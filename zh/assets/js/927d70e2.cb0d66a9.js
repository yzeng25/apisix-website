"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[1045],{13192:n=>{n.exports=JSON.parse('{"blogPosts":[{"id":"APISIX \u7684\u51fa\u6d77\u5f81\u7a0b\u52bf\u5982\u7834\u7af9\uff1aAPISIX \u9a6c\u6765\u897f\u4e9a Meetup","metadata":{"permalink":"/zh/blog/2023/07/12/2023-apisix-meetup-malaysia","source":"@site/blog/2023/07/12/2023-apisix-meetup-malaysia.md","title":"APISIX \u7684\u51fa\u6d77\u5f81\u7a0b\u52bf\u5982\u7834\u7af9\uff1aAPISIX \u9a6c\u6765\u897f\u4e9a Meetup","description":"7 \u6708 4 \u65e5\uff0c2023 APISIX \u5f00\u6e90\u793e\u533a Meetup \u5728\u9a6c\u6765\u897f\u4e9a\u9996\u90fd\u5409\u9686\u5761\u6210\u529f\u4e3e\u529e\u3002","date":"2023-07-12T00:00:00.000Z","formattedDate":"2023\u5e747\u670812\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":15.685,"truncated":true,"authors":[{"name":"Yilia Lin","title":"Author","url":"https://github.com/Yilialinn","image_url":"https://avatars.githubusercontent.com/u/114121331?v=4","imageURL":"https://avatars.githubusercontent.com/u/114121331?v=4"}],"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (6.19 - 7.02)","permalink":"/zh/blog/2023/07/05/weekly-report"}},"content":"> 7 \u6708 4 \u65e5\uff0c2023 APISIX \u5f00\u6e90\u793e\u533a Meetup \u5728\u9a6c\u6765\u897f\u4e9a\u9996\u90fd\u5409\u9686\u5761\u6210\u529f\u4e3e\u529e\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u8fd1\u65e5\uff0cApache APISIX \u53d1\u8d77\u7684\u6280\u672f\u76db\u5bb4\uff0c\u5728\u9a6c\u6765\u897f\u4e9a\u9996\u90fd\u5409\u9686\u5761\u9686\u91cd\u5f00\u5e55\uff01\u6d3b\u52a8\u7531 [API7\uff08\u652f\u6d41\u79d1\u6280\uff09](https://www.apiseven.com/)\u4e0e [N2N\uff08N2N Connect Berhad\uff0c\u8054\u5723\uff09](https://www.n2nconnect.com/)\u53ca [AMD\uff08Advanced Micro Devices, Inc.,\uff09](https://www.amd.com/en.html)\u8054\u5408\u4e3e\u529e\uff0c\u6c47\u96c6\u4e86\u4f17\u591a API \u7f51\u5173\u6280\u672f\u9886\u57df\u7684\u4e13\u5bb6\u548c\u7231\u597d\u8005\u3002\\n\\nAPISIX \u5728\u9a6c\u6765\u897f\u4e9a\u4e0e\u65b0\u52a0\u5761\u6709\u5f88\u591a\u6765\u81ea\u91d1\u878d\u3001IT \u7b49\u9886\u57df\u7684\u7528\u6237\uff0c\u5176\u4e2d\u4e0d\u5c11\u516c\u53f8\u4e13\u7a0b\u6765\u5230\u4e86\u73b0\u573a\uff0c\u4ea6\u6709\u4f17\u591a\u5173\u6ce8\u8005\u5728\u7ebf\u4e0a\u89c2\u770b\u4e86\u6b64\u6b21\u6d3b\u52a8\u3002\u73b0\u573a\uff0c[APISIX PMC \u6210\u5458](https://apisix.apache.org/zh/team/)\u53ca\u4f17\u591a\u8d21\u732e\u8005\u9f50\u805a\u4e00\u5802\uff0c\u63a2\u8ba8\u4e86 API \u7f51\u5173\u6280\u672f\u7684\u6700\u65b0\u8fdb\u5c55\u548c\u672a\u6765\u53d1\u5c55\u8d8b\u52bf\uff0c\u5206\u4eab\u4e86\u4ed6\u4eec\u5728\u5b9e\u8df5\u4e2d\u7684\u7ecf\u9a8c\u548c\u89c1\u89e3\u3002\\n\\n\u70ed\u70c8\u7684\u6c1b\u56f4\u548c\u4ea4\u6d41\u8ba9\u8fd9\u4e2a Meetup \u6210\u4e3a\u4e86\u4e00\u4e2a\u6c47\u805a\u667a\u6167\u548c\u521b\u65b0\u7684\u5e73\u53f0\uff0c\u4e3a API \u7f51\u5173\u6280\u672f\u7684\u53d1\u5c55\u6ce8\u5165\u4e86\u65b0\u7684\u6d3b\u529b\u548c\u52a8\u529b\uff01\\n\\n## \u4ed6\u4eec\u8bf4\\n\\n\u4e3a\u671f\u4e00\u5929\u7684 Meetup \u5927\u83b7\u597d\u8bc4\uff01\u5176\u4e2d Bryan \u662f\u9a6c\u6765\u897f\u4e9a\u7b2c\u4e00\u80a1\u7968\u4ea4\u6613\u5e73\u53f0 N2N \u7684\u4e1a\u52a1\u62d3\u5c55\u7ecf\u7406\uff0c\u4ed6\u8868\u793a\uff1a\\n\\n> \u201c\u4eca\u5929\u7684 meetup \u5f88\u6210\u529f\uff01\u5bf9\u4e8e\u9a6c\u6765\u897f\u4e9a\u7684\u5de5\u7a0b\u5e08\u4eec\u6765\u8bf4\uff0c\u80fd\u548c\u8fd9\u4e48\u591a\u5f00\u53d1\u4eba\u5458\u5f53\u9762\u6c9f\u901a\u5e76\u89e3\u51b3\u95ee\u9898\uff0c\u8fd9\u662f\u4e00\u6b21\u975e\u5e38\u597d\u7684\u673a\u4f1a\u3002\u56e0\u4e3a\u4ed6\u4eec\u51e0\u4e4e\u90fd\u662f\u5728\u7ebf\u4e0a\u5b66\u4e60\u7814\u53d1\uff0c\u4f46\u662f\u5f88\u591a\u5b9e\u9645\u7684\u95ee\u9898\u5f88\u96be\u5728\u7ebf\u4e0a\u89e3\u51b3\uff0c\u56e0\u800c\u7ebf\u4e0b\u7684\u6c9f\u901a\u548c\u4ea4\u6d41\u662f\u5f88\u6709\u5fc5\u8981\u7684\u3002\\n>\\n> \u4ece\u6574\u4f53\u6765\u770b\uff0cAPISIX \u524d\u666f\u4e00\u7247\u5149\u660e\u3002\u4ece\u4eca\u5929\u53c2\u4f1a\u4eba\u5458\u7684\u53cd\u9988\u6765\u770b\uff0c\u5927\u5bb6\u90fd\u5f88\u559c\u7231 APISIX \u8fd9\u4e2a\u9879\u76ee\uff0c\u4e5f\u6709\u5f88\u591a\u7528\u6237\u6b63\u5728\u4f7f\u7528 APISIX\uff0c \u5b83\u5728\u9a6c\u6765\u897f\u4e9a\u4e00\u5b9a\u4f1a\u8d8a\u6765\u8d8a\u597d\uff01\u6211\u4eec\u5f88\u5f00\u5fc3\u80fd\u89c1\u5230\u8fd9\u4e48\u591a\u5fd7\u8da3\u76f8\u6295\u7684\u540c\u4f34\uff0c\u4e5f\u5e0c\u671b\u4ee5\u540e\u4f1a\u6709\u66f4\u591a\u7684\u673a\u4f1a\u548c\u4f60\u4eec\u4e00\u8d77\u5408\u4f5c\uff01\u201d\\n\\nMichael \u662f\u4e00\u5bb6\u8de8\u56fd\u91d1\u878d\u79d1\u6280\u516c\u53f8\u7684 SRE \u8d1f\u8d23\u4eba\uff0c\u4ed6\u8868\u793a\uff1a\\n\\n> \u201c\u6211\u4eec\u6b63\u5728\u5bfb\u6c42\u65b0\u7684 API \u7f51\u5173\uff0c\u5bf9 APISIX \u5904\u7406\u6d41\u91cf\u7684\u4eae\u70b9\u5f88\u611f\u5174\u8da3\uff0c\u5927\u4f1a\u4e0a\u5206\u4eab\u7684\u91d1\u878d\u884c\u4e1a\u7528\u6237\u6848\u4f8b\u5f88\u6709\u501f\u9274\u610f\u4e49\uff0c\u975e\u5e38\u671f\u5f85\u80fd\u65e9\u65e5\u611f\u53d7 APISIX \u7684\u9b45\u529b\uff01\u201d\\n\\nJoey \u662f\u4e00\u540d\u8f6f\u4ef6\u5de5\u7a0b\u5e08\uff0c\u4ed6\u5bf9\u4eca\u5929\u7684 Meetup \u5185\u5bb9\u8d5e\u4e0d\u7edd\u53e3\uff1a\\n\\n> \u201c\u4eca\u5929\u7684 meetup \u5185\u5bb9\u7fd4\u5b9e\uff0c\u6f14\u793a\u7684 demo \u4e5f\u5f88\u8be6\u5c3d\uff0c\u6211\u5b66\u5230\u4e86\u5f88\u591a\u3002\u4e4b\u524d\u5e76\u4e0d\u4e86\u89e3 APISIX\uff0c\u53ea\u4e86\u89e3 GCP\u3001AWS \u7b49\uff0c\u73b0\u5728\u4e86\u89e3\u4e86APISIX\uff0c\u4ee5\u540e\u4e00\u5b9a\u4f1a\u6709\u66f4\u591a\u673a\u4f1a\u5728\u5de5\u4f5c\u4e2d\u4f7f\u7528\u3002\u201d\\n\\n## \u6e29\u94ed\uff1aAPISIX \u7684\u524d\u4e16\u4eca\u751f\\n\\n> [\u6e29\u94ed](https://www.linkedin.com/in/ming-wen-api7/)\uff0cApache APISIX PMC \u4e3b\u5e2d\u3001Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u6210\u5458\u3001Kubernetes \u6210\u5458\u3001API7.ai \u8054\u5408\u521b\u59cb\u4eba\u517c CEO\\n\\n![Ming Wen](https://static.apiseven.com/uploads/2023/07/07/wv8WK1TY_meetup1.jpeg)\\n\\n\u6e29\u94ed\u9996\u5148\u5206\u4eab\u4e86 APISIX \u8bde\u751f\u7684\u6545\u4e8b\u3002\u4ed6\u548c\u9662\u751f\u70ed\u7231\u4ee3\u7801\uff0c\u5fd7\u540c\u9053\u5408\uff0c\u60f3\u6311\u6218\u81ea\u6211\uff0c\u505a\u4e9b\u6709\u96be\u5ea6\u7684\u4e8b\u60c5\u3002\u5728\u521d\u521b\u65f6\u671f\uff0c\u4ed6\u4eec\u6ca1\u65e5\u6ca1\u591c\u5730\u5f85\u5728\u903c\u4ec4\u7684\u5c0f\u623f\u95f4\u91cc\uff0c\u4e13\u6ce8\u4e8e\u5199\u4ee3\u7801\uff0c\u6700\u7ec8\u5f00\u521b\u4e86 APISIX\u3002\\n\\n\u4e3a\u4e86\u8ba9\u5168\u4e16\u754c\u7684\u5f00\u53d1\u8005\u90fd\u80fd\u5171\u4eab\u4ed6\u4eec\u7684\u6210\u679c\uff0c\u4ed6\u4eec\u51b3\u5b9a\u5c06 APISIX \u6350\u8d60\u7ed9 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u3002\u81ea\u6b64\u4ee5\u540e\uff0cApache APISIX \u4e00\u76f4\u9075\u5faa\u201cCommunity over Code\u201d\u7684\u539f\u5219\uff0c\u7531[\u793e\u533a](https://apisix.apache.org/zh/blog/tags/community/)\u9a71\u52a8\u3002APISIX \u5c06\u8d21\u732e\u8005\u89c6\u4e3a\u5408\u4f5c\u4f19\u4f34\uff0c\u8fd9\u4e5f\u5438\u5f15\u4e86\u4e16\u754c\u5404\u5730\u7684\u4f18\u79c0\u5f00\u53d1\u4eba\u5458\u6301\u7eed\u4e3a APISIX \u9879\u76ee\u8d21\u732e\u81ea\u5df1\u7684\u529b\u91cf\u3002\u56db\u5e74\u5982\u4e00\u65e5\uff0cAPISIX \u9879\u76ee\u7684\u95ee\u9898\u54cd\u5e94\u65f6\u95f4\u90fd\u80fd\u7ef4\u6301\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u5185\uff0c\u6d3b\u8dc3\u7684\u793e\u533a\u662f APISIX \u7115\u53d1\u751f\u673a\u7684\u52a8\u529b\u3002\u5b83\u4e0d\u65ad\u5438\u5f15\u7740\u66f4\u591a\u7684\u4eba\u52a0\u5165\uff0c\u4e3a APISIX \u6ce8\u5165\u65b0\u7684\u8840\u6db2\u548c\u7075\u9b42\u3002\\n\\n![Time of Issues Responded](https://static.apiseven.com/uploads/2023/07/07/FGcdrAPT_2.png)\\n\\nAPISIX \u7684\u7528\u6237\u904d\u5e03\u6d77\u5916\uff0c\u5168\u7403\u5df2\u7ecf\u6709\u6570\u767e\u5bb6\u4f01\u4e1a\u7528\u6237\u5728\u4f7f\u7528\u6211\u4eec\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u6db5\u76d6\u4e86\u91d1\u878d\u3001\u4e92\u8054\u7f51\u3001\u5236\u9020\u3001\u96f6\u552e\u3001\u8fd0\u8425\u5546\u7b49\u591a\u4e2a\u884c\u4e1a\u3002\u4ece\u6708\u6d3b\u7528\u6237 5.13 \u4ebf\u7684[\u7231\u5947\u827a](https://api7.ai/blog/iqiyi-api-gateway-update-and-deployment-based-on-apache-apisix)\u5230\u6570\u636e\u4f20\u8f93\u8de8\u8d8a\u8d85\u8fc7 130 \u4e2a\u56fd\u5bb6\u548c\u5730\u533a\u7684 [Airwallex\uff08\u7a7a\u4e2d\u4e91\u6c47\uff09](https://api7.ai/blog/how-airwallex-empowers-global-payment-through-apache-apisix)\uff0c\u751a\u81f3\u5168\u7403\u9886\u5148\u7684\u5728\u7ebf\u4f1a\u8bae\u5e73\u53f0 [Zoom](https://api7.ai/blog/zoom-uses-apisix-ingress) \u4ee5\u53ca\u7d2f\u8ba1\u4ea4\u6613\u603b\u989d\u8d85\u4e07\u4ebf\u7684\u5168\u7403\u5316\u52a0\u5bc6\u91d1\u878d\u670d\u52a1\u5546 [Amber \u96c6\u56e2](https://api7.ai/blog/amber-api-gateway-architecture)\uff0c\u90fd\u5728\u4f7f\u7528\u6211\u4eec\u7684\u65b9\u6848\u5904\u7406\u6838\u5fc3\u4e1a\u52a1\u6d41\u91cf\u3002\\n\\n\u672a\u6765\uff0cAPISIX \u5c06\u5728 AI \u65b9\u5411\u53d1\u529b\u3002\u5176\u5b9e\uff0c\u65e9\u5728 2022 \u5e74 10 \u6708\uff0cAPISIX \u7684 [AI \u6a21\u5757](https://github.com/apache/apisix/pull/8102/files)\u5df2\u7ecf\u521d\u5177\u96cf\u5f62\u3002\u8fd9\u4e00\u521b\u65b0\u5c06\u4e3a\u5f00\u53d1\u8005\u5e26\u6765\u66f4\u52a0\u667a\u80fd\u5316\u7684 API \u7ba1\u7406\u4f53\u9a8c\uff0c\u5e2e\u52a9\u4ed6\u4eec\u66f4\u597d\u5730\u5e94\u5bf9\u65e5\u76ca\u590d\u6742\u7684\u4e1a\u52a1\u573a\u666f\u3002\\n\\n\u9664\u6b64\u4e4b\u5916\uff0cAPISIX \u8fd8\u5c06\u81f4\u529b\u4e8e\u51cf\u8f7b API \u8bbe\u8ba1\u7684\u6210\u672c\uff0c\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u66f4\u52a0\u9ad8\u6548\u7684\u5de5\u5177\u548c\u652f\u6301\u3002\u540c\u65f6\uff0cAPISIX \u8fd8\u5c06\u534f\u52a9\u7ba1\u7406\u5c42\u505a\u51fa\u66f4\u660e\u667a\u7684\u51b3\u7b56\u3002\u8fd9\u4e9b\u4e3e\u63aa\u5c06\u4e3a\u5f00\u53d1\u8005\u548c\u4f01\u4e1a\u5e26\u6765\u66f4\u591a\u7684\u4ef7\u503c\uff0c\u4e5f\u5c06\u63a8\u52a8\u6574\u4e2a\u884c\u4e1a\u5411\u7740\u66f4\u52a0\u667a\u80fd\u5316\u548c\u9ad8\u6548\u7684\u65b9\u5411\u53d1\u5c55\u3002\\n\\n## \u738b\u9662\u751f\uff1a\u91d1\u878d\u516c\u53f8\u5982\u4f55\u4f7f\u7528 APISIX\uff1f\\n\\n> [\u738b\u9662\u751f](https://www.linkedin.com/in/yuansheng-wang-84014022a/)\uff0cApache APISIX PMC \u6210\u5458\u3001API7.ai \u8054\u5408\u521b\u59cb\u4eba\u517c CTO\u3001\u300aApache APISIX \u5b9e\u6218\u300b\u4f5c\u8005\u4e4b\u4e00\uff0c\u4e0b\u56fe\u662f\u9662\u751f\uff08\u53f3\uff09\u5728\u548c\u73b0\u573a\u89c2\u4f17\u63a2\u8ba8\u6280\u672f\u7ec6\u8282\\n\\n![Yuansheng (right) is discussing technical details with the audience](https://static.apiseven.com/uploads/2023/07/07/3kshxsgx_3.jpeg)\\n\\nAPI \u8fde\u63a5\u7740\u6570\u5b57\u4e16\u754c\u7684\u201c\u4ea4\u901a\u201d\uff0c\u800c APISIX \u5219\u662f\u201c\u4ea4\u901a\u8def\u7ebf\u201d\u4e0a\u7684\u6838\u5fc3\u5de5\u5177\u3002\u5728\u73b0\u4ee3\u67b6\u6784\u4e2d\uff0cAPISIX \u5728 API \u7684\u5168\u751f\u547d\u5468\u671f\u7ba1\u7406\u4e0a\u626e\u6f14\u7740\u4e3e\u8db3\u8f7b\u91cd\u7684\u89d2\u8272\u3002\u8fd9\u4e00\u521b\u65b0\u7684 API \u7ba1\u7406\u5e73\u53f0\uff0c\u4e3a\u5f00\u53d1\u8005\u548c\u4f01\u4e1a\u5e26\u6765\u4e86\u66f4\u9ad8\u6548\u3001\u66f4\u667a\u80fd\u7684 API \u7ba1\u7406\u65b9\u6848\u3002\\n\\nAPISIX \u5df2\u7ecf\u8d62\u5f97\u4e86\u4f17\u591a\u91d1\u878d\u516c\u53f8\u7528\u6237\u7684\u9752\u7750\uff0c\u5176\u4e2d\u5305\u62ec [Airwallex](https://api7.ai/blog/how-airwallex-empowers-global-payment-through-apache-apisix)\u3001[\u5b89\u4fe1\u8bc1\u5238](https://api7.ai/blog/essence-securities-selects-apisix)\u3001\u5e7f\u53d1\u8bc1\u5238\u3001[Amber \u96c6\u56e2](https://api7.ai/blog/amber-api-gateway-architecture)\u3001[\u96ea\u7403](https://api7.ai/blog/snowball-finance-with-apisix)\u7b49\u7b49\u3002\u8fd9\u4e9b\u4f01\u4e1a\u90fd\u6df1\u77e5 API \u5728\u6570\u5b57\u5316\u8f6c\u578b\u4e2d\u7684\u91cd\u8981\u6027\uff0c\u5e76\u901a\u8fc7 APISIX \u83b7\u5f97\u4e86\u66f4\u52a0\u9ad8\u6548\u3001\u5b89\u5168\u548c\u667a\u80fd\u7684 API \u7ba1\u7406\u4f53\u9a8c\u3002APISIX \u7684\u6210\u5c31\u4e0d\u4ec5\u5f70\u663e\u4e86\u5176\u5728\u6570\u5b57\u5316\u8f6c\u578b\u8fc7\u7a0b\u4e2d\u7684\u91cd\u8981\u6027\uff0c\u4e5f\u4e3a\u6574\u4e2a\u884c\u4e1a\u63d0\u4f9b\u4e86\u65b0\u7684\u601d\u8def\u548c\u65b9\u5411\u3002[API7](https://api7.ai/) \u5728 APISIX \u7684\u57fa\u7840\u4e0a\u63d0\u4f9b\u4e86\u66f4\u6df1\u5ea6\u7684[\u4f01\u4e1a\u7ea7\u4ea7\u54c1](https://api7.ai/enterprise)\u3002\\n\\n### \u7a7a\u4e2d\u4e91\u6c47\uff08Airwallex\uff09\\n\\n\u968f\u7740 [Airwallex](https://api7.ai/blog/how-airwallex-empowers-global-payment-through-apache-apisix) \u7684\u4e1a\u52a1\u5728\u5168\u7403\u8303\u56f4\u5185\u6269\u5c55\uff0c\u6570\u636e\u6cbb\u7406\u9762\u4e34\u91cd\u5927\u6311\u6218\uff0c\u540c\u65f6\u5185\u90e8\u7cfb\u7edf\u7ba1\u7406\u548c\u4e92\u8054\u9519\u7efc\u590d\u6742\uff0c\u4e00\u65e6\u67d0\u4e2a\u7cfb\u7edf\u51fa\u73b0\u95ee\u9898\uff0c\u5f88\u5bb9\u6613\u5f71\u54cd\u5176\u4ed6\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0cAirwallex \u5bfb\u6c42\u9ad8\u7a33\u5b9a\u3001\u53ef\u9760\u3001\u53ef\u7528\u7684 API \u7f51\u5173\uff0c\u8981\u6c42\u4f4e\u5ef6\u8fdf\u548c\u826f\u597d\u7684\u6027\u80fd\uff0c\u8fd8\u8981\u6c42\u652f\u6301\u81ea\u5b9a\u4e49\u63d2\u4ef6\uff0c\u4f8b\u5982\u6309\u7528\u6237\u8def\u7531 API \u548c\u9650\u901f\u9650\u6d41\u3002APISIX \u6ee1\u8db3\u4e86\u8fd9\u4e9b\u8981\u6c42\uff0c\u5e76\u5e2e\u52a9 Airwallex \u89e3\u51b3\u4e86\u6570\u636e\u4e3b\u6743\u7684\u95ee\u9898\uff0c\u5b89\u5168\u9ad8\u6548\u5730\u652f\u6491 Airwallex \u8986\u76d6 130 \u591a\u4e2a\u56fd\u5bb6\u548c\u5730\u533a 50 \u591a\u79cd\u5e01\u79cd\u7684\u4e1a\u52a1\u3002\\n\\n### \u5b89\u4fe1\u8bc1\u5238\\n\\n[\u5b89\u4fe1\u8bc1\u5238](https://api7.ai/blog/essence-securities-selects-apisix)\u539f\u6709\u7684\u6280\u672f\u6808\u6bd4\u8f83\u590d\u6742\uff0c\u5305\u542b NGINX\u3001Spring Cloud \u7f51\u5173\u548c\u81ea\u4e3b\u7814\u53d1\u7cfb\u7edf\u3002\u8fd9\u79cd\u5206\u6563\u7684\u67b6\u6784\u5bfc\u81f4\u4e86\u7cfb\u7edf\u7ba1\u7406\u548c\u91cd\u590d\u5de5\u4f5c\u7684\u95ee\u9898\uff0c\u589e\u52a0\u4e86\u5f00\u53d1\u6210\u672c\u3002APISIX \u6613\u4e8e\u4e0e\u5b89\u4fe1\u8bc1\u5238\u4e1a\u52a1\u7cfb\u7edf\u96c6\u6210\uff0c\u5177\u5907\u9ad8\u6027\u80fd\u548c\u6a2a\u5411\u6269\u5c55\u80fd\u529b\uff0c\u540c\u65f6\u62e5\u6709\u5f3a\u5927\u4e30\u5bcc\u7684\u6d41\u91cf\u6cbb\u7406\u3001\u5b89\u5168\u3001\u534f\u8bae\u8f6c\u6362\u3001\u6388\u6743\u3001\u9274\u6743\u7b49\u529f\u80fd\u3002APISIX \u5e2e\u52a9\u5b89\u4fe1\u8bc1\u5238\u63a8\u8fdb\u4e86\u6d41\u91cf\u6cbb\u7406\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u7814\u53d1\u7684\u6548\u7387\uff0c\u540c\u65f6\u589e\u5f3a\u4e86\u6570\u636e\u5b89\u5168\u548c\u6743\u9650\u7ba1\u7406\u3002\u73b0\u5728\uff0cAPISIX \u5df2\u7ecf\u6210\u4e3a\u5b89\u4fe1\u8bc1\u5238\u4e91\u539f\u751f\u5f00\u53d1\u7684\u91cd\u8981\u652f\u6491\uff0c\u5e2e\u52a9\u4ed6\u4eec\u66f4\u52a0\u9ad8\u6548\u5730\u7ba1\u7406\u548c\u5f00\u53d1\u4e1a\u52a1\u3002\\n\\n\u67e5\u770b\u66f4\u591a\u7c7b\u4f3c\u7528\u6237\u6848\u4f8b\uff0c\u8bf7\u67e5\u9605\uff1a[https://api7.ai/category/usercase](https://api7.ai/category/usercase)\u3002\\n\\n## Bobur\uff1a\u57fa\u4e8e\u7528\u6237\u51ed\u8bc1\u5bf9 API \u7f51\u5173\u8fdb\u884c\u52a8\u6001\u8def\u7531\\n\\n> [Bobur Umurzokov](https://www.linkedin.com/in/boburumurzokov/)\uff0cApache APISIX \u5e03\u9053\u5e08\uff0cAPI7 \u5e03\u9053\u5e08\\n\\n\u901a\u8fc7\u4f7f\u7528 API \u7f51\u5173\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u5404\u79cd\u6807\u51c6\u5c06\u6d41\u91cf\u8def\u7531\u5230\u4e0d\u540c\u7684\u540e\u7aef\u670d\u52a1\u3002\u901a\u8fc7\u6f14\u793a\uff0cBobur \u8bb2\u89e3\u4e86\u5982\u4f55\u6839\u636e\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u67e5\u8be2\u6216\u8bf7\u6c42\u4f53\u4e2d\u6307\u5b9a\u7684\u7528\u6237\u5c5e\u6027\u6765\u5b9e\u73b0\u52a8\u6001\u8def\u7531\u3002\\n\\n\u66f4\u591a\u7ec6\u8282\u53ef\u67e5\u770b [Bobur \u7684\u6587\u7ae0](https://api7.ai/blog/dynamic-routing-based-on-user-credentials)\u3002\\n\\n![Bobur is demonstrating how to route traffic](https://static.apiseven.com/uploads/2023/07/07/AoFBgxlM_meetup5.png)\\n\\n## \u5f20\u8d85\uff1aApache APISIX \u4e91\u4e0a\u5b9e\u8df5\\n\\n> [\u5f20\u8d85](https://www.linkedin.com/in/chao-zhang-52a106107/)\uff0cApache APISIX PMC \u6210\u5458\uff0c\u5f00\u6e90\u7231\u597d\u8005\uff0cOpenResty\u3001Kubernetes Ingress-NGINX\u3001Kuberentes Gateway API \u7b49\u9879\u76ee\u8d21\u732e\u8005\\n\\n![Chao Zhang](https://static.apiseven.com/uploads/2023/07/07/V4FYhaOD_6.jpeg)\\n\\n\u5982\u4eca\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u516c\u53f8\u6b63\u5728\u91c7\u7528\u4e91\u4f9b\u5e94\u5546\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u8d8a\u6765\u8d8a\u591a\u7684 IT \u4e13\u4e1a\u4eba\u5458\u4e5f\u5728\u5b66\u4e60\u4e91\u6280\u672f\u5806\u6808\uff0c\u751a\u81f3\u8fdb\u884c\u81ea\u6211\u8ba4\u8bc1\u3002\u4e91\u4f5c\u4e3a\u57fa\u7840\u8bbe\u65bd\uff0c\u6a2a\u8de8 SaaS\uff0c\u5df2\u7ecf\u6210\u4e3a\u4e86\u4f01\u4e1a\u548c\u4e2a\u4eba\u8fdb\u884c\u6570\u5b57\u5316\u8f6c\u578b\u7684\u9996\u9009\u4e4b\u4e00\uff0c\u5e76\u4e14\u6b63\u5728\u4ee5\u60ca\u4eba\u7684\u901f\u5ea6\u589e\u957f\u3002\\n\\n\u8003\u8651\u5230\u591a\u4e91\u548c\u6df7\u5408\u4e91\u7684\u573a\u666f\u4e0b\uff0c\u7edf\u4e00\u7ba1\u7406 API \u7684\u4f7f\u7528\u5c06\u4f1a\u662f\u4e00\u4e2a\u5de8\u5927\u7684\u6311\u6218\u3002\u8fd9\u6b63\u662f [API7 Cloud](https://api7.ai/cloud) \u5e94\u8fd0\u800c\u751f\u7684\u539f\u56e0\uff1a\u5b83\u80fd\u591f\u5e2e\u52a9\u4f01\u4e1a\u89e3\u51b3\u591a\u4e91\u548c\u6df7\u5408\u4e91\u573a\u666f\u4e0b\u7684\u95ee\u9898\u3002\\n\\nAPI7 Cloud \u57fa\u4e8e Apache APISIX\uff0c\u56f4\u7ed5\u7740 Apache APISIX \u6240\u63d0\u4f9b\u7684\u529f\u80fd\u8fdb\u884c\u4e86\u4ea7\u54c1\u5316\uff0c\u65e8\u5728\u8ba9\u7528\u6237\u66f4\u7b80\u5355\u3001\u66f4\u653e\u5fc3\u5730\u914d\u7f6e\u548c\u4f7f\u7528 APISIX\u3002API7 Cloud \u4ee5 Apache APISIX \u4e3a\u57fa\u7840\uff0c\u53c8\u5bf9\u5b83\u8fdb\u884c\u4e86\u66f4\u4f01\u4e1a\u5316\u7684\u5b9a\u5236\uff0c\u4f8b\u5982\u5f3a\u5316\u4e86\u5f00\u6e90 APISIX \u7684\u52a8\u6001\u80fd\u529b\uff0c\u652f\u6301\u4e86\u52a8\u6001\u7684\u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff1b\u5f00\u653e API \u4e14\u63d0\u4f9b SDK\uff0c\u5141\u8bb8\u81ea\u52a8\u5316\u7684 API \u7ba1\u7406\uff0c\u5141\u8bb8\u901a\u8fc7\u7a0b\u5e8f\u96c6\u6210 API7 Cloud \u5b9e\u73b0\u81ea\u52a8\u5316\u3002\\n\\n\u76f8\u6bd4\u672c\u5730\u8bbe\u5907\uff0cAPI7 Cloud \u5177\u6709\u66f4\u9ad8\u7684\u5b89\u5168\u6027\u3001\u66f4\u597d\u7684\u53ef\u6269\u5c55\u6027\uff0c\u800c\u4e14\u7ef4\u62a4\u548c\u66f4\u65b0\u7684\u6210\u672c\u4e5f\u66f4\u4f4e\u3002API7 Cloud \u80fd\u591f\u6258\u7ba1\u63a7\u5236\u9762\uff0c\u540c\u65f6\u5728\u4efb\u4f55\u5730\u65b9\u3001\u4efb\u4f55\u57fa\u7840\u8bbe\u65bd\u4e0a\u90e8\u7f72 API \u7f51\u5173\u7684\u6570\u636e\u9762\uff0c\u8ba9\u7528\u6237\u80fd\u591f\u66f4\u52a0\u8f7b\u677e\u5730\u7ba1\u7406\u4ed6\u4eec\u7684 API\uff0c\u540c\u65f6\u5185\u7f6e\u53ef\u89c2\u6d4b\u6027\uff0c\u8ba9\u7528\u6237\u80fd\u591f\u66f4\u52a0\u6e05\u6670\u5730\u4e86\u89e3\u4ed6\u4eec API \u7684\u4f7f\u7528\u60c5\u51b5\u548c\u6027\u80fd\u8868\u73b0\u3002\\n\\n![Built-in Observability Support of API7](https://static.apiseven.com/uploads/2023/07/07/KE26wb3m_7.png)\\n\\n## Nicolas\uff1a\u6570\u636e\u9a7b\u7559\u7ba1\u7406\\n\\n> [Nicolas Fr\xe4nkel](https://www.linkedin.com/in/nicolasfrankel/)\uff0c\u7814\u53d1\u5de5\u7a0b\u5e08\uff0cAPISIX \u5e03\u9053\u5e08\uff0cAPI7 \u5e03\u9053\u5e08\\n\\n![Nicolas Fr\xe4nkel](https://static.apiseven.com/uploads/2023/07/07/YYJ9lHsQ_a5592a72-fb7d-4841-bbb6-ae29235bb569.jpeg)\\n\\n\u6570\u636e\u9a7b\u7559\u662f\u4e00\u4e2a\u5907\u53d7\u5173\u6ce8\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u5728\u4e0d\u540c\u7684\u56fd\u5bb6\u548c\u5730\u533a\uff0c\u6cd5\u5f8b\u6cd5\u89c4\u5bf9\u4e8e\u6570\u636e\u5b58\u50a8\u548c\u5904\u7406\u7684\u8981\u6c42\u662f\u4e0d\u540c\u7684\u3002\u800c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4e91\u4f9b\u5e94\u5546\u53ef\u80fd\u6ca1\u6709\u5728\u6240\u9700\u4f4d\u7f6e\u5efa\u7acb\u6570\u636e\u4e2d\u5fc3\uff0c\u8fd9\u5c31\u9700\u8981\u6211\u4eec\u601d\u8003\u5982\u4f55\u7ba1\u7406\u6570\u636e\u9a7b\u7559\u95ee\u9898\u3002\\n\\n\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0cNicolas \u5728\u4f1a\u4e0a\u5206\u4eab\u4e86\u56db\u79cd\u65b9\u5f0f\uff1a\u5728\u4ee3\u7801\u5c42\u3001\u5e93/\u6846\u67b6\u3001\u4ee3\u7406\u548c\u7f51\u5173\u4e2d\u7ba1\u7406\u6570\u636e\u9a7b\u7559\u3002\u8fd9\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u5e2e\u52a9\u66f4\u597d\u5730\u7ba1\u7406\u6570\u636e\uff0c\u540c\u65f6\u786e\u4fdd\u9075\u5b88\u4e0d\u540c\u56fd\u5bb6\u548c\u5730\u533a\u7684\u6cd5\u5f8b\u6cd5\u89c4\uff0c\u4fdd\u62a4\u7528\u6237\u7684\u9690\u79c1\u548c\u6570\u636e\u5b89\u5168\u3002\\n\\n\u901a\u8fc7\u73b0\u573a\u6f14\u793a demo\uff0cNicolas \u751f\u52a8\u5f62\u8c61\u5730\u5411\u4e0e\u4f1a\u8005\u5c55\u793a\u4e86\u8fd9\u4e9b\u65b9\u6cd5\u7684\u64cd\u4f5c\u8fc7\u7a0b\u548c\u6548\u679c\uff0c\u8ba9\u5927\u5bb6\u66f4\u597d\u5730\u7406\u89e3\u5982\u4f55\u5728\u4e0d\u540c\u7684\u60c5\u51b5\u4e0b\u7ba1\u7406\u6570\u636e\u9a7b\u7559\u95ee\u9898\u3002\\n\\n\u6b64\u5916\uff0c\u6765\u81ea AMD \u7684\u4e1c\u76df\u5546\u52a1\u4e3b\u7ba1 [Koh Lian Chong](https://www.linkedin.com/in/koh-lian-chong-2b1713/?originalSubdomain=sg) \u5206\u4eab\u4e86 AMD \u5982\u4f55\u8d4b\u80fd\u5168\u7403\u6570\u636e\u4e2d\u5fc3\uff0c\u4ed6\u5411\u5927\u5bb6\u4ecb\u7ecd\u4e86 AMD \u7684\u5386\u53f2\u548c\u4ea7\u54c1\u3002\u540c\u65f6\uff0c\u6765\u81ea ShapeBlue \u7684\u8d28\u91cf\u4fdd\u8bc1\u5de5\u7a0b\u5e08 [Kiran Chavala](https://www.linkedin.com/in/kiran-chavala-1bb6a97/) \u4ecb\u7ecd\u4e86 Apache CloudStack\uff0c\u5b83\u662f\u4e00\u4e2a\u9ad8\u53ef\u7528\u6027\u548c\u53ef\u6269\u5c55\u6027\u7684\u5f00\u6e90\u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u548c APISIX \u642d\u914d\u4f7f\u7528\u80fd\u591f\u6781\u5927\u5730\u63d0\u5347\u5f00\u53d1\u6548\u7387\u3002\\n\\n## \u8fc5\u731b\u53d1\u5c55\u7684\u4eca\u5929\u4e0e\u672a\u6765\\n\\n\u9a6c\u6765\u897f\u4e9a\u6709\u8bb8\u591a\u91d1\u878d\u79d1\u6280\u516c\u53f8\u6b63\u5728\u4f7f\u7528 [APISIX](https://github.com/apache/apisix-website)\uff0c\u6781\u5927\u7684\u4e00\u4e2a\u56e0\u7d20\u5728\u4e8e APISIX \u7684\u9ad8\u6027\u80fd\uff0c\u540c\u65f6\u5b83\u662f\u8f7b\u91cf\u7ea7\u7684\uff0c\u6613\u4e8e\u7ba1\u7406\u548c\u4f7f\u7528\u3002APISIX \u53ef\u4ee5\u5728\u5355\u4e2a\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\uff0c\u53ef\u4ee5\u7528\u4e8e\u591a\u4e2a\u670d\u52a1\u5668\u5904\u7406\u6570\u5341\u4ebf\u6d41\u91cf\uff0c\u8fd8\u53ef\u4ee5\u5feb\u901f\u5730\u5b89\u88c5\u548c\u5f15\u5bfc\u3002\u9a6c\u6765\u897f\u4e9a\u7684\u4e00\u5bb6\u5927\u578b\u8de8\u56fd\u96c6\u56e2\u6b63\u5728\u4f7f\u7528 APISIX \u6765\u5904\u7406\u652f\u4ed8\uff0c\u4f17\u591a\u91d1\u878d\u79d1\u6280\u516c\u53f8\u90fd\u503e\u5411\u4e8e\u4f7f\u7528 APISIX \u4f5c\u4e3a\u652f\u4ed8\u7f51\u5173\u3002\\n\\n![2023 APISIX Meetup Malaysia](https://static.apiseven.com/uploads/2023/07/07/YFHhI10g_meetup10.jpeg)\\n\\n\u611f\u8c22\u6240\u6709\u6f14\u8bb2\u8005\u3001\u53c2\u4e0e\u8005\u4ee5\u53ca\u7ec4\u7ec7\u65b9\uff0c\u4f60\u4eec\u7684\u652f\u6301\u4f7f\u5f97 Apache APISIX \u9a6c\u6765\u897f\u4e9a\u7ad9\u7684 meetup \u53d6\u5f97\u4e86\u5706\u6ee1\u6210\u529f\u3002\u6b63\u662f\u56e0\u4e3a\u4f60\u4eec\u7684\u53c2\u4e0e\uff0c\u8fd9\u6b21\u6d3b\u52a8\u624d\u5f97\u4ee5\u987a\u5229\u8fdb\u884c\uff0c\u6211\u4eec\u5411\u4f60\u4eec\u81f4\u4ee5\u6700\u8bda\u631a\u7684\u611f\u8c22\u3002\\n\\n\u672a\u6765\uff0c\u6211\u4eec\u671f\u5f85\u66f4\u591a\u8fd9\u6837\u7684\u6d3b\u52a8\uff0c\u671f\u5f85\u770b\u5230\u793e\u533a\u5c06\u4f1a\u5e26\u6765\u54ea\u4e9b\u521b\u65b0\u548c\u8fdb\u6b65\u3002\u5982\u679c\u4f60\u9519\u8fc7\u4e86\u8fd9\u6b21 meetup\uff0c\u4e0d\u7528\u62c5\u5fc3\uff01\u4f60\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7\u5173\u6ce8 Apache APISIX \u7684\u793e\u4ea4\u5a92\u4f53\uff0c\u6216\u53c2\u52a0\u672a\u6765\u7684\u6d3b\u52a8\u6765\u8ddf\u4e0a\u6700\u65b0\u8fdb\u5c55\u3002\\n\\n\u656c\u8bf7\u5173\u6ce8\u66f4\u591a\u66f4\u65b0\u548c\u516c\u544a\uff0c\u548c\u6211\u4eec\u4e00\u8d77\u4f7f\u7528 Apache APISIX \u6784\u5efa API \u7f51\u5173\u6280\u672f\u7684\u672a\u6765\uff01\u65e0\u8bba\u4f60\u662f\u521d\u5b66\u8005\u8fd8\u662f\u6709\u7ecf\u9a8c\u7684\u4e13\u4e1a\u4eba\u58eb\uff0c\u6211\u4eec\u90fd\u6b22\u8fce\u4f60\u7684\u52a0\u5165\uff0c\u4e00\u8d77\u63a2\u7d22 [Apache APISIX](https://apisix.apache.org/) \u7684\u65e0\u9650\u53ef\u80fd\u6027\uff01"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (6.19 - 7.02)","metadata":{"permalink":"/zh/blog/2023/07/05/weekly-report","source":"@site/blog/2023/07/05/weekly-report.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (6.19 - 7.02)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-07-05T00:00:00.000Z","formattedDate":"2023\u5e747\u67085\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3,"truncated":true,"authors":[],"prevItem":{"title":"APISIX \u7684\u51fa\u6d77\u5f81\u7a0b\u52bf\u5982\u7834\u7af9\uff1aAPISIX \u9a6c\u6765\u897f\u4e9a Meetup","permalink":"/zh/blog/2023/07/12/2023-apisix-meetup-malaysia"},"nextItem":{"title":"Release Apache APISIX 3.4.0","permalink":"/zh/blog/2023/06/30/release-apache-apisix-3.4.0"}},"content":"> \u6211\u4eec\u8fd1\u671f\u5bf9 Apache APISIX \u548c Apache APISIX Ingress Controller \u7684\u90e8\u5206\u529f\u80fd\u8fdb\u884c\u4e86\u4fee\u590d\u6216\u6539\u5584\uff0c\u5305\u62ec\u4f18\u5316 Prometheus\u3001\u4fee\u590d body-transformer \u548c log-rotate \u63d2\u4ef6\u3001\u65b0\u589e annotation \u5141\u8bb8\u91cd\u5199 response header\uff0c\u8be6\u60c5\u8bf7\u9605\u8bfb\u672c\u671f\u53cc\u5468\u62a5\u3002\u4e0e\u6b64\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u53d1\u5e03\u4e86 Apache APISIX 3.4.0\u3002\u5b83\u7684\u529f\u80fd\u66f4\u52a0\u5f3a\u5927\uff0c\u6027\u80fd\u66f4\u52a0\u4f18\u8d8a\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u4ece 2023.6.19 - 2023.7.02\uff0c\u6709 22 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 35 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\u6211\u4eec\u8fd1\u671f\u5bf9\u90e8\u5206\u529f\u80fd\u8fdb\u884c\u4e86\u4fee\u590d\u6216\u6539\u5584\uff0c\u66f4\u65b0\u5185\u5bb9\u6c47\u603b\u5982\u4e0b\uff1a\\n\\n1. APISIX \u5141\u8bb8\u81ea\u5b9a\u4e49 Prometheus \u9ed8\u8ba4 bucket\u3002\\n\\n2. \u4fee\u590d body-transformer \u63d2\u4ef6\u65e0\u6cd5\u6b63\u5e38\u8f6c\u6362\u7a7a\u7684 table \u95ee\u9898\u3002\\n\\n3. \u4fee\u590d\u4f7f\u7528\u81ea\u5b9a\u4e49\u540d\u79f0\u65f6 log-rotate \u63d2\u4ef6\u7684 max_kept \u914d\u7f6e\u65e0\u6cd5\u751f\u6548\u95ee\u9898\u3002\\n\\n4. APISIX Ingress Controller \u65b0\u589e annotation \u5141\u8bb8\u91cd\u5199 response header\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/07/03/NmhS4JKj_%E8%B4%A1%E7%8C%AE%E8%80%85%E5%90%8D%E5%8D%95.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/07/07/M3P3D5AP_%E6%96%B0%E6%99%8B%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5.png)\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n### Apache APISIX\\n\\n- [APISIX \u5141\u8bb8\u81ea\u5b9a\u4e49 prometheus \u9ed8\u8ba4 bucket](https://github.com/apache/apisix/pull/9673)\uff08\u8d21\u732e\u8005\uff1a[jiangfucheng](https://github.com/jiangfucheng)\uff09\\n\\n- [\u4fee\u590d body-transformer \u63d2\u4ef6\u65e0\u6cd5\u6b63\u5e38\u8f6c\u6362\u7a7a\u7684 table \u95ee\u9898](https://github.com/apache/apisix/pull/9669)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n- [\u4fee\u590d\u4f7f\u7528\u81ea\u5b9a\u4e49\u540d\u79f0\u65f6 log-rotate \u63d2\u4ef6\u7684 max_kept \u914d\u7f6e\u65e0\u6cd5\u751f\u6548\u95ee\u9898](https://github.com/apache/apisix/pull/9749)\uff08\u8d21\u732e\u8005\uff1a[monkeyDluffy6017](https://github.com/monkeyDluffy6017)\uff09\\n\\n### Apache APISIX Ingress Controller\\n\\n- [APISIX Ingress Controller \u65b0\u589e annotation \u5141\u8bb8\u91cd\u5199 response header](https://github.com/apache/apisix-ingress-controller/pull/1861)\uff08\u8d21\u732e\u8005\uff1a[Revolyssup](https://github.com/Revolyssup )\uff09\\n\\n## \u6700\u65b0\u535a\u5ba2\u901f\u89c8\\n\\n- [Release Apache APISIX 3.4.0](https://apisix.apache.org/zh/blog/2023/06/30/release-apache-apisix-3.4.0/)\\n  \\n  \u6b64\u7248\u672c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b0\u7684\u63d2\u4ef6 loki-logger\uff0c\u53ef\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230 Grafana Loki\uff0c\u5e76\u5141\u8bb8\u5728\u8def\u7531\u7ea7\u522b\u4e0a\u5efa\u7acb mTLS \u8fde\u63a5\u3002\u6b64\u5916\uff0c\u6b64\u7248\u672c\u8fd8\u8fd8\u5f15\u5165\u4e86\u8bb8\u591a\u65b0\u7684\u7279\u6027\uff0c\u65e8\u5728\u4f18\u5316\u5bf9 APISIX \u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"Release Apache APISIX 3.4.0","metadata":{"permalink":"/zh/blog/2023/06/30/release-apache-apisix-3.4.0","source":"@site/blog/2023/06/30/release-apache-apisix-3.4.0.md","title":"Release Apache APISIX 3.4.0","description":"Apache APISIX 3.4.0 \u7248\u672c\u4e8e 2023 \u5e74 6 \u6708 30 \u65e5\u53d1\u5e03\u3002\u6b64\u7248\u672c\u65b0\u589e\u4e86\u4e00\u4e2a\u9002\u7528\u4e8e Grafana Loki \u7684\u63d2\u4ef6\uff0c\u5141\u8bb8\u5728\u8def\u7531\u7ea7\u522b\u4e0a\u5efa\u7acb mTLS \u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u6027\u80fd\u4f18\u5316\uff0c\u4e0d\u65ad\u63d0\u5347 APISIX \u7684\u7528\u6237\u4f53\u9a8c\u3002","date":"2023-06-30T00:00:00.000Z","formattedDate":"2023\u5e746\u670830\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.345,"truncated":true,"authors":[{"name":"Xin Rong","title":"Author","url":"https://github.com/AlinsRan","image_url":"https://avatars.githubusercontent.com/u/79972061?v=4","imageURL":"https://avatars.githubusercontent.com/u/79972061?v=4"},{"name":"Traky Deng","title":"Technical Writer","url":"https://github.com/kayx23","image_url":"https://avatars.githubusercontent.com/u/39619599?v=4","imageURL":"https://avatars.githubusercontent.com/u/39619599?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (6.19 - 7.02)","permalink":"/zh/blog/2023/07/05/weekly-report"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (6.06 - 6.18)","permalink":"/zh/blog/2023/06/21/weekly-report-zh"}},"content":"\u6211\u4eec\u5f88\u9ad8\u5174\u5730\u4ecb\u7ecd Apache APISIX 3.4.0\uff0c\u5b83\u5e26\u6765\u4e86\u4ee4\u4eba\u5174\u594b\u7684\u65b0\u529f\u80fd\u548c\u6027\u80fd\u6539\u8fdb\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u6b64\u7248\u672c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b0\u7684\u63d2\u4ef6 `loki-logger`\uff0c\u53ef\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230 [Grafana Loki](https://grafana.com/oss/loki/)\uff0c\u5e76\u5141\u8bb8\u5728\u8def\u7531\u7ea7\u522b\u4e0a\u5efa\u7acb mTLS \u8fde\u63a5\u3002\u6b64\u5916\uff0c\u6b64\u7248\u672c\u8fd8\u8fd8\u5f15\u5165\u4e86\u8bb8\u591a\u65b0\u7684\u7279\u6027\uff0c\u65e8\u5728\u4f18\u5316\u5bf9 APISIX \u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\n\\n## \u65b0\u529f\u80fd\\n\\n### \u4f7f\u7528 `loki-logger` \u63d2\u4ef6\u652f\u6301\u4e0e Grafana Loki \u96c6\u6210\\n\\n`loki-logger` \u63d2\u4ef6\u88ab\u7528\u4e8e\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230 [Grafana Loki](https://grafana.com/oss/loki/) \u8fdb\u884c\u5206\u6790\u548c\u5b58\u50a8\u3002\\n\\n\u542f\u7528\u63d2\u4ef6\u540e\uff0cAPISIX \u4f1a\u5c06\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4fe1\u606f\u5e8f\u5217\u5316\u4e3a[JSON \u683c\u5f0f\u7684 Log \u6761\u76ee](https://grafana.com/docs/loki/latest/api/#push-log-entries-to-loki)\uff0c\u5e76\u5c06\u5176\u63d0\u4ea4\u5230\u6279\u5904\u7406\u961f\u5217\u3002\u5f53\u961f\u5217\u6761\u4ef6\u6ee1\u8db3\u65f6\u6570\u636e\u5c06\u88ab\u63a8\u9001\u5230 Grafana Loki\u3002\\n\\n\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5728\u7279\u5b9a\u8def\u7531\u4e0a\u542f\u7528 `loki-logger` \u63d2\u4ef6\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"loki-logger\\": {\\n            \\"endpoint_addrs\\" : [\\"http://127.0.0.1:3100\\"]\\n        }\\n    },\\n    \\"upstream\\": {\\n       \\"nodes\\": {\\n           \\"127.0.0.1:1980\\": 1\\n       },\\n       \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"uri\\": \\"/hello\\"\\n}\'\\n```\\n\\n\u5982\u679c\u6210\u529f\uff0cAPISIX \u65e5\u5fd7\u5c06\u88ab\u8f6c\u53d1\u5230\u8fd0\u884c\u5728 `http://127.0.0.1:3100` \u4e0a\u7684 Loki\u3002\\n\\n\u6709\u5173\u8be5\u63d2\u4ef6\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1 `loki-logger` [\u63d2\u4ef6\u6587\u6863](https://github.com/apache/apisix/blob/release/3.4/docs/en/latest/plugins/loki-logger.md)\u3002\\n\\n\u6709\u5173\u6b64\u529f\u80fd\u7684 PR \u8bf7\u53c2\u89c1 [#9399](https://github.com/apache/apisix/pull/9399)\u3002\\n\\n### \u652f\u6301\u8def\u7531\u7ea7\u522b\u7684 mTLS\\n\\n\u652f\u6301\u5728\u8def\u7531\u7ea7\u522b\u914d\u7f6e mTLS\u3002Admin API SSL \u5bf9\u8c61\u73b0\u63d0\u4f9b\u4e00\u4e2a\u65b0\u7684\u914d\u7f6e\u9009\u9879 `client.skip_mtls_uri_regex`\u3002\u7528\u6237\u53ef\u4ee5\u5728\u6b64\u9009\u9879\u4e2d\u6307\u5b9a\u4e00\u4e2a URI \u5217\u8868\u767d\u540d\u5355\uff08\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u3002\u5bf9\u4e8e\u8fd9\u4e9b URI\uff0cAPISIX \u8df3\u8fc7\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u9a8c\u8bc1\u3002\\n\\n\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e\u5982\u4e0b\u7684\u8def\u7531\u7ea7\u522b\u7684 mTLS\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/*\\",\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"httpbin.org\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/ssls/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"cert\\": \\"\'\\"$(path/to/certs/mtls_server.crt)\\"\'\\",\\n    \\"key\\": \\"\'\\"$(path/to/certs/mtls_server.key)\\"\'\\",\\n    \\"snis\\": [\\n        \\"*.apisix.dev\\"\\n    ],\\n    \\"client\\": {\\n        \\"ca\\": \\"\'\\"$(path/to/certs/mtls_ca.crt)\\"\'\\",\\n        \\"depth\\": 10,\\n        \\"skip_mtls_uri_regex\\": [\\n            \\"/anything.*\\"\\n        ]\\n    }\\n}\'\\n```\\n\\n\u5982\u679c\u8bf7\u6c42\u7684 URI \u5728 `skip_mtls_uri_regex` \u5217\u8868\u4e2d\uff0c\u5219\u4e0d\u4f1a\u68c0\u67e5\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u8bc1\u4e66\u4e22\u5931\u6216\u65e0\u6548\uff0c\u5219\u5173\u8054\u7684 SNI \u7684\u5176\u4ed6 URI \u5c06\u5728 SSL \u63e1\u624b\u9636\u6bb5\u5f97\u5230 HTTP 400 \u54cd\u5e94\u800c\u4e0d\u662f\u8b66\u62a5\u9519\u8bef\u3002\\n\\n\u6709\u5173\u8be6\u7ec6\u793a\u4f8b\uff0c\u8bf7\u53c2\u89c1 [\u6559\u7a0b\uff1a\u57fa\u4e8e URI \u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u6765\u7ed5\u8fc7 mTLS](https://github.com/apache/apisix/blob/release/3.4/docs/zh/latest/tutorials/client-to-apisix-mtls.md#\u57fa\u4e8e\u5bf9-uri-\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u7ed5\u8fc7-mtls)\u3002\\n\\n\u6709\u5173\u6b64\u529f\u80fd\u7684 PR \u8bf7\u53c2\u89c1 [#9322](https://github.com/apache/apisix/pull/9322)\u3002\\n\\n## \u5176\u4ed6\u66f4\u65b0\\n\\n* \u652f\u6301\u5355\u4e2a HTTP \u957f\u8fde\u63a5 watch etcd \u7684\u5168\u90e8\u8d44\u6e90\uff0c\u8be5\u4f18\u5316\u964d\u4f4e\u4e86\u8bbf\u95ee etcd \u7684\u8d44\u6e90\u635f\u8017\uff0c\u4f7f watch \u6027\u80fd\u53ef\u8fbe\u5230 \u4e0e gRPC \u4e00\u6837\u7684\u6548\u679c\uff08[PR \uff039456](https://github.com/apache/apisix/pull/9456)\uff09\u3002\\n* \u652f\u6301\u5728 `proxy_rewrite` \u63d2\u4ef6\u4e2d\u4f7f\u7528\u591a\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u6a21\u5f0f\uff08[PR \uff039194](https://github.com/apache/apisix/pull/9194)\uff09\u3002\\n* \u5141\u8bb8\u7528\u6237\u5728 `prometheus` \u63d2\u4ef6\u4e2d\u81ea\u5b9a\u4e49\u914d\u7f6e `DEFAULT_BUCKETS\uff08`[PR #9673](https://github.com/apache/apisix/pull/9673)\uff09\u3002\\n\\n## \u66f4\u65b0\u65e5\u5fd7\\n\\n\u6709\u5173\u6b64\u7248\u672c\u4e2d\u5305\u542b\u7684\u6240\u6709\u65b0\u529f\u80fd\u548c\u9519\u8bef\u4fee\u590d\u7684\u5b8c\u6574\u5217\u8868\uff0c\u8bf7\u53c2\u89c1 [CHANGELOG](https://github.com/apache/apisix/blob/master/CHANGELOG.md)."},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (6.06 - 6.18)","metadata":{"permalink":"/zh/blog/2023/06/21/weekly-report-zh","source":"@site/blog/2023/06/21/weekly-report-zh.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (6.06 - 6.18)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-06-21T00:00:00.000Z","formattedDate":"2023\u5e746\u670821\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":1.42,"truncated":true,"authors":[],"prevItem":{"title":"Release Apache APISIX 3.4.0","permalink":"/zh/blog/2023/06/30/release-apache-apisix-3.4.0"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (5.23 - 6.05)","permalink":"/zh/blog/2023/06/08/weekly-report"}},"content":"> \u4ece 2023.6.06 - 2023.6.18\uff0c\u6709 21 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 32 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/06/20/Z6yEOnRT_%E5%90%8D%E5%8D%95.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/06/20/zvIq9JId_%E6%96%B0%E6%99%8B%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5.png)\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n### Apache APISIX\\n\\n- [\u91cd\u65b0\u7f16\u8bd1 protobuffer \u65f6\uff0c\u786e\u4fdd\u6b63\u786e\u91cd\u8f7d\u65e7\u72b6\u6001](https://github.com/apache/apisix/pull/9606)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (5.23 - 6.05)","metadata":{"permalink":"/zh/blog/2023/06/08/weekly-report","source":"@site/blog/2023/06/08/weekly-report.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (5.23 - 6.05)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-06-08T00:00:00.000Z","formattedDate":"2023\u5e746\u67088\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":1.595,"truncated":true,"authors":[],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (6.06 - 6.18)","permalink":"/zh/blog/2023/06/21/weekly-report-zh"},"nextItem":{"title":"Apache APISIX 3.2.1 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2023/06/01/release-apache-apisix-3.2.1"}},"content":"> \u4ece 2023.5.23 - 2023.6.05\uff0c\u6709 20 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 37 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/06/09/XavQu9xL_contributor%20list0609.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/06/08/MOxcew0f_%E6%96%B0%E6%99%8B%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5.png)\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n- [\u4f7f\u7528\u5355\u4e2a http \u957f\u94fe\u63a5 watch \u6240\u6709\u8d44\u6e90](https://github.com/apache/apisix/pull/9456)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n- [skywalking-logger \u4e0e error-log-logger \u63d0\u4f9b $hostname \u53d8\u91cf\u540d\u652f\u6301](https://github.com/apache/apisix/pull/9401)\uff08\u8d21\u732e\u8005\uff1a[shreemaan-abhishek](https://github.com/shreemaan-abhishek)\uff09\\n\\n- [\u65b0\u589e loki-logger \u63d2\u4ef6\u652f\u6301](https://github.com/apache/apisix/pull/9399)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [APISIX 3.2.1 \u53d1\u7248](https://github.com/apache/apisix/pull/9560)\uff08\u8d21\u732e\u8005\uff1a[leslie-tsang](https://github.com/leslie-tsang)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"Apache APISIX 3.2.1 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2023/06/01/release-apache-apisix-3.2.1","source":"@site/blog/2023/06/01/release-apache-apisix-3.2.1.md","title":"Apache APISIX 3.2.1 \u6b63\u5f0f\u53d1\u5e03","description":"APISIX 3.2.1 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff0c\u4fee\u590d\u4e86\u8bf8\u591a bug\uff0c\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u3002","date":"2023-06-01T00:00:00.000Z","formattedDate":"2023\u5e746\u67081\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":0.805,"truncated":true,"authors":[{"name":"\u66fe\u5143\u8c6a","title":"Author","url":"https://github.com/leslie-tsang","image_url":"https://avatars.githubusercontent.com/u/59061168?v=4","imageURL":"https://avatars.githubusercontent.com/u/59061168?v=4"},{"name":"Yilia Lin","title":"Technical Writer","url":"https://github.com/Yilialinn","image_url":"https://avatars.githubusercontent.com/u/114121331?v=4","imageURL":"https://avatars.githubusercontent.com/u/114121331?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (5.23 - 6.05)","permalink":"/zh/blog/2023/06/08/weekly-report"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (5.08 - 5.22)","permalink":"/zh/blog/2023/05/24/weekly-report-0524"}},"content":"> APISIX 3.2.1 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff0c\u4fee\u590d\u4e86\u8bf8\u591a bug\uff0c\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u3002\\n\x3c!--truncate--\x3e\\n\\n## bugfix\\n\\n- \u4fee\u590d `core.request.add_header` \u4e2d\u7684\u65e0\u6548\u7f13\u5b58\u95ee\u9898 [#8824](https://github.com/apache/apisix/pull/8824)\\n  > \u63d0\u4f9b\u65b0\u7684\u5b9e\u73b0\uff0c\u907f\u514d\u4e86 nginx \u5185\u7f6e header \u53d8\u91cf\u7f13\u5b58\u672a\u88ab\u5237\u65b0\u7684\u95ee\u9898\\n\\n- \u4fee\u590d etcd \u6570\u636e\u540c\u6b65\u5f02\u5e38\u95ee\u9898 [#8493](https://github.com/apache/apisix/pull/8493)\\n\\n- \u4fee\u590d\u7531 healthcheck \u5f15\u8d77\u7684\u9ad8 CPU \u548c\u5185\u5b58\u4f7f\u7528\u95ee\u9898 [#9016](https://github.com/apache/apisix/pull/9016)\\n  > \u4fee\u590d APISIX \u5728 `cancel_clean_handler` \u5931\u8d25\u540e\uff0ccreate_checker \u4e2d `healthcheck.new` \u521b\u5efa\u7684 healthchecker \u6cc4\u6f0f\u95ee\u9898\\n\\n- \u9632\u6b62\u975e `127.0.0.0/24` \u7684\u8bf7\u6c42\u7528\u7a7a\u7684 `admin_key` \u8bbf\u95ee Admin API [#9146](https://github.com/apache/apisix/pull/9146)\\n\\n- \u4fee\u590d batch-requests \u4e0d\u8bfb\u53d6 trailer headers \u7684\u60c5\u51b5 [#9289](https://github.com/apache/apisix/pull/9289)\\n\\n\u5982\u679c\u4f60\u5bf9\u5b8c\u6574\u7684\u5185\u5bb9\u611f\u5174\u8da3\uff0c\u8bf7\u53c2\u8003 3.2.1 \u53d1\u5e03\u7684 [CHANGELOG](https://github.com/apache/apisix/blob/release/3.2/docs/zh/latest/CHANGELOG.md#321)\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (5.08 - 5.22)","metadata":{"permalink":"/zh/blog/2023/05/24/weekly-report-0524","source":"@site/blog/2023/05/24/weekly-report-0524.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (5.08 - 5.22)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-05-24T00:00:00.000Z","formattedDate":"2023\u5e745\u670824\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":1.66,"truncated":true,"authors":[],"prevItem":{"title":"Apache APISIX 3.2.1 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2023/06/01/release-apache-apisix-3.2.1"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (4.24 - 5.07)","permalink":"/zh/blog/2023/05/12/weekly-report-0512"}},"content":"> \u4ece 2023.5.08 - 2023.5.22\uff0c\u6709 24 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 44 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/05/26/NXSJe8NY_Untitled.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/05/26/nrrzBEPe_Untitled%20%281%29.png)\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n### Apache APISIX\\n\\n- [Proxy-mirror \u63d2\u4ef6\u63d0\u4f9b grpc \u4e0e grpcs \u6d41\u91cf\u4ee3\u7406\u652f\u6301](https://github.com/apache/apisix/pull/9388)\uff08\u8d21\u732e\u8005\uff1a[Sn0rt](https://github.com/Sn0rt)\uff09\\n\\n- [\u590d\u7528 etcd \u94fe\u63a5\uff0c\u63d0\u5347 etcd \u8bfb\u5199\u541e\u5410](https://github.com/apache/apisix/pull/9420)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n### Apache APISIX Ingress Controller\\n\\n- [Apache APISIX Ingress Controller \u9879\u76ee\u79fb\u9664\u4e86 v2beta3 \u7248\u672c\u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\u652f\u6301](https://github.com/apache/apisix-ingress-controller/pull/1817)\uff08\u8d21\u732e\u8005\uff1a[tao12345666333](https://github.com/tao12345666333)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (4.24 - 5.07)","metadata":{"permalink":"/zh/blog/2023/05/12/weekly-report-0512","source":"@site/blog/2023/05/12/weekly-report-0512.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (4.24 - 5.07)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-05-12T00:00:00.000Z","formattedDate":"2023\u5e745\u670812\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":1.61,"truncated":true,"authors":[],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (5.08 - 5.22)","permalink":"/zh/blog/2023/05/24/weekly-report-0524"},"nextItem":{"title":"Apache APISIX 3.3.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2023/05/08/release-apache-apisix-3.3.0"}},"content":"> \u4ece 2023.4.24 - 2023.5.07\uff0c\u6709 20 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 28 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/05/12/E6TtjF4h_%E5%85%A8%E9%83%A8%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/05/12/DGlHypFc_%E6%96%B0%E6%99%8B%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5.png)\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n### Apache APISIX\\n\\n- [Forward-auth \u63d2\u4ef6\u652f\u6301\u670d\u52a1\u964d\u7ea7\u7279\u6027](https://github.com/apache/apisix/pull/9345)\uff08\u8d21\u732e\u8005\uff1a[shreemaan-abhishek](https://github.com/shreemaan-abhishek)\uff09\\n\\n- [\u652f\u6301\u901a\u8fc7\u767d\u540d\u5355\u7684\u5f62\u5f0f\u8df3\u8fc7 mTLS \u8ba4\u8bc1](https://github.com/apache/apisix/pull/9322)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n- [Proxy-rewrite \u63d2\u4ef6\u652f\u6301\u591a\u4e2a\u6b63\u5219\u5339\u914d\u6539\u5199\u89c4\u5219](https://github.com/apache/apisix/pull/9194)\uff08\u8d21\u732e\u8005\uff1a[fengxsong](https://github.com/fengxsong)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"Apache APISIX 3.3.0 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2023/05/08/release-apache-apisix-3.3.0","source":"@site/blog/2023/05/08/release-apache-apisix-3.3.0.md","title":"Apache APISIX 3.3.0 \u6b63\u5f0f\u53d1\u5e03","description":"Apache APISIX 3.3.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff0c\u6b64\u7248\u672c\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u591a\u57df\u540d\u5339\u914d\u573a\u666f\u4e0b\u7684\u8868\u73b0\u3002","date":"2023-05-08T00:00:00.000Z","formattedDate":"2023\u5e745\u67088\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.69,"truncated":true,"authors":[{"name":"\u66fe\u5143\u8c6a","title":"Author","url":"https://github.com/leslie-tsang","image_url":"https://avatars.githubusercontent.com/u/59061168?v=4","imageURL":"https://avatars.githubusercontent.com/u/59061168?v=4"},{"name":"Yilialinn","title":"Technical Writer","url":"https://github.com/Yilialinn","image_url":"https://avatars.githubusercontent.com/u/114121331?v=4","imageURL":"https://avatars.githubusercontent.com/u/114121331?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (4.24 - 5.07)","permalink":"/zh/blog/2023/05/12/weekly-report-0512"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (4.10 - 4.23)","permalink":"/zh/blog/2023/04/26/weekly-report-0426"}},"content":"> Apache APISIX 3.3.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff0c\u6b64\u7248\u672c\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u591a\u57df\u540d\u5339\u914d\u573a\u666f\u4e0b\u7684\u8868\u73b0\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## APISIX 3.3.0 \u65b0\u529f\u80fd\\n\\n\u65f6\u9694\u4e00\u4e2a\u6708\uff0c\u65b0\u7248\u672c\u53c8\u6765\u4e86\u3002\u8fd9\u6b21\u7684 APISIX 3.3.0 \u662f 3.2 LTS \u7248\u672c\u4ee5\u6765\u7684\u7b2c\u4e00\u4e2a\u65b0\u7248\u672c\uff0c\u5728 3.x \u7684\u65b0\u65f6\u4ee3\u91cc\uff0c\u6211\u4eec\u4e00\u5982\u65e2\u5f80\u5730\u7ed9\u5927\u5bb6\u5949\u4e0a\u66f4\u591a\u65b0\u529f\u80fd\u3002\\n\\n\u6b64\u6b21\u53d1\u5e03\u7684 3.3.0 \u7248\u672c\uff0c\u5c06\u9ed8\u8ba4\u8def\u7531\u5339\u914d\u6a21\u5f0f\u4ece `radixtree_uri` \u6539\u4e3a `radixtree_host_uri`\uff0c\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u591a\u57df\u540d\u5339\u914d\u573a\u666f\u4e0b\u7684\u8868\u73b0\u3002\u5728\u8fd9\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u5f15\u5165\u4e86\u8bb8\u591a\u65b0\u7684\u7279\u6027\u548c\u529f\u80fd\uff0c\u65e8\u5728\u4f18\u5316 APISIX \u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\n\\n## \u65b0\u7279\u6027\\n\\n### \u652f\u6301\u5c06\u8def\u7531\u8bc1\u4e66\u5b58\u50a8\u5728 secrets manager \u4e2d\\n\\nAPISIX 3.3.0 \u7248\u672c\u652f\u6301\u4ece Vault \u4e2d\u52a0\u8f7d\u8bc1\u4e66\uff0c\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u5b89\u5168\u6027\u4fdd\u969c\u3002\\n\\n#### \u76f8\u5173\u793a\u4f8b\\n\\n\u7b2c\u4e00\u6b65\uff1a\u914d\u7f6e Vault \u5bf9\u63a5\u53c2\u6570\\n\\n```\\n$ curl http://127.0.0.1:9180/apisix/admin/secrets/vault/test1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n{\\n    \\"uri\\": \\"http://127.0.0.1:8200\\",\\n    \\"prefix\\": \\"kv/apisix\\",\\n    \\"token\\" : \\"root\\"\\n}\'\\n```\\n\\n\u7b2c\u4e8c\u6b65\uff1a\u5728 SSL \u5bf9\u8c61\u4e0a\u4f7f\u7528 `$secret://` \u7684\u8bed\u6cd5\u5f15\u7528 vault \u76f8\u5173\u8def\u5f84\u7684\u914d\u7f6e\uff0cAPISIX \u5c06\u4ece\u5bf9\u5e94 vault \u8d44\u6e90\u8def\u5f84\u4e2d\u83b7\u53d6\u5230\u76f8\u5173\u8bc1\u4e66\u6570\u636e\\n\\n```\\n$ curl http://127.0.0.1:9180/apisix/admin/ssls/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n{\\n    \\"cert\\": \\"$secret://vault/test1/ssl/test2.com.crt\\",\\n    \\"key\\": \\"$secret://vault/test1/ssl/test2.com.key\\",\\n    \\"sni\\": \\"test2.com\\"\\n}\'\\n```\\n\\n\u6700\u540e\u5728\u5177\u4f53\u7684 route \u4e0a\u914d\u7f6e\u4e0a\u8ff0 SSL \u5bf9\u8c61\uff0croute \u8bc1\u4e66\u4fbf\u53ef\u4ee5\u4ece vault \u4e2d\u52a0\u8f7d\u3002\\n\\n### \u652f\u6301\u901a\u8fc7\u914d\u7f6e\u7ed5\u8fc7 Admin API \u8eab\u4efd\u9a8c\u8bc1\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b APISIX \u5c06\u68c0\u67e5 `X-API-KEY` \uff0c\u73b0\u5728\u53ef\u4ee5\u901a\u8fc7\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5173\u95ed `admin_key_required` \u914d\u7f6e\u9879\uff0c\u5173\u95ed\u76f8\u5173\u7684\u68c0\u67e5\u3002\\n\\n\u7b2c\u4e00\u6b65\uff1a\u4fee\u6539 config.yaml \u914d\u7f6e\u6587\u4ef6\\n\\n```\\n...\\ndeployment:\\n  admin:\\n    admin_key_required: false\\n...\\n```\\n\\n\u7b2c\u4e8c\u6b65\uff1a\u4e0d\u4f7f\u7528 admin key \u8bbf\u95ee\u8d44\u6e90\\n\\n```\\ncurl -v http://127.0.0.1:9180/apisix/admin/routes\\n```\\n\\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u7b80\u5316\u5f00\u53d1\u8c03\u8bd5\u7684\u590d\u6742\u5ea6\u4e86\u3002\\n\\n### \u65b0\u529f\u80fd\uff1a\u4f18\u5316\u4ee5\u53ca\u66f4\u591a\u5c0f\u529f\u80fd\\n\\n\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u51e0\u4e2a\u5927\u7684\u529f\u80fd\u5916\uff0c\u6b64\u6b21\u53d1\u5e03\u4e5f\u5305\u542b\u8bb8\u591a\u503c\u5f97\u8ff0\u8bf4\u7684\u6539\u52a8\uff1a\\n\\n* fault-injection \u63d2\u4ef6\u652f\u6301\u8bf7\u6c42\u5934\u6ce8\u5165\\n* \u63d0\u4f9b\u5728\u5176\u4ed6\u63d2\u4ef6\u4e2d\u5f15\u7528 proxy-rewrite \u63d2\u4ef6\u4e2d\u8def\u7531\u6539\u5199\u6355\u6349\u5230\u7684\u53d8\u91cf\u652f\u6301\\n* limit-count \u63d2\u4ef6\u63d0\u4f9b username \u4e0e ssl redis \u8ba4\u8bc1\u65b9\u5f0f\\n\u7b49\u7b49\u3002\\n\\n\u5982\u679c\u4f60\u5bf9\u65b0\u7248\u672c\u7684\u5b8c\u6574\u66f4\u65b0\u7ec6\u8282\u611f\u5174\u8da3\uff0c\u8bf7\u53c2\u8003 3.3.0 \u53d1\u5e03\u7684 [CHANGELOG](https://github.com/apache/apisix/blob/release/3.3/docs/zh/latest/CHANGELOG.md#330)\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (4.10 - 4.23)","metadata":{"permalink":"/zh/blog/2023/04/26/weekly-report-0426","source":"@site/blog/2023/04/26/weekly-report-0426.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (4.10 - 4.23)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-04-26T00:00:00.000Z","formattedDate":"2023\u5e744\u670826\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":1.525,"truncated":true,"authors":[],"prevItem":{"title":"Apache APISIX 3.3.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2023/05/08/release-apache-apisix-3.3.0"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (3.27 - 4.9)","permalink":"/zh/blog/2023/04/12/weekly-report-0409"}},"content":"> \u4ece 2023.4.10 - 2023.4.23\uff0c\u6709 30 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 51 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/04/26/oqoEZoe5_%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5-20230426.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/04/26/hs1igYPY_%E6%96%B0%E6%99%8B%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5-%E8%8B%B1%E6%96%8720230426.png)\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n### Apache APISIX\\n\\n- [\u914d\u7f6e\u6587\u4ef6\u63d0\u4f9b admin api key \u514d\u68c0\u67e5\u9009\u9879](https://github.com/apache/apisix/pull/9147)\uff08\u8d21\u732e\u8005\uff1a[An-DJ](https://github.com/An-DJ)\uff09\\n\\n- [\u63d0\u4f9b\u5c06\u8def\u7531\u8bc1\u4e66\u5b58\u50a8\u4e8e secret manager \u7684\u652f\u6301](https://github.com/apache/apisix/pull/9247)\uff08\u8d21\u732e\u8005\uff1a[soulbird](https://github.com/soulbird)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (3.27 - 4.9)","metadata":{"permalink":"/zh/blog/2023/04/12/weekly-report-0409","source":"@site/blog/2023/04/12/weekly-report-0409.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (3.27 - 4.9)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-04-12T00:00:00.000Z","formattedDate":"2023\u5e744\u670812\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":1.955,"truncated":true,"authors":[],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (4.10 - 4.23)","permalink":"/zh/blog/2023/04/26/weekly-report-0426"},"nextItem":{"title":"2023 \u5e74\u5341\u5927 API \u7ba1\u7406\u8d8b\u52bf","permalink":"/zh/blog/2023/04/03/10-api-management-trends"}},"content":"> \u4ece 2023.3.27 - 2023.4.9\uff0c\u6709 24 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 44 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 Issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/04/10/DIDm2aDQ_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5-07%E6%9C%9F.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/04/10/ysgQ4kpJ_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E6%96%B0%E6%99%8B%E6%B5%B7%E6%8A%A5-07%E5%91%A8.png)\\n\\n## Good First Issue\\n\\n### Issue #8772\\n\\n\u94fe\u63a5\uff1a[1. https://github.com/apache/apisix/issues/8772](https://github.com/apache/apisix/issues/8772)\\n\\n\u95ee\u9898\u63cf\u8ff0\uff1a OIDC \u63d2\u4ef6\u589e\u52a0\u989d\u5916\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u5c5e\u6027\u9a8c\u8bc1\u652f\u6301\u3002\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n### Apache APISIX\\n\\n- [\u589e\u52a0 upstream \u72b6\u6001\u5c55\u793a\u9875\u9762\u652f\u6301](https://github.com/apache/apisix/pull/9151)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n- [\u6545\u969c\u6ce8\u5165\u63d2\u4ef6\u589e\u52a0\u54cd\u5e94\u5934\u6ce8\u5165\u652f\u6301](https://github.com/apache/apisix/pull/9039)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n### Apache APISIX Ingress\\n\\n- [\u652f\u6301\u901a\u8fc7 adminssion webhook \u6821\u9a8c plugin](https://github.com/apache/apisix-ingress-controller/pull/1355)\uff08\u8d21\u732e\u8005\uff1a[AlinsRan](https://github.com/AlinsRan)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"2023 \u5e74\u5341\u5927 API \u7ba1\u7406\u8d8b\u52bf","metadata":{"permalink":"/zh/blog/2023/04/03/10-api-management-trends","source":"@site/blog/2023/04/03/10-api-management-trends.md","title":"2023 \u5e74\u5341\u5927 API \u7ba1\u7406\u8d8b\u52bf","description":"\u672c\u6587\u63a2\u8ba8\u4e86 API \u7ba1\u7406\u5728\u6570\u5b57\u5316\u8f6c\u578b\u4e2d\u7684\u91cd\u8981\u6027\uff0c\u4ee5\u53ca API \u7ba1\u7406\u9762\u4e34\u7684\u6311\u6218\u548c\u53d1\u5c55\u673a\u9047\u3002\u6587\u7ae0\u91cd\u70b9\u4ecb\u7ecd\u4e86\u5341\u5927 API \u7ba1\u7406\u53d1\u5c55\u8d8b\u52bf\uff0c\u5305\u62ec API \u5b89\u5168\u6027\u3001API \u6807\u51c6\u5316\u3001\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u3001\u4f4e\u4ee3\u7801 API \u5e73\u53f0\u3001API \u5e02\u573a\u3001\u65b0\u5174 API \u534f\u8bae\u3001\u4eba\u5de5\u667a\u80fd\u4e0e API\u3001\u5f00\u53d1\u8005\u4f53\u9a8c\u3001API \u5206\u6790\u548c\u65e0\u670d\u52a1\u5668\u67b6\u6784\u7b49\u3002\u901a\u8fc7\u5173\u6ce8\u8fd9\u4e9b\u8d8b\u52bf\uff0c\u4f01\u4e1a\u80fd\u66f4\u597d\u5730\u5e94\u5bf9\u672a\u6765\u6311\u6218\uff0c\u6293\u4f4f\u53d1\u5c55\u673a\u9047\uff0c\u5b9e\u73b0\u4e1a\u52a1\u7684\u6301\u7eed\u589e\u957f\u548c\u521b\u65b0\u3002","date":"2023-04-03T00:00:00.000Z","formattedDate":"2023\u5e744\u67083\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":20.005,"truncated":true,"authors":[{"name":"\u90d1\u73a9\u661f","title":"Author","url":"https://github.com/ronething","image_url":"https://github.com/ronething.png","imageURL":"https://github.com/ronething.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (3.27 - 4.9)","permalink":"/zh/blog/2023/04/12/weekly-report-0409"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (3.13 - 3.26)","permalink":"/zh/blog/2023/03/30/weekly-report-0330"}},"content":"> \u672c\u6587\u63a2\u8ba8\u4e86 API \u7ba1\u7406\u5728\u6570\u5b57\u5316\u8f6c\u578b\u4e2d\u7684\u91cd\u8981\u6027\uff0c\u4ee5\u53ca API \u7ba1\u7406\u9762\u4e34\u7684\u6311\u6218\u548c\u53d1\u5c55\u673a\u9047\u3002\u6587\u7ae0\u91cd\u70b9\u4ecb\u7ecd\u4e86\u5341\u5927 API \u7ba1\u7406\u53d1\u5c55\u8d8b\u52bf\uff0c\u5305\u62ec API \u5b89\u5168\u6027\u3001API \u6807\u51c6\u5316\u3001\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u3001\u4f4e\u4ee3\u7801 API \u5e73\u53f0\u3001API \u5e02\u573a\u3001\u65b0\u5174 API \u534f\u8bae\u3001\u4eba\u5de5\u667a\u80fd\u4e0e API\u3001\u5f00\u53d1\u8005\u4f53\u9a8c\u3001API \u5206\u6790\u548c\u65e0\u670d\u52a1\u5668\u67b6\u6784\u7b49\u3002\u901a\u8fc7\u5173\u6ce8\u8fd9\u4e9b\u8d8b\u52bf\uff0c\u4f01\u4e1a\u80fd\u66f4\u597d\u5730\u5e94\u5bf9\u672a\u6765\u6311\u6218\uff0c\u6293\u4f4f\u53d1\u5c55\u673a\u9047\uff0c\u5b9e\u73b0\u4e1a\u52a1\u7684\u6301\u7eed\u589e\u957f\u548c\u521b\u65b0\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u90d1\u73a9\u661f](https://github.com/ronething)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\u3002\\n\\n## \u4ec0\u4e48\u662f API\uff1f\u4ec0\u4e48\u662f API \u7ba1\u7406\uff1f\\n\\n\u8fd1\u671f\uff0cAIGC\uff08AI Generated Content\uff0c\u751f\u6210\u5f0f\u4eba\u5de5\u667a\u80fd\uff09\u5728\u5404\u884c\u4e1a\u7684\u5e94\u7528\u65e5\u8d8b\u666e\u53ca\u3002AIGC \u670d\u52a1\u63d0\u4f9b\u5546\u901a\u8fc7 API \u5411\u5916\u90e8\u63d0\u4f9b\u5176\u5185\u5bb9\u751f\u6210\u80fd\u529b\uff0c\u4f7f\u5f97\u7528\u6237\u80fd\u591f\u4fbf\u6377\u5730\u83b7\u53d6 AIGC \u5e94\u7528\u76f8\u5173\u5185\u5bb9\u3002\u663e\u7136\uff0cAPI \u6210\u4e3a AIGC \u5e94\u7528\u7684\u91cd\u8981\u652f\u67f1\u3002\u90a3\u4e48\uff0c\u7a76\u7adf\u4ec0\u4e48\u662f API \u5462\uff1f\\n\\nAPI\uff08Application Programming Interface\uff0c\u5e94\u7528\u7a0b\u5e8f\u63a5\u53e3\uff09\u662f\u4e00\u7cfb\u5217\u9884\u5148\u5b9a\u4e49\u7684\u89c4\u5219\u548c\u7ea6\u5b9a\uff0c\u76ee\u7684\u662f\u7528\u4e8e\u4e0d\u540c\u8f6f\u4ef6\u5e94\u7528\u4e4b\u95f4\u7684\u901a\u4fe1\u3002API \u4f7f\u5f97\u4e00\u4e2a\u8f6f\u4ef6\u5e94\u7528\u7a0b\u5e8f\uff08\u5373\u5ba2\u6237\u7aef\uff09\u80fd\u591f\u8bf7\u6c42\u53e6\u4e00\u4e2a\u8f6f\u4ef6\u5e94\u7528\u7a0b\u5e8f\uff08\u5373\u670d\u52a1\u5668\uff09\u7684\u529f\u80fd\u4e0e\u6570\u636e\uff0c\u4ece\u800c\u4fc3\u6210\u4e0d\u540c\u7cfb\u7edf\u95f4\u7684\u4e92\u52a8\u548c\u6570\u636e\u5171\u4eab\u3002\u501f\u52a9 API\uff0c\u5f00\u53d1\u8005\u80fd\u591f\u5229\u7528\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u7684\u529f\u80fd\uff0c\u4ece\u800c\u66f4\u5feb\u901f\u5730\u6784\u5efa\u548c\u53d1\u5e03\u65b0\u5e94\u7528\u3002\\n\\nAPI \u7ba1\u7406\u5305\u62ec\u521b\u5efa\u548c\u53d1\u5e03 API\u3001\u5236\u5b9a\u4f7f\u7528\u7b56\u7565\u3001\u63a7\u5236\u8bbf\u95ee\u6743\u9650\u3001\u57f9\u517b\u7528\u6237\u793e\u533a\u3001\u641c\u96c6\u4e0e\u5206\u6790\u4f7f\u7528\u7edf\u8ba1\u6570\u636e\u4ee5\u53ca\u62a5\u544a\u6027\u80fd\u7b49\u8fc7\u7a0b\uff0c\u901a\u5e38\u5305\u542b API \u7f51\u5173\u3001\u5f00\u53d1\u8005\u95e8\u6237\u7b49\u7ec4\u4ef6\u3002\u5176\u4e2d\uff0cAPI \u7f51\u5173\u4f5c\u4e3a\u5173\u952e\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u5904\u7406\u548c\u8f6c\u53d1\u8bf7\u6c42\uff0c\u540c\u65f6\u6267\u884c\u5b89\u5168\u548c\u6027\u80fd\u7b56\u7565\uff0c\u800c\u5f00\u53d1\u8005\u95e8\u6237\u5219\u662f\u4e00\u4e2a\u5728\u7ebf\u5e73\u53f0\uff0c\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b API \u6587\u6863\u3001\u5bc6\u94a5\u7ba1\u7406\u548c\u5176\u4ed6\u76f8\u5173\u8d44\u6e90\u3002\\n\\n\u968f\u7740\u4f01\u4e1a\u65e5\u76ca\u4f9d\u8d56 API \u63a8\u8fdb\u6570\u5b57\u5316\u8f6c\u578b\uff0cAPI \u7ba1\u7406\u7684\u91cd\u8981\u6027\u7a7a\u524d\u63d0\u5347\u3002\u5728\u7b80\u8981\u4ecb\u7ecd\u4e86\u76f8\u5173\u6982\u5ff5\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u63a2\u8ba8 API \u7ba1\u7406\u7684\u5341\u5927\u53d1\u5c55\u8d8b\u52bf\u3002\\n\\n## API \u5b89\u5168\u6027\u8d8a\u6765\u8d8a\u91cd\u8981\\n\\nAPI \u5b89\u5168\u6027\u662f\u6307\u4fdd\u62a4\u5e94\u7528\u7a0b\u5e8f\u548c\u7cfb\u7edf\u4e4b\u95f4\u901a\u8fc7 API \u4ea4\u6362\u6570\u636e\u548c\u529f\u80fd\u7684\u8fc7\u7a0b\u3002API \u5b89\u5168\u6027\u7684\u4e3b\u8981\u76ee\u6807\u662f\u786e\u4fdd\u6570\u636e\u548c\u529f\u80fd\u7684\u6b63\u786e\u6027\u3001\u53ef\u9760\u6027\u548c\u79c1\u5bc6\u6027\uff0c\u9632\u6b62\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\u548c\u6f5c\u5728\u7684\u6076\u610f\u653b\u51fb\u3002API \u5b89\u5168\u6027\u5bf9\u4e8e\u73b0\u4ee3\u5e94\u7528\u548c\u4f01\u4e1a\u670d\u52a1\u81f3\u5173\u91cd\u8981\uff0c\u56e0\u4e3a\u5b83\u4eec\u5927\u91cf\u4f9d\u8d56\u4e8e API \u8fdb\u884c\u6570\u636e\u4ea4\u6362\u548c\u96c6\u6210\u3002\u4ee5\u4e0b\u662f API \u5b89\u5168\u6027\u91cd\u8981\u7684\u51e0\u70b9\u539f\u56e0\uff1a\\n\\n1. **\u6570\u636e\u4fdd\u62a4**\uff1aAPI \u901a\u5e38\u7528\u4e8e\u4f20\u8f93\u654f\u611f\u6570\u636e\uff0c\u5982\u7528\u6237\u4fe1\u606f\u3001\u4ea4\u6613\u7ec6\u8282\u548c\u652f\u4ed8\u4fe1\u606f\u3002\u786e\u4fdd API \u5b89\u5168\u6027\u53ef\u4ee5\u9632\u6b62\u6570\u636e\u6cc4\u9732\u3001\u7be1\u6539\u548c\u4e22\u5931\uff0c\u4fdd\u969c\u7528\u6237\u548c\u4f01\u4e1a\u7684\u4fe1\u606f\u5b89\u5168\u3002\\n\\n2. **\u7cfb\u7edf\u5b8c\u6574\u6027**\uff1a\u901a\u8fc7\u786e\u4fdd API \u53ea\u80fd\u88ab\u5408\u6cd5\u7528\u6237\u548c\u5408\u89c4\u5e94\u7528\u8bbf\u95ee\uff0c\u53ef\u4ee5\u7ef4\u62a4\u7cfb\u7edf\u5b8c\u6574\u6027\u3002\u8fd9\u6709\u52a9\u4e8e\u9632\u6b62\u6076\u610f\u653b\u51fb\u8005\u901a\u8fc7 API \u7834\u574f\u6216\u63a7\u5236\u7cfb\u7edf\u3002\\n\\n3. **\u4fe1\u4efb\u548c\u58f0\u8a89**\uff1a\u4e00\u4e2a\u5b89\u5168\u7684 API \u53ef\u4ee5\u63d0\u9ad8\u7528\u6237\u5bf9\u4f01\u4e1a\u670d\u52a1\u7684\u4fe1\u4efb\u5ea6\uff0c\u6709\u52a9\u4e8e\u5efa\u7acb\u826f\u597d\u7684\u54c1\u724c\u58f0\u8a89\u3002\u76f8\u53cd\uff0c\u5982\u679c API \u5b89\u5168\u6027\u4e0d\u8db3\uff0c\u53ef\u80fd\u5bfc\u81f4\u4f01\u4e1a\u58f0\u8a89\u53d7\u635f\uff0c\u7528\u6237\u6d41\u5931\u3002\\n\\n\u4e3a\u4e86\u4fdd\u969c API \u7684\u5b89\u5168\u6027\uff0c\u901a\u5e38\u6211\u4eec\u53ef\u4ee5\u5229\u7528 API \u7f51\u5173\u6765\u7ba1\u7406\u5b89\u5168\u529f\u80fd\uff0c\u4f8b\u5982\u8eab\u4efd\u9a8c\u8bc1\u548c\u8bbf\u95ee\u63a7\u5236\uff0c\u4ee5\u4fdd\u62a4 API \u514d\u53d7\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\u548c\u653b\u51fb\u3002\u5e02\u573a\u4e0a\u5df2\u6709\u8bb8\u591a API \u7f51\u5173\u63d0\u4f9b\u8fd9\u4e9b\u529f\u80fd\uff0c\u5176\u4e2d\u4e4b\u4e00\u4fbf\u662f Apache APISIX\u3002[Apache APISIX](https://apisix.apache.org/) \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0b\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7b49\u7279\u70b9\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u5b89\u5168\u529f\u80fd\uff0c\u4ee5\u786e\u4fdd API \u7684\u5b89\u5168\u6027\u3002\u4f8b\u5982\uff0cApache APISIX \u652f\u6301\u901a\u8fc7 `key-auth`\u3001`jwt-auth` \u7b49\u63d2\u4ef6\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4ee5\u53ca\u901a\u8fc7 `consumer-restriction` \u7b49\u63d2\u4ef6\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\u3002\u8fd9\u4e9b\u529f\u80fd\u5e2e\u52a9\u4f01\u4e1a\u9632\u6b62\u6570\u636e\u6cc4\u9732\uff0c\u4fdd\u62a4\u7528\u6237\u9690\u79c1\u53ca\u4f01\u4e1a\u5229\u76ca\u3002\\n\\n## API \u6807\u51c6\u5316\u65e5\u76ca\u91cd\u8981\\n\\n\u968f\u7740 API \u7684\u5e7f\u6cdb\u5e94\u7528\uff0cAPI \u6807\u51c6\u5316\u53d8\u5f97\u8d8a\u6765\u8d8a\u91cd\u8981\u3002\u4ee5\u4e0b\u662f API \u6807\u51c6\u5316\u7684\u51e0\u5927\u597d\u5904\uff1a\\n\\n1. **\u4fc3\u8fdb\u7ec4\u7ec7\u5185\u90e8\u7684\u534f\u4f5c\u548c\u6c9f\u901a**\uff1a\u8ba9\u4e0d\u540c\u56e2\u961f\u548c\u90e8\u95e8\u9075\u5faa\u7edf\u4e00\u7684\u8bbe\u8ba1\u539f\u5219\u548c\u89c4\u8303\uff0c\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\u548c\u8d28\u91cf\u3002\\n\\n2. **\u589e\u5f3a API \u7684\u5b89\u5168\u6027\u548c\u7a33\u5b9a\u6027**\uff1a\u901a\u8fc7\u5b9a\u4e49\u6e05\u6670\u7684\u63a5\u53e3\u3001\u6570\u636e\u7ed3\u6784\u548c\u534f\u8bae\uff0c\u9632\u6b62\u9519\u8bef\u6216\u6ee5\u7528\u7684\u60c5\u51b5\u53d1\u751f\u3002\\n\\n3. **\u63d0\u5347 API \u7684\u53ef\u6269\u5c55\u6027\u548c\u4e92\u64cd\u4f5c\u6027**\uff1a\u901a\u8fc7\u9075\u5faa\u884c\u4e1a\u6216\u793e\u533a\u8ba4\u53ef\u7684\u8bbe\u8ba1\u6307\u5357\u6216\u6700\u4f73\u5b9e\u8df5\uff0c\u4f7f API \u80fd\u591f\u9002\u5e94\u4e0d\u540c\u7684\u573a\u666f\u548c\u9700\u6c42\u3002\\n\\n\u5728 API \u6807\u51c6\u5316\u8fc7\u7a0b\u4e2d\uff0c\u5e38\u89c1\u7684 API \u6807\u51c6\u89c4\u8303\u6709 [OpenAPI Specfication](https://swagger.io/specification/)\u3002\u8bb8\u591a\u5de5\u5177\u548c\u5e73\u53f0\u90fd\u652f\u6301\u8fd9\u79cd\u89c4\u8303\uff0c\u4ee5\u65b9\u4fbf\u7528\u6237\u5bfc\u5165\u548c\u7ba1\u7406 API\u3002\u4f8b\u5982\uff0c[Apache APISIX Dashboard](https://github.com/apache/apisix-dashboard) \u5c31\u53ef\u4ee5\u901a\u8fc7 OpenAPI \u6587\u6863\u8fdb\u884c\u5bfc\u5165\u76f8\u5173\u8def\u7531\u6570\u636e\u3002\\n\\n![import routes data](https://static.apiseven.com/uploads/2023/03/24/JoFz3ZOy_openapi.png)\\n\\n\u5229\u7528\u8fd9\u4e9b\u6807\u51c6\u89c4\u8303\uff0c\u56e2\u961f\u53ef\u4ee5\u8f7b\u677e\u5730\u5728\u4e0d\u540c\u5e73\u53f0\u548c\u5de5\u5177\u4e4b\u95f4\u5171\u4eab\u548c\u7ba1\u7406 API\uff0c\u8fdb\u4e00\u6b65\u63d0\u9ad8\u534f\u4f5c\u6548\u7387\u548c API \u7684\u53ef\u7ef4\u62a4\u6027\u3002\\n\\n## \u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u7684\u666e\u53ca\\n\\n\u4f20\u7edf\u7684 API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u901a\u5e38\u4fa7\u91cd\u4e8e\u5728\u672c\u5730\u90e8\u7f72\u548c\u7ba1\u7406 API\uff0c\u8fd9\u610f\u5473\u7740\u4f01\u4e1a\u9700\u8981\u8d2d\u4e70\u3001\u90e8\u7f72\u548c\u7ef4\u62a4\u786c\u4ef6\u548c\u8f6f\u4ef6\u8d44\u6e90\uff0c\u4ee5\u652f\u6301 API \u7684\u5f00\u53d1\u3001\u53d1\u5e03\u548c\u76d1\u63a7\u3002\u7136\u800c\uff0c\u968f\u7740\u4e1a\u52a1\u7684\u53d1\u5c55\u548c\u4e91\u8ba1\u7b97\u6280\u672f\u7684\u666e\u53ca\uff0c\u4f20\u7edf\u7684 API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u5728\u53ef\u4f38\u7f29\u6027\u3001\u6210\u672c\u6548\u76ca\u548c\u8de8\u5e73\u53f0\u96c6\u6210\u65b9\u9762\u9762\u4e34\u4e00\u5b9a\u7684\u6311\u6218\u3002\\n\\n\u4e0e\u6b64\u540c\u65f6\uff0c\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u5e94\u8fd0\u800c\u751f\u3002\u8fd9\u7c7b\u89e3\u51b3\u65b9\u6848\u5145\u5206\u5229\u7528\u4e86\u4e91\u8ba1\u7b97\u7684\u5f39\u6027\u3001\u6309\u9700\u4ed8\u8d39\u548c\u8de8\u5e73\u53f0\u7279\u6027\uff0c\u4e3a\u4f01\u4e1a\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u4e3a\u7075\u6d3b\u3001\u9ad8\u6548\u548c\u53ef\u9760\u7684 API \u7ba1\u7406\u65b9\u5f0f\u3002\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u901a\u5e38\u5305\u62ec API \u7f51\u5173\u3001\u5b89\u5168\u529f\u80fd\u3001\u76d1\u63a7\u548c\u5206\u6790\u7b49\u7ec4\u4ef6\uff0c\u4ee5\u652f\u6301\u4f01\u4e1a\u5728\u6df7\u5408\u4e91\u548c\u591a\u4e91\u73af\u5883\u4e2d\u5b9e\u73b0 API \u7684\u7edf\u4e00\u7ba1\u7406\u3002\\n\\n\u76f8\u6bd4\u4e8e\u4f20\u7edf\u7684 API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\uff0c\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u62e5\u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a\\n\\n1. **\u9ad8\u53ef\u7528\u6027**\uff1a\u5f97\u76ca\u4e8e\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u63d0\u4f9b\u5f39\u6027\u7684\u8d1f\u8f7d\u5747\u8861\u4e0e\u81ea\u52a8\u6269\u5c55\u529f\u80fd\u3001\u4ee5\u53ca\u81ea\u52a8\u5316\u7684\u6545\u969c\u5207\u6362\u548c\u707e\u96be\u6062\u590d\u80fd\u529b\uff0c\u4f7f\u5f97\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u5177\u5907\u66f4\u9ad8\u7684\u53ef\u7528\u6027\u3002\\n\\n2. **\u964d\u4f4e\u6210\u672c**\uff1a\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u53ef\u4ee5\u964d\u4f4e API \u7684\u5f00\u53d1\u3001\u90e8\u7f72\u548c\u7ef4\u62a4\u6210\u672c\uff0c\u8ba9\u4f01\u4e1a\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u521b\u65b0\u800c\u65e0\u9700\u62c5\u5fc3\u57fa\u7840\u8bbe\u65bd\u7684\u7ba1\u7406\u3002\\n\\n3. **\u8de8\u5e73\u53f0\u652f\u6301**\uff1a\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u652f\u6301\u6df7\u5408\u4e91\u548c\u591a\u4e91\u73af\u5883\uff0c\u5b9e\u73b0\u8de8\u5e73\u53f0\u7684 API \u96c6\u6210\u548c\u7ba1\u7406\uff0c\u8ba9\u4f01\u4e1a\u53ef\u4ee5\u8f7b\u677e\u5730\u5728\u4e0d\u540c\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u4e4b\u95f4\u8fc1\u79fb\u548c\u6269\u5c55\u5176 API\u3002\\n\\n\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u57fa\u4e8e Apache APISIX \u7684 [API7 Cloud](https://api7.ai/cloud) \u4ea7\u54c1\u6b63\u662f\u8fd9\u6837\u4e00\u79cd\u4e91\u7aef API \u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u3002API7 Cloud \u91c7\u7528\u4e86\u73b0\u4ee3\u5316\u7684\u4e91\u67b6\u6784\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u7ba1\u7406\u90e8\u7f72\u5728\u6df7\u5408\u4e91\u548c\u591a\u4e91\u4e0a\u7684 API\uff0c\u5e76\u9ad8\u6548\u3001\u53ef\u9760\u5730\u8fde\u63a5\u5b83\u4eec\uff0c\u76f8\u8f83\u4e8e\u4f20\u7edf API \u89e3\u51b3\u65b9\u6848\uff0c\u5177\u6709\u66f4\u591a\u7684\u4f18\u52bf\u548c\u7075\u6d3b\u6027\u3002\\n\\n## \u4f7f\u7528\u4f4e\u4ee3\u7801 API \u5e73\u53f0\u65b9\u4fbf\u521b\u5efa\u53d1\u5e03 API\\n\\n\u4f4e\u4ee3\u7801 API \u5e73\u53f0\u662f\u4e00\u79cd\u5141\u8bb8\u7528\u6237\u901a\u8fc7\u7b80\u5355\u7684\u56fe\u5f62\u754c\u9762\u548c\u9884\u6784\u5efa\u7684\u6a21\u5757\u521b\u5efa\u3001\u53d1\u5e03\u548c\u7ba1\u7406 API \u7684\u5de5\u5177\u3002\u8fd9\u4e9b\u5e73\u53f0\u65e8\u5728\u7b80\u5316 API \u5f00\u53d1\u8fc7\u7a0b\uff0c\u964d\u4f4e\u5f00\u53d1\u95e8\u69db\uff0c\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\u3002\\n\\n\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\u662f\uff0c[Apache APISIX Dashboard](https://github.com/apache/apisix-dashboard) \u521b\u5efa\u8def\u7531\u7684\u65f6\u5019\uff0c\u65e0\u9700\u624b\u52a8\u7f16\u5199\u4ee3\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528\u62d6\u62fd\u65b9\u5f0f\u8fdb\u884c\u63d2\u4ef6\u7f16\u6392\u7ec4\u5408\u4e0d\u540c\u7684\u63d2\u4ef6\u3002\\n\\n![plugin-config](https://static.apiseven.com/uploads/2023/03/21/b35zInFq_plugin-config.png)\\n\\n## API \u5e02\u573a\u7684\u53d1\u5c55\\n\\n\u968f\u7740 API \u7684\u666e\u53ca\uff0cAPI \u5e02\u573a\u9010\u6e10\u6210\u4e3a\u4f01\u4e1a\u4ece\u5404\u79cd\u4f9b\u5e94\u5546\u53d1\u73b0\u3001\u8bc4\u4f30\u548c\u8d2d\u4e70 API \u7684\u4e00\u79cd\u65b9\u5f0f\u3002API \u5e02\u573a\u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u52a0\u901f\u521b\u65b0\uff0c\u964d\u4f4e\u5f00\u53d1\u6210\u672c\u3002\\n\\n1. \u5bf9\u4e8e API \u4f9b\u5e94\u5546\uff0cAPI \u5e02\u573a\u53ef\u4ee5\u63d0\u9ad8\u4ed6\u4eec\u7684 API \u7684\u53ef\u89c1\u6027\u548c\u5438\u5f15\u529b\uff0c\u589e\u52a0\u4ed6\u4eec\u7684\u6536\u5165\u548c\u5ba2\u6237\u7fa4\uff0c\u4ee5\u53ca\u5229\u7528\u5e02\u573a\u7684\u5206\u6790\u529f\u80fd\u6765\u4f18\u5316\u4ed6\u4eec\u7684 API \u7b56\u7565\u548c\u8bbe\u8ba1\u3002\\n\\n2. \u5bf9\u4e8e API \u6d88\u8d39\u8005\uff0cAPI \u5e02\u573a\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u65b9\u4fbf\u7684\u4e00\u7ad9\u5f0f\u670d\u52a1\uff0c\u8ba9\u4ed6\u4eec\u80fd\u591f\u8f7b\u677e\u5730\u627e\u5230\u5e76\u4f7f\u7528\u5404\u79cd\u9ad8\u8d28\u91cf\u7684 API \u6765\u6ee1\u8db3\u4ed6\u4eec\u7684\u4e1a\u52a1\u9700\u6c42\uff0c\u5e76\u4e14\u8282\u7701\u4e86\u81ea\u5df1\u5f00\u53d1\u6216\u7ef4\u62a4\u8fd9\u4e9b API \u7684\u65f6\u95f4\u548c\u8d44\u6e90\u3002\\n\\n3. \u5bf9\u4e8e\u6574\u4e2a API \u751f\u6001\u7cfb\u7edf\uff0cAPI \u5e02\u573a\u53ef\u4ee5\u4fc3\u8fdb\u591a\u65b9\u4e4b\u95f4\u7684\u534f\u4f5c\u548c\u521b\u65b0\uff0c\u6fc0\u53d1\u65b0\u7684\u7528\u4f8b\u548c\u4ef7\u503c\u3002\\n\\n## \u66f4\u591a API \u534f\u8bae\u5d1b\u8d77\\n\\n\u968f\u7740\u4e0b\u4e00\u4ee3 API \u534f\u8bae\uff0c\u5982 [GraphQL](https://api7.ai/blog/what-is-graphql) \u548c [gRPC](https://api7.ai/blog/what-is-grpc-and-how-to-work-with-apisix)\uff0c\u4e0e\u5f53\u524d\u4e3b\u5bfc\u4f46\u9010\u6e10\u8870\u843d\u7684 [REST API](https://api7.ai/blog/understanding-and-using-restful-apis) \u5c55\u5f00\u7ade\u4e89\uff0c\u8d8a\u6765\u8d8a\u591a\u7684 API \u534f\u8bae\u5f97\u5230\u4e86\u5e7f\u6cdb\u5e94\u7528\u3002\\n\\nGraphQL \u662f\u7531 Facebook \u5f00\u53d1\u7684\u4e00\u79cd\u6570\u636e\u67e5\u8be2\u548c\u64cd\u4f5c\u8bed\u8a00\u3002\u5b83\u5141\u8bb8\u5ba2\u6237\u7aef\u6839\u636e\u5176\u9700\u6c42\u660e\u786e\u8bf7\u6c42\u6240\u9700\u6570\u636e\uff0c\u5e76\u5728\u4e00\u4e2a\u8bf7\u6c42\u4e2d\u83b7\u53d6\u591a\u4e2a\u8d44\u6e90\u3002\u8fd9\u6709\u52a9\u4e8e\u51cf\u5c11\u6570\u636e\u4f20\u8f93\u91cf\u548c\u63d0\u9ad8\u6027\u80fd\u3002\u4e0e REST API \u76f8\u6bd4\uff0cGraphQL \u7684\u4f18\u52bf\u5305\u62ec\uff1a\\n\\n1. **\u7075\u6d3b\u7684\u6570\u636e\u8bf7\u6c42**\uff1a\u5ba2\u6237\u7aef\u53ef\u4ee5\u6307\u5b9a\u6240\u9700\u7684\u6570\u636e\uff0c\u907f\u514d\u4e86\u8fc7\u5ea6\u6216\u4e0d\u8db3\u7684\u6570\u636e\u4f20\u8f93\u3002\\n\\n2. **\u66f4\u9ad8\u6548\u7684\u8bf7\u6c42\u5904\u7406**\uff1a\u901a\u8fc7\u5355\u4e2a\u8bf7\u6c42\u83b7\u53d6\u591a\u4e2a\u8d44\u6e90\uff0c\u6709\u52a9\u4e8e\u51cf\u5c11\u7f51\u7edc\u5f80\u8fd4\u6b21\u6570\u3002\\n\\n3. **\u5b9e\u65f6\u6570\u636e\u66f4\u65b0**\uff1aGraphQL \u652f\u6301\u5b9e\u65f6\u6570\u636e\u66f4\u65b0\uff0c\u53ef\u4ee5\u53ca\u65f6\u54cd\u5e94\u5ba2\u6237\u7aef\u7684\u6570\u636e\u53d8\u66f4\u9700\u6c42\u3002\\n\\ngRPC \u662f\u7531 Google \u5f00\u53d1\u7684\u4e00\u79cd\u9ad8\u6027\u80fd\u3001\u5f00\u6e90\u7684\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\uff08RPC\uff09\u6846\u67b6\u3002\u5b83\u5141\u8bb8\u5ba2\u6237\u7aef\u50cf\u8c03\u7528\u672c\u5730\u65b9\u6cd5\u4e00\u6837\u8c03\u7528\u670d\u52a1\u7aef\u7684\u65b9\u6cd5\u3002gRPC \u4f7f\u7528 Protocol Buffers\uff08Protobuf\uff09\u4f5c\u4e3a\u63a5\u53e3\u5b9a\u4e49\u8bed\u8a00\u548c\u6570\u636e\u5e8f\u5217\u5316\u683c\u5f0f\uff0c\u4ee5\u5b9e\u73b0\u9ad8\u6548\u7684\u6570\u636e\u4f20\u8f93\u3002\u4e0e REST API \u76f8\u6bd4\uff0cgRPC \u7684\u4f18\u52bf\u5305\u62ec\uff1a\\n\\n1. **gRPC \u4f7f\u7528 Protobuf \u8fdb\u884c\u6570\u636e\u5e8f\u5217\u5316**\uff1a\u76f8\u8f83\u4e8e JSON \u683c\u5f0f\uff0c\u5177\u6709\u66f4\u9ad8\u7684\u6027\u80fd\u548c\u66f4\u5c0f\u7684\u6570\u636e\u4f53\u79ef\u3002\\n\\n2. **gRPC \u57fa\u4e8e HTTP/2 \u534f\u8bae\uff0c\u652f\u6301\u53cc\u5411\u6d41\u5f0f\u4f20\u8f93\uff0c\u591a\u8def\u590d\u7528\u548c\u5185\u7f6e\u7684 TLS \u5b89\u5168\u6027**\uff1a\u6bd4 REST API \u57fa\u4e8e HTTP/1.1 \u534f\u8bae\u7684\u5355\u5411\u8bf7\u6c42\u54cd\u5e94\u6a21\u5f0f\u66f4\u5feb\uff0c\u66f4\u7075\u6d3b\uff0c\u66f4\u5b89\u5168\u3002\\n\\n3. **gRPC \u57fa\u4e8e Protobuf \u5b9a\u4e49 API**\uff1a\u63d0\u4f9b\u4e86\u539f\u751f\u7684\u4ee3\u7801\u751f\u6210\u529f\u80fd\uff0c\u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u7684\u4ee3\u7801\uff0c\u652f\u6301\u591a\u79cd\u7f16\u7a0b\u8bed\u8a00\uff0c\u6bd4 REST API \u9700\u8981\u4f7f\u7528\u7b2c\u4e09\u65b9\u5de5\u5177\u5982 Swagger \u751f\u6210\u4ee3\u7801\u66f4\u65b9\u4fbf\uff0c\u66f4\u4e00\u81f4\u3002\\n\\n\u4e3a\u4e86\u9002\u5e94\u8fd9\u4e9b\u65b0\u5174\u534f\u8bae\u7684\u9700\u6c42\uff0cApache APISIX \u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u76f8\u5173\u63d2\u4ef6\uff0c\u4ee5\u652f\u6301\u4e0d\u540c\u534f\u8bae\u7684\u5904\u7406\u3002\\n\\n\u5728 Apache APISIX \u4e2d\uff0c\u4ee5\u4e0b\u63d2\u4ef6\u53ef\u4ee5\u5904\u7406\u8fd9\u4e9b\u65b0\u5174 API \u534f\u8bae\uff1a\\n\\n- [grpc-transcode](https://apisix.apache.org/docs/apisix/plugins/grpc-transcode/)\uff1a`grpc-transcode` \u7528\u4e8e\u5728 HTTP \u548c gRPC \u8bf7\u6c42\u4e4b\u95f4\u8fdb\u884c\u8f6c\u6362\u3002\\n- [grpc-web](https://apisix.apache.org/docs/apisix/plugins/grpc-web/)\uff1a`grpc-web` \u662f\u4e00\u4e2a\u4ee3\u7406\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5904\u7406\u4ece JavaScript \u5ba2\u6237\u7aef\u5230 gRPC Service \u7684 [gRPC Web](https://github.com/grpc/grpc-web) \u8bf7\u6c42\\n- [degraphql](https://apisix.apache.org/docs/apisix/plugins/degraphql/)\uff1a`degraphql` \u63d2\u4ef6\u7528\u4e8e\u652f\u6301\u5c06 RESTful API \u89e3\u7801\u4e3a GraphQL\u3002\\n\\n## \u4eba\u5de5\u667a\u80fd\u4e0e API\\n\\nAPI \u7ba1\u7406\u5e73\u53f0\u6b63\u5728\u5229\u7528\u673a\u5668\u5b66\u4e60\u548c\u4eba\u5de5\u667a\u80fd\u81ea\u52a8\u5316\u4efb\u52a1\uff0c\u4f8b\u5982 API \u53d1\u73b0\u3001\u5b89\u5168\u5a01\u80c1\u68c0\u6d4b\u548c\u5f02\u5e38\u68c0\u6d4b\u3002\u8fd9\u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u51cf\u8f7b\u5176 IT \u56e2\u961f\u7684\u8d1f\u62c5\uff0c\u5e76\u63d0\u9ad8\u5176 API \u7ba1\u7406\u6d41\u7a0b\u7684\u6548\u7387\u548c\u51c6\u786e\u6027\u3002\\n\\n1. **\u5b89\u5168\u5a01\u80c1\u68c0\u6d4b**\uff1a\u673a\u5668\u5b66\u4e60\u548c\u4eba\u5de5\u667a\u80fd\u53ef\u4ee5\u5e2e\u52a9 API \u7ba1\u7406\u5e73\u53f0\u5b9e\u65f6\u76d1\u63a7\u5e76\u5206\u6790 API \u6d41\u91cf\uff0c\u4ee5\u4fbf\u4e8e\u53ca\u65f6\u53d1\u73b0\u5e76\u963b\u6b62\u4efb\u4f55\u6076\u610f\u6216\u5f02\u5e38\u7684\u8bf7\u6c42\u3002\\n\\n2. **\u5f02\u5e38\u68c0\u6d4b**\uff1a\u673a\u5668\u5b66\u4e60\u548c\u4eba\u5de5\u667a\u80fd\u53ef\u4ee5\u5e2e\u52a9 API \u7ba1\u7406\u5e73\u53f0\u9884\u6d4b\u5e76\u8bca\u65ad\u4efb\u4f55\u53ef\u80fd\u5f71\u54cd API \u6027\u80fd\u6216\u53ef\u7528\u6027\u7684\u95ee\u9898\uff0c\u4ee5\u4fbf\u4e8e\u53ca\u65f6\u4fee\u590d\u5e76\u4f18\u5316\u3002\\n\\n## \u66f4\u52a0\u5173\u6ce8\u5f00\u53d1\u8005\u4f53\u9a8c\\n\\n\u968f\u7740 API \u53d8\u5f97\u8d8a\u6765\u8d8a\u96c6\u4e2d\u4e8e\u4e1a\u52a1\u8fd0\u8425\uff0c\u5f00\u53d1\u8005\u4f53\u9a8c\u53d8\u5f97\u8d8a\u6765\u8d8a\u91cd\u8981\u3002API \u7ba1\u7406\u5e73\u53f0\u6b63\u5728\u589e\u52a0\u66f4\u591a\u7684\u5f00\u53d1\u8005\u53cb\u597d\u529f\u80fd\uff0c\u4f8b\u5982\u6587\u6863\u3001\u6d4b\u8bd5\u5de5\u5177\u548c SDK\uff0c\u4ee5\u4f7f\u5f00\u53d1\u8005\u66f4\u5bb9\u6613\u4f7f\u7528 API\u3002\\n\\n1. **\u6587\u6863**\uff1a\u6587\u6863\u662f\u5f00\u53d1\u8005\u4e86\u89e3\u548c\u5b66\u4e60 API \u7684\u4e3b\u8981\u9014\u5f84\uff0c\u56e0\u6b64\u6587\u6863\u5e94\u8be5\u6e05\u6670\u3001\u5b8c\u6574\u3001\u51c6\u786e\u3001\u53ca\u65f6\u5730\u63cf\u8ff0 API \u7684\u529f\u80fd\u3001\u53c2\u6570\u3001\u793a\u4f8b\u548c\u9519\u8bef\u7801\u7b49\u4fe1\u606f\u3002\u6587\u6863\u8fd8\u5e94\u8be5\u63d0\u4f9b\u4ea4\u4e92\u5f0f\u7684\u63a7\u5236\u53f0\u6216\u6c99\u76d2\uff0c\u8ba9\u5f00\u53d1\u8005\u80fd\u591f\u5feb\u901f\u5730\u6d4b\u8bd5\u548c\u8c03\u8bd5 API\u3002\\n\\n2. **\u6d4b\u8bd5\u5de5\u5177**\uff1a\u6d4b\u8bd5\u5de5\u5177\u662f\u5f00\u53d1\u8005\u9a8c\u8bc1\u548c\u4f18\u5316 API \u7684\u91cd\u8981\u624b\u6bb5\uff0c\u56e0\u6b64\u6d4b\u8bd5\u5de5\u5177\u5e94\u8be5\u65b9\u4fbf\u3001\u53ef\u9760\u3001\u7075\u6d3b\u5730\u652f\u6301\u5404\u79cd\u6d4b\u8bd5\u573a\u666f\u548c\u9700\u6c42\u3002\u6d4b\u8bd5\u5de5\u5177\u8fd8\u5e94\u8be5\u63d0\u4f9b\u5b9e\u65f6\u7684\u53cd\u9988\u548c\u62a5\u544a\uff0c\u8ba9\u5f00\u53d1\u8005\u80fd\u591f\u53ca\u65f6\u5730\u53d1\u73b0\u5e76\u89e3\u51b3\u95ee\u9898\u3002\\n\\n3. **SDK**\uff1aSDK \u662f\u5f00\u53d1\u8005\u96c6\u6210\u548c\u4f7f\u7528 API \u7684\u4fbf\u6377\u65b9\u5f0f\uff0c\u56e0\u6b64 SDK \u5e94\u8be5\u8986\u76d6\u5404\u79cd\u4e3b\u6d41\u7684\u7f16\u7a0b\u8bed\u8a00\u548c\u5e73\u53f0\uff0c\u5e76\u4e14\u4fdd\u6301\u4e0e API \u7684\u540c\u6b65\u66f4\u65b0\u3002SDK \u8fd8\u5e94\u8be5\u9075\u5faa\u6700\u4f73\u5b9e\u8df5\u548c\u89c4\u8303\uff0c\u8ba9\u5f00\u53d1\u8005\u80fd\u591f\u8f7b\u677e\u5730\u7406\u89e3\u548c\u8c03\u7528\u3002\\n\\n## API \u5206\u6790\u7684\u5174\u8d77\\n\\nAPI \u5206\u6790\uff08API Analytics\uff09\u662f\u4e00\u79cd\u7528\u4e8e\u6536\u96c6\u3001\u5206\u6790\u548c\u89e3\u91ca API \u4f7f\u7528\u60c5\u51b5\u6570\u636e\u7684\u6280\u672f\u3002\u968f\u7740 API \u5728\u8f6f\u4ef6\u548c\u4e92\u8054\u7f51\u884c\u4e1a\u7684\u666e\u53ca\uff0cAPI \u5206\u6790\u5e94\u8fd0\u800c\u751f\uff0c\u6210\u4e3a\u4e00\u79cd\u5173\u952e\u7684\u7ba1\u7406\u548c\u4f18\u5316\u624b\u6bb5\u3002\u4ee5\u4e0b\u662f API \u5206\u6790\u5174\u8d77\u7684\u51e0\u70b9\u539f\u56e0\uff1a\\n\\n1. \u968f\u7740\u4e91\u8ba1\u7b97\u3001\u5927\u6570\u636e\u3001\u7269\u8054\u7f51\u7b49\u6280\u672f\u7684\u53d1\u5c55\uff0cAPI \u5df2\u6210\u4e3a\u4f01\u4e1a\u548c\u5f00\u53d1\u8005\u4e4b\u95f4\u4ea4\u6362\u6570\u636e\u548c\u529f\u80fd\u7684\u91cd\u8981\u5de5\u5177\u3002\u8fd9\u5bfc\u81f4\u4e86\u5bf9 API \u5206\u6790\u7684\u9700\u6c42\u4e0d\u65ad\u589e\u957f\uff0c\u4ee5\u4fbf\u66f4\u597d\u5730\u4e86\u89e3\u548c\u4f18\u5316 API \u7684\u6027\u80fd\u3002\\n\\n2. \u73b0\u4ee3\u8f6f\u4ef6\u5f00\u53d1\u8d8a\u6765\u8d8a\u591a\u5730\u91c7\u7528\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u5c06\u590d\u6742\u7684\u5e94\u7528\u7a0b\u5e8f\u5206\u89e3\u4e3a\u591a\u4e2a\u72ec\u7acb\u7684\u3001\u53ef\u6269\u5c55\u7684\u670d\u52a1\u3002\u8fd9\u4e9b\u670d\u52a1\u901a\u8fc7 API \u76f8\u4e92\u901a\u4fe1\uff0c\u56e0\u6b64\u5bf9 API \u5206\u6790\u7684\u9700\u6c42\u5728\u8fd9\u79cd\u67b6\u6784\u4e0b\u66f4\u52a0\u660e\u663e\u3002\\n\\n3. API \u5206\u6790\u53ef\u4ee5\u5e2e\u52a9\u68c0\u6d4b\u6f5c\u5728\u7684\u5b89\u5168\u6f0f\u6d1e\u548c\u8fdd\u53cd\u5408\u89c4\u6027\u7684\u884c\u4e3a\uff0c\u4ece\u800c\u964d\u4f4e\u98ce\u9669\u3002\\n\\n## \u66f4\u591a\u7684 API \u901a\u8fc7\u65e0\u670d\u52a1\u5668\uff08Serverless\uff09\u67b6\u6784\u63d0\u4f9b\u670d\u52a1\\n\\n\u65e0\u670d\u52a1\u5668\u67b6\u6784\u662f\u4e00\u79cd\u4e91\u8ba1\u7b97\u6a21\u5f0f\uff0c\u5b83\u5141\u8bb8\u5f00\u53d1\u8005\u5728\u4e0d\u7ba1\u7406\u670d\u52a1\u5668\u7684\u60c5\u51b5\u4e0b\uff0c\u90e8\u7f72\u548c\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u3002\\n\\n\u8981\u901a\u8fc7\u65e0\u670d\u52a1\u5668\u67b6\u6784\u63d0\u4f9b API \u670d\u52a1\uff0c\u4f60\u53ea\u9700\u8981\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a\\n\\n1. \u9009\u62e9\u4e00\u4e2a\u65e0\u670d\u52a1\u5668\u5e73\u53f0\uff0c\u7f16\u5199\u4f60\u7684 API \u903b\u8f91\u4ee3\u7801\uff0c\u4f7f\u7528\u65e0\u670d\u52a1\u5668\u5e73\u53f0\u63d0\u4f9b\u7684\u7f16\u7a0b\u8bed\u8a00\u548c\u6846\u67b6\u3002\\n\\n2. \u5728\u5e73\u53f0\u4e0a\u914d\u7f6e\u4f60\u7684 API \u89e6\u53d1\u5668\uff0c\u5982 HTTP \u8bf7\u6c42\uff0c\u5b9a\u65f6\u5668\uff0c\u4e8b\u4ef6\u7b49\u3002\\n\\n3. \u4f7f\u7528\u5e73\u53f0\u63d0\u4f9b\u7684\u76f8\u5173\u5de5\u5177\u90e8\u7f72\u4f60\u7684 API \u4ee3\u7801\u5230\u65e0\u670d\u52a1\u5668\u5e73\u53f0\uff0c\u5e76\u6d4b\u8bd5\u5176\u529f\u80fd\u548c\u6027\u80fd\u3002\\n\\n\u4f7f\u7528\u65e0\u670d\u52a1\u5668\u67b6\u6784\u62e5\u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a\\n\\n1. \u65e0\u670d\u52a1\u5668\u67b6\u6784\u53ef\u4ee5\u8ba9 API \u5f00\u53d1\u8005\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\uff0c\u800c\u4e0d\u7528\u62c5\u5fc3\u57fa\u7840\u8bbe\u65bd\u3001\u90e8\u7f72\u3001\u7f29\u653e\u7b49\u95ee\u9898\u3002\\n\\n2. \u65e0\u670d\u52a1\u5668\u67b6\u6784\u53ef\u4ee5\u6839\u636e API \u8bf7\u6c42\u91cf\u81ea\u52a8\u8c03\u6574\u8d44\u6e90\uff0c\u907f\u514d\u8d44\u6e90\u6d6a\u8d39\u6216\u4e0d\u8db3\u3002\\n\\n3. \u65e0\u670d\u52a1\u5668\u67b6\u6784\u53ef\u4ee5\u63d0\u9ad8 API \u7684\u54cd\u5e94\u901f\u5ea6\u548c\u53ef\u9760\u6027\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u5229\u7528\u5206\u5e03\u5f0f\u7684\u8fb9\u7f18\u8ba1\u7b97\u8282\u70b9\u6765\u5904\u7406\u8bf7\u6c42\\n\\nApache APISIX \u5728\u8fd9\u65b9\u9762\u4e5f\u6709\u6240\u652f\u6301\uff0c\u5305\u62ec [serverless](https://apisix.apache.org/docs/apisix/plugins/serverless/)\uff0c[openfunction](https://apisix.apache.org/docs/apisix/plugins/openfunction/) \u7b49\u63d2\u4ef6\u3002\\n\\n## \u603b\u7ed3\\n\\nAPI \u7ba1\u7406\u4f5c\u4e3a\u6570\u5b57\u5316\u8f6c\u578b\u6218\u7565\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u6b63\u9762\u4e34\u7740\u8bf8\u591a\u6311\u6218\u548c\u53d1\u5c55\u673a\u9047\u3002\u901a\u8fc7\u5173\u6ce8 API \u7ba1\u7406\u7684\u8fd9\u5341\u5927\u8d8b\u52bf\uff0c\u4f01\u4e1a\u53ef\u4ee5\u66f4\u597d\u5730\u5e94\u5bf9\u672a\u6765\u7684\u6311\u6218\uff0c\u6293\u4f4f\u53d1\u5c55\u673a\u9047\uff0c\u5e76\u5b9e\u73b0\u4e1a\u52a1\u7684\u6301\u7eed\u589e\u957f\u548c\u521b\u65b0\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (3.13 - 3.26)","metadata":{"permalink":"/zh/blog/2023/03/30/weekly-report-0330","source":"@site/blog/2023/03/30/weekly-report-0330.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (3.13 - 3.26)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-03-30T00:00:00.000Z","formattedDate":"2023\u5e743\u670830\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2,"truncated":true,"authors":[],"prevItem":{"title":"2023 \u5e74\u5341\u5927 API \u7ba1\u7406\u8d8b\u52bf","permalink":"/zh/blog/2023/04/03/10-api-management-trends"},"nextItem":{"title":"WebAssembly \u52a9\u529b\u4e91\u539f\u751f\uff1aAPISIX \u5982\u4f55\u501f\u52a9 Wasm \u63d2\u4ef6\u5b9e\u73b0\u6269\u5c55\u529f\u80fd\uff1f","permalink":"/zh/blog/2023/03/30/what-is-wasm-and-how-does-apache-apisix-support-it"}},"content":"> \u4ece 2023.3.13 - 2023.3.26\uff0c\u6709 25 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 54 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 Issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/03/28/csedWKi7_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5-06%E6%9C%9F.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/03/28/cyWb9xTh_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E6%96%B0%E6%99%8B%E6%B5%B7%E6%8A%A5-06%E5%91%A8.png)\\n\\n## Good First Issue\\n\\n### Issue #9182\\n\\n\u94fe\u63a5\uff1a[https://github.com/apache/apisix/issues/9182](https://github.com/apache/apisix/issues/9182)\\n\\n\u95ee\u9898\u63cf\u8ff0\uff1a \u5bf9\u6587\u6863 `expose-api` \u6559\u7a0b\u4e2d\u7684 URI \u8fdb\u884c\u8c03\u6574\u3002\\n\\n### Issue #1740\\n\\n\u94fe\u63a5\uff1a[https://github.com/apache/apisix-ingress-controller/issues/1740](https://github.com/apache/apisix-ingress-controller/issues/1740)\\n\\n\u95ee\u9898\u63cf\u8ff0\uff1a \u5bf9 APISIX Upstream \u53c2\u8003\u6587\u6863\u8fdb\u884c\u66f4\u65b0\u3002\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n### Apache APISIX\\n\\n- [\u63d2\u4ef6 `proxy-rewrite` \u652f\u6301\u4fdd\u5b58\u6b63\u5219\u6539\u5199\u8def\u7531\u4e2d\u95f4\u53d8\u91cf\uff0c\u63d0\u4f9b $ \u5f00\u5934\u7684\u53d8\u91cf\u8bbf\u95ee\u65b9\u5f0f](https://github.com/apache/apisix/pull/9112)\uff08\u8d21\u732e\u8005\uff1a[monkeyDluffy6017](https://github.com/monkeyDluffy6017)\uff09\\n\\n- [APISIX \u9ed8\u8ba4\u8def\u7531\u5339\u914d\u6a21\u5f0f\u7531 `radixtree_uri` \u6539\u4e3a `radixtree_host_uri`](https://github.com/apache/apisix/pull/9047)\uff08\u8d21\u732e\u8005\uff1a[monkeyDluffy6017](https://github.com/monkeyDluffy6017)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"WebAssembly \u52a9\u529b\u4e91\u539f\u751f\uff1aAPISIX \u5982\u4f55\u501f\u52a9 Wasm \u63d2\u4ef6\u5b9e\u73b0\u6269\u5c55\u529f\u80fd\uff1f","metadata":{"permalink":"/zh/blog/2023/03/30/what-is-wasm-and-how-does-apache-apisix-support-it","source":"@site/blog/2023/03/30/what-is-wasm-and-how-does-apache-apisix-support-it.md","title":"WebAssembly \u52a9\u529b\u4e91\u539f\u751f\uff1aAPISIX \u5982\u4f55\u501f\u52a9 Wasm \u63d2\u4ef6\u5b9e\u73b0\u6269\u5c55\u529f\u80fd\uff1f","description":"\u672c\u6587\u5c06\u4ecb\u7ecd Wasm\uff0c\u4ee5\u53ca Apache APISIX \u5982\u4f55\u5b9e\u73b0 Wasm \u529f\u80fd\u3002","date":"2023-03-30T00:00:00.000Z","formattedDate":"2023\u5e743\u670830\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":9.4,"truncated":true,"authors":[{"name":"\u6731\u6b23\u6b23","title":"Author","url":"https://github.com/starsz","image_url":"https://github.com/starsz.png","imageURL":"https://github.com/starsz.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (3.13 - 3.26)","permalink":"/zh/blog/2023/03/30/weekly-report-0330"},"nextItem":{"title":"\u4ec0\u4e48\u662f LuaJIT\uff1f\u4e3a\u4ec0\u4e48 Apache APISIX \u9009\u62e9\u4e86 LuaJIT\uff1f","permalink":"/zh/blog/2023/03/22/what-is-luajit-and-why-does-apisix-choose-luajit"}},"content":"> \u672c\u6587\u5c06\u4ecb\u7ecd Wasm\uff0c\u4ee5\u53ca Apache APISIX \u5982\u4f55\u5b9e\u73b0 Wasm \u529f\u80fd\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u6731\u6b23\u6b23](https://github.com/starsz)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\u3002\\n\\n## \u4ec0\u4e48\u662f Wasm\\n\\n[Wasm](http://webassembly.org) \u662f WebAssembly \u7684\u7f29\u5199\u3002WebAssembly/Wasm \u662f\u4e00\u4e2a\u57fa\u4e8e\u5806\u6808\u7684\u865a\u62df\u673a\u8bbe\u8ba1\u7684\u6307\u4ee4\u683c\u5f0f\u3002\\n\u5728 Wasm \u672a\u51fa\u73b0\u4e4b\u524d\uff0c\u6d4f\u89c8\u5668\u4e2d\u53ea\u80fd\u652f\u6301\u8fd0\u884c Javascript \u8bed\u8a00\u3002\u5f53 Wasm \u51fa\u73b0\u4e4b\u540e\uff0c\u4f7f\u5f97\u9ad8\u7ea7\u8bed\u8a00\u4f8b\u5982 C/C++/Golang \u80fd\u591f\u5728\u6d4f\u89c8\u5668\u4e2d\u8fd0\u884c\u3002\u5f53\u524d\uff0c\u4e3b\u6d41\u7684\u6d4f\u89c8\u5668\u5305\u62ec Chrome\u3001Firefox\u3001Safari \u7b49\u6d4f\u89c8\u5668\u90fd\u5df2\u5b8c\u6210\u5bf9 Wasm \u7684\u652f\u6301\u3002\u5e76\u4e14\u5f97\u76ca\u4e8e WASI \u9879\u76ee\u7684\u63a8\u8fdb\uff0c\u670d\u52a1\u7aef\u4e5f\u5df2\u7ecf\u80fd\u591f\u652f\u6301\u8fd0\u884c Wasm \u6307\u4ee4\u3002\\n\u5982\u4eca\u5728\u7f51\u5173\u4fa7\uff0cApache APISIX \u4e5f\u5df2\u5b8c\u6210\u5bf9 Wasm \u7684\u652f\u6301\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7\u9ad8\u7ea7\u8bed\u8a00 C/C++/Go/Rust \u5e76\u6309\u7167 [proxy-wasm](https://github.com/proxy-wasm/spec) \u89c4\u8303\u6765\u5b8c\u6210 Wasm \u63d2\u4ef6\u7684\u5f00\u53d1\u3002\\n\\n![wasm](https://static.apiseven.com/uploads/2023/03/10/6ZI9czxe_whiteboard_exported_image.jpeg)\\n\\n## \u4e3a\u4ec0\u4e48 APISIX \u8981\u652f\u6301 Wasm \u63d2\u4ef6\\n\\n\u76f8\u6bd4\u8f83\u539f\u751f\u7684 Lua \u63d2\u4ef6\uff0cWasm \u63d2\u4ef6\u5b58\u5728\u5982\u4e0b\u4f18\u52bf\uff1a\\n\\n- \u53ef\u6269\u5c55\u6027\uff1aAPISIX \u901a\u8fc7\u652f\u6301 Wasm\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed3\u5408 `proxy-wasm` \u63d0\u4f9b\u7684 SDK\uff0c\u4f7f\u7528 C++/Golang/Rust \u7b49\u8bed\u8a00\u8fdb\u884c\u63d2\u4ef6\u5f00\u53d1\u3002\u7531\u4e8e\u9ad8\u7ea7\u8bed\u8a00\u5f80\u5f80\u62e5\u6709\u66f4\u52a0\u4e30\u5bcc\u7684\u751f\u6001\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f9d\u6258\u4e8e\u8fd9\u4e9b\u751f\u6001\u6765\u5b9e\u73b0\u652f\u6301\u66f4\u591a\u529f\u80fd\u4e30\u5bcc\u7684\u63d2\u4ef6\u3002\\n\\n- \u5b89\u5168\u6027\uff1a\u7531\u4e8e APISIX \u548c Wasm \u4e4b\u524d\u7684\u8c03\u7528\u4f9d\u6258\u4e8e `proxy-wasm` \u63d0\u4f9b\u7684 ABI\uff08\u4e8c\u8fdb\u5236\u5e94\u7528\u63a5\u53e3\uff09\uff0c\u8fd9\u90e8\u5206\u7684\u8bbf\u95ee\u8c03\u7528\u66f4\u4e3a\u5b89\u5168\u3002Wasm \u63d2\u4ef6\u53ea\u5141\u8bb8\u5bf9\u8bf7\u6c42\u8fdb\u884c\u7279\u5b9a\u7684\u4fee\u6539\u3002\u53e6\u5916\uff0c\u7531\u4e8e Wasm \u63d2\u4ef6\u8fd0\u884c\u5728\u7279\u5b9a\u7684 VM \u4e2d\uff0c\u6240\u4ee5\u5373\u4f7f\u63d2\u4ef6\u8fd0\u884c\u51fa\u73b0\u5d29\u6e83\u4e5f\u4e0d\u4f1a\u5f71\u54cd APISIX \u4e3b\u8fdb\u7a0b\u7684\u8fd0\u884c\u3002\\n\\n## APISIX \u5982\u4f55\u652f\u6301 Wasm\\n\\n\u4e86\u89e3\u5b8c Wasm\uff0c\u73b0\u5728\u6211\u4eec\u5c06\u4ece\u81ea\u9876\u5411\u4e0b\u7684\u89d2\u5ea6\u6765\u770b APISIX \u662f\u5982\u4f55\u652f\u6301 Wasm \u63d2\u4ef6\u529f\u80fd\u7684\u3002\\n\\n![apisix-wasm](https://static.apiseven.com/uploads/2023/03/10/5t9ZpK7P_apisx-wasm.jpeg)\\n\\n### APISIX Wasm \u63d2\u4ef6\\n\\n\u5728 APISIX \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u9ad8\u7ea7\u8bed\u8a00 C/C++/Go/Rust \u6765\u6309\u7167 `proxy-wasm` \u89c4\u8303\u4ee5\u53ca\u5bf9\u5e94\u7684 SDK \u6765\u7f16\u5199\u63d2\u4ef6\u3002\\n\\n> `proxy-wasm` \u662f Envoy \u63a8\u51fa\u7684\u5728 L4/L7 \u4ee3\u7406\u4e4b\u95f4\u7684 ABI \u7684\u89c4\u8303\u4e0e\u6807\u51c6\u3002\\n\u5728\u8be5\u89c4\u8303\u4e2d\u5b9a\u4e49\u4e86\u5305\u542b\u5185\u5b58\u7ba1\u7406\u3001\u56db\u5c42\u4ee3\u7406\u3001\u4e03\u5c42\u4ee3\u7406\u6269\u5c55\u7b49 ABI\u3002\\n\u4f8b\u5982\u5728\u4e03\u5c42\u4ee3\u7406\u4e2d\uff0c`proxy-wasm` \u89c4\u8303\u5b9a\u4e49\u4e86 proxy_on_http_request_headers\uff0cproxy_on_http_request_body\uff0cproxy_on_http_request_trailers\uff0cproxy_on_http_response_headers \u7b49 ABI\uff0c\u4f7f\u5f97\u6a21\u5757\u80fd\u591f\u5728\u5404\u4e2a\u9636\u6bb5\u5bf9\u8bf7\u6c42\u5185\u5bb9\u8fdb\u884c\u83b7\u53d6\u4e0e\u4fee\u6539\u3002\\n\\n\u4f8b\u5982\uff0c\u6211\u4eec\u4f7f\u7528 Golang \u7ed3\u5408 [proxy-wasm-go-sdk](https://github.com/tetratelabs/proxy-wasm-go-sdk), \u7f16\u5199\u5982\u4e0b\u63d2\u4ef6\uff1a\\n\\n> `proxy-wasm-go-sdk` \u6b63\u662f\u4e0a\u8ff0 `proxy-wasm` \u89c4\u8303\u7684 SDK\uff0c\u5b83\u5e2e\u52a9\u5f00\u53d1\u8005\u66f4\u597d\u7684\u4f7f\u7528 Golang \u7f16\u5199 proxy-wasm \u63d2\u4ef6\u3002\\n\\n\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e\u539f\u751f Golang \u5728\u652f\u6301 WASI \u65f6\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff0c\u56e0\u6b64\u8be5 SDK \u57fa\u4e8e TinyGo \u5b9e\u73b0\uff0c\u66f4\u591a\u5185\u5bb9\u53ef\u4ee5[\u70b9\u51fb](https://github.com/tetratelabs/proxy-wasm-go-sdk/blob/main/doc/OVERVIEW.md#tinygo-vs-the-official-go-compiler)\u8fdb\u884c\u67e5\u770b\u3002\\n\\n\u8be5\u63d2\u4ef6\u7684\u4e3b\u8981\u529f\u80fd\u7528\u4e8e\u5c06 HTTP \u4fee\u6539\u8bf7\u6c42\u7684\u54cd\u5e94\u72b6\u6001\u7801\u4e0e\u54cd\u5e94\u4f53\uff0c\u5f15\u7528\u81ea APISIX [\u94fe\u63a5](https://github.com/apache/apisix/blob/master/t/wasm/fault-injection/main.go)\uff0c\\n\\n```go\\n...\\nfunc (ctx *pluginContext) OnPluginStart(pluginConfigurationSize int) types.OnPluginStartStatus {\\n        data, err := proxywasm.GetPluginConfiguration()\\n        if err != nil {\\n                proxywasm.LogErrorf(\\"error reading plugin configuration: %v\\", err)\\n                return types.OnPluginStartStatusFailed\\n        }\\n\\n        var p fastjson.Parser\\n        v, err := p.ParseBytes(data)\\n        if err != nil {\\n                proxywasm.LogErrorf(\\"error decoding plugin configuration: %v\\", err)\\n                return types.OnPluginStartStatusFailed\\n        }\\n        ctx.Body = v.GetStringBytes(\\"body\\")\\n        ctx.HttpStatus = uint32(v.GetUint(\\"http_status\\"))\\n        if v.Exists(\\"percentage\\") {\\n                ctx.Percentage = v.GetInt(\\"percentage\\")\\n        } else {\\n                ctx.Percentage = 100\\n        }\\n\\n        // schema check\\n        if ctx.HttpStatus < 200 {\\n                proxywasm.LogError(\\"bad http_status\\")\\n                return types.OnPluginStartStatusFailed\\n        }\\n        if ctx.Percentage < 0 || ctx.Percentage > 100 {\\n                proxywasm.LogError(\\"bad percentage\\")\\n                return types.OnPluginStartStatusFailed\\n        }\\n\\n        return types.OnPluginStartStatusOK\\n}\\n\\nfunc (ctx *httpLifecycle) OnHttpRequestHeaders(numHeaders int, endOfStream bool) types.Action {\\n        plugin := ctx.parent\\n        if !sampleHit(plugin.Percentage) {\\n                return types.ActionContinue\\n        }\\n\\n        err := proxywasm.SendHttpResponse(plugin.HttpStatus, nil, plugin.Body, -1)\\n        if err != nil {\\n                proxywasm.LogErrorf(\\"failed to send local response: %v\\", err)\\n                return types.ActionContinue\\n        }\\n        return types.ActionPause\\n}\\n...\\n```\\n\\n\u4e4b\u540e\uff0c\u6211\u4eec\u901a\u8fc7 `tiny-go` \u5c06\u4e0a\u8ff0\u7684 Golang \u4ee3\u7801\u7f16\u8bd1\u751f\u6210 `.wasm` \u6587\u4ef6\\n\\n```bash\\ntinygo build -o wasm_fault_injection.go.wasm -scheduler=none -target=wasi ./main.go\\n```\\n\\n\u5b8c\u6210\u7f16\u8bd1\u4e4b\u540e\uff0c\u6211\u4eec\u5f97\u5230\u4e86 `fault_injection.go.wasm` \u6587\u4ef6\\n\\n> \u5982\u679c\u5bf9 wasm \u6587\u4ef6\u5185\u5bb9\u611f\u5174\u8da3\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 [wasm-tool](https://github.com/bytecodealliance/wasm-tools) \u5de5\u5177\u6765\u67e5\u770b\u8be5 wasm \u6587\u4ef6\u7684\u5177\u4f53\u5185\u5bb9\u3002\\n`wasm-tools dump hello.go.wasm`\\n\\n\u5c06 `wasm_fault_injection.go.wasm` \u914d\u7f6e\u5230 APISIX \u5230 `config.yaml`\uff0c\u5e76\u5c06\u8be5\u63d2\u4ef6\u547d\u540d\u4e3a `wasm_fault_injection`\u3002\\n\\n```yaml\\napisix:\\n        ...\\nwasm:\\n  plugins:\\n    - name: wasm_fault_injection\\n      priority: 7997\\n      file: wasm_fault_injection.go.wasm\\n```\\n\\n\u4e4b\u540e\uff0c\u6211\u4eec\u542f\u52a8 APISIX \uff0c\u5e76\u521b\u5efa\u4e00\u6761\u8def\u7531\u5f15\u7528\u8be5 Wasm \u63d2\u4ef6\uff1a\\n\\n```bash\\ncurl  http://127.0.0.1:9180/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'{\\n    \\"uri\\":\\"/*\\",\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"timeout\\":{\\n            \\"connect\\":1,\\n            \\"read\\":1,\\n            \\"send\\":1\\n        },\\n        \\"nodes\\":{\\n            \\"httpbin.org:80\\":1\\n        }\\n    },\\n    \\"plugins\\":{\\n        \\"wasm_fault_injection\\":{\\n            \\"conf\\":\\"{\\\\\\"http_status\\\\\\":200, \\\\\\"body\\\\\\":\\\\\\"Hello WebAssembly!\\\\n\\\\\\"}\\"\\n        }\\n    },\\n    \\"name\\":\\"wasm_fault_injection\\"\\n}\'\\n\\n```\\n\\n\u8fdb\u884c\u8bbf\u95ee\u6d4b\u8bd5\uff0c\u53d1\u73b0\u54cd\u5e94\u4f53\u5df2\u88ab\u4fee\u6539\u4e3a \\"Hello WebAssembly\\"\uff0c\u7531\u6b64 Wasm \u63d2\u4ef6\u5df2\u7ecf\u751f\u6548\u3002\\n\\n```bash\\ncurl 127.0.0.1:9080/get -v\\n*   Trying 127.0.0.1:9080...\\n* Connected to 127.0.0.1 (127.0.0.1) port 9080 (#0)\\n> GET /get HTTP/1.1\\n> Host: 127.0.0.1:9080\\n> User-Agent: curl/7.81.0\\n> Accept: */*\\n>\\n* Mark bundle as not supporting multiuse\\n< HTTP/1.1 200 OK\\n< Date: Thu, 09 Feb 2023 07:46:50 GMT\\n< Content-Type: text/plain; charset=utf-8\\n< Transfer-Encoding: chunked\\n< Connection: keep-alive\\n< Server: APISIX/3.1.0\\n<\\nHello WebAssembly!\\n```\\n\\n### Wasm-nginx-module\\n\\n\u4e86\u89e3\u5b8c Apache APISIX \u5982\u4f55\u4f7f\u7528 Wasm \u63d2\u4ef6\uff0c\u73b0\u5728\u6211\u4eec\u66f4\u8fdb\u4e00\u6b65\u6765\u4e86\u89e3 \\"\u4e3a\u4ec0\u4e48\u6211\u4eec\u80fd\u5728 Wasm \u63d2\u4ef6\u4e2d\u83b7\u53d6\u5230\u8bf7\u6c42\u7684\u5185\u5bb9\u5e76\u4fee\u6539\u8bf7\u6c42\uff1f\\" \u3002\\n\u7531\u4e8e APISIX \u9009\u7528 Openresty \u4f5c\u4e3a\u5e95\u5c42\u6846\u67b6\uff0c\u56e0\u6b64 Wasm \u63d2\u4ef6\u4e2d\u60f3\u8981\u80fd\u591f\u83b7\u53d6\u5230\u8bf7\u6c42\u5185\u5bb9\u548c\u4fee\u6539\u8bf7\u6c42\u5185\u5bb9\uff0c\u5c31\u9700\u8981\u548c openResty \u6216\u8005 NGINX \u63d0\u4f9b\u7684 API \u8fdb\u884c\u4ea4\u4e92\u3002`wasm-nginx-module` \u6b63\u662f\u63d0\u4f9b\u4e86\u8fd9\u90e8\u5206\u80fd\u529b\u3002\\n\\n> `wasm-nginx-module` \u662f\u7531 [API7](https://api7.ai/) \u7814\u53d1\u7684\u652f\u6301 Wasm \u7684 NGINX \u6a21\u5757\u3002\\n\u8be5\u6a21\u5757\u5c1d\u8bd5\u5728 NGINX \u7684\u57fa\u7840\u4e0a\u5b9e\u73b0 `proxy-wasm-abi`\uff0c\u5e76\u4e14\u5411\u4e0a\u5c01\u88c5\u4e86 Lua API\uff0c\u4f7f\u5f97\u6211\u4eec\u80fd\u591f\u5728 Lua \u5c42\u9762\u5b8c\u6210 `proxy-wasm-abi` \u7684\u8c03\u7528\u3002\\n\u66f4\u591a\u5185\u5bb9\u53ef\u53c2\u8003 [wasm-nginx-module](https://github.com/api7/wasm-nginx-module)\u3002\\n\\n\u4f8b\u5982\uff0c\u5f53\u6211\u4eec\u7684 APISIX \u8fd0\u884c\u5230 \\"access\\" \u9636\u6bb5\u65f6\uff0c\u4f1a\u8c03\u7528 `wasm-nginx-module` \u4e2d\u63d0\u4f9b\u7684 Lua \u65b9\u6cd5\\non_http_request_headers\u3002\\n\\n```lua\\n-- apisix/wasm.lua\\n...\\nlocal ok, err = wasm.on_http_request_headers(plugin_ctx)\\n   if not ok then\\n       core.log.error(name, \\": failed to run wasm plugin: \\", err)\\n       return 503\\n   end\\nend\\n...\\n\\n```\\n\\n\u4e4b\u540e\u5728\u8be5\u65b9\u6cd5\u4e2d\uff0c\u5c06\u8c03\u7528 `wasm-nginx-module` \u4e2d `ngx_http_wasm_on_http` \u65b9\u6cd5\uff0c\\n\\n```lua\\nngx_int_t\\nngx_http_wasm_on_http(ngx_http_wasm_plugin_ctx_t *hwp_ctx, ngx_http_request_t *r,\\n                      ngx_http_wasm_phase_t type, const u_char *body, size_t size,\\n                      int end_of_body)\\n{\\n    ...\\n\\n    ctx = ngx_http_wasm_get_module_ctx(r);\\n\\n    if (type == HTTP_REQUEST_HEADERS) {\\n        cb_name = &proxy_on_request_headers;\\n    } else if (type == HTTP_REQUEST_BODY) {\\n        cb_name = &proxy_on_request_body;\\n    } else if (type == HTTP_RESPONSE_HEADERS) {\\n        cb_name = &proxy_on_response_headers;\\n    } else {\\n        cb_name = &proxy_on_response_body;\\n    }\\n\\n    if (type == HTTP_REQUEST_HEADERS || type == HTTP_RESPONSE_HEADERS) {\\n        if (hwp_ctx->hw_plugin->abi_version == PROXY_WASM_ABI_VER_010) {\\n            rc = ngx_wasm_vm->call(hwp_ctx->hw_plugin->plugin,\\n                                   cb_name,\\n                                   true, NGX_WASM_PARAM_I32_I32, http_ctx->id, 0);\\n        } else {\\n            rc = ngx_wasm_vm->call(hwp_ctx->hw_plugin->plugin,\\n                                   cb_name,\\n                                   true, NGX_WASM_PARAM_I32_I32_I32, http_ctx->id,\\n                                   0, 1);\\n        }\\n\\n    } else {\\n        rc = ngx_wasm_vm->call(hwp_ctx->hw_plugin->plugin,\\n                              cb_name,\\n                              true, NGX_WASM_PARAM_I32_I32_I32, http_ctx->id,\\n                              size, end_of_body);\\n    }\\n    ...\\n}\\n```\\n\\n\u5728 `wasm-nginx-module` \u4e2d\uff0c\u6211\u4eec\u5c06\u6839\u636e\u4e0d\u540c\u7684\u9636\u6bb5\uff0c\u8bbe\u7f6e `cb_name`\uff0c\u4f8b\u5982\uff1a`HTTP_REQUEST_HEADERS` \u5bf9\u5e94 `proxy_on_request_headers`\uff0c\u4e4b\u540e\u5c06\u5728 `ngx_wasm_vm->call`  \u4e2d\u8c03\u7528 vm \u4e2d\u7684\u65b9\u6cd5\u4e5f\u5c31\u662f\u6211\u4eec\u5728\u4e0a\u6587\u4e2d\u63d0\u5230\u7684 wasm \u63d2\u4ef6 `OnHttpRequestHeaders` \u7684\u65b9\u6cd5\u3002\\n\\n\u81f3\u6b64\uff0c\u6574\u4e2a APISIX \u8c03\u7528 wasm \u63d2\u4ef6\uff0c\u8fd0\u884c Golang \u7684\u8c03\u7528\u94fe\u4fbf\u68b3\u7406\u5b8c\u6210\uff0c\u8c03\u7528\u94fe\u5982\u4e0b\uff1a\\n\\n![wasm-call](https://static.apiseven.com/uploads/2023/03/10/fzwAEDi4_call.png)\\n\\n### Wasm VM\\n\\nWasm VM \u7528\u4e8e\u771f\u6b63\u6267\u884c Wasm \u4ee3\u7801\u7684\u865a\u62df\u673a\uff0c\u5728 `wasm-nginx-module` \u4e2d\u5b9e\u73b0\u4e86\u5bf9\u4e24\u79cd\u865a\u62df\u673a \\"wasmtime\\" \u548c \\"wasmedge\\" \u4e24\u79cd\u865a\u62df\u673a\uff0c\u5728 APISIX \u4e2d\u9ed8\u8ba4\u9009\u62e9\u4f7f\u7528 \\"wasmtime\\" \u4f5c\u4e3a Wasm \u4ee3\u7801\u7684\u8fd0\u884c\u865a\u62df\u673a\u3002\\n\\n> Wasmtime\\n[Wasmtime](https://github.com/bytecodealliance/wasmtime) \u662f\u7531 bytecodealliance \u5f00\u6e90\u7684 WebAssembly \u548c WASI \u7684\u5c0f\u578b\u9ad8\u6548\u8fd0\u884c\u65f6\u3002\u5b83\u80fd\u591f\u5728 Web \u5916\u90e8\u8fd0\u884c WebAssembly \u4ee3\u7801\uff0c\u5373\u53ef\u4ee5\u7528\u4f5c\u547d\u4ee4\u884c\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a WebAssembly \u8fd0\u884c\u5f15\u64ce\u5d4c\u5165\u5230\u5176\u4ed6\u7a0b\u5e8f\u4f5c\u4e3a\u5e93\u4f7f\u7528\u3002\\nWasmedge\\n[Wasmedge](https://wasmedge.org/) \u662f\u4e3a\u8fb9\u7f18\u8ba1\u7b97\u4f18\u5316\u7684\u8f7b\u91cf\u7ea7\u3001\u9ad8\u6027\u80fd\u3001\u53ef\u6269\u5c55\u7684 WebAssembly (Wasm) \u865a\u62df\u673a\uff0c\u53ef\u7528\u4e8e\u4e91\u539f\u751f\u3001\u8fb9\u7f18\u548c\u53bb\u4e2d\u5fc3\u5316\u7684\u5e94\u7528\u3002\\n\\n\u5728 Wasm vm \u4e2d\u9996\u5148\u901a\u8fc7 `load` \u65b9\u6cd5\u5c06 `.wasm` \u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u4e4b\u540e\u6211\u4eec\u4fbf\u53ef\u4ee5\u901a\u8fc7 VM \u7684 call \u65b9\u6cd5\u6765\u8c03\u7528\u8fd9\u4e9b\u65b9\u6cd5\u3002VM \u5e95\u5c42\u4f9d\u6258\u4e8e WASI \u7684\u63a5\u53e3\u5b9e\u73b0\uff0c\u4f7f\u5f97 Wasm \u4ee3\u7801\u4e0d\u4ec5\u80fd\u591f\u8fd0\u884c\u5728\u6d4f\u89c8\u5668\u7aef\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u80fd\u591f\u5728\u670d\u52a1\u7aef\u8fdb\u884c\u3002\\n\\n## \u603b\u7ed3\\n\\n\u901a\u8fc7\u672c\u6587\u6211\u4eec\u4e86\u89e3\u5230 Wasm \u662f\u4ec0\u4e48\u4ee5\u53ca APISIX \u5982\u4f55\u652f\u6301 Wasm \u63d2\u4ef6\u3002APISIX \u901a\u8fc7\u652f\u6301 Wasm \u63d2\u4ef6\uff0c\u4e0d\u4f46\u53ef\u4ee5\u6269\u5145\u5bf9\u591a\u8bed\u8a00\u7684\u652f\u6301\uff0c\u4f8b\u5982\u901a\u8fc7 C++, Rust, Golang, AssemblyScript \u7b49\u8fdb\u884c\u63d2\u4ef6\u5f00\u53d1\uff0c\u800c\u4e14\u7531\u4e8e WebAssembly \u6b63\u5728\u4ece\u6d4f\u89c8\u5668\u8d70\u5411\u4e91\u539f\u751f\u62e5\u6709\u4e86\u66f4\u52a0\u4e30\u5bcc\u7684\u751f\u6001\u4e0e\u4f7f\u7528\u573a\u666f\uff0c\u56e0\u6b64 APISIX \u4e5f\u53ef\u4ee5\u501f\u52a9 Wasm \u5b8c\u6210\u5728 API \u7f51\u5173\u4fa7\u66f4\u591a\u7684\u6269\u5c55\u529f\u80fd\uff0c\u89e3\u51b3\u66f4\u591a\u4f7f\u7528\u573a\u666f\u3002"},{"id":"\u4ec0\u4e48\u662f LuaJIT\uff1f\u4e3a\u4ec0\u4e48 Apache APISIX \u9009\u62e9\u4e86 LuaJIT\uff1f","metadata":{"permalink":"/zh/blog/2023/03/22/what-is-luajit-and-why-does-apisix-choose-luajit","source":"@site/blog/2023/03/22/what-is-luajit-and-why-does-apisix-choose-luajit.md","title":"\u4ec0\u4e48\u662f LuaJIT\uff1f\u4e3a\u4ec0\u4e48 Apache APISIX \u9009\u62e9\u4e86 LuaJIT\uff1f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 LuaJIT \u7684\u9ad8\u7075\u6d3b\u6027\u548c\u9ad8\u6027\u80fd\uff0c\u4ee5\u53ca APISIX \u4f5c\u4e3a\u4e91\u539f\u751f API \u7f51\u5173\u9009\u62e9 LuaJIT \u7684\u539f\u56e0\u3002","date":"2023-03-22T00:00:00.000Z","formattedDate":"2023\u5e743\u670822\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":14.67,"truncated":true,"authors":[{"name":"\u6768\u9676","title":"Author","url":"https://github.com/SkyeYoung","image_url":"https://github.com/SkyeYoung.png","imageURL":"https://github.com/SkyeYoung.png"}],"prevItem":{"title":"WebAssembly \u52a9\u529b\u4e91\u539f\u751f\uff1aAPISIX \u5982\u4f55\u501f\u52a9 Wasm \u63d2\u4ef6\u5b9e\u73b0\u6269\u5c55\u529f\u80fd\uff1f","permalink":"/zh/blog/2023/03/30/what-is-wasm-and-how-does-apache-apisix-support-it"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (2.27 - 3.12)","permalink":"/zh/blog/2023/03/16/weekly-report-0316"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 LuaJIT \u7684\u9ad8\u7075\u6d3b\u6027\u548c\u9ad8\u6027\u80fd\uff0c\u4ee5\u53ca APISIX \u4f5c\u4e3a\u4e91\u539f\u751f API \u7f51\u5173\u9009\u62e9 LuaJIT \u7684\u539f\u56e0\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u6768\u9676](https://github.com/SkyeYoung)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\u3002\\n\\n## \u4ec0\u4e48\u662f LuaJIT\\n\\n### \u5b9a\u4e49\\n\\n\u7b80\u5355\u5730\u8bf4\uff0cLuaJIT \u662f Lua \u8fd9\u79cd\u7f16\u7a0b\u8bed\u8a00\u7684\u5b9e\u65f6\u7f16\u8bd1\uff08JIT\uff0cJust-In-Time Compilation\uff09\u5668\u7684\u5b9e\u73b0\u3002\\n\u5bf9\u4e8e\u4e0d\u592a\u4e86\u89e3 LuaJIT \u7684\u8bfb\u8005\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 LuaJIT \u62c6\u6210 Lua \u548c JIT \u4e24\u4e2a\u90e8\u5206\u6765\u7406\u89e3\u3002\\n\\n#### Lua\\n\\nLua \u662f\u4e00\u79cd\u4f18\u96c5\u3001\u6613\u4e8e\u5b66\u4e60\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u5177\u6709\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u3001\u5b8c\u6574\u7684\u8bcd\u6cd5\u4f5c\u7528\u57df\u3001\u95ed\u5305\u3001\u8fed\u4ee3\u5668\u3001\u534f\u7a0b\u3001\u6b63\u786e\u7684\u5c3e\u90e8\u8c03\u7528\u4ee5\u53ca\u4f7f\u7528\u5173\u8054\u6570\u7ec4\u8fdb\u884c\u975e\u5e38\u5b9e\u7528\u7684\u6570\u636e\u5904\u7406\u3002\u672c\u6587\u4e0d\u4f1a\u6d89\u53ca Lua \u7684\u8bed\u6cd5\uff0c\u6709\u5173\u5185\u5bb9\u6b22\u8fce\u9605\u8bfb [Getting Started With Lua](https://api7.ai/learning-center/openresty/getting-started-with-lua)\u3002\\n\\nLua \u7684\u8bbe\u8ba1\u76ee\u6807\u662f\u80fd\u4e0e C \u6216\u5176\u5b83\u5e38\u7528\u7684\u7f16\u7a0b\u8bed\u8a00\u76f8\u4e92\u96c6\u6210\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5229\u7528\u5176\u5b83\u8bed\u8a00\u5df2\u7ecf\u505a\u597d\u7684\u65b9\u9762\uff1b\u800c\u5b83\u63d0\u4f9b\u7684\u7279\u6027\u53c8\u6070\u597d\u662f C \u8fd9\u7c7b\u8bed\u8a00\u4e0d\u592a\u64c5\u957f\u7684\uff0c\u6bd4\u5982\u76f8\u5bf9\u4e8e\u786c\u4ef6\u5c42\u7684\u9ad8\u5c42\u62bd\u8c61\uff0c\u52a8\u6001\u7684\u7ed3\u6784\uff0c\u7b80\u6613\u7684\u6d4b\u8bd5\u7b49\u7b49\u3002\u5176\u8896\u73cd\u7684\u8bed\u8a00\u5185\u6838\u548c\u53ea\u4f9d\u8d56\u4e8e ANSI C \u6807\u51c6\u7684\u7279\u70b9\uff0c\u4f7f\u4e4b\u5728\u5404\u5e73\u53f0\u4e0a\u7684\u53ef\u79fb\u690d\u6027\u53d8\u5f97\u975e\u5e38\u9ad8\u3002\u56e0\u6b64 Lua \u4e0d\u4ec5\u662f\u4e00\u4e2a\u53ef\u4ee5\u4f5c\u4e3a\u72ec\u7acb\u7a0b\u5e8f\u8fd0\u884c\u7684\u811a\u672c\u8bed\u8a00\uff0c\u4e5f\u662f\u4e00\u4e2a\u53ef\u4ee5\u5d4c\u5165\u5176\u5b83\u5e94\u7528\u7684\u5d4c\u5165\u5f0f\u8bed\u8a00\u3002\\n\\n![Apache APISIX \u5c31\u662f\u4e00\u4e2a\u5728\u5e95\u5c42\u540c\u65f6\u4f7f\u7528 Lua \u548c C \u7684\u6781\u4f73\u4f8b\u5b50\u3002](https://static.apiseven.com/uploads/2023/02/24/TjmXxHHf_%E4%B8%8B%E8%BD%BD%20%281%29.png)\\n\\n\u4f46\u6b64\u65f6\u7684 Lua \u8fd8\u6709\u4f20\u7edf\u811a\u672c\u8bed\u8a00\u5e38\u89c1\u7684\u4e24\u4e2a\u95ee\u9898\uff1a\u6548\u7387\u4f4e\u548c\u4ee3\u7801\u66b4\u9732\u3002\u800c LuaJIT \u5f15\u5165\u7684 JIT \u6280\u672f\u80fd\u591f\u6709\u6548\u5730\u89e3\u51b3\u4e86\u8fd9\u4e24\u4e2a\u95ee\u9898\u3002\\n\\n#### JIT\\n\\nJIT\uff08Just-In-Time Compilation\uff09\uff0c\u5b9e\u65f6\u7f16\u8bd1\uff0c\u662f\u52a8\u6001\u7f16\u8bd1\u7684\u4e00\u79cd\u5f62\u5f0f\u3002\u5728\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\uff0c\u52a8\u6001\u7f16\u8bd1\u5e76\u4e0d\u662f\u552f\u4e00\u7684\u7f16\u8bd1\u5f62\u5f0f\uff0c\u6bd4\u5982\u73b0\u4eca\u4ecd\u7136\u6d41\u884c\u7684 C \u8bed\u8a00\u4f7f\u7528\u7684\u5c31\u662f\u53e6\u4e00\u79cd\u5f62\u5f0f\uff1a\u9759\u6001\u7f16\u8bd1\u3002\\n\\n\u9700\u8981\u6307\u51fa\u7684\u662f\uff0c\u6211\u4eec\u4e5f\u5e38\u5e38\u5c06 C \u8bed\u8a00\u7684\u8fd9\u79cd\u4e0e\u52a8\u6001\u7f16\u8bd1\u76f8\u53cd\u7684\u7f16\u8bd1\u65b9\u5f0f\u79f0\u4e3a\u63d0\u524d\u7f16\u8bd1\uff08AOT\uff0cAhead-of-Time Compilation\uff09\uff0c\u4f46\u4e8c\u8005\u5e76\u4e0d\u662f\u5b8c\u5168\u5bf9\u7b49\u7684\u3002AOT \u4ec5\u662f\u63cf\u8ff0\u5728\u6267\u884c\u7a0b\u5e8f\u524d\uff0c\u5c06\u67d0\u79cd\u201c\u9ad8\u7ea7\u201d\u8bed\u8a00\u7f16\u8bd1\u4e3a\u67d0\u79cd\u201c\u4f4e\u7ea7\u201d\u8bed\u8a00\u7684\u884c\u4e3a\u3002\u5176\u7f16\u8bd1\u7684\u76ee\u6807\u8bed\u8a00\u5e76\u4e0d\u4e00\u5b9a\u7279\u5b9a\u4e8e\u7a0b\u5e8f\u5bbf\u4e3b\u673a\u4e0a\u7684\u673a\u5668\u7801\uff0c\u800c\u662f\u4efb\u610f\u5b9a\u4e49\u7684\u3002\u6bd4\u5982\u5c06 Java \u7f16\u8bd1\u4e3a C\uff0c\u6216\u8005\u5c06 JavaScript \u7f16\u8bd1\u4e3a V8 \u7b49\u7b49\u8fd9\u4e9b\u884c\u4e3a\u4e5f\u4f1a\u88ab\u89c6\u4e3a AOT\u3002\u7531\u4e8e\u6240\u6709\u9759\u6001\u7f16\u8bd1\u5728\u6280\u672f\u4e0a\u90fd\u662f\u63d0\u524d\u6267\u884c\u7684\uff0c\u6240\u4ee5\u5728\u8fd9\u79cd\u7279\u5b9a\u7684\u4e0a\u4e0b\u6587\u4e2d\u4f7f\u7528\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 AOT \u89c6\u4e3a\u4e0e JIT \u76f8\u53cd\u7684\u9759\u6001\u7f16\u8bd1\u3002\\n\\n\u629b\u5f00\u8fd9\u4e9b\u5197\u6742\u7684\u540d\u8bcd\uff0c\u60f3\u5230\u9759\u6001\u7f16\u8bd1\u7684\u4ea7\u7269\uff0c\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\uff0cLua \u8bed\u8a00\u9762\u4e34\u7684\u95ee\u9898\u4e5f\u53ef\u4ee5\u901a\u8fc7\u9759\u6001\u7f16\u8bd1\u6765\u89e3\u51b3\u3002\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u5c31\u4e22\u5931\u4e86 Lua \u4f5c\u4e3a\u811a\u672c\u8bed\u8a00\u7684\u4f18\u52bf\uff1a\u70ed\u66f4\u65b0\u7684\u7075\u6d3b\u6027\u548c\u826f\u597d\u7684\u5e73\u53f0\u517c\u5bb9\u6027\u3002\u6240\u4ee5\u76ee\u524d\u9664\u4e86\u6709\u7279\u6b8a\u9700\u6c42\u7684\u811a\u672c\u8bed\u8a00\u5916\uff0c\u5927\u90e8\u5206\u811a\u672c\u8bed\u8a00\u90fd\u5728\u4f7f\u7528 JIT \u5c1d\u8bd5\u63d0\u9ad8\u8bed\u8a00\u6027\u80fd\uff0c\u6bd4\u5982 Chromium \u5e73\u53f0\u4e0a\u4f7f\u7528 V8 \u7684 JavaScript \u548c\u4f7f\u7528 YJIT \u7684 Ruby\u3002\\n\\nJIT \u5c1d\u8bd5\u5c06 Lua \u7684\u52a8\u6001\u89e3\u91ca\u548c C \u7684\u9759\u6001\u7f16\u8bd1\u4e24\u8005\u7684\u4f18\u7f3a\u70b9\u76f8\u7ed3\u5408\uff0c\u5728\u811a\u672c\u8bed\u8a00\u7684\u6267\u884c\u671f\u95f4\uff0c\u901a\u8fc7\u4e0d\u65ad\u5730\u5206\u6790\u6b63\u5728\u6267\u884c\u7684\u4ee3\u7801\u7247\u6bb5\uff0c\u7f16\u8bd1\u6216\u91cd\u65b0\u7f16\u8bd1\u8fd9\u6bb5\u4ee3\u7801\uff0c\u4ee5\u5f97\u5230\u6267\u884c\u6548\u7387\u7684\u63d0\u5347\u3002\u6b64\u65f6\uff0cJIT \u5047\u8bbe\u7684\u76ee\u6807\u662f\uff0c\u7531\u6b64\u5f97\u5230\u7684\u6027\u80fd\u63d0\u5347\u80fd\u591f\u9ad8\u4e8e\u7f16\u8bd1\u6216\u91cd\u65b0\u7f16\u8bd1\u8fd9\u6bb5\u4ee3\u7801\u7684\u5f00\u9500\u3002\u7406\u8bba\u4e0a\u8bf4\uff0c\u7531\u4e8e\u80fd\u591f\u8fdb\u884c\u52a8\u6001\u5730\u91cd\u65b0\u7f16\u8bd1\uff0cJIT \u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u9488\u5bf9\u6b63\u5728\u8fd0\u884c\u7a0b\u5e8f\u7684\u7279\u5b9a\u5e73\u53f0\u67b6\u6784\u8fdb\u884c\u4f18\u5316\u3001\u52a0\u901f\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u80fd\u4ea7\u751f\u6bd4\u9759\u6001\u7f16\u8bd1\u66f4\u5feb\u7684\u6267\u884c\u901f\u5ea6\u3002\\n\\nJIT \u5206\u4e3a\u4f20\u7edf\u7684 Method JIT \u548c LuaJIT \u6b63\u5728\u4f7f\u7528\u7684 Trace JIT \u4e24\u79cd\u3002Method JIT \u662f\u5c06\u6bcf\u4e00\u4e2a\u65b9\u6cd5\uff08Method\uff09\u7ffb\u8bd1\u4e3a\u673a\u5668\u7801\uff1b\u800c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u66f4\u5148\u8fdb\u7684Trace JIT \u5047\u5b9a \u201c\u5bf9\u53ea\u6267\u884c\u4e00\u4e24\u6b21\u7684\u4ee3\u7801\uff0c\u89e3\u91ca\u6267\u884c\u6bd4 JIT \u7f16\u8bd1\u6267\u884c\u8981\u5feb\u201d\uff0c\u4ee5\u6b64\u4e3a\u4f9d\u636e\u5bf9\u4f20\u7edf JIT \u8fdb\u884c\u4f18\u5316\uff0c\u5177\u4f53\u8868\u73b0\u4e3a\u5c06\u9891\u7e41\u6267\u884c\u7684\u4ee3\u7801\u7247\u6bb5\uff08\u5373\u70ed\u8def\u5f84\u4e0a\u7684\u4ee3\u7801\uff09\u8ba4\u5b9a\u4e3a\u9700\u8981\u8ddf\u8e2a\u7684\u4ee3\u7801\uff0c\u5c06\u8fd9\u90e8\u5206\u4ee3\u7801\u7f16\u8bd1\u6210\u673a\u5668\u7801\u6267\u884c\u3002\\n\\n![LuaJIT \u7684\u539f\u7406](https://static.apiseven.com/uploads/2023/02/24/5tZgTwe1_%E6%97%A0%E6%A0%87%E9%A2%98-2023-02-24-1113.png)\\n\\n#### LuaJIT\\n\\n\u800c LuaJIT\uff082.x \u7248\u672c\uff09\u5728 Trace JIT \u7684\u57fa\u7840\u4e0a\uff0c\u96c6\u6210\u4e86\u4f7f\u7528\u6c47\u7f16\u7f16\u5199\u7684\u9ad8\u901f\u89e3\u91ca\u5668\u548c\u57fa\u4e8e [SSA](https://en.wikipedia.org/wiki/Static_single-assignment_form) \u5e76\u8fdb\u884c\u4f18\u5316\u7684\u4ee3\u7801\u751f\u6210\u5668\u540e\u7aef\uff0c\u5927\u5e45\u63d0\u9ad8\u4e86 JIT \u7684\u8868\u73b0\uff0c\u6700\u7ec8\u4f7f\u5f97 LuaJIT \u6210\u4e3a\u6700\u5feb\u7684\u52a8\u6001\u8bed\u8a00\u5b9e\u73b0\u4e4b\u4e00\u3002\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u76f8\u5bf9\u4e8e\u539f\u751f Lua \u4e2d\u4e3a\u4e86\u4e0e C \u4ea4\u4e92\u800c\u9700\u8981\u7f16\u5199 Lua \u4e0e C \u7684\u7e41\u590d\u7ed1\u5b9a\uff0cLuaJIT \u8fd8\u5b9e\u73b0\u4e86 FFI\uff08\u5916\u90e8\u51fd\u6570\u63a5\u53e3\uff0cForeign Function Interface\uff09\u3002\u8be5\u6280\u672f\u5141\u8bb8\u4e86\u6211\u4eec\u5728\u4e0d\u6e05\u695a\u53c2\u6570\u4e2a\u6570\u548c\u7c7b\u578b\u7684\u60c5\u51b5\u4e0b\uff0c\u4ece Lua \u4ee3\u7801\u4e2d\u76f4\u63a5\u8c03\u7528\u5916\u90e8\u7684 C \u51fd\u6570\u548c\u4f7f\u7528 C \u7684\u6570\u636e\u7ed3\u6784\u3002\u7531\u6b64\u529f\u80fd\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 FFI \u5b9e\u73b0\u6240\u9700\u7684\u6570\u636e\u7ed3\u6784\uff0c\u800c\u975e Lua \u539f\u751f\u7684 Table \u7c7b\u578b\uff0c\u8fdb\u4e00\u6b65\u5728\u6027\u80fd\u654f\u611f\u7684\u573a\u666f\u4e0b\uff0c\u63d0\u5347\u7a0b\u5e8f\u8fd0\u884c\u7684\u901f\u5ea6\u3002\u6709\u5173\u4f7f\u7528 FFI \u63d0\u9ad8\u6027\u80fd\u7684\u6280\u5de7\u5e76\u975e\u672c\u6587\u8ba8\u8bba\u7684\u8303\u7574\uff0c\u66f4\u6df1\u5165\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u9605 [Why Does lua-resty-core Perform Better?](https://api7.ai/learning-center/openresty/why-lua-resty-core-perform-better)\u3002\\n\\n\u603b\u800c\u8a00\u4e4b\uff0cLuaJIT \u5728 Lua \u8bed\u6cd5\u7684\u57fa\u7840\u4e0a\uff0c\u5b9e\u73b0\u4e86\u8fc4\u4eca\u4e3a\u6b62\u811a\u672c\u8bed\u8a00\u4e2d\u6700\u5feb\u7684 Trace JIT \u4e4b\u4e00\uff0c\u5e76\u63d0\u4f9b\u4e86 FFI \u7b49\u529f\u80fd\uff0c\u89e3\u51b3\u4e86 Lua \u6548\u7387\u4f4e\u548c\u4ee3\u7801\u66b4\u9732\u7684\u95ee\u9898\uff0c\u8ba9 Lua \u771f\u6b63\u6210\u4e3a\u4e86\u9ad8\u7075\u6d3b\u6027\u3001\u9ad8\u6027\u80fd\u548c\u8d85\u4f4e\u5185\u5b58\u5360\u7528\u7684\u811a\u672c\u8bed\u8a00\u548c\u5d4c\u5165\u5f0f\u8bed\u8a00\u3002\\n\\n### \u4e0e\u5176\u5b83\u8bed\u8a00\u3001WASM \u7684\u5bf9\u6bd4\\n\\n\u76f8\u5bf9\u4e8e Lua \u548c LuaJIT\uff0c\u6211\u4eec\u53ef\u80fd\u5bf9\u5176\u5b83\u7684\u4e00\u4e9b\u8bed\u8a00\u66f4\u52a0\u719f\u6089\uff0c\u6bd4\u5982 JavaScript (Node.js)\uff0cPython\uff0cGolang\uff0cJava \u7b49\u3002\u5bf9\u6bd4\u8fd9\u4e9b\u5927\u4f17\u5316\u7684\u8bed\u8a00\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u66f4\u591a LuaJIT \u7684\u7279\u6027\u548c\u4f18\u52bf\uff0c\u4e0b\u9762\u7b80\u5355\u7f57\u5217\u4e00\u4e9b Lua/LuaJIT \u4e0e\u8fd9\u4e9b\u8bed\u8a00\u7684\u5bf9\u6bd4\uff1a\\n\\n- Lua \u7684\u8bed\u6cd5\u8bbe\u8ba1\u662f\u9488\u5bf9\u975e\u8f6f\u4ef6\u5de5\u7a0b\u5e08\u6240\u8bbe\u8ba1\u7684\u3002\u6240\u4ee5\u50cf R \u8bed\u8a00\u4e00\u6837\uff0cLua \u4e5f\u62e5\u6709\u6570\u7ec4\u4e0b\u6807\u4ece 1 \u5f00\u59cb\u7b49\u9002\u5408\u666e\u901a\u4eba\u7684\u8bbe\u8ba1\u3002\\n- Lua \u975e\u5e38\u9002\u5408\u4f5c\u4e3a\u5d4c\u5165\u5f0f\u8bed\u8a00\u3002Lua \u672c\u8eab\u62e5\u6709\u4e00\u4e2a\u8f7b\u91cf\u7684 VM\uff0c\u800c LuaJIT \u5728\u6dfb\u52a0\u5404\u79cd\u529f\u80fd\u548c\u4f18\u5316\u540e\uff0c\u4e5f\u4ecd\u7136\u5f88\u8f7b\u91cf\u3002\u6240\u4ee5\u76f8\u5bf9 Node.js \u548c Python \u4e4b\u7c7b\u5e9e\u5927\u7684\u8fd0\u884c\u73af\u5883\uff0cLuaJIT \u76f4\u63a5\u96c6\u6210\u5230 C \u7f16\u5199\u7684\u7a0b\u5e8f\u4e2d\u540e\u4e5f\u4e0d\u4f1a\u589e\u5927\u592a\u591a\u4f53\u79ef\u3002\u56e0\u6b64\uff0c\u5b9e\u9645\u4e0a Lua \u662f\u6240\u6709\u5d4c\u5165\u5f0f\u8bed\u8a00\u4e2d\u4f7f\u7528\u91cf\u6bd4\u8f83\u5927\u4e14\u4e3b\u6d41\u7684\u9009\u62e9\u3002\\n- Lua \u4e5f\u5f88\u9002\u5408\u505a\u201c\u80f6\u6c34\u201d\u8bed\u8a00\u3002\u7c7b\u4f3c JavaScript(Node.js) \u548c Python\uff0cLua \u4e5f\u80fd\u5f88\u597d\u5730\u8fde\u63a5\u4e0d\u540c\u7684\u5e93\u548c\u4ee3\u7801\u3002\u4f46\u7a0d\u6709\u4e0d\u540c\u7684\u662f\uff0cLua \u4e0e\u5e95\u5c42\u751f\u6001\u7684\u8026\u5408\u6027\u66f4\u9ad8\uff0c\u6240\u4ee5\u5728\u4e0d\u540c\u7684\u9886\u57df\u4e2d\uff0cLua \u7684\u751f\u6001\u53ef\u80fd\u5e76\u4e0d\u901a\u7528\u3002\\n\\nWASM\uff08Web Assembly\uff09\u662f\u4e00\u79cd\u65b0\u5174\u7684\u8de8\u5e73\u53f0\u6280\u672f\u3002\u8fd9\u79cd\u8d77\u521d\u8bbe\u8ba1\u4e3a\u8865\u5145\u800c\u975e\u53d6\u4ee3 JavaScript \u7684\u6280\u672f\uff0c\u56e0\u4e3a\u80fd\u591f\u5c06\u5176\u5b83\u7684\u8bed\u8a00\u7f16\u8bd1\u6210 WASM \u5b57\u8282\u7801\uff0c\u540c\u65f6\u8fd8\u80fd\u4f5c\u4e3a\u5b89\u5168\u6c99\u7bb1\u8fd0\u884c\u4ee3\u7801\uff0c\u4f7f\u5f97\u8d8a\u6765\u8d8a\u591a\u7684\u7a0b\u5e8f\u4e5f\u5728\u8003\u8651\u4f7f\u7528 WASM \u4f5c\u4e3a\u5d4c\u5165\u6216\u8005\u80f6\u6c34\u7684\u5e73\u53f0\u3002\u5373\u4fbf\u5982\u6b64\uff0cLua/LuaJIT \u5728\u5bf9\u6bd4\u65b0\u5174\u7684 WASM \u65f6\uff0c\u4e5f\u4ecd\u7136\u6709\u4e0d\u5c11\u4f18\u52bf\uff1a\\n\\n- WASM \u7684\u6027\u80fd\u662f\u53d7\u9650\u7684\uff0c\u65e0\u6cd5\u8fbe\u5230\u6c47\u7f16\u7684\u6c34\u51c6\u3002\u666e\u904d\u573a\u666f\u4e0b\u7684\u6027\u80fd\uff0cWASM \u80af\u5b9a\u597d\u8fc7 Lua\uff0c\u4f46\u4e0e LuaJIT \u6709\u6240\u5dee\u8ddd\u3002\\n- WASM \u4e0e\u5bbf\u4e3b\u7a0b\u5e8f\u7684\u6570\u636e\u4f20\u9012\u6548\u7387\u6bd4\u8f83\u4f4e\u3002\u800c LuaJIT \u53ef\u4ee5\u901a\u8fc7 FFI \u8fdb\u884c\u9ad8\u6548\u7387\u7684\u6570\u636e\u4f20\u9012\u3002\\n\\n## \u4e3a\u4ec0\u4e48 Apache APISIX \u9009\u62e9 LuaJIT\\n\\n\u5c3d\u7ba1\u4e0a\u6587\u63cf\u8ff0\u4e86 LuaJIT \u81ea\u8eab\u7684\u8bf8\u591a\u4f18\u52bf\uff0c\u4f46\u5bf9\u4e8e\u5927\u90e8\u5206\u5f00\u53d1\u8005\u800c\u8a00\uff0cLua \u4e0d\u662f\u4e00\u95e8\u5927\u4f17\u7684\u8bed\u8a00\uff0cLuaJIT \u66f4\u4e0d\u662f\u4e00\u4e2a\u5927\u4f17\u7684\u9009\u62e9\u3002\u90a3\u4e3a\u4ec0\u4e48 Apache \u57fa\u91d1\u4f1a\u6240\u5c5e\u7684\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd8\u662f\u9009\u62e9\u4e86 LuaJIT \u5462\uff1f\\n\\n\u4f5c\u4e3a\u4e91\u539f\u751f\u7684 API \u7f51\u5173\uff0cApache APISIX \u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7b49\u7279\u70b9\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\uff08\u91d1\u4e1d\u96c0\u53d1\u5e03\uff09\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u6765\u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5904\u7406\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\uff0c\u8fd8\u53ef\u4ee5\u7528\u4f5c k8s \u7684 Ingress Controller\u3002\\n\\n\u800c\u8fd9\u4e00\u5207\u90fd\u5efa\u7acb\u5728 Apache APISIX \u6240\u9009\u62e9\u7684 NGINX \u548c LuaJIT \u6280\u672f\u6808\u4e4b\u4e0a\u3002\\n\\n### LuaJIT \u4e0e NGINX \u7ed3\u5408\u5e26\u6765\u7684\u4f18\u52bf\\n\\nNGINX \u662f\u4e00\u4e2a\u77e5\u540d\u7684\u9ad8\u6027\u80fd HTTP \u3001TCP/UDP \u4ee3\u7406\u548c\u53cd\u5411\u4ee3\u7406\u7684 Web \u670d\u52a1\u5668\u3002\\n\\n\u4f46\u5728\u4f7f\u7528\u4e2d\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u5f88\u607c\u4eba\u7684\u662f\uff0c\u6bcf\u6b21\u4fee\u6539 NGINX \u7684\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u90fd\u9700\u8981\u4f7f\u7528 `nginx -s reload` \u91cd\u65b0\u52a0\u8f7d NGINX \u914d\u7f6e\u3002\\n\\n\u4e0d\u4ec5\u5982\u6b64\uff0c\u9891\u7e41\u5730\u4f7f\u7528\u8be5\u547d\u4ee4\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u53ef\u80fd\u4f1a\u9020\u6210\u8fde\u63a5\u7684\u4e0d\u7a33\u5b9a\uff0c\u589e\u52a0\u4e1a\u52a1\u4e22\u5931\u7684\u53ef\u80fd\u6027\uff1b\u800c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0cNGINX \u91cd\u8f7d\u914d\u7f6e\u7684\u673a\u5236\u4e5f\u53ef\u80fd\u4f1a\u9020\u6210\u65e7\u8fdb\u7a0b\u7684\u56de\u6536\u65f6\u95f4\u8fc7\u957f\uff0c\u5f71\u54cd\u6b63\u5e38\u7684\u4e1a\u52a1\u3002\u5bf9\u4e8e\u8be5\u95ee\u9898\u7684\u6df1\u5165\u8ba8\u8bba\uff0c\u53ef\u4ee5\u9605\u8bfb [\u4e3a\u4ec0\u4e48 NGINX \u7684 reload \u4e0d\u662f\u70ed\u52a0\u8f7d\uff1f](https://apisix.apache.org/zh/blog/2022/11/23/why-is-not-reload-hot-loaded-in-nginx/)\uff0c\u8fd9\u91cc\u4e0d\u8fdb\u884c\u6df1\u5165\u5c55\u5f00\u3002\\n\\nApache APISIX \u8bde\u751f\u7684\u76ee\u7684\u4e4b\u4e00\u5c31\u662f\u89e3\u51b3 NGINX \u7684\u52a8\u6001\u914d\u7f6e\u95ee\u9898\uff0cLuaJIT \u7684\u9ad8\u7075\u6d3b\u6027\u3001\u9ad8\u6027\u80fd\u548c\u8d85\u4f4e\u5185\u5b58\u5360\u7528\u5e26\u6765\u4e86\u8fd9\u79cd\u53ef\u80fd\u6027\u3002\\n\u4ee5\u6700\u5177\u666e\u904d\u6027\u7684\u8def\u7531\u4e3a\u4f8b\uff0cApache APISIX \u901a\u8fc7\u5728 NGINX \u914d\u7f6e\u6587\u4ef6\u4e2d\u53ea\u914d\u7f6e\u5355\u4e2a location \u4f5c\u4e3a\u4e3b\u5165\u53e3\uff0c\u800c\u540e\u7eed\u7684\u8def\u7531\u5206\u53d1\u5219\u7531 APISIX \u7684\u8def\u7531\u5206\u53d1\u6a21\u5757\u5b8c\u6210\uff0c\u4ee5\u6b64\u5b9e\u73b0\u4e86\u8def\u7531\u7684\u52a8\u6001\u914d\u7f6e\u3002\\n\\n\u4e3a\u4e86\u5b9e\u73b0\u8db3\u591f\u9ad8\u7684\u6027\u80fd\uff0cApache APISIX \u4f7f\u7528 C \u7f16\u5199\u4e86\u57fa\u4e8e\u524d\u7f00\u6811\u7684\u5339\u914d\u8def\u7531\u7b97\u6cd5\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\u4f7f\u7528 LuaJIT \u63d0\u4f9b\u7684 FFI \u7f16\u5199\u4e86\u9002\u7528\u4e8e Lua \u7684\u63a5\u53e3\u3002\u800c Lua \u7684\u7075\u6d3b\u6027\uff0c\u4e5f\u4f7f\u5f97 Apache APISIX \u7684\u8def\u7531\u5206\u53d1\u6a21\u5757\uff0c\u53ef\u4ee5\u8f7b\u6613\u5730\u652f\u6301\u901a\u8fc7\u7279\u5b9a\u7684\u8868\u8fbe\u5f0f\u7b49\u65b9\u6cd5\uff0c\u5bf9\u540c\u4e00\u524d\u7f00\u7684\u4e0b\u7ea7\u8def\u7531\u8fdb\u884c\u5339\u914d\u3002\u6700\u7ec8\u5728\u66ff\u4ee3 NGINX \u539f\u751f\u8def\u7531\u5206\u53d1\u529f\u80fd\u7684\u524d\u63d0\u4e0b\uff0c\u5b9e\u73b0\u4e86\u517c\u5177\u9ad8\u6027\u80fd\u3001\u9ad8\u7075\u6d3b\u6027\u7684\u52a8\u6001\u914d\u7f6e\u529f\u80fd\u3002\u6709\u5173\u8fd9\u90e8\u5206\u529f\u80fd\u7684\u8be6\u7ec6\u5b9e\u73b0\uff0c\u53ef\u4ee5\u67e5\u770b [lua-resty-radixtree](https://github.com/api7/lua-resty-radixtree) \u548c [route.lua](https://github.com/apache/apisix/blob/master/apisix/http/route.lua)\u3002\\n\\n\u53e6\u5916\uff0c\u4e0d\u53ea\u662f\u8def\u7531\uff0c\u4ece\u8d1f\u8f7d\u5747\u8861\u3001\u5065\u5eb7\u68c0\u67e5\uff0c\u5230\u4e0a\u6e38\u8282\u70b9\u914d\u7f6e\u3001\u670d\u52a1\u7aef\u8bc1\u4e66\uff0c\u4ee5\u53ca\u6269\u5c55 APISIX \u80fd\u529b\u7684\u63d2\u4ef6\u672c\u8eab\uff0c\u90fd\u80fd\u5728 APISIX \u4e0d\u91cd\u542f\u7684\u60c5\u51b5\u4e0b\u91cd\u65b0\u52a0\u8f7d\u3002\\n\\n\u540c\u65f6\uff0c\u9664\u4e86\u5728\u4f7f\u7528 LuaJIT \u8fdb\u884c\u63d2\u4ef6\u7b49\u529f\u80fd\u7684\u5f00\u53d1\uff0cApache APISIX \u8fd8\u652f\u6301\u4e86 Java\u3001Go\u3001Node\u3001Python \u4ee5\u53ca WASM \u7b49\u591a\u79cd\u65b9\u5f0f\u5f00\u53d1\u63d2\u4ef6\uff0c\u4e5f\u8ba9 Apache APISIX \u7684\u4e8c\u6b21\u5f00\u53d1\u95e8\u69db\u5927\u5927\u964d\u4f4e\uff0c\u4f7f Apache APISIX \u83b7\u5f97\u4e86\u4e30\u5bcc\u7684\u63d2\u4ef6\u751f\u6001\u548c\u6d3b\u8dc3\u7684\u5f00\u6e90\u793e\u533a\u3002\\n\\n![Apache APISIX \u7684\u63d2\u4ef6\u539f\u7406\u548c\u751f\u6001](https://static.apiseven.com/uploads/2023/02/24/ugg7fXMD_%E4%B8%8B%E8%BD%BD%20%282%29.png)\\n\\n## \u603b\u7ed3\\n\\nLuaJIT \u662f Lua \u7684\u5b9e\u65f6\u7f16\u8bd1\u5668\u5b9e\u73b0\u3002\\n\\nApache APISIX \u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0c\u57fa\u4e8e NGINX \u4e0e LuaJIT \u5e26\u6765\u7684\u9ad8\u6027\u80fd\u3001\u9ad8\u7075\u6d3b\u7b49\u7279\u6027\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\n\u76ee\u524d Apache APISIX \u5df2\u7ecf\u6765\u5230\u4e86\u5168\u65b0\u7684 3.x \u7248\u672c\uff0c\u5e76\u5e26\u6765\u4e86\u66f4\u591a\u7684\u5f00\u6e90\u9879\u76ee\u96c6\u6210\u3001\u4e91\u4f9b\u5e94\u5546\u96c6\u6210\uff0c\u539f\u751f\u7684 gRPC \u652f\u6301\uff0c\u66f4\u591a\u7684\u63d2\u4ef6\u5f00\u53d1\u65b9\u5f0f\u9009\u62e9\uff0c\u4ee5\u53ca\u670d\u52a1\u7f51\u683c\u652f\u6301\u7b49\u529f\u80fd\u3002\u6b22\u8fce\u52a0\u5165 Apache APISIX \u793e\u533a\uff0c\u4e86\u89e3\u66f4\u591a LuaJIT \u5728\u4e91\u539f\u751f API \u7f51\u5173\u4e2d\u7684\u5e94\u7528\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (2.27 - 3.12)","metadata":{"permalink":"/zh/blog/2023/03/16/weekly-report-0316","source":"@site/blog/2023/03/16/weekly-report-0316.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (2.27 - 3.12)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-03-16T00:00:00.000Z","formattedDate":"2023\u5e743\u670816\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.175,"truncated":true,"authors":[],"prevItem":{"title":"\u4ec0\u4e48\u662f LuaJIT\uff1f\u4e3a\u4ec0\u4e48 Apache APISIX \u9009\u62e9\u4e86 LuaJIT\uff1f","permalink":"/zh/blog/2023/03/22/what-is-luajit-and-why-does-apisix-choose-luajit"},"nextItem":{"title":"Apache APISIX 3.2.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2023/03/09/release-apache-apisix-3.2.0"}},"content":"> \u4ece 2023.2.27 - 2023.3.12\uff0c\u6709 29 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 74 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/03/14/0rjys38r_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5-05%E6%9C%9F.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/03/14/WZpcYrG7_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E6%96%B0%E6%99%8B%E6%B5%B7%E6%8A%A5-05%E6%9C%9F.png)\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n### Apache APISIX\\n\\n- [`clickhouse-logger` \u63d2\u4ef6\u6dfb\u52a0\u8bb0\u5f55\u8bf7\u6c42\u4f53\u54cd\u5e94\u4f53\u7279\u6027\u652f\u6301](https://github.com/apache/apisix/pull/8722)\uff08\u8d21\u732e\u8005\uff1a[pixeldin](https://github.com/pixeldin)\uff09\\n\\n- [Cli \u542f\u52a8\u6a21\u5f0f\u6dfb\u52a0\u4ece `APISIX_DEPLOYMENT_ETCD_HOST` \u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6 etcd \u4e3b\u673a\u652f\u6301](https://github.com/apache/apisix/pull/8898)\uff08\u8d21\u732e\u8005\uff1a[An-DJ](https://github.com/An-DJ)\uff09\\n\\n- [\u589e\u52a0 `degraphql` \u63d2\u4ef6\uff0c\u5141\u8bb8\u7528\u6237\u901a\u8fc7\u914d\u7f6e\u5c06\u8bf7\u6c42\u6620\u5c04\u81f3\u56fa\u5b9a\u7684 GraphQL \u67e5\u8be2](https://github.com/apache/apisix/pull/8959)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n### Apache APISIX Ingress Controller\\n\\n- \u4e3a APISIX Ingress \u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\u589e\u52a0 IngressClass \u652f\u6301\uff0c\u5141\u8bb8\u540c\u4e00\u96c6\u7fa4\u4e2d\u540c\u65f6\u90e8\u7f72\u591a\u5957 Ingress controller \u5e76\u4f7f\u7528\u81ea\u5b9a\u4e49\u8d44\u6e90\u3002\u8d21\u732e\u8005\uff1a[AlinsRan](https://github.com/AlinsRan)\uff0c[lingsamuel](https://github.com/lingsamuel)\uff0c[Donghui0](https://github.com/Donghui0)\uff0c\u76f8\u5173 PR\uff1a\\n\\n- [feat: make multiple controllers handle different ApisixRoute CRDs](https://github.com/apache/apisix-ingress-controller/pull/593)\\n- [feat: ApisixUpstream support IngressClass](https://github.com/apache/apisix-ingress-controller/pull/1674)\\n- [feat: ApisixTls suuport ingressClass](https://github.com/apache/apisix-ingress-controller/pull/1714)\\n- [feat: support ingressClass for ApisixPluginConfig](https://github.com/apache/apisix-ingress-controller/pull/1716)\\n- [feat: ApisixConsumer support ingressClass](https://github.com/apache/apisix-ingress-controller/pull/1717)\\n- [feat: support ingressClass for ApisixGlobalRule](https://github.com/apache/apisix-ingress-controller/pull/1718)\\n- [feat: ApisixClusterConfig support IngressClass](https://github.com/apache/apisix-ingress-controller/pull/1720)\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"Apache APISIX 3.2.0 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2023/03/09/release-apache-apisix-3.2.0","source":"@site/blog/2023/03/09/release-apache-apisix-3.2.0.md","title":"Apache APISIX 3.2.0 \u6b63\u5f0f\u53d1\u5e03","description":"APISIX 3.2.0 \u662f 3.0 \u5927\u7248\u672c\u4ee5\u6765\u7684\u7b2c\u4e00\u4e2a LTS \u7248\u672c\u3002\u6b64\u6b21\u53d1\u7248\uff0c\u662f 3.x \u65f6\u4ee3\u66f4\u66ff 2.x \u65f6\u4ee3\u7684\u4e00\u5927\u91cc\u7a0b\u7891\u3002\u4ece\u6b64\u4e4b\u540e\uff0c\u65b0\u7684\u4e00\u7cfb\u5217 patch \u7248\u672c\u5c06\u4f1a\u5728 3.2 \u7684\u57fa\u7840\u4e0a\u53d1\u5e03\u3002\u672c\u6b21\u53d1\u5e03\u4e00\u5982\u5f80\u5e38\u4e00\u6837\u5e26\u6765\u4e86\u8bb8\u591a\u65b0\u7684\u63d2\u4ef6\u548c\u7279\u6027\uff0c\u4e3a APISIX \u7684\u4f7f\u7528\u8005\u5e26\u6765\u4e0d\u4e00\u6837\u7684\u65b0\u73a9\u6cd5\u3002","date":"2023-03-09T00:00:00.000Z","formattedDate":"2023\u5e743\u67089\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":5.725,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","title":"Author","url":"https://github.com/spacewander","image_url":"https://github.com/spacewander.png","imageURL":"https://github.com/spacewander.png"},{"name":"Yilialinn","title":"Technical Writer","url":"https://github.com/Yilialinn","image_url":"https://avatars.githubusercontent.com/u/114121331?v=4","imageURL":"https://avatars.githubusercontent.com/u/114121331?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (2.27 - 3.12)","permalink":"/zh/blog/2023/03/16/weekly-report-0316"},"nextItem":{"title":"\u5fae\u670d\u52a1\u4e3a\u4ec0\u4e48\u8981\u7528\u5230 API \u7f51\u5173\uff1f","permalink":"/zh/blog/2023/03/08/why-do-microservices-need-an-api-gateway"}},"content":"> APISIX 3.2.0 \u662f 3.0 \u5927\u7248\u672c\u4ee5\u6765\u7684\u7b2c\u4e00\u4e2a LTS \u7248\u672c\u3002\u6b64\u6b21\u53d1\u7248\uff0c\u662f 3.x \u65f6\u4ee3\u66f4\u66ff 2.x \u65f6\u4ee3\u7684\u4e00\u5927\u91cc\u7a0b\u7891\u3002\u4ece\u6b64\u4e4b\u540e\uff0c\u65b0\u7684\u4e00\u7cfb\u5217 patch \u7248\u672c\u5c06\u4f1a\u5728 3.2 \u7684\u57fa\u7840\u4e0a\u53d1\u5e03\u3002\u672c\u6b21\u53d1\u5e03\u4e00\u5982\u5f80\u5e38\u4e00\u6837\u5e26\u6765\u4e86\u8bb8\u591a\u65b0\u7684\u63d2\u4ef6\u548c\u7279\u6027\uff0c\u4e3a APISIX \u7684\u4f7f\u7528\u8005\u5e26\u6765\u4e0d\u4e00\u6837\u7684\u65b0\u73a9\u6cd5\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u65b0\u7279\u6027\uff1a\u56db\u5c42\u4e0a\u7684\u670d\u52a1\u53d1\u73b0\\n\\n\u53ea\u6709\u5c11\u6570\u7f51\u5173\u652f\u6301\u670d\u52a1\u53d1\u73b0\uff0cAPISIX \u5c31\u662f\u5176\u4e2d\u4e4b\u4e00\u3002\u5728 3.2.0 \u7248\u672c\u4e2d\uff0cAPISIX \u628a\u539f\u6765\u4e03\u5c42\u4e0a\u7684\u670d\u52a1\u53d1\u73b0\u7684\u529f\u80fd\u4e5f\u505a\u5230\u4e86\u56db\u5c42\u4e0a\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5c06 APISIX \u4f5c\u4e3a TCP/UDP \u4ee3\u7406\u65f6\u4e5f\u80fd\u4eab\u53d7\u5230\u670d\u52a1\u53d1\u73b0\u5e26\u6765\u7684\u4fbf\u5229\u6027\u3002\u548c\u5728\u4e03\u5c42\u4e0a\u7684\u670d\u52a1\u53d1\u73b0\u4e00\u6837\uff0c\u8981\u60f3\u7528\u4e0a\u670d\u52a1\u53d1\u73b0\uff0c\u6211\u4eec\u9700\u8981\u5148\u5728 `config.yaml` \u4e2d\u914d\u7f6e\u670d\u52a1\u53d1\u73b0\u670d\u52a1\u5668\u7684\u5730\u5740\uff1a\\n\\n```yaml\\ndiscovery:\\n  nacos:\\n    host:\\n      - \\"http://192.168.33.1:8848\\"\\n```\\n\\n\u7136\u540e\u5728\u5177\u4f53\u7684 upstream \u4e0a\u914d\u7f6e `discovery_type` \u548c `service_name`\uff1a\\n\\n```shell\\n$ curl http://127.0.0.1:9180/apisix/admin/stream_routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n{\\n    \\"remote_addr\\": \\"127.0.0.1\\",\\n    \\"upstream\\": {\\n        \\"scheme\\": \\"tcp\\",\\n        \\"discovery_type\\": \\"nacos\\",\\n        \\"service_name\\": \\"APISIX-NACOS\\",\\n        \\"type\\": \\"roundrobin\\"\\n    }\\n}\'\\n```\\n\\n\u8fd9\u6837\u8bbf\u95ee stream_routes \u65f6\uff0c\u4e0a\u6e38\u7684\u8282\u70b9\u4f1a\u4ece Nacos \u7684 APISIX-NACOS \u670d\u52a1\u4e2d\u83b7\u53d6\u3002\\n\\n## \u65b0\u63d2\u4ef6\uff1aRESTful \u8bf7\u6c42\u8f6c GraphQL\\n\\n\u5728 3.2 \u7248\u672c\u4e2d\uff0cAPISIX \u65b0\u589e\u4e86\u4e00\u4e2a\u80fd\u5c06 RESTful \u8bf7\u6c42\u8f6c\u6210 GraphQL \u7684\u63d2\u4ef6\u3002\u5047\u5982\u4f60\u6709\u8fd9\u6837\u7684 GraphQL \u67e5\u8be2\u8bed\u53e5\uff1a\\n\\n```\\nquery($name: String!, $githubAccount: String!) {\\n  persons(filter: { name: $name, githubAccount: $githubAccount }) {\\n    id\\n    name\\n    blog\\n    githubAccount\\n    talks {\\n      id\\n      title\\n    }\\n  }\\n}\\n```\\n\\n\u5176\u4e2d `$name` \u548c `$githubAccount` \u662f\u4e24\u4e2a GraphQL \u53d8\u91cf\u3002\\n\\n\u6211\u4eec\u53ef\u4ee5\u7528\u5982\u4e0b\u7684\u914d\u7f6e\u6765\u66b4\u9732\u51fa\u540c\u6837\u7684 RESTful \u63a5\u53e3\uff1a\\n\\n```shell\\ncurl --location --request PUT \'http://localhost:9180/apisix/admin/routes/1\' \\\\\\n--header \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n--header \'Content-Type: application/json\' \\\\\\n--data-raw \'{\\n    \\"uri\\": \\"/graphql\\",\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:8080\\": 1\\n        }\\n    },\\n    \\"plugins\\": {\\n        \\"degraphql\\": {\\n            \\"query\\": \\"query($name: String!, $githubAccount: String!) {\\\\n  persons(filter: { name: $name, githubAccount: $githubAccount }) {\\\\n    id\\\\n    name\\\\n    blog\\\\n    githubAccount\\\\n    talks {\\\\n      id\\\\n      title\\\\n    }\\\\n  }\\\\n}\\",\\n            \\"variables\\": [\\n                \\"name\\",\\n                \\"githubAccount\\"\\n            ]\\n        }\\n    }\\n}\'\\n```\\n\\n\u8fd9\u91cc `query` \u662f\u6211\u4eec\u8981\u7528\u5230\u7684\u67e5\u8be2\u8bed\u53e5\uff0c`variables` \u662f\u4e8b\u5148\u58f0\u660e\u7684\u53d8\u91cf\u5217\u8868\u3002\\n\\n\u63a5\u4e0b\u6765\u5c31\u80fd\u50cf RESTful \u63a5\u53e3\u4e00\u6837\u8bbf\u95ee\u5b83\uff1a\\n\\n```shell\\ncurl --location --request POST \'http://localhost:9080/graphql\' \\\\\\n--header \'Content-Type: application/json\' \\\\\\n--data-raw \'{\\n    \\"name\\": \\"Niek\\",\\n    \\"githubAccount\\": \\"npalm\\"\\n}\'\\n```\\n\\n\u7ed3\u679c\u8ddf\u76f4\u63a5\u7528\u5bf9\u5e94\u7684 GraphQL \u8bed\u53e5\u8bbf\u95ee\u4e0a\u6e38\u662f\u4e00\u6837\u7684\uff1a\\n\\n```json\\n{\\n  \\"data\\": {\\n    \\"persons\\": [\\n      {\\n        \\"id\\": \\"7\\",\\n        \\"name\\": \\"Niek\\",\\n        \\"blog\\": \\"https://040code.github.io\\",\\n        \\"githubAccount\\": \\"npalm\\",\\n        \\"talks\\": [\\n          {\\n            \\"id\\": \\"19\\",\\n            \\"title\\": \\"GraphQL - The Next API Language\\"\\n          },\\n          {\\n            \\"id\\": \\"20\\",\\n            \\"title\\": \\"Immutable Infrastructure\\"\\n          }\\n        ]\\n      }\\n    ]\\n  }\\n}\\n```\\n\\n\u4f60\u540c\u6837\u80fd\u7528 GET \u8bf7\u6c42\u6765\u8bbf\u95ee\u540c\u6837\u7684\u63a5\u53e3\uff0c\u8fd9\u65f6\u5019\u53c2\u6570\u5c31\u9700\u8981\u901a\u8fc7 query string \u6765\u4f20\u9012\uff1a\\n\\n```\\ncurl \'http://localhost:9080/graphql?name=Niek&githubAccount=npalm\'\\n```\\n\\n## \u65b0\u7279\u6027\uff1a\u652f\u6301\u5728\u6bcf\u4e2a\u65e5\u5fd7\u63d2\u4ef6\u4e0a\u8bbe\u7f6e\u65e5\u5fd7\u683c\u5f0f\\n\\n\u5728 3.2 \u7248\u672c\uff0c\u6211\u4eec\u6574\u7406\u4e86 APISIX \u73b0\u6709\u7684\u5341\u591a\u4e2a access \u65e5\u5fd7\u63d2\u4ef6\u3002\u73b0\u5728\u6bcf\u4e2a\u63d2\u4ef6\u90fd\u652f\u6301\u914d\u7f6e\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f\uff1a\\n\\n1. \u5728\u8be5\u63d2\u4ef6\u7684 plugin metadata \u4e2d\u5b9a\u4e49\u5168\u5c40\u7684\u65e5\u5fd7\u683c\u5f0f\\n2. \u5728\u5177\u4f53\u7684\u8def\u7531\u89c4\u5219\u4e0a\u7684\u8be5\u63d2\u4ef6\u7684\u914d\u7f6e\u4e2d\u5b9a\u4e49\u5f53\u524d\u8def\u7531\u7684\u65e5\u5fd7\u683c\u5f0f\\n\\n\u4ee5 `clickhouse-logger` \u4e3a\u4f8b\uff0c\u4e0b\u9762\u662f\u5b9a\u4e49\u5168\u5c40\u65e5\u5fd7\u683c\u5f0f\u7684\u505a\u6cd5\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/plugin_metadata/clickhouse-logger \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"log_format\\": {\\n        \\"host\\": \\"$host\\",\\n        \\"@timestamp\\": \\"$time_iso8601\\",\\n        \\"client_ip\\": \\"$remote_addr\\"\\n    }\\n}\'\\n```\\n\\n\u4e0b\u9762\u5219\u662f\u5f53\u524d\u8def\u7531\u7684\u65e5\u5fd7\u683c\u5f0f\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n      \\"plugins\\": {\\n            \\"clickhouse-logger\\": {\\n                \\"log_format\\": {\\n                    \\"host\\": \\"$host\\",\\n                    \\"@timestamp\\": \\"$time_iso8601\\",\\n                    \\"client_ip\\": \\"$remote_addr\\"\\n                },\\n                \\"user\\": \\"default\\",\\n                \\"password\\": \\"a\\",\\n                \\"database\\": \\"default\\",\\n                \\"logtable\\": \\"test\\",\\n                \\"endpoint_addrs\\": [\\"http://127.0.0.1:8123\\"]\\n            }\\n       },\\n      \\"upstream\\": {\\n           \\"type\\": \\"roundrobin\\",\\n           \\"nodes\\": {\\n               \\"127.0.0.1:1980\\": 1\\n           }\\n      },\\n      \\"uri\\": \\"/hello\\"\\n}\'\\n\\n```\\n\\n## \u65b0\u63d2\u4ef6\uff1a\u8bf7\u6c42\u4f53/\u54cd\u5e94\u4f53\u8f6c\u6362\\n\\n\u4f60\u662f\u5426\u5728\u4e3a\u5982\u4f55\u628a\u8fd4\u56de XML \u7684\u53e4\u65e9\u4e0a\u6e38\u670d\u52a1\u4ecb\u7ecd\u7ed9\u53ea\u63a5\u53d7 JSON \u7684\u73b0\u4ee3\u5ba2\u6237\u7aef\u800c\u82e6\u607c\uff1f3.2.0 \u7248\u672c\u65b0\u589e\u7684 `body-transformer` \u63d2\u4ef6\u5f00\u6e90\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\\n\\n`body-transformer` \u63d2\u4ef6\u652f\u6301 JSON \u548c XML \u4e4b\u95f4\u7684\u4e92\u76f8\u8f6c\u6362\u3002\u4e0d\u8fc7\u8fd9\u5e76\u975e\u662f\u5b83\u552f\u4e00\u80fd\u505a\u7684\u4e8b\u3002\u5b83\u8fd8\u652f\u6301\u901a\u8fc7\u6a21\u677f\u914d\u7f6e\u8f93\u5165\u8f93\u51fa\u7684\u5185\u5bb9\u7684\u5177\u4f53\u683c\u5f0f\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\\n\\n\u5047\u8bbe\u4f60\u6709\u4e0b\u9762\u7684 JSON \u6a21\u677f\uff1a`{\\"foo\\":\\"{{name .. \\" world\\"}}\\",\\"bar\\":{{age+10}}}`\uff0c\u5e76\u628a\u5b83\u914d\u7f6e\u5230 `body-transformer` \u63d2\u4ef6\u7684 `request.template` \u5b57\u6bb5\u4e2d\uff1a\\n\\n```\\n      ...\\n      \\"body-transformer\\": {\\n          \\"request\\": {\\n              \\"template\\": \\"...\\"\\n          }\\n      }\\n      ...\\n```\\n\\n\u90a3\u4e48\u5f53\u8bf7\u6c42\u5185\u5bb9\u4e3a `{\\"name\\":\\"hello\\",\\"age\\":20}`\uff0c\u53d1\u9001\u7ed9\u4e0a\u6e38\u7684\u662f\u6539\u5199\u4e4b\u540e\u7684 `{\\"foo\\":\\"hello world\\",\\"bar\\":30}`\u3002\u6211\u4eec\u91c7\u7528\u4e86 `lua-resty-template` \u6765\u6e32\u67d3\u6a21\u677f\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u5728\u6a21\u677f\u4e2d\u5d4c\u5165 Lua \u8868\u8fbe\u5f0f\u6765\u5b9e\u73b0\u6539\u5199\u903b\u8f91\u3002\\n\\n\u5bf9\u4e0a\u6e38\u8f93\u51fa\u7684\u6539\u5199\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u53ea\u662f\u9700\u8981\u914d\u7f6e\u7684\u662f\u63d2\u4ef6\u7684 `response.template` \u5b57\u6bb5\u3002\\n\\n## \u65b0\u529f\u80fd\uff1a\u4f18\u5316\u548c\u66f4\u591a\u7684\u5c0f\u529f\u80fd\\n\\n\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u51e0\u4e2a\u5927\u7684\u529f\u80fd\u5916\uff0c\u6b64\u6b21\u53d1\u5e03\u4e5f\u5305\u542b\u8bb8\u591a\u503c\u5f97\u8ff0\u8bf4\u7684\u6539\u52a8\uff1a\\n\\n* `error-log-logger` \u63d2\u4ef6\u652f\u6301\u53d1\u9001\u9519\u8bef\u65e5\u5fd7\u5230 Kafka\\n* `limit-count` \u63d2\u4ef6\u652f\u6301\u8fd4\u56de `X-RateLimit-Reset` \u54cd\u5e94\u5934\\n\\n\u7b49\u7b49\u3002\\n\\n\u5982\u679c\u4f60\u5bf9\u5b8c\u6574\u7684\u5185\u5bb9\u611f\u5174\u8da3\uff0c\u8bf7\u53c2\u8003 3.2 \u53d1\u5e03\u7684 CHANGELOG\uff1a[https://github.com/apache/apisix/blob/release/3.2/docs/zh/latest/CHANGELOG.md#320](https://github.com/apache/apisix/blob/release/3.2/docs/zh/latest/CHANGELOG.md#320)"},{"id":"\u5fae\u670d\u52a1\u4e3a\u4ec0\u4e48\u8981\u7528\u5230 API \u7f51\u5173\uff1f","metadata":{"permalink":"/zh/blog/2023/03/08/why-do-microservices-need-an-api-gateway","source":"@site/blog/2023/03/08/why-do-microservices-need-an-api-gateway.md","title":"\u5fae\u670d\u52a1\u4e3a\u4ec0\u4e48\u8981\u7528\u5230 API \u7f51\u5173\uff1f","description":"\u968f\u7740\u5fae\u670d\u52a1\u7684\u6570\u636e\u8d8a\u6765\u8d8a\u591a\uff0cAPI \u7684\u6570\u91cf\u4e5f\u8d8a\u6765\u8d8a\u591a\uff0c\u5bf9\u4e8e\u5927\u6d41\u91cf\u7684\u6cbb\u7406\uff0c\u9009\u62e9\u4e00\u4e2a\u4f18\u79c0\u7684 API \u7f51\u5173\u662f\u81f3\u5173\u91cd\u8981\u7684\u3002\u672c\u6587\u5217\u4e3e\u4e86\u5e38\u89c1\u7f51\u5173\uff0c\u5e76\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5217\u51fa\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\uff0c\u5982\u679c\u4f60\u6b63\u5728\u505a API \u7f51\u5173\u7684\u6280\u672f\u9009\u578b\uff0c\u6216\u8005\u4f60\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\u51fa\u73b0\u4e86\u6027\u80fd\u95ee\u9898\uff0c\u518d\u6216\u8005\u4f60\u60f3\u642d\u5efa\u4e00\u4e2a\u9ad8\u6548\u7a33\u5b9a\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\uff0c\u5e0c\u671b\u672c\u6587\u53ef\u4ee5\u5e26\u7ed9\u4f60\u4e00\u5b9a\u7684\u542f\u53d1\u3002","date":"2023-03-08T00:00:00.000Z","formattedDate":"2023\u5e743\u67088\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":15.145,"truncated":true,"authors":[{"name":"\u7a0b\u5c0f\u5170","title":"Author","url":"https://github.com/Hazel6869","image_url":"https://github.com/Hazel6869.png","imageURL":"https://github.com/Hazel6869.png"}],"prevItem":{"title":"Apache APISIX 3.2.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2023/03/09/release-apache-apisix-3.2.0"},"nextItem":{"title":"\u4ece 1 \u79d2\u5230 10 \u6beb\u79d2\uff01\u5728 APISIX \u4e2d\u51cf\u5c11 Prometheus \u8bf7\u6c42\u963b\u585e","permalink":"/zh/blog/2023/03/06/the-mystery-of-prometheus-plugins-and-long-tail-requests"}},"content":"> \u968f\u7740\u5fae\u670d\u52a1\u7684\u6570\u636e\u8d8a\u6765\u8d8a\u591a\uff0cAPI \u7684\u6570\u91cf\u4e5f\u8d8a\u6765\u8d8a\u591a\uff0c\u5bf9\u4e8e\u5927\u6d41\u91cf\u7684\u6cbb\u7406\uff0c\u9009\u62e9\u4e00\u4e2a\u4f18\u79c0\u7684 API \u7f51\u5173\u662f\u81f3\u5173\u91cd\u8981\u7684\u3002\u672c\u6587\u5217\u4e3e\u4e86\u5e38\u89c1\u7f51\u5173\uff0c\u5e76\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5217\u51fa\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\uff0c\u5982\u679c\u4f60\u6b63\u5728\u505a API \u7f51\u5173\u7684\u6280\u672f\u9009\u578b\uff0c\u6216\u8005\u4f60\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\u51fa\u73b0\u4e86\u6027\u80fd\u95ee\u9898\uff0c\u518d\u6216\u8005\u4f60\u60f3\u642d\u5efa\u4e00\u4e2a\u9ad8\u6548\u7a33\u5b9a\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\uff0c\u5e0c\u671b\u672c\u6587\u53ef\u4ee5\u5e26\u7ed9\u4f60\u4e00\u5b9a\u7684\u542f\u53d1\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u7a0b\u5c0f\u5170](https://github.com/Hazel6869)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\uff0cApache APISIX Contributor\u3002\\n\\n## \u4ec0\u4e48\u662f\u5fae\u670d\u52a1\\n\\n\u5fae\u670d\u52a1\u67b6\u6784\uff08\u901a\u5e38\u7b80\u79f0\u4e3a\u5fae\u670d\u52a1\uff09\u662f\u6307\u5f00\u53d1\u5e94\u7528\u6240\u7528\u7684\u4e00\u79cd\u67b6\u6784\u5f62\u5f0f\u3002\u901a\u8fc7\u5fae\u670d\u52a1\uff0c\u53ef\u5c06\u5927\u578b\u5e94\u7528\u5206\u89e3\u6210\u591a\u4e2a\u72ec\u7acb\u7684\u7ec4\u4ef6\uff0c\u5176\u4e2d\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u6709\u5404\u81ea\u7684\u8d23\u4efb\u9886\u57df\u3002\u5728\u5904\u7406\u4e00\u4e2a\u7528\u6237\u8bf7\u6c42\u65f6\uff0c\u57fa\u4e8e\u5fae\u670d\u52a1\u7684\u5e94\u7528\u53ef\u80fd\u4f1a\u8c03\u7528\u8bb8\u591a\u5185\u90e8\u5fae\u670d\u52a1\u6765\u5171\u540c\u751f\u6210\u5176\u54cd\u5e94\u3002\u5fae\u670d\u52a1\u662f\u4e92\u8054\u7f51\u4e1a\u52a1\u53d1\u5c55\u7684\u7ed3\u679c\uff0c\u4e92\u8054\u7f51\u4e1a\u52a1\u7684\u98de\u901f\u53d1\u5c55\u5bfc\u81f4\u7cfb\u7edf\u7684\u67b6\u6784\u4e5f\u5728\u4e0d\u65ad\u5730\u53d1\u751f\u53d8\u5316\uff0c\u603b\u4f53\u6765\u8bf4\uff0c\u7cfb\u7edf\u7684\u67b6\u6784\u5927\u81f4\u7ecf\u5386\u4e86\uff1a\u5355\u4f53\u5e94\u7528\u67b6\u6784\u2014> SOA \u67b6\u6784\u2014>\u5fae\u670d\u52a1\u67b6\u6784\u7684\u6f14\u53d8\uff0c\u5177\u4f53\u53d1\u5c55\u5386\u7a0b\u548c\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\u5982\u4e0b\u8868\u6240\u793a\u3002\\n\\n| \u67b6\u6784\u7c7b\u578b | \u7b80\u4ecb                                                                                                                      | \u4f18\u70b9                                                                                                                                                                      | \u7f3a\u70b9                                                                                                         |\\n|----|-------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|\\n| \u5355\u4f53\u5e94\u7528\u67b6\u6784   |    \u5c06\u6240\u6709\u7684\u529f\u80fd\u4ee3\u7801\u6253\u5305\u6210\u4e00\u4e2a\u670d\u52a1\u3002                                                                                                                     | 1. \u67b6\u6784\u7b80\u5355\uff0c\u9879\u76ee\u5f00\u53d1\u548c\u7ef4\u62a4\u6210\u672c\u4f4e\u3002                                                                                                                                                     | \u6240\u6709\u6a21\u5757\u8026\u5408\u5728\u4e00\u8d77\uff0c\u6bd4\u8f83\u6709\u5229\u4e8e\u5c0f\u578b\u9879\u76ee\u7684\u5f00\u53d1\u548c\u7ef4\u62a4\uff1b\u4f46\u662f\uff0c\u5bf9\u4e8e\u5927\u578b\u9879\u76ee\u6765\u8bf4\u5374\u5b58\u5728\u95ee\u9898\uff0c\u6bd4\u5982\uff1a<br/> 1. \u9879\u76ee\u5404\u6a21\u5757\u4e4b\u95f4\u8fc7\u4e8e\u8026\u5408\uff0c\u4e00\u4e2a\u6a21\u5757\u7684\u6027\u80fd\u95ee\u9898\u53ef\u80fd\u5bfc\u81f4\u6574\u4e2a\u9879\u76ee\u7684\u4e0d\u53ef\u7528\uff1b<br/> 2. \u9879\u76ee\u7684\u6269\u5c55\u6027\u5dee\u3002 |\\n|    SOA \u67b6\u6784      |   \u4e2d\u6587\u610f\u601d\u4e3a \u201c\u9762\u5411\u670d\u52a1\u7684\u67b6\u6784\u201d\uff0c\u901a\u5e38\u5305\u542b\u591a\u4e2a\u670d\u52a1\uff0c<br/>\u4e00\u4e2a\u670d\u52a1\u901a\u5e38\u4ee5\u72ec\u7acb\u7684\u5f62\u5f0f\u5b58\u5728\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u7a0b\u4e2d\uff0c\u670d\u52a1\u4e4b\u95f4\u901a\u8fc7\u76f8\u4e92\u4f9d\u8d56\u6216\u8005\u901a\u8fc7\u901a\u4fe1\u673a\u5236\u6765\u5b8c\u6210\u901a\u4fe1\u7684\uff0c<br/>\u6700\u7ec8\u63d0\u4f9b\u4e00\u7cfb\u5217\u7684\u529f\u80fd\u3002                                                                                                                                      | 1. \u7cfb\u7edf\u96c6\u6210\uff1a\u7ad9\u5728\u7cfb\u7edf\u7684\u89d2\u5ea6\uff0c\u89e3\u51b3\u4f01\u4e1a\u7cfb\u7edf\u95f4\u7684\u901a\u4fe1\u95ee\u9898\uff0c\u628a\u539f\u5148\u6563\u4e71\u3001\u65e0\u89c4\u5212\u7684\u7cfb\u7edf\u95f4\u7684\u7f51\u72b6\u7ed3\u6784\uff0c\u68b3\u7406\u6210\u89c4\u6574\u3001\u53ef\u6cbb\u7406\u7684\u7cfb\u7edf\u95f4\u661f\u5f62\u7ed3\u6784\uff1b<br/> 2. \u7cfb\u7edf\u7684\u670d\u52a1\u5316\uff1a\u7ad9\u5728\u529f\u80fd\u7684\u89d2\u5ea6\uff0c\u628a\u4e1a\u52a1\u903b\u8f91\u62bd\u8c61\u6210\u53ef\u590d\u7528\u3001\u53ef\u7ec4\u88c5\u7684\u670d\u52a1\uff0c\u901a\u8fc7\u670d\u52a1\u7684\u7f16\u6392\u5b9e\u73b0\u4e1a\u52a1\u7684\u5feb\u901f\u518d<br/> 3. \u4e1a\u52a1\u7684\u670d\u52a1\u5316\uff1a\u7ad9\u5728\u4f01\u4e1a\u7684\u89d2\u5ea6\uff0c\u628a\u4f01\u4e1a\u804c\u80fd\u62bd\u8c61\u6210\u53ef\u590d\u7528\u3001\u53ef\u7ec4\u88c5\u7684\u670d\u52a1\u3002 | 1. \u670d\u52a1\u7684\u4e2d\u5fc3\u5316\uff0c\u5404\u670d\u52a1\u4e4b\u95f4\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\uff0c\u5982\u679c\u67d0\u4e2a\u670d\u52a1\u51fa\u73b0\u6545\u969c\u53ef\u80fd\u4f1a\u9020\u6210\u670d\u52a1\u7684\u96ea\u5d29\uff1b<br/> 2. \u670d\u52a1\u4e4b\u95f4\u7684\u4f9d\u8d56\u4e0e\u8c03\u7528\u5173\u7cfb\u590d\u6742\uff0c\u6d4b\u8bd5\u90e8\u7f72\u7684\u56f0\u96be\u6bd4\u8f83\u5927\u3002                             |\\n|      \u5fae\u670d\u52a1\u67b6\u6784          |     \u5fae\u670d\u52a1\u662f\u5728 SOA \u4e0a\u505a\u7684\u5347\u534e\u3002\u5fae\u670d\u52a1\u67b6\u6784\u91cd\u70b9\u5f3a\u8c03\u7684\u4e00\u4e2a\u662f\\"\u4e1a\u52a1\u9700\u8981\u5f7b\u5e95\u7684\u7ec4\u4ef6\u5316\u548c\u670d\u52a1\u5316\\"\uff0c<br/>\u539f\u6709\u7684\u5355\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u4f1a\u62c6\u5206\u4e3a\u591a\u4e2a\u53ef\u4ee5\u72ec\u7acb\u5f00\u53d1\u3001\u8bbe\u8ba1\u3001<br/>\u8fd0\u884c\u7684\u5c0f\u5e94\u7528\u3002\u5404\u4e2a\u5c0f\u5e94\u7528\u4e4b\u95f4\uff0c\u76f8\u4e92\u53bb\u534f\u4f5c\u901a\u4fe1\uff0c\u6765\u5b8c\u6210\u4e00\u4e2a\u4ea4\u4e92\u548c\u96c6\u6210\uff0c\u8fd9\u5c31\u662f\u5fae\u670d\u52a1\u67b6\u6784\u3002                                                                                                                                                                                                                        | 1. \u53bb\u4e2d\u5fc3\u5316\uff1b<br/> 2. \u901a\u8fc7\u670d\u52a1\u5b9e\u73b0\u7ec4\u4ef6\u5316\uff1b<br/> 3. \u6309\u4e1a\u52a1\u80fd\u529b\u6765\u5212\u5206\u670d\u52a1\u548c\u5f00\u53d1\u56e2\u961f\uff1b<br/> 4. \u57fa\u7840\u8bbe\u65bd\u81ea\u52a8\u5316\uff08 Devops\u3001\u81ea\u52a8\u5316\u90e8\u7f72\uff09\u3002                                                                                    | 1. \u5f00\u53d1\u7684\u6210\u672c\u6bd4\u8f83\u9ad8\uff1b<br/> 2. \u4f1a\u5f15\u53d1\u670d\u52a1\u7684\u5bb9\u9519\u6027\u95ee\u9898\uff1b<br/> 3. \u4f1a\u5f15\u53d1\u6570\u636e\u7684\u4e00\u81f4\u6027\u95ee\u9898\uff1b<br/> 4. \u4f1a\u6d89\u53ca\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002                                        |\\n\\n\u56e0\u6b64\uff0c\u5fae\u670d\u52a1\u662f\u4e92\u8054\u7f51\u53d1\u5c55\u7684\u5fc5\u7136\u7ed3\u679c\uff0c\u5f88\u591a\u4f20\u7edf\u516c\u53f8\u7684\u7cfb\u7edf\u67b6\u6784\u4e5f\u5728\u9010\u6b65\u5fae\u670d\u52a1\u5316\u3002\u4f46\u662f\uff0c\u968f\u7740\u4e92\u8054\u7f51\u4e1a\u52a1\u7684\u53d1\u5c55\uff0cAPI \u7684\u6570\u91cf\u4e5f\u5728\u5267\u589e\uff0c\u4f7f\u7528\u7f51\u5173\u5bf9API\u7edf\u4e00\u7ba1\u7406\u4e5f\u5c06\u9762\u4e34\u6311\u6218\uff0c\u9009\u62e9\u4e00\u4e2a\u66f4\u5f3a\u5927\u7684 API \u7f51\u5173\uff0c\u53ef\u4ee5\u6709\u6548\u5730\u589e\u5f3a\u7cfb\u7edf\u7684\u76d1\u63a7\u3001\u5bb9\u707e\u3001\u9274\u6743\u548c\u9650\u6d41\u7b49\u80fd\u529b\u3002\\n\\n## \u4ec0\u4e48\u662f API \u7f51\u5173\\n\\nAPI \u7f51\u5173\u4e3a\u5ba2\u6237\u4e0e\u670d\u52a1\u7cfb\u7edf\u4e4b\u95f4\u7684\u4ea4\u4e92\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u4e5f\u662f\u7ba1\u7406\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u4e2d\u5fc3\u70b9\uff0c\u9009\u62e9\u4e00\u4e2a\u9002\u5408\u7684 API \u7f51\u5173\uff0c\u53ef\u4ee5\u6709\u6548\u5730\u7b80\u5316\u5f00\u53d1\u5e76\u63d0\u9ad8\u7cfb\u7edf\u7684\u8fd0\u7ef4\u4e0e\u7ba1\u7406\u6548\u7387\u3002\\nAPI \u7f51\u5173\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u662f\u7cfb\u7edf\u8bbe\u8ba1\u7684\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\uff0c\u7528\u6765\u6574\u5408\u5404\u4e2a\u4e0d\u540c\u6a21\u5757\u7684\u5fae\u670d\u52a1\uff0c\u7edf\u4e00\u534f\u8c03\u670d\u52a1\u3002API \u7f51\u5173\u4f5c\u4e3a\u4e00\u4e2a\u7cfb\u7edf\u8bbf\u95ee\u7684\u5207\u9762\uff0c\u5bf9\u5916\u63d0\u4f9b\u7edf\u4e00\u7684\u5165\u53e3\u4f9b\u5ba2\u6237\u7aef\u8bbf\u95ee\uff0c\u9690\u85cf\u7cfb\u7edf\u67b6\u6784\u5b9e\u73b0\u7684\u7ec6\u8282\uff0c\u8ba9\u5fae\u670d\u52a1\u4f7f\u7528\u66f4\u4e3a\u53cb\u597d\uff1b\u5e76\u96c6\u6210\u4e86\u4e00\u4e9b\u901a\u7528\u7279\u6027\uff08\u5982\u9274\u6743\u3001\u9650\u6d41\u3001\u7194\u65ad\uff09\uff0c\u907f\u514d\u6bcf\u4e2a\u5fae\u670d\u52a1\u5355\u72ec\u5f00\u53d1\uff0c\u63d0\u5347\u6548\u7387\uff0c\u4f7f\u7cfb\u7edf\u66f4\u52a0\u6807\u51c6\u5316\uff0c\u6bd4\u5982\u8eab\u4efd\u9a8c\u8bc1\u3001\u76d1\u63a7\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u9650\u6d41\u3001\u964d\u7ea7\u4e0e\u5e94\u7528\u68c0\u6d4b\u7b49\u529f\u80fd\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u5fae\u670d\u52a1\u9700\u8981 API \u7f51\u5173\\n\\n![Architecture Diagram](https://static.apiseven.com/uploads/2023/01/30/dSfRMQcD_%E5%9B%BE1.png)\\n\\n\u5982\u4e0a\u56fe\u6240\u793a\uff0cAPI \u7f51\u5173\u4f5c\u4e3a\u5ba2\u6237\u7aef\u548c\u5fae\u670d\u52a1\u7684\u4e2d\u95f4\u5c42\uff0c\u5b83\u53ef\u4ee5\u5c06\u5fae\u670d\u52a1\u4ee5\u7edf\u4e00\u7684\u5730\u5740\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u5c06\u5916\u90e8\u8bbf\u95ee\u8fd9\u4e2a\u5730\u5740\u7684\u6d41\u91cf\uff0c\u6839\u636e\u9002\u5f53\u7684\u89c4\u5219\u8def\u7531\u5230\u5185\u90e8\u96c6\u7fa4\u4e2d\u6b63\u786e\u7684\u670d\u52a1\u8282\u70b9\u4e4b\u4e0a\uff0c\u5982\u679c\u6ca1\u6709 API \u7f51\u5173\uff0c\u6d41\u91cf\u7684\u51fa\u5165\u53e3\u5219\u4e0d\u7edf\u4e00\uff0c\u5ba2\u6237\u7aef\u5c31\u9700\u8981\u77e5\u9053\u6240\u6709\u670d\u52a1\u7684\u8bbf\u95ee\u4fe1\u606f\uff0c\u5fae\u670d\u52a1\u7684\u610f\u4e49\u5c06\u4e0d\u590d\u5b58\u5728\uff0c\u6240\u4ee5\uff0c\u5fae\u670d\u52a1\u7f51\u5173\u5728\u5fae\u670d\u52a1\u7cfb\u7edf\u67b6\u6784\u4e2d\u7684\u5b58\u5728\u662f\u5fc5\u8981\u7684\u3002\u6b64\u5916\uff0cAPI \u7f51\u5173\u5728\u7cfb\u7edf\u7684\u53ef\u89c2\u6d4b\u6027\u3001\u8eab\u4efd\u9274\u6743\u8ba4\u8bc1\u3001\u7a33\u5b9a\u6027\u548c\u670d\u52a1\u53d1\u73b0\u7b49\u65b9\u9762\u4e5f\u4f1a\u53d1\u6325\u91cd\u8981\u4f5c\u7528\u3002\\n\\n### \u5fae\u670d\u52a1\u9047\u5230\u7684\u6311\u6218\\n\\n\u5fae\u670d\u52a1\u7f51\u5173\u5e94\u8be5\u9996\u5148\u8981\u5177\u5907 API \u8def\u7531\u80fd\u529b\uff0c\u5fae\u670d\u52a1\u6570\u91cf\u53d8\u591a\uff0cAPI \u6570\u91cf\u6025\u5267\u589e\u52a0\uff0c\u7f51\u5173\u8fd8\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u7684\u573a\u666f\u4f5c\u4e3a\u6d41\u91cf\u8fc7\u6ee4\u5668\u6765\u4f7f\u7528\uff0c\u4ee5\u63d0\u4f9b\u67d0\u4e9b\u989d\u5916\u53ef\u9009\u529f\u80fd\uff0c\u56e0\u6b64\u5bf9\u5fae\u670d\u52a1 API Gateway \u63d0\u51fa\u4e86\u66f4\u9ad8\u8981\u6c42\uff0c\u6bd4\u5982\uff1a\\n\\n- \u53ef\u89c2\u6d4b\u6027\uff1a\u5728\u4ee5\u5f80\u7684\u5355\u4f53\u5e94\u7528\u4e2d\uff0c\u6392\u67e5\u95ee\u9898\u5f80\u5f80\u901a\u8fc7\u67e5\u770b\u65e5\u5fd7\u5b9a\u4f4d\u9519\u8bef\u4fe1\u606f\u548c\u5f02\u5e38\u5806\u6808\uff1b\u4f46\u662f\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u670d\u52a1\u7e41\u591a\uff0c\u51fa\u73b0\u95ee\u9898\u65f6\u7684\u95ee\u9898\u5b9a\u4f4d\u53d8\u5f97\u975e\u5e38\u56f0\u96be\uff1b\u56e0\u6b64\uff0c\u5982\u4f55\u76d1\u63a7\u5fae\u670d\u52a1\u7684\u8fd0\u884c\u72b6\u51b5\u3001\u5f53\u51fa\u73b0\u5f02\u5e38\u65f6\u80fd\u5feb\u901f\u7ed9\u51fa\u62a5\u8b66\uff0c\u8fd9\u7ed9\u5f00\u53d1\u4eba\u5458\u5e26\u6765\u5f88\u5927\u6311\u6218\u3002\\n- \u9274\u6743\u8ba4\u8bc1\uff1a\u800c\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\uff0c\u4e00\u4e2a\u5e94\u7528\u4f1a\u88ab\u62c6\u5206\u6210\u82e5\u5e72\u4e2a\u5fae\u5e94\u7528\uff0c\u6bcf\u4e2a\u5fae\u5e94\u7528\u90fd\u9700\u8981\u5bf9\u8bbf\u95ee\u8fdb\u884c\u9274\u6743\uff0c\u6bcf\u4e2a\u5fae\u5e94\u7528\u90fd\u9700\u8981\u660e\u786e\u5f53\u524d\u8bbf\u95ee\u7528\u6237\u4ee5\u53ca\u5176\u6743\u9650\u3002\u5c24\u5176\u5f53\u8bbf\u95ee\u6765\u6e90\u4e0d\u53ea\u662f\u6d4f\u89c8\u5668\uff0c\u8fd8\u5305\u62ec\u5176\u5b83\u670d\u52a1\u7684\u8c03\u7528\u65f6\uff0c\u5355\u4f53\u5e94\u7528\u67b6\u6784\u4e0b\u7684\u9274\u6743\u65b9\u5f0f\u5c31\u4e0d\u662f\u7279\u522b\u5408\u9002\u4e86\u3002\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\uff0c\u8981\u8003\u8651\u5916\u90e8\u5e94\u7528\u63a5\u5165\u7684\u573a\u666f\u3001\u7528\u6237 - \u670d\u52a1\u7684\u9274\u6743\u3001\u670d\u52a1 - \u670d\u52a1\u7684\u9274\u6743\u7b49\u591a\u79cd\u9274\u6743\u573a\u666f\u3002\\n- \u7cfb\u7edf\u7a33\u5b9a\u6027\uff1a\u82e5\u5927\u91cf\u8bf7\u6c42\u8d85\u8fc7\u5fae\u670d\u52a1\u7684\u5904\u7406\u80fd\u529b\u65f6\uff0c\u53ef\u80fd\u4f1a\u5c06\u670d\u52a1\u6253\u57ae\uff0c\u751a\u81f3\u4ea7\u751f\u96ea\u5d29\u6548\u5e94\u3001\u5f71\u54cd\u7cfb\u7edf\u7684\u6574\u4f53\u7a33\u5b9a\u6027\u3002\\n- \u670d\u52a1\u53d1\u73b0\uff1a\u5fae\u670d\u52a1\u7684\u5206\u6563\u7ba1\u7406\uff0c\u8ba9\u5fae\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\u7684\u5b9e\u73b0\u4e5f\u66f4\u5177\u6709\u6311\u6218\u6027\u3002\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\nAPI \u7f51\u5173\u4f5c\u4e3a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u4e2d\u95f4\u6865\u6881\uff0c\u4e3a\u5fae\u670d\u52a1\u7cfb\u7edf\u63d0\u4f9b\u7edf\u4e00\u7684\u7ba1\u7406\u673a\u5236\uff1a\u9664\u4e86\u57fa\u7840\u7684\u8bf7\u6c42\u5206\u53d1\u3001API \u7ba1\u7406\u548c\u6761\u4ef6\u8def\u7531\u7b49\u529f\u80fd\uff0c\u8fd8\u5305\u62ec\u8eab\u4efd\u9a8c\u8bc1\u3001\u76d1\u63a7\u62a5\u8b66\u3001\u8c03\u7528\u94fe\u8ffd\u8e2a\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u9650\u6d41\u9694\u79bb\u548c\u7194\u65ad\u964d\u7ea7\u3002\\n\u8eab\u4efd\u8ba4\u8bc1\uff1a\u4e0b\u56fe\u8868\u793a\u7684\u662f\u5fae\u670d\u52a1\u8054\u5408 API \u7f51\u5173\u5982\u4f55\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u7684\uff0c\u7531\u56fe\u53ef\u89c1\u6240\u6709\u8bf7\u6c42\u90fd\u901a\u8fc7\u7f51\u5173\uff0c\u4ece\u800c\u6709\u6548\u5730\u9690\u85cf\u4e86\u5fae\u670d\u52a1\u3002\\n\\n![Architecture Diagram](https://static.apiseven.com/uploads/2023/01/30/rlo8Ci1h_%E5%9B%BE2.png)\\n\\n\u76d1\u63a7\u62a5\u8b66/\u8c03\u7528\u94fe\u8ffd\u8e2a\uff1aAPI \u4f5c\u4e3a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u4e2d\u95f4\u6865\u6881\uff0c\u662f\u5fae\u670d\u52a1\u76d1\u63a7\u7684\u6700\u597d\u8f7d\u4f53\uff0cAPI \u7f51\u5173\u76d1\u63a7\u529f\u80fd\u7684\u4e3b\u8981\u804c\u8d23\u662f\u53ca\u65f6\u53d1\u73b0\u7f51\u5173\u4ee5\u53ca\u540e\u7aef\u670d\u52a1\u5668\u7684\u8fde\u63a5\u5f02\u5e38\uff0c\u5728 API \u7684\u76d1\u63a7\u5e73\u53f0\u4e0a\u9762\u7528\u6237\u53ef\u4ee5\u968f\u65f6\u67e5\u770b\u65e5\u5fd7\u4fe1\u606f\uff0c\u76d1\u63a7\u4fe1\u606f\uff0c\u8c03\u7528\u94fe\u7b49\u7b49\uff0c\u5e76\u4e14\u4e3b\u673a\u53d1\u751f\u7684\u4efb\u4f55\u5f02\u5e38\u90fd\u4f1a\u81ea\u52a8\u62a5\u8b66\u5230\u63a7\u5236\u53f0\u3002\u6709\u4e9b\u7f51\u5173\u751a\u81f3\u53ef\u4ee5\u505a\u5230\u7ed9\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u53cc\u5411\u62a5\u8b66\u3002\\n\\n![Architecture Diagram](https://static.apiseven.com/uploads/2023/01/30/Zl9ydaQv_%E5%9B%BE3.png)\\n\\n\u9650\u6d41\u9694\u79bb/\u7194\u65ad\u964d\u7ea7\uff1a\u968f\u7740\u4e92\u8054\u7f51\u4e1a\u52a1\u89c4\u6a21\u7684\u589e\u52a0\uff0c\u7cfb\u7edf\u7684\u5e76\u53d1\u5ea6\u589e\u9ad8\uff0c\u591a\u4e2a\u670d\u52a1\u4e4b\u95f4\u76f8\u4e92\u8c03\u7528\u94fe\u8def\uff0c\u4e00\u6761\u6838\u5fc3\u94fe\u8def\u5f80\u5f80\u53ef\u80fd\u8c03\u7528\u5341\u4e2a\u670d\u52a1\u3002\u5982\u679c\u5728\u94fe\u8def\u4e2d\uff0c\u67d0\u4e2a\u670d\u52a1\u7684 rt\uff08\u54cd\u5e94\u65f6\u95f4\uff09\u6025\u5267\u4e0a\u5347\uff0c\u4e0a\u6e38\u670d\u52a1\u4e0d\u65ad\u8bf7\u6c42\uff0c\u9020\u6210\u6076\u6027\u5faa\u73af\uff0c\u4e0a\u6e38\u7b49\u5f85\u7ed3\u679c\u7ebf\u7a0b\u6570\u8d8a\u591a\uff0c\u4f7f\u5f97\u66f4\u4e0a\u6e38\u670d\u52a1\u963b\u585e\u6700\u7ec8\u6574\u6761\u94fe\u8def\u65e0\u6cd5\u4f7f\u7528\uff0c\u4ece\u800c\u5bfc\u81f4\u670d\u52a1\u96ea\u5d29\uff0c\u6240\u4ee5\u5bf9\u5165\u53e3\u6d41\u91cf\u8fdb\u884c\u6574\u6cbb\u7ba1\u7406\u662f\u5f88\u6709\u5fc5\u8981\u7684\uff0c\u4e0b\u56fe\u8868\u793a\u5fae\u670d\u52a1\u7cfb\u7edf\u662f\u5982\u4f55\u7ed3\u5408 API \u7f51\u5173\u8fdb\u884c\u9650\u6d41\u9694\u79bb\u548c\u7194\u65ad\u964d\u7ea7\u7684\u3002\\n\\n![Architecture Diagram](https://static.apiseven.com/uploads/2023/01/30/vEAHDq7c_%E5%9B%BE4.png)\\n\\n### \u4e3b\u6d41\u7f51\u5173\u9009\u62e9\\n\\n\u5728\u5fae\u670d\u52a1\u9886\u57df\uff0c\u6709\u8bb8\u591a\u5f00\u6e90\u7f51\u5173\u5b9e\u73b0\uff0c\u6709 NGINX\u3001Kong\u3001Apache APISIX \u548c Envoy \u7b49\uff0cJava \u6280\u672f\u6808\u7684\u6709 Netfilx Zuul\u3001Spring Cloud Gateway\u3001Soul \u7b49\u3002\u6216\u8bb8\u4f60\u4f1a\u95ee\u201c\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX \uff1f\u201d \uff0c\u4e0b\u9762\u505a\u4e2a\u7b80\u5355\u5bf9\u6bd4\u3002\\n\\n| \u7f51\u5173 | \u75db\u70b9                                                                                                                                 | \u4f18\u52bf                                                                                                                                                      |\\n|---|------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|\\n| NGINX | 1. \u4fee\u6539\u914d\u7f6e\u9700\u8981 Reload \u624d\u80fd\u751f\u6548\uff0c\u8ddf\u4e0d\u4e0a\u4e91\u539f\u751f\u7684\u53d1\u5c55\u3002                                                                                                   | 1. \u8001\u724c\u5e94\u7528\uff1b<br/> 2. \u7a33\u5b9a\u53ef\u9760\uff0c\u4e45\u7ecf\u8003\u9a8c\uff1b<br/> 3. \u9ad8\u6027\u80fd\u3002                                                                                                                |\\n| Apache APISIX | 1. \u6587\u6863\u4e0d\u591f\u4e30\u5bcc\u548c\u6e05\u6670\uff0c\u9700\u8981\u5f85\u6539\u8fdb\u3002                                                                                                                | 1. Apache \u57fa\u91d1\u4f1a\u9876\u7ea7\u9879\u76ee\uff1b<br/> 2. \u6280\u672f\u67b6\u6784\u66f4\u8d34\u5408\u4e91\u539f\u751f\uff1b 3. \u6027\u80fd\u8868\u73b0\u4f18\u79c0\uff1b<br/> 4. \u751f\u6001\u4e30\u5bcc\uff1b 5. \u9664\u4e86\u652f\u6301 Lua \u5f00\u53d1\u63d2\u4ef6\u5916\uff0c\u8fd8\u652f\u6301 Java\u3001Go\u3001Python\u3001Node \u7b49\u8bed\u8a00\u63d2\u4ef6\u3002                                          |\\n| Kong | 1. \u9ed8\u8ba4\u4f7f\u7528 PostgreSQL \u6216 Cassandra \u6570\u636e\u5e93\uff0c\u4f7f\u5f97\u6574\u4e2a\u67b6\u6784\u975e\u5e38\u81c3\u80bf\uff0c\u5e76\u4e14\u4f1a\u5e26\u6765\u9ad8\u53ef\u7528\u7684\u95ee\u9898\uff1b<br/> 2. \u8def\u7531\u4f7f\u7528\u7684\u662f\u904d\u5386\u67e5\u627e\uff0c\u5f53\u7f51\u5173\u5185\u6709\u8d85\u8fc7\u4e0a\u5343\u4e2a\u8def\u7531\u65f6\uff0c\u5b83\u7684\u6027\u80fd\u5c31\u4f1a\u51fa\u73b0\u6bd4\u8f83\u6025\u5267\u7684\u4e0b\u964d\uff1b<br/> 3. \u4e00\u4e9b\u91cd\u8981\u529f\u80fd\u662f\u9700\u8981\u4ed8\u8d39\u7684\u3002 | 1. \u5f00\u6e90 API \u7f51\u5173\u7684\u9f3b\u7956\uff0c\u7528\u6237\u6570\u4f17\u591a\uff1b<br/> 2. \u6027\u80fd\u6ee1\u8db3\u5927\u90e8\u5206\u7528\u6237\u7684\u9700\u6c42\uff1b<br/> 3. \u751f\u6001\u4e30\u5bcc\uff1b<br/> 4. \u652f\u6301 Lua \u548c Go \u5f00\u53d1\u63d2\u4ef6\u3002                                                                    |\\n|   Envoy   | 1. \u4f7f\u7528 C++\uff0c\u4e8c\u6b21\u5f00\u53d1\u96be\u5ea6\u5927\uff1b<br/> 2. \u9664\u4e86 C++ \u5f00\u53d1 filter \u5916\uff0c\u8fd8\u652f\u6301 WASM \u548c Lua\u3002                                                                     | 1. CNCF \u6bd5\u4e1a\u9879\u76ee \u66f4\u9002\u5408\u670d\u52a1\u7f51\u683c\u573a\u666f\u591a\u8bed\u8a00\u67b6\u6784\u90e8\u7f72\u3002                                                                                                                          |\\n|     Spring Cloud Gateway      | 1. \u867d\u7136 Spring \u793e\u533a\u6210\u719f\uff0c\u4f46\u662f Gateway \u8d44\u6e90\u7f3a\u4e4f\u3002                                                                                                  | 1. \u5185\u7f6e\u4e86\u975e\u5e38\u591a\u7684\u5f00\u7bb1\u5373\u7528\u529f\u80fd\uff0c\u5e76\u4e14\u90fd\u53ef\u4ee5\u901a\u8fc7 SpringBoot \u914d\u7f6e\u6216\u8005\u624b\u5de5\u7f16\u7801\u94fe\u5f0f\u8c03\u7528\u6765\u4f7f\u7528\uff1b <br/> 2. Spring \u7cfb\u5217\u53ef\u6269\u5c55\u6027\u5f3a\uff0c\u6613\u914d\u7f6e\uff0c\u53ef\u7ef4\u62a4\u6027\u597d\uff1b    <br/> 3. Spring \u793e\u533a\u6210\u719f\uff1b <br/> 4. \u7b80\u5355\u6613\u7528\uff1b<br/> 5. \u5bf9\u4e8e Java \u6280\u672f\u6808\u6765\u8bf4\u65b9\u4fbf\u3002 |\\n\\n## \u603b\u7ed3\\n\\n\u968f\u7740\u4e92\u8054\u7f51\u7684\u53d1\u5c55\uff0c\u4e92\u8054\u7f51\u4f01\u4e1a\u7684\u4e1a\u52a1\u4e5f\u5728\u4e0d\u65ad\u7684\u98de\u901f\u53d1\u5c55\uff0c\u8fdb\u800c\u5bfc\u81f4\u7cfb\u7edf\u7684\u67b6\u6784\u4e5f\u5728\u4e0d\u65ad\u7684\u53d1\u751f\u7740\u53d8\u5316\uff0c\u5fae\u670d\u52a1\u67b6\u6784\u5df2\u7ecf\u5728\u4f17\u591a\u516c\u53f8\u5f97\u5230\u5e7f\u6cdb\u5e94\u7528\u3002\u968f\u7740\u5fae\u670d\u52a1\u7684\u6570\u636e\u8d8a\u6765\u8d8a\u591a\uff0cAPI \u7684\u6570\u91cf\u4e5f\u8d8a\u6765\u8d8a\u591a\uff0c\u5bf9\u4e8e\u5927\u6d41\u91cf\u7684\u6cbb\u7406\uff0c\u9009\u62e9\u4e00\u4e2a\u4f18\u79c0\u7684 API \u7f51\u5173\u662f\u81f3\u5173\u91cd\u8981\u7684\u3002\u672c\u6587\u5217\u4e3e\u4e86\u5e38\u89c1\u7f51\u5173\uff0c\u5e76\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5217\u51fa\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\uff0c\u5982\u679c\u4f60\u6b63\u5728\u505a API \u7f51\u5173\u7684\u6280\u672f\u9009\u578b\uff0c\u6216\u8005\u4f60\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\u51fa\u73b0\u4e86\u6027\u80fd\u95ee\u9898\uff0c\u518d\u6216\u8005\u4f60\u60f3\u642d\u5efa\u4e00\u4e2a\u9ad8\u6548\u7a33\u5b9a\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\uff0c\u5e0c\u671b\u672c\u6587\u53ef\u4ee5\u5e26\u7ed9\u4f60\u4e00\u5b9a\u7684\u542f\u53d1\u3002"},{"id":"\u4ece 1 \u79d2\u5230 10 \u6beb\u79d2\uff01\u5728 APISIX \u4e2d\u51cf\u5c11 Prometheus \u8bf7\u6c42\u963b\u585e","metadata":{"permalink":"/zh/blog/2023/03/06/the-mystery-of-prometheus-plugins-and-long-tail-requests","source":"@site/blog/2023/03/06/the-mystery-of-prometheus-plugins-and-long-tail-requests.md","title":"\u4ece 1 \u79d2\u5230 10 \u6beb\u79d2\uff01\u5728 APISIX \u4e2d\u51cf\u5c11 Prometheus \u8bf7\u6c42\u963b\u585e","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 Prometheus \u63d2\u4ef6\u9020\u6210\u957f\u5c3e\u8bf7\u6c42\u73b0\u8c61\u7684\u539f\u56e0\uff0c\u4ee5\u53ca\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002","date":"2023-03-06T00:00:00.000Z","formattedDate":"2023\u5e743\u67086\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":15.1,"truncated":true,"authors":[{"name":"\u5c60\u6b63\u677e","title":"Author","url":"https://github.com/tzssangglass","image_url":"https://github.com/tzssangglass.png","imageURL":"https://github.com/tzssangglass.png"}],"prevItem":{"title":"\u5fae\u670d\u52a1\u4e3a\u4ec0\u4e48\u8981\u7528\u5230 API \u7f51\u5173\uff1f","permalink":"/zh/blog/2023/03/08/why-do-microservices-need-an-api-gateway"},"nextItem":{"title":"API Gateway vs Load Balancer\uff1a\u9009\u62e9\u9002\u5408\u4f60\u7684\u7f51\u7edc\u6d41\u91cf\u7ba1\u7406\u7ec4\u4ef6","permalink":"/zh/blog/2023/03/03/api-gateway-vs-load-balancer"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Prometheus \u63d2\u4ef6\u9020\u6210\u957f\u5c3e\u8bf7\u6c42\u73b0\u8c61\u7684\u539f\u56e0\uff0c\u4ee5\u53ca\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u5c60\u6b63\u677e](https://github.com/tzssangglass)\uff0cApache APISIX PMC Member\u3002\\n\\n## \u73b0\u8c61\\n\\n\u5728 APISIX \u793e\u533a\u4e2d\uff0c\u66fe\u6709\u90e8\u5206\u7528\u6237\u9646\u7eed\u53cd\u9988\u4e00\u79cd\u795e\u79d8\u73b0\u8c61\uff1a\u90e8\u5206\u8bf7\u6c42\u5ef6\u8fdf\u8f83\u957f\u3002\u5177\u4f53\u8868\u73b0\u4e3a\uff1a\u5f53\u6d41\u91cf\u8bf7\u6c42\u8fdb\u5165\u4e00\u4e2a\u6b63\u5e38\u90e8\u7f72\u7684 APISIX \u96c6\u7fa4\u65f6\uff0c\u5076\u5c14\u4f1a\u51fa\u73b0\u90e8\u5206\u8bf7\u6c42\u6709 1 ~ 2 \u79d2\u7684\u5ef6\u8fdf\u3002\u7528\u6237\u7684 QPS \u89c4\u6a21\u5927\u6982\u5728 1 \u4e07\uff0c\u4f46\u662f\u8fd9\u79cd\u5f02\u5e38\u8bf7\u6c42\u975e\u5e38\u5c11\u89c1\uff0c\u6bcf\u9694\u51e0\u5206\u949f\u5c31\u4f1a\u51fa\u73b0 1 ~ 3 \u6b21\u3002\u4e00\u4e9b\u7528\u6237\u5728 issue \u4e2d\u4e5f\u63d0\u4f9b\u4e86\u6355\u83b7\u5230\u7684\u5ef6\u8fdf\u8f83\u957f\u7684\u8bf7\u6c42\u3002\u4ece\u8fd9\u4e9b\u622a\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u786e\u5b9e\u6709\u8bf7\u6c42\u5ef6\u8fdf\u8f83\u9ad8\uff0c\u751a\u81f3\u53ef\u4ee5\u8fbe\u5230\u79d2\u7ea7\u522b\u3002\\n\\n![High Latency Requests 1.png](https://static.apiseven.com/uploads/2023/01/31/uDLOpLOB_rGTqZMPdD2.jpeg)\\n\\n![High Latency Requests 2.png](https://static.apiseven.com/2022/12/29/63ad4ff190201.png)\\n\\n\u8fd9\u79cd\u73b0\u8c61\u4f34\u968f\u7740\u53e6\u4e00\u79cd\u73b0\u8c61\uff1a\u67d0\u4e2a worker \u8fdb\u7a0b\u7684 CPU \u5360\u7528\u7387\u8fbe\u5230\u4e86 100%\u3002\\n\\n![100% CPU.png](https://static.apiseven.com/2022/12/29/63ad4ff52986d.png)\\n\\n\u5f00\u53d1\u56e2\u961f\u901a\u8fc7\u4e0d\u540c\u6e20\u9053\u4e0e\u8fd9\u4e9b\u53cd\u9988\u7684\u7528\u6237\u6c9f\u901a\u5f97\u77e5\uff0c\u8fd9\u4e2a\u73b0\u8c61\u53d1\u751f\u7684\u6761\u4ef6\u662f\uff1a\\n\\n1. \u5f00\u542f prometheus \u63d2\u4ef6\uff0c\u5e76\u4e14\u6709 Prometheus Exporter \u8bbf\u95ee APISIX \u7684 endpoint `/apisix/prometheus/metrics` \u6765\u91c7\u96c6\u6307\u6807\uff1b\\n2. prometheus \u63d2\u4ef6\u7edf\u8ba1\u7684 metrics \u7684\u6570\u91cf\u8fbe\u5230\u4e00\u5b9a\u89c4\u6a21\uff0c\u901a\u5e38\u662f\u4e0a\u4e07\u7ea7\u522b\uff1b\\n\\n\u8fd9\u4e2a\u73b0\u8c61\u662f\u5728\u4e1a\u754c\u79f0\u4e3a \\"\u957f\u5c3e\u8bf7\u6c42\\"\uff0c\u662f\u6307\u5728\u4e00\u4e2a\u8bf7\u6c42\u7fa4\u4f53\u4e2d\uff0c\u5927\u90e8\u5206\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u8f83\u77ed\uff0c\u4f46\u6709\u5c11\u90e8\u5206\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u8f83\u957f\u7684\u60c5\u51b5\u3002\u5b83\u53ef\u80fd\u662f\u7531\u4e8e\u540e\u7aef\u7cfb\u7edf\u7684\u6027\u80fd\u74f6\u9888\u3001\u8d44\u6e90\u4e0d\u8db3\u6216\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\u7684\u3002\u5b83\u4e0d\u662f\u4e00\u4e2a\u81f4\u547d\u7684 bug\uff0c\u4f46\u662f\u5b83\u4e25\u91cd\u5f71\u54cd\u4e86\u7ec8\u7aef\u7528\u6237\u7684\u4f53\u9a8c\u3002\\n\\n## \u62bd\u4e1d\u5265\u8327\\n\\nAPISIX \u57fa\u4e8e\u4e00\u4e2a\u5f00\u6e90\u7684 Lua \u5e93 [nginx-lua-prometheus](https://github.com/knyar/nginx-lua-prometheus) \u5f00\u53d1\u4e86 Prometheus \u63d2\u4ef6\uff0c\u63d0\u4f9b\u8ddf\u8e2a\u548c\u6536\u96c6 metrics \u7684\u529f\u80fd\u3002\u5f53 Prometheus Exporter \u8bbf\u95ee APISIX \u66b4\u9732\u7684 Prometheus \u6307\u6807\u7684 endpoint \u65f6\uff0cAPISIX \u4f1a\u8c03\u7528 nginx-lua-prometheus \u63d0\u4f9b\u7684\u51fd\u6570\u6765\u66b4\u9732 metrics \u7684\u8ba1\u7b97\u7ed3\u679c\u3002\\n\\n\u5f00\u53d1\u56e2\u961f\u4ece\u793e\u533a\u7528\u6237\uff0c\u4f01\u4e1a\u7528\u6237\u7b49\u6e20\u9053\u6536\u96c6\u6c47\u603b\u4e86\u957f\u5c3e\u8bf7\u6c42\u53d1\u751f\u7684\u6761\u4ef6\uff0c\u57fa\u672c\u5b9a\u4f4d\u4e86\u95ee\u9898\u6240\u5728\uff1anginx-lua-prometheus \u4e2d\u7528\u4e8e\u66b4\u9732 metrics \u6307\u6807\u7684\u51fd\u6570 `prometheus:metric_data()`\u3002\\n\\n\u4e0d\u8fc7\u8fd9\u53ea\u662f\u521d\u6b65\u63a8\u65ad\uff0c\u8fd8\u9700\u8981\u76f4\u63a5\u7684\u8bc1\u636e\u6765\u8bc1\u660e\u957f\u5c3e\u8bf7\u6c42\u4e0e\u6b64\u6709\u5173\uff0c\u5e76\u4e14\u9700\u8981\u641e\u6e05\u695a\u4ee5\u4e0b\u95ee\u9898\uff1a\\n\\n1. \u8fd9\u4e2a\u51fd\u6570\u5177\u4f53\u505a\u4e86\u4ec0\u4e48\uff1f\\n2. \u8fd9\u4e2a\u51fd\u6570\u4e3a\u4ec0\u4e48\u4f1a\u9020\u6210\u957f\u5c3e\u8bf7\u6c42\u73b0\u8c61\uff1f\\n\\n\u5f00\u53d1\u56e2\u961f\u6784\u9020\u4e86\u672c\u5730\u590d\u73b0\u73af\u5883\uff0c\u8fd9\u4e2a\u590d\u73b0\u73af\u5883\u4e3b\u8981\u6a21\u62df\u4ee5\u4e0b\u573a\u666f\uff1a\\n\\n1. \u6a21\u62df\u5ba2\u6237\u7aef\u53d1\u9001\u6b63\u5e38\u8bf7\u6c42\uff0c\u88ab APISIX \u4ee3\u7406\u5230\u4e0a\u6e38\\n2. \u6a21\u62df Prometheus Exporter \u6bcf\u9694 5 \u79d2\u8bbf\u95ee `/apisix/prometheus/metrics`\uff0c\u89e6\u53d1 APISIX \u8fd0\u884c `prometheus:metric_data()` \u51fd\u6570\\n\\n\u590d\u73b0\u73af\u5883\u793a\u610f\u56fe\uff1a\\n\\n![Reproduced Environment.png](https://static.apiseven.com/2022/12/29/63ad4ff72f99a.png)\\n\\n\u5728\u6267\u884c\u590d\u73b0\u6d4b\u8bd5\u65f6\uff0c\u6211\u4eec\u4f1a\u89c2\u5bdf wrk2 \u7684\u6d4b\u8bd5\u7ed3\u679c\u4e2d\u7684 P100 \u7b49\u6307\u6807\u6765\u786e\u8ba4\u662f\u5426\u53d1\u751f\u4e86\u957f\u5c3e\u8bf7\u6c42\u73b0\u8c61\uff0c\u5e76\u4e14\u4f1a\u5bf9\u8fd0\u884c\u4e2d\u7684 APISIX \u751f\u6210\u706b\u7130\u56fe\uff0c\u6765\u89c2\u6d4b\u53d1\u751f\u957f\u5c3e\u8bf7\u6c42\u65f6\uff0cCPU \u8d44\u6e90\u6d88\u8017\u5728\u54ea\u91cc\u3002\\n\\nwrk2 \u7684\u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b\uff1a\\n\\n```text\\n  Latency Distribution (HdrHistogram - Uncorrected Latency (measured without taking delayed starts into account))\\n   50.000%    1.13ms\\n   75.000%    2.56ms\\n   90.000%    4.82ms\\n   99.000%   14.70ms\\n   99.900%   27.95ms\\n   99.990%   74.75ms\\n   99.999%  102.78ms\\n  100.000%  102.78ms\\n```\\n\\n\u6839\u636e\u8fd9\u4e2a\u6d4b\u8bd5\u7ed3\u679c\u53ef\u4ee5\u5f97\u5230\u7ed3\u8bba\uff1a\u5728\u6d4b\u8bd5\u671f\u95f4\uff0c99% \u7684\u8bf7\u6c42\u5728 14.70 \u6beb\u79d2\u5185\u5b8c\u6210\u4e86\uff0c\u4f46\u662f\u8fd8\u6709\u5f88\u5c11\u4e00\u90e8\u5206\u8bf7\u6c42\u6d88\u8017\u4e86 100 \u591a\u6beb\u79d2\u3002\u5e76\u4e14\u6211\u4eec\u7528 metrics \u6570\u91cf\u4f5c\u4e3a\u53d8\u91cf\uff0c\u8fdb\u884c\u4e86\u591a\u6b21\u6d4b\u8bd5\uff0c\u53d1\u73b0 metrics \u6570\u91cf\u4e0e P100 \u7684\u5ef6\u8fdf\u5448\u7ebf\u6027\u589e\u957f\u3002\u5982\u679c metrics \u8fbe\u5230 10 \u4e07\u7ea7\u522b\uff0cP100 \u5c06\u8fbe\u5230\u79d2\u7ea7\u522b\u3002\\n\\n\u751f\u6210\u7684\u706b\u7130\u56fe\u5982\u4e0b\uff1a\\n\\n![Flame Graph1](https://static.apiseven.com/2022/12/29/63ad4ff9130d0.png)\\n\\n\u4ece\u706b\u7130\u56fe\u7684\u51fd\u6570\u5806\u6808\u53ef\u4ee5\u770b\u5230\uff0c`prometheus:metric_data()` \u5360\u636e\u4e86\u6700\u957f\u7684\u6a2a\u8f74\u5bbd\u5ea6\uff0c\u8fd9\u8bc1\u660e\u4e86\u5927\u91cf CPU \u6d88\u8017\u5728\u8fd9\u91cc\u3002\u8fd9\u4e5f\u76f4\u63a5\u8bc1\u660e\u4e86 `prometheus:metric_data()` \u9020\u6210\u957f\u5c3e\u8bf7\u6c42\u73b0\u8c61\u3002\\n\\n\u4e0b\u9762\u6211\u4eec\u6765\u7b80\u5355\u5206\u6790\u4e00\u4e0b `prometheus:metric_data()` \u51fd\u6570\u505a\u4e86\u4ec0\u4e48\u3002`prometheus:metric_data()` \u5c06\u4f1a\u4ece\u5171\u4eab\u5185\u5b58\u4e2d\u83b7\u53d6\u6307\u6807\uff0c\u5bf9\u6307\u6807\u8fdb\u884c\u5206\u7c7b\uff0c\u5e76\u52a0\u5de5\u6210 Prometheus \u517c\u5bb9\u7684\u6587\u672c\u683c\u5f0f\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u5bf9\u6240\u6709 metrics \u6309\u7167\u5b57\u5178\u5e8f\u8fdb\u884c\u6392\u5e8f\uff0c\u4f1a\u7528\u6b63\u5219\u5904\u7406 metrics \u7684\u524d\u7f00\u3002\u6839\u636e\u7ecf\u9a8c\uff0c\u8fd9\u4e9b\u90fd\u662f\u975e\u5e38\u6602\u8d35\u7684\u64cd\u4f5c\u3002\\n\\n## \u4e0d\u591f\u5b8c\u7f8e\u7684\u4f18\u5316\\n\\n\u5f53\u5b9a\u4f4d\u5230\u6709\u95ee\u9898\u7684\u4ee3\u7801\u540e\uff0c\u4e0b\u4e00\u6b65\u5c31\u662f\u7ed3\u5408\u706b\u7130\u56fe\uff0c\u8be6\u7ec6\u5206\u6790\u4ee3\u7801\uff0c\u5bfb\u627e\u4f18\u5316\u7a7a\u95f4\u3002\\n\\n\u4ece\u706b\u7130\u56fe\u53ef\u4ee5\u5b9a\u4f4d\u5230 `fix_histogram_bucket_labels` \u51fd\u6570\u3002\u901a\u8fc7 review \u8fd9\u4e2a\u51fd\u6570\uff0c\u6211\u4eec\u53d1\u73b0\u4e86\u4e24\u4e2a\u6bd4\u8f83\u654f\u611f\u7684\u51fd\u6570\uff1a`string:match` \u548c `string:gsub`\u3002\u8fd9\u4e24\u4e2a\u51fd\u6570\u90fd\u4e0d\u80fd\u88ab LuaJIT \u6240 JIT \u7f16\u8bd1\uff0c\u53ea\u80fd\u89e3\u91ca\u6267\u884c\u3002\\n\\nLuaJIT \u662f\u4e00\u4e2a\u9488\u5bf9 Lua \u7f16\u7a0b\u8bed\u8a00\u7684 JIT \u7f16\u8bd1\u5668\uff0c\u53ef\u4ee5\u5c06 Lua \u4ee3\u7801\u7f16\u8bd1\u6210\u673a\u5668\u7801\u5e76\u8fd0\u884c\u3002\u8fd9\u76f8\u6bd4\u4e8e\u4f7f\u7528\u89e3\u91ca\u5668\u6765\u8fd0\u884c Lua \u4ee3\u7801\uff0c\u53ef\u4ee5\u63d0\u4f9b\u66f4\u9ad8\u7684\u6027\u80fd\u3002\\n\u4f7f\u7528 LuaJIT \u8fd0\u884c Lua \u4ee3\u7801\u7684\u4e00\u4e2a\u4f18\u52bf\u662f\uff0c\u5b83\u53ef\u4ee5\u5927\u5e45\u63d0\u5347\u4ee3\u7801\u7684\u6267\u884c\u901f\u5ea6\u3002\u8fd9\u4f7f\u5f97 APISIX \u5728\u5904\u7406\u5927\u91cf\u8bf7\u6c42\u65f6\u53ef\u4ee5\u4fdd\u6301\u8f83\u4f4e\u7684\u5ef6\u8fdf\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u9ad8\u5e76\u53d1\u73af\u5883\u4e0b\u8868\u73b0\u51fa\u8f83\u597d\u7684\u6027\u80fd\u3002\\n\u5173\u4e8e LuaJIT \u7684\u66f4\u591a\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003\uff1a[\u4ec0\u4e48\u662f JIT](https://moonbingbing.gitbooks.io/openresty-best-practices/content/lua/what_jit.html)\uff1f\\n\\n\u56e0\u6b64\u4e0d\u80fd\u88ab LuaJIT \u7f16\u8bd1\u7684\u4ee3\u7801\u5fc5\u7136\u4f1a\u6210\u4e3a\u6f5c\u5728\u7684\u6027\u80fd\u74f6\u9888\u3002\\n\\n\u6211\u4eec\u6574\u7406\u4ee5\u4e0a\u4fe1\u606f\u5e76\u63d0\u4ea4\u4e86 [issue: optimize the long-tail request phenomenon](https://github.com/knyar/nginx-lua-prometheus/issues/130) \u5230 nginx-lua-prometheus\uff0c\u4e0e\u8fd9\u4e2a\u9879\u76ee\u7684\u4f5c\u8005 knyar \u4e00\u8d77\u63a2\u8ba8\u53ef\u4ee5\u4f18\u5316\u7684\u7a7a\u95f4\u3002knyar \u54cd\u5e94\u5f88\u53ca\u65f6\uff0c\u6211\u4eec\u6c9f\u901a\u540e\u660e\u786e\u4e86\u53ef\u4ee5\u4f18\u5316\u7684\u70b9\u3002\u4e8e\u662f\u63d0\u4ea4\u4e86 PR\uff1a[chore: use ngx.re.match instead of string match to improve performance](https://github.com/knyar/nginx-lua-prometheus/pull/131) \u8fdb\u884c\u4f18\u5316\u3002\\n\u5728\u8fd9\u4e2a PR \u4e2d\uff0c\u4e3b\u8981\u5b8c\u6210\u4e86\uff1a\\n\\n- \u7528 `ngx.re.match` \u66ff\u4ee3 `string:match`\\n- \u7528 `ngx.re.gsub` \u66ff\u4ee3 `string:gsub`\\n\\n\u5728\u5b8c\u6210\u8fd9\u4e2a\u4f18\u5316\u540e\uff0c\u6211\u4eec\u5176\u5b9e\u975e\u5e38\u7406\u6027\u5730\u77e5\u9053\uff0c\u8fd9\u4e2a\u4f18\u5316\u53ea\u80fd\u63d0\u5347\u4e00\u4e9b\u6027\u80fd\uff0c\u4f46\u4e0d\u80fd\u6839\u672c\u89e3\u51b3\u95ee\u9898\u3002\u6839\u672c\u95ee\u9898\u662f\uff1a\\n\\nNginx \u662f\u4e00\u79cd\u591a\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\u67b6\u6784\u3002\u6240\u6709\u7684 worker \u8fdb\u7a0b\u90fd\u4f1a\u76d1\u542c TCP \u8fde\u63a5\uff0c\u4f46\u4e00\u65e6\u8fde\u63a5\u8fdb\u5165\u4e86\u67d0\u4e2a worker \u8fdb\u7a0b\uff0c\u5c31\u4e0d\u80fd\u518d\u88ab\u8fc1\u79fb\u5230\u5176\u4ed6 worker \u8fdb\u7a0b\u53bb\u5904\u7406\u4e86\u3002\\n\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u67d0\u4e2a worker \u8fdb\u7a0b\u975e\u5e38\u5fd9\u788c\uff0c\u90a3\u4e48\u8be5 worker \u8fdb\u7a0b\u5185\u7684\u5176\u4ed6\u8fde\u63a5\u5c31\u53ef\u80fd\u65e0\u6cd5\u53ca\u65f6\u83b7\u5f97\u5904\u7406\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u8fdb\u7a0b\u5185\u7684\u5355\u7ebf\u7a0b\u6a21\u578b\u610f\u5473\u7740\uff0c\u6240\u6709 CPU \u5bc6\u96c6\u578b\u548c IO \u5bc6\u96c6\u578b\u7684\u4efb\u52a1\u90fd\u5fc5\u987b\u6309\u987a\u5e8f\u6267\u884c\u3002\u5982\u679c\u67d0\u4e2a\u4efb\u52a1\u6267\u884c\u65f6\u95f4\u8f83\u957f\uff0c\u90a3\u4e48\u5176\u4ed6\u4efb\u52a1\u5c31\u53ef\u80fd\u88ab\u5ffd\u7565\uff0c\u5bfc\u81f4\u4efb\u52a1\u5904\u7406\u65f6\u95f4\u4e0d\u5747\u5300\u3002\\n\\n`prometheus:metric_data()` \u5360\u636e\u4e86\u5927\u91cf\u7684 CPU \u65f6\u95f4\u7247\u8fdb\u884c\u8ba1\u7b97\uff0c\u6324\u538b\u4e86\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u7684 CPU \u8d44\u6e90\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u4f1a\u770b\u5230\u67d0\u4e2a worker \u8fdb\u7a0b\u7684 CPU \u5360\u7528\u7387\u8fbe\u5230 100%\u3002\\n\\n\u57fa\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5728\u5b8c\u6210\u4e0a\u8ff0\u4f18\u5316\u540e\u7ee7\u7eed\u5206\u6790\uff0c\u6293\u53d6\u4e86\u706b\u7130\u56fe\uff1a\\n\\n![Flame Graph2](https://static.apiseven.com/2022/12/29/63ad4ffa4e070.png)\\n\\n\u4e0a\u9762\u706b\u7130\u56fe `builtin#100` \u8868\u793a\u7684\u662f luajit/lua \u7684\u5e93\u51fd\u6570\uff08\u6bd4\u5982 `string.find` \u8fd9\u79cd\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7 https://github.com/openresty/openresty-devel-utils/blob/master/ljff.lua \u8fd9\u4e2a\u9879\u76ee\u91cc\u7684\u811a\u672c\u6765\u5f97\u5230\u5bf9\u5e94\u7684\u51fd\u6570\u540d\u79f0\u3002\\n\\n\u4f7f\u7528\u65b9\u5f0f\uff1a\\n\\n```shell\\n$ luajit ljff.lua 100\\nFastFunc table.sort\\n```\\n\\n\u7531\u4e8e\u8ba1\u7b97 metrics \u65f6\u5360\u7528\u4e86\u8fc7\u91cf\u7684 CPU\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5728\u8ba1\u7b97 metrics \u65f6\u9002\u5f53\u8ba9\u51fa CPU \u65f6\u95f4\u7247\u3002\\n\\n\u5bf9\u4e8e APISIX \u6765\u8bf4\uff0c\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7\u662f\u6700\u9ad8\u7684\uff0cCPU \u8d44\u6e90\u5e94\u5f53\u5411\u6b64\u503e\u659c\uff0c\u800c `prometheus:metric_data()` \u53ea\u4f1a\u5f71\u54cd Prometheus Exporter \u83b7\u53d6\u6307\u6807\u65f6\u7684\u6548\u7387\u3002\\n\\n\u5728 OpenResty \u4e16\u754c\uff0c\u6709\u4e00\u4e2a\u9690\u79d8\u7684\u8ba9\u51fa CPU \u65f6\u95f4\u7247\u7684\u65b9\u5f0f\uff1a`ngx.sleep(0)` \u3002\u6211\u4eec\u5728 `prometheus:metric_data()` \u4e2d\u5f15\u5165\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5f53\u5904\u7406\u6240\u6709\u7684 metrics \u65f6\uff0c\u6bcf\u5904\u7406\u56fa\u5b9a\u6570\u76ee\uff08\u6bd4\u5982 200 \u4e2a\uff09\u7684 metrics \u540e\u8ba9\u51fa CPU \u65f6\u95f4\u7247\uff0c\u8fd9\u6837\u65b0\u8fdb\u6765\u7684\u8bf7\u6c42\u5c06\u6709\u673a\u4f1a\u5f97\u5230\u5904\u7406\u3002\\n\\n\u6211\u4eec\u63d0\u4ea4\u4e86\u5f15\u5165\u8fd9\u4e2a\u4f18\u5316\u7684 PR\uff1a[feat: performance optimization](https://github.com/knyar/nginx-lua-prometheus/pull/139)\u3002\\n\\n\u5728\u6211\u4eec\u7684\u6d4b\u8bd5\u573a\u666f\u4e2d\uff0c\u5f53 metrics \u7684\u603b\u6570\u91cf\u8fbe\u5230 10 \u4e07\u7ea7\u522b\u65f6\uff0c\u5f15\u5165\u8fd9\u4e2a\u4f18\u5316\u4e4b\u524d\u7528 wrk2 \u6d4b\u8bd5\u5f97\u5230\u7684\u7ed3\u679c\uff1a\\n\\n```text\\n  Latency Distribution (HdrHistogram - Uncorrected Latency (measured without taking delayed starts into account))\\n 50.000%   10.21ms\\n 75.000%   12.03ms\\n 90.000%   13.25ms\\n 99.000%   92.80ms\\n 99.900%  926.72ms\\n 99.990%  932.86ms\\n 99.999%  934.40ms\\n100.000%  934.91ms\\n```\\n\\n\u5f15\u5165\u8fd9\u4e2a\u4f18\u5316\u540e\uff0c\u7528 wrk2 \u6d4b\u8bd5\u5f97\u5230\u7684\u7ed3\u679c\uff1a\\n\\n```text\\n  Latency Distribution (HdrHistogram - Uncorrected Latency (measured without taking delayed starts into account))\\n 50.000%    4.34ms\\n 75.000%   12.81ms\\n 90.000%   16.12ms\\n 99.000%   82.75ms\\n 99.900%  246.91ms\\n 99.990%  349.44ms\\n 99.999%  390.40ms\\n100.000%  397.31ms\\n```\\n\\n\u53ef\u4ee5\u770b\u5230 P100 \u7684\u6307\u6807\u5927\u7ea6\u662f\u4f18\u5316\u524d\u7684 1/3 \uff5e 1/2\u3002\\n\\n\u4e0d\u8fc7\u8fd9\u5e76\u6ca1\u6709\u5b8c\u7f8e\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u901a\u8fc7\u5206\u6790\u4f18\u5316\u540e\u7684\u706b\u7130\u56fe\uff1a\\n\\n![Flame Graph After Optimization](https://static.apiseven.com/2022/12/29/63ad4ffa4e070.png)\\n\\n\u53ef\u4ee5\u76f4\u63a5\u770b\u5230 `builtin#100`\uff08\u5373 `table.sort`\uff09 \u548c `builtin#92`\uff08\u5373 `string.format`\uff09\u7b49\uff0c\u4ecd\u7136\u5360\u636e\u4e86\u76f8\u5f53\u5bbd\u5ea6\u7684\u6a2a\u8f74\uff0c\u8fd9\u662f\u56e0\u4e3a\uff1a\\n\\n1. `prometheus:metric_data()` \u4e2d\u9996\u5148\u4f1a\u5bf9\u6240\u6709\u7684 metrics \u8c03\u7528 `table.sort` \u8fdb\u884c\u6392\u5e8f\uff0c\u5f53 metrics \u5230 10 \u4e07\u7ea7\u522b\u65f6\uff0c\u76f8\u5f53\u4e8e\u5bf9 10 \u4e07\u4e2a\u5b57\u7b26\u4e32\u8fdb\u884c\u6392\u5e8f\uff0c\u5e76\u4e14 `table.sort` \u4e0d\u53ef\u4ee5\u88ab `ngx.sleep(0)` \u4e2d\u65ad\u3002\\n2. \u4f7f\u7528 `string.format` \u7684\u5730\u65b9\uff0c\u4ee5\u53ca `fix_histogram_bucket_labels` \u65e0\u6cd5\u4f18\u5316\uff0c\u7ecf\u8fc7\u4e0e knyar \u4ea4\u6d41\u540e\u5f97\u77e5\uff0c\u8fd9\u4e9b\u6b65\u9aa4\u5fc5\u987b\u5b58\u5728\u4ee5\u4fdd\u8bc1 `prometheus:metric_data()` \u53ef\u4ee5\u4ea7\u51fa\u683c\u5f0f\u6b63\u786e\u7684 metrics\u3002\\n\\n\u81f3\u6b64\uff0c\u4ee3\u7801\u5c42\u9762\u7684\u4f18\u5316\u624b\u6bb5\u5df2\u7ecf\u7528\u5b8c\u4e86\uff0c\u4f46\u9057\u61be\u7684\u662f\uff0c\u8fd8\u662f\u6ca1\u6709\u5b8c\u7f8e\u89e3\u51b3\u95ee\u9898\u3002P100 \u7684\u6307\u6807\u4ecd\u7136\u6709\u660e\u663e\u7684\u5ef6\u8fdf\u3002\\n\\n## \u600e\u4e48\u529e\uff1f\\n\\n\u8ba9\u6211\u4eec\u518d\u56de\u5230\u6838\u5fc3\u95ee\u9898\uff1a`prometheus:metric_data()` \u5360\u636e\u4e86\u5927\u91cf\u7684 CPU \u65f6\u95f4\u7247\u8fdb\u884c\u8ba1\u7b97\uff0c\u6324\u538b\u4e86\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u7684 CPU \u8d44\u6e90\u3002\\n\\n\u5728 Linux \u7cfb\u7edf\u4e2d\uff0cCPU \u5206\u914d\u65f6\u95f4\u7247\u7684\u5355\u4f4d\u662f\u7ebf\u7a0b\u8fd8\u662f\u8fdb\u7a0b\uff1f\u51c6\u786e\u6765\u8bf4\u662f\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u624d\u662f\u5b9e\u9645\u7684\u5de5\u4f5c\u5355\u5143\u3002\u4e0d\u8fc7 Nginx \u662f\u591a\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u7684\u67b6\u6784\uff0c\u5b9e\u9645\u5728\u6bcf\u4e2a\u8fdb\u7a0b\u4e2d\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u3002\\n\\n\u6b64\u65f6\u6211\u4eec\u4f1a\u60f3\u5230\u4e00\u4e2a\u4f18\u5316\u65b9\u5411\uff1a\u5c06 `prometheus:metric_data()` \u8f6c\u79fb\u5230\u5176\u4ed6\u7ebf\u7a0b\uff0c\u6216\u8005\u8bf4\u8fdb\u7a0b\u3002\u4e8e\u662f\u6211\u4eec\u8c03\u7814\u4e86\u4e24\u4e2a\u65b9\u5411\uff1a\\n\\n1. \u7528 `ngx.run_worker_thread` \u6765\u8fd0\u884c `prometheus:metric_data()` \u7684\u8ba1\u7b97\u4efb\u52a1\uff0c\u76f8\u5f53\u4e8e\u5c06 CPU \u5bc6\u96c6\u578b\u4efb\u52a1\u4ea4\u7ed9\u7ebf\u7a0b\u6c60\uff1b\\n2. \u7528\u5355\u72ec\u7684\u8fdb\u7a0b\u6765\u5904\u7406 `prometheus:metric_data()` \u7684\u8ba1\u7b97\u4efb\u52a1\uff0c\u8fd9\u4e2a\u8fdb\u7a0b\u4e0d\u4f1a\u5904\u7406\u6b63\u5e38\u8bf7\u6c42\u3002\\n\\n\u7ecf\u8fc7 PoC \u540e\uff0c\u6211\u4eec\u5426\u5b9a\u4e86\u65b9\u6848 1\uff0c\u91c7\u7528\u4e86\u65b9\u6848 2\u3002\u5426\u5b9a\u65b9\u6848 1 \u662f\u56e0\u4e3a `ngx.run_worker_thread` \u53ea\u9002\u5408\u8fd0\u884c\u4e0e\u8bf7\u6c42\u65e0\u5173\u7684\u8ba1\u7b97\u4efb\u52a1\uff0c\u800c `prometheus:metric_data()` \u660e\u663e\u662f\u4e0e\u8bf7\u6c42\u6709\u5173\u7684\u3002\\n\\n\u65b9\u6848 2 \u7684\u5b9e\u73b0\uff1a\u8ba9 `privileged agent`\uff08\u7279\u6743\u8fdb\u7a0b\uff09\u6765\u5904\u7406 `prometheus:metric_data()`\u3002\u4f46\u662f\u7279\u6743\u8fdb\u7a0b\u672c\u8eab\u4e0d\u76d1\u542c\u4efb\u4f55\u7aef\u53e3\uff0c\u4e5f\u4e0d\u4f1a\u5904\u7406\u4efb\u4f55\u8bf7\u6c42\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u7279\u6743\u8fdb\u7a0b\u8fdb\u884c\u4e00\u4e9b\u6539\u9020\uff0c\u8ba9\u5b83\u76d1\u542c\u7aef\u53e3\u3002\\n\\n\u6700\u7ec8\uff0c\u6211\u4eec\u901a\u8fc7 [feat: allow privileged agent to listen port](https://github.com/api7/apisix-nginx-module/pull/71) \u548c [feat(prometheus): support collect metrics works in the priviledged agent](https://github.com/apache/apisix/pull/8434) \u5b9e\u73b0\u4e86\u65b9\u6848 2\u3002\\n\\n\u6211\u4eec\u4f7f\u7528\u5e26\u4e0a\u4e86\u8fd9\u4e2a\u4f18\u5316\u7684 APISIX \u6765\u6d4b\u8bd5\uff0c\u53d1\u73b0 P100 \u7684\u6307\u6807\u5ef6\u8fdf\u5df2\u7ecf\u964d\u4f4e\u5230\u5408\u7406\u7684\u8303\u56f4\u5185\uff0c\u957f\u5c3e\u8bf7\u6c42\u73b0\u8c61\u4e5f\u4e0d\u5b58\u5728\u4e86\u3002\\n\\n```text\\n  Latency Distribution (HdrHistogram - Uncorrected Latency (measured without taking delayed starts into account))\\n 50.000%    3.74ms\\n 75.000%    4.66ms\\n 90.000%    5.77ms\\n 99.000%    9.99ms\\n 99.900%   13.41ms\\n 99.990%   16.77ms\\n 99.999%   18.38ms\\n100.000%   18.40ms\\n```\\n\\n\u8fd9\u4e2a\u65b9\u6848\u6709\u4e9b\u5de7\u5999\uff0c\u4e5f\u89e3\u51b3\u4e86\u6700\u6838\u5fc3\u7684\u95ee\u9898\u3002\u6211\u4eec\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u89c2\u5bdf\u5e76\u9a8c\u8bc1\u4e86\u8fd9\u4e2a\u65b9\u6848\uff0c\u5b83\u6d88\u9664\u4e86\u957f\u5c3e\u8bf7\u6c42\u73b0\u8c61\uff0c\u4e5f\u6ca1\u6709\u9020\u6210\u5176\u4ed6\u989d\u5916\u7684\u5f02\u5e38\u3002\\n\u4e0e\u6b64\u540c\u65f6\uff0c\u6211\u4eec\u53d1\u73b0\u793e\u533a\u4e2d\u4e5f\u6709\u7c7b\u4f3c\u7684\u4fee\u590d\u65b9\u6848\uff0c\u6709\u5174\u8da3\u7684\u8bdd\u53ef\u4ee5\u5ef6\u4f38\u9605\u8bfb\uff1a[\u5982\u4f55\u4fee\u6539 Nginx \u6e90\u7801\u5b9e\u73b0 worker \u8fdb\u7a0b\u9694\u79bb](https://heapdump.cn/article/4822247)\u3002\\n\\n## \u5c55\u671b\\n\\n\u5728\u6211\u4eec\u4fee\u590d\u8fd9\u4e2a\u95ee\u9898\u7684\u65f6\u5019\uff0c\u4ea7\u751f\u4e86\u4e00\u4e2a\u65b0\u7684\u601d\u8003\uff1anginx-lua-prometheus \u8fd9\u4e2a\u5f00\u6e90\u5e93\u9002\u5408 APISIX \u5417\uff1f\\n\\n\u6211\u4eec\u5728 APISIX \u4fa7\u89e3\u51b3\u4e86 `prometheus:metric_data()` \u7684\u95ee\u9898\uff0c\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u53d1\u73b0\u4e86 nginx-lua-prometheus \u5b58\u5728\u7684\u5176\u4ed6\u95ee\u9898\uff0c\u5e76\u4e14\u4fee\u590d\u4e86\u3002\u6bd4\u5982[\u4fee\u590d\u5185\u5b58\u6cc4\u6f0f](https://github.com/knyar/nginx-lua-prometheus/pull/151)\uff0c\u4ee5\u53ca\u4fee\u590d [LRU \u7f13\u5b58\u6dd8\u6c70](https://github.com/knyar/nginx-lua-prometheus/pull/147)\u3002\\n\\nnginx-lua-prometheus \u521a\u5f00\u59cb\u662f\u88ab\u8bbe\u8ba1\u4e3a Nginx \u4f7f\u7528\uff0c\u5e76\u4e0d\u662f\u4e3a\u4e86 OpenResty \u4ee5\u53ca\u57fa\u4e8e OpenResty \u7684\u5e94\u7528\u6240\u8bbe\u8ba1\u7684\u3002OpenResty \u751f\u6001\u5185\u6ca1\u6709\u6bd4 nginx-lua-prometheus \u66f4\u6210\u719f\u7684\u5bf9\u63a5 Prometheus \u751f\u6001\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u56e0\u6b64 nginx-lua-prometheus \u4e0d\u65ad\u88ab\u5f00\u6e90\u793e\u533a\u7684\u529b\u91cf\u63a8\u52a8\u6210\u4e3a\u9002\u5408 OpenResty \u751f\u6001\u7684\u65b9\u5411\u3002\\n\\n\u4e5f\u8bb8\u6211\u4eec\u5e94\u8be5\u5c06\u89c6\u91ce\u653e\u5f97\u66f4\u5f00\u9614\u4e00\u4e9b\uff0c\u5bfb\u627e\u4e0d\u7528\u4fee\u6539 APISIX \u5e95\u5c42\u7684\u65b9\u5f0f\u6765\u5bf9\u63a5 Prometheus \u751f\u6001\u3002\u6bd4\u5982\u8bbe\u8ba1\u4e00\u4e2a\u66f4\u9002\u5408 APISIX \u7684\u4f9d\u8d56\u5e93\uff0c\u6216\u8005\u7528\u67d0\u79cd\u65b9\u5f0f\u5bf9\u63a5 Prometheus \u751f\u6001\u4e2d\u6210\u719f\u7684\u9879\u76ee\uff0c\u5c06\u6536\u96c6\u548c\u8ba1\u7b97 metrics \u7684\u8fc7\u7a0b\u8f6c\u79fb\u5230\u90a3\u4e9b\u6210\u719f\u7684\u9879\u76ee\u4e2d\u3002"},{"id":"API Gateway vs Load Balancer\uff1a\u9009\u62e9\u9002\u5408\u4f60\u7684\u7f51\u7edc\u6d41\u91cf\u7ba1\u7406\u7ec4\u4ef6","metadata":{"permalink":"/zh/blog/2023/03/03/api-gateway-vs-load-balancer","source":"@site/blog/2023/03/03/api-gateway-vs-load-balancer.md","title":"API Gateway vs Load Balancer\uff1a\u9009\u62e9\u9002\u5408\u4f60\u7684\u7f51\u7edc\u6d41\u91cf\u7ba1\u7406\u7ec4\u4ef6","description":"\u672c\u6587\u4ece\u5bf9\u6bd4\u4e86 API Gateway \u548c Load Balancer \u7684\u529f\u80fd\u533a\u522b\uff0c\u5e2e\u52a9\u8bfb\u8005\u66f4\u597d\u5730\u4e86\u89e3\u4ed6\u4eec\u5728\u7cfb\u7edf\u67b6\u6784\u4e2d\u626e\u6f14\u7684\u89d2\u8272\u3002","date":"2023-03-03T00:00:00.000Z","formattedDate":"2023\u5e743\u67083\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":12.945,"truncated":true,"authors":[{"name":"\u9648\u6cf5","title":"Author","url":"https://github.com/mscb402","image_url":"https://github.com/mscb402.png","imageURL":"https://github.com/mscb402.png"}],"prevItem":{"title":"\u4ece 1 \u79d2\u5230 10 \u6beb\u79d2\uff01\u5728 APISIX \u4e2d\u51cf\u5c11 Prometheus \u8bf7\u6c42\u963b\u585e","permalink":"/zh/blog/2023/03/06/the-mystery-of-prometheus-plugins-and-long-tail-requests"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (2.13 - 2.26)","permalink":"/zh/blog/2023/03/01/weekly-report-0301"}},"content":"> \u672c\u6587\u4ece\u5bf9\u6bd4\u4e86 API Gateway \u548c Load Balancer \u7684\u529f\u80fd\u533a\u522b\uff0c\u5e2e\u52a9\u8bfb\u8005\u66f4\u597d\u5730\u4e86\u89e3\u4ed6\u4eec\u5728\u7cfb\u7edf\u67b6\u6784\u4e2d\u626e\u6f14\u7684\u89d2\u8272\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u9648\u6cf5](https://github.com/mscb402)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\u3002\\n\\n\u7531\u4e8e\u4e92\u8054\u7f51\u6280\u672f\u7684\u53d1\u5c55\uff0c\u7f51\u7edc\u6570\u636e\u7684\u8bf7\u6c42\u6570\u8282\u8282\u6500\u5347\uff0c\u8fd9\u4f7f\u5f97\u670d\u52a1\u5668\u627f\u53d7\u7684\u538b\u529b\u8d8a\u6765\u8d8a\u5927\u3002\u5728\u65e9\u671f\u7684\u7cfb\u7edf\u67b6\u6784\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528 Load Balancer \u6765\u5c06\u7f51\u7edc\u6d41\u91cf\u5e73\u644a\u5230\u591a\u4e2a\u670d\u52a1\u5668\u4e2d\uff0c\u4ee5\u6b64\u51cf\u8f7b\u5355\u53f0\u670d\u52a1\u5668\u7684\u538b\u529b\u3002\u4f46\u662f\u73b0\u5982\u4eca\uff0c\u540e\u7aef\u670d\u52a1\u7684\u79cd\u7c7b\u5728\u4e0d\u65ad\u5730\u53d8\u591a\uff0c\u6bcf\u4e2a\u79cd\u7c7b\u7684\u540e\u7aef\u90fd\u4ee5 API \u7684\u5f62\u5f0f\u5bf9\u5916\u66b4\u9732\uff0c\u8fd9\u4f7f\u5f97 API \u7684\u6570\u91cf\u4e5f\u5728\u4e0d\u65ad\u53d8\u591a\u3002\u4ee5\u4f20\u7edf\u7684 Load Balancer \u4e3a\u4e3b\u7684\u7cfb\u7edf\u67b6\u6784\u7684\u5c40\u9650\u6027\u5c31\u53d8\u5f97\u660e\u663e\u8d77\u6765\uff0c\u56e0\u4e3a\u5b83\u4e3b\u8981\u5de5\u4f5c\u5728\u56db\u5c42\uff0c\u5728\u4e03\u5c42\u4e0a\u529f\u80fd\u8f83\u5f31\uff0c\u4e8e\u662f\u4e00\u6b3e\u4e3b\u8981\u5de5\u4f5c\u5728\u4e03\u5c42\u4e14\u5177\u6709\u4e30\u5bcc\u6269\u5c55\u80fd\u529b\u7684\u57fa\u7840\u8bbe\u65bd\u4fbf\u5e94\u8fd0\u800c\u751f\uff0c\u5b83\u5c31\u662f API Gateway\u3002\\n\\n\u5728\u672c\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u4ecb\u7ecd Load Balancer \u548c API Gateway \u7684\u529f\u80fd\u7279\u70b9\uff0c\u5e76\u63a2\u8ba8\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\uff0c\u5e2e\u52a9\u8bfb\u8005\u66f4\u597d\u5730\u4e86\u89e3\u8fd9\u4e24\u8005\u4e4b\u95f4\u7684\u5173\u7cfb\u3002\\n\\n## \u4e00\u3001\u4ec0\u4e48\u662f Load Balancer\\n\\n![what is load balancer](https://static.apiseven.com/uploads/2023/02/06/npYlQINW_1.png)\\n\\nLoad Balancer \u7684\u4e3b\u8981\u4f5c\u7528\u662f\u4e3a\u591a\u4e2a\u540e\u7aef\u670d\u52a1\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u529f\u80fd\uff0c\u4f9d\u636e\u4e0d\u540c\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u8ba9\u8fd9\u4e9b\u670d\u52a1\u53ef\u4ee5\u5206\u644a\u6d41\u91cf\u3002Load Balancer \u7684\u5386\u53f2\u975e\u5e38\u60a0\u4e45\uff0c\u4ece\u6f14\u8fdb\u8def\u5f84\u4e0a\u770b\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u8fd9\u51e0\u4e2a\u9636\u6bb5\uff1a\\n\\n- \u7b2c\u4e00\u9636\u6bb5\uff1a\u8fd9\u4e00\u9636\u6bb5\u7684 Load Balancer \u901a\u5e38\u7531\u786c\u4ef6\u8bbe\u5907\u7ec4\u6210\uff0c\u5177\u6709\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u9760\u6027\u7684\u7279\u70b9\uff0c\u4f46\u7075\u6d3b\u6027\u8f83\u5dee\uff0c\u4ef7\u683c\u6602\u8d35\u3002\u6bd4\u8f83\u5178\u578b\u7684\u662f F5 \u8fd9\u79cd\u57fa\u4e8e\u786c\u4ef6\u7684 Load Balancer \u3002\\n\\n- \u7b2c\u4e8c\u9636\u6bb5\uff1aLoad Balancer \u5f00\u59cb\u4ee5\u8f6f\u4ef6\u5f62\u5f0f\u5b9e\u73b0\uff0c\u4f7f\u5176\u66f4\u52a0\u7075\u6d3b\u548c\u53ef\u6269\u5c55\uff0c\u901a\u5e38\u4ee5\u8f6f\u4ef6\u5206\u53d1\u7684\u5f62\u5f0f\u51fa\u73b0\uff0c\u56e0\u6b64\u4ef7\u683c\u4e5f\u6bd4\u8f83\u4f4e\u5ec9\uff0c\u6bd4\u5982 LVS \u5c31\u5c5e\u4e8e\u8fd9\u4e00\u7c7b\u3002\\n\\n- \u7b2c\u4e09\u9636\u6bb5\uff1a\u968f\u7740\u4e91\u8ba1\u7b97\u6280\u672f\u7684\u5174\u8d77\uff0cLoad Balancer \u4e5f\u5f00\u59cb\u6709\u4e86\u4e91\u7248\u672c\uff0c\u8fd9\u4e2a\u7248\u672c\u7684 Load Balancer \u5176\u4e2d\u4e00\u4e2a\u597d\u5904\u662f\u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u4ee5\u66f4\u4f4e\u7684\u6210\u672c\u83b7\u5f97\u9ad8\u6027\u80fd\u7684\u8d1f\u8f7d\u5747\u8861\u670d\u52a1\uff0c\u53e6\u4e00\u4e2a\u597d\u5904\u662f\u5b83\u80fd\u591f\u5229\u7528\u4e91\u8ba1\u7b97\u7684\u53ef\u6269\u5c55\u6027\u548c\u5f39\u6027\u7684\u7279\u70b9\u6765\u63d0\u9ad8\u6574\u4f53\u53ef\u7528\u6027\u3002\u4f8b\u5982 AWS \u7684 Classic Load Balancer\u3001Application Load Balancer\u3001Network Load Balancer \u7b49\u3002\\n\\nLoad Balancer \u9664\u4e86\u7528\u4e8e\u5206\u644a\u6d41\u91cf\u3001\u63d0\u9ad8\u7f51\u7edc\u7684\u4f38\u7f29\u6027\u5916\uff0c\u8fd8\u53ef\u4ee5\u7528\u4e8e\u63d0\u5347\u7f51\u7edc\u5b89\u5168\u3002\u6bd4\u5982\u53ef\u4ee5\u5c06\u5185\u7f51\u670d\u52a1\u5668\u4e0e\u5916\u7f51\u8fdb\u884c\u9694\u79bb\uff0c\u9632\u6b62\u4e92\u8054\u7f51\u7684\u6076\u610f\u653b\u51fb\u548c\u8bbf\u95ee\u3002\u4e00\u4e2a\u7b80\u5355\u7684\u4f7f\u7528\u573a\u666f\u5c31\u662f\uff0c\u4e00\u4e2a\u5305\u542b\u654f\u611f\u4fe1\u606f\u7684\u5185\u90e8\u670d\u52a1\u5668\uff0cLoad Balancer \u53ef\u4ee5\u628a\u5185\u90e8\u670d\u52a1\u5668\u9694\u79bb\u5728\u5185\u7f51\u4e2d\uff0c\u8fd9\u6837\u5c31\u80fd\u6709\u6548\u4fdd\u62a4\u5185\u90e8\u670d\u52a1\u5668\u7684\u5b89\u5168\u3002\\n\\n## \u4e8c\u3001\u4ec0\u4e48\u662f API Gateway\\n\\n![what is api gateway](https://static.apiseven.com/uploads/2023/02/06/PUDzqJ5k_what-is-api-gateway.png)\\n\\nAPI Gateway \u7b80\u5355\u6765\u8bf4\u662f\u4e00\u79cd\u4e3b\u8981\u5de5\u4f5c\u5728\u4e03\u5c42\uff0c\u4e13\u95e8\u7528\u4e8e API \u7684\u7ba1\u7406\u548c\u6d41\u91cf\u8f6c\u53d1\u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\u62e5\u6709 Load Balancer \u6240\u4e0d\u5177\u5907\u7684\u5f3a\u5927\u7684\u6269\u5c55\u6027\uff0c\u6bd4\u5982\uff1a\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u3001\u81ea\u5b9a\u4e49\u63d2\u4ef6\u7b49\u7b49\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u4ee5\u4e0b\u8fd9\u4e9b\u7279\u70b9\uff1a\\n\\n- \u4e30\u5bcc\u7684\u8def\u7531\u7b56\u7565\uff1aAPI Gateway \u5de5\u4f5c\u5728\u4e03\u5c42\uff0c\u6240\u4ee5\u5b83\u53ef\u4ee5\u89e3\u6790\u5230 HTTP/HTTPS \u5c42\u7684\u6570\u636e\u3002\u56e0\u6b64\u5b83\u53ef\u4ee5\u6839\u636e\u8bf7\u6c42\u7684 Path \u6216 Domain \u751a\u81f3\u662f Header \u4f5c\u4e3a\u6761\u4ef6\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u4e0d\u540c\u7684\u4e0a\u6e38\u670d\u52a1\u5668\u3002\\n\\n- \u8ba4\u8bc1\uff1a\u53ef\u4ee5\u5728API\u5c42\u9762\u652f\u6301\u591a\u79cd\u591a\u6837\u7684\u8ba4\u8bc1\u65b9\u5f0f\u6765\u907f\u514d\u975e\u6cd5\u8bf7\u6c42\uff0c\u6bd4\u5982 OAuth2\u3001JWT \u7b49\u7b49\uff0c\u76f4\u63a5\u5c06\u8ba4\u8bc1\u8fd9\u90e8\u5206\u670d\u52a1\u72ec\u7acb\u51fa\u6765\uff0c\u4e0d\u4fb5\u5165\u6216\u8005\u5c11\u4fb5\u5165\u4e1a\u52a1\u4ee3\u7801\u3002\\n\\n- \u9650\u6d41\uff1a\u652f\u6301\u5bf9\u4e0d\u540c\u7a0b\u5ea6\u7684\u8def\u7531\u8fdb\u884c\u7ec6\u7c92\u5ea6\u7684\u9650\u6d41\uff0c\u9632\u6b62\u6076\u610f\u653b\u51fb\uff0c\u9632\u6b62\u540e\u7aef\u670d\u52a1\u96ea\u5d29\u3002\\n\\n- \u53ef\u89c2\u6d4b\u6027\uff1a\u53ef\u89c2\u5bdf\u6027\u662f\u6307\u4ece\u7cfb\u7edf\u5916\u90e8\u89c2\u5bdf\u7cfb\u7edf\u5185\u90e8\u7a0b\u5e8f\u7684\u8fd0\u884c\u72b6\u6001\u548c\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u7684\u80fd\u529b\u3002 API Gateway \u652f\u6301\u5c06\u65e5\u5fd7\u5bf9\u63a5\u5230 Kafka\u3001 Google Cloud Logging Service\u3001Elasticsearch \u7b49\uff0c\u652f\u6301\u5c06\u76f8\u5173 metrics \u63a5\u5165\u5230 prometheus\u3001datadog \u7b49\u3002\\n\\n- \u6269\u5c55\uff1a\u56e0\u4e3a API Gateway \u81ea\u8eab\u662f\u7f51\u5173\u8eab\u4efd\uff0c\u8fd9\u5c31\u6ce8\u5b9a\u5bf9\u5b83\u8981\u6c42\u662f\u80fd\u9002\u914d\u5404\u5bb6\u516c\u53f8\u4e0d\u540c\u5e94\u7528\u573a\u666f\uff0c\u6bd4\u5982\u4e0d\u540c\u7684\u9274\u6743\u3001\u7070\u5ea6\u3001\u5b89\u5168\u7b56\u7565\u3001\u65e5\u5fd7\u6536\u96c6\u7b49\uff0c\u5fc5\u987b\u5141\u8bb8\u7528\u6237\u81ea\u7531\u9009\u62e9\u6240\u9700\u6269\u5c55\u6216\u8005\u81ea\u5b9a\u4e49\u5f00\u53d1\uff0c\u56e0\u6b64\u6269\u5c55\u6027\u5f88\u5f3a\uff0c\u5141\u8bb8\u9009\u62e9\u7684\u6269\u5c55\u79cd\u7c7b\u4e5f\u5341\u5206\u4e30\u5bcc\u3002\u4ee5 Apache APISIX \u4e3e\u4f8b\uff0c\u5149\u662f\u8ba4\u8bc1\u7684\u6269\u5c55\u5c31\u6709 13 \u6b3e\uff0c\u51e0\u4e4e\u6db5\u76d6\u4e86\u5e02\u9762\u4e0a\u5e38\u89c1\u7684\u8ba4\u8bc1\u9700\u6c42\u3002\\n\\n\u76ee\u524d\u5e02\u9762\u4e0a\u6709\u8bb8\u591a API Gateway\uff0c\u6bd4\u5982 Apache APISIX\u3001Kong\u3001Tyk\u3001Zuul \u7b49\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684 API Gateway\u3002\\n\\n## \u4e09\u3001API Gateway \u4e0e Load Balancer \u4e3b\u8981\u533a\u522b\\n\\n![api gateway different with load balancer img 1](https://static.apiseven.com/uploads/2023/02/06/roVkkRLu_api-gateway-vs-lb-1.png)\\n\\n\u9996\u5148\uff0c\u4ed6\u4eec\u4e3b\u8981\u5de5\u4f5c\u7684\u4fa7\u91cd\u70b9\u4e0d\u540c\u3002\u867d\u7136\u8bf4 API Gateway \u548c Load Balancer \u90fd\u652f\u6301\u56db\u5c42\u548c\u4e03\u5c42\u7684\u4ee3\u7406\u3002\u4f46\u662f\uff0cAPI Gateway \u4e3b\u8981\u4fa7\u91cd\u4e8e\u4e03\u5c42\uff0c\u800c Load Balancer \u4e3b\u8981\u4fa7\u91cd\u4e8e\u56db\u5c42\u3002\\n\\n\u5de5\u4f5c\u5728\u56db\u5c42\u7684 Load Balancer \u62e5\u6709\u8bb8\u591a\u6709\u5229\u7684\u7279\u70b9\uff0c\u9996\u5148\u662f\u5b83\u76f8\u6bd4\u4e8e API Gateway \u51cf\u5c11\u4e86\u534f\u8bae\u89e3\u6790\u7684\u635f\u8017\uff0c\u5177\u6709\u66f4\u5f3a\u7684\u541e\u5410\u80fd\u529b\u3002\u5176\u6b21\u5c31\u662f\u5b83\u652f\u6301\u900f\u4f20\u5ba2\u6237\u7aef IP \u5730\u5740\uff0c\u800c API Gateway\uff0c\u4e00\u822c\u662f\u901a\u8fc7 HTTP \u5934\u65b9\u5f0f\u4f20\u9012\u5ba2\u6237\u7aef IP \u5730\u5740\u3002\\n\\n![api gateway different with load balancer img 2](https://static.apiseven.com/uploads/2023/02/06/S25JMIe9_api-gateway-vs-lb-2.png)\\n\\n\u5176\u6b21\u5c31\u662f\u529f\u80fd\u7684\u4e30\u5bcc\u7a0b\u5ea6\u4e0d\u540c\u3002Load Balancer \u7684 HTTP \u4e03\u5c42\u5904\u7406\u80fd\u529b\u6bd4\u8f83\u5f31\uff0c\u5f80\u5f80\u4e0d\u5305\u542b\u8ba4\u8bc1\u3001\u6388\u6743\u3001\u9274\u6743\u3001\u590d\u6742\u8def\u7531\u903b\u8f91\u3001\u65e5\u5fd7\u6536\u96c6\u7b49\u529f\u80fd\u3002API Gateway \u5219\u5177\u6709\u76f8\u5f53\u5f3a\u5927\u7684\u4e03\u5c42\u534f\u8bae\u5904\u7406\u80fd\u529b\uff0c\u53ef\u4ee5\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u9644\u52a0\u5404\u79cd\u5404\u6837\u7684\u529f\u80fd\u6269\u5c55\uff0c\u6bd4\u5982\u6743\u9650\u63a7\u5236\u3001\u65e5\u5fd7\u3001API \u7ba1\u7406\u3001Serverless \u7b49\u7b49\u3002\\n\\n\u73b0\u5982\u4eca\uff0c\u79d1\u6280\u516c\u53f8\u7684\u4ea7\u54c1\u9700\u6c42\u53d8\u5e7b\u83ab\u6d4b\uff0c\u5bf9\u4e8e\u5f88\u591a\u516c\u53f8\u6765\u8bf4\u652f\u6301\u81ea\u5b9a\u4e49\u5f00\u53d1\u662f\u521a\u9700\u3002API Gateway \u652f\u6301\u5404\u5f0f\u7684\u81ea\u5b9a\u4e49\u5f00\u53d1\uff0c\u6bd4\u5982\u652f\u6301\u4e30\u5bcc\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u652f\u6301\u5728\u6d41\u91cf\u8f6c\u53d1\u7684\u4e0d\u540c\u9636\u6bb5\u6ce8\u5165\u81ea\u5b9a\u4e49\u7684\u5904\u7406\u903b\u8f91\uff0c\u800c Load Balancer \u57fa\u672c\u4e0d\u652f\u6301\u4efb\u4f55\u81ea\u5b9a\u4e49\u529f\u80fd\u5f00\u53d1\u3002\\n\\n\u8fd8\u6709\u4e00\u70b9\u5c31\u662f Load Balancer \u901a\u5e38\u91c7\u7528\u6d41\u91cf\u76f4\u63a5\u5206\u53d1\u7684\u5f62\u5f0f\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u5b83\u901a\u8fc7\u7b97\u6cd5\u5c06\u6d41\u91cf\u6570\u636e\u76f4\u63a5\u53d1\u5411\u67d0\u4e2a\u540e\u7aef\u670d\u52a1\u5668\u8282\u70b9\u3002\u8fd9\u610f\u5473\u7740\u540e\u7aef\u7b49\u5f85\u63a5\u6536\u6d41\u91cf\u7684\u6bcf\u4e00\u4e2a\u670d\u52a1\u5b9e\u4f8b\u884c\u4e3a\u90fd\u5fc5\u987b\u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u51cf\u5c11\u4e86\u4e00\u5b9a\u7684\u7075\u6d3b\u6027\u3002\u800c API Gateway \u5219\u662f\u4ee5 URL Path \u3001Domain\u3001Header \u7b49\u7ef4\u5ea6\u8fdb\u884c\u6d41\u91cf\u5206\u53d1\uff0c\u540e\u7aef\u7b49\u5f85\u63a5\u6536\u6d41\u91cf\u7684\u670d\u52a1\u5b9e\u4f8b\u53ef\u4ee5\u591a\u79cd\u591a\u6837\uff0c\u53ef\u4ee5\u662f\u67d0\u4e2a Private API\uff0c\u4e5f\u53ef\u4ee5\u662f\u67d0\u4e2a gRPC \u7684 API\u3002\u8fd9\u5c31\u4f7f\u6d41\u91cf\u5206\u53d1\u53d8\u5f97\u5341\u5206\u5730\u7075\u6d3b\u3002\\n\\n## \u56db\u3001\u4f7f\u7528\u573a\u666f\\n\\n### \u5fae\u670d\u52a1\u573a\u666f\\n\\n![in microservice screen](https://static.apiseven.com/uploads/2023/02/06/njZDrvwk_microservice-screen.png)\\n\\nAPI Gateway \u5bf9\u4e8e\u5fae\u670d\u52a1\u67b6\u6784\u7684\u7cfb\u7edf\u662f\u521a\u9700\u3002\u9996\u5148\u5b83\u53ef\u4ee5\u65b9\u4fbf\u5730\u7ba1\u7406\u548c\u8def\u7531\u591a\u79cd\u4e0d\u540c\u7684\u540e\u7aef\u670d\u52a1\uff0c\u5176\u6b21\u53ef\u4ee5\u63d0\u4f9b\u8bb8\u591a\u9ad8\u7ea7\u529f\u80fd\uff0c\u6bd4\u5982\u8eab\u4efd\u9a8c\u8bc1\u3001\u6388\u6743\u3001\u9650\u6d41\u3001\u8f6c\u53d1\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\u529f\u80fd\u3002\u8fd9\u6837\u4e0d\u540c\u7684\u5fae\u670d\u52a1\u4e4b\u95f4\u65e0\u9700\u91cd\u590d\u5b9e\u73b0\u9650\u6d41\u3001\u8ba4\u8bc1\u7b49\u529f\u80fd\uff0c\u8ba9\u5fae\u670d\u52a1\u7684\u6bcf\u4e2a\u670d\u52a1\u7684\u529f\u80fd\u5b9e\u73b0\u66f4\u52a0\u7eaf\u7cb9\uff0c\u51cf\u5c11\u7814\u53d1\u6210\u672c\u3002\\n\\n\u7531\u4e8e\u5fae\u670d\u52a1\u7684\u7279\u70b9\u662f\u670d\u52a1\u79cd\u7c7b\u591a\uff0c\u5de5\u4f5c\u5728\u56db\u5c42\u7684 Load Balancer \u4e0d\u592a\u9002\u5408\u5bf9\u79cd\u7c7b\u7e41\u591a\u540e\u7aef\u670d\u52a1\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u5b83\u66f4\u9002\u5408\u7528\u4e8e\u5355\u4f53\u540e\u7aef\u670d\u52a1\u3002\u5373\u4f7f\u662f\u5de5\u4f5c\u5728\u4e03\u5c42\u7684 Load Balancer\uff0c\u56e0\u4e3a\u4e00\u822c\u4e0d\u80fd\u63d0\u4f9b\u8f83\u4e3a\u4e30\u5bcc\u7684\u9ad8\u7ea7\u529f\u80fd\uff0c\u76f8\u6bd4\u4e8e API Gateway \u5728\u5fae\u670d\u52a1\u4e0a\u4f18\u52bf\u4e5f\u4e0d\u660e\u663e\u3002\\n\\n### API \u7ba1\u7406\u4e0e\u53d1\u5e03\\n\\n\u5728\u9700\u8981\u5bf9\u5927\u91cf\u7684 API \u8fdb\u884c\u7ba1\u7406\u548c\u53d1\u5e03\u7684\u573a\u666f\uff0cAPI Gateway \u4e5f\u975e\u5e38\u9002\u7528\uff0c\u56e0\u4e3a\u5b83\u5177\u6709\u5f3a\u5927\u7684 API \u7ba1\u7406\u529f\u80fd\uff0c\u53ef\u4ee5\u8ba9\u4f60\u968f\u65f6\u968f\u5730\u8ba9\u67d0\u4e2a API \u4e0a\u7ebf\u6216\u8005\u4e0b\u7ebf\uff0c\u5feb\u901f\u5730\u4fee\u6539 API \u8f6c\u53d1\u7684\u914d\u7f6e\uff0c\u5feb\u901f\u5730\u4e3a\u67d0\u4e2a API \u6dfb\u52a0\u9650\u6d41\u3001\u8ba4\u8bc1\u3001\u65e5\u5fd7\u7b49\u7b49\u529f\u80fd\u800c\u65e0\u9700\u91cd\u65b0\u542f\u52a8 API Gateway\u3002\\n\\n\u4ee5 Apache APISIX \u4e3a\u4f8b\uff0cApache APISIX \u662f Apache \u57fa\u91d1\u4f1a\u65d7\u4e0b\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u662f\u5f53\u524d\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u3002\u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0cApache APISIX \u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\n![apisix dashboard screenshot image 1](https://static.apiseven.com/uploads/2023/02/10/rMQQXaaA_apisix-dashboard-router.png)\\n\\n![apisix dashboard screenshot image 12](https://static.apiseven.com/uploads/2023/02/06/rYEyFHcM_apisix-dashboard2.png)\\n\\n\u800c\u4f20\u7edf\u7684 Load Balancer \u5219\u5728 API \u7ba1\u7406\u4e0a\u8f83\u4e3a\u5f31\u52bf\uff0c\u4e0d\u5177\u5907\u5982\u6b64\u4e30\u5bcc\u7684\u9ad8\u7ea7\u529f\u80fd\u3002\\n\\n### \u9ad8\u6027\u80fd\u7684\u7f51\u7edc\u51fa\u5165\u53e3\\n\\n\u5bf9\u4e8e\u9700\u8981\u5927\u6d41\u91cf\u3001\u6781\u9ad8\u7a33\u5b9a\u6027\u7684\u7f51\u7edc\u51fa\u5165\u53e3\u7684\u573a\u666f\uff0c\u5de5\u4f5c\u5728\u56db\u5c42\u7684 Load Balancer \u663e\u7136\u66f4\u4e3a\u9002\u7528\u3002\u5b83\u53ef\u4ee5\u628a\u7f51\u7edc\u539f\u59cb\u56db\u5c42\u6d41\u91cf\u76f4\u63a5\u5206\u53d1\u5230\u5404\u4e2a\u540e\u7aef\u670d\u52a1\u4e2d\uff0c\u4e0d\u5b58\u5728\u4e2d\u95f4\u5c42\u591a\u6b21\u89e3\u6790\u5e94\u7528\u5c42\u534f\u8bae\u7684\u5f71\u54cd\uff0c\u5177\u6709\u66f4\u5f3a\u7684\u541e\u5410\u80fd\u529b\u3002\\n\\n\u800c\u5de5\u4f5c\u5728\u4e03\u5c42\u7684 API Gateway \u4f5c\u4e3a\u7edf\u4e00\u7684\u5165\u53e3\uff0c\u4f1a\u7531\u4e8e\u9700\u8981\u89e3\u6790\u534f\u8bae\uff0c\u5b58\u5728\u4e00\u5b9a\u7684\u541e\u5410\u91cf\u9650\u5236\u3002\u5373\u4f7f\u662f\u4f7f\u7528\u56db\u5c42\u7684 API Gateway \u6765\u505a\u7f51\u7edc\u51fa\u5165\u53e3\u4e5f\u4e0d\u592a\u6709\u4f18\u52bf\uff0c\u56e0\u4e3a\u8fd9\u4e00\u5c42\u4e0d\u662f API Gateway \u7684\u4fa7\u91cd\u70b9\uff0c\u76f8\u6bd4\u4e8e Load Balancer \u591a\u5e74\u5728\u8fd9\u4e00\u5c42\u7684\u6280\u672f\u7d2f\u8ba1\uff0cAPI Gateway \u4f18\u52bf\u4e5f\u4e0d\u660e\u663e\u3002\\n\\n## \u56db\u3001\u603b\u7ed3\\n\\n\u603b\u7684\u6765\u8bf4\uff0cAPI Gateway \u548c Load Balancer \u662f\u5206\u522b\u7528\u4e8e\u89e3\u51b3\u4e0d\u540c\u5c42\u9762\u95ee\u9898\u7684\u57fa\u7840\u8bbe\u65bd\u3002API Gateway \u4e3b\u8981\u7528\u4e8e\u4f5c\u4e3a\u540e\u7aef\u7684 API \u63a5\u53e3\u4ee3\u7406\uff0c\u63d0\u4f9b\u5bf9\u5916\u8bbf\u95ee\u4e0d\u540c\u79cd\u7c7b API \u7684\u4e00\u4e2a\u5355\u72ec\u5165\u53e3\uff0c\u5e76\u4e14\u53ef\u4ee5\u63d0\u4f9b\u72ec\u7acb\u4e8e\u540e\u7aef\u670d\u52a1\u7684\u9650\u6d41\u3001\u8ba4\u8bc1\u3001\u76d1\u63a7\u7b49\u529f\u80fd\uff1b\u800c Load Balancer \u5219\u4e3b\u8981\u7528\u4e8e\u56db\u5c42\u6d41\u91cf\u5206\u53d1\uff0c\u5b83\u53ef\u4ee5\u5c06\u8bf7\u6c42\u5206\u644a\u5230\u591a\u53f0\u540e\u7aef\u670d\u52a1\u5668\u4e0a\uff0c\u5e73\u8861\u540e\u7aef\u7684\u8bf7\u6c42\u8d1f\u8f7d\uff0c\u4ee5\u63d0\u9ad8\u7cfb\u7edf\u7684\u6574\u4f53\u53ef\u7528\u6027\u548c\u5bb9\u9519\u6027\u3002\\n\\n\u5728\u5408\u7406\u7684\u67b6\u6784\u8bbe\u8ba1\u4e0b\uff0c\u4e00\u822c\u90fd\u5c06 API Gateway \u548c Load Balancer \u914d\u5408\u4f7f\u7528\uff0c\u4f7f\u7528 Load Balancer \u4f5c\u4e3a\u6574\u4e2a\u7cfb\u7edf\u7684\u7f51\u7edc\u51fa\u5165\u53e3\uff0c\u5c06\u6d41\u91cf\u5206\u53d1\u5230\u591a\u4e2a API Gateway \u5b9e\u4f8b\uff0c\u7136\u540e\u6bcf\u4e2a API Gateway \u5b9e\u4f8b\u5206\u522b\u5bf9\u8bf7\u6c42\u8fdb\u884c\u8def\u7531\u3001\u8ba4\u8bc1\u3001\u9274\u6743\u7b49\u64cd\u4f5c\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u6574\u4e2a\u7f51\u7edc\u66f4\u52a0\u7a33\u5065\u3001\u53ef\u9760\u3001\u53ef\u6269\u5c55\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (2.13 - 2.26)","metadata":{"permalink":"/zh/blog/2023/03/01/weekly-report-0301","source":"@site/blog/2023/03/01/weekly-report-0301.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (2.13 - 2.26)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-03-01T00:00:00.000Z","formattedDate":"2023\u5e743\u67081\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.16,"truncated":true,"authors":[],"prevItem":{"title":"API Gateway vs Load Balancer\uff1a\u9009\u62e9\u9002\u5408\u4f60\u7684\u7f51\u7edc\u6d41\u91cf\u7ba1\u7406\u7ec4\u4ef6","permalink":"/zh/blog/2023/03/03/api-gateway-vs-load-balancer"},"nextItem":{"title":"API \u7f51\u5173\u65e5\u5fd7\u7684\u4ef7\u503c\uff0c\u4f60\u4e86\u89e3\u591a\u5c11\uff1f","permalink":"/zh/blog/2023/02/28/transforming-logs-for-ingestion-into-your-observability-stack"}},"content":"> \u4ece 2023.2.13 - 2023.2.26\uff0c\u6709 23 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 51 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u793e\u533a\u7684\u65b0\u624b\u4eec\u53c2\u52a0\u7684 Issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/02/28/gOoFu4SE_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5-04%E6%9C%9F.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/02/27/KGpNS2ST_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E6%96%B0%E6%99%8B%E6%B5%B7%E6%8A%A5-04%E6%9C%9F.png)\\n\\n## Good First Issue\\n\\n### Issue #8772\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/8772\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5bf9 OIDC \u8ba4\u8bc1\u76f8\u5173\u7684\u81ea\u5b9a\u4e49\u914d\u7f6e\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4ee5\u4fbf\u7528\u6237\u5bf9\u4e0d\u5408\u89c4\u914d\u7f6e\u9650\u5236\u5176\u5411\u540e\u7aef\u8bbf\u95ee\u3002\\n\\n### Issue #1075\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1075\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4e3a APISIX Ingress \u589e\u52a0\u4f7f\u7528 apisix:dev \u7684\u56de\u5f52\u6d4b\u8bd5\uff0c\u4ee5\u4fbf\u5c3d\u65e9\u53d1\u73b0\u4e0e APISIX \u6700\u65b0\u4fee\u6539\u7684\u517c\u5bb9\u95ee\u9898\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [`opentelemetry` \u63d2\u4ef6\u63d0\u4f9b HTTPS \u4e0a\u6e38\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8823)\uff08\u8d21\u732e\u8005\uff1a[yangxikun](https://github.com/yangxikun)\uff09\\n\\n- [Admin API \u63d0\u4f9b head \u65b9\u6cd5\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8752)\uff08\u8d21\u732e\u8005\uff1a[An-DJ](https://github.com/An-DJ)\uff09\\n\\n- [Stream \u4ee3\u7406\u6a21\u5f0f\u63d0\u4f9b tars \u670d\u52a1\u53d1\u73b0\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8826)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\n- [`request-id` \u63d2\u4ef6\u6dfb\u52a0 `range_id` \u7b97\u6cd5\u751f\u6210 UniqueID \u652f\u6301\u3002](https://github.com/apache/apisix/pull/8826)\uff08\u8d21\u732e\u8005\uff1a[jiangfucheng](https://github.com/jiangfucheng)\uff09\\n\\n- [\u63d0\u4f9b\u4ece\u73af\u5883\u53d8\u91cf\u4e2d\u83b7\u53d6 `VAULT_TOKEN` \u7684\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8866)\uff08\u8d21\u732e\u8005\uff1a[shreemaan-abhishek](https://github.com/shreemaan-abhishek)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [RESTful API \u4e3a\u4f55\u6210\u4e3a\u9876\u6d41 API \u67b6\u6784\u98ce\u683c\uff1f](https://apisix.apache.org/zh/blog/2023/02/08/what-is-restful-api/)\\n\\n    \u672c\u6587\u5c06\u4ecb\u7ecd\u4ec0\u4e48\u662f RESTful API \u4ee5\u53ca\u6211\u4eec\u5982\u4f55\u4f7f\u7528\u5b83\u3002\\n\\n- [APISIX Ingress \u5982\u4f55\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66](https://apisix.apache.org/zh/blog/2023/02/07/apisix-ingress-with-cert-mamager/)\\n\\n    Cert Manager \u89e3\u51b3\u4e86 Kubernetes \u4e2d\u8bc1\u4e66\u7684\u9ed8\u8ba4\u5b58\u50a8\u65b9\u5f0f\u7684\u75db\u70b9\uff0c\u5e76\u9010\u6b65\u6210\u4e3a\u4e86 Kubernetes \u751f\u6001\u4e2d\u8bc1\u4e66\u7b7e\u53d1\u548c\u7ba1\u7406\u9886\u57df\u4e2d\u7684\u4e8b\u5b9e\u6807\u51c6\u3002\\n\\n- [API \u7f51\u5173\u7b56\u7565\u7684\u4e8c\u4e09\u4e8b](https://apisix.apache.org/zh/blog/2023/01/30/something-about-api-gateway-policy/)\\n\\n    \u8fd9\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f API \u7f51\u5173\u7b56\u7565\uff0c\u5e76\u9488\u5bf9\u8ba4\u8bc1\u6388\u6743\u3001\u5b89\u5168\u3001\u6d41\u91cf\u5904\u7406\u4e0e\u53ef\u89c2\u6d4b\u6027\u8fd9\u56db\u7c7b API \u7f51\u5173\u4e2d\u5e38\u7528\u7684\u7b56\u7565\u8fdb\u884c\u63cf\u8ff0\u3002"},{"id":"API \u7f51\u5173\u65e5\u5fd7\u7684\u4ef7\u503c\uff0c\u4f60\u4e86\u89e3\u591a\u5c11\uff1f","metadata":{"permalink":"/zh/blog/2023/02/28/transforming-logs-for-ingestion-into-your-observability-stack","source":"@site/blog/2023/02/28/transforming-logs-for-ingestion-into-your-observability-stack.md","title":"API \u7f51\u5173\u65e5\u5fd7\u7684\u4ef7\u503c\uff0c\u4f60\u4e86\u89e3\u591a\u5c11\uff1f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 API \u7f51\u5173\u65e5\u5fd7\u7684\u4ef7\u503c\uff0c\u5e76\u4ee5\u77e5\u540d\u7f51\u5173 Apache APISIX \u4e3a\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u96c6\u6210 API \u7f51\u5173\u65e5\u5fd7\u3002","date":"2023-02-28T00:00:00.000Z","formattedDate":"2023\u5e742\u670828\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.03,"truncated":true,"authors":[{"name":"\u94b1\u52c7","title":"Author","url":"https://github.com/nic-6443","image_url":"https://github.com/nic-6443.png","imageURL":"https://github.com/nic-6443.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (2.13 - 2.26)","permalink":"/zh/blog/2023/03/01/weekly-report-0301"},"nextItem":{"title":"APISIX \u662f\u600e\u4e48\u4fdd\u62a4\u7528\u6237\u7684\u654f\u611f\u6570\u636e\u4e0d\u88ab\u6cc4\u9732\u7684\uff1f","permalink":"/zh/blog/2023/02/23/how-to-prevent-sensitive-data-from-leaking"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 API \u7f51\u5173\u65e5\u5fd7\u7684\u4ef7\u503c\uff0c\u5e76\u4ee5\u77e5\u540d\u7f51\u5173 Apache APISIX \u4e3a\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u96c6\u6210 API \u7f51\u5173\u65e5\u5fd7\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u94b1\u52c7](https://github.com/nic-6443)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\uff0cApache APISIX Committer\\n\\n## \u7f51\u5173\u65e5\u5fd7\u7684\u4ef7\u503c\\n\\n\u5728\u6570\u5b57\u5316\u65f6\u4ee3\uff0c\u8f6f\u4ef6\u67b6\u6784\u968f\u7740\u4e1a\u52a1\u6210\u957f\u800c\u53d8\u5f97\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u8fd9\u7ed9\u6545\u969c\u7684\u53d1\u73b0\u548c\u6392\u67e5\u90fd\u5e26\u6765\u4e86\u975e\u5e38\u5927\u7684\u6311\u6218\uff0c\u8fdb\u4e00\u6b65\u5012\u903c\u8f6f\u4ef6\u91cd\u89c6\u81ea\u8eab\u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u3002\\n\u800c**\u65e5\u5fd7\u88ab\u79f0\u4e3a\u53ef\u89c2\u6d4b\u6027\u7684\u4e09\u5927\u652f\u67f1\u4e4b\u4e00**\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u7cfb\u7edf\u7ba1\u7406\u5458\u548c\u5f00\u53d1\u4eba\u5458\u4e86\u89e3\u7cfb\u7edf\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u4ee5\u4fbf\u80fd\u591f\u53ca\u65f6\u53d1\u73b0\u5e76\u89e3\u51b3\u95ee\u9898\u3002\\n\u6b64\u5916\uff0c\u65e5\u5fd7\u8fd8\u53ef\u4ee5\u7528\u4e8e\u6570\u636e\u6316\u6398\u3001\u5ba1\u8ba1\u548c\u5b89\u5168\u76d1\u63a7\u7b49\u65b9\u5411\uff0c\u4ee5\u786e\u4fdd\u7cfb\u7edf\u7684\u5408\u89c4\u6027\u548c\u5b89\u5168\u6027\u3002\\n\\n\u800c API \u7f51\u5173\u662f\u5728\u5e94\u7528\u7a0b\u5e8f\u4e0e\u5916\u90e8\u4e16\u754c\u4e4b\u95f4\u6784\u5efa\u7684\u4e00\u9053\u5173\u53e3\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u7ec4\u7ec7\u66f4\u597d\u5730\u7ba1\u7406\u548c\u76d1\u63a7 API \u8c03\u7528\uff0c\u5176\u4e2d\u4e4b\u4e00\u91cd\u8981\u7684\u529f\u80fd\u5c31\u662f\u5bf9\u4e8e API \u8c03\u7528\u65e5\u5fd7\u7684\u8bb0\u5f55\u3002\\n\\n![API Gateway Log](https://static.apiseven.com/uploads/2023/01/29/q5vt6NM5_api-gateway-log.png)\\n\\n\u4e0b\u9762\u5c06\u4f1a\u4ece\u4e24\u4e2a\u89d2\u5ea6\u6765\u5206\u6790 API \u7f51\u5173\u65e5\u5fd7\u7684\u4ef7\u503c\u3002\\n\\n### \u8fd0\u7ef4\u4ef7\u503c\\n\\n\u65e0\u8bba\u662f\u4f20\u7edf\u7cfb\u7edf\u8fd0\u7ef4\uff0c\u8fd8\u662f\u73b0\u4ee3\u7f51\u7ad9\u53ef\u9760\u6027\u5de5\u7a0b\u5e08\uff08SRE\uff09\uff0c\u5bf9\u4e8e\u4fdd\u969c\u7cfb\u7edf\u7a33\u5b9a\u6027\u8fd9\u4e2a\u5927\u76ee\u6807\u800c\u8a00\uff0c\u5982\u4f55\u53d1\u73b0\u6545\u969c\u6c38\u8fdc\u662f\u6392\u5728\u6700\u9ad8\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u4efb\u4f55\u4e00\u4e2a\u5927\u578b\u7684\u5728\u7ebf\u4e1a\u52a1\uff0c\u6bcf\u4e00\u79d2\u7684\u6545\u969c\u65f6\u95f4\u90fd\u53ef\u80fd\u4f1a\u5e26\u6765\u5de8\u5927\u7684\u4e1a\u52a1\u635f\u5931\u548c\u7528\u6237\u4f53\u9a8c\u4f24\u5bb3\u3002\\n\\n\u800c API \u7f51\u5173\u5904\u4e8e\u6574\u4e2a\u7cfb\u7edf\u7684\u6700\u524d\u7aef\uff0c\u5b83\u53ef\u4ee5\u626e\u6f14\u4e00\u4e2a\u201c\u54e8\u5175\u201d\u7684\u89d2\u8272\uff0c\u8ba9\u6211\u4eec\u4ece\u5b83\u7684\u8bbf\u95ee\u65e5\u5fd7\u4e2d\u63d0\u53d6\u975e\u5e38\u591a\u5bf9\u4e8e\u8fd0\u7ef4\u4f53\u7cfb\u81f3\u5173\u91cd\u8981\u7684\u6307\u6807\u6570\u636e\uff1a\\n\\n- \u901a\u8fc7\u4e0a\u3001\u4e0b\u6e38\u72b6\u6001\u7801\u5206\u6790\uff0c\u76d1\u63a7\u7f51\u7ad9\u6574\u4f53\u53ef\u7528\u6027\u548c\u5177\u4f53\u4e0a\u6e38\u670d\u52a1\u7684\u53ef\u7528\u6027\uff1b\\n- \u901a\u8fc7\u8bbf\u95ee\u65e5\u5fd7\u6574\u4f53\u7edf\u8ba1\uff0c\u76d1\u63a7\u7f51\u7ad9\u6d41\u91cf\uff0c\u53ca\u65f6\u53d1\u73b0 DDoS \u4e00\u7c7b\u7684\u653b\u51fb\uff1b\\n- \u6d41\u91cf\u7684\u8d8b\u52bf\u5206\u6790\u53ef\u4ee5\u4f5c\u4e3a\u4e1a\u52a1\u7cfb\u7edf\u6269\u7f29\u5bb9\u7684\u53c2\u8003\u4f9d\u636e\uff1b\\n- \u8bf7\u6c42\u8017\u65f6\u7edf\u8ba1\uff0c\u4e3a\u4e1a\u52a1\u7cfb\u7edf\u63d0\u4f9b\u63a5\u53e3\u7ea7\u522b\u7684\u6027\u80fd\u62a5\u544a\uff0c\u4f5c\u4e3a\u4e1a\u52a1\u7cfb\u7edf\u6027\u80fd\u4f18\u5316\u7684\u6570\u636e\u53c2\u8003\u3002\\n\\n\u4ee5\u4e0a\u90fd\u662f\u4e00\u4e9b\u5728\u4e1a\u754c\u88ab\u5e7f\u6cdb\u91c7\u7528\u7684 API \u7f51\u5173\u65e5\u5fd7\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u5728\u5f88\u591a\u4f01\u4e1a\u7684\u8fd0\u7ef4\u4f53\u7cfb\u4e2d\u843d\u5730\u3002\\n\\n### \u4e1a\u52a1\u4ef7\u503c\\n\\n\u4e0e\u8fd0\u7ef4\u4ef7\u503c\u88ab\u5e7f\u6cdb\u8ba4\u53ef\u76f8\u6bd4\uff0c\u7f51\u5173\u65e5\u5fd7\u7684\u4e1a\u52a1\u4ef7\u503c\u5f80\u5f80\u662f\u88ab\u4eba\u4eec\u6240\u5ffd\u89c6\u7684\u3002\\n\u4f8b\u5982\u5728\u7528\u6237\u884c\u4e3a\u5206\u6790\u9886\u57df\uff0c\u5728\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u7f16\u7801\u7684\u65b9\u5f0f\u8fdb\u884c\u57cb\u70b9\u4e0a\u62a5\u662f\u6700\u5e38\u89c1\u7684\u6570\u636e\u6536\u96c6\u65b9\u5f0f\uff0c\u800c\u5bf9\u4e8e\u4e00\u5957\u8bbe\u8ba1\u826f\u597d\u7684 API \u6765\u8bf4\uff0c\u7f51\u5173\u65e5\u5fd7\u662f\u53ef\u4ee5\u5929\u7136\u652f\u6301\u6b64\u7c7b\u9700\u6c42\u7684\u3002\u6211\u4eec\u53ef\u4ee5\uff1a\\n\\n- \u901a\u8fc7\u5206\u6790\u5ba2\u6237\u7aef IP\uff0c\u7edf\u8ba1\u6d41\u91cf\u7684\u5730\u7406\u4f4d\u7f6e\u5206\u5e03\uff1b\\n- \u901a\u8fc7\u5206\u6790 HTTP Referer\uff0c\u4e86\u89e3\u7528\u6237\u8fdb\u5165\u5404\u4e2a\u9875\u9762\u7684\u6765\u6e90\uff1b\\n- \u5bf9\u4e8e\u91cd\u70b9 API \u7684\u805a\u5408\u7edf\u8ba1\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u5173\u952e\u4e1a\u52a1\u6307\u6807\u3002\u4f8b\uff1a\u7edf\u8ba1\u7528\u6237\u6ce8\u518c\u3001\u5546\u54c1\u4e0b\u5355\u7b49 API \u7684\u6210\u529f\u8c03\u7528\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u6307\u5b9a\u65f6\u95f4\u6bb5\u5185\u7684\u65b0\u7528\u6237\u3001\u65b0\u8ba2\u5355\u7684\u6570\u91cf\u6307\u6807\u3002\\n\\n\u5f53\u7136\u7f51\u5173\u65e5\u5fd7\u663e\u7136\u4e0d\u5982\u7a0b\u5e8f\u57cb\u70b9\u7075\u6d3b\uff0c\u65e0\u6cd5\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6570\u636e\u6536\u96c6\u9700\u6c42\uff0c\u4f46\u5176\u4e2d\u8574\u85cf\u7684\u4e1a\u52a1\u4ef7\u503c\u8db3\u4ee5\u6ee1\u8db3\u7b80\u5355\u7684\u6570\u636e\u6316\u6398\u9700\u6c42\u3002\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\u5b83\u7684\u5f88\u591a\u80fd\u529b\u662f\u901a\u8fc7\u53ef\u63d2\u62d4\u7684\u63d2\u4ef6\u5f62\u5f0f\u63d0\u4f9b\uff0c\u8fd9\u5176\u4e2d\u5c31\u5305\u62ec\u5341\u6570\u4e2a\u65e5\u5fd7\u63d2\u4ef6\u3002\u4e0b\u9762\u5c06\u4f1a\u4ee5 APISIX \u4e2d\u5178\u578b\u7684\u65e5\u5fd7\u63d2\u4ef6\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u5982\u4f55\u5c06\u7f51\u5173\u65e5\u5fd7\u4e0e\u65e5\u5fd7\u5206\u6790\u7cfb\u7edf\u6253\u901a\uff0c\u6316\u6398\u51fa\u66f4\u591a\u7684\u4ef7\u503c\u3002\\n\\n## APISIX \u5178\u578b\u65e5\u5fd7\u63d2\u4ef6\u4ecb\u7ecd\\n\\n### elasticsearch-logger\\n\\n![Elastic Search And Apache APISIX](https://static.apiseven.com/uploads/2023/01/29/0qU8RQOO_elastic-apisix.png)\\n\\nElasticSearch \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u5f00\u6e90\u641c\u7d22\u548c\u5206\u6790\u5f15\u64ce\uff0c\u65e8\u5728\u5904\u7406\u5927\u91cf\u6570\u636e\uff0c\u5728\u65e5\u5fd7\u5206\u6790\u9886\u57df\u4eab\u6709\u6781\u9ad8\u77e5\u540d\u5ea6\u3002\\n\u5b83\u63d0\u4f9b\u7684\u914d\u5957\u6570\u636e\u9762\u677f Kibana\uff0c\u53ef\u4ee5\u975e\u5e38\u8f7b\u677e\u7684\u5b9a\u5236\u51fa\u5404\u79cd\u7edf\u8ba1\u56fe\u8868\uff0c\u6ee1\u8db3\u7ec4\u7ec7\u5bf9\u4e8e\u53ef\u89c6\u5316\u67e5\u8be2\u5206\u6790\u7684\u9700\u6c42\u3002\\n\\n\u5b9e\u9645\u5e94\u7528\u65f6\uff0c\u7531\u4e8e\u5927\u591a\u6570\u4f20\u7edf\u8f6f\u4ef6\u7684\u65e5\u5fd7\u90fd\u662f\u4fdd\u5b58\u5230\u672c\u5730\u6587\u4ef6\uff0c\u6240\u4ee5 ElasticSearch \u751f\u6001\u4e2d\u6709\u4e00\u4e2a\u9879\u76ee\u53eb Filebeat\uff0c\u7528\u4e8e\u76d1\u63a7\u672c\u5730\u673a\u5668\u4e0a\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u5e76\u5c06\u589e\u91cf\u7684\u65e5\u5fd7\u53d1\u9001\u7ed9 ElasticSearch \u670d\u52a1\u5668\u3002\u800c APISIX \u63d0\u4f9b\u7684 `elasticsearch-logger` \u63d2\u4ef6\uff0c\u53ef\u4ee5\u5c06 APISIX \u7684\u8bbf\u95ee\u65e5\u5fd7\u76f4\u63a5\u53d1\u9001 ElasticSearch \u670d\u52a1\u5668\uff0c\u8fd9\u6709\u51e0\u70b9\u597d\u5904\uff1a\\n\\n- \u65e0\u9700\u90e8\u7f72 Filebeat \u7ec4\u4ef6\uff0c\u5904\u7406\u94fe\u8def\u66f4\u77ed\uff0c\u51cf\u5c11\u8ba1\u7b97\u8d44\u6e90\u6d88\u8017\uff1b\\n- \u65e5\u5fd7\u4e0d\u843d\u76d8\uff0c\u4e0d\u7528\u8003\u8651\u65e5\u5fd7\u6587\u4ef6\u7684\u78c1\u76d8\u5360\u7528\uff0c\u56e0\u4e3a\u8bbf\u95ee\u65e5\u5fd7\u7684\u91cf\u7ea7\u53ef\u80fd\u975e\u5e38\u5927\uff0c\u5982\u679c\u6ca1\u6709\u5904\u7406\u597d\u6587\u4ef6\u7684\u8f6e\u8f6c\uff0c\u5f88\u5bb9\u6613\u5c06\u673a\u5668\u7684\u78c1\u76d8\u6253\u6ee1\uff0c\u5bfc\u81f4\u6545\u969c\u3002\u6b64\u5916\uff0c\u4e0e\u78c1\u76d8\u8fdb\u884c\u4ea4\u4e92\u4e5f\u4f1a\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u964d\u4f4e\u7f51\u5173\u7684\u6027\u80fd\u3002\\n\\n### kafka-logger\\n\\n\u7f51\u5173\u8bbf\u95ee\u65e5\u5fd7\u6709\u4e00\u4e2a\u5f88\u660e\u663e\u7684\u7279\u70b9\uff1a\u65e5\u5fd7\u7684\u6570\u636e\u91cf\u4e0e\u4e1a\u52a1\u7684\u8bf7\u6c42\u91cf\u6210\u6b63\u6bd4\uff0c\u8bf7\u6c42\u8d8a\u591a\uff0c\u65e5\u5fd7\u8d8a\u591a\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u5728\u7ebf\u4e1a\u52a1\uff0c\u8bf7\u6c42\u91cf\u4f1a\u5b58\u5728\u660e\u663e\u7684\u5468\u671f\u6027\uff0c\u6bd4\u5982\u5916\u5356\u5e73\u53f0\u7684\u6d41\u91cf\u9ad8\u5cf0\u671f\u4f1a\u51fa\u73b0\u5728\u9910\u70b9\u9644\u8fd1\uff0c\u800c\u89c6\u9891\u7f51\u7ad9\u7684\u9ad8\u5cf0\u671f\u5219\u4f1a\u51fa\u73b0\u5728\u4e0b\u73ed\u65f6\u95f4\u6bb5\u3002\\n\u8fd9\u5bf9\u4e8e\u65e5\u5fd7\u5b58\u50a8\u7cfb\u7edf\u7684\u6311\u6218\u662f\u5de8\u5927\u7684\uff0c\u5982\u4f55\u4fdd\u8bc1\u7cfb\u7edf\u5728\u6d41\u91cf\u9ad8\u5cf0\u671f\u4f9d\u7136\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u662f\u6bcf\u4e00\u4e2a ElasticSearch \u7ba1\u7406\u5458\u7684\u5fc5\u4fee\u8bfe\u3002\\n\\n![Apache APISIX And Kafka](https://static.apiseven.com/uploads/2023/01/29/aNv4oh2Q_apisix-kafka-es.png)\\n\\n\u6d88\u606f\u961f\u5217\u662f\u5904\u7406\u201c\u524a\u5cf0\u586b\u8c37\u201d\u573a\u666f\u7684\u4e0d\u4e8c\u6cd5\u5668\uff0c\u5728\u7f51\u5173\u4e0e\u5b58\u50a8\u7cfb\u7edf\u4e4b\u95f4\u5f15\u5165\u6d88\u606f\u961f\u5217\uff0c\u63d0\u4f9b\u65e5\u5fd7\u7f13\u51b2\u533a\uff0c\u5c06\u4f1a\u6781\u5927\u7684\u964d\u4f4e\u5b58\u50a8\u7cfb\u7edf\u5728\u6d41\u91cf\u9ad8\u5cf0\u671f\u7684\u538b\u529b\u3002\\n\u4e3a\u6b64 APISIX \u63d0\u4f9b\u4e86 `kafka-logger` \uff0c\u5b83\u53ef\u4ee5\u5c06\u8bbf\u95ee\u65e5\u5fd7\u6295\u9012\u5230 Kafka \u670d\u52a1\u5668\uff0c\u907f\u514d\u5bf9\u65e5\u5fd7\u5b58\u50a8\u4ea7\u751f\u76f4\u63a5\u7684\u51b2\u51fb\u3002\\n\\n### loggly\\n\\n\u8fd1\u51e0\u5e74 SaaS \u7684\u6982\u5ff5\u9010\u6e10\u6df1\u5165\u4eba\u5fc3\uff0c\u5b83\u51ed\u501f\u6781\u4f4e\u7684\u63a5\u5165\u95e8\u69db\u548c\u6309\u9700\u4ed8\u8d39\u7684\u8ba1\u4ef7\u6a21\u578b\u88ab\u4f17\u591a\u4e2d\u5c0f\u578b\u4f01\u4e1a\u6240\u9752\u7750\uff0c\u5728\u65e5\u5fd7\u5206\u6790\u9886\u57df\u4e5f\u6d8c\u73b0\u4e86\u8bf8\u591a SaaS \u4ea7\u54c1\uff0cLoggly \u51ed\u501f\u7740\u4e30\u5bcc\u7684\u65e5\u5fd7\u6765\u6e90\u548c\u5206\u6790\u624b\u6bb5\u6210\u4e3a\u5176\u4e2d\u7684\u4f7c\u4f7c\u8005\u3002\\n\u5728\u6b64\u80cc\u666f\u4e0b\uff0c\u6d3b\u8dc3\u7684 APISIX \u793e\u533a\u5f00\u53d1\u4e86\u5f00\u7bb1\u5373\u7528\u7684 `loggly` \u63d2\u4ef6\uff0c\u53ea\u9700\u8981\u914d\u7f6e\u597d\u51ed\u8bc1\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u5c06 APISIX \u8bbf\u95ee\u65e5\u5fd7\u76f4\u63a5\u53d1\u9001\u7ed9 Loggly \u670d\u52a1\uff0c\u5341\u5206\u65b9\u4fbf\u3002\\n\\n\u7c7b\u4f3c `loggly` \u63d2\u4ef6\uff0cAPISIX \u8fd8\u63d0\u4f9b\u4e86 `google-cloud-logging` \u3001`sls-logger` \u3001`tencent-cloud-cls` \u63d2\u4ef6\uff0c\u53ef\u4ee5\u8f7b\u677e\u96c6\u6210\u4e3b\u6d41\u4e91\u5382\u5546\u7684\u65e5\u5fd7\u670d\u52a1\u3002\\n\\n![Apache APISIX Log SaaS](https://static.apiseven.com/uploads/2023/01/29/LnOhd04T_apisix-log-saas.png)\\n\\n### error-log-logger\\n\\n\u4e0a\u9762\u4ecb\u7ecd\u7684\u63d2\u4ef6\u90fd\u662f\u7528\u4e8e\u6536\u96c6\u8bbf\u95ee\u65e5\u5fd7\uff0c\u5728 APISIX \u4e2d\u8fd8\u5b58\u5728\u53e6\u5916\u4e00\u7c7b\u65e5\u5fd7\uff1a\u9519\u8bef\u65e5\u5fd7\uff08error.log\uff09\uff0c\u5b83\u5bf9\u4e8e\u6392\u67e5\u7f51\u5173\u81ea\u8eab\u6545\u969c\u975e\u5e38\u5173\u952e\uff0c\u6240\u4ee5 APISIX \u63d0\u4f9b\u4e86 `error-log-logger` \u63d2\u4ef6 \uff0c\u7528\u4e8e\u5c06\u9519\u8bef\u65e5\u5fd7\u53d1\u9001\u5230\u8fdc\u7aef\u670d\u52a1\u5668\u8fdb\u884c\u5b58\u50a8\u5206\u6790\u3002\u5b9e\u9645\u4f7f\u7528\u65f6\uff0c\u53ef\u4ee5\u7ed3\u5408 APISIX \u7684\u65e5\u5fd7\u7b49\u7ea7\u914d\u7f6e\uff0c\u8ba9\u7f51\u5173\u6253\u5370\u51fa\u66f4\u591a debug \u6216\u8005 info \u7ea7\u522b\u7684\u65e5\u5fd7\uff0c\u8fd9\u4e24\u4e2a\u7ea7\u522b\u4f1a\u5305\u542b\u66f4\u52a0\u8be6\u7ec6\u7684\u7f51\u5173\u8fd0\u884c\u72b6\u6001\u65e5\u5fd7\uff0c\u5229\u7528\u8fd9\u4e9b\u65e5\u5fd7\u901a\u5e38\u53ef\u4ee5\u5b9a\u4f4d\u51fa\u7edd\u5927\u591a\u6570\u95ee\u9898\u3002\\n\\n## \u603b\u7ed3\\n\\n\u7f51\u5173\u65e5\u5fd7\u8574\u85cf\u7740\u5de8\u5927\u7684\u4ef7\u503c\uff0c\u4ece Apache APISIX \u9879\u76ee\u4e30\u5bcc\u7684\u65e5\u5fd7\u63d2\u4ef6\u4e2d\u6211\u4eec\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u793e\u533a\u4e2d\u7684\u4f01\u4e1a\u7528\u6237\u5bf9\u4e8e\u7f51\u5173\u65e5\u5fd7\u4ef7\u503c\u7684\u80af\u5b9a\uff0c\u800c\u8fd9\u4e9b\u63d2\u4ef6\u4e5f\u8fdb\u4e00\u6b65\u964d\u4f4e\u4e86\u65b0\u7528\u6237\u642d\u5efa\u65e5\u5fd7\u7cfb\u7edf\u7684\u6210\u672c\u3002\\n\u6b64\u5916\uff0cAPISIX \u8fd8\u6709\u53e6\u5916\u4e24\u7c7b\u53ef\u89c2\u6d4b\u6027\u63d2\u4ef6\uff1a`metrics`\u3001`tracing`\uff0c\u5b83\u4eec\u914d\u5408\u4e0a\u65e5\u5fd7\u63d2\u4ef6\u5c06\u4f1a\u8fdb\u4e00\u6b65\u63d0\u5347\u7f51\u5173\u7684\u53ef\u89c2\u6d4b\u6027\uff0c\u52a9\u529b\u7cfb\u7edf\u7a33\u5b9a\u6027\u5efa\u8bbe\u3002"},{"id":"APISIX \u662f\u600e\u4e48\u4fdd\u62a4\u7528\u6237\u7684\u654f\u611f\u6570\u636e\u4e0d\u88ab\u6cc4\u9732\u7684\uff1f","metadata":{"permalink":"/zh/blog/2023/02/23/how-to-prevent-sensitive-data-from-leaking","source":"@site/blog/2023/02/23/how-to-prevent-sensitive-data-from-leaking.md","title":"APISIX \u662f\u600e\u4e48\u4fdd\u62a4\u7528\u6237\u7684\u654f\u611f\u6570\u636e\u4e0d\u88ab\u6cc4\u9732\u7684\uff1f","description":"\u672c\u6587\u4ee5 APISIX \u4f5c\u4e3a\u4f8b\u5b50\uff0c\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5982\u4f55\u501f\u52a9 `Global Data Encryption` \u529f\u80fd\u6765\u4fdd\u62a4\u654f\u611f\u6570\u636e\uff0c\u786e\u4fdd\u4e0d\u4f1a\u6709\u4efb\u4f55\u654f\u611f\u6570\u636e\u8fdb\u884c\u660e\u6587\u5b58\u50a8\uff0c\u8fd9\u6837\u5373\u4f7f etcd \u4e2d\u6240\u6709\u5b58\u50a8\u7684\u6570\u636e\u90fd\u88ab\u76d7\u53d6\uff0c\u4e5f\u4e0d\u4f1a\u9020\u6210\u654f\u611f\u6570\u636e\u6cc4\u9732\uff0c\u4ece\u800c\u6709\u6548\u63d0\u5347\u4e86 APISIX \u7684\u5b89\u5168\u6027\u3002","date":"2023-02-23T00:00:00.000Z","formattedDate":"2023\u5e742\u670823\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":6.59,"truncated":true,"authors":[{"name":"\u5218\u7ef4","title":"Author","url":"https://github.com/monkeyDluffy6017","image_url":"https://github.com/monkeyDluffy6017.png","imageURL":"https://github.com/monkeyDluffy6017.png"}],"prevItem":{"title":"API \u7f51\u5173\u65e5\u5fd7\u7684\u4ef7\u503c\uff0c\u4f60\u4e86\u89e3\u591a\u5c11\uff1f","permalink":"/zh/blog/2023/02/28/transforming-logs-for-ingestion-into-your-observability-stack"},"nextItem":{"title":"\u5982\u4f55\u4f7f\u7528 Kubernetes \u5b9e\u73b0\u5e94\u7528\u7a0b\u5e8f\u7684\u5f39\u6027\u4f38\u7f29","permalink":"/zh/blog/2023/02/21/how-to-scale-application-elastically-in-kubernetes"}},"content":"> \u672c\u6587\u4ee5 APISIX \u4f5c\u4e3a\u4f8b\u5b50\uff0c\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5982\u4f55\u501f\u52a9 `Global Data Encryption` \u529f\u80fd\u6765\u4fdd\u62a4\u654f\u611f\u6570\u636e\uff0c\u786e\u4fdd\u4e0d\u4f1a\u6709\u4efb\u4f55\u654f\u611f\u6570\u636e\u8fdb\u884c\u660e\u6587\u5b58\u50a8\uff0c\u8fd9\u6837\u5373\u4f7f etcd \u4e2d\u6240\u6709\u5b58\u50a8\u7684\u6570\u636e\u90fd\u88ab\u76d7\u53d6\uff0c\u4e5f\u4e0d\u4f1a\u9020\u6210\u654f\u611f\u6570\u636e\u6cc4\u9732\uff0c\u4ece\u800c\u6709\u6548\u63d0\u5347\u4e86 APISIX \u7684\u5b89\u5168\u6027\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u5218\u7ef4](https://github.com/monkeyDluffy6017)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\uff0cApache APISIX Contributor\u3002\\n\\n## \u4ec0\u4e48\u662f\u654f\u611f\u6570\u636e\\n\\n\u654f\u611f\u6570\u636e\uff0c\u53c8\u79f0\u9690\u79c1\u6570\u636e\uff0c\u4e3b\u8981\u662f\u6307\u6cc4\u9732\u540e\u53ef\u80fd\u4f1a\u7ed9\u4e2a\u4eba\u6216\u8005\u516c\u53f8\u5e26\u6765\u4e25\u91cd\u5371\u5bb3\u7684\u6570\u636e\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u4e2a\u4eba\u8eab\u4efd\u4fe1\u606f\uff0c\u4f01\u4e1a\u7ecf\u8425\u6570\u636e\u7b49\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u8981\u4fdd\u62a4\u654f\u611f\u6570\u636e\\n\\n\u5bf9\u4e8e\u4e2a\u4eba\u6765\u8bf4\uff0c\u5982\u679c\u654f\u611f\u6570\u636e\u88ab\u6cc4\u9732\uff0c\u8f7b\u5219\u53ef\u80fd\u53d7\u5230\u65e0\u6b62\u5c3d\u7684\u5e7f\u544a\u9a9a\u6270\uff0c\u91cd\u5219\u53ef\u80fd\u5bfc\u81f4\u4eba\u683c\u5c0a\u4e25\u53d7\u5230\u4fb5\u5bb3\uff0c\u6216\u8005\u4eba\u8eab\u3001\u8d22\u4ea7\u5b89\u5168\u53d7\u5230\u5371\u5bb3\u3002\\n\\n\u5bf9\u4e8e\u4f01\u4e1a\u6765\u8bf4\uff0c\u654f\u611f\u6570\u636e\u76f4\u63a5\u5173\u7cfb\u4f01\u4e1a\u7684\u4fe1\u606f\u5b89\u5168\u3002\u4f8b\u5982\u5bc6\u94a5\uff0c\u8bc1\u4e66\u7b49\u654f\u611f\u4fe1\u606f\uff0c\u4e00\u65e6\u906d\u53d7\u6cc4\u9732\uff0c\u4f01\u4e1a\u5c06\u4f1a\u906d\u53d7\u4fe1\u4efb\u635f\u5931\u548c\u8d22\u52a1\u635f\u5931\uff0c\u751a\u81f3\u53ef\u80fd\u9762\u4e34\u6cd5\u5f8b\u8d23\u4efb\u3002\\n\\n## \u5728 API \u7f51\u5173\u4e2d\u6709\u54ea\u4e9b\u654f\u611f\u6570\u636e\\n\\nAPI \u7f51\u5173\u4f5c\u4e3a\u4e1a\u52a1\u6d41\u91cf\u7684\u5165\u53e3\uff0c\u5f80\u5f80\u5305\u542b\u4e86\u5927\u91cf\u7684\u654f\u611f\u6570\u636e\uff0c\u4f8b\u5982 API \u5bc6\u94a5\u3001\u7528\u4e8e\u9274\u6743\u8ba4\u8bc1\u7684 token \u7b49\uff0c\u9664\u4e86\u57fa\u672c\u7684\u8d1f\u8f7d\u5747\u8861\u3001\u6d41\u91cf\u7ba1\u7406\u7b49\u529f\u80fd\u5916\uff0c\u63d0\u5347\u5b89\u5168\u3001\u9632\u6b62\u654f\u611f\u4fe1\u606f\u6cc4\u9732\uff0c\u4e5f\u81f3\u5173\u91cd\u8981\uff0c\u56e0\u6b64\u5bf9 API \u7f51\u5173\u4e2d\u7684\u654f\u611f\u6570\u636e\u8fdb\u884c\u4fdd\u62a4\u5177\u6709\u91cd\u8981\u610f\u4e49\u3002\\n\\n![Sensitive Data](https://static.apiseven.com/uploads/2023/02/03/a86d0nVj_sensitive_data.png)\\n\\n## API \u7f51\u5173\u600e\u4e48\u4fdd\u62a4\u9690\u79c1\u6570\u636e\\n\\n\u5927\u81f4\u601d\u8def\u4e00\u822c\u5982\u4e0b\uff1a\\n\\n1. \u5c06\u654f\u611f\u6570\u636e\u7f6e\u4e8e\u4fdd\u62a4\u533a\u5185\uff0c\u5bf9\u8bbf\u95ee\u6743\u9650\u8fdb\u884c\u4e25\u683c\u7684\u63a7\u5236\\n\\n2. \u589e\u52a0\u98ce\u63a7\u7cfb\u7edf\uff0c\u5bf9\u5f02\u5e38\u884c\u4e3a\u548c\u4e1a\u52a1\u5408\u89c4\u8fdb\u884c\u98ce\u9669\u63a7\u5236\\n\\n3. \u5bf9\u654f\u611f\u6570\u636e\u8fdb\u884c\u8131\u654f\u5904\u7406\u6216\u52a0\u5bc6\u5b58\u50a8\\n\\n\u4e0b\u9762\u5c06\u4ee5 Apache APISIX \u4e3a\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u5728 API \u7f51\u5173\u4e2d\u5bf9\u654f\u611f\u6570\u636e\u8fdb\u884c\u4fdd\u62a4\u3002\\n\\n## Apache APISIX \u5728\u4fdd\u62a4\u9690\u79c1\u6570\u636e\u4e2d\u7684\u5b9e\u8df5\\n\\n[Apache APISIX](https://apisix.apache.org/) \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u662f\u5f53\u524d\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u3002\u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0cApache APISIX \u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\n\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u7f16\u5199\u63d2\u4ef6\u6765\u5bf9 Apache APISIX \u529f\u80fd\u8fdb\u884c\u6269\u5c55\uff0c\u5f97\u76ca\u4e8e\u6210\u719f\u7684\u793e\u533a\u548c\u8d8a\u6765\u8d8a\u591a\u7684\u6d3b\u8dc3\u5f00\u53d1\u8005\uff0cApache APISIX \u7684\u63d2\u4ef6\u6570\u91cf\u5728\u65e5\u76ca\u589e\u591a\uff0c\u5176\u4e2d\u6709\u4e9b\u63d2\u4ef6\u643a\u5e26\u654f\u611f\u4fe1\u606f\uff0c\u4f8b\u5982 [jwt-auth](https://apisix.apache.org/docs/apisix/plugins/jwt-auth/) \u63d2\u4ef6\u7684\u914d\u7f6e\u9879 `secret` \u548c `private_key`\uff0c\u4e3a\u4e86\u9632\u6b62\u8fd9\u4e9b\u6570\u636e\u88ab\u975e\u6cd5\u83b7\u53d6\uff0c\u6211\u4eec\u6709\u5fc5\u8981\u5bf9\u5176\u8fdb\u884c\u52a0\u5bc6\u5b58\u50a8\u3002\\n\\n\u4e3a\u4e86\u589e\u5f3a APISIX \u7684\u5b89\u5168\u6027\uff0c\u66f4\u597d\u7684\u4fdd\u62a4\u7528\u6237\u7684\u9690\u79c1\uff0cAPISIX \u5728 3.1.0 \u7248\u672c\u4e2d\u5f15\u5165\u4e86 `Global Data Encryption` \u529f\u80fd\uff0c\u6709\u4e86\u8fd9\u4e2a\u529f\u80fd\uff0c\u5f00\u53d1\u8005\u5728\u5f00\u53d1\u65b0\u63d2\u4ef6\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5728\u63d2\u4ef6\u7684 schema \u4e2d\u6307\u5b9a\u8981\u52a0\u5bc6\u7684\u6570\u636e\uff0cAPISIX \u5c31\u80fd\u5728\u63a7\u5236\u9762\u5199\u5165\u7684\u65f6\u5019\u81ea\u52a8\u8fdb\u884c\u52a0\u5bc6\u5b58\u50a8\uff0c\u6570\u636e\u9762\u8bfb\u53d6\u7684\u65f6\u5019\u81ea\u52a8\u89e3\u5bc6\uff0c\u5bf9\u5f00\u53d1\u8005\u5b8c\u5168\u900f\u660e\u3002\\n\\n![Global Data Encryption](https://static.apiseven.com/uploads/2023/02/03/o7B7uR2a_global_data_encryption.png)\\n\\n\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b\u5177\u4f53\u7684\u793a\u4f8b\u3002\\n\\n### \u672a\u5f00\u542f\u6570\u636e\u52a0\u5bc6\u529f\u80fd\\n\\n1. \u4e0b\u53d1\u914d\u7f6e\\n\\n```lua\\ncurl http://127.0.0.1:9180/apisix/admin/consumers -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"username\\": \\"foo\\",\\n    \\"plugins\\": {\\n        \\"basic-auth\\": {\\n            \\"username\\": \\"foo\\",\\n            \\"password\\": \\"bar\\"\\n        }\\n    }\\n}\'\\n```\\n\\n2. \u786e\u5b9a etcd \u4e2d\u7684\u654f\u611f\u6570\u636e\u72b6\u6001\\n\\n```lua\\netcdctl get /apisix/consumers/foo\\n{\\"username\\":\\"foo\\",\\"update_time\\":1675414313,\\"create_time\\":1674009211,\\"plugins\\":{\\"basic-auth\\":{\\"username\\":\\"foo\\",\\"password\\":\\"bar\\"}}}\\n```\\n\\n**\u53ef\u4ee5\u770b\u5230 `password` \u5b57\u6bb5\u662f\u660e\u6587\u5b58\u50a8**\\n\\n### \u5f00\u542f\u6570\u636e\u52a0\u5bc6\u529f\u80fd\\n\\n1. \u5728 `config.yaml` \u4e2d\u5f00\u542f `data_encryption`\uff1a\\n\\n```yaml\\napisix:\\n    data_encryption:\\n    enable: true\\n    keyring:\\n        - edd1c9f0985e76a2\\n```\\n\\n2. \u542f\u7528\u5df2\u7ecf\u652f\u6301\u654f\u611f\u6570\u636e\u52a0\u5bc6\u7684\u63d2\u4ef6\uff0c\u8fd9\u91cc\u4ee5 `basic-auth` \u63d2\u4ef6\u4e3a\u4f8b\\n\\n```lua\\ncurl http://127.0.0.1:9180/apisix/admin/consumers -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"username\\": \\"foo\\",\\n    \\"plugins\\": {\\n        \\"basic-auth\\": {\\n            \\"username\\": \\"foo\\",\\n            \\"password\\": \\"bar\\"\\n        }\\n    }\\n}\'\\n```\\n\\n3. \u9a8c\u8bc1\u63d2\u4ef6\u529f\u80fd\\n\\n```\\ncurl http://127.0.0.1:9180/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/get\\",\\n    \\"plugins\\": {\\n        \\"basic-auth\\": {}\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"httpbin.org\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u80fd\u6b63\u5e38\u8bbf\u95ee\\n\\n```\\ncurl -i -ufoo:bar http://127.0.0.1:9080/get\\nHTTP/1.1 200 OK\\n...\\n```\\n\\n\u5bc6\u7801\u9519\u8bef\uff0c\u4e0d\u80fd\u8bbf\u95ee\\n\\n```\\ncurl -i -ufoo:test http://127.0.0.1:9080/get\\nHTTP/1.1 401 Unauthorized\\n...\\n{\\"message\\":\\"Invalid user authorization\\"}\\n```\\n\\n\u63d2\u4ef6\u529f\u80fd\u6b63\u5e38\\n\\n4. \u786e\u5b9a etcd \u4e2d\u7684\u654f\u611f\u6570\u636e\u72b6\u6001\\n\\n```lua\\netcdctl get /apisix/consumers/foo\\n{\\"create_time\\":1674009211,\\"update_time\\":1674009211,\\"plugins\\":{\\"basic-auth\\":{\\"password\\":\\"+kOEVUuRc5rC5ZwvvAMLwg==\\",\\"username\\":\\"foo\\"}},\\"username\\":\\"foo\\"}\\n```\\n\\n**\u53ef\u4ee5\u770b\u5230 `password` \u5b57\u6bb5\u5df2\u7ecf\u88ab\u6210\u529f\u52a0\u5bc6**\uff0c\u6b64\u65f6\u5c31\u7b97\u6570\u636e\u88ab\u6cc4\u9732\uff0c\u5176\u4ed6\u4eba\u4e5f\u65e0\u6cd5\u7834\u89e3\u3002\\n\\n## \u603b\u7ed3\\n\\n\u5728 API \u7f51\u5173\u4e2d\uff0c\u5305\u542b\u4e86\u5927\u91cf\u7684\u654f\u611f\u6570\u636e\uff0c\u56e0\u6b64\u9700\u8981\u91c7\u53d6\u6709\u6548\u7684\u624b\u6bb5\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u4fdd\u62a4\uff0c\u672c\u6587\u4ee5 APISIX \u4f5c\u4e3a\u4f8b\u5b50\uff0c\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5982\u4f55\u501f\u52a9 `Global Data Encryption` \u529f\u80fd\u6765\u4fdd\u62a4\u654f\u611f\u6570\u636e\uff0c\u786e\u4fdd\u4e0d\u4f1a\u6709\u4efb\u4f55\u654f\u611f\u6570\u636e\u8fdb\u884c\u660e\u6587\u5b58\u50a8\uff0c\u8fd9\u6837\u5373\u4f7f etcd \u4e2d\u6240\u6709\u5b58\u50a8\u7684\u6570\u636e\u90fd\u88ab\u76d7\u53d6\uff0c\u4e5f\u4e0d\u4f1a\u9020\u6210\u654f\u611f\u6570\u636e\u6cc4\u9732\uff0c\u4ece\u800c\u6709\u6548\u63d0\u5347\u4e86 APISIX \u7684\u5b89\u5168\u6027\u3002\u540c\u65f6\u9664\u4e86\u5bf9\u654f\u611f\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\u4ee5\u5916\uff0cAPISIX \u8fd8\u652f\u6301\u5c06\u654f\u611f\u4fe1\u606f\u76f4\u63a5\u653e\u5230\u7b2c\u4e09\u65b9\u670d\u52a1\uff0c\u5373[Secret Manager](https://api7.ai/blog/how-to-use-secret-manager-with-api-gateway)\u529f\u80fd\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u5b89\u5168\u6027\u3002\\n\\n\u5e0c\u671b\u901a\u8fc7\u4e0a\u8ff0\u5206\u4eab\uff0c\u80fd\u591f\u4f7f\u5927\u5bb6\u66f4\u591a\u7684\u4e86\u89e3\u5982\u4f55\u5728 API \u7f51\u5173\u4e2d\u4fdd\u62a4\u654f\u611f\u6570\u636e\uff0c\u4ece\u800c\u4fdd\u969c\u4f01\u4e1a\u7684\u4fe1\u606f\u5b89\u5168\u3002"},{"id":"\u5982\u4f55\u4f7f\u7528 Kubernetes \u5b9e\u73b0\u5e94\u7528\u7a0b\u5e8f\u7684\u5f39\u6027\u4f38\u7f29","metadata":{"permalink":"/zh/blog/2023/02/21/how-to-scale-application-elastically-in-kubernetes","source":"@site/blog/2023/02/21/how-to-scale-application-elastically-in-kubernetes.md","title":"\u5982\u4f55\u4f7f\u7528 Kubernetes \u5b9e\u73b0\u5e94\u7528\u7a0b\u5e8f\u7684\u5f39\u6027\u4f38\u7f29","description":"\u672c\u7bc7\u6587\u7ae0\u5229\u7528 KEDA \u4f7f\u7528 Prometheus \u91c7\u96c6 APISIX \u66b4\u9732\u51fa\u6765\u7684\u6307\u6807\u4f5c\u4e3a\u4f38\u7f29\u5668\uff0c\u8fdb\u800c\u5b9e\u73b0\u57fa\u4e8e\u6d41\u91cf\u7684\u5e94\u7528\u7a0b\u5e8f\u5f39\u6027\u4f38\u7f29\u3002","date":"2023-02-21T00:00:00.000Z","formattedDate":"2023\u5e742\u670821\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.14,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","title":"Author","url":"https://github.com/tao12345666333","image_url":"https://github.com/tao12345666333.png","imageURL":"https://github.com/tao12345666333.png"}],"prevItem":{"title":"APISIX \u662f\u600e\u4e48\u4fdd\u62a4\u7528\u6237\u7684\u654f\u611f\u6570\u636e\u4e0d\u88ab\u6cc4\u9732\u7684\uff1f","permalink":"/zh/blog/2023/02/23/how-to-prevent-sensitive-data-from-leaking"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (1.30 - 2.12)","permalink":"/zh/blog/2023/02/16/weekly-report-0216"}},"content":"> \u672c\u7bc7\u6587\u7ae0\u5229\u7528 KEDA \u4f7f\u7528 Prometheus \u91c7\u96c6 APISIX \u66b4\u9732\u51fa\u6765\u7684\u6307\u6807\u4f5c\u4e3a\u4f38\u7f29\u5668\uff0c\u8fdb\u800c\u5b9e\u73b0\u57fa\u4e8e\u6d41\u91cf\u7684\u5e94\u7528\u7a0b\u5e8f\u5f39\u6027\u4f38\u7f29\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u5f20\u664b\u6d9b](https://github.com/tao12345666333)\uff0cAPI7.ai \u4e91\u539f\u751f\u5de5\u7a0b\u5e08\uff0cApache APISIX PMC\u3002\\n\\n## \u4ecb\u7ecd\\n\\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u5e94\u7528\u53ef\u4ee5\u627f\u8f7d\u7684\u538b\u529b\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u63d0\u524d\u8fdb\u884c\u538b\u6d4b\u6765\u4e86\u89e3\u5355\u5e94\u7528\u7a0b\u5e8f\u526f\u672c\u7684\u8d1f\u8f7d\u80fd\u529b\u3002\u5982\u679c\u5728\u4e1a\u52a1\u9ad8\u5cf0\uff0c\u6216\u8005\u4e1a\u52a1\u7684\u8bf7\u6c42\u538b\u529b\u589e\u52a0\u65f6\u5019\uff0c\u5bf9\u5e94\u7528\u8fdb\u884c\u6a2a\u5411\u6269\u5bb9\u53ef\u4ee5\u4fdd\u8bc1\u66f4\u597d\u7684\u4e3a\u7528\u6237\u63d0\u4f9b\u670d\u52a1\u3002\\n\\nApache APISIX \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u6240\u6709\u53d1\u9001\u5230\u4e0a\u6e38\u5e94\u7528\u7a0b\u5e8f\u7684\u6d41\u91cf\u90fd\u5c06\u901a\u8fc7 APISIX\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6839\u636e APISIX \u63d0\u4f9b\u7684\u6d41\u91cf\u6307\u6807\uff0c\u6765\u5224\u65ad\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u9700\u8981\u8fdb\u884c\u5f39\u6027\u4f38\u7f29\u3002\\n\\n\u672c\u6587\u4e2d\u5c06\u4f7f\u7528 KEDA \u4f5c\u4e3a\u5f39\u6027\u4f38\u7f29\u7684\u63a7\u5236\u7ec4\u4ef6\uff0c\u7528 Prometheus \u91c7\u96c6 APISIX \u63d0\u4f9b\u7684\u6d41\u91cf\u6307\u6807\u6765\u8fdb\u884c\u5e94\u7528\u7684\u5f39\u6027\u4f38\u7f29\u3002\\n\\n![using KEDA for autocaling](https://static.apiseven.com/uploads/2023/02/21/Zrw8DGl2_0221.png)\\n\\n## KEDA \u4e2d\u5982\u4f55\u4f7f\u7528 Prometheus \u5b9e\u73b0\u4f38\u7f29\\n\\n[KEDA](https://keda.sh/) \u662f\u4e00\u4e2a Kubernetes \u4e2d\u57fa\u4e8e\u4e8b\u4ef6\u7684\u81ea\u52a8\u4f38\u7f29\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u79cd\u4f38\u7f29\u5668\u3002\u672c\u6587\u5c06\u4f7f\u7528 Prometheus \u4f5c\u4e3a\u4f38\u7f29\u5668 \uff0c\u83b7\u53d6 APISIX \u66b4\u9732\u51fa\u6765\u7684 metrics\uff08\u6307\u6807\uff09\u5e76\u8fdb\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u6269\u7f29\u5bb9\u3002\\n\\n### \u90e8\u7f72 KEDA\\n\\nKEDA \u7684\u90e8\u7f72\u6bd4\u8f83\u7b80\u5355\uff0c\u6dfb\u52a0\u5bf9\u5e94\u7684 Helm repo \u5e76\u8fdb\u884c\u5b89\u88c5\u5373\u53ef\u3002\\n\\n```bash\\n(MoeLove) \u279c helm repo add kedacore https://kedacore.github.io/charts\\n\\"kedacore\\" has been added to your repositories\\n(MoeLove) \u279c helm repo update kedacore\\nHang tight while we grab the latest from your chart repositories...\\n...Successfully got an update from the \\"kedacore\\" chart repository\\nUpdate Complete. \u2388Happy Helming!\u2388\\n(MoeLove) \u279c helm install keda kedacore/keda --namespace keda --create-namespace\\nNAME: keda\\nLAST DEPLOYED: Thu Jan 19 00:01:00 2023\\nNAMESPACE: keda\\nSTATUS: deployed\\nREVISION: 1\\nTEST SUITE: None\\n```\\n\\n\u5728\u5b89\u88c5\u5b8c\u6210\u540e\uff0cPod \u5904\u4e8e `Running` \u72b6\u6001\uff0c\u8868\u793a\u5df2\u7ecf\u6b63\u5e38\u5b89\u88c5\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl -n keda get pods\\nNAME                                               READY   STATUS    RESTARTS   AGE\\nkeda-operator-metrics-apiserver-6d4db7dcff-ck9qg   1/1     Running   0          36s\\nkeda-operator-5dd4748dcd-k8jjz                     1/1     Running   0          36s\\n```\\n\\n\u63a5\u4e0b\u6765\u90e8\u7f72 Prometheus\u3002\\n\\n### \u90e8\u7f72 Prometheus\\n\\n\u6b64\u5904\u6211\u4eec\u4f7f\u7528 Prometheus Operator \u6765\u8fdb\u884c Prometheus \u7684\u90e8\u7f72\u3002Prometheus Operator \u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5728 Kubernetes \u4e2d\u5feb\u901f\u90e8\u7f72 Prometheus \u5b9e\u4f8b\uff0c\u4ee5\u53ca\u901a\u8fc7\u58f0\u660e\u5f0f\u914d\u7f6e\u7684\u65b9\u5f0f\u6dfb\u52a0\u76d1\u63a7\u89c4\u5219\u3002\\n\\n\u901a\u8fc7\u5982\u4e0b\u6b65\u9aa4\u5b8c\u6210 Prometheus Operator \u7684\u5b89\u88c5\u3002\\n\\n```bash\\n(MoeLove) \u279c https://github.com/prometheus-operator/prometheus-operator/releases/download/v0.62.0/bundle.yaml\\n(MoeLove) \u279c kubectl apply --server-side -f bundle.yaml\\ncustomresourcedefinition.apiextensions.k8s.io/alertmanagerconfigs.monitoring.coreos.com serverside-applied\\ncustomresourcedefinition.apiextensions.k8s.io/alertmanagers.monitoring.coreos.com serverside-applied\\ncustomresourcedefinition.apiextensions.k8s.io/podmonitors.monitoring.coreos.com serverside-applied\\ncustomresourcedefinition.apiextensions.k8s.io/probes.monitoring.coreos.com serverside-applied\\ncustomresourcedefinition.apiextensions.k8s.io/prometheuses.monitoring.coreos.com serverside-applied\\ncustomresourcedefinition.apiextensions.k8s.io/prometheusrules.monitoring.coreos.com serverside-applied\\ncustomresourcedefinition.apiextensions.k8s.io/servicemonitors.monitoring.coreos.com serverside-applied\\ncustomresourcedefinition.apiextensions.k8s.io/thanosrulers.monitoring.coreos.com serverside-applied\\nclusterrolebinding.rbac.authorization.k8s.io/prometheus-operator serverside-applied\\nclusterrole.rbac.authorization.k8s.io/prometheus-operator serverside-applied\\ndeployment.apps/prometheus-operator serverside-applied\\nserviceaccount/prometheus-operator serverside-applied\\nservice/prometheus-operator serverside-applied\\n```\\n\\n\u7136\u540e\u4f7f\u7528\u5982\u4e0b\u914d\u7f6e\u4f5c\u4e3a Prometheus \u5b9e\u4f8b\u7684\u914d\u7f6e\uff0c\u7136\u540e\u5c06\u5176\u5e94\u7528\u5230 Kubernetes \u96c6\u7fa4\u4e2d\u3002\\n\\n```yaml\\n---\\napiVersion: v1\\nkind: ServiceAccount\\nmetadata:\\n  name: prometheus\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRole\\nmetadata:\\n  name: prometheus\\nrules:\\n- apiGroups: [\\"\\"]\\n  resources:\\n  - nodes\\n  - nodes/metrics\\n  - services\\n  - endpoints\\n  - pods\\n  verbs: [\\"get\\", \\"list\\", \\"watch\\"]\\n- apiGroups: [\\"\\"]\\n  resources:\\n  - configmaps\\n  verbs: [\\"get\\"]\\n- apiGroups:\\n  - networking.k8s.io\\n  resources:\\n  - ingresses\\n  verbs: [\\"get\\", \\"list\\", \\"watch\\"]\\n- nonResourceURLs: [\\"/metrics\\"]\\n  verbs: [\\"get\\"]\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRoleBinding\\nmetadata:\\n  name: prometheus\\nroleRef:\\n  apiGroup: rbac.authorization.k8s.io\\n  kind: ClusterRole\\n  name: prometheus\\nsubjects:\\n- kind: ServiceAccount\\n  name: prometheus\\n  namespace: default\\n---\\napiVersion: monitoring.coreos.com/v1\\nkind: Prometheus\\nmetadata:\\n  name: prometheus\\nspec:\\n  serviceAccountName: prometheus\\n  serviceMonitorSelector:\\n    matchLabels:\\n      app: apisix\\n  serviceMonitorNamespaceSelector:\\n    matchLabels:\\n      team: apisix\\n  resources:\\n    requests:\\n      memory: 400Mi\\n  enableAdminAPI: false\\n---\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: prometheus\\nspec:\\n  type: LoadBalancer\\n  ports:\\n  - name: web\\n    port: 9090\\n    protocol: TCP\\n    targetPort: web\\n  selector:\\n    prometheus: prometheus\\n```\\n\\n\u5e94\u7528\u540e\uff0c\u5219\u53ef\u4ee5\u770b\u5230\u5728 `default` namespace \u4e0b\u521b\u5efa\u4e86 Prometheus \u5b9e\u4f8b\u3002\u7531\u4e8e\u4e0a\u8ff0\u914d\u7f6e\u4e2d\u521b\u5efa\u4e86 `LoadBalancer` \u7c7b\u578b\u7684 Service\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 LoadBalancer \u7684\u516c\u7f51 IP \u8fdb\u884c Prometheus \u7684\u8bbf\u95ee\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl get svc\\nNAME                  TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)          AGE\\nkubernetes            ClusterIP      10.43.0.1       <none>         443/TCP          96m\\nprometheus-operator   ClusterIP      None            <none>         8080/TCP         92m\\nprometheus-operated   ClusterIP      None            <none>         9090/TCP         41m\\nprometheus            LoadBalancer   10.43.125.194   216.6.66.66    9090:30099/TCP   41m\\n```\\n\\n## \u5982\u4f55\u90e8\u7f72\u7f51\u5173\u5e76\u5f00\u542f\u76d1\u63a7\\n\\n\u63a5\u4e0b\u6765\u90e8\u7f72 APISIX Ingress\uff0c\u5e76\u4f7f\u7528 Prometheus \u8fdb\u884c metrics \u91c7\u96c6\u3002\\n\\n**\u5982\u679c\u7528\u6237\u6ca1\u6709\u4f7f\u7528 APISIX Ingress\uff0c\u800c\u662f\u4ec5\u4ec5\u4f7f\u7528\u4e86 APISIX\uff0c\u64cd\u4f5c\u65b9\u6cd5\u4e5f\u662f\u7c7b\u4f3c\u7684\u3002** \u8fd9\u91cc\u4e0d\u518d\u5206\u5f00\u4ecb\u7ecd\u3002\\n\\n\u6b64\u5904\u4f7f\u7528 Helm \u8fdb\u884c\u90e8\u7f72\uff0c\u53ef\u4ee5\u540c\u65f6\u5c06 APISIX Ingress controller \u548c APISIX \u90e8\u7f72\u5230\u96c6\u7fa4\u4e2d\u3002\\n\\n```bash\\n(MoeLove) \u279c helm repo add apisix https://charts.apiseven.com\\n\\"apisix\\" already exists with the same configuration, skipping\\n(MoeLove) \u279c helm repo update apisix\\nHang tight while we grab the latest from your chart repositories...\\n...Successfully got an update from the \\"apisix\\" chart repository\\nUpdate Complete. \u2388Happy Helming!\u2388\\n(MoeLove) \u279c helm upgrade --install apisix apisix/apisix --create-namespace  --namespace apisix --set gateway.type=LoadBalancer --set ingress-controller.enabled=true --set ingress-controller.config.apisix.serviceNamespace=apisix\\nRelease \\"apisix\\" has been upgraded. Happy Helming!\\nNAME: apisix\\nLAST DEPLOYED: Thu Jan 19 02:11:23 2023\\nNAMESPACE: apisix\\nSTATUS: deployed\\nREVISION: 1\\nTEST SUITE: None\\nNOTES:\\n1. Get the application URL by running these commands:\\n     NOTE: It may take a few minutes for the LoadBalancer IP to be available.\\n           You can watch the status of by running \'kubectl get --namespace apisix svc -w apisix-gateway\'\\n  export SERVICE_IP=$(kubectl get svc --namespace apisix apisix-gateway --template \\"{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}\\")\\n  echo http://$SERVICE_IP:80\\n```\\n\\n\u63a5\u4e0b\u6765\u5f00\u542f APISIX \u7684 `prometheus` \u63d2\u4ef6\uff0c\u5177\u4f53\u7684\u914d\u7f6e\u65b9\u6cd5\u548c\u76f8\u5173\u53c2\u6570\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u4e24\u7bc7\u6587\u6863\u3002\\n\\n* [prometheus plugins | Apache APISIX\xae](https://apisix.apache.org/docs/apisix/plugins/prometheus/)\\n* [How to access Apache APISIX Prometheus metrics on Kubernetes | Apache APISIX\xae](https://apisix.apache.org/docs/ingress-controller/tutorials/how-to-access-Apache-APISIX-Prometheus-Metrics-on-k8s/)\\n\\n\u5f00\u542f\u540e\uff0c\u4fbf\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa ServiceMonitor \u8d44\u6e90\uff0c\u8ba9 Prometheus \u6293\u53d6 APISIX \u66b4\u9732\u51fa\u7684 metrics \u4e86\u3002\\n\\n```yaml\\napiVersion: monitoring.coreos.com/v1\\nkind: ServiceMonitor\\nmetadata:\\n  name: example-app\\n  labels:\\n    app: apisix\\nspec:\\n  selector:\\n    matchLabels:\\n      app: apisix\\n  endpoints:\\n  - port: web\\n```\\n\\n## \u9a8c\u8bc1\u5e94\u7528\u5f39\u6027\u4f38\u7f29\u80fd\u529b\\n\\n\u6b64\u5904\u5c06\u521b\u5efa\u4e00\u4e2a\u793a\u4f8b\u5e94\u7528\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl create deploy httpbin --image=kennethreitz/httpbin --port=80\\ndeployment.apps/httpbin created\\n(MoeLove) \u279c kubectl expose deploy httpbin --port 80\\n```\\n\\n\u521b\u5efa\u5982\u4e0b\u8def\u7531\u89c4\u5219\uff0c\u5e94\u7528\u5230 Kubernetes \u96c6\u7fa4\u540e\uff0c\u5219\u53ef\u901a\u8fc7 APISIX \u8fdb\u884c\u8bf7\u6c42\u7684\u4ee3\u7406\u3002\\n\\n```yaml\\napiVersion: apisix.apache.org/v2\\nkind: ApisixRoute\\nmetadata:\\n  name: httpserver-route\\nspec:\\n  http:\\n  - name: rule1\\n    match:\\n      hosts:\\n      - local.httpbin.org\\n      paths:\\n      - /*\\n    backends:\\n       - serviceName: httpbin\\n         servicePort: 80\\n```\\n\\n\u63a5\u4e0b\u6765\uff0c\u521b\u5efa KEDA \u7684 ScaledObject\uff0c\u914d\u7f6e Prometheus \u76f8\u5173\u53c2\u6570\u3002\\n\\n```yaml\\napiVersion: keda.sh/v1alpha1\\nkind: ScaledObject\\nmetadata:\\n  name: prometheus-scaledobject\\n  namespace: default\\nspec:\\n  scaleTargetRef:\\n    name: httpbin\\n  triggers:\\n  - type: prometheus\\n    metadata:\\n      serverAddress: http://prometheus.default.svc:9090\\n      metricName: apisix_http_status\\n      threshold: \'10\'\\n      query: sum(rate(apisix_http_status{route=\\"httpserver-route\\"}[1m]))\\n```\\n\\n\u4e0a\u8ff0\u53c2\u6570\u8868\u793a\u901a\u8fc7 `sum(rate(apisix_http_status{route=\\"httpserver-route\\"}[1m]))` \u4f5c\u4e3a\u67e5\u8be2\u8868\u8fbe\u5f0f\uff0c\u5982\u679c\u7ed3\u679c\u80fd\u5230\u8fbe 10, \u5219\u5f00\u59cb\u8fdb\u884c\u6269\u5bb9\uff08\u6b64\u5904\u914d\u7f6e\u4ec5\u7528\u4e8e\u672c\u6587\u4e2d\u7684\u793a\u4f8b\u4f7f\u7528\uff0c\u751f\u4ea7\u73af\u5883\u8bf7\u6309\u7167\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u4fee\u6539\uff09\u3002\\n\\n\u7136\u540e\uff0c\u6211\u4eec\u901a\u8fc7 curl \u5411 httpbin \u670d\u52a1\u53d1\u51fa\u8fde\u7eed\u8bf7\u6c42\uff0c\u518d\u6b21\u67e5\u770b\u793a\u4f8b\u5e94\u7528\u7684 Pod \u5df2\u7ecf\u53d8\u6210\u4e24\u4e2a\uff0c\u8bc1\u660e KEDA \u6210\u529f\u81ea\u52a8\u6269\u5bb9\u4e86\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl get pods\\nNAME                      READY   STATUS    RESTARTS   AGE\\nhttpbin-d46d778d7-chtdw   1/1     Running   0          12m\\nhttpbin-d46d778d7-xanbj   1/1     Running   0          10s\\n```\\n\\n\u5f85\u4e00\u6bb5\u65f6\u95f4\u65e0\u8bf7\u6c42\u540e\uff0c\u518d\u6b21\u67e5\u770b\u53d1\u73b0 Pod \u7684\u6570\u91cf\u81ea\u52a8\u7f29\u51cf\u4e3a\u4e00\u4e2a\uff0c\u8bc1\u660e\u81ea\u52a8\u7f29\u5bb9\u4e5f\u5b9e\u73b0\u4e86\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl get pods\\nNAME                      READY   STATUS    RESTARTS   AGE\\nhttpbin-d46d778d7-chtdw   1/1     Running   0          32m\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u7bc7\u6587\u7ae0\u5229\u7528 KEDA \u4f7f\u7528 Prometheus \u91c7\u96c6 APISIX \u66b4\u9732\u51fa\u6765\u7684\u6307\u6807\u4f5c\u4e3a\u4f38\u7f29\u5668\uff0c\u8fdb\u800c\u5b9e\u73b0\u57fa\u4e8e\u6d41\u91cf\u7684\u5e94\u7528\u7a0b\u5e8f\u5f39\u6027\u4f38\u7f29\u3002\u7531\u4e8e\u6240\u6709\u6d41\u91cf\u90fd\u4f1a\u5148\u7ecf\u8fc7 APISIX \uff0c\u6240\u4ee5\u5728 APISIX \u4fa7\u8fdb\u884c\u6570\u636e\u7edf\u8ba1\u66f4\u52a0\u7b80\u5355\u65b9\u4fbf\u3002\\n\\n\u5728\u4e1a\u52a1\u8bf7\u6c42\u91cf\u4e0a\u6765\u540e\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c06\u8fdb\u884c\u81ea\u52a8\u5316\u7684\u6269\u5bb9\uff0c\u5f53\u4e1a\u52a1\u4f4e\u8c37\u7684\u65f6\u5019\uff0c\u5219\u4f1a\u81ea\u52a8\u7684\u7f29\u5bb9\u3002\u8fd9\u53ef\u4ee5\u5728\u7f13\u89e3\u5f88\u591a\u751f\u4ea7\u73af\u5883\u4e0b\u7684\u624b\u52a8\u6269/\u7f29\u5bb9\u64cd\u4f5c\uff0c\u4ee5\u4fdd\u969c\u7528\u6237\u7684\u670d\u52a1\u4f53\u9a8c\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (1.30 - 2.12)","metadata":{"permalink":"/zh/blog/2023/02/16/weekly-report-0216","source":"@site/blog/2023/02/16/weekly-report-0216.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (1.30 - 2.12)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-02-16T00:00:00.000Z","formattedDate":"2023\u5e742\u670816\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.65,"truncated":true,"authors":[],"prevItem":{"title":"\u5982\u4f55\u4f7f\u7528 Kubernetes \u5b9e\u73b0\u5e94\u7528\u7a0b\u5e8f\u7684\u5f39\u6027\u4f38\u7f29","permalink":"/zh/blog/2023/02/21/how-to-scale-application-elastically-in-kubernetes"},"nextItem":{"title":"RESTful API \u4e3a\u4f55\u6210\u4e3a\u9876\u6d41 API \u67b6\u6784\u98ce\u683c\uff1f","permalink":"/zh/blog/2023/02/08/what-is-restful-api"}},"content":"> \u4ece 2023.1.30 - 2023.2.12\uff0c\u6709 36 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 69 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 Issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/02/13/atGiY8KB_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5-03%E5%91%A8.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/02/13/duMIjv3Z_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E6%96%B0%E6%99%8B%E6%B5%B7%E6%8A%A5-03%E5%91%A8.png)\\n\\n## Good First Issue\\n\\n### Issue #8772\\n\\n\u94fe\u63a5\uff1a[https://github.com/apache/apisix/issues/8772](https://github.com/apache/apisix/issues/8772)\\n\\n\u95ee\u9898\u63cf\u8ff0\uff1a\u5bf9 OIDC \u8ba4\u8bc1\u76f8\u5173\u7684\u81ea\u5b9a\u4e49\u914d\u7f6e\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4ee5\u4fbf\u7528\u6237\u5bf9\u4e0d\u5408\u89c4\u914d\u7f6e\u9650\u5236\u5176\u5411\u540e\u7aef\u8bbf\u95ee\u3002\\n\\n### Issue #1075\\n\\n\u94fe\u63a5\uff1a[https://github.com/apache/apisix-ingress-controller/issues/1075](https://github.com/apache/apisix-ingress-controller/issues/1075)\\n\\n\u95ee\u9898\u63cf\u8ff0\uff1a\u4e3a APISIX Ingress \u589e\u52a0\u4f7f\u7528 apisix:dev \u7684\u56de\u5f52\u6d4b\u8bd5\uff0c\u4ee5\u4fbf\u5c3d\u65e9\u53d1\u73b0\u4e0e APISIX \u6700\u65b0\u4fee\u6539\u7684\u517c\u5bb9\u95ee\u9898\\n\\n## \u8fd1\u671f\u4eae\u70b9\u529f\u80fd\\n\\n### Apache APISIX\\n\\n- [\u589e\u52a0 `body-transformer` \u63d2\u4ef6\uff0c\u63d0\u4f9b\u5c06\u4e0a\u6e38\u54cd\u5e94\u4f53\u8fdb\u884c\u683c\u5f0f\u8f6c\u6362\u7684\u80fd\u529b](https://github.com/apache/apisix/pull/8766)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n- [`error-log` \u63d2\u4ef6\u63d0\u4f9b\u5c06\u9519\u8bef\u65e5\u5fd7\u53d1\u9001\u5230 Kafka \u96c6\u7fa4\u7684\u80fd\u529b](https://github.com/apache/apisix/pull/8693)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\n- [`elasticsearch-logger` \u63d0\u4f9b\u591a Elasticsearch \u8282\u70b9\u968f\u673a\u5199\u5165\u652f\u6301\uff0c\u964d\u4f4e\u8282\u70b9\u538b\u529b](https://github.com/apache/apisix/pull/8604)\uff08\u8d21\u732e\u8005\uff1a[xiaoxuanzi](https://github.com/xiaoxuanzi)\uff09\\n\\n- [Stream \u4ee3\u7406\u6a21\u5f0f\u63d0\u4f9b Consul \u670d\u52a1\u53d1\u73b0\u652f\u6301](https://github.com/apache/apisix/pull/8696)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\n- [\u5141\u8bb8 logger \u7c7b\u63d2\u4ef6\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f](https://github.com/apache/apisix/pull/8806)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [`file-logger` \u63d2\u4ef6\u652f\u6301\u901a\u8fc7 `resp_body` \u53d8\u91cf\u8bbf\u95ee\u4e0a\u6e38\u54cd\u5e94\u4f53\u5185\u5bb9](https://github.com/apache/apisix/pull/8711)\uff08\u8d21\u732e\u8005\uff1a[mscb402](https://github.com/mscb402)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"RESTful API \u4e3a\u4f55\u6210\u4e3a\u9876\u6d41 API \u67b6\u6784\u98ce\u683c\uff1f","metadata":{"permalink":"/zh/blog/2023/02/08/what-is-restful-api","source":"@site/blog/2023/02/08/what-is-restful-api.md","title":"RESTful API \u4e3a\u4f55\u6210\u4e3a\u9876\u6d41 API \u67b6\u6784\u98ce\u683c\uff1f","description":"\u672c\u6587\u5c06\u4ecb\u7ecd\u4ec0\u4e48\u662f RESTful API \u4ee5\u53ca\u6211\u4eec\u5982\u4f55\u4f7f\u7528\u5b83\u3002","date":"2023-02-08T00:00:00.000Z","formattedDate":"2023\u5e742\u67088\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":14.455,"truncated":true,"authors":[{"name":"\u5b59\u6bc5","title":"Author","url":"https://github.com/litesun","image_url":"https://github.com/litesun.png","imageURL":"https://github.com/litesun.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (1.30 - 2.12)","permalink":"/zh/blog/2023/02/16/weekly-report-0216"},"nextItem":{"title":"APISIX Ingress \u5982\u4f55\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66","permalink":"/zh/blog/2023/02/07/apisix-ingress-with-cert-mamager"}},"content":"> \u672c\u6587\u5c06\u4ecb\u7ecd\u4ec0\u4e48\u662f RESTful API \u4ee5\u53ca\u6211\u4eec\u5982\u4f55\u4f7f\u7528\u5b83\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u5b59\u6bc5](https://github.com/litesun)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\uff0cApache APISIX Committer\\n\\n\u4e07\u7269\u4e92\u8054\u7684\u4e16\u754c\u5145\u6ee1\u7740\u5404\u5f0f\u5404\u6837\u7684 API \uff0c\u5982\u4f55\u7edf\u7b79\u89c4\u8303 API \u81f3\u5173\u91cd\u8981\u3002[RESTful API](https://en.wikipedia.org/wiki/Representational_state_transfer) \u662f\u76ee\u524d\u4e16\u754c\u4e0a\u6700\u6d41\u884c\u7684 API \u67b6\u6784\u98ce\u683c\u4e4b\u4e00\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u4f60\u5b9e\u73b0\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u5173\u6ce8\u70b9\u5206\u79bb\uff0c\u8ba9\u524d\u540e\u7aef\u5404\u81ea\u8fed\u4ee3\uff0c\u63d0\u5347\u7ba1\u7406\u6548\u7387\uff1b\u5176\u65e0\u72b6\u6001\u7684\u7279\u6027\u53ef\u4ee5\u8ba9\u5e94\u7528\u66f4\u5bb9\u6613\u6269\u5c55\uff0c\u66f4\u5bb9\u6613\u5730\u5b9e\u73b0\u7f13\u5b58\u7b56\u7565\u4ece\u800c\u63d0\u5347\u7cfb\u7edf\u6027\u80fd\u548c\u7528\u6237\u4f53\u9a8c\u3002\u672c\u6587\u5c06\u4ecb\u7ecd\u4ec0\u4e48\u662f RESTful API \u4ee5\u53ca\u6211\u4eec\u5982\u4f55\u4f7f\u7528\u5b83\u3002\\n\\n\u9996\u5148\uff0c\u629b\u5f00 API \u8fd9\u4e2a\u6982\u5ff5\uff0c\u6211\u4eec\u6765\u804a\u804a\u5728\u751f\u6d3b\u4e2d\u5982\u4f55\u4f20\u9012\u4fe1\u606f\u3002\\n\\n\u5f53\u4f60\u5728\u5546\u5e97\u5c06\u94b1\u62ff\u7ed9\u8001\u677f\u544a\u8bc9\u4ed6\u4f60\u9700\u8981\u4e70\u7535\u6c60\uff0c\u8001\u677f\u5728\u6536\u5230\u94b1\u540e\u5728\u8d27\u67b6\u4e0a\u627e\u5230\u7535\u6c60\u5e76\u9012\u7ed9\u4f60\u3002\u4e00\u4e2a\u4e70\u7535\u6c60\u7684\u4ea4\u6613\u987a\u5229\u5b8c\u6210\u3002\\n\\n\u8ba1\u7b97\u673a\u8f6f\u4ef6\u5219\u901a\u8fc7 API \u6765\u5b8c\u6210\u4fe1\u606f\u7684\u4f20\u9012\uff0c\u5148\u6765\u770b\u7ef4\u57fa\u767e\u79d1\u5b9a\u4e49\uff1a\\n\\n> An application programming interface (API) is a way for two or more computer programs to communicate with each other. It is a type of software interface, offering a service to other pieces of software.\\n\\n\u8f6f\u4ef6 A \u901a\u8fc7 API \u5411\u8f6f\u4ef6 B \u53d1\u8d77\u8bf7\u6c42\uff0c\u8f6f\u4ef6 B \u5728\u67e5\u8be2\u81ea\u5df1\u8d44\u6e90\u540e\u5c06\u8bf7\u6c42\u7684\u54cd\u5e94\u5185\u5bb9\u901a\u8fc7 API \u8fd4\u56de A\u3002\\n\\n\u8f6f\u4ef6 A \u901a\u8fc7 API \u5411\u8f6f\u4ef6 B \u53d1\u8d77\u8bf7\u6c42\u5c31\u597d\u6bd4\u4f60\u8ddf\u8001\u677f\u8bf4\u4f60\u9700\u8981\u7535\u6c60\uff0c\u8f6f\u4ef6 B \u5728\u5c06\u6570\u636e\u8fd4\u56de\u7ed9\u8f6f\u4ef6 A \u5c31\u597d\u6bd4\u8001\u677f\u627e\u5230\u7535\u6c60\u540e\u5c06\u7535\u6c60\u7ed9\u4f60\u3002\\n\\n\u8fd9\u4e00\u8fc7\u7a0b\u8f6f\u4ef6 B \u4e0d\u9700\u8981\u77e5\u9053\u8f6f\u4ef6 A \u4e3a\u4ec0\u4e48\u8981\u6570\u636e\uff0c\u5c31\u597d\u6bd4\u5546\u5e97\u8001\u677f\u4e0d\u4f1a\u95ee\u4f60\u4e70\u7535\u6c60\u7684\u76ee\u7684\u3002\u8f6f\u4ef6 A \u4e5f\u4e0d\u9700\u8981\u77e5\u9053 B \u8f6f\u4ef6\u7684\u6570\u636e\u662f\u600e\u4e48\u627e\u5230\u7684\uff0c\u5c31\u597d\u6bd4\u4f60\u4e70\u7535\u6c60\u7684\u65f6\u5019\u4f60\u4e5f\u4e0d\u4f1a\u95ee\u8001\u677f\u7535\u6c60\u4ece\u54ea\u91cc\u8fdb\u8d27\u4e00\u6837\u3002\u6bcf\u4e2a\u8f6f\u4ef6\u4e4b\u95f4\u901a\u8fc7 API \u4f20\u9012\u4fe1\u606f\uff0c\u5404\u53f8\u5176\u4e8b\uff0c\u4f7f\u5f97\u7a0b\u5e8f\u4e16\u754c\u53d8\u5f97\u6709\u5e8f\u53ef\u9760\u3002\\n\\n## \u4ec0\u4e48\u662f RESTful API\\n\\nRoy Fielding \u5728\u4ed6 2000 \u5e74\u7684\u535a\u58eb\u8bba\u6587\u300a\u5efa\u7b51\u98ce\u683c\u548c\u57fa\u4e8e\u7f51\u7edc\u7684\u8f6f\u4ef6\u67b6\u6784\u8bbe\u8ba1\u300b\u4e2d\u5b9a\u4e49\u4e86REST\uff08Representational state transfer\uff09\uff0cREST \u67b6\u6784\u98ce\u683c\u5b9a\u4e49\u4e86\u516d\u4e2a\u6307\u5bfc\u6027\u7ea6\u675f\u3002\u4e00\u4e2a\u7b26\u5408**\u90e8\u5206**\u6216**\u5168\u90e8**\u7ea6\u675f\u7684\u7cfb\u7edf\u88ab\u677e\u6563\u5730\u79f0\u4e3a RESTful\u3002\\n\\n![RESTful API](https://static.apiseven.com/uploads/2023/02/10/mRPLIAud_3291947742.png)  \\n (\u56fe\u7247\u6765\u6e90\uff1aSeobility)\\n\\n### REST \u7684\u7ea6\u675f\u6761\u4ef6\\n\\n|\u7ea6\u675f\u6761\u4ef6|\u8be6\u8ff0|\u4f18\u52bf|\\n|:----|:----|:----|\\n|Client\u2013server architecture|\u901a\u8fc7\u5c06\u7528\u6237\u754c\u9762\u95ee\u9898\u4e0e\u6570\u636e\u5b58\u50a8\u95ee\u9898\u5206\u5f00\uff0c\u63d0\u9ad8\u4e86\u8de8\u591a\u4e2a\u5e73\u53f0\u7684\u7528\u6237\u754c\u9762\u7684\u53ef\u79fb\u690d\u6027\uff0c\u5e76\u901a\u8fc7\u7b80\u5316\u670d\u52a1\u5668\u7ec4\u4ef6\u63d0\u9ad8\u4e86\u53ef\u6269\u5c55\u6027\u3002|1. \u5ba2\u6237\u7aef\u3001\u670d\u52a1\u7aef\u89e3\u8026\u3002<br />2. \u63d0\u5347\u7528\u6237\u5e73\u53f0\u8de8\u5e73\u53f0\u7684\u53ef\u79fb\u690d\u6027\u3002<br />3. \u63d0\u5347\u670d\u52a1\u5668\u7aef\u7684\u53ef\u62d3\u5c55\u6027\u3002|\\n|Statelessness|\u5ba2\u6237\u7aef\u7684\u6bcf\u4e2a\u8bf7\u6c42\u5230\u670d\u52a1\u5668\u5fc5\u987b\u5305\u542b\u8bf7\u6c42\u6240\u9700\u7684\u6240\u6709\u4fe1\u606f\uff0c\u5e76\u4e14\u4e0d\u80fd\u5229\u7528\u670d\u52a1\u5668\u4e0a\u5b58\u50a8\u7684\u4efb\u4f55\u4e0a\u4e0b\u6587\uff0c\u4f1a\u8bdd\u72b6\u6001\u5b8c\u5168\u4fdd\u5b58\u5728\u5ba2\u6237\u7aef\u3002|1. \u6613\u6269\u5c55\uff0c\u65e0\u4f1a\u8bdd\u4f9d\u8d56\uff0c\u4efb\u4f55\u670d\u52a1\u5668\u53ef\u4ee5\u5904\u7406\u4efb\u4f55\u8bf7\u6c42\u3002<br />2. \u6613\u7f13\u5b58\uff0c\u63d0\u5347\u7a0b\u5e8f\u6027\u80fd\u3002|\\n|Cacheability|\u8981\u6c42\u8bf7\u6c42\u54cd\u5e94\u4e2d\u7684\u6570\u636e\u88ab\u9690\u5f0f\u6216\u663e\u5f0f\u6807\u8bb0\u4e3a\u53ef\u7f13\u5b58\u6216\u4e0d\u53ef\u7f13\u5b58\u3002\u5982\u679c\u4e00\u4e2a\u54cd\u5e94\u662f\u53ef\u7f13\u5b58\u7684\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u7f13\u5b58\u5c31\u88ab\u6388\u4e88\u4e3a\u4ee5\u540e\u7684\u7b49\u6548\u8bf7\u6c42\u91cd\u7528\u8be5\u54cd\u5e94\u6570\u636e\u7684\u6743\u5229\u3002|1. \u51cf\u5c11\u5e26\u5bbd\u3002<br />2. \u51cf\u5c11\u5ef6\u8fdf\u3002<br />3. \u51cf\u5c11\u670d\u52a1\u5668\u8d1f\u8f7d\u3002<br />4. \u9690\u85cf\u7f51\u7edc\u72b6\u6001\u3002|\\n|Layered system|\u901a\u8fc7\u7ea6\u675f\u7ec4\u4ef6\u884c\u4e3a\u5141\u8bb8\u67b6\u6784\u7531\u5206\u5c42\u5c42\u7ec4\u6210\uff0c\u8fd9\u6837\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u4e0d\u80fd\u201c\u770b\u5230\u201d\u8d85\u51fa\u5b83\u4eec\u4e0e\u4e4b\u4ea4\u4e92\u7684\u76f4\u63a5\u5c42\u3002\u901a\u8fc7\u5c06\u7cfb\u7edf\u77e5\u8bc6\u9650\u5236\u5728\u5355\u4e2a\u5c42\uff0c\u964d\u4f4e\u4e86\u6574\u4e2a\u7cfb\u7edf\u7684\u590d\u6742\u6027\u5e76\u4fc3\u8fdb\u4e86\u5e95\u5c42\u72ec\u7acb\u6027\u3002|1. \u964d\u4f4e\u6574\u4e2a\u7cfb\u7edf\u7684\u590d\u6742\u6027\u3002<br />2. \u4fc3\u8fdb\u5e95\u5c42\u7684\u72ec\u7acb\u6027\u3002<br />3. \u53ef\u65b9\u4fbf\u5730\u5b9e\u65bd\u8d1f\u8f7d\u5747\u8861\u3002<br />4. \u53ef\u5c06\u4e1a\u52a1\u903b\u8f91\u548c\u5b89\u5168\u7b56\u7565\u89e3\u8026\u3002|\\n|Code on demand (optional)|\u5141\u8bb8\u901a\u8fc7\u4e0b\u8f7d\u548c\u6267\u884c\u5c0f\u7a0b\u5e8f\u6216\u811a\u672c\u5f62\u5f0f\u7684\u4ee3\u7801\u6765\u6269\u5c55\u5ba2\u6237\u7aef\u529f\u80fd\u3002|1. \u63d0\u9ad8\u7cfb\u7edf\u7684\u53ef\u6269\u5c55\u6027\u3002|\\n|Uniform interface|\u4e3b\u8981\u5305\u542b\u56db\u70b9\uff1a<br />1. Resource identification in requests.<br />\u5ba2\u6237\u80fd\u591f\u901a\u8fc7\u8bf7\u6c42\u4e2d\u5305\u542b\u7684 URI \u6765\u8bc6\u522b\u4e00\u4e2a\u8d44\u6e90\uff0c\u5c06\u670d\u52a1\u7aef\u8d44\u6e90\u548c\u5ba2\u6237\u7aef\u8bf7\u6c42\u8d44\u6e90\u89e3\u8026\u3002<br />2. Resource manipulation through representations.<br />\u5f53\u5ba2\u6237\u7aef\u62e5\u6709\u4e00\u4e2a\u8d44\u6e90\u7684\u8868\u793a\uff0c\u5982 URI\uff0c\u90a3\u4e48\u5c31\u6709\u8db3\u591f\u7684\u4fe1\u606f\u6765\u4fee\u6539\u6216\u8005\u5220\u9664\u8d44\u6e90\u3002<br />3. Self-descriptive messages.<br />\u6bcf\u4e2a\u6d88\u606f\u90fd\u5305\u62ec\u8db3\u591f\u7684\u4fe1\u606f\u6765\u544a\u77e5\u5ba2\u6237\u5ba2\u6237\u7aef\u8be5\u5982\u4f55\u5904\u7406\u8be5\u4fe1\u606f\u3002<br />4. Hypermedia as the engine of application state ([HATEOAS](https://github.com/api7/contents/blob/691305a1293991d7b0b39a0ac9a7a655c935778a/blog/https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FHATEOAS)).<br />\u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u4efb\u4f55\u989d\u5916\u7684\u7f16\u7801\u901a\u8fc7\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u8d44\u6e90\u94fe\u63a5\uff0c\u5c31\u53ef\u4ee5\u4f7f\u5f97\u7528\u6237\u83b7\u53d6\u6240\u6709\u7684\u8d44\u6e90\u3002|1. \u7b80\u5316\u4e86\u6574\u4f53\u7cfb\u7edf\u67b6\u6784\u3002<br />2. \u63d0\u9ad8\u4e86\u4ea4\u4e92\u7684\u53ef\u89c1\u6027\u3002|\\n\\n## RESTful API \u6700\u4f73\u5b9e\u8df5\\n\\n\u5f3a\u8c03\u7ec4\u4ef6\u95f4\u7684 **\u7edf\u4e00\u63a5\u53e3** \u662f REST \u67b6\u6784\u98ce\u683c\u4e0e\u5176\u4ed6\u57fa\u4e8e\u7f51\u7edc\u7684\u98ce\u683c\u533a\u5206\u5f00\u6765\u7684\u6838\u5fc3\u7279\u5f81\uff0c\u57fa\u4e8e\u6b64\u7279\u5f81\uff0c\u672c\u6587\u68b3\u7406\u4e86RSETful \u6700\u4f73\u5b9e\u8df5\uff0c\u4ee5\u5e2e\u52a9\u4f60\u66f4\u597d\u5730\u8bbe\u8ba1 API\u3002\\n\\n### \u8def\u5f84\u540d\u79f0\u907f\u514d\u52a8\u8bcd\\n\\n\u4f7f\u7528 HTTP \u65b9\u6cd5\u6765\u8868\u8fbe\u8d44\u6e90\u64cd\u4f5c\u884c\u4e3a\uff0c\u800c\u4e0d\u662f\u5c06\u884c\u4e3a\u52a8\u8bcd\u5b9a\u4e49\u5230\u8def\u5f84\u4e2d\u3002\\n\\n```shell\\n# Good\\ncurl -X GET http://httpbin.org/orders\\n\\n# Bad\\ncurl -X GET \\"http://httpbin.org/getOrders\\"\\n```\\n\\n* GET \u83b7\u53d6\u6307\u5b9a URI \u7684\u8d44\u6e90\u4fe1\u606f\\n\\n```shell\\n# \u4ee3\u8868\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u7684\u6240\u6709\u8ba2\u5355\u4fe1\u606f\\ncurl -X GET http://httpbin.org/orders\\n\\n# \u4ee3\u8868\u83b7\u53d6\u8ba2\u5355\u7f16\u53f7\u4e3a 1 \u7684\u8ba2\u5355\u8be6\u60c5\u4fe1\u606f\\ncurl -X GET http://httpbin.org/orders/1\\n```\\n\\n* POST \u901a\u8fc7\u6307\u5b9a\u7684 URI \u521b\u5efa\u8d44\u6e90\\n\\n```plain\\n# \u4ee3\u8868\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u4e3a order \u7684\u8d44\u6e90\\ncurl -X POST http://httpbin.org/orders \\\\\\n  -d \'{\\"name\\": \\"awesome\\", region: \\"A\\"}\' \\\\\\n```\\n\\n* PUT \u521b\u5efa\u6216\u5168\u91cf\u66ff\u6362\u6307\u5b9a URI \u4e0a\u7684\u8d44\u6e90\\n\\n```shell\\n# \u4ee3\u8868\u5c06 id \u4e3a 1 \u7684 order \u8fdb\u884c\u6570\u636e\u66ff\u6362\\ncurl -X PUT http://httpbin.org/orders/1 \\\\\\n  -d \'{\\"name\\": \\"new awesome\\", region: \\"B\\"}\' \\\\\\n```\\n\\n* PATCH \u6267\u884c\u4e00\u4e2a\u8d44\u6e90\u7684\u90e8\u5206\u66f4\u65b0\\n\\n```shell\\n# \u4ee3\u8868\u5c06 id \u4e3a 1 \u7684 order \u4e2d\u7684 region \u5b57\u6bb5\u8fdb\u884c\u66f4\u6539\uff0c\u5176\u4ed6\u6570\u636e\u4fdd\u6301\u4e0d\u53d8\\ncurl -X PATCH http://httpbin.org/orders/1 \\\\\\n  -d \'{region: \\"B\\"}\' \\\\\\n```\\n\\n* DELETE \u901a\u8fc7\u6307\u5b9a\u7684 URI \u79fb\u9664\u8d44\u6e90\\n\\n```shell\\n# \u4ee3\u8868\u5c06 id \u4e3a 1 \u7684 order \u5220\u9664\\ncurl -X DELETE http://httpbin.org/orders/1\\n```\\n\\n### URI \u4f7f\u7528\u590d\u6570\u5f62\u5f0f\\n\\n\u82e5\u4f7f\u7528\u5355\u6570\u7684\u5f62\u5f0f\u6765\u8868\u793a\u83b7\u53d6\u67d0\u4e00\u7c7b\u8d44\u6e90\uff0c\u4f8b\u5982\uff1a\\n\\n```shell\\ncurl -X GET \\"http://httpbin.org/order\\"\\n```\\n\\n\u4f7f\u7528\u5355\u6570\u5f62\u5f0f\uff0c\u4f1a\u4f7f\u7528\u6237\u4ea7\u751f\u8be5\u7cfb\u7edf\u4e2d\u53ea\u6709\u4e00\u4e2a order \u7684\u56f0\u60d1\uff0c\u7528\u590d\u6570\u5f62\u5f0f\u5728\u903b\u8f91\u4e0a\u5219\u987a\u7545\u5f88\u591a\u3002\\n\\n```shell\\ncurl -X GET \\"http://httpbin.org/orders\\"\\n```\\n\\n### \u5584\u7528 HTTP \u72b6\u6001\u7801\\n\\nHTTP \u6807\u51c6\u5b9a\u4e49\u4e2a\u72b6\u6001\u7801\uff0c\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u7c7b\uff1a\\n\\n|\u72b6\u6001\u7801|\u542b\u4e49|\\n|:----|:----|\\n|2xx|\u6210\u529f\uff0c\u64cd\u4f5c\u88ab\u6210\u529f\u63a5\u6536\u5e76\u5904\u7406|\\n|3xx|\u91cd\u5b9a\u5411\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u7684\u64cd\u4f5c\u4ee5\u5b8c\u6210\u8bf7\u6c42|\\n|4xx|\u5ba2\u6237\u7aef\u9519\u8bef\uff0c\u8bf7\u6c42\u5305\u542b\u8bed\u6cd5\u9519\u8bef\u6216\u65e0\u6cd5\u5b8c\u6210\u8bf7\u6c42|\\n|5xx|\u670d\u52a1\u5668\u9519\u8bef\uff0c\u670d\u52a1\u5668\u5728\u5904\u7406\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e86\u9519\u8bef|\\n\\n\u4f7f\u7528\u6807\u51c6\u72b6\u6001\u7801\uff0c\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u7acb\u5373\u8bc6\u522b\u95ee\u9898\uff0c\u53ef\u4ee5\u51cf\u5c11\u53d1\u73b0\u4e0d\u540c\u7c7b\u578b\u9519\u8bef\u7684\u65f6\u95f4\u3002\\n\\n### \u7248\u672c\u7ba1\u7406\\n\\n\u968f\u7740\u4e1a\u52a1\u9700\u6c42\u7684\u53d8\u66f4\uff0c\u5df2\u7ecf\u4e0a\u7ebf\u7684 API \u5927\u6982\u7387\u662f\u8981\u5bf9\u5e94\u8c03\u6574\u7684\u3002\u5982\u679c\u6211\u4eec\u7684 API \u6709\u7b2c\u4e09\u65b9\u5728\u4f7f\u7528\uff0c\u8ba9\u6bcf\u4e00\u4e2a\u5ba2\u6237\u7aef\u6839\u636e\u6211\u4eec API \u7684\u53d8\u66f4\u800c\u53d8\u66f4\u663e\u7136\u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u8981\u5f15\u5165 API \u7248\u672c\u7ba1\u7406\u6982\u5ff5\u4e86\uff0c\u65e2\u53ef\u4ee5\u4fdd\u8bc1\u5386\u53f2 API \u6b63\u5e38\u4f7f\u7528\uff0c\u53c8\u53ef\u4ee5\u8fed\u4ee3\u65b0\u7684 API \u4ee5\u6ee1\u8db3\u65b0\u7684\u4e1a\u52a1\u9700\u6c42\u3002\\n\\n\u5e38\u89c1\u7684\u7248\u672c\u63a7\u5236\u624b\u6bb5\u6709\uff1a\\n\\n* \u901a\u8fc7\u8bf7\u6c42\u4e2d\u8def\u5f84\u6765\u505a\u7248\u672c\u63a7\u5236\\n\\n```shell\\n# \u8bf7\u6c42 v1 \u7248\u672c\u7684API\\ncurl  http://httpbin.org/v1/orders\\n\\n# \u8bf7\u6c42 v2 \u7248\u672c\u7684API\\ncurl  http://httpbin.org/v2/orders\\n```\\n\\n* \u901a\u8fc7 Query \u53c2\u6570\u6765\u505a\u7248\u672c\u63a7\u5236\\n\\n```shell\\n# \u8bf7\u6c42 v1 \u7248\u672c\u7684API\\ncurl  http://httpbin.org/orders?version=v1\\n\\n# \u8bf7\u6c42 v2 \u7248\u672c\u7684API\\ncurl  http://httpbin.org/v2/orders?version=v2\\n```\\n\\n* \u901a\u8fc7 Header \u6765\u505a\u7248\u672c\u63a7\u5236\\n\\n```shell\\n# \u8bf7\u6c42 v1 \u7248\u672c\u7684API\\ncurl  http://httpbin.org/orders -H \\"custom-version: v1\\"\\n\\n# \u8bf7\u6c42 v2 \u7248\u672c\u7684API\\ncurl  http://httpbin.org/orders -H \\"custom-version: v2\\"\\n```\\n\\n## APISIX \u5982\u4f55\u52a9\u529b RESTful API\\n\\n\u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0cApache APISIX \u53ef\u4ee5\u5728\u4efb\u4f55 RESTful API \u670d\u52a1\u4e0a\u8fd0\u884c\uff0c\u5e76\u4f7f\u7528\u63d2\u4ef6\u6765\u6dfb\u52a0\u65b0\u7684\u670d\u52a1\u548c\u6269\u5c55\u5176\u529f\u80fd\uff0c\u8fd9\u7b26\u5408 RESTful \u5b9a\u4e49\u4e2d\u7684 **Layered system**\u3002\u6b64\u5916\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u6ca1\u6709\u9075\u5faa RESTful API \u5b9a\u4e49\u7684\u5386\u53f2\u670d\u52a1\uff0c APISIX \u4e5f\u53ef\u4ee5\u5e2e\u4f60\u5728**\u4e0d\u6539\u52a8\u539f\u6709\u4e1a\u52a1\u4ee3\u7801**\u7684\u60c5\u51b5\u4e0b\u5b8c\u6210\u63a5\u53e3\u7684\u8f6c\u6362\uff0c\u4f7f\u4f60\u7684\u63a5\u53e3\u5b8c\u6210 **Uniform interface** \u8fd9\u4e00 REST \u9650\u5236\u6761\u4ef6\uff0c\u4f7f\u4f60\u7684 API \u53ef\u4ee5\u66f4\u597d\u5730\u9075\u5b88 RESTful API \u89c4\u8303\u3002\\n\\n### \u5206\u5c42\u7cfb\u7edf\uff1a\u652f\u6301\u4e1a\u52a1\u903b\u8f91\u548c\u5b89\u5168\u903b\u8f91\u7684\u5206\u5272\\n\\n\u4f60\u53ef\u4ee5\u53ea\u7528\u5173\u6ce8\u4e1a\u52a1\u903b\u8f91\u7684\u5b9e\u73b0\uff0c\u63a5\u53e3\u7684\u5b89\u5168\u903b\u8f91\u53ef\u4ee5\u4ea4\u7ed9 APISIX Authentication \u7c7b\u63d2\u4ef6\u5904\u7406\uff0c\u4f8b\u5982 [key-auth](https://apisix.apache.org/docs/apisix/plugins/key-auth)\u3002APISIX \u652f\u6301\u5927\u91cf\u7684 Authentication \u63d2\u4ef6\uff0c\u6211\u4eec\u4ee5 [openid-connet](https://apisix.apache.org/docs/apisix/plugins/openid-connect/) \u4e3a\u4f8b\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![APISIX \u7684\u4f5c\u7528](https://static.apiseven.com/uploads/2023/02/10/YP0k3mhR_3873553149.png)\\n\\n \u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528 APISIX\uff08API Gateway\uff09\u5728\u4e1a\u52a1\u670d\u52a1\u5668\u524d\u9762\u52a0\u4e00\u5c42\u8ba4\u8bc1\u903b\u8f91\uff0c\u5c31\u53ef\u4ee5\u8d77\u5230\u4fdd\u62a4\u4e0a\u6e38\u670d\u52a1\u7684\u4f5c\u7528\uff0c\u8ba9\u4f60\u7684\u4e1a\u52a1\u903b\u8f91\u548c\u5b89\u5168\u903b\u8f91\u9ad8\u6548\u89e3\u8026\u3002\\n\\n### Layered system\uff1a\u591a\u8d1f\u8f7d\u5747\u8861\u534f\u8bae\u652f\u6301\\n\\nAPISIX \u4f5c\u4e3a API \u7f51\u5173\uff0c\u53ef\u4ee5\u8bbe\u7acb\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4e4b\u95f4\uff0c\u5b8c\u6210\u4e0d\u540c\u7684\u8d1f\u8f7d\u9700\u6c42\u3002\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5b9a\u4e49\u8d1f\u8f7d\u5747\u8861\u7684\u903b\u8f91\u3002\\n\\n\u652f\u6301\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u6709\uff1a\\n\\n* `roundrobin`: Round robin balancing with weights.\\n* `chash`: Consistent hash.\\n* `ewma`: Pick the node with minimum latency. See [EWMA Chart](https://github.com/api7/contents/blob/691305a1293991d7b0b39a0ac9a7a655c935778a/blog/https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FEWMA_chart) for more details.\\n* `least_conn`: Picks the node with the lowest value of `(active_conn + 1) / weight`. Here, an active connection is a connection being used by the request and is similar to the concept in Nginx.\\n* user-defined load balancer loaded via `require(\\"apisix.balancer.your_balancer\\")`\\n\\n### \u7edf\u4e00\u63a5\u53e3\uff1a\u4f7f\u5386\u53f2 API \u66f4\u52a0 RESTful\\n\\n\u5bf9\u4e8e\u5df2\u7ecf\u5b58\u5728\u5f88\u4e45\u7684\u5386\u53f2 API\uff0c\u5982\u679c\u6ca1\u6709\u5f88\u597d\u5730\u9075\u5faa RESTful API \u51c6\u5219\u3002\u4f60\u53ef\u4ee5\u5728\u4e0d\u6539\u9020\u539f\u6709 API \u903b\u8f91\u7684\u60c5\u51b5\u4e0b\u91cd\u65b0\u901a\u8fc7 APISIX \u6765\u5c01\u88c5\u65b0\u7684 API \u4ee5\u6ee1\u8db3\u4e0d\u540c\u7684\u4e1a\u52a1\u573a\u666f\u3002\\n\\n#### \u4f7f\u7528 [proxy-rewrite](https://apisix.apache.org/docs/apisix/plugins/proxy-rewrite/) \u6539\u5199\u5ba2\u6237\u7aef\u8bf7\u6c42\\n\\n\u5728\u672c\u6587\u4e2d\u4e0a\u65b9\u63d0\u8fc7\u6211\u4eec\u7684\u8def\u5f84\u4e2d\u4e0d\u8981\u6709\u52a8\u8bcd\u3002\\n\\n\u4f8b\u5982\uff1a\u5386\u53f2\u7248\u672c API \u6709 `/getOrder` \u63a5\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `proxy-rewrite` \u63d2\u4ef6\u6765\u5c06 API \u8bf7\u6c42\u4ee3\u7406\u5230\u5386\u53f2 API \u4e0a\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/orders\\",\\n    \\"plugins\\": {\\n        \\"proxy-rewrite\\": {\\n            \\"uri\\": \\"/getOrder\\",\\n            \\"scheme\\": \\"http\\",\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:80\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u4f60\u4e5f\u53ef\u4ee5\u540c\u6837\u4f7f\u7528\u8be5\u63d2\u4ef6\u8fdb\u884c API \u7248\u672c\u7ba1\u7406\u4e0a\u7684\u64cd\u4f5c\u3002\\n\\n#### \u4f7f\u7528 [response-rewrite](https://apisix.apache.org/docs/apisix/plugins/response-rewrite/) \u63d2\u4ef6\u6539\u5199\u670d\u52a1\u7aef\u54cd\u5e94\\n\\n\u5f53\u6211\u4eec\u7684\u5386\u53f2 API \u5b58\u5728\u54cd\u5e94\u72b6\u6001\u7801\u4e0d\u89c4\u8303\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `response-rewrite` \u4ee3\u7406 response \u54cd\u5e94\u4ece\u800c\u8fbe\u5230\u4fee\u6539\u54cd\u5e94\u72b6\u6001\u7801\u7684\u76ee\u7684\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/orders\\",\\n    \\"plugins\\": {\\n        \\"response-rewrite\\": {\\n            \\"status_code\\": 201,\\n            \\"body\\": \\"{\\\\\\"code\\\\\\":\\\\\\"ok\\\\\\",\\\\\\"message\\\\\\":\\\\\\"new json body\\\\\\"}\\",\\n            \\"vars\\":[\\n                [ \\"status\\",\\"==\\",200 ]\\n            ]\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:80\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u4f8b\u5982\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u8868\u793a\u5c06\u8bf7\u6c42 `/orders` \u8def\u5f84\u7684 API \u4e2d\u54cd\u5e94\u4e3a `200` \u7684\u72b6\u6001\u7684\u8bf7\u6c42\u4fee\u6539\u4e3a `201`\u3002\\nAPISIX \u652f\u6301\u975e\u5e38\u4e30\u5bcc\u7684\u63d2\u4ef6\uff0c\u671f\u5f85\u4f60\u53bb\u6316\u6398\u66f4\u591a\u7684\u73a9\u6cd5\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u8be6\u7ec6\u8bf4\u660e\u4e86\u4ec0\u4e48\u662f API\uff0c\u4ec0\u4e48\u662f RESTful API \u4ee5\u53ca\u5176\u6700\u4f73\u5b9e\u8df5\u3002\u53e6\u5916\u8fd8\u4ecb\u7ecd\u4e86\u5982\u4f55\u901a\u8fc7 APISIX \u6765\u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\u548c\u5b89\u5168\u903b\u8f91\u5206\u79bb\uff0c\u5982\u4f55\u4f7f\u7528 APISIX \u5728\u4e0d\u6539\u52a8\u539f\u6709\u4e1a\u52a1\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u5c06\u5386\u53f2 API \u670d\u52a1\u66f4\u52a0 RESTful\u3002\u5e0c\u671b\u672c\u6587\u5bf9\u4f60\u4e86\u89e3 RESTful API \u6709\u6240\u5e2e\u52a9\uff0c\u4e5f\u6b22\u8fce\u4f60\u6765 GitHub \u4e00\u8d77\u73a9\u800d\u3002"},{"id":"APISIX Ingress \u5982\u4f55\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66","metadata":{"permalink":"/zh/blog/2023/02/07/apisix-ingress-with-cert-mamager","source":"@site/blog/2023/02/07/apisix-ingress-with-cert-mamager.md","title":"APISIX Ingress \u5982\u4f55\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66","description":"\u672c\u6587\u4e2d\u4ecb\u7ecd\u4e86 Kubernetes \u4e2d\u8bc1\u4e66\u7684\u9ed8\u8ba4\u5b58\u50a8\u65b9\u5f0f\uff0c\u4ee5\u53ca\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u7684\u4e00\u4e9b\u75db\u70b9\u3002cert-manager \u7684\u51fa\u73b0\u6bd4\u8f83\u597d\u7684\u89e3\u51b3\u4e86\u8fd9\u4e9b\u95ee\u9898\uff0c\u9010\u6b65\u6210\u4e3a\u4e86 Kubernetes \u751f\u6001\u4e2d\u8bc1\u4e66\u7b7e\u53d1/\u7ba1\u7406\u9886\u57df\u4e2d\u7684\u4e8b\u5b9e\u6807\u51c6\u3002","date":"2023-02-07T00:00:00.000Z","formattedDate":"2023\u5e742\u67087\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":7.685,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","title":"Author","url":"https://github.com/tao12345666333","image_url":"https://github.com/tao12345666333.png","imageURL":"https://github.com/tao12345666333.png"}],"prevItem":{"title":"RESTful API \u4e3a\u4f55\u6210\u4e3a\u9876\u6d41 API \u67b6\u6784\u98ce\u683c\uff1f","permalink":"/zh/blog/2023/02/08/what-is-restful-api"},"nextItem":{"title":"2022 \u5e74\u5ea6\u4f18\u8d28\u6587\u7ae0\u76d8\u70b9 Top10","permalink":"/zh/blog/2023/02/06/2022-top10-blogs"}},"content":"> Cert Manager \u89e3\u51b3\u4e86 Kubernetes \u4e2d\u8bc1\u4e66\u7684\u9ed8\u8ba4\u5b58\u50a8\u65b9\u5f0f\u7684\u75db\u70b9\uff0c\u5e76\u9010\u6b65\u6210\u4e3a\u4e86 Kubernetes \u751f\u6001\u4e2d\u8bc1\u4e66\u7b7e\u53d1\u548c\u7ba1\u7406\u9886\u57df\u4e2d\u7684\u4e8b\u5b9e\u6807\u51c6\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u5f20\u664b\u6d9b](https://github.com/tao12345666333)\uff0cAPI7.ai \u4e91\u539f\u751f\u5de5\u7a0b\u5e08\uff0cApache APISIX PMC\u3002\\n\\n[Apache APISIX Ingress Controller](https://github.com/apache/apisix-ingress-controller) \u662f\u4e00\u6b3e\u4ee5 [Apache APISIX](http://apisix.apache.org/) \u4f5c\u4e3a\u6570\u636e\u9762\u7684 [Kubernetes Ingress Controller](https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/) \u5f00\u6e90\u5de5\u5177\uff0c\u76ee\u524d\u5df2\u7ecf\u66f4\u65b0\u5230 [v1.3](https://github.com/apache/apisix-ingress-controller/blob/master/CHANGELOG.md#130) \u7248\u672c\uff0c\u5b9e\u73b0\u4e86\u5982\u8bc1\u4e66\u7ba1\u7406\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u91d1\u4e1d\u96c0\u53d1\u5e03\u7b49\u529f\u80fd\u3002\\n\\n\u957f\u4e45\u4ee5\u6765\uff0c\u8bc1\u4e66\u7ba1\u7406\u90fd\u4e0d\u662f\u4e00\u4ef6\u7b80\u5355\u7684\u4e8b\u60c5\uff0c\u867d\u7136 Apache APISIX Ingress Controller \u652f\u6301\u4ece Kubernetes Secrets \u8d44\u6e90\u4e2d\u63d0\u53d6\u8bc1\u4e66\u548c\u79c1\u94a5\uff0c\u5e76\u8f6c\u6362\u4e3a Apache APISIX \u53ef\u8bc6\u522b\u7684 SSL \u5bf9\u8c61\uff0c\u4f46\u8fd9\u53ea\u662f\u6574\u4e2a\u8bc1\u4e66\u7ba1\u7406\u94fe\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u8bc1\u4e66\u7684\u9881\u53d1\u3001\u8f6e\u8f6c\u3001\u540a\u9500\u903b\u8f91\u4f9d\u7136\u9700\u8981\u7ba1\u7406\u5458\u6267\u884c\uff0c\u5c24\u5176\u5f53\u8bc1\u4e66\u6570\u91cf\u6bd4\u8f83\u591a\u65f6\uff0c\u5de5\u4f5c\u91cf\u5f80\u5f80\u5e76\u4e0d\u5c0f\uff0c\u56e0\u800c\u4f1a\u5360\u7528\u7ba1\u7406\u5458\u4e0d\u5c11\u7684\u65f6\u95f4\u3002\\n\\n[Cert Manager](https://cert-manager.io/docs/) \u662f\u4e00\u6b3e\u81f4\u529b\u4e8e\u5728 Kubernetes \u5e73\u53f0\u4e0a\u7b80\u5316\u8bc1\u4e66\u7ba1\u7406\u7684\u8f6f\u4ef6\uff0c\u5b83\u652f\u6301\u5bf9\u63a5\u8bb8\u591a\u4e0d\u540c\u7684\u8bc1\u4e66\u6e90\uff0c\u5982 [Let\'s Encrypt](https://letsencrypt.org/) \u548c [HashiCorp Vault](https://www.vaultproject.io/)\u3002\\n\\n\u5982\u679c\u4f60\u5728\u4f7f\u7528 Apache APISIX Ingress Controller \u65f6\uff0c\u9047\u5230\u4e86\u8bc1\u4e66\u7ba1\u7406\u7684\u9ebb\u70e6\uff0c\u90a3\u4e48\u4f7f\u7528 Cert Manager \u5c06\u4f1a\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\uff0c\u672c\u6587\u5c06\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 Cert Manager \u6765\u521b\u5efa\u8bc1\u4e66\u5e76\u5bf9\u63a5\u5230 Apache APISIX Ingress Controller\u3002\\n\\n## \u6b65\u9aa4\u4e00\uff1a\u73af\u5883\u51c6\u5907\\n\\n\u5982\u679c\u4f60\u5e0c\u671b\u6309\u7167\u672c\u6587\u7684\u6307\u5bfc\u8fdb\u884c\u5b9e\u9645\u7684\u64cd\u4f5c\uff0c\u8bf7\u786e\u4fdd\u4ee5\u4e0b\u73af\u5883\u548c\u5de5\u5177\u5df2\u51c6\u5907\u5c31\u7eea\uff1a\\n\\n1. \u51c6\u5907\u4e00\u4e2a\u53ef\u7528\u7684 Kubernetes \u96c6\u7fa4\uff0c\u5f00\u53d1\u73af\u5883\u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 [Kind](https://kind.sigs.k8s.io/) \u548c [Minikube](https://kubernetes.io/docs/tutorials/hello-minikube/)\\n2. \u5b89\u88c5 [kubectl](https://kubernetes.io/docs/tutorials/hello-minikube/)\\n3. \u5b89\u88c5 [Helm v3](https://helm.sh/)\\n\\n> \u8bf7\u6ce8\u610f\uff0c\u4e0b\u6587\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u5c06\u5728 ingress-apisix \u547d\u540d\u7a7a\u95f4\u4e2d\u6267\u884c\uff0c\u56e0\u6b64\u9700\u8981\u5148\u521b\u5efa\u8be5\u547d\u540d\u7a7a\u95f4\uff1a`kubectl create namespace ingress-apisix`\\n\\n## \u6b65\u9aa4\u4e8c\uff1a\u5b89\u88c5 Apache APISIX Ingress Controller\\n\\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Helm \u6765\u5b89\u88c5 Apache APISIX Ingress Controller\uff0c\u5305\u62ec\u6570\u636e\u9762\u7684 Apache APISIX \u548c etcd \u96c6\u7fa4\u3002\\n\\n```bash\\nhelm repo add apisix https://charts.apiseven.com\\nhelm repo update\\nhelm install apisix apisix/apisix --set gateway.tls.enabled=true --set ingress-controller.enabled=true --namespace ingress-apisix\\n```\\n\\n\u70b9\u51fb\u67e5\u770b[\u8be6\u7ec6\u5b89\u88c5\u4ecb\u7ecd](https://github.com/apache/apisix-helm-chart/blob/master/charts/apisix/README.md)\u3002\\n\\n## \u6b65\u9aa4\u4e09\uff1a\u5b89\u88c5 Cert Manager\\n\\n\u901a\u8fc7 Helm \u6765\u5b89\u88c5 Cert Manager\uff0c\u70b9\u51fb\u53ef\u67e5\u770b[\u8be6\u7ec6\u5b89\u88c5\u4ecb\u7ecd](https://cert-manager.io/docs/installation/)\u3002\\n\\n```bash\\nhelm install cert-manager jetstack/cert-manager --namespace ingress-apisix  --set prometheus.enabled=false --set installCRDs=true\\n```\\n\\n\u5b89\u88c5\u5b8c\u6bd5\u540e\u8bf7\u7b49\u5f85\u4e00\u4f1a\u540e\u67e5\u770b\u7ec4\u4ef6\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u786e\u4fdd\u6240\u6709\u7ec4\u4ef6\u90fd\u5df2\u6b63\u5e38\u8fd0\u884c\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u67e5\u770b\u3002\\n\\n```bash\\nkubectl get all -n ingress-apisix\\n```\\n\\n\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\u6240\u793a\uff0c\u8868\u793a\u6240\u6709\u7ec4\u4ef6\u90fd\u5df2\u6b63\u5e38\u8fd0\u884c\u3002\\n\\n```bash\\nNAME                                             READY   STATUS        RESTARTS   AGE\\npod/apisix-5d99956d88-j68sj                      1/1     Running       0          63s\\npod/apisix-69459554d4-btnwn                      0/1     Terminating   0          57m\\npod/apisix-etcd-0                                1/1     Running       0          57m\\npod/apisix-etcd-1                                1/1     Running       0          57m\\npod/apisix-etcd-2                                0/1     Running       0          50s\\npod/apisix-ingress-controller-7b5c767cc7-j62hb   1/1     Running       0          55m\\npod/cert-manager-5ffd4f6c89-q9f7m                1/1     Running       0          45m\\npod/cert-manager-cainjector-748dc889c5-nrvkh     1/1     Running       0          45m\\npod/cert-manager-startupapicheck-kmgxf           0/1     Completed     0          45m\\npod/cert-manager-webhook-bc964d98b-mkjj7         1/1     Running       0          45m\\n\\nNAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\\nservice/apisix-admin                ClusterIP   10.96.16.25     <none>        9180/TCP                     57m\\nservice/apisix-etcd                 ClusterIP   10.96.232.251   <none>        2379/TCP,2380/TCP            57m\\nservice/apisix-etcd-headless        ClusterIP   None            <none>        2379/TCP,2380/TCP            57m\\nservice/apisix-gateway              NodePort    10.96.118.75    <none>        80:32039/TCP,443:30107/TCP   57m\\nservice/apisix-ingress-controller   ClusterIP   10.96.13.76     <none>        80/TCP                       57m\\nservice/cert-manager-webhook        ClusterIP   10.96.182.188   <none>        443/TCP                      45m\\n\\nNAME                                        READY   UP-TO-DATE   AVAILABLE   AGE\\ndeployment.apps/apisix                      1/1     1            1           57m\\ndeployment.apps/apisix-ingress-controller   1/1     1            1           57m\\ndeployment.apps/cert-manager                1/1     1            1           45m\\ndeployment.apps/cert-manager-cainjector     1/1     1            1           45m\\ndeployment.apps/cert-manager-webhook        1/1     1            1           45m\\n\\nNAME                                                   DESIRED   CURRENT   READY   AGE\\nreplicaset.apps/apisix-5d99956d88                      1         1         1       63s\\nreplicaset.apps/apisix-69459554d4                      0         0         0       57m\\nreplicaset.apps/apisix-ingress-controller-74c6b5fbdd   0         0         0       57m\\nreplicaset.apps/apisix-ingress-controller-7b5c767cc7   1         1         1       55m\\nreplicaset.apps/apisix-ingress-controller-7d58db957c   0         0         0       55m\\nreplicaset.apps/cert-manager-5ffd4f6c89                1         1         1       45m\\nreplicaset.apps/cert-manager-cainjector-748dc889c5     1         1         1       45m\\nreplicaset.apps/cert-manager-webhook-bc964d98b         1         1         1       45m\\n\\nNAME                           READY   AGE\\nstatefulset.apps/apisix-etcd   2/3     57m\\n\\nNAME                                     COMPLETIONS   DURATION   AGE\\njob.batch/cert-manager-startupapicheck   1/1           6m24s      45m\\n```\\n\\n> [Kubernetes Controller Manager](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-controller-manager/) \u7684\u673a\u5236\u51b3\u5b9a\u4e86 Pod \u540d\u79f0\u4f1a\u6709\u6240\u4e0d\u540c\u3002\\n\\n## \u6b65\u9aa4\u56db\uff1a\u7533\u8bf7\u8bc1\u4e66\u5e76\u6d4b\u8bd5\\n\\n\u9996\u5148\u6211\u4eec\u9700\u8981\u914d\u7f6e\u8bc1\u4e66\u9881\u53d1\u5bf9\u8c61\u3002\\n\\n```yaml\\n# issuer.yaml\\napiVersion: cert-manager.io/v1\\nkind: Issuer\\nmetadata:\\n  name: issuer\\n  namespace: ingress-apisix\\nspec:\\n  selfSigned: {}\\n```\\n\\n\u5e76\u521b\u5efa\u81ea\u7b7e\u540d\u8bc1\u4e66\u9881\u53d1\u8005\u3002\\n\\n```bash\\nkubectl apply -f issuer.yaml\\n```\\n\\n> \u8bf7\u6ce8\u610f\uff0c\u81ea\u7b7e\u540d\u9881\u53d1\u5bf9\u8c61\u4e0d\u63a8\u8350\u4f7f\u7528\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff01\u66f4\u591a\u8bc1\u4e66\u9881\u53d1\u5bf9\u8c61\u7684\u914d\u7f6e\u8bf7\u53c2\u8003[\u8fd9\u91cc](https://cert-manager.io/docs/configuration/)\u3002\\n\\n\u7136\u540e\u4e3a\u57df\u540d `httpbin.org` \u521b\u5efa\u4e00\u5f20\u8bc1\u4e66\u3002\\n\\n```yaml\\n# httpbin-cert.yaml\\napiVersion: cert-manager.io/v1\\nkind: Certificate\\nmetadata:\\n  name: httpbin\\n  namespace: ingress-apisix\\nspec:\\n  secretName: httpbin\\n  duration: 2160h # 90d\\n  renewBefore: 360h # 15d\\n  subject:\\n    organizations:\\n      - foo\\n  commonName: httpbin.org\\n  isCA: false\\n  privateKey:\\n    algorithm: RSA\\n    encoding: PKCS1\\n    size: 2048\\n  usages:\\n    - server auth\\n  dnsNames:\\n    - \\"httpbin.org\\"\\n    - \\"*.httpbin.org\\"\\n  issuerRef:\\n    name: issuer\\n    kind: Issuer\\n    group: cert-manager.io\\nkubectl apply -f httpbin-cert.yaml\\n```\\n\\n\u6b64\u65f6\u9700\u8981\u67e5\u770b\u5bf9\u5e94 Secrets \u662f\u5426\u5df2\u7ecf\u88ab\u521b\u5efa\u3002\\n\\n```plain\\nkubectl get secrets -n ingress-apisix httpbin\\nNAME      TYPE                DATA   AGE\\nhttpbin   kubernetes.io/tls   3      2m5s\\n```\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u9a8c\u8bc1\uff0c\u8be5 Secrets \u5bf9\u8c61\u7684\u521b\u5efa\u4e8b\u4ef6\u5df2\u7ecf\u88ab Apache APISIX Ingress Controller \u6355\u83b7\u5230\uff0c\u6211\u4eec\u5c1d\u8bd5\u8bbf\u95ee Apache APISIX Ingress Controller \u6765\u9a8c\u8bc1\u8bc1\u4e66\u662f\u5426\u751f\u6548\uff0c\u9996\u5148\u6211\u4eec\u9700\u8981\u521b\u5efa\u989d\u5916\u7684\u8def\u7531\u5bf9\u8c61\u3002\\n\\n```bash\\n# \u521b\u5efa\u540e\u7aef\\nkubectl run httpbin --image kennethreitz/httpbin --namespace ingress-apisix\\nkubectl expose pod httpbin -n ingress-apisix --port 80\\n# \u5b9a\u4e49 ApisixTls \u5bf9\u8c61\\napiVersion: apisix.apache.org/v1\\nkind: ApisixTls\\nmetadata:\\n  name: httpbin\\n  namespace: ingress-apisix\\nspec:\\n  hosts:\\n  - httpbin.org\\n  secret:\\n    name: httpbin\\n    namespace: ingress-apisix\\n---\\n# \u5b9a\u4e49\u8bbf\u95ee\u540e\u7aef\u7684\u8def\u7531\\napiVersion: apisix.apache.org/v2beta1\\nkind: ApisixRoute\\nmetadata:\\n  name: httpbin\\n  namespace: ingress-apisix\\nspec:\\n  http:\\n  - name: httpbin\\n    match:\\n      paths:\\n      - /*\\n      hosts:\\n      - httpbin.org\\n    backends:\\n    - serviceName: httpbin\\n      servicePort: 80\\n```\\n\\n\u63a5\u4e0b\u6765\u8bbf\u95ee\u670d\u52a1 `apisix-gateway`\u3002\u6ce8\u610f\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8be5\u670d\u52a1\u7684\u7c7b\u578b\u4e3a `NodePort`\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4fee\u6539\u5176\u7c7b\u578b\uff0c\u6bd4\u5982\u4f60\u7684 Kubernetes \u96c6\u7fa4\u662f\u4e91\u5382\u5546\u6258\u7ba1\u7684\uff0c\u5219\u53ef\u4ee5\u8003\u8651\u5c06\u5176\u4fee\u6539\u4e3a `LoadBalancer` \u7c7b\u578b\uff0c\u4ee5\u83b7\u53d6\u4e00\u4e2a\u5916\u90e8\u53ef\u8fbe\u7684 IP\u3002\\n\\n\u8fd9\u91cc\u6211\u4eec\u901a\u8fc7\u7aef\u53e3\u8f6c\u53d1\u7684\u65b9\u5f0f\u5c06\u670d\u52a1\u6620\u5c04\u5230\u672c\u5730\u3002\\n\\n```plain\\nkubectl port-forward -n ingress-apisix svc/apisix-gateway 8443:443\\n```\\n\\n\u7136\u540e\u5f00\u59cb\u914d\u7f6e\u8bbf\u95ee\u3002\\n\\n```\\ncurl https://httpbin.org:8443/json --resolve \'httpbin.org:8443:127.0.0.1\' -sk\\n{\\n  \\"slideshow\\": {\\n    \\"author\\": \\"Yours Truly\\",\\n    \\"date\\": \\"date of publication\\",\\n    \\"slides\\": [\\n      {\\n        \\"title\\": \\"Wake up to WonderWidgets!\\",\\n        \\"type\\": \\"all\\"\\n      },\\n      {\\n        \\"items\\": [\\n          \\"Why <em>WonderWidgets</em> are great\\",\\n          \\"Who <em>buys</em> WonderWidgets\\"\\n        ],\\n        \\"title\\": \\"Overview\\",\\n        \\"type\\": \\"all\\"\\n      }\\n    ],\\n    \\"title\\": \\"Sample Slide Show\\"\\n  }\\n}\\n```\\n\\n\u7ecf\u8fc7\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u53ef\u4ee5\u770b\u5230\u8bbf\u95ee\u6210\u529f\uff0c\u8bf4\u660e\u8bc1\u4e66\u5df2\u7ecf\u751f\u6548\u3002\u6ce8\u610f\uff0c\u7531\u4e8e\u8bc1\u4e66\u662f\u81ea\u7b7e\u540d\u7684\uff0c\u8fd9\u91cc\u9700\u8981\u52a0\u4e0a `-k` \u9009\u9879\u6765\u5ffd\u7565\u8bc1\u4e66\u7684\u6821\u9a8c\u3002\\n\\n\u6b64\u5916\uff0c\u5982\u679c\u4f60\u60f3\u8981\u8f6e\u8f6c\u8bc1\u4e66\uff0c\u5220\u9664 `httpbin` \u8fd9\u4e00 Secret \u5bf9\u8c61\u5373\u53ef\uff0cCert Manager \u4f1a\u7acb\u523b\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 httpbin  Secret \u5bf9\u8c61\uff0c\u5e76\u4e14\u5305\u542b\u65b0\u7684\u8bc1\u4e66\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u8bb2\u89e3\u4e86\u5982\u4f55\u5229\u7528 Cert Manager \u5728 Apache APISIX Ingress Controller \u4e2d\u8fdb\u884c\u8bc1\u4e66\u7684\u521b\u5efa\u548c\u7ba1\u7406\u3002\u60f3\u4e86\u89e3\u66f4\u591a\u5173\u4e8e Apache APISIX Ingress \u7684\u4ecb\u7ecd\u4e0e\u5185\u5bb9\uff0c\u53ef\u53c2\u8003[\u672c\u7bc7\u6587\u7ae0](https://apisix.apache.org/zh/blog/2021/10/09/apisix-ingress-techblog/) \u6216\u8005\u53c2\u4e0e Apache APISIX  Ingress \u9879\u76ee\u6bcf\u4e24\u5468\u4e3e\u884c\u7684\u7ebf\u4e0a\u8ba8\u8bba\uff0c\u5206\u4eab\u5f53\u4e0b\u9879\u76ee\u8fdb\u5ea6\u3001\u6700\u4f73\u5b9e\u8df5\u53ca\u8bbe\u8ba1\u601d\u8def\u7b49\u591a\u4e2a\u8bdd\u9898\uff0c\u53ef\u67e5\u770b\u5177\u4f53 [issue](https://github.com/apache/apisix-ingress-controller/issues/614) \u4e86\u89e3\u66f4\u591a\u3002"},{"id":"2022 \u5e74\u5ea6\u4f18\u8d28\u6587\u7ae0\u76d8\u70b9 Top10","metadata":{"permalink":"/zh/blog/2023/02/06/2022-top10-blogs","source":"@site/blog/2023/02/06/2022-top10-blogs.md","title":"2022 \u5e74\u5ea6\u4f18\u8d28\u6587\u7ae0\u76d8\u70b9 Top10","description":"\u672c\u6587\u6574\u7406\u76d8\u70b9\u4e86 2022 \u5e74\u5ea6 Top10 \u9ad8\u9605\u8bfb\u91cf\u6587\u7ae0\uff0c\u5176\u4e2d\u5305\u62ec\u6280\u672f\u539f\u7406\u3001\u751f\u6001\u5171\u5efa\u3001\u884c\u4e1a\u77e5\u8bc6\u79d1\u666e\u3001\u6d41\u884c\u63d2\u4ef6\u5b9e\u64cd\u6559\u7a0b\u7b49\uff0c\u5efa\u8bae\u6536\u85cf\u3002","date":"2023-02-06T00:00:00.000Z","formattedDate":"2023\u5e742\u67086\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":7.08,"truncated":true,"authors":[{"name":"Shirley","title":"Author","url":"https://github.com/ShirleyHhh","image_url":"https://github.com/ShirleyHhh.png","imageURL":"https://github.com/ShirleyHhh.png"}],"prevItem":{"title":"APISIX Ingress \u5982\u4f55\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66","permalink":"/zh/blog/2023/02/07/apisix-ingress-with-cert-mamager"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (1.16 - 1.29)","permalink":"/zh/blog/2023/02/02/weekly-report-0202"}},"content":"> \u672c\u6587\u6574\u7406\u76d8\u70b9\u4e86 2022 \u5e74\u5ea6 Top10 \u9ad8\u9605\u8bfb\u91cf\u6587\u7ae0\uff0c\u5176\u4e2d\u5305\u62ec\u6280\u672f\u539f\u7406\u3001\u751f\u6001\u5171\u5efa\u3001\u884c\u4e1a\u77e5\u8bc6\u79d1\u666e\u3001\u6d41\u884c\u63d2\u4ef6\u5b9e\u64cd\u6559\u7a0b\u7b49\uff0c\u5efa\u8bae\u6536\u85cf\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX \u793e\u533a\u5728\u8fc7\u53bb\u7684\u4e00\u5e74\u91cc\u6301\u7eed\u8f93\u51fa\u5173\u4e8e API \u7f51\u5173\u3001\u4e91\u539f\u751f\u3001\u5fae\u670d\u52a1\u7b49\u9886\u57df\u7684\u6587\u7ae0\uff0c\u52a9\u529b\u4f01\u4e1a\u548c\u4e2a\u4eba\u5728\u5f00\u53d1\u6d4b\u8bd5\u4e0e\u751f\u4ea7\u73af\u5883\u4e2d\u843d\u5730 APISIX \u5e94\u7528\u5b9e\u8df5\u3002\\n\\n\u4e3a\u4e86\u65b9\u4fbf\u793e\u533a\u540c\u5b66\u56de\u987e\uff0c\u6211\u4eec\u6574\u7406\u76d8\u70b9\u4e86 2022 \u5e74\u5ea6 Top10 \u9ad8\u9605\u8bfb\u91cf\u6587\u7ae0\uff0c\u5176\u4e2d\u5305\u62ec\u6280\u672f\u539f\u7406\u3001\u751f\u6001\u5171\u5efa\u3001\u884c\u4e1a\u77e5\u8bc6\u79d1\u666e\u3001\u6d41\u884c\u63d2\u4ef6\u5b9e\u64cd\u6559\u7a0b\u7b49\uff0c\u5efa\u8bae\u6536\u85cf\u3002\\n\\n## 2022 \u5e74\u5ea6\u4f18\u8d28\u6587\u7ae0 Top10\\n\\n### [Apache APISIX \u7ed3\u5408 Authing \u5b9e\u73b0\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7ba1\u7406](https://apisix.apache.org/zh/blog/2022/01/04/authing/)\\n\\n\u4e0e\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u4e0d\u540c\uff0c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u628a\u7528\u6237\u8ba4\u8bc1\u4ece\u5e94\u7528\u670d\u52a1\u4e2d\u62bd\u79bb\u4e86\u51fa\u6765\u3002\u4ee5 Apache APISIX \u4e3a\u4f8b\uff0c\u96c6\u4e2d\u8ba4\u8bc1\u7684\u6d41\u7a0b\u9996\u5148\u7531\u7528\u6237\u53d1\u8d77\u8bf7\u6c42\uff08request\uff09\uff0c\u7136\u540e\u7531\u524d\u7f6e\u7684\u7f51\u5173\u8d1f\u8d23\u7528\u6237\u8ba4\u8bc1\u6d41\u7a0b\uff0c\u4e0e\u8eab\u4efd\u63d0\u4f9b\u65b9\u5bf9\u63a5\uff0c\u5411\u8eab\u4efd\u63d0\u4f9b\u65b9\u53d1\u9001\u8eab\u4efd\u8ba4\u8bc1\uff08authorization\uff09\u8bf7\u6c42\u3002\u8eab\u4efd\u63d0\u4f9b\u65b9\u8fd4\u56de\u7528\u6237\u8eab\u4efd\u4fe1\u606f\uff08user info\uff09\u3002\u7f51\u5173\u5b8c\u6210\u7528\u6237\u8eab\u4efd\u8bc6\u522b\u540e\uff0c\u5c06\u7528\u6237\u8eab\u4efd\u4fe1\u606f\u901a\u8fc7\u8bf7\u6c42\u5934\u7684\u5f62\u5f0f\u8f6c\u53d1\u81f3\u540e\u7aef\u5e94\u7528\u3002\\n\\n### [API \u7f51\u5173\u96c6\u6210 ClickHouse \u63d2\u4ef6\u63d0\u5347\u5168\u94fe\u8def\u65e5\u5fd7\u6548\u7387](https://apisix.apache.org/zh/blog/2022/03/04/apigateway-clickhouse-makes-logging-easier/)\\n\\nClickHouse \u7531 Yandex \u5f00\u53d1\uff0c\u5728 2016 \u5e74\u5f00\u6e90\u3002ClickHouse \u4e0d\u6b62\u662f\u4e00\u4e2a\u6570\u636e\u5e93\uff0c \u4e5f\u662f\u4e00\u4e2a\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5b83\u5141\u8bb8\u5728\u8fd0\u884c\u65f6\u521b\u5efa\u8868\u548c\u6570\u636e\u5e93\u3001\u52a0\u8f7d\u6570\u636e\u548c\u8fd0\u884c\u67e5\u8be2\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u914d\u7f6e\u6216\u91cd\u542f\u670d\u52a1\u3002\u968f\u7740\u8d8a\u6765\u8d8a\u591a\u7684\u516c\u53f8\u5f00\u59cb\u5c06\u4e1a\u52a1\u8fc1\u79fb\u4e0a\u4e91\uff0c\u5982\u4f55\u9ad8\u6548\u5730\u5b9e\u73b0\u65e5\u5fd7\u6536\u53d1\u53ca\u65e5\u5fd7\u5206\u6790\uff0c\u589e\u5f3a\u7cfb\u7edf\u7684\u53ef\u89c2\u6d4b\u6027\u6210\u4e3a\u4e86\u4e00\u4e2a\u96be\u9898\u3002\\n\\n### [\u91cd\u78c5\u529f\u80fd\uff01Apache APISIX \u62e5\u62b1 WASM \u751f\u6001](https://apisix.apache.org/zh/blog/2021/11/19/apisix-supports-wasm/)\\n\\nWASM \u5168\u79f0 WebAssembly\uff0c\u5b83\u662f\u4e00\u5957\u5b57\u8282\u7801\u6807\u51c6\uff0c\u4e13\u95e8\u8bbe\u8ba1\u6210\u53ef\u4ee5\u5728\u5bbf\u4e3b\u73af\u5883\u4e2d\u5d4c\u5957\u4f7f\u7528\u3002\u8981\u60f3\u8fd0\u884c\u7279\u5b9a\u7684\u5e94\u7528\uff0c\u9700\u8981\u5b9e\u73b0\u8be5\u5e94\u7528\u6240\u9700\u7684 API\u3002\u4ee5 JavaScript \u4e3a\u4f8b\uff0c\u867d\u7136\u540c\u6837\u662f JavaScript \u4ee3\u7801\uff0c\u4f46\u662f\u9488\u5bf9\u6d4f\u89c8\u5668\u5199\u7684 JS \u6a21\u5757\u4e0d\u80fd\u76f4\u63a5\u7528\u5728 npm \u5305\u91cc\u9762\uff0c\u56e0\u4e3a\u4e24\u4e2a\u7684 API \u4e0d\u4e00\u6837\u3002\u6240\u4ee5\u4ec5\u4ec5\u628a WASM \u653e\u5230 Apache APISIX \u91cc\u9762\u5e76\u884c\u4e0d\u901a\uff0c\u8981\u60f3\u8ba9\u5f00\u53d1\u8005\u5728 Apache APISIX \u4e0a\u8fd0\u884c WASM\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u63d0\u4f9b\u4e00\u5957\u4e13\u95e8\u7684 API\u3002\\n\\n### [\u4ee3\u7406\u7c7b\u578b\u5347\u7ea7\uff0cAPISIX \u652f\u6301 Kafka \u4f5c\u4e3a\u4e0a\u6e38](https://apisix.apache.org/zh/blog/2022/01/17/apisix-kafka-integration/)\\n\\nhttps://mp.weixin.qq.com/s/3GZwuzipBbXqp1i_HeQpHg\\n\\nApache APISIX 2.14 \u7248\u672c\u8d77\uff0c\u63d0\u4f9b Kafka \u7c7b\u578b\u7684\u4e0a\u6e38\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5728\u8def\u7531\u4e2d\u914d\u7f6e Scheme \u4e3a Kafka \u7684\u4e0a\u6e38\u5f00\u542f Kafka \u6d88\u8d39\u8005\u529f\u80fd\uff0c\u4ece\u800c\u5728\u5404\u79cd\u73af\u5883\u4e2d\u5b9e\u73b0\u6d88\u606f\u8ba2\u9605\u3002\u672c\u6587\u5c06\u4ecb\u7ecd Kafka \u53d1\u5e03\u8ba2\u9605\u529f\u80fd\u53ca `kafka-proxy` \u63d2\u4ef6\u7684\u4f7f\u7528\u7ec6\u8282\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u5982\u4f55\u5c06 APISIX \u4e0e Kafka \u7ed3\u5408\u4f7f\u7528\u5728\u6d4f\u89c8\u5668\u7b49\u8fde\u63a5\u53d7\u9650\u7684\u573a\u666f\uff0c\u5b9e\u73b0\u5bf9 Kafka \u4e2d\u6d88\u606f\u7684\u6d88\u8d39\u3002\\n\\n### [\u4f7f\u7528 Gitpod \u5f00\u53d1 API \u7f51\u5173 Apache APISIX](https://apisix.apache.org/zh/blog/2022/03/03/develop-apisix-with-gitpod/)\\n\\nApache APISIX \u4f5c\u4e3a\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u5982\u4f55\u5feb\u901f\u7684\u90e8\u7f72 APISIX \u7684\u5f00\u53d1\u73af\u5883\u5bf9\u4e8e\u5f00\u53d1\u8005\u662f\u6bd4\u8f83\u91cd\u8981\u7684\u3002\u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Gitpod \u5bf9 Apache APISIX \u8fdb\u884c\u76f8\u5173\u5f00\u53d1\u3002\\n\\n### [\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u662f\u4ec0\u4e48\uff1f](https://apisix.apache.org/zh/blog/2022/11/10/what-is-service-in-microservice-discovery/)\\n\\n\u5728\u4e92\u8054\u7f51\u521a\u5f00\u59cb\u51fa\u73b0\u7684\u5e74\u4ee3\uff0c\u4eba\u4eec\u8981\u60f3\u8bbf\u95ee\u67d0\u4e2a\u5728\u7ebf\u670d\u52a1\uff0c\u9700\u8981\u8f93\u5165\u4e00\u957f\u4e32\u7684 IP \u5730\u5740\u3002IP \u5730\u5740\u867d\u7136\u4e0d\u957f\uff0c\u4f46\u662f\u4f5c\u4e3a\u4e00\u4e32\u65e0\u610f\u4e49\u7684\u6570\u5b57\uff0c\u8981\u6c42\u8bb0\u4f4f\u7279\u5b9a\u670d\u52a1\u7684\u7279\u5b9a\u5730\u5740\u8fd8\u662f\u5f88\u8003\u9a8c\u4eba\u7684\u8bb0\u5fc6\u529b\u3002\u6240\u4ee5\u540e\u6765\u4eba\u4eec\u5c31\u53d1\u660e\u4e86\u57df\u540d\u7cfb\u7edf\u3002\u6bcf\u4e2a\u5728\u7ebf\u670d\u52a1\u4f1a\u5230\u57df\u540d\u5546\u6ce8\u518c\u4e00\u4e2a\u57df\u540d\uff0c\u7136\u540e\u901a\u8fc7 DNS \u5efa\u7acb\u57df\u540d\u548c\u5177\u4f53 IP \u7684\u8054\u7cfb\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4eba\u4eec\u53ea\u9700\u8981\u8f93\u5165\u4e00\u4e2a\u597d\u8bb0\u7684\u57df\u540d\uff0c\u5c31\u80fd\u8bbf\u95ee\u5230\u5177\u4f53 IP \u4e0a\u7684\u5728\u7ebf\u670d\u52a1\u3002\u8fd9\u5c31\u662f\u6700\u65e9\u7684\u670d\u52a1\u53d1\u73b0\u3002\u672c\u6587\u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u7684\u76f8\u5173\u80cc\u666f\u548c APISIX \u5bf9\u4e8e\u670d\u52a1\u53d1\u73b0\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\uff0c\u6765\u4ecb\u7ecd\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5185\u5bb9\u3002\\n\\n### [API \u7f51\u5173 APISIX \u96c6\u6210 OpenWhisk \u4e30\u5bcc\u8ba4\u8bc1\u573a\u666f](https://apisix.apache.org/zh/blog/2021/12/24/apisix-integrate-openwhisk-plugin/)\\n\\n\u672c\u6587\u5c06\u4ecb\u7ecd Apache APISIX 2.12.0 \u7248\u672c\u4e2d\u65b0\u589e\u7684\u63d2\u4ef6\u2014\u2014OpenWhisk\uff0c\u5e76\u901a\u8fc7\u8be6\u7ec6\u6b65\u9aa4\u5411\u5927\u5bb6\u5c55\u793a\u5982\u4f55\u5c06 OpenWhisk \u670d\u52a1\u4e0e Apache APISIX \u8fdb\u884c\u96c6\u6210\uff0c\u6765\u4eab\u53d7\u65e0\u670d\u52a1\u5668\u8ba1\u7b97\u7684\u4f18\u52bf\u3002\\n\\n### [\u591a\u534f\u8bae\u63a5\u5165\u6846\u67b6 xRPC \u7ec6\u8282\u524d\u77bb](https://apisix.apache.org/zh/blog/2022/01/21/apisix-xrpc-details-and-miltilingual/)\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 xRPC \u6846\u67b6\u4ee5\u53ca\u76f8\u5173\u7ec6\u8282\uff0c\u540c\u65f6\u4ecb\u7ecd\u4e86 Apache APISIX \u5728\u591a\u8bed\u8a00\u5f00\u53d1\u652f\u6301\u4e2d\u7684\u7ec6\u8282\u5c55\u793a\u3002\u901a\u8fc7\u591a\u534f\u8bae\u4ee3\u7406\u4e0e\u591a\u8bed\u8a00\u652f\u6301\u4e24\u4e2a\u89d2\u5ea6\uff0c\u5145\u5206\u5c55\u793a\u4e86 Apache APISIX \u5728\u9762\u5411\u751f\u6001\u7684\u591a\u9879\u52aa\u529b\u3002\u4e5f\u6b22\u8fce\u968f\u65f6\u5728 GitHub Discussions \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7\u90ae\u4ef6\u5217\u8868\u8fdb\u884c\u4ea4\u6d41\u3002\\n\\n### [\u8ba9\u4f60\u5728 Apache APISIX \u4e2d\u4ee3\u7406 Dubbo \u670d\u52a1\u66f4\u4fbf\u6377](https://apisix.apache.org/zh/blog/2022/01/13/how-to-proxy-dubbo-in-apache-apisix/)\\n\\nApache Dubbo \u662f\u7531\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u5e76\u6350\u8d60\u7ed9 Apache \u7684\u5fae\u670d\u52a1\u5f00\u53d1\u6846\u67b6\uff0c\u5b83\u63d0\u4f9b\u4e86 RPC \u901a\u4fe1\u4e0e\u5fae\u670d\u52a1\u6cbb\u7406\u4e24\u5927\u5173\u952e\u80fd\u529b\u3002Apache APISIX \u57fa\u4e8e\u5f00\u6e90\u9879\u76ee tengine/mod_dubbo \u6a21\u5757\u4e3a Apache Dubbo \u670d\u52a1\u914d\u5907\u4e86HTTP \u7f51\u5173\u80fd\u529b\u3002\u901a\u8fc7 dubbo-proxy \u63d2\u4ef6\uff0c\u53ef\u4ee5\u8f7b\u677e\u5730\u5c06 Dubbo Service \u53d1\u5e03\u4e3a HTTP \u670d\u52a1\u3002\\n\\n### [API \u7f51\u5173 Apache APISIX \u96c6\u6210 CNCF OpenFunction](https://apisix.apache.org/zh/blog/2022/09/20/apisix-integrate-cncf-openfunction/)\\n\\n\u65e0\u670d\u52a1\u5177\u6709\u9ad8\u5ea6\u53ef\u6269\u5c55\u548c\u6210\u672c\u4f4e\u7b49\u4f18\u52bf\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u90e8\u7f72\u4e1a\u52a1\u670d\u52a1\u80fd\u591f\u6781\u5927\u964d\u4f4e\u8d44\u6e90\u4f7f\u7528\u548c\u6295\u5165\u6210\u672c\u3002\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528 OpenFunction \u4f5c\u4e3a\u65e0\u670d\u52a1\u5e73\u53f0\uff0c\u4f60\u5c31\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u53bb\u4ee3\u7406\u8fd9\u4e9b\u51fd\u6570\u7684\u8bf7\u6c42\uff0c\u4e3a\u51fd\u6570\u8bf7\u6c42\u8ffd\u52a0\u670d\u52a1\u6cbb\u7406\u7684\u80fd\u529b\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (1.16 - 1.29)","metadata":{"permalink":"/zh/blog/2023/02/02/weekly-report-0202","source":"@site/blog/2023/02/02/weekly-report-0202.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (1.16 - 1.29)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-02-02T00:00:00.000Z","formattedDate":"2023\u5e742\u67082\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.845,"truncated":true,"authors":[],"prevItem":{"title":"2022 \u5e74\u5ea6\u4f18\u8d28\u6587\u7ae0\u76d8\u70b9 Top10","permalink":"/zh/blog/2023/02/06/2022-top10-blogs"},"nextItem":{"title":"API \u7f51\u5173\u7b56\u7565\u7684\u4e8c\u4e09\u4e8b","permalink":"/zh/blog/2023/01/30/something-about-api-gateway-policy"}},"content":"> \u4ece 2023.1.16 - 2023.1.29\uff0c\u6709 21 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 41 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 Issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/02/01/AL9SEc50_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5-02%E5%91%A8.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/02/01/jQX92Uq2_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E6%96%B0%E6%99%8B%E6%B5%B7%E6%8A%A5-02%E5%91%A8.png)\\n\\n## Good First Issue\\n\\n### Issue #8772\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/8772\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5bf9 OIDC \u8ba4\u8bc1\u76f8\u5173\u7684\u81ea\u5b9a\u4e49\u914d\u7f6e\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4ee5\u4fbf\u7528\u6237\u5bf9\u4e0d\u5408\u89c4\u914d\u7f6e\u9650\u5236\u5176\u5411\u540e\u7aef\u8bbf\u95ee\u3002\\n\\n### Issue #1075\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1075\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4e3a APISIX Ingress \u589e\u52a0\u4f7f\u7528 apisix:dev \u7684\u56de\u5f52\u6d4b\u8bd5\uff0c\u4ee5\u4fbf\u5c3d\u65e9\u53d1\u73b0\u4e0e APISIX \u6700\u65b0\u4fee\u6539\u7684\u517c\u5bb9\u95ee\u9898\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [Stream \u4ee3\u7406\u6a21\u5f0f\u6dfb\u52a0 Kubernetes \u670d\u52a1\u53d1\u73b0\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8640)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\n- [Stream \u4ee3\u7406\u6a21\u5f0f\u6dfb\u52a0 consul_kv \u670d\u52a1\u53d1\u73b0\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8640)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [API \u7f51\u5173\u7b56\u7565\u7684\u4e8c\u4e09\u4e8b](https://apisix.apache.org/zh/blog/2023/01/30/something-about-api-gateway-policy/)\\n\\n    \u8fd9\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f API \u7f51\u5173\u7b56\u7565\uff0c\u5e76\u9488\u5bf9\u8ba4\u8bc1\u6388\u6743\u3001\u5b89\u5168\u3001\u6d41\u91cf\u5904\u7406\u4e0e\u53ef\u89c2\u6d4b\u6027\u8fd9\u56db\u7c7b API \u7f51\u5173\u4e2d\u5e38\u7528\u7684\u7b56\u7565\u8fdb\u884c\u63cf\u8ff0\u3002\\n\\n- [Apache APISIX \u96c6\u6210\u539f\u751f Consul \u7684\u670d\u52a1\u53d1\u73b0\u80fd\u529b](https://apisix.apache.org/zh/blog/2023/01/18/consul-with-apisix/)\\n\\n    Apache APISIX \u652f\u6301\u539f\u751f Consul \u7684\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u3002\u672c\u6587\u8bb2\u8ff0\u4e86\u5728 Apache APISIX \u4e2d\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u548c\u670d\u52a1\u6ce8\u518c\u7684\u5168\u8fc7\u7a0b\u53ca Consul \u7684\u76f8\u5173\u539f\u7406\u3002\\n\\n- [\u9a6c\u8702\u7a9d\u5982\u4f55\u5229\u7528 APISIX \u7f51\u5173\u5b9e\u73b0\u5fae\u670d\u52a1\u67b6\u6784\u5347\u7ea7](https://apisix.apache.org/zh/blog/2023/01/15/mafengwo-with-apisix/)\\n\\n    \u672c\u6587\u4ece\u9a6c\u8702\u7a9d\u7684\u5fae\u670d\u52a1\u67b6\u6784\u5e73\u53f0\u8702\u6548\u8fed\u4ee3\u8fc7\u7a0b\u548c\u5e94\u7528 APISIX \u540e\u7684\u4ea7\u54c1\u5b9e\u8df5\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u57fa\u4e8e APISIX \u7684\u7f51\u5173\u5e94\u7528\u5b9e\u4f8b\u3002\\n\\n- [Apache APISIX Ingress 1.6 \u6b63\u5f0f\u53d1\u5e03](https://apisix.apache.org/zh/blog/2023/01/10/release-apisix-ingress-1.6/)\\n\\n    Apache APISIX Ingress 1.6 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u5e26\u6765\u4e86 Gateway API \u7684\u652f\u6301\uff0c\u540c\u65f6\u65b0\u589e\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u96c6\u6210\u4e0e\u4ee3\u7406\u5916\u90e8\u670d\u52a1\uff0c\u4f18\u5316\u5bf9 APISIX Ingress Controller \u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\n\\n- [2022 Apache APISIX \u5e74\u5ea6\u8bb0\u5fc6](https://apisix.apache.org/zh/blog/2023/01/02/2022-summary/)\\n\\n    \u672c\u6587\u5c06\u5e26\u60a8\u56de\u987e Apache APISIX \u793e\u533a\u5728 2022 \u5e74\u5728\u5404\u9886\u57df\u53d6\u5f97\u7684\u6210\u7ee9\u3002\\n\\n- [Apache APISIX 3.1.0 \u6b63\u5f0f\u53d1\u5e03](https://apisix.apache.org/zh/blog/2022/12/30/release-apache-apisix-3.1.0/)\\n\\n    Apache APISIX 3.1.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u5e26\u6765\u5f88\u591a\u5173\u4e8e\u5b89\u5168\u5c42\u9762\u7684\u529f\u80fd\u652f\u6301\uff0c\u540c\u65f6\u65b0\u589e\u5185\u7f6e\u8c03\u8bd5\u63d2\u4ef6\uff0c\u65e8\u5728\u4f18\u5316\u5bf9 APISIX \u7684\u4f7f\u7528\u4f53\u9a8c\u3002"},{"id":"API \u7f51\u5173\u7b56\u7565\u7684\u4e8c\u4e09\u4e8b","metadata":{"permalink":"/zh/blog/2023/01/30/something-about-api-gateway-policy","source":"@site/blog/2023/01/30/something-about-api-gateway-policy.md","title":"API \u7f51\u5173\u7b56\u7565\u7684\u4e8c\u4e09\u4e8b","description":"\u8fd9\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f API \u7f51\u5173\u7b56\u7565\uff0c\u5e76\u9488\u5bf9\u8ba4\u8bc1\u6388\u6743\u3001\u5b89\u5168\u3001\u6d41\u91cf\u5904\u7406\u4e0e\u53ef\u89c2\u6d4b\u6027\u8fd9\u56db\u7c7b API \u7f51\u5173\u4e2d\u5e38\u7528\u7684\u7b56\u7565\u8fdb\u884c\u63cf\u8ff0\u3002","date":"2023-01-30T00:00:00.000Z","formattedDate":"2023\u5e741\u670830\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":29.94,"truncated":true,"authors":[{"name":"\u66b4\u6e0a","title":"Author","url":"https://github.com/Baoyuantop","image_url":"https://github.com/Baoyuantop.png","imageURL":"https://github.com/Baoyuantop.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (1.16 - 1.29)","permalink":"/zh/blog/2023/02/02/weekly-report-0202"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (1.2 - 1.15)","permalink":"/zh/blog/2023/01/19/weekly-report-0115"}},"content":"> \u8fd9\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f API \u7f51\u5173\u7b56\u7565\uff0c\u5e76\u9488\u5bf9\u8ba4\u8bc1\u6388\u6743\u3001\u5b89\u5168\u3001\u6d41\u91cf\u5904\u7406\u4e0e\u53ef\u89c2\u6d4b\u6027\u8fd9\u56db\u7c7b API \u7f51\u5173\u4e2d\u5e38\u7528\u7684\u7b56\u7565\u8fdb\u884c\u63cf\u8ff0\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u66b4\u6e0a](https://github.com/Baoyuantop)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\uff0cApache APISIX Committer\u3002\\n\\n\u8fd1\u4e9b\u5e74\u968f\u7740\u4e91\u539f\u751f\u548c\u5fae\u670d\u52a1\u67b6\u6784\u7684\u65e5\u8d8b\u53d1\u5c55\uff0cAPI \u7f51\u5173\u4ee5\u6d41\u91cf\u5165\u53e3\u7684\u89d2\u8272\u5728\u6280\u672f\u67b6\u6784\u4e2d\u626e\u6f14\u7740\u8d8a\u6765\u8d8a\u91cd\u8981\u7684\u4f5c\u7528\u3002**API \u7f51\u5173\u4e3b\u8981\u8d1f\u8d23\u63a5\u6536\u6240\u6709\u8bf7\u6c42\u7684\u6d41\u91cf\u5e76\u8fdb\u884c\u5904\u7406\u8f6c\u53d1\u81f3\u4e0a\u6e38\u670d\u52a1\uff0cAPI \u7f51\u5173\u7684\u7b56\u7565\u51b3\u5b9a\u4e86 API \u7f51\u5173\u5904\u7406\u8fd9\u4e9b\u6d41\u91cf\u7684\u903b\u8f91\u4e0e\u89c4\u5219\uff0c\u76f4\u63a5\u51b3\u5b9a\u4e86\u5b9e\u9645\u7684\u4e1a\u52a1\u6d41\u91cf\u884c\u4e3a\u3002**\\n\\n## \u4ec0\u4e48\u662f API \u7f51\u5173\u7b56\u7565\uff1f\\n\\nAPI \u7f51\u5173\u4e00\u822c\u4f4d\u4e8e\u6240\u6709\u7684\u4e0a\u6e38\u670d\u52a1\u4e4b\u524d\uff0c\u5f53\u7528\u6237\u5411\u670d\u52a1\u53d1\u9001\u8bf7\u6c42\u540e\u8bf7\u6c42\u4f1a\u5148\u5230 API \u7f51\u5173\uff0cAPI \u7f51\u5173\u63a5\u6536\u5230\u8bf7\u6c42\u4e4b\u540e\u4e00\u822c\u4f1a\u5224\u65ad\u51e0\u4ef6\u4e8b\u60c5\uff1a\\n\\n1. **\u8bf7\u6c42\u662f\u5426\u5408\u6cd5\uff0c\u6bd4\u5982\u662f\u5426\u6765\u81ea\u88ab\u7981\u6b62\u8bbf\u95ee\u7684\u7528\u6237\u5217\u8868\u4e2d\uff1b**\\n2. **\u8fd9\u4e2a\u8bf7\u6c42\u662f\u5426\u901a\u8fc7\u8ba4\u8bc1\uff0c\u8bbf\u95ee\u7684\u5185\u5bb9\u662f\u5426\u662f\u7ecf\u8fc7\u6388\u6743\u7684\uff1b**\\n3. **\u8bf7\u6c42\u662f\u5426\u89e6\u53d1\u4e86\u67d0\u4e9b\u9650\u5236\u89c4\u5219\uff0c\u6bd4\u5982\u9650\u6d41\u9650\u901f\u7b49\uff1b**\\n4. **\u8bf7\u6c42\u5e94\u8be5\u8f6c\u53d1\u7ed9\u54ea\u4e2a\u4e0a\u6e38\u670d\u52a1\u3002**\\n\\n\u7ecf\u8fc7\u8fd9\u4e00\u7cfb\u5217\u6b65\u9aa4\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u8981\u4e48\u4e0d\u7b26\u5408\u9884\u8bbe\u7684\u89c4\u5219\u88ab\u62d2\u7edd\uff0c\u8981\u4e48\u7ecf\u8fc7\u4e86\u5c42\u5c42\u5904\u7406\u6b63\u786e\u5230\u8fbe\u6307\u5b9a\u7684\u4e0a\u6e38\u670d\u52a1\u4e2d\u3002\u6211\u4eec\u5c06\u8fd9\u4e9b\u5904\u7406\u89c4\u5219\u79f0\u4e4b\u4e3a API \u7f51\u5173\u7684\u7b56\u7565\u3002\u8fd9\u4e9b\u89c4\u5219\u7531\u7f51\u5173\u7684\u7ba1\u7406\u5458\u5728\u7f51\u5173\u8fd0\u884c\u65f6\u4e0d\u65ad\u6dfb\u52a0\u81f3\u7f51\u5173\u4e2d\uff0c\u7f51\u5173\u63a5\u53d7\u8fd9\u4e9b\u89c4\u5219\u5e76\u6839\u636e\u8fd9\u4e9b\u89c4\u5219\u4f5c\u51fa\u6b63\u786e\u7684\u6d41\u91cf\u5904\u7406\u884c\u4e3a\u3002\\n\\n\u4ee5 API \u7f51\u5173 [Apache APISIX](https://apisix.apache.org/) \u4e3a\u4f8b\uff0cAPISIX \u7684\u914d\u7f6e\u4fe1\u606f\u6709\u4e24\u79cd\uff1a\u7f51\u5173\u542f\u52a8\u7528\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982 `config.yaml`\uff0c\u8fd9\u4e2a\u6587\u4ef6\u51b3\u5b9a\u4e86\u7f51\u5173\u6b63\u5e38\u542f\u52a8\u6240\u5fc5\u987b\u7684\u4e00\u4e9b\u914d\u7f6e\u3002\u53e6\u5916\u5728\u8fd0\u884c\u65f6\u7ba1\u7406\u5458\u53ef\u4ee5\u901a\u8fc7 [Admin API](https://apisix.apache.org/docs/apisix/admin-api/) \u52a8\u6001\u521b\u5efa\u5404\u79cd\u89c4\u5219\u4e0e\u914d\u7f6e\uff0c\u6bd4\u5982 Route\u3001Consumer\u3001Plugin \u7b49\u7b49\u3002API \u7f51\u5173\u7684\u7b56\u7565\u5c31\u662f\u7ba1\u7406\u5458\u901a\u8fc7 Admin API \u52a8\u6001\u521b\u5efa\u7684\u5404\u79cd\u89c4\u5219\u4e0e\u914d\u7f6e\u3002\\n\\n\u672c\u6587\u4e0d\u518d\u989d\u5916\u63cf\u8ff0\u57fa\u672c\u5e38\u7528\u573a\u666f\uff0c\u800c\u662f\u9488\u5bf9\u8ba4\u8bc1\u6388\u6743\u3001\u5b89\u5168\u3001\u6d41\u91cf\u5904\u7406\u4e0e\u53ef\u89c2\u6d4b\u6027\u8fd9\u56db\u7c7b API \u7f51\u5173\u4e2d\u91cd\u8981\u7684\u573a\u666f\u8fdb\u884c\u9610\u8ff0\uff0c\u4ecb\u7ecd\u6bcf\u79cd\u573a\u666f\u4e0b\u5305\u542b\u7684\u4e00\u4e9b API \u7f51\u5173\u7b56\u7565\u7684\u4f5c\u7528\u4ee5\u53ca\u4f7f\u7528\u65b9\u6cd5\u3002\\n\\n## \u8ba4\u8bc1\u548c\u6388\u6743\u7b56\u7565\\n\\n\u8ba4\u8bc1\u53ef\u4ee5\u786e\u8ba4 API \u8c03\u7528\u8005\u7684\u8eab\u4efd\uff0c\u6388\u6743\u4e3b\u8981\u9650\u5236\u8c03\u7528\u8005\u4ec5\u80fd\u8bbf\u95ee\u6743\u9650\u5185\u7684\u8d44\u6e90\u3002\\n\\n![\u6388\u6743\u8c03\u7528](https://static.apiseven.com/uploads/2023/01/29/EuHMTBfw_download_image%20%283%29%20%281%29.png)\\n\\n\u6bd4\u5982\u8bf4\u4e00\u4f4d\u4e58\u5ba2\u524d\u5f80\u8f66\u7ad9\u51fa\u884c\uff0c\u8fdb\u5165\u8f66\u7ad9\u4e4b\u524d\u4f1a\u4f7f\u7528\u8eab\u4efd\u8bc1\u8fdb\u884c\u201c\u8ba4\u8bc1\u201d\u786e\u8ba4\u8eab\u4efd\uff0c\u5728\u8fdb\u5165\u8f66\u7ad9\u540e\u51fa\u793a\u8f66\u7968\uff0c\u7ecf\u5de5\u4f5c\u4eba\u5458\u786e\u8ba4\u540e\u88ab\u201c\u6388\u6743\u201d\u8fdb\u5165\u67d0\u73ed\u5217\u8f66\u3002\\n\\n\u8ba4\u8bc1\u6388\u6743\u7c7b\u7b56\u7565\u4e3b\u8981\u76ee\u7684\u662f\u4fdd\u8bc1\u7f51\u5173\u8f6c\u53d1\u5230\u4e0a\u6e38\u670d\u52a1\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u662f\u7ecf\u8fc7\u8ba4\u8bc1\u548c\u6388\u6743\u7684\uff0c\u4e0d\u4f1a\u51fa\u73b0\u975e\u6cd5\u8bf7\u6c42\u3002\u5e76\u4e14\u8bbf\u95ee\u7684\u90fd\u662f\u6743\u9650\u8303\u56f4\u5185\u7684\u8d44\u6e90\u3002\u6bd4\u8f83\u5e38\u7528\u7684\u7b56\u7565\u6709\u4e0b\u9762\u51e0\u79cd\uff1a\\n\\n### Basic Auth\\n\\n[\u57fa\u672c\u8bbf\u95ee\u8ba4\u8bc1](https://en.wikipedia.org/wiki/Basic_access_authentication)\u7b56\u7565\uff0c\u8fd9\u662f\u4e00\u79cd\u6700\u7b80\u5355\u7684\u8bbf\u95ee\u63a7\u5236\u6280\u672f\u3002\u4e00\u822c\u7531\u7528\u6237\u7684 HTTP \u4ee3\u7406\u5728\u53d1\u51fa\u8bf7\u6c42\u65f6\u643a\u5e26\u7528\u4e8e\u8ba4\u8bc1\u7684\u8bf7\u6c42\u5934\uff0c\u4e00\u822c\u4e3a\uff1a`Authorization: Basic <credentials>`\uff0ccredentials \u4e2d\u5373\u5305\u542b\u4e86\u7528\u6237\u8ba4\u8bc1\u9700\u8981\u7684\u7528\u6237 ID \u548c\u5bc6\u7801\uff0c\u4f7f\u7528 `:` \u9694\u79bb\u3002\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u9700\u8981\u767b\u9646\u9875\u9762\u3001cookie \u7b49\u7e41\u6742\u7684\u8bbe\u7f6e\uff0c\u4ec5\u4ec5\u57fa\u4e8e\u8bf7\u6c42\u5934\u4e2d\u7684\u7b80\u5355\u51ed\u636e\u4fe1\u606f\u8fdb\u884c\u8ba4\u8bc1\uff0c\u4e00\u822c\u4e3a\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u914d\u7f6e\u4f7f\u7528\u8d77\u6765\u8f83\u4e3a\u7b80\u5355\u3002\\n\\n\u643a\u5e26\u57fa\u672c\u8ba4\u8bc1\u7684 `cURL` \u8bf7\u6c42\u7684\u793a\u4f8b\u5982\u4e0b\uff0c\u7528\u6237\u540d\u4e3a `username`\uff0c\u5bc6\u7801\u4e3a `password`\uff1a\\n\\n```shell\\ncurl -i -u \'username:password\' http://127.0.0.1:8080/hello\\n```\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u662f `credentials` \u4e2d\u7684\u4fe1\u606f\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u5e76\u4e0d\u4f1a\u88ab\u52a0\u5bc6\uff0c\u4ec5\u4ec5\u505a Base64 \u7f16\u7801\uff0c\u6240\u4ee5\u901a\u5e38\u9700\u8981\u548c HTTPS \u4e00\u8d77\u4f7f\u7528\u6765\u4fdd\u8bc1\u5bc6\u7801\u7684\u5b89\u5168\u6027\u3002\\n\\n\u5728\u7f51\u5173\u4e2d\u5b9e\u65bd\u8fd9\u4e00\u7b56\u7565\u540e\uff0c\u672a\u643a\u5e26\u51ed\u636e\u7684\u8bf7\u6c42\u5c06\u65e0\u6cd5\u6b63\u5e38\u901a\u8fc7\u7f51\u5173\u8f6c\u53d1\uff0c\u9664\u975e\u5728\u8bf7\u6c42\u4e2d\u643a\u5e26\u4e86\u6b63\u786e\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u5b9e\u73b0\u4e86\u6700\u5c0f\u6210\u672c\u4e0b\u4e3a API \u6dfb\u52a0\u4e86\u8bbf\u95ee\u9a8c\u8bc1\u3002\\n\\n### Key Auth\\n\\nKey Auth \u7b56\u7565\u901a\u8fc7\u5728 API \u4e2d\u6dfb\u52a0 Key \u6765\u9650\u5236 API \u8c03\u7528\uff0c\u5e76\u8bc6\u522b\u8bf7\u6c42\u643a\u5e26\u7684 Key \u6765\u8fdb\u884c\u8bbf\u95ee\u8d44\u6e90\u7684\u63a7\u5236\u3002\u53ea\u6709\u643a\u5e26\u4e86\u6b63\u786e\u7684 Key \u4e4b\u540e\u7684\u8bf7\u6c42\u624d\u80fd\u6b63\u5e38\u8bbf\u95ee\uff0c\u53ef\u4ee5\u5728\u8bf7\u6c42\u5934\u4e2d\u6216 Query \u4e2d\u643a\u5e26\u3002\u901a\u5e38\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a Key \u6765\u533a\u5206\u4e0d\u540c\u7684 API \u8c03\u7528\u65b9\uff0c\u4ece\u800c\u53ef\u4ee5\u9488\u5bf9\u4e0d\u540c\u7684\u8c03\u7528\u65b9\u5b9e\u65bd\u4e0d\u540c\u7684\u5176\u4ed6\u7b56\u7565\u6216\u8d44\u6e90\u63a7\u5236\u3002\u540c\u6837\u7684 Key \u5728 HTTP \u4e2d\u662f\u660e\u6587\u4f20\u8f93\u7684\uff0c\u786e\u4fdd\u8bf7\u6c42\u4f7f\u7528\u4e86 HTTPS \u4ee5\u4fdd\u8bc1\u5b89\u5168\u3002\\n\\n\u4ee5 APISIX \u7684 [key-auth](https://apisix.apache.org/docs/apisix/plugins/key-auth/) \u63d2\u4ef6\u4e3a\u4f8b\uff0c\u63d2\u4ef6\u9700\u8981\u901a\u8fc7 Admin API \u521b\u5efa\u4e00\u4e2a\u5177\u6709\u552f\u4e00 key \u503c\u7684 Consumer\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/consumers \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"username\\": \\"jack\\",\\n    \\"plugins\\": {\\n        \\"key-auth\\": {\\n            \\"key\\": \\"jack-key\\"\\n        }\\n    }\\n}\'\\n```\\n\\n\u8fd9\u4e00\u8bf7\u6c42\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u5b57\u4e3a `jack` \u7684 Consumer\uff0c\u5b83\u7684 key \u503c\u4e3a `jack-key`\u3002\u5728\u8def\u7531\u4e2d\u542f\u7528\u63d2\u4ef6\u65f6\u9700\u8981\u914d\u7f6e\u7f51\u5173\u4ece\u8bf7\u6c42\u4e2d\u8bfb\u53d6 Key \u503c\u7684\u4f4d\u7f6e\u548c\u5b57\u6bb5\u540d\u79f0\u3002\u9ed8\u8ba4\u7684\u914d\u7f6e\u4f4d\u7f6e\u4e3a `header` \uff0c\u5b57\u6bb5\u540d\u79f0\u4e3a `apikey`\uff0c \u90a3\u4e48\u6b63\u786e\u7684\u8bf7\u6c42\u8fd9\u4e2a\u8def\u7531\u7684\u793a\u4f8b\u4e3a\uff1a\\n\\n```shell\\ncurl -i http://127.0.0.1:8080/hello -H \'apikey: jack-key\'\\n```\\n\\nAPISIX \u5728\u6536\u5230\u8fd9\u4e00\u8bf7\u6c42\u540e\u4f1a\u4ece\u8bf7\u6c42\u4e2d\u89e3\u6790\u51fa Key\uff0c\u7136\u540e\u4ece\u914d\u7f6e\u7684\u6240\u6709 Key \u4e2d\u627e\u5230\u548c\u8fd9\u4e2a\u8bf7\u6c42\u5339\u914d\u7684 Consumer `jack`\uff0c\u8fd9\u6837\u7f51\u5173\u5c31\u6e05\u695a\u8fd9\u4e2a\u8bf7\u6c42\u662f `jack` \u53d1\u51fa\u7684\u3002\u5982\u679c\u6ca1\u6709\u627e\u5230\u5339\u914d\u7684 Key \u5373\u53ef\u5224\u5b9a\u4e3a\u975e\u6cd5\u8bf7\u6c42\u3002\\n\\n### JSON Web Token\uff08JWT\uff09\\n\\nJSON Web Token (JWT) \u662f\u4e00\u4e2a\u5f00\u653e\u7684[\u6807\u51c6](https://www.rfc-editor.org/rfc/rfc7519)\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u79cd\u4ee5 json \u5bf9\u8c61\u5f62\u5f0f\u5728\u5404\u65b9\u4e4b\u95f4\u5b89\u5168\u4f20\u9012\u4fe1\u606f\u7684\u65b9\u5f0f\u3002JWT \u7b56\u7565\u53ef\u4ee5\u96c6\u8ba4\u8bc1\u548c\u6388\u6743\u4e8e\u4e00\u8eab\uff0c\u5728\u7528\u6237\u53d6\u5f97\u6388\u6743\u540e\u4f1a\u5411\u7528\u6237\u4f20\u8f93\u4e00\u4e2a JWT Token\uff0c\u5728\u540e\u9762\u7684\u6240\u6709\u8bf7\u6c42\u4e2d\u8c03\u7528\u65b9\u90fd\u4f1a\u643a\u5e26\u8fd9\u4e2a Token \u4ece\u800c\u4fdd\u8bc1\u8bf7\u6c42\u662f\u88ab\u6388\u6743\u7684\u3002\\n\\n\u5728 API \u7f51\u5173\u4e2d\u53ef\u4ee5\u901a\u8fc7 JWT \u7b56\u7565\u5c06 [JWT](https://jwt.io/) \u8eab\u4efd\u9a8c\u8bc1\u80fd\u529b\u6dfb\u52a0\u5230\u7f51\u5173\u4e2d\uff0c\u4ece\u800c\u628a\u8fd9\u5c42\u903b\u8f91\u4ece\u4e1a\u52a1\u4e2d\u62bd\u79bb\u51fa\u6765\uff0c\u4e1a\u52a1\u5b9e\u73b0\u8005\u53ef\u4ee5\u66f4\u52a0\u4e13\u6ce8\u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\u3002\u4ee5 APISIX \u7684 [jwt-auth](https://apisix.apache.org/zh/docs/apisix/plugins/jwt-auth/) \u63d2\u4ef6\u4e3a\u4f8b\uff0c\u63d2\u4ef6\u9700\u8981\u5728 Consumer \u4e2d\u542f\u7528\u5e76\u914d\u7f6e\u552f\u4e00\u7684 Key\u3001\u52a0\u5bc6\u7528\u7684\u516c\u79c1\u94a5\u3001\u52a0\u5bc6\u7b97\u6cd5\u3001Token \u8fc7\u671f\u65f6\u95f4\u7b49\u3002\u540c\u65f6\u8fd8\u9700\u8981\u5728\u8def\u7531\u4e2d\u542f\u7528\u8fd9\u4e00\u63d2\u4ef6\u5e76\u914d\u7f6e\u7f51\u5173\u8bfb\u53d6 Token \u7684\u4f4d\u7f6e\u548c\u5b57\u6bb5\uff0c\u6bd4\u5982 header\u3001query\u3001cookie \u7b49\u3002\u8be5\u63d2\u4ef6\u4f1a\u5728 API \u7f51\u5173\u4e2d\u6dfb\u52a0\u4e00\u4e2a API \u7528\u4e8e\u7b7e\u53d1 Token\u3002\u5728\u53d1\u9001\u8bf7\u6c42\u4e4b\u524d\u9700\u8981\u8bf7\u6c42\u7b7e\u53d1 token \u7684 API \u83b7\u5f97 Token\uff0c\u53d1\u9001\u8bf7\u6c42\u65f6\u9700\u8981\u6839\u636e\u914d\u7f6e\u4fe1\u606f\u5728\u6307\u5b9a\u7684\u4f4d\u7f6e\u4e0a\u643a\u5e26\u8fd9\u4e00 Token\u3002\u5728\u8bf7\u6c42\u5230\u8fbe\u7f51\u5173\u540e\u7f51\u5173\u4f1a\u6309\u7167\u914d\u7f6e\u4fe1\u606f\u4ece\u8bf7\u6c42\u7684\u6307\u5b9a\u4f4d\u7f6e\u8bfb\u53d6 Token \u5e76\u9a8c\u8bc1 Token \u7684\u6709\u6548\u6027\uff0c\u9a8c\u8bc1\u901a\u8fc7\u540e\u8be5\u8bf7\u6c42\u624d\u80fd\u88ab\u8f6c\u53d1\u81f3\u4e0a\u6e38\u670d\u52a1\u3002\\n\\n\u76f8\u8f83\u4e8e\u524d\u4e24\u79cd\u7b56\u7565\uff0cJWT \u7b56\u7565\u5305\u542b\u4e86\u8fc7\u671f\u65f6\u95f4\u9009\u9879\uff0c\u7b7e\u53d1\u7684 Token \u968f\u7740\u65f6\u95f4\u6d41\u901d\u662f\u53ef\u4ee5\u8fc7\u671f\u7684\uff0c\u4f46\u662f Basic Auth \u548c Key Auth \u7684\u6709\u6548\u671f\u662f\u6c38\u4e45\u7684\uff0c\u9664\u975e\u670d\u52a1\u7aef\u66f4\u6362\u4e86\u5bc6\u7801\u6216 Key\u3002\u9664\u6b64\u4e4b\u5916 JWT \u7b56\u7565\u53ef\u4ee5\u5728\u591a\u4e2a\u670d\u52a1\u4e4b\u95f4\u516c\u7528\uff0c\u5c24\u5176\u662f\u9488\u5bf9\u5355\u70b9\u767b\u5f55\u573a\u666f\u4e0b\u5f88\u6709\u7528\u3002\\n\\n### OpenID Connect\\n\\n[OpenID Connect](https://openid.net/connect/) \u662f\u5efa\u7acb\u5728 OAuth2.0 \u534f\u8bae\u4e4b\u4e0a\u7684\u8eab\u4efd\u8ba4\u8bc1\u65b9\u6cd5\uff0c\u4e3a\u5e94\u7528\u7684\u6388\u6743\u63d0\u4f9b\u4e86\u6bd4\u8f83\u5b8c\u6574\u7684\u65b9\u6848\uff0cAPI \u7f51\u5173\u4e2d\u7684 OpenID Connect \u7b56\u7565\u5c06\u5141\u8bb8\u4e0a\u6e38\u670d\u52a1\u4ece\u8eab\u4efd\u63d0\u4f9b\u8005\uff08IdP\uff09\u4e2d\u83b7\u53d6\u8bf7\u6c42\u4e2d\u7684\u7528\u6237\u4fe1\u606f\uff0c\u4ece\u800c\u4fdd\u62a4 API \u5b89\u5168\u3002\u5e38\u89c1\u7684\u8eab\u4efd\u63d0\u4f9b\u8005\u6709 Keycloak\u3001Ory Hydra\u3001Okta\u3001Auth0 \u7b49\u7b49\u3002\u4ee5 Apache APISIX \u4e3a\u4f8b\u7f51\u5173\u4e2d\u7684 [OpenID Connect](https://apisix.apache.org/docs/apisix/plugins/openid-connect/) \u7b56\u7565\u5de5\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a\\n\\n![\u5de5\u4f5c\u6d41\u7a0b](https://static.apiseven.com/uploads/2023/01/29/zagxMPz1_download_image%20%285%29%20%281%29.png)\\n\\n1. \u5ba2\u6237\u7aef\u5411\u7f51\u5173\u53d1\u51fa\u8bf7\u6c42\\n2. \u7f51\u5173\u6536\u5230\u8bf7\u6c42\u540e\u5411 IdP \u53d1\u51fa\u8ba4\u8bc1\u8bf7\u6c42\\n3. \u7528\u6237\u5c06\u88ab\u91cd\u5b9a\u5411\u5230 IdP \u63d0\u4f9b\u7684\u9875\u9762\u5b8c\u6210\u767b\u9646\u8ba4\u8bc1\\n4. IdP \u91cd\u5b9a\u5411\u5230\u7f51\u5173\u5e76\u643a\u5e26\u8ba4\u8bc1 code\\n5. \u7f51\u5173\u901a\u8fc7 code \u5411 IdP \u8bf7\u6c42 Access Token \u4ece\u800c\u83b7\u53d6\u7528\u6237\u4fe1\u606f\\n6. \u7f51\u5173\u5411\u4e0a\u6e38\u8f6c\u53d1\u8bf7\u6c42\u65f6\u5373\u53ef\u643a\u5e26\u7528\u6237\u4fe1\u606f\\n\\n\u901a\u8fc7\u8fd9\u4e00\u6d41\u7a0b\u53ef\u4ee5\u5c06\u8ba4\u8bc1\u548c\u9274\u6743\u4ece\u4e1a\u52a1\u4e2d\u72ec\u7acb\u51fa\u6765\u653e\u7f6e\u4e8e\u7f51\u5173\u4e2d\u89e3\u51b3\uff0c\u4f7f\u67b6\u6784\u66f4\u52a0\u6e05\u6670\u3002\u5173\u4e8e\u66f4\u591a APISIX \u7684\u8ba4\u8bc1\u6388\u6743\u65b9\u6cd5\u53ef\u4ee5\u53c2\u8003 [API Gateway Authentication](https://api7.ai/blog/api-gateway-authentication)\u3002\\n\\n## \u5b89\u5168\u7b56\u7565\\n\\nAPI \u7f51\u5173\u5b89\u5168\u7b56\u7565\u50cf\u95e8\u536b\u4e00\u6837\u4fdd\u8bc1 API \u5b89\u5168\u8bbf\u95ee\uff0c\u5141\u8bb8\u6b63\u5e38\u8bf7\u6c42\u88ab\u7f51\u5173\u8f6c\u53d1\u5e76\u5728\u7f51\u5173\u4e0a\u62e6\u622a\u975e\u6cd5\u8bf7\u6c42\u3002\u6839\u636e [OWASP API Security Project](https://owasp.org/www-project-api-security/)\uff0c\u5728 API \u7684\u8c03\u7528\u8005\u4e2d\u5b58\u5728\u7740\u5927\u91cf\u53ef\u80fd\u7684\u5a01\u80c1\u548c\u653b\u51fb\u3002\u4f7f\u7528 API \u7f51\u5173\u5b89\u5168\u7b56\u7565\u53ef\u4ee5\u5bf9\u6240\u6709\u7684 API \u8bf7\u6c42\u8fdb\u884c\u5b89\u5168\u9a8c\u8bc1\uff0c\u5728 API \u514d\u4e8e\u906d\u53d7\u8fd9\u4e9b\u5b89\u5168\u5a01\u80c1\u4e0a\u8d77\u5230\u4e86\u91cd\u8981\u4f5c\u7528\u3002\\n\\n![\u5b89\u5168\u7b56\u7565](https://static.apiseven.com/uploads/2023/01/29/g7IiXUK8_download_image%20%286%29%20%281%29.png)\\n\\n\u4ee5\u4e0b\u662f\u51e0\u79cd\u6bd4\u8f83\u91cd\u8981\u7684 API \u7f51\u5173\u5b89\u5168\u7b56\u7565\u3002\\n\\n### IP \u8bbf\u95ee\u9650\u5236\\n\\nIP \u9650\u5236\u7b56\u7565\u901a\u8fc7\u5c06\u67d0\u4e9b IP \u6216 [CIDR](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing) \u8bbe\u7f6e\u4e3a\u767d\u540d\u5355\u6216\u8005\u9ed1\u540d\u5355\u6765\u9650\u5236\u67d0\u4e9b\u5ba2\u6237\u7aef\u5bf9 API \u7684\u8bbf\u95ee\uff0c\u786e\u4fdd\u91cd\u8981\u6570\u636e\u4e0d\u4f1a\u88ab\u968f\u610f\u8bbf\u95ee\u3002\u6b63\u786e\u914d\u7f6e\u8fd9\u4e00\u7b56\u7565\u5f88\u5927\u7a0b\u5ea6\u4e0a\u63d0\u9ad8\u4e86 API \u7684\u5b89\u5168\u6027\uff0c\u5b9e\u73b0\u4e86\u66f4\u9ad8\u7684 API \u5b89\u5168\u6cbb\u7406\u3002\\n\\n### URI \u62e6\u622a\\n\\nURI \u62e6\u622a\u7b56\u7565\u4e3b\u8981\u901a\u8fc7\u8bbe\u7f6e URI \u7684\u4e00\u4e9b\u89c4\u5219\u6765\u963b\u6b62\u6f5c\u5728\u7684\u5371\u9669 API \u8bf7\u6c42\u3002\u6bd4\u5982\u4e00\u4e9b\u5b89\u5168\u653b\u51fb\u901a\u8fc7\u55c5\u63a2 URI \u8def\u5f84\u4ece\u800c\u53d1\u73b0\u6f5c\u5728\u7684\u5b89\u5168\u6f0f\u6d1e\u8fdb\u800c\u653b\u51fb\u3002\\n\\nApache APISIX \u63d0\u4f9b\u4e86 `uri-blocker` \u63d2\u4ef6\u6765\u63d0\u4f9b\u8fd9\u4e00\u80fd\u529b\u3002\u901a\u8fc7 [uri-blocker](https://apisix.apache.org/docs/apisix/plugins/uri-blocker/) \u63d2\u4ef6\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e9b\u6b63\u5219\u89c4\u5219\uff0c\u5982\u679c\u8bf7\u6c42\u547d\u4e2d\u89c4\u5219\u5c31\u53ef\u4ee5\u62e6\u622a\u5f53\u524d\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u4f8b\u5982\u8bbe\u7f6e `root.exe`\u3001`admin` \uff0c\u8fd9\u4e00\u63d2\u4ef6\u5c31\u53ef\u4ee5\u963b\u6b62 `*/root.exe` \u548c `*/admin` \u8fd9\u79cd\u7c7b\u4f3c\u7684\u8bf7\u6c42\uff0c\u8fdb\u4e00\u6b65\u4fdd\u62a4 API \u5b89\u5168\u3002\\n\\n### CORS\\n\\nCORS \u5373\u6d4f\u89c8\u5668\u9488\u5bf9\u8de8\u57df\u8bf7\u6c42\u4f5c\u51fa\u7684\u5b89\u5168\u7b56\u7565\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\u5728\u6d4f\u89c8\u5668\u4e2d\u53d1\u51fa xhr \u8bf7\u6c42\u524d\u6d4f\u89c8\u5668\u4f1a\u9a8c\u8bc1\u8bf7\u6c42\u5730\u5740\u548c\u5f53\u524d\u5730\u5740\u662f\u5426\u4e3a[\u540c\u4e00\u57df](https://developer.mozilla.org/en-US/docs/Glossary/Origin)\uff0c\u5982\u679c\u5728\u540c\u4e00\u57df\u4e0b\u8bf7\u6c42\u53ef\u4ee5\u76f4\u63a5\u53d1\u51fa\uff0c\u5426\u5219\u6d4f\u89c8\u5668\u4f1a\u5148\u51fa\u53d1\u4e00\u4e2a OPTION \u7c7b\u578b\u7684\u8de8\u57df\u9884\u68c0\u8bf7\u6c42\uff0c\u7136\u540e\u5728\u8be5\u8bf7\u6c42\u7684\u54cd\u5e94\u5934\u4e2d\u4f1a\u6709 CORS \u76f8\u5173\u7684\u8bbe\u7f6e\uff0c\u4f8b\u5982\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u7684\u65b9\u6cd5\u3001\u5141\u8bb8\u8bf7\u6c42\u643a\u5e26\u7684\u51ed\u636e\u7b49\u3002\u6d4f\u89c8\u5668\u4f1a\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u51b3\u5b9a\u662f\u5426\u53d1\u51fa\u6b63\u5f0f\u7684\u8bf7\u6c42\uff0c\u8be6\u7ec6\u53ef\u4ee5\u53c2\u8003 [CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)\u3002\\n\\n\u4e00\u822c\u60c5\u51b5\u4e0b\u5305\u542b CORS \u8bbe\u7f6e\u7684\u54cd\u5e94\u662f\u7531\u540e\u7aef\u670d\u52a1\u8bbe\u7f6e\u7684\uff0c\u4f46\u662f\u5982\u679c\u670d\u52a1\u6570\u91cf\u5f88\u591a\uff0c\u5728\u7f51\u5173\u5c42\u9762\u9488\u5bf9\u4e0d\u540c\u670d\u52a1\u7edf\u4e00\u5904\u7406\u4f1a\u66f4\u52a0\u4fbf\u6377\u5b89\u5168\u3002CORS \u7b56\u7565\u53ef\u4ee5\u5728\u4e0d\u540c\u7684 API \u4e0a\u8bbe\u7f6e\u4e0d\u540c\u7684\u8de8\u57df\u89e3\u51b3\u7b56\u7565\uff0c\u4e0a\u6e38\u670d\u52a1\u65e0\u9700\u518d\u5904\u7406\u8fd9\u4e9b\u903b\u8f91\u3002\\n\\n### CSRF\\n\\n[CSRF](https://owasp.org/www-community/attacks/csrf) \u5373\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\u653b\u51fb\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u4f1a\u4f7f\u7ec8\u7aef\u7528\u6237\u5728\u4ed6\u4eec\u5df2\u7ecf\u8ba4\u8bc1\u7684\u7ad9\u70b9\u4e2d\u6267\u884c\u975e\u81ea\u613f\u7684\u52a8\u4f5c\u3002\u8fd9\u79cd\u653b\u51fb\u901a\u5e38\u4f34\u968f\u7740\u793e\u4f1a\u5de5\u7a0b\u5b66\uff08\u901a\u8fc7\u7535\u5b50\u90ae\u4ef6\u5411\u653b\u51fb\u8005\u53d1\u9001\u653b\u51fb\u94fe\u63a5\uff09\uff0c\u5f53\u7528\u6237\u70b9\u51fb\u8fd9\u4e00\u94fe\u63a5\u540e\u5229\u7528\u653b\u51fb\u8005\u5728\u7f51\u7ad9\u4e2d\u5df2\u767b\u9646\u8ba4\u8bc1\u7684\u8eab\u4efd\u6267\u884c\u653b\u51fb\u64cd\u4f5c\u3002\u5728\u7f51\u7ad9\u770b\u6765\u56e0\u4e3a\u7528\u6237\u5df2\u7ecf\u767b\u9646\uff0c\u6240\u4ee5\u6240\u505a\u7684\u4efb\u4f55\u64cd\u4f5c\u90fd\u662f\u6b63\u5e38\u7684\u3002\\n\\n\u901a\u5e38\u7f51\u7ad9\u7684\u540e\u7aef\u670d\u52a1\u9700\u8981\u6dfb\u52a0\u989d\u5916\u7684\u4e2d\u95f4\u4ef6\u5904\u7406\u8fd9\u90e8\u5206\u903b\u8f91\uff0c\u9632\u8303\u7684\u65b9\u6cd5\u4e5f\u90fd\u6709\u7edf\u4e00\u7684\u6807\u51c6\u3002\u4f7f\u7528 CSRF \u7b56\u7565\u53ef\u4ee5\u4e3a\u7f51\u5173\u63d0\u4f9b\u9632\u8303\u8fd9\u4e00\u653b\u51fb\u7684\u80fd\u529b\uff0c\u5728\u7f51\u5173\u5c42\u7edf\u4e00\u505a CSRF \u5b89\u5168\u5904\u7406\uff0c\u7b80\u5316\u4e0a\u6e38\u670d\u52a1\u903b\u8f91\u590d\u6742\u5ea6\u3002\\n\\n## \u6d41\u91cf\u5904\u7406\u7b56\u7565\\n\\n\u6d41\u91cf\u5904\u7406\u7b56\u7565\u4e3b\u8981\u4fdd\u8bc1 API \u7f51\u5173\u8fdb\u884c\u6d41\u91cf\u8f6c\u53d1\u7684\u4e0a\u6e38\u8d1f\u8f7d\u90fd\u5728\u5065\u5eb7\u8303\u56f4\u5185\uff0c\u540c\u65f6\u5728\u8bf7\u6c42\u8f6c\u53d1\u524d\u6216\u8005\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u524d\u5bf9\u8bf7\u6c42\u8fdb\u884c\u6309\u9700\u6539\u5199\u3002\u8fd9\u4e00\u7c7b\u578b\u7684\u7b56\u7565\u4e3b\u8981\u56f4\u7ed5\u9650\u6d41\u9650\u901f\u3001\u7194\u65ad\u3001\u7f13\u5b58\u3001\u91cd\u5199\u7b49\u529f\u80fd\u5c55\u5f00\u3002\\n\\n### \u9650\u6d41\u9650\u901f\\n\\n\u5728\u8d44\u6e90\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0cAPI \u53ef\u4ee5\u63d0\u4f9b\u7684\u670d\u52a1\u80fd\u529b\u662f\u6709\u4e00\u5b9a\u9650\u5ea6\u7684\uff0c\u5982\u679c\u8c03\u7528\u8d85\u8fc7\u4e86\u8fd9\u4e00\u9650\u5236\u53ef\u80fd\u4f1a\u4f7f\u4e0a\u6e38\u670d\u52a1\u5d29\u6e83\u7ee7\u800c\u5f15\u8d77\u4e00\u4e9b\u8fde\u9501\u53cd\u5e94\u3002\u9650\u6d41\u9650\u901f\u53ef\u4ee5\u9632\u8303\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u53ef\u4ee5\u6709\u6548\u9632\u6b62 API \u906d\u53d7 DDOS \u653b\u51fb\u3002\\n\\n\u5728\u9650\u6d41\u9650\u901f\u7b56\u7565\u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u65f6\u95f4\u7a97\u53e3\u548c\u53ef\u5141\u8bb8\u6700\u5927\u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u5728\u65f6\u95f4\u7a97\u53e3\u5185\u8d85\u8fc7\u8fd9\u4e2a\u6570\u91cf\u7684\u8bf7\u6c42\u4f1a\u88ab\u62d2\u7edd\u5e76\u8fd4\u56de\u8bbe\u7f6e\u7684\u4fe1\u606f\uff0c\u76f4\u5230\u8bf7\u6c42\u6570\u91cf\u4f4e\u4e8e\u8bbe\u5b9a\u7684\u503c\u6216\u5230\u4e0b\u4e00\u4e2a\u65f6\u95f4\u7a97\u53e3\u540e\u4f1a\u5141\u8bb8\u7ee7\u7eed\u8bbf\u95ee\u3002\\n\\n\u8bf7\u6c42\u8ba1\u6570\u7684\u51ed\u636e\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u8bf7\u6c42\u4e2d\u7684\u53d8\u91cf\u6216\u7740\u67d0\u4e00\u4e2a\u8bf7\u6c42\u5934\u7b49\uff0c\u4f8b\u5982\u6839\u636e\u4e0d\u540c\u7684 IP \u8bbe\u7f6e\u76f8\u5e94\u7684\u9650\u901f\u7b56\u7565\u3002\u5b9e\u73b0\u66f4\u52a0\u7075\u6d3b\u7684\u63a7\u5236\u3002\\n\\n### \u7194\u65ad\\n\\nAPI \u7194\u65ad\u7b56\u7565\u53ef\u4ee5\u4e3a\u4e0a\u6e38\u670d\u52a1\u63d0\u4f9b\u7194\u65ad\u80fd\u529b\uff0c\u4f7f\u7528\u8fd9\u4e00\u7b56\u7565\u65f6\u9700\u8981\u8bbe\u7f6e\u4e0a\u6e38\u670d\u52a1\u5065\u5eb7\u548c\u4e0d\u5065\u5eb7\u7684\u72b6\u6001\u7801\uff0c\u7528\u4e8e\u7f51\u5173\u5224\u65ad\u4e0a\u6e38\u670d\u52a1\u72b6\u6001\u3002\u53e6\u5916\u8fd8\u9700\u8981\u8bbe\u7f6e\u89e6\u53d1\u7194\u65ad\u6216\u8005\u6062\u590d\u5065\u5eb7\u7684\u8bf7\u6c42\u6b21\u6570\uff0c\u8fde\u7eed\u8fbe\u5230\u8fd9\u4e00\u6b21\u6570\u540e\u5373\u5224\u5b9a\u4e3a\u5bf9\u5e94\u7684\u72b6\u6001\u3002\u5f53\u4e0a\u6e38\u670d\u52a1\u8fde\u7eed\u5411\u7f51\u5173\u8fd4\u56de\u4e00\u5b9a\u6b21\u6570\u7684\u4e0d\u5065\u5eb7\u72b6\u6001\u7801\u540e\uff0c\u7f51\u5173\u5c31\u4f1a\u7194\u65ad\u8be5\u4e0a\u6e38\u670d\u52a1\u4e00\u6bb5\u65f6\u95f4\uff0c\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\u4e0d\u518d\u5411\u8be5\u4e0a\u6e38\u8f6c\u53d1\u8bf7\u6c42\u800c\u662f\u7531\u7f51\u5173\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u3002\u53ef\u4ee5\u9632\u6b62\u4e0a\u6e38\u670d\u52a1\u56e0\u4e3a\u9519\u8bef\u540e\u7ee7\u7eed\u63a5\u6536\u8bf7\u6c42\u51fa\u73b0 \u201c\u96ea\u5d29\u201d\uff0c\u4fdd\u62a4\u4e1a\u52a1\u670d\u52a1\u3002\u8d85\u8fc7\u8fd9\u4e00\u65f6\u95f4\u540e\u7f51\u5173\u4f1a\u518d\u6b21\u5c1d\u8bd5\u5411\u4e0a\u6e38\u8f6c\u53d1\u8bf7\u6c42\uff0c\u5982\u679c\u8fd8\u662f\u8fd4\u56de\u4e0d\u5065\u5eb7\u7684\u72b6\u6001\u7801\uff0c\u7f51\u5173\u5c31\u4f1a\u7ee7\u7eed\u7194\u65ad\u66f4\u957f\u7684\u65f6\u95f4\uff08\u52a0\u500d\uff09\u3002\u76f4\u5230\u8f6c\u53d1\u8bf7\u6c42\u540e\u4e0a\u6e38\u8fde\u7eed\u8fd4\u56de\u4e86\u4e00\u5b9a\u6b21\u6570\u7684\u5065\u5eb7\u72b6\u6001\u7801\uff0c\u5219\u7f51\u5173\u8ba4\u4e3a\u4e0a\u6e38\u670d\u52a1\u6062\u590d\u5065\u5eb7\uff0c\u540e\u7eed\u4f1a\u7ee7\u7eed\u5f80\u8be5\u4e0a\u6e38\u8282\u70b9\u8f6c\u53d1\u6d41\u91cf\u3002\\n\\n\u5728\u8fd9\u4e2a\u7b56\u7565\u4e2d\u8fd8\u9700\u8981\u8bbe\u7f6e\u5f53\u4e0d\u5065\u5eb7\u540e\u9700\u8981\u8fd4\u56de\u7684\u72b6\u6001\u7801\u548c\u4fe1\u606f\uff0c\u5f53\u4e0a\u6e38\u670d\u52a1\u4e0d\u5065\u5eb7\u540e\u8bf7\u6c42\u5728\u7f51\u5173\u5c42\u9762\u76f4\u63a5\u8fd4\u56de\uff0c\u4fdd\u62a4\u4e1a\u52a1\u670d\u52a1\u7a33\u5b9a\u3002\\n\\n### \u6d41\u91cf\u62c6\u5206\\n\\n\u6d41\u91cf\u62c6\u5206\u7b56\u7565\u53ef\u4ee5\u52a8\u6001\u63a7\u5236\u5c06\u6d41\u91cf\u6309\u6bd4\u4f8b\u8f6c\u53d1\u7ed9\u4e0d\u540c\u7684\u4e0a\u6e38\u670d\u52a1\uff0c\u8fd9\u5728[\u7070\u5ea6\u53d1\u5e03](https://en.wikipedia.org/wiki/Feature_toggle#Canary_release)\u6216[\u84dd\u7eff\u53d1\u5e03](https://en.wikipedia.org/wiki/Blue-green_deployment)\u4e2d\u975e\u5e38\u6709\u7528\u3002\\n\\n\u7070\u5ea6\u53d1\u5e03\u53c8\u540d\u91d1\u4e1d\u96c0\u53d1\u5e03\uff0c\u5f53\u670d\u52a1\u53d1\u5e03\u65b0\u529f\u80fd\u65f6\u53ef\u4ee5\u4ec5\u8ba9\u4e00\u90e8\u5206\u8bf7\u6c42\u4f7f\u7528\u65b0\u7684\u670d\u52a1\uff0c\u53e6\u4e00\u90e8\u5206\u4ecd\u7136\u505c\u7559\u5728\u65e7\u7684\u670d\u52a1\u4e2d\u3002\u5982\u679c\u65b0\u670d\u52a1\u4fdd\u6301\u7a33\u5b9a\uff0c\u5219\u53ef\u4ee5\u589e\u52a0\u6bd4\u4f8b\u9010\u6b65\u5c06\u6240\u6709\u8bf7\u6c42\u8f6c\u79fb\u5230\u65b0\u7684\u670d\u52a1\u4e2d\uff0c\u76f4\u81f3\u6bd4\u4f8b\u5b8c\u5168\u5207\u6362\uff0c\u5b8c\u6210\u670d\u52a1\u5347\u7ea7\u3002\\n\\n\u84dd\u7eff\u53d1\u5e03\u5219\u662f\u53e6\u4e00\u79cd\u53d1\u5e03\u6a21\u5f0f\uff0c\u53ef\u4ee5\u505a\u5230\u5728\u7528\u6237\u4f7f\u7528\u7684\u9ad8\u5cf0\u671f\u8fdb\u884c\u53d1\u5e03\uff0c\u540c\u65f6\u4e0d\u4f1a\u4e2d\u65ad\u670d\u52a1\u3002\u670d\u52a1\u7684\u65e7\u7248\u672c\u548c\u65b0\u7248\u672c\u4f1a\u540c\u65f6\u5171\u5b58\u3002\u4e00\u822c\u4f1a\u5c06\u751f\u4ea7\u73af\u5883\uff08\u84dd\u8272\uff09\u590d\u5236\u5230\u4e00\u4e2a\u76f8\u540c\u4f46\u662f\u5355\u72ec\u7684\u5bb9\u5668\u4e2d\uff08\u7eff\u8272\uff09\u3002\u5728\u7eff\u8272\u73af\u5883\u4e2d\u53d1\u5e03\u65b0\u7684\u66f4\u65b0\uff0c\u4e4b\u540e\u5c06\u7eff\u8272\u548c\u84dd\u8272\u4e00\u540c\u53d1\u5e03\u81f3\u751f\u4ea7\u73af\u5883\u3002\u4e4b\u540e\u5c31\u53ef\u4ee5\u5728\u7eff\u8272\u73af\u5883\u4e2d\u8fdb\u884c\u6d4b\u8bd5\u548c\u4fee\u590d\uff0c\u5728\u8fd9\u671f\u95f4\u7528\u6237\u8bbf\u95ee\u7684\u8fd8\u662f\u84dd\u8272\u7cfb\u7edf\u3002\u4e4b\u540e\u53ef\u4ee5\u4f7f\u7528\u67d0\u4e9b\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u5c06\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230\u7eff\u8272\u73af\u5883\u4e2d\u3002\u84dd\u8272\u73af\u5883\u5373\u53ef\u4fdd\u6301\u5f85\u673a\u4f5c\u4e3a\u707e\u96be\u6062\u590d\u9009\u9879\u6216\u8005\u7528\u4f5c\u4e0b\u4e00\u6b21\u66f4\u65b0\u3002\\n\\nAPISIX \u7684  [traffic-split](https://apisix.apache.org/docs/apisix/plugins/traffic-split/)  \u63d2\u4ef6\u901a\u8fc7\u6d41\u91cf\u62c6\u5206\u5bf9\u4e0a\u8ff0\u63d0\u5230\u7684\u4e24\u79cd\u53d1\u5e03\u7c7b\u578b\u90fd\u8fdb\u884c\u4e86\u5f88\u597d\u7684\u652f\u6301\uff0c\u4f7f\u5f97\u4e1a\u52a1\u90e8\u7f72\u66f4\u52a0\u4fbf\u6377\u53ef\u9760\u3002\\n\\n### \u8bf7\u6c42\u91cd\u5199\\n\\n\u5728\u73b0\u4ee3\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u5c24\u5176\u662f\u670d\u52a1\u7aef\u4e0e\u670d\u52a1\u3001\u670d\u52a1\u4e0e\u670d\u52a1\u4e4b\u95f4\u5145\u65a5\u5404\u79cd\u4e0d\u540c\u7684\u534f\u8bae\uff0c\u6216\u7740\u8bf7\u6c42\u6570\u636e\u683c\u5f0f\u4e0d\u7edf\u4e00\uff0c\u8fd9\u4e9b\u95ee\u9898\u5982\u679c\u5355\u72ec\u5728\u5404\u81ea\u670d\u52a1\u4e4b\u95f4\u5b9e\u73b0\u8f6c\u6362\u5904\u7406\u4f1a\u4ea7\u751f\u5f88\u591a\u5197\u4f59\u7684\u903b\u8f91\u4ee3\u7801\u5e76\u4e14\u96be\u4ee5\u7ba1\u7406\u3002\u4e00\u4e9b\u8bf7\u6c42\u91cd\u5199\u7b56\u7565\u53ef\u4ee5\u5904\u7406\u4e00\u4e9b\u534f\u8bae\u8f6c\u6362\u3001\u8bf7\u6c42\u4f53\u6539\u5199\u7b49\u903b\u8f91\u3002\\n\\nAPISIX \u63d0\u4f9b\u4e86 [response-rewrite](https://apisix.apache.org/docs/apisix/plugins/response-rewrite/) \u63d2\u4ef6\u53ef\u4ee5\u7528\u6765\u4fee\u6539\u4e0a\u6e38\u670d\u52a1\u8fd4\u56de\u7684 Body \u6216\u8005 Header \u4fe1\u606f\u5185\u5bb9\uff0c\u652f\u6301\u6dfb\u52a0\u6216\u8005\u5220\u9664\u54cd\u5e94\u5934\uff0c\u8bbe\u7f6e\u89c4\u5219\u4fee\u6539\u54cd\u5e94\u4f53\u7b49\u3002\u8fd9\u5728\u8bbe\u7f6e CORS \u54cd\u5e94\u5934\u5b9e\u73b0\u8de8\u57df\u8bf7\u6c42\u8bbe\u7f6e\u6216\u8005\u8bbe\u7f6e Location \u5b9e\u73b0\u91cd\u5b9a\u5411\u7b49\u573a\u666f\u4e2d\u5f88\u6709\u7528\u3002\\n\\n\u53e6\u4e00\u65b9\u9762\uff0c\u5bf9\u4e8e\u8bf7\u6c42\u91cd\u5199 APISIX \u5219\u63d0\u4f9b\u4e86 [proxy-rewrite](https://apisix.apache.org/docs/apisix/plugins/proxy-rewrite/) \u63d2\u4ef6\u4e5f\u53ef\u4ee5\u5904\u7406\u4ee3\u7406\u5230\u4e0a\u6e38\u670d\u52a1\u7684\u8bf7\u6c42\u5185\u5bb9\uff0c\u53ef\u4ee5\u5bf9\u8bf7\u6c42\u7684 URI\u3001\u65b9\u6cd5\u3001\u8bf7\u6c42\u5934\u7b49\u91cd\u5199\uff0c\u5728\u5f88\u591a\u573a\u666f\u4e0b\u4e3a\u4e1a\u52a1\u5904\u7406\u63d0\u4f9b\u4e86\u4fbf\u6377\u3002\\n\\n### \u6545\u969c\u6ce8\u5165\\n\\n\u6545\u969c\u6ce8\u5165\u6d4b\u8bd5\u662f\u4e00\u79cd\u8f6f\u4ef6\u6d4b\u8bd5\u65b9\u6cd5\uff0c\u901a\u8fc7\u5728\u7cfb\u7edf\u4e2d\u6545\u610f\u5f15\u5165\u9519\u8bef\u6765\u786e\u4fdd\u7cfb\u7edf\u7684\u884c\u4e3a\u6b63\u5e38\u3002\u901a\u5e38\u5728\u90e8\u7f72\u4e4b\u524d\u8fdb\u884c\u6d4b\u8bd5\u4ee5\u4fdd\u8bc1\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6ca1\u6709\u6f5c\u5728\u7684\u6545\u969c\u3002\u5728\u4e00\u4e9b\u6df7\u6c8c\u6d4b\u8bd5\u573a\u666f\u4e0b\uff0c\u9700\u8981\u5bf9\u670d\u52a1\u6ce8\u5165\u4e00\u4e9b\u9519\u8bef\u6765\u9a8c\u8bc1\u670d\u52a1\u7684\u53ef\u9760\u6027\u3002\\n\\n\u8f6f\u4ef6\u7684\u6545\u969c\u6ce8\u5165\u53ef\u4ee5\u5206\u4e3a\u7f16\u8bd1\u65f6\u6ce8\u5165\u548c\u8fd0\u884c\u65f6\u6ce8\u5165\u3002\u7f16\u8bd1\u65f6\u6ce8\u5165\u6307\u5728\u7f16\u5199\u8f6f\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u901a\u8fc7\u6539\u53d8\u67d0\u4e9b\u4ee3\u7801\u6216\u903b\u8f91\u6765\u5b9e\u73b0\uff1b\u8fd0\u884c\u65f6\u6ce8\u5165\u901a\u8fc7\u5411\u6b63\u5728\u8fd0\u884c\u7684\u8f6f\u4ef6\u73af\u5883\u4e2d\u8bbe\u7f6e\u9519\u8bef\u6765\u6d4b\u8bd5\u8f6f\u4ef6\u7684\u884c\u4e3a\u3002\u6545\u969c\u6ce8\u5165\u7b56\u7565\u53ef\u4ee5\u5728\u7f51\u5173\u4e2d\u4ee5\u8fd0\u884c\u65f6\u6ce8\u5165\u7684\u65b9\u5f0f\uff0c\u6a21\u62df\u5e94\u7528\u7f51\u7edc\u8bf7\u6c42\u4e2d\u7684\u6545\u969c\u3002\u901a\u8fc7\u5728\u7b56\u7565\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u6bd4\u4f8b\uff0c\u547d\u4e2d\u8fd9\u4e2a\u6bd4\u4f8b\u5185\u7684\u8bf7\u6c42\u4f1a\u6267\u884c\u8bbe\u7f6e\u597d\u7684\u6545\u969c\u903b\u8f91\uff0c\u6bd4\u5982\u5ef6\u8fdf\u65f6\u95f4\u8fd4\u56de\uff0c\u6216\u76f4\u63a5\u8fd4\u56de\u8bbe\u7f6e\u7684\u9519\u8bef\u7801\u548c\u9519\u8bef\u4fe1\u606f\u7ed9\u8c03\u7528\u65b9\u3002\\n\\n\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u589e\u52a0\u8f6f\u4ef6\u7684\u9002\u5e94\u6027\uff0c\u8ba9\u5f00\u53d1\u4eba\u5458\u63d0\u524d\u770b\u5230\u53ef\u80fd\u51fa\u73b0\u7684\u4e00\u4e9b\u9519\u8bef\u60c5\u51b5\uff0c\u5728\u53d1\u5e03\u4e4b\u524d\u9488\u5bf9\u95ee\u9898\u505a\u51fa\u9002\u5e94\u6027\u4fee\u6539\u3002\\n\\n### \u534f\u8bae\u8f6c\u6362\\n\\n\u534f\u8bae\u8f6c\u6362\u7c7b\u7684\u7b56\u7565\u53ef\u4ee5\u505a\u4e00\u4e9b\u5e38\u89c1\u534f\u8bae\u4e4b\u95f4\u7684\u8f6c\u6362\u3002\u6bd4\u5982\u5e38\u89c1\u7684 HTTP \u8bf7\u6c42\u548c gRPC \u4e4b\u95f4\u7684\u8f6c\u6362\u3002Apache APISIX \u63d0\u4f9b\u4e86 [grpc-transcode](https://apisix.apache.org/zh/docs/apisix/plugins/grpc-transcode/) \u63d2\u4ef6\u53ef\u4ee5\u5b9e\u73b0\u5728\u7f51\u5173\u63a5\u6536\u5230 HTTP \u8bf7\u6c42\u4e4b\u540e\uff0c\u5c06\u8bf7\u6c42\u8f6c\u7801\u5e76\u8f6c\u53d1\u7ed9 gRPC \u7c7b\u578b\u7684\u670d\u52a1\uff0c\u63a5\u6536\u5230\u54cd\u5e94\u540e\u4ee5 HTTP \u7684\u683c\u5f0f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u8fd9\u6837\u5ba2\u6237\u7aef\u65e0\u9700\u5173\u6ce8\u4e0a\u6e38 gRPC \u7684\u7c7b\u578b\uff0c\u53ea\u5904\u7406 HTTP \u5373\u53ef\u3002\\n\\n## \u53ef\u89c2\u6d4b\u6027\u7b56\u7565\\n\\n\u53ef\u89c2\u6d4b\u6027\u6307\u5728\u4e00\u4e2a\u7cfb\u7edf\u4e2d\u901a\u8fc7\u7cfb\u7edf\u7684\u8f93\u51fa\u6570\u636e\u6765\u8861\u91cf\u8fd9\u4e2a\u7cfb\u7edf\u8fd0\u884c\u72b6\u6001\u7684\u80fd\u529b\u3002\u5728\u4e00\u4e9b\u7b80\u5355\u7684\u7cfb\u7edf\u4e2d\uff0c\u56e0\u4e3a\u7cfb\u7edf\u7ec4\u4ef6\u6570\u91cf\u76f8\u5bf9\u8f83\u5c11\uff0c\u51fa\u73b0\u95ee\u9898\u65f6\u53ef\u4ee5\u901a\u8fc7\u5206\u6790\u5404\u4e2a\u7ec4\u4ef6\u72b6\u6001\u5f97\u5230\u7b54\u6848\u3002\u4f46\u662f\u5728\u5927\u578b\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5404\u79cd\u5fae\u670d\u52a1\u7ec4\u4ef6\u6570\u91cf\u975e\u5e38\u5927\uff0c\u5bf9\u7ec4\u4ef6\u4e00\u4e00\u8fdb\u884c\u6392\u67e5\u663e\u7136\u662f\u4e0d\u73b0\u5b9e\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u7cfb\u7edf\u5177\u5907\u53ef\u89c2\u6d4b\u6027\u3002\u53ef\u89c2\u6d4b\u6027\u63d0\u4f9b\u4e86\u5bf9\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u201c\u53ef\u89c1\u6027\u201d\uff0c\u5f53\u7cfb\u7edf\u51fa\u73b0\u95ee\u9898\u65f6\u5b83\u53ef\u4ee5\u63d0\u4f9b\u5de5\u7a0b\u5e08\u6240\u9700\u7684\u63a7\u5236\u80fd\u529b\uff0c\u51c6\u786e\u5b9a\u4f4d\u95ee\u9898\u3002\\n\\n![\u8f93\u51fa\u6570\u636e\u7c7b\u578b](https://static.apiseven.com/uploads/2023/01/29/JMvtNbzD_download_image%20%287%29%20%281%29.png)\\n\\n\u53ef\u89c2\u6d4b\u6027\u7684\u6570\u636e\u6536\u96c6\u53ef\u4ee5\u5728\u5e94\u7528\u7a0b\u5e8f\u7ec4\u4ef6\u5185\u5b9e\u73b0\uff0c\u4e5f\u53ef\u4ee5\u5728\u5176\u4ed6\u4f4d\u7f6e\u5b9e\u73b0\u3002API \u7f51\u5173\u4f5c\u4e3a\u6240\u6709\u6d41\u91cf\u7684\u5165\u53e3\uff0c\u5728 API \u7f51\u5173\u4e2d\u5b9e\u73b0\u7cfb\u7edf\u7684\u53ef\u89c2\u6d4b\u6027\uff0c\u53ef\u4ee5\u6e05\u6670\u53cd\u6620\u51fa\u7cfb\u7edf API \u7684\u4f7f\u7528\u60c5\u51b5\u3002API \u7f51\u5173\u7684\u53ef\u89c2\u6d4b\u6027\u7b56\u7565\u53ef\u4ee5\u5e2e\u52a9\u5230\u516c\u53f8\u7684\u6bcf\u4e2a\u56e2\u961f\uff1a\\n\\n* \u5de5\u7a0b\u5e08\u56e2\u961f\u53ef\u4ee5\u76d1\u63a7\u5e76\u89e3\u51b3 API \u95ee\u9898\uff1b\\n* \u4ea7\u54c1\u56e2\u961f\u53ef\u4ee5\u4e86\u89e3 API \u7684\u4f7f\u7528\u60c5\u51b5\u4ee5\u6316\u6398\u80cc\u540e\u7684\u5546\u4e1a\u4ef7\u503c\uff1b\\n* \u9500\u552e\u548c\u589e\u957f\u56e2\u961f\u53ef\u4ee5\u76d1\u63a7 API \u4f7f\u7528\u60c5\u51b5\uff0c\u89c2\u5bdf\u5546\u4e1a\u673a\u4f1a\u5e76\u786e\u4fdd API \u63d0\u4f9b\u6b63\u786e\u7684\u6570\u636e\u3002\\n\\n\u53ef\u89c2\u6d4b\u6027\u7b56\u7565\u6839\u636e\u8f93\u51fa\u7684\u6570\u636e\u7c7b\u578b\u4e00\u822c\u5206\u4e3a\u4e09\u7c7b\uff1aTracing\uff0cMetrics \u548c Logging\u3002\\n\\n### Tracing\\n\\n\u5728\u5927\u578b\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u670d\u52a1\u4e4b\u95f4\u7684\u8c03\u7528\u5173\u7cfb\u9519\u7efc\u590d\u6742\uff0cTracing\uff08\u94fe\u8def\u8ffd\u8e2a\uff09\u53ef\u4ee5\u5728\u5206\u5e03\u5f0f\u5e94\u7528\u4e2d\u8ffd\u8e2a\u5b8c\u6574\u7684\u8c03\u7528\u94fe\u8def\u3001\u5e94\u7528\u4e4b\u95f4\u7684\u4f9d\u8d56\u5206\u6790\u4ee5\u53ca\u8bf7\u6c42\u7edf\u8ba1\u7b49\u5185\u5bb9\u3002\u5728\u7cfb\u7edf\u51fa\u73b0\u95ee\u9898\u65f6\u53ef\u4ee5\u5e2e\u52a9\u5de5\u7a0b\u5e08\u786e\u5b9a\u6392\u67e5\u8303\u56f4\u548c\u4f4d\u7f6e\u3002\\n\\nTracing \u7b56\u7565\u53ef\u4ee5\u5728 API \u7f51\u5173\u4e0a\u96c6\u6210\u4e00\u4e9b\u5176\u4ed6\u7684\u5206\u5e03\u5f0f\u8c03\u7528\u94fe\u8def\u8ffd\u8e2a\u7cfb\u7edf\uff0c\u6536\u96c6\u4fe1\u606f\u5e76\u8bb0\u5f55\u3002\u5e38\u89c1\u7684\u670d\u52a1\u6bd4\u5982 Zipkin\u3001SkyWalking \u7b49\u3002\u901a\u8fc7 Tracing \u7b56\u7565\u5c06\u8fd9\u4e9b\u670d\u52a1\u96c6\u6210\u5230 API \u7f51\u5173\u4e2d\uff0c\u5b9e\u73b0\u5728\u7f51\u5173\u4e0a\u6570\u636e\u6536\u96c6\u548c\u4e0e\u8fd9\u4e9b\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5de5\u7a0b\u5e08\u89e3\u51b3\u8bf8\u5982\u8fd9\u4e2a\u8bf7\u6c42\u63a5\u89e6\u4e86\u4ec0\u4e48\u670d\u52a1\u4ee5\u53ca\u5f15\u5165\u4e86\u591a\u5c11\u5ef6\u8fdf\u7b49\u95ee\u9898\u3002Tracing \u7b56\u7565\u4f7f\u5de5\u7a0b\u5e08\u80fd\u591f\u8fdb\u4e00\u6b65\u786e\u8ba4\u5728\u7279\u5b9a\u7684\u4f1a\u8bdd\u6216\u76f8\u5173\u7684 API \u8c03\u7528\u4e2d\u8981\u770b\u54ea\u4e9b\u65e5\u5fd7\uff0c\u786e\u8ba4\u6392\u67e5\u8303\u56f4\u3002\\n\\n### Metrics\\n\\nMetrics \u6307\u5728\u670d\u52a1\u8fd0\u884c\u671f\u95f4\u6536\u96c6\u5230\u7684\u4e00\u4e2a\u65f6\u95f4\u95f4\u9694\u5185\u8f6f\u4ef6\u81ea\u5df1\u7684\u5404\u79cd\u89c2\u6d4b\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u9ed8\u8ba4\u662f\u7ed3\u6784\u5316\u7684\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u5b9e\u73b0\u67e5\u8be2\u548c\u53ef\u89c6\u5316\u3002\u901a\u8fc7\u5bf9\u8fd9\u4e9b\u6570\u636e\u5206\u6790\u53ef\u4ee5\u638c\u63e1\u7cfb\u7edf\u5f53\u4e0b\u7684\u8fd0\u884c\u72b6\u6001\u548c\u884c\u4e3a\u3002\\n\\nMetrics \u7b56\u7565\u53ef\u4ee5\u5728 API \u7f51\u5173\u4e2d\u96c6\u6210 Prometheus \u6216 Datadog \u8fd9\u4e00\u7c7b\u670d\u52a1\uff0c\u4e3a\u7cfb\u7edf\u63d0\u4f9b\u76d1\u63a7\u3001\u62a5\u8b66\u7b49\u80fd\u529b\u3002\u8fd9\u4e00\u7b56\u7565\u901a\u8fc7 API \u7f51\u5173\u4e2d\u7684\u5404\u79cd\u63a5\u53e3\u6536\u96c6\u7f51\u5173\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u6570\u636e\uff0c\u5e76\u5c06\u6570\u636e\u4e0a\u62a5\u81f3\u4e0a\u8ff0\u670d\u52a1\u4e2d\u3002\u901a\u8fc7\u5c06\u8fd9\u4e9b\u6570\u636e\u53ef\u89c6\u5316\u540e\u5f00\u53d1\u8005\u53ef\u4ee5\u6e05\u6670\u770b\u5230\u7f51\u5173\u7684\u8fd0\u884c\u72b6\u6001\uff0cAPI \u8bf7\u6c42\u7684\u7edf\u8ba1\u4fe1\u606f\u7b49\u6570\u636e\u7edf\u8ba1\u56fe\u3002\\n\\n### Logging\\n\\n\u65e5\u5fd7\u662f\u5728\u67d0\u4e2a\u7279\u5b9a\u65f6\u95f4\u7cfb\u7edf\u4e8b\u4ef6\u7684\u6587\u672c\u8bb0\u5f55\uff0c\u5f53\u7cfb\u7edf\u51fa\u73b0\u95ee\u9898\u65f6\u65e5\u5fd7\u662f\u9996\u8981\u6392\u67e5\u7684\u5730\u65b9\u3002\u5f53\u670d\u52a1\u51fa\u73b0\u4e00\u4e9b\u610f\u5916\u60c5\u51b5\u65f6\u5de5\u7a0b\u5e08\u4f9d\u8d56\u65e5\u5fd7\u5185\u5bb9\u67e5\u770b\u7cfb\u7edf\u201c\u53d1\u751f\u4e86\u4ec0\u4e48\u201d\u4ece\u800c\u627e\u51fa\u5bf9\u5e94\u7684\u89e3\u51b3\u65b9\u6cd5\u3002\u65e5\u5fd7\u5185\u5bb9\u4e00\u822c\u5206\u4e3a\u4e24\u7c7b\uff1aAPI \u8bf7\u6c42\u65e5\u5fd7\u548c\u7f51\u5173\u81ea\u8eab\u7684\u8fd0\u884c\u65e5\u5fd7\u3002API \u8bf7\u6c42\u65e5\u5fd7\u8bb0\u5f55\u4e86 API \u7f51\u5173\u5728\u8fd0\u884c\u671f\u95f4\u6240\u6709\u7684 API \u8bf7\u6c42\u8bb0\u5f55\uff0c\u901a\u8fc7\u8fd9\u4e9b\u8bb0\u5f55\u5de5\u7a0b\u5e08\u53ef\u4ee5\u638c\u63e1 API \u8bbf\u95ee\u60c5\u51b5\uff0c\u53ca\u65f6\u53d1\u73b0\u5e76\u6392\u67e5\u5f02\u5e38\u8bf7\u6c42\u3002\u7f51\u5173\u81ea\u8eab\u7684\u8fd0\u884c\u65e5\u5fd7\u5219\u5305\u542b\u4e86\u7f51\u5173\u5728\u5de5\u4f5c\u671f\u95f4\u53d1\u751f\u7684\u6240\u6709\u4e8b\u4ef6\u7684\u8bb0\u5f55\uff0c\u5f53 API \u7f51\u5173\u81ea\u8eab\u51fa\u73b0\u5f02\u5e38\u65f6\u53ef\u4ee5\u4f5c\u4e3a\u6392\u67e5\u95ee\u9898\u7684\u91cd\u8981\u4f9d\u636e\u3002\\n\\nLogging \u7b56\u7565\u53ef\u4ee5\u5c06 API \u7f51\u5173\u4e2d\u7684\u65e5\u5fd7\u5b58\u50a8\u5728\u670d\u52a1\u5668\u78c1\u76d8\u4e2d\u6216\u662f\u63a8\u9001\u5230\u4e00\u4e9b\u5176\u4ed6\u7684\u65e5\u5fd7\u670d\u52a1\u5668\u4e2d\uff0c\u6bd4\u5982 HTTP \u65e5\u5fd7\u670d\u52a1\u5668\u3001TCP \u65e5\u5fd7\u670d\u52a1\u5668\u3001UDP \u65e5\u5fd7\u670d\u52a1\u5668\u7b49\uff0c\u6216\u8005\u662f\u5176\u4ed6\u7684\u65e5\u5fd7\u7cfb\u7edf\u6bd4\u5982 Apache Kafka\u3001Apache RocketMQ\u3001Clickhouse \u7b49\u3002\\n\\n## \u603b\u7ed3\\n\\n\u8fd9\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f API \u7f51\u5173\u7b56\u7565\uff0c\u5e76\u9488\u5bf9\u8ba4\u8bc1\u6388\u6743\u3001\u5b89\u5168\u3001\u6d41\u91cf\u5904\u7406\u4e0e\u53ef\u89c2\u6d4b\u6027\u8fd9\u56db\u7c7b API \u7f51\u5173\u4e2d\u5e38\u7528\u7684\u7b56\u7565\u8fdb\u884c\u63cf\u8ff0\u3002API \u7f51\u5173\u5728\u6240\u6709\u4e0a\u6e38\u670d\u52a1\u4e4b\u524d\u63a5\u6536\u8bf7\u6c42\u7684\u6d41\u91cf\uff0c\u63a7\u5236\u4e00\u4e2a\u8bf7\u6c42\u662f\u5426\u8981\u8f6c\u53d1\u4ee5\u53ca\u5982\u4f55\u8fdb\u884c\u8f6c\u53d1\uff0c\u5bf9\u4e0d\u5b89\u5168\u7684\u3001\u672a\u6388\u6743\u7684\u8bf7\u6c42\u76f4\u63a5\u62d2\u7edd\u6216\u8fdb\u884c\u9650\u5236\uff0c\u8fd9\u4e9b\u884c\u4e3a\u90fd\u53ef\u4ee5\u7531 API \u7f51\u5173\u7b56\u7565\u51b3\u5b9a\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (1.2 - 1.15)","metadata":{"permalink":"/zh/blog/2023/01/19/weekly-report-0115","source":"@site/blog/2023/01/19/weekly-report-0115.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (1.2 - 1.15)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-01-19T00:00:00.000Z","formattedDate":"2023\u5e741\u670819\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.225,"truncated":true,"authors":[],"prevItem":{"title":"API \u7f51\u5173\u7b56\u7565\u7684\u4e8c\u4e09\u4e8b","permalink":"/zh/blog/2023/01/30/something-about-api-gateway-policy"},"nextItem":{"title":"Apache APISIX \u96c6\u6210\u539f\u751f Consul \u7684\u670d\u52a1\u53d1\u73b0\u80fd\u529b","permalink":"/zh/blog/2023/01/18/consul-with-apisix"}},"content":"> \u4ece 2023.1.2 - 2023.1.15\uff0c\u6709 19 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 33 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n**\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u65b0\u664b\u8d21\u732e\u8005\u6765\u81ea\u591a\u4e2a\u56fd\u5bb6\uff08\u6ce2\u5170\u3001\u5df4\u57fa\u65af\u5766\u3001\u632a\u5a01\u3001\u8d8a\u5357\uff09\uff0cAPISIX \u6b63\u5728\u88ab\u4e16\u754c\u5404\u5730\u6709\u8da3\u7684\u5f00\u53d1\u8005\u4eec\u5173\u6ce8\u5e76\u53c2\u4e0e\u8d21\u732e\u3002**\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/uploads/2023/01/19/ttc04wzr_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E8%B4%A1%E7%8C%AE%E8%80%85%E6%B5%B7%E6%8A%A5-01%E5%91%A8.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/01/19/m0C82lr9_%E7%A4%BE%E5%8C%BA%E5%8F%8C%E5%91%A8%E6%8A%A5-%E6%96%B0%E6%99%8B%E6%B5%B7%E6%8A%A5-01%E5%91%A8.png)\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [`limit-count` \u63d2\u4ef6\u6dfb\u52a0 Redis \u96c6\u7fa4 TLS/SSL \u8fde\u63a5\u6a21\u5f0f\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8558)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\n- [`limit-count` \u63d2\u4ef6\u6dfb\u52a0 `X-RateLimit-Reset` \u652f\u6301\u3002](https://github.com/apache/apisix/pull/8578)\uff08\u8d21\u732e\u8005\uff1a[mscb402](https://github.com/mscb402)\uff09\\n\\n- [Logger \u7c7b\u63d2\u4ef6\u652f\u6301\u5b9a\u5236\u5316\u65e5\u5fd7\u683c\u5f0f\u3002](https://github.com/apache/apisix/pull/8583)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [Stream \u4ee3\u7406\u6a21\u5f0f\u6dfb\u52a0 Eureka \u670d\u52a1\u53d1\u73b0\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8583)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\n- [Stream \u4ee3\u7406\u6a21\u5f0f\u6dfb\u52a0 DNS \u670d\u52a1\u53d1\u73b0\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8593)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\n- [Stream \u4ee3\u7406\u6a21\u5f0f\u6dfb\u52a0 Nacos \u670d\u52a1\u53d1\u73b0\u652f\u6301\u3002](https://github.com/apache/apisix/pull/8584)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u9a6c\u8702\u7a9d\u5982\u4f55\u5229\u7528 APISIX \u7f51\u5173\u5b9e\u73b0\u5fae\u670d\u52a1\u67b6\u6784\u5347\u7ea7](https://apisix.apache.org/zh/blog/2023/01/15/mafengwo-with-apisix/)\\n\\n    \u672c\u6587\u4ece\u9a6c\u8702\u7a9d\u7684\u5fae\u670d\u52a1\u67b6\u6784\u5e73\u53f0\u8702\u6548\u8fed\u4ee3\u8fc7\u7a0b\u548c\u5e94\u7528 APISIX \u540e\u7684\u4ea7\u54c1\u5b9e\u8df5\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u57fa\u4e8e APISIX \u7684\u7f51\u5173\u5e94\u7528\u5b9e\u4f8b\u3002\\n\\n- [Apache APISIX Ingress 1.6 \u6b63\u5f0f\u53d1\u5e03](https://apisix.apache.org/zh/blog/2023/01/10/release-apisix-ingress-1.6/)\\n\\n    Apache APISIX Ingress 1.6 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u5e26\u6765\u4e86 Gateway API \u7684\u652f\u6301\uff0c\u540c\u65f6\u65b0\u589e\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u96c6\u6210\u4e0e\u4ee3\u7406\u5916\u90e8\u670d\u52a1\uff0c\u4f18\u5316\u5bf9 APISIX Ingress Controller \u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\n\\n- [2022 Apache APISIX \u5e74\u5ea6\u8bb0\u5fc6](https://apisix.apache.org/zh/blog/2023/01/02/2022-summary/)\\n\\n    \u672c\u6587\u5c06\u5e26\u60a8\u56de\u987e Apache APISIX \u793e\u533a\u5728 2022 \u5e74\u5728\u5404\u9886\u57df\u53d6\u5f97\u7684\u6210\u7ee9\u3002\\n\\n- [Apache APISIX 3.1.0 \u6b63\u5f0f\u53d1\u5e03](https://apisix.apache.org/zh/blog/2022/12/30/release-apache-apisix-3.1.0/)\\n\\n    Apache APISIX 3.1.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u5e26\u6765\u5f88\u591a\u5173\u4e8e\u5b89\u5168\u5c42\u9762\u7684\u529f\u80fd\u652f\u6301\uff0c\u540c\u65f6\u65b0\u589e\u5185\u7f6e\u8c03\u8bd5\u63d2\u4ef6\uff0c\u65e8\u5728\u4f18\u5316\u5bf9 APISIX \u7684\u4f7f\u7528\u4f53\u9a8c\u3002"},{"id":"Apache APISIX \u96c6\u6210\u539f\u751f Consul \u7684\u670d\u52a1\u53d1\u73b0\u80fd\u529b","metadata":{"permalink":"/zh/blog/2023/01/18/consul-with-apisix","source":"@site/blog/2023/01/18/consul-with-apisix.md","title":"Apache APISIX \u96c6\u6210\u539f\u751f Consul \u7684\u670d\u52a1\u53d1\u73b0\u80fd\u529b","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u652f\u6301\u539f\u751f Consul \u7684\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u3002\u672c\u6587\u8bb2\u8ff0\u4e86\u5728 Apache APISIX \u4e2d\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u548c\u670d\u52a1\u6ce8\u518c\u7684\u5168\u8fc7\u7a0b\u53ca Consul \u7684\u76f8\u5173\u539f\u7406\u3002","date":"2023-01-18T00:00:00.000Z","formattedDate":"2023\u5e741\u670818\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.58,"truncated":true,"authors":[{"name":"\u674e\u5955\u6d69","title":"Author","url":"https://github.com/Fabriceli","image_url":"https://github.com/Fabriceli.png","imageURL":"https://github.com/Fabriceli.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (1.2 - 1.15)","permalink":"/zh/blog/2023/01/19/weekly-report-0115"},"nextItem":{"title":"\u670d\u52a1\u7f51\u683c\u9886\u57df\u7684\u767e\u82b1\u9f50\u653e\uff0c\u662f\u5426\u5b58\u5728\u4e00\u4e2a\u66f4\u4f18\u89e3\uff1f","permalink":"/zh/blog/2023/01/18/what-is-service-mesh"}},"content":"> Apache APISIX \u652f\u6301\u539f\u751f Consul \u7684\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u3002\u672c\u6587\u8bb2\u8ff0\u4e86\u5728 Apache APISIX \u4e2d\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u548c\u670d\u52a1\u6ce8\u518c\u7684\u5168\u8fc7\u7a0b\u53ca Consul \u7684\u76f8\u5173\u539f\u7406\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\\n\\n### \u5173\u4e8e Apache APISIX\\n\\nApache APISIX \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0b\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u5b83\u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7b49\u7279\u70b9\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\uff08\u91d1\u4e1d\u96c0\u53d1\u5e03\uff09\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u6765\u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5904\u7406\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\u3002\\n\\n### \u5173\u4e8e Consul\\n\\nConsul \u662f HashiCorp \u516c\u53f8\u63a8\u51fa\u7684\u5f00\u6e90\u5de5\u5177\uff0c\u7528\u4e8e\u5b9e\u73b0\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u670d\u52a1\u53d1\u73b0\u4e0e\u914d\u7f6e\uff0c\u63d0\u4f9b\u4e86\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\u3001\u5065\u5eb7\u68c0\u67e5\u3001Key/Value \u5b58\u50a8\u3001\u591a\u6570\u636e\u4e2d\u5fc3\u7684\u80fd\u529b\u3002\\n\\n## \u51c6\u5907\u9636\u6bb5\\n\\n\u672c\u6587\u4e2d\u7684\u6d4b\u8bd5\u73af\u5883\u4f7f\u7528 docker-compose \u642d\u5efa\\n\\n1. \u4e0b\u8f7d Apache APISIX\\n\\n   ```sh\\n   git clone https://github.com/apache/apisix-docker.git\\n   ```\\n\\n2. \u521b\u5efa\u5e76\u8fd0\u884c Consul\\n\\n   ```sh\\n   docker run --rm --name consul_1 -d -p 8500:8500 consul:1.8 consul agent -server -bootstrap-expect=1 -node=agent-one -client 0.0.0.0 -log-level info -data-dir=/consul/data -enable-script-checks\\n   ```\\n\\n3. \u66f4\u65b0 Apache APISIX \u4e2d\u7684\u914d\u7f6e\u6587\u4ef6 `apisix_conf/config.yaml`\\n\\n   ```yaml\\n   # config.yml\\n   # ... other config\\n   discovery:\\n     consul:\\n       servers:\\n         - \\"http://127.0.0.1:8500\\"\\n   ```\\n\\n4. \u542f\u52a8 Apache APISIX\\n\\n   ```sh\\n   # \u8fdb example \u6587\u4ef6\u5939\uff0c\u542f\u52a8 APISIX\\n   docker-compose -f docker-compose.yml -p apisix-docker  up -d\\n   ```\\n\\n5. \u6d4b\u8bd5\u670d\u52a1\u5df2\u7ecf\u5305\u542b\u4e86\u4e24\u4e2a Web \u670d\u52a1\uff0c\u786e\u8ba4 Web \u670d\u52a1\u7684 IP \u5730\u5740\\n\\n   ```sh\\n   $ sudo docker inspect -f=\'{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}\' $(sudo docker ps -aq) | grep web\\n   # \u8f93\u51fa\\n   /apisix-docker-web1-1 - 172.21.0.5\\n   /apisix-docker-web2-1 - 172.21.0.6\\n   ```\\n\\n6. \u8bf7\u6c42 Consul HTTP API \u5c06 Web \u670d\u52a1\u6ce8\u518c\u5230 Consul\\n\\n   ```sh\\n   # \u4f7f\u7528 Web \u5bf9\u5e94\u7684 IP \u548c port \u8fdb\u884c\u6ce8\u518c\\n   $ curl --location --request PUT \'http://127.0.0.1:8500/v1/agent/service/register\' \\\\\\n   --header \'Content-Type: application/json\' \\\\\\n   --data \'{\\n      \\"ID\\": \\"service_a1\\",\\n      \\"Name\\": \\"service_a\\",\\n      \\"Tags\\": [\\"primary\\", \\"v1\\"],\\n      \\"Address\\": \\"172.21.0.5\\",\\n      \\"Port\\": 9081,\\n      \\"Weights\\": {\\n         \\"Passing\\": 10,\\n         \\"Warning\\": 1\\n      }\\n   }\'\\n\\n   $ curl --location --request PUT \'http://127.0.0.1:8500/v1/agent/service/register\' \\\\\\n   --header \'Content-Type: application/json\' \\\\\\n   --data \'{\\n      \\"ID\\": \\"service_a2\\",\\n      \\"Name\\": \\"service_a\\",\\n      \\"Tags\\": [\\"primary\\", \\"v1\\"],\\n      \\"Address\\": \\"172.21.0.6\\",\\n      \\"Port\\": 9082,\\n      \\"Weights\\": {\\n         \\"Passing\\": 10,\\n         \\"Warning\\": 1\\n      }\\n   }\'\\n   ```\\n\\n7. \u67e5\u770b\u6d4b\u8bd5\u670d\u52a1\u662f\u5426\u6ce8\u518c\u6210\u529f\\n\\n   ```sh\\n   $ curl --location --request GET \'http://127.0.0.1:8500/v1/catalog/service/service_a\'\\n   ```\\n\\n   \u5176\u4e2d\uff0c`/v1/catalog/service/` \u540e\u7684\u8def\u5f84\u662f\u670d\u52a1\u540d\u79f0\uff0c\u5373\u670d\u52a1\u6ce8\u518c\u65f6\u5019\u7684 `name` \u3002\\n   \u8fd4\u56de\u6d88\u606f\u4f53\u5982\u4e0b\u5219\u8868\u793a\u6210\u529f\u6ce8\u518c\u3002\\n\\n  ```json\\n   [{\\n      \\"ID\\": \\"7a36c6f1-f701-9c67-8db8-7b8551d36b4a\\",\\n      \\"Node\\": \\"agent-one\\",\\n      \\"Address\\": \\"172.23.0.2\\",\\n      \\"Datacenter\\": \\"dc1\\",\\n      \\"TaggedAddresses\\": {\\n         \\"lan\\": \\"172.23.0.2\\",\\n         \\"lan_ipv4\\": \\"172.23.0.2\\",\\n         \\"wan\\": \\"172.23.0.2\\",\\n         \\"wan_ipv4\\": \\"172.23.0.2\\"\\n      },\\n      \\"NodeMeta\\": {\\n         \\"consul-network-segment\\": \\"\\"\\n      },\\n      \\"ServiceKind\\": \\"\\",\\n      \\"ServiceID\\": \\"service_a1\\",\\n      \\"ServiceName\\": \\"service_a\\",\\n      \\"ServiceTags\\": [\\"primary\\", \\"v1\\"],\\n      \\"ServiceAddress\\": \\"172.20.10.2\\",\\n      \\"ServiceTaggedAddresses\\": {\\n         \\"lan_ipv4\\": {\\n            \\"Address\\": \\"172.20.10.2\\",\\n            \\"Port\\": 9082\\n         },\\n         \\"wan_ipv4\\": {\\n            \\"Address\\": \\"172.20.10.2\\",\\n            \\"Port\\": 9082\\n         }\\n      },\\n      \\"ServiceWeights\\": {\\n         \\"Passing\\": 10,\\n         \\"Warning\\": 1\\n      },\\n      \\"ServiceMeta\\": {},\\n      \\"ServicePort\\": 9082,\\n      \\"ServiceEnableTagOverride\\": false,\\n      \\"ServiceProxy\\": {\\n         \\"MeshGateway\\": {},\\n         \\"Expose\\": {}\\n      },\\n      \\"ServiceConnect\\": {},\\n      \\"CreateIndex\\": 46,\\n      \\"ModifyIndex\\": 124\\n   }, {\\n      \\"ID\\": \\"7a36c6f1-f701-9c67-8db8-7b8551d36b4a\\",\\n      \\"Node\\": \\"agent-one\\",\\n      \\"Address\\": \\"172.23.0.2\\",\\n      \\"Datacenter\\": \\"dc1\\",\\n      \\"TaggedAddresses\\": {\\n         \\"lan\\": \\"172.23.0.2\\",\\n         \\"lan_ipv4\\": \\"172.23.0.2\\",\\n         \\"wan\\": \\"172.23.0.2\\",\\n         \\"wan_ipv4\\": \\"172.23.0.2\\"\\n      },\\n      \\"NodeMeta\\": {\\n         \\"consul-network-segment\\": \\"\\"\\n      },\\n      \\"ServiceKind\\": \\"\\",\\n      \\"ServiceID\\": \\"service_a2\\",\\n      \\"ServiceName\\": \\"service_a\\",\\n      \\"ServiceTags\\": [\\"primary\\", \\"v1\\"],\\n      \\"ServiceAddress\\": \\"172.20.10.2\\",\\n      \\"ServiceTaggedAddresses\\": {\\n         \\"lan_ipv4\\": {\\n            \\"Address\\": \\"172.20.10.2\\",\\n            \\"Port\\": 9081\\n         },\\n         \\"wan_ipv4\\": {\\n            \\"Address\\": \\"172.20.10.2\\",\\n            \\"Port\\": 9081\\n         }\\n      },\\n      \\"ServiceWeights\\": {\\n         \\"Passing\\": 10,\\n         \\"Warning\\": 1\\n      },\\n      \\"ServiceMeta\\": {},\\n      \\"ServicePort\\": 9081,\\n      \\"ServiceEnableTagOverride\\": false,\\n      \\"ServiceProxy\\": {\\n         \\"MeshGateway\\": {},\\n         \\"Expose\\": {}\\n      },\\n      \\"ServiceConnect\\": {},\\n      \\"CreateIndex\\": 47,\\n      \\"ModifyIndex\\": 125\\n   }]\\n  ```\\n\\n## \u521b\u5efa\u8def\u7531\\n\\n### \u6dfb\u52a0\u8def\u7531\\n\\n\u5728\u6dfb\u52a0\u4e4b\u524d\u9700\u8981\u786e\u8ba4 `X-API-KEY`\uff0c\u5c5e\u4e8e APISIX Admin API \u7684\u8bbf\u95ee Token\uff0c\u5728\u8be5\u793a\u4f8b\u4e2d\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684\u5373\u53ef\uff1a`edd1c9f034335f136f87ad84b625c8f1`\uff0c\u8fd9\u91cc\u5c06 URL \u4e3a `/consul/web/*` \u7684\u8bf7\u6c42\u8def\u7531\u5206\u914d\u5230 Consul \u7684 service_a\u3002\\n\\n```sh\\n$ curl http://127.0.0.1:9180/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n{\\n    \\"uri\\": \\"/consul/web/*\\",\\n    \\"upstream\\": {\\n        \\"service_name\\": \\"service_a\\",\\n        \\"type\\": \\"roundrobin\\",\\n        \\"discovery_type\\": \\"consul\\"\\n    }\\n}\'\\n```\\n\\n\u8fd4\u56de\u5982\u4e0b\u7ed3\u6784\u4f53\u8868\u793a\u6210\u529f\u6dfb\u52a0\uff1a\\n\\n```json\\n{\\n   \\"value\\": {\\n      \\"status\\": 1,\\n      \\"uri\\": \\"\\\\/*\\",\\n      \\"update_time\\": 1674029322,\\n      \\"id\\": \\"1\\",\\n      \\"upstream\\": {\\n         \\"hash_on\\": \\"vars\\",\\n         \\"discovery_type\\": \\"consul\\",\\n         \\"pass_host\\": \\"pass\\",\\n         \\"scheme\\": \\"http\\",\\n         \\"service_name\\": \\"service_a\\",\\n         \\"type\\": \\"roundrobin\\"\\n      },\\n      \\"create_time\\": 1674029322,\\n      \\"priority\\": 0\\n   },\\n   \\"key\\": \\"\\\\/apisix\\\\/routes\\\\/1\\"\\n}\\n```\\n\\n## \u9a8c\u8bc1\u914d\u7f6e\u7ed3\u679c\\n\\n\u901a\u8fc7\u8bf7\u6c42\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0cApache APISIX \u4e2d\u65b0\u589e\u7684\u8def\u7531\u901a\u8fc7 Consul \u547d\u4e2d\u4e86\u6b63\u786e\u7684\u670d\u52a1\u5730\u5740\uff0c\u5e76\u6839\u636e `roundrobin` \u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u8bf7\u6c42\u5230\u4e24\u4e2a\u8282\u70b9\u4e0a\u3002\\n\\n```sh\\n# \u7b2c\u4e00\u6b21\u8bf7\u6c42\\ncurl -s http://127.0.0.1:9080/consul/web/\\n# \u8f93\u51fa\\nhello web2%\\n\\n# \u7b2c\u4e8c\u6b21\u8bf7\u6c42\\ncurl -s http://127.0.0.1:9080/consul/web/\\n# \u8f93\u51fa\\nhello web1%\\n\\n# \u6ce8\u610f\uff1a\u4e24\u6b21\u8bf7\u6c42\u83b7\u53d6\u7684\u90fd\u53ef\u80fd\u662f web1 \u6216\u8005 web2\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u7684\u524d\u534a\u90e8\u5206\u4ecb\u7ecd\u4e86 Apache APISIX \u5982\u4f55\u914d\u5408 Consul \u5b9e\u73b0\u57fa\u4e8e Consul \u7684\u670d\u52a1\u53d1\u73b0\u6ce8\u518c\u4e2d\u5fc3\uff0c\u89e3\u51b3\u670d\u52a1\u4fe1\u606f\u7ba1\u7406\u7ef4\u62a4\u7684\u95ee\u9898\u3002\u800c\u5728\u540e\u534a\u90e8\u5206\u5219\u7740\u91cd\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 Docker \u4e2d\u642d\u914d Consul \u4f7f\u7528 Apache APISIX \u7684\u64cd\u4f5c\u6d41\u7a0b\u3002\u5f53\u7136\uff0c\u5728\u5b9e\u9645\u573a\u666f\u4e2d\u7684\u5e94\u7528\uff0c\u8fd8\u9700\u8981\u5404\u4f4d\u8bfb\u8005\u6839\u636e\u4e1a\u52a1\u4f7f\u7528\u573a\u666f\u548c\u5df2\u6709\u7684\u7cfb\u7edf\u67b6\u6784\u5177\u4f53\u5206\u6790\u3002\u5173\u4e8e\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Consul \u6ce8\u518c\u4e2d\u5fc3\u7684\u66f4\u591a\u8bf4\u660e\uff0c\u53ef\u4ee5\u5728[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/discovery/consul/)\u4e2d\u627e\u5230\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41."},{"id":"\u670d\u52a1\u7f51\u683c\u9886\u57df\u7684\u767e\u82b1\u9f50\u653e\uff0c\u662f\u5426\u5b58\u5728\u4e00\u4e2a\u66f4\u4f18\u89e3\uff1f","metadata":{"permalink":"/zh/blog/2023/01/18/what-is-service-mesh","source":"@site/blog/2023/01/18/what-is-service-mesh.md","title":"\u670d\u52a1\u7f51\u683c\u9886\u57df\u7684\u767e\u82b1\u9f50\u653e\uff0c\u662f\u5426\u5b58\u5728\u4e00\u4e2a\u66f4\u4f18\u89e3\uff1f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f\u670d\u52a1\u7f51\u683c\uff1f\u670d\u52a1\u7f51\u683c\u5982\u4f55\u5de5\u4f5c\uff1f\u4ee5\u53ca\u5177\u4f53\u5b9e\u9645\u5e94\u7528\u3002\u7136\u540e\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f Amesh\uff1f\u4ee5\u53ca Amesh \u76ee\u524d\u7684\u53d1\u5c55\u72b6\u6001\u3002","date":"2023-01-18T00:00:00.000Z","formattedDate":"2023\u5e741\u670818\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":15.47,"truncated":true,"authors":[{"name":"\u6797\u5fd7\u714c","title":"Author","url":"https://github.com/hansedong","image_url":"https://github.com/hansedong.png","imageURL":"https://github.com/hansedong.png"},{"name":"lingsamuel","title":"Author","url":"https://github.com/lingsamuel","image_url":"https://github.com/lingsamuel.png","imageURL":"https://github.com/lingsamuel.png"}],"prevItem":{"title":"Apache APISIX \u96c6\u6210\u539f\u751f Consul \u7684\u670d\u52a1\u53d1\u73b0\u80fd\u529b","permalink":"/zh/blog/2023/01/18/consul-with-apisix"},"nextItem":{"title":"\u9a6c\u8702\u7a9d\u5982\u4f55\u5229\u7528 APISIX \u7f51\u5173\u5b9e\u73b0\u5fae\u670d\u52a1\u67b6\u6784\u5347\u7ea7","permalink":"/zh/blog/2023/01/15/mafengwo-with-apisix"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f\u670d\u52a1\u7f51\u683c\uff1f\u670d\u52a1\u7f51\u683c\u5982\u4f55\u5de5\u4f5c\uff1f\u4ee5\u53ca\u5177\u4f53\u5b9e\u9645\u5e94\u7528\u3002\u7136\u540e\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f Amesh\uff1f\u4ee5\u53ca Amesh \u76ee\u524d\u7684\u53d1\u5c55\u72b6\u6001\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[lingsamuel](https://github.com/lingsamuel)\uff0cAPI7.ai \u4e91\u539f\u751f\u6280\u672f\u4e13\u5bb6\uff0cApache APISIX Committer\u3002\\n>\\n> \u4f5c\u8005[\u6797\u5fd7\u714c](https://github.com/oil-oil)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\uff0cApache APISIX contributor\u3002\\n\\n**\u670d\u52a1\u7f51\u683c\u662f\u4e00\u79cd\u6280\u672f\u67b6\u6784\uff0c\u5b83\u7528\u4e8e\u7ba1\u7406\u5fae\u670d\u52a1\u7cfb\u7edf\u4e2d\u5404\u4e2a\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u65e8\u5728\u5904\u7406\u5fae\u670d\u52a1\u95f4\u7684\u6d41\u91cf\uff08\u4e5f\u79f0\u4e3a\u4e1c\u897f\u5411\u6d41\u91cf\uff09\u3002**\\n\\n![\u670d\u52a1\u7f51\u683c\u793a\u4f8b\u56fe](https://static.apiseven.com/uploads/2023/01/18/wScWsjXh_download_image%20%2810%29.png)\\n\\n\u5728\u4e91\u539f\u751f\u5e94\u7528\u4e2d\uff0c\u4e00\u4e2a\u5e94\u7528\u7684\u80cc\u540e\u53ef\u80fd\u5b58\u5728\u7740\u6210\u767e\u4e0a\u5343\u4e2a\u670d\u52a1\uff0c\u5404\u4e2a\u670d\u52a1\u53ef\u80fd\u53c8\u6709\u7740\u82e5\u5e72\u4e2a\u5b9e\u4f8b\uff0c\u5404\u4e2a\u5b9e\u4f8b\u7684\u72b6\u6001\u4e5f\u4e00\u76f4\u5728\u53d8\u5316\u3002\u5728\u5982\u6b64\u590d\u6742\u7684\u670d\u52a1\u8fd0\u884c\u73af\u5883\u4e2d\uff0c\u5982\u4f55\u4fdd\u969c\u7528\u6237\u7684\u53ef\u9760\u8bbf\u95ee\u4ee5\u53ca\u7ef4\u6301\u4e1a\u52a1\u7684\u5e73\u7a33\u8fd0\u884c\u6210\u4e3a\u4e00\u4e2a\u5f88\u5927\u7684\u6311\u6218\uff0c\u670d\u52a1\u7f51\u683c\u7684\u6cbb\u7406\u65b9\u6848\u4fbf\u5e94\u8fd0\u800c\u751f\u3002\\n\\n\u670d\u52a1\u7f51\u683c\u5c31\u50cf\u662f\u5fae\u670d\u52a1\u95f4\u7684 TCP/IP\uff0c\u8d1f\u8d23\u670d\u52a1\u95f4\u7684\u7f51\u7edc\u8c03\u7528\u3001\u9650\u6d41\u9650\u901f\u3001\u76d1\u63a7\u7b49\u3002\u670d\u52a1\u7f51\u683c\u76ee\u524d\u4e3b\u8981\u5e94\u7528\u5728 Kubernetes \u5e73\u53f0\u4e0a\uff0c\u5176\u6700\u7ecf\u5178\u7684\u4e00\u79cd\u5b9e\u73b0\u6a21\u5f0f\u662f Sidecar \u6a21\u5f0f\uff1a\u5c06\u4e00\u4e9b\u901a\u7528\u529f\u80fd\u62bd\u8c61\u5230 Sidecar \u5bb9\u5668\u4e2d\uff0c\u5e76\u5c06 Sidecar \u5bb9\u5668\u4e0e\u670d\u52a1\u5bb9\u5668\u6302\u8f7d\u5728\u540c\u4e00\u4e2a Pod \u91cc\u3002\u7531\u4e8e Sidecar \u5bb9\u5668\u4e0e\u670d\u52a1\u5bb9\u5668\u5e76\u884c\uff0c\u4e14\u5404\u4e2a Sidecar \u95f4\u76f8\u4e92\u901a\u8baf\uff0c\u5171\u540c\u6784\u6210\u4e86\u7f51\u683c\u5f62\u5f0f\u7684\u7f51\u7edc\uff0c\u56e0\u6b64\u79f0\u4e4b\u4e3a\u670d\u52a1\u7f51\u683c\u3002\u5f53\u7136\uff0cSidecar \u5e76\u975e\u552f\u4e00\u7684\u4e00\u79cd\u670d\u52a1\u7f51\u683c\u5b9e\u73b0\u6a21\u5f0f\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u6709 [DaemonSet \u6a21\u5f0f](https://wecode.wepay.com/posts/scds-battle-of-containerization)\u53ca [Ambient mesh \u6a21\u5f0f](https://istio.io/latest/blog/2022/introducing-ambient-mesh/)\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u9700\u8981\u670d\u52a1\u7f51\u683c\uff1f\\n\\n\u5728\u670d\u52a1\u7f51\u683c\u6d41\u884c\u4e4b\u524d\uff0c\u5f88\u591a\u5fae\u670d\u52a1\u67b6\u6784\u7684\u670d\u52a1\u6cbb\u7406\u90fd\u662f\u901a\u8fc7\u5fae\u670d\u52a1\u6846\u67b6\u914d\u5408\u63a7\u5236\u5e73\u53f0\u5b9e\u73b0\u7684\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5b58\u5728\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a\\n\\n1. \u6846\u67b6\u4e0e\u4e1a\u52a1\u8026\u5408\uff0c\u6574\u4f53\u590d\u6742\u5ea6\u4e0e\u8fd0\u7ef4\u96be\u5ea6\u5f88\u9ad8\uff0c\u4e14\u5f00\u53d1\u8005\u9700\u8981\u5bf9\u516c\u5171\u5e93\u6709\u4e00\u5b9a\u7684\u4e86\u89e3\uff0c\u6ca1\u6cd5\u53ea\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u5b9e\u73b0\u3002\\n2. \u9700\u8981\u7ef4\u62a4\u591a\u79cd\u8bed\u8a00\u7248\u672c\u7684\u6846\u67b6\uff0c\u589e\u52a0\u4e86\u7ef4\u62a4\u7684\u6210\u672c\u3002\\n3. \u5fae\u670d\u52a1\u6846\u67b6\u672c\u8eab\u7684\u5347\u7ea7\u6210\u672c\u6bd4\u8f83\u9ad8\uff0c\u5728\u5347\u7ea7\u65f6\u5f80\u5f80\u9700\u8981\u8fdb\u884c\u4e1a\u52a1\u91cd\u542f\u7b49\u64cd\u4f5c\u3002\\n4. \u7ebf\u4e0a\u5b58\u5728\u5f88\u591a\u7248\u672c\u7684\u6846\u67b6\uff0c\u4f1a\u5bfc\u81f4\u590d\u6742\u7684\u517c\u5bb9\u6027\u8003\u8651\u3002\\n\\n\u9762\u5bf9\u4ee5\u4e0a\u8fd9\u4e9b\u95ee\u9898\uff0c\u539f Twitter \u5de5\u7a0b\u5e08 Willian Morgan \u63d0\u51fa\u4e86 Service Mesh \u7684\u6982\u5ff5\uff0c\u5373\u670d\u52a1\u7f51\u683c\u3002\u670d\u52a1\u7f51\u683c\u901a\u8fc7 Sidecar \u6a21\u5f0f\u5b9e\u73b0\u5728\u4e0d\u4fb5\u5165\u4e1a\u52a1\u670d\u52a1\u7684\u60c5\u51b5\u4e0b\u5c06\u57fa\u7840\u8bbe\u65bd\u4e0e\u4e1a\u52a1\u903b\u8f91\u89e3\u8026\uff0c\u5b9e\u73b0\u8de8\u8bed\u8a00\u7edf\u4e00\u66f4\u65b0\u53d1\u5e03\u53ca\u8fd0\u7ef4\u3002\\n\\n![\u670d\u52a1\u7f51\u683c\u5185\u90e8\u5b9e\u73b0](https://static.apiseven.com/uploads/2023/01/18/K8DWpiNn_download_image%20%283%29.jpeg)\\n\\n\u670d\u52a1\u7f51\u683c\u5c06\u6d41\u91cf\u7ba1\u7406\u3001\u53ef\u89c2\u6d4b\u6027\u548c\u5b89\u5168\u901a\u8baf\u7b49\u529f\u80fd\u4e0b\u6c89\u5230\u57fa\u7840\u7ec4\u4ef6\uff0c\u56e0\u6b64\u5f00\u53d1\u8005\u65e0\u9700\u5173\u5fc3\u901a\u4fe1\u5c42\u548c\u670d\u52a1\u6cbb\u7406\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u4e0e\u901a\u4fe1\u76f8\u5173\u7684\u4e00\u5207\u5de5\u4f5c\u76f4\u63a5\u4ea4\u7ed9\u670d\u52a1\u7f51\u683c\uff0c\u8ba9\u5f00\u53d1\u8005\u80fd\u591f\u66f4\u5173\u6ce8\u4e8e\u4e1a\u52a1\u7684\u5f00\u53d1\u3002\u57fa\u4e8e\u670d\u52a1\u7f51\u683c\u7684\u8fd9\u4e9b\u7279\u70b9\uff0c\u524d\u9762\u63d0\u5230\u7684\u51e0\u4e2a\u95ee\u9898\u90fd\u80fd\u591f\u5f97\u5230\u6709\u6548\u89e3\u51b3\u3002\\n\\n## \u670d\u52a1\u7f51\u683c\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f\\n\\n\u670d\u52a1\u7f51\u683c\u4e0d\u4f1a\u4e3a\u5e94\u7528\u7684\u8fd0\u884c\u65f6\u73af\u5883\u52a0\u5165\u65b0\u529f\u80fd\uff0c\u4efb\u4f55\u67b6\u6784\u4e2d\u7684\u5e94\u7528\u8fd8\u662f\u9700\u8981\u76f8\u5e94\u7684\u89c4\u5219\u6765\u6307\u5b9a\u8bf7\u6c42\u5982\u4f55\u4ece A \u70b9\u5230\u8fbe B \u70b9\u3002\u4f46\u670d\u52a1\u7f51\u683c\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u5b83\u4ece\u5404\u4e2a\u670d\u52a1\u4e2d\u63d0\u53d6\u903b\u8f91\u7ba1\u7406\u7684\u670d\u52a1\u95f4\u901a\u4fe1\uff0c\u5e76\u5c06\u5176\u62bd\u8c61\u4e3a\u4e00\u4e2a\u57fa\u7840\u67b6\u6784\u5c42\u3002\\n\\n\u76ee\u524d\u670d\u52a1\u7f51\u683c\u5927\u591a\u6570\u91c7\u7528\u662f**\u6570\u636e\u9762** + **\u63a7\u5236\u9762**\u7684\u67b6\u6784\u6a21\u5f0f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![\u76ee\u524d\u7684\u670d\u52a1\u7f51\u683c\u793a\u4f8b\u56fe](https://static.apiseven.com/uploads/2023/01/18/U2Vw7rs3_download_image%20%282%29%20%281%29.png)\\n\\n\u5176\u4e2d\u63a7\u5236\u9762\u7528\u4e8e\u7ba1\u7406\u548c\u914d\u7f6e\u6570\u636e\u9762\u4ee5\u53ca\u5728\u8fd0\u884c\u65f6\u6267\u884c\u7b56\u7565\u3002\u5355\u4e2a\u7f51\u683c\u4e2d\u63a7\u5236\u5e73\u9762\u7684\u6240\u6709\u5b9e\u4f8b\u5171\u4eab\u76f8\u540c\u7684\u914d\u7f6e\u8d44\u6e90\u3002\u4e3b\u8981\u805a\u7126\u4e8e\u5b89\u5168\u3001\u53ef\u89c2\u6d4b\u6027\u3001\u6d41\u91cf\u7ba1\u63a7\u7b49\u7b56\u7565\u7684\u5904\u7406\u548c\u4e0b\u53d1\uff0c\u540c\u65f6\u8fd8\u80fd\u591f\u6536\u96c6\u548c\u96c6\u4e2d\u6570\u636e\u5e73\u9762\u7684\u9065\u6d4b\u6570\u636e\uff0c\u4f9b\u8fd0\u7ef4\u4eba\u5458\u4f7f\u7528\u3002\\n\\n\u800c\u6570\u636e\u9762\u901a\u5e38\u4ee5\u4ee3\u7406\u7684\u5f62\u5f0f\u5b9e\u73b0\uff0c\u662f\u7531\u4e00\u4e2a\u4e2a\u7684\u7f51\u7edc\u4ee3\u7406 Sidecar \u7ec4\u6210\uff0cSidecar \u4e0e\u4e1a\u52a1\u5e94\u7528\u5b9e\u4f8b\u5e76\u884c\uff0c\u901a\u8fc7\u62e6\u622a\u4e1a\u52a1\u6570\u636e\u6d41\u4ee5\u7ba1\u63a7\u4e1a\u52a1\u5e94\u7528\u7684\u6d41\u91cf\u3002\\n\\n\u5728\u524d\u9762\u7684\u4ecb\u7ecd\u4e2d\u6709\u63d0\u5230\u670d\u52a1\u7f51\u683c\u662f\u5c06 Sidecar \u8bbe\u8ba1\u6a21\u5f0f\u5728 Kubernetes \u8fdb\u884c\u5b9e\u73b0\uff0c\u901a\u8fc7\u5bb9\u5668\u5316\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86\u5c01\u88c5\uff0cSidecar \u4e3b\u5f20\u4ee5\u989d\u5916\u7684\u5bb9\u5668\u6765\u6269\u5c55\u6216\u589e\u5f3a\u4e3b\u5bb9\u5668\uff0c\u8fd9\u4e2a\u989d\u5916\u7684\u5bb9\u5668\u88ab\u79f0\u4e3a Sidecar \u5bb9\u5668\uff0c\u5b83\u4e0e\u4e1a\u52a1\u5bb9\u5668\u5728\u540c\u4e00\u4e2a Pod \u4e2d\u3002\u800c\u670d\u52a1\u7f51\u683c\u5373\u662f\u4e00\u4e2a\u4e2a Sidecar \u4ee3\u7406\u6240\u6784\u6210\u7684\u7f51\u683c\u5f0f\u7f51\u7edc\u3002\\n\\n## \u670d\u52a1\u7f51\u683c\u7684\u5b9e\u9645\u5e94\u7528\\n\\n\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u5de5\u7a0b\u5e08\u5f80\u5f80\u4f1a\u4e3a\u5bf9\u5916\u66b4\u9732\u7684\u670d\u52a1\u91c7\u53d6\u52a0\u5bc6\u6216\u8bbf\u95ee\u9650\u5236\u7684\u63aa\u65bd\u4ee5\u4fdd\u969c\u670d\u52a1\u7684\u5b89\u5168\uff0c\u4f46\u5374\u5ffd\u89c6\u4e86\u96c6\u7fa4\u5185\u90e8\u7684\u6d41\u91cf\u901a\u4fe1\u5b89\u5168\uff0c\u6240\u4ee5\u81f3\u4eca\u4ecd\u6709\u5f88\u591a\u5fae\u670d\u52a1\u5e94\u7528\u6ca1\u6709\u91c7\u53d6\u670d\u52a1\u95f4\u901a\u4fe1\u7684\u52a0\u5bc6\u63aa\u65bd\uff0c\u96c6\u7fa4\u5185\u90e8\u7684\u6d41\u91cf\u4ee5\u660e\u6587\u7684\u5f62\u5f0f\u8fdb\u884c\u4f20\u8f93\uff0c\u975e\u5e38\u5bb9\u6613\u5bfc\u81f4\u5185\u90e8\u6d41\u91cf\u906d\u5230\u6570\u636e\u7a83\u542c\u6216\u662f\u4e2d\u95f4\u4eba\u653b\u51fb\u3002\\n\\n\u800c\u4e3a\u4e86\u9632\u6b62\u96c6\u7fa4\u5185\u90e8\u6d41\u91cf\u906d\u5230\u653b\u51fb\uff0c\u901a\u5e38\u4f1a\u4f7f\u7528 mTLS \u5c06\u901a\u8baf\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\u3002mTLS \u53ef\u4ee5\u7528\u4e8e\u786e\u4fdd\u670d\u52a1\u7f51\u683c\u4e2d\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u4fe1\u5b89\u5168\u3002\u5b83\u4f7f\u7528\u52a0\u5bc6\u5b89\u5168\u6280\u672f\u76f8\u4e92\u8ba4\u8bc1\u5404\u4e2a\u5fae\u670d\u52a1\u5e76\u52a0\u5bc6\u5b83\u4eec\u4e4b\u95f4\u7684\u6d41\u91cf\u3002\\n\\n![mTLS\u52a0\u5bc6](https://static.apiseven.com/uploads/2023/01/18/bT2Zctxd_download_image%20%281%29%20%281%29.png)\\n\\n\u867d\u7136\u53ef\u4ee5\u76f4\u63a5\u5728\u5fae\u670d\u52a1\u4e2d\u5b9a\u4e49\u901a\u4fe1\u5b89\u5168\u7b56\u7565\u5e76\u6267\u884c\u8eab\u4efd\u9a8c\u8bc1\u548c\u52a0\u5bc6\uff0c\u4f46\u5728\u6bcf\u4e00\u4e2a\u5fae\u670d\u52a1\u4e2d\u53bb\u5355\u72ec\u5b9e\u73b0\u76f8\u540c\u7684\u529f\u80fd\u6548\u7387\u662f\u5f88\u4f4e\u7684\u3002\u800c\u4e14\u589e\u52a0\u529f\u80fd\u8fd8\u9700\u8981\u6539\u52a8\u4e1a\u52a1\u4ee3\u7801\uff0c\u4fb5\u5165\u4e1a\u52a1\u903b\u8f91\u3002\u4e14\u5373\u4fbf\u5b8c\u6210\u4e86\u529f\u80fd\uff0c\u540e\u671f\u7684\u5347\u7ea7\u8fed\u4ee3\u4e0e\u6d4b\u8bd5\u90fd\u9700\u8981\u5f00\u53d1\u8005\u6295\u5165\u989d\u5916\u7cbe\u529b\u53bb\u7ef4\u62a4\uff0c\u65e0\u6cd5\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u529f\u80fd\u7684\u5f00\u53d1\u3002\\n\\n\u800c\u4f7f\u7528\u670d\u52a1\u7f51\u683c\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4e0d\u5f71\u54cd\u539f\u672c\u4e1a\u52a1\u7684\u60c5\u51b5\u4e0b\u96f6\u611f\u77e5\u7684\u4e3a\u670d\u52a1\u63d0\u4f9b mTLS \u901a\u4fe1\u3002\u56e0\u4e3a\u5728\u670d\u52a1\u7f51\u683c\u4e2d\uff0c\u670d\u52a1\u901a\u4fe1\u76f8\u5173\u7684\u529f\u80fd\u90fd\u88ab\u8f6c\u79fb\u81f3 Sidecar \u4ee3\u7406\u4e2d\u5b9e\u73b0\u3002**\u5728\u6574\u4e2a\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\uff0c\u4e1a\u52a1\u5e94\u7528\u90fd\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u964d\u4f4e\u5f00\u53d1\u8005\u5fc3\u667a\u8d1f\u62c5\u3002**\\n\\n\u5f53\u7136\uff0c\u670d\u52a1\u7f51\u683c\u9664\u4e86\u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c mTLS \u8fd9\u7c7b\u7684\u5185\u90e8\u6d41\u91cf\u5b89\u5168\u914d\u7f6e\u529f\u80fd\uff0c\u901a\u8fc7\u8c03\u6574\u63a7\u5236\u9762\u7684\u914d\u7f6e\u8fd8\u80fd\u5feb\u901f\u7684\u62d3\u5c55\u5305\u62ec\u6d41\u91cf\u7ba1\u63a7\uff0c\u53ef\u89c2\u6d4b\u6027\uff0c\u534f\u8bae\u7f16\u89e3\u7801\u7b49\u66f4\u591a\u529f\u80fd\u3002\\n\\n## \u66f4\u4f18\u7684\u670d\u52a1\u7f51\u683c\u65b9\u6848\uff1f\\n\\n\u867d\u7136\u670d\u52a1\u7f51\u683c\u89e3\u51b3\u4e86\u5f88\u591a\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u75db\u70b9\uff0c\u4f46\u5b83\u4e5f\u540c\u65f6\u6709\u81ea\u5df1\u7684\u5c40\u9650\u6027\uff0c\u5728\u8f6f\u4ef6\u5f00\u53d1\u4e2d\u590d\u6742\u5ea6\u662f\u4e0d\u706d\u7684\uff0c\u53ea\u662f\u5728\u4e0d\u540c\u7684\u90e8\u5206\u4e4b\u95f4\u505a\u8f6c\u79fb\u3002\u6211\u4eec\u5c06\u670d\u52a1\u6cbb\u7406\u62bd\u79bb\u4e3a\u5355\u72ec\u7684\u4e00\u5c42\u5c31\u8981\u9762\u5bf9\u6d41\u91cf\u94fe\u8def\u7684\u589e\u957f\u4ee5\u53ca\u8fd0\u7ef4\u96be\u5ea6\u7684\u63d0\u5347\uff0c\u4e14\u670d\u52a1\u7f51\u683c\u9700\u8981\u5728\u4e91\u539f\u751f\u7684\u73af\u5883\u4e2d\u4f7f\u7528\uff0c\u8fd9\u5bf9\u4e8e\u8fd0\u7ef4\u7684\u4e13\u4e1a\u80fd\u529b\u53ca\u5de5\u7a0b\u5b9e\u8df5\u7ecf\u9a8c\u6709\u4e86\u66f4\u9ad8\u7684\u8981\u6c42\u3002\u6240\u4ee5\u8bf4\u6280\u672f\u53ea\u662f\u7528\u4e8e\u89e3\u51b3\u95ee\u9898\u7684\u5de5\u5177\uff0c\u670d\u52a1\u7f51\u683c\u80fd\u5e26\u6765\u7684\u4ef7\u503c\u8fd8\u662f\u5f97\u4ece\u5e94\u7528\u7684\u4ece\u5b9e\u9645\u60c5\u51b5\u51fa\u53d1\u3002\\n\\n\u4f5c\u4e3a Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u9879\u76ee\uff0cApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u5728\u57fa\u4e8e APISIX \u7684\u6269\u5c55\u9053\u8def\u4e0a\uff0c\u9664\u4e86 APISIX Ingress \u5728\u4e91\u539f\u751f\u9886\u57df\u88ab\u5404\u5927\u5382\u5546\u5f00\u59cb\u5173\u6ce8\u5916\uff0c\u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u65b9\u6848\u4e5f\u5728\u79ef\u6781\u8fed\u4ee3\u4e2d\u3002\\n\\n## \u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u65b9\u6848\u2014\u2014Amesh\\n\\n[Amesh](https://github.com/api7/Amesh) \u662f [Apache APISIX](https://github.com/apache/apisix) \u7684\u670d\u52a1\u7f51\u683c\u5e93\u3002\u5b83\u9002\u914d\u4e86 xDS \u534f\u8bae\uff0c\u53ef\u4ee5\u4ece\u8bf8\u5982 Istio \u7684\u63a7\u5236\u5e73\u9762\u4e2d\u63a5\u6536\u6570\u636e\uff0c\u5e76\u751f\u6210 APISIX \u6240\u9700\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f7f\u5f97 APISIX \u80fd\u591f\u5728\u670d\u52a1\u7f51\u683c\u9886\u57df\u4f5c\u4e3a\u6570\u636e\u9762\u53d1\u6325\u4f5c\u7528\u3002\\n\\n\u4f9d\u9760 Amesh\uff0cAPISIX \u53ef\u4ee5\u5de5\u4f5c\u5728\u670d\u52a1\u7f51\u683c\u6a21\u5f0f\u4e0b\uff0c\u4e0d\u4f7f\u7528\u4f20\u7edf\u7684 etcd \u4f5c\u4e3a\u6570\u636e\u4e2d\u5fc3\uff0c\u800c\u662f\u4f7f\u7528 shdict \u4e0e Amesh \u5e93\u76f4\u63a5\u8fdb\u884c\u6570\u636e\u4ea4\u6362\uff0c\u907f\u514d\u4e86\u989d\u5916\u7684\u6027\u80fd\u635f\u8017\uff0c\u4f7f\u5f97\u5927\u89c4\u6a21\u90e8\u7f72\u6210\u4e3a\u53ef\u80fd\u3002\\n\\n\u901a\u8fc7\u4f7f\u7528 Amesh\uff0c\u53ef\u4ee5\u5728\u670d\u52a1\u7f51\u683c\u9886\u57df\u83b7\u5f97 APISIX \u5177\u5907\u7684\u9ad8\u6027\u80fd\u3001\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3001\u6613\u6269\u5c55\u6027\u7b49\u591a\u79cd\u4f18\u52bf\u3002\\n\\nAmesh \u901a\u8fc7\u9002\u914d xDS \u534f\u8bae\uff0c\u53ef\u4ee5\u8ba9 APISIX \u66ff\u4ee3 Istio \u6240\u4f7f\u7528\u7684 Envoy \u7ec4\u4ef6\u6765\u63a5\u7ba1\u96c6\u7fa4\u6d41\u91cf\u3002\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0cAPISIX \u5c06\u4f5c\u4e3a Pod \u7684 Sidecar \u63a5\u7ba1\u7f51\u683c\u5185\u7684\u6240\u6709\u6d41\u91cf\u3002\u76ee\u524d Amesh \u7684\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![Amesh\u67b6\u6784](https://static.apiseven.com/uploads/2023/01/19/99lIgVfj_image42fix.png)\\n\\n\u901a\u8fc7\u67b6\u6784\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7 xDS \u534f\u8bae\uff0cAmesh \u53ef\u4ee5\u5c06 Istio \u4f5c\u4e3a\u63a7\u5236\u9762\uff0c\u4ece Istio \u4fa7\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\uff0c\u5e76\u5c06\u5176\u8f6c\u4e49\u4e3a APISIX \u6240\u9700\u7684\u914d\u7f6e\u3002\\n\\n\u800c\u7f51\u683c\u5185\u90e8\u7684\u6240\u6709\u6d41\u91cf\u90fd\u5c06\u7531 APISIX \u63a5\u7ba1\u3002\u5176\u4e2d\uff0cAPISIX \u7684\u914d\u7f6e\u4e2d\u5fc3\u88ab\u8bbe\u7f6e\u4e3a Amesh\uff0c\u8fd9\u4f7f\u5f97 APISIX \u8131\u79bb etcd \u7684\u4f9d\u8d56\u3002Amesh \u4e3a APISIX \u63d0\u4f9b\u4e86\u4e00\u79cd\u4ece xDS \u534f\u8bae\u4e2d\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\u7684\u65b9\u5f0f\u3002\\n\\n\u6b64\u5916\uff0cAmesh \u5728 v0.2 \u4e2d\u63d0\u4f9b\u4e86\u989d\u5916\u7684\u53ef\u9009\u63a7\u5236\u9762\u7ec4\u4ef6\uff1a[amesh-controller](https://github.com/api7/Amesh/tree/main/controller/charts/amesh-controller)\u3002Amesh Controller \u589e\u52a0\u4e86 Amesh \u4e13\u7528\u7684 CRD\uff0c\u53ef\u4ee5\u4e3a APISIX \u914d\u7f6e\u4e00\u4e9b Istio \u6240\u4e0d\u652f\u6301\u7684\u989d\u5916\u529f\u80fd\u3002\u989d\u5916\u5e26\u6709 `amesh-controller` \u7684\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![amesh-controller\u67b6\u6784](https://static.apiseven.com/uploads/2023/01/19/AQCRwtA8_image43fix.png)\\n\\n\u6b63\u5982\u524d\u6587\u6240\u63d0\u5230\u7684\uff0cAmesh Controller \u662f\u53ef\u9009\u7ec4\u4ef6\u3002\u5728\u672a\u5b89\u88c5\u65f6\uff0cAmesh \u4e5f\u80fd\u6b63\u5e38\u4f7f\u7528 Istio \u7684\u539f\u751f\u80fd\u529b\u63d0\u4f9b\u670d\u52a1\u3002\u5728\u5b89\u88c5\u4e86 `amesh-controller` \u540e\uff0cAmesh \u80fd\u81ea\u52a8\u68c0\u6d4b\u5230\u63a7\u5236\u9762\u7684\u52a0\u5165\uff0c\u5e76\u52a8\u6001\u5730\u4ece\u4e2d\u83b7\u53d6\u914d\u7f6e\uff0c\u800c\u65e0\u9700\u91cd\u542f\u3002\\n\\nAmesh controller \u4e3a Amesh \u63d0\u4f9b\u4e86 Istio \u65e0\u6cd5\u63d0\u4f9b\u7684 APISIX \u7279\u6709\u529f\u80fd\u3002\u4f8b\u5982\u5728\u5b89\u88c5 `amesh-controller` \u540e\uff0c\u7528\u6237\u80fd\u4e3a\u670d\u52a1\u914d\u7f6e APISIX \u539f\u751f\u5177\u5907\u7684\u6d77\u91cf\u63d2\u4ef6\uff0c\u4f7f APISIX \u4f17\u591a\u7684\u63d2\u4ef6\u5728\u670d\u52a1\u7f51\u683c\u573a\u666f\u4e0b\u4e5f\u80fd\u5f00\u7bb1\u5373\u7528\uff0c\u800c\u65e0\u9700\u7528\u6237\u8fdb\u884c\u81ea\u5b9a\u4e49\u7684\u5f00\u53d1\u3002\\n\\n## Amesh \u53d1\u5c55\u72b6\u6001\\n\\n\u76ee\u524d Amesh \u9879\u76ee\u6b63\u5728\u79ef\u6781\u5f00\u53d1\u4e2d\u3002\u5728\u6700\u8fd1\u53d1\u5e03\u7684\u7684 [v0.2 \u7248\u672c](https://github.com/api7/Amesh/releases/tag/v0.0.2)\u4e2d\uff0cAmesh \u65b0\u589e\u4e86\u53ef\u9009\u7684\u63a7\u5236\u9762 amesh-controller \u7ec4\u4ef6\uff0c\u4e3a Amesh \u63d0\u4f9b\u4e86 APISIX \u6240\u652f\u6301\u7684\u5f3a\u5927\u7684\u63d2\u4ef6\u7cfb\u7edf\uff0c\u5927\u5927\u589e\u5f3a\u4e86 Amesh \u7684\u53ef\u6269\u5c55\u6027\u3002\\n\\n### \u6269\u5c55\u80fd\u529b\\n\\n\u5728\u4f7f\u7528 Amesh \u65f6\uff0c\u5982\u679c\u662f\u5e38\u89c4\u7684 Istio \u90e8\u7f72\uff0c\u7528\u6237\u5219\u53ef\u4ee5\u901a\u8fc7 Lua \u6216 Wasm \u6765\u5bf9 Envoy \u8fdb\u884c\u529f\u80fd\u6269\u5c55\u3002\\n\\n\u4e0e Envoy \u539f\u751f\u80fd\u529b\u76f8\u6bd4\uff0cAPISIX \u5b98\u65b9\u5373\u652f\u6301\u63d2\u4ef6\u6269\u5c55\u80fd\u529b\uff0c\u7ef4\u62a4\u4e86 80+ \u7684\u63d2\u4ef6\u53ef\u4f9b\u7528\u6237\u4f7f\u7528\uff0c\u8bb8\u591a\u529f\u80fd\u5df2\u7ecf\u539f\u751f\u96c6\u6210\u3002\u4f46\u7531\u4e8e\u5728 Istio \u4e2d\uff0c\u4e0d\u80fd\u5bf9\u8fd9\u4e9b\u63d2\u4ef6\u8fdb\u884c\u914d\u7f6e\uff0c\u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u63d2\u4ef6\u6240\u63d0\u4f9b\u7684\u80fd\u529b\u3002\\n\\n\u4e3a\u6b64\uff0cAmesh v2.0 \u7248\u672c\u65b0\u589e\u4e86\u4e00\u4e2a\u63a7\u5236\u9762\u7ec4\u4ef6\uff0c\u5373\u524d\u6587\u63d0\u5230\u7684 `amesh-controller`\u3002\u5b83\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u914d\u7f6e APISIX \u63d2\u4ef6\u7684\u80fd\u529b\uff0c\u4f7f APISIX \u4f17\u591a\u7684\u63d2\u4ef6\u5728\u670d\u52a1\u7f51\u683c\u573a\u666f\u4e0b\u4e5f\u80fd\u5f00\u7bb1\u5373\u7528\uff0c\u800c\u65e0\u9700\u7528\u6237\u8fdb\u884c\u81ea\u5b9a\u4e49\u7684\u5f00\u53d1\u3002\\n\\n### \u5e94\u7528\u793a\u4f8b\\n\\n\u5728 Amesh v0.2 \u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b89\u88c5 `amesh-controller` \u5e76\u4f7f\u7528\u63d0\u4f9b\u7684 `AmeshPluginConfig` CRD \u6765\u8fdb\u884c APISIX \u7684\u63d2\u4ef6\u914d\u7f6e\u3002\\n\\n\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3a\u8bf7\u6c42\u7684\u54cd\u5e94\u6dfb\u52a0\u7279\u5b9a\u7684 header\uff0c\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e APISIX \u7684 `response-rewrite` \u63d2\u4ef6\u5b9e\u73b0\u3002\\n\\n\u5047\u8bbe\u6211\u4eec\u9700\u8981\u6dfb\u52a0\u7684 header \u4e3a `X-Header`\uff0c\u5176\u503c\u4e3a `AddedHeader`\uff0c\u6211\u4eec\u53ef\u4ee5\u914d\u7f6e\u5982\u4e0b\u7684 `AmeshPluginConfig`\uff0c\u6b64\u65f6\u8bf7\u6c42\u7684\u54cd\u5e94\u4e2d\u5c31\u4f1a\u5e26\u4e0a\u6211\u4eec\u6240\u9700\u7684 header\u3002\\n\\n```yaml\\napiVersion: apisix.apache.org/v1alpha1\\nkind: AmeshPluginConfig\\nmetadata:\\n  name: ampc-sample\\nspec:\\n  plugins:\\n    - name: response-rewrite\\n      config: \'{\\"headers\\": {\\"X-Header\\":\\"AddedHeader\\"}}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u968f\u7740\u4e91\u539f\u751f\u7684\u7206\u70b8\u5f0f\u53d1\u5c55\u53ca\u670d\u52a1\u7f51\u683c\u7684\u4e0d\u65ad\u4f18\u5316\uff0c\u672a\u6765\u7684\u670d\u52a1\u7f51\u683c\u53ef\u80fd\u4f1a\u5b8c\u5168\u53d6\u4ee3\u4f20\u7edf\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u6210\u4e3a\u5404\u4e2a\u4f01\u4e1a\u5fae\u670d\u52a1\u53ca\u4e91\u539f\u751f\u6539\u9020\u7684\u9996\u9009\u67b6\u6784\u3002\u867d\u7136\u73b0\u5728\u5404\u79cd\u65b9\u6848\u90fd\u8fd8\u4e0d\u592a\u5b8c\u5584\uff0c\u4f46\u6574\u4f53\u90fd\u5c5e\u4e8e\u87ba\u65cb\u4e0a\u5347\u7684\u72b6\u6001\u3002\u5f53\u7136\uff0c\u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u4e5f\u6b63\u671d\u7740\u5927\u5bb6\u5fc3\u76ee\u4e2d\u7684\u7406\u60f3\u578b\u670d\u52a1\u7f51\u683c\u89e3\u51b3\u65b9\u6848\u594b\u8fdb\uff0c\u4e5f\u6b22\u8fce\u5404\u4f4d\u5bf9 APISIX \u670d\u52a1\u7f51\u683c\u65b9\u6848\u611f\u5174\u8da3\u7684\u670b\u53cb\u4eec\u8fdb\u884c\u5c1d\u9c9c\u3002"},{"id":"\u9a6c\u8702\u7a9d\u5982\u4f55\u5229\u7528 APISIX \u7f51\u5173\u5b9e\u73b0\u5fae\u670d\u52a1\u67b6\u6784\u5347\u7ea7","metadata":{"permalink":"/zh/blog/2023/01/15/mafengwo-with-apisix","source":"@site/blog/2023/01/15/mafengwo-with-apisix.md","title":"\u9a6c\u8702\u7a9d\u5982\u4f55\u5229\u7528 APISIX \u7f51\u5173\u5b9e\u73b0\u5fae\u670d\u52a1\u67b6\u6784\u5347\u7ea7","description":"\u672c\u6587\u4ece\u9a6c\u8702\u7a9d\u7684\u5fae\u670d\u52a1\u67b6\u6784\u5e73\u53f0\u8702\u6548\u8fed\u4ee3\u8fc7\u7a0b\u548c\u5e94\u7528 APISIX \u540e\u7684\u4ea7\u54c1\u5b9e\u8df5\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u57fa\u4e8e APISIX \u7684\u7f51\u5173\u5e94\u7528\u5b9e\u4f8b\u3002","date":"2023-01-15T00:00:00.000Z","formattedDate":"2023\u5e741\u670815\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":20.185,"truncated":true,"authors":[{"name":"\u8463\u7ea2\u5e05","title":"Author","url":"https://github.com/hansedong","image_url":"https://github.com/hansedong.png","imageURL":"https://github.com/hansedong.png"}],"prevItem":{"title":"\u670d\u52a1\u7f51\u683c\u9886\u57df\u7684\u767e\u82b1\u9f50\u653e\uff0c\u662f\u5426\u5b58\u5728\u4e00\u4e2a\u66f4\u4f18\u89e3\uff1f","permalink":"/zh/blog/2023/01/18/what-is-service-mesh"},"nextItem":{"title":"\u5982\u4f55\u4f7f\u7528 Amesh \u914d\u7f6e\u63d2\u4ef6","permalink":"/zh/blog/2023/01/12/amesh-config-plugin"}},"content":"> \u672c\u6587\u4ece\u9a6c\u8702\u7a9d\u7684\u5fae\u670d\u52a1\u67b6\u6784\u5e73\u53f0\u8702\u6548\u8fed\u4ee3\u8fc7\u7a0b\u548c\u5e94\u7528 APISIX \u540e\u7684\u4ea7\u54c1\u5b9e\u8df5\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u57fa\u4e8e APISIX \u7684\u7f51\u5173\u5e94\u7528\u5b9e\u4f8b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005\uff1a[\u8463\u7ea2\u5e05](https://github.com/hansedong)\uff0c\u9a6c\u8702\u7a9d\u5fae\u670d\u52a1\u4f53\u7cfb\u5efa\u8bbe\u4ee5\u53ca\u57fa\u7840\u670d\u52a1\u80fd\u529b\u5efa\u8bbe\u4e13\u5bb6\u3002\\n\\n\u9a6c\u8702\u7a9d\u4f5c\u4e3a\u65c5\u884c\u793e\u4ea4\u5e73\u53f0\uff0c\u662f\u6570\u636e\u9a71\u52a8\u7684\u65b0\u578b\u65c5\u884c\u7535\u5546\u3002\u57fa\u4e8e\u5341\u4f59\u5e74\u7684\u5185\u5bb9\u79ef\u7d2f\uff0c\u9a6c\u8702\u7a9d\u901a\u8fc7 AI \u6280\u672f\u4e0e\u5927\u6570\u636e\u7b97\u6cd5\uff0c\u5c06\u4e2a\u6027\u5316\u65c5\u884c\u4fe1\u606f\u4e0e\u6765\u81ea\u5168\u7403\u5404\u5730\u7684\u65c5\u6e38\u4ea7\u54c1\u4f9b\u5e94\u5546\u5b9e\u73b0\u8fde\u63a5\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u4e0e\u4f17\u4e0d\u540c\u7684\u65c5\u884c\u4f53\u9a8c\u3002\\n\\n\u968f\u7740\u4e1a\u52a1\u7684\u53d1\u5c55\uff0c\u9a6c\u8702\u7a9d\u67b6\u6784\u4e5f\u5728\u8ddf\u968f\u6280\u672f\u6b65\u4f10\u8fdb\u884c\u66f4\u8fed\uff0c\u5f00\u59cb\u57fa\u4e8e Kubernetes \u8fdb\u884c\u66f4\u591a\u7684\u5ef6\u5c55\u3002\u5728\u8fd9\u4e2a\u6280\u672f\u80cc\u666f\u4e0b\uff0c\u9700\u8981\u9488\u5bf9\u4e91\u670d\u52a1\u5f00\u542f\u65b0\u4e00\u8f6e\u7684\u67b6\u6784\u66f4\u65b0\uff0c\u6bd4\u5982\uff1a\u5fae\u670d\u52a1\u573a\u666f\u5efa\u8bbe\u65b0\u7684\u8702\u6548\u5e73\u53f0\u53ca\u5468\u8fb9\u8bbe\u65bd\u6765\u652f\u6301\u8fed\u4ee3\u548c\u6d41\u91cf\u6cf3\u9053\u7684\u80fd\u529b\uff0c\u5728\u591a Kubernetes \u96c6\u7fa4\u573a\u666f\u5f15\u5165 Karmada \u5b9e\u73b0\u591a\u96c6\u7fa4\u7ba1\u7406\uff0c\u5728\u5fae\u670d\u52a1\u7f51\u5173\u9886\u57df\u5c06 Istio + Envoy \u7684\u67b6\u6784\u66ff\u6362\u4e3a Apache APISIX \u4e0e Envoy \u5171\u5b58\u7684\u5fae\u670d\u52a1\u7f51\u5173\u6a21\u5f0f\u3002\\n\\n## \u5fae\u670d\u52a1 1.0 \u6a21\u5f0f\u73b0\u72b6\\n\\n\u76ee\u524d\u9a6c\u8702\u7a9d\u5185\u90e8\u7684\u5fae\u670d\u52a1\u67b6\u6784\u7ecf\u5386\u4e86\u4e24\u6b21\u8fed\u4ee3\uff0c\u672c\u6587\u4e2d\u5c06\u9488\u5bf9\u539f\u6709\u67b6\u6784\u7684\u7b2c\u4e00\u6b21\u8c03\u6574\u5b9a\u4e49\u4e3a 1.0 \u7248\u672c\u3002\u5728\u8fdb\u884c\u5fae\u670d\u52a1 1.0 \u67b6\u6784\u7684\u642d\u5efa\u4e4b\u524d\uff0c\u6211\u4eec\u4ece\u53d1\u5e03\u7cfb\u7edf\u80fd\u529b\u3001Kubernetes \u5bb9\u5668\u3001\u670d\u52a1\u53d1\u73b0\u548c\u5fae\u670d\u52a1\u7f51\u5173\u7b49\u89d2\u5ea6\u8fdb\u884c\u4e86\u4e00\u4e9b\u8003\u91cf\u4e0e\u76ee\u6807\u5bf9\u9f50\u3002\u6bd4\u5982 Kubernetes \u7684\u5e7f\u6cdb\u5e94\u7528\uff0c\u9700\u8981\u5f00\u59cb\u8003\u8651\u57fa\u4e8e\u5bb9\u5668\u505a\u591a\u8bed\u8a00\u652f\u6301\uff0c\u5728 CI/CD \u73af\u8282\u5b9e\u73b0\u5168\u9762\u5bb9\u5668\u5316\uff0c\u5e76\u652f\u6301\u591a Kubernetes \u96c6\u7fa4\u7b49\u3002\\n\\n\u5728\u8fdb\u884c\u7b2c\u4e00\u6b21\u8fed\u4ee3\u4e4b\u524d\uff0c\u5185\u90e8\u67b6\u6784\u7684\u5fae\u670d\u52a1\u7f51\u5173\u4f7f\u7528\u7684\u662f NGINX Ingress\uff0c\u4f46\u5b83\u5176\u5b9e\u662f\u5b58\u5728\u95ee\u9898\u7684\u3002\u6bd4\u5982\u914d\u7f6e\u53d8\u66f4\u57fa\u4e8e NGINX reload\uff0c\u4f1a\u9020\u6210\u4e1a\u52a1\u6709\u635f\uff1b\u540c\u65f6\u5728\u5e94\u7528\u8303\u56f4\u5185\u4ec5\u652f\u6301\u5355 Kubernetes \u96c6\u7fa4\uff0c\u573a\u666f\u53d7\u9650\uff1b\u5185\u7f6e\u8d44\u6e90\u8fc7\u4e8e\u7b80\u5355\uff0c\u5927\u91cf\u5339\u914d\u89c4\u5219\u4f9d\u8d56 Annotations\uff0c\u914d\u7f6e\u7e41\u6742\u4e0d\u53cb\u597d\uff0c\u5c24\u5176\u662f\u5bf9\u5916\u90e8\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u652f\u6301\u5f88\u5f31\u3002\\n\\n\u56e0\u6b64\u5728\u8fdb\u884c\u5fae\u670d\u52a1 1.0 \u8fed\u4ee3\u843d\u5730\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e3a\u4e86\u6ee1\u8db3\u4e00\u4e9b\u4e1a\u52a1\u9700\u6c42\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u5982\u4e0b\u52a8\u4f5c\uff08\u9009\u53d6\u90e8\u5206\u64cd\u4f5c\u5217\u4e3e\uff09\uff1a\\n\\n* \u5728 Kubernetes \u5bb9\u5668\u5185\uff0c\u57fa\u4e8e macvlan \u6539\u9020\u5bb9\u5668\u7f51\u7edc\uff0cIDC \u673a\u623f\u7f51\u7edc\u4e0e\u4e91\u5382\u5546\u7f51\u7edc\u4e92\u901a\uff08\u5bb9\u5668\u4e92\u901a\u7684\u901a\u4fe1\u57fa\u7840\uff09\uff1b\u501f\u52a9\u7f51\u5173\u6216\u5bb9\u5668\u76f4\u8fde\u5b9e\u73b0\u670d\u52a1\u4e92\u8bbf\uff0c\u4e0d\u518d\u4f7f\u7528 Kubernetes Service\u3002\\n* \u57fa\u4e8e Kubernetes \u5bb9\u5668\u573a\u666f\u90e8\u7f72\uff1b\u57fa\u4e8e Consul \u7269\u7406\u673a\u865a\u62df\u673a\u90e8\u7f72\u3002\\n* \u589e\u52a0\u7edf\u4e00\u670d\u52a1\u53d1\u73b0\u80fd\u529b\uff0c\u57fa\u4e8e Kubernetes\u3001Consul \u5efa\u8bbe\u7edf\u4e00\u7684\u53d1\u73b0\u4e2d\u5fc3 \u2014 Atlas\uff1b\u540c\u65f6\u57fa\u4e8e Atlas \u6269\u5c55\u5fae\u670d\u52a1\u7f51\u5173\u3001Java \u751f\u6001\u3001\u76d1\u63a7\u4f53\u7cfb\u7b49\u3002\\n* \u5728\u5fae\u670d\u52a1\u7f51\u5173\u7684\u9009\u62e9\u4e0a\uff0c\u57fa\u4e8e Istio + Envoy \u67b6\u6784\u8fdb\u884c\u6784\u5efa\u3002\u5bf9 Istio \u4e2d Pilot \u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\uff0c\u5bf9\u63a5 Atlas \u53d1\u73b0\u4e2d\u5fc3\uff0c\u7531\u4e8e Atlas \u6570\u636e\u6765\u6e90\u4e8e\u591a\u5957 Kubernetes \u548c Consul\uff0c\u8fdb\u800c\u5c06\u5b9e\u4f8b\u53d1\u73b0\u4e0e Kubernetes \u96c6\u7fa4\u89e3\u8026\uff0c\u95f4\u63a5\u505a\u5230\u7f51\u5173\u5bf9\u63a5\u591a Kubernetes \u96c6\u7fa4\u7684\u80fd\u529b\uff0c\u5b9e\u73b0\u6574\u4e2a\u7f51\u5173\u52a8\u6001\u611f\u77e5\u8bc6\u522b\u7684\u53d8\u5316\u3002\\n\\n![\u8702\u6548 1.0 \u5fae\u670d\u52a1\u7f51\u5173\u67b6\u6784](https://static.apiseven.com/uploads/2023/01/17/jydzEiWC_image%20%2837%29.png)\\n\\n### \u75db\u70b9\u68b3\u7406\\n\\n\u5728\u5fae\u670d\u52a1 1.0 \u7684\u8fd9\u5957\u67b6\u6784\u4e2d\uff0c\u5b9e\u8df5\u4e0b\u6765\u8fd8\u662f\u5b58\u5728\u4e00\u4e9b\u75db\u70b9\u3002\\n\\n\u9996\u5148\u662f\u5728\u53d1\u5e03\u7cfb\u7edf\u80fd\u529b\u65b9\u9762\uff0c\u5fae\u670d\u52a1 1.0 \u4e2d\u7684\u53d1\u5e03\u7cfb\u7edf\uff0c\u4ec5\u4ec5\u662f\u4e00\u4e2a\u53d1\u5e03\u7cfb\u7edf\uff0c\u65e0\u6cd5\u6709\u6548\u878d\u5408\u9879\u76ee\u9700\u6c42\u7684\u7ba1\u7406\uff08\u53d1\u5e03\u4e5f\u662f\u5ea6\u91cf\u7684\u4e00\u73af\uff09\uff1b\u540c\u65f6\u8fd9\u5957\u53d1\u5e03\u7cfb\u7edf\u57fa\u4e8e PHP \u6784\u5efa\uff0c\u65e0\u6cd5\u5f88\u597d\u5730\u652f\u6301\u81ea\u52a8\u5316\u6eda\u52a8\u90e8\u7f72\u3001\u591a\u7248\u672c\u6eda\u52a8\u90e8\u7f72\u5bb9\u91cf\u53d8\u66f4\u7b49\u8f83\u4e3a\u590d\u6742\u7684\u90e8\u7f72\u573a\u666f\uff1b\u5f53\u591a\u4eba\u5bf9\u540c\u4e00\u4e2a\u9879\u76ee\u5f00\u53d1\uff0c\u6216\u4e00\u4e2a\u9700\u6c42\u5173\u8054\u591a\u4e2a\u9879\u76ee\u65f6\uff0c\u7f3a\u5c11\u673a\u5236\u8ba9\u6d41\u91cf\u5728\u540c\u4e00\u4e2a\u8fed\u4ee3\u4e2d\u81ea\u52a8\u4e32\u8054\uff08\u6d41\u91cf\u6cf3\u9053\uff09\u3002\u540c\u65f6\u5bf9\u591a Kubernetes \u96c6\u7fa4\u7ba1\u7406\u5e76\u4e0d\u65b9\u4fbf\uff0c\u5f53 Kubernetes \u4e0b\u7ebf\u65f6\u9700\u8981\u4e1a\u52a1\u4fa7\u53c2\u4e0e\uff0c\u7ed9\u4e1a\u52a1\u7ebf\u5e26\u6765\u4e86\u65f6\u95f4\u6210\u672c\u7b49\u3002\\n\\n\u5176\u6b21\u5c31\u662f\u5fae\u670d\u52a1\u7f51\u5173\u67b6\u6784\u5c42\u9762\u3002\u524d\u6587\u4e5f\u63d0\u5230\u4e86 1.0 \u67b6\u6784\u4e0b\u7f51\u5173\u662f\u57fa\u4e8e Istio+Envoy \u5bf9 Pilot \u505a\u4e86\u4e8c\u6b21\u5f00\u53d1\uff0c\u4e3b\u8981\u662f\u5bf9\u63a5 Atlas \u53d1\u73b0\u4e2d\u5fc3\u3002\u968f\u7740\u4e1a\u52a1\u7684\u5e94\u7528\u6570\u91cf\u8d8a\u6765\u8d8a\u591a\uff0c\u8bbf\u95ee\u89c4\u5219\u4e5f\u8d8a\u6765\u8d8a\u591a\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6211\u4eec\u7ebf\u4e0a\u7684\u7f51\u5173\u751f\u6548\u5ef6\u8fdf\u4e5f\u8d8a\u6765\u8d8a\u9ad8\u3002\u5728\u6d41\u91cf\u5dc5\u5cf0\u72b6\u6001\u4e0b\uff0c\u5927\u6982\u6709 15 \u79d2\u5de6\u53f3\u7684\u5ef6\u8fdf\u3002\u8fd9\u4e2a\u5ef6\u8fdf\u4e3b\u8981\u6765\u81ea\u4e8e CRD \u8d44\u6e90\uff0c\u51e0\u4e4e\u5168\u90fd\u5728\u76f8\u540c\u7684 namespace \u4e0b\uff0c\u540c\u65f6\u4e0a\u4e0b\u7ebf\u65f6\u4f1a\u89e6\u53d1\u5168\u91cf\u66f4\u65b0\u5bfc\u81f4\u5ef6\u8fdf\u8f83\u9ad8\u3002\\n\\n\u800c\u5728\u65e9\u671f\u7684\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0cEnvoy \u5728\u6570\u636e\u5168\u91cf\u63a8\u9001\u8fc7\u7a0b\u4e2d\u8fd8\u4f1a\u51fa\u73b0\u94fe\u63a5\u4e2d\u65ad\u7684\u72b6\u51b5\uff0c\u9020\u6210 `503` \u95ee\u9898\u7684\u4ea7\u751f\u3002\u9664\u6b64\u4e4b\u5916\uff0cEnvoy \u8fd8\u5b58\u5728\u4f7f\u7528\u5185\u5b58\u6301\u7eed\u589e\u957f\u5bfc\u81f4 OOM \u7684\u60c5\u51b5\uff0c\u5f53\u7f51\u5173\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u5bf9 Envoy \u548c Pilot \u8fdb\u884c\u6392\u9519\u7684\u6210\u672c\u8f83\u9ad8\u3002\u5f53\u4f7f\u7528\u4e00\u4e9b\u9ad8\u9636\u914d\u7f6e\u65f6\uff0c\u9700\u8981\u501f\u52a9 Envoy Filter \u5b9e\u73b0\uff0c\u5176\u4e0a\u624b\u95e8\u69db\u8f83\u9ad8\uff0c\u5bf9\u4e8e\u60f3\u7b80\u5355\u5b9e\u73b0\u7194\u65ad\u3001\u9650\u6d41\u3001Auth \u9274\u6743\u7b49\u529f\u80fd\u800c\u8a00\uff0c\u6210\u672c\u8f83\u9ad8\u3002\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u4e24\u4e2a\u793e\u533a\uff08Istio \u548c Envoy\uff09\u7684\u53d1\u5c55\u901f\u5ea6\u5f88\u5feb\uff0c\u8fd9\u4e5f\u5bfc\u81f4\u6211\u4eec\u7684\u67b6\u6784\u6bd4\u8f83\u96be\u8ddf\u8fdb\u4e0a\u6e38\u793e\u533a\u7684\u53d1\u5c55\u3002\\n\\n## \u57fa\u4e8e APISIX \u7684\u5fae\u670d\u52a1 2.0 \u6a21\u5f0f\\n\\n### \u65b0\u5e73\u53f0\u4e0e\u65b0\u67b6\u6784\\n\\n\u9762\u5bf9 1.0 \u67b6\u6784\u4e0b\u5b58\u5728\u7684\u75db\u70b9\u4e0e\u95ee\u9898\uff0c\u5185\u90e8\u5bf9\u4e8e\u8fd9\u5957\u5fae\u670d\u52a1\u67b6\u6784\u8fdb\u884c\u4e86\u518d\u6b21\u8fed\u4ee3\uff0c\u6765\u5230\u4e86 2.0 \u65f6\u4ee3\u30022.0 \u67b6\u6784\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u65b0\u589e\u4e86\u4e00\u5957\u53d1\u5e03\u5e73\u53f0\u2014\u2014\u8702\u6548\u5e73\u53f0\u3002\\n\\n\u8702\u6548\u5e73\u53f0\u91cd\u70b9\u7a81\u51fa\u4e86\u4ee5\u4e0b\u80fd\u529b\uff1a\\n\\n* \u878d\u5408\u4e86\u9700\u6c42\u7ba1\u7406\uff0c\u652f\u6301\u4e86\u8fed\u4ee3\u90e8\u7f72\u80fd\u529b\uff0c\u4f7f\u5f97\u53d1\u5e03\u7cfb\u7edf\u53ef\u4ee5\u589e\u76ca\u5ea6\u91cf\u3002\\n* \u5c06\u5bb9\u5668\u90e8\u7f72\u548c\u673a\u5668\u90e8\u7f72\uff08\u7269\u7406\u673a\u90e8\u7f72\uff09\u5728\u4ea7\u54c1\u80fd\u529b\u4e0a\u8fdb\u884c\u4e86\u7edf\u4e00\u3002\\n* \u589e\u5f3a\u4e86\u7cbe\u7ec6\u5316\u7684\u6d41\u91cf\u7ba1\u7406\u80fd\u529b\u3001\u56de\u6eda\u80fd\u529b\uff08\u56de\u6eda\u7b56\u7565\uff1a\u6279\u6b21\u3001\u5b9e\u4f8b\u6570\u3001\u95f4\u9694\u7b49\uff09\\n* \u4e0e Java \u751f\u6001\u878d\u5408\u5171\u5efa\uff0c\u652f\u6301\u4e86\u6d41\u91cf\u6cf3\u9053\u80fd\u529b\uff0c\u73af\u5883\u6d41\u91cf\u9694\u79bb\u3002\\n* \u7f51\u5173\u57fa\u4e8e APISIX \u8fdb\u884c\u91cd\u6784\uff0c\u89e3\u51b3 Envoy OOM \u53ca\u89c4\u5219\u751f\u6548\u5ef6\u8fdf\u8f83\u9ad8\u7684\u540c\u65f6\uff0c\u901a\u8fc7 APISIX \u4ea7\u54c1\u5316\u80fd\u529b\u964d\u4f4e\u4e86\u95ee\u9898\u6392\u9519\u6210\u672c\uff0c\u964d\u4f4e\u4e86\u6269\u5c55\u548c\u914d\u7f6e\u7f51\u5173\u7684\u4e0a\u624b\u95e8\u69db\u3002\\n\\n\u5728\u8702\u6548\u5e73\u53f0\u4ea7\u54c1\u4fa7\u4e2d\uff0c\u6211\u4eec\u5c06\u9700\u6c42\u7ba1\u7406\u4e0e\u8fed\u4ee3\u90e8\u7f72\u5173\u8054\u7ed3\u5408\uff0c\u5e76\u4e14\u4e3a\u4e86\u652f\u6301\u4e86\u591a\u79cd\u8fed\u4ee3\u6d41\u6c34\u7ebf\u6a21\u5f0f\u3002\u5728\u6d41\u91cf\u7ba1\u7406\u65b9\u9762\uff0c\u6211\u4eec\u501f\u52a9 Atlas Instance \u6a21\u578b\u4e2d\u7684 env \u5c5e\u6027\u4ee5\u53ca\u6269\u5c55\u5c5e\u6027\uff0c\u5b9e\u73b0\u4e86\u6d41\u91cf\u6cf3\u9053\u80fd\u529b\u3002\u57fa\u4e8e\u6d41\u91cf\u6cf3\u9053\u6a21\u578b\uff0c\u5728\u4e0a\u5c42\u4ea7\u54c1\u4fa7\u6784\u5efa\u8fed\u4ee3\u6d41\u91cf\u73af\u5883\u8c03\u7528\u94fe\u8def\u9694\u79bb\u3002\\n\\n![\u89c4\u5212\u8702\u6548 2.0 ](https://static.apiseven.com/uploads/2023/01/17/FmMR3bfp_image%20%2838%29.png)\\n\\n\u5728\u5468\u8fb9\u751f\u6001\u5efa\u8bbe\u65b9\u9762\uff0cJava SDK \u4fa7\u505a\u5230\u4e86\u5e94\u7528\u5728\u8fed\u4ee3\u73af\u5883\u4e2d\u53ef\u4ee5\u5b9e\u73b0\u9694\u79bb\u7684\u94fe\u8def\u8c03\u7528\uff0c\u7f51\u5173\u4fa7\u4e5f\u8fdb\u884c\u4e86\u7c7b\u4f3c\u7684\u64cd\u4f5c\u3002\u53ea\u662f\u7f51\u5173\u4fa7\u4f5c\u4e3a\u6574\u4e2a\u6d41\u91cf\u7684\u5165\u53e3\uff0c\u6211\u4eec\u662f\u901a\u8fc7 Cookie \u7684\u89c4\u5219\uff0c\u4e5f\u5c31 Cookie \u7684\u65b9\u5f0f\u8fdb\u884c\u914d\u7f6e\u7684\u3002\u57fa\u7ebf\u73af\u5883\u7684\u6d41\u91cf\u53ea\u80fd\u5230\u8fbe\u57fa\u7ebf\u73af\u5883\u7684\u7248\u672c\u4e2d\uff0c\u8fed\u4ee3\u73af\u5883\u7684\u6d41\u91cf\u5c31\u4f1a\u8f6c\u53d1\u5230\u8fed\u4ee3\u7684\u7248\u672c\u4e0a\u53bb\u3002\\n\\n![v1 \u4e0e v2 \u7248\u672c\u7684\u6d41\u91cf\u5206\u914d](https://static.apiseven.com/uploads/2023/01/17/QCn1I0Gh_%E6%B5%81%E7%A8%8B%E5%9B%BE%20%283%29%20%281%29.jpg)\\n\\n\u540c\u65f6\u5728\u90e8\u7f72\u5c42\u7684 Kubernetes \u591a\u96c6\u7fa4\u7ba1\u7406\u5c42\u9762\uff0c\u6211\u4eec\u5219\u501f\u52a9 Karmada \u5b9e\u73b0\u4e86\u4e00\u4e2a\u591a Kubernetes \u96c6\u7fa4\u7684\u7ba1\u7406\u3002\u5728\u6574\u4e2a\u67b6\u6784\u4e2d\uff08\u5982\u4e0b\u56fe\u6240\u793a\uff09\uff0c\u5e95\u5c42\u7684\u80fd\u529b\u4e3b\u8981\u662f\u7531 Kubernetes \u591a\u96c6\u7fa4\u548c\u6d41\u91cf\u7f51\u5173 Envoy \u4e0e APISIX\u3001\u53d1\u73b0\u4e2d\u5fc3 Atlas\u3001\u65e5\u5fd7\u670d\u52a1\u4e0e\u76d1\u63a7\u670d\u52a1\u7b49\u7ec4\u6210\u3002\\n\\n\u800c\u8702\u6548\u5e73\u53f0\u5728\u6574\u4e2a\u67b6\u6784\u4e2d\u4e3b\u8981\u662f\u8fdb\u884c\u914d\u7f6e\u7ba1\u7406\u3001\u6784\u5efa\u90e8\u7f72\u3001\u6269\u7f29\u5bb9\u548c\u4e0a\u4e0b\u7ebf\u7b49\u7b49\uff0c\u540c\u65f6\u5305\u542b\u4efb\u52a1\u6d41\u7684\u6a21\u5757\u3002\u6700\u4e0a\u65b9\u5219\u662f\u5e94\u7528\u5e02\u573a\u7684\u4e00\u4e9b\u80fd\u529b\uff0c\u6bd4\u5982\u8fed\u4ee3\u80fd\u529b\u548c\u63d2\u4ef6\u80fd\u529b\u7b49\u3002\\n\\n![\u8702\u6548\u5e73\u53f0 2.0 \u67b6\u6784\u56fe](https://static.apiseven.com/uploads/2023/01/17/luSFWibx_%E6%B5%81%E7%A8%8B%E5%9B%BE%20%284%29.jpg)\\n\\n\u6574\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u57fa\u4e8e\u5e94\u7528\u4e2d\u5fc3\u548c\u670d\u52a1\u6253\u9020\u51fa\u4e86 2.0 \u65b0\u67b6\u6784\u3002\u8fd9\u5957\u65b0\u67b6\u6784\u5728 Kubernetes \u96c6\u7fa4\u53d1\u751f\u53d8\u66f4\u65f6\uff0c\u53ef\u901a\u8fc7 PropagationPolicy\u3001OveridePolicy \u7b49\u7b56\u7565\uff0c\u5b9e\u73b0 Deployment \u7b49\u5728 Kubernetes \u96c6\u7fa4\u7ea7\u522b\u7684\u8d44\u6e90\u5206\u53d1\uff0c\u51cf\u5c11\u96c6\u7fa4\u53d8\u66f4\u65f6\u4e1a\u52a1\u53c2\u4e0e\u7684\u6210\u672c\uff0c\u51cf\u8f7b\u4e86\u4e1a\u52a1\u7814\u53d1\u4fa7\u7684\u4e00\u4e9b\u538b\u529b\u3002\\n\\n### \u7f51\u5173\u9009\u578b\\n\\n\u5728 2.0 \u6a21\u5f0f\u7684\u67b6\u6784\u4e2d\uff0c\u6d41\u91cf\u7f51\u5173\u6211\u4eec\u63d0\u5230\u4e86\u4e24\u4e2a\u7f51\u5173\u4ea7\u54c1\uff0c\u5373 Envoy \u4e0e APISIX\u3002Envoy \u4f5c\u4e3a\u4e4b\u524d 1.0 \u7248\u672c\u7684\u9009\u62e9\uff0c\u6211\u4eec\u5e76\u6ca1\u6709\u5b8c\u5168\u653e\u5f03\uff0c\u5728 2.0 \u4e2d\u6211\u4eec\u4e5f\u56e0\u4e3a\u4e00\u4e9b\u9700\u6c42\u548c\u4ea7\u54c1\u671f\u671b\uff0c\u5f00\u59cb\u8003\u8651\u65b0\u7684\u7f51\u5173\u4ea7\u54c1\u8fdb\u884c\u66ff\u4ee3\uff0c\u6bd4\u5982\uff1a\\n\\n* \u8bbf\u95ee\u89c4\u5219\u53d8\u5316\u65f6\uff0c\u7f51\u5173\u7684\u751f\u6548\u901f\u5ea6\u9700\u8981\u63a7\u5236\u5728\u6beb\u79d2\u7ea7\uff08\u751f\u6548\u6162\uff0c\u4f1a\u5bfc\u81f4\u7f51\u5173\u751f\u6548\u901f\u5ea6\u4e0d\u4e00\uff0c\u5728\u4f7f\u7528\u4e86 CDN \u573a\u666f\u4e0b\u53ef\u80fd\u5bfc\u81f4\u4e1a\u52a1\u8d44\u6e90\u957f\u65f6\u95f4 404\uff09\u3002\\n* \u53ef\u5728\u73b0\u6709\u573a\u666f\u4e2d\uff0c\u5b8c\u5168\u66ff\u6362 Istio+Envoy \u67b6\u6784\uff1b\u540c\u65f6\u652f\u6301 HTTP\u3001gRPC\uff0c\u5e76\u517c\u5bb9\u73b0\u6709\u8def\u7531\u7b56\u7565\u3002\\n* \u9700\u8981\u964d\u4f4e\u95ee\u9898\u7684\u6392\u67e5\u6210\u672c\uff0c\u6700\u597d\u6709\u4ea7\u54c1\u5316\u652f\u6301\uff08\u5982 Dashboard\uff09\u3002\\n* \u4ea7\u54c1\u8db3\u591f\u7a33\u5b9a\uff0c\u793e\u533a\u6d3b\u8dc3\uff0c\u529f\u80fd\u5f3a\uff08\u5bf9\u9650\u6d41\u7b49\u573a\u666f\u652f\u6301\uff09\u3002\\n* \u4e0d\u9700\u8981\u4e8c\u6b21\u5f00\u53d1\u5373\u53ef\u652f\u6301\u516c\u53f8\u73b0\u6709\u67b6\u6784\u7684\u66ff\u6362\u3002\\n* \u5728\u66ff\u6362 Istio+Envoy \u67b6\u6784\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u4fdd\u6301\u53cc\u67b6\u6784\u53ef\u7528\uff08Istio\u3001Envoy \u4e0e\u65b0\u7f51\u5173\u5e76\u5b58\uff09\uff0c\u5982\u679c\u65b0\u67b6\u6784\u6709\u95ee\u9898\u53ef\u5feb\u901f\u56de\u9000\u81f3\u539f\u6765\u65b9\u6848\u3002\\n\\n\u5728\u8c03\u7814\u4e86\u4e00\u4e9b\u5173\u952e\u7f51\u5173\u4ea7\u54c1\u7684\u6a21\u578b\u4e4b\u540e\uff0c\u6211\u4eec\u6700\u7ec8\u5c06\u65b9\u6848\u9501\u5b9a\u5728\u4e86 Apache APISIX\u3002APISIX \u7684\u67b6\u6784\u4e5f\u5206\u4e3a\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\uff0c\u540c\u65f6\u8fd8\u9644\u5e26 Dashboard \u4ea7\u54c1\u3002\u5728\u529f\u80fd\u4f7f\u7528\u4e0a\uff0cAPISIX \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u63d2\u4ef6\uff0c\u6bd4\u5982\u9650\u6d41\u3001\u7194\u65ad\u3001\u65e5\u5fd7\u5b89\u5168\u548c\u76d1\u63a7\u7b49\u7b49\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 APISIX \u7684 Admin API \u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u53bb\u5b8c\u6574\u64cd\u4f5c APISIX \u7684\u6240\u6709\u80fd\u529b\uff0c\u6bd4\u5982 Upstream\u3001Consumer \u8fd8\u6709\u5404\u79cd\u63d2\u4ef6\u7b49\u3002\u5bf9\u6211\u4eec\u800c\u8a00\uff0cAPISIX \u8fd8\u6709\u4e00\u4e2a\u7279\u522b\u6709\u4f18\u52bf\u7684\u70b9\uff0c\u5c31\u662f APISIX \u5728\u5347\u7ea7\u65f6\uff0c\u80fd\u591f\u505a\u5230\u5bf9\u4f4e\u7248\u672c\u7684 API \u8fdb\u884c\u7edf\u4e00\u7684\u517c\u5bb9\u3002\\n\\n![APISIX \u67b6\u6784](https://static.apiseven.com/uploads/2023/01/17/RxOc4qk7_image%20%2840%29.png)\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u8ba4\u4e3a APISIX \u8fd8\u6709\u4ee5\u4e0b\u51e0\u4e2a\u4f18\u52bf\uff1a\\n\\n* APISIX \u57fa\u4e8e Openresty \u7684\u6027\u80fd\u5f88\u597d\uff0c\u76f8\u6bd4 Envoy \u6765\u8bf4\uff0c\u6027\u80fd\u635f\u8017\u5f88\u5c11\u3002\u5728\u7ecf\u8fc7\u6211\u4eec\u6d4b\u8bd5\u4e4b\u540e\uff0c\u5728 QPS \u7684\u8868\u73b0\u4e0a\uff0cAPISIX \u635f\u8017 3%\uff0c\u800c Envoy \u635f\u8017 16%\uff1b\u5728\u65f6\u5ef6\u8868\u73b0\u4e0a\uff0cAPISIX \u5e73\u5747\u8f6c\u53d1\u8017\u65f6 2ms\uff0c\u800c Envoy \u8017\u65f6 7ms\u3002\u6570\u636e\u7684\u4f53\u73b0\uff0c\u5df2\u7ecf\u5c55\u793a\u4e86 APISIX \u5728\u6027\u80fd\u4e0a\u7684\u5353\u8d8a\u4f18\u52bf\u3002\\n* APISIX \u8fd8\u9644\u6709 Dashboard \u652f\u6301\uff0c\u5bf9\u4e8e\u8def\u7531\u5339\u914d\u5f02\u5e38\u7b49\u573a\u666f\u53ef\u5feb\u901f\u5224\u65ad\u662f\u5426\u4e3a\u89c4\u5219\u914d\u7f6e\u9519\u8bef\u3002\\n* \u4f5c\u4e3a\u5f00\u6e90\u4ea7\u54c1\uff0cAPISIX \u7684\u793e\u533a\u66f4\u4e3a\u6d3b\u8dc3\u3002\u5728\u4ea7\u54c1\u7684\u529f\u80fd\u4e0a\uff0c\u5728\u9650\u6d41\u3001\u9274\u6743\u3001\u76d1\u63a7\u7b49\u65b9\u9762\u76f8\u6bd4 Envoy \u6210\u672c\u66f4\u4f4e\uff0c\u652f\u6301\u6027\u66f4\u597d\u3002\\n* APISIX \u76f8\u6bd4 Envoy \u5185\u5b58\u5360\u7528\u5f88\u4f4e\uff0c\u4f46\u5728\u914d\u7f6e\u7684\u52a8\u6001\u53d8\u66f4\u4e0a\u76f8\u6bd4 Envoy \u8981\u5f31\uff08Envoy \u51e0\u4e4e\u5927\u90e8\u5206\u914d\u7f6e\u53ef\u52a8\u6001\u4e0b\u53d1\uff09\uff0c\u4f46\u4e5f\u8db3\u591f\u6ee1\u8db3\u9700\u6c42\u3002\\n\\n\u56e0\u6b64\uff0c\u5728\u8c03\u7814\u4e0e\u6d4b\u8bd5\u4e4b\u540e\uff0c\u6211\u4eec\u5728\u5fae\u670d\u52a1 2.0 \u7684\u67b6\u6784\u4e0b\u589e\u6dfb\u4e86 Apache APISIX \u4f5c\u4e3a\u6d41\u91cf\u7f51\u5173\u52a0\u5165\u3002\u7531\u4e8e\u7f51\u5173\u662f\u6574\u4e2a\u5fae\u670d\u52a1\u6d41\u91cf\u7684\u6838\u5fc3\uff0c\u5982\u679c\u4ece\u4e00\u5957\u65e7\u67b6\u6784\u5207\u6362\u5230\u4e00\u5957\u65b0\u7684\u67b6\u6784\uff0c\u5176\u5b9e\u6210\u672c\u662f\u6bd4\u8f83\u9ad8\u7684\u3002\u6240\u4ee5\u6211\u4eec\u5e0c\u671b\u5fae\u670d\u52a1\u7684\u7f51\u5173\u89c4\u5219\u53d8\u5316\u80fd\u591f\u5bf9\u65b0\u65e7\u4e24\u5957\u7f51\u5173\uff08Envoy \u4e0e APISIX\uff09\u540c\u65f6\u751f\u6548\uff0c\u4e5f\u5c31\u662f\u4e00\u5957\u914d\u7f6e\u53ef\u4ee5\u9002\u7528\u4e8e\u4e24\u79cd\u67b6\u6784\uff0c\u56e0\u6b64\u6211\u4eec\u5728 2.0 \u67b6\u6784\u4e2d\uff0c\u9488\u5bf9\u8fd9\u4e9b\u53d8\u52a8\u505a\u4e86\u4e00\u4e9b\u8c03\u6574\u3002\\n\\n### \u843d\u5730\u65b9\u6848\u4e0e\u5b9e\u8df5\u95ee\u9898\\n\\n\u9996\u5148\u8003\u8651\u5230\u6210\u672c\u95ee\u9898\uff0c\u5bf9\u539f\u672c\u7684 Istio \u67b6\u6784\u4fdd\u6301\u4e0d\u53d8\uff0c\u5e76\u672a\u8fdb\u884c\u6539\u9020\u3002\u540c\u65f6\u5728\u7f51\u5173\u67b6\u6784\u4e2d\uff0c\u5f15\u5165\u4e86\u65b0\u5f00\u53d1\u7684\u5173\u952e\u7ec4\u4ef6\u2014\u2014 **istio-apisix-translator**\u3002\\n\\nistio-apisix-translator \u4e3b\u8981\u662f\u53bb\u5bf9\u63a5 Atlas \u53d1\u73b0\u4e2d\u5fc3\u4ee5\u53ca Istio \u7684 CRD \u6570\u636e\u3002\u4f5c\u4e3a\u6570\u636e\u540c\u6b65\u670d\u52a1\uff0c\u5b9e\u65f6\u5c06 VirtualService\u3001DestinationRule \u7b49\u89c4\u5219\u53d8\u5316\u8f6c\u6362\u4e3a APISIX \u8def\u7531\u89c4\u5219\uff0c\u5c06 Atlas Instance \u6570\u636e\u5b9e\u65f6\u8f6c\u6362\u4e3a APISIX Upstream \u89c4\u5219\u7b49\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u901a\u8fc7\u8fd9\u6837\u4e00\u4e2a\u670d\u52a1\u7ec4\u4ef6\uff0c\u5b9e\u73b0\u4e86\u5bf9 Atlas \u4ee5\u53ca Istio CRD \u7684\u6570\u636e\u652f\u6301\u3002\\n\\n\u501f\u52a9\u8fd9\u79cd\u67b6\u6784\uff0c\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\u5bf9\u4e24\u79cd\u7f51\u5173\u7684\u5b8c\u6574\u652f\u6301\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![\u8702\u6548 2.0 \u5fae\u670d\u52a1\u7f51\u5173\u67b6\u6784](https://static.apiseven.com/uploads/2023/01/17/Ai05UtVk_image%20%2841%29.png)\\n\\n\u7f51\u5173\u67b6\u6784\u7684\u6838\u5fc3\u90e8\u5206\u5219\u662f\u56fe\u4e2d\u6700\u4e0b\u65b9\u7684 APISIX\uff0c\u4e0a\u5c42\u7684 istio-apisix-translator \u5219\u5145\u5f53\u7c7b\u4f3c Istio \u67b6\u6784\u4e2d\u7684 Pilot \u89d2\u8272\uff0c\u5c06 Instance \u4e0e CR \u6570\u636e\u6574\u5408\u540e\uff0c\u501f\u7531 APISIX Admin API \u63a8\u9001\u81f3 APISIX \u4e2d\uff0c\u5b9e\u4f8b\u5219\u662f\u5bf9\u63a5\u5230\u5185\u90e8\u4e1a\u52a1\u7684 Atlas \u53d1\u73b0\u4e2d\u5fc3\u3002\u56e0\u6b64\uff0c\u65e0\u8bba\u662f\u8bbf\u95ee\u89c4\u5219\u53d1\u751f\u53d8\u5316\u8fd8\u662f Atlas \u7684\u6570\u636e\u6e90\u53d1\u751f\u53d8\u5316\uff0c\u90fd\u53ef\u4ee5\u5c06\u8fd9\u4efd\u6570\u636e\u53d8\u5316\u8f6c\u6362\u6210 APISIX \u7684\u6570\u636e\u63a8\u5230 APISIX \u4e2d\u3002\u76ee\u524d\u5168\u94fe\u8def\u90fd\u662f\u57fa\u4e8e Watch \u673a\u5236\u4fdd\u8bc1\u6570\u636e\u53d8\u5316\u7684\u5b9e\u65f6\u5904\u7406\uff0c\u56e0\u6b64\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e0b\uff0c\u57fa\u672c\u53ef\u4ee5\u8fbe\u5230\u6570\u636e\u53d8\u5316\u7684\u6beb\u79d2\u7ea7\u751f\u6548\u3002\\n\\n**\u5f53\u7136\uff0c\u5728\u4f7f\u7528 APISIX \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u9047\u5230\u4e86\u51e0\u5904\u95ee\u9898\u3002\u4f46\u5747\u5df2\u89e3\u51b3\u5e76\u5c06\u7ed3\u679c\u540c\u6b65\u7ed9\u4e86\u793e\u533a\u8fdb\u884c\u53cd\u9988\u3002**\\n\\n\u7b2c\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u5728 APISIX \u4f7f\u7528\u8bc1\u4e66\u5bf9\u63a5 etcd \u65f6\uff0c\u5982\u679c APISIX \u8282\u70b9\u8f83\u591a\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4 APISIX Admin API \u63a5\u53e3\u54cd\u5e94\u975e\u5e38\u6162\u3002\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u76ee\u524d etcd \u5b58\u5728\u4e00\u4e2a\u5173\u4e8e HTTP/2 \u7684 BUG\u3002\u5982\u679c\u901a\u8fc7 HTTPS \u64cd\u4f5c etcd\uff08HTTP \u4e0d\u53d7\u5f71\u54cd\uff09\uff0cHTTP/2 \u7684\u8fde\u63a5\u6570\u4e0a\u9650\u4e3a Golang \u9ed8\u8ba4\u7684 250 \u4e2a\u3002\u800c APISIX \u7684\u63a7\u5236\u9762\u548c Istio \u67b6\u6784\u7684\u63a7\u5236\u9762\u6709\u533a\u522b\uff0cAPISIX \u8282\u70b9\u662f\u76f4\u8fde etcd\uff0c\u5f53 APISIX \u6570\u636e\u9762\u8282\u70b9\u6570\u8f83\u591a\u65f6\uff0c\u4e00\u65e6\u6240\u6709 APISIX \u8282\u70b9\u4e0e etcd \u8fde\u63a5\u6570\u8d85\u8fc7\u8fd9\u4e2a\u4e0a\u9650\uff0c\u5219 APISIX \u7684\u63a5\u53e3\u54cd\u5e94\u4f1a\u975e\u5e38\u7684\u6162\u3002\\n\\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u4e5f\u5728 etcd \u548c APISIX \u7684\u793e\u533a\u5747\u8fdb\u884c\u4e86\u53cd\u9988\uff0c\u540e\u7eed\u4e5f\u901a\u8fc7\u5347\u7ea7\u7248\u672c\uff08etcd 3.4 \u5347\u7ea7\u5230 3.4.20 \u53ca\u4ee5\u4e0a\uff0cetcd 3.5 \u5347\u7ea7\u5230 3.5.5 \u53ca\u4ee5\u4e0a\uff09\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u540c\u65f6\u6211\u4eec\u4e5f\u5df2\u5c06\u8fd9\u4e2a\u7ed3\u679c\u540c\u6b65\u5230\u4e86 APISIX \u793e\u533a\u5b98\u7f51 Q&A \u6587\u6863\u4e2d\uff0c\u65b9\u4fbf\u540e\u7eed\u7528\u6237\u9047\u5230\u540c\u6837\u95ee\u9898\u65f6\uff0c\u53ef\u4ee5\u6709\u6240\u53c2\u8003\u3002\\n\\n\u7b2c\u4e8c\u4e2a\u95ee\u9898\u5c31\u662f\u5728\u4f7f\u7528 APISIX \u7684\u8fc7\u7a0b\u4e2d\u4f1a\u9047\u5230\u6027\u80fd\u6296\u52a8\u7684\u95ee\u9898\u3002\\n\\n\u9996\u5148\u662f\u4f1a\u51fa\u73b0 `499` \u54cd\u5e94\u6296\u52a8\uff0c\u8fd9\u4e2a\u95ee\u9898\u4e3b\u8981\u51fa\u73b0\u5728\u8fde\u7eed\u4e24\u6b21\u4ee5\u4e0a\u8fc7\u5feb\u7684 post \u8bf7\u6c42\uff08\u4e5f\u4e0d\u6b62 post\uff09\u7684\u573a\u666f\u4e0b\u3002\u8fd9\u79cd\u60c5\u51b5\u662f NGINX \u8ba4\u5b9a\u4e3a\u4e0d\u5b89\u5168\u7684\u8fde\u63a5\uff0c\u5219\u4e3b\u52a8\u65ad\u5f00\u4e86\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002\u4e3a\u4e86\u5904\u7406\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ea\u9700\u5c06 `proxy_ignore_client_abort` \u7684\u914d\u7f6e\u8c03\u6574\u4e3a on \u5373\u53ef\u3002\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u5f53 APISIX Admin API \u63a5\u53e3\u8bf7\u6c42\u5bc6\u96c6\u65f6\uff0c\u4e5f\u4f1a\u51fa\u73b0 APISIX \u6570\u636e\u9762\u5c11\u90e8\u5206\u54cd\u5e94\u8d85\u65f6\u7684\u72b6\u51b5\u3002\u8fd9\u4e2a\u4e3b\u8981\u662f\u56e0\u4e3a istio-apisix-translator \u5728\u91cd\u542f\u65f6\uff0c\u4f1a\u5c06 Atlas\u3001Istio CR \u6570\u636e\u805a\u5408\uff0c\u5168\u91cf\u540c\u6b65\u81f3 APISIX \u4e2d\uff0c\u5927\u91cf\u8bf7\u6c42\u5f15\u53d1 APISIX \u6570\u636e\u53d8\u66f4\uff0cAPISIX \u6570\u636e\u9762\u5bc6\u96c6\u7684\u540c\u6b65\u53d8\u66f4\u5bfc\u81f4\u5c0f\u90e8\u5206\u54cd\u5e94\u8d85\u65f6\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u5f15\u5165\u534f\u7a0b\u6c60\u548c\u4ee4\u724c\u6876\u9650\u6d41\uff0c\u51cf\u5c11 APISIX \u6570\u636e\u5bc6\u96c6\u53d8\u66f4\u7684\u573a\u666f\u6765\u5e94\u5bf9\u6b64\u95ee\u9898\u3002\\n\\n## \u603b\u7ed3\u4e0e\u53d1\u5c55\\n\\n\u9a6c\u8702\u7a9d\u5f53\u524d\u662f\u57fa\u4e8e Kubernetes \u5bb9\u5668\u90e8\u7f72\u4ee5\u53ca\u57fa\u4e8e Consul \u7684\u673a\u5668\u90e8\u7f72\u573a\u666f\uff0c\u81ea\u5efa Atlas \u670d\u52a1\u53d1\u73b0\u4e2d\u5fc3\uff0c\u540c\u65f6\uff0c\u5728 Java \u751f\u6001\u3001\u5fae\u670d\u52a1\u7f51\u5173\uff0c\u5fae\u670d\u52a1\u4f53\u7cfb\u7684\u6d41\u91cf\u6cf3\u9053\uff0c\u4ee5\u53ca\u76d1\u63a7\u4f53\u7cfb\u505a\u5bf9\u63a5\u548c\u9002\u914d\u3002\\n\\n\u5728\u5fae\u670d\u52a1\u7f51\u5173\u524d\u671f\uff0c\u662f\u57fa\u4e8e Istio 1.5.10 \u5bf9 Pilot \u4e8c\u6b21\u5f00\u53d1\uff0c\u4e5f\u5728\u7f51\u5173\u4fa7\u652f\u6301\u975e\u5bb9\u5668\u90e8\u7f72\u573a\u666f\u3002\u76ee\u524d\u9636\u6bb5\u5219\u662f\u4fdd\u6301\u4e86 Istio+Envoy \u67b6\u6784\u4e0e APISIX \u67b6\u6784\u540c\u65f6\u652f\u6301\uff0c\u901a\u8fc7\u5f15\u5165\u5916\u90e8\u670d\u52a1\u7ec4\u4ef6\uff0c\u8ba9 APISIX \u4e5f\u590d\u7528 Istio CRD \u8d44\u6e90\u3002\\n\\n\u4ece\u7f51\u5173\u53d1\u5c55\u89c6\u89d2\u6765\u770b\uff0c\u672a\u6765\u6211\u4eec\u4e5f\u4f1a\u8ddf\u968f\u7f51\u5173\u7684\u4e00\u4e9b\u8d8b\u52bf\u3002\u6bd4\u5982\u73b0\u5728\u5f88\u591a\u4ea7\u54c1\u90fd\u5f00\u59cb\u652f\u6301 Gateway API\uff0c\u50cf APISIX Ingress\u3001Traefik\u3001Contour \u7b49\uff1b\u540c\u65f6\u7f51\u5173\u7684\u52a8\u6001\u5316\u914d\u7f6e\u4e5f\u662f\u672a\u6765\u975e\u5e38\u660e\u663e\u7684\u8d8b\u52bf\uff0c\u5bf9\u4e8e\u8fd0\u7ef4\u6216\u8005\u57fa\u7840\u7814\u53d1\u7684\u540c\u5b66\u6765\u8bf4\uff0c\u5728\u540e\u7eed\u8003\u8651\u7f51\u5173\u67b6\u6784\u7684\u9009\u578b\u548c\u8fed\u4ee3\u65f6\uff0c\u4e5f\u53ef\u4ee5\u66f4\u591a\u5173\u6ce8\u7f51\u5173\u52a8\u6001\u914d\u7f6e\u7684\u65b9\u9762\u3002"},{"id":"\u5982\u4f55\u4f7f\u7528 Amesh \u914d\u7f6e\u63d2\u4ef6","metadata":{"permalink":"/zh/blog/2023/01/12/amesh-config-plugin","source":"@site/blog/2023/01/12/amesh-config-plugin.md","title":"\u5982\u4f55\u4f7f\u7528 Amesh \u914d\u7f6e\u63d2\u4ef6","description":"Amesh \u662f Apache APISIX \u7684\u670d\u52a1\u7f51\u683c\u5e93\u3002\u672c\u6587\u5728\u5047\u8bbe\u5df2\u7ecf\u6210\u529f\u5b89\u88c5 Amesh \u540e\uff0c\u5982\u4f55\u5728 Amesh \u4e2d\u8fdb\u884c\u90e8\u7f72\u3001\u914d\u7f6e\u548c\u66f4\u65b0\u63d2\u4ef6\u7b49\u64cd\u4f5c\u3002","date":"2023-01-12T00:00:00.000Z","formattedDate":"2023\u5e741\u670812\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":4.175,"truncated":true,"authors":[{"name":"lingsamuel","title":"Author","url":"https://github.com/lingsamuel","image_url":"https://github.com/lingsamuel.png","imageURL":"https://github.com/lingsamuel.png"}],"prevItem":{"title":"\u9a6c\u8702\u7a9d\u5982\u4f55\u5229\u7528 APISIX \u7f51\u5173\u5b9e\u73b0\u5fae\u670d\u52a1\u67b6\u6784\u5347\u7ea7","permalink":"/zh/blog/2023/01/15/mafengwo-with-apisix"},"nextItem":{"title":"\u76d8\u70b9\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\u7684\u8bf8\u591a\u8eab\u4efd\u9a8c\u8bc1\u65b9\u5f0f","permalink":"/zh/blog/2023/01/12/serverless-auth-type"}},"content":"> Amesh \u662f Apache APISIX \u7684\u670d\u52a1\u7f51\u683c\u5e93\u3002\u672c\u6587\u5728\u5047\u8bbe\u5df2\u7ecf\u6210\u529f\u5b89\u88c5 Amesh \u540e\uff0c\u5982\u4f55\u5728 Amesh \u4e2d\u8fdb\u884c\u90e8\u7f72\u3001\u914d\u7f6e\u548c\u66f4\u65b0\u63d2\u4ef6\u7b49\u64cd\u4f5c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[@lingsamuel](https://github.com/lingsamuel)\uff0cAPI7.ai \u4e91\u539f\u751f\u6280\u672f\u4e13\u5bb6\uff0cApache APISIX Committer\u3002\\n\\n\u5728\u4e0a\u4e00\u7bc7 Amesh \u4ea7\u54c1\u4ecb\u7ecd\u4e2d\uff0c\u6211\u4eec\u6709\u63d0\u5230\u5728 Amesh v2.0 \u7248\u672c\u65b0\u589e\u4e86\u4e00\u4e2a\u53ef\u9009\u7684\u63a7\u5236\u9762\u7ec4\u4ef6\uff0c\u5373 `amesh-controller` \u53ca\u76f8\u5e94\u7684 CRD\u3002`amesh controller` \u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u914d\u7f6e APISIX \u63d2\u4ef6\u7684\u80fd\u529b\uff0c\u4f7f APISIX \u4f17\u591a\u7684\u63d2\u4ef6\u5728\u670d\u52a1\u7f51\u683c\u573a\u666f\u4e0b\u4e5f\u80fd\u5f00\u7bb1\u5373\u7528\uff0c\u800c\u65e0\u9700\u7528\u6237\u8fdb\u884c\u81ea\u5b9a\u4e49\u7684\u5f00\u53d1\u3002\u90a3\u4e48\u5982\u4f55\u4f7f\u7528\u8fd9\u4e9b\u7ec4\u4ef6\uff0c\u6765\u8fdb\u884c APISIX \u63d2\u4ef6\u80fd\u529b\u7684\u4f7f\u7528\u5462\uff1f\\n\\n\u672c\u6587\u5728\u5047\u8bbe\u5df2\u7ecf\u6210\u529f\u5b89\u88c5 Amesh \u540e\uff0c\u5982\u4f55\u5728 Amesh \u4e2d\u8fdb\u884c\u90e8\u7f72\u3001\u914d\u7f6e\u548c\u66f4\u65b0\u63d2\u4ef6\u7b49\u64cd\u4f5c\u3002\\n\\n## \u90e8\u7f72 Amesh Controller \u4e0e CRD\\n\\n\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u90e8\u7f72 Amesh Controller \u4e0e CRD\uff1a\\n\\n```bash\\ncd controller\\nkubectl apply -k ./config/crd/\\nhelm install amesh-controller -n istio-system ./charts/amesh-controller\\n```\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAmesh \u5c06\u4f1a\u81ea\u52a8\u8fde\u63a5\u5230\u4f4d\u4e8e `istio-system` namespace \u4e0b\u7684 `amesh-controller` \u670d\u52a1 `15810` \u7aef\u53e3\uff0c\u800c\u65e0\u9700\u91cd\u542f Sidecar\u3002\\n\\n\u5982\u9700\u81ea\u5b9a\u4e49\uff0c\u53ef\u4ee5\u4f7f\u7528 `AMESH_GRPC_SOURCE` \u73af\u5883\u53d8\u91cf\u8fdb\u884c\u914d\u7f6e\u3002\u8be5\u53d8\u91cf\u9ed8\u8ba4\u503c\u4e3a `\\"grpc://amesh-controller.istio-system.svc:15810\\"`\uff0c\u6309\u9700\u6307\u5b9a\u5230\u5bf9\u5e94\u7684 `amesh-controller` \u5373\u53ef\u3002\\n\\n## \u90e8\u7f72\u793a\u4f8b\u5e94\u7528\\n\\n\u8fd9\u91cc\u6211\u4eec\u4ee5 Istio \u63d0\u4f9b\u7684 Bookinfo \u5e94\u7528\u4e3a\u6d4b\u8bd5\u7528\u4f8b\u3002\\n\\n```bash\\n# \u5728 Istio \u76ee\u5f55\u4e0b\u6267\u884c\\nkubectl -n test apply -f samples/bookinfo/platform/kube/bookinfo.yaml\\nkubectl -n test run consumer --image curlimages/curl --image-pull-policy IfNotPresent --command sleep 1d\\n```\\n\\n\u6d4b\u8bd5\u662f\u5426\u80fd\u591f\u6b63\u5e38\u8bbf\u95ee\uff1a\\n\\n```bash\\nkubectl -n test exec -it -c istio-proxy consumer -- curl -i -XGET \\"http://productpage:9080/productpage\\" | grep -o \\"<title>.*</title>\\"\\n```\\n\\n\u8f93\u51fa\u7ec6\u8282\u7c7b\u4f3c\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```bash\\n<title>Simple Bookstore App</title>\\n```\\n\\n## \u914d\u7f6e\u793a\u4f8b\u63d2\u4ef6\\n\\n\u672c\u6587\u5c06\u4ee5 `response-rewrite` \u63d2\u4ef6\u4e3a\u4f8b\u8fdb\u884c\u6f14\u793a\u3002\u9996\u5148\u4e3a\u96c6\u7fa4\u5e94\u7528\u4e0b\u5217\u793a\u4f8b\u914d\u7f6e\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v1alpha1\\nkind: AmeshPluginConfig\\nmetadata:\\n  name: ameshpluginconfig-sample\\nspec:\\n  plugins:\\n    - name: response-rewrite\\n      config: \'{\\"body\\": \\"BODY_REWRITE\\", \\"headers\\": {\\"X-Header\\":\\"Rewrite\\"}}\'\\n```\\n\\n\u5c1d\u8bd5\u8bbf\u95ee\u6d4b\u8bd5\u8d1f\u8f7d\uff1a\\n\\n```bash\\nkubectl -n test exec -it -c istio-proxy consumer -- curl -i -XGET \\"http://productpage:9080/productpage\\"\\n```\\n\\n\u8f93\u51fa\u7ec6\u8282\u5e94\u8be5\u5305\u542b\u5982\u4e0b\u5185\u5bb9\uff1a\\n\\n```yaml\\nVia: APISIX\\nServer: APISIX/2.15.0\\nX-Header: Rewrite\\n\\nBODY_REWRITE\\n```\\n\\n### \u66f4\u65b0\u63d2\u4ef6\u914d\u7f6e\\n\\n\u5c06\u793a\u4f8b AmeshPluginConfig \u6587\u4ef6\u4fee\u6539\u4e3a\u5982\u4e0b\uff0c\u79fb\u9664 Body \u914d\u7f6e\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v1alpha1\\nkind: AmeshPluginConfig\\nmetadata:\\n  name: ameshpluginconfig-sample\\nspec:\\n  plugins:\\n  - name: response-rewrite\\n    config: \'{\\"headers\\": {\\"X-Header\\":\\"Rewrite\\"}}\'\\n```\\n\\n\u518d\u6b21\u8bf7\u6c42\u6d4b\u8bd5\u8d1f\u8f7d\uff1a\\n\\n```bash\\nkubectl -n test exec -it -c istio-proxy consumer -- curl -i -XGET \\"http://productpage:9080/productpage\\" | grep -o \\"<title>.*</title>\\"\\n```\\n\\n\u8f93\u51fa\u5e94\u8be5\u5305\u542b\u5982\u4e0b\u5185\u5bb9\uff1a\\n\\n```html\\n<title>Simple Bookstore App</title>\\n```\\n\\n\u8fd9\u8868\u660e\u54cd\u5e94 Body \u6ca1\u6709\u88ab\u91cd\u5199\uff0c\u7b26\u5408\u6211\u4eec\u7684\u9884\u671f\u3002\\n\\n\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u9a8c\u8bc1 Header \u662f\u5426\u88ab\u6b63\u5e38\u91cd\u5199\uff1a\\n\\n```bash\\nkubectl -n test exec -it -c istio-proxy consumer -- curl -i -XGET \\"http://productpage:9080/productpage\\" | grep \\"X-Header\\"\\n```\\n\\n\u8f93\u51fa\u5185\u5bb9\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```yaml\\nX-Header: Rewrite\\n```\\n\\n## \u5176\u4ed6\u573a\u666f\\n\\n\u9664\u4e86\u4e0a\u6587\u6f14\u793a\u7684 `response-rewrite` \u63d2\u4ef6\u4e4b\u5916\uff0cAmesh \u8fd8\u652f\u6301\u914d\u7f6e APISIX \u7684\u6240\u6709\u63d2\u4ef6\u3002\u7528\u6237\u53ef\u4ee5\u6839\u636e\u9700\u8981\u8fdb\u884c\u914d\u7f6e\u3002\\n\\n\u4f8b\u5982\uff0c\u5f53\u9700\u8981\u8fdb\u884c\u6545\u969c\u6ce8\u5165\u65f6\uff0c\u53ea\u9700\u8981\u5c06\u914d\u7f6e\u4e2d\u7684\u63d2\u4ef6\u540d\u6539\u4e3a `fault-injection`\uff0c\u63d2\u4ef6\u914d\u7f6e\u6539\u4e3a `\'{\\"abort\\": { \\"http_status\\": 200, \\"body\\": \\"Fault Injection!\\" }\'` \u5373\u53ef\u5b9e\u73b0\uff0c\u5177\u4f53\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v1alpha1\\nkind: AmeshPluginConfig\\nmetadata:\\n  name: faultinjection-sample\\nspec:\\n  plugins:\\n  - name: fault-injection\\n    config: \'{\\"abort\\": { \\"http_status\\": 200, \\"body\\": \\"Fault Injection!\\" }\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4ee5 `response-rewrite` \u63d2\u4ef6\u4e3a\u4f8b\uff0c\u6f14\u793a\u4e86 Amesh v0.2 \u7248\u672c\u65b0\u589e\u7684\u63d2\u4ef6\u914d\u7f6e\u529f\u80fd\u3002\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u9700\u8981\uff0c\u4e3a Amesh \u914d\u7f6e\u9002\u5408\u7684 APISIX \u4e2d\u5df2\u6709\u7684\u63d2\u4ef6\u3002\u4e5f\u6b22\u8fce\u5404\u4f4d\u5728\u5b9e\u8df5\u4e2d\u8fdb\u884c\u4f53\u9a8c\uff0c\u5e76\u53cd\u9988\u66f4\u591a\u5173\u4e8e\u670d\u52a1\u7f51\u683c\u7684\u60f3\u6cd5\u3002"},{"id":"\u76d8\u70b9\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\u7684\u8bf8\u591a\u8eab\u4efd\u9a8c\u8bc1\u65b9\u5f0f","metadata":{"permalink":"/zh/blog/2023/01/12/serverless-auth-type","source":"@site/blog/2023/01/12/serverless-auth-type.md","title":"\u76d8\u70b9\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\u7684\u8bf8\u591a\u8eab\u4efd\u9a8c\u8bc1\u65b9\u5f0f","description":"\u672c\u6587\u5c06\u4ece\u4f20\u7edf\u670d\u52a1\u67b6\u6784\u548c\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\u7684\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f\u533a\u522b\u8fdb\u884c\u8ba8\u8bba\uff0c\u5e76\u6700\u7ec8\u8861\u91cf\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u7684\u5404\u79cd\u5b9e\u73b0\u65b9\u5f0f\u7684\u4f18\u52a3\u3002","date":"2023-01-12T00:00:00.000Z","formattedDate":"2023\u5e741\u670812\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":13.145,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","title":"Author","url":"https://github.com/spacewander","image_url":"https://github.com/spacewander.png","imageURL":"https://github.com/spacewander.png"},{"name":"\u8d75\u58eb\u745e","title":"Author","url":"https://github.com/soulbird","image_url":"https://github.com/soulbird.png","imageURL":"https://github.com/soulbird.png"}],"prevItem":{"title":"\u5982\u4f55\u4f7f\u7528 Amesh \u914d\u7f6e\u63d2\u4ef6","permalink":"/zh/blog/2023/01/12/amesh-config-plugin"},"nextItem":{"title":"\u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u65b9\u6848 Amesh \u79ef\u6781\u5f00\u53d1\u4e2d\uff01","permalink":"/zh/blog/2023/01/11/apisix-amesh-introduction"}},"content":"> \u8eab\u4efd\u8ba4\u8bc1\u662f\u6388\u4e88\u7528\u6237\u8bbf\u95ee\u7cfb\u7edf\u5e76\u6388\u4e88\u4f7f\u7528\u7cfb\u7edf\u7684\u5fc5\u8981\u6743\u9650\u7684\u8fc7\u7a0b\u3002\u800c\u63d0\u4f9b\u4e86\u8fd9\u4e00\u529f\u80fd\u7684\u670d\u52a1\uff0c\u5c31\u662f\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u8054\u5408\u4f5c\u8005\u7f57\u6cfd\u8f69\uff0cAPI7.ai \u6280\u672f\u4e13\u5bb6\u3001Apache APISIX PMC \u6210\u5458\uff1b\\n>\\n> \u8054\u5408\u4f5c\u8005\u8d75\u58eb\u745e\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\uff0cApache APISIX Committer\u3002\\n\\n\u5728\u4f20\u7edf\u7684\u5355\u4f53\u8f6f\u4ef6\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u6240\u6709\u8fd9\u4e9b\u90fd\u53d1\u751f\u5728\u540c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002\u4f46\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u7cfb\u7edf\u7531\u591a\u4e2a\u670d\u52a1\u7ec4\u6210\uff0c\u5728\u8fd9\u6837\u7684\u67b6\u6784\u4e2d\uff0c\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u6709\u81ea\u5df1\u7684\u4efb\u52a1\uff0c\u56e0\u6b64\u4e3a\u6bcf\u4e2a\u5fae\u670d\u52a1\u5206\u522b\u5b9e\u73b0\u6388\u6743\u548c\u8eab\u4efd\u9a8c\u8bc1\u8fc7\u7a0b\u5e76\u4e0d\u5b8c\u5168\u7b26\u5408\u6b64\u539f\u5219\u3002\\n\\n\u672c\u6587\u5c06\u4ece\u4f20\u7edf\u670d\u52a1\u67b6\u6784\u548c\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\u7684\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f\u533a\u522b\u8fdb\u884c\u8ba8\u8bba\uff0c\u5e76\u6700\u7ec8\u8861\u91cf\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u7684\u5404\u79cd\u5b9e\u73b0\u65b9\u5f0f\u7684\u4f18\u52a3\u3002\\n\\n## \u4f20\u7edf\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\\n\\n\u5728\u4f01\u4e1a\u5f00\u53d1\u670d\u52a1\u7684\u65e9\u671f\uff0c\u6240\u6709\u529f\u80fd\u90fd\u662f\u505a\u5230\u540c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u91cc\u9762\u7684\u3002\u6211\u4eec\u628a\u8fd9\u79cd\u6a21\u5f0f\u79f0\u4e4b\u4e3a \u201c\u5355\u4f53\u201d\uff0c\u4ee5\u8ddf\u5f53\u4e0b\u66f4\u4e3a\u4e3b\u6d41\u7684 \u201c\u5fae\u670d\u52a1\u201d \u67b6\u6784\u533a\u5206\u5f00\u6765\u3002\\n\\n\u5355\u4f53\u5e94\u7528\u7531\u5355\u4e2a\u4e0d\u53ef\u5206\u5272\u7684\u5355\u5143\u7ec4\u6210\u3002\u5b83\u901a\u5e38\u7531\u5404\u4e2a\u4e1a\u52a1\u7ebf\u5404\u81ea\u5f00\u53d1\uff0c\u4f46\u662f\u90e8\u7f72\u65f6\u653e\u5165\u5230\u540c\u4e00\u4e2a\u73af\u5883\u4e2d\u3002\u6240\u6709\u8fd9\u4e9b\u90fd\u7d27\u5bc6\u96c6\u6210\u4ee5\u5728\u4e00\u4e2a\u5355\u5143\u4e2d\u63d0\u4f9b\u6240\u6709\u529f\u80fd\u3002\u8fd9\u4e00\u5355\u5143\u91cc\u62e5\u6709\u6240\u9700\u7684\u6240\u6709\u8d44\u6e90\u3002\u5355\u4f53\u5e94\u7528\u7684\u597d\u5904\u5728\u4e8e\u90e8\u7f72\u8fed\u4ee3\u7b80\u5355\uff0c\u9002\u5408\u4e1a\u52a1\u7ebf\u8f83\u5c11\u4e14\u6bd4\u8f83\u72ec\u7acb\u7684\u516c\u53f8\u91c7\u7528\u3002\\n\\n\u968f\u7740\u4f01\u4e1a\u5f00\u53d1\u51fa\u6765\u7684\u4e1a\u52a1\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u5355\u4f53\u670d\u52a1\u5df2\u7ecf\u65e0\u6cd5\u6ee1\u8db3\u73b0\u5b9e\u751f\u6d3b\u91cc\u9762\u5feb\u901f\u8fed\u4ee3\u7684\u9700\u8981\u4e86\u3002\u6211\u4eec\u9700\u8981\u628a\u8fd9\u4e2a\u5355\u4f53\u7684\u5de8\u65e0\u9738\u62c6\u5206\u4e00\u4e0b\uff0c\u540c\u65f6\u4fdd\u8bc1\u73b0\u6709\u7684\u5404\u4e2a\u529f\u80fd\u95f4\u7684\u8c03\u7528\u80fd\u6b63\u5e38\u8fdb\u884c\u3002\u8fd9\u65f6\u5019\uff0cESB\uff08\u4f01\u4e1a\u670d\u52a1\u603b\u7ebf\uff09\u4fbf\u5e94\u8fd0\u800c\u751f\u4e86\u3002\\n\\n\u6240\u8c13\u7684 \u201c\u4f01\u4e1a\u670d\u52a1\u603b\u7ebf\u201d\uff0c\u5c31\u662f\u4e00\u6839\u8fde\u63a5\u5404\u4e2a\u4f01\u4e1a\u670d\u52a1\u7684\u7ba1\u9053\u3002ESB \u7684\u5b58\u5728\u662f\u4e3a\u4e86\u96c6\u6210\u57fa\u4e8e\u4e0d\u540c\u534f\u8bae\u7684\u4e0d\u540c\u670d\u52a1\uff0cESB \u505a\u4e86\u6d88\u606f\u7684\u8f6c\u5316\u3001\u89e3\u91ca\u4ee5\u53ca\u8def\u7531\u7684\u5de5\u4f5c\uff0c\u4ee5\u6b64\u6765\u8ba9\u4e0d\u540c\u7684\u670d\u52a1\u4e92\u8054\u4e92\u901a\u3002\u4ece\u540d\u79f0\u5c31\u80fd\u77e5\u9053\uff0c\u5b83\u7684\u6982\u5ff5\u501f\u9274\u4e86\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u4e2d\u7684\u901a\u4fe1\u6a21\u578b \u2014\u2014 \u603b\u7ebf\uff0c\u6240\u6709\u9700\u8981\u548c\u5916\u90e8\u7cfb\u7edf\u901a\u4fe1\u7684\u7cfb\u7edf\uff0c\u7edf\u7edf\u63a5\u5165 ESB\uff0c\u5c31\u53ef\u4ee5\u5229\u7528\u73b0\u6709\u7684\u7cfb\u7edf\u6784\u5efa\u4e00\u4e2a\u5168\u65b0\u7684\u677e\u8026\u5408\u7684\u5f02\u6784\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u3002\\n\\nESB \u505a\u4e86\u6d88\u606f\u7684\u8f6c\u6362\u89e3\u91ca\u4e0e\u8def\u7531\u7b49\u5de5\u4f5c\uff0c\u8ba9\u4e0d\u540c\u7684\u670d\u52a1\u4e92\u8054\u4e92\u901a\u3002\u4f20\u7edf\u7684 ESB \u7684\u670d\u52a1\u8c03\u7528\u65b9\u5f0f\u662f\uff0c\u6bcf\u4e00\u6b21\u670d\u52a1\u7684\u8c03\u7528\u8005\u8981\u5411\u670d\u52a1\u63d0\u4f9b\u8005\u8fdb\u884c\u670d\u52a1\u4ea4\u4e92\u8bf7\u6c42\u65f6\u90fd\u5fc5\u987b\u901a\u8fc7\u4e2d\u5fc3\u7684 ESB \u6765\u8fdb\u884c\u8def\u7531\u3002\\n\\n\u63a5\u4e0b\u6765\u5c06\u6309\u7167\u8fd9\u4e24\u79cd\u60c5\u51b5\uff0c\u5206\u522b\u63cf\u8ff0\u5bf9\u5e94\u7684\u8eab\u4efd\u8ba4\u8bc1\u529f\u80fd\u7684\u5b9e\u73b0\u3002\\n\\n### \u5355\u4f53\u67b6\u6784\\n\\n\u5355\u4f53\u67b6\u6784\u4e0b\uff0c\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\u548c\u4f1a\u8bdd\u7ba1\u7406\u76f8\u5bf9\u7b80\u5355\u3002\u8eab\u4efd\u8ba4\u8bc1\u548c\u6388\u6743\u53d1\u751f\u5728\u540c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528\u57fa\u4e8e session \u7684\u8ba4\u8bc1\u65b9\u6848\u3002\u4e00\u65e6\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u4f1a\u8bdd\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u670d\u52a1\u5668\u4e0a\uff0c\u4efb\u4f55\u9700\u8981\u5b83\u7684\u7ec4\u4ef6\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5b83\u5e76\u7528\u4e8e\u901a\u77e5\u548c\u6388\u6743\u540e\u7eed\u8981\u6c42\u3002\u4f1a\u8bdd ID \u88ab\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u5e76\u7528\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684\u6240\u6709\u540e\u7eed\u8bf7\u6c42\uff0c\u4ee5\u5c06\u8bf7\u6c42\u4e0e\u5f53\u524d\u4f1a\u8bdd\u76f8\u5173\u8054\u3002\\n\\n### ESB \u67b6\u6784\\n\\n\u5728 ESB \u67b6\u6784\u4e0b\uff0c\u6240\u6709\u7528\u6237\u4e0e\u670d\u52a1\u4e4b\u95f4\uff0c\u670d\u52a1\u4e0e\u670d\u52a1\u4e4b\u95f4\u5168\u90e8\u901a\u8fc7 ESB \u603b\u7ebf\u8fdb\u884c\u5904\u7406\u3002\u7531\u4e8e ESB \u7684\u67b6\u6784\u662f\u4ece\u5355\u4f53\u62c6\u5206\u4e0b\u6765\u7684\uff0c\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f\u76f8\u5bf9\u4e8e\u5355\u4f53\u67b6\u6784\u5e76\u6ca1\u6709\u53d8\u5316\u3002\\n\\n## \u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\\n\\n\u4ece\u5355\u4f53\u67b6\u6784\u8fc1\u79fb\u5230\u5fae\u670d\u52a1\u67b6\u6784\u6709\u5f88\u591a\u4f18\u52bf\uff0c\u4f46\u5fae\u670d\u52a1\u67b6\u6784\u4f5c\u4e3a\u4e00\u79cd\u5206\u5e03\u5f0f\u67b6\u6784\uff0c\u4f1a\u5b58\u5728\u66f4\u5927\u7684\u653b\u51fb\u9762\uff0c\u5171\u4eab\u7528\u6237\u4e0a\u4e0b\u6587\u66f4\u52a0\u56f0\u96be\u3002\u56e0\u6b64\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\u9700\u8981\u6709\u8ddf\u4f20\u7edf\u67b6\u6784\u4e0d\u4e00\u6837\u7684\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\uff0c\u624d\u80fd\u54cd\u5e94\u66f4\u5927\u7684\u5b89\u5168\u6027\u6311\u6218\u3002\\n\\n\u76ee\u524d\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\u7684\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u5206\u4e3a\u4ee5\u4e0b\u4e09\u7c7b\uff1a\\n\\n1. \u901a\u8fc7\u6bcf\u4e2a\u5fae\u670d\u52a1\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1\uff1b\\n2. \u901a\u8fc7\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1\uff1b\\n3. \u901a\u8fc7\u7f51\u5173\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1\u3002\\n\\n\u5f53\u7136\uff0c\u6bcf\u79cd\u505a\u6cd5\u90fd\u6709\u81ea\u5df1\u7279\u5b9a\u7684\u4f18\u7f3a\u70b9\u3002\\n\\n### \u901a\u8fc7\u6bcf\u4e2a\u5fae\u670d\u52a1\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1\\n\\n\u65e2\u7136\u5fae\u670d\u52a1\u67b6\u6784\u662f\u4ece\u5355\u4f53\u67b6\u6784\u62c6\u5206\u51fa\u6765\u7684\uff0c\u56e0\u6b64\u6bd4\u8f83\u81ea\u7136\u7684\u8fc7\u6e21\u65b9\u5f0f\u5c31\u662f\u7531\u6bcf\u4e2a\u5fae\u670d\u52a1\u81ea\u5df1\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1\u3002\\n\\n![\u6bcf\u4e2a\u5fae\u670d\u52a1\u81ea\u5df1\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1](https://static.apiseven.com/uploads/2023/01/10/DiCEnbrz_1713208657.png)\\n\\n\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u9700\u8981\u5b9e\u73b0\u81ea\u5df1\u72ec\u7acb\u7684\u5b89\u5168\u6027\u4fdd\u969c\uff0c\u5e76\u5728\u6bcf\u4e2a\u5165\u53e3\u70b9\u4e0a\u5f3a\u5236\u6267\u884c\u3002\u6b64\u65b9\u6cd5\u4f7f\u5fae\u670d\u52a1\u56e2\u961f\u80fd\u591f\u81ea\u4e3b\u51b3\u5b9a\u5982\u4f55\u5b9e\u73b0\u5176\u5b89\u5168\u89e3\u51b3\u65b9\u6848\u3002\u4f46\u662f\uff0c\u8fd9\u79cd\u65b9\u6cd5\u6709\u51e0\u4e2a\u7f3a\u70b9\uff1a\\n\\n* \u5b89\u5168\u903b\u8f91\u9700\u8981\u5728\u6bcf\u4e2a\u5fae\u670d\u52a1\u4e2d\u91cd\u590d\u5b9e\u73b0\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u670d\u52a1\u4e4b\u95f4\u7684\u4ee3\u7801\u91cd\u590d\u3002\\n* \u5b83\u5206\u6563\u4e86\u5f00\u53d1\u56e2\u961f\u7684\u6ce8\u610f\u529b\uff0c\u4f7f\u5176\u65e0\u6cd5\u4e13\u6ce8\u4e8e\u5176\u4e3b\u8981\u670d\u52a1\u3002\\n* \u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u4f9d\u8d56\u4e8e\u5b83\u4e0d\u62e5\u6709\u7684\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\u6570\u636e\u3002\\n* \u5f88\u96be\u7ef4\u62a4\u548c\u76d1\u63a7\u3002\\n\\n\u5b8c\u5584\u8fd9\u4e2a\u89e3\u51b3\u65b9\u6848\u7684\u9009\u62e9\u4e4b\u4e00\u5c31\u662f\u4f7f\u7528\u4e00\u4e2a\u52a0\u8f7d\u5728\u6bcf\u4e2a\u5fae\u670d\u52a1\u4e0a\u7684\u5171\u4eab\u8ba4\u8bc1\u5e93\u3002\u8fd9\u4e2a\u64cd\u4f5c\u53ef\u4ee5\u9632\u6b62\u4ee3\u7801\u91cd\u590d\uff0c\u5f00\u53d1\u56e2\u961f\u5c06\u53ea\u5173\u6ce8\u4ed6\u4eec\u7684\u4e1a\u52a1\u9886\u57df\uff0c\u4f46\u4ecd\u7136\u5b58\u5728\u8fd9\u79cd\u6539\u8fdb\u65e0\u6cd5\u89e3\u51b3\u7684\u7f3a\u70b9\u3002\\n\\n\u56e0\u4e3a\u5171\u4eab\u7684\u8ba4\u8bc1\u5e93\u4ecd\u7136\u9700\u8981\u6709\u5bf9\u5e94\u7684\u7528\u6237\u8eab\u4efd\u6570\u636e\uff0c\u800c\u4e14\u8fd8\u9700\u8981\u4fdd\u8bc1\u5404\u4e2a\u5fae\u670d\u52a1\u4f7f\u7528\u540c\u6837\u7248\u672c\u7684\u8ba4\u8bc1\u5e93\u3002\u8001\u5b9e\u8bf4\uff0c\u5171\u4eab\u8ba4\u8bc1\u5e93\u66f4\u50cf\u662f\u670d\u52a1\u62c6\u5206\u4e0d\u900f\u5f7b\u7684\u7ed3\u679c\u3002\\n\\n\u56e0\u6b64\u8fd9\u79cd\u65b9\u5f0f\u603b\u7ed3\u6765\u8bf4\uff0c\u4f18\u52bf\u5728\u4e8e\u5b9e\u65bd\u901f\u5ea6\u5feb\uff0c\u72ec\u7acb\u6027\u5f3a\uff1b\u800c\u52a3\u52bf\u4e5f\u6bd4\u8f83\u660e\u663e\uff0c\u670d\u52a1\u4e4b\u95f4\u7684\u4ee3\u7801\u91cd\u590d\u3001\u8fdd\u53cd\u5355\u4e00\u804c\u8d23\u539f\u5219\uff0c\u8f83\u96be\u7ef4\u62a4\u3002\\n\\n### \u901a\u8fc7\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1\\n\\n\u65e2\u7136\u6bcf\u4e2a\u5fae\u670d\u52a1\u81ea\u5df1\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1\u96be\u4ee5\u7ef4\u62a4\uff0c\u800c\u4f7f\u7528\u5171\u4eab\u8ba4\u8bc1\u5e93\u53c8\u8fdd\u80cc\u4e86\u5fae\u670d\u52a1\u62c6\u5206\u7684\u672c\u610f\uff0c\u90a3\u4e48\u80fd\u4e0d\u80fd\u628a\u5171\u4eab\u8ba4\u8bc1\u5e93\u5347\u7ea7\u6210\u4e13\u95e8\u7684\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u5462\uff1f\\n\\n![\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u5b9e\u73b0](https://static.apiseven.com/uploads/2023/01/10/crpx8OA6_3258593430.png)\\n\\n\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u8bbf\u95ee\u90fd\u901a\u8fc7\u540c\u4e00\u670d\u52a1\u8fdb\u884c\u63a7\u5236\uff0c\u7c7b\u4f3c\u4e8e\u5355\u4f53\u5e94\u7528\u91cc\u9762\u7684\u8eab\u4efd\u8ba4\u8bc1\u529f\u80fd\u3002\u6bcf\u4e2a\u4e1a\u52a1\u670d\u52a1\u90fd\u5fc5\u987b\u5728\u6267\u884c\u64cd\u4f5c\u65f6\uff0c\u5411\u8bbf\u95ee\u63a7\u5236\u6a21\u5757\u53d1\u9001\u5355\u72ec\u7684\u6388\u6743\u8bf7\u6c42\u3002\\n\\n\u4f46\u662f\uff0c\u8fd9\u79cd\u65b9\u6cd5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u51cf\u6162\u4e86\u670d\u52a1\u7684\u8fd0\u884c\u901f\u5ea6\uff0c\u5e76\u589e\u52a0\u4e86\u670d\u52a1\u4e4b\u95f4\u7684\u4e92\u8fde\u91cf\u3002\u5e76\u4e14\u5404\u4e2a\u5fae\u670d\u52a1\u4f1a\u4f9d\u8d56\u8fd9\u4e2a\u201c\u5355\u70b9\u201d\u7684\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u3002\u4e07\u4e00\u7edf\u4e00\u7684\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u51fa\u95ee\u9898\uff0c\u4f1a\u9020\u6210\u94fe\u5f0f\u53cd\u5e94\uff0c\u5e26\u6765\u4e8c\u6b21\u4f24\u5bb3\u3002\\n\\n\u6240\u4ee5\u603b\u7ed3\u6765\u770b\uff0c\u8fd9\u79cd\u65b9\u5f0f\u867d\u7136\u786e\u4fdd\u4e86\u6bcf\u4e2a\u5fae\u670d\u52a1\u804c\u8d23\u5355\u4e00\uff0c\u4f7f\u5f97\u8eab\u4efd\u8ba4\u8bc1\u529f\u80fd\u66f4\u52a0\u96c6\u4e2d\u3002\u4f46\u662f\u4ecd\u4f1a\u9020\u6210\u5355\u70b9\u4f9d\u8d56\uff0c\u8fdb\u800c\u589e\u52a0\u8bf7\u6c42\u5ef6\u8fdf\u3002\\n\\n### \u901a\u8fc7\u7f51\u5173\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1\\n\\n\u8fc1\u79fb\u5230\u5fae\u670d\u52a1\u4f53\u7cfb\u7ed3\u6784\u65f6\uff0c\u9700\u8981\u56de\u7b54\u7684\u95ee\u9898\u4e4b\u4e00\u662f\u5fae\u670d\u52a1\u4e4b\u95f4\u5982\u4f55\u901a\u4fe1\u3002\u524d\u9762\u63d0\u5230\u7684 ESB \u662f\u79cd\u65b9\u6848\uff0c\u4f46\u662f\u66f4\u5e38\u89c1\u7684\u9009\u62e9\u5219\u662f\u91c7\u7528 API \u7f51\u5173\u3002\\n\\n![\u7f51\u5173\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1](https://static.apiseven.com/uploads/2023/01/10/LY1f4mnq_2653992949.png)\\n\\nAPI \u7f51\u5173\u662f\u6240\u6709\u8bf7\u6c42\u7684\u5355\u4e2a\u7ec8\u7aef\u8282\u70b9\u5165\u53e3\uff0c\u5b83\u901a\u8fc7\u5145\u5f53\u4f7f\u7528\u8fd9\u4e9b\u5fae\u670d\u52a1\u7684\u4e2d\u592e\u63a5\u53e3\u6765\u63d0\u4f9b\u7075\u6d3b\u6027\u3002\u67d0\u4e2a\u9700\u8981\u8bbf\u95ee\u5176\u4ed6\u5fae\u670d\u52a1\u7684\u5fae\u670d\u52a1\uff08\u4ee5\u4e0b\u79f0\u4e4b\u4e3a\u201c\u5ba2\u6237\u7aef\u201d\uff0c\u4ee5\u8ddf\u88ab\u5b83\u8bbf\u95ee\u7684\u5fae\u670d\u52a1\u76f8\u533a\u5206\uff09\u65e0\u6743\u8bbf\u95ee\u591a\u4e2a\u670d\u52a1\uff0c\u800c\u662f\u9700\u8981\u5411\u8d1f\u8d23\u5c06\u5176\u8def\u7531\u5230\u4e0a\u6e38\u670d\u52a1\u7684 API \u7f51\u5173\u53d1\u9001\u8bf7\u6c42\u3002\\n\\n\u7531\u4e8e API \u7f51\u5173\u4f4d\u4e8e\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u5fc5\u7ecf\u4e4b\u8def\u4e0a\uff0c\u56e0\u6b64\u5b83\u662f\u5f3a\u5236\u5b9e\u65bd\u8eab\u4efd\u9a8c\u8bc1\u95ee\u9898\u7684\u7edd\u4f73\u9009\u62e9\u3002\u4f7f\u7528 API \u7f51\u5173\u53ef\u4ee5\u51cf\u5c11\u5ef6\u8fdf\uff08\u8c03\u7528\u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\uff09\uff0c\u5e76\u786e\u4fdd\u8eab\u4efd\u9a8c\u8bc1\u8fc7\u7a0b\u5728\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4fdd\u6301\u4e00\u81f4\u3002\\n\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u901a\u8fc7 APISIX \u7684 [jwt-auth](https://apisix.apache.org/docs/apisix/plugins/jwt-auth/) \u63d2\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u7f51\u5173\u4e0a\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1\u3002\\n\\n\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u89c4\u5212\u82e5\u5e72\u4e2a\u7528\u6237\u8eab\u4efd\u4fe1\u606f\uff08\u540d\u79f0\u3001\u5bc6\u94a5\u7b49\u7b49\uff09\uff0c\u5e76\u5c06\u5176\u914d\u7f6e\u5230 APISIX \u4e0a\u3002\u5176\u6b21\uff0c\u6839\u636e\u7ed9\u5b9a\u7684\u7528\u6237\u5bc6\u94a5\uff0c\u5411 APISIX \u53d1\u8d77\u7b7e\u540d\u8bf7\u6c42\uff0c\u5f97\u5230\u8fd9\u4e2a\u7528\u6237\u7684 JWT token\u3002\u63a5\u7740\uff0c\u5f53\u5ba2\u6237\u7aef\u9700\u8981\u8bbf\u95ee\u67d0\u4e2a\u4e0a\u6e38\u670d\u52a1\u65f6\uff0c\u5e26\u4e0a JWT token\uff0c\u7531 APISIX \u4f5c\u4e3a API \u7f51\u5173\u4ee3\u7406\u8be5\u8bbf\u95ee\u3002\u6700\u540e\uff0cAPISIX \u4f1a\u901a\u8fc7 JWT token\uff0c\u5b8c\u6210\u8eab\u4efd\u8ba4\u8bc1\u7684\u64cd\u4f5c\u3002\\n\\n\u5f53\u7136\uff0c\u51e1\u4e8b\u6709\u5229\u5c31\u6709\u5f0a\uff0c\u6ca1\u6709\u5b8c\u5168\u65e0\u52a3\u52bf\u7684\u6280\u672f\u9009\u578b\u3002\u4f7f\u7528\u7f51\u5173\u6765\u5b8c\u6210\u8eab\u4efd\u8ba4\u8bc1\uff0c\u8fd8\u662f\u5e26\u6765\u4e86\u5c11\u8bb8\u5355\u70b9\u95ee\u9898\u3002\u6bd4\u8d77\u5728\u6bcf\u4e2a\u5fae\u670d\u52a1\u5185\u5b8c\u6210\u8eab\u4efd\u8ba4\u8bc1\uff0c\u5728\u7f51\u5173\u4e0a\u89e3\u51b3\u8be5\u95ee\u9898\uff0c\u5b89\u5168\u6027\u76f8\u6bd4\u4f1a\u964d\u4f4e\u4e9b\u3002\u6bd4\u5982 API \u7f51\u5173\u88ab\u653b\u7834\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u8be5\u7f51\u5173\u80cc\u540e\u7684\u4efb\u4f55\u5fae\u670d\u52a1\u3002\u4f46\u662f\u98ce\u9669\u662f\u76f8\u5bf9\u7684\uff0c\u6bd4\u8d77\u7edf\u4e00\u7684\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\uff0c\u4f7f\u7528 API \u7f51\u5173\u7684\u5355\u70b9\u95ee\u9898\u5e76\u6ca1\u6709\u90a3\u4e48\u4e25\u91cd\u3002\\n\\n\u56e0\u6b64\u8fd9\u79cd\u65b9\u5f0f\u64cd\u4f5c\u8d77\u6765\uff0c\u5728\u4f18\u52bf\u4e0a\u8f83\u4e3a\u660e\u663e\uff0c\u6bd4\u5982\u53ef\u4ee5\u6709\u6548\u4fdd\u62a4\u540e\u7aef\u5fae\u670d\u52a1\uff0c\u5fae\u670d\u52a1\u4e0d\u7528\u5904\u7406\u4efb\u4f55\u8ba4\u8bc1\u903b\u8f91\u7b49\u3002\u4f46\u540c\u65f6\u8fd8\u662f\u4f1a\u5b58\u6709\u5c11\u8bb8\u7684\u5355\u70b9\u4f9d\u8d56\u3002\\n\\n## \u603b\u7ed3\\n\\n\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u4f1a\u9700\u8981\u4e0d\u540c\u7684\u8eab\u4efd\u8ba4\u8bc1\u65b9\u6848\u3002\u5728\u5355\u4f53\u5e94\u7528\u4e2d\uff0c\u8eab\u4efd\u8ba4\u8bc1\u53d1\u751f\u5728\u540c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u670d\u52a1\u7aef\u4fdd\u5b58\u4e86\u6240\u6709\u7684\u4f1a\u8bdd\u3002\u8fdb\u5165\u5fae\u670d\u52a1\u65f6\u4ee3\uff0c\u5355\u4f53\u5e94\u7528\u6f14\u53d8\u4e3a\u5206\u5e03\u5f0f\u670d\u52a1\uff0c\u5355\u4f53\u5e94\u7528\u4e2d\u7684\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f\u5728\u5fae\u670d\u52a1\u4e2d\u5e76\u4e0d\u9002\u7528\u3002\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u6211\u4eec\u6709\u4e0a\u8ff0\u63d0\u5230\u7684\u4e09\u79cd\u8eab\u4efd\u8ba4\u8bc1\u7684\u65b9\u5f0f\u53ef\u4f9b\u9009\u62e9\u3002\u6bcf\u79cd\u9009\u62e9\u90fd\u6709\u5c5e\u4e8e\u81ea\u5df1\u7684\u5229\u5f0a\uff0c\u9700\u8981\u6839\u636e\u5177\u4f53\u7684\u5b9e\u9645\u60c5\u51b5\u505a\u5177\u4f53\u5206\u6790\u3002"},{"id":"\u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u65b9\u6848 Amesh \u79ef\u6781\u5f00\u53d1\u4e2d\uff01","metadata":{"permalink":"/zh/blog/2023/01/11/apisix-amesh-introduction","source":"@site/blog/2023/01/11/apisix-amesh-introduction.md","title":"\u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u65b9\u6848 Amesh \u79ef\u6781\u5f00\u53d1\u4e2d\uff01","description":"Amesh \u662f Apache APISIX \u7684\u670d\u52a1\u7f51\u683c\u5e93\u3002\u5b83\u9002\u914d\u4e86 xDS \u534f\u8bae\uff0c\u53ef\u4ee5\u4ece\u8bf8\u5982 Istio \u7684\u63a7\u5236\u5e73\u9762\u4e2d\u63a5\u6536\u6570\u636e\uff0c\u5e76\u751f\u6210 APISIX \u6240\u9700\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f7f\u5f97 APISIX \u80fd\u591f\u5728\u670d\u52a1\u7f51\u683c\u9886\u57df\u4f5c\u4e3a\u6570\u636e\u9762\u53d1\u6325\u4f5c\u7528\u3002","date":"2023-01-11T00:00:00.000Z","formattedDate":"2023\u5e741\u670811\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":6.41,"truncated":true,"authors":[{"name":"lingsamuel","title":"Author","url":"https://github.com/lingsamuel","image_url":"https://github.com/lingsamuel.png","imageURL":"https://github.com/lingsamuel.png"}],"prevItem":{"title":"\u76d8\u70b9\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\u7684\u8bf8\u591a\u8eab\u4efd\u9a8c\u8bc1\u65b9\u5f0f","permalink":"/zh/blog/2023/01/12/serverless-auth-type"},"nextItem":{"title":"\u4e3a\u4ec0\u4e48 APISIX Ingress \u662f\u6bd4 Ingress NGINX \u66f4\u597d\u7684\u9009\u62e9\uff1f","permalink":"/zh/blog/2023/01/11/apisix-ingress-vs-ingress-nginx"}},"content":"> \u5728\u4e91\u539f\u751f\u5feb\u901f\u53d1\u5c55\u7684\u524d\u63d0\u4e0b\uff0c\u670d\u52a1\u7f51\u683c\u9886\u57df\u4e5f\u5f00\u59cb\u9010\u6e10\u706b\u70ed\u3002\u76ee\u524d\u9636\u6bb5\uff0c\u5927\u5bb6\u6240\u719f\u77e5\u7684\u670d\u52a1\u7f51\u683c\u89e3\u51b3\u65b9\u6848\u5f88\u591a\uff0c\u6bcf\u79cd\u4ea7\u54c1\u53c8\u5404\u6709\u5176\u4f18\u52bf\u3002\u56e0\u6b64\u5728\u9762\u5bf9\u4e0d\u540c\u7684\u884c\u4e1a\u6216\u8005\u4e1a\u52a1\u80cc\u666f\u65f6\uff0c\u6bcf\u4e2a\u4eba\u7684\u9009\u578b\u60f3\u6cd5\u90fd\u5404\u4e0d\u76f8\u540c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005 [lingsamuel](https://github.com/lingsamuel)\uff0cAPI7.ai \u4e91\u539f\u751f\u6280\u672f\u4e13\u5bb6\uff0cApache APISIX Committer\u3002\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u57fa\u4e8e APISIX \u7684\u6269\u5c55\u9053\u8def\u4e0a\uff0c\u9664\u4e86 APISIX Ingress \u5728\u4e91\u539f\u751f\u9886\u57df\u88ab\u5404\u5927\u5382\u5546\u5f00\u59cb\u5173\u6ce8\u5916\uff0c\u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u65b9\u6848\u4e5f\u5728\u79ef\u6781\u8fed\u4ee3\u4e2d\u3002\\n\\n## \u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u65b9\u6848\\n\\n[Amesh](https://github.com/api7/amesh) \u662f [Apache APISIX](https://github.com/apache/apisix) \u7684\u670d\u52a1\u7f51\u683c\u5e93\u3002\u5b83\u9002\u914d\u4e86 xDS \u534f\u8bae\uff0c\u53ef\u4ee5\u4ece\u8bf8\u5982 Istio \u7684\u63a7\u5236\u5e73\u9762\u4e2d\u63a5\u6536\u6570\u636e\uff0c\u5e76\u751f\u6210 APISIX \u6240\u9700\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f7f\u5f97 APISIX \u80fd\u591f\u5728\u670d\u52a1\u7f51\u683c\u9886\u57df\u4f5c\u4e3a\u6570\u636e\u9762\u53d1\u6325\u4f5c\u7528\u3002\\n\\n\u4f9d\u9760 Amesh\uff0cAPISIX \u53ef\u4ee5\u5de5\u4f5c\u5728\u670d\u52a1\u7f51\u683c\u6a21\u5f0f\u4e0b\uff0c\u4e0d\u4f7f\u7528\u4f20\u7edf\u7684 etcd \u4f5c\u4e3a\u6570\u636e\u4e2d\u5fc3\uff0c\u800c\u662f\u4f7f\u7528 shdict \u4e0e Amesh \u5e93\u76f4\u63a5\u8fdb\u884c\u6570\u636e\u4ea4\u6362\uff0c\u907f\u514d\u4e86\u989d\u5916\u7684\u6027\u80fd\u635f\u8017\uff0c\u4f7f\u5f97\u5927\u89c4\u6a21\u90e8\u7f72\u6210\u4e3a\u53ef\u80fd\u3002\\n\\n\u901a\u8fc7\u4f7f\u7528 Amesh\uff0c\u53ef\u4ee5\u5728\u670d\u52a1\u7f51\u683c\u9886\u57df\u83b7\u5f97 APISIX \u5177\u5907\u7684\u9ad8\u6027\u80fd\u3001\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3001\u6613\u6269\u5c55\u6027\u7b49\u591a\u79cd\u4f18\u52bf\u3002\\n\\n### Amesh \u7684\u67b6\u6784\\n\\nAmesh \u901a\u8fc7\u9002\u914d xDS \u534f\u8bae\uff0c\u53ef\u4ee5\u8ba9 APISIX \u66ff\u4ee3 Istio \u6240\u4f7f\u7528\u7684 envoy \u7ec4\u4ef6\u6765\u63a5\u7ba1\u96c6\u7fa4\u6d41\u91cf\u3002\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0cAPISIX \u5c06\u4f5c\u4e3a Pod \u7684 Sidecar \u63a5\u7ba1\u7f51\u683c\u5185\u7684\u6240\u6709\u6d41\u91cf\u3002\u76ee\u524d Amesh \u7684\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![Amesh \u67b6\u6784](https://static.apiseven.com/uploads/2023/01/19/99lIgVfj_image42fix.png)\\n\\n\u901a\u8fc7\u67b6\u6784\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7 xDS \u534f\u8bae\uff0cAmesh \u53ef\u4ee5\u5c06 Istio \u4f5c\u4e3a\u63a7\u5236\u9762\uff0c\u4ece Istio \u4fa7\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\uff0c\u5e76\u5c06\u5176\u8f6c\u4e49\u4e3a APISIX \u6240\u9700\u7684\u914d\u7f6e\u3002\\n\\n\u800c\u7f51\u683c\u5185\u90e8\u7684\u6240\u6709\u6d41\u91cf\u90fd\u5c06\u7531 APISIX \u63a5\u7ba1\u3002\u5176\u4e2d\uff0cAPISIX \u7684\u914d\u7f6e\u4e2d\u5fc3\u88ab\u8bbe\u7f6e\u4e3a Amesh\uff0c\u8fd9\u4f7f\u5f97 APISIX \u8131\u79bb etcd \u7684\u4f9d\u8d56\u3002Amesh \u4e3a APISIX \u63d0\u4f9b\u4e86\u4e00\u79cd\u4ece xDS \u534f\u8bae\u4e2d\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\u7684\u65b9\u5f0f\u3002\\n\\n\u6b64\u5916\uff0cAmesh \u5728 v0.2 \u4e2d\u63d0\u4f9b\u4e86\u989d\u5916\u7684\u53ef\u9009\u63a7\u5236\u9762\u7ec4\u4ef6\uff1a`amesh-controller` \uff0c\u5b83\u589e\u52a0\u4e86 Amesh \u4e13\u7528\u7684 CRD\uff0c\u53ef\u4ee5\u4e3a APISIX \u914d\u7f6e\u4e00\u4e9b Istio \u6240\u4e0d\u652f\u6301\u7684\u989d\u5916\u529f\u80fd\u3002\u989d\u5916\u5e26\u6709 `amesh-controller` \u7684\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![amesh-controller \u67b6\u6784](https://static.apiseven.com/uploads/2023/01/19/AQCRwtA8_image43fix.png)\\n\\n\u6b63\u5982\u524d\u6587\u6240\u63d0\u5230\u7684\uff0c`amesh controller` \u662f\u53ef\u9009\u7ec4\u4ef6\u3002\u5728\u672a\u5b89\u88c5\u65f6\uff0cAmesh \u4e5f\u80fd\u6b63\u5e38\u4f7f\u7528 Istio \u7684\u539f\u751f\u80fd\u529b\u63d0\u4f9b\u670d\u52a1\u3002\u5728\u5b89\u88c5\u4e86 amesh-controller \u540e\uff0cAmesh \u80fd\u81ea\u52a8\u68c0\u6d4b\u5230\u63a7\u5236\u9762\u7684\u52a0\u5165\uff0c\u5e76\u52a8\u6001\u5730\u4ece\u4e2d\u83b7\u53d6\u914d\u7f6e\uff0c\u800c\u65e0\u9700\u91cd\u542f\u3002\\n\\n`amesh-controller` \u4e3a Amesh \u63d0\u4f9b\u4e86 Istio \u65e0\u6cd5\u63d0\u4f9b\u7684 APISIX \u7279\u6709\u529f\u80fd\u3002\u4f8b\u5982\u5728\u5b89\u88c5 `amesh-controller` \u540e\uff0c\u7528\u6237\u80fd\u4e3a\u670d\u52a1\u914d\u7f6e APISIX \u539f\u751f\u5177\u5907\u7684\u6d77\u91cf\u63d2\u4ef6\u3002\\n\\n## Amesh \u53d1\u5c55\u72b6\u6001\\n\\n\u76ee\u524d Amesh \u9879\u76ee\u6b63\u5728\u79ef\u6781\u5f00\u53d1\u4e2d\u3002\u5728\u6700\u8fd1\u53d1\u5e03\u7684\u7684 v0.2 \u7248\u672c\u4e2d\uff0cAmesh \u65b0\u589e\u4e86\u53ef\u9009\u7684\u63a7\u5236\u9762 `amesh-controller` \u7ec4\u4ef6\uff0c\u4e3a Amesh \u63d0\u4f9b\u4e86 APISIX \u6240\u652f\u6301\u7684\u5f3a\u5927\u7684\u63d2\u4ef6\u7cfb\u7edf\uff0c\u5927\u5927\u589e\u5f3a\u4e86 Amesh \u7684\u53ef\u6269\u5c55\u6027\u3002\\n\\n### \u6269\u5c55\u80fd\u529b\\n\\n\u5728\u4f7f\u7528 Amesh \u65f6\uff0c\u5982\u679c\u662f\u5e38\u89c4\u7684 Istio \u90e8\u7f72\uff0c\u7528\u6237\u5219\u53ef\u4ee5\u901a\u8fc7 Lua \u6216 Wasm \u6765\u5bf9 Envoy \u8fdb\u884c\u529f\u80fd\u6269\u5c55\u3002\\n\\n\u4e0e Envoy \u539f\u751f\u80fd\u529b\u76f8\u6bd4\uff0cAPISIX \u5b98\u65b9\u5373\u652f\u6301\u63d2\u4ef6\u6269\u5c55\u80fd\u529b\uff0c\u7ef4\u62a4\u4e86 80+ \u7684\u63d2\u4ef6\u53ef\u4f9b\u7528\u6237\u4f7f\u7528\uff0c\u8bb8\u591a\u529f\u80fd\u5df2\u7ecf\u539f\u751f\u96c6\u6210\u3002\u4f46\u7531\u4e8e\u5728 Istio \u4e2d\uff0c\u4e0d\u80fd\u5bf9\u8fd9\u4e9b\u63d2\u4ef6\u8fdb\u884c\u914d\u7f6e\uff0c\u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u63d2\u4ef6\u6240\u63d0\u4f9b\u7684\u80fd\u529b\u3002\\n\\n\u4e3a\u6b64\uff0cAmesh v2.0 \u7248\u672c\u65b0\u589e\u4e86\u4e00\u4e2a\u63a7\u5236\u9762\u7ec4\u4ef6\uff0c\u5373\u524d\u6587\u63d0\u5230\u7684 `amesh-controller`\u3002\u5b83\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u914d\u7f6e APISIX \u63d2\u4ef6\u7684\u80fd\u529b\uff0c\u4f7f APISIX \u4f17\u591a\u7684\u63d2\u4ef6\u5728\u670d\u52a1\u7f51\u683c\u573a\u666f\u4e0b\u4e5f\u80fd\u5f00\u7bb1\u5373\u7528\uff0c\u800c\u65e0\u9700\u7528\u6237\u8fdb\u884c\u81ea\u5b9a\u4e49\u7684\u5f00\u53d1\u3002\\n\\n### \u5e94\u7528\u793a\u4f8b\\n\\n\u5728 Amesh v0.2 \u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b89\u88c5 `amesh-controller` \u5e76\u4f7f\u7528\u63d0\u4f9b\u7684 `AmeshPluginConfig` CRD \u6765\u8fdb\u884c APISIX \u7684\u63d2\u4ef6\u914d\u7f6e\u3002\\n\\n\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3a\u8bf7\u6c42\u7684\u54cd\u5e94\u6dfb\u52a0\u7279\u5b9a\u7684 header\uff0c\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e APISIX \u7684 `response-rewrite` \u63d2\u4ef6\u5b9e\u73b0\u3002\\n\\n\u5047\u8bbe\u6211\u4eec\u9700\u8981\u6dfb\u52a0\u7684 header \u4e3a `X-Header`\uff0c\u5176\u503c\u4e3a `AddedHeader`\uff0c\u6211\u4eec\u53ef\u4ee5\u914d\u7f6e\u5982\u4e0b\u7684 `AmeshPluginConfig`\uff0c\u6b64\u65f6\u8bf7\u6c42\u7684\u54cd\u5e94\u4e2d\u5c31\u4f1a\u5e26\u4e0a\u6211\u4eec\u6240\u9700\u7684 header\u3002\\n\\n```YAML\\napiVersion: apisix.apache.org/v1alpha1\\nkind: AmeshPluginConfig\\nmetadata:\\n  name: ampc-sample\\nspec:\\n  plugins:\\n    - name: response-rewrite\\n      config: \'{\\"headers\\": {\\"X-Header\\":\\"AddedHeader\\"}}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u5728\u672c\u6587\u4e2d\uff0c\u6211\u4eec\u7b80\u5355\u4ecb\u7ecd\u4e86 [Amesh](https://github.com/api7/amesh) \u7684\u67b6\u6784\uff0c\u4ee5\u53ca\u5728 v0.2 \u7248\u672c\u4e2d\u63d0\u4f9b\u7684 `amesh-controller` \u6240\u5e26\u6765\u7684\u67b6\u6784\u53d8\u66f4\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u5e2e\u52a9\u7528\u6237\u7406\u89e3 Amesh \u7684\u5de5\u4f5c\u539f\u7406\u3002\\n\\n\u5728\u5f53\u4e0b\u6280\u672f\u53d1\u5c55\u8d8b\u52bf\u4e2d\uff0c\u670d\u52a1\u7f51\u683c\u52bf\u5fc5\u662f\u672a\u6765\u7684\u6d41\u884c\u8d8b\u52bf\u3002\u867d\u7136\u73b0\u5728\u5404\u79cd\u65b9\u6848\u90fd\u8fd8\u4e0d\u592a\u5b8c\u5584\uff0c\u4f46\u6574\u4f53\u90fd\u5c5e\u4e8e\u87ba\u65cb\u4e0a\u5347\u7684\u72b6\u6001\u3002\u5f53\u7136\uff0c\u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u4e5f\u6b63\u671d\u7740\u5927\u5bb6\u5fc3\u76ee\u4e2d\u7684\u7406\u60f3\u578b\u670d\u52a1\u7f51\u683c\u89e3\u51b3\u65b9\u6848\u594b\u8fdb\uff0c\u4e5f\u6b22\u8fce\u5404\u4f4d\u5bf9 APISIX \u670d\u52a1\u7f51\u683c\u65b9\u6848\u611f\u5174\u8da3\u7684\u670b\u53cb\u4eec\u8fdb\u884c\u5c1d\u9c9c\u3002"},{"id":"\u4e3a\u4ec0\u4e48 APISIX Ingress \u662f\u6bd4 Ingress NGINX \u66f4\u597d\u7684\u9009\u62e9\uff1f","metadata":{"permalink":"/zh/blog/2023/01/11/apisix-ingress-vs-ingress-nginx","source":"@site/blog/2023/01/11/apisix-ingress-vs-ingress-nginx.md","title":"\u4e3a\u4ec0\u4e48 APISIX Ingress \u662f\u6bd4 Ingress NGINX \u66f4\u597d\u7684\u9009\u62e9\uff1f","description":"\u672c\u6587\u5c06\u4f1a\u5bf9\u6bd4\u4e24\u4e2a\u6bd4\u8f83\u6d41\u884c\u7684 Ingress controller \u5b9e\u73b0\uff0c\u5e0c\u671b\u80fd\u5bf9\u8bfb\u8005\u8fdb\u884c Ingress controller \u9009\u578b\u4e2d\u6709\u6240\u5e2e\u52a9\u3002","date":"2023-01-11T00:00:00.000Z","formattedDate":"2023\u5e741\u670811\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":17.12,"truncated":true,"authors":[{"name":"\u5bb9\u946b","title":"Author","url":"https://github.com/AlinsRan","image_url":"https://github.com/AlinsRan.png","imageURL":"https://github.com/AlinsRan.png"}],"prevItem":{"title":"\u57fa\u4e8e APISIX \u7684\u670d\u52a1\u7f51\u683c\u65b9\u6848 Amesh \u79ef\u6781\u5f00\u53d1\u4e2d\uff01","permalink":"/zh/blog/2023/01/11/apisix-amesh-introduction"},"nextItem":{"title":"Apache APISIX Ingress 1.6 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2023/01/10/release-apisix-ingress-1.6"}},"content":"> \u672c\u6587\u5c06\u4f1a\u5bf9\u6bd4\u4e24\u4e2a\u6bd4\u8f83\u6d41\u884c\u7684 Ingress controller \u5b9e\u73b0\uff0c\u5e0c\u671b\u80fd\u5bf9\u8bfb\u8005\u8fdb\u884c Ingress controller \u9009\u578b\u4e2d\u6709\u6240\u5e2e\u52a9\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005\u5bb9\u946b\uff0cAPI7.ai \u4e91\u539f\u751f\u6280\u672f\u5de5\u7a0b\u5e08\uff0cApache APISIX Committer\u3002\\n\\n\u672c\u6587\u5c06\u4f1a\u5bf9\u6bd4\u4e24\u4e2a\u6bd4\u8f83\u6d41\u884c\u7684 Ingress controller \u5b9e\u73b0\uff0c\u5e0c\u671b\u80fd\u5bf9\u8bfb\u8005\u8fdb\u884c Ingress controller \u9009\u578b\u4e2d\u6709\u6240\u5e2e\u52a9\u3002\\n\\n>[Ingress NGINX](https://github.com/kubernetes/ingress-nginx) \u662f Kubernetes \u793e\u533a\u5b9e\u73b0\u7684 Ingress controller\uff0c\u5728\u793e\u533a\u4e2d\u88ab\u5e7f\u6cdb\u4f7f\u7528\u3002[Apache APISIX Ingress](https://github.com/apache/apisix-ingress-controller) \u5219\u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0b\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u4f7f\u7528 APISIX \u4f5c\u4e3a\u6570\u636e\u9762\u7684 Kubernetes Ingress controller\u3002\\n\\n## Ingress NGINX vs APISIX Ingress\\n\\n### \u529f\u80fd\u5bf9\u6bd4\\n\\n\u4e0b\u5217\u8868\u683c\u4e2d\uff0c\u5bf9\u6bd4\u4e86 Ingress NGINX \u548c APISIX Ingress \u57fa\u672c\u529f\u80fd\uff0c\u5305\u62ec\u534f\u8bae\u652f\u6301\u3001\u9274\u6743\u65b9\u5f0f\u3001\u4e0a\u6e38\u63a2\u9488/\u7b56\u7565\u3001\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u3001Kubenertes \u96c6\u6210\u7b49\u3002\u4ee5\u4e0b\u8868\u683c\u6570\u636e\u53d6\u81ea [learnk8s.io](https://docs.google.com/spreadsheets/d/191WWNpjJ2za6-nbG4ZoUMXMpUK8KlCIosvQB0f-oq3k)\u3002\\n\\n| Product/Project               |                                | Ingress NGINX             | Apache APISIX Ingress |\\n| :---------------------------- | :----------------------------- | :------------------------ | :-------------------- |\\n| 1. General info               |                                |                           |                       |\\n|                               | Based on                       | nginx                     | nginx                 |\\n| 2. Protocols                  |                                |                           |                       |\\n|                               | HTTP/HTTPS                     | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | HTTP2                          | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | gRPC                           | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | TCP                            | Partial                   | \u2714\ufe0f                     |\\n|                               | TCP+TLS                        | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n|                               | UDP                            | Partial                   | \u2714\ufe0f                     |\\n|                               | Websockets                     | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Proxy Protocol                 | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | QUIC/HTTP3                     | Preview                   | Preview               |\\n| 3. Clients                    |                                |                           |                       |\\n|                               | Rate limiting (L7)             | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | WAF                            | \u2714\ufe0f                         | Partial               |\\n|                               | Timeouts                       | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Safe-list/Block-list           | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Authentication                 | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Authorisation                  | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n| 4. Traffic routing            |                                |                           |                       |\\n|                               | Host                           | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Path                           | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Headers                        | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Querystring                    | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Method                         | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | ClientIP                       | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n| 5. Upstream probes/resiliency |                                |                           |                       |\\n|                               | Healthchecks                   | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n|                               | Retries                        | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Circuit Breaker                | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n| 6.Load balancer strategies    |                                |                           |                       |\\n|                               | Round robin                    | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Sticky sessions                | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Least connections              | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n|                               | Ring hash                      | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Custom load balancing          | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n| 7. Authentication             |                                |                           |                       |\\n|                               | Basic auth                     | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | External Auth                  | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Client certificate - mTLS      | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | OAuth                          | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | OpenID                         | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n|                               | JWT                            | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n|                               | LDAP                           | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n|                               | HMAC                           | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n| 8. Observability              |                                |                           |                       |\\n|                               | Logging                        | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Metrics                        | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Tracing                        | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n| 9. Kubernetes Integration     |                                |                           |                       |\\n|                               | State                          | Kubernetes                | Kubernetes            |\\n|                               | CRD                            | \u2716\ufe0e                         | \u2714\ufe0f                     |\\n|                               | Scope                          | Clusterwide<br/>namespace | namespace             |\\n|                               | Support for the Gateway API    | \u2716\ufe0e                         | Preview               |\\n|                               | Integrates with service meshes | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n| 10. Traffic shaping           |                                |                           |                       |\\n|                               | Canary                         | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Session Affinity               | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Traffic Mirroring              | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n| 11. Other                     |                                |                           |                       |\\n|                               | Hot reloading                  | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | LetsEncrypt Integration        | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Wildcard certificate support   | \u2714\ufe0f                         | \u2714\ufe0f                     |\\n|                               | Configure hot reloading        | Preview                   | \u2714\ufe0f                     |\\n|                               | Service Discovery              | \u2716                         | \u2714\ufe0f                     |\\n\\n### \u529f\u80fd\u5dee\u5f02\\n\\n\u901a\u8fc7\u4e0b\u56fe\uff0c\u53ef\u4ee5\u7c97\u7565\u770b\u5230 APISIX Ingress \u5185\u7f6e\u7684\u529f\u80fd\u548c\u7279\u6027\u76f8\u6bd4 Ingress NGINX \u66f4\u52a0\u4e30\u5bcc\uff0c\u5176\u4e2d\u5305\u62ec\u670d\u52a1\u53d1\u73b0\u3001\u534f\u8bae\u652f\u6301\u3001\u8ba4\u8bc1\u9274\u6743\u7b49\u7b49\u3002\\n\\n![\u529f\u80fd\u5dee\u5f02](https://static.apiseven.com/uploads/2023/01/11/xCr4lsN2_1077243769.png)\\n\\n### \u670d\u52a1\u53d1\u73b0\\n\\n\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u5e94\u7528\u88ab\u62c6\u5206\u4e3a\u5f88\u591a\u5fae\u670d\u52a1\uff0c\u65e0\u8bba\u662f\u5fae\u670d\u52a1\u6545\u969c\uff0c\u8fd8\u662f\u5bf9\u5e94\u7528\u670d\u52a1\u8fdb\u884c\u6269\u7f29\u5bb9\uff0c\u90fd\u9700\u8981\u5c3d\u5feb\u7684\u901a\u77e5\u5230\u8c03\u7528\u65b9\uff0c\u4ee5\u514d\u8c03\u7528\u5931\u8d25\u3002\u56e0\u6b64\uff0c\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u670d\u52a1\u6ce8\u518c\u548c\u53d1\u73b0\u673a\u5236\u5c31\u663e\u5f97\u5f88\u91cd\u8981\u4e86\uff0c\u901a\u5e38\u8fd9\u4f1a\u901a\u8fc7\u6ce8\u518c\u4e2d\u5fc3\u6765\u5b8c\u6210\u3002\\n\\n| Service Discovery | Ingress NGINX | Apache APISIX Ingress |\\n| :---------------- | :------------ | :-------------------- |\\n| Kubernetes        | \u2714\ufe0f             | \u2714\ufe0f                     |\\n| DNS               | \u2716             | \u2714\ufe0f                     |\\n| nacos             | \u2716             | \u2714\ufe0f                     |\\n| exureka           | \u2716             | \u2714\ufe0f                     |\\n| consul_kv         | \u2716             | \u2714\ufe0f                     |\\n\\n### \u534f\u8bae\u652f\u6301\\n\\n\u4e24\u8005\u90fd\u5bf9 HTTP/HTTPS \u534f\u8bae\u63d0\u4f9b\u5b8c\u6574\u652f\u6301\uff0cAPISIX Ingress \u5728\u534f\u8bae\u652f\u6301\u4e0a\u66f4\u4e30\u5bcc\u4e00\u4e9b\uff0c\u80fd\u591f\u7684\u4f7f\u7528 TLS \u6765\u52a0\u5bc6 TCP \u6d41\u91cf\uff0c\u8fd8\u652f\u6301 [MQTT](https://apisix.apache.org/docs/apisix/plugins/mqtt-proxy/)\u3001[Dubbo](https://apisix.apache.org/docs/apisix/plugins/dubbo-proxy/)\u3001[Kafka](https://apisix.apache.org/docs/apisix/plugins/kafka-proxy/) \u7b49\u534f\u8bae\u8fdb\u884c\u4ee3\u7406\u3002\\n\\n### \u670d\u52a1\u6cbb\u7406\u80fd\u529b\\n\\n#### \u5065\u5eb7\u68c0\u67e5\\n\\n\u5728\u540e\u7aef\u8282\u70b9\u6545\u969c\u6216\u8005\u8fc1\u79fb\u65f6\uff0c\u4e0d\u53ef\u907f\u514d\u4f1a\u51fa\u73b0\u8282\u70b9\u4e0d\u53ef\u7528\u7684\u60c5\u51b5\u3002\u5982\u679c\u5927\u91cf\u8bf7\u6c42\u8bbf\u95ee\u5230\u4e86\u8fd9\u4e9b\u4e0d\u53ef\u7528\u7684\u8282\u70b9\u65f6\uff0c\u5c06\u4f1a\u9020\u6210\u6d41\u91cf\u635f\u5931\uff0c\u5bfc\u81f4\u4e1a\u52a1\u4e2d\u65ad\u3002\u56e0\u6b64\uff0c\u9700\u8981\u5bf9\u8282\u70b9\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\uff0c\u901a\u8fc7\u63a2\u9488\u7684\u5f62\u5f0f\u63a2\u6d4b\u540e\u7aef\u8282\u70b9\u7684\u53ef\u7528\u6027\uff0c\u5c06\u8bf7\u6c42\u4ee3\u7406\u5230\u5065\u5eb7\u7684\u8282\u70b9\uff0c\u4ece\u800c\u51cf\u5c11\u6216\u907f\u514d\u6d41\u91cf\u635f\u5931\u3002\\n\\n\u5065\u5eb7\u68c0\u67e5\u7684\u80fd\u529b\u5728 Ingress NGINX \u4e2d\u5c1a\u672a\u652f\u6301\uff0c\u800c APISIX Ingress \u63d0\u4f9b\u4e86\u8be5\u80fd\u529b\uff0c\u5176\u4e2d\u5305\u62ec\uff1a\\n\\n* **\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5**\uff1a\u786e\u4fdd\u540e\u7aef\u670d\u52a1\u4e2d\u7684 Pod \u5904\u4e8e\u53ef\u7528\u7684\u72b6\u6001\u3002\u5728\u5e94\u7528\u670d\u52a1\u8fdb\u884c\u6eda\u52a8\u66f4\u65b0\u65f6\uff0c\u4f1a\u7275\u626f\u5927\u91cf\u7684\u8282\u70b9\u8fdb\u884c\u66f4\u65b0\uff0c\u4e0d\u5065\u5eb7\u7684\u8282\u70b9\u5c06\u4f1a\u88ab\u8d1f\u8f7d\u5747\u8861\u5668\u5ffd\u7565\uff0c\u5f00\u542f\u5065\u5eb7\u68c0\u67e5\u80fd\u591f\u6709\u6548\u7684\u6311\u9009\u51fa\u53ef\u7528\u7684 Pod\uff0c\u907f\u514d\u6d41\u91cf\u635f\u5931\u3002\\n* **\u88ab\u52a8\u5065\u5eb7\u68c0\u67e5**\uff1a\u88ab\u52a8\u7684\u65b9\u5f0f\u65e0\u9700\u53d1\u8d77\u989d\u5916\u7684\u63a2\u9488\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u5c31\u662f\u63a2\u9488\uff0c\u82e5\u4e00\u4e2a\u5065\u5eb7\u8282\u70b9\u8fde\u7eed N \u4e2a\u8bf7\u6c42\u90fd\u88ab\u5224\u5b9a\u4e3a\u5931\u8d25\uff08\u53d6\u51b3\u4e8e\u5982\u4f55\u914d\u7f6e\uff09\uff0c\u5219\u8be5\u8282\u70b9\u5c06\u88ab\u6807\u8bb0\u4e3a\u4e0d\u5065\u5eb7\u3002\u7531\u4e8e\u65e0\u6cd5\u63d0\u524d\u611f\u77e5\u8282\u70b9\u7684\u72b6\u6001\uff0c\u53ef\u80fd\u4f1a\u6709\u4e00\u5b9a\u91cf\u7684\u5931\u8d25\u8bf7\u6c42\uff0c\u5728\u6eda\u52a8\u66f4\u65b0\u65f6\u8fd9\u79cd\u60c5\u51b5\u4f1a\u76f8\u5bf9\u5e38\u89c1\uff0c\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u964d\u7ea7\u6765\u907f\u514d\u5931\u8d25\u7684\u8bf7\u6c42\u91cf\u3002\\n\\n\u5982\u4e0b\u662f APISIX Ingress \u4e3a httpbin \u670d\u52a1\u914d\u7f6e\u5065\u5eb7\u68c0\u67e5\u793a\u4f8b\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v2\\nkind: ApisixUpstream\\nmetadata:\\nname: httpbin\\nspec:\\nhealthCheck:\\npassive:\\nunhealthy:\\nhttpCodes:\\n- 500\\nhttpFailures: 3\\nactive:\\ntype: http\\nhttpPath: /healthz\\nhealthy:\\nsuccesses: 3\\ninterval: 2s\\nhttpCodes:\\n- 200\\n```\\n\\n#### \u670d\u52a1\u7194\u65ad\\n\\n\u6d41\u91cf\u9ad8\u5cf0\u65f6\uff0c\u7f51\u5173\u4f5c\u4e3a\u6d41\u91cf\u5165\u53e3\u5411\u540e\u7aef\u670d\u52a1\u53d1\u8d77\u8c03\u7528\uff0c\u540e\u7aef\u670d\u52a1\u6709\u53ef\u80fd\u4f1a\u4ea7\u751f\u8c03\u7528\u5931\u8d25\uff08\u8d85\u65f6\u6216\u8005\u5f02\u5e38\uff09\uff0c\u5931\u8d25\u65f6\u4e0d\u80fd\u8ba9\u8bf7\u6c42\u5806\u79ef\u5728\u7f51\u5173\u4e0a\uff0c\u9700\u8981\u5feb\u901f\u5931\u8d25\u5e76\u8fd4\u56de\u56de\u53bb\uff0c\u8fd9\u5c31\u9700\u8981\u5728\u7f51\u5173\u4e0a\u8fdb\u884c\u7194\u65ad\u3002\\n\\n\u670d\u52a1\u7194\u65ad\u7684\u529f\u80fd\u5728 Ingress NGINX \u4e2d\u5c1a\u672a\u652f\u6301\u3002\u5728 APISIX Ingress \u4e2d\u5219\u53ef\u4ee5\u901a\u8fc7 [api-breaker](https://apisix.apache.org/docs/apisix/plugins/api-breaker/) \u7194\u65ad\u63d2\u4ef6\u6765\u5b9e\u73b0\u3002\\n\\n\u5177\u4f53\u4f7f\u7528\u914d\u7f6e\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v2\\nkind: ApisixRoute\\nmetadata:\\nname: httpbin-route\\nspec:\\nhttp:\\n- name: rule1\\nmatch:\\nhosts:\\n- httpbin.org\\npaths:\\n- /status/*\\nbackends:\\n- serviceName: httpbin\\nservicePort: 80\\nplugins:\\n- name: api-breaker\\nenable: true\\nconfig:\\nbreak_response_code: 502\\nunhealthy:\\nhttp_statuses:\\n- 505\\nfailures: 2\\nhealthy:\\nhttp_statuses:\\n- 200\\nsuccesses: 2\\n```\\n\\n### \u63d2\u4ef6\u548c\u9274\u6743\u65b9\u5f0f\\n\\n\u76ee\u524d Ingress NGINX \u4e3b\u8981\u901a\u8fc7 [Annotations](https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/) \u548c [ConfigMap](https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/) \u7b49\u65b9\u5f0f\u8fdb\u884c\u914d\u7f6e\uff0c\u652f\u6301\u7684\u63d2\u4ef6\u529f\u80fd\u6bd4\u8f83\u6709\u9650\u3002\u5982\u679c\u60f3\u8981\u4f7f\u7528 JWT\u3001HAMC \u7b49\u9274\u6743\u65b9\u5f0f\uff0c\u53ea\u80fd\u81ea\u884c\u5f00\u53d1\u3002\\n\\n\u800c APISIX Ingress \u5f97\u76ca\u4e8e APISIX \u7684\u4e30\u5bcc\u529f\u80fd\uff0c\u539f\u751f\u652f\u6301 APISIX \u5185\u7f6e\u7684 [80+ \u63d2\u4ef6](https://github.com/apache/apisix/blob/master/conf/config-default.yaml#L391-L473)\uff0c\u80fd\u591f\u8986\u76d6\u5927\u90e8\u5206\u4f7f\u7528\u573a\u666f\uff0c\u8fd8\u652f\u6301 JWT\u3001HMAC\u3001wolf-rbac \u7b49\u591a\u79cd\u9274\u6743\u65b9\u5f0f\u3002\u4ee5\u4e0b\u4ec5\u5c55\u793a APISIX Ingress \u4f7f\u7528 HMAC \u8ba4\u8bc1\u5e76\u5728\u8def\u7531\u4e0a\u7684\u5e94\u7528\u793a\u4f8b\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v2\\nkind: ApisixConsumer\\nmetadata:\\nname: hmac-value\\nspec:\\nauthParameter:\\nhmacAuth:\\nvalue:\\naccess_key: papa\\nsecret_key: fatpa\\nalgorithm: \\"hmac-sha256\\"\\nclock_skew: 0\\n\\n---\\n\\napiVersion: apisix.apache.org/v2\\nkind: ApisixRoute\\nmetadata:\\nname: httpbin-route\\nspec:\\nhttp:\\n- name: rule1\\nmatch:\\nhosts:\\n- httpbin.org\\npaths:\\n- /ip\\nbackends:\\n- serviceName: httpbin\\nservicePort: 80\\nauthentication:\\nenable: true\\ntype: hmacAuth\\n```\\n\\n## Ingress NGINX \u548c APISIX Ingress \u7684\u6269\u5c55\u65b9\u5f0f\\n\\n\u9664\u4e86\u4ee5\u4e0a\u8fd9\u4e9b\u7ec6\u8282\u5bf9\u6bd4\u5916\uff0c\u4e24\u8005\u5bf9\u4e8e\u989d\u5916\u529f\u80fd\u7684\u6269\u5c55\u4e5f\u6709\u6240\u4e0d\u540c\u3002\u5f53 Ingress controller \u7684\u57fa\u7840\u529f\u80fd\u65e0\u6cd5\u6ee1\u8db3\u4f01\u4e1a\u7528\u6237\u7684\u9700\u6c42\u65f6\uff0c\u53ea\u80fd\u901a\u8fc7\u6269\u5c55\u7684\u65b9\u5f0f\u8fdb\u884c\u5b9a\u5236\u5f00\u53d1\u3002\u63a5\u4e0b\u6765\u5c06\u5177\u4f53\u4ecb\u7ecd Ingress NGINX \u548c APISIX Ingress \u5982\u4f55\u8fdb\u884c\u529f\u80fd\u6269\u5c55\u3002\\n\\n### Ingress NGINX \u5982\u4f55\u8fdb\u884c\u529f\u80fd\u6269\u5c55\\n\\nIngress NGINX \u5728\u6269\u5c55\u65b9\u5f0f\u4e0a\u6bd4\u8f83\u5355\u4e00\uff0c\u53ea\u80fd\u901a\u8fc7\u5d4c\u5165 Lua \u7a0b\u5e8f\u7684\u65b9\u5f0f\u6765\u6269\u5c55\u529f\u80fd\u3002\u6211\u4eec\u4ee5 [Ingress NGINX \u63d2\u4ef6\u5f00\u53d1](https://github.com/kubernetes/ingress-nginx/blob/main/rootfs/etc/nginx/lua/plugins/README.md)\u4e3a\u4f8b\uff0c\u5927\u6982\u9700\u8981\u4ee5\u4e0b\u6b65\u9aa4\uff1a\\n\\n1. \u7f16\u5199 Lua \u7a0b\u5e8f example-plugin\\n2. \u5c06\u63d2\u4ef6\u5b89\u88c5\u5230 ingress-nginx pod \u4e2d\u7684 `/etc/nginx/lua/plugins/<your plugin name>` \u2192 `/etc/nginx/lua/plugins/example-plugin`\\n3. \u5728 ConfigMap \u4e2d\u542f\u7528 `example-plugin` \u63d2\u4ef6\uff0c\u9700\u8981\u5728\u5b89\u88c5 Ingress NGINX \u65f6\u5f15\u7528\u6b64 ConfigMap \u5bf9\u8c61\\n\\n```yaml\\napiVersion: v1\\nkind: ConfigMap\\nmetadata:\\nname: ingress-nginx-controller\\nnamespace: ingress-nginx\\ndata:\\nplugins: \\"example-plugin\\"\\n```\\n\\n### APISIX Ingress \u5982\u4f55\u8fdb\u884c\u529f\u80fd\u6269\u5c55\\n\\nAPISIX Ingress \u63d0\u4f9b\u4e86\u591a\u79cd\u6269\u5c55\u65b9\u5f0f\uff0c\u4f01\u4e1a\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u60c5\u51b5\u81ea\u7531\u9009\u62e9\u6216\u7ec4\u5408\uff0c\u5f53\u524d\u652f\u6301\u5982\u4e0b\u62d3\u5c55\u65b9\u5f0f\uff1a\\n\\n* \u901a\u8fc7 [Lua \u8fdb\u884c\u63d2\u4ef6\u5f00\u53d1](https://apisix.apache.org/docs/apisix/plugin-develop/)\uff1a\u8fd9\u79cd\u65b9\u5f0f\u76f8\u5bf9\u7b80\u5355\uff0c\u5e76\u4e14\u51e0\u4e4e\u6ca1\u6709\u6027\u80fd\u635f\u8017\uff1b\\n* \u901a\u8fc7 plugin-runner \u5f00\u53d1\uff1a\u8fd9\u79cd\u6a21\u5f0f\u4e0b\u652f\u6301 Java/Python/Go \u7b49\u8bed\u8a00\u8fdb\u884c\u5f00\u53d1\uff0c\u8fd9\u53ef\u4ee5\u65b9\u4fbf\u7528\u6237\u5229\u7528\u4e00\u4e9b\u73b0\u6709\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u5e76\u4e14\u65e0\u9700\u5b66\u4e60\u65b0\u8bed\u8a00\uff1b\\n* \u901a\u8fc7 Wasm \u8fdb\u884c\u63d2\u4ef6\u63d2\u4ef6\uff1a\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u652f\u6301\u6784\u5efa\u51fa Wasm \u7684\u8bed\u8a00\u8fdb\u884c\u63d2\u4ef6\u5f00\u53d1\u3002\\n\\n\u6b64\u5916\u8fd8\u53ef\u4ee5\u901a\u8fc7 Serverless \u63d2\u4ef6\u6765\u76f4\u63a5\u7f16\u5199 Lua \u4ee3\u7801\uff0c\u5feb\u901f\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\u3002\\n\\n## \u4e3a\u4ec0\u4e48 APISIX Ingress \u9009\u62e9\u7ef4\u62a4 CRD\\n\\n\u76ee\u524d APISIX Ingress \u652f\u6301\u4e09\u79cd\u58f0\u660e\u5f0f\u914d\u7f6e\uff1aIngress\u3001CRD \u548c Gateway API\u3002\u8fd9\u91cc\u4e3b\u8981\u5bf9\u6bd4 Ingress \u548c CRD\uff0cGateway API \u5c06\u5728\u540e\u7eed\u5c55\u5f00\u3002\\n\\nIngress \u6bd4\u8f83\u9002\u5408\u4ece Ingress NGINX \u8fc1\u79fb\u7684\u4f01\u4e1a\u7528\u6237\uff0c\u5176\u8f6c\u6362\u6210\u672c\u8f83\u4f4e\u3002\u4f46\u7f3a\u70b9\u4e5f\u8f83\u660e\u663e\uff0c\u6bd4\u5982\u8bed\u4e49\u5316\u80fd\u529b\u5f31\u3001\u6ca1\u6709\u7ec6\u81f4\u89c4\u8303\u7b49\uff0c\u540c\u65f6\u4e5f\u53ea\u80fd\u901a\u8fc7 Annotations \u65b9\u5f0f\u6269\u5c55\uff0c\u4e14 Annotations \u65e0\u6cd5\u652f\u6491\u590d\u6742\u914d\u7f6e\u573a\u666f\u3002\u76f8\u5bf9\u7684\u4f7f\u7528 CRD \u4e3b\u8981\u6709\u4ee5\u4e0b\u597d\u5904\uff1a\\n\\n* \u66f4\u5951\u5408\u6570\u636e\u9762\u7684\u8bbe\u8ba1\u8bed\u4e49\uff0c\u66f4\u52a0\u7b80\u5355\u6613\u7528\uff1b\\n* \u4e00\u4e9b\u91cd\u8981\u914d\u7f6e\u80fd\u591f\u88ab\u590d\u7528\uff0c\u800c\u4e0d\u4f1a\u5b58\u5728\u5197\u4f59\u5e9e\u5927\u7684\u5355\u4e2a\u914d\u7f6e\uff1b\\n* \u529f\u80fd\u6027\u548c\u53ef\u6269\u5c55\u80fd\u529b\u6709\u4e86\u5de8\u5927\u63d0\u5347\uff1b\\n* \u6570\u636e\u9762 APISIX \u6709\u7740\u6d3b\u8dc3\u7684\u793e\u533a\uff0c\u66f4\u65b0\u548c\u53d1\u5e03\u7248\u672c\u5feb\uff0cCRD \u7684\u65b9\u5f0f\u80fd\u591f\u8f7b\u6613\u652f\u6301\u6570\u636e\u9762\u7684\u66f4\u591a\u80fd\u529b\uff1b\\n\\n## Ingress NGINX \u7684\u75db\u70b9\uff1a\u4e0d\u652f\u6301\u914d\u7f6e\u70ed\u52a0\u8f7d\\n\\n### \u9759\u6001\u914d\u7f6e\u5e26\u6765\u7684\u95ee\u9898\\n\\nIngress NGINX \u4e3b\u8981\u57fa\u4e8e NGINX \u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u5f0f\uff0c\u5c3d\u7ba1\u4f7f\u7528 NGINX + Lua \u6765\u5b9e\u73b0\u529f\u80fd\u6269\u5c55\uff0c\u4f46\u6ca1\u6709\u5f7b\u5e95\u89e3\u51b3\u9759\u6001\u914d\u7f6e\u6587\u4ef6\u7684\u95ee\u9898\u3002\u5728\u8def\u7531\u80fd\u529b\u548c\u52a0\u8f7d\u6a21\u5f0f\u4e0a\u7a0d\u663e\u4e0d\u8db3\uff0c\u5e76\u4e14\u5b58\u5728\u4e00\u4e9b\u660e\u663e\u52a3\u52bf\u3002\\n\\n\u6bd4\u5982\u6dfb\u52a0\u3001\u4fee\u6539\u4efb\u4f55\u65b0\u7684\u89c4\u5219\u65f6\uff0c\u9700\u8981\u91cd\u65b0\u52a0\u8f7d NGINX \u914d\u7f6e\u3002\u968f\u7740\u8d8a\u6765\u8d8a\u591a\u7684\u8def\u7531\u89c4\u5219\u548c\u8bc1\u4e66\uff0c\u5728\u89e6\u53d1\u53d8\u66f4\u65f6\uff0creload \u64cd\u4f5c\u5c06\u4f1a\u66f4\u8017\u65f6\uff0c\u751a\u81f3\u9700\u8981\u51e0\u79d2\u5230\u5341\u51e0\u79d2\u7684\u65f6\u95f4\uff0c\u5bf9\u7ebf\u4e0a\u6d41\u91cf\u7684\u5f71\u54cd\u5c06\u4f1a\u975e\u5e38\u5927\u7684\uff0c\u4f1a\u5bfc\u81f4\u6d41\u91cf\u77ed\u6682\u4e2d\u65ad\u3001\u5f71\u54cd\u54cd\u5e94\u5ef6\u8fdf\u3001\u8d1f\u8f7d\u5747\u8861\u8d28\u91cf\uff08\u6bcf\u6b21\u91cd\u65b0\u52a0\u8f7d NGINX \u90fd\u4f1a\u91cd\u7f6e\u8d1f\u8f7d\u5747\u8861\u72b6\u6001\uff09\u7b49\u3002\\n\\n### \u89e6\u53d1 NGINX \u91cd\u65b0\u52a0\u8f7d\u7684\u60c5\u51b5\\n\\n\u4ee5\u4e0b\u8fd9\u4e9b\u60c5\u51b5\uff0c\u6db5\u76d6\u4e86 Ingress controller \u5927\u91cf\u7684\u4f7f\u7528\u573a\u666f\uff1a\\n\\n* \u521b\u5efa\u65b0\u7684 Ingress \u8d44\u6e90\uff1b\\n* \u5c06TLS \u90e8\u5206\u6dfb\u52a0\u5230\u73b0\u6709 Ingress\uff1b\\n* Ingress Annotations \u7684\u53d8\u5316\u53ef\u80fd\u5f71\u54cd\u4e0a\u6e38\u914d\u7f6e\uff08\u4f8b\u5982 load-balance \u6ce8\u91ca\u4e0d\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\uff09\uff1b\\n* \u5728 Ingress \u4e2d\u6dfb\u52a0\u6216\u5220\u9664 path\uff1b\\n* Ingress\u3001Service\u3001Secret \u8d44\u6e90\u88ab\u5220\u9664\uff1b\\n* Secret \u53d1\u751f\u66f4\u65b0\u3002\\n\\n\u5728\u4e0a\u8ff0\u573a\u666f\u4e0b\uff0c\u5177\u6709\u9891\u7e41\u90e8\u7f72\u5e94\u7528\u7a0b\u5e8f\u7684\u96c6\u7fa4\u73af\u5883\u4e2d\uff0c\u4f1a\u4e0d\u65ad\u89e6\u53d1 Ingress\u3001Secret \u7b49\u8d44\u6e90\u7684\u64cd\u4f5c\uff08\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u7b49\uff09\uff0c\u5bfc\u81f4 NGINX \u91cd\u65b0\u52a0\u8f7d\u6b21\u6570\u5267\u589e\uff0c\u7ed9\u751f\u4ea7\u73af\u5883\u5e26\u6765\u4e86\u6781\u5927\u7684\u5f71\u54cd\u3002\\n\\n### \u5c0f\u7ed3\\n\\nIngress NGINX \u7684\u67b6\u6784\u51b3\u5b9a\u4e86\u5b83\u5fc5\u987b\u751f\u6210 NGINX \u914d\u7f6e\u7136\u540e\u901a\u8fc7 reload \u65b9\u5f0f\u5b8c\u6210\u914d\u7f6e\u66f4\u65b0\uff0c\u67b6\u6784\u4e0d\u8c03\u6574\u662f\u65e0\u6cd5\u89e3\u51b3\u8fd9\u4e9b\u5df2\u77e5\u95ee\u9898\u3002\u6bd4\u5982\u8def\u7531\u7684\u5b9e\u73b0\uff0cAPISIX Ingress \u5219\u4e0d\u518d\u4f9d\u8d56 NGINX \u914d\u7f6e\u6539\u4e3a\u4e86\u7eaf\u5185\u5b58\u7ed3\u6784\uff0c\u901a\u8fc7\u70ed\u66f4\u65b0\u65b9\u5f0f\u5b9e\u73b0\u52a8\u6001\u8def\u7531\uff0c\u4e0d\u518d\u9700\u8981\u91cd\u542f NGINX\u3002\\n\\n## \u4e91\u539f\u751f\u65b0\u4e00\u4ee3\u7f51\u5173\u89c4\u8303 Gateway API\\n\\n### Gateway API \u4f18\u52bf\\n\\nGateway API \u76f8\u6bd4 Ingress \u7684\u529f\u80fd\u6027\u66f4\u5f3a\uff0c\u65e8\u5728\u901a\u8fc7\u7531\u8bb8\u591a\u4f9b\u5e94\u5546\u5b9e\u73b0\u5e76\u5177\u6709\u5e7f\u6cdb\u884c\u4e1a\u652f\u6301\u7684\u5bcc\u6709\u8868\u73b0\u529b\u3001\u53ef\u6269\u5c55\u548c\u9762\u5411\u89d2\u8272\u7684\u63a5\u53e3\u6765\u53d1\u5c55 Kubernetes \u670d\u52a1\u7f51\u7edc\u3002\u5f53\u4e0b Gateway API \u5177\u6709\u5982\u4e0b\u7684\u4f18\u52bf\uff1a\\n\\n* \u9762\u5411\u89d2\u8272\uff1aGateway \u662f\u7531\u4e00\u7ec4 API \u8d44\u6e90\u7ec4\u6210\u7684\u3002\u4e0d\u540c\u7684 API \u8d44\u6e90\u4ee3\u8868\u4e86\u4f7f\u7528\u4e0e\u914d\u7f6e Kubernetes \u7f51\u7edc\u8d44\u6e90\u7684\u4e0d\u540c\u89d2\u8272\uff1b\\n* \u8868\u73b0\u529b\u5f3a\uff1aGateway API \u7684\u6838\u5fc3\u529f\u80fd\u5c31\u5305\u542b\u8bf8\u5982\u57fa\u4e8e\u5934\u7684\u5339\u914d\u3001\u6d41\u91cf\u52a0\u6743\u4ee5\u53ca\u5176\u4ed6\u5728 Ingress \u4e2d\u53ea\u80fd\u901a\u8fc7\u5404\u5b9e\u73b0\u8005\u81ea\u5b9a\u4e49\u7684\u975e\u6807\u51c6\u5316 Annotations \u7b49\u65b9\u5f0f\u5b9e\u73b0\u7684\u529f\u80fd\uff1b\\n* \u53ef\u6269\u5c55\uff1aGateway API \u5141\u8bb8\u4e0d\u540c\u8d44\u6e90\u5728\u4e0d\u540c\u5c42\u7ea7\u4e00\u540c\u4f7f\u7528\u3002\u8fd9\u4f7f\u5f97\u80fd\u591f\u5bf9 API \u7ed3\u6784\u8fdb\u884c\u66f4\u7cbe\u7ec6\u5316\u7684\u63a7\u5236\u3002\\n\\n### \u652f\u6301\u60c5\u51b5\\n\\nGateway API \u4f5c\u4e3a\u4e00\u79cd\u6269\u5c55 Kubernetes \u670d\u52a1\u7f51\u7edc\u7684\u6807\u51c6\uff0c\u5176 Gateway \u8d44\u6e90\u80fd\u591f\u5b9e\u73b0\u4f5c\u4e3a Kubernetes API \u6765\u7ba1\u7406\u7f51\u5173\u7684\u751f\u547d\u5468\u671f\uff0c\u529f\u80fd\u5341\u5206\u5f3a\u5927\u3002\u76ee\u524d\u8bb8\u591a Ingress controller \u90fd\u5728\u79ef\u6781\u652f\u6301\u5b83\uff0c\u5305\u62ec Istio\u3001Kong\u3001Traefik \u7b49\u3002\u5728\u76ee\u524d [Gateway API \u5b9e\u73b0\u60c5\u51b5](https://gateway-api.sigs.k8s.io/implementations/#implementation-status)\u4e2d\uff0c\u5f88\u9057\u61be\u7684\u662f\uff0c**Ingress NGINX \u5c1a\u672a\u8ba1\u5212\u652f\u6301 Gateway API** \u3002\u800c APISIX Ingress \u5df2\u7ecf\u652f\u6301\u4e86 Gateway API \u7684\u5927\u90e8\u5206\u7279\u6027\uff1a\u5305\u62ec HTTPRoute\u3001TCPRoute\u3001TLSRoute\u3001UDPRoute \u7b49\u3002\\n\\n## \u603b\u7ed3\\n\\n\u7ecf\u8fc7 APISIX Ingress \u4e0e Ingress NGINX \u7684\u5b8c\u6574\u5bf9\u6bd4\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e24\u8005\u57fa\u7840\u529f\u80fd\u5dee\u5f02\u4e0d\u5927\uff0c\u4e5f\u90fd\u5177\u5907\u6269\u5c55\u80fd\u529b\u3002\u4f46\u5728\u5fae\u670d\u52a1\u7684\u67b6\u6784\u4e2d\uff0cAPISIX Ingress \u5bf9\u670d\u52a1\u6cbb\u7406\u548c\u670d\u52a1\u53d1\u73b0\u7684\u652f\u6301\u66f4\u5177\u4f18\u52bf\u3002\\n\\n\u603b\u4f53\u6765\u770b\uff0c\u4e24\u6b3e\u5f00\u6e90\u8f6f\u4ef6\u5747\u975e\u5e38\u4f18\u79c0\uff0cIngress NGINX \u4e3b\u8981\u7279\u70b9\u662f\u7b80\u5355\u3001\u6613\u63a5\u5165\uff0c\u4f46\u7f3a\u70b9\u4e5f\u5341\u5206\u660e\u663e\uff1bAPISIX Ingress \u4f5c\u4e3a\u540e\u6765\u8005\u89e3\u51b3\u4e86 NGINX \u4e0d\u652f\u6301\u70ed\u52a0\u8f7d\u7684\u75db\u70b9\uff0c\u5728\u6269\u5c55\u80fd\u529b\u548c\u529f\u80fd\u4e0a\u76f8\u6bd4 Ingress NGINX \u4e5f\u5177\u6709\u5f88\u5927\u7684\u4f18\u52bf\u3002\u4ece\u9879\u76ee\u53d1\u5c55\u89d2\u5ea6\u800c\u8a00\uff0c\u652f\u6301 Gateway API \u548c CRD \u80fd\u591f\u6269\u5c55\u548c\u4e30\u5bcc Ingress controller \u57fa\u7840\u80fd\u529b\u3002\\n\\n\u5982\u679c\u8bfb\u8005\u6b63\u5728\u8fdb\u884c Ingress controller \u9009\u578b\uff0c\u503e\u5411\u4e8e\u529f\u80fd\u4e30\u5bcc\u548c\u66f4\u5f3a\u7684\u6269\u5c55\u80fd\u529b\uff0c\u63a8\u8350\u4f7f\u7528 APISIX Ingress\u3002\u5982\u679c\u53ea\u662f\u521a\u63a5\u89e6 Ingress controller\uff0c\u6ca1\u6709\u66f4\u591a\u7684\u529f\u80fd\u9700\u6c42\uff0cIngress NGINX \u4e5f\u662f\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u9009\u62e9\u3002"},{"id":"Apache APISIX Ingress 1.6 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2023/01/10/release-apisix-ingress-1.6","source":"@site/blog/2023/01/10/release-apisix-ingress-1.6.md","title":"Apache APISIX Ingress 1.6 \u6b63\u5f0f\u53d1\u5e03","description":"Apache APISIX Ingress 1.6 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u5e26\u6765\u4e86 Gateway API \u7684\u652f\u6301\uff0c\u540c\u65f6\u65b0\u589e\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u96c6\u6210\u4e0e\u4ee3\u7406\u5916\u90e8\u670d\u52a1\uff0c\u4f18\u5316\u5bf9 APISIX Ingress Controller \u7684\u4f7f\u7528\u4f53\u9a8c\u3002","date":"2023-01-10T00:00:00.000Z","formattedDate":"2023\u5e741\u670810\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":6.63,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","url":"https://github.com/tao12345666333","imageURL":"https://github.com/tao12345666333.png"}],"prevItem":{"title":"\u4e3a\u4ec0\u4e48 APISIX Ingress \u662f\u6bd4 Ingress NGINX \u66f4\u597d\u7684\u9009\u62e9\uff1f","permalink":"/zh/blog/2023/01/11/apisix-ingress-vs-ingress-nginx"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (12.19 - 1.1)","permalink":"/zh/blog/2023/01/04/weekly-report-0105"}},"content":"> Apache APISIX Ingress 1.6 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u5e26\u6765\u4e86 Gateway API \u7684\u652f\u6301\uff0c\u540c\u65f6\u65b0\u589e\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u96c6\u6210\u4e0e\u4ee3\u7406\u5916\u90e8\u670d\u52a1\uff0c\u4f18\u5316\u5bf9 APISIX Ingress Controller \u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u8ddd\u79bb\u4e0a\u4e00\u4e2a\u7248\u672c v1.5 \u53d1\u5e03\uff0c\u5df2\u7ecf\u8fc7\u4e86 3 \u4e2a\u6708\uff0c\u6211\u4eec\u5f88\u9ad8\u5174\u5730\u5ba3\u5e03 Apache APISIX Ingress v1.6 \u6b63\u5f0f\u53d1\u5e03\uff01\\n\\n\u5728\u8be5\u7248\u672c\u4e2d\uff0c\u5171\u6709 **29 \u4f4d\u8d21\u732e\u8005** \u53c2\u4e0e\u4ee3\u7801\u63d0\u4ea4\uff0c\u5176\u4e2d **17 \u4f4d\u662f\u65b0\u664b\u8d21\u732e\u8005** \uff0c\u611f\u8c22\u5927\u5bb6\u7684\u652f\u6301\u548c\u53c2\u4e0e\uff01\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/uploads/2023/01/11/7ALBS8mi_blog1.png)\\n\\n\u672c\u6b21\u53d1\u5e03\u7684 Apache APISIX Ingress v1.6 \u7248\u672c\u5e26\u6765\u4e86\u4f17\u591a\u65b0\u7279\u6027\uff0c\u4e3b\u8981\u96c6\u4e2d\u5728\u5bf9 Gateway API \u7684\u652f\u6301\uff0c\u540c\u65f6\u4e5f\u5728\u6269\u5c55 APISIX Ingress \u7684\u4f7f\u7528\u573a\u666f\u548c\u6613\u7528\u6027\u65b9\u9762\u7684\u63d0\u5347\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u91cd\u70b9\u7279\u6027\u7684\u4ecb\u7ecd\u3002\\n\\n## \u6269\u5c55\u5bf9 Gateway API \u7684\u652f\u6301\\n\\nGateway API \u662f Kubernetes \u4e2d\u4e0b\u4e00\u4ee3\u7684 Ingress \u89c4\u8303\uff0c\u81f4\u529b\u4e8e\u63d0\u4f9b\u5bcc\u6709\u8868\u73b0\u529b\uff0c\u53ef\u6269\u5c55\u548c\u9762\u5411\u89d2\u8272\u7684\u63a5\u53e3\u6765\u53d1\u5c55 Kubernetes \u7684\u7f51\u7edc\uff0c\u5404\u4e2a Ingress controller \u9879\u76ee\u90fd\u5728\u79ef\u6781\u63a8\u8fdb\u5bf9\u8be5\u89c4\u8303\u7684\u652f\u6301\u3002Apache APISIX Ingress \u9879\u76ee\u81ea 2021 \u5e74\u5f00\u59cb\u5c31\u5728\u79ef\u6781\u5730\u7d27\u8ddf\u4e0a\u6e38\u793e\u533a\u7684\u53d1\u5c55\uff0c\u5e76\u79ef\u6781\u63a8\u8fdb Gateway API \u5728 APISIX Ingress \u9879\u76ee\u4e2d\u7684\u5b9e\u73b0\u3002\\n\\n![Gateway API](https://static.apiseven.com/uploads/2023/01/11/ru9yoUrn_blog2.png)\\n\\n\u5f53\u524d\uff0cApache APISIX Ingress \u9879\u76ee\u4e2d\u901a\u8fc7 Gateway API \u8fdb\u884c\u914d\u7f6e\u7684\u7279\u6027\u5c1a\u5904\u4e8e beta \u9636\u6bb5\uff0c\u6b22\u8fce\u5927\u5bb6\u5728\u6d4b\u8bd5\u73af\u5883\u4e2d\u79ef\u6781\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5e76\u63d0\u4f9b\u53cd\u9988\uff0c\u6211\u4eec\u5c06\u6301\u7eed\u7684\u5bf9\u6b64\u7279\u6027\u8fdb\u884c\u4f18\u5316\u548c\u6539\u8fdb\uff0c\u5c3d\u65e9\u5b8c\u6210\u6b64\u7279\u6027\u7684 GA\u3002\\n\\n\u5728 APISIX Ingress v1.6 \u7248\u672c\u4e2d\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86\u5bf9 Gateway API \u4e2d\u7684 `TCPRoute` \u548c `UDPRoute` \u8fd9\u4e24\u79cd\u8d44\u6e90\u7684\u652f\u6301\u3002\u540c\u65f6\uff0c\u6269\u5c55\u4e86\u5bf9 `HTTPRoute` \u8d44\u6e90\u4e2d `Filters` \u7684\u652f\u6301\uff0c\u8fd9\u6837\u7528\u6237\u5728\u4f7f\u7528 `HTTPRoute` \u8d44\u6e90\u65f6\uff0c\u5c31\u53ef\u4ee5\u5728\u8be5\u8d44\u6e90\u4e2d\u5e94\u7528\u4e00\u4e9b\u91cd\u5b9a\u5411\u3001Header \u6539\u5199\u7b49\u80fd\u529b\u4e86\u3002\\n\\n\u4f8b\u5982\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u914d\u7f6e\uff1a\\n\\n```YAML\\napiVersion: gateway.networking.k8s.io/v1alpha2\\nkind: HTTPRoute\\nmetadata:\\n  name: http-route\\nspec:\\n  hostnames: [\\"httpbin.org\\"]\\n  rules:\\n  - matches:\\n    - path:\\n        type: PathPrefix\\n        value: /headers\\n    filters:\\n    - type: RequestHeaderModifier\\n      requestHeaderModifier:\\n        add:\\n        - name: X-Api-Version\\n          value: v1\\n        - name: X-api-key\\n          value: api-value\\n        set:\\n        - name: X-Auth\\n          value: filter\\n        remove:\\n        - Remove-header\\n    backendRefs:\\n    - name: httpbin\\n      port: 80\\n```\\n\\n\u901a\u8fc7\u4f7f\u7528\u6b64\u914d\u7f6e\uff0c\u5ba2\u6237\u7aef\u5728\u5bf9 [httpbin.org](httpbin.org) \u8fdb\u884c\u8bf7\u6c42\u65f6\uff0c\u5c06\u4f1a\u6dfb\u52a0 `\\"X-Api-Version\\": \\"v1\\"` \u548c `\\"X-Api-Key\\": \\"api-value\\"` \u7684\u8bf7\u6c42\u5934\uff0c\u5e76\u5c06 `\\"X-Auth\\"` \u8bf7\u6c42\u5934\u7684\u503c\u8bbe\u7f6e\u4e3a `filter` \uff0c\u540c\u65f6\u5c06\u79fb\u9664 `\\"Remove-Header\\"` \u8fd9\u4e2a\u8bf7\u6c42\u5934\u3002\\n\\n## \u652f\u6301\u4e0e\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u7684\u96c6\u6210\\n\\nKubernetes \u4e2d\u9ed8\u8ba4\u662f\u4f7f\u7528\u57fa\u4e8e DNS \u7684\u670d\u52a1\u53d1\u73b0\u673a\u5236\uff0c\u4f46\u662f\u5e94\u7528\u5728\u8fc1\u79fb\u548c\u6539\u9020\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5e76\u975e\u6240\u6709\u7684\u4e1a\u52a1\u90fd\u4f1a\u9009\u62e9\u6539\u9020\u6210\u57fa\u4e8e DNS \u7684\u8fd9\u79cd\u670d\u52a1\u53d1\u73b0\u673a\u5236\uff0c\u4ecd\u7136\u6709\u5927\u91cf\u5fae\u670d\u52a1\u67b6\u6784\u7684\u5e94\u7528\u4f1a\u7ee7\u7eed\u4f7f\u7528\u539f\u6709\u7684\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\u7ec4\u4ef6\uff0c\u6bd4\u5982 Consul\uff0cNacos\uff0cEureka \u7b49\u3002\\n\\n\u4e3a\u4e86\u5c06 APISIX Ingress \u6253\u9020\u6210\u4e00\u6b3e\u66f4\u52a0\u597d\u7528\u7684 Ingress controller\uff0c\u6211\u4eec\u5728 v1.6 \u7248\u672c\u4e2d\u65b0\u589e\u4e86\u4e0e\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u96c6\u6210\u7684\u80fd\u529b\uff0c\u7528\u6237\u53ef\u4ee5\u5c06\u6ce8\u518c\u5728 Consul/Nacos/Eureka/DNS \u4e2d\u7684\u670d\u52a1\uff0c\u901a\u8fc7 APISIX Ingress \u66b4\u9732\u51fa\u6765\uff0c\u65e0\u8bba\u662f\u5357\u5317\u5411\u8fd8\u662f\u4e1c\u897f\u5411\u6d41\u91cf\u7684\u573a\u666f\u5747\u53ef\u4f7f\u7528\u3002\\n\\n\u4f8b\u5982\u901a\u8fc7\u5982\u4e0b\u914d\u7f6e\uff0c\u58f0\u660e\u8981\u4ee3\u7406\u7684\u670d\u52a1\u662f\u901a\u8fc7 Nacos \u6ce8\u518c\u7684\u540d\u4e3a `httpbin` \u7684\u670d\u52a1\u3002\\n\\n```YAML\\napiVersion: apisix.apache.org/v2\\nkind: ApisixUpstream\\nmetadata:\\n  name: httpbin-upstream\\nspec:\\n  discovery:\\n    type: nacos\\n    serviceName: httpbin\\n```\\n\\n\u7136\u540e\u5728 ApisixRoute \u8d44\u6e90\u4e2d\u5bf9\u5176\u8fdb\u884c\u5f15\u7528\u5373\u53ef\uff1a\\n\\n```YAML\\napiVersion: apisix.apache.org/v2\\nkind: ApisixRoute\\nmetadata:\\n  name: httpbin-route\\nspec:\\n  http:\\n  - name: rule1\\n    match:\\n      hosts:\\n      - local.httpbin.org\\n      paths:\\n      - /*\\n    upstreams:\\n    - name: httpbin-upstream\\n```\\n\\n\u8fd9\u6837\u5ba2\u6237\u7aef\u5728\u8bbf\u95ee\u65f6\uff0c\u5c31\u4f1a\u88ab APISIX \u4ee3\u7406\u5230 Nacos \u4e2d\u6ce8\u518c\u7684\u670d\u52a1\u4e86\u3002\u66f4\u591a\u5185\u5bb9\u53ef[\u53c2\u8003\u6587\u6863](https://apisix.apache.org/docs/ingress-controller/tutorials/external-service-discovery/)\u3002\\n\\n## \u652f\u6301\u4ee3\u7406\u5916\u90e8\u670d\u52a1\\n\\n\u4e0e\u4e0a\u8ff0\u529f\u80fd\u7c7b\u4f3c\uff0cApache APISIX Ingress v1.6 \u7248\u672c\u4e2d\u8fd8\u6dfb\u52a0\u4e86\u5bf9\u5916\u90e8\u670d\u52a1\u4ee3\u7406\u7684\u80fd\u529b\u3002\u4e3b\u8981\u662f\u4e3a\u4e86\u4fbf\u4e8e\u7528\u6237\u5bf9\u4e00\u4e9b\u6ca1\u6709\u90e8\u7f72\u5728 Kubernetes \u4e2d\u7684\u5916\u90e8\u670d\u52a1\u8fdb\u884c\u4ee3\u7406\u3002\\n\\n\u6700\u5178\u578b\u7684\u573a\u666f\u6bd4\u5982\u8bf4\u6d88\u606f\u63a8\u9001\u3002\u4e1a\u52a1\u4e3a\u4e86\u4fdd\u969c\u670d\u52a1\u7684\u9ad8\u53ef\u7528\uff0c\u901a\u5e38\u4f1a\u9009\u62e9\u591a\u5bb6\u4f9b\u5e94\u5546\u63d0\u4f9b\u670d\u52a1\uff0c\u4f46\u4f9b\u5e94\u5546\u4e5f\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e00\u4e9b\u5f02\u5e38\u7684\u60c5\u51b5\u3002\u8fd9\u79cd\u65f6\u5019\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u529f\u80fd\uff0c\u5728\u591a\u4e2a\u4f9b\u5e94\u5546\u63d0\u4f9b\u7684\u670d\u52a1\u4e2d\u8fdb\u884c\u52a8\u6001\u8c03\u5ea6\u4e86\u3002\\n\\n\u6bd4\u5982\u901a\u8fc7\u5982\u4e0b\u914d\u7f6e\u8bbe\u7f6e\u4e24\u4e2a\u4f9b\u5e94\u5546\u7684\u57df\u540d\u4f5c\u4e3a\u540e\u7aef\uff1a\\n\\n```YAML\\napiVersion: apisix.apache.org/v2\\nkind: ApisixUpstream\\nmetadata:\\n  name: notify-api\\nspec:\\n  externalNodes:\\n  - type: Domain\\n    name: foo.com\\n  - type: Domain\\n    name: bar.com\\n  healthCheck:\\n    passive:\\n      unhealthy:\\n        httpCodes:\\n          - 500\\n          - 502\\n          - 503\\n          - 504\\n        httpFailures: 3\\n        timeout: 5s\\n    active:\\n      type: http\\n      httpPath: /healthz\\n      timeout: 5s\\n      healthy:\\n        successes: 3\\n        interval: 2s\\n        httpCodes:\\n          - 200\\n```\\n\\n\u7136\u540e\u5728 ApisixRoute \u8d44\u6e90\u4e2d\u8fdb\u884c\u5f15\u7528\uff1a\\n\\n```YAML\\napiVersion: apisix.apache.org/v2\\nkind: ApisixRoute\\nmetadata:\\n  name: notify-route\\nspec:\\n  http:\\n  - name: rule1\\n    match:\\n      hosts:\\n      - local.notify.app\\n      paths:\\n      - /*\\n    upstreams:\\n    - name: notify-api\\n```\\n\\n\u8fd9\u6837\uff0c\u5982\u679c\u67d0\u4e2a\u4f9b\u5e94\u5546\u7684\u670d\u52a1\u51fa\u73b0\u5f02\u5e38\uff0c\u5219\u4f1a\u6839\u636e\u5065\u5eb7\u68c0\u67e5\u7684\u89c4\u5219\u81ea\u52a8\u5730\u4ee3\u7406\u5230\u5907\u7528\u7684\u670d\u52a1\u4e0a\uff0c\u4ece\u800c\u4fdd\u969c\u4e1a\u52a1\u7684\u53ef\u7528\u6027\u3002\\n\\n\u540c\u6837\u7684\uff0c\u5982\u679c\u4e1a\u52a1\u4e2d\u5b58\u5728\u9700\u8981\u4ee3\u7406 ExternalName Service \u7684\u573a\u666f\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u8fdb\u884c\u4ee3\u7406\u3002\u66f4\u591a\u5185\u5bb9\u53ef[\u53c2\u8003\u6587\u6863](https://apisix.apache.org/docs/ingress-controller/tutorials/external-service/)\u3002\\n\\n## \u5176\u4ed6\\n\\n\u9664\u4e86\u4e0a\u8ff0\u7684\u8fd9\u4e9b\u529f\u80fd\u5916\uff0c\u5728\u6b64\u7248\u672c\u4e2d\u8fd8\u6dfb\u52a0\u4e86\u5f88\u591a\u5176\u4ed6\u529f\u80fd\uff0c\u5305\u62ec\uff1a\\n\\n- \u652f\u6301 Ingress \u8d44\u6e90\u4e2d\u4ee3\u7406\u4e0d\u540c namespace \u4e2d\u7684\u540e\u7aef\u670d\u52a1\uff1b\\n- \u539f\u751f\u7684 MQTT \u534f\u8bae\u7684\u4ee3\u7406\u652f\u6301\uff1b\\n- \u5141\u8bb8\u4e3a 4 \u5c42\u4ee3\u7406\u6dfb\u52a0\u63d2\u4ef6\u652f\u6301\uff1b\\n- \u5141\u8bb8\u5728 ApisixRoute \u8d44\u6e90\u4e2d\u4f7f\u7528 vars \u8fdb\u884c\u6761\u4ef6\u5339\u914d\uff1b\\n- \u65e5\u5fd7\u8f6e\u8f6c\u652f\u6301\uff1b\\n\\n\u66f4\u591a\u8be6\u7ec6\u7684\u53d8\u66f4\u8bf7\u67e5\u770b Release Note\uff1ahttps://github.com/apache/apisix-ingress-controller/blob/master/CHANGELOG.md#160"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (12.19 - 1.1)","metadata":{"permalink":"/zh/blog/2023/01/04/weekly-report-0105","source":"@site/blog/2023/01/04/weekly-report-0105.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (12.19 - 1.1)","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2023-01-04T00:00:00.000Z","formattedDate":"2023\u5e741\u67084\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.995,"truncated":true,"authors":[],"prevItem":{"title":"Apache APISIX Ingress 1.6 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2023/01/10/release-apisix-ingress-1.6"},"nextItem":{"title":"2022 Apache APISIX \u5e74\u5ea6\u8bb0\u5fc6","permalink":"/zh/blog/2023/01/02/2022-summary"}},"content":"> \u4ece 2022.12.19 - 2023.1.1\uff0c\u6709 21 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 64 \u4e2a commit\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2023/01/05/63b66c807be86.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/2023/01/05/63b66c8590e1f.png)\\n\\n## Good first issue\\n\\n### Issue #1572\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1572\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u66f4\u65b0 GitHub PR \u6a21\u677f\uff0c\u5f53\u524d\u6a21\u677f\u8fc7\u4e8e\u7b80\u7ea6\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [\u66f4\u591a APISIX \u63d2\u4ef6\u539f\u751f\u652f\u6301\u6570\u636e\u52a0\u5bc6\u7279\u6027](https://github.com/apache/apisix/pull/8487)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [\u652f\u6301\u901a\u8fc7 gRPC \u534f\u8bae\u5728 NGINX \u542f\u52a8\u524d\u4e0e etcd \u4ea4\u4e92](https://github.com/apache/apisix/pull/8548)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [`consumer-restriction` \u63d2\u4ef6\u6dfb\u52a0 consumer_group_id \u5b57\u6bb5\uff0c\u4e3a Consumer \u589e\u6dfb\u66f4\u591a\u5206\u7c7b\u6761\u4ef6](https://github.com/apache/apisix/pull/8567)\uff08\u8d21\u732e\u8005\uff1a[ronething](https://github.com/ronething)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [Apache APISIX 3.1.0 \u6b63\u5f0f\u53d1\u5e03](https://apisix.apache.org/zh/blog/2022/12/30/release-apache-apisix-3.1.0/)\\n\\n    Apache APISIX 3.1.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u5e26\u6765\u5f88\u591a\u5173\u4e8e\u5b89\u5168\u5c42\u9762\u7684\u529f\u80fd\u652f\u6301\uff0c\u540c\u65f6\u65b0\u589e\u5185\u7f6e\u8c03\u8bd5\u63d2\u4ef6\uff0c\u65e8\u5728\u4f18\u5316\u5bf9 APISIX \u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\n\\n- [\u4e3a\u4ec0\u4e48 APISIX Ingress \u662f\u6bd4 Traefik \u66f4\u597d\u7684\u9009\u62e9\uff1f](https://apisix.apache.org/zh/blog/2022/12/19/apisix-ingress-better-than-traefik/)\\n\\n    \u672c\u6587\u53ef\u4ee5\u4e3a\u6b63\u5728\u9009\u578b Kubernetes Ingress Controller \u4ea7\u54c1\u7684\u7528\u6237\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002\\n\\n- [\u8ba4\u8bc1\u9274\u6743\u5bf9\u4e8e API \u7f51\u5173\u7684\u91cd\u8981\u6027](https://apisix.apache.org/zh/blog/2022/12/19/auth-apisix-gateway/)\\n\\n    \u8ba4\u8bc1\u9274\u6743\u4f5c\u4e3a API \u7f51\u5173\u4e0d\u53ef\u6216\u7f3a\u7684\u80fd\u529b\uff0c\u5df2\u7136\u6210\u4e3a\u7528\u6237\u5728\u9009\u578b API \u7f51\u5173\u65f6\u8003\u91cf\u7684\u91cd\u8981\u56e0\u7d20\u4e4b\u4e00\u3002\\n\\n- [\u805a\u7126\u4eba\u673a\u4ea4\u4e92\u667a\u80fd\u5e94\u7528\u9886\u57df\uff0cAPISIX \u5728\u5e0c\u6c83\u7f51\u5173\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/12/13/seewo-with-apache-apisix/)\\n\\n    \u968f\u7740\u6280\u672f\u7684\u98de\u901f\u53d1\u5c55\uff0c\u5728\u4eba\u9645\u4ea4\u4e92\u667a\u80fd\u9886\u57df\uff0c\u4e1a\u52a1\u9700\u6c42\u4e5f\u5bf9\u67b6\u6784\u8fed\u4ee3\u6709\u4e86\u66f4\u9ad8\u7684\u8981\u6c42\u3002\u4e3a\u4e86\u5e94\u5bf9\u65e5\u8d8b\u6210\u719f\u53ca\u5feb\u901f\u589e\u957f\u7684\u4e1a\u52a1\u73b0\u72b6\uff0c\u5e0c\u6c83\u53c8\u662f\u5982\u4f55\u5728\u7f51\u5173\u5c42\u9762\u8fdb\u884c\u8ddf\u8fdb\u7684\u5462\uff1f\\n\\n- [\u667a\u6167\u4ea4\u901a\u7cfb\u7edf\u7f51\u65b0\u7535\u6c14\uff0c\u5982\u4f55\u57fa\u4e8e APISIX \u8fed\u4ee3\u6570\u5b57\u667a\u8054\u5e73\u53f0](https://apisix.apache.org/zh/blog/2022/12/09/insigma-with-apache-apisix/)\\n\\n    \u5728\u57ce\u5e02\u667a\u80fd\u4ea4\u901a\u7684\u8986\u76d6\u8303\u56f4\u4e0b\uff0c\u5f88\u591a\u573a\u666f\u5bf9\u4e8e\u6d41\u91cf\u5904\u7406\u548c\u7cfb\u7edf\u7a33\u5b9a\u6027\u90fd\u8981\u6c42\u6781\u9ad8\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u79cd\u57ce\u5e02\u7ea7\u522b\u7684\u6570\u5b57\u667a\u80fd\u8981\u6c42\uff0c\u7f51\u65b0\u7535\u6c14\u57fa\u4e8e APISIX \u8fdb\u884c\u4e86\u7f51\u5173\u5c42\u9762\u7684\u8fed\u4ee3\u3002\\n\\n- [APISIX \u5728\u541b\u6da6\u4eba\u529b\u4e91\u539f\u751f\u5e73\u53f0\u7684\u67b6\u6784\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/12/07/junrunrenli-with-apisix/)\\n\\n    \u672c\u6587\u4ece\u541b\u6da6\u4eba\u529b\u4e1a\u52a1\u5feb\u901f\u6269\u5f20\u7684\u80cc\u666f\u5165\u624b\uff0c\u91cd\u70b9\u4ecb\u7ecd\u5f00\u6e90 API \u7f51\u5173 APISIX \u5bf9\u5176\u81ea\u7814\u5e73\u53f0\u7cfb\u7edf\u67b6\u6784\u7684\u591a\u6837\u5316\u5e94\u7528\u573a\u666f\u652f\u6301\u3002"},{"id":"2022 Apache APISIX \u5e74\u5ea6\u8bb0\u5fc6","metadata":{"permalink":"/zh/blog/2023/01/02/2022-summary","source":"@site/blog/2023/01/02/2022-summary.md","title":"2022 Apache APISIX \u5e74\u5ea6\u8bb0\u5fc6","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u793e\u533a\u5728 2022 \u5e74\u53d6\u5f97\u7684\u6210\u7ee9\u3002","date":"2023-01-02T00:00:00.000Z","formattedDate":"2023\u5e741\u67082\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":12.45,"truncated":true,"authors":[{"name":"Sylvia","url":"https://github.com/SylviaBABY","imageURL":"https://github.com/SylviaBABY.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (12.19 - 1.1)","permalink":"/zh/blog/2023/01/04/weekly-report-0105"},"nextItem":{"title":"Apache APISIX 3.1.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/12/30/release-apache-apisix-3.1.0"}},"content":"> \u672c\u6587\u5c06\u5e26\u60a8\u56de\u987e Apache APISIX \u793e\u533a\u5728 2022 \u5e74\u5728\u5404\u9886\u57df\u53d6\u5f97\u7684\u6210\u7ee9\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u65f6\u5149\u5df2\u901d\uff0c\u8f6c\u773c 2022 \u5e74\u5df2\u7136\u843d\u4e0b\u4e86\u5e37\u5e55\u3002Apache APISIX \u793e\u533a\u5728\u4f17\u591a\u5f00\u6e90\u7231\u597d\u8005\u548c\u5f00\u53d1\u8005\u7684\u966a\u4f34\u4e0b\uff0c\u53c8\u4e00\u8d77\u8d70\u8fc7\u4e86\u65b0\u7684\u56db\u5b63\u3002\\n\\n\u5728\u8fc7\u53bb\u7684\u4e00\u5e74\u4e2d\uff0c\u6211\u4eec\u7684\u5f00\u6e90\u9879\u76ee\u548c\u793e\u533a\u90fd\u53d6\u5f97\u4e86\u8bb8\u591a\u6210\u5c31\uff0c\u5e76\u5f97\u5230\u4e86\u6765\u81ea\u5168\u7403\u8303\u56f4\u7684\u5e7f\u6cdb\u5173\u6ce8\u548c\u652f\u6301\u30022022 \u5e74\uff0cAPISIX \u793e\u533a\u4ecd\u7136\u5728\u4e3a\u5168\u7403\u6280\u672f\u5f00\u53d1\u8005\u548c\u4f01\u4e1a\u63d0\u4f9b\u4f18\u8d28\u7684\u4ea7\u54c1\u4e0e\u652f\u6301\uff0c\u5e76\u4e0d\u65ad\u6539\u8fdb\u548c\u5347\u7ea7\u4ea7\u54c1\u3002\u8fd9\u4e00\u5e74\u4e2d\uff0cAPISIX \u65b0\u589e\u4e86\u8bb8\u591a\u529f\u80fd\uff0c\u5e76\u8fc8\u5165\u4e86\u5168\u65b0\u7684 3.0 \u65f6\u4ee3\uff1b\u6539\u5584\u4e86\u7528\u6237\u4f53\u9a8c\uff0c\u5e76\u5f97\u5230\u4e86\u8bb8\u591a\u4f18\u79c0\u8d21\u732e\u8005\u7684\u966a\u4f34\u4e0e\u5408\u4f5c\u3002\\n\\n\u6211\u4eec\u5e0c\u671b\u901a\u8fc7\u8fd9\u4e00\u4efd\u7eb8\u4e0a\u544a\u767d\uff0c\u5411\u5927\u5bb6\u5c55\u793a Apache APISIX \u5728\u8fc7\u53bb\u4e00\u5e74\u4e2d\u53d6\u5f97\u7684\u6210\u5c31\uff0c\u5e76\u611f\u8c22\u6240\u6709\u4e3a APISIX \u9879\u76ee\u505a\u51fa\u8d21\u732e\u7684\u4eba\u3002\\n\\n## \u8fc8\u8fdb 3.0 \u5927\u7248\u672c\uff0c\u65b0\u589e\u8d85\u591a\u5b9e\u7528\u6027\u529f\u80fd\\n\\n\u8fdb\u5165 2022 \u5e74\u540e\uff0cAPISIX \u4ece 1 \u6708\u4efd\u5f00\u59cb\u4f9d\u65e7\u4fdd\u6301\u7740\u826f\u597d\u7684\u53d1\u7248\u901f\u5ea6\u3002**\u8fd9\u4e00\u5e74\u4e2d\uff0cAPISIX \u4e00\u5171\u53d1\u5e03\u4e86 15 \u4e2a\u7248\u672c\uff0c\u6d89\u53ca 6 \u4e2a\u7248\u672c\u7684\u66f4\u8fed\uff0c\u5305\u62ec\u65e7\u7248\u672c\u7684\u7ef4\u62a4\u66f4\u65b0\u4ee5\u53ca\u6b63\u5e38\u7248\u672c\u7684\u8fed\u4ee3\u3002**\\n\\n![releases](https://static.apiseven.com/2023/01/03/63b3eaa87d7d5.png)\\n\\n\u540c\u65f6\uff0c\u5728\u4eca\u5e74 APISIX \u4e5f\u5c06\u4ea7\u54c1\u62c9\u8fdb\u4e86\u65b0\u7684 3.0 \u65f6\u4ee3\uff0c\u76ee\u524d\u5df2\u9488\u5bf9 3.x \u7cfb\u5217\u53d1\u5e03\u4e86 3 \u4e2a\u66f4\u65b0\u7248\u672c\u3002\u5728 3.0 \u7684\u6574\u4f53\u89c4\u5212\u4e2d\uff0c\u5c06\u4f1a\u9646\u7eed\u5e26\u6765\u66f4\u591a\u7684\u9488\u5bf9\u751f\u6001\u548c\u4ea7\u54c1\u4f53\u9a8c\u4e0a\u7684\u529f\u80fd\u63d0\u5347\uff0c\u4f7f APISIX \u7684\u53ef\u7528\u6027\u66f4\u4e0a\u4e00\u5c42\u697c\u3002**\u5728\u65b0\u7684\u4e00\u5e74\u4e2d\uff0cAPISIX \u4e5f\u4f1a\u4e3a\u4ea7\u54c1\u5e26\u6765\u66f4\u591a\u5b9e\u7528\u6027\u529f\u80fd\uff0c\u52a9\u529b\u4f01\u4e1a\u5728\u6570\u5b57\u5316\u8f6c\u578b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6108\u53d1\u8f7b\u677e\u3002**\\n\\n![3.0 roadmap](https://static.apiseven.com/2023/01/03/63b3eaa75f6f5.png)\\n\\n\u4ece 2019 \u5e74\u5728 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u6bd5\u4e1a\u6210\u4e3a Apache \u793e\u533a\u9876\u7ea7\u9879\u76ee\uff0c\u5230\u73b0\u5728\u4fdd\u6301\u7740\u7a33\u5b9a\u53d1\u7248\u901f\u5ea6\u548c\u6d3b\u8dc3\u793e\u533a\u6c1b\u56f4\u7684\u4e09\u5e74\u65f6\u95f4\u91cc\uff0cAPISIX \u9879\u76ee\u5728 GitHub \u4e0a\u5df2\u5f97\u5230 10K+ star \u5e76\u62e5\u6709 6 \u4ebf\u591a\u4e0b\u8f7d\u91cf\uff0ccontributor \u6570\u91cf\u5df2\u7ecf\u8d85\u8fc7 500 \u4eba\u3002\u540c\u65f6\u6bcf\u6708\u4fdd\u6301\u8d21\u732e 70+ commit\u3001\u5904\u7406 80+ issue \u7684\u54cd\u5e94\u901f\u5ea6\u3002\u9ad8\u6d3b\u8dc3\u5ea6\u7684\u793e\u533a\u6c1b\u56f4\uff0c\u6b63\u662f\u63a8\u52a8\u4ea7\u54c1\u5feb\u901f\u6210\u957f\u7684\u5173\u952e\u56e0\u7d20\u3002\\n\\n![github data](https://static.apiseven.com/2023/01/03/63b3eab9e3b22.png)\\n\\n## \u6cf5\u5165\u65b0\u9c9c\u8840\u6db2\uff0c\u6536\u83b7\u884c\u4e1a\u8ba4\u53ef\\n\\n**\u4ea7\u54c1\u5feb\u901f\u6210\u957f\u7684\u80cc\u540e\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u4e2d\u6bcf\u4e00\u4f4d\u6210\u5458\u7684\u652f\u6301\u3002** \u5728\u8fc7\u53bb\u7684\u4e00\u5e74\u4e2d\uff0cAPISIX \u7684\u8d21\u732e\u8005\u4eba\u6570\u589e\u52a0\u4e86 200 \u4eba\u5de6\u53f3\u3002\u76f8\u6bd4\u603b\u8d21\u732e\u8005\u4eba\u6570\uff0c\u8fd9\u4e00\u5e74\u7684\u589e\u957f\u76f8\u5f53\u4e8e\u603b\u4eba\u6570\u7684\u8fd1 40% \u6bd4\u4f8b\uff0c\u53ef\u89c1\u4eca\u5e74 APISIX \u6536\u83b7\u4e86\u5f00\u53d1\u8005\u4eec\u8d85\u9ad8\u7684\u70ed\u60c5\u53cd\u9988\uff0c\u5e76\u5c06\u5bf9\u5f00\u6e90\u4ea7\u54c1\u7684\u559c\u7231\u4f53\u73b0\u5728\u4e86\u793e\u533a\u8d21\u732e\u4e2d\u6765\u3002\\n\\n\u8fd9\u4e09\u5e74\u7684\u53d1\u5c55\u8fc7\u7a0b\u4e2d\uff0cAPISIX \u5f97\u5230\u4e86\u975e\u5e38\u591a\u5f00\u53d1\u8005\u7684\u80af\u5b9a\u4e0e\u8ba4\u53ef\uff0c\u4ed6\u4eec\u4e5f\u5728\u5168\u7403 20 \u591a\u4e2a\u56fd\u5bb6\u548c\u5730\u533a\u8fdb\u884c APISIX \u9879\u76ee\u7684\u5ba3\u4f20\u3002\u4e3a\u4e86\u611f\u8c22\u5404\u4f4d\u5bf9 APISIX \u793e\u533a\u7684\u559c\u7231\uff0c\u6211\u4eec\u4e5f\u4f1a\u5b9a\u671f\u4e3a\u53c2\u4e0e APISIX \u793e\u533a\u7684\u65b0\u664b\u8d21\u732e\u8005\u4eec\u8d60\u9001\u793e\u533a\u5468\u8fb9\uff0c\u4eca\u5e74\u4e5f\u662f\u4e00\u6837\u3002\\n\\n\u4e0a\u534a\u5e74\u7684\u65b0\u664b\u8d21\u732e\u8005\u6211\u4eec\u5df2\u6d3e\u53d1\u8fc7\u76f8\u5173\u5468\u8fb9\uff0c\u4e0b\u534a\u5e74\u7684\u65b0\u664b\u8d21\u732e\u8005\u793c\u7269\u4e5f\u5728\u7d27\u9523\u5bc6\u9f13\u5730\u5236\u4f5c\u4e2d\u3002\u5982\u679c\u4f60\u6709\u6536\u5230\u6765\u81ea APISIX \u793e\u533a\u7684\u76f8\u5173\u90ae\u4ef6\uff0c\u8bb0\u5f97\u586b\u5199\u4fe1\u606f\u54e6\u3002\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4e3b\u52a8\u5728 [GitHub \u9875\u9762](https://github.com/apache/apisix/blob/master/CONTRIBUTING.md)\u8fdb\u884c\u586b\u5199\uff0c\u4e4b\u540e\u5c31\u4f1a\u6709\u7cbe\u7f8e\u5468\u8fb9\u9001\u5230\u4f60\u624b\u4e0a\u3002\\n\\n![contributor](https://static.apiseven.com/2023/01/03/63b3ea8cc7637.png)\\n\\n\u9664\u4e86\u56fd\u5185\u5916\u5f00\u53d1\u8005\u7684\u8ba4\u53ef\u5916\uff0c\u4eca\u5e74 APISIX \u4e5f\u6536\u83b7\u4e86\u5f88\u591a\u4f01\u4e1a\u7ea7\u7684\u6280\u672f\u8d5e\u8a89\u3002\u6bd4\u5982\u5728\u4e92\u8054\u7f51\u4fdd\u9669\u9886\u57df\uff0c[\u4f17\u5b89\u4fdd\u9669](https://apisix.apache.org/zh/blog/2022/03/02/zhongan-usercase-with-apache-apisix/) \u5728\u6574\u4e2a DevOps \u7684\u5168\u751f\u547d\u5468\u671f\u4e2d\uff0c\u5c06 APISIX \u4f5c\u4e3a\u6d41\u91cf\u6cbb\u7406\u7684\u5173\u952e\u73af\u8282\u53bb\u5904\u7406\uff0c\u5b9e\u73b0\u4e86\u66f4\u597d\u7684\u591a\u6e20\u9053\u6d41\u91cf\u9694\u79bb\uff1b\u5728\u667a\u80fd\u6c7d\u8f66 AI \u9886\u57df\uff0c[\u5730\u5e73\u7ebf](https://apisix.apache.org/zh/blog/2022/10/28/apisix-ingress-with-horizon-ai/) \u5219\u9009\u62e9\u4e86 APISIX Ingress \u66ff\u6362 Traefik \u4f5c\u4e3a\u516c\u53f8\u7684\u7edf\u4e00\u6d41\u91cf\u7f51\u5173\uff0c\u4e30\u5bcc\u4e86\u591a\u4e91\u73af\u5883\u4e0b\u7684\u670d\u52a1\u8c03\u7528\u7b49\u529f\u80fd\uff1b\u5728\u56fd\u4ea7\u624b\u673a\u9886\u519b\u961f\u4f0d\u4e2d\uff0c[vivo](https://apisix.apache.org/zh/blog/2022/11/13/vivo-with-apache-apisix/) \u4f7f\u7528 APISIX \u66ff\u6362\u4e86\u4e4b\u524d\u4f20\u7edf\u7684 NGINX\uff0c\u540c\u65f6\u57fa\u4e8e APISIX \u8fd8\u81ea\u7814\u4e86\u5185\u90e8\u4e1a\u52a1\u914d\u7f6e\u7ba1\u7406\u7cfb\u7edf\uff0c\u5728 vivo \u4e1a\u52a1\u67b6\u6784\u7684\u5b9e\u8df5\u548c\u573a\u666f\u652f\u6301\u4e0a\u90fd\u8868\u73b0\u5f97\u5341\u5206\u51fa\u8272\u3002\\n\\n![usercase](https://static.apiseven.com/2023/01/03/63b3ead0d9004.png)\\n\\n\u5f53\u7136\uff0c\u4ee5\u4e0a\u4e5f\u4ec5\u4ec5\u53ea\u9009\u53d6\u4e86\u90e8\u5206\u4f7f\u7528 APISIX \u7684\u4f01\u4e1a\u7528\u6237\uff0c\u60f3\u8981\u4e86\u89e3\u4e0d\u540c\u884c\u4e1a\u5bf9\u4e8e APISIX \u7684\u5b9e\u8df5\uff0c\u53ef\u4ee5\u524d\u5f80 [\u793e\u533a\u5b98\u7f51](https://apisix.apache.org/zh/blog/tags/case-studies/) \u67e5\u770b\u66f4\u591a\u7ec6\u8282\u3002\\n\\n## \u6d3b\u52a8\u5f62\u5f0f\u591a\u6837\uff0c\u6301\u7eed\u8df5\u884c Apache Way\\n\\n\u5728 2022 \u5e74\u4e2d\u65ec\uff0cAPISIX \u793e\u533a\u4e3e\u529e\u4e86\u7b2c\u4e00\u6b21\u5168\u7403\u6027\u8d28\u7684\u5927\u4f1a\u2014\u2014 Apache APISIX Summit Asia 2022\u3002\u5728\u4e3a\u671f\u4e24\u5929\u7684\u6d3b\u52a8\u4e2d\uff0c\u6211\u4eec\u89c1\u8bc1\u4e86\u4e0d\u540c\u884c\u4e1a\u9886\u57df\u4e0b\u7684 APISIX \u5b9e\u8df5\u7528\u4f8b\u3002\u7531\u6765\u81ea\u817e\u8baf\u4e91\u3001\u963f\u91cc\u4e91\u3001VMware Tanzu Labs \u7b49\u9876\u7ea7\u79d1\u6280\u516c\u53f8\u7684\u5de5\u7a0b\u5e08\u4ee5\u53ca APISIX PMC \u6210\u5458\u4eec\uff0c\u5e26\u6765\u4e86\u5e72\u8d27\u6ee1\u6ee1\u53c8\u5bcc\u6709\u501f\u9274\u610f\u4e49\u7684\u6280\u672f\u5c55\u793a\u3002\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709\u8bb8\u591a\u6df1\u5165\u4f46\u6709\u8da3\u7684\u5706\u684c\u7814\u8ba8\u4f1a\uff0c\u4f17\u591a\u7684\u5f00\u6e90\u8d21\u732e\u8005\u548c\u6295\u8d44\u8005\u5c31\u6784\u5efa\u793e\u533a\u4f18\u5148\u5f00\u6e90\u8f6f\u4ef6\u7684\u539f\u56e0\u548c\u65b9\u6cd5\u5206\u4eab\u4e86\u4ed6\u4eec\u7684\u60f3\u6cd5\uff0c\u5e2e\u52a9\u7ec4\u7ec7\u548c\u4f01\u4e1a\u66f4\u597d\u5730\u7406\u89e3\u548c\u4f7f\u7528\u5f00\u6e90 API \u7ba1\u7406\u5de5\u5177\u3002\\n\\n![image (21).png](https://static.apiseven.com/2023/01/03/63b3ead14eae7.png)\\n\\n\u4eca\u5e74\u867d\u7136\u6ca1\u6709\u592a\u591a\u673a\u4f1a\u8fdb\u884c\u7ebf\u4e0b\u6d3b\u52a8\u7684\u5f00\u5c55\uff0c\u4f46 APISIX \u793e\u533a\u4ecd\u7136\u5728\u5357\u4eac\u3001\u676d\u5dde\u3001\u6df1\u5733\u548c\u591a\u4f26\u591a\u7b49\u57ce\u5e02\u4e3e\u529e\u4e86 APISIX \u7ebf\u4e0b Meetup\uff0c\u4e0e\u4f17\u591a\u793e\u533a\u7528\u6237\u548c\u5f00\u6e90\u7231\u597d\u8005\u89c1\u9762\uff0c\u4e3a\u6280\u672f\u4eba\u642d\u5efa\u7ebf\u4e0b\u4ea4\u6d41\u5e73\u53f0\u3002\\n\\n![meetup](https://static.apiseven.com/2023/01/03/63b3ea8d4a916.jpg)\\n\\n\u9664\u6b64\u4e4b\u5916\uff0cAPISIX \u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u4e5f\u6d3b\u8dc3\u5728\u5176\u4ed6\u6d3b\u52a8\u7684\u73b0\u573a\uff0c\u4ed6\u4eec\u79ef\u6781\u53c2\u4e0e QCon \u5927\u4f1a\u3001Open Source Summit\u3001Service Mesh Summit\u3001\u4e9a\u9a6c\u900a\u4e91\u79d1\u6280\u4e2d\u56fd\u5cf0\u4f1a\u3001\u963f\u91cc\u4e91\u5f00\u53d1\u8005\u5927\u4f1a\u7b49\u884c\u4e1a\u4f1a\u8bae\uff0c\u4e3a\u5176\u4ed6\u9886\u57df\u4e5f\u5e26\u6765\u4e86 APISIX \u7684\u76f8\u5173\u96c6\u6210\u5206\u4eab\u3002\\n\\n![topics](https://static.apiseven.com/2023/01/03/63b3ea809380a.jpeg)\\n\\n\u540c\u65f6\u5728\u793e\u533a\u5408\u4f5c\u65b9\u9762\uff0c\u5148\u540e\u4e0e Apache Pulsar\uff0cApache RocketMQ\u3001Apache SeaTunnel\uff0cApache EventMesh\uff0cKubeSphere \u7b49\u793e\u533a\u7ec4\u7ec7\u4e86\u591a\u6b21\u8054\u5408\u7ebf\u4e0a Meetup\uff0c\u5728\u6253\u9020 APISIX \u4e0a\u4e0b\u6e38\u751f\u6001\u7684\u540c\u65f6\uff0c\u4e5f\u4e3a\u4e0d\u540c\u793e\u533a\u5f00\u53d1\u8005\u8fd1\u8ddd\u79bb\u8ba8\u8bba\u63d0\u4f9b\u4e86\u5e73\u53f0\u3002\\n\\n\u9664\u4e86\u8ba9\u66f4\u591a\u7684\u5f00\u53d1\u8005\u52a0\u5165\u5230\u7ebf\u4e0b\u6d3b\u52a8\u4e4b\u5916\uff0cAPISIX \u793e\u533a\u4e5f\u4e00\u76f4\u81f4\u529b\u4e8e\u62c9\u8fd1\u4e0e\u5b66\u751f\u4eec\u7684\u5f00\u6e90\u4e4b\u65c5\u3002APISIX \u793e\u533a\u5df2\u8fde\u7eed\u4e24\u5e74\u79ef\u6781\u63a8\u8fdb\u5168\u7403\u5316\u7684\u5f00\u6e90\u8ba1\u5212 Google Summer of Code (GSoC) \uff0c\u8ba9\u5168\u7403\u5404\u5730\u7684\u5b66\u751f\u4eec\u53c2\u4e0e\u5f00\u6e90\u5e76\u5f00\u59cb\u63a5\u89e6 APISIX\uff1b\u5728\u56fd\u5185\uff0cAPISIX \u9879\u76ee\u4e5f\u5df2\u8fde\u7eed\u4e24\u5e74\u79ef\u6781\u53c2\u4e0e\u5230\u7531\u4e2d\u79d1\u9662\u53d1\u8d77\u7684\u5f00\u6e90\u4f9b\u5e94\u94fe\u70b9\u4eae\u8ba1\u5212\u4e2d\u6765\u3002\u5e76\u901a\u8fc7\u8fd9\u4e9b\u6d3b\u52a8\u9879\u76ee\u7684\u4ea7\u51fa\uff0c\u8ba9\u5b66\u751f\u4eec\u5bf9\u5f00\u6e90\u7684\u5174\u8da3\u5927\u589e\uff0c\u4e3a\u540e\u7eed\u5f00\u6e90\u5e74\u8f7b\u52bf\u529b\u8f93\u9001\u4e86\u8d85\u591a\u7684\u65b0\u9c9c\u8840\u6db2\u3002\\n\\n## \u5168\u7403\u5316\u5f00\u542f\uff0c\u8ba9\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u4f7f\u7528\u4e0a\u4f18\u79c0\u4ea7\u54c1\\n\\n\u5728\u4eca\u5e74\uff0cAPISIX \u4e5f\u5728\u5c1d\u8bd5\u6253\u5f00\u66f4\u5e7f\u6cdb\u7684\u5168\u7403\u89c6\u89d2\uff0c\u53bb\u63a5\u89e6\u4e16\u754c\u5404\u5730\u6709\u8da3\u7684\u5f00\u53d1\u8005\u4eec\u3002\u5728\u8fd9\u4e00\u5e74\u7684\u65f6\u95f4\u91cc\uff0cAPISIX \u793e\u533a\u7684\u5de5\u7a0b\u5e08\u548c\u5e03\u9053\u5e08\u4eec\u7a7f\u68ad\u5728 30 \u591a\u4e2a\u56fd\u5bb6\uff0c\u53c2\u4e0e\u4e86 80 \u591a\u573a\u7ebf\u4e0b\u6280\u672f\u4f1a\u8bae\uff0c\u4ece\u4e2d\u56fd\u3001\u7f8e\u56fd\u3001\u52a0\u62ff\u5927\u5230\u5370\u5ea6\u3001\u4e39\u9ea6\u3001\u745e\u58eb\u7b49\uff0c\u904d\u5e03\u5404\u5927\u6d32\u3002\u4f60\u53ef\u4ee5\u5728\u5f88\u591a\u56fd\u9645\u4f1a\u8bae\u4e0a\uff0c\u770b\u5230\u6765\u81ea APISIX \u793e\u533a\u53ef\u53ef\u7231\u7231\u7684\u9762\u5b54\u4eec\u3002\\n\\n![Global users](https://static.apiseven.com/2023/01/03/63b3ea813c11e.jpeg)\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u6765\u81ea\u56fd\u5916\u5e03\u9053\u5e08\u548c\u793e\u533a\u8d21\u732e\u8005\u4eec\u7684\u6280\u672f\u5185\u5bb9\u4e5f\u5f00\u59cb\u5728\u5404\u4e2a\u5e73\u53f0\uff08Dev.to\u3001Medium\u3001Dzone\u3001Hackernoon\u3001Reddit\u3001InfoQ \u7b49\uff09\uff0c\u6536\u83b7\u4e86\u4ee4\u4eba\u60ca\u559c\u7684\u5173\u6ce8\u5ea6\u53d8\u5316\uff0c\u6bd4\u5982 APISIX \u7684\u76f8\u5173\u5185\u5bb9\u5df2\u5728 Hacker News \u7684\u524d\u5341\u699c\u5355\u4e0a\u51fa\u73b0\u8fc7\u6570\u6b21\u3002\u800c\u4ece\u4eca\u5e74\u5f00\u59cb\uff0cAPISIX \u793e\u533a\u7684\u4e00\u4e9b\u5ba3\u4f20\u6e20\u9053\u4e5f\u5f00\u59cb\u8fdb\u884c\u6d3b\u8dc3\uff0c\u5728 YouTube \u9891\u9053\u65b0\u589e\u4e86 20 \u4e2a\u5168\u65b0\u7684\u6559\u7a0b\u89c6\u9891\uff0c\u6536\u83b7\u4e86\u8fd1 2 \u4e07\u7684\u89c2\u770b\u91cf\uff0cTwitter \u7684\u5173\u6ce8\u4eca\u5e74\u4e5f\u7ffb\u500d\u63d0\u5347\uff0c\u4ece 500 \u8dc3\u5347\u5230\u4e86 1100 \u4eba\u5de6\u53f3\u3002\u4e0b\u56fe\u4ec5\u9009\u53d6\u4e86\u90e8\u5206\u6e20\u9053\u8fdb\u884c\u5173\u6ce8\u8005\u4eba\u6570\u53d8\u5316\u5c55\u793a\u3002\\n\\n![Global data](https://static.apiseven.com/2023/01/03/63b3eae052f32.png)\\n\\n\u540c\u65f6\u5728\u4eca\u5e74\u7684\u6d77\u5916\u63a2\u7d22\u4e2d\uff0c\u6211\u4eec\u4e5f\u79ef\u6781\u4e0e\u5b66\u751f\u7fa4\u4f53\u8fdb\u884c\u4ea4\u6d41\uff0c\u4e0e\u4f2f\u514b\u5229\u3001\u591a\u4f26\u591a\u5927\u5b66\u3001\u6ed1\u94c1\u5362\u5927\u5b66\u7b49\u5728\u7f8e\u56fd\u3001\u52a0\u62ff\u5927\u3001\u5370\u5ea6\u3001\u975e\u6d32\u7684\u5927\u5b66\u548c\u7ec4\u7ec7\u5171\u4e3e\u529e\u4e86 15 \u573a workshops\uff0c\u603b\u91cf\u8986\u76d6\u6570\u767e\u540d CS \u548c\u70ed\u7231\u5f00\u6e90\u7684\u5b66\u751f\u4eec\u3002\u8fd9\u4e5f\u8ba9 APISIX \u7684\u8d21\u732e\u8005\u7fa4\u4f53\u4ece\u516c\u53f8\u7684\u6838\u5fc3\u5de5\u7a0b\u5e08\u6269\u5c55\u5230\u4e86\u77e5\u540d\u9ad8\u6821\u7684\u5927\u5b66\u751f\u4eec\uff0c\u4e3a\u540e\u7eed\u7684\u5f00\u6e90\u7fa4\u4f53\u5e26\u6765\u4e86\u56fd\u9645\u5316\u65b0\u9c9c\u8840\u6db2\u3002\u5f97\u76ca\u4e8e workshop \u7684\u6d3b\u8dc3\uff0cAPISIX \u793e\u533a\u7684 Slack \u6e20\u9053\u6d3b\u8dc3\u4eba\u6570\u4e5f\u5f97\u5230\u4e86\u5de8\u5927\u7684\u589e\u957f\u3002\\n\\n\u5168\u7403\u5316\u7684\u63a2\u7d22\uff0c\u4e5f\u8ba9 APISIX \u6536\u83b7\u4e86\u6765\u81ea\u56fd\u9645\u5316\u4f01\u4e1a\u7684\u8ba4\u53ef\u3002\u6765\u81ea\u571f\u8033\u5176\u6700\u5927\u7684\u7535\u5b50\u5546\u52a1\u516c\u53f8 Trendyol\uff0c\u5728\u4eca\u5e74\u5f00\u59cb\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u66f4\u6362\u4e3a APISIX\uff0c\u671f\u95f4\u4e5f\u79ef\u6781\u5730\u5728\u793e\u533a\u4e2d\u8fdb\u884c\u76f8\u5173\u8fdb\u5ea6\u53cd\u9988\u3002\u4e0e\u6b64\u540c\u65f6\uff0c\u7532\u9aa8\u6587 Oracle \u5728\u5176 Spring Cloud \u7684 BaaS \u4ea7\u54c1\u4e2d\u4e5f\u5f00\u59cb\u4f7f\u7528 APISIX \u6765\u90e8\u7f72\u548c\u4fdd\u62a4\u793a\u4f8b\u5e94\u7528\u7a0b\u5e8f\u7684 API\u3002\\n\\n![Global usercase](https://static.apiseven.com/2023/01/03/63b3eae00f8de.png)\\n\\n## \u65b0\u7684\u4e00\u5e74\uff0c\u65b0\u7684\u5c55\u671b\\n\\n\u5728\u8fc7\u53bb\u7684\u65f6\u95f4\u91cc\uff0cApache APISIX \u5148\u540e\u83b7\u5f97\u4e91\u8ba1\u7b97\u5f00\u6e90\u4ea7\u4e1a\u8054\u76df\u8bc4\u9009\u7684[\u300c\u5c16\u5cf0\u5f00\u6e90\u9879\u76ee\u53ca\u5f00\u6e90\u793e\u533a\u300d](https://mp.weixin.qq.com/s/YcCgbfbMTz7R3abHaI-p2Q)\u3001CSDN \u673a\u6784\u8bc4\u9009\u7684[\u300c\u5e74\u5ea6\u4e91\u539f\u751f\u6280\u672f\u4ea7\u54c1\u300d](https://mp.weixin.qq.com/s/V40SxXoPxvHLIUIx4lxX-g)\u7b49\uff0c\u5e76\u88ab [Stackshare \u8bc4\u4e3a\u300c2021 \u5e74\u5168\u7403 Top100 \u5f00\u53d1\u8005\u5de5\u5177\u300d](https://mp.weixin.qq.com/s/CY4YH3JwQBiLeFHPGhyiaw)\u3002\u975e\u5e38\u611f\u8c22\u6765\u81ea\u5168\u7403\u89c6\u89d2\u7684\u7528\u6237\u80af\u5b9a\uff0c\u65b0\u7684\u4e00\u5e74\uff0cAPISIX \u793e\u533a\u4f1a\u66f4\u52a0\u52aa\u529b\u5730\u4e3a\u5168\u4e16\u754c\u7528\u6237\u63d0\u4f9b\u66f4\u591a\u7684\u60ca\u559c\u3002\\n\\n\u4e0d\u7ba1\u662f\u4ea7\u54c1\u65b9\u9762\u7684\u529f\u80fd\u8fed\u4ee3\u4e0e\u751f\u6001\u96c6\u6210\uff0c\u8fd8\u662f\u793e\u533a\u5c42\u9762\u7684\u5168\u7403\u5316\u5e03\u9053\uff0c\u4ea6\u6216\u662f\u52a0\u5f3a\u4e0e\u5b66\u751f\u7fa4\u4f53\u7684\u5f00\u6e90\u6280\u672f\u4ea4\u6d41\u3002\u5f00\u6e90\u4e16\u754c\u5185\uff0c\u4eba\u4f9d\u65e7\u662f\u6700\u91cd\u8981\u7684\u7ec4\u6210\u56e0\u7d20\u3002\u6240\u4ee5\u6211\u4eec\u5e0c\u671b\u5728\u672a\u6765\u7684\u65f6\u95f4\u91cc\uff0cAPISIX \u793e\u533a\u4f1a\u51fa\u73b0\u66f4\u591a\u79cd\u65cf\u3001\u66f4\u591a\u8bed\u8a00\u3001\u66f4\u591a\u884c\u4e1a\u7684\u4eba\u4eec\u6765\u732e\u8ba1\u732e\u7b56\uff0c\u4e00\u8d77\u8ba9 APISIX \u53d8\u5f97\u66f4\u52a0\u591a\u59ff\u591a\u5f69\u3002"},{"id":"Apache APISIX 3.1.0 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2022/12/30/release-apache-apisix-3.1.0","source":"@site/blog/2022/12/30/release-apache-apisix-3.1.0.md","title":"Apache APISIX 3.1.0 \u6b63\u5f0f\u53d1\u5e03","description":"Apache APISIX 3.1.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u5e26\u6765\u5f88\u591a\u5173\u4e8e\u5b89\u5168\u5c42\u9762\u7684\u529f\u80fd\u652f\u6301\uff0c\u540c\u65f6\u65b0\u589e\u5185\u7f6e\u8c03\u8bd5\u63d2\u4ef6\uff0c\u65e8\u5728\u4f18\u5316\u5bf9 APISIX \u7684\u4f7f\u7528\u4f53\u9a8c\u3002","date":"2022-12-30T00:00:00.000Z","formattedDate":"2022\u5e7412\u670830\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":9.07,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","title":"Author","url":"https://github.com/spacewander","image_url":"https://github.com/spacewander.png","imageURL":"https://github.com/spacewander.png"},{"name":"Sylvia","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"2022 Apache APISIX \u5e74\u5ea6\u8bb0\u5fc6","permalink":"/zh/blog/2023/01/02/2022-summary"},"nextItem":{"title":"APISIX Ingress + Flagger \u5b9e\u73b0\u987a\u6ed1\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03","permalink":"/zh/blog/2022/12/27/apisix-ingress-with-Flagger"}},"content":"> Apache APISIX 3.1.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u5e26\u6765\u5f88\u591a\u5173\u4e8e\u5b89\u5168\u5c42\u9762\u7684\u529f\u80fd\u652f\u6301\uff0c\u540c\u65f6\u65b0\u589e\u5185\u7f6e\u8c03\u8bd5\u63d2\u4ef6\uff0c\u65e8\u5728\u4f18\u5316\u5bf9 APISIX \u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\r\\n\\r\\n\x3c!--truncate--\x3e\\r\\n\\r\\n\u65f6\u9694\u4e00\u4e2a\u6708\uff0c\u65b0\u7248\u672c\u53c8\u6765\u4e86\u3002\u8fd9\u6b21\u7684 APISIX 3.1.0 \u662f 3.0 \u5927\u7248\u672c\u4ee5\u6765\u7684\u7b2c\u4e00\u4e2a\u65b0\u7248\u672c\uff0c\u5728 3.x \u7684\u65b0\u65f6\u4ee3\u91cc\uff0c\u6211\u4eec\u4e00\u5982\u65e2\u5f80\u5730\u5728\u6bcf\u4e2a\u7248\u672c\u4e2d\u7ed9\u5927\u5bb6\u5949\u4e0a\u66f4\u591a\u7684\u65b0\u529f\u80fd\u3002\\r\\n\\r\\n\u6b64\u6b21\u53d1\u5e03\u7684 3.1.0 \u7248\u672c\uff0c\u6dfb\u52a0\u4e86\u5bf9\u63d2\u4ef6\u914d\u7f6e\u7684\u52a0\u5bc6\u5b58\u50a8\u548c\u5b58\u50a8\u5728\u5916\u90e8\u5b89\u5168\u670d\u52a1\u7684\u652f\u6301\uff0c\u7740\u91cd\u4e8e\u8ba9\u7528\u6237\u80fd\u591f\u66f4\u5b89\u5168\u3001\u66f4\u653e\u5fc3\u5730\u4f7f\u7528\u4ed6\u4eec\u7684\u914d\u7f6e\u3002\u5728\u8fd9\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u5f15\u5165\u4e86\u8bb8\u591a\u65b0\u7684\u7279\u6027\uff0c\u65e8\u5728\u4f18\u5316\u5bf9 APISIX \u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\r\\n\\r\\n## \u65b0\u7279\u6027\uff1a\u63d2\u4ef6\u914d\u7f6e\u7684\u52a0\u5bc6\u5b58\u50a8\\r\\n\\r\\n\u65b0\u7248\u672c\u652f\u6301\u5c06\u63d2\u4ef6\u7684\u7279\u5b9a\u5b57\u6bb5\u52a0\u5bc6\u4fdd\u5b58\u5230 etcd \u4e2d\u3002\\r\\n\\r\\n\u5728\u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0cAPISIX \u63d0\u4f9b\u4e86\u4e00\u4e2a `key_encrypt_salt` \u7684\u914d\u7f6e\u9879\uff0c\u652f\u6301\u5bf9 etcd \u91cc\u9762\u5b58\u50a8\u7684 SSL key \u8fdb\u884c\u52a0\u5bc6\uff0c\u907f\u514d\u660e\u6587\u5b58\u50a8\u79c1\u94a5\u6570\u636e\u3002\u6bd5\u7adf\u50cf\u79c1\u94a5\u8fd9\u6837\u7684\u654f\u611f\u6570\u636e\uff0c\u5c11\u4e00\u4e2a\u5730\u65b9\u5b58\u50a8\u660e\u6587\uff0c\u5c31\u80fd\u591a\u4e00\u4efd\u5b89\u5fc3\u3002\u90a3\u4e48\u5bf9\u4e8e\u5176\u4ed6\u540c\u6837\u654f\u611f\u7684\u914d\u7f6e\uff0c\u6bd4\u5982 `jwt-auth` \u63d2\u4ef6\u4e2d\u7684 secret\uff0c\u6211\u4eec\u80fd\u4e0d\u80fd\u4e5f\u52a0\u5bc6\u8d77\u6765\uff0c\u907f\u514d\u5728 etcd \u91cc\u9762\u5b58\u50a8\u660e\u6587\u5462\uff1f\\r\\n\\r\\n3.1 \u7248\u672c\u4e2d\u5c31\u628a\u52a0\u5bc6\u5b58\u50a8\u7684\u529f\u80fd\u62d3\u5c55\u5230\u5176\u4ed6\u5b57\u6bb5\u4e0a\u3002\u6709\u4e86\u8fd9\u4e2a\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u67d0\u4e2a\u7279\u5b9a\u7684\u63d2\u4ef6\u4e0a\u6307\u5b9a\u9700\u8981\u52a0\u5bc6\u7684\u5b57\u6bb5\uff0c\u7136\u540e\u5728 `config.yaml` \u6587\u4ef6\u4e2d\u5f00\u542f\u52a0\u5bc6\uff0c\u5373\u53ef\u907f\u514d\u660e\u6587\u5b58\u50a8\u3002\\r\\n\\r\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u7ed9 `jwt-auth` \u63d2\u4ef6\u65b0\u589e\u4e86\u5982\u4e0b\u7684\u6807\u8bb0\uff1a\\r\\n\\r\\n```lua\\r\\n     encrypt_fields = {\\"secret\\", \\"private_key\\"},\\r\\n```\\r\\n\\r\\n\u5f53\u6211\u4eec\u5728 `config.yaml` \u91cc\u5f00\u542f\u4e86\u5b57\u6bb5\u7684\u52a0\u5bc6\u529f\u80fd\uff1a\\r\\n\\r\\n```yaml\\r\\napisix:\\r\\n    data_encryption:\\r\\n        enable: true\\r\\n        keyring:\\r\\n            - edd1c9f0985e76a2\\r\\n```\\r\\n\\r\\n\u90a3\u4e48\u5199\u5165\u5230 etcd \u7684 `jwt-auth` \u63d2\u4ef6\u7684\u914d\u7f6e\u4e2d\u7684 secret \u548c private_key\uff0c\u5c31\u4f1a\u88ab\u52a0\u5bc6\u5b58\u50a8\u3002\u901a\u8fc7 `etcdctl get --prefix /` \u770b\u5230\u7684\u914d\u7f6e\uff0c\u4f1a\u662f\u8bf8\u5982 \u201c\\"secret\\":\\"77+NmbYqNfN+oL...\\"\u201d \u8fd9\u6837\u7684\u6570\u636e\uff0c\u800c\u4e0d\u662f\u539f\u59cb\u7684\u914d\u7f6e\u4fe1\u606f\u3002\\r\\n\\r\\n## \u65b0\u7279\u6027\uff1a\u5c06\u654f\u611f\u4fe1\u606f\u5b58\u50a8\u5728\u5916\u90e8\u5b89\u5168\u670d\u52a1\\r\\n\\r\\n\u9664\u4e86\u53ef\u4ee5\u5c06\u654f\u611f\u4fe1\u606f\u52a0\u5bc6\u5b58\u50a8\u5728 etcd \u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u9009\u62e9\u4ece\u522b\u7684\u7cfb\u7edf\u4e2d\u52a8\u6001\u83b7\u53d6\u654f\u611f\u4fe1\u606f\uff0c\u800c\u4e0d\u518d\u8981\u6c42\u654f\u611f\u4fe1\u606f\u5fc5\u987b\u5b58\u50a8\u5728 APISIX \u7684\u914d\u7f6e\u5b58\u50a8\uff08\u5982 etcd\uff09\u4e2d\u3002\\r\\n\\r\\n\u5728 3.1 \u7248\u672c\u4e2d\uff0c\u6211\u4eec\u4e0a\u7ebf\u4e86\u540d\u4e3a APISIX Secret \u7684\u529f\u80fd\u3002APISIX Secret \u5141\u8bb8\u7528\u6237\u5728 APISIX \u4e2d\u901a\u8fc7\u4e00\u4e9b\u5bc6\u94a5\u7ba1\u7406\u670d\u52a1\uff08Vault \u7b49\uff09\u6765\u5b58\u50a8 secret\uff0c\u5728\u4f7f\u7528\u7684\u65f6\u5019\u6839\u636e key \u8fdb\u884c\u8bfb\u53d6\uff0c\u786e\u4fdd secret \u5728\u6574\u4e2a\u5e73\u53f0\u4e2d\u4e0d\u4ee5\u660e\u6587\u7684\u5f62\u5f0f\u5b58\u5728\u3002\\r\\n\\r\\nAPISIX \u76ee\u524d\u652f\u6301\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b58\u50a8 secret\uff1a\\r\\n\\r\\n- \u73af\u5883\u53d8\u91cf\\r\\n- HashiCorp Vault\\r\\n\\r\\n### \u76f8\u5173\u793a\u4f8b\\r\\n\\r\\n\u4ee5 `key-auth` \u63d2\u4ef6\u4e3a\u4f8b\uff0c\u6211\u4eec\u6765\u793a\u8303\u4e0b\u5982\u4f55\u4f7f\u7528\u7279\u6027\u3002\\r\\n\\r\\n#### \u57fa\u4e8e\u73af\u5883\u53d8\u91cf\u7684\u654f\u611f\u4fe1\u606f\u5b58\u50a8\\r\\n\\r\\n\u7b2c\u4e00\u6b65\uff1aAPISIX \u5b9e\u4f8b\u542f\u52a8\u524d\u521b\u5efa\u73af\u5883\u53d8\u91cf\\r\\n\\r\\n```shell\\r\\nexport JACK_AUTH_KEY=abc\\r\\n```\\r\\n\\r\\n\u7b2c\u4e8c\u6b65\uff1a\u5728 `key-auth` \u63d2\u4ef6\u4e2d\u5f15\u7528\u73af\u5883\u53d8\u91cf\\r\\n\\r\\n```shell\\r\\ncurl http://127.0.0.1:9180/apisix/admin/consumers \\\\\\r\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\r\\n{\\r\\n    \\"username\\": \\"jack\\",\\r\\n    \\"plugins\\": {\\r\\n        \\"key-auth\\": {\\r\\n            \\"key\\": \\"$ENV://JACK_AUTH_KEY\\"\\r\\n        }\\r\\n    }\\r\\n}\'\\r\\n```\\r\\n\\r\\n\u901a\u8fc7\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u53ef\u4ee5\u5c06 `key-auth` \u63d2\u4ef6\u4e2d\u7684 key \u914d\u7f6e\u4fdd\u5b58\u5728\u73af\u5883\u53d8\u91cf\u4e2d\uff0c\u800c\u4e0d\u662f\u5728\u914d\u7f6e\u63d2\u4ef6\u65f6\u660e\u6587\u663e\u793a\u3002\\r\\n\\r\\n#### \u57fa\u4e8e Vault \u7684\u654f\u611f\u4fe1\u606f\u5b58\u50a8\\r\\n\\r\\n\u7b2c\u4e00\u6b65\uff1a\u5728 Vault \u4e2d\u521b\u5efa\u5bf9\u5e94\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a\\r\\n\\r\\n```shell\\r\\nvault kv put apisix/jack auth-key=value\\r\\n```\\r\\n\\r\\n\u7b2c\u4e8c\u6b65\uff1a\u901a\u8fc7 Admin API \u6dfb\u52a0 Secret \u8d44\u6e90\uff0c\u914d\u7f6e Vault \u7684\u5730\u5740\u7b49\u8fde\u63a5\u4fe1\u606f\uff1a\\r\\n\\r\\n```shell\\r\\ncurl http://127.0.0.1:9180/apisix/admin/secrets/vault/1 \\\\\\r\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\r\\n{\\r\\n    \\"uri\\": \\"https://127.0.0.1:8200\\"\uff0c\\r\\n    \\"prefix\\": \\"apisix\\",\\r\\n    \\"token\\": \\"root\\"\\r\\n}\'\\r\\n```\\r\\n\\r\\n\u7b2c\u4e09\u6b65\uff1a\u5728 `key-auth` \u63d2\u4ef6\u4e2d\u5f15\u7528 APISIX Secret \u8d44\u6e90\uff0c\u586b\u5145\u914d\u7f6e\u5728 Vault \u4e2d\u7684\u4f4d\u7f6e\uff1a\\r\\n\\r\\n```shell\\r\\ncurl http://127.0.0.1:9180/apisix/admin/consumers \\\\\\r\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\r\\n{\\r\\n    \\"username\\": \\"jack\\",\\r\\n    \\"plugins\\": {\\r\\n        \\"key-auth\\": {\\r\\n            \\"key\\": \\"$secret://vault/1/jack/auth-key\\"\\r\\n        }\\r\\n    }\\r\\n}\'\\r\\n```\\r\\n\\r\\n\u901a\u8fc7\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u53ef\u4ee5\u5c06 `key-auth` \u63d2\u4ef6\u4e2d\u7684 key \u914d\u7f6e\u4fdd\u5b58\u5728 Vault \u4e2d\uff0c\u800c\u4e0d\u662f\u5728\u914d\u7f6e\u63d2\u4ef6\u65f6\u660e\u6587\u663e\u793a\u3002\\r\\n\\r\\n## \u65b0\u7279\u6027\uff1a\u5b9e\u9a8c\u6027\u57fa\u4e8e gRPC \u7684 etcd \u914d\u7f6e\u540c\u6b65\\r\\n\\r\\n\u5728\u672c\u6b21\u65b0\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u8fd8\u5f15\u5165\u4e86\u5b9e\u9a8c\u6027\u7684\u57fa\u4e8e gRPC \u7684 etcd \u914d\u7f6e\u540c\u6b65\u3002\u5f53\u524d APISIX \u540c\u6b65 etcd \u7684\u914d\u7f6e\uff0c\u662f\u57fa\u4e8e HTTP long pulling\uff0c\u8fd9\u5c31\u8981\u6c42 etcd \u5f00\u542f gRPC-gateway \uff08\u6240\u5e78\u7684\u662f\u9ed8\u8ba4\u5c31\u662f\u5f00\u542f\u7684\uff09\u3002\\r\\n\\r\\n\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u9047\u5230\u4e86 etcd \u7684 HTTP API \u51fa\u73b0\u95ee\u9898\uff0c\u4e5f\u8bb8\u662f\u56e0\u4e3a\u901a\u8fc7 HTTP \u540c\u6b65\u914d\u7f6e\u5e76\u975e etcd \u7684\u4e3b\u6d41\u4f7f\u7528\u65b9\u5f0f\uff0c\u6240\u4ee5\u4f1a\u66f4\u5bb9\u6613\u9047\u5230 bug\u3002\u901a\u8fc7\u628a etcd \u914d\u7f6e\u540c\u6b65\u7531 HTTP long pulling \u5207\u6362\u5230 gRPC \u4e0a\u9762\u6765\uff0cAPISIX \u5b9e\u73b0\u4e86\u540c\u6b65\u65b9\u5f0f\u4e0e\u4e3b\u6d41\u63a5\u8f68\u3002\\r\\n\\r\\n\u53e6\u5916\u7531\u4e8e gRPC \u672c\u8eab\u63d0\u4f9b\u4e86\u591a\u8def\u590d\u7528\u7684\u652f\u6301\uff0c\u6539\u7528 gRPC \u540c\u6b65\u914d\u7f6e\u80fd\u5927\u5e45\u964d\u4f4e APISIX \u5230 etcd \u7684\u8fde\u63a5\u6570\u3002\u5f53\u524d APISIX \u540c\u6b65\u6bcf\u4e00\u7c7b\u914d\u7f6e\u90fd\u8981\u6709\u72ec\u7acb\u7684 HTTP \u8fde\u63a5\uff0c\u5207\u6362\u5230 gRPC \u540e\u6bcf\u4e2a\u8fdb\u7a0b\u53ea\u6709\u4e00\u6761\u7528\u4e8e\u914d\u7f6e\u540c\u6b65\u7684\u8fde\u63a5\uff08\u5982\u679c\u5f00\u542f\u4e86 L4 \u4ee3\u7406\uff0c\u90a3\u4e48\u662f\u4e24\u6761\uff09\u3002\\r\\n\\r\\n\u542f\u7528\u5b9e\u9a8c\u6027\u7684\u57fa\u4e8e gRPC \u7684\u914d\u7f6e\u540c\u6b65\uff0c\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6 `config.yaml` \u4e2d\u8bbe\u7f6e `use_grpc: true`\uff1a\\r\\n\\r\\n```yaml\\r\\n  etcd:\\r\\n    use_grpc: true\\r\\n    timeout: 3600\\r\\n    host:\\r\\n      - \\"http://127.0.0.1:2379\\"\\r\\n    prefix: \\"/apisix\\"\\r\\n```\\r\\n\\r\\n## \u65b0\u7279\u6027\uff1a\u57fa\u4e8e Consul \u7684\u670d\u52a1\u53d1\u73b0\\r\\n\\r\\n\u5728 APISIX \u4e4b\u524d\u7684\u7248\u672c\u91cc\uff0c\u6709\u70ed\u5fc3\u7684\u8d21\u732e\u8005\u63d0\u4f9b\u4e86\u57fa\u4e8e Consul KV \u7684\u670d\u52a1\u53d1\u73b0\u5b9e\u73b0\u3002\u4e0d\u8fc7 Consul KV \u8ddf Consul \u81ea\u8eab\u7684\u670d\u52a1\u53d1\u73b0\u529f\u80fd\u6709\u4e9b\u4e0d\u540c\u3002Consul \u81ea\u8eab\u7684\u670d\u52a1\u53d1\u73b0\u652f\u6301\u989d\u5916\u7684\u4e00\u4e9b\u529f\u80fd\uff0c\u6bd4\u5982\u5bf9\u6ce8\u518c\u670d\u52a1\u7684\u5065\u5eb7\u68c0\u67e5\uff0c\u6240\u4ee5\u5728\u4f7f\u7528\u4e0a\u4f1a\u66f4\u4e3a\u5e7f\u6cdb\u4e9b\u3002\u672c\u6b21 3.1 \u7248\u672c\u4e2d\uff0c\u53e6\u4e00\u4f4d\u70ed\u5fc3\u8d21\u732e\u8005\u63d0\u4f9b\u4e86\u57fa\u4e8e Consul \u7684\u670d\u52a1\u53d1\u73b0\uff0c\u586b\u8865\u4e86\u8fd9\u4e00\u7a7a\u7f3a\u3002\\r\\n\\r\\n\u57fa\u4e8e Consul \u7684\u670d\u52a1\u53d1\u73b0\u548c\u4e4b\u524d\u7248\u672c\u91cc\u57fa\u4e8e Consul KV \u7684\u670d\u52a1\u53d1\u73b0\u6709\u7740\u76f8\u4f3c\u7684\u914d\u7f6e\u3002\u9996\u5148\uff0c\u9700\u8981\u5728 `config.yaml` \u6587\u4ef6\u4e2d\u542f\u7528\u8be5\u670d\u52a1\u53d1\u73b0\uff1a\\r\\n\\r\\n```yaml\\r\\ndiscovery:\\r\\n  consul:\\r\\n    servers:\\r\\n      - \\"http://127.0.0.1:8500\\"\\r\\n```\\r\\n\\r\\n\u7136\u540e\u5728\u5177\u4f53\u7684 upstream \u4e2d\u914d\u7f6e\u5bf9\u5e94\u7684 `service_name` \u548c `discovery_type`\uff1a\\r\\n\\r\\n```shell\\r\\ncurl http://127.0.0.1:9180/apisix/admin/upstreams/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\r\\n{\\r\\n    \\"service_name\\": \\"service_a\\",\\r\\n    \\"discovery_type\\": \\"consul\\"\\r\\n}\'\\r\\n```\\r\\n\\r\\n\u5bf9\u5e94\u7684 upstream \u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u5c31\u4f1a\u6839\u636e Consul \u91cc\u9762\u914d\u7f6e\u7684\u503c\u53bb\u5f97\u5230\u771f\u6b63\u7684\u4e0a\u6e38\u8282\u70b9\u3002\\r\\n\\r\\n## \u65b0\u7279\u6027\uff1a\u5185\u7f6e\u7684\u8c03\u8bd5\u63d2\u4ef6\\r\\n\\r\\n\u5de5\u6b32\u5584\u5176\u4e8b\uff0c\u5fc5\u5148\u5229\u5176\u5668\u3002\u8c03\u8bd5\u662f\u7a0b\u5e8f\u5458\u65e5\u5e38\u5de5\u4f5c\u7684\u4e00\u90e8\u5206\u3002\u4f5c\u4e3a\u6ce8\u91cd\u8c03\u8bd5\u4f53\u9a8c\u7684\u7f51\u5173\uff0cAPISIX \u5728 3.1 \u7248\u672c\u4e2d\u4ee5\u63d2\u4ef6\u7684\u5f62\u5f0f\u5185\u7f6e\u4e86\u4e00\u4e2a Lua \u8c03\u8bd5\u5668\u63d2\u4ef6\uff0c\u652f\u6301\u52a8\u6001\u8bbe\u7f6e\u65ad\u70b9\u3001\u6dfb\u52a0\u56de\u8c03\u7b49\u7b49\u3002\\r\\n\\r\\n\u9ed8\u8ba4\u7684\u914d\u7f6e\u5982\u4e0b\uff1a\\r\\n\\r\\n```yaml\\r\\nplugins:\\r\\n    ...\\r\\n    - inspect\\r\\n    ...\\r\\n\\r\\nplugin_attr:\\r\\n  inspect:\\r\\n    delay: 3\\r\\n    hooks_file: \\"/usr/local/apisix/plugin_inspect_hooks.lua\\"\\r\\n```\\r\\n\\r\\nAPISIX \u5728\u542f\u52a8\u540e\uff0c\u4f1a\u5b9a\u671f\u67e5\u770b\u914d\u7f6e\u7684 hooks_file \uff08\u8fd9\u91cc\u662f `/usr/local/apisix/plugin_inspect_hooks.lua` \u6587\u4ef6\uff09\uff0c\u5982\u679c\u6587\u4ef6\u91cc\u9762\u6709\u5185\u5bb9\uff0c\u5c31\u4f1a\u6839\u636e\u91cc\u9762\u7684\u5185\u5bb9\u8bbe\u7f6e\u65ad\u70b9\u548c\u56de\u8c03\u3002\u6bd4\u5982\u4e0b\u65b9\u5185\u5bb9\u4f1a\u7ed9 `limit-req.lua` \u6587\u4ef6\u7684 88 \u884c\u4e0a\u8bbe\u7f6e\u4e00\u4e2a\u65ad\u70b9\uff0c\u5e76\u5728\u8be5\u65ad\u70b9\u4e0a\u6ce8\u518c\u4e86\u56de\u8c03\u51fd\u6570 `function(info) ... end`\u3002\\r\\n\\r\\n```lua\\r\\nlocal dbg = require \\"apisix.inspect.dbg\\"\\r\\n\\r\\ndbg.set_hook(\\"limit-req.lua\\", 88, require(\\"apisix.plugins.limit-req\\").access, function(info)\\r\\n    ngx.log(ngx.INFO, debug.traceback(\\"foo traceback\\", 3))\\r\\n    return true\\r\\nend)\\r\\n```\\r\\n\\r\\n## \u65b0\u529f\u80fd\uff1a\u4f18\u5316\u4ee5\u53ca\u66f4\u591a\u5c0f\u529f\u80fd\\r\\n\\r\\n\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u51e0\u4e2a\u5927\u7684\u529f\u80fd\u5916\uff0c\u6b64\u6b21\u53d1\u5e03\u4e5f\u5305\u542b\u8bb8\u591a\u503c\u5f97\u8ff0\u8bf4\u7684\u6539\u52a8\uff1a\\r\\n\\r\\n- \u4f18\u5316 Prometheus \u6307\u6807\u91c7\u96c6\u7684\u8d44\u6e90\u5360\u7528\\r\\n- \u652f\u6301\u5728 L4 \u7684\u4ee3\u7406\u4e2d\uff0c\u914d\u7f6e\u57df\u540d\u4f5c\u4e3a\u4e0a\u6e38\\r\\n\\r\\n\u5982\u679c\u4f60\u5bf9\u65b0\u7248\u672c\u7684\u5b8c\u6574\u66f4\u65b0\u7ec6\u8282\u611f\u5174\u8da3\uff0c\u8bf7\u53c2\u8003 3.1.0 \u53d1\u5e03\u7684 [CHANGELOG](https://github.com/apache/apisix/blob/release/3.1/docs/zh/latest/CHANGELOG.md#310)\u3002"},{"id":"APISIX Ingress + Flagger \u5b9e\u73b0\u987a\u6ed1\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2022/12/27/apisix-ingress-with-Flagger","source":"@site/blog/2022/12/27/apisix-ingress-with-Flagger.md","title":"APISIX Ingress + Flagger \u5b9e\u73b0\u987a\u6ed1\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03","description":"\u901a\u8fc7 Apache APISIX \u548c Flagger \u7684\u6574\u5408\uff0c\u5b9e\u73b0\u4e86\u975e\u5e38\u987a\u6ed1\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03\u3002","date":"2022-12-27T00:00:00.000Z","formattedDate":"2022\u5e7412\u670827\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":14.9,"truncated":true,"authors":[{"name":"\u8c2d\u6052\u4eae","url":"https://github.com/Gallardot","imageURL":"https://github.com/Gallardot.png"}],"prevItem":{"title":"Apache APISIX 3.1.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/12/30/release-apache-apisix-3.1.0"},"nextItem":{"title":"APISIX Ingress \u5bf9 Gateway API \u7684\u652f\u6301\u548c\u5e94\u7528","permalink":"/zh/blog/2022/12/27/apisix-ingress-with-gatewayapi"}},"content":"> \u901a\u8fc7 Apache APISIX \u548c Flagger \u7684\u6574\u5408\uff0c\u5b9e\u73b0\u4e86\u975e\u5e38\u987a\u6ed1\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005\uff1a\u8c2d\u6052\u4eae\uff0cGithub ID: Gallardot\u3002\u5f00\u6e90\u9879\u76ee\u7231\u597d\u8005\uff0cCNCF Chaos Mesh \u9879\u76ee Maintainer\uff0cCNCF KubeVela\u3001Apache APISIX\u3001CNCF Flagger\u3001CNCF Argo Rollouts \u7b49\u9879\u76ee Contributor\u3002\u76ee\u524d\u5728\u5c0f\u9e4f\u6c7d\u8f66\u4efb\u804c\u57fa\u7840\u67b6\u6784\u7814\u53d1\u4e13\u5bb6\u3002\\n\\n\u5728\u65e5\u5e38\u7684\u9879\u76ee\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u65f6\uff0c\u6211\u4eec\u65f6\u5e38\u4f1a\u9762\u4e34\u670d\u52a1\u53d8\u66f4\u7684\u6311\u6218\uff0c\u4e3a\u4e86\u4e0d\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\uff0c\u6211\u4eec\u5f80\u5f80\u5c3d\u53ef\u80fd\u9700\u8981\u89c4\u907f\u670d\u52a1\u4e0d\u53ef\u7528\u7684\u98ce\u9669\u3002\u56e0\u6b64\uff0c\u6301\u7eed\u4ea4\u4ed8\u4fbf\u5e94\u8fd0\u800c\u751f\uff0c\u5176\u88ab\u63a5\u53d7\u4e3a\u4e00\u79cd\u4f01\u4e1a\u8f6f\u4ef6\u5b9e\u8df5\uff0c\u5e76\u4e14\u662f\u5b8c\u5584\u7684\u6301\u7eed\u96c6\u6210\u539f\u5219\u7684\u81ea\u7136\u6f14\u53d8\u3002\\n\\n\u7136\u800c\uff0c\u6301\u7eed\u90e8\u7f72\u4ecd\u7136\u975e\u5e38\u7f55\u89c1\uff0c\u8fd9\u53ef\u80fd\u662f\u7531\u4e8e\u7ba1\u7406\u7684\u590d\u6742\u6027\u4ee5\u53ca\u62c5\u5fc3\u90e8\u7f72\u5931\u8d25\u4f1a\u5f71\u54cd\u7cfb\u7edf\u53ef\u7528\u6027\u3002\u5728\u6574\u4e2a\u6301\u7eed\u4ea4\u4ed8\u4f53\u7cfb\u4e2d\uff0c\u91d1\u4e1d\u96c0\u53d1\u5e03\u6216\u8bb8\u662f\u6700\u4e3a\u7ecf\u5178\u7684\u4e00\u4e2a\u573a\u666f\u3002\u57fa\u4e8e\u6b64\uff0c\u6211\u4eec\u80fd\u591f\u5f88\u5feb\u53d1\u73b0\u201c\u4e0d\u5065\u5eb7\u201d\u548c\u201c\u6709\u95ee\u9898\u201d\u7684\u670d\u52a1\uff0c\u5e76\u4e14\u53ef\u4ee5\u6beb\u4e0d\u8d39\u529b\u5730\u56de\u6eda\u5230\u4e0a\u4e00\u4e2a\u7248\u672c\u3002\\n\\n\u91d1\u4e1d\u96c0\u53d1\u5e03\u4e5f\u79f0\u201c\u7070\u5ea6\u53d1\u5e03\u201d\u3002\u901a\u5e38\u6765\u8bb2\uff0c\u5728\u539f\u6709\u7248\u672c\u53ef\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u540c\u65f6\u53d1\u5e03\u90e8\u7f72\u4e00\u4e2a\u65b0\u7248\u672c\u5e94\u7528\u4f5c\u4e3a\u201c\u91d1\u4e1d\u96c0\u201d\uff0c\u5176\u76ee\u7684\u662f\u4e3a\u4e86\u6d4b\u8bd5\u65b0\u7248\u672c\u7684\u6027\u80fd\u548c\u8868\u73b0\uff0c\u5728\u4fdd\u969c\u6574\u4f53\u7cfb\u7edf\u7a33\u5b9a\u7684\u524d\u63d0\u4e0b\uff0c\u5c3d\u65e9\u53d1\u73b0\u548c\u53ca\u65f6\u8c03\u6574\u3002\\n\\n\u91d1\u4e1d\u96c0\u53d1\u5e03\u5e76\u975e\u9ed1\u5373\u767d\u7684\u53d1\u5e03\u65b9\u5f0f\uff0c\u5b83\u80fd\u591f\u7f13\u6162\u5730\u5c06\u7279\u5b9a\u767e\u5206\u6bd4\u7684\u6d41\u91cf\u5f15\u5bfc\u81f3\u4e00\u5c0f\u90e8\u5206\u7528\u6237\u3002\u82e5\u9a8c\u8bc1\u6ca1\u6709\u95ee\u9898\uff0c\u518d\u63a8\u5e7f\u5230\u5168\u90e8\u7528\u6237\uff0c\u5e76\u9010\u6b65\u6dd8\u6c70\u65e7\u7248\u672c\uff0c\u4ee5\u964d\u4f4e\u751f\u4ea7\u73af\u5883\u5f15\u5165\u65b0\u529f\u80fd\u5e26\u6765\u7684\u98ce\u9669\u3002\\n\\n\u672c\u6587\u5c06\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 Apache APISIX Ingress \u548c Flagger \u5b9e\u73b0\u987a\u6ed1\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03\uff0c\u4ece\u800c\u63d0\u9ad8\u53d1\u5e03\u6548\u7387\uff0c\u964d\u4f4e\u53d1\u5e03\u98ce\u9669\u3002\\n\\n## \u9879\u76ee\u4ecb\u7ecd\\n\\n### Apache APISIX Ingress\\n\\nApache APISIX Ingress \u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u6570\u636e\u9762\u4ee3\u7406\u7684 Kubernetes Ingress controller \u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u91d1\u4e1d\u96c0\u53d1\u5e03\u3001\u7cbe\u7ec6\u5316\u8def\u7531\u3001\u9650\u6d41\u9650\u901f\u3001\u670d\u52a1\u964d\u7ea7\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u6570\u767e\u9879\u529f\u80fd\u3002\u76ee\u524d\u5df2\u88ab\u5305\u62ec Zoom\u3001\u817e\u8baf\u4e91\u3001\u9a7e\u8003\u5b9d\u5178\u3001\u5730\u5e73\u7ebf\u3001\u6b27\u6d32\u54e5\u767d\u5c3c\u53c2\u8003\u7cfb\u7edf\u7b49\u56fd\u5185\u5916\u516c\u53f8\u548c\u7ec4\u7ec7\u91c7\u7528\u3002\\n\\n### Flagger\\n\\nFlagger \u662f\u4e00\u4e2a CNCF \u4e91\u539f\u751f\u8ba1\u7b97\u57fa\u91d1\u4f1a\u9879\u76ee\uff0c\u662f GitOps \u5de5\u5177 Flux \u7cfb\u5217\u7684\u4e00\u90e8\u5206\u3002\u6700\u8fd1 CNCF \u4e91\u539f\u751f\u8ba1\u7b97\u57fa\u91d1\u4f1a\u4e5f\u5ba3\u5e03\u4e86 Flux \u6b63\u5f0f\u6bd5\u4e1a\uff0c\u5f88\u597d\u5730\u8868\u660e\u4e86\u4e91\u539f\u751f\u6280\u672f\u5f53\u524d\u7684\u6210\u529f\u4e0e\u5149\u660e\u524d\u666f\u3002\u4f5c\u4e3a\u4e00\u79cd\u6e10\u8fdb\u5f0f\u4ea4\u4ed8\u5de5\u5177\uff0cFlagger \u53ef\u81ea\u52a8\u6267\u884c\u5728 Kubernetes \u4e0a\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u53d1\u5e03\u8fc7\u7a0b\u3002\u5b83\u901a\u8fc7\u5728\u8861\u91cf\u5206\u6790\u6307\u6807\u548c\u8fd0\u884c\u4e00\u81f4\u6027\u6d4b\u8bd5\u7684\u540c\u65f6\u9010\u6e10\u5c06\u6d41\u91cf\u8f6c\u79fb\u5230\u65b0\u7248\u672c\u6765\u964d\u4f4e\u5728\u751f\u4ea7\u4e2d\u5f15\u5165\u65b0\u8f6f\u4ef6\u7248\u672c\u7684\u98ce\u9669\u3002\\n\\n\u7ecf\u8fc7 Apache APISIX \u548c Flux \u4e24\u4e2a\u793e\u533a\u7684\u5408\u4f5c\u4e0e\u52aa\u529b\uff0cFlagger \u5728\u8fd1\u671f\u4e5f\u53d1\u5e03\u4e86 v1.27.0 \u7248\u672c\uff0c\u652f\u6301\u4f7f\u7528 Apache APISIX Ingress \u548c Flagger \u8fdb\u884c\u81ea\u52a8\u5316\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03\u3002\\n\\n![\u91d1\u4e1d\u96c0\u53d1\u5e03\u6d41\u7a0b](https://static.apiseven.com/2022/12/26/63a9a47945eda.png)\\n\\n\u4e0b\u6587\u5c06\u901a\u8fc7\u5b9e\u8df5\uff0c\u4e00\u6b65\u6b65\u4e3a\u5927\u5bb6\u5c55\u793a\u4e0b\u8fd9\u4e2a\u987a\u6ed1\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03\u8fc7\u7a0b\u3002\\n\\n## \u91d1\u4e1d\u96c0\u53d1\u5e03\u51c6\u5907\u73af\u8282\\n\\n### \u73af\u5883\u4e0e\u7ec4\u4ef6\u51c6\u5907\\n\\n\u9996\u5148\u9700\u8981\u4e00\u4e2a v1.19 \u6216\u66f4\u65b0\u7248\u672c\u7684 Kubernetes \u96c6\u7fa4\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 [kind](https://kind.sigs.k8s.io/) \u8fdb\u884c\u5b89\u88c5\u3002\\n\\n\u7136\u540e\u4f7f\u7528 Helm V3 \u6765\u5b89\u88c5 Apache APISIX \u548c Apache APISIX Ingress Controller\uff0c\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```bash\\nhelm repo add apisix https://charts.apiseven.com\\nkubectl create ns apisix\\n\\n\\n\\nhelm upgrade -i apisix apisix/apisix --version=0.11.3 \\\\\\n--namespace apisix \\\\\\n--set apisix.podAnnotations.\\"prometheus\\\\.io/scrape\\"=true \\\\\\n--set apisix.podAnnotations.\\"prometheus\\\\.io/port\\"=9091 \\\\\\n--set apisix.podAnnotations.\\"prometheus\\\\.io/path\\"=/apisix/prometheus/metrics \\\\\\n--set pluginAttrs.prometheus.export_addr.ip=0.0.0.0 \\\\\\n--set pluginAttrs.prometheus.export_addr.port=9091 \\\\\\n--set pluginAttrs.prometheus.export_uri=/apisix/prometheus/metrics \\\\\\n--set pluginAttrs.prometheus.metric_prefix=apisix_ \\\\\\n--set ingress-controller.enabled=true \\\\\\n--set ingress-controller.config.apisix.serviceNamespace=apisix\\n```\\n\\n\u5b8c\u6210\u540e\uff0c\u5728 apisix namespace \u4e2d\u5b89\u88c5 Flagger \u548c Prometheus \u9644\u52a0\u7ec4\u4ef6\u3002\\n\\n```bash\\nhelm repo add flagger https://flagger.app\\n\\n\\n\\nhelm upgrade -i flagger flagger/flagger \\\\\\n--namespace apisix \\\\\\n--set prometheus.install=true \\\\\\n--set meshProvider=apisix\\n```\\n\\n\u6ce8\u610f\uff0c\u5982\u9700\u4f7f\u7528\u81ea\u5efa prometheus \u6216\u8005 prometheus operator\uff0c\u53ef\u4ee5\u81ea\u884c\u641c\u7d22\u76f8\u5173\u6587\u7ae0\u8fdb\u884c\u4fee\u6539\u3002\\n\\n### \u521d\u59cb\u5316\u5e94\u7528\\n\\nFlagger \u53ef\u4ee5\u4f5c\u7528\u4e8e Kubernetes \u7684 deployment \u4ee5\u53ca\u5176\u4ed6\u7684 workload\uff0c\u4e5f\u53ef\u4ee5\u548c HPA \u7ed3\u5408\u5728\u4e00\u8d77\u5de5\u4f5c\u3002\u5b83\u5c06\u4f1a\u521b\u5efa\u4e00\u7cfb\u5217\u7684\u5bf9\u8c61\uff08\u6bd4\u5982 Kubernetes deployments\u3001ClusterIP services \u548c ApisixRoute\uff09\u3002\u8fd9\u4e9b\u5bf9\u8c61\u53ef\u4ee5\u5c06\u5e94\u7528\u66b4\u9732\u5230\u96c6\u7fa4\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u5e76\u7528\u4e8e\u91d1\u4e1d\u96c0\u53d1\u5e03\u8fc7\u7a0b\u7684\u5206\u6790\u548c\u53d1\u5e03\u3002\\n\\n\u9996\u5148\u4f7f\u7528 `kubectl create ns test` \u547d\u4ee4\u6765\u65b0\u5efa\u4e00\u4e2a namespace\uff0c\u8fd9\u91cc\u6211\u4eec\u5c06\u5176\u547d\u540d\u4e3a `test`\u3002\u7136\u540e\u901a\u8fc7 `kubectl apply -k https://github.com/fluxcd/flagger//kustomize/podinfo?ref=main` \u547d\u4ee4\uff0c\u65b0\u5efa\u4e00\u4e2a deployment \u548c HPA\uff0c\u8fd9\u91cc\u4f7f\u7528 Flagger \u5b98\u65b9\u793a\u4f8b\u7a0b\u5e8f\u3002\\n\\n\u63a5\u4e0b\u6765\u53ef\u901a\u8fc7 `helm upgrade -i flagger-loadtester flagger/loadtester \\\\`\\n\\n`--namespace=test` \u6307\u4ee4\u6765\u90e8\u7f72 Flagger \u7684\u8d1f\u8f7d\u6d4b\u8bd5\u670d\u52a1\uff0c\u7528\u4e8e\u5728\u91d1\u4e1d\u96c0\u53d1\u5e03\u671f\u95f4\u4ea7\u751f\u6d41\u91cf\u65f6\uff0c\u65b9\u4fbf\u5bf9\u5176\u8fdb\u884c\u5206\u6790\u3002\\n\\n\u6b64\u65f6\uff0c\u521b\u5efa Apache APISIX \u7684`ApisixRoute`\uff0cFlagger \u5c06\u4f1a\u5f15\u7528\u8be5\u8d44\u6e90\uff0c\u5e76\u4e14\u751f\u6210\u91d1\u4e1d\u96c0\u7248\u672c\u7684 Apache APISIX Ingress \u7684`ApisixRoute`\uff0c\u5177\u4f53\u53ef\u53c2\u8003\u4e0b\u65b9\u793a\u4f8b\uff08\u793a\u4f8b\u4e2d\u7684`app.example.com`\u53ef\u4ee5\u66ff\u6362\u6210\u4f60\u7684\u5b9e\u9645\u57df\u540d\uff09\u3002\\n\\n```yaml\\napiVersion: apisix.apache.org/v2\\nkind: ApisixRoute\\nmetadata:\\n  name: podinfo\\n  namespace: test\\nspec:\\n  http:\\n    - backends:\\n        - serviceName: podinfo\\n          servicePort: 80\\n      match:\\n        hosts:\\n          - app.example.com\\n        methods:\\n          - GET\\n        paths:\\n          - /*\\n      name: method\\n      plugins:\\n        - name: prometheus\\n          enable: true\\n          config:\\n            disable: false\\n            prefer_name: true\\n```\\n\\n\u5c06\u4e0a\u65b9\u4ee3\u7801\u4fdd\u5b58\u4e3a `podinfo-apisixroute.yaml` \u6587\u4ef6\u5e76\u4e14\u63d0\u4ea4\u5230\u96c6\u7fa4\u4e2d\u3002\\n\\n```shell\\nkubectl apply -f ./podinfo-apisixroute.yaml\\n```\\n\\n\u63a5\u4e0b\u6765\u53ef\u4ee5\u521b\u5efa Flagger \u7684\u81ea\u5b9a\u4e49\u8d44\u6e90 Canary\uff0c\u5982\u4e0b\u6240\u793a\uff08\u793a\u4f8b\u4e2d\u7684 `app.example.com` \u53ef\u4ee5\u66ff\u6362\u6210\u4f60\u7684\u5b9e\u9645\u57df\u540d\uff09\u3002\\n\\n```yaml\\napiVersion: flagger.app/v1beta1\\nkind: Canary\\nmetadata:\\n  name: podinfo\\n  namespace: test\\nspec:\\n  provider: apisix\\n  targetRef:\\n    apiVersion: apps/v1\\n    kind: Deployment\\n    name: podinfo\\n  # \u5f15\u7528 apisix route\\n  routeRef:\\n    apiVersion: apisix.apache.org/v2\\n    kind: ApisixRoute\\n    name: podinfo\\n  progressDeadlineSeconds: 60\\n  service:\\n    port: 80\\n    targetPort: 9898\\n  analysis:\\n    # \u8c03\u5ea6\u95f4\u9694 (\u9ed8\u8ba4 60s)\\n    interval: 10s\\n    # \u6700\u5927\u7684metric\u68c0\u6d4b\u5931\u8d25\u6b21\u6570\uff0c\u8d85\u8fc7\u5c06\u4f1a\u81ea\u52a8\u56de\u6eda\\n    threshold: 10\\n    # \u6d41\u91cf\u8def\u7531\u5230canary\u5e94\u7528\u7684\u6700\u5927\u767e\u5206\u6bd4\\n    # (0-100)\\n    maxWeight: 50\\n    # \u91d1\u4e1d\u96c0\u5206\u6790\u6e10\u8fdb\u7684\u6b65\u957f\\n    # (0-100)\\n    stepWeight: 10\\n    # \u901a\u8fc7Prometheus\u68c0\u67e5APISIX\u4e0a\u7684\u6d41\u91cf\u72b6\u51b5\\n    metrics:\\n      - name: request-success-rate\\n        # \u6700\u5c0f\u7684\u8bf7\u6c42\u6210\u529f\u7387 (\u975e 5xx \u54cd\u5e94)\\n        # (0-100)\\n        thresholdRange:\\n          min: 99\\n        interval: 1m\\n      - name: request-duration\\n        # P99 \u6700\u5927\u7684\u8bf7\u6c42\u5ef6\u8fdf\\n        # \u5355\u4f4d\u662f\u6beb\u79d2\\n        thresholdRange:\\n          max: 500\\n        interval: 30s\\n    webhooks:\\n        # \u81ea\u52a8\u4ea7\u751f\u6d41\u91cf\u4ee5\u4fbf\u8fdb\u884c\u91d1\u4e1d\u96c0\u5206\u6790\uff0c\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u4fee\u6539\\n      - name: load-test\\n        url: http://flagger-loadtester.test/\\n        timeout: 5s\\n        type: rollout\\n        metadata:\\n          cmd: |-\\n            hey -z 1m -q 10 -c 2 -h2 -host app.example.com http://apisix-gateway.apisix/api/info\\n```\\n\\n\u5c06\u4e0a\u8ff0\u4ee3\u7801\u4fdd\u5b58\u4e3a `podinfo-canary.yaml` \u6587\u4ef6\uff0c\u5e76\u63d0\u4ea4\u5230\u96c6\u7fa4\u4e2d\u3002\\n\\n```shell\\nkubectl apply -f ./podinfo-canary.yaml\\n```\\n\\n\u7a0d\u7b49\u4e00\u4e0b Flagger \u5c31\u4f1a\u81ea\u52a8\u751f\u6210\u76f8\u5173\u7684\u8d44\u6e90\u3002\\n\\n```bash\\n# \u4e3b\u52a8\u63d0\u4ea4\u7684\\ndeployment.apps/podinfo\\nhorizontalpodautoscaler.autoscaling/podinfo\\napisixroute/podinfo\\ncanary.flagger.app/podinfo\\n\\n# \u81ea\u52a8\u751f\u6210\u7684\\ndeployment.apps/podinfo-primary\\nhorizontalpodautoscaler.autoscaling/podinfo-primary\\nservice/podinfo\\nservice/podinfo-canary\\nservice/podinfo-primary\\napisixroute/podinfo-podinfo-canary\\n```\\n\\n\u6b64\u65f6\u4f60\u901a\u8fc7\u57df\u540d app.example.com \u8bbf\u95ee\u5e94\u7528\uff08\u793a\u4f8b\u4e2d\u7684 `app.example.com` \u53ef\u4ee5\u66ff\u6362\u6210\u4f60\u7684\u5b9e\u9645\u57df\u540d\uff09\uff0c\u4f60\u5c06\u4f1a\u770b\u5230\u5f53\u524d\u7248\u672c\u7684\u5e94\u7528\u7ec6\u8282\u3002\\n\\n![\u7248\u672c 1](https://static.apiseven.com/2022/12/26/63a9a4798e616.png)\\n\\n## \u5177\u4f53\u529f\u80fd\u5b9e\u8df5\\n\\n### \u81ea\u52a8\u91d1\u4e1d\u96c0\u53d1\u5e03\\n\\nFlagger \u5b9e\u73b0\u4e86\u4e00\u4e2a\u63a7\u5236\u5faa\u73af\uff0c\u5728\u6301\u7eed\u6d4b\u91cf HTTP \u8bf7\u6c42\u6210\u529f\u7387\u3001\u8bf7\u6c42\u5e73\u5747\u6301\u7eed\u65f6\u95f4\u548c Pod \u5065\u5eb7\u72b6\u51b5\u7b49\u5173\u952e\u6027\u80fd\u6307\u6807\u7684\u540c\u65f6\uff0c\u9010\u6e10\u5c06\u6d41\u91cf\u8f6c\u79fb\u81f3\u91d1\u4e1d\u96c0\u8282\u70b9\u3002\u6839\u636e\u5bf9\u76f8\u5173\u6307\u6807\u7684\u5206\u6790\uff0c\u53d1\u5e03\u6216\u4e2d\u6b62\u91d1\u4e1d\u96c0\u90e8\u7f72\uff0c\u5e76\u5c06\u5206\u6790\u7ed3\u679c\u53d1\u5e03\u5230\u76f8\u5173\u5e73\u53f0\u4f8b\u5982 Slack\u3001MS Teams \u6216\u8005 Prometheus Alert Manager \u7b49\u3002\\n\\n![Flagger \u63a7\u5236\u5faa\u73af](https://static.apiseven.com/2022/12/26/63a9a47bb7a3d.png)\\n\\n\u5177\u4f53\u53ef\u901a\u8fc7\u66f4\u65b0\u5bb9\u5668\u955c\u50cf\u7248\u672c\uff0c\u6765\u89e6\u53d1\u91d1\u4e1d\u96c0\u53d1\u5e03\u3002\\n\\n```shell\\nkubectl -n test set image deployment/podinfo \\\\\\npodinfod=stefanprodan/podinfo:6.0.1\\n```\\n\\n\u5f53 Flagger \u68c0\u6d4b\u5230 deployment \u6709\u65b0\u7248\u53d8\u66f4\u65f6\uff0c\u5c31\u4f1a\u5f00\u59cb\u8bd5\u8fd0\u884c\u91d1\u4e1d\u96c0\u5206\u6790\u53d1\u5e03\u3002\\n\\n```shell\\nkubectl -n test describe canary/podinfo\\n\\nStatus:\\n  Canary Weight:  0\\n  Conditions:\\n    Message:               Canary analysis completed successfully, promotion finished.\\n    Reason:                Succeeded\\n    Status:                True\\n    Type:                  Promoted\\n  Failed Checks:           1\\n  Iterations:              0\\n  Phase:                   Succeeded\\n\\nEvents:\\n  Type     Reason  Age                    From     Message\\n  ----     ------  ----                   ----     -------\\n  Warning  Synced  2m59s                  flagger  podinfo-primary.test not ready: waiting for rollout to finish: observed deployment generation less than desired generation\\n  Warning  Synced  2m50s                  flagger  podinfo-primary.test not ready: waiting for rollout to finish: 0 of 1 (readyThreshold 100%) updated replicas are available\\n  Normal   Synced  2m40s (x3 over 2m59s)  flagger  all the metrics providers are available!\\n  Normal   Synced  2m39s                  flagger  Initialization done! podinfo.test\\n  Normal   Synced  2m20s                  flagger  New revision detected! Scaling up podinfo.test\\n  Warning  Synced  2m (x2 over 2m10s)     flagger  canary deployment podinfo.test not ready: waiting for rollout to finish: 0 of 1 (readyThreshold 100%) updated replicas are available\\n  Normal   Synced  110s                   flagger  Starting canary analysis for podinfo.test\\n  Normal   Synced  109s                   flagger  Advance podinfo.test canary weight 10\\n  Warning  Synced  100s                   flagger  Halt advancement no values found for apisix metric request-success-rate probably podinfo.test is not receiving traffic: running query failed: no values found\\n  Normal   Synced  90s                    flagger  Advance podinfo.test canary weight 20\\n  Normal   Synced  80s                    flagger  Advance podinfo.test canary weight 30\\n  Normal   Synced  69s                    flagger  Advance podinfo.test canary weight 40\\n  Normal   Synced  59s                    flagger  Advance podinfo.test canary weight 50\\n  Warning  Synced  30s (x2 over 40s)      flagger  podinfo-primary.test not ready: waiting for rollout to finish: 1 old replicas are pending termination\\n  Normal   Synced  9s (x3 over 50s)       flagger  (combined from similar events): Promotion completed! Scaling down podinfo.test\\n```\\n\\n\u5728\u65b0\u7248\u672c\u91d1\u4e1d\u96c0\u53d1\u5e03\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u57df\u540d app.example.com \u8bbf\u95ee\u5e94\u7528\uff08\u793a\u4f8b\u4e2d\u7684 `app.example.com` \u53ef\u4ee5\u66ff\u6362\u6210\u4f60\u7684\u5b9e\u9645\u57df\u540d\uff09\uff0c\u8fd9\u91cc\u5c06\u4f1a\u51fa\u73b0\u4e0d\u540c\u7248\u672c\u7684\u54cd\u5e94\u5207\u6362\u3002\\n\\n![\u7248\u672c 2](https://static.apiseven.com/2022/12/26/63a9a47b281b0.png)\\n\\n\u901a\u8fc7\u67e5\u770b\u7531 Flagger \u81ea\u52a8\u521b\u5efa\u51fa\u6765\u7684 Apache APISIX \u7684 `ApisixRoute` \u8d44\u6e90 `podinfo-podinfo-canary`\uff0c\u4f1a\u53d1\u73b0 service `podinfo-primary` \u548c service `podinfo-canary` \u7684\u6743\u91cd\u8ddf\u968f\u7740\u53d1\u5e03\u8fc7\u7a0b\u4e00\u8d77\u53d8\u5316\u3002\\n\\n```yaml\\nspec:\\n  http:\\n    - backends:\\n        - serviceName: podinfo-primary\\n          servicePort: 80\\n          # Flagger\u81ea\u52a8\u8c03\u6574\\n          weight: 80\\n        - serviceName: podinfo-canary\\n          servicePort: 80\\n          # Flagger\u81ea\u52a8\u8c03\u6574\\n          weight: 20\\n```\\n\\n\u5f53\u6700\u7ec8\u53d1\u5e03\u5b8c\u6210\u540e\uff0c\u5c06\u4f1a\u770b\u5230\u7a33\u5b9a\u7684\u6700\u65b0\u7248\u672c\u3002\\n\\n![\u7248\u672c 3](https://static.apiseven.com/2022/12/26/63a9a479d5bbe.png)\\n\\n:::note \u6ce8\u610f\\n\\n\u5982\u82e5\u5728\u91d1\u4e1d\u96c0\u53d1\u5e03\u671f\u95f4\u518d\u6b21\u53d8\u66f4\u4e86 deployment\uff0cFlagger \u5c06\u4f1a\u91cd\u65b0\u8fdb\u884c\u91d1\u4e1d\u96c0\u5206\u6790\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u6765\u89c2\u5bdf\u5230\u6240\u6709\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03\u7ec6\u8282\u3002\\n\\n:::\\n\\n```bash\\nwatch kubectl get canaries --all-namespaces\\n\\nNAMESPACE   NAME      STATUS      WEIGHT   LASTTRANSITIONTIME\\ntest        podinfo-2   Progressing   10       2022-11-23T05:00:54Z\\ntest        podinfo     Succeeded     0        2022-11-23T06:00:54Z\\n```\\n\\n### \u81ea\u52a8\u56de\u6eda\\n\\n\u5728\u91d1\u4e1d\u96c0\u53d1\u5e03\u5206\u6790\u671f\u95f4\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u751f\u6210 HTTP `500` \u9519\u8bef\u8bf7\u6c42\uff0c\u6d4b\u8bd5 Flagger \u6682\u505c\u91d1\u4e1d\u96c0\u53d1\u5e03\u5e76\u56de\u6eda\u5230\u65e7\u7248\u672c\u3002\\n\\n\u9996\u5148\u9700\u8981\u89e6\u53d1\u53e6\u4e00\u4e2a\u91d1\u4e1d\u96c0\u53d1\u5e03\u3002\\n\\n```bash\\nkubectl -n test set image deployment/podinfo \\\\\\npodinfod=stefanprodan/podinfo:6.0.2\\n```\\n\\n\u7136\u540e\u8fdb\u5165\u5230 load tester \u5bb9\u5668\u4e2d\u3002\\n\\n```bash\\nkubectl -n test exec -it deploy/flagger-loadtester bash\\n```\\n\\n\u63a5\u7740\u53bb\u751f\u6210 HTTP `500` \u9519\u8bef\uff0c\u5e76\u6a21\u62df\u670d\u52a1\u5ef6\u8fdf\u3002\\n\\n```bash\\nhey -z 1m -c 5 -q 5 -host app.example.com http://apisix-gateway.apisix/status/500\\n\\nwatch -n 1 curl -H \\\\\\"host: app.example.com\\\\\\" http://apisix-gateway.apisix/delay/1\\n```\\n\\n\u5f53\u5931\u8d25\u6307\u6807\u7684\u68c0\u6d4b\u6b21\u6570\u8fbe\u5230\u91d1\u4e1d\u96c0\u5206\u6790\u7684\u9608\u503c\u65f6\uff0c\u6d41\u91cf\u5c06\u88ab\u81ea\u52a8\u8def\u7531\u5230\u4e3b\u8282\u70b9\u3002\u91d1\u4e1d\u96c0\u8282\u70b9\u88ab\u7f29\u5c0f\u5230\u96f6\uff0c\u8be5\u91d1\u4e1d\u96c0\u53d1\u5e03\u8fc7\u7a0b\u88ab\u6807\u8bb0\u4e3a\u5931\u8d25\u3002\\n\\n```bash\\nkubectl -n apisix logs deploy/flagger -f | jq .msg\\n\\n\\"New revision detected! Scaling up podinfo.test\\"\\n\\"canary deployment podinfo.test not ready: waiting for rollout to finish: 0 of 1 (readyThreshold 100%) updated replicas are available\\"\\n\\"Starting canary analysis for podinfo.test\\"\\n\\"Advance podinfo.test canary weight 10\\"\\n\\"Halt podinfo.test advancement success rate 0.00% < 99%\\"\\n\\"Halt podinfo.test advancement success rate 26.76% < 99%\\"\\n\\"Halt podinfo.test advancement success rate 34.19% < 99%\\"\\n\\"Halt podinfo.test advancement success rate 37.32% < 99%\\"\\n\\"Halt podinfo.test advancement success rate 39.04% < 99%\\"\\n\\"Halt podinfo.test advancement success rate 40.13% < 99%\\"\\n\\"Halt podinfo.test advancement success rate 48.28% < 99%\\"\\n\\"Halt podinfo.test advancement success rate 50.35% < 99%\\"\\n\\"Halt podinfo.test advancement success rate 56.92% < 99%\\"\\n\\"Halt podinfo.test advancement success rate 67.70% < 99%\\"\\n\\"Rolling back podinfo.test failed checks threshold reached 10\\"\\n\\"Canary failed! Scaling down podinfo.test\\"\\n```\\n\\n### \u81ea\u5b9a\u4e49\u6307\u6807\u91d1\u4e1d\u96c0\u5206\u6790\\n\\n\u91d1\u4e1d\u96c0\u5206\u6790\u53ef\u4ee5\u901a\u8fc7\u67e5\u8be2 Prometheus \u7684\u6307\u6807\u8fdb\u884c\u6269\u5c55\uff0c\u5177\u4f53\u53ef\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u8fdb\u884c\u8c03\u6574\u3002\u4e3b\u8981\u64cd\u4f5c\u662f\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u6307\u6807\u6a21\u677f\uff0c\u5e76\u63d0\u4ea4\u5230\u96c6\u7fa4\u3002\\n\\n```yaml\\napiVersion: flagger.app/v1beta1\\nkind: MetricTemplate\\nmetadata:\\n  name: not-found-percentage\\n  namespace: test\\nspec:\\n  provider:\\n    type: prometheus\\n    address: http://flagger-prometheus.apisix:9090\\n  query: |\\n    sum(\\n      rate(\\n        apisix_http_status{\\n          route=~\\"{{ namespace }}_{{ route }}-{{ target }}-canary_.+\\",\\n          code!~\\"4..\\"\\n        }[{{ interval }}]\\n      )\\n    )\\n    /\\n    sum(\\n      rate(\\n        apisix_http_status{\\n          route=~\\"{{ namespace }}_{{ route }}-{{ target }}-canary_.+\\"\\n        }[{{ interval }}]\\n      )\\n    ) * 100\\n# \u4fee\u6539\u91d1\u4e1d\u96c0\u53d1\u5e03\u4e2d\u7684 analysis\uff0c\u6dfb\u52a0\u4e0a\u9762\u521b\u5efa\u7684\u6307\u6807\u6a21\u7248\u3002\\n  analysis:\\n    metrics:\\n      - name: \\"404s percentage\\"\\n        templateRef:\\n          name: not-found-percentage\\n        thresholdRange:\\n          max: 5\\n        interval: 1m\\n```\\n\\n\u4e0a\u8ff0\u914d\u7f6e\u5185\u5bb9\u4e3b\u8981\u662f\u901a\u8fc7\u68c0\u67e5 HTTP `404` \u8bf7\u6c42\u7684 QPS \u662f\u5426\u9ad8\u4e8e\u603b\u6d41\u91cf\u7684 5% \u6765\u9a8c\u8bc1\u91d1\u4e1d\u96c0\u3002\u5982\u679c HTTP `404` \u8bf7\u6c42\u8d85\u8fc7 5% \u7684\u9608\u503c\uff0c\u90a3\u4e48\u91d1\u4e1d\u96c0\u53d1\u5e03\u5c31\u5931\u8d25\u4e86\u3002\\n\\n## \u603b\u7ed3\\n\\n\u5f53\u7136\uff0c\u4ee5\u4e0a\u8fc7\u7a0b\u8fd8\u53ef\u4ee5\u901a\u8fc7\u66f4\u591a\u7684\u81ea\u5b9a\u4e49\u6307\u6807\u68c0\u67e5\u3001Webhook\u3001\u624b\u52a8\u5ba1\u6279\u548c Slack \u6216 MS Teams \u901a\u77e5\u7b49\u8fdb\u884c\u6269\u5c55\u3002\\n\\n\u901a\u8fc7 Apache APISIX \u548c Flagger \u7684\u6574\u5408\uff0c\u5b9e\u73b0\u4e86\u975e\u5e38\u987a\u6ed1\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03\u3002\u5728\u4e1a\u52a1\u5b9e\u8df5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u63d0\u9ad8\u4e86\u53d1\u5e03\u6548\u7387\uff0c\u964d\u4f4e\u4e86\u53d1\u5e03\u98ce\u9669\u3002\u540e\u7eed\u4e24\u4e2a\u793e\u533a\u4e5f\u4f1a\u901a\u8fc7\u66f4\u7d27\u5bc6\u7684\u5408\u4f5c\uff0c\u53bb\u5b9e\u73b0 Blue/Green Mirroring \u548c A/B Testing \u7b49\u66f4\u591a\u7684\u53d1\u5e03\u80fd\u529b\u7279\u6027\u3002"},{"id":"APISIX Ingress \u5bf9 Gateway API \u7684\u652f\u6301\u548c\u5e94\u7528","metadata":{"permalink":"/zh/blog/2022/12/27/apisix-ingress-with-gatewayapi","source":"@site/blog/2022/12/27/apisix-ingress-with-gatewayapi.md","title":"APISIX Ingress \u5bf9 Gateway API \u7684\u652f\u6301\u548c\u5e94\u7528","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 Gateway API \u8fd9\u4e2a\u5c06\u670d\u52a1\u66b4\u9732\u5230\u96c6\u7fa4\u4e4b\u5916\u7684\u5168\u65b0\u89c4\u8303\uff0c\u5e76\u4e14\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 APISIX Ingress Controller \u4e2d\u4f7f\u7528\u5b83\u3002","date":"2022-12-27T00:00:00.000Z","formattedDate":"2022\u5e7412\u670827\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.35,"truncated":true,"authors":[{"name":"lingsamuel","url":"https://github.com/lingsamuel","imageURL":"https://github.com/lingsamuel.png"}],"prevItem":{"title":"APISIX Ingress + Flagger \u5b9e\u73b0\u987a\u6ed1\u7684\u91d1\u4e1d\u96c0\u53d1\u5e03","permalink":"/zh/blog/2022/12/27/apisix-ingress-with-Flagger"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (12.05 - 12.18)","permalink":"/zh/blog/2022/12/22/weekly-report-1218"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Gateway API \u8fd9\u4e2a\u5c06\u670d\u52a1\u66b4\u9732\u5230\u96c6\u7fa4\u4e4b\u5916\u7684\u5168\u65b0\u89c4\u8303\uff0c\u5e76\u4e14\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 APISIX Ingress Controller \u4e2d\u4f7f\u7528\u5b83\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005@lingsamuel\uff0cAPI7.ai \u4e91\u539f\u751f\u6280\u672f\u4e13\u5bb6\uff0cApache APISIX Committer\u3002\\n\\nGateway API \u662f\u9664\u539f\u751f Service \u4e0e Ingress \u4e4b\u5916\uff0cAPISIX \u793e\u533a\u53d1\u8d77\u7684\u72ec\u7acb\u89c4\u8303\uff0c\u5e2e\u52a9\u7528\u6237\u5c06 Kubernetes \u4e2d\u7684\u670d\u52a1\u66b4\u9732\u5230\u96c6\u7fa4\u4e4b\u5916\uff0c\u7531 [sig-network](https://github.com/kubernetes/community/tree/master/sig-network) \uff08\u7279\u522b\u5174\u8da3\u5c0f\u7ec4\uff09\u7ba1\u7406\u3002\\n\\nGateway API \u652f\u6301\u5927\u90e8\u5206\u5e38\u7528\u7f51\u7edc\u534f\u8bae\uff08HTTP\u3001TCP\u3001UDP \u7b49\uff09\u548c\u5bf9 TLS \u7684\u652f\u6301\u3002\u6b64\u5916\uff0cGateway API \u4e2d\u7684 Gateway \u8d44\u6e90\u80fd\u591f\u901a\u8fc7 Kubernetes API \u6765\u7ba1\u7406\u4ee3\u7406\u548c\u7f51\u5173\u7684\u751f\u547d\u5468\u671f\u3002\\n\\n\u968f\u7740 Gateway API \u88ab[\u5e7f\u6cdb\u5b9e\u73b0](https://gateway-api.sigs.k8s.io/implementations/)\u4e0e\u5e94\u7528\uff0cGateway API \u53d1\u5e03\u4e86 v0.5.0 \u7248\u672c\u3002\u5728\u8be5\u7248\u672c\u4e2d\uff0c\u4e00\u4e9b\u6838\u5fc3 API \u9996\u6b21\u8fdb\u5165 Beta \u9636\u6bb5\uff0c\u5305\u62ec\uff1aGatewayClass\u3001Gateway\u3001HTTPRoute\u3002\\n\\n### **Gateway API \u4f18\u52bf\u76d8\u70b9**\\n\\nGateway API \u4e0d\u4ec5\u662f Ingress \u7684\u529f\u80fd\u7236\u96c6\uff0c\u8fd8\u5177\u6709\u5982\u4e0b\u6539\u8fdb\uff1a\\n\\n* **\u9762\u5411\u89d2\u8272**\uff1aGateway \u7531\u4e00\u7ec4 API \u8d44\u6e90\u7ec4\u6210\uff0c\u4e0d\u540c\u7684 API \u8d44\u6e90\u4ee3\u8868\u4e86\u4f7f\u7528\u4e0e\u914d\u7f6e Kubernetes \u7f51\u7edc\u8d44\u6e90\u7684\u4e0d\u540c\u89d2\u8272\u3002\\n* **\u8868\u73b0\u529b\u5f3a**\uff1aGateway API \u7684\u6838\u5fc3\u529f\u80fd\u5305\u542b\u57fa\u4e8e Header \u5339\u914d\u3001\u6d41\u91cf\u52a0\u6743\u4ee5\u53ca\u4ee5\u53ca\u5176\u4ed6\u90e8\u5206\u7531 annotations \u5b9e\u73b0\u7684\u975e\u6807\u51c6\u5316\u529f\u80fd\u3002\\n* **\u53ef\u6269\u5c55**\uff1aGateway API \u5141\u8bb8\u4e0d\u540c\u8d44\u6e90\u5728\u4e0d\u540c\u5c42\u7ea7\u4e00\u540c\u4f7f\u7528\u3002\u8fd9\u4f7f\u5f97\u80fd\u591f\u5bf9 API \u7ed3\u6784\u8fdb\u884c\u66f4\u7cbe\u7ec6\u5316\u7684\u63a7\u5236\u3002\\n\\n\u6b64\u5916\uff0cGateway API \u8fd8\u5305\u542b\u4e86\u53ef\u79fb\u690d\u3001\u7f51\u5173\u5171\u4eab\u4e0e\u8de8\u547d\u540d\u7a7a\u95f4\u5f15\u7528\u7b49\u7279\u6027\u3002\\n\\n\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u9762\u5411\u89d2\u8272\u7684\u8bbe\u8ba1\u4f7f\u4e0d\u540c\u56e2\u961f\u4e4b\u95f4\u53ef\u4ee5\u5171\u4eab\u96c6\u7fa4\u5185\u90e8\u7684\u7f51\u7edc\u57fa\u7840\u8bbe\u65bd\uff0c\u548c\u96c6\u7fa4\u7ba1\u7406\u5458\u8bbe\u7f6e\u7684\u7b56\u7565\u4e0e\u7ea6\u675f\u3002\u7531\u6b64\uff0c\u57fa\u7840\u8bbe\u65bd\u63d0\u4f9b\u65b9\u3001\u96c6\u7fa4\u7ba1\u7406\u5458\u3001\u5e94\u7528\u5f00\u53d1\u8005\u7b49\u5404\u79cd\u8eab\u4efd\u7684\u89d2\u8272\u53ef\u4ee5\u53ea\u4e13\u6ce8\u81ea\u5df1\u7684\u5de5\u4f5c\uff0c\u65e0\u9700\u5bf9\u5176\u4ed6\u89d2\u8272\u8d1f\u8d23\u3002\\n\\n\u4e0d\u540c\u7684\u89d2\u8272\u914d\u7f6e\u4e0d\u540c\u5c42\u7ea7\u7684 Gateway API \u8d44\u6e90\uff0c\u8fd9\u4e9b\u8d44\u6e90\u76f8\u4e92\u914d\u5408\uff0c\u5171\u540c\u4f5c\u7528\uff1a\\n\\n## \u5982\u4f55\u5728 APISIX Ingress \u4e2d\u4f7f\u7528 Gateway API\\n\\n### \u7b2c\u4e00\u6b65\uff1a\u5b89\u88c5 Gateway API CRD\\n\\n\u8981\u4f7f\u7528 Gateway API\uff0c\u9700\u8981\u5148\u5b89\u88c5 Gateway API \u7684 CRD\uff0c\u6709\u4e24\u79cd\u5b89\u88c5\u65b9\u5f0f\uff1aAPISIX Ingress Controller \u4ed3\u5e93\u4e0b\u7684\u526f\u672c\u6216\u5b98\u65b9\u4ed3\u5e93 [kubernetes-sigs/gateway-api](https://github.com/kubernetes-sigs/gateway-api/tree/main/config/crd/experimental)\u3002\\n\\n\u6b64\u5904\u4ee5 APISIX Ingress Controller \u4ed3\u5e93\u7684 CRD \u526f\u672c\u4e3a\u4f8b\uff0c\u5b89\u88c5\u547d\u4ee4\u5982\u4e0b\uff1a\\n\\n```shell\\ngit pull git@github.com:apache/apisix-ingress-controller.git\\ncd apisix-ingress-controller\\nkubectl apply -f ./samples/deploy/gateway-api/\\n```\\n\\n### \u7b2c\u4e8c\u6b65\uff1a\u5b89\u88c5 APISIX Ingress Controller\\n\\n\u5728 APISIX Ingress Controller \u4e2d\uff0c\u9ed8\u8ba4\u4e0d\u542f\u7528 Gateway API \u652f\u6301\uff0c\u53ef\u901a\u8fc7\u53c2\u6570 `--enable-gateway-api=true` \u542f\u7528\u3002\u968f\u540e\u5728\u4f7f\u7528 Helm \u5b89\u88c5\u65f6\uff0c\u53ef\u901a\u8fc7\u914d\u7f6e values \u6765\u542f\u7528\u3002\\n\\nAPISIX \u4e0e APISIX Ingress Controller \u5b89\u88c5\u547d\u4ee4\u5982\u4e0b\uff1a\\n\\n```shell\\nhelm repo add apisix https://charts.apiseven.com\\nhelm repo add bitnami https://charts.bitnami.com/bitnami\\nhelm repo update\\nkubectl create ns apisix-ingress\\nhelm install apisix apisix/apisix --namespace apisix-ingress \\\\\\n  --set gateway.type=NodePort \\\\\\n  --set ingress-controller.enabled=true \\\\\\n  --set ingress-controller.config.apisix.serviceNamespace=apisix-ingress \\\\\\n  --set ingress-controller.config.kubernetes.enableGatewayAPI=true\\n```\\n\\n:::note \u6ce8\u610f\\n\\n\u53c2\u6570 `--set ingress-controller.config.kubernetes.enableGatewayAPI=true` \u7528\u4e8e\u5f00\u542f Gateway API \u652f\u6301\u3002\\n\\n:::\\n\\n\u8fd9\u4e9b\u547d\u4ee4\u5c06\u5728 `apisix-ingress` \u547d\u540d\u7a7a\u95f4\u4e0b\u521b\u5efa\u5b8c\u6574\u7684\u6d4b\u8bd5\u73af\u5883\uff0c\u5305\u62ec APISIX\u3001etcd \u4e0e APISIX Ingress Controller\u3002\\n\\n### \u7b2c\u4e09\u6b65\uff1a\u90e8\u7f72\u6d4b\u8bd5\u8d1f\u8f7d\\n\\n\u4f7f\u7528 `kennethreitz/httpbin` \u955c\u50cf\u4f5c\u4e3a\u6d4b\u8bd5\u8d1f\u8f7d\u3002\\n\\n\u5728\u9ed8\u8ba4\u547d\u540d\u7a7a\u95f4\u4e0b\u90e8\u7f72\u8fd9\u4e9b\u8d1f\u8f7d\uff0c\u5b89\u88c5\u547d\u4ee4\u5982\u4e0b\uff1a\\n\\n```shell\\nkubectl run httpbin --image kennethreitz/httpbin --port 80\\nkubectl expose pod httpbin --port 80\\n```\\n\\n### \u7b2c\u56db\u6b65\uff1a\u914d\u7f6e HTTPRoute\\n\\n\u76ee\u524d\uff0cAPISIX Ingress Controller \u652f\u6301 `v1alpha2` \u7248\u672c\u7684 Gateway API \u8d44\u6e90\u3002\\n\\n\u5728\u6d4b\u8bd5\u65f6\uff0c\u4f7f\u7528\u5982\u4e0b HTTPRoute \u914d\u7f6e\uff0c\u5c06\u5176\u4fdd\u5b58\u5230 `httproute.yaml` \u6587\u4ef6\u4e2d\uff1a\\n\\n```yaml\\n# httproute.yaml\\napiVersion: gateway.networking.k8s.io/v1alpha2\\nkind: HTTPRoute\\nmetadata:\\n  name: basic-http-route\\nspec:\\n  hostnames:\\n  - local.httpbin.org\\n  rules:\\n  - backendRefs:\\n    - name: httpbin\\n      port: 80\\n    matches:\\n    - path:\\n        type: PathPrefix\\n        value: /\\n```\\n\\n\u90e8\u7f72\u8be5 HTTPRoute \u914d\u7f6e\uff1a\\n\\n```shell\\nkubectl apply -f ./httproute.yaml\\n```\\n\\n### \u7b2c\u4e94\u6b65\uff1a\u9a8c\u8bc1\\n\\n\u5728 APISIX \u7684 Pod \u4e2d\u76f4\u63a5\u9a8c\u8bc1\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\\n\\n```shell\\nkubectl -n apisix-ingress exec -it \\\\\\n  $(kubectl -n apisix-ingress get Pods -l \\"app.kubernetes.io/name=apisix\\" -o name) -c apisix -- \\\\\\n  curl -H \\"Host: local.httpbin.org\\" localhost:9080/ip\\n```\\n\\n\u9884\u671f\u8f93\u51fa\u4e3a\uff1a\\n\\n```shell\\n{\\n  \\"origin\\": \\"127.0.0.1\\"\\n}\\n```\\n\\n\u7531\u6b64\uff0c\u914d\u7f6e\u6210\u529f\u751f\u6548\u3002\\n\\n## APISIX Ingress \u5bf9 Gateway API \u7684\u652f\u6301\u72b6\u6001\\n\\nAPISIX Ingress Controller \u6b63\u5728\u5bf9 Gateway API \u6dfb\u52a0\u652f\u6301\uff0c\u73b0\u5df2\u5904\u4e8e Alpha \u9636\u6bb5\uff0c\u652f\u6301 HTTPRoute\u3001TCPRoute \u7b49\u8d44\u6e90\u3002\\n\\n\u76ee\u524d Gateway API \u5df2\u66f4\u65b0\u81f3 v0.5.1 \u7248\u672c\uff0c\u4f46\u5bf9\u4e8e Gateway \u4e0e Gateway Class \u7684\u652f\u6301\u8fd8\u5904\u4e8e\u5f00\u53d1\u9636\u6bb5\uff0c\u56e0\u6b64\u76ee\u524d\u8fd9\u4e9b\u8d44\u6e90\u7684\u914d\u7f6e\u6682\u65f6\u4e0d\u4f1a\u751f\u6548\u3002\\n\\n## \u603b\u7ed3\\n\\n\u5728\u672c\u6587\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86 Gateway API \u8fd9\u4e2a\u5c06\u670d\u52a1\u66b4\u9732\u5230\u96c6\u7fa4\u4e4b\u5916\u7684\u5168\u65b0\u89c4\u8303\uff0c\u5e76\u4e14\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 APISIX Ingress Controller \u4e2d\u4f7f\u7528\u5b83\u3002APISIX Ingress Controller \u5bf9 Gateway API \u7684\u5b8c\u6574\u652f\u6301\u4ecd\u5728\u79ef\u6781\u5f00\u53d1\u4e2d\uff0c\u6b22\u8fce\u611f\u5174\u8da3\u7684\u670b\u53cb\u53c2\u4e0e\u8d21\u732e\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (12.05 - 12.18)","metadata":{"permalink":"/zh/blog/2022/12/22/weekly-report-1218","source":"@site/blog/2022/12/22/weekly-report-1218.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (12.05 - 12.18)","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86\u56fd\u5bc6\u5bc6\u7801\u5957\u4ef6\uff0c\u57df\u540d\u89e3\u6790\u4f18\u5316\uff0cAdmin API \u901a\u8fc7 gRPC \u534f\u8bae\u94fe\u63a5 ectd \u7b49\u65b0\u529f\u80fd\u3002","date":"2022-12-22T00:00:00.000Z","formattedDate":"2022\u5e7412\u670822\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":5.405,"truncated":true,"authors":[],"prevItem":{"title":"APISIX Ingress \u5bf9 Gateway API \u7684\u652f\u6301\u548c\u5e94\u7528","permalink":"/zh/blog/2022/12/27/apisix-ingress-with-gatewayapi"},"nextItem":{"title":"\u4e3a\u4ec0\u4e48 APISIX Ingress \u662f\u6bd4 Traefik \u66f4\u597d\u7684\u9009\u62e9\uff1f","permalink":"/zh/blog/2022/12/19/apisix-ingress-better-than-traefik"}},"content":"> \u4ece 12 \u6708 5 \u65e5\u5f00\u59cb\u5df2\u6709 27 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 68 \u4e2a commit\u3002\u611f\u8c22\u4ee5\u4e0b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff08\u6392\u540d\u4e0d\u5206\u5148\u540e\uff09\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u8d21\u732e\u8005\u6d77\u62a5-1205-1218.png](https://static.apiseven.com/2022/12/22/63a411bfb3595.png)\\n\\n![\u65b0\u664b\u8d21\u732e\u8005\u6d77\u62a51205-1218.png](https://static.apiseven.com/2022/12/22/63a411c0d2e44.png)\\n\\n## Good first issue\\n\\n### Issue #1522\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1522\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5728 APISIX Ingress \u7684\u5b98\u7f51\u6587\u6863\u5185\uff0c\u6d89\u53ca\u5230\u4e00\u4e9b\u57fa\u7840\u7ec4\u6210\u8981\u7d20\u7684\u5185\u5bb9\u4e2d\uff0c\u591a\u4e2a\u6587\u6863\u4e4b\u95f4\u5b58\u5728\u4e0d\u540c\u6b65/\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002\\n\\n### Issue #1547\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1547\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0cCHANGELOG \u6587\u4ef6\u5e94\u8be5\u7531 release-tools \u81ea\u52a8\u751f\u6210\u3002\u800c\u5728\u6700\u8fd1\u7684\u60c5\u51b5\u4e2d\uff0cmake update-all \u6307\u4ee4\u53ef\u4ee5\u4fee\u6539 CHANGELOG \u6587\u4ef6\uff0c\u8fd9\u4e2a\u95ee\u9898\u9700\u8981\u4fee\u590d\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n### Apache APISIX\\n\\n- [\u65b0\u589e `inspect` \u63d2\u4ef6](https://github.com/apache/apisix/pull/8400)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n- [\u65b0\u589e\u652f\u6301 Consul \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0\u6a21\u5f0f](https://github.com/apache/apisix/pull/8380)\uff08\u8d21\u732e\u8005\uff1a[Fabriceli](https://github.com/Fabriceli)\uff09\\n\\n- [\u652f\u6301 `prometheus` \u63d2\u4ef6\u5728\u7279\u6743\u8fdb\u7a0b\u4e2d\u8ba1\u7b97\u6307\u6807](https://github.com/apache/apisix/pull/8434)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [\u652f\u6301\u901a\u8fc7 gRPC \u540c\u6b65\u6570\u636e](https://github.com/apache/apisix/pull/8450)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [file-logger \u63d2\u4ef6\u652f\u6301\u8bb0\u5f55\u54cd\u5e94\u4f53\u5185\u5bb9](https://github.com/apache/apisix/pull/8414)\uff08\u8d21\u732e\u8005\uff1a[pixeldin](https://github.com/pixeldin)\uff09\\n\\n- [\u652f\u6301\u5728 Stream \u5b50\u7cfb\u7edf\u4e2d\u89e3\u6790\u57df\u540d](https://github.com/apache/apisix/pull/8500)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n### Apache APISIX Ingress\\n\\n- [\u4e3a Ingress \u8d44\u6e90\u6dfb\u52a0\u4e86\u65b0\u7684 Annotation \u6765\u652f\u6301 response-rewrite \u63d2\u4ef6](https://github.com/apache/apisix-ingress-controller/pull/1487)\uff08\u8d21\u732e\u8005\uff1a[An-DJ](https://github.com/An-DJ)\uff09\\n\\n- [Ingress: \u4fee\u6b63\u4e86\u6570\u4e07 namespace \u573a\u666f\u4e0b\uff0c\u521d\u59cb\u5316\u8017\u65f6\u7684\u95ee\u9898](https://github.com/apache/apisix-ingress-controller/pull/1386)\uff08\u8d21\u732e\u8005\uff1a[shareinto](https://github.com/shareinto)\uff09\\n\\n- [Ingress\uff1a\u5141\u8bb8\u4ee3\u7406\u7684\u5916\u90e8\u670d\u52a1\u53ef\u76f4\u63a5\u6307\u5b9a Port](https://github.com/apache/apisix-ingress-controller/pull/1500)\uff08\u8d21\u732e\u8005\uff1a[Gallardot](https://github.com/Gallardot)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u805a\u7126\u4eba\u673a\u4ea4\u4e92\u667a\u80fd\u5e94\u7528\u9886\u57df\uff0cAPISIX \u5728\u5e0c\u6c83\u7f51\u5173\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/12/13/seewo-with-apache-apisix/)\\n\\n    \u968f\u7740\u6280\u672f\u7684\u98de\u901f\u53d1\u5c55\uff0c\u5728\u4eba\u9645\u4ea4\u4e92\u667a\u80fd\u9886\u57df\uff0c\u4e1a\u52a1\u9700\u6c42\u4e5f\u5bf9\u67b6\u6784\u8fed\u4ee3\u6709\u4e86\u66f4\u9ad8\u7684\u8981\u6c42\u3002\u4e3a\u4e86\u5e94\u5bf9\u65e5\u8d8b\u6210\u719f\u53ca\u5feb\u901f\u589e\u957f\u7684\u4e1a\u52a1\u73b0\u72b6\uff0c\u5e0c\u6c83\u53c8\u662f\u5982\u4f55\u5728\u7f51\u5173\u5c42\u9762\u8fdb\u884c\u8ddf\u8fdb\u7684\u5462\uff1f\\n\\n- [\u667a\u6167\u4ea4\u901a\u7cfb\u7edf\u7f51\u65b0\u7535\u6c14\uff0c\u5982\u4f55\u57fa\u4e8e APISIX \u8fed\u4ee3\u6570\u5b57\u667a\u8054\u5e73\u53f0](https://apisix.apache.org/zh/blog/2022/12/09/insigma-with-apache-apisix/)\\n\\n    \u5728\u57ce\u5e02\u667a\u80fd\u4ea4\u901a\u7684\u8986\u76d6\u8303\u56f4\u4e0b\uff0c\u5f88\u591a\u573a\u666f\u5bf9\u4e8e\u6d41\u91cf\u5904\u7406\u548c\u7cfb\u7edf\u7a33\u5b9a\u6027\u90fd\u8981\u6c42\u6781\u9ad8\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u79cd\u57ce\u5e02\u7ea7\u522b\u7684\u6570\u5b57\u667a\u80fd\u8981\u6c42\uff0c\u7f51\u65b0\u7535\u6c14\u57fa\u4e8e APISIX \u8fdb\u884c\u4e86\u7f51\u5173\u5c42\u9762\u7684\u8fed\u4ee3\u3002\\n\\n- [Apache APISIX \u73a9\u8f6c Tongsuo \u56fd\u5bc6\u63d2\u4ef6](https://apisix.apache.org/zh/blog/2022/12/08/apisix-support-tongsuo/)\\n\\n    \u672c\u6587\u901a\u8fc7\u89e3\u8bfb\u56fd\u5bc6\u7684\u76f8\u5173\u5185\u5bb9\u4e0e\u6807\u51c6\uff0c\u5448\u73b0\u4e86\u5f53\u4e0b\u56fd\u5185\u6280\u672f\u73af\u5883\u4e2d\u5bf9\u4e8e\u56fd\u5bc6\u529f\u80fd\u652f\u6301\u7684\u73b0\u72b6\u3002\u5e76\u4ece API \u7f51\u5173 Apache APISIX \u7684\u89d2\u5ea6\uff0c\u5e26\u6765\u6709\u5173\u56fd\u5bc6\u7684\u63a2\u7d22\u4e0e\u529f\u80fd\u5448\u73b0\u3002\\n\\n- [APISIX \u5728\u541b\u6da6\u4eba\u529b\u4e91\u539f\u751f\u5e73\u53f0\u7684\u67b6\u6784\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/12/07/junrunrenli-with-apisix/)\\n\\n    \u672c\u6587\u4ece\u541b\u6da6\u4eba\u529b\u4e1a\u52a1\u5feb\u901f\u6269\u5f20\u7684\u80cc\u666f\u5165\u624b\uff0c\u91cd\u70b9\u4ecb\u7ecd\u5f00\u6e90 API \u7f51\u5173 APISIX \u5bf9\u5176\u81ea\u7814\u5e73\u53f0\u7cfb\u7edf\u67b6\u6784\u7684\u591a\u6837\u5316\u5e94\u7528\u573a\u666f\u652f\u6301\u3002\\n\\n- [\u8bd1\u6587 | A poor man\'s API](https://apisix.apache.org/zh/blog/2022/12/a-poor-man%E2%80%98s-api/)\\n\\n    \u672c\u6587\u5c06\u5c55\u793a\u5982\u4f55\u5728\u4e0d\u7f16\u5199\u4efb\u4f55\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u7b80\u5355\u5b9e\u73b0\u4e00\u4e2a API \u5b9e\u8df5\u3002\\n\\n- [APISIX Ingress \u662f\u5982\u4f55\u652f\u6301\u4e0a\u5343\u4e2a Pod \u526f\u672c\u7684\u5e94\u7528](https://apisix.apache.org/zh/blog/2022/11/25/how-apisix-support-1000-pods/)\\n\\n    \u672c\u6587\u901a\u8fc7\u4ecb\u7ecd Kubernetes \u4e2d\u4e0a\u5343\u4e2a Pod \u526f\u672c\u5e94\u7528\u573a\u666f\u7684\u89e3\u6790\uff0c\u63d0\u51fa\u6280\u672f\u5b9e\u73b0\u7684\u56f0\u96be\u3002\u4ecb\u7ecd APISIX Ingress \u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e00\u96be\u9898\u7684\u3002\\n\\n- [\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u662f\u4ec0\u4e48](https://apisix.apache.org/zh/blog/2022/11/10/what-is-service-in-microservice-discovery/)\\n\\n    \u672c\u6587\u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u7684\u76f8\u5173\u80cc\u666f\u548c APISIX \u5bf9\u4e8e\u670d\u52a1\u53d1\u73b0\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\uff0c\u6765\u4ecb\u7ecd\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5185\u5bb9\u3002"},{"id":"\u4e3a\u4ec0\u4e48 APISIX Ingress \u662f\u6bd4 Traefik \u66f4\u597d\u7684\u9009\u62e9\uff1f","metadata":{"permalink":"/zh/blog/2022/12/19/apisix-ingress-better-than-traefik","source":"@site/blog/2022/12/19/apisix-ingress-better-than-traefik.md","title":"\u4e3a\u4ec0\u4e48 APISIX Ingress \u662f\u6bd4 Traefik \u66f4\u597d\u7684\u9009\u62e9\uff1f","description":"\u672c\u6587\u53ef\u4ee5\u4e3a\u6b63\u5728\u9009\u578b Kubernetes Ingress Controller \u4ea7\u54c1\u7684\u7528\u6237\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002","date":"2022-12-19T00:00:00.000Z","formattedDate":"2022\u5e7412\u670819\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.88,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","url":"https://github.com/tao12345666333","imageURL":"https://github.com/tao12345666333.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (12.05 - 12.18)","permalink":"/zh/blog/2022/12/22/weekly-report-1218"},"nextItem":{"title":"\u8ba4\u8bc1\u9274\u6743\u5bf9\u4e8e API \u7f51\u5173\u7684\u91cd\u8981\u6027","permalink":"/zh/blog/2022/12/19/auth-apisix-gateway"}},"content":"> \u672c\u6587\u53ef\u4ee5\u4e3a\u6b63\u5728\u9009\u578b Kubernetes Ingress Controller \u4ea7\u54c1\u7684\u7528\u6237\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005\u5f20\u664b\u6d9b\uff0cAPI7.ai \u4e91\u539f\u751f\u4e13\u5bb6\uff0cApache APISIX Committer\u3001Kubernetes Ingress Nginx Reviewer\\n\\n## Apache APISIX Ingress\\n\\n[Apache APISIX Ingress](https://github.com/apache/apisix-ingress-controller/) \u662f\u4e00\u4e2a\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u6570\u636e\u9762\u7684 Kubernetes Ingress controller \u5b9e\u73b0\u3002\\n\\n\u76ee\u524d\uff0c\u5b83\u652f\u6301\u591a\u79cd\u89c4\u5219\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u5305\u62ec Ingress\u3001APISIX Ingress CRD \uff08\u81ea\u5b9a\u4e49\u8d44\u6e90\uff09\u4ee5\u53ca Gateway API\u3002\\n\\n\u5176\u6574\u4f53\u91c7\u7528\u6570\u636e\u9762\u4e0e\u63a7\u5236\u9762\u5206\u79bb\u7684\u67b6\u6784\uff0c\u7531 Apache APISIX \u627f\u8f7d\u5b9e\u9645\u7684\u4e1a\u52a1\u6d41\u91cf\u3002\u56e0\u6b64\u5927\u5927\u63d0\u5347\u4e86\u6574\u4f53\u7684\u5b89\u5168\u6027\uff0c\u6781\u5927\u907f\u514d\u4e86\u7531\u4e8e\u6570\u636e\u9762\u88ab\u653b\u51fb\u800c\u5bfc\u81f4 Kubernetes \u96c6\u7fa4\u88ab\u653b\u51fb\u7684\u53ef\u80fd\u3002\\n\\n![image (4).png](https://static.apiseven.com/2022/12/22/63a4011023eef.png)\\n\\n## Traefik\\n\\nTraefik \u662f\u7531 Traefik Labs \u5f00\u6e90\u7684\u4e00\u6b3e\u53cd\u5411\u4ee3\u7406\u548c\u8d1f\u8f7d\u5747\u8861\u5668\u3002\u5b83\u5728 Kubernetes \u4e2d\u652f\u6301\u591a\u79cd\u89c4\u5219\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u5305\u62ec Ingress\u3001Traefik IngressRoute\uff08\u81ea\u5b9a\u4e49\u8d44\u6e90\uff09\u548c Gateway API\u3002\\n\\nTraefik \u662f\u4e00\u4e2a\u7edf\u4e00\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\u7684\u4ee3\u7406\u903b\u8f91\u5747\u7ed1\u5b9a\u5728\u4e00\u8d77\u3002\u56e0\u6b64\uff0c\u5982\u679c\u53d7\u5230\u653b\u51fb\u6216\u8005\u6709\u8fdc\u7a0b\u6267\u884c\u7684\u5b89\u5168\u6f0f\u6d1e\u88ab\u5229\u7528\uff0c\u6781\u6709\u53ef\u80fd\u5b58\u5728 Kubernetes \u96c6\u7fa4\u88ab\u653b\u51fb\u7684\u60c5\u51b5\u3002\\n\\n![image (5).png](https://static.apiseven.com/2022/12/22/63a4010fb7f25.png)\\n\\n## APISIX Ingress vs Traefik\\n\\n\u63a5\u4e0b\u6765\u6211\u5c06\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u7ef4\u5ea6\u5bf9 Apache APISIX Ingress \u548c Traefik \u8fdb\u884c\u4e00\u4e9b\u5bf9\u6bd4\uff0c\u65b9\u4fbf\u5927\u5bb6\u5728\u9009\u578b\u65f6\u5bf9\u4ea7\u54c1\u6709\u66f4\u591a\u7684\u8ba4\u77e5\u3002\\n\\n### \u534f\u8bae\u652f\u6301\\n\\n\u4f5c\u4e3a\u7f51\u5173\uff0c\u6700\u4e3a\u6838\u5fc3\u7684\u80fd\u529b\u4fbf\u662f\u8981\u80fd\u591f\u6b63\u786e\u7684\u4ee3\u7406\u6d41\u91cf\u3002\u4f5c\u4e3a Kubernetes \u96c6\u7fa4\u7684\u5165\u53e3\u7f51\u5173\uff0c\u4e3b\u8981\u5904\u7406\u5982\u4e0b\u4e24\u90e8\u5206\u7684\u6d41\u91cf\uff1a\u5373 **Client \u5230\u7f51\u5173\u7684\u6d41\u91cf**\u548c**\u7f51\u5173\u4e0e Upstream \u7684\u6d41\u91cf**\u3002\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```bash\\nClient <----\x3e Ingress <----\x3e Upstream Service\\n```\\n\\n\u5f53\u524d\u7684\u534f\u8bae\u591a\u79cd\u591a\u6837\uff0c\u4ee5\u4e0b\u7b80\u5355\u6c47\u603b\u4e86\u4e24\u4e2a\u9879\u76ee\u5bf9\u534f\u8bae\u7684\u652f\u6301\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002\\n\\n|    \u534f\u8bae    | APISIX Ingress | Traefik |\\n| :--------: | :------------: | :-----: |\\n| HTTP/HTTPS |      \u652f\u6301      |  \u652f\u6301   |\\n|   HTTP/2   |      \u652f\u6301      |  \u652f\u6301   |\\n|   HTTP/3   |     \u4e0d\u652f\u6301     |  \u652f\u6301   |\\n|    TCP     |      \u652f\u6301      |  \u652f\u6301   |\\n|    UDP     |      \u652f\u6301      |  \u652f\u6301   |\\n| WebSocket  |      \u652f\u6301      |  \u652f\u6301   |\\n|   Dubbo    |      \u652f\u6301      | \u4e0d\u652f\u6301  |\\n\\n\u6b64\u5916\uff0c\u65e0\u8bba\u662f APISIX Ingress \u8fd8\u662f Traefik\uff0c\u5747\u53ef\u901a\u8fc7 HTTP/2 \u6216\u8005 TCP \u4ee3\u7406\u7b49\u65b9\u5f0f\u652f\u6301 gRPC\u3001MQTT \u7b49\u534f\u8bae\uff0c\u6545\u800c\u672a\u5728\u4e0a\u8ff0\u8868\u683c\u4e2d\u5217\u51fa\u3002\\n\\n\u4ece\u534f\u8bae\u652f\u6301\u7684\u89d2\u5ea6\u6765\u770b\uff0cAPISIX Ingress \u548c Traefik \u5404\u6709\u4f18\u52bf\u3002\u6b64\u5916\uff0cAPISIX \u5bf9\u4e8e HTTP/3 \u7684\u652f\u6301\u6b63\u5728\u89c4\u5212\u4e2d\uff0c\u540e\u7eed\u4e5f\u53ef\u968f\u65f6\u5173\u6ce8\u793e\u533a\u52a8\u6001\u3002\\n\\n### \u53ef\u6269\u5c55\u6027\\n\\n\u7531\u4e8e\u4e1a\u52a1\u9700\u6c42\u591a\u79cd\u591a\u6837\uff0c\u6240\u4ee5\u53ef\u6269\u5c55\u6027\u4e5f\u662f\u8fdb\u884c\u6280\u672f\u9009\u578b\u7684\u4e00\u4e2a\u4e3b\u8981\u6307\u6807\u3002APISIX Ingress \u548c Traefik \u5747\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6269\u5c55\u65b9\u5f0f\uff0c\u6211\u4eec\u5c06\u5206\u522b\u8fdb\u884c\u4ecb\u7ecd\u3002\\n\\n#### APISIX Ingress\\n\\n\u5728 APISIX Ingress \u4e2d\u8fdb\u884c\u529f\u80fd\u6269\u5c55\uff0c\u4e3b\u8981\u662f\u901a\u8fc7\u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6\u6765\u5b8c\u6210\u3002\u5f53\u524d\uff0cAPISIX Ingress \u4e3b\u8981\u652f\u6301\u5982\u4e0b\u51e0\u79cd\u63d2\u4ef6\u7684\u5f00\u53d1\u65b9\u5f0f\uff1a\\n\\n* \u901a\u8fc7 Lua \u8fdb\u884c\u63d2\u4ef6\u7684\u5f00\u53d1\uff1a\u8fd9\u79cd\u65b9\u5f0f\u76f8\u5bf9\u7b80\u5355\uff0c\u5e76\u4e14\u51e0\u4e4e\u6ca1\u6709\u6027\u80fd\u635f\u8017\uff1b\\n* \u901a\u8fc7 Plugin Runner \u5f00\u53d1\uff1a\u8fd9\u79cd\u6a21\u5f0f\u4e0b\u652f\u6301 JAVA/Python/Go \u7b49\u591a\u79cd\u8ba1\u7b97\u8bed\u8a00\u8fdb\u884c\u5f00\u53d1\uff0c\u65b9\u4fbf\u7528\u6237\u5229\u7528\u73b0\u6709\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u540c\u65f6\u65e0\u9700\u5b66\u4e60\u65b0\u8bed\u8a00\uff1b\\n* \u901a\u8fc7 WASM \u8fdb\u884c\u63d2\u4ef6\u63d2\u4ef6\uff1a\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u652f\u6301\u6784\u5efa\u51fa WASM \u7684\u8bed\u8a00\u8fdb\u884c\u63d2\u4ef6\u5f00\u53d1\uff1b\\n\\n\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 Serverless \u63d2\u4ef6\u6765\u76f4\u63a5\u7f16\u6392 Lua \u4ee3\u7801\uff0c\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\u3002\\n\\n\u5f53\u7136\uff0c\u5982\u679c\u4f60\u6709 Lua \u6a21\u5757\u7684\u5f00\u53d1\u7ecf\u9a8c\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7f16\u5199 Lua \u6a21\u5757\uff0c\u7136\u540e\u8fdb\u884c\u52a0\u8f7d\u5373\u53ef\uff0c\u53ea\u9700\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u589e\u52a0\u5982\u4e0b\u5185\u5bb9\u5373\u53ef\uff1a\\n\\n```yaml\\napisix:\\n...\\nextra_lua_path: \\"/path/to/example/?.lua\\"\\n```\\n\\n\u5177\u4f53\u5173\u4e8e\u63d2\u4ef6\u7684\u7684\u5f00\u53d1\u6b65\u9aa4\u548c\u4f7f\u7528\uff0c\u8bf7\u53c2\u8003 [Apache APISIX \u7684\u63d2\u4ef6\u5f00\u53d1\u6587\u6863](https://apisix.apache.org/docs/apisix/plugin-develop/)\u3002\\n\\n#### Traefik\\n\\nTraefik \u4e5f\u63d0\u4f9b\u4e86\u76f8\u5173\u63d2\u4ef6\u673a\u5236\u7528\u4e8e\u529f\u80fd\u6269\u5c55\u3002\u4f46\u662f Traefik \u662f\u7531 Go \u8fdb\u884c\u5f00\u53d1\u7684\uff0c\u56e0\u6b64\u5b83\u7684\u63d2\u4ef6\u4e5f\u9700\u8981\u7528 Go \u8fdb\u884c\u5f00\u53d1\u3002\\n\\n\u5728\u5f00\u53d1\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 Traefik \u7684\u914d\u7f6e\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\u8fdb\u884c\u5f15\u7528\u4e86\uff08\u9700\u6ce8\u610f\uff0c\u63d2\u4ef6\u7684\u540d\u5b57\u9700\u8981\u4e0e\u5305\u540d\u4fdd\u6301\u4e00\u81f4\uff09\u3002\u4f8b\u5982\uff1a\\n\\n```yaml\\nexperimental:\\nlocalPlugins:\\nexample:\\nmoduleName: github.com/traefik/pluginproviderdemo\\n```\\n\\n\u603b\u4f53\u6765\u770b\uff0cAPISIX Ingress \u63d0\u4f9b\u4e86\u66f4\u591a\u79cd\u7684\u6269\u5c55\u65b9\u5f0f\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8fdb\u884c\u7075\u6d3b\u9009\u62e9\u3002\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u559c\u6b22\u6216\u64c5\u957f\u7684\u5de5\u5177\u5373\u53ef\uff0c\u66f4\u5bb9\u6613\u5b9e\u73b0\u4e0e\u73b0\u6709\u4e1a\u52a1\u96c6\u6210\u3002\u800c Traefik \u76ee\u524d\u5219\u53ea\u652f\u6301\u901a\u8fc7 Go \u8bed\u8a00\u8fdb\u884c\u5f00\u53d1\uff0c\u9009\u62e9\u8f83\u5c11\u3002\\n\\n### \u751f\u6001\\n\\n\u5728\u8fdb\u884c\u6280\u672f\u9009\u578b\u65f6\u5019\uff0c\u9664\u4e86\u8003\u8651\u4e00\u4e9b\u6027\u80fd\u8868\u73b0\uff0c\u8fd8\u9700\u8981\u5bf9\u4ea7\u54c1\u7684\u6574\u4e2a\u751f\u6001\u652f\u6301\u8fdb\u884c\u8003\u5bdf\u3002\u6bd4\u5982\u9879\u76ee\u6240\u4f7f\u7528\u7684\u534f\u8bae\u3001\u9879\u76ee\u5f52\u5c5e\u4ee5\u53ca\u4e0e\u73b0\u6709\u57fa\u7840\u8bbe\u65bd\u662f\u5426\u53ef\u4ee5\u6574\u5408\u7b49\u7b49\u3002\u4e0b\u65b9\u7b80\u5355\u6574\u7406\u4e86\u51e0\u4e2a\u89d2\u5ea6\u8fdb\u884c\u5448\u73b0\uff08\u5305\u542b\u4e86\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\uff09\u3002\\n\\n| \u5bf9\u6bd4\u7ef4\u5ea6  |      APISIX Ingress      |   Traefik    |\\n| :-------: | :----------------------: | :----------: |\\n|   \u5f52\u5c5e    | Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\uff08ASF\uff09 | Traefik Labs |\\n|   \u534f\u8bae    |        Apache 2.0        |     MIT      |\\n| \u8bde\u751f\u65f6\u95f4  |       2019 \u5e74 6 \u6708       | 2015 \u5e74 8 \u6708 |\\n|  consul   |           \u652f\u6301           |     \u652f\u6301     |\\n|   nacos   |           \u652f\u6301           |    \u4e0d\u652f\u6301    |\\n|  Eureka   |           \u652f\u6301           |    \u4e0d\u652f\u6301    |\\n|   etcd    |           \u652f\u6301           |     \u652f\u6301     |\\n| zookeeper |           \u652f\u6301           |     \u652f\u6301     |\\n|    DNS    |           \u652f\u6301           |    \u4e0d\u652f\u6301    |\\n\\n\u6b64\u5916\uff0c\u8fd9\u4e24\u4e2a\u9879\u76ee\u90fd\u975e\u5e38\u79ef\u6781\u4e0e\u4e00\u4e9b\u5468\u8fb9\u9879\u76ee\u8fdb\u884c\u4e86\u96c6\u6210\u4e0e\u5408\u4f5c\u3002\u6bd4\u5982 Rancher\u3001KubeSphere \u7b49\u3002\\n\\n\u4ece\u751f\u6001\u5408\u4f5c\u89d2\u5ea6\u6765\u770b\uff0cAPISIX Ingress \u6bd4 Traefik \u63d0\u4f9b\u4e86\u66f4\u4e3a\u5e7f\u6cdb\u7684\u96c6\u6210\u80fd\u529b\uff0c\u5c24\u5176\u662f\u4e0e\u57fa\u7840\u7ec4\u4ef6\u3002\u56e0\u6b64\u5728\u8fdb\u884c\u6280\u672f\u9009\u578b\u65f6\uff0c\u53ef\u4ee5\u7ed3\u5408\u5f53\u524d\u81ea\u5df1\u6240\u7528\u7684\u57fa\u7840\u7ec4\u4ef6\u7684\u60c5\u51b5\u8fdb\u884c\u6743\u8861\u3002\\n\\n## \u6765\u81ea\u7528\u6237\u7684\u58f0\u97f3\\n\\n\u5728\u4eca\u5e74\uff0c\u6211\u4eec\u4e5f\u770b\u5230\u4e86\u5f88\u591a\u6765\u81ea\u7528\u6237\u7684\u58f0\u97f3\uff0c\u4ed6\u4eec\u5f00\u59cb\u5728\u4e1a\u52a1\u67b6\u6784\u4e2d\u7528\u4e0a\u4e86 APISIX Ingress\u3002\u6bd4\u5982[\u5730\u5e73\u7ebf\u4f7f\u7528 APISIX Ingress \u66ff\u6362\u4e86 Traefik](https://www.apiseven.com/usercase/apisix-ingress-with-horizon-ai)\uff0c\u4e3b\u8981\u662f\u8003\u8651\u5982\u4e0b\u65b9\u9762\uff1a\\n\\n* \u901a\u8fc7 Annotation \u589e\u52a0\u7684\u914d\u7f6e\u4e0d\u6613\u91cd\u7528\uff1b\\n* Traefik \u4e2d\u9ed8\u8ba4\u7684\u884c\u4e3a\u4e0e NGINX \u4e2d\u4e0d\u540c\uff0c\u7528\u6237\u5728\u4f7f\u7528\u65f6\u5019\u4f1a\u4ea7\u751f\u56f0\u60d1\uff1b\\n\\n\u5728\u5207\u6362\u4e3a Apache APISIX Ingress \u540e\uff0c\u5f97\u76ca\u4e8e APISIX Ingress \u4e30\u5bcc\u7684\u63d2\u4ef6\u751f\u6001\uff0c\u7edd\u5927\u591a\u6570\u9700\u6c42\u5747\u53ef\u901a\u8fc7\u5185\u7f6e\u63d2\u4ef6\u6ee1\u8db3\u3002\u5e76\u4e14\u63d2\u4ef6\u7684\u914d\u7f6e\u53ef\u76f4\u63a5\u901a\u8fc7 APISIX Ingress \u7684 ApisixRoute \u8d44\u6e90\u8fdb\u884c\u5b9a\u4e49\uff0c\u6bd4\u8f83\u76f4\u89c2\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7 ApisixPluginConfig \u8fdb\u884c\u63d2\u4ef6\u6a21\u677f\u7684\u914d\u7f6e\uff0c\u5728\u5176\u4ed6\u7684 ApisixRoute \u8d44\u6e90\u4e2d\u8fdb\u884c\u5f15\u7528\u3002\\n\\n![image (8).png](https://static.apiseven.com/2022/12/22/63a4011134069.png)\\n\\nAPISIX Ingress \u7684\u6570\u636e\u9762\u6027\u80fd\u66f4\u4f73\uff0c\u80fd\u9ad8\u6548\u5730\u5e94\u5bf9\u65e5\u76ca\u589e\u957f\u7684\u4e1a\u52a1\u6d41\u91cf\uff0c\u800c\u4e0d\u4f1a\u9677\u5165\u6027\u80fd\u74f6\u9888\u3002\\n\\n\u9664\u5730\u5e73\u7ebf\u4ee5\u5916\uff0c\u5305\u62ec[\u5c11\u5e74\u5f97\u5230](http://www.igetcool.com/)\uff0c[\u89c2\u4e3a\u667a\u6167](http://www.gwwisdom.com/)\u7b49\u516c\u53f8\u4e5f\u90fd\u4f7f\u7528 APISIX Ingress \u66ff\u6362\u4e86 Traefik\uff0c\u66f4\u591a\u7528\u6237\u6848\u4f8b\u8bf7\u53c2\u8003[\u7528\u6237\u6848\u4f8b](https://www.apiseven.com/usercases)\u3002\\n\\n\u6b64\u5916\uff0cApache APISIX \u793e\u533a\u975e\u5e38\u6d3b\u8dc3\uff0c\u5728 GitHub \u548c Slack \u7b49\u9891\u9053\u4e0a\u90fd\u4f1a\u5feb\u901f\u54cd\u5e94\u3002\u4e5f\u671f\u5f85\u5404\u4f4d\u5728\u793e\u533a\u79ef\u6781\u8fdb\u884c\u53cd\u9988\u4e0e\u8ba8\u8bba\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4ece\u534f\u8bae\u652f\u6301\u3001\u53ef\u6269\u5c55\u6027\u548c\u751f\u6001\u7b49\u65b9\u9762\u5bf9\u6bd4\u4e86 Apache APISIX Ingress \u548c Traefik\u3002\u4ece\u5185\u5bb9\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\uff0cAPISIX Ingress \u5728\u53ef\u6269\u5c55\u6027\u548c\u751f\u6001\u96c6\u6210\u65b9\u9762\u6709\u4e00\u5b9a\u7684\u4f18\u52bf\uff0c\u7528\u6237\u53ef\u4ee5\u66f4\u5bb9\u6613\u5730\u5bf9 APISIX Ingress \u8fdb\u884c\u6269\u5c55\uff0c\u4ee5\u53ca\u4e0e\u4e00\u4e9b\u57fa\u7840\u7ec4\u4ef6\u8fdb\u884c\u96c6\u6210\u3002\\n\\n\u5e0c\u671b\u672c\u6587\u53ef\u4ee5\u4e3a\u6b63\u5728\u9009\u578b Kubernetes Ingress Controller \u4ea7\u54c1\u7684\u7528\u6237\u63d0\u4f9b\u4e00\u4e9b\u5e2e\u52a9\u3002"},{"id":"\u8ba4\u8bc1\u9274\u6743\u5bf9\u4e8e API \u7f51\u5173\u7684\u91cd\u8981\u6027","metadata":{"permalink":"/zh/blog/2022/12/19/auth-apisix-gateway","source":"@site/blog/2022/12/19/auth-apisix-gateway.md","title":"\u8ba4\u8bc1\u9274\u6743\u5bf9\u4e8e API \u7f51\u5173\u7684\u91cd\u8981\u6027","description":"\u8ba4\u8bc1\u9274\u6743\u4f5c\u4e3a API \u7f51\u5173\u4e0d\u53ef\u6216\u7f3a\u7684\u80fd\u529b\uff0c\u5df2\u7136\u6210\u4e3a\u7528\u6237\u5728\u9009\u578b API \u7f51\u5173\u65f6\u8003\u91cf\u7684\u91cd\u8981\u56e0\u7d20\u4e4b\u4e00\u3002","date":"2022-12-19T00:00:00.000Z","formattedDate":"2022\u5e7412\u670819\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":13.59,"truncated":true,"authors":[{"name":"\u94b1\u52c7","imageURL":"https://avatars.githubusercontent.com/u/22141303?v=4"}],"prevItem":{"title":"\u4e3a\u4ec0\u4e48 APISIX Ingress \u662f\u6bd4 Traefik \u66f4\u597d\u7684\u9009\u62e9\uff1f","permalink":"/zh/blog/2022/12/19/apisix-ingress-better-than-traefik"},"nextItem":{"title":"\u5f53 Amazon Lambda \u9047\u4e0a Apache APISIX \u53ef\u4ee5\u64e6\u51fa\u4ec0\u4e48\u706b\u82b1\uff1f","permalink":"/zh/blog/2022/12/16/amazonlambda-with-apisix"}},"content":"> \u8ba4\u8bc1\u9274\u6743\u4f5c\u4e3a API \u7f51\u5173\u4e0d\u53ef\u6216\u7f3a\u7684\u80fd\u529b\uff0c\u5df2\u7136\u6210\u4e3a\u7528\u6237\u5728\u9009\u578b API \u7f51\u5173\u65f6\u8003\u91cf\u7684\u91cd\u8981\u56e0\u7d20\u4e4b\u4e00\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005\u94b1\u52c7\uff0cAPI7.ai \u5f00\u53d1\u5de5\u7a0b\u5e08\uff0cApache APISIX Committer\\n\\n\u5728\u5f53\u4e0b\u4e91\u539f\u751f\u8d8a\u53d1\u6210\u719f\u7684\u73af\u5883\u4e0b\uff0cAPI \u7f51\u5173\u6700\u6838\u5fc3\u7684\u529f\u80fd\u53ef\u4ee5\u6982\u62ec\u4e3a\uff1a\u8fde\u63a5 API \u6d88\u8d39\u8005\u548c API \u63d0\u4f9b\u8005\u3002\\n\\n\u5b9e\u9645\u573a\u666f\u4e2d\uff0c\u9664\u53bb\u5c11\u90e8\u5206\u5141\u8bb8\u533f\u540d\u8bbf\u95ee\u7684 API \u5916\uff0c\u63d0\u4f9b\u8005\u5f80\u5f80\u90fd\u4f1a\u5bf9\u6d88\u8d39\u8005\u6709\u6240\u9650\u5236\uff0c\u6bd4\u5982\u53ea\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6d88\u8d39\u8005\u624d\u53ef\u4ee5\u5bf9 API \u8fdb\u884c\u8bbf\u95ee\u3002\u5176\u6b21\uff0c\u63d0\u4f9b\u8005\u5bf9\u4e8e\u4e0d\u540c\u7684\u6d88\u8d39\u8005\u7684\u8bbf\u95ee\u7b56\u7565\u53ef\u80fd\u5e76\u4e0d\u76f8\u540c\uff0c\u4f8b\u5982 A\u3001B \u6d88\u8d39\u8005\u90fd\u53ef\u4ee5\u8bbf\u95ee `/send_mail` API\uff0c\u4f46\u6bcf\u5206\u949f\u7684\u8c03\u7528\u9891\u6b21\u9700\u8981\u533a\u5206\u8ba1\u7b97\u3002\\n\\n\u4ece\u4ee5\u4e0a\u4e24\u70b9\u53ef\u4ee5\u770b\u51fa\u5728 API \u7f51\u5173\u5c42\u9762\u9274\u522b\u548c\u9a8c\u8bc1 API \u6d88\u8d39\u8005\u7684\u8eab\u4efd\u81f3\u5173\u91cd\u8981\u3002\u672c\u6587\u5c06\u4ecb\u7ecd\u4e91\u539f\u751f\u5f00\u6e90 API \u7f51\u5173 Apache APISIX \u5982\u4f55\u5b9e\u73b0\u5bf9\u4e8e\u6d88\u8d39\u8005\u7684\u8ba4\u8bc1\uff0c\u4ee5\u53ca\u76ee\u524d\u88ab\u4f01\u4e1a\u5e7f\u6cdb\u91c7\u7528\u7684\u8ba4\u8bc1\u65b9\u5f0f\u3002\u8fdb\u4e00\u6b65\u4ecb\u7ecd APISIX \u7684\u7528\u6237\u8ba4\u8bc1\u4f53\u7cfb\u662f\u5982\u4f55\u4e0e\u5176\u4ed6\u5b89\u5168\u7279\u6027\u8054\u52a8\u4f7f\u7528\uff0c\u4ece\u800c\u8fdb\u4e00\u6b65\u63d0\u5347 API \u7f51\u5173\u7684\u5b89\u5168\u9632\u62a4\u80fd\u529b\u3002\\n\\n![2020785233.png](https://static.apiseven.com/2022/12/22/63a4066de6401.png)\\n\\n## **Apache APISIX \u7684\u8ba4\u8bc1\u9274\u6743**\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u7cbe\u7ec6\u5316\u8def\u7531\u3001\u9650\u6d41\u9650\u901f\u3001\u670d\u52a1\u964d\u7ea7\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u6570\u767e\u9879\u529f\u80fd\u3002\u5728\u8ba4\u8bc1\u9274\u6743\u65b9\u9762\uff0cAPISIX \u4e5f\u662f\u63d0\u4f9b\u4e86\u975e\u5e38\u591a\u4e14\u65b9\u4fbf\u7684\u9014\u5f84\u3002\\n\\n\u4f20\u7edf\u7684 HTTP \u4ee3\u7406\u5f80\u5f80\u53ea\u80fd\u57fa\u4e8e\u8bf7\u6c42\u57df\u540d\u3001\u5ba2\u6237\u7aef IP \u7b49\u7c97\u7c92\u5ea6\u624b\u6bb5\u5bf9\u8bf7\u6c42\u65b9\u8fdb\u884c\u8bc6\u522b\uff0c\u8fd9\u5bf9\u4e8e\u4e00\u6b3e API \u7f51\u5173\u6765\u8bf4\u662f\u8fdc\u8fdc\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u9700\u8981\u6709\u66f4\u4e30\u5bcc\u7684\u8ba4\u8bc1\u65b9\u5f0f\u6765\u89e3\u51b3\u8d8a\u6765\u8d8a\u590d\u6742\u7684\u4e1a\u52a1\u9700\u6c42\u3002\u800c APISIX \u533a\u5206\u4e8e\u4f20\u7edf\u4ee3\u7406\u7684\u4e00\u5927\u4f18\u52bf\u5c31\u662f\u7075\u6d3b\u7684\u63d2\u4ef6\u6269\u5c55\u80fd\u529b\uff0c\u8fd9\u5176\u4e2d\u5c31\u5305\u62ec\u4e00\u5957\u7528\u4e8e\u7528\u6237\u8ba4\u8bc1\u7684\u63d2\u4ef6\u96c6\u5408\uff0c\u8fd9\u4e9b\u63d2\u4ef6\u6839\u636e\u5b9e\u73b0\u65b9\u5f0f\u7684\u4e0d\u540c\u53ef\u4ee5\u5206\u4e3a\u4e24\u5927\u7c7b\u3002\\n\\n\u7b2c\u4e00\u79cd\u662f\u5bf9\u63a5\u5916\u90e8\u8ba4\u8bc1\u670d\u52a1\uff0c\u59d4\u6258\u5176\u8fdb\u884c\u8ba4\u8bc1\u3002\\n\\n![721355468.jpg](https://static.apiseven.com/2022/12/22/63a406703dcd4.jpg)\\n\\n\u7b2c\u4e8c\u79cd\u5219\u662f\u5728\u7f51\u5173\u5185\u90e8\u8ba4\u8bc1\uff0c\u914d\u5408 APISIX \u8bbe\u8ba1\u7684 Consumer \u5bf9\u8c61\u8fdb\u884c\u8ba4\u8bc1\u3002\\n\\n![2821843005.jpg](https://static.apiseven.com/2022/12/22/63a4066fd1941.jpg)\\n\\n\u4e0b\u9762\u5c06\u4f1a\u4f9d\u6b21\u4ecb\u7ecd\u8fd9\u4e24\u79cd\u8ba4\u8bc1\u65b9\u5f0f\u3002\\n\\n### **\u5bf9\u63a5\u5916\u90e8\u8ba4\u8bc1\u670d\u52a1**\\n\\n\u5728\u4f01\u4e1a\u91c7\u7528 API \u7f51\u5173\u4e4b\u524d\uff0c\u7cfb\u7edf\u4e2d\u5f80\u5f80\u5df2\u7ecf\u90e8\u7f72\u4e86\u72ec\u7acb\u7684\u8ba4\u8bc1\u670d\u52a1\uff0c\u6b64\u65f6\u6211\u4eec\u8981\u5982\u4f55\u5c06 APISIX \u4e0e\u5df2\u6709\u7684\u8ba4\u8bc1\u670d\u52a1\u8fdb\u884c\u5bf9\u63a5\u5462\uff1fAPISIX \u63d0\u4f9b\u4e86\u8fd9\u6837\u4e00\u7cfb\u5217\u63d2\u4ef6\uff0c\u5b83\u4eec\u7684\u5de5\u4f5c\u539f\u7406\u5c31\u662f\u901a\u8fc7\u5bf9\u63a5\u5404\u79cd\u5916\u90e8\u7684\u8ba4\u8bc1\u670d\u52a1\uff0c\u59d4\u6258\u5b83\u4eec\u5b8c\u6210\u8ba4\u8bc1\u3002\\n\\n\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 `openid-connect` \u63d2\u4ef6\u5bf9\u63a5\u4efb\u610f\u652f\u6301 OIDC \u534f\u8bae\u7684\u8ba4\u8bc1\u670d\u52a1\uff0c\u4e0b\u9762\u662f\u4e00\u6bb5\u5bf9\u63a5\u5230 Keycloak \u670d\u52a1\u7684\u6837\u4f8b\u914d\u7f6e\uff1a\\n\\n```bash\\ncurl http://127.0.0.1:9180/apisix/admin/routes -H \\"X-Api-Key: your-API-key\\" -XPOST -d \'\\n{\\n    \\"uri\\":\\"/*\\",\\n    \\"plugins\\":{\\n        \\"openid-connect\\":{\\n            \\"client_id\\":\\"apisix\\", // keycloak \u521b\u5efa client \u65f6\u751f\u6210\\n            \\"client_secret\\":\\"d5c42c50-3e71-4bbe-aa9e-31083ab29da4\\",\\n            \\"discovery\\":\\"http://keycloak:8080/auth/realms/apisix_test_realm/.well-known/openid-configuration\\", // keycloak OpenID Endpoint\\n            \\"scope\\":\\"openid profile\\",\\n            \\"bearer_only\\":false,\\n            \\"realm\\":\\"apisix_test_realm\\",\\n            \\"introspection_endpoint_auth_method\\":\\"client_secret_post\\",\\n            \\"redirect_uri\\":\\"http://127.0.0.1:9080/\\"\\n        }\\n    },\\n    \\"upstream\\":{\\n        ...\\n    }\\n}\'\\n```\\n\\n### **\u7f51\u5173\u5185\u90e8\u8ba4\u8bc1**\\n\\n#### **Consumer**\\n\\n![1391469438.jpg](https://static.apiseven.com/2022/12/22/63a4066f62dfe.jpg)\\n\\n\u5f53\u6765\u81ea\u591a\u6e20\u9053\u7684\u8bf7\u6c42\u5230\u8fbe API \u7f51\u5173\u540e\uff0c\u7f51\u5173\u9700\u8981\u8bc6\u522b\u51fa\u8fd9\u4e9b\u8c03\u7528\u65b9\u3002\u4e3a\u6b64\uff0cApache APISIX \u63d0\u51fa\u4e86 Consumer \u6982\u5ff5\uff0c\u7528\u6765\u4ee3\u8868\u67d0\u7c7b\u670d\u52a1\u7684\u8c03\u7528\u65b9\u3002\\n\\nConsumer \u5bf9\u8c61\u9700\u8981\u914d\u7f6e\u8ba4\u8bc1\u63d2\u4ef6\u8fdb\u884c\u4f7f\u7528\uff0c\u4ee5\u6700\u7b80\u5355\u7684 `key-auth` \u63d2\u4ef6\u4e3a\u4f8b\uff1a\\n\\n```bash\\ncurl http://127.0.0.1:9180/apisix/admin/consumers  -H \'X-API-KEY: your-API-key\' -X PUT -i -d \'\\n{\\n    \\"username\\": \\"jack\\",\\n    \\"plugins\\": {\\n        \\"key-auth\\": {\\n            \\"key\\": \\"auth-jack\\"\\n        }\\n}\'\\n```\\n\\n\u4ee5\u4e0a\u914d\u7f6e\u8868\u793a\u5f53\u8bf7\u6c42\u4e2d\u643a\u5e26\u6307\u5b9a\u7684 key\uff08auth-jack\uff09\u65f6\uff0c\u5f53\u524d\u8bf7\u6c42\u5c06\u4f1a\u4e0e jack \u8fd9\u4e2a\u6d88\u8d39\u8005\u8fdb\u884c\u5173\u8054\u3002\u53ef\u4ee5\u770b\u5230\uff0cConsumer \u4e0a\u914d\u7f6e\u7684\u8ba4\u8bc1\u63d2\u4ef6\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u6307\u5b9a\u8ba4\u8bc1\u673a\u5236\u4e0b\u7684\u8eab\u4efd\u51ed\u8bc1\uff0c\u5728 `key-auth` \u63d2\u4ef6\u4e2d\uff0ckey \u5373\u662f\u6807\u8bc6\u67d0\u4e2a\u6d88\u8d39\u8005\u7684\u51ed\u8bc1\uff0c\u7c7b\u4f3c\u7684\u8fd8\u6709 `basic-auth` \u63d2\u4ef6\u7684\u7528\u6237\u540d\u4e0e\u5bc6\u7801\u7b49\u7b49\u3002\\n\\n#### **\u4e3a\u8def\u7531\u914d\u7f6e\u8ba4\u8bc1\u63d2\u4ef6**\\n\\n\u5f53\u6211\u4eec\u901a\u8fc7 Consumer \u5c06\u51ed\u8bc1\u4fe1\u606f\u4e0e\u5177\u4f53\u7684\u6d88\u8d39\u8005\u8fdb\u884c\u5173\u8054\u540e\uff0c\u8fd8\u9700\u8981\u5728\u76f8\u5e94\u7684\u8def\u7531\u4e0a\u5f00\u542f\u8ba4\u8bc1\u63d2\u4ef6\uff1a\\n\\n```bash\\ncurl http://127.0.0.1:9180/apisix/admin/routes/orders -H \'X-API-KEY: your-API-key\' -X PUT -i -d \'\\n{\\n    \\"uri\\": \\"/orders\\",\\n    \\"plugins\\": {\\n        \\"key-auth\\": {\\n            \\"header\\": \\"Authorization\\"\\n        }\\n    }\\n}\'\\n```\\n\\n\u4ee5\u4e0a\u914d\u7f6e\u8868\u793a\u5728 `/orders` \u8fd9\u4e2a\u8def\u7531\u4e0a\u5f00\u542f `key-auth` \u63d2\u4ef6\uff0c\u9a8c\u8bc1\u6548\u679c\u5982\u4e0b\uff1a\\n\\n```bash\\ncurl http://127.0.0.1:9080/orders -H \'Authorization: auth-jack\' -i\\n\\nHTTP/1.1 200 OK\\n...\\n\\ncurl http://127.0.0.1:9080/orders -H \'Authorization: wrong-key\' -i\\n\\nHTTP/1.1 401 Unauthorized\\n...\\n{\\"message\\":\\"Invalid API key in request\\"}\\n```\\n\\n\u5f53\u6765\u81ea\u7528\u6237\u7684\u8bf7\u6c42\u547d\u4e2d\u8fd9\u6761\u8def\u7531\u65f6\uff0cAPISIX \u4f1a\u5c1d\u8bd5\u901a\u8fc7 `Authorization` \u5934\u90e8\u62ff\u5230\u7528\u6237\u63d0\u4f9b\u7684 Key\u3002\u5982\u679c\u65e0\u6cd5\u83b7\u53d6\u6216\u8005\u83b7\u53d6\u5230\u7684 Key \u662f\u4e0d\u5408\u6cd5\u7684\uff0c\u90a3\u4e48\u8be5\u8bf7\u6c42\u5c06\u4f1a\u88ab\u7f51\u5173\u76f4\u63a5\u62d2\u7edd\uff0c\u4ece\u800c\u4fdd\u62a4\u4e0a\u6e38\u670d\u52a1\u3002\\n\\n\u53ef\u4ee5\u770b\u5230\u4ee5\u4e0a\u4e24\u79cd\u8ba4\u8bc1\u65b9\u5f0f\u4e2d\uff0c\u8ba4\u8bc1\u63d2\u4ef6\u90fd\u5904\u4e8e\u6574\u4e2a\u4f53\u7cfb\u4e2d\u7684\u6838\u5fc3\u5730\u4f4d\uff0c\u5b83\u7684\u4e30\u5bcc\u5ea6\u5c06\u76f4\u63a5\u5f71\u54cd\u7740 API \u7f51\u5173\u7528\u6237\u5bf9\u4e8e\u8ba4\u8bc1\u65b9\u5f0f\u7684\u9009\u62e9\u7a7a\u95f4\u3002\\n\\n## **APISIX \u652f\u6301\u7684\u8ba4\u8bc1\u65b9\u5f0f**\\n\\n\u8ba4\u8bc1\u9274\u6743\u4f5c\u4e3a\u8ba1\u7b97\u673a\u4e16\u754c\u4ece\u7b2c\u4e00\u5929\u8d77\u5c31\u5b58\u5728\u7684\u57fa\u7840\u673a\u5236\uff0c\u7ecf\u8fc7\u8fd9\u4e48\u591a\u5e74\u7684\u8fed\u4ee3\uff0c\u5df2\u7ecf\u53d1\u5c55\u6210\u4e3a\u4e00\u4e2a\u975e\u5e38\u591a\u6837\u5316\u7684\u9886\u57df\u3002\u800c APISIX \u7684\u63d2\u4ef6\u673a\u5236\u6781\u5927\u5730\u964d\u4f4e\u4e86\u5b9e\u73b0\u5404\u79cd\u8ba4\u8bc1\u65b9\u5f0f\u7684\u5f00\u53d1\u6210\u672c\uff0c\u4ee5\u4e0b\u662f\u90e8\u5206 APISIX \u5df2\u7ecf\u652f\u6301\u7684\u4e3b\u6d41\u8ba4\u8bc1\u65b9\u5f0f\u3002\\n\\n### **Key Auth**\\n\\nKey Auth \u662f\u76ee\u524d APISIX \u6240\u652f\u6301\u7684\u8ba4\u8bc1\u65b9\u5f0f\u4e2d\uff0c\u4f7f\u7528\u8d77\u6765\u6700\u7b80\u5355\u7684\u3002\u4f46 `key-auth` \u63d2\u4ef6\u5728\u5b9e\u9645\u73af\u5883\u4e2d\u6709\u7740\u975e\u5e38\u4e30\u5bcc\u7684\u5e94\u7528\u573a\u666f\uff0c\u4f8b\u5982\uff1a\u6536\u8d39\u8f6f\u4ef6\u4e2d\u7684 License\u3001\u5f00\u653e API \u5e73\u53f0\u4e2d\u7684\u7528\u4e8e\u6807\u8bc6\u5f00\u53d1\u8005\u7684 token \u7b49\u7b49\uff0c\u90fd\u53ef\u4ee5\u975e\u5e38\u8f7b\u677e\u5730\u4f7f\u7528 `key-auth` \u6765\u5b9e\u73b0\u3002\u5e76\u4e14\u57fa\u4e8e APISIX \u5168\u52a8\u6001\u7684\u914d\u7f6e\u4e0b\u53d1\u80fd\u529b\uff0cKey \u53ef\u4ee5\u88ab\u8fc5\u901f\u521b\u5efa\u3001\u540a\u9500\uff0c\u800c\u4e14\u5b9e\u65f6\u751f\u6548\u3002\\n\\n### **Basic Auth**\\n\\nBasic Auth \u662f\u57fa\u4e8e\u7528\u6237\u540d\u3001\u5bc6\u7801\u8fdb\u884c\u8ba4\u8bc1\u7684\u65b9\u5f0f\uff0c\u5e38\u7528\u4e8e\u7f51\u9875\u767b\u5f55\u573a\u666f\uff0c\u4f8b\u5982\uff1a\u7f51\u7ad9\u7684\u7ba1\u7406\u540e\u53f0\u9700\u8981\u7ba1\u7406\u5458\u767b\u5f55\u540e\u624d\u53ef\u4ee5\u4f7f\u7528\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Basic Auth \u65b9\u5f0f\u8fdb\u884c\u8ba4\u8bc1\u3002\\n\\n### **LDAP**\\n\\nLDAP\uff08Lightweight Directory Access Protocol\uff09\u662f\u4e00\u79cd\u57fa\u4e8eX.500 \u6807\u51c6\u7684\u8f7b\u91cf\u7ea7\u6587\u4ef6\u8bbf\u95ee\u534f\u8bae\uff0c\u901a\u8fc7IP \u534f\u8bae\u63d0\u4f9b\u8bbf\u95ee\u63a7\u5236\u548c\u7ef4\u62a4\u5206\u5e03\u5f0f\u4fe1\u606f\u7684\u76ee\u5f55\u4fe1\u606f\uff0c\u501f\u52a9\u4e8e LDAP \uff0c\u8fd0\u7ef4\u4eba\u5458\u53ef\u4ee5\u7ec6\u7c92\u5ea6\u5730\u63a7\u5236\u7528\u6237\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u3002\u901a\u8fc7 APISIX \u7684 `ldap-auth` \u63d2\u4ef6\uff0c\u53ef\u4ee5\u8f7b\u677e\u5bf9\u63a5\u5b9e\u73b0\u4e86 LDAP \u534f\u8bae\u7684\u5e73\u53f0\uff0c\u4f8b\u5982\u5fae\u8f6f\u7684 Active Direcory\uff0c\u6216\u8005 Linux \u5e73\u53f0\u7684 OpenLDAP Server\uff0c\u4ece\u800c\u80fd\u591f\u7cbe\u7ec6\u5316\u5730\u63a7\u5236 Consumer \u5bf9\u5177\u4f53\u8def\u7531\u7684\u8bbf\u95ee\u6743\u9650\u3002\\n\\n### **OIDC**\\n\\nOpenID \u662f\u4e00\u4e2a\u53bb\u4e2d\u5fc3\u5316\u7684\u7f51\u4e0a\u8eab\u4efd\u8ba4\u8bc1\u7cfb\u7edf\u3002\u5bf9\u4e8e\u652f\u6301 OpenID \u7684\u7f51\u7ad9\uff0c\u7528\u6237\u4e0d\u9700\u8981\u8bb0\u4f4f\u50cf\u7528\u6237\u540d\u548c\u5bc6\u7801\u8fd9\u6837\u7684\u4f20\u7edf\u9a8c\u8bc1\u6807\u8bb0\u3002\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\uff0c\u4ed6\u4eec\u53ea\u9700\u8981\u9884\u5148\u5728\u4e00\u4e2a\u4f5c\u4e3a OpenID \u8eab\u4efd\u63d0\u4f9b\u8005\uff08identity provider, IdP\uff09\u7684\u7f51\u7ad9\u4e0a\u6ce8\u518c\u8d26\u53f7\uff0c\u800c\u540e\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u8d26\u53f7\u767b\u5f55\u6240\u6709\u5bf9\u63a5\u4e86\u8be5\u63d0\u4f9b\u8005\u7684\u5e94\u7528\uff0c\u4f8b\u5982\uff1a\u53ef\u4ee5\u901a\u8fc7\u77e5\u540d\u7684 Google \u6216\u8005 Facebook \u670d\u52a1\u7684\u8d26\u53f7\u6765\u8ba4\u8bc1\u6211\u4eec\u81ea\u8eab\u7cfb\u7edf\u7684\u7528\u6237\u3002\\n\\n\u9488\u5bf9 OIDC\uff0cAPISIX \u63d0\u4f9b\u4e86 `openid-connect` \u63d2\u4ef6\uff0c\u53ef\u4ee5\u7528\u4e8e\u5bf9\u63a5\u652f\u6301\u4e86 OIDC \u534f\u8bae\u7684\u8ba4\u8bc1\u670d\u52a1\u3002\\n\\n### **Forward Auth**\\n\\n\u5f53 APISIX \u7684\u6807\u51c6\u8ba4\u8bc1\u63d2\u4ef6\u65e0\u6cd5\u6ee1\u8db3\u4f60\u5f53\u524d\u9700\u6c42\u65f6\uff0c\u6216\u8005\u5f53\u524d\u7cfb\u7edf\u4e2d\u5df2\u7ecf\u90e8\u7f72\u4e86\u4e13\u95e8\u7684\u5e76\u4e14\u662f\u975e\u6807\u51c6\u534f\u8bae\u7684\u8ba4\u8bc1\u670d\u52a1\uff0c\u6b64\u65f6\u4f60\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 `forward-auth` \u63d2\u4ef6\u3002\u4f7f\u7528\u8be5\u63d2\u4ef6\u53ef\u4ee5\u5c06\u7528\u6237\u7684\u8bf7\u6c42\u901a\u8fc7 HTTP \u5f62\u5f0f\u8f6c\u53d1\u81f3\u8ba4\u8bc1\u670d\u52a1\u4e2d\uff0c\u5e76\u5728\u8ba4\u8bc1\u670d\u52a1\u54cd\u5e94\u975e\u6b63\u5e38\u72b6\u6001\uff08\u9519\u8bef\u7801\u975e 20x\uff09\u65f6\uff0c\u8fd4\u56de\u81ea\u5b9a\u4e49\u62a5\u9519\u6216\u8005\u5c06\u7528\u6237\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u9875\u9762\u3002\\n\\n\u501f\u52a9 `forward-auth` \u63d2\u4ef6\u7684\u80fd\u529b\uff0c\u53ef\u4ee5\u975e\u5e38\u5de7\u5999\u5730\u5c06\u8ba4\u8bc1\u4e0e\u6388\u6743\u903b\u8f91\u8f6c\u79fb\u5230\u4e13\u95e8\u7684\u3001\u975e\u6807\u51c6\u534f\u8bae\u7684\u5916\u90e8\u670d\u52a1\u4e2d\u3002\\n\\n## **\u201c\u8ba4\u8bc1+\u4efb\u610f\u529f\u80fd\u201d\uff0cAPISIX \u52a9\u529b API \u5b89\u5168**\\n\\n\u7528\u6237\u8ba4\u8bc1\u53ea\u662f APISIX \u4fdd\u969c API \u5b89\u5168\u7684\u7b2c\u4e00\u6b65\uff0c\u5c06\u8ba4\u8bc1\u80fd\u529b\u4e0e\u5176\u4ed6\u5b89\u5168\u7c7b\u578b\u63d2\u4ef6\u7684\u6709\u673a\u7ed3\u5408\u5c06\u4f1a\u8fdb\u4e00\u6b65\u653e\u5927\u7f51\u5173\u7684\u5b89\u5168\u80fd\u529b\u3002\\n\\n### **ACL \u8bbf\u95ee\u63a7\u5236**\\n\\n\u5728\u4e00\u4e2a\u590d\u6742\u7684\u540e\u7aef\u7cfb\u7edf\u4e2d\uff0c\u53ef\u80fd\u4f1a\u5b58\u5728\u90e8\u5206 API \u7684\u5b89\u5168\u9650\u5236\u662f\u9ad8\u4e8e\u5176\u4ed6 API \u7684\uff0c\u8fd9\u79cd\u9650\u5236\u4e0d\u4ec5\u9700\u8981\u62e6\u622a\u533f\u540d\u7528\u6237\uff0c\u800c\u4e14\u9700\u8981\u5bf9\u8ba4\u8bc1\u7528\u6237\u8fdb\u884c\u9650\u5236\uff0c\u4f8b\u5982\uff1a\u53ea\u5141\u8bb8\u767d\u540d\u5355\u7528\u6237\u8bbf\u95ee\u7528\u6237\u7ba1\u7406 API\u3002\\n\\n![3322406862.jpg](https://static.apiseven.com/2022/12/22/63a4066e6b7e4.jpg)\\n\\n\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 APISIX \u63d0\u4f9b\u7684 `consumer-restriction` \u63d2\u4ef6\u53bb\u5b9e\u73b0\u4e00\u4e2a\u8bbf\u95ee\u63a7\u5236\u673a\u5236\u3002\\n\\n```bash\\ncurl http://127.0.0.1:9180/apisix/admin/routes -H \'X-API-KEY: your-API-key\' -X POST -i -d \'\\n{\\n    \\"uri\\": \\"/api/v1/users/admin\\",\\n    \\"plugins\\": {\\n        \\"key-auth\\": {},\\n        \\"consumer-restriction\\": {\\n            \\"whitelist\\": [\\n                \\"Rose\\",\\n                \\"Peter\\n            ]\\n        }\\n    },\\n    \\"upstream\\": {\\n        ...\\n    },\\n}\'\\n```\\n\\n\u4e0a\u8ff0\u914d\u7f6e\u4e2d\uff0c\u901a\u8fc7 `key-auth` \u548c `consumer-restriction` \u4e24\u4e2a\u63d2\u4ef6\u9650\u5236\u4e86\uff1a`/api/v1/users/admin` \u8def\u7531\u9700\u8981\u901a\u8fc7 key auth \u8ba4\u8bc1\uff0c\u5e76\u4e14\u4ec5 Rose \u548c Peter \u53ef\u4ee5\u8bbf\u95ee\u3002\\n\\n### **\u9650\u6d41\u9650\u901f**\\n\\n\u524d\u9762\u6211\u4eec\u4ecb\u7ecd\u4e86\u53ef\u4ee5\u901a\u8fc7\u5728 Consumer \u4e2d\u914d\u7f6e\u8ba4\u8bc1\u63d2\u4ef6\u5c06\u7528\u6237\u51ed\u8bc1\u4e0e\u6d88\u8d39\u8005\u8fdb\u884c\u5173\u8054\uff0c\u4e8b\u5b9e APISIX Consumer \u5bf9\u8c61\u4e0d\u4ec5\u4ec5\u53ef\u4ee5\u6302\u8f7d\u8ba4\u8bc1\u7c7b\u578b\u7684\u63d2\u4ef6\uff0c\u800c\u662f\u53ef\u4ee5\u50cf\u8def\u7531\u548c Service \u4e00\u6837\uff0c\u6302\u8f7d\u4efb\u610f\u63d2\u4ef6\u3002\\n\\n\u4ee5\u9650\u6d41\u573a\u666f\u4e3e\u4f8b\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u9650\u6d41\u7b56\u7565\u5f80\u5f80\u4e0d\u662f\u4e00\u6210\u4e0d\u53d8\u800c\u662f\\"\u5343\u4eba\u5343\u9762\\"\uff0c\u4e0d\u540c\u670d\u52a1\u7b49\u7ea7\u7684\u8c03\u7528\u65b9\u62e5\u6709\u4e0d\u540c\u7684 API \u9650\u6d41\u7b56\u7565\u662f\u975e\u5e38\u5e38\u89c1\u7684\u9700\u6c42\uff0c\u8fd9\u6837\u7684\u9700\u6c42\u662f\u65e0\u6cd5\u901a\u8fc7\u5728\u8def\u7531\u4e0a\u6302\u8f7d\u9650\u6d41\u63d2\u4ef6\u8fdb\u884c\u89e3\u51b3\u7684\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6d88\u8d39\u8005\u4e0a\u6302\u8f7d\u9650\u6d41\u63d2\u4ef6\uff0c\u5e76\u4e14\u4e3a\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u6307\u5b9a\u4e0d\u540c\u7684\u9650\u6d41\u7b56\u7565\u3002\\n\\n```bash\\ncurl http://127.0.0.1:9180/apisix/admin/consumers  -H \'X-API-KEY: your-API-key\' -X PUT -i -d \'\\n{\\n    \\"username\\": \\"jack\\",\\n    \\"plugins\\": {\\n        \\"key-auth\\": {\\n            \\"key\\": \\"jack\\"\\n        },\\n        \\"limit-count\\": {\\n            \\"count\\": 200,\\n            \\"time_window\\": 60,\\n            \\"rejected_code\\": 503,\\n            \\"key\\": \\"$consumer_name\\",\\n        }\\n}\'\\n\\ncurl http://127.0.0.1:9180/apisix/admin/consumers  -H \'X-API-KEY: your-API-key\' -X PUT -i -d \'\\n{\\n    \\"username\\": \\"rose\\",\\n    \\"plugins\\": {\\n        \\"key-auth\\": {\\n            \\"key\\": \\"rose\\"\\n        },\\n        \\"limit-count\\": {\\n            \\"count\\": 1000,\\n            \\"time_window\\": 60,\\n            \\"rejected_code\\": 503,\\n            \\"key\\": \\"$consumer_name\\",\\n        }\\n}\'\\n```\\n\\n\u901a\u8fc7\u4e0a\u65b9\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u4e3a jack \u548c rose \u5206\u522b\u6307\u5b9a\u4e86\u4e0d\u540c\u7684\u9650\u6d41\u7b56\u7565\u3002Rose \u5728 60 \u79d2\u5185\u62e5\u6709\u66f4\u591a\u7684\u8bf7\u6c42\u6b21\u6570\u914d\u989d 1000\uff0c\u800c Jack \u53ea\u6709 200 \u914d\u989d\u3002\\n\\n## **\u603b\u7ed3**\\n\\n\u8ba4\u8bc1\u9274\u6743\u4f5c\u4e3a API \u7f51\u5173\u4e0d\u53ef\u6216\u7f3a\u7684\u80fd\u529b\uff0c\u5df2\u7136\u6210\u4e3a\u7528\u6237\u5728\u9009\u578b API \u7f51\u5173\u65f6\u8003\u91cf\u7684\u91cd\u8981\u56e0\u7d20\u4e4b\u4e00\u3002\\n\\n\u672c\u6587\u4e2d\u4ecb\u7ecd\u7684\u5f00\u6e90\u7f51\u5173 Apache APISIX\uff0c\u8986\u76d6\u4e86\u6240\u6709\u4e3b\u6d41\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u53ef\u4ee5\u6ee1\u8db3\u4f01\u4e1a\u7528\u6237\u5bf9\u4e8e\u8ba4\u8bc1\u9274\u6743\u7684\u9700\u6c42\u3002\u540c\u65f6 APISIX \u8fd8\u62e5\u6709\u5176\u4ed6\u4ee5\u4e0b\u4f18\u52bf\uff1a\\n\\n* \u4e30\u5bcc\u7684\u3001\u5f00\u7bb1\u5373\u7528\u7684\u8ba4\u8bc1\u63d2\u4ef6\uff1b\\n* \u540c\u65f6\u652f\u6301\u5185\u7f6e\u3001\u5916\u7f6e\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u7531\u9009\u62e9\uff1b\\n* \u652f\u6301\u4e8c\u6b21\u5f00\u53d1\uff0c\u65b9\u4fbf\u5bf9\u63a5\u81ea\u5b9a\u4e49\u9274\u6743\u4e2d\u5fc3\u3002\\n\\n\u8fd9\u4e9b\u4f18\u52bf\u90fd\u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u66f4\u8f7b\u677e\u7684\u843d\u5730\u7f51\u5173\u5c42\u9762\u7684\u8ba4\u8bc1\u9274\u6743\uff0c\u52a0\u5f3a API \u5b89\u5168\u3002"},{"id":"\u5f53 Amazon Lambda \u9047\u4e0a Apache APISIX \u53ef\u4ee5\u64e6\u51fa\u4ec0\u4e48\u706b\u82b1\uff1f","metadata":{"permalink":"/zh/blog/2022/12/16/amazonlambda-with-apisix","source":"@site/blog/2022/12/16/amazonlambda-with-apisix.md","title":"\u5f53 Amazon Lambda \u9047\u4e0a Apache APISIX \u53ef\u4ee5\u64e6\u51fa\u4ec0\u4e48\u706b\u82b1\uff1f","description":"\u672c\u6587\u901a\u8fc7\u4ecb\u7ecd\u4e86 Serverless \u7684\u76f8\u5173\u5185\u5bb9\uff0c\u5f15\u51fa\u4e86\u4e00\u4e2a\u597d\u7684\u7f51\u5173\u5728 Serverless \u67b6\u6784\u4e0b\u7684\u91cd\u8981\u6027\u3002\u800c APISIX \u5c31\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u7f51\u5173\u3002","date":"2022-12-16T00:00:00.000Z","formattedDate":"2022\u5e7412\u670816\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":9.515,"truncated":true,"authors":[{"name":"\u7a0b\u5c0f\u5170"}],"prevItem":{"title":"\u8ba4\u8bc1\u9274\u6743\u5bf9\u4e8e API \u7f51\u5173\u7684\u91cd\u8981\u6027","permalink":"/zh/blog/2022/12/19/auth-apisix-gateway"},"nextItem":{"title":"\u9a6c\u65af\u514b\u90fd\u4e0d\u61c2\u7684 GraphQL\uff0cAPI \u7f51\u5173\u53c8\u80fd\u5bf9\u5176\u5982\u4f55\u7406\u89e3\uff1f","permalink":"/zh/blog/2022/12/16/what-is-graphql"}},"content":"> \u672c\u6587\u901a\u8fc7\u4ecb\u7ecd\u4e86 Serverless \u7684\u76f8\u5173\u5185\u5bb9\uff0c\u5f15\u51fa\u4e86\u4e00\u4e2a\u597d\u7684\u7f51\u5173\u5728 Serverless \u67b6\u6784\u4e0b\u7684\u91cd\u8981\u6027\u3002\u800c APISIX \u5c31\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u7f51\u5173\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005\u7a0b\u5c0f\u5170\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\\n\\n## \u4ec0\u4e48\u662f Serverless\\n\\nServerless \u7684\u57fa\u7840\u6982\u5ff5\u662f\u5c06\u8fd0\u884c\u670d\u52a1\u6240\u9700\u7684\u57fa\u7840\u8bbe\u65bd\u4ea4\u7531\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u7ba1\u7406\uff0c\u4ee5\u53ca\u4e00\u4e9b\u81ea\u90e8\u7f72\u7684 Serverless \u5e73\u53f0\uff0c\u4ece\u800c\u8ba9\u4f7f\u7528 Serverless \u7684\u5de5\u7a0b\u5e08\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u9762\u5411\u5ba2\u6237\u4e1a\u52a1\u5e94\u7528\u5c42\u7684\u5f00\u53d1\uff0c\u800c\u4e0d\u9700\u8981\u5728\u57fa\u7840\u8bbe\u65bd\u7684\u6784\u5efa\u3001\u7ba1\u7406\u3001\u6269\u5bb9\u7b49\u4efb\u52a1\u4e0a\u6295\u5165\u8fc7\u591a\u7cbe\u529b\u3002\\n\\n\u76ee\u524d\uff0c\u5f88\u591a\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u4e5f\u5728\u63a8\u51fa Serverless \u76f8\u5173\u7684\u4ea7\u54c1\u3002\u6bd4\u5982 Amazon Serverless \u7684\u6838\u5fc3\u662f\u540d\u4e3a [AWS Lambda](https://aws.amazon.com/lambda) \u7684\u8ba1\u7b97\u670d\u52a1\u3002\\n\\n\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u548c\u4f20\u7edf\u7684\u5f00\u53d1\u3001\u7f16\u8bd1\u3001\u90e8\u7f72\u8fd0\u884c\u65b9\u5f0f\u4e0d\u540c\uff0c\u4f7f\u7528 Amazon Serverless \u8ba1\u7b97\u670d\u52a1 Lambda\uff0c\u4ec5\u9700\u8981\u4e0a\u4f20\u6e90\u6587\u4ef6\uff0c\u9009\u62e9\u6267\u884c\u73af\u5883\u5e76\u6267\u884c\uff0c\u4fbf\u80fd\u5f97\u5230\u8fd0\u884c\u7ed3\u679c\u3002\u5728\u8be5\u8fc7\u7a0b\u4e2d\uff0c\u670d\u52a1\u5668\u90e8\u7f72\u3001runtime \u5b89\u88c5\u3001\u7f16\u8bd1\u7b49\uff0c\u90fd\u7531 Amazon Serverless \u8ba1\u7b97\u5e73\u53f0\u7ba1\u7406\u6267\u884c\u3002\\n\\n![download_image.png](https://static.apiseven.com/2022/11/29/6386054bc6c9c.png)\\n\\n\u5bf9\u5de5\u7a0b\u5e08\u6765\u8bf4\uff0c\u53ea\u9700\u8981\u7ef4\u62a4\u6e90\u4ee3\u7801\u548c Amazon Serverless \u6267\u884c\u73af\u5883\u7684\u76f8\u5173\u914d\u7f6e\u5373\u53ef\u3002\u4e0e\u6b64\u76f8\u5173\u7684\u6280\u672f\u8fd8\u6709 BaaS\uff08Backend as a Service\uff0c\u540e\u7aef\u5373\u670d\u52a1\uff09\uff0c\u662f\u6307\u6211\u4eec\u65e0\u9700\u7f16\u5199\u6216\u8005\u7ba1\u7406\u6240\u6709\u670d\u52a1\u7aef\u7ec4\u4ef6\uff0c\u628a\u5e94\u7528\u4e2d\u7684\u5404\u4e2a\u90e8\u5206\u5b8c\u5168\u5916\u5305\u51fa\u53bb\uff0c\u800c Serverless \u5219\u662f\u4e00\u79cd\u65b0\u7684\u8fd0\u884c\u4ee3\u7801\u7684\u6258\u7ba1\u73af\u5883\u3002\\n\\n### **\u4e3a\u4ec0\u4e48\u9700\u8981 Serverless**\\n\\n\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u800c\u8a00\uff0cServerless \u53ef\u4ee5\u5bf9\u7a0b\u5e8f\u6267\u884c\u7ec6\u8282\u8fdb\u884c\u62bd\u8c61\uff0c\u8ba9\u4e1a\u52a1\u5f00\u53d1\u5de5\u7a0b\u5e08\u4e13\u6ce8\u4e8e\u4ee3\u7801\u672c\u8eab\u3002\u4ece\u4e0a\u56fe\u7684\u5bf9\u6bd4\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u57fa\u4e8e Serverless \u7684\u5f00\u53d1\uff0c\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u6765\u8bf4\u66f4\u53cb\u597d\u3002\\n\\n\u4ece\u6210\u672c\u89d2\u5ea6\u6765\u770b\uff0c\u4f7f\u7528 Serverless \u53ea\u9700\u6309\u7167\u4f7f\u7528\u91cf\u4ed8\u8d39\uff1b\u4ece\u670d\u52a1\u6027\u80fd\u89d2\u5ea6\u6765\u770b\uff0c Serverless \u53ef\u4ee5\u81ea\u52a8\u54cd\u5e94\u4efb\u4f55\u89c4\u6a21\u7684\u4ee3\u7801\u6267\u884c\u8bf7\u6c42\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u51fd\u6570\u5185\u5b58\u5927\u5c0f\u4f18\u5316\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u548c\u54cd\u5e94\u65f6\u95f4\u3002\\n\\n### **\u4f7f\u7528 Serverless \u65f6\u4e3a\u4ec0\u4e48\u9700\u8981\u4e00\u4e2a\u7f51\u5173\uff1f**\\n\\n\u867d\u7136 Serverless \u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u63d0\u4f9b\u4e86\u975e\u5e38\u5927\u7684\u4f18\u52bf\uff0c\u4f46 Serverless \u670d\u52a1\u7684\u4f7f\u7528\u4e5f\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\u3002\\n\\n\u6bd4\u5982\u5c06\u51fd\u6570 URL \u786c\u7f16\u7801\u5230\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff1b\u5176\u6b21\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\u7684\u6388\u6743\u548c\u8eab\u4efd\u9a8c\u8bc1\u95ee\u9898\u4e5f\u6bd4\u8f83\u7e41\u7410\uff1b\u518d\u8005\uff0c\u66f4\u65b0\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u7684\u8fc7\u7a0b\u4e5f\u662f\u4e00\u4e2a\u6bd4\u8f83\u8270\u5de8\u7684\u5de5\u7a0b\u3002\\n\\n\u800c\u7f51\u5173\u53ef\u4ee5\u5929\u7136\u5730\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u901a\u8fc7\u4e8c\u8005\u914d\u5408\u7684\u65b9\u5f0f\uff0cServerless \u53ef\u4ee5\u66f4\u597d\u5730\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u63cf\u8ff0\u7684\u662f\u5982\u4f55\u4f7f\u7528 Amazon Serverless \u7684\u76f8\u5173\u670d\u52a1\u8fc5\u901f\u7ec4\u88c5\u4e00\u4e2a\u7b80\u5355\u7684 Web Service\uff0c\u7f51\u5173\u5c06\u5728\u6388\u6743\u7b49\u95ee\u9898\u4e2d\u53d1\u6325\u91cd\u8981\u4f5c\u7528\u3002\\n\\n\u8fd9\u91cc\u4ee5 Apache APISIX \u4e3a\u4f8b\uff0c\u5b83\u4e3a\u6d41\u884c\u7684\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\uff08AWS\u3001Azure\uff09\u63d0\u4f9b Serverless \u6846\u67b6\u652f\u6301\uff1b\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u8def\u7531\u53bb\u542f\u7528 Serverless \u63d2\u4ef6\uff0c\u800c\u4e0d\u662f\u5c06\u51fd\u6570 URL \u786c\u7f16\u7801\u5230\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff1b\u540c\u65f6\uff0c\u4e3a\u5f00\u53d1\u4eba\u5458\u63d0\u4f9b\u4e86\u70ed\u66f4\u65b0\u51fd\u6570 URI \u7684\u7075\u6d3b\u6027\uff0c\u66f4\u65b0\u4e0d\u540c\u7684 FaaS \u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u4e5f\u6ca1\u6709\u4ec0\u4e48\u989d\u5916\u7684\u9ebb\u70e6\uff1b\u6b64\u5916\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u51cf\u8f7b\u4e86\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\u7684\u6388\u6743\u548c\u8eab\u4efd\u9a8c\u8bc1\u95ee\u9898\u3002\\n\\n![download_image (1).png](https://static.apiseven.com/2022/11/29/6385ff2ce13c3.png)\\n\\n## **Apache APISIX \u4e0e Serverless**\\n\\n[Apache APISIX](https://apisix.apache.org/) \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0b\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u5b83\u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7b49\u7279\u70b9\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\uff08\u91d1\u4e1d\u96c0\u53d1\u5e03\uff09\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\n\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u6765\u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5904\u7406\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\u3002\u540c\u65f6\uff0c\u5b83\u4e5f\u652f\u6301\u4f5c\u4e3a K8s Ingress Controller \u6765\u4f7f\u7528\u3002APISIX \u901a\u8fc7\u63d2\u4ef6\u6765\u6269\u5145\u751f\u6001\uff0c\u76ee\u524d\u4e5f\u5185\u7f6e\u4e86\u5404\u7c7b\u63d2\u4ef6\uff0c\u8986\u76d6\u4e86 API \u7f51\u5173\u7684\u5404\u79cd\u9886\u57df\uff0c\u5982\u8ba4\u8bc1\u9274\u6743\u3001\u5b89\u5168\u3001\u53ef\u89c2\u6d4b\u6027\u3001\u6d41\u91cf\u7ba1\u7406\u3001\u591a\u534f\u8bae\u63a5\u5165\u7b49\uff0c\u5f53\u7136\uff0c\u4e5f\u5305\u542b\u5f88\u591a Serverless \u76f8\u5173\u63d2\u4ef6\u3002\\n\\n### **AWS Lambda \u63d2\u4ef6**\\n\\n`aws-lambda` \u63d2\u4ef6\u7528\u4e8e\u5c06 AWS Lambda \u4f5c\u4e3a\u52a8\u6001\u4e0a\u6e38\u96c6\u6210\u81f3 APISIX\uff0c\u4ece\u800c\u5b9e\u73b0\u5c06\u8bbf\u95ee\u6307\u5b9a URI \u7684\u8bf7\u6c42\u4ee3\u7406\u5230 AWS \u4e91\u3002\u7528\u6237\u4f7f\u7528\u8be5\u63d2\u4ef6\u7ec8\u6b62\u5bf9\u5df2\u914d\u7f6e URI \u7684\u8bf7\u6c42\uff0c\u5e76\u4ee3\u8868\u5ba2\u6237\u7aef\u5411 AWS Lambda Gateway URI \u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\u3002\\n\\n\u8fd9\u4e2a\u65b0\u8bf7\u6c42\u4e2d\u643a\u5e26\u4e86\u4e4b\u524d\u914d\u7f6e\u7684\u6388\u6743\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u4f53\u548c\u53c2\u6570\uff08\u4ee5\u4e0a\u53c2\u6570\u90fd\u662f\u4ece\u539f\u59cb\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684\uff09\uff0c\u4e4b\u540e `aws-lambda` \u63d2\u4ef6\u4f1a\u5c06\u5e26\u6709\u54cd\u5e94\u5934\u3001\u72b6\u6001\u7801\u548c\u54cd\u5e94\u4f53\u7684\u54cd\u5e94\u4fe1\u606f\u8fd4\u56de\u7ed9\u4f7f\u7528 APISIX \u53d1\u8d77\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u3002\u8be5\u63d2\u4ef6\u652f\u6301\u901a\u8fc7 AWS API key \u548c AWS IAM secrets \u8fdb\u884c\u6388\u6743\u3002 \u63d2\u4ef6\u7ec6\u8282\u53ef\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/plugins/aws-lambda)\u6216\u8005[\u535a\u5ba2](https://blog.bisakh.com/blog/aws-lambda-apisix)\u3002\\n\\n### **Serverless \u76f8\u5173\u63d2\u4ef6\u6c47\u603b**\\n\\n\u9664\u4e86 Amazon Lambda\uff0cApache APISIX \u76ee\u524d\u8fd8\u652f\u6301\u4e0e Azure Function\u3001Lua \u51fd\u6570\u548c Apache OpenWhisk \u7b49 Serverless \u76f8\u5173\u751f\u6001\u7684\u96c6\u6210\uff0c\u4ece\u800c\u63d0\u4f9b\u4e86\u76f8\u5e94\u7684 Serverless \u63d2\u4ef6\uff0c\u5177\u4f53\u5982\u4e0b\u8868\u6240\u793a\u3002\\n\\n|    \u63d2\u4ef6\u540d\u79f0   | \u63cf\u8ff0 |\\n| :--------: | :------------ |\\n| [serverless](https://apisix.apache.org/docs/apisix/plugins/serverless/) |     \u7528\u6237\u53ef\u4ee5\u901a\u8fc7 Serverless \u63d2\u4ef6\u4e0a\u4f20\u81ea\u5b9a\u4e49\u7684 Lua \u811a\u672c\uff0c\u5e76\u6839\u636e\u914d\u7f6e\u4e2d\u7684 phase \u6765\u6307\u5b9a\u4ee3\u7801\u8fd0\u884c\u9636\u6bb5\u3002\u4f8b\u5982\u5728 access \u9636\u6bb5\u5bf9\u8bf7\u6c42\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\uff0c\u5728 header filter\uff0cbody filter \u9636\u6bb5\uff0c\u5bf9\u54cd\u5e94\u5934\u6216\u54cd\u5e94\u4f53\u8fdb\u884c\u4fee\u6539\uff0c\u6216\u8005\u5728 log \u9636\u6bb5\u6253\u5370\u4e2a\u6027\u5316\u65e5\u5fd7\u7b49\u3002\u53e6\u5916\uff0c\u7531\u4e8e Serverless \u63d2\u4ef6\u662f\u70ed\u52a0\u8f7d\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u4e0d\u9700\u8981\u91cd\u65b0\u542f\u52a8 Apache APISIX \u4fbf\u53ef\u7acb\u5373\u751f\u6548\u3002      |\\n| [Azure Function](https://apisix.apache.org/docs/apisix/plugins/azure-functions/)  |   \u7528\u4e8e\u5c06 Azure Serverless Function \u4f5c\u4e3a\u52a8\u6001\u4e0a\u6e38\u96c6\u6210\u81f3 APISIX\uff0c\u4ece\u800c\u5b9e\u73b0\u5c06\u8bbf\u95ee\u6307\u5b9a URI \u7684\u8bf7\u6c42\u4ee3\u7406\u5230 Microsoft Azure \u4e91\u670d\u52a1\u3002\u542f\u7528 azure-functions \u63d2\u4ef6\u540e\uff0c\u8be5\u63d2\u4ef6\u4f1a\u7ec8\u6b62\u5bf9\u5df2\u914d\u7f6e URI \u7684\u8bf7\u6c42\uff0c\u5e76\u4ee3\u8868\u5ba2\u6237\u7aef\u5411 Azure Functions \u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\u3002\u8be5\u65b0\u8bf7\u6c42\u4e2d\u643a\u5e26\u4e86\u4e4b\u524d\u914d\u7f6e\u7684\u6388\u6743\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u4f53\u548c\u53c2\u6570\uff08\u4ee5\u4e0a\u53c2\u6570\u90fd\u662f\u4ece\u539f\u59cb\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684\uff09\u3002\u4e4b\u540e\u4fbf\u4f1a\u901a\u8fc7 azure-functions \u63d2\u4ef6\uff0c\u5c06\u5e26\u6709\u54cd\u5e94\u5934\u3001\u72b6\u6001\u7801\u548c\u54cd\u5e94\u4f53\u7684\u4fe1\u606f\u8fd4\u56de\u7ed9\u4f7f\u7528 APISIX \u53d1\u8d77\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u3002  |\\n| [OpenWhisk](https://apisix.apache.org/docs/apisix/plugins/openwhisk/)|   \u7528\u4e8e\u5c06\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u65e0\u670d\u52a1\u5668\u5e73\u53f0 Apache OpenWhisk \u4f5c\u4e3a\u52a8\u6001\u4e0a\u6e38\u96c6\u6210\u81f3 APISIX\u3002\u542f\u7528 openwhisk \u63d2\u4ef6\u540e\uff0c\u8be5\u63d2\u4ef6\u4f1a\u7ec8\u6b62\u5bf9\u5df2\u914d\u7f6e URI \u7684\u8bf7\u6c42\uff0c\u5e76\u4ee3\u8868\u5ba2\u6237\u7aef\u5411 OpenWhisk \u7684 API Host \u7aef\u70b9\u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\uff0c\u7136\u540e openwhisk \u63d2\u4ef6\u4f1a\u5c06\u54cd\u5e94\u4fe1\u606f\u8fd4\u56de\u81f3\u5ba2\u6237\u7aef\u3002    |\\n|[OpenFunction](https://apisix.apache.org/docs/apisix/plugins/openfunction/)    | \u7528\u4e8e\u5c06\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u65e0\u670d\u52a1\u5668\u5e73\u53f0 CNCF OpenFunction \u4f5c\u4e3a\u52a8\u6001\u4e0a\u6e38\u96c6\u6210\u81f3 APISIX\u3002\u542f\u7528 openfunction \u63d2\u4ef6\u540e\uff0c\u8be5\u63d2\u4ef6\u4f1a\u7ec8\u6b62\u5bf9\u5df2\u914d\u7f6e URI \u7684\u8bf7\u6c42\uff0c\u5e76\u4ee3\u8868\u5ba2\u6237\u7aef\u5411 OpenFunction \u7684 function \u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\uff0c\u7136\u540e openfunction \u63d2\u4ef6\u4f1a\u5c06\u54cd\u5e94\u4fe1\u606f\u8fd4\u56de\u81f3\u5ba2\u6237\u7aef\u3002  |\\n\\n![download_image (2).png](https://static.apiseven.com/2022/12/01/638842425ec60.png)\\n\\n## **\u603b\u7ed3**\\n\\n\u8fd1\u5e74\u6765\uff0c\u968f\u7740\u5fae\u670d\u52a1\u67b6\u6784\u7684\u51fa\u73b0\uff0c\u5f88\u591a\u4f01\u4e1a\u90fd\u5f00\u59cb\u5c06\u4e1a\u52a1\u67b6\u6784\u8fc1\u79fb\u5230\u4e91\u7aef\uff0c\u4e0d\u5c11\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u4e5f\u5728\u63a8\u51fa Serverless \u76f8\u5173\u7684\u4ea7\u54c1\uff0c\u57fa\u4e8e Serverless \u7684\u5f00\u53d1\u5df2\u7ecf\u6210\u4e3a\u4e00\u79cd\u5341\u5206\u4fbf\u5229\u7684\u5f00\u53d1\u6a21\u5f0f\u3002\\n\\n\u672c\u6587\u901a\u8fc7\u4ecb\u7ecd\u4e86 Serverless \u7684\u76f8\u5173\u5185\u5bb9\uff0c\u5f15\u51fa\u4e86\u4e00\u4e2a\u597d\u7684\u7f51\u5173\u5728 Serverless \u67b6\u6784\u4e0b\u7684\u91cd\u8981\u6027\u3002\u800c APISIX \u5c31\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u7f51\u5173\uff0c\u5f53\u7136\u672c\u6587\u5e76\u672a\u5728\u5177\u4f53\u4f7f\u7528\u7ec6\u8282\u4e0a\u8fdb\u884c\u66f4\u4e30\u5bcc\u7684\u63cf\u8ff0\uff0c\u4ec5\u4ec5\u7b80\u5355\u4ecb\u7ecd\u4e86 APISIX \u4e2d\u7684 Serverless \u7c7b\u578b\u7684\u63d2\u4ef6 \u3002\u5982\u679c\u4f60\u5bf9\u8fd9\u7c7b\u63d2\u4ef6\u7684\u4f7f\u7528\u611f\u5174\u8da3\uff0c\u4e5f\u6b22\u8fce\u5728\u793e\u533a\u4e2d\u8fdb\u884c\u66f4\u4e30\u5bcc\u7684\u5b9e\u8df5\u4e0e\u8ba8\u8bba\u3002"},{"id":"\u9a6c\u65af\u514b\u90fd\u4e0d\u61c2\u7684 GraphQL\uff0cAPI \u7f51\u5173\u53c8\u80fd\u5bf9\u5176\u5982\u4f55\u7406\u89e3\uff1f","metadata":{"permalink":"/zh/blog/2022/12/16/what-is-graphql","source":"@site/blog/2022/12/16/what-is-graphql.md","title":"\u9a6c\u65af\u514b\u90fd\u4e0d\u61c2\u7684 GraphQL\uff0cAPI \u7f51\u5173\u53c8\u80fd\u5bf9\u5176\u5982\u4f55\u7406\u89e3\uff1f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f GraphQL\uff0c\u4ee5\u53ca APISIX \u662f\u5982\u4f55\u652f\u6301 GraphQL \u7684\u3002","date":"2022-12-16T00:00:00.000Z","formattedDate":"2022\u5e7412\u670816\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.575,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://github.com/spacewander.png"}],"prevItem":{"title":"\u5f53 Amazon Lambda \u9047\u4e0a Apache APISIX \u53ef\u4ee5\u64e6\u51fa\u4ec0\u4e48\u706b\u82b1\uff1f","permalink":"/zh/blog/2022/12/16/amazonlambda-with-apisix"},"nextItem":{"title":"APISIX Ingress \u5982\u4f55\u652f\u6301\u81ea\u5b9a\u4e49\u63d2\u4ef6","permalink":"/zh/blog/2022/12/15/how-support-ingress-custom-plugins"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f GraphQL\uff0c\u4ee5\u53ca APISIX \u662f\u5982\u4f55\u652f\u6301 GraphQL \u7684\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4e0a\u4e2a\u6708\u9a6c\u65af\u514b\u8bc4\u8bba\xa0Twitter App \u6ee5\u7528 RPC \u540e\uff0c\u4e0e\u4e00\u4e9b Twitter \u7684\u6280\u672f\u4e3b\u7ba1\u53d1\u751f\u4e86\u77db\u76fe \u2014\u2014 \u76f4\u8a00\u9a6c\u65af\u514b\u4e0d\u61c2\u6280\u672f\u3002\u90a3\u8fd9\u4e2a\u9a6c\u65af\u514b\u90fd\u4e0d\u61c2\u7684 GraphQL \u5230\u5e95\u662f\u4ec0\u4e48\uff1f\\n\\n![image (3).png](https://static.apiseven.com/2022/12/16/639c101d512e2.png)\\n\\n## \u4ec0\u4e48\u662f GraphQL\uff1f\u5b83\u6709\u591a\u6d41\u884c\uff1f\\n\\nGraphQL \u662f\u4e00\u5957\u7531 Facebook \u5728 2015 \u5e74\u53d1\u5e03\u7684\u4e00\u5957\u9762\u5411 API \u7684\u67e5\u8be2\u64cd\u4f5c\u8bed\u8a00\u3002\u76f8\u6bd4\u4e8e\u5176\u4ed6\u7684 API \u8bbe\u8ba1\u65b9\u5f0f\uff0cGraphQL \u5141\u8bb8\u5ba2\u6237\u7aef\u6839\u636e\u4e8b\u5148\u7ea6\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u7ec4\u5efa\u67e5\u8be2\u8bed\u53e5\uff0c\u7531\u670d\u52a1\u7aef\u89e3\u6790\u8fd9\u4e00\u8bed\u53e5\u5e76\u53ea\u8fd4\u56de\u6240\u9700\u7684\u5185\u5bb9\u3002\u8fd9\u4e48\u4e00\u6765\uff0cGraphQL \u5728\u63d0\u4f9b\u4e30\u5bcc\u6027\u548c\u7075\u6d3b\u6027\u7684\u540c\u65f6\uff0c\u907f\u514d\u4e86\u5197\u4f59\u6570\u636e\u5e26\u6765\u7684\u6027\u80fd\u635f\u8017\u3002\\n\\nGraphQL \u7684\u8fd9\u4e00\u7279\u6027\uff0c\u8ba9\u5b83\u5728\u9700\u8981\u8ddf\u8bb8\u591a\u590d\u6742\u6570\u636e\u5bf9\u8c61\u6253\u4ea4\u9053\u7684\u5e94\u7528\u573a\u666f\u91cc\u5927\u884c\u5176\u9053\uff0c\u6210\u4e3a\u8be5\u73af\u5883\u4e0b\u7684\u4e0d\u4e8c\u4e4b\u9009\u3002\\n\\n2018 \u5e74 GraphQL \u5b8c\u6210\u4e86\u89c4\u8303\u7684\u5236\u5b9a\u5de5\u4f5c\uff0c\u5e76\u63a8\u51fa\u4e86\u7a33\u5b9a\u7248\u672c\u3002\u540c\u5e74\uff0cFacebook \u5c06 GraphQL \u9879\u76ee\u6350\u732e\u7ed9\u4e86 Linux \u57fa\u91d1\u4f1a\u4e0b\u5c5e\u7684 GraphQL \u57fa\u91d1\u4f1a\u3002\u81ea\u90a3\u4ee5\u540e\uff0cGraphQL \u5df2\u7ecf\u5728\u8bb8\u8bb8\u591a\u591a\u7684\u5f00\u6e90\u9879\u76ee\u548c\u5546\u4e1a\u673a\u6784\u4e2d\u843d\u5730\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u5e02\u9762\u4e0a\u5df2\u7ecf\u6709\u4e86\u591a\u4e2a GraphQL \u7684\u4e3b\u6d41\u5ba2\u6237\u7aef\u5b9e\u73b0\u3002\u800c\u670d\u52a1\u7aef\u7684\u5b9e\u73b0\u904d\u5e03\u5404\u5927\u670d\u52a1\u7aef\u7f16\u7a0b\u8bed\u8a00\uff0c\u751a\u81f3\u8fde\u4e00\u4e9b\u5c0f\u4f17\u7f16\u7a0b\u8bed\u8a00\u5982 D \u548c R \u90fd\u6709\u5bf9\u5e94\u7684\u5b9e\u73b0\u3002\\n\\n## GraphQL \u7684\u4e00\u4e9b\u771f\u5b9e\u573a\u666f\u548c\u6311\u6218\\n\\n\u6700\u4e3a\u77e5\u540d\u7684\u91c7\u7528 GraphQL \u7684\u4f8b\u5b50\uff0c\u83ab\u8fc7\u4e8e GitHub \u7684 GraphQL API \u4e86\u3002\\n\\n\u5728\u62e5\u62b1 GraphQL \u4e4b\u524d\uff0cGitHub \u63d0\u4f9b\u4e86 REST API \u6765\u66b4\u9732\u5343\u5343\u4e07\u4e07\u6258\u7ba1\u9879\u76ee\u6240\u4ea7\u751f\u7684\u4e30\u5bcc\u6570\u636e\u3002GitHub \u7684 REST API \u662f\u5982\u6b64\u7684\u6210\u529f\uff0c\u4ee5\u81f4\u4e8e\u5b83\u6210\u4e3a\u4e86\u4eba\u4eec\u8bbe\u8ba1 REST API \u65f6\u7ade\u76f8\u6a21\u4eff\u7684\u5178\u8303\u3002\\n\\n\u7136\u800c\u968f\u7740\u6570\u636e\u5bf9\u8c61\u7684\u53d8\u591a\u548c\u5bf9\u8c61\u5185\u5b57\u6bb5\u7684\u53d8\u5927\uff0cREST API \u5f00\u59cb\u66b4\u9732\u51fa\u8d8a\u6765\u8d8a\u591a\u7684\u5f0a\u7aef\u3002\u5728\u670d\u52a1\u7aef\uff0c\u7531\u4e8e\u6bcf\u6b21\u8c03\u7528\u90fd\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u6570\u636e\uff0cGitHub \u4e3a\u4e86\u964d\u4f4e\u6210\u672c\u4e0d\u5f97\u4e0d\u5bf9\u8c03\u7528\u9891\u7387\u8bbe\u7f6e\u4e25\u683c\u7684\u9650\u5236\u3002\\n\\n\u800c\u5728\u5f00\u53d1\u8005\u8fd9\u8fb9\uff0c\u4ed6\u4eec\u5219\u4e0d\u5f97\u4e0d\u4e0e\u8fd9\u4e00\u9650\u5236\u505a\u6597\u4e89\u3002\u56e0\u4e3a\u867d\u7136\u5355\u6b21\u8c03\u7528\u4f1a\u8fd4\u56de\u7e41\u591a\u7684\u6570\u636e\uff0c\u4f46\u662f\u7edd\u5927\u90e8\u5206\u90fd\u662f\u65e0\u7528\u7684\u3002\u5f00\u53d1\u8005\u8981\u60f3\u83b7\u53d6\u67d0\u4e00\u7279\u5b9a\u7684\u4fe1\u606f\uff0c\u5f80\u5f80\u9700\u8981\u53d1\u8d77\u591a\u4e2a\u67e5\u8be2\uff0c\u7136\u540e\u7f16\u5199\u8bb8\u591a\u80f6\u6c34\u4ee3\u7801\u628a\u67e5\u8be2\u7ed3\u679c\u4e2d\u6709\u610f\u4e49\u7684\u6570\u636e\u62fc\u63a5\u6210\u6240\u9700\u7684\u5185\u5bb9\u3002\u5728\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\uff0c\u4ed6\u4eec\u8fd8\u4e0d\u5f97\u4e0d\u5e26\u4e0a\u201c\u8c03\u7528\u6b21\u6570\u201d\u7684\u9563\u94d0\u3002\\n\\n\u6240\u4ee5 GraphQL \u7684\u51fa\u73b0\uff0c\u7acb\u523b\u5c31\u8ba9 GitHub [\u7688\u4f9d](https://docs.github.com/en/graphql/overview/about-the-graphql-api#why-github-is-using-graphql)\u4e86\u3002GitHub \u6210\u4e3a\u4e86 GraphQL \u7684\u4f7f\u8005\u4fdd\u7f57\uff0c\u4e3a\u4e07\u5343\u5f00\u53d1\u8005\u4f20\u9012\u798f\u97f3\u3002\u76ee\u524d GraphQL API \u5df2\u7ecf\u662f GitHub API \u7684\u9996\u9009\u3002\u4ece[\u7b2c\u4e00\u6b21\u5ba3\u5e03\u5bf9 GraphQL \u7684\u652f\u6301](https://github.blog/2016-09-14-the-github-graphql-api/)\u4e4b\u540e\uff0cGitHub \u6bcf\u4e00\u5e74\u90fd\u4f1a[\u53d1\u51e0\u7bc7\u5173\u4e8e GraphQL \u7684\u6587\u7ae0](https://github.blog/?s=graphQL)\u3002\u4e3a\u4e86\u8ba9\u5f00\u53d1\u8005\u80fd\u591f\u8fc1\u79fb\u5230 GraphQL \u4e0a\u6765\uff0cGitHub \u4e13\u95e8\u5199\u4e86\u4e2a\u4ea4\u4e92\u5f0f\u67e5\u8be2\u5e94\u7528\uff0c[\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u5e94\u7528\u5b66\u4e60\u600e\u4e48\u7f16\u5199](https://docs.github.com/en/graphql/overview/explorer%E3%80%82%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%BF%99%E4%B8%AA%E5%BA%94%E7%94%A8%E5%AD%A6%E4%B9%A0%E6%80%8E%E4%B9%88%E7%BC%96%E5%86%99) GraphQL\u3002\\n\\n\u7136\u800c GraphQL \u5e76\u975e\u7075\u4e39\u5999\u836f\u3002\u5c31\u5728\u6700\u8fd1\uff0c[GitHub \u5e9f\u5f03\u81ea\u5df1 package API \u7684 GraphQL \u5b9e\u73b0](https://github.blog/changelog/2022-08-18-deprecation-notice-graphql-for-packages/)\u3002\u8bb8\u591a\u4eba\u4e5f\u5f00\u59cb[\u70ed\u8bae GraphQL \u7684\u4e00\u4e9b\u7f3a\u70b9](https://honest.engineering/posts/why-use-graphql-good-and-bad-reasons)\u3002\\n\\nGraphQL \u7684\u8bb8\u591a\u95ee\u9898\u6e90\u81ea\u4e8e\u5b83\u8ddf HTTP \u6807\u51c6\u7684\u7ed3\u6784\u5dee\u522b\u8f83\u5927\uff0c\u6ca1\u529e\u6cd5\u7b80\u5355\u5730\u5c06 GraphQL \u7684\u4e00\u4e9b\u6982\u5ff5\u6620\u5c04\u5230\u8bf8\u5982 HTTP path/header \u8fd9\u6837\u7684\u7ed3\u6784\u4e2d\u3002\u628a GraphQL \u5f53\u4f5c\u666e\u901a\u7684 HTTP API \u6765\u5904\u7406\uff0c\u9700\u8981\u989d\u5916\u7684\u5f00\u53d1\u5de5\u4f5c\u3002\u5982\u6b64\u4e00\u6765\uff0c\u5f00\u53d1\u8005\u5982\u679c\u8981\u7ba1\u7406\u81ea\u5df1\u7684 GraphQL API\uff0c\u5c31\u5fc5\u987b\u91c7\u7528\u652f\u6301 GraphQL \u7684 API \u7f51\u5173\u624d\u884c\u3002\\n\\n## APISIX \u73b0\u5728\u5bf9 GraphQL \u7684\u652f\u6301\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u7cbe\u7ec6\u5316\u8def\u7531\u3001\u9650\u6d41\u9650\u901f\u3001\u670d\u52a1\u964d\u7ea7\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u6570\u767e\u9879\u529f\u80fd\u3002\u4f5c\u4e3a Apache \u7684\u9876\u7ea7\u9879\u76ee\uff0cAPISIX \u4e00\u76f4\u81f4\u529b\u4e8e\u5468\u8fb9\u751f\u6001\u7684\u6269\u5c55\u4e0e\u8ddf\u8fdb\u3002\\n\\nAPISIX \u76ee\u524d\u652f\u6301\u901a\u8fc7 GraphQL \u7684\u4e00\u4e9b\u5c5e\u6027\u8fdb\u884c\u52a8\u6001\u8def\u7531\u3002\u901a\u8fc7\u8be5\u80fd\u529b\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u63a5\u53d7\u7279\u5b9a\u7684 GraphQL \u8bf7\u6c42\uff0c\u6216\u8005\u8ba9\u4e0d\u540c\u7684 GraphQL \u8f6c\u53d1\u5230\u4e0d\u540c\u7684\u4e0a\u6e38\u3002\\n\\n\u4ee5\u4e0b\u9762\u7684 GraphQL \u8bed\u53e5\u4e3a\u4f8b\uff1a\\n\\n```graphql\\n  query getRepo {\\n      owner {\\n          name\\n      }\\n      repo {\\n          created\\n      }\\n  }\\n```\\n\\nAPISIX \u4f1a\u63d0\u53d6 GraphQL \u4ee5\u4e0b\u4e09\u4e2a\u5c5e\u6027\uff0c\u7528\u5728\u8def\u7531\u5f53\u4e2d\uff1a\\n\\n* graphql_operation\\n* graphql_name\\n* graphql_root_fields\\n\\n\u5728\u4e0a\u9762\u7684 GraphQL \u8bed\u53e5\u4e2d\uff1a\\n\\n* `graphql_operation` \u5bf9\u5e94 `query`\\n* `graphql_name` \u5bf9\u5e94 `getRepo`\\n* `graphql_root_fields` \u5bf9\u5e94 `[\\"owner\\", \\"repo\\"]`\\n\\n\u8ba9\u6211\u4eec\u6765\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff0c\u5c55\u793a\u4e0b APISIX \u5bf9 GraphQL \u7684\u7cbe\u7ec6\u5316\u8def\u7531\u80fd\u529b\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/routes/1 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n  {\\n      \\"methods\\": [\\"POST\\"],\\n      \\"uri\\": \\"/graphql\\",\\n      \\"vars\\": [\\n          [\\"graphql_operation\\", \\"==\\", \\"query\\"],\\n          [\\"graphql_name\\", \\"==\\", \\"getRepo\\"],\\n          [\\"graphql_root_fields\\", \\"has\\", \\"owner\\"]\\n      ],\\n      \\"upstream\\": {\\n          \\"type\\": \\"roundrobin\\",\\n          \\"nodes\\": {\\n              \\"127.0.0.1:2022\\": 1\\n          }\\n      }\\n  }\'\\n```\\n\\n\u63a5\u4e0b\u6765\u4f7f\u7528\u5e26\u6709 GraphQL \u8bed\u53e5\u7684\u8bf7\u6c42\u53bb\u8bbf\u95ee\uff1a\\n\\n```shell\\ncurl -i -H \'content-type: application/graphql\' \\\\\\n-X POST http://127.0.0.1:9080/graphql -d \'\\nquery getRepo {\\n    owner {\\n        name\\n    }\\n    repo {\\n        created\\n    }\\n}\'\\nHTTP/1.1 200 OK\\n...\\n```\\n\\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8bf7\u6c42\u5230\u8fbe\u4e86\u4e0a\u6e38\uff0c\u8fd9\u662f\u56e0\u4e3a\u67e5\u8be2\u8bed\u53e5\u5339\u914d\u4e86\u5168\u90e8\u4e09\u4e2a\u6761\u4ef6\u3002 \u53cd\u4e4b\uff0c\u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e0d\u5339\u914d\u7684\u8bed\u53e5\u6765\u8bbf\u95ee\uff0c\u6bd4\u5982\u4e0d\u5305\u542b `owner` \u5b57\u6bb5\uff1a\\n\\n```shell\\ncurl -i -H \'content-type: application/graphql\' \\\\\\n-X POST http://127.0.0.1:9080/graphql -d \'\\nquery getRepo {\\n    repo {\\n        created\\n    }\\n}\'\\nHTTP/1.1 404 Not Found\\n...\\n```\\n\\n\u5219\u4e0d\u4f1a\u5339\u914d\u5bf9\u5e94\u7684\u8def\u7531\u89c4\u5219\u3002\\n\\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u53e6\u5916\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff0c\u8ba9\u4e0d\u5305\u542b `owner` \u5b57\u6bb5\u7684\u8bed\u53e5\u8def\u7531\u5230\u522b\u7684\u4e0a\u6e38\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/routes/2 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n  {\\n      \\"methods\\": [\\"POST\\"],\\n      \\"uri\\": \\"/graphql\\",\\n      \\"vars\\": [\\n          [\\"graphql_operation\\", \\"==\\", \\"query\\"],\\n          [\\"graphql_name\\", \\"==\\", \\"getRepo\\"],\\n          [\\"graphql_root_fields\\", \\"!\\", \\"has\\", \\"owner\\"]\\n      ],\\n      \\"upstream\\": {\\n          \\"type\\": \\"roundrobin\\",\\n          \\"nodes\\": {\\n              \\"192.168.0.1:2022\\": 1\\n          }\\n      }\\n  }\'\\ncurl -i -H \'content-type: application/graphql\' \\\\\\n-X POST http://127.0.0.1:9080/graphql -d \'\\nquery getRepo {\\n    repo {\\n        created\\n    }\\n}\'\\nHTTP/1.1 200 OK\\n..\\n```\\n\\n## \u5c55\u671b APISIX \u672a\u6765\u5bf9 GraphQL \u7684\u652f\u6301\\n\\n\u9664\u4e86\u52a8\u6001\u8def\u7531\u4e4b\u5916\uff0cAPISIX \u5728\u672a\u6765\u4e5f\u53ef\u80fd\u4f1a\u6839\u636e GraphQL \u7684\u5177\u4f53\u5b57\u6bb5\u63a8\u51fa\u66f4\u591a\u7684\u64cd\u4f5c\u3002\u6bd4\u5982\u8bf4\uff0cGitHub \u7684 GraphQL API \u6709[\u4e13\u95e8\u4e00\u5957\u9488\u5bf9\u9650\u6d41\u7684\u8ba1\u7b97\u516c\u5f0f](https://docs.github.com/en/graphql/overview/resource-limitations#rate-limit)\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5e94\u7528\u7c7b\u4f3c\u7684\u89c4\u5219\u6765\u628a\u5355\u4e2a GraphQL \u8bf7\u6c42\u8f6c\u6210\u76f8\u5e94\u7684\u201c\u865a\u62df\u8c03\u7528\u201d\u6b21\u6570\uff0c\u6765\u5b8c\u6210 GraphQL \u4e13\u5c5e\u7684\u9650\u6d41\u5de5\u4f5c\u3002\\n\\n\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u6362\u4e2a\u601d\u8def\u89e3\u51b3\u95ee\u9898\u3002\u5373\u5e94\u7528\u81ea\u8eab\u8fd8\u662f\u63d0\u4f9b REST API\uff0c\u7531\u7f51\u5173\u5728\u6700\u5916\u5c42\u628a GraphQL \u8bf7\u6c42\u8f6c\u6210 REST \u8bf7\u6c42\uff0c\u628a REST \u54cd\u5e94\u8f6c\u6210 GraphQL \u54cd\u5e94\u3002\u8fd9\u79cd\u65b9\u5f0f\u63d0\u4f9b\u7684 GraphQL API \u65e0\u9700\u5f00\u53d1\u4e13\u95e8\u7684\u63d2\u4ef6\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u8bf8\u5982 RBAC\u3001\u9650\u6d41\u3001\u7f13\u5b58\u7b49\u529f\u80fd\u3002\\n\\n\u4ece\u63d2\u4ef6\u89d2\u5ea6\u6765\u770b\uff0c\u5b83\u5c31\u662f\u4e2a\u5e73\u5e73\u65e0\u5947\u7684 REST API\u3002\u4ece\u6280\u672f\u89d2\u5ea6\u4e0a\u8bb2\uff0c\u8fd9\u4e2a\u601d\u8def\u5e76\u4e0d\u96be\u5b9e\u73b0\u3002\u6bd5\u7adf\u5728 2022 \u5e74\u7684\u73b0\u5728\uff0cREST API \u4e5f\u4f1a\u63d0\u4f9b OpenAPI spec \u6765\u4f5c\u4e3a schema\uff0c\u65e0\u975e\u662f GraphQL schema \u548c OpenAPI schema \u4e4b\u95f4\u7684\u4e92\u8f6c\uff0c\u5916\u52a0 GraphQL \u7279\u6709\u7684\u5b57\u6bb5\u7b5b\u9009\u7f62\u4e86\uff08\u5f53\u7136\uff0c\u6211\u5fc5\u987b\u627f\u8ba4\uff0c\u6211\u5e76\u6ca1\u6709\u4eb2\u81ea\u5b9e\u8df5\u8fc7\uff0c\u6216\u8005\u5728\u4e00\u4e9b\u7ec6\u8282\u4e0a\u5b58\u5728\u5c1a\u5f85\u514b\u670d\u7684\u6311\u6218\uff09\u3002\\n\\n\u7ec6\u5fc3\u7684\u8bfb\u8005\u4f1a\u53d1\u73b0\uff0c\u8fd9\u79cd\u65b9\u5f0f\u8f6c\u6362\u5f97\u6765\u7684 GraphQL API\uff0c\u6bcf\u6b21\u53ea\u80fd\u64cd\u4f5c\u4e00\u4e2a\u6a21\u578b\uff0c\u663e\u7136\u65e0\u6cd5\u6ee1\u8db3 GraphQL \u7075\u6d3b\u6027\u7684\u8981\u6c42\uff0c\u65e0\u975e\u662f\u62ab\u7740 GraphQL \u5916\u8863\u7684 REST API\u3002**\u4e14\u6162\uff0c\u6211\u8fd8\u6ca1\u6709\u628a\u8bdd\u8bf4\u5b8c\u5462\uff01**GraphQL \u6709\u4e00\u4e2a\u53eb [schema stitch](https://www.apollographql.com/blog/backend/graphql-schema-stitching/) \u7684\u6982\u5ff5\uff0c\u5141\u8bb8\u5b9e\u73b0\u8005\u628a\u591a\u4e2a schema \u7ec4\u5408\u5728\u4e00\u8d77\u3002\\n\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u73b0\u5728\u6709\u4e24\u4e2a API\u3002\u4e00\u4e2a\u53eb GetEvent\uff0c\u53e6\u4e00\u4e2a\u53eb GetLocation\u3002\u4ed6\u4eec\u8fd4\u56de\u7684\u7c7b\u578b\u5206\u522b\u662f Event \u548c Location\u3002\\n\\n```grahphql\\ntype Event {\\n  id: string\\n  location_id: string\\n}\\n\\ntype Location {\\n  id: string\\n  city: string\\n}\\n\\ntype Query {\\n    GetEvent(id: string): Event\\n    GetLocation(id: string): Location\\n}\\n```\\n\\n\u6211\u4eec\u53ef\u4ee5\u52a0\u4e00\u4e2a\u914d\u7f6e\uff0c\u7531\u8fd9\u4e24\u4e2a API \u7ec4\u5408\u6210\u65b0\u7684 API \u53eb `GetEventWithLocation`\u3002\u65b0\u7684 API \u662f\u8fd9\u6837\u7684\uff1a\\n\\n```grahphql\\ntype EventWithLocation {\\n  id: string\\n  location: Location\\n}\\n\\ntype Query {\\n    GetEventWithLocation(id: string): EventWithLocation\\n}\\n```\\n\\n\u6574\u4f53 schema stitch \u7684\u8fc7\u7a0b\u90fd\u7531\u7f51\u5173\u6765\u5b8c\u6210\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u7f51\u5173\u4f1a\u628a API \u62c6\u5206\u6210\u4e24\u4e2a\uff0c\u5148\u8c03\u7528 GetEvent \u5f97\u5230 `location_id`\uff0c\u518d\u8c03\u7528 GetLocation \u5f97\u5230\u7ec4\u5408\u540e\u7684\u6570\u636e\u3002\\n\\n\u603b\u800c\u8a00\u4e4b\uff0c\u901a\u8fc7 REST \u8f6c GraphQL\uff0c\u6bcf\u4e2a REST API \u53ef\u4ee5\u53d8\u6210\u5bf9\u5e94\u7684 GraphQL \u6a21\u578b\uff1b\u518d\u501f\u52a9 schema stitch\uff0c\u53ef\u4ee5\u628a\u591a\u4e2a\u6a21\u578b\u7ec4\u5408\u6210\u4e00\u4e2a GraphQL API\u3002\\n\\n\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u80fd\u5728\u73b0\u6709\u7684 REST API \u4e0a\u6784\u5efa\u8d77\u4e30\u5bcc\u7075\u6d3b\u7684 GraphQL API\uff0c\u4e14\u5728 REST API \u7684\u7c92\u5ea6\u4e0a\u5b8c\u6210\u5177\u4f53\u7684\u63d2\u4ef6\u7ba1\u7406\u3002\u8fd9\u4e00\u8bbe\u8ba1\u987a\u5e26\u89e3\u51b3\u4e86\u90e8\u5206 API \u7f16\u6392\u7684\u95ee\u9898\u3002\u5c31\u50cf\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u628a\u4e00\u4e2a API \u7684\u8f93\u51fa\uff08Event.location_id\uff09\u4f5c\u4e3a\u53e6\u4e00\u4e2a API \u7684\u8f93\u5165\uff08Location.id\uff09\u3002"},{"id":"APISIX Ingress \u5982\u4f55\u652f\u6301\u81ea\u5b9a\u4e49\u63d2\u4ef6","metadata":{"permalink":"/zh/blog/2022/12/15/how-support-ingress-custom-plugins","source":"@site/blog/2022/12/15/how-support-ingress-custom-plugins.md","title":"APISIX Ingress \u5982\u4f55\u652f\u6301\u81ea\u5b9a\u4e49\u63d2\u4ef6","description":"\u672c\u7bc7\u4e3b\u8981\u4ecb\u7ecd\u4e86 Ingress \u8d44\u6e90\u76f8\u5173\u7684\u8bed\u4e49\uff0c\u4ee5\u53ca\u5982\u4f55\u5bf9 Ingress \u8d44\u6e90\u8fdb\u884c\u80fd\u529b\u7684\u6269\u5c55\u3002","date":"2022-12-15T00:00:00.000Z","formattedDate":"2022\u5e7412\u670815\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.605,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","url":"https://github.com/tao12345666333","imageURL":"https://github.com/tao12345666333.png"}],"prevItem":{"title":"\u9a6c\u65af\u514b\u90fd\u4e0d\u61c2\u7684 GraphQL\uff0cAPI \u7f51\u5173\u53c8\u80fd\u5bf9\u5176\u5982\u4f55\u7406\u89e3\uff1f","permalink":"/zh/blog/2022/12/16/what-is-graphql"},"nextItem":{"title":"\u805a\u7126\u4eba\u673a\u4ea4\u4e92\u667a\u80fd\u5e94\u7528\u9886\u57df\uff0cAPISIX \u5728\u5e0c\u6c83\u7f51\u5173\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5","permalink":"/zh/blog/2022/12/13/seewo-with-apache-apisix"}},"content":"> \u672c\u7bc7\u4e3b\u8981\u4ecb\u7ecd\u4e86 Ingress \u8d44\u6e90\u76f8\u5173\u7684\u8bed\u4e49\uff0c\u4ee5\u53ca\u5982\u4f55\u5bf9 Ingress \u8d44\u6e90\u8fdb\u884c\u80fd\u529b\u7684\u6269\u5c55\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005\uff1a\u5f20\u664b\u6d9b\uff0cAPI7.ai \u4e91\u539f\u751f\u6280\u672f\u4e13\u5bb6\uff0cApache APISIX PMC \u6210\u5458\uff0cApache APISIX Ingress Controller \u9879\u76ee\u7ef4\u62a4\u8005\u3002\\n\\n## Ingress \u548c Ingress Controllers\\n\\nKubernetes \u4e2d\u7684 Ingress \u662f\u4e00\u79cd\u8d44\u6e90\u5bf9\u8c61\uff0c\u7528\u4e8e\u5b9a\u4e49\u5982\u4f55\u4ece Kubernetes \u96c6\u7fa4\u5916\u8bbf\u95ee\u5230 Kubernetes \u96c6\u7fa4\u5185\u7684\u670d\u52a1\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u5177\u4f53\u7684\u8bbf\u95ee\u89c4\u5219\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u5ba2\u6237\u7aef\u4f7f\u7528 HTTP/HTTPS \u534f\u8bae\u8fdb\u884c\u8bbf\u95ee\u3002\\n\\n\u5ba2\u6237\u7aef\u53ef\u6309\u7167 Ingress \u8d44\u6e90\u5b9a\u4e49\u7684\u89c4\u5219\uff0c\u5c06\u5ba2\u6237\u7aef\u8bf7\u6c42\u8def\u7531\u5230 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u6216\u5177\u4f53\u7684 Pod \u4e2d\u3002\\n\\n![3df3234c-7ae7-48de-8dbb-0449226e4f2e.png](https://static.apiseven.com/2022/12/14/63996e81521dc.png)\\n\\n\u4ee5\u4e0b\u662f\u4e00\u4e2a Ingress \u8d44\u6e90\u7684\u793a\u4f8b\uff1a\\n\\n```yaml\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  name: apisix-gateway\\nspec:\\n  rules:\\n  - host: apisix.apache.org\\n    http:\\n      paths:\\n      - backend:\\n          service:\\n            name: apisix-gateway\\n            port:\\n              number: 80\\n        path: /\\n        pathType: Exact\\n```\\n\\n\u4e0a\u8ff0\u793a\u4f8b\u4e2d\u5305\u542b\u4e86\u4ee5\u4e0b\u5185\u5bb9\uff1a\\n\\n* **metadata.name**\uff1aIngress \u8d44\u6e90\u7684\u540d\u79f0\\n* **spec.rules[].host**\uff1a\u5916\u90e8\u8bbf\u95ee\u4f7f\u7528\u7684\u57df\u540d\\n* **spec.rules[].http.paths[].backend**\uff1a\u5b9a\u4e49\u4e86 Kubernetes \u96c6\u7fa4\u4e2d\u670d\u52a1\u7684\u76f8\u5173\u4fe1\u606f\\n* **spec.rules[].http.paths[].path**\uff1a\u5b9a\u4e49\u4e86\u5916\u90e8\u670d\u52a1\u8bbf\u95ee Kubernetes \u96c6\u7fa4\u4e2d\u670d\u52a1\u65f6\u4f7f\u7528\u7684\u8def\u5f84\\n* **spec.rules[].http.paths[].pathType**\uff1a\u5b9a\u4e49\u4e86\u5916\u90e8\u670d\u52a1\u8bbf\u95ee Kubernetes \u96c6\u7fa4\u4e2d\u670d\u52a1\u65f6\u8def\u5f84\u7684\u5339\u914d\u89c4\u5219\\n\\n\u4ece\u4e0a\u8ff0\u5185\u5bb9\u53ef\u4ee5\u770b\u5230\uff0c**Ingress \u8d44\u6e90\u7684\u8bed\u4e49\u662f\u76f8\u5bf9\u6bd4\u8f83\u7b80\u5355\u7684\u3002**\\n\\nIngress \u4ec5\u4ec5\u662f Kubernetes \u4e2d\u7684\u4e00\u79cd\u8d44\u6e90\u5b9a\u4e49\uff0c\u5b83\u672c\u8eab\u4e0d\u5177\u5907\u4efb\u4f55\u6d41\u91cf\u5904\u7406\u80fd\u529b\u3002\u8981\u8ba9 Ingress \u8d44\u6e90\u751f\u6548\uff0c\u5219\u5fc5\u987b\u8981\u6709 controller \u6765\u5904\u7406\u8fd9\u4e9b Ingress \u8d44\u6e90\uff0c\u901a\u5e38\u8fd9\u6837\u7684 controller \u6211\u4eec\u79f0\u4e4b\u4e3a Ingress controller\u3002\\n\\nIngress controller \u4f1a\u6301\u7eed\u5730\u76d1\u63a7\u6216\u76d1\u542c Kubernetes \u96c6\u7fa4\u4e2d Ingress \u8d44\u6e90\u7684\u53d8\u5316\uff0c\u5e76\u6839\u636e Ingress \u8d44\u6e90\u4e2d\u5b9a\u4e49\u7684\u89c4\u5219\uff0c\u8f6c\u6362\u4e3a\u5176\u6570\u636e\u9762\u4e2d\u7684\u4ee3\u7406\u89c4\u5219\uff0c\u5e76\u7531\u6570\u636e\u9762\u6765\u5b9e\u9645\u7684\u627f\u8f7d\u6d41\u91cf\u3002\\n\\n**\u5728\u5b9e\u9645\u7684\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u9700\u6c42\u662f\u591a\u79cd\u591a\u6837\u7684\u3002\u6bd4\u5982\u6700\u5e38\u89c1\u7684\u8ba4\u8bc1\u3001\u8def\u7531\u91cd\u5199\u7b49\u80fd\u529b\uff0c\u901a\u8fc7 Ingress \u8d44\u6e90\u662f\u65e0\u6cd5\u76f4\u63a5\u8fdb\u884c\u63cf\u8ff0\u7684\u3002\u90a3\u4e48\u8fd9\u4e9b\u9700\u6c42\u8981\u5982\u4f55\u6ee1\u8db3\u5462\uff1f**\\n\\n## Ingress-NGINX \u5982\u4f55\u652f\u6301\u6269\u5c55\u529f\u80fd\\n\\n\u9996\u5148\u6211\u4ee5 Kubernetes \u793e\u533a\u7684 Ingress-NGINX controller \u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u5982\u4f55\u5728\u5176\u4e2d\u4f7f\u7528\u6269\u5c55\u529f\u80fd\u3002\\n\\n\u5728 Ingress-NGINX \u9879\u76ee\u4e2d\uff0c\u53ef\u4ee5\u4e3a Ingress \u8d44\u6e90\u589e\u52a0\u4e00\u4e9b Annotation \u6765\u63cf\u8ff0\u5176\u9700\u8981\u4f7f\u7528\u7684\u6269\u5c55\u80fd\u529b\u3002\u6bd4\u5982\u4f7f\u7528\u5982\u4e0b\u914d\u7f6e\u4fbf\u53ef\u5f00\u542f cors \u80fd\u529b\u3002\\n\\n```yaml\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  annotations:\\n    kubernetes.io/ingress.class: nginx\\n    nginx.ingress.kubernetes.io/enable-cors: \\"true\\"\\n    nginx.ingress.kubernetes.io/cors-allow-origin: https://foo.com,https://bar.com\\n    nginx.ingress.kubernetes.io/cors-allow-headers: x-foo-1,x-foo-2\\n    nginx.ingress.kubernetes.io/cors-allow-methods: GET,POST,PUT\\n  name: nginx-ingress\\nspec:\\n  rules:\\n  - host: kubernetes.github.io\\n    http:\\n      paths:\\n      - path: /ingress\\n        pathType: Exact\\n        backend:\\n          service:\\n            name: nginx\\n            port:\\n              number: 80\\n```\\n\\n\u8fd9\u79cd\u65b9\u5f0f\u4ec5\u4ec5\u9700\u8981\u4e3a Ingress \u8d44\u6e90\u6dfb\u52a0 Annotations \u7684\u914d\u7f6e\u5373\u53ef\uff0c\u76f8\u5bf9\u7b80\u5355\u3002\u4f46\u9700\u8981\u6ce8\u610f\uff0c\u4f7f\u7528\u8fd9\u79cd\u6a21\u5f0f\u9700\u8981 Ingress-NGINX controller \u5df2\u7ecf\u5b8c\u6210\u4e86\u5bf9\u8be5 Annotations \u7684\u5b8c\u6574\u652f\u6301\uff0c\u5426\u5219\u8be5\u914d\u7f6e\u662f\u65e0\u6548\u7684\u3002\\n\\n\u5982\u679c\u9700\u8981\u5176\u4ed6\u7684\u4e00\u4e9b Ingress-NGINX controller \u5c1a\u672a\u5b9e\u73b0\u7684\u80fd\u529b\uff0c\u5219\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\u3002\\n\\n## \u5728 APISIX Ingress \u4e2d\u4f7f\u7528\u63d2\u4ef6\\n\\n\u76f8\u8f83\u4e8e Ingress-NGINX controller\uff0cAPISIX Ingress \u4f7f\u7528 APISIX \u4f5c\u4e3a\u6570\u636e\u9762\uff0cAPISIX \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u5168\u52a8\u6001 API \u7f51\u5173\u3002\u6240\u6709\u7684\u914d\u7f6e\u53d8\u66f4\u90fd\u662f\u52a8\u6001\u8fdb\u884c\u7684\uff0c\u65e0\u9700\u91cd\u542f\uff0c\u6240\u4ee5\u5bf9\u4e1a\u52a1\u6d41\u91cf\u4e0d\u4f1a\u9020\u6210\u4efb\u4f55\u5f71\u54cd\u3002\\n\\n\u5728 Apache APISIX Ingress \u4e2d\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u63d2\u4ef6\uff0c\u6765\u6ee1\u8db3\u7528\u6237\u5404\u79cd\u6d41\u91cf\u5904\u7406\u7684\u9700\u6c42\u548c\u5177\u4f53\u573a\u666f\u3002\u5f53\u524d\u6709 80+ \u63d2\u4ef6\u5f00\u7bb1\u5373\u7528\uff0c\u5f53\u7136\u7528\u6237\u4e5f\u53ef\u4ee5\u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6\u6765\u8fdb\u884c\u80fd\u529b\u7684\u6269\u5c55\u3002\\n\\n![output.png](https://static.apiseven.com/2022/12/14/63996c4d6f23e.png)\\n\\n\u76ee\u524d\uff0c\u5728 Apache APISIX \u4e2d\u652f\u6301\u591a\u79cd\u65b9\u5f0f\u8fdb\u884c\u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684\u5f00\u53d1\uff1a\\n\\n* \u4f7f\u7528 Lua \u8fdb\u884c\u63d2\u4ef6\u7684\u5f00\u53d1\uff0c\u8fd9\u7c7b\u63d2\u4ef6\u4f1a\u5728 APISIX \u5185\u90e8\u8fd0\u884c\uff1b\\n* \u4f7f\u7528\u5176\u4ed6\u8bed\u8a00\u8fdb\u884c\u63d2\u4ef6\u7684\u5f00\u53d1\uff0c\u8fd9\u79cd\u673a\u5236\u53eb\u4f5c Plugin Runner\uff0c\u5229\u7528\u8be5\u673a\u5236\u5f00\u53d1\u7684\u63d2\u4ef6\u5c5e\u4e8e external-plugin\u3002\\n\\n\u5173\u4e8e APISIX \u63d2\u4ef6\u7684\u5f00\u53d1\uff0c\u53ef\u53c2\u8003\u5b98\u65b9\u6587\u6863\uff1a\\n\\n* [\u63d2\u4ef6\u5f00\u53d1](https://apisix.apache.org/docs/apisix/plugin-develop/)\\n* [External Plugin \u5f00\u53d1](https://apisix.apache.org/docs/apisix/external-plugin/)\\n\\n\u4e86\u89e3\u4e86 APISIX \u7684\u63d2\u4ef6\u5f00\u53d1\u6a21\u5f0f\u540e\uff0c\u63a5\u4e0b\u6765\u5c06\u4ecb\u7ecd 3 \u79cd\u5728 APISIX Ingress \u4e2d\u4f7f\u7528 Lua \u8bed\u8a00\u5f00\u53d1\u63d2\u4ef6\u7684\u65b9\u5f0f\u3002\\n\\n### \u65b9\u5f0f\u4e00\uff1a\u7eaf CRD \u6a21\u5f0f\\n\\nAPISIX Ingress controller \u652f\u6301\u81ea\u5df1\u8bbe\u8ba1\u7684\u4e00\u5957 CRD \u89c4\u8303\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\u8def\u7531\u89c4\u5219\u4e2d\u5f00\u542f\u63d2\u4ef6\uff08\u65e0\u8bba\u662f\u5185\u7f6e\u63d2\u4ef6\u8fd8\u662f\u81ea\u5b9a\u4e49\u63d2\u4ef6\uff09\uff0c\u4f8b\u5982\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v2beta3\\nkind: ApisixRoute\\nmetadata:\\n name: httpbin-route\\nspec:\\n http:\\n - name: rule1\\n   match:\\n     hosts:\\n     - apisix.apache.org\\n     paths:\\n       - /apisix-ingress\\n   backends:\\n   - serviceName: apisix-gateway\\n     servicePort: 80\\n   plugins:\\n   - name: cors\\n     enable: true\\n     config:\\n       allow_origins: http://foo.bar.org\\n       allow_methods: \\"GET,POST\\"\\n       max_age: 3600\\n       expose_headers: x-foo,x-baz\\n       allow_headers: x-from-ingress\\n       allow_credential: true\\n```\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u914d\u7f6e\u53ef\u4ee5\u521b\u5efa\u8def\u7531\u89c4\u5219\uff0c\u5e76\u4e14\u5728\u6b64\u8def\u7531\u4e2d\u5f00\u542f `cors` \u63d2\u4ef6\u3002\\n\\n**\u8fd9\u662f APISIX Ingress \u4e2d\u6700\u539f\u751f\u652f\u6301\u7684\u65b9\u5f0f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u4e0e APISIX \u66f4\u52a0\u8d34\u5408\u3002\u540c\u65f6\uff0c\u7528\u6237\u65b0\u589e\u81ea\u5b9a\u4e49\u63d2\u4ef6\u540e\uff0cAPISIX Ingress \u4e5f\u65e0\u9700\u8fdb\u884c\u4efb\u4f55\u4e8c\u6b21\u5f00\u53d1\uff0c\u53ef\u76f4\u63a5\u4f7f\u7528\u3002**\\n\\n### \u65b9\u5f0f\u4e8c\uff1aIngress Annotations \u6a21\u5f0f\\n\\n\u7531\u4e8e Ingress \u8d44\u6e90\u7684\u8bed\u4e49\u6709\u9650\uff0c\u6240\u4ee5\u901a\u5e38\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `annotations` \u4e3a\u8d44\u6e90\u5bf9\u8c61\u6269\u5c55\u4e00\u4e9b\u4fe1\u606f\uff0c\u8fd9\u4e5f\u662f\u6700\u5e38\u89c1\u7684\u5bf9 Ingress \u80fd\u529b\u6269\u5c55\u7684\u65b9\u5f0f\u3002\u4f8b\u5982\uff1a\\n\\n```yaml\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  annotations:\\n    kubernetes.io/ingress.class: apisix\\n    k8s.apisix.apache.org/enable-cors: \\"true\\"\\n    k8s.apisix.apache.org/cors-allow-origin: https://foo.com,https://bar.com\\n    k8s.apisix.apache.org/cors-allow-headers: x-foo-1,x-foo-2\\n    k8s.apisix.apache.org/cors-allow-methods: GET,POST,PUT\\n  name: apisix-ingress\\nspec:\\n  rules:\\n  - host: apisix.apache.org\\n    http:\\n      paths:\\n      - path: /apisix-ingress\\n        pathType: Exact\\n        backend:\\n          service:\\n            name: apisix-gateway\\n            port:\\n              number: 80\\n```\\n\\n\u4e0a\u8ff0\u914d\u7f6e\u5728 Ingress \u8d44\u6e90\u4e2d\u589e\u52a0\u4e86 `cors` \u76f8\u5173\u7684\u4e00\u4e9b\u4fe1\u606f\u3002APISIX Ingress controller \u53ef\u4ee5\u8bc6\u522b\u8fd9\u4e9b\u4fe1\u606f\uff0c\u5e76\u5c06\u8fd9\u4e9b\u4fe1\u606f\u8f6c\u6362\u4e3a\u6570\u636e\u9762\u4e2d `cors` \u7684\u914d\u7f6e\uff0c\u8fdb\u800c\u5b8c\u6210\u5bf9 Ingress \u8d44\u6e90\u7684\u6269\u5c55\u3002\\n\\n**\u4f46\u662f\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u9700\u8981\u786e\u4fdd\u5728 APISIX Ingress controller \u4e2d\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5bf9\u8fd9\u4e9b Annotations \u7684\u5904\u7406\u903b\u8f91\uff0c\u5982\u679c\u5c1a\u672a\u5b9e\u73b0\uff0c\u5219\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u4e8c\u6b21\u5f00\u53d1\u3002**\\n\\n\u5982\u679c\u9700\u8981\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\uff0c\u53ef\u53c2\u8003[\u5982\u4f55\u8fdb\u884c APISIX Ingress controller \u7684\u5f00\u53d1](https://apisix.apache.org/docs/ingress-controller/contribute/)\u3002\\n\\n### \u65b9\u5f0f\u4e09\uff1aCRD + Ingress Annotations \u6a21\u5f0f\\n\\n\u9664\u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\u5916\uff0c\u5728 APISIX Ingress \u4e2d\u4e5f\u53ef\u4ee5\u901a\u8fc7 CRD + Ingress Annotations \u7684\u65b9\u5f0f\u8fdb\u884c\u6269\u5c55\uff0c\u4f8b\u5982\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v2\\nkind: ApisixPluginConfig\\nmetadata:\\n  name: cors-plugin\\nspec:\\n  plugins:\\n    - name: cors\\n      enable: true\\n      config:\\n        allow_origins: http://foo.bar.org\\n        allow_methods: \\"GET,POST\\"\\n        max_age: 3600\\n        expose_headers: x-foo,x-baz\\n        allow_headers: x-from-ingress\\n        allow_credential: true\\n---\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  annotations:\\n    kubernetes.io/ingress.class: apisix\\n    k8s.apisix.apache.org/plugin-config-name: cors-plugin\\n  name: apisix-ingress\\nspec:\\n  rules:\\n  - host: apisix.apache.org\\n    http:\\n      paths:\\n      - path: /apisix-ingress\\n        pathType: Exact\\n        backend:\\n          service:\\n            name: apisix-gateway\\n            port:\\n              number: 80\\n```\\n\\n\u901a\u8fc7\u4e0a\u65b9\u7684\u8fd9\u6bb5\u914d\u7f6e\uff0c\u53ef\u4ee5\u5355\u72ec\u521b\u5efa\u540d\u4e3a `cors-plugin` \u7684\u63d2\u4ef6\u914d\u7f6e\uff0c\u5e76\u901a\u8fc7 Ingress \u8d44\u6e90\u7684 `k8s.apisix.apache.org/plugin-config-name: cors-plugin` \u5bf9\u5176\u8fdb\u884c\u5f15\u7528\u3002\u901a\u8fc7\u8fd9\u79cd\u64cd\u4f5c\u7684\u5b9e\u9645\u6548\u679c\u4e0e\u524d\u4e24\u4e2a\u65b9\u5f0f\u57fa\u672c\u7c7b\u4f3c\uff0c\u90fd\u4f1a\u5728\u5bf9\u5e94\u7684\u8def\u7531\u4e0a\u5f00\u542f `cors` \u63d2\u4ef6\u3002\\n\\n\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c**\u7528\u6237\u7684\u63d2\u4ef6\u914d\u7f6e\u53ef\u4ee5\u4f5c\u4e3a\u72ec\u7acb\u8d44\u6e90\uff0c\u5e76\u4e14\u53ef\u4ee5\u88ab\u591a\u4e2a Ingress \u8d44\u6e90\u5171\u4eab\u3002\u540c\u65f6\uff0c\u4e5f\u65e0\u9700\u8fdb\u884c\u4efb\u4f55\u4e8c\u6b21\u5f00\u53d1\u3002**\\n\\n## \u603b\u7ed3\\n\\n\u672c\u7bc7\u4e3b\u8981\u4ecb\u7ecd\u4e86 Ingress \u8d44\u6e90\u76f8\u5173\u7684\u8bed\u4e49\uff0c\u4ee5\u53ca\u5982\u4f55\u5bf9 Ingress \u8d44\u6e90\u8fdb\u884c\u80fd\u529b\u7684\u6269\u5c55\u3002\u5728 Ingress-NGINX \u4e2d\u53ef\u4ee5\u901a\u8fc7 Annotations \u7684\u65b9\u5f0f\u8fdb\u884c\u80fd\u529b\u7684\u6269\u5c55\uff0c\u4f46\u5728 Apache APISIX Ingress \u4e2d\u53ef\u4ee5\u901a\u8fc7\u4e09\u79cd\u6a21\u5f0f\u8fdb\u884c\u914d\u7f6e\u3002\u4e14\u5176\u4e2d\u4e24\u79cd\u5bf9\u4e8e\u7528\u6237\u81ea\u5df1\u5f00\u53d1\u7684\u81ea\u5b9a\u4e49\u63d2\u4ef6\u800c\u8a00\uff0c\u662f\u65e0\u9700\u8fdb\u884c\u4efb\u4f55\u4e8c\u6b21\u5f00\u53d1\u7684\uff0c\u8fdb\u800c\u6ee1\u8db3\u7528\u6237\u66f4\u591a\u7684\u573a\u666f\u548c\u9700\u6c42\u3002"},{"id":"\u805a\u7126\u4eba\u673a\u4ea4\u4e92\u667a\u80fd\u5e94\u7528\u9886\u57df\uff0cAPISIX \u5728\u5e0c\u6c83\u7f51\u5173\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/12/13/seewo-with-apache-apisix","source":"@site/blog/2022/12/13/seewo-with-apache-apisix.md","title":"\u805a\u7126\u4eba\u673a\u4ea4\u4e92\u667a\u80fd\u5e94\u7528\u9886\u57df\uff0cAPISIX \u5728\u5e0c\u6c83\u7f51\u5173\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5","description":"\u672c\u6587\u6982\u8ff0\u4e86\u5e0c\u6c83\u5728\u7f51\u5173\u90e8\u5206\u7684\u56db\u6b21\u8fed\u4ee3\uff0c\u4ee5\u53ca\u5f15\u5165 APISIX \u540e\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\u3002","date":"2022-12-13T00:00:00.000Z","formattedDate":"2022\u5e7412\u670813\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":16.92,"truncated":true,"authors":[{"name":"\u7b80\u6d77\u6e05","title":"Speaker"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"APISIX Ingress \u5982\u4f55\u652f\u6301\u81ea\u5b9a\u4e49\u63d2\u4ef6","permalink":"/zh/blog/2022/12/15/how-support-ingress-custom-plugins"},"nextItem":{"title":"\u667a\u6167\u4ea4\u901a\u7cfb\u7edf\u7f51\u65b0\u7535\u6c14\uff0c\u5982\u4f55\u57fa\u4e8e APISIX \u8fed\u4ee3\u6570\u5b57\u667a\u8054\u5e73\u53f0","permalink":"/zh/blog/2022/12/09/insigma-with-apache-apisix"}},"content":"> \u89c6\u6e90\u80a1\u4efd\uff08CVTE\uff09\u81ea\u6210\u7acb\u4ee5\u6765\uff0c\u4f9d\u6258\u5728\u97f3\u89c6\u9891\u6280\u672f\u3001\u4eba\u673a\u4ea4\u4e92\u3001\u5e94\u7528\u5f00\u53d1\u3001\u7cfb\u7edf\u96c6\u6210\u7b49\u7535\u5b50\u4ea7\u54c1\u9886\u57df\u7684\u8f6f\u786c\u4ef6\u6280\u672f\u79ef\u7d2f\uff0c\u5efa\u7acb\u4e86\u6559\u80b2\u6570\u5b57\u5316\u5de5\u5177\u53ca\u670d\u52a1\u63d0\u4f9b\u5546\u5e0c\u6c83\uff08seewo\uff09\u3001\u667a\u6167\u534f\u540c\u5e73\u53f0 MAXHUB \u7b49\u591a\u4e2a\u4e1a\u5185\u77e5\u540d\u54c1\u724c\u3002\u5176\u4e2d\u5e0c\u6c83\u4ece 2012 \u5e74\u5230 2021 \u5e74\u8fde\u7eed 10 \u5e74\u8749\u8054\u4e2d\u56fd\u4ea4\u4e92\u667a\u80fd\u5e73\u677f\u884c\u4e1a\u5e02\u5360\u7387\u6842\u51a0\uff0c\u5df2\u6210\u4e3a\u540d\u526f\u5176\u5b9e\u7684\u884c\u4e1a\u6807\u6746\u4f01\u4e1a\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u5206\u4eab\u5609\u5bbe\u7b80\u6d77\u6e05\uff0c\u89c6\u6e90\u80a1\u4efd\u8fd0\u7ef4\u8d1f\u8d23\u4eba\u3002\\n\\n\u4e3a\u4e86\u5e94\u5bf9\u65e5\u8d8b\u6210\u719f\u53ca\u5feb\u901f\u589e\u957f\u7684\u4e1a\u52a1\u73b0\u72b6\uff0c\u5e0c\u6c83\u53c8\u662f\u5982\u4f55\u5728\u7f51\u5173\u5c42\u9762\u8fdb\u884c\u8ddf\u8fdb\u7684\u5462\uff1f\\n\\n**\u968f\u7740\u6280\u672f\u7684\u98de\u901f\u53d1\u5c55\uff0c\u5728\u4eba\u9645\u4ea4\u4e92\u667a\u80fd\u9886\u57df\uff0c\u4e1a\u52a1\u9700\u6c42\u4e5f\u5bf9\u67b6\u6784\u8fed\u4ee3\u6709\u4e86\u66f4\u9ad8\u7684\u8981\u6c42\u3002\u4e3a\u4e86\u5e94\u5bf9\u65e5\u8d8b\u6210\u719f\u53ca\u5feb\u901f\u589e\u957f\u7684\u4e1a\u52a1\u73b0\u72b6\uff0c\u5e0c\u6c83\u53c8\u662f\u5982\u4f55\u5728\u7f51\u5173\u5c42\u9762\u8fdb\u884c\u8ddf\u8fdb\u7684\u5462\uff1f**\\n\\n## \u7f51\u5173\u5f80\u671f\u8fed\u4ee3\u4e0e\u75db\u70b9\\n\\n\u5e0c\u6c83\u7f51\u5173\u7684\u53d1\u5c55\u7ecf\u5386\u4e86\u56db\u4e2a\u7248\u672c\u7684\u8fed\u4ee3\u30022013 \u5e74\u516c\u53f8\u5f00\u59cb\u5c1d\u8bd5\u4e92\u8054\u7f51\u4e1a\u52a1\uff0c\u90a3\u65f6\u5019\u91c7\u7528\u4e86 OpenResty + NGINX \u9759\u6001\u914d\u7f6e\u7684\u65b9\u5f0f\u642d\u5efa\u4e86\u6700\u521d\u7684\u7f51\u5173\uff0c\u5f00\u53d1\u4eba\u5458\u901a\u8fc7 SCP\uff08Secure Copy\uff09\u8fdb\u884c\u53d1\u5e03\u3002\u4e0e\u6b64\u540c\u65f6\u4e00\u4e2a\u6bd4\u8f83\u4e25\u91cd\u7684\u95ee\u9898\u5c31\u662f\uff0c\u6bcf\u6b21\u4e0a\u7ebf\u53d1\u5e03\u90fd\u9700\u8981\u8fd0\u7ef4\u4eba\u5458\u7684\u534f\u52a9\u624d\u80fd\u4fdd\u8bc1\u5e73\u6ed1\u4e0a\u7ebf\u3002\\n\\n\u968f\u7740\u4e1a\u52a1\u7684\u53d1\u5c55\u548c\u4eba\u5458\u7684\u6269\u5145\uff0c2016 \u5e74\u6211\u4eec\u5f00\u53d1\u4e86\u7b2c\u4e8c\u4ee3\u53d1\u5e03\u7cfb\u7edf\u548c\u76f8\u5173\u8fed\u4ee3\u7f51\u5173\u3002\u8fd9\u6b21\u662f\u57fa\u4e8e OpenResty \u96c6\u6210\u4e86 upsync \u6a21\u5757\uff0c\u540c\u65f6\u914d\u5408 Consul \u6765\u8fdb\u884c\u670d\u52a1\u53d1\u73b0\u3002\u7b2c\u4e8c\u4ee3\u7684\u7cfb\u7edf\u89e3\u51b3\u4e86\u4e0a\u4e00\u4ee3\u5f00\u53d1\u4eba\u5458\u65e0\u6cd5\u72ec\u7acb\u53d1\u5e03\u4e0a\u7ebf\u7684\u95ee\u9898\uff0c\u4f46\u4ecd\u9700\u8981\u8fd0\u7ef4\u534f\u52a9\u624d\u80fd\u8fdb\u884c\u6269\u5bb9\u3002\\n\\n\u4e4b\u540e\u516c\u53f8\u4e1a\u52a1\u5f00\u59cb\u4e86\u8fc5\u731b\u53d1\u5c55\uff0c\u5f00\u59cb\u5bf9\u7f51\u5173\u4ee5\u53ca\u4ea7\u54c1\u7684\u5f39\u6027\u6269\u7f29\u80fd\u529b\u6709\u4e86\u66f4\u9ad8\u7684\u8981\u6c42\u30022018 \u5e74\u6211\u4eec\u57fa\u4e8e K8s \u5f00\u53d1\u4e86\u7b2c\u4e09\u4ee3\u7cfb\u7edf\u3002\u8003\u8651\u5230\u4ecd\u6709\u90e8\u5206\u5e94\u7528\u9057\u7559\u5728\u5bbf\u4e3b\u673a\u4e0a\uff0c\u6240\u4ee5\u6574\u4e2a\u7f51\u5173\u67b6\u6784\u662f\u5728 K8s \u4e0a\u4f7f\u7528 Ingress NGINX \u6765\u5f53\u4f5c\u7b2c\u4e8c\u5c42\u7684\u7f51\u5173\uff0c\u7b2c\u4e00\u5c42\u7f51\u5173\u4ecd\u662f OpenResty \u914d\u5408\u7684\u53cc\u5c42\u7f51\u5173\u67b6\u6784\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u867d\u7136\u89e3\u51b3\u4e86\u524d\u4ee3\u53d1\u5e03\u6269\u5bb9\u7b49\u81ea\u52a9\u95ee\u9898\uff0c\u4f46\u53c8\u5f15\u5165\u4e86\u65b0\u7684\u9ebb\u70e6\u3002\\n\\n\u4e1a\u52a1\u7684\u5feb\u901f\u6269\u5145\u81f4\u4f7f\u5bf9\u4e8e\u6574\u4f53\u7a33\u5b9a\u6027\u7684\u8981\u6c42\u8d8a\u6765\u8d8a\u9ad8\u3002\u91c7\u7528\u8fd9\u79cd\u53cc\u5c42\u7f51\u5173\u67b6\u6784\u540e\uff0c\u4e00\u5c42 NGINX reload \u548c\u4e8c\u5c42\u7f51\u5173\u7684\u8def\u7531\u53d8\u66f4\uff0c\u90fd\u4f1a\u9020\u6210\u957f\u8fde\u63a5\u65ad\u5f00\u3002\u8fd9\u5bf9\u4e8e\u4e00\u4e9b\u957f\u8fde\u63a5\u4f7f\u7528\u573a\u666f\u4f1a\u5f71\u54cd\u8f83\u5927\uff0c\u6bd4\u5982\u8f6f\u4ef6\u9700\u8981\u83b7\u53d6\u8001\u5e08\u7684\u6388\u8bfe\u72b6\u6001\u65f6\u8fde\u63a5\u7a81\u7136\u65ad\u5f00\uff0c\u72b6\u6001\u83b7\u53d6\u4e2d\u65ad\u4ece\u800c\u5f71\u54cd\u6388\u8bfe\u3002\\n\\n![output (4).png](https://static.apiseven.com/2022/12/13/6397db09f10c6.png)\\n\\n\u672c\u8eab\u53cc\u5c42\u67b6\u6784\u5c31\u4f1a\u5e26\u6765\u6210\u672c\u5c42\u9762\u7684\u4e00\u4e9b\u589e\u52a0\u3002\u540c\u65f6\uff0c\u4ece\u4e0a\u56fe\u7684\u7f51\u5173\u6d41\u91cf\u62d3\u6251\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u9664\u4e0a\u8ff0\u9057\u7559\u95ee\u9898\u5916\u4e5f\u8fd8\u5b58\u5728\u4e00\u4e9b\u67b6\u6784\u4e0a\u7684\u75db\u70b9\uff1a\\n\\n* \u5728\u53cc\u5c42\u7f51\u5173\u67b6\u6784\u4e0b\uff0c\u4e0d\u7ba1\u662f\u5728\u7b2c\u4e00\u5c42\u7f51\u5173\u6dfb\u52a0\u57df\u540d\u3001\u4fee\u6539\u914d\u7f6e\u6216\u8005\u6dfb\u52a0\u4e00\u4e9b\u7279\u6b8a\u89c4\u5219\u7b49\uff0c\u90fd\u9700\u8981 reload NGINX\u3002\\n* \u540c\u65f6\u4ece\u6574\u4f53\u67b6\u6784\u6765\u770b\uff0c\u7ec4\u4ef6\u7684\u914d\u5408\u5bf9\u4e8e\u6d41\u91cf\u63a7\u5236\u5c42\u9762\u6765\u8bf4\u6bd4\u8f83\u5dee\u3002\u5c24\u5176\u662f\u76ee\u524d\u6211\u4eec\u7684\u4e1a\u52a1\u7528\u6237\u4f53\u91cf\u5df2\u8fbe\u5230\u5343\u4e07\u7ea7\u522b\uff0c\u4e00\u65e6\u5ba2\u6237\u7aef\u51fa\u73b0\u4e0d\u53ef\u89c4\u907f\u7684\u5f02\u5e38\uff0c\u5c31\u6709\u53ef\u80fd\u51fa\u73b0\u4fb5\u8680\u670d\u52a1\u7aef\u7684\u60c5\u51b5\uff0c\u8fd9\u79cd\u65f6\u5019\u5982\u679c\u5728\u7f51\u5173\u5c42\u9762\u6ca1\u6709\u4e00\u5b9a\u7684\u6d41\u91cf\u63a7\u5236\u80fd\u529b\uff0c\u5bf9\u4e8e\u540e\u7aef\u6765\u8bf4\u5c06\u4f1a\u9020\u6210\u975e\u5e38\u4e25\u91cd\u7684\u96ea\u5d29\u3002\\n\\n\u56e0\u6b64\uff0c\u57fa\u4e8e\u4e0a\u8ff0\u8fed\u4ee3\u9057\u7559\u95ee\u9898\u548c\u67b6\u6784\u75db\u70b9\uff0c\u5728 2022 \u5e74\u6211\u4eec\u5f15\u5165\u4e86 APISIX \u6765\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002\u540c\u65f6\u501f\u52a9 APISIX\uff0c\u4e5f\u52a0\u5f3a\u4e86\u5728\u7f51\u5173\u5c42\u9762\u5bf9\u4e8e\u6d41\u91cf\u7684\u63a7\u5236\u80fd\u529b\u3002\\n\\n\u4f46\u662f\u5728\u8fc1\u79fb APISIX \u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u4f1a\u5b58\u5728\u4e00\u4e9b\u5df2\u77e5\u6311\u6218\u3002\u6bd4\u5982\uff1a\\n\\n* \u2f00\u5c42 NGINX \u57df\u540d\u591a\uff0c\u5b9a\u5236\u5316\u89c4\u5219\u590d\u6742\u3002\u76ee\u524d\u6211\u4eec\u7684\u4e1a\u52a1\u4e2d\u6709 700+ \u57df\u540d\uff0c\u540c\u65f6\u8fd8\u5b58\u5728\u975e\u5e38\u591a\u7684\u5b9a\u5236\u5316\u914d\u7f6e\uff0c\u6bd4\u5982\u91cd\u5b9a\u5411\u3001\u9ed1\u767d\u540d\u5355\u7b49\uff0c\u8fd9\u4e9b\u90fd\u9700\u8981\u9002\u914d APISIX \u7684\u63d2\u4ef6\u3002\\n* \u7531\u4e8e\u5386\u53f2\u9057\u7559\u95ee\u9898\uff0c\u2f00\u5c42 NGINX \u548c\u4e8c\u5c42 Ingress \u7f51\u5173\u8fd8\u662f\u2f00\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u5bf9\u4e8e\u540e\u7eed\u7684\u6d41\u91cf\u5207\u6362\u662f\u4e0d\u662f\u4f1a\u5f88\u590d\u6742\uff0c\u8fd9\u4e5f\u662f\u4e00\u4e2a\u5f85\u89e3\u51b3\u95ee\u9898\u3002\\n* \u5185\u90e8\u5b58\u5728\u7684\u53cc\u5c42 DNS \u67b6\u6784\u3002\u76ee\u524d DNS \u89e3\u6790\u4e3b\u8981\u7528\u4e8e\u5904\u7406\u516c\u7f51\u548c\u670d\u52a1\u5668\u5185\u90e8\u7684\u89e3\u6790\uff0c\u6240\u4ee5\u5bf9\u4e8e\u540e\u7eed\u7684\u65b9\u6848\u6211\u4eec\u66f4\u5e0c\u671b\u662f\u4e00\u4e2a\u80fd\u65b9\u4fbf\u56de\u6eda\u540c\u65f6\u53ef\u4ee5\u4f18\u5316\u5185\u7f51\u8c03\u7528\u6027\u80fd\u7684\u3002\\n\\n## \u8fc1\u79fb APISIX \u540e\u67b6\u6784\u8c03\u6574\\n\\n\u9762\u5bf9\u4e0a\u8ff0\u5df2\u77e5\u7684\u6311\u6218\uff0c\u5728\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u4e3b\u8981\u8fdb\u884c\u4e86\u4ee5\u4e0b\u4e09\u4e2a\u89d2\u5ea6\u7684\u64cd\u4f5c\u3002\u7531\u4e8e\u6574\u4e2a\u8fc1\u79fb\u8fc7\u7a0b\u6ca1\u6709\u6d89\u53ca\u5230\u7814\u53d1\u5185\u5bb9\uff0c\u6240\u4ee5\u5168\u90e8\u90fd\u662f\u7531\u8fd0\u7ef4\u4eba\u5458\u5b9e\u65bd\u7684\u3002\\n\\n\u5728\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c\u9996\u5148\u8981\u505a\u7684\u5c31\u662f APISIX \u8def\u7531\u7684\u751f\u6210\u3002\u57fa\u4e8e\u539f\u672c\u7684\u67b6\u6784\uff0c\u6211\u4eec\u53bb\u6389\u4e86\u4e00\u5c42\u7279\u6b8a\u529f\u80fd\uff0c\u6bd4\u5982 rewrite\u3001set-header \u7b49\u3002\u5f31\u5316\u4e00\u5c42\u7f51\u5173\u7684\u8f6c\u53d1\uff0c\u628a\u6240\u6709\u529f\u80fd\u90fd\u96c6\u4e2d\u5728\u4e8c\u5c42\u7684 Ingress \u4e0a\uff0c\u7136\u540e\u57fa\u4e8e Ingress \u53bb\u751f\u6210 APISIX \u7684\u8def\u7531\u3002\u540c\u65f6\u5728 NGINX \u914d\u7f6e\u7684\u57fa\u7840\u4e0a\u9002\u914d APISIX \u7684\u63d2\u4ef6\u3002\\n\\n\u8def\u7531\u751f\u6210\u540e\uff0c\u5c31\u9700\u8981\u53bb\u6821\u9a8c\u6574\u4e2a\u8f6c\u53d1\u8fc7\u7a0b\u662f\u5426\u6b63\u786e\u3002\u6211\u4eec\u57fa\u4e8e goreplay \u7684\u5f55\u5236\u56de\u653e\u6765\u9a8c\u8bc1\u8def\u7531\u8f6c\u53d1\u7684\u6b63\u786e\u6027\uff0c\u540c\u65f6\u901a\u8fc7\u81ea\u52a8\u5316\u811a\u672c\u6765\u9a8c\u8bc1\u63d2\u4ef6\u529f\u80fd\u662f\u5426\u6b63\u5e38\u3002\u5728\u529f\u80fd\u6821\u9a8c\u901a\u8fc7\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f1a\u7ee7\u7eed\u9a8c\u8bc1 APISIX \u5728\u6027\u80fd\u5c42\u9762\u662f\u5426\u6ee1\u8db3\u5185\u90e8\u9700\u6c42\u3002\u56e0\u6b64\uff0c\u5728\u6027\u80fd\u538b\u6d4b\u8fc7\u7a0b\u4e2d\u6211\u4eec\u81ea\u7814\u4e86 `elastic-apm` \u63d2\u4ef6\uff0c\u540c\u65f6\u9488\u5bf9\u90e8\u5206\u5f71\u54cd QPS \u7684\u63d2\u4ef6\u8fdb\u884c\u4e86\u6027\u80fd\u4f18\u5316\u3002\\n\\n\u5904\u7406\u5b8c\u529f\u80fd\u8ddf\u6027\u80fd\u76f8\u5173\u7684\u95ee\u9898\u540e\uff0c\u6700\u5927\u7684\u6311\u6218\u5c31\u662f\u6d41\u91cf\u5207\u6362\u4e86\uff0c\u56e0\u4e3a\u6d41\u91cf\u5207\u6362\u5c06\u76f4\u63a5\u5173\u4e4e\u751f\u4ea7\u8d28\u91cf\u3002\\n\\n![output.png](https://static.apiseven.com/2022/12/13/6397db0d5432c.png)\\n\\n\u867d\u7136\u524d\u8fb9\u6211\u4eec\u5df2\u7ecf\u4f7f\u7528\u4e86 goreplay \u8fdb\u884c\u6d41\u91cf\u5f55\u5236\u56de\u653e\uff0c\u4f46\u6211\u4eec\u4ecd\u7136\u9700\u8981\u4e00\u4e2a\u6bd4\u8f83\u53ef\u9760\u7684\u56de\u6eda\u65b9\u6848\u3002\u5047\u8bbe\u6d41\u91cf\u5207\u6362\u9020\u6210\u4e86\u5f02\u5e38\uff0c\u6bd4\u5982\u8f6c\u53d1\u5f02\u5e38\u6216\u8005\u662f APISIX \u51fa\u73b0\u5d29\u6e83\u65f6\uff0c\u80fd\u591f\u8fdb\u884c\u5feb\u901f\u56de\u6eda\u64cd\u4f5c\u3002\u57fa\u4e8e\u6b64\uff0c\u6211\u4eec\u9996\u5148\u5207\u6362\u4e86\u516c\u7f51\u6d41\u91cf\uff0c\u56e0\u4e3a\u516c\u7f51\u662f\u901a\u8fc7 WAF \u56de\u6e90\u5230 SLB \u6765\u8fdb\u884c\u6d41\u91cf\u5207\u6362\u7684\uff0c\u8fd9\u65f6\u5982\u679c\u6211\u4eec\u5207\u6362\u5230 APISIX\uff0c\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u53bb\u4fee\u6539\u56de\u6e90\u5730\u5740\u6765\u5c06\u6574\u4e2a\u6d41\u91cf\u8fdb\u884c\u56de\u6eda\uff0c\u5982\u4e0a\u56fe\u6807\u6ce8\u300c\u5207\u6362\u300d\u5b57\u6837\u6240\u793a\u3002\u8fd9\u4e2a\u5f02\u5e38\u60c5\u51b5\u4e0b\u7684\u6d41\u91cf\u5207\u6362\u8fc7\u7a0b\u57fa\u672c\u662f\u5728\u79d2\u7ea7\u522b\uff0c\u53ef\u80fd 10 \u79d2\u5185\u5c31\u628a\u6240\u6709\u6d41\u91cf\u90fd\u5207\u56de\u6765\u4e86\u3002\\n\\n\u5b8c\u6210\u4e86\u516c\u7f51\u6d41\u91cf\u5207\u6362\u7684\u60c5\u51b5\u4e0b\uff0c\u987a\u5229\u8fd0\u884c\u4e86\u51e0\u5929\uff0c\u6211\u4eec\u5c31\u901a\u8fc7 APISIX \u5c06\u5185\u7f51\u6d41\u91cf\u4e5f\u8fdb\u884c\u4e86\u53d8\u66f4\uff0c\u7136\u540e\u6574\u4e2a\u751f\u4ea7\u4e0a\u7684\u5207\u6362\u5c31\u5168\u90e8\u5b8c\u6210\u4e86\u3002\u4f46\u662f\u8fd9\u4e2a\u4e0a\u7ebf\u8fc7\u7a0b\u4e2d\uff0c\u5176\u5b9e\u6211\u4eec\u8fd8\u662f\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\u7684\u3002\\n\\n## \u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u7684\u95ee\u9898\u4e0e\u89e3\u51b3\u65b9\u6848\\n\\n### Prometheus \u63d2\u4ef6\u8f6c\u53d1\u5ef6\u8fdf\\n\\n\u8fd9\u4e2a\u662f\u5728\u6211\u4eec\u5185\u7f51\u6d4b\u8bd5\u73af\u5883\u4e2d\u53d1\u73b0\u7684\u4e00\u4e2a\u95ee\u9898\u3002\u7531\u4e8e\u6211\u4eec\u7684\u5185\u7f51\u662f all-in-one \u7684\u6d4b\u8bd5\u73af\u5883\uff0c\u6240\u6709\u90e8\u95e8\u90fd\u4f7f\u7528\u540c\u4e00\u4e2a APISIX \u7684\u5165\u53e3\uff0c\u6240\u4ee5\u8def\u7531\u89c4\u5219\u975e\u5e38\u591a\uff0c\u8fbe\u5230 4000+\u3002\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u6bcf\u6b21\u62c9\u53d6 `Prometheus` \u63d2\u4ef6\u65f6\uff0c metrics \u2f24\u5c0f\u8fbe\u5230 80M+\uff0c\u9020\u6210\u5355\u4e2a worker \u8fdb\u7a0b\u8dd1\u6ee1\uff0c\u4ece\u800c\u9020\u6210 worker \u7684\u8f6c\u53d1\u5ef6\u8fdf\u3002\\n\\n![output (1).png](https://static.apiseven.com/2022/12/13/6397db06cae1c.png)\\n\\n\u8fd9\u4e2a\u95ee\u9898\u662f\u76ee\u524d APISIX \u5f00\u6e90\u7248\u672c\u5b58\u5728\u7684\u4e00\u4e2a\u73b0\u8c61\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u4e1a\u52a1\u6d41\u91cf\u548c\u5185\u90e8 API \u6d41\u91cf\uff08\u6bd4\u5982Prometheus  metrics \u548c Admin API\uff09\u90fd\u5171\u7528 worker \u9020\u6210\u7684\u3002\u6211\u4eec\u5728\u4e4b\u524d\u662f\u9488\u5bf9 Prometheus \u63d2\u4ef6\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u5176\u4e2d\u5ef6\u8fdf\u76f8\u5173\u7684 metrics \u5360\u7528\u4e86 90%\u4ee5\u4e0a\uff08\u5982\u4e0a\u56fe\u6240\u793a\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u8fd9\u90e8\u5206\u91c7\u96c6\u53bb\u6389\u4e86\u3002\u53bb\u6389\u8fd9\u90e8\u5206\u540e\uff0c\u4e1a\u52a1\u5c42\u9762\u8fd8\u662f\u6ee1\u8db3\u4e86\u6211\u4eec\u7684\u76d1\u63a7\u4f7f\u7528\u9700\u6c42\uff0c\u5e76\u672a\u9020\u6210\u5f71\u54cd\u3002\\n\\n\u4e0d\u8fc7\u6700\u8fd1\u6211\u4eec\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\u53c8\u6709\u4e86\u65b0\u7684\u65b9\u6848\uff0c\u76ee\u524d\u8fd8\u5904\u4e8e demo \u9636\u6bb5\u3002\u8fd9\u5957\u65b0\u65b9\u6848\u662f\u5bf9 NGINX \u6e90\u7801\u8fdb\u884c\u4fee\u6539\uff0c\u901a\u8fc7\u591a\u542f\u52a8\u2f00\u4e2a\u6216\u591a\u4e2a worker \u8fdb\u7a0b\uff08isolation process) \u6765\u4e13\u2ed4\u76d1\u542c\u7279\u5b9a\u7aef\u53e3\u7684\u8bf7\u6c42\uff08\u6bd4\u5982 Prometheus\u3001Admin API\u3001Control API \u7b49\uff09\uff0c\u4e0d\u76d1\u542c\u5904\u7406\u6b63\u5e38\u4e1a\u52a1\u7aef\u53e3\u8bf7\u6c42\u3002\u5176\u5b83\u7684 worker \u8fdb\u7a0b\u5219\u53d6\u6d88\u76d1\u542c\u4e0a\u8ff0\u7aef\u53e3\uff0c\u53ea\u5904\u7406\u6b63\u5e38\u4e1a\u52a1\u7aef\u53e3\u8bf7\u6c42\uff0c\u6765\u786e\u4fdd APISIX \u5185\u90e8\u8bf7\u6c42\u548c\u6b63\u5e38\u4e1a\u52a1\u8bf7\u6c42\u95f4\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\u3002\\n\\n![output (2).png](https://static.apiseven.com/2022/12/13/6397db081a569.png)\\n\\n### \u9ed8\u8ba4\u8def\u7531\u5339\u914d\u5f02\u5e38\\n\\n![output (3).png](https://static.apiseven.com/2022/12/13/6397db09048b1.png)\\n\\n\u5728\u4e0a\u7ebf APISIX \u540e\uff0c\u6211\u4eec\u53d1\u73b0\u57df\u540d\u5e76\u6ca1\u6709\u8d70\u7cbe\u786e\u5339\u914d\u6a21\u5f0f\uff0c\u800c\u662f\u91c7\u7528\u4e86\u901a\u914d\u7b26\u5339\u914d\uff0c\u8fd9\u8ddf NGINX \u7684\u57df\u540d\u6700\u957f\u5339\u914d\u662f\u4e0d\u4e00\u81f4\u7684\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u901a\u8fc7\u66f4\u6362\u8def\u7531\u7b56\u7565\uff0c\u5c06 URL \u65b9\u5f0f\u6539\u6210\u4e86 host+URL \u7684\u65b9\u5f0f\uff0c\u89e3\u51b3\u4e86\u8be5\u95ee\u9898\u3002\\n\\n\u4f46\u5173\u4e8e APISIX \u57fa\u4e8e URL \u8def\u7531\u7b56\u7565\u4f5c\u4e3a\u9ed8\u8ba4\u8def\u7531\u7684\u95ee\u9898\uff0c\u5927\u5bb6\u53ef\u4ee5\u5728\u81ea\u5df1\u7684\u751f\u4ea7\u73af\u5883\u4e2d\u8fdb\u884c\u538b\u6d4b\u540e\u518d\u51b3\u5b9a\u662f\u5426\u4fdd\u7559\u3002\\n\\n\u5047\u5982\u4f60\u7684\u751f\u4ea7\u573a\u666f\u4e2d\u5c5e\u4e8e URL \u7279\u522b\u591a\u3001\u57df\u540d\u7279\u522b\u5c11\u7684\u7c7b\u578b\uff0c\u90a3 APISIX \u8fd9\u79cd\u9ed8\u8ba4\u8def\u7531\u7b56\u7565\u662f\u5b8c\u5168 OK \u7684\u3002\u4f46\u5728\u6211\u4eec\u7684\u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u5e76\u6ca1\u6709\u8fd9\u4e48\u591a URL\uff0c\u6240\u4ee5\u91c7\u7528 host+URL \u7684\u65b9\u5f0f\u662f\u66f4\u6ee1\u8db3\u6211\u4eec\u7684\u6027\u80fd\u9700\u6c42\u3002\\n\\n### \u9ed8\u8ba4\u81ea\u52a8\u7ed1\u6838\u95ee\u9898\\n\\n\u5728\u4e91\u539f\u751f\u7684\u80cc\u666f\u4e0b\uff0c\u5927\u90e8\u5206\u7528\u6237\u90fd\u4f1a\u9009\u62e9\u5c06 APISIX \u90e8\u7f72\u5728\u5bb9\u5668\u4e2d\u4f7f\u7528\u3002\u4f46 APISIX \u5728\u9ed8\u8ba4\u914d\u7f6e\u4e0b\u4f1a\u8fdb\u884c\u81ea\u52a8\u7ed1\u6838\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u5728\u5bb9\u5668\u5316\u573a\u666f\u4e0b\uff0c\u53ef\u80fd\u53ea\u4f1a\u7528\u5230\u524d\u51e0\u4e2a\u6838\u5fc3\uff0c\u9020\u6210\u524d\u51e0\u4e2a\u6838\u5fc3\u8dd1\u6ee1\u800c\u540e\u51e0\u4e2a\u6838\u5fc3\u4ecd\u5904\u4e8e\u7a7a\u95f2\u7684\u72b6\u6001\u3002\u867d\u7136 CPU \u4f7f\u7528\u7387\u4e0d\u9ad8\uff0c\u4f46\u662f\u4f1a\u4f7f APISIX \u8f6c\u53d1\u51fa\u73b0\u5ef6\u8fdf\u3002\\n\\n![output (5).png](https://static.apiseven.com/2022/12/13/6397db0b771b9.png)\\n\\n\u4e0d\u8fc7 APISIX \u793e\u533a\u6700\u8fd1\u5df2\u7ecf\u5f00\u59cb\u8c03\u6574\u8fd9\u4e2a\u914d\u7f6e\uff0c\u5c06 `worker_cpu_affinity` \u914d\u7f6e\u7684\u9ed8\u8ba4\u503c\u4ece `true` \u6539\u4e3a\u4e86 `false`\u3002\u56e0\u6b64\u8fd9\u4e2a\u95ee\u9898\u76ee\u524d\u5728 APISIX \u7248\u672c\u4e2d\u5df2\u7ecf\u89e3\u51b3\u4e86\u3002\\n\\n### \u7248\u672c\u5347\u7ea7\u517c\u5bb9\u95ee\u9898\\n\\n\u5728\u4e0a\u7ebf APISIX \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u8fd8\u53d1\u73b0\u5728\u8f83\u8001\u7684\u7cfb\u7edf\u6216 OpenSSL \u5e93\u4e2d\uff0c\u5b83\u7684 ssl_ciphers \u548c\u670d\u52a1\u7aef\u9ed8\u8ba4\u503c\u65e0\u4ea4\u96c6\uff0c\u4ece\u800c\u9020\u6210 SSL \u63e1\u624b\u5931\u8d25\u3002\\n\\n\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5efa\u8bae\u5927\u5bb6\u5728\u4e0a\u7ebf APISIX \u4e4b\u524d\uff0c\u5148\u901a\u8fc7\u4e00\u4e9b SSL \u5de5\u5177\u5148\u53bb\u63a2\u6d4b\u4e00\u4e0b\u5f53\u524d\u65e7\u7f51\u5173\u4e0e APISIX \u7f51\u5173\u7684 SSL \u63e1\u624b\u4ea4\u96c6\u662f\u5426\u6b63\u786e\u6216\u6ee1\u8db3\u4f7f\u7528\u573a\u666f\uff0c\u7136\u540e\u518d\u8fdb\u884c\u89c4\u6a21\u5316\u7684\u8fc1\u79fb\u8c03\u6574\u3002\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u5728 APISIX \u53d1\u5e03 2.15 LTS \u7248\u672c\u540e\uff0c\u6211\u4eec\u5c31\u5728\u5185\u7f51\u8fdb\u884c\u4e86\u5347\u7ea7\uff0c\u4f46\u662f\u5347\u7ea7\u540e\u5c31\u53d1\u73b0\u4e86\u4e00\u4e9b\u8def\u7531\u5339\u914d\u76f8\u5173\u7684\u95ee\u9898\u3002\\n\\n\u56e0\u4e3a\u4ece\u65e7\u7248\u672c\u5347\u7ea7\u5230\u65b0\u7248\u672c\u65f6\uff0c\u5b58\u5728\u4e00\u4e9b\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u5bfc\u81f4 redirect \u63d2\u4ef6\u53c2\u6570 `http_to_https` \u4e3a`true` \u65f6\uff0c\u53c2\u6570 `http_to_https` \u548c `append_query_string` \u6821\u9a8c\u5931\u8d25\uff0c\u8fdb\u800c\u8def\u7531\u52a0\u8f7d\u5931\u8d25\uff0c\u5bfc\u81f4\u8def\u7531\u4e22\u5931\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u4f1a\u5728\u8def\u7531\u5339\u914d\u65f6\u51fa\u73b0 404 \u6216\u8005\u8f6c\u53d1\u5230\u5176\u4ed6\u4e0a\u6e38\u7684\u60c5\u51b5\u3002\\n\\n\u76ee\u524d\u8fd9\u4e2a\u95ee\u9898\u5df2\u7ecf\u5728 APISIX \u7684 master \u5206\u652f\u4e2d\u89e3\u51b3\u4e86\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u9488\u5bf9 2.15 \u7248\u672c\u8fdb\u884c\u5355\u72ec\u89e3\u51b3\uff0c\u6240\u4ee5\u5927\u5bb6\u5728\u4f7f\u7528\u8be5\u7248\u672c\u65f6\u4e5f\u9700\u8981\u7559\u610f\u8fd9\u90e8\u5206\u95ee\u9898\u3002\\n\\n## \u5e94\u7528 APISIX \u7684\u6536\u76ca\u53ca\u5c55\u671b\\n\\n\u867d\u7136\u524d\u8fb9\u63d0\u5230\u4e86\u4e00\u4e9b\u6211\u4eec\u5728\u4e0a\u7ebf APISIX \u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u95ee\u9898\uff0c\u4f46\u662f\u5728\u5e94\u7528 APISIX \u4e4b\u540e\uff0c\u7ed9\u516c\u53f8\u4e1a\u52a1\u5c42\u9762\u8fd8\u662f\u5e26\u6765\u4e86\u5f88\u591a\u4ef7\u503c\u7684\u3002\u6bd4\u5982\uff1a\\n\\n* **\u8fd0\u7ef4\u6548\u7387\u63d0\u5347\u3002** \u4f7f\u7528 APISIX \u540e\uff0c\u518d\u4e5f\u4e0d\u5b58\u5728 reload \u76f8\u5173\u7684\u70e6\u607c\uff0c\u53ef\u4ee5\u505a\u5230\u968f\u65f6\u66f4\u65b0\u8def\u7531\u548c\u8bc1\u4e66\u7b49\uff0c\u7ed9\u5f00\u53d1\u4eba\u5458\u5e26\u6765\u4e86\u64cd\u4f5c\u4e0a\u7684\u4fbf\u5229\u3002\\n* **\u6d41\u91cf\u63a7\u5236\u80fd\u529b\u63d0\u5347\u3002** \u4f7f\u7528 APISIX \u540e\uff0c\u6211\u4eec\u5728\u7194\u65ad\u548c\u9650\u6d41\u65b9\u9762\u90fd\u5f97\u5230\u4e86\u63d0\u5347\uff0c\u4ece\u800c\u52a0\u5f3a\u4e86\u5728\u6d41\u91cf\u7ba1\u63a7\u5c42\u9762\u7684\u80fd\u529b\uff0c\u8fdb\u4e00\u6b65\u7a33\u56fa\u4e86\u6574\u4e2a\u4e1a\u52a1\u6838\u5fc3\u6d41\u7a0b\u3002\\n* **\u81ea\u7814\u63d2\u4ef6\uff0c\u589e\u5f3a\u7f51\u5173\u80fd\u529b\u3002** \u5f97\u76ca\u4e8e APISIX \u7684\u5f3a\u62d3\u5c55\u6027\u548c\u81ea\u8eab\u63d2\u4ef6\u6027\u80fd\u7684\u4f18\u5f02\uff0c\u6211\u4eec\u4e5f\u4f1a\u66f4\u4e3b\u52a8\u5730\u53bb\u5f00\u53d1\u4e00\u4e9b\u63d2\u4ef6\u3002\u6bd4\u5982\u6211\u4eec\u5728 APISIX \u4e0a\u96c6\u6210\u4e86\u7edf\u4e00\u9274\u6743\u7684\u80fd\u529b\uff0c\u65b0\u4e1a\u52a1\u65e0\u9700\u5355\u72ec\u5bf9\u63a5\u9274\u6743\u7cfb\u7edf\uff0c\u52a0\u5feb\u4e86\u4ea7\u54c1\u8fed\u4ee3\u6d41\u7a0b\u3002\\n\\n  ![output (6).png](https://static.apiseven.com/2022/12/13/6397db0c5b17b.png)\\n\\n* **\u53bb\u6389\u4e86\u5197\u4f59\u7684\u4e00\u5c42 NGINX\uff0c\u5b9e\u73b0\u964d\u672c\u589e\u6548\u3002** \u4e4b\u524d\u7684\u53cc\u5c42\u7f51\u5173\u67b6\u6784\u4e2d\uff0c\u4e00\u5c42\u7684 NGINX \u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u5e76\u4e0d\u900f\u660e\u3002\u73b0\u5728\u5c06\u53cc\u5c42\u7f51\u5173\u5408\u5e76\u4e3a\u4e00\u5c42\u540e\uff0c\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u5f88\u6e05\u6670\u5730\u770b\u5230\u67b6\u6784\u4e2d\u4e00\u4e9b\u5173\u4e8e\u8def\u7531\u6216\u63d2\u4ef6\u7b49\u914d\u7f6e\uff0c\u5bf9\u4e8e\u6392\u67e5\u95ee\u9898\u6765\u8bf4\u66f4\u52a0\u65b9\u4fbf\u5feb\u6377\u3002\\n\u5728\u540e\u7eed\u4f7f\u7528 APISIX \u7684\u89c4\u5212\u4e2d\uff0c\u6211\u4eec\u8fd8\u662f\u4f1a\u7ee7\u7eed\u5728\u7f51\u5173\u5c42\u9762\u8fdb\u884c\u589e\u5f3a\u3002\u6bd4\u5982\u5f00\u53d1\u9488\u5bf9\u5185\u90e8\u4e1a\u52a1\u7684\u81ea\u7814\u63d2\u4ef6\uff0c\u63d0\u4f9b\u591a\u79df\u6237\u7684\u80fd\u529b\uff0c\u6216\u8005\u662f\u5c06 API \u7ba1\u7406\u7684\u529f\u80fd\u5e26\u5230\u7f51\u5173\u5c42\u9762\u7b49\u7b49\u3002\\n\\n\u5f53\u7136\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u5728\u79ef\u6781\u56de\u9988\u793e\u533a\u3002\u76ee\u524d\u5df2\u5728\u793e\u533a\u4e2d\u8d21\u732e\u4e86 8 \u4e2a PR\uff0c\u5e2e\u5fd9\u5b8c\u5584\u548c\u4fee\u590d\u4e86\u4e00\u4e9b\u751f\u6001\u63d2\u4ef6\u76f8\u5173\u7684\u95ee\u9898\u3002\u6bd4\u5982\u5b8c\u5584 `batch_request` \u652f\u6301\u81ea\u5b9a\u4e49 uri\u3001\u4e3a `hmac-auth` \u63d2\u4ef6\u63d0\u4f9b\u8bf7\u6c42 body \u6821\u9a8c\u7b49\u529f\u80fd\u3002\\n\\n\u5e0c\u671b\u5728\u540e\u7eed\u7684\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u66f4\u5168\u9762\u5730\u4f7f\u7528\u548c\u53d1\u6325 APISIX \u7684\u7279\u6027\uff0c\u66f4\u52a0\u79ef\u6781\u5730\u63a2\u7d22 APISIX \u7684\u4f7f\u7528\u573a\u666f\u3002\u671f\u5f85\u672a\u6765\u6709\u66f4\u591a\u7684\u5171\u5efa\u529f\u80fd\u4e0a\u7ebf\u3002"},{"id":"\u667a\u6167\u4ea4\u901a\u7cfb\u7edf\u7f51\u65b0\u7535\u6c14\uff0c\u5982\u4f55\u57fa\u4e8e APISIX \u8fed\u4ee3\u6570\u5b57\u667a\u8054\u5e73\u53f0","metadata":{"permalink":"/zh/blog/2022/12/09/insigma-with-apache-apisix","source":"@site/blog/2022/12/09/insigma-with-apache-apisix.md","title":"\u667a\u6167\u4ea4\u901a\u7cfb\u7edf\u7f51\u65b0\u7535\u6c14\uff0c\u5982\u4f55\u57fa\u4e8e APISIX \u8fed\u4ee3\u6570\u5b57\u667a\u8054\u5e73\u53f0","description":"\u5728\u57ce\u5e02\u667a\u80fd\u4ea4\u901a\u7684\u8986\u76d6\u8303\u56f4\u4e0b\uff0c\u5f88\u591a\u573a\u666f\u5bf9\u4e8e\u6d41\u91cf\u5904\u7406\u548c\u7cfb\u7edf\u7a33\u5b9a\u6027\u90fd\u8981\u6c42\u6781\u9ad8\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u79cd\u57ce\u5e02\u7ea7\u522b\u7684\u6570\u5b57\u667a\u80fd\u8981\u6c42\uff0c\u7f51\u65b0\u7535\u6c14\u57fa\u4e8e APISIX \u8fdb\u884c\u4e86\u7f51\u5173\u5c42\u9762\u7684\u8fed\u4ee3\u3002","date":"2022-12-09T00:00:00.000Z","formattedDate":"2022\u5e7412\u67089\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":19.57,"truncated":true,"authors":[{"name":"\u6c88\u5dcd"}],"prevItem":{"title":"\u805a\u7126\u4eba\u673a\u4ea4\u4e92\u667a\u80fd\u5e94\u7528\u9886\u57df\uff0cAPISIX \u5728\u5e0c\u6c83\u7f51\u5173\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5","permalink":"/zh/blog/2022/12/13/seewo-with-apache-apisix"},"nextItem":{"title":"Apache APISIX \u73a9\u8f6c Tongsuo \u56fd\u5bc6\u63d2\u4ef6","permalink":"/zh/blog/2022/12/08/apisix-support-tongsuo"}},"content":"> \u5728\u57ce\u5e02\u667a\u80fd\u4ea4\u901a\u7684\u8986\u76d6\u8303\u56f4\u4e0b\uff0c\u5f88\u591a\u573a\u666f\u5bf9\u4e8e\u6d41\u91cf\u5904\u7406\u548c\u7cfb\u7edf\u7a33\u5b9a\u6027\u90fd\u8981\u6c42\u6781\u9ad8\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u79cd\u57ce\u5e02\u7ea7\u522b\u7684\u6570\u5b57\u667a\u80fd\u8981\u6c42\uff0c\u7f51\u65b0\u7535\u6c14\u57fa\u4e8e APISIX \u8fdb\u884c\u4e86\u7f51\u5173\u5c42\u9762\u7684\u8fed\u4ee3\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u5206\u4eab\u5609\u5bbe\u6c88\u5dcd\uff0c\u6d59\u5927\u7f51\u65b0\u7814\u53d1\u603b\u76d1\u3002\\n\\n\u7f51\u65b0\u7535\u6c14\u6210\u7acb\u4e8e 2011 \u5e74\uff0c\u5c5e\u4e8e\u6d59\u5927\u7f51\u65b0\u65d7\u4e0b\uff0c\u4e3a\u7eff\u8272\u667a\u6167\u4ea4\u901a\u7cfb\u7edf\u89e3\u51b3\u65b9\u6848\u7684\u63d0\u4f9b\u5546\u3002\u4e1a\u52a1\u8303\u56f4\u5305\u62ec\u94c1\u8def\u3001\u96a7\u9053\u3001\u57ce\u5e02\u667a\u80fd\u4ea4\u901a\u3001\u822a\u7a7a\u3001\u9ad8\u901f\u516c\u8def\u7b49\u884c\u4e1a\u3002\u6574\u4e2a\u9ad8\u94c1\u4fe1\u606f\u5316\u7684\u4e1a\u52a1\u5206\u5e03\u5360\u5230\u4e86\u5168\u56fd\u5e02\u573a\u7684 20% \u4ee5\u4e0a\uff0c\u6bd4\u5982\u53c2\u4e0e\u5efa\u8bbe\u4e86\u676d\u9ec4\u94c1\u8def\u3001\u5408\u80a5\u5357\u7ad9\u7b49\u5ba2\u670d\u4fe1\u606f\u5316\u7cfb\u7edf\uff1b\u676d\u5dde\u6587\u4e00\u8def\u96a7\u9053\u3001\u676d\u5dde\u7d2b\u4e4b\u96a7\u9053\u7b49\u76d1\u63a7\u7cfb\u7edf\uff1b\u9996\u90fd\u673a\u573a\u7269\u8054\u7f51\u5e73\u53f0\u3001\u6570\u636e\u4ea4\u6362\u5e73\u53f0\u7b49\u7cfb\u7edf\u3002\\n\\n\u5728\u57ce\u5e02\u667a\u80fd\u4ea4\u901a\u7684\u8986\u76d6\u8303\u56f4\u4e0b\uff0c\u5f88\u591a\u573a\u666f\u5bf9\u4e8e\u6d41\u91cf\u5904\u7406\u548c\u7cfb\u7edf\u7a33\u5b9a\u6027\u90fd\u8981\u6c42\u6781\u9ad8\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u79cd\u57ce\u5e02\u7ea7\u522b\u7684\u6570\u5b57\u667a\u80fd\u8981\u6c42\uff0c\u5bf9\u4e8e\u57fa\u7840\u67b6\u6784\u7684\u7ec4\u4ef6\u9009\u62e9\u4e5f\u662f\u91cd\u4e2d\u4e4b\u91cd\u3002\u672c\u6587\u5c06\u4ece\u6570\u5b57\u5316\u5e73\u53f0\u5e94\u7528\u7684\u89d2\u5ea6\uff0c\u5e26\u6765\u4e0e API \u7f51\u5173 Apache APISIX \u7684\u76f8\u9047\u76f8\u719f\u548c\u5e94\u7528\uff0c\u5e0c\u671b\u5bf9\u4ecd\u5728\u7f51\u5173\u9009\u578b\u8fc7\u7a0b\u4e2d\u7684\u4f01\u4e1a\u6216\u7528\u6237\u6709\u6240\u5e2e\u52a9\u3002\\n\\n## \u6570\u5b57\u5927\u6865\u667a\u8054\u5e73\u53f0\u5e94\u7528\u573a\u666f\\n\\n![\u7f51\u65b0\u6570\u5b57\u5927\u6865\u667a\u8054\u5e73\u53f0](https://static.apiseven.com/2022/12/09/639293149c4bc.png)\\n\\n\u5728\u6570\u5b57\u9886\u57df\u7684\u4e1a\u52a1\u5b9e\u8df5\u4e2d\uff0c\u6211\u4eec\u6253\u9020\u4e86\u7f51\u65b0\u6570\u5b57\u5927\u6865\u667a\u8054\u5e73\u53f0\u3002\u6570\u5b57\u5927\u6865\u667a\u8054\u5e73\u53f0\u662f\u4e00\u4e2a\u975e\u5e38\u5e9e\u5927\u7684\u4ea4\u901a\u9886\u57df\u7ba1\u63a7\u7cfb\u7edf\uff0c\u6db5\u76d6\u4e86\u6574\u4e2a\u4ea4\u901a\u9886\u57df\u6bd4\u5982\u7ed3\u6784\u5316\u5b89\u5168\u3001\u75c5\u5bb3\u68c0\u6d4b\u3001\u65e5\u5e38\u7ef4\u517b\u5de1\u68c0\u3001\u6570\u5b57\u5b6a\u751f\u4e0e\u5efa\u6a21\u3001\u4ea4\u901a\u5e94\u6025\u6307\u6325\u4ee5\u53ca\u5404\u7c7b\u8bc4\u4f30\u7b97\u6cd5\u7b49\u7b49\u3002\\n\\n\u4e0b\u56fe\u4e3a\u7f51\u65b0\u6570\u5b57\u5927\u6865\u667a\u8054\u5e73\u539f\u672c\u7684\u67b6\u6784\u6a21\u5f0f\uff0c\u6574\u4e2a\u7cfb\u7edf\u4e3b\u8981\u5206\u4e3a\u56db\u4e2a\u90e8\u5206\u3002\\n\\n![\u67b6\u6784\u6a21\u5f0f](https://static.apiseven.com/2022/12/09/63929314aa6c5.png)\\n\\n\u6700\u5e95\u5c42\u5c5e\u4e8e\u91c7\u96c6\u5c42\uff0c\u4e3b\u8981\u8d1f\u8d23\u91c7\u96c6\u5404\u7c7b\u6570\u636e\u3002\u76ee\u524d\u91c7\u96c6\u6570\u636e\u7684\u79cd\u7c7b\u6bd4\u8f83\u591a\uff0c\u6bd4\u5982\u6e29\u5ea6\u4f20\u611f\u5668\u4f1a\u91c7\u96c6\u5230\u8def\u9762\u7684\u4e00\u4e9b\u6e29\u5ea6\uff1b\u7ed3\u6784\u5c42\u9762\u7684\u529b\u5b66\u4f20\u611f\u5668\u4f1a\u68c0\u6d4b\u9707\u52a8\u6570\u636e\uff1bGPS \u4f20\u611f\u5668\u5219\u4f1a\u91c7\u96c6\u4f4d\u79fb\u60c5\u51b5\uff1b\u65e0\u4eba\u673a\u76d1\u6d4b\u8def\u9762\u72b6\u6001\u7b49\u7b49\uff0c\u6240\u4ee5\u6574\u4f53\u76d1\u6d4b\u7c7b\u578b\u7684\u6570\u636e\u91cf\u4e5f\u662f\u975e\u5e38\u5927\u7684\u3002\\n\\n\u5728\u6b64\u4e4b\u4e0a\uff0c\u5728\u4e2d\u95f4\u5c42\u6211\u4eec\u8fd8\u6784\u5efa\u4e86\u4e00\u4e2a\u6570\u636e\u4e2d\u67a2\uff0c\u5b83\u53ef\u4ee5\u628a\u6240\u6709\u7684\u4e1a\u52a1\u6570\u636e\u90fd\u6c47\u603b\u5230\u4e00\u8d77\uff0c\u7136\u540e\u518d\u63d0\u4f9b\u4e1a\u52a1\u7684 API \u7ed9\u5404\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u4f7f\u7528\u3002\u8fd9\u4e2a\u9879\u76ee\u6700\u5927\u7684\u4e00\u4e2a\u7279\u70b9\uff0c\u5c31\u662f\u53c2\u4e0e\u7684\u516c\u53f8\u5f88\u591a\uff08\u5927\u6982 30+\uff09\uff0c\u8fd9\u4e9b\u516c\u53f8\u90fd\u4f1a\u53c2\u4e0e\u8fdb\u6765\u8fdb\u884c\u5404\u81ea\u7684\u4e1a\u52a1\u7cfb\u7edf\u642d\u5efa\u3002\\n\\n\u5728\u4e1a\u52a1\u5c42\u4e2d\uff0c\u9700\u8981\u5728\u540c\u4e00\u5957\u7528\u6237\u4f53\u7cfb\u4e0b\u8bbf\u95ee\u4e1a\u52a1\u7cfb\u7edf\uff0c\u4e3b\u8981\u662f\u7ed9\u4e1a\u52a1\u7528\u6237\u4f7f\u7528\u3002\u5728\u5b9e\u9645\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u540c\u4e1a\u52a1\u7cfb\u7edf\u4e4b\u95f4\u5f80\u5f80\u5b58\u5728\u4ea4\u53c9\u8bbf\u95ee\u3002\u968f\u7740\u4e1a\u52a1\u7cfb\u7edf\u7684\u589e\u591a\uff0c\u6574\u4e2a\u670d\u52a1\u5bf9\u5916\u63d0\u4f9b\u7684 IP \u548c\u7aef\u53e3\u4e5f\u4f1a\u589e\u591a\uff0c\u4e00\u4e9b\u95ee\u9898\u5f00\u59cb\u5e94\u8fd0\u800c\u751f\u3002\\n\\n### \u75db\u70b9\u4e0e\u73b0\u72b6\\n\\n\u968f\u7740\u5b9e\u8df5\u7684\u589e\u591a\uff0c\u6211\u4eec\u53d1\u73b0\u4e0a\u8ff0\u67b6\u6784\u5f00\u59cb\u5448\u73b0\u5982\u4e0b\u95ee\u9898\uff1a\\n\\n1. \u4e0d\u540c\u7cfb\u7edf\u4e4b\u95f4 API \u9274\u6743\u5404\u5f02\uff0c\u5927\u91cf\u91cd\u590d\u5f00\u53d1\uff1b\\n2. \u4e0d\u540c\u7cfb\u7edf\u5bf9 API \u7684\u5b89\u5168\u7ba1\u7406\u7a0b\u5ea6\u4e0d\u540c\uff1b\\n3. \u7f3a\u5c11\u7edf\u4e00\u7684 API \u8def\u7531\uff1b\\n4. \u7f3a\u5c11\u7edf\u4e00 API \u76d1\u63a7\u7b49\u3002\\n\\n\u57fa\u4e8e\u4e0a\u8ff0\u9700\u6c42\u75db\u70b9\uff0c\u5f15\u7533\u51fa\u4e86\u4e00\u4e2a\u7ed3\u8bba\u65b9\u5411\uff1a\u5373\u6211\u4eec\u9700\u8981\u6784\u5efa\u4e00\u4e2a API \u7f51\u5173\u3002API \u7f51\u5173\u5bf9\u4e8e\u6211\u4eec\u73b0\u9636\u6bb5\u7684\u7cfb\u7edf\u800c\u8a00\uff0c\u662f\u4e00\u4e2a\u521a\u9700\u7684\u7ec4\u4ef6\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u5f00\u59cb\u8003\u8651\u5982\u679c\u5f15\u5165 API \u7f51\u5173\u540e\u4f1a\u6709\u4ec0\u4e48\u4f18\u70b9\u3002\\n\\n![\u5f15\u5165 API \u7f51\u5173\u540e](https://static.apiseven.com/2022/12/09/63929315c57c8.png)\\n\\n\u6bd4\u5982\u4e4b\u524d\u6574\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u4f1a\u66b4\u9732\u5927\u91cf\u7684\u670d\u52a1\u7aef\u53e3\uff0c\u56e0\u4e3a\u7cfb\u7edf\u5f88\u591a\u90fd\u9700\u8981\u66b4\u9732\u5230\u5916\u90e8\u53bb\u4f7f\u7528\u3002\u5f15\u5165 API \u7f51\u5173\u540e\uff0c\u6216\u8bb8\u6574\u4e2a\u7cfb\u7edf\u53ef\u4ee5\u53ea\u66b4\u9732\u4e00\u4e2a 443 \u7aef\u53e3\uff0c\u5176\u4ed6\u5168\u90e8\u5728\u5185\u7f51\u8bbf\u95ee\u5373\u53ef\uff0c\u8fd9\u6837\u6574\u4e2a\u7cfb\u7edf\u7684\u5b89\u5168\u6027\u5c31\u66f4\u9ad8\u3002\\n\\n\u5176\u6b21 API \u9274\u6743\u5982\u679c\u90fd\u653e\u5230 API \u7f51\u5173\u6765\u505a\u7684\u8bdd\uff0c\u90a3\u6574\u4e2a\u529f\u80fd\u7684\u5b9e\u73b0\u5c31\u975e\u5e38\u7b80\u5355\u4e86\uff0c\u540c\u65f6\u8fd8\u964d\u4f4e\u4e86\u5404\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u4e4b\u95f4\u4e92\u76f8\u8c03\u7528\u7684\u5f00\u53d1\u5de5\u4f5c\u91cf\uff0c\u907f\u514d\u91cd\u590d\u5f00\u53d1\u3002\u540c\u7406\u5bf9\u4e8e API \u7684\u8def\u7531\u548c\u76d1\u63a7\u4e5f\u4e00\u6837\uff0c\u90fd\u53ef\u4ee5\u8ba9\u6574\u4f53\u4e1a\u52a1\u66f4\u597d\u5730\u7ba1\u7406\u3002\\n\\n\u6700\u540e\u5c31\u662f\u5185\u7f51\u5982\u679c\u8d70 HTTP \u7684\u8bdd\uff0c\u6027\u80fd\u5176\u5b9e\u4f1a\u66f4\u597d\u3002\u56e0\u4e3a\u4e4b\u524d\u67b6\u6784\u4e2d\uff0c\u5404\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u4e4b\u95f4\u7684\u4e92\u76f8\u8c03\u7528\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5b89\u5168\u6027\u6240\u4ee5\u9009\u62e9\u4e86 HTTPS \u6a21\u5f0f\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5f71\u54cd\u4e86\u6574\u4f53\u6027\u80fd\u3002\\n\u6240\u4ee5\u603b\u4f53\u6765\u770b\uff0c\u52a0\u5165 API \u7f51\u5173\u8fd9\u4e2a\u7ec4\u4ef6\uff0c\u5bf9\u4e8e\u6211\u4eec\u6574\u4f53\u4e1a\u52a1\u7684\u63d0\u5347\u662f\u6bd4\u8f83\u660e\u663e\u7684\u3002\\n\\n## \u7f51\u5173\u5c42\u4e3a\u4f55\u9009\u62e9 APISIX\\n\\n### \u81ea\u7814\u521d\u5c1d\u8bd5\\n\\n\u5728\u9009\u578b API \u7f51\u5173\u4e4b\u524d\uff0c\u5176\u5b9e\u6211\u4eec\u81ea\u5df1\u4e5f\u5c1d\u8bd5\u8fc7\u4e00\u4e9b\u64cd\u4f5c\u3002\u56e0\u4e3a\u6574\u4e2a\u56e2\u961f\u5bf9 Java \u6280\u672f\u6808\u548c Spring \u6846\u67b6\u90fd\u6bd4\u8f83\u719f\uff0c\u6240\u4ee5\u5c31\u9009\u62e9\u57fa\u4e8e Zuul \u5f00\u53d1\u4e86\u4e00\u4e2a API \u7f51\u5173\u4f7f\u7528\u3002\u5f53\u65f6\u8fd9\u5957\u7f51\u5173\u5bf9\u4e8e HTTP \u573a\u666f\u4e5f\u57fa\u672c\u591f\u7528\u3002\u968f\u7740\u540e\u7eed\u7ee7\u7eed\u4f7f\u7528\uff0c\u5c31\u6709\u65b0\u7684\u9700\u6c42\u5f00\u59cb\u4ea7\u751f\u3002\u6bd4\u5982\uff1a\\n\\n- \u9700\u8981\u5bf9 WebSocket \u7684\u9274\u6743\u8fdb\u884c\u652f\u6301\u3002\u5f88\u591a\u5b9e\u65f6\u7c7b\u7684\u544a\u8b66\u4fe1\u606f\u9700\u8981\u901a\u8fc7 WebSocket \u8fdb\u884c\u63a8\u9001\uff0c\u5982\u679c\u9700\u8981\u652f\u6301\u8fd9\u7c7b\u4fe1\u606f\uff0c\u8fd8\u9700\u53e6\u884c\u5f00\u53d1\uff1b\u540c\u65f6 Zuul \u5bf9 WebSocket \u7684\u652f\u6301\u6027\u4e0d\u662f\u5f88\u597d\uff0c\u60f3\u8981\u5bf9 WebSocket \u8fdb\u884c\u9274\u6743\u66f4\u662f\u96be\u4e0a\u52a0\u96be\u3002\\n\\n- \u9700\u8981\u8def\u7531\u652f\u6301 HLS \u548c FLV \u7b49\u6d41\u5a92\u4f53\u534f\u8bae\u3002\u7531\u4e8e\u672c\u8eab\u4e1a\u52a1\u5b9e\u8df5\u573a\u666f\u4e2d\uff0c\u5bf9\u4e8e\u89c6\u9891\u5904\u7406\u7684\u9700\u6c42\u6bd4\u8f83\u5927\uff0c\u5c24\u5176\u662f\u9762\u5411 ToB \u548c ToG \u7684\u4e1a\u52a1\u573a\u666f\uff0c\u89c6\u9891\u76d1\u63a7\u662f\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u7cfb\u7edf\u3002\u56e0\u6b64\u5982\u679c\u89c6\u9891\u5904\u7406\u8d70\u7f51\u5173\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u652f\u6301 HLS \u548c FLV \u6d41\u5a92\u4f53\u534f\u8bae\uff08\u4e24\u79cd\u90fd\u57fa\u4e8e HTTP\uff09\uff0c\u540c\u65f6\u89c6\u9891\u5bf9\u4e8e\u5ef6\u8fdf\u6027\u548c\u6d41\u91cf\u8981\u6c42\u90fd\u662f\u5f88\u9ad8\u7684\uff0c\u5bf9\u7f51\u5173\u538b\u529b\u6781\u5927\u3002\\n\\n- BIM \u6a21\u578b\u5c55\u793a\uff0c\u57fa\u4e8e 3D Tiles \u534f\u8bae\u9700\u8981\u5728\u77ed\u65f6\u95f4\u4e0b\u8f7d\u6570 GB \u7684\u6570\u636e\u3002\u5728\u524d\u6587\u63d0\u5230\u7684\u6570\u5b57\u5b6a\u751f\u573a\u666f\u4e0b\uff0cBIM \u5efa\u6a21\u975e\u5e38\u706b\u3002\u56e0\u6b64\u6574\u4e2a\u6a21\u578b\u4f53\u91cf\u662f\u975e\u5e38\u5927\u7684\uff0c\u5927\u6982\u51e0\u767e\u4e2a G \u3002\u5c3d\u7ba1 3D Tiles \u534f\u8bae\u652f\u6301\u52a8\u6001\u52a0\u8f7d\u80fd\u529b\uff0c\u4f46\u662f\u5728\u77ed\u65f6\u95f4\u5185\u9700\u8981\u5b8c\u6210\u7684\u6d41\u91cf\u4f9d\u65e7\u5f88\u5e9e\u5927\uff0c\u5bf9\u4e8e\u7f51\u5173\u6765\u8bf4\u538b\u529b\u5c31\u66f4\u5927\u4e86\u3002\\n\\n- \u8def\u7531\u9700\u8981\u52a8\u6001\u52a0\u8f7d\uff0c\u5373\u65f6\u751f\u6548\u3002\u5728\u52a8\u6001\u52a0\u8f7d\u5c42\u9762\uff0cZuul \u6ca1\u6cd5\u6ee1\u8db3\u6211\u4eec\u5373\u65f6\u751f\u6548\u7684\u9700\u6c42\u3002\u5373\u4fbf\u662f\u6211\u4eec\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\uff0c\u4e5f\u4f1a\u52a0\u5927\u989d\u5916\u7684\u5de5\u4f5c\u91cf\uff0c\u540c\u65f6\u8fd8\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u53ef\u4ee5\u5b8c\u7f8e\u5730\u5b9e\u73b0\u8fd9\u79cd\u6548\u679c\u3002\\n\\n### \u8c03\u7814\u9009\u578b\u4e3b\u6d41\u7f51\u5173\\n\\n\u5728\u81ea\u7814\u9053\u8def\u4e0a\u8dcc\u8dcc\u649e\u649e\u4e4b\u540e\uff0c\u6211\u4eec\u5f00\u59cb\u5bf9\u5e02\u573a\u4e2d\u4e3b\u6d41\u7684\u7f51\u5173\u4ea7\u54c1\u8fdb\u884c\u8c03\u7814\u3002\u5f53\u65f6\u6211\u4eec\u8c03\u7814\u4e86\u4ee5\u4e0b\u51e0\u4e2a\u7f51\u5173\uff0c\u8c03\u7814\u5b8c\u4e4b\u540e\u53d1\u73b0\u6bcf\u4e2a\u4ea7\u54c1\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\u90fd\u6bd4\u8f83\u660e\u663e\uff0c\u4f46\u662f\u90fd\u4e0d\u80fd\u5f88\u597d\u5730\u5951\u5408\u6211\u4eec\u7684\u573a\u666f\u3002\u6bd4\u5982 NGINX \u65e0\u6cd5\u505a\u52a8\u6001\u8def\u7531\uff0cJava \u6280\u672f\u6808\u76f8\u5173\u7684\u6027\u80fd\u53c8\u8ddf\u4e0d\u592a\u4e0a\u7b49\u3002\\n\\n![\u9009\u578b\u4f18\u5148\u7ea7](https://static.apiseven.com/2022/12/09/6392931701477.png)\\n\\n\u8c03\u7814\u4e4b\u540e\uff0c\u6211\u4eec\u5e76\u6ca1\u6709\u627e\u5230\u9002\u5408\u81ea\u5df1\u7684\u4ea7\u54c1\uff0c\u4e5f\u4e00\u76f4\u90fd\u5728\u89c2\u671b\u548c\u56f0\u60d1\u4e2d\u3002\u4f46\u540e\u6765\u5728\u9009\u578b\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u610f\u95f4\u770b\u5230\u4e86\u7531\u5f00\u6e90\u4e2d\u56fd\u4e3e\u529e\u7684 \u300c2021 \u5e74\u5e74\u5ea6\u4e2d\u56fd\u5f00\u6e90\u9879\u76ee\u300d\u8bc4\u9009\u6d3b\u52a8\u3002\u56e0\u4e3a\u6211\u89c9\u5f97\u8fd9\u91cc\u9762\u80af\u5b9a\u6709\u5f88\u591a\u4f18\u79c0\u7684\u9879\u76ee\uff0c\u4e8e\u662f\u62b1\u7740\u5b66\u4e60\u7684\u5fc3\u6001\u5c31\u4e00\u4e2a\u4e2a\u70b9\u8fdb\u53bb\u4e86\u89e3\u4e86\u4e00\u4e0b\uff0c\u7136\u540e\u5c31\u770b\u5230\u4e86 API \u7f51\u5173\u4ea7\u54c1 \u2014\u2014 Apache APISIX\u3002\\n\\n![2021\u5e74\u5e74\u5ea6\u4e2d\u56fd\u5f00\u6e90\u9879\u76ee](https://static.apiseven.com/2022/12/09/63929313912bb.png)\\n\\n\u540e\u6765\u8ddf\u968f APISIX \u7684\u5404\u79cd\u4ecb\u7ecd\uff0c\u5305\u62ec GitHub \u4e0a\u7684\u63d0\u95ee\u3001\u793e\u533a\u5b98\u7f51\u4e0a\u7684\u6280\u672f\u6587\u6863\u4ee5\u53ca B \u7ad9\u4e0a\u7684\u4e00\u4e9b\u7528\u6237\u6848\u4f8b\u548c\u6280\u672f\u5b9e\u8df5\u5206\u4eab\u7b49\u7b49\uff0c\u6211\u53d1\u73b0\u6574\u4e2a\u793e\u533a\u90fd\u975e\u5e38\u6709\u6d3b\u529b\u3002\u6bd4\u5982\u5728 GitHub \u4e0a\u6709\u63a5\u8fd1 3600 \u4e2a issue \u800c\u4e14\u5df2\u7ecf\u89e3\u51b3\u4e86 3200 \u4e2a\u5de6\u53f3\uff0c\u89e3\u51b3\u7387\u9ad8\u8fbe 89%\uff0c\u8fd9\u4e2a\u6570\u91cf\u5360\u6bd4\u8fd8\u662f\u975e\u5e38\u53ef\u89c2\u7684\uff1b\u540c\u65f6\u6709\u4e9b\u793e\u533a\u53cd\u9988\u6e20\u9053\u4e5f\u5141\u8bb8\u4e2d\u6587\u63d0\u95ee\uff0c\u8fd9\u5bf9\u4e8e\u4e2d\u56fd\u5f00\u53d1\u8005\u800c\u8a00\u975e\u5e38\u53cb\u597d\u3002\\n\\n\u540c\u65f6 Apache APISIX \u9879\u76ee\u5728\u5168\u7f51\u6709\u8f83\u591a\u7684\u53c2\u8003\u8d44\u6599\u3002APISIX \u793e\u533a\u5728 B \u7ad9\u548c Youtube \u4e0a\u90fd\u6709\u975e\u5e38\u591a\u7684\u89c6\u9891\u5206\u4eab\uff0c\u5305\u62ec\u7528\u6237\u6848\u4f8b\u548c\u4e00\u4e9b\u6280\u672f tutorials\uff08\u6559\u7a0b\uff09\u3002\u6211\u66fe\u7ecf\u82b1\u4e86\u4e24\u5929\u65f6\u95f4\u628a APISIX \u7684 B \u7ad9\u89c6\u9891\u5168\u90fd\u770b\u4e86\u4e00\u904d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6211\u53d1\u73b0\u6709\u5f88\u591a\u4f01\u4e1a\u7c7b\u4f3c\u7684\u6848\u4f8b\u90fd\u8ddf\u6211\u4eec\u7684\u9700\u6c42\u573a\u666f\u5f88\u7c7b\u4f3c\uff0c\u5305\u62ec\u4e00\u4e9b\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u8e29\u7684\u5751\u3002\u8fd9\u4e9b\u5bf9\u4e8e\u6211\u4eec\u800c\u8a00\uff0c\u5f88\u591a\u662f\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u501f\u9274\u7684\u771f\u5b9e\u7ecf\u9a8c\uff0c\u5bf9\u4e8e\u540e\u7eed\u7684\u67b6\u6784\u66f4\u65b0\u6709\u975e\u5e38\u9ad8\u7684\u4ef7\u503c\u53c2\u8003\u3002\\n\\n\u8fd9\u4e9b\u7ec6\u8282\uff0c\u90fd\u8ba9\u6211\u4eec\u5bf9\u4e8e\u4ea7\u54c1\u7684\u540e\u7eed\u4f7f\u7528\u6709\u4e86\u5341\u8db3\u7684\u5b89\u5168\u611f\uff0c\u6700\u7ec8\u6211\u4eec\u9009\u62e9\u4e86\u5c06 Apache APISIX \u4f5c\u4e3a API \u7f51\u5173\u8fdb\u884c\u540e\u7eed\u67b6\u6784\u548c\u4e1a\u52a1\u7684\u8fed\u4ee3\u3002\\n\\n## \u5e94\u7528 APISIX \u7684\u4e1a\u52a1\u5b9e\u8df5\\n\\n### \u8ba9 Kubernetes \u4e2d\u90e8\u7f72\u66f4\u53ef\u9760\\n\\n![\u5728 Kubernetes \u4e0a](https://static.apiseven.com/2022/12/09/6392931729609.png)\\n\\n\u76ee\u524d\u6211\u4eec\u662f\u5c06 APISIX \u90e8\u7f72\u5728 Kubernetes \u4e0a\u4f7f\u7528\uff0c\u6574\u4e2a\u7528\u6237\u4fa7\u7684\u4e1a\u52a1\u7cfb\u7edf\u90fd\u662f\u5148\u7ecf\u8fc7 API \u7f51\u5173\uff0c\u7136\u540e\u518d\u7531 API \u7f51\u5173\u5728\u8def\u7531\u4e0a\u5206\u53d1\u5230\u5404\u4e2a\u4e1a\u52a1\u670d\u52a1\uff0c\u4e2d\u95f4\u90fd\u662f\u901a\u8fc7\u5185\u90e8\u57df\u540d\u8fdb\u884c\u4f20\u9012\u3002\\n\u5728\u9ad8\u6027\u80fd\u7684\u4f53\u73b0\u4e0a\uff0c\u6211\u4eec\u91c7\u53d6\u4e86 Kubernetes \u591a\u5b9e\u4f8b\u7684\u65b9\u6848\u3002\u6bd4\u5982\u8bf4\u6027\u80fd\u8981\u6c42\u597d\uff0c\u5c31\u53ef\u4ee5\u7ed9\u5b83\u914d 10 \u4e2a\u5b9e\u4f8b\uff1b\u6027\u80fd\u8981\u6c42\u5dee\u4e00\u4e9b\uff0c\u5c31\u914d 5 \u4e2a\u5b9e\u4f8b\u3002\\n\\n\u540c\u65f6\u57df\u540d\u4e5f\u662f\u6211\u4eec\u5f88\u5728\u610f\u7684\u70b9\u3002\u56e0\u4e3a\u6309\u7167\u524d\u6587\u6240\u63d0\u5230\u7684\u9884\u60f3\u89c4\u5212\uff0c\u6211\u4eec\u53ea\u5e0c\u671b\u66b4\u9732\u4e00\u4e2a 443 \u7684\u7aef\u53e3\u51fa\u53bb\uff0c\u5176\u4ed6\u90fd\u901a\u8fc7 Kubernetes \u5185\u90e8\u7684\u57df\u540d\u8fdb\u884c\u6574\u4f53\u670d\u52a1\u7684\u8fd0\u8f6c\u3002\u5728\u521a\u5f00\u59cb\u4f7f\u7528 APISIX \u65f6\u6211\u8fd8\u6709\u4e9b\u62c5\u5fc3\uff0c\u4e07\u4e00\u5b83\u53ea\u652f\u6301 IP \u5730\u5740\u8ddf\u7aef\u53e3\uff0c\u90a3\u5c31\u5f88\u9ebb\u70e6\u4e86\u3002\\n\\n\u540e\u6765\u7ecf\u8fc7\u6d4b\u8bd5\u53d1\u73b0\u6548\u679c\u4e5f\u975e\u5e38\u597d\u3002\u5982\u4e0b\u56fe\u5de6\u4fa7\u4e3a APISIX Dashboard\uff0c\u53f3\u4fa7\u662f\u670d\u52a1\u57df\u540d\uff08Kubernetes \u670d\u52a1\u57df\u540d\uff09\u3002\u8fd9\u91cc\u5c31\u53ef\u4ee5\u76f4\u63a5\u914d\u7f6e Kubernetes \u7684\u57df\u540d+\u4e00\u4e2a\u7aef\u53e3\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u5b8c\u6210\u57df\u540d\u7684\u8f6c\u53d1\u3002\u8fd9\u5bf9\u6574\u4e2a\u7cfb\u7edf\u7684\u53ef\u9760\u6027\u8ddf\u5b89\u5168\u6027\u90fd\u6709\u4e86\u975e\u5e38\u5f3a\u529b\u7684\u529f\u80fd\u652f\u6301\u3002\\n\\n![APISIX Dashboard](https://static.apiseven.com/2022/12/09/639293138baeb.png)\\n\\n### \u81ea\u5b9a\u4e49\u670d\u52a1\u8f7b\u677e\u5bf9\u63a5\u9274\u6743\\n\\n\u5355\u70b9\u767b\u5f55\u4e0e\u9274\u6743\u4e5f\u662f\u6211\u4eec\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u90e8\u5206\u3002\u56e0\u4e3a\u6211\u4eec\u6709\u5927\u91cf\u7684\u4e1a\u52a1\u548c\u7528\u6237\u9700\u8981\u8fdb\u884c\u7ba1\u7406\uff0c\u6240\u4ee5\u8fd9\u4e00\u5757\u80af\u5b9a\u662f\u7531\u5404\u81ea\u4e1a\u52a1\u7cfb\u7edf\u8fdb\u884c\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u4e5f\u81ea\u7814\u4e86\u5355\u70b9\u767b\u5f55\u670d\u52a1\u3002\\n\\n\u7531\u4e8e\u81ea\u7814\u670d\u52a1\u7cfb\u7edf\uff0c\u6240\u4ee5\u76f8\u5173 token \u5e76\u4e0d\u901a\u7528\uff0c\u5176\u4e2d\u5c31\u4f1a\u643a\u5e26\u4e00\u4e9b\u4e1a\u52a1\u7279\u5b9a\u7684\u81ea\u5b9a\u4e49\u4fe1\u606f\u3002\u56e0\u6b64\u6211\u4eec\u4e5f\u5bb3\u6015\u81ea\u5df1\u7684 token \u65e0\u6cd5\u88ab APISIX \u9274\u6743\u76f8\u5173\u529f\u80fd\u6240\u8bc6\u522b\uff0c\u56e0\u4e3a APISIX \u63d0\u4f9b\u7684 token \u662f\u6211\u4eec\u5185\u90e8\u65e0\u6cd5\u4f7f\u7528\u7684\u3002\\n\\n![\u670d\u52a1\u9274\u6743](https://static.apiseven.com/2022/12/09/6392931354abd.png)\\n\\n\u4f46\u5728\u540e\u7eed\u7684\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u79cd\u60f3\u6cd5\u662f\u591a\u8651\u7684\u3002\u5728\u5b9e\u9645\u751f\u4ea7\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u9700\u628a\u6211\u4eec\u4e1a\u52a1\u7684 token \u751f\u4ea7\u52a0\u5bc6\u7b97\u6cd5\u4e0e APISIX \u7684\u52a0\u5bc6\u914d\u7f6e\u4fdd\u6301\u540c\u6b65\uff0c\u5c31\u53ef\u4ee5\u5229\u7528 APISIX \u5b9e\u73b0\u5b8c\u6574\u529f\u80fd\u7684\u9274\u6743\u3002\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u81ea\u7814\u670d\u52a1\u4ea7\u751f\u7684 token \u901a\u8fc7 APISIX \u7684 jwt-auth \u63d2\u4ef6\u5b8c\u6210\u4e86\u4e00\u6574\u4e2a\u670d\u52a1\u9274\u6743\u3002\\n\\n### \u9488\u5bf9\u4e1a\u52a1\u7684 etcd \u5904\u7406\\n\\n\u4f5c\u4e3a APISIX \u67b6\u6784\u4e2d\u7684\u91cd\u8981\u7ec4\u4ef6\uff0cetcd \u5bf9\u4e8e\u6211\u4eec\u7684\u7814\u53d1\u56e2\u961f\u6765\u8bf4\u786e\u5b9e\u662f\u4e00\u4e2a\u6311\u6218\u3002\u7531\u4e8e\u672c\u8eab\u5bf9 etcd \u5e76\u4e0d\u719f\u6089\uff0c\u6240\u4ee5\u6211\u4eec\u5728 Kubernetes \u73af\u5883\u4e2d\u90e8\u7f72 etcd \u96c6\u7fa4\u6298\u817e\u4e86\u5f88\u4e45\u3002\u867d\u7136\u5728\u5b66\u4e60\u6210\u672c\u4e0a\u6709\u4e9b\u6298\u817e\uff0c\u4f46\u4e5f\u610f\u5916\u53d1\u73b0\u4e86\u4e00\u4e2a\u60ca\u559c\u3002\\n\\n\u6211\u4eec\u53d1\u73b0\uff0cAPISIX \u5728 etcd \u5b95\u673a\u540e\uff0c\u975e\u91cd\u542f\u60c5\u51b5\u4e0b\u8fd8\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002\u7b49 etcd \u6062\u590d\u540e\uff0c APISIX \u4f1a\u81ea\u52a8\u91cd\u8fde\u3002\u57fa\u4e8e\u6b64\uff0c\u6211\u4eec\u63d0\u51fa\u4e86\u4e00\u4e2a\u66f4\u8d34\u5408\u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u7684\u65b9\u6848\u3002\\n\\n\u56e0\u6b64\u6211\u4eec\u653e\u5f03\u4e86\u914d\u7f6e etcd \u96c6\u7fa4\uff0c\u800c\u662f\u53ea\u914d\u7f6e\u4e86\u4e00\u4e2a etcd \u7528\u6765\u652f\u6491\u6574\u4e2a APISIX\u3002\u53ea\u9700\u8981\u628a etcd \u7684\u6570\u636e\u5907\u4efd\u597d\uff0c\u91cd\u542f\u5b8c APISIX \u4e5f\u80fd\u6b63\u5e38\u8fde\u63a5\u8fd0\u4f5c\u3002\u5b9e\u9645\u8fd0\u884c\u8d77\u6765\u7684\u6548\u679c\u4e5f\u662f\u5f88\u4e0d\u9519\u7684\uff0c\u81f3\u5c11\u5bf9\u4e8e\u6211\u4eec\u7684\u4e1a\u52a1\u573a\u666f\u662f\u591f\u7528\u7684\u3002\u540c\u65f6\u56e0\u4e3a etcd \u53ea\u90e8\u7f72\u4e86\u4e00\u4e2a\uff0c\u6240\u4ee5\u540e\u7eed\u7684\u8fd0\u7ef4\u5de5\u4f5c\u91cf\u4e5f\u51cf\u5c11\u4e86\u5f88\u591a\u3002\\n\\n### \u5f00\u7bb1\u5373\u7528\u7684 API \u76d1\u63a7\\n\\n\u5bf9\u4e8e\u6211\u4eec\u7684\u4e1a\u52a1\u6765\u8bf4\uff0c\u662f\u5c5e\u4e8e\u5f3a\u4f9d\u8d56\u4e8e\u7cfb\u7edf\u96c6\u6210\u7684\u9879\u76ee\uff0c\u56e0\u6b64\u4e1a\u52a1\u7cfb\u7edf\u4e4b\u95f4\u4e92\u76f8\u8c03\u7528 API \u7684\u73af\u8282\u5c31\u975e\u5e38\u591a\u3002\u5982\u679c\u67d0\u4e9b\u7cfb\u7edf\u4e4b\u95f4\u7684\u8c03\u7528 API \u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4e0d\u540c\u4e1a\u52a1\u90e8\u95e8\u4e92\u76f8\u626f\u76ae\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u79cd\u73af\u8282\uff0c\u5c31\u9700\u8981\u6709\u76f8\u5e94\u7684\u76d1\u63a7\u7cfb\u7edf\u8fdb\u884c\u6392\u67e5\u3002\\n\\nAPISIX \u5b98\u65b9\u5176\u5b9e\u5df2\u7ecf\u63d0\u4f9b\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u76d1\u63a7\u89e3\u51b3\u65b9\u6848\u300cAPISIX+Prometheus+Grafana\u300d\u3002\u5229\u7528\u81ea\u5e26\u7684 prometheus \u63d2\u4ef6\uff0c\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u4e0e Prometheus \u8fdb\u884c\u96c6\u6210\uff0c\u5e76\u5b9e\u73b0\u8bf7\u6c42\u72b6\u6001\u7801\u3001\u5b9e\u65f6\u5e26\u5bbd\u3001etcd \u53ef\u7528\u6027\u3001TCP \u8fde\u63a5\u6307\u6807\u548c\u8282\u70b9\u7b49\u4fe1\u606f\u7684\u76d1\u63a7\u548c\u7ba1\u7406\u3002\\n\\n![\u76d1\u63a7\u9875\u9762](https://static.apiseven.com/2022/12/09/63929319077ae.png)\\n\\n\u4f9d\u9760 APISIX \u8fd9\u5957\u76d1\u63a7\u65b9\u6848\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5b9a\u4f4d\u51fa\u54ea\u90e8\u5206\u8c03\u7528 API \u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u8fdb\u884c\u5feb\u901f\u5b9a\u4f4d\uff0c\u907f\u514d\u4e86\u5404\u4e1a\u52a1\u7cfb\u7edf\u4e4b\u95f4\u96c6\u6210\u5bf9\u63a5\u65f6\u6240\u4ea7\u751f\u7684\u4e00\u4e9b\u95ee\u9898\u3002\\n\\n## \u603b\u7ed3\u4e0e\u5c55\u671b\\n\\n\u603b\u4f53\u6765\u770b\uff0c\u6211\u4eec\u63a5\u89e6 APISIX \u7684\u65f6\u95f4\u5e76\u4e0d\u7b97\u957f\u30022021 \u5e74 10 \u6708\u4efd\u521a\u77e5\u9053\u8fd9\u4e2a\u4ea7\u54c1\uff0c\u5728\u6d4b\u8bd5\u548c\u9700\u6c42\u68c0\u9a8c\u7b49\u89d2\u5ea6\u6298\u817e\u4e86\u4e24\u4e09\u4e2a\u6708\u540e\uff0c\u5f00\u59cb\u5c1d\u8bd5\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u73b0\u5728\u4e5f\u662f\u968f\u7740\u5b98\u65b9\u7248\u672c\u7684\u66f4\u65b0\u9010\u6e10\u8fed\u4ee3\u3002\\n\\n\u4ece\u6211\u4e2a\u4eba\u89d2\u5ea6\u548c\u4e1a\u52a1\u8fd0\u884c\u7684\u4f53\u9a8c\u6765\u770b\uff0cAPISIX \u4f5c\u4e3a\u7f51\u5173\u5df2\u7ecf\u662f\u4e00\u4e2a\u5f88\u6210\u719f\u7684\u4ea7\u54c1\u4e86\u3002\u5728\u4f7f\u7528\u7684\u8fd9\u6bb5\u65f6\u95f4\u91cc\uff0c\u4e5f\u9010\u6e10\u4ece\u5bf9\u8fd9\u4e2a\u4ea7\u54c1\u7684\u5404\u79cd\u62c5\u5fc3\u5230\u771f\u6b63\u4e0a\u624b\u540e\u7684\u60ca\u559c\u56de\u9988\uff1a\\n\\n- \u4e00\u5f00\u59cb\u66fe\u62c5\u5fc3\u914d\u7f6e\u4e0a\u6e38\u65f6\uff0c\u65e0\u6cd5\u4f7f\u7528 Kubernetes \u7684\u670d\u52a1\u57df\u540d\uff1b\u4f7f\u7528\u8fc7\u53d1\u73b0\uff0c\u539f\u6765\u5b8c\u7f8e\u652f\u6301\u670d\u52a1\u57df\u540d\u8bbf\u95ee\u3002\\n- \u57fa\u4e8e APISIX \u5b9e\u73b0\u4e86\u4e1a\u52a1\u9ad8\u53ef\u7528\u65b9\u6848\uff0c\u4f9d\u8d56 Kubernetes \u4e91\u5e73\u53f0\u5b9e\u73b0\u591a\u5b9e\u4f8b+\u81ea\u52a8\u4f38\u7f29+\u5065\u5eb7\u76d1\u6d4b+\u9884\u8b66\u544a\u8b66\u7b49\u529f\u80fd\u3002\\n- \u5bf9\u4e8e\u7cfb\u7edf\u96c6\u6210\u9879\u76ee\uff0cAPISIX \u5b8c\u7f8e\u89e3\u51b3\u4e86 API \u7684\u7ba1\u7406\u3001 \u9274\u6743\u3001\u8def\u7531\u95ee\u9898\u3002\\n- \u5176\u914d\u7f6e\u7684\u70ed\u66f4\u65b0\u7279\u6027\uff0c\u6781\u5927\u907f\u514d\u4e86\u201c\u56e0\u4e3a\u66f4\u65b0\u5bfc\u81f4\u670d\u52a1\u65e0\u6cd5\u6b63\u5e38\u8bbf\u95ee\u201d\u3002\\n- \u4f5c\u4e3a\u4e00\u4e2a\u5f00\u7bb1\u5373\u7528\u7684\u7f51\u5173\u4ea7\u54c1\uff0c\u8ba9\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u66f4\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u4ee3\u7801\u3002\\n\\n\u5f53\u7136\uff0c\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u57fa\u4e8e\u8fd9\u4e9b\u64cd\u4f5c\u63d0\u51fa\u4e86\u4e00\u4e9b\u4e1a\u52a1\u5c42\u9762\u5bf9\u4e8e APISIX \u7684\u529f\u80fd\u9700\u6c42\uff0c\u6bd4\u5982\uff1a\\n\\n- \u80fd\u5426\u652f\u6301\u9664 etcd \u5916\u7684\u5176\u4ed6\u6570\u636e\u6301\u4e45\u5316\u65b9\u5f0f\uff0c\u6bd4\u5982 MySQL\u3001PostgreSQL \u7b49\u3002\u53ef\u8ba9\u6211\u4eec\u5728\u719f\u6089\u7684\u6570\u636e\u5b58\u50a8\u9886\u57df\u80fd\u591f\u66f4\u597d\u5730\u5e94\u7528\u4e0e\u6392\u67e5\u95ee\u9898\uff1b\\n- APISIX Dashboard \u80fd\u5426\u652f\u6301\u4e00\u952e\u6570\u636e\u5907\u4efd\u4e0e\u8fd8\u539f\u3002\\n\\n\u6574\u4f53\u6765\u770b\uff0c\u5728\u4f7f\u7528 APISIX \u7684\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u7684\u5b66\u4e60\u6210\u672c\u53ef\u80fd\u9ad8\u4e86\u4e00\u4e9b\uff0c\u4f46\u662f\u4ea7\u54c1\u670d\u52a1\u4e8e\u4e1a\u52a1\u4e2d\u6240\u4f53\u73b0\u51fa\u6765\u7684\u6574\u4f53\u6548\u679c\u662f\u5b8c\u5168\u60ca\u559c\u7684\u3002\u540e\u7eed\u6211\u4eec\u4e5f\u8ba1\u5212\u5728\u66f4\u591a\u7cfb\u5217\u7684\u4e1a\u52a1\u4ea7\u54c1\u4e2d\u5f15\u5165 APISIX\uff0c\u4f5c\u4e3a\u7f51\u5173\u7ec4\u4ef6\u8ba9\u6211\u4eec\u7684\u4e1a\u52a1\u4ea7\u54c1\u53ef\u4ee5\u53d1\u6325\u66f4\u7a33\u5b9a\u66f4\u9ad8\u6548\u7684\u4ef7\u503c\u3002"},{"id":"Apache APISIX \u73a9\u8f6c Tongsuo \u56fd\u5bc6\u63d2\u4ef6","metadata":{"permalink":"/zh/blog/2022/12/08/apisix-support-tongsuo","source":"@site/blog/2022/12/08/apisix-support-tongsuo.md","title":"Apache APISIX \u73a9\u8f6c Tongsuo \u56fd\u5bc6\u63d2\u4ef6","description":"\u672c\u6587\u901a\u8fc7\u89e3\u8bfb\u56fd\u5bc6\u7684\u76f8\u5173\u5185\u5bb9\u4e0e\u6807\u51c6\uff0c\u5448\u73b0\u4e86\u5f53\u4e0b\u56fd\u5185\u6280\u672f\u73af\u5883\u4e2d\u5bf9\u4e8e\u56fd\u5bc6\u529f\u80fd\u652f\u6301\u7684\u73b0\u72b6\u3002\u5e76\u4ece API \u7f51\u5173 Apache APISIX \u7684\u89d2\u5ea6\uff0c\u5e26\u6765\u6709\u5173\u56fd\u5bc6\u7684\u63a2\u7d22\u4e0e\u529f\u80fd\u5448\u73b0\u3002","date":"2022-12-08T00:00:00.000Z","formattedDate":"2022\u5e7412\u67088\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":11.445,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://github.com/spacewander.png"}],"prevItem":{"title":"\u667a\u6167\u4ea4\u901a\u7cfb\u7edf\u7f51\u65b0\u7535\u6c14\uff0c\u5982\u4f55\u57fa\u4e8e APISIX \u8fed\u4ee3\u6570\u5b57\u667a\u8054\u5e73\u53f0","permalink":"/zh/blog/2022/12/09/insigma-with-apache-apisix"},"nextItem":{"title":"APISIX \u5728\u541b\u6da6\u4eba\u529b\u4e91\u539f\u751f\u5e73\u53f0\u7684\u67b6\u6784\u5b9e\u8df5","permalink":"/zh/blog/2022/12/07/junrunrenli-with-apisix"}},"content":"> \u672c\u6587\u901a\u8fc7\u89e3\u8bfb\u56fd\u5bc6\u7684\u76f8\u5173\u5185\u5bb9\u4e0e\u6807\u51c6\uff0c\u5448\u73b0\u4e86\u5f53\u4e0b\u56fd\u5185\u6280\u672f\u73af\u5883\u4e2d\u5bf9\u4e8e\u56fd\u5bc6\u529f\u80fd\u652f\u6301\u7684\u73b0\u72b6\u3002\u5e76\u4ece API \u7f51\u5173 Apache APISIX \u7684\u89d2\u5ea6\uff0c\u5e26\u6765\u6709\u5173\u56fd\u5bc6\u7684\u63a2\u7d22\u4e0e\u529f\u80fd\u5448\u73b0\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005\uff1a\u7f57\u6cfd\u8f69\uff0cApache APISIX PMC\\n\\n## \u4ec0\u4e48\u662f\u56fd\u5bc6\\n\\n\u987e\u540d\u601d\u4e49\uff0c**\u56fd\u5bc6\u5c31\u662f\u56fd\u4ea7\u5316\u7684\u5bc6\u7801\u7b97\u6cd5**\u3002\u5728\u6211\u4eec\u65e5\u5e38\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4f1a\u63a5\u89e6\u5230\u5404\u79cd\u5404\u6837\u7684\u5bc6\u7801\u7b97\u6cd5\uff0c\u5982 RSA\u3001SHA256 \u7b49\u7b49\u3002\u4e3a\u4e86\u8fbe\u5230\u66f4\u9ad8\u7684\u5b89\u5168\u7b49\u7ea7\uff0c\u8bb8\u591a\u5927\u516c\u53f8\u548c\u56fd\u5bb6\u4f1a\u5236\u5b9a\u81ea\u5df1\u7684\u5bc6\u7801\u7b97\u6cd5\u3002\u56fd\u5bc6\u5c31\u662f\u8fd9\u6837\u4e00\u7ec4\u7531\u4e2d\u56fd\u56fd\u5bb6\u5bc6\u7801\u7ba1\u7406\u5c40\u5236\u5b9a\u7684\u5bc6\u7801\u7b97\u6cd5\u3002\u5728\u56fd\u9645\u5f62\u52bf\u8d8a\u53d1\u590d\u6742\u591a\u53d8\u7684\u4eca\u5929\uff0c\u5bc6\u7801\u7b97\u6cd5\u7684\u56fd\u4ea7\u5316\u66ff\u4ee3\uff0c\u5728\u4e00\u4e9b\u9886\u57df\u5df2\u7ecf\u6210\u4e3a\u4e86\u4e00\u80a1\u52bf\u4e0d\u53ef\u6321\u7684\u6f6e\u6d41\u3002\\n\\n**\u56fd\u5bc6\u7684\u5b98\u65b9\u540d\u79f0\u4e3a\u56fd\u5bb6\u5546\u7528\u5bc6\u7801\uff0c\u7b80\u79f0\u5546\u5bc6\uff0c\u62fc\u97f3\u7f29\u5199\u662f SM**\u3002\u8fd9\u4e5f\u662f\u56fd\u5bc6\u6807\u51c6\u4e2d SM2/3/4/7/9 \u7b49\u7b97\u6cd5\u540d\u79f0\u7684\u6765\u6e90\u3002\u56fd\u5bc6\u7b97\u6cd5\u7684\u547d\u540d\u65b9\u5f0f\u975e\u5e38\u7b80\u5355\u76f4\u63a5\uff0c\u5c31\u50cf\u201c\u7ef5\u9633\u4e5d\u6240\u201d\u3001\u201c\u4e8c\u673a\u90e8\u201d\u4e00\u6837\uff0c\u90fd\u662f\u201c\u5206\u7c7b+\u5e8f\u53f7\u201d\u7684\u7ec4\u5408\u3002\u5176\u4e2d SM1 \u548c SM4 \u662f\u5bf9\u79f0\u7b97\u6cd5\uff0c\u5bf9\u6807 AES\uff1bSM2 \u662f\u975e\u5bf9\u79f0\u7b97\u6cd5\uff0c\u5bf9\u6807 RSA\u3001ECDSA\uff1bSM3 \u662f\u6458\u8981\u7b97\u6cd5\uff0c\u5bf9\u6807 MD5\uff1b\u7b49\u7b49\u3002\u7531\u4e8e\u672c\u6587\u5e76\u975e\u6d89\u53ca\u5230\u56fd\u5bc6\u7684\u5b9e\u73b0\u7ec6\u8282\uff0c\u6240\u4ee5\u4e0d\u4f1a\u8bb2\u5f97\u975e\u5e38\u7ec6\uff0c\u4e5f\u5c31\u79d1\u666e\u4e0b\u56fd\u5bc6\u7b97\u6cd5\u7684\u5206\u7c7b\u3002\\n\\n\u5728\u57fa\u7840\u7684\u56fd\u5bc6\u7b97\u6cd5\u4e4b\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u56fd\u5bc6\u7684\u5782\u76f4\u751f\u6001\uff0c\u6bd4\u5982\u5b9e\u73b0\u56fd\u5bc6\u7b97\u6cd5\u7684\u786c\u4ef6\u3001\u63d0\u4f9b\u56fd\u5bc6\u652f\u6301\u7684\u5bc6\u7801\u5e93\u3001\u52a0\u5165\u56fd\u5bc6\u6d41\u7a0b\u7684 TLS \u63e1\u624b\u534f\u8bae\u7b49\u7b49\u3002\u6b63\u5982\u5b89\u5168\u9700\u8981\u7eb5\u6df1\u9632\u5fa1\u4e00\u6837\uff0c\u57fa\u4e8e\u56fd\u5bc6\u7684\u4fe1\u4efb\u94fe\u4e5f\u9700\u8981\u6709\u5168\u8f6f\u4ef6\u6808\u4e0a\u7684\u652f\u6301\u3002\\n\\n\u56e0\u6b64\uff0c\u5f53\u6211\u4eec\u8c08\u8bba\u56fd\u5bc6\u652f\u6301\u65f6\uff0c\u5e76\u4e0d\u4ec5\u4ec5\u5355\u72ec\u6307\u53ef\u4ee5\u7528\u67d0\u4e00\u79cd\u56fd\u5bc6\u7b97\u6cd5\u8fdb\u884c\u52a0\u89e3\u5bc6\uff0c\u800c\u662f\u6307\u5d4c\u5408\u5165\u56fd\u5bc6\u7684\u751f\u6001\uff0c\u652f\u6301\u67d0\u79cd\u56fd\u5bc6\u7684\u5e94\u7528\u573a\u666f\u3002\\n\\n## \u56fd\u5bc6\u7684\u5e94\u7528\u573a\u666f\\n\\n\u4f5c\u4e3a\u56fd\u5bb6\u5bc6\u7801\u7ba1\u7406\u5c40\u5236\u5b9a\u7684\u5bc6\u7801\u7b97\u6cd5\uff0c\u56fd\u5bc6\u5e7f\u6cdb\u5e94\u7528\u4e8e\u7535\u5b50\u653f\u52a1\uff08\u5305\u62ec\u56fd\u5bb6\u653f\u52a1\u901a\u3001\u8b66\u52a1\u901a\u7b49\u91cd\u8981\u9886\u57df\uff09\u3001\u4fe1\u521b\u53ca\u91d1\u878d\u4e1a\u7684\u5404\u4e2a\u5e94\u7528\u9886\u57df\u3002\\n\\n* **\u653f\u5e9c\u548c\u91d1\u878d\u7684\u8eab\u4efd\u8ba4\u8bc1\u7ec8\u7aef**\u3002\u4f9d\u7167\u73b0\u884c\u6709\u5173\u89c4\u5b9a\uff0c\u8bb8\u591a\u6d89\u53ca\u653f\u5e9c\u548c\u91d1\u878d\u7684\u8eab\u4efd\u8ba4\u8bc1\u7ec8\u7aef\uff08\u8bf8\u5982 USBKey\u3001\u667a\u80fd IC \u5361\u3001\u94f6\u884c\u5361\u7ec8\u7aef\u7b49\uff09\u90fd\u9700\u8981\u63d0\u4f9b\u5bf9\u56fd\u5bc6\u7684\u652f\u6301\u3002\\n* **\u56fd\u4ea7\u5f00\u6e90\u64cd\u4f5c\u7cfb\u7edf**\u3002\u8bb8\u591a\u4e3b\u6253\u56fd\u4ea7\u66ff\u4ee3\u7684\u5f00\u6e90\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f1a\u63d0\u4f9b\u57fa\u4e8e\u56fd\u5bc6\u7684\u5b89\u5168\u52a0\u56fa\u529f\u80fd\u3002\u6bd4\u5982\u9f99\u8725\u64cd\u4f5c\u7cfb\u7edf (Anolis OS) \u63d0\u5230\u81ea\u5df1\u5b9e\u73b0\u4e86\u5168\u6808\u56fd\u5bc6\u80fd\u529b\uff1bOpenEuler \u4e5f\u5728\u505a\u56fd\u5bc6\u76f8\u5173\u7684\u4e00\u4e9b\u529f\u80fd\uff0c\u6bd4\u5982\u57fa\u4e8e\u56fd\u5bc6\u6570\u5b57\u8bc1\u4e66\u6269\u5c55\u4e86 EFI \u7684\u6570\u5b57\u7b7e\u540d\u3002\\n* **\u4fe1\u521b\u4ea7\u54c1**\u3002\u8fd8\u6709\u8bb8\u591a\u505a\u4fe1\u521b\u751f\u610f\u7684\u5382\u5546\uff0c\u56f4\u7ed5\u56fd\u5bc6\u63a8\u51fa\u7b26\u5408\u76f8\u5173\u6807\u51c6\u7684\u4ea7\u54c1\u3002\u4f8b\u5982\u652f\u6301\u4f7f\u7528\u56fd\u5bc6\u7b97\u6cd5\u505a\u6570\u5b57\u7b7e\u540d\u7684 PDF \u5de5\u5177\u3001\u652f\u6301\u56fd\u5bc6\u63a5\u5165\u6807\u51c6\u7684\u97f3\u89c6\u9891\u8f6f\u4ef6\u7b49\u7b49\u3002\\n* **\u57fa\u4e8e\u56fd\u5bc6 TLS \u534f\u8bae\u7684\u751f\u6001**\u3002\u4e5f\u662f\u5728\u65e5\u5e38\u5f00\u53d1\u4e2d\u63a5\u89e6\u5f97\u6700\u591a\u7684\u3002\u8b6c\u5982\u5404\u79cd\u56fd\u4ea7 CA \u5382\u5546\u3001\u652f\u6301\u4e86\u56fd\u5bc6 TLS \u7684\u8bb8\u8bb8\u591a\u591a\u5bc6\u7801\u5e93\u548c\u6d4f\u89c8\u5668\uff0c\u4ee5\u53ca\u56fd\u5bc6\u63a5\u5165\u7684 VPN \u548c\u7f51\u5173\u7b49\u7b49\u3002\\n\\n## APISIX \u5bf9\u56fd\u5bc6\u7684\u63a2\u7d22\u4e0e\u652f\u6301\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u7cbe\u7ec6\u5316\u8def\u7531\u3001\u9650\u6d41\u9650\u901f\u3001\u670d\u52a1\u964d\u7ea7\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u6570\u767e\u9879\u529f\u80fd\u3002\u4f5c\u4e3a\u4e00\u4e2a\u53d1\u8ff9\u4e8e\u56fd\u5185\u73af\u5883\u7684 API \u7f51\u5173\uff0cAPISIX \u81ea\u7136\u9700\u8981\u8003\u8651\u4e0b\u5982\u4f55\u63a5\u5165\u56fd\u5bc6\u7684\u751f\u6001\u5708\u3002\\n\\n\u7531\u4e8e\u56fd\u5bc6\u66f4\u591a\u5730\u7528\u5728\u56fd\u5185\u73af\u5883\u4e2d\uff0c\u5c1a\u672a\u88ab OpenSSL \u7b49\u56fd\u9645\u4e3b\u6d41\u9879\u76ee\u6240\u5b8c\u5168\u63a5\u7eb3\u3002\u5982\u679c\u8981\u4f7f\u7528\u56fd\u5bc6\u7684\u529f\u80fd\uff0c\u5c31\u6d89\u53ca\u5230\u66f4\u6362 APISIX \u9ed8\u8ba4\u7684 OpenSSL \u5e93\u4e3a\u5176\u4ed6 SSL \u5e93\u3002\\n\\n\u4e3a\u6b64\uff0c\u6211\u4eec\u8003\u5bdf\u4e86\u4ee5\u4e0b\u7684\u9879\u76ee\uff1a\\n\\n* GMSSL\uff1a\u5317\u4eac\u5927\u5b66\u5f00\u6e90\u7684\u9879\u76ee\u3002\u539f\u7248\u57fa\u4e8e OpenSSL 1.0.2 \u4fee\u6539\u800c\u6765\u3002\u65b0\u7684 GMSSL 3.0 \u57fa\u672c\u4e0a\u662f\u91cd\u65b0\u5f00\u53d1\uff0c\u8ddf OpenSSL \u7684\u76ee\u5f55\u7ed3\u6784\u5dee\u522b\u5f88\u5927\u3002\\n* gm-BoringSSL\uff1a\u4e2a\u4eba\u5f00\u6e90\u9879\u76ee\uff0c\u5728 BoringSSL \u4e0a\u589e\u52a0\u56fd\u5bc6\u652f\u6301\u3002\u5df2\u6709\u4e24\u5e74\u672a\u6539\u52a8\u3002\\n* TaSSL\uff1a\u5317\u4eac\u6c5f\u5357\u5929\u5b89\u79d1\u6280\u6709\u9650\u516c\u53f8\u5f00\u6e90\u7684\u9879\u76ee\u3002\u57fa\u4e8e OpenSSL 1.1.1 \u4fee\u6539\u800c\u6765\u3002\\n* Tongsuo\uff1a\u8682\u8681\u96c6\u56e2\u5f00\u6e90\u7684\u9879\u76ee\u3002\u57fa\u4e8e OpenSSL 3.0 \u4fee\u6539\u800c\u6765\uff0c\u9879\u76ee\u524d\u8eab\u662f BabaSSL\uff0c\u73b0\u5df2**\u6539\u540d\u4e3a\u94dc\u9501/Tongsuo**\u3002\\n\u7531\u4e8e GMSSL 3.0 \u5e76\u4e0d\u57fa\u4e8e OpenSSL\uff0c\u5373\u4f7f\u80fd\u4fdd\u8bc1 API \u517c\u5bb9\uff0c\u4e5f\u6ca1\u529e\u6cd5\u786e\u4fdd\u80fd 100% \u66ff\u6362\u73b0\u6709 OpenSSL \u7684\u884c\u4e3a\uff0c\u6240\u4ee5\u88ab\u9996\u5148\u6392\u9664\u3002\u5176\u6b21 gm-BoringSSL \u758f\u4e8e\u7ef4\u62a4\uff0c\u4e5f\u88ab\u6392\u9664\u3002\\n\\n\u5728 TaSSL \u548c Tongsuo \u4e4b\u4e2d\uff0c\u6211\u503e\u5411\u4e8e\u9009\u62e9 [Tongsuo](https://github.com/Tongsuo-Project/Tongsuo)\u3002\u56e0\u4e3a Tongsuo \u5728\u6807\u51c6\u4e0a\u62e5\u6709\u66f4\u5f3a\u7684\u8bdd\u8bed\u6743\uff0c\u6bd4\u5982 RFC 8998\uff08TLS 1.3 \u4e2d\u652f\u6301 SM \u5957\u4ef6\uff09\u5c31\u662f\u7531 Tongsuo \u7684\u5f00\u53d1\u8005\u5236\u5b9a\u7684\u3002TaSSL \u5219\u662f\u6bcf\u51fa\u4e00\u4e2a\u7248\u672c\uff0c\u5c31\u516c\u5e03\u4e00\u4e2a\u65b0\u7684\u4ed3\u5e93\u3002\u6bd4\u5982[\u524d\u4e00\u4e2a \u7248\u672c](https://github.com/jntass/TASSL-1.1.1k)\uff0c\u611f\u89c9\u4e0d\u592a\u9760\u8c31\u3002\\n\\n\u5bf9\u4e8e\u9009\u62e9 Tongsuo\uff0c\u6211\u4e2a\u4eba\u5b58\u5728\u4e00\u4e2a\u987e\u8651\uff0c\u5c31\u662f\u4ed6\u76ee\u524d\u57fa\u4e8e OpenSSL 3.0 \u7684\u7248\u672c\u8fd8\u6ca1\u6709\u53d1\u5e03\u6b63\u5f0f\u7684 Release \u7248\u672c\uff08\u7b2c\u4e00\u4e2a\u7248\u672c\u9884\u8ba1\u5728 2023 \u5e74 2 \u6708\u53d1\u5e03\uff09\u3002\u7531\u4e8e Tongsuo \u5f53\u524d\u8fd8\u6ca1\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u7248\u672c\uff0c\u56e0\u6b64\u793e\u533a\u51b3\u5b9a\u5148\u628a\u56fd\u5bc6\u76f8\u5173\u7684\u529f\u80fd\u72ec\u7acb\u51fa\u6765\uff0c\u4ee5\u63d2\u4ef6\u5f62\u5f0f\u5b58\u5728\uff0c\u6709\u76f8\u5173\u9700\u6c42\u65f6\u53ef\u5355\u72ec\u542f\u7528\u3002\\n\\n\u76ee\u524d\u5df2\u5728\u63d2\u4ef6\u5c42\u9762\u5b9e\u73b0\u4e86\u670d\u52a1\u7aef\u4e00\u4fa7\u56fd\u5bc6\u53cc\u8bc1\u4e66\u7684\u652f\u6301\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u5728\u5b98\u7f51\u67e5\u770b `gm` [\u63d2\u4ef6\u4ecb\u7ecd\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/next/plugins/gm/)\uff0c\u81ea\u884c\u5b8c\u6210 APISIX \u7684\u7f16\u8bd1\u548c\u5bf9\u5e94\u63d2\u4ef6\u7684\u5b89\u88c5\u914d\u7f6e\u5de5\u4f5c\u3002\u5f53\u7136\uff0c\u5982\u679c\u60f3\u5373\u523b\u9884\u89c8\u8be5\u63d2\u4ef6\u7684\u4f7f\u7528\u8fc7\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u53c2\u8003\u4e0b\u6587\u5185\u5bb9\u3002\\n\\n## \u5feb\u901f\u53c2\u8003\uff1aAPISIX \u56fd\u5bc6\u63d2\u4ef6\u7684\u4f7f\u7528\\n\\n### \u542f\u7528\u63d2\u4ef6\\n\\n**\u63d2\u4ef6\u8981\u6c42 Apache APISIX \u8fd0\u884c\u5728\u7f16\u8bd1\u4e86 Tongsuo \u7684 APISIX-Base \u4e0a**\u3002\\n\\n\u9996\u5148\u9700\u8981\u5b89\u88c5 Tongsuo \uff08\u6b64\u5904\u6211\u4eec\u9009\u62e9\u7f16\u8bd1\u51fa Tongsuo \u7684\u52a8\u6001\u94fe\u63a5\u5e93\uff09\uff1a\\n\\n```bash\\n# TODO: use a fixed release once they have created one.\\n# See https://github.com/Tongsuo-Project/Tongsuo/issues/318\\ngit clone https://github.com/api7/tongsuo --depth 1\\npushd tongsuo\\n./config shared enable-ntls -g --prefix=/usr/local/tongsuo\\nmake -j2\\nsudo make install_sw\\n```\\n\\n\u5176\u6b21\u9700\u8981\u6784\u5efa APISIX-Base\uff0c\u8ba9\u5b83\u4f7f\u7528 Tongsuo \u4f5c\u4e3a SSL \u5e93\uff1a\\n\\n```bash\\nexport OR_PREFIX=/usr/local/openresty\\nexport openssl_prefix=/usr/local/tongsuo\\nexport zlib_prefix=$OR_PREFIX/zlib\\nexport pcre_prefix=$OR_PREFIX/pcre\\n\\nexport cc_opt=\\"-DNGX_LUA_ABORT_AT_PANIC -I${zlib_prefix}/include -I${pcre_prefix}/include -I${openssl_prefix}/include\\"\\nexport ld_opt=\\"-L${zlib_prefix}/lib -L${pcre_prefix}/lib -L${openssl_prefix}/lib64 -Wl,-rpath,${zlib_prefix}/lib:${pcre_prefix}/lib:${openssl_prefix}/lib64\\"\\n./build-apisix-base.sh\\n```\\n\\n\u8be5\u63d2\u4ef6\u9ed8\u8ba4\u662f\u7981\u7528\u72b6\u6001\uff0c\u4f60\u9700\u8981\u5c06\u5176\u6dfb\u52a0\u5230\u914d\u7f6e\u6587\u4ef6`./conf/config.yaml` \u4e2d\u624d\u53ef\u4ee5\u542f\u7528\u5b83\uff1a\\n\\n```yaml\\nplugins:\\n  - ...\\n  - gm\\n```\\n\\n\u7531\u4e8e APISIX \u7684\u9ed8\u8ba4 cipher \u4e2d\u4e0d\u5305\u542b\u56fd\u5bc6 cipher\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6 `./conf/config.yaml` \u4e2d\u8bbe\u7f6e cipher\uff1a\\n\\n```yaml\\napisix:\\n  ...\\n  ssl:\\n    ...\\n    # \u53ef\u6309\u5b9e\u9645\u60c5\u51b5\u8c03\u6574\u3002\u9519\u8bef\u7684 cipher \u4f1a\u5bfc\u81f4 \u201cno shared cipher\u201d \u6216 \u201cno ciphers available\u201d \u62a5\u9519\u3002\\n    ssl_ciphers: HIGH:!aNULL:!MD5\\n```\\n\\n\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u91cd\u65b0\u52a0\u8f7d APISIX\uff0c\u6b64\u65f6 APISIX \u5c06\u4f1a\u542f\u7528\u56fd\u5bc6\u76f8\u5173\u7684\u903b\u8f91\u3002\\n\\n## \u6d4b\u8bd5\u63d2\u4ef6\\n\\n\u5728\u6d4b\u8bd5\u63d2\u4ef6\u4e4b\u524d\uff0c\u9700\u8981\u51c6\u5907\u597d\u56fd\u5bc6\u53cc\u8bc1\u4e66\u3002Tongsuo \u63d0\u4f9b\u4e86[\u751f\u6210 SM2 \u53cc\u8bc1\u4e66](https://www.yuque.com/tsdoc/ts/sulazb)\u7684\u6559\u7a0b\u3002\\n\\n\u5728\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5c06\u7528\u5230\u5982\u4e0b\u7684\u8bc1\u4e66\uff1a\\n\\n```plain\\n# \u5ba2\u6237\u7aef\u52a0\u5bc6\u8bc1\u4e66\u548c\u5bc6\u94a5\\nt/certs/client_enc.crt\\nt/certs/client_enc.key\\n\\n# \u5ba2\u6237\u7aef\u7b7e\u540d\u8bc1\u4e66\u548c\u5bc6\u94a5\\nt/certs/client_sign.crt\\nt/certs/client_sign.key\\n\\n# CA \u548c\u4e2d\u95f4 CA \u6253\u5305\u5728\u4e00\u8d77\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u8bbe\u7f6e\u53d7\u4fe1\u4efb\u7684 CA\\nt/certs/gm_ca.crt\\n\\n# \u670d\u52a1\u7aef\u52a0\u5bc6\u8bc1\u4e66\u548c\u5bc6\u94a5\\nt/certs/server_enc.crt\\nt/certs/server_enc.key\\n\\n# \u670d\u52a1\u7aef\u7b7e\u540d\u8bc1\u4e66\u548c\u5bc6\u94a5\\nt/certs/server_sign.crt\\nt/certs/server_sign.key\\n```\\n\\n\u6b64\u5916\uff0c\u8fd8\u9700\u8981\u51c6\u5907 Tongsuo \u547d\u4ee4\u884c\u5de5\u5177\u3002\\n\\n```plain\\n./config enable-ntls -static\\nmake -j2\\n# \u751f\u6210\u7684\u547d\u4ee4\u884c\u5de5\u5177\u5728 apps \u76ee\u5f55\u4e0b\\nmv apps/openssl ..\\n```\\n\\n\u4f60\u4e5f\u53ef\u4ee5\u91c7\u7528\u975e\u9759\u6001\u7f16\u8bd1\u7684\u65b9\u5f0f\uff0c\u4e0d\u8fc7\u5c31\u9700\u8981\u6839\u636e\u5177\u4f53\u73af\u5883\uff0c\u81ea\u5df1\u89e3\u51b3\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u8def\u5f84\u95ee\u9898\u4e86\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u5728\u6307\u5b9a\u57df\u540d\u4e2d\u542f\u7528 `gm` \u63d2\u4ef6\u3002\\n\u8981\u5728\u6307\u5b9a\u57df\u540d\u4e2d\u542f\u7528 `gm` \u63d2\u4ef6\u7684\u529f\u80fd\uff0c\u9700\u8981\u5148\u521b\u5efa\u5bf9\u5e94\u7684 SSL \u5bf9\u8c61\uff1a\\n\\n```python\\n#!/usr/bin/env python\\n# coding: utf-8\\n\\nimport sys\\n# sudo pip install requests\\nimport requests\\n\\nif len(sys.argv) <= 3:\\n    print(\\"bad argument\\")\\n    sys.exit(1)\\nwith open(sys.argv[1]) as f:\\n    enc_cert = f.read()\\nwith open(sys.argv[2]) as f:\\n    enc_key = f.read()\\nwith open(sys.argv[3]) as f:\\n    sign_cert = f.read()\\nwith open(sys.argv[4]) as f:\\n    sign_key = f.read()\\napi_key = \\"edd1c9f034335f136f87ad84b625c8f1\\"\\nresp = requests.put(\\"http://127.0.0.1:9180/apisix/admin/ssls/1\\", json={\\n    \\"cert\\": enc_cert,\\n    \\"key\\": enc_key,\\n    \\"certs\\": [sign_cert],\\n    \\"keys\\": [sign_key],\\n    \\"gm\\": True,\\n    \\"snis\\": [\\"localhost\\"],\\n}, headers={\\n    \\"X-API-KEY\\": api_key,\\n})\\nprint(resp.status_code)\\nprint(resp.text)\\n```\\n\\n\u7136\u540e\u5c06\u4e0a\u9762\u7684\u811a\u672c\u4fdd\u5b58\u4e3a `./create_gm_ssl.py`\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\\n\\n```plain\\n./create_gm_ssl.py t/certs/server_enc.crt  t/certs/server_enc.key t/certs/server_sign.crt t/certs/server_sign.key\\n```\\n\\n\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff1a\\n\\n```plain\\n200\\n{\\"key\\":\\"\\\\/apisix\\\\/ssls\\\\/1\\",\\"value\\":{\\"keys\\":[\\"Yn...\\n```\\n\\n\u5b8c\u6210\u4e0a\u8ff0\u51c6\u5907\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u6d4b\u8bd5\u63d2\u4ef6\u662f\u5426\u542f\u7528\u6210\u529f\uff1a\\n\\n```plain\\n./openssl s_client -connect localhost:9443 -servername localhost -cipher ECDHE-SM2-WITH-SM4-SM3 -enable_ntls -ntls -verifyCAfile t/certs/gm_ca.crt -sign_cert t/certs/client_sign.crt -sign_key t/certs/client_sign.key -enc_cert t/certs/client_enc.crt -enc_key t/certs/client_enc.key\\n```\\n\\n\u5176\u4e2d\uff0c`./openssl` \u662f\u4e0a\u6587\u63d0\u5230\u7684 Tongsuo \u547d\u4ee4\u884c\u5de5\u5177\uff0c`9443` \u662f APISIX \u9ed8\u8ba4\u7684 HTTPS \u7aef\u53e3\u3002\\n\u5982\u679c\u4e00\u5207\u6b63\u5e38\uff0c\u53ef\u4ee5\u770b\u5230\u8fde\u63a5\u5df2\u7ecf\u5efa\u7acb\u4e86\u8d77\u6765\uff0c\u5e76\u8f93\u51fa\u5982\u4e0b\u4fe1\u606f\uff1a\\n\\n```plain\\n...\\nNew, NTLSv1.1, Cipher is ECDHE-SM2-SM4-CBC-SM3\\n...\\n```\\n\\n### \u7981\u7528\u63d2\u4ef6\\n\\n\u5982\u679c\u4e0d\u518d\u4f7f\u7528\u6b64\u63d2\u4ef6\uff0c\u53ef\u5c06 `gm` \u63d2\u4ef6\u4ece `./conf/config.yaml` \u914d\u7f6e\u6587\u4ef6\u4e2d\u79fb\u9664\uff0c\u7136\u540e\u91cd\u542f APISIX \u6216\u8005\u901a\u8fc7\u63d2\u4ef6\u70ed\u52a0\u8f7d\u7684\u63a5\u53e3\u89e6\u53d1\u63d2\u4ef6\u7684\u5378\u8f7d\u3002\\n\\n\u5982\u679c\u4f60\u5bf9\u8be5\u529f\u80fd\u6216\u8005\u63d2\u4ef6\u611f\u5174\u8da3\uff0c\u6b22\u8fce\u5728\u968f\u65f6\u5728\u793e\u533a\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"APISIX \u5728\u541b\u6da6\u4eba\u529b\u4e91\u539f\u751f\u5e73\u53f0\u7684\u67b6\u6784\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/12/07/junrunrenli-with-apisix","source":"@site/blog/2022/12/07/junrunrenli-with-apisix.md","title":"APISIX \u5728\u541b\u6da6\u4eba\u529b\u4e91\u539f\u751f\u5e73\u53f0\u7684\u67b6\u6784\u5b9e\u8df5","description":"\u672c\u6587\u4ece\u541b\u6da6\u4eba\u529b\u4e1a\u52a1\u5feb\u901f\u6269\u5f20\u7684\u80cc\u666f\u5165\u624b\uff0c\u91cd\u70b9\u4ecb\u7ecd\u5f00\u6e90 API \u7f51\u5173 APISIX \u5bf9\u5176\u81ea\u7814\u5e73\u53f0\u7cfb\u7edf\u67b6\u6784\u7684\u591a\u6837\u5316\u5e94\u7528\u573a\u666f\u652f\u6301\u3002","date":"2022-12-07T00:00:00.000Z","formattedDate":"2022\u5e7412\u67087\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":15.17,"truncated":true,"authors":[{"name":"\u8881\u9e4f"}],"prevItem":{"title":"Apache APISIX \u73a9\u8f6c Tongsuo \u56fd\u5bc6\u63d2\u4ef6","permalink":"/zh/blog/2022/12/08/apisix-support-tongsuo"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (11.21 - 12.04)","permalink":"/zh/blog/2022/12/04/weekly-report-1204"}},"content":"> \u672c\u6587\u4ece\u541b\u6da6\u4eba\u529b\u4e1a\u52a1\u5feb\u901f\u6269\u5f20\u7684\u80cc\u666f\u5165\u624b\uff0c\u91cd\u70b9\u4ecb\u7ecd\u5f00\u6e90 API \u7f51\u5173 APISIX \u5bf9\u5176\u81ea\u7814\u5e73\u53f0\u7cfb\u7edf\u67b6\u6784\u7684\u591a\u6837\u5316\u5e94\u7528\u573a\u666f\u652f\u6301\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u5206\u4eab\u5609\u5bbe\u8881\u9e4f\uff0c\u4e00\u9875\u79d1\u6280\u67b6\u6784\u5e08\\n\\n\u541b\u6da6\u4eba\u529b\u6210\u7acb\u4e8e 2019 \u5e74\uff0c\u662f\u4e00\u5bb6\u4ee5\u79d1\u6280\u9a71\u52a8\u7684\u4eba\u529b\u8d44\u6e90\u89e3\u51b3\u65b9\u6848\u670d\u52a1\u5546\uff0c\u4f9d\u6258\u884c\u4e1a\u9886\u5148\u7684\u79d1\u6280\u6c34\u5e73\u548c\u670d\u52a1\u80fd\u529b\uff0c\u4e13\u6ce8\u4e8e\u4e3a\u5ba2\u6237\u63d0\u4f9b\u4e00\u7ad9\u5f0f\u4eba\u529b\u8d44\u6e90\u670d\u52a1\u3002\u81ea\u7814\u6570\u5341\u5bb6\u4eba\u529b\u8d44\u6e90\u670d\u52a1\u5e73\u53f0\uff0c\u6df1\u5ea6\u94fe\u63a5 B \u7aef\u4f01\u4e1a\u548c C \u7aef\u7528\u6237\uff0c\u6784\u5efa\u6570\u5b57\u5316\u4eba\u529b\u8d44\u6e90\u670d\u52a1\u751f\u6001\u3002\\n\\n\u672c\u6587\u4ece\u541b\u6da6\u4eba\u529b\u4e1a\u52a1\u5feb\u901f\u6269\u5f20\u7684\u80cc\u666f\u5165\u624b\uff0c\u91cd\u70b9\u4ecb\u7ecd\u5f00\u6e90 API \u7f51\u5173 APISIX \u5bf9\u5176\u81ea\u7814\u5e73\u53f0\u7cfb\u7edf\u67b6\u6784\u7684\u591a\u6837\u5316\u5e94\u7528\u573a\u666f\u652f\u6301\uff0c\u5171\u6709\u56db\u5927\u7ebf\u4e0a\u5b9e\u6218\u6848\u4f8b\uff0c\u5e0c\u671b\u5bf9\u4ecd\u5728\u7f51\u5173\u9009\u578b\u8fc7\u7a0b\u4e2d\u7684\u4f01\u4e1a\u6216\u7528\u6237\u6709\u6240\u5e2e\u52a9\u3002\\n\\n![\u541b\u6da6\u4eba\u529b\u4e1a\u52a1](https://static.apiseven.com/2022/12/09/639291b9ce2a8.png)\\n\\n## \u541b\u6da6\u4eba\u529b\u81ea\u7814\u7cfb\u7edf\u67b6\u6784\u6982\u8ff0\\n\\n\u541b\u6da6\u4eba\u529b\u5728\u642d\u5efa\u81ea\u7814\u670d\u52a1\u5e73\u53f0\u67b6\u6784\u65f6\uff0c\u9996\u8981\u539f\u5219\u5c31\u662f\u201c\u5f00\u653e\u3001\u5f00\u6e90\u3001\u62e5\u62b1\u4e91\u539f\u751f\u201d\u3002\u5e73\u53f0\u57fa\u4e8e K8s \u5fae\u670d\u52a1\u67b6\u6784\u6784\u5efa\u4e91\u7aef\u7cfb\u7edf\uff0c\u6574\u4f53\u67b6\u6784\u53c2\u8003\u4e0b\u56fe\u3002\\n\\n![\u81ea\u7814\u670d\u52a1\u5e73\u53f0](https://static.apiseven.com/2022/12/09/639291ba824c6.png)\\n\\n\u53ef\u4ee5\u770b\u5230\uff0c\u541b\u6da6\u81ea\u7814\u670d\u52a1\u5e73\u53f0 DevOps \u6d41\u7a0b\uff08\u53f3\u4fa7\uff09\u4f9d\u6258 Git webhook\u3001CODING\u3001K8s \u96c6\u7fa4\u5b9e\u73b0\u5168\u81ea\u52a8\u5316\u4e0e\u65e0\u611f\u53d1\u5e03\uff0c\u4e1a\u52a1\u7cfb\u7edf\u57fa\u4e8e PaaS \u5e73\u53f0\u8fdb\u884c\u8fed\u4ee3\u5f00\u53d1\uff0c\u786e\u4fdd\u7814\u53d1\u89c4\u8303\uff0c\u5e76\u8fbe\u6210\u6280\u672f\u6808\u7684\u7edf\u4e00\u3002\uff08\u4e0a\u4fa7\uff09\u5728\u76d1\u63a7\u624b\u6bb5\u4e0a\uff0c\u7cfb\u7edf\u96c6\u6210\u4e86 sky-agent \u548c arthas\uff0c\u6ee1\u8db3\u4e86\u7ebf\u4e0a\u670d\u52a1\u89c2\u6d4b\u591a\u7ef4\u5ea6\u7684\u9700\u6c42\u3002\u4e0e\u6b64\u540c\u65f6\uff0c\u91c7\u7528\u817e\u8baf\u65e5\u5fd7\u4e91\u4e0e K8s \u7ed3\u5408\u7684\u65b9\u5f0f\u5c06\u670d\u52a1\u65e5\u5fd7\u5b58\u50a8\u5728\u4e91\u4e0a\uff0c\u5b9e\u73b0 K8s \u96c6\u7fa4\u5185\u65e0\u6587\u4ef6\u5316\u670d\u52a1\uff0c\u907f\u514d\u78c1\u76d8\u5bb9\u91cf\u5806\u79ef\u4ece\u800c\u5f71\u54cd\u5230 K8s \u96c6\u7fa4\u5355\u4e2a\u8282\u70b9\u7684\u5065\u5eb7\u3002\\n\\n\u67b6\u6784\u56fe\u7684\u5de6\u4fa7\uff0c\u662f\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u6700\u91cd\u8981\u7684\u73af\u8282 -- \u6d41\u91cf\u7ba1\u7406\u3002\u6240\u6709\u6d41\u91cf\u4f1a\u901a\u8fc7 WAF\uff08Web Application Firewall\uff0cWeb \u5e94\u7528\u9632\u706b\u5899\uff0c\u8d1f\u8d23\u7f51\u7edc\u5b89\u5168\uff09\u8fdb\u5165\u4e09\u5c42\u7f51\u7edc\u91cc\u9762\u7684\u7b2c\u4e00\u5c42 CLB\uff0c\u5b83\u4e3b\u8981\u8d1f\u8d23\u6d41\u91cf\u7684\u8f6c\u53d1\uff1b\u7b2c\u4e8c\u5c42\u5c31\u662f\u4e91\u539f\u751f\u7f51\u5173 APISIX\uff0c\u5b83\u627f\u62c5\u4e86\u4e1a\u52a1\u7cfb\u7edf\u7684\u5185\u90e8\u670d\u52a1\u6cbb\u7406\uff1b\u7b2c\u4e09\u5c42\u5219\u662f\u4e1a\u52a1\u7cfb\u7edf\u7684 Gateway \u5e94\u7528\u5185\u90e8\u7684\u7f51\u5173\uff0c\u8d1f\u8d23\u5355\u7cfb\u7edf\u9274\u6743\u548c\u8def\u7531\u3002\\n\\n\u5176\u4e2d\u7b2c\u4e00\u5c42\u7684 CLB \u548c\u7b2c\u4e8c\u5c42\u7684 APISIX \u5c24\u5176\u91cd\u8981\uff0c\u5b83\u662f\u6240\u6709\u7cfb\u7edf\u7684\u5165\u53e3\uff0c\u4e00\u65e6\u51fa\u73b0\u95ee\u9898\uff0c\u90a3\u4e48\u6240\u6709\u7cfb\u7edf\u5c06\u65e0\u6cd5\u88ab\u8bbf\u95ee\u3002CLB \u91c7\u7528\u7684\u662f\u817e\u8baf\u4e91\u670d\u52a1\uff0c\u7a33\u5b9a\u6027\u3001\u6269\u5c55\u6027\u4e0e\u6297\u5e76\u53d1\u6027\u80fd\u90fd\u6bd4\u8f83\u9ad8\uff0c\u4e1a\u52a1\u67b6\u6784\u9700\u8981\u89e3\u51b3\u7684\u662f\u7b2c\u4e8c\u5c42\u4e91\u539f\u751f\u7f51\u5173 APISIX\uff0c\u4fdd\u8bc1\u5b83\u7684\u9ad8\u53ef\u7528\u3002\\n\\nAPISIX-Service \u88ab\u90e8\u7f72\u5728 K8s \u96c6\u7fa4\u5185\u90e8\uff0cK8s \u96c6\u7fa4\u91c7\u7528\u7684\u662f\u817e\u8baf\u4e91\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u51fa\u73b0\u95ee\u9898\u540e\u80fd\u591f\u5feb\u901f\u6062\u590d\uff0c\u7cfb\u7edf\u5916\u7f6e\u4e86 etcd \u96c6\u7fa4\uff0c\u4f7f\u6570\u636e\u5f97\u4ee5\u4fdd\u7559\uff0c\u8fd9\u662f APISIX \u96c6\u7fa4\u9ad8\u53ef\u7528\u7684\u4f53\u73b0\u3002\\n\\n\u90a3\u4e48\uff0c\u5982\u4f55\u6765\u4fdd\u8bc1 APISIX \u7684\u9ad8\u5e76\u53d1\u548c\u9ad8\u6027\u80fd\uff1f\u8fd9\u91cc\u7cfb\u7edf\u5229\u7528\u4e86 K8s \u7684\u673a\u5236\uff0c\u5f53 APISIX \u8fdb\u884c\u8def\u7531\u8f6c\u53d1\u65f6\uff0c\u901a\u8fc7 K8s \u7684\u670d\u52a1\u540d + \u670d\u52a1\u7aef\u53e3\u4f7f\u5b83\u5728\u540c\u4e00\u4e2a\u7f51\u6bb5\u5185\u8df3\u8f6c\uff1b\u56e0\u4e3a\u7f51\u5173\u670d\u52a1\u90e8\u7f72\u5728 K8s \u5185\u90e8\uff0c\u4f9d\u6258\u4e8e K8s \u7684\u7279\u6027\uff0c\u53ef\u4ee5\u8fdb\u884c\u6eda\u52a8\u5347\u7ea7\uff0c\u8fdb\u800c\u8fbe\u5230 APISIX \u7f51\u5173\u5347\u7ea7\u7684\u65e0\u611f\u53d1\u5e03\u3002\\n\\n\u901a\u8fc7\u8be5\u67b6\u6784\u56fe\u4e0d\u96be\u53d1\u73b0\uff0c\u7b2c\u4e8c\u5c42\u662f\u6240\u6709\u6d41\u91cf\u7684\u5165\u53e3\uff0c\u9009\u62e9\u4e00\u4e2a\u6ee1\u8db3\u4e1a\u52a1\u6269\u5f20\u9700\u6c42\u7684\u4e91\u539f\u751f\u7f51\u5173\uff0c\u5bf9\u6211\u4eec\u6765\u8bf4\u81f3\u5173\u91cd\u8981\uff0c\u4e0b\u9762\u8c08\u8c08\u5728\u7f51\u5173\u6280\u672f\u9009\u578b\u65f6\u7684\u4e3b\u8981\u601d\u8003\u3002\\n\\n## \u6280\u672f\u7f51\u5173\u9009\u578b\u75db\u70b9\\n\\n- \u6570\u91cf\u5e9e\u5927\u7684\u4e1a\u52a1\u7cfb\u7edf\u3002\u6211\u4eec\u5728\u4eba\u529b\u8d44\u6e90\u8fd9\u4e2a\u9886\u57df\u6709 15+ \u670d\u52a1\u5e73\u53f0\uff0c\u751f\u6001\u4e1a\u52a1\u591a\u6837\u5316\uff0c\u9762\u4e34\u7684\u95ee\u9898\u4e5f\u6bd4\u8f83\u591a\uff0c\u670d\u52a1\u8bf7\u6c42\u9700\u8981\u9891\u7e41\u53d8\u66f4\uff0c\u5bfc\u81f4\u9700\u8981\u64cd\u4f5c\u548c\u914d\u7f6e\u7684\u8def\u7531\u4e5f\u975e\u5e38\u591a\u3002\u539f\u6765\u6211\u4eec\u662f\u57fa\u4e8e CLB \u8fdb\u884c\u6d41\u91cf\u8f6c\u53d1\uff0c\u4e45\u800c\u4e45\u4e4b\uff0c\u8fd0\u7ef4\u4eba\u5458\u9700\u8981\u914d\u7f6e\u548c\u64cd\u4f5c\u7684\u5730\u65b9\u975e\u5e38\u591a\uff0c\u8017\u8d39\u4e86\u5927\u91cf\u7684\u4eba\u529b\u4e0e\u65f6\u95f4\u3002\\n\\n- \u9891\u7e41\u7684\u9ad8\u5e76\u53d1\u5927\u6d41\u91cf\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5ba2\u6237\u96c6\u4e2d\u5728\u540c\u4e00\u5929\u53d1\u85aa\u6216\u63d0\u73b0\u5927\u989d\u8d44\u91d1\u3002\u5728\u7528\u6237\u6570\u91cf\u8fbe\u5230\u5927\u51e0\u5341\u4e07\u65f6\uff0c\u96c6\u4e2d\u8fdb\u884c\u7684\u67d0\u4e9b\u884c\u4e3a\uff0c\u5982\u6253\u5361\u3001\u7b7e\u7ea6\u3001\u9886\u53d6\u4efb\u52a1\u6216\u5de5\u8d44\u7b49\uff0c\u6b64\u65f6\u7cfb\u7edf\u5e76\u53d1\u6d41\u91cf\u975e\u5e38\u5927\uff0c\u77ed\u671f\u7ffb\u500d\u7684\u60c5\u51b5\u6bd4\u6bd4\u7686\u662f\u3002\\n\\n- \u4e2a\u6027\u5316\u9700\u6c42\u7684\u6269\u5f20\u538b\u529b\u3002APISIX \u662f\u57fa\u4e8e OpenResty\u3001NGINX \u548c Lua \u5f00\u53d1\u7684\uff0c\u4f46\u5982\u679c\u7528 Lua \u6765\u5f00\u53d1\u63d2\u4ef6\uff0c\u4f1a\u6709\u4e00\u5b9a\u7684\u7814\u53d1\u6295\u5165\u548c\u7ef4\u62a4\u6210\u672c\u3002\\n\\n\u5bf9\u4e8e\u63d2\u4ef6\u8fd9\u5757\uff0cAPISIX \u5df2\u7ecf\u63d0\u524d\u505a\u597d\u4e86\u51c6\u5907\u3002APISIX \u7684\u5b98\u7f51\u63d0\u4f9b\u4e86\u81ea\u5b9a\u4e49\u63d2\u4ef6 ext-plugin \u6765\u652f\u6301 Java \u5f00\u53d1\uff0c\u6211\u4eec\u7684\u6280\u672f\u6808\u95ee\u9898\u6070\u597d\u8fce\u5203\u800c\u89e3\u3002\u6b64\u5916 APISIX \u7684\u751f\u6001\u975e\u5e38\u597d\uff0c\u4f5c\u4e3a\u56fd\u4ea7\u7f51\u5173\u4ea7\u54c1\uff0c\u793e\u533a\u6781\u5176\u6d3b\u8dc3\uff0c\u4e1a\u5185\u5b9e\u8df5\u8fd8\u7279\u522b\u591a\uff0c\u5728\u4e91\u539f\u751f\u7f51\u5173\u8fd9\u5c42\u6765\u8bf4\uff0c\u4e1a\u5185\u4e5f\u662f\u9876\u7ea7\u5b58\u5728\u3002\\n\\n\u6211\u4eec\u7684\u56e2\u961f\u975e\u5e38\u5f00\u653e\uff0c\u5f53\u6211\u4eec\u505a\u5b8c\u6280\u672f\u9009\u578b\u540e\uff0c\u5feb\u901f\u5b9e\u8df5\u843d\u5730\uff0c\u4ece\u4e0a\u7ebf\u90e8\u7f72\u5230\u670d\u52a1\u5206\u6279\u6b21\u63a5\u5165\uff0c\u8017\u65f6\u4e0d\u5230 1 \u4e2a\u6708\u65f6\u95f4\uff0c\u6211\u4eec\u76ee\u524d 99% \u7684\u670d\u52a1\u90fd\u662f\u901a\u8fc7 APISIX \u8bbf\u95ee\uff0c\u4e0a\u7ebf\u4e00\u5e74\u591a\u81f3\u4eca\u96f6\u4e8b\u6545\uff0c\u7a33\u5b9a\u6027\u975e\u5e38\u597d\u3002\u4e0b\u9762\u8fd9\u5f20\u56fe\u91cc\uff0c\u5927\u5bb6\u80fd\u770b\u5230 APISIX \u7684\u4e00\u4e9b\u7279\u6027\uff0c\u5176\u4e2d\u7ea2\u5b57\u90e8\u5206\u662f\u6211\u4eec\u6700\u770b\u91cd\u7684\u70b9\u3002\\n\\n![APISIX \u7279\u6027](https://static.apiseven.com/2022/12/09/639291bb06396.png)\\n\\n## APISIX \u56db\u5927\u5b9e\u8df5\u573a\u666f\\n\\n![\u56db\u5927\u5b9e\u8df5\u573a\u666f](https://static.apiseven.com/2022/12/09/639291bbbbfe0.png)\\n\\n### \u8def\u7531\u7b56\u7565\\n\\nApache APISIX \u57fa\u4e8e Radixtree \u548c etcd \u63d0\u4f9b\u8def\u7531\u6781\u901f\u5339\u914d\u4e0e\u914d\u7f6e\u5feb\u901f\u540c\u6b65\u7684\u80fd\u529b\u3002\u8def\u7531\u548c\u63d2\u4ef6\u7684\u8bbe\u8ba1\u5b9e\u73b0\u90fd\u6ee1\u8db3\u4e86\u6781\u901f\u6027\u80fd\u548c\u8d85\u4f4e\u5ef6\u8fdf\u7684\u9700\u6c42\u3002\u6bd4\u5982\u4ee5\u4e0b\u4e24\u4e2a\u573a\u666f\u4e2d\uff0c\u90fd\u8868\u73b0\u51fa\u4e86\u4e0d\u9519\u7684\u6027\u80fd\uff1a\\n\\n- \u4e1a\u52a1\u7cfb\u7edf\u5904\u5728\u9ad8\u5cf0\u671f\u65f6\uff0c\u7528\u6237\u5bfc\u51fa\u767e\u4e07\u6570\u91cf\u7ea7\u7684\u62a5\u8868\u6570\u636e\uff0c\u4f1a\u4f7f MySQL \u6570\u636e\u5e93\u76f4\u63a5\u5b95\u673a\uff0c\u6b64\u65f6\u91cd\u542f\u670d\u52a1\u4e5f\u65e0\u6cd5\u89e3\u51b3\uff0c\u7528\u6237\u7ee7\u7eed\u5bfc\u51fa\u64cd\u4f5c\u4f1a\u6301\u7eed\u6545\u969c\uff0c\u8fd9\u4e2a\u95ee\u9898\u4ee5\u524d\u6211\u4eec\u5f97\u53d1\u7248\u624d\u80fd\u89e3\u51b3\uff1b\u800c\u73b0\u5728\u53ea\u9700\u8981\u8fd0\u7ef4\u4eba\u5458\u7b80\u5355\u914d\u7f6e\u4e00\u756a\uff0c\u5c31\u53ef\u4ee5\u505a\u5230 API \u7d27\u6025\u505c\u7528\uff0c\u901a\u8fc7\u8def\u7531\u4f18\u5148\u7ea7\u7b56\u7565\u548c\u5931\u6548\u7b56\u7565\uff08\u4f9d\u6258 Serverless \u63d2\u4ef6\uff09\uff0c\u914d\u5408\u4f7f API \u63a5\u53e3\u5728\u5206\u949f\u7ea7\u4e0b\u7ebf\uff0c\u4ece\u800c\u4fdd\u8bc1\u670d\u52a1\u7684\u7a33\u5b9a\u3002\\n\\n- \u6211\u4eec\u4e1a\u52a1\u7cfb\u7edf\u975e\u5e38\u591a\uff0c\u5176\u4e2d SaaS \u7cfb\u7edf\u9700\u8981\u652f\u6301\u5ba2\u6237\u81ea\u5b9a\u4e49\u57df\u540d\u8bbf\u95ee\uff0c\u6211\u4eec\u91c7\u7528\u4e86\u6cdb\u57df\u540d\u5339\u914d\uff0c\u505a\u5230\u4e00\u6b21\u914d\u7f6e\uff0c\u5168\u5c40\u901a\u7528\u3002\\n\\n\u4e0b\u56fe\u662f\u541b\u6da6\u4eba\u529b 2022 \u5168\u5e74\u5ea6\u8def\u7531\u589e\u957f\u8d8b\u52bf\u56fe\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4e0d\u8bba\u524d\u7aef\u8fd8\u662f\u540e\u7aef\u8def\u7531\uff0c\u5728\u5f15\u5165 APISIX \u4e4b\u540e\uff0c\u90fd\u5b9e\u73b0\u4e86\u4e09\u500d\u6216\u4ee5\u4e0a\u7684\u6570\u91cf\u589e\u957f\u3002\\n\\n![2022\u589e\u957f](https://static.apiseven.com/2022/12/09/639291bc3c66a.png)\\n\\n### \u5b89\u5168\u63a7\u5236\\n\\n![PaaS \u670d\u52a1\u7f51\u5173](https://static.apiseven.com/2022/12/09/639291bb5f479.png)\\n\\n\u5728\u5b89\u5168\u63a7\u5236\u8fd9\u5757\uff0c\u6211\u4eec\u57fa\u4e8e APISIX \u505a\u4e86\u53cc\u5c42\u7f51\u5173\u67b6\u6784\uff0c\u5728 APISIX \u4e0a\u9694\u79bb\u51fa\u4e00\u4e2a\u903b\u8f91\u7f51\u5173\uff0c\u7528\u6237\u8bbf\u95ee CLB \u8fdb\u6765 APISIX \u518d\u8f6c\u53d1\u5230\u4e1a\u52a1\u7cfb\u7edf\uff1b\u5982\u679c\u7528\u6237\u4f7f\u7528\u7684\u8fd9\u4e2a\u529f\u80fd\u9700\u8981\u7528\u5230 PaaS\uff0c\u5c31\u4f1a\u901a\u8fc7 PaaS \u670d\u52a1\u7f51\u5173\u8fdb\u884c\u8bbf\u95ee\uff0c\u6b64\u65f6 PaaS \u670d\u52a1\u7f51\u5173\u5c31\u662f\u4e00\u4e2a\u903b\u8f91\u7f51\u5173\u3002\\n\\n\u6211\u4eec\u5728 K8s \u5185\u90e8\u5c01\u95ed\u4e86\u4e00\u4e2a\u533a\u57df\uff0c\u5373 PaaS \u5e73\u53f0\uff0c\u91cc\u9762\u5305\u542b\u5927\u91cf\u7684\u57fa\u7840\u670d\u52a1\u3002\u5229\u7528 APISIX \u7f51\u5173\u7684\u7279\u6027--\u7194\u65ad\u3001\u5b89\u5168\u3001\u8eab\u4efd\u8bc6\u522b\uff0c\u4f7f\u4e0a\u5c42\u4e1a\u52a1\u7cfb\u7edf\u8bbf\u95ee PaaS \u670d\u52a1\u90fd\u9700\u8981\u901a\u8fc7 PaaS \u7f51\u5173\u3002\\n\\n### \u6d41\u91cf\u7ba1\u7406\\n\\n\u7531\u4e8e\u4e1a\u52a1\u7cfb\u7edf\u6570\u91cf\u8f83\u591a\uff0c \u6838\u5fc3\u670d\u52a1\uff08SSO\u3001PaaS \u670d\u52a1\u548c\u53d1\u85aa\u670d\u52a1\uff09\u53ef\u7528\u6027\u8981\u6c42\u9ad8\uff0c \u8fd9\u4e9b\u670d\u52a1\u7684\u6d41\u91cf\u7ba1\u63a7\u9700\u8981\u4f9d\u8d56 APISIX \u63d0\u4f9b\u7684\u6d41\u91cf\u7ba1\u7406\u7070\u5ea6\u7b56\u7565\u3002\\n\\n\u4e3a\u6b64\uff0c\u6211\u4eec\u5185\u90e8\u91c7\u7528\u4e86\u4e24\u79cd\u65b9\u5f0f\u8fdb\u884c\u3002\u7b2c\u4e00\u79cd\u662f\u57fa\u4e8e\u6807\u7b7e\u7070\u5ea6\uff0c \u6838\u5fc3\u670d\u52a1\u4e0a\u5230\u751f\u4ea7\u73af\u5883\u4e4b\u524d\uff0c\u6d4b\u8bd5\u4eba\u5458\u5148\u5728\u7070\u5ea6\u73af\u5883\u9a8c\u8bc1\uff0c\u6211\u4eec\u4f1a\u5c06\u6d4b\u8bd5\u7528\u6237\u6d41\u91cf\u8f6c\u53d1\u5230\u7070\u5ea6\u670d\u52a1\uff0c\u8fdb\u884c\u751f\u4ea7\u73af\u5883\u9a8c\u8bc1\uff1b\u9a8c\u8bc1\u901a\u8fc7\u540e\u518d\u57fa\u4e8e\u6743\u91cd\u5207\u5165\u6d41\u91cf\uff0c\u89c2\u5bdf\u4e00\u6bb5\u65f6\u95f4\uff0c\u6ca1\u95ee\u9898\u540e\u518d\u628a\u5168\u90e8\u6d41\u91cf\u5207\u6362\u5230\u65b0\u7248\u672c\u3002\\n\u7b2c\u4e8c\u79cd\u662f\u751f\u4ea7\u73af\u5883\u5185\uff0c\u76f8\u540c\u7684\u670d\u52a1\u5e76\u5b58\u591a\u4e2a\u7248\u672c\uff0c\u4e0d\u540c\u7684\u4e1a\u52a1\u7cfb\u7edf\u8bbf\u95ee\u4e0d\u540c\u7684\u7248\u672c\u65f6\uff0c\u57fa\u4e8e\u6807\u7b7e\u8fdb\u884c\u8def\u7531\u8f6c\u53d1\u3002\\n\\n![\u7070\u5ea6\u7b56\u7565](https://static.apiseven.com/2022/12/09/639291b99687a.png)\\n\\n### \u65e5\u5fd7\u7ba1\u7406\\n\\n\u4ece\u4e0b\u56fe\u7684\u67b6\u6784\u6a21\u5f0f\u53ef\u4ee5\u770b\u51fa\uff0cAPISIX \u548c Pod \u670d\u52a1\u90fd\u57fa\u4e8e K8s \u67b6\u6784\uff0c\u6240\u6709\u540e\u7aef\u8def\u7531\u90fd\u88ab\u7ed1\u5b9a\u5728\u540c\u4e00\u670d\u52a1\u4e0a\uff0c\u5728 APISIX \u670d\u52a1\u4e0a\u914d\u7f6e\u7684 Kafka \u63d2\u4ef6\u7528\u6765\u91c7\u96c6\u65e5\u5fd7\u6570\u636e\uff0c\u540c\u65f6\u914d\u7f6e\u4e86 Skywalking \u76d1\u63a7\u7a0b\u5e8f\u6027\u80fd\u3002\u6839\u636e RequestId \u548c TraceId \u5728 Skywalking \u548c\u65e5\u5fd7\u4e91\uff0c\u6211\u4eec\u53ef\u4ee5\u89c2\u6d4b\u5230\u6574\u4e2a\u8c03\u7528\u94fe\u8def\uff0c\u5e76\u67e5\u770b\u6bcf\u4e2a\u73af\u8282\u7684\u65e5\u5fd7\u8bb0\u5f55\u548c API \u8bf7\u6c42\u8017\u65f6\u3002\\n\\n![\u65e5\u5fd7\u7ba1\u7406](https://static.apiseven.com/2022/12/09/639291b9cb5c5.png)\\n\\n\u4ece\u76ee\u524d\u89c2\u6d4b\u5230\u7684\u6570\u636e\u6765\u770b\uff0c\u7cfb\u7edf\u6bcf\u5929\u90fd\u6709\u4e0a\u5343\u4e07\u6b21\u7684 API \u8bf7\u6c42\uff0c\u5e73\u5747\u6bcf\u5929\u4ea7\u751f\u7684\u65e5\u5fd7\u6570\u636e\u8fbe\u5230 30G \uff0c\u65e5\u5fd7\u603b\u91cf\u8fbe\u5230 TB \u7ea7\u3002\\n\\n## \u4f7f\u7528 APISIX \u7684\u7ecf\u9a8c\u4e0e\u5c55\u671b\\n\\n\u5728\u4f7f\u7528 APISIX \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u603b\u7ed3\u4e86\u4e00\u4e9b\u7ecf\u9a8c\u4e4b\u8c08\uff0c\u5728\u8fd9\u91cc\u5206\u4eab\u7ed9\u5bf9 APISIX \u611f\u5174\u8da3\u7684\u670b\u53cb\u4eec\u3002\\n\\n- \u6784\u5efa\u57fa\u7840\u955c\u50cf\u9700\u8981\u62c9\u53d6\u56fd\u5916\u8d44\u6e90\u3002\u7531\u4e8e\u6211\u4eec APISIX \u9700\u8981\u90e8\u7f72\u5728 K8s \u5185\u90e8\uff0c\u6211\u4eec\u5185\u90e8\u4f1a\u8fdb\u884c\u4e00\u5b9a\u7684\u4e8c\u6b21\u5f00\u53d1\u548c\u6e90\u7801\u7f16\u8bd1\uff0c\u8fd9\u65f6\u9700\u8981\u5230 GitHub \u4e0a\u62c9\u53d6\u8d44\u6e90\uff0c\u76ee\u524d\u5b98\u65b9\u63d0\u4f9b\u7684 Docker \u955c\u50cf\u6709\u4e00\u90e8\u5206\u9700\u8981\u62c9\u53d6\u56fd\u5916\u8d44\u6e90\uff0c\u5728\u8fdb\u884c\u672c\u5730\u5f00\u53d1\u548c\u7ebf\u4e0a\u90e8\u7f72\u65f6\uff0c\u73af\u5883\u8c03\u8bd5\u76f8\u5bf9\u9ebb\u70e6\u3002\\n\\n- \u8c03\u8bd5\u73af\u5883\u90e8\u7f72\u6709\u8981\u6c42\u3002\u81ea\u5b9a\u4e49\u63d2\u4ef6 `java-plugin-runner`\uff0c\u9700\u8981\u57fa\u4e8e `runner.sock` \u8fdb\u884c RPC \u901a\u8baf\uff0c\u73b0\u6709\u6848\u4f8b\u8f83\u5c11\uff0c\u8c03\u8bd5\u8d77\u6765\u6709\u4e00\u5b9a\u56f0\u96be\uff0c\u5b83\u9700\u8981\u548c APISIX-Service \u5728\u540c\u4e00\u4e2a\u955c\u50cf\u5185\u3002\\n\\n- \u6bcf\u5929\u4ea7\u751f\u5927\u91cf\u7684\u65e5\u5fd7\u8bb0\u5f55\u5230\u672c\u5730\u3002\u521a\u521a\u53d1\u5e03\u751f\u4ea7\u65f6\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u5c31\u7b97\u53ea\u5f00\u542f error \u7ea7\u522b\u65e5\u5fd7\uff0c\u6bcf\u5929\u7684\u589e\u957f\u6570\u91cf\u90fd\u975e\u5e38\u5927\uff0c\u5bfc\u81f4 K8s \u96c6\u7fa4\u4e2d\u4e00\u4e2a\u8282\u70b9\u78c1\u76d8\u544a\u8b66\u3002\u540e\u9762\u6211\u4eec\u6253\u5305\u955c\u50cf\u65f6\u5c06\u65e5\u5fd7\u7531\u6587\u4ef6\u8bb0\u5f55\u6539\u53d8\u4e3a\u8f93\u51fa\u81f3\u63a7\u5236\u53f0\uff0c\u6536\u96c6\u81f3\u4e91\u65e5\u5fd7\u670d\u52a1 CLS \u5b58\u50a8\u8bb0\u5f55\u5206\u6790\uff0c\u5b9e\u73b0\u672c\u5730\u65e0\u6587\u4ef6\u5316\u5b58\u50a8\u3002\\n\\n\u5f53\u7136\uff0c\u4ee5\u4e0a\u90fd\u5c5e\u4e8e\u524d\u671f\u51c6\u5907\u5de5\u4f5c\u4e0a\u7684\u5fc5\u7ecf\u4e4b\u8def\uff0c\u5728\u6b63\u5f0f\u6295\u5165\u4f7f\u7528\u540e\uff0cAPISIX \u7ed9\u6211\u4eec\u5e26\u6765\u7684\u6536\u76ca\u8fdc\u8fdc\u5927\u4e8e\u671f\u671b\uff0c\u603b\u4f53\u6709\u4ee5\u4e0b\u4e09\u70b9\uff1a\\n\\n1. \u5bf9\u4e1a\u52a1\u53d1\u5c55\u8d77\u5230\u4e86\u5f3a\u6709\u529b\u7684\u652f\u6491\u3002\u4f7f\u7528 APISIX \u540e\uff0c\u6211\u4eec\u7684\u7cfb\u7edf\u529f\u80fd\u66f4\u52a0\u4e30\u5bcc\uff0c\u6027\u80fd\u66f4\u52a0\u5f3a\u52b2\u3002APISIX \u5bf9 API \u670d\u52a1\u63d0\u4f9b\u4e86\u591a\u79cd\u53ef\u89c2\u6d4b\u6027\u548c\u5b89\u5168\u9632\u62a4\u624b\u6bb5\uff0c\u53ef\u4ee5\u652f\u6301\u6211\u4eec\u6bcf\u5929\u5343\u4e07\u6b21\u6d41\u91cf\u7684\u8bbf\u95ee\u3002\\n\\n2. \u52a9\u529b\u7814\u53d1\u4ea4\u4ed8\u6548\u7387\u3002\u6bd4\u5982\u539f\u6765\u914d\u7f6e DNS \u89e3\u6790\u9700\u8981 10 \u5206\u949f\u624d\u80fd\u751f\u6548\uff0c\u800c\u73b0\u5728\u901a\u8fc7\u6cdb\u57df\u540d\u914d\u7f6e\uff0c\u51e0\u79d2\u949f\u5c31\u80fd\u751f\u6548\uff1b\u56e0\u4e3a\u539f\u5148\u9700\u8981\u5728 CLB \u548c NGINX \u4e24\u4e2a\u5730\u65b9\u624b\u52a8\u4fee\u6539\u914d\u7f6e\uff0c\u800c\u6211\u4eec\u6709 10 \u591a\u4e2a\u7cfb\u7edf\u3001100 \u591a\u4e2a\u670d\u52a1\uff0c\u9700\u8981\u914d\u7f6e\u7684\u70b9\u5f88\u591a\uff0c\u5e94\u7528\u4e86 APISIX \u7684\u6cdb\u57df\u540d\u914d\u7f6e\u540e\uff0c\u73b0\u5728\u53ea\u9700\u8981\u5728\u63a7\u5236\u9762\u677f\u4e0a\u4fee\u6539\uff0c\u6781\u5927\u5730\u51cf\u5c11 DevOps \u5de5\u4f5c\u91cf\u3002\\n\\n3. \u5927\u5e45\u964d\u4f4e\u6210\u672c\u3002LB \uff08\u8d1f\u8f7d\u5747\u8861\uff09\u6210\u672c\u7684\u53d8\u5316\u3002LB \u670d\u52a1\u6570\u91cf\u7531 200+ \u7f29\u51cf\u5230\u4e86 10+\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u7cfb\u7edf\u7ef4\u62a4\u6210\u672c\u3002\\n\\n\u540e\u671f\u6211\u4eec\u8fd8\u4f1a\u6709\u4e00\u7cfb\u5217\u9700\u8981\u501f\u52a9 APISIX \u4e91\u539f\u751f\u7f51\u5173\u8fbe\u6210\u7684\u529f\u80fd\u5f00\u53d1\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u96c6\u6210 Sentinel \u4f7f\u670d\u52a1\u5177\u5907\u70ed\u63d2\u62d4\u52a8\u6001\u9650\u6d41\u529f\u80fd\u3001\u5f00\u53d1\u591a\u7ef4\u5ea6\u6d41\u91cf\u63a7\u5236\u3001\u98ce\u63a7\u8bc6\u522b\u529f\u80fd\u5347\u7ea7\u3001\u5206\u5c42\u6cbb\u7406\u548c\u5168\u94fe\u8def\u65e5\u5fd7\u5206\u6790\u7b49\u7b49\u3002\u5c4a\u65f6\u5c06\u91c7\u7528\u591a\u5957 APISIX \u96c6\u7fa4\u6765\u6ee1\u8db3\u81ea\u7814\u670d\u52a1\u5e73\u53f0\u7684\u529f\u80fd\u9700\u6c42\u3002\\n\\n\u6240\u4ee5\u8bf4\uff0c\u4f7f\u7528 APISIX \u4e91\u539f\u751f\u7f51\u5173\u7ed9\u6211\u4eec\u6280\u672f\u5e26\u6765\u4e86\u975e\u5e38\u5927\u7684\u5e2e\u52a9\uff0c\u4f7f\u6211\u4eec\u80fd\u8f7b\u677e\u5e94\u5bf9\u591a\u6837\u5316\u7684\u590d\u6742\u573a\u666f\uff0c\u6253\u9020\u8d8b\u4e8e\u5b8c\u7f8e\u7684\u6570\u5b57\u5316\u4eba\u529b\u8d44\u6e90\u670d\u52a1\u751f\u6001\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (11.21 - 12.04)","metadata":{"permalink":"/zh/blog/2022/12/04/weekly-report-1204","source":"@site/blog/2022/12/04/weekly-report-1204.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (11.21 - 12.04)","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86\u56fd\u5bc6\u5bc6\u7801\u5957\u4ef6\uff0c\u57df\u540d\u89e3\u6790\u4f18\u5316\uff0cAdmin API \u901a\u8fc7 gRPC \u534f\u8bae\u94fe\u63a5 ectd \u7b49\u65b0\u529f\u80fd\u3002","date":"2022-12-04T00:00:00.000Z","formattedDate":"2022\u5e7412\u67084\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.92,"truncated":true,"authors":[],"prevItem":{"title":"APISIX \u5728\u541b\u6da6\u4eba\u529b\u4e91\u539f\u751f\u5e73\u53f0\u7684\u67b6\u6784\u5b9e\u8df5","permalink":"/zh/blog/2022/12/07/junrunrenli-with-apisix"},"nextItem":{"title":"\u8bd1\u6587 | A poor man\'s API","permalink":"/zh/blog/2022/11/28/a-poor-man\u2018s-api"}},"content":"> \u4ece 11.21 - 12.04\uff0c\u6709 22 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 61 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2022/12/08/639153c8987d9.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/2022/12/08/639153c959ebe.png)\\n\\n## Good first issue\\n\\n### Issue #8413\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/8413\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5c06\u9650\u5236\u8ba1\u6570\u63d2\u4ef6\u4e0e\u652f\u6301 tls/ssl \u7684 Redis Cluster \u4e00\u8d77\u4f7f\u7528\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n### Apache APISIX\\n\\n- [`proxy-mirror` \u63d2\u4ef6\u652f\u6301\u6307\u5b9a\u955c\u50cf\u8bf7\u6c42\u7684\u524d\u7f00](https://github.com/apache/apisix/pull/8261)\uff08\u8d21\u732e\u8005\uff1a[Gallardot](https://github.com/Gallardot)\uff09\\n- [`jwt-auth` \u652f\u6301\u9690\u85cf\u5ba2\u6237\u7aef\u8ba4\u8bc1\u51ed\u636e](https://github.com/apache/apisix/pull/8206)\uff08\u8d21\u732e\u8005\uff1a[pixeldin](https://github.com/pixeldin)\uff09\\n- [APISIX \u652f\u6301 FIPS \u5bc6\u7801\u5957\u4ef6](https://github.com/apache/apisix/pull/8298)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n- [`proxy-mirror` \u63d2\u4ef6\u652f\u6301\u89e3\u6790\u57df\u540d](https://github.com/apache/apisix/pull/8356)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n- [`grpc-transcode` \u63d2\u4ef6\u652f\u6301\u5728\u8fd4\u56de\u4f53\u4e2d\u5c55\u793a\u89e3\u6790\u8fc7\u7684 grpc-status-details-bin](https://github.com/apache/apisix/pull/7639)\uff08\u8d21\u732e\u8005\uff1a[monkeyDluffy6017](https://github.com/monkeyDluffy6017)\uff09\\n- [\u57df\u540d\u89e3\u6790\u65f6\u4f18\u5148\u89e3\u6790\u672c\u5730\u7684 `/etc/hosts` \u6587\u4ef6](https://github.com/apache/apisix/pull/8270)\uff08\u8d21\u732e\u8005\uff1a[TenYearsIn](https://github.com/TenYearsIn)\uff09\\n- [`proxy-rewrite` \u63d2\u4ef6\u652f\u6301\u663e\u5f0f\u8bbe\u7f6e\u548c\u5220\u9664 header](https://github.com/apache/apisix/pull/8336)\uff08\u8d21\u732e\u8005\uff1a[mscb402](https://github.com/mscb402)\uff09\\n- [\u652f\u6301\u56fd\u5bc6\u5bc6\u7801\u5957\u4ef6](https://github.com/apache/apisix/pull/8389)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n- [\u652f\u6301\u5c06\u654f\u611f\u5b57\u6bb5\u5b58\u50a8\u5728\u7b2c\u4e09\u65b9\u670d\u52a1\u4e2d\uff0c\u5982 Vault](https://github.com/apache/apisix/pull/8390)\uff08\u8d21\u732e\u8005\uff1a[soulbird](https://github.com/soulbird) [kingluo](https://github.com/kingluo)\uff09\\n- [\u652f\u6301\u654f\u611f\u5b57\u6bb5\u8fdb\u884c\u81ea\u52a8\u52a0\u5bc6\u548c\u89e3\u5bc6\uff0c\u4fdd\u62a4\u654f\u611f\u5b57\u6bb5](https://github.com/apache/apisix/pull/8403)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n- [`syslog` \u63d2\u4ef6\u652f\u6301\u8bbe\u7f6e log format](https://github.com/apache/apisix/pull/8279)\uff08\u8d21\u732e\u8005\uff1a[fatihusta](https://github.com/fatihusta)\uff09\\n- [Admin API \u901a\u8fc7 gRPC \u534f\u8bae\u8fde\u63a5 etcd](https://github.com/apache/apisix/pull/8411)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n### Apache APISIX Ingress\\n\\n- [\u5728\u65e5\u5fd7\u4e2d\u9690\u85cf\u5bc6\u94a5\u4fe1\u606f](https://github.com/apache/apisix-ingress-controller/pull/1480)\uff08\u8d21\u732e\u8005\uff1a[macmiranda](https://github.com/macmiranda)\uff09\\n- [\u53ef\u4ee5\u901a\u8fc7 annotation \u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u8bf7\u6c42\u65b9\u6cd5\u7684\u63a7\u5236](https://github.com/apache/apisix-ingress-controller/pull/1471)\uff08\u8d21\u732e\u8005\uff1a[incubator4](https://github.com/incubator4)\uff09\\n- [\u5141\u8bb8\u5728 APISIX Ingress \u4e0e\u670d\u52a1\u6ce8\u518c/\u53d1\u73b0\u4e2d\u5fc3\u8fdb\u884c\u96c6\u6210](https://github.com/apache/apisix-ingress-controller/pull/1465)\uff08\u8d21\u732e\u8005\uff1a[tao12345666333](https://github.com/tao12345666333)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u8bd1\u6587 | A poor man\'s API](https://apisix.apache.org/zh/blog/2022/12/a-poor-man%E2%80%98s-api/)\\n\\n    \u672c\u6587\u5c06\u5c55\u793a\u5982\u4f55\u5728\u4e0d\u7f16\u5199\u4efb\u4f55\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u7b80\u5355\u5b9e\u73b0\u4e00\u4e2a API \u5b9e\u8df5\u3002\\n\\n- [APISIX Ingress \u662f\u5982\u4f55\u652f\u6301\u4e0a\u5343\u4e2a Pod \u526f\u672c\u7684\u5e94\u7528](https://apisix.apache.org/zh/blog/2022/11/25/how-apisix-support-1000-pods/)\\n\\n    \u672c\u6587\u901a\u8fc7\u4ecb\u7ecd Kubernetes \u4e2d\u4e0a\u5343\u4e2a Pod \u526f\u672c\u5e94\u7528\u573a\u666f\u7684\u89e3\u6790\uff0c\u63d0\u51fa\u6280\u672f\u5b9e\u73b0\u7684\u56f0\u96be\u3002\u4ecb\u7ecd APISIX Ingress \u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e00\u96be\u9898\u7684\u3002\\n\\n- [\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u662f\u4ec0\u4e48](https://apisix.apache.org/zh/blog/2022/11/10/what-is-service-in-microservice-discovery/)\\n\\n    \u672c\u6587\u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u7684\u76f8\u5173\u80cc\u666f\u548c APISIX \u5bf9\u4e8e\u670d\u52a1\u53d1\u73b0\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\uff0c\u6765\u4ecb\u7ecd\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5185\u5bb9\u3002\\n\\n- [\u5b9e\u8df5\u4e00\u5e74\u4e4b\u4e45\uff0cvivo \u5982\u4f55\u57fa\u4e8e APISIX \u8fdb\u884c\u4e1a\u52a1\u57fa\u7840\u67b6\u6784\u7684\u6f14\u8fdb](https://apisix.apache.org/zh/blog/2022/11/13/vivo-with-apache-apisix/)\\n\\n    \u672c\u6587\u4ece\u5e94\u7528 APISIX \u540e\u7684\u8c03\u6574\u4e0e\u5b9e\u8df5\u56f0\u96be\u89d2\u5ea6\u5165\u624b\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 vivo \u57fa\u4e8e APISIX \u7684\u4f01\u4e1a\u5b9e\u8df5\u7ec6\u8282\u3002\\n\\n- [\u817e\u8baf\u84dd\u9cb8 API \u7f51\u5173\u5982\u4f55\u501f\u52a9 APISIX \u5b9e\u73b0\u4ea7\u54c1\u5347\u7ea7\u4e0e\u4e1a\u52a1\u5b8c\u5584](https://apisix.apache.org/zh/blog/2022/11/05/tencent-blueking-with-apisix/)\\n\\n    \u672c\u6587\u4ece\u84dd\u9cb8\u7f51\u5173\u7684\u8fed\u4ee3\u8fc7\u7a0b\u548c\u5e94\u7528 APISIX \u540e\u7684\u4ea7\u54c1\u5b9e\u8df5\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u57fa\u4e8e APISIX \u7684\u7f51\u5173\u5e94\u7528\u5b9e\u4f8b\u3002\\n\\n- [\u4ece Traefik \u5230 APISIX\uff0c\u6c7d\u8f66\u667a\u80fd\u8ba1\u7b97\u5e73\u53f0\u516c\u53f8\u300c\u5730\u5e73\u7ebf\u300d\u5728 Ingress Controller \u7684\u63a2\u7d22\u548c\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/10/28/apisix-ingress-with-horizon-ai/)\\n\\n    \u5730\u5e73\u7ebf\u4f5c\u4e3a\u4e00\u5bb6\u81f4\u529b\u4e8e\u6c7d\u8f66\u81ea\u52a8\u9a7e\u9a76\u82af\u7247\u7684\u516c\u53f8\uff0c\u5728\u4e1a\u52a1\u8fed\u4ee3\u4e2d\u4e3a\u4f55\u4ece Traefik \u5207\u6362\u5230\u4e86 APISIX Ingress \u53bb\u652f\u6491\u4e1a\u52a1\uff1f"},{"id":"\u8bd1\u6587 | A poor man\'s API","metadata":{"permalink":"/zh/blog/2022/11/28/a-poor-man\u2018s-api","source":"@site/blog/2022/11/28/a-poor-man\u2018s-api.md","title":"\u8bd1\u6587 | A poor man\'s API","description":"\u672c\u6587\u5c06\u5c55\u793a\u5982\u4f55\u5728\u4e0d\u7f16\u5199\u4efb\u4f55\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u7b80\u5355\u5b9e\u73b0\u4e00\u4e2a API \u5b9e\u8df5\u3002","date":"2022-11-28T00:00:00.000Z","formattedDate":"2022\u5e7411\u670828\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.69,"truncated":true,"authors":[{"name":"Nicolas Fr\xe4nkel","title":"Author","url":"https://github.com/nfrankel","image_url":"https://github.com/nfrankel.png","imageURL":"https://github.com/nfrankel.png"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (11.21 - 12.04)","permalink":"/zh/blog/2022/12/04/weekly-report-1204"},"nextItem":{"title":"APISIX Ingress \u662f\u5982\u4f55\u652f\u6301\u4e0a\u5343\u4e2a Pod \u526f\u672c\u7684\u5e94\u7528","permalink":"/zh/blog/2022/11/25/how-apisix-support-1000-pods"}},"content":"> \u5728 API \u65e5\u6e10\u6d41\u884c\u7684\u5e74\u4ee3\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u975e\u6280\u672f\u4eba\u5458\u4e5f\u5e0c\u671b\u80fd\u4ece API \u7684\u4f7f\u7528\u4e2d\u83b7\u5229\uff0c\u800c\u521b\u5efa\u4e00\u5957\u6210\u719f\u7684 API \u65b9\u6848\u9700\u8981\u65f6\u95f4\u6210\u672c\u548c\u91d1\u94b1\u4e24\u65b9\u9762\u7684\u8d44\u6e90\u52a0\u6301\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u9700\u8981\u8003\u8651\u6a21\u578b\u3001\u8bbe\u8ba1\u3001REST \u539f\u5219\u7b49\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u7f16\u5199\u4e00\u884c\u4ee3\u7801\u3002\u5982\u4f55\u6253\u9020\u4e00\u4e2a\u5177\u6709\u9ad8\u6027\u4ef7\u6bd4\u4e14\u80fd\u6301\u7eed\u8fed\u4ee3\u7684\u4ea7\u54c1\uff0c\u6210\u4e3a\u8d8a\u6765\u8d8a\u591a\u6280\u672f\u56e2\u961f\u7684\u76ee\u6807\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u65b9\u6848\u521d\u8bd5\\n\\n\u8be5\u89e3\u51b3\u65b9\u6848\u4e3b\u8981\u4f7f\u7528\u7684\u662f PostgreSQL \u6570\u636e\u5e93\uff0cPostgreSQL \u662f\u4e00\u4e2a\u5f00\u6e90 SQL \u6570\u636e\u5e93\u3002\u540c\u65f6\u6211\u4eec\u6ca1\u6709\u7f16\u5199 REST API\uff0c\u800c\u662f\u4f7f\u7528\u4e86 PostgREST \u7ec4\u4ef6\u3002\\n\\n[PostgREST](https://postgrest.org/) \u662f\u4e00\u4e2a\u72ec\u7acb\u7684 Web \u670d\u52a1\u5668\uff0c\u5b83\u53ef\u4ee5\u5c06 PostgreSQL \u6570\u636e\u5e93\u76f4\u63a5\u8f6c\u6362\u4e3a RESTful API\u3002\u5982\u679c\u4f60\u60f3\u4e86\u89e3 PostgREST \u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u53ef\u4ee5\u53c2\u8003[\u5165\u95e8\u6307\u5357](https://postgrest.org/en/stable/tutorials/tut0.html)\u6587\u6863\uff0c\u5185\u5bb9\u975e\u5e38\u5168\u9762\u4e14\u5f00\u7bb1\u5373\u7528\u3002\\n\\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u5b83\u5e94\u7528\u5230\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\u4e2d\u3002\\n\\n### \u5177\u4f53\u6b65\u9aa4\\n\\n> \u4ee5\u4e0b\u8fc7\u7a0b\u4f60\u53ef\u4ee5\u5728 [GitHub](https://github.com/ajavageek/poor-man-api) \u4e0a\u627e\u5230\u5b8c\u6574\u6e90\u4ee3\u7801\u3002\\n\u4e0b\u65b9\u5c55\u793a\u4e86\u4e00\u4e2a\u901a\u8fc7 CRUD API \u516c\u5f00\u7684 product \u8868\u3002\\n\\n![\u8868\u7ed3\u6784](https://static.apiseven.com/2022/12/02/63896834f0e22.png)\\n\\n\u7531\u4e8e\u6211\u6ca1\u6709\u627e\u5230\u4efb\u4f55\u73b0\u6210\u7684 Docker \u955c\u50cf\uff0c\u6240\u4ee5\u6211\u5355\u72ec\u521b\u5efa\u4e86\u4e00\u4efd\u65b0\u7684 Dockerfile\u3002\u5176\u4e2d\u4e3b\u8981\u6d89\u53ca\u4f9d\u8d56\u9879\u7684\u5b89\u88c5\u548c\u53c2\u6570\u5316\u6570\u636e\u751f\u6210\u3002\\n\\n***Dockerfile***\\n\\n```dockerfile\\nFROM\xa0debian:bookworm-slim\\nARG\xa0POSTGREST_VERSION=v10.1.1\\nARG\xa0POSTGREST_FILE=postgrest-$POSTGREST_VERSION-linux-static-x64.tar.xz\\nRUN\xa0mkdir\xa0postgrest\\nWORKDIR\xa0postgrest\\nADD\xa0https://github.com/PostgREST/postgrest/releases/download/$POSTGREST_VERSION/$POSTGREST_FILE\xa0\\\\\\n\xa0\xa0\xa0\xa0.\\nRUN\xa0apt-get\xa0update\xa0&&\xa0\\\\\\n\xa0\xa0\xa0\xa0apt-get\xa0install\xa0-y\xa0libpq-dev\xa0xz-utils\xa0&&\xa0\\\\\\n\xa0\xa0\xa0\xa0tar\xa0xvf\xa0$POSTGREST_FILE\xa0&&\xa0\\\\\\n\xa0\xa0\xa0\xa0rm\xa0$POSTGREST_FILE\\n```\\n\\n\u4e4b\u540e\uff0cDocker \u955c\u50cf\u5728  `/postgrest`  \u6587\u4ef6\u5939\u4e2d\u4f1a\u5305\u542b\u4e00\u4e2a\u540d\u4e3a  `postgrest`  \u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7 Docker Compose \u6765\u90e8\u7f72\uff1a\\n\\n***docker-compose.yml***\\n\\n```yaml\\nversion:\xa0\\"3\\"\\nservices:\\n\xa0\xa0postgrest:\\n\xa0\xa0\xa0\xa0build:\xa0./postgrest\\n\xa0\xa0\xa0\xa0volumes:\\n\xa0\xa0\xa0\xa0\xa0\xa0-\xa0./postgrest/product.conf:/etc/product.conf:ro\\n\xa0\xa0\xa0\xa0ports:\\n\xa0\xa0\xa0\xa0\xa0\xa0-\xa0\\"3000:3000\\"\\n\xa0\xa0\xa0\xa0entrypoint:\xa0[\\"/postgrest/postgrest\\"]\\n\xa0\xa0\xa0\xa0command:\xa0[\\"/etc/product.conf\\"]\\n\xa0\xa0\xa0\xa0depends_on:\\n\xa0\xa0\xa0\xa0\xa0\xa0-\xa0postgres\\n\xa0\xa0postgres:\\n\xa0\xa0\xa0\xa0image:\xa0postgres:15-alpine\\n\xa0\xa0\xa0\xa0environment:\\n\xa0\xa0\xa0\xa0\xa0\xa0POSTGRES_PASSWORD:\xa0\\"root\\"\\n\xa0\xa0\xa0\xa0volumes:\\n\xa0\xa0\xa0\xa0\xa0\xa0-\xa0./postgres:/docker-entrypoint-initdb.d:ro\\n```\\n\\n\u63a5\u4e0b\u6765\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u67e5\u8be2\u524d\u6587\u63d0\u5230\u7684  `product`  \u8868\uff1a\\n\\n```shell\\ncurl\xa0localhost:3000/product\\n```\\n\\n\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\u53cd\u9988\uff1a\\n\\n```json\\n[{\\"id\\":1,\\"name\\":\\"Stickers\xa0pack\\",\\"description\\":\\"A\xa0pack\xa0of\xa0rad\xa0stickers\xa0to\xa0display\xa0on\xa0your\xa0laptop\xa0or\xa0wherever\xa0you\xa0feel\xa0like.\xa0Show\xa0your\xa0love\xa0for\xa0Apache\xa0APISIX\\",\\"price\\":0.49,\\"hero\\":false},\\n\xa0{\\"id\\":2,\\"name\\":\\"Lapel\xa0pin\\",\\"description\\":\\"With\xa0this\xa0\\\\\\"Powered\xa0by\xa0Apache\xa0APISIX\\\\\\"\xa0lapel\xa0pin,\xa0support\xa0your\xa0favorite\xa0API\xa0Gateway\xa0and\xa0let\xa0everybody\xa0know\xa0about\xa0it.\\",\\"price\\":1.49,\\"hero\\":false},\\n\xa0{\\"id\\":3,\\"name\\":\\"Tee-Shirt\\",\\"description\\":\\"The\xa0classic\xa0geek\xa0product!\xa0At\xa0a\xa0conference,\xa0at\xa0home,\xa0at\xa0work,\xa0this\xa0tee-shirt\xa0will\xa0be\xa0your\xa0best\xa0friend.\\",\\"price\\":9.99,\\"hero\\":true}]\\n```\\n\\n## \u65b9\u6848\u4f18\u5316\\n\\n\u5c3d\u7ba1\u4e0a\u6587\u63d0\u5230\u7684\u8fd9\u5957\u89e3\u51b3\u65b9\u6848\u6709\u6548\uff0c\u4f46\u4ecd\u5b58\u5728\u5f88\u5927\u7684\u6539\u8fdb\u7a7a\u95f4\u3002\u6bd4\u5982\u6570\u636e\u5e93\u7528\u6237\u4e0d\u80fd\u66f4\u6539\u6570\u636e\u3001\u5b9e\u9645\u64cd\u4f5c\u4e2d\u6bcf\u4e2a\u4eba\u90fd\u53ef\u4ee5\u8bbf\u95ee\u76f8\u5173\u6570\u636e\u7b49\u3002\u8fd9\u5bf9\u4e8e\u4e0e\u4ea7\u54c1\u76f8\u5173\u7684\u6570\u636e\u6765\u8bf4\uff0c\u53ef\u80fd\u4e0d\u662f\u4e00\u4e2a\u5927\u95ee\u9898\uff0c\u4f46\u5982\u679c\u662f\u533b\u7597\u6570\u636e\u5462\uff1f\\n\\nPostgREST \u7684\u5b98\u7f51[\u4f7f\u7528\u6587\u6863](https://postgrest.org/en/stable/admin.html)\u4e2d\u63d0\u5230\u4e86\u8fd9\u4e00\u70b9\uff0c\u5e76\u660e\u786e\u63d0\u51fa\uff1a\u5efa\u8bae\u7528\u6237\u4f7f\u7528\u53cd\u5411\u4ee3\u7406\u3002\\n\\n\u63d0\u5230\u53cd\u5411\u4ee3\u7406\uff0c\u5c31\u4e0d\u5f97\u4e0d\u5c06\u76ee\u5149\u8f6c\u5411\u5230 API \u7f51\u5173\u884c\u5217\u3002\u4e0e NGINX \u4e0d\u540c\uff0c\u8fd9\u91cc\u6211\u9009\u53d6\u4e86**\u5f00\u6e90\u9886\u57df\u975e\u5e38\u6d3b\u8dc3\u7684 API \u7f51\u5173\u4ea7\u54c1 \u2014 Apache APISIX**\u3002APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u7cbe\u7ec6\u5316\u8def\u7531\u3001\u9650\u6d41\u9650\u901f\u3001\u670d\u52a1\u964d\u7ea7\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u6570\u767e\u9879\u529f\u80fd\u3002\\n\\n\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 Docker Compose \u6587\u4ef6\u4e2d\u8865\u5145 APISIX \u76f8\u5173\u4fe1\u606f\uff0c\u5305\u62ec APISIX \u53ca\u5176\u4f9d\u8d56\u7684\u5b58\u50a8 etcd\uff0c\u800c etcd \u4e3b\u8981\u7528\u4e8e\u5b58\u50a8 APISIX \u7684\u8def\u7531\u3001\u63d2\u4ef6\u7b49\u914d\u7f6e\u4fe1\u606f\u3002\\n\\n***docker-compose.yml***\\n\\n```yaml\\nversion:\xa0\\"3\\"\\nservices:\\n\xa0\xa0apisix:\\n\xa0\xa0\xa0\xa0image:\xa0apache/apisix:2.15.0-alpine\\n\xa0\xa0\xa0\xa0volumes:\\n\xa0\xa0\xa0\xa0\xa0\xa0-\xa0./apisix/config.yml:/usr/local/apisix/conf/config.yaml:ro\\n\xa0\xa0\xa0\xa0ports:\\n\xa0\xa0\xa0\xa0\xa0\xa0-\xa0\\"9080:9080\\"\\n\xa0\xa0\xa0\xa0restart:\xa0always\\n\xa0\xa0\xa0\xa0depends_on:\\n\xa0\xa0\xa0\xa0\xa0\xa0-\xa0etcd\\n\xa0\xa0\xa0\xa0\xa0\xa0-\xa0postgrest\\n\xa0\xa0etcd:\\n\xa0\xa0\xa0\xa0image:\xa0bitnami/etcd:3.5.2\\n\xa0\xa0\xa0\xa0environment:\\n\xa0\xa0\xa0\xa0\xa0\xa0ETCD_ENABLE_V2:\xa0\\"true\\"\\n\xa0\xa0\xa0\xa0\xa0\xa0ALLOW_NONE_AUTHENTICATION:\xa0\\"yes\\"\\n\xa0\xa0\xa0\xa0\xa0\xa0ETCD_ADVERTISE_CLIENT_URLS:\xa0\\"http://0.0.0.0:2397\\"\\n\xa0\xa0\xa0\xa0\xa0\xa0ETCD_LISTEN_CLIENT_URLS:\xa0\\"http://0.0.0.0:2397\\"\\n```\\n\\n\u7136\u540e\u5c06 APISIX \u914d\u7f6e\u4e3a  `postgrest`  \u7684\u4ee3\u7406\u8fdb\u884c\u8c03\u7528\u3002\\n\\n```shell\\ncurl\xa0http://apisix:9080/apisix/admin/upstreams/1\xa0-H\xa0\'X-API-KEY:\xa0123xyz\'\xa0-X\xa0PUT\xa0-d\xa0\'\\n{\\n\xa0\xa0\\"type\\":\xa0\\"roundrobin\\",\\n\xa0\xa0\\"nodes\\":\xa0{\\n\xa0\xa0\xa0\xa0\\"postgrest:3000\\":\xa01\\n\xa0\xa0}\\n}\'\\ncurl\xa0http://apisix:9080/apisix/admin/routes/1\xa0-H\xa0\'X-API-KEY:\xa0123xyz\'\xa0-X\xa0PUT\xa0-d\xa0\'\\n{\\n\xa0\xa0\\"uri\\":\xa0\\"/*\\",\\n\xa0\xa0\\"upstream_id\\":\xa01\\n}\\n```\\n\\n\u73b0\u5728\u518d\u6765\u67e5\u8be2\u7aef\u70b9\uff0c\u4f1a\u5f97\u5230\u4e0e\u4e0a\u6587\u4e00\u81f4\u7684\u8fd4\u56de\u7ed3\u679c\u3002\\n\\n```shell\\ncurl\xa0localhost:9080/product\\n```\\n\\n## \u6dfb\u7816\u52a0\u74e6\\n\\n\u867d\u7136\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u8fd8\u6ca1\u6709\u6dfb\u52a0\u4efb\u4f55\u5b9e\u9645\u9879\u76ee\uff0c\u4f46\u51c6\u5907\u5de5\u4f5c\u5df2\u7ecf\u5168\u90e8\u5c31\u7eea\u4e86\u3002\u63a5\u4e0b\u6765\u5c31\u8ba9\u6211\u4eec\u4e3a\u8fd9\u4e2a API \u6dfb\u52a0\u4e00\u4e9b\u5176\u4ed6\u529f\u80fd\uff0c\u8ba9\u5176\u66f4\u5b89\u5168\u6709\u6548\uff0c\u6613\u4e8e\u8ffd\u8e2a\u3002\\n\\n### DDoS \u4fdd\u62a4\\n\\nAPI \u4f5c\u4e3a\u4e00\u4e2a\u8fde\u63a5\u5c5e\u6027\u7684\u7ec4\u4ef6\uff0c\u5fc5\u7136\u8981\u4fdd\u8bc1\u5176\u8fc7\u7a0b\u4e2d\u7684\u4f20\u8f93\u5b89\u5168\u3002\u56e0\u6b64\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u5bf9 API \u589e\u52a0\u4e00\u4e9b\u9632\u62a4\uff0c\u8ba9\u5176\u514d\u53d7 DDoS \u653b\u51fb\u3002APISIX \u63d0\u4f9b\u4e86\u975e\u5e38\u591a\u7684\u5b98\u65b9\u63d2\u4ef6\uff0c\u6d89\u53ca\u9274\u6743\u3001\u6d41\u91cf\u5904\u7406\u3001\u76d1\u63a7\u7b49\u7b49\u3002\u4e3a\u4e86\u9632\u6b62 DDoS\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 APISIX \u7684  `limit-count`  \u63d2\u4ef6\u3002\\n\\n\u5728 APISIX \u4e2d\u4f7f\u7528\u63d2\u4ef6\u65f6\uff0c\u4f60\u53ef\u4ee5\u5728\u521b\u5efa\u7279\u5b9a\u8def\u7531\u65f6\u5728\u6bcf\u4e2a\u8def\u7531\u4e0a\u8bbe\u7f6e\u67d0\u4e2a\u63d2\u4ef6\u3002\u5982\u679c\u4f60\u60f3\u8ba9\u67d0\u4e2a\u63d2\u4ef6\u5728\u6bcf\u4e2a\u8def\u7531\u4e0a\u90fd\u751f\u6548\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u89c4\u5219\u3002\u5982\u4e0b\u65b9\u6240\u793a\uff0c\u6211\u4eec\u5e0c\u671b\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4fdd\u62a4\u6bcf\u4e2a\u8def\u7531\uff0c\u6240\u4ee5\u4f7f\u7528\u5168\u5c40\u89c4\u5219\u8bbe\u5b9a  `limit-count`  \u63d2\u4ef6\u3002\\n\\n```shell\\ncurl\xa0http://apisix:9080/apisix/admin/global_rules/1\xa0-H\xa0\'X-API-KEY:\xa0123xyz\'\xa0-X\xa0PUT\xa0-d\xa0\'\\n{\\n\xa0\xa0\\"plugins\\":\xa0{\\n\xa0\xa0\xa0\xa0\\"limit-count\\":\xa0{\\n\xa0\xa0\xa0\xa0\xa0\xa0\\"count\\":\xa01,\\n\xa0\xa0\xa0\xa0\xa0\xa0\\"time_window\\":\xa05,\\n\xa0\xa0\xa0\xa0\xa0\xa0\\"rejected_code\\":\xa0429\\n\xa0\xa0\xa0\xa0}\\n\xa0\xa0}\\n}\'\\n```\\n\\n\u73b0\u5728\uff0c\u5982\u679c\u6211\u4eec\u6267\u884c\u592a\u591a\u7684\u8bf7\u6c42\uff0cAPISIX \u5c06\u4f1a\u4fdd\u62a4\u4e0a\u6e38\u3002\\n\\n```shell\\ncurl\xa0localhost:9080/product\\n```\\n\\n```xml\\n<html>\\n<head><title>429\xa0Too\xa0Many\xa0Requests</title></head>\\n<body>\\n<center><h1>429\xa0Too\xa0Many\xa0Requests</h1></center>\\n<hr><center>openresty</center>\\n</body>\\n</html>\\n```\\n\\n### \u589e\u52a0\u9274\u6743\\n\\nPostgREST \u8fd8\u5728\u6839\u7aef\u63d0\u4f9b\u4e86\u4e00\u4e2a OpenAPI endpoint\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u73b0\u5728\u6709\u4e24\u6761\u8def\u7531\uff1a `/` \uff08\u63a7\u5236 Open API \u89c4\u8303\uff09\u548c  `/product`  \uff08\u63a7\u5236\u4ea7\u54c1\uff09\u3002\\n\\n\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u9700\u8981\u5236\u5b9a\u4e00\u5957\u9650\u5236\u8bbf\u95ee\u7684\u64cd\u4f5c\uff0c\u5373\u4e0d\u5141\u8bb8\u672a\u7ecf\u6388\u6743\u7684\u4eba\u8bbf\u95ee\u6570\u636e\u3002\u666e\u901a\u7528\u6237\u53ef\u4ee5\u8bbf\u95ee\u4ea7\u54c1\u7aef\u4fe1\u606f\uff0c\u800c\u7ba1\u7406\u5458\u7528\u6237\u53ef\u4ee5\u8bbf\u95ee Open API \u89c4\u8303\u548c\u4ea7\u54c1\u7aef\u4fe1\u606f\u3002\\n\\nAPISIX \u63d0\u4f9b\u4e86\u51e0\u79cd[\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6cd5](https://apisix.apache.org/plugins/#authentication)\uff0c\u8fd9\u4e9b\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f\u90fd\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u8fdb\u884c\u5b9e\u73b0\u3002\u8fd9\u91cc\u6211\u4eec\u9009\u53d6 APISIX \u4e2d\u6700\u5e38\u7528\u4e5f\u662f\u6700\u7b80\u5355\u7684\u8ba4\u8bc1\u63d2\u4ef6 [key-auth](https://apisix.apache.org/docs/apisix/plugins/key-auth/)\uff0c\u5b83\u4f9d\u8d56\u4e8e [Consumer](https://apisix.apache.org/docs/apisix/terminology/consumer/)\uff08\u6d88\u8d39\u8005\uff09\u62bd\u8c61\u3002 `key-auth`  \u63d2\u4ef6\u7684\u4f7f\u7528\u4e2d\u9700\u8981\u4e00\u4e2a\u7279\u5b9a\u7684 header\uff0c\u8fd9\u6837\u63d2\u4ef6\u5c31\u53ef\u4ee5\u6839\u636e\u503c\u6570\u636e\u8fdb\u884c\u53cd\u5411\u67e5\u627e\uff0c\u5e76\u627e\u5230\u5176\u5bf9\u5e94\u7684 Consumer\u3002\\n\\n\u4ee5\u4e0b\u4ee3\u7801\u5c55\u793a\u4e86\u5982\u4f55\u65b0\u5efa\u4e00\u4e2a Consumer\uff1a\\n\\n```shell\\ncurl\xa0http://apisix:9080/apisix/admin/consumers\xa0-H\xa0\'X-API-KEY:\xa0123xyz\'\xa0-X\xa0PUT\xa0-d\xa0\'\\n{\\n\xa0\xa0\\"username\\":\xa0\\"admin\\",\\n\xa0\xa0\\"plugins\\":\xa0{\\n\xa0\xa0\xa0\xa0\\"key-auth\\":\xa0{\\n\xa0\xa0\xa0\xa0\xa0\xa0\\"key\\":\xa0\\"admin\\"\\n\xa0\xa0\xa0\xa0}\\n\xa0\xa0}\\n}\'\\n```\\n\\n\u540c\u6837\u7684\uff0c\u6211\u4eec\u9700\u8981\u5bf9 Consumer  `user`  \u548c Key  `user` \xa0 \u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\u3002\u73b0\u5728\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u4e13\u7528\u8def\u7531\u6765\u914d\u7f6e\u5b83\u4eec\uff0c\u4ee5\u4fbf\u53ea\u6709\u6765\u81ea  `admin`  \u7684\u8bf7\u6c42\u624d\u80fd\u901a\u8fc7\uff1a\\n\\n```shell\\ncurl\xa0http://apisix:9080/apisix/admin/routes\xa0-H\xa0\'X-API-KEY:\xa0123xyz\'\xa0-X\xa0POST\xa0-d\xa0\'\\n{\\n\xa0\xa0\\"uri\\":\xa0\\"/\\",\\n\xa0\xa0\\"upstream_id\\":\xa01,\\n\xa0\xa0\\"plugins\\":\xa0{\\n\xa0\xa0\xa0\xa0\\"key-auth\\":\xa0{},\\n\xa0\xa0\xa0\xa0\\"consumer-restriction\\":\xa0{\\n\xa0\xa0\xa0\xa0\xa0\xa0\\"whitelist\\":\xa0[\xa0\\"admin\\"\xa0]\\n\xa0\xa0\xa0\xa0}\\n\xa0\xa0}\\n}\'\\n```\\n\\n\u7136\u540e\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6d4b\u8bd5\u4e00\u4e0b\uff1a\\n\\n```shell\\ncurl\xa0localhost:9080\\n```\\n\\n\u53d1\u73b0\u5e76\u6ca1\u6709\u8d77\u4f5c\u7528\u3002\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u6ca1\u6709\u901a\u8fc7 API \u5bc6\u94a5\u7684 header \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\\n\\n```shell\\n{\\"message\\":\\"Missing\xa0API\xa0key\xa0found\xa0in\xa0request\\"}\\n```\\n\\n\u6dfb\u52a0 header \u540e\u518d\u6b21\u8fdb\u884c\u6d4b\u8bd5\uff1a\\n\\n```shell\\ncurl -H \\"apikey: user\\" localhost:9080\\n\\n{\\"message\\":\\"The consumer_name is forbidden.\\"}\\n```\\n\\n\u53d1\u73b0\u4ecd\u7136\u6ca1\u6709\u6548\u679c\u3002\u8fd9\u662f\u56e0\u4e3a\u8fd9\u91cc API key \u4e3a `user` \uff0c\u6211\u4eec\u524d\u8fb9\u4ec5\u4e3a `admin` \u4e5f\u5c31\u662f\u7ba1\u7406\u5458\u8bbe\u7f6e\u4e86\u76f8\u5173\u6743\u9650\u3002\u6240\u4ee5\u5982\u679c\u66f4\u6362\u4e3a  `admin` \uff0c\u5c31\u4f1a\u5982\u671f\u8fd4\u56de Open API \u89c4\u8303\u7684\u76f8\u5173\u4fe1\u606f\u3002\\n\\n### \u914d\u7f6e\u76d1\u63a7\\n\\n\u5728\u8f6f\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u603b\u6709\u4e00\u4e2a\u88ab\u4eba\u4eec\u4f4e\u4f30\u91cd\u8981\u6027\u7684\u529f\u80fd \u2014\u2014 **\u53ef\u89c2\u6d4b\u6027**\u3002\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u90e8\u7f72\u4e86\u4efb\u4f55\u7ec4\u4ef6\uff0c\u90fd\u9700\u8981\u76d1\u63a7\u5176\u8fd0\u884c\u72b6\u51b5\u3002\\n\\n\u5982\u4eca\uff0c\u5f88\u591a\u670d\u52a1\u90fd\u63d0\u4f9b\u4e86\u53ef\u89c2\u6d4b\u6027\u7684\u529f\u80fd\uff0c\u6bd4\u5982 [Prometheus](https://prometheus.io/)\u3002\u5f97\u76ca\u4e8e Prometheus \u7684\u5f00\u6e90\u5c5e\u6027\uff0c\u5b83\u88ab\u5e7f\u6cdb\u5e94\u7528\u4e8e\u5b9e\u8df5\u4e2d\u3002\u56e0\u6b64\uff0c\u8fd9\u91cc\u6211\u4eec\u4e5f\u9009\u7528 Prometheus \u8fdb\u884c\u76f8\u5173\u6570\u636e\u7684\u76d1\u63a7\u3002\\n\\n\u4e3a\u4e86\u901a\u8fc7\u56fe\u8868\u7b49\u5f62\u5f0f\u663e\u793a\u6570\u636e\uff0c\u6211\u4eec\u4e5f\u540c\u65f6\u9700\u8981\u4f9d\u8d56\u4e8e [Grafana](https://grafana.com/)\u3002\u63a5\u4e0b\u6765\uff0c\u5c06\u8fd9\u4e9b\u7ec4\u4ef6\u6dfb\u52a0\u5230 Docker Compose \u6587\u4ef6\u4e2d\u3002\\n\\n***docker-compose.yml***\\n\\n```yaml\\nversion: \\"3\\"\\nservices:\\n\xa0 prometheus:\\n\xa0 \xa0 image: prom/prometheus:v2.40.1\\n\xa0 \xa0 \xa0 - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml\\n\xa0 \xa0 depends_on:\\n\xa0 \xa0 \xa0 - apisix\\n\xa0 grafana:\\n\xa0 \xa0 image: grafana/grafana:8.5.15\\n\xa0 \xa0 volumes:\\n\xa0 \xa0 \xa0 - ./grafana/provisioning:/etc/grafana/provisioning\\n\xa0 \xa0 \xa0 - ./grafana/dashboards:/var/lib/grafana/dashboards\\n\xa0 \xa0 \xa0 - ./grafana/config/grafana.ini:/etc/grafana/grafana.ini\\n\xa0 \xa0 ports:\\n\xa0 \xa0 \xa0 - \\"3001:3000\\"\\n\xa0 \xa0 depends_on:\\n\xa0 \xa0 \xa0 - prometheus\\n```\\n\\n\u4ee5\u4e0a\u64cd\u4f5c\u9700\u6ce8\u610f\uff1aAPISIX \u7684\u9ed8\u8ba4\u76d1\u63a7\u65b9\u6848\u4e2d\u81ea\u5e26 Grafana\uff0c\u56e0\u6b64\u53ea\u9700\u4ece APISIX \u4e2d\u83b7\u53d6[\u76f8\u5173\u914d\u7f6e](https://github.com/apache/apisix/blob/master/docs/assets/other/json/apisix-grafana-dashboard.json) \u5373\u53ef\u3002\u540c\u65f6\u5c06\u9ed8\u8ba4\u7aef\u53e3\u4ece 3000 \u66f4\u6539\u4e3a 3001 \u662f\u4e3a\u4e86\u907f\u514d\u4e0e PostgREST \u670d\u52a1\u53d1\u751f\u51b2\u7a81\u3002\\n\\n\u4e00\u65e6\u76d1\u63a7\u57fa\u7840\u8bbe\u65bd\u5230\u4f4d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6307\u793a APISIX \u4ee5 Prometheus \u671f\u671b\u7684\u683c\u5f0f\u63d0\u4f9b\u6570\u636e\u5373\u53ef\u3002\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u63d2\u4ef6\u548c\u65b0\u7684\u5168\u5c40\u89c4\u5219\u6765\u5b9e\u73b0\u8fd9\u4e00\u76ee\u6807\uff1a\\n\\nconfig.yaml\\n\\n```yaml\\nplugin_attr:\\n\xa0\xa0prometheus:\\n\xa0\xa0\xa0\xa0export_addr:\\n\xa0\xa0\xa0\xa0\xa0\xa0ip:\xa0\\"0.0.0.0\\"\\n\xa0\xa0\xa0\xa0\xa0\xa0port:\xa09091\\n```\\n\\n```bash\\ncurl http://apisix:9080/apisix/admin/global_rules/2 -H \'X-API-KEY: 123xyz\' -X PUT -d \'\\n{\\n\xa0 \\"plugins\\": {\\n\xa0 \xa0 \\"prometheus\\": {}\\n\xa0 }\\n}\'\\n```\\n\\n\u6b64\u65f6\u53d1\u9001\u51e0\u4e2a\u67e5\u8be2\u8bf7\u6c42\uff0c\u5e76\u6253\u5f00 Grafana \u4eea\u8868\u677f\uff0c\u53ef\u770b\u5230\u7c7b\u4f3c\u6570\u636e\u3002\u5982\u679c\u8fd0\u884c\u8f83\u591a\u8bf7\u6c42\uff0c\u5219\u4f1a\u51fa\u73b0\u66f4\u4e30\u5bcc\u7684\u6570\u636e\u4eea\u8868\u3002\\n\\n![\u4eea\u8868\u76d8](https://static.apiseven.com/2022/12/02/63896834c6f18.png)\\n\\n![\u76d1\u63a7\u6570\u636e](https://static.apiseven.com/2022/12/02/6389683506d5f.png)\\n\\n## \u603b\u7ed3\\n\\n\u521b\u5efa\u4e00\u4e2a\u6210\u719f\u7684 RESTful API \u662f\u4e00\u9879\u5de8\u5927\u7684\u6295\u8d44\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7 PostgREST \u5c06\u6570\u636e\u5e93\u66b4\u9732\u5728 CRUD API \u4e2d\u6765\u5feb\u901f\u6d4b\u8bd5\u4e00\u4e2a\u7b80\u5355\u7684 API\u3002\u4f46\u662f\uff0c\u8fd9\u6837\u7684\u4f53\u7cfb\u7ed3\u6784\u4e0d\u9002\u7528\u4e8e\u5b9e\u9645\u751f\u4ea7\u3002\u8981\u60f3\u4f7f\u5176\u66f4\u5177\u5b9e\u8df5\u6027\uff0c\u5c31\u9700\u8981\u5728 PostgREST \u524d\u8bbe\u7f6e\u4e00\u4e2a facade\u3001\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\uff0c\u6216\u8005\u66f4\u597d\u7684 API \u7f51\u5173\u3002\\n\\nApache APISIX \u4f5c\u4e3a\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u63d0\u4f9b\u4e86\u5e7f\u6cdb\u7684\u7279\u6027\uff0c\u4ece\u6d41\u91cf\u5904\u7406\u5230\u8ba4\u8bc1\u6388\u6743\u548c\u53ef\u89c2\u6d4b\u6027\u7b49\u3002\u6709\u4e86 APISIX\uff0c\u4f60\u5c31\u53ef\u4ee5\u7528\u8f83\u4f4e\u7684\u6210\u672c\u5feb\u901f\u9a8c\u8bc1\u4f60\u7684 API \u9700\u6c42\u3002\u9526\u4e0a\u6dfb\u82b1\u7684\u662f\uff0c\u5f53\u4f60\u9a8c\u8bc1\u9700\u6c42\u5b8c\u6210\u4e4b\u540e\uff0c\u8fd8\u53ef\u4ee5\u4fdd\u7559\u73b0\u6709\u7684 facade\uff0c\u5e76\u7528\u81ea\u5b9a\u4e49\u5f00\u53d1\u7684 API \u6765\u66ff\u6362 PostgREST\u3002"},{"id":"APISIX Ingress \u662f\u5982\u4f55\u652f\u6301\u4e0a\u5343\u4e2a Pod \u526f\u672c\u7684\u5e94\u7528","metadata":{"permalink":"/zh/blog/2022/11/25/how-apisix-support-1000-pods","source":"@site/blog/2022/11/25/how-apisix-support-1000-pods.md","title":"APISIX Ingress \u662f\u5982\u4f55\u652f\u6301\u4e0a\u5343\u4e2a Pod \u526f\u672c\u7684\u5e94\u7528","description":"\u672c\u6587\u901a\u8fc7\u4ecb\u7ecd Kubernetes \u4e2d\u4e0a\u5343\u4e2a Pod \u526f\u672c\u5e94\u7528\u573a\u666f\u7684\u89e3\u6790\uff0c\u63d0\u51fa\u6280\u672f\u5b9e\u73b0\u7684\u56f0\u96be\u3002\u4ecb\u7ecd APISIX Ingress \u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e00\u96be\u9898\u7684\u3002","date":"2022-11-25T00:00:00.000Z","formattedDate":"2022\u5e7411\u670825\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":14.15,"truncated":true,"authors":[{"name":"\u5bb9\u946b","url":"https://github.com/AlinsRan","imageURL":"https://github.com/AlinsRan.png"}],"prevItem":{"title":"\u8bd1\u6587 | A poor man\'s API","permalink":"/zh/blog/2022/11/28/a-poor-man\u2018s-api"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (11.5 - 11.20)","permalink":"/zh/blog/2022/11/23/weekly-report-1123"}},"content":"> \u672c\u6587\u901a\u8fc7\u4ecb\u7ecd Kubernetes \u4e2d\u4e0a\u5343\u4e2a Pod \u526f\u672c\u5e94\u7528\u573a\u666f\u7684\u89e3\u6790\uff0c\u63d0\u51fa\u6280\u672f\u5b9e\u73b0\u7684\u56f0\u96be\u3002\u4ecb\u7ecd APISIX Ingress \u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e00\u96be\u9898\u7684\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5728 Kubernetes \u4e2d\u4e3a\u4ec0\u4e48\u4f1a\u9047\u5230\u4e0a\u5343\u4e2a Pod \u526f\u672c\u7684\u5e94\u7528\u573a\u666f\uff1f\\n\\n\u5728 Kubernetes \u4e2d\uff0cPod \u662f\u6700\u5c0f\u7684\u8c03\u5ea6\u5355\u5143\u3002\u5e94\u7528\u7a0b\u5e8f\u5b9e\u9645\u662f\u4ee5 Pod \u5728\u8fd0\u884c\u7684\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u51fa\u4e8e\u53ef\u6269\u5c55\u6027\u548c\u964d\u4f4e\u7206\u70b8\u534a\u5f84\u7b49\u65b9\u9762\u7684\u8003\u8651\uff0c\u53ea\u4f1a\u7ed9 Pod \u8bbe\u7f6e\u6709\u9650\u7684\u8d44\u6e90\u3002\u90a3\u4e48\u5bf9\u4e8e\u5927\u6d41\u91cf\u7684\u573a\u666f\uff0c\u4e00\u822c\u90fd\u662f\u901a\u8fc7\u6c34\u5e73\u6269\u5bb9\u7684\u65b9\u5f0f\u8fdb\u884c\u5e94\u5bf9\u3002\\n\\n\u4f8b\u5982\u7535\u5546\u884c\u4e1a\u5728\u8fdb\u884c\u4fc3\u9500\u6d3b\u52a8\u6216\u79d2\u6740\u62a2\u8d2d\u6d3b\u52a8\u65f6\uff0c\u4e1a\u52a1\u6d41\u91cf\u76f8\u5bf9\u8f83\u5927\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u79cd\u573a\u666f\uff0c\u901a\u5e38\u4f1a\u8bbe\u7f6e\u5f39\u6027\u6269\u5bb9\u3002\u5728\u6d3b\u52a8\u8fdb\u884c\u65f6\uff0c\u670d\u52a1\u4f1a\u8fdb\u884c\u5f39\u6027\u4f38\u7f29\u76f4\u5230\u80fd\u591f\u627f\u8f7d\u6d41\u91cf\uff0c\u8fd9\u65f6\u4f1a\u57fa\u4e8e\u5f39\u6027\u6269\u5bb9\u7684\u7b56\u7565\uff0c\u4e3a\u4e1a\u52a1\u589e\u52a0\u526f\u672c\u6570\uff0c\u4e5f\u5c31\u662f Pod \u4f1a\u53d8\u591a\u3002\\n\\n\u6bcf\u4e2a Pod \u90fd\u6709\u5404\u81ea\u552f\u4e00\u7684 IP \uff0c\u4f46\u540c\u65f6 Pod \u7684 IP \u4e5f\u4e0d\u662f\u56fa\u5b9a\u7684\u3002\u4e3a\u4e86\u53ca\u65f6\u8ffd\u8e2a Pod IP \u7684\u53d8\u5316\uff0c\u4ece\u800c\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\uff0cEndpoints API \u63d0\u4f9b\u4e86\u5728 Kubernetes \u4e2d\u8ddf\u8e2a\u7f51\u7edc\u7aef\u70b9\u7684\u4e00\u79cd\u7b80\u5355\u800c\u76f4\u63a5\u7684\u65b9\u6cd5\u3002\\n\\n\u4f46\u968f\u7740 Kubernetes \u96c6\u7fa4\u548c\u670d\u52a1\u9010\u6e10\u5f00\u59cb\u4e3a\u66f4\u591a\u7684\u540e\u7aef Pod \u8fdb\u884c\u5904\u7406\u548c\u53d1\u9001\u8bf7\u6c42\uff0c\u6bd4\u5982\u4e0a\u6587\u63d0\u5230\u5927\u6d41\u91cf\u573a\u666f\u4e0b\uff0cPod \u6570\u91cf\u4f1a\u88ab\u4e0d\u65ad\u6269\u5bb9\uff0cEndpoints API \u4e5f\u5c06\u53d8\u5f97\u8d8a\u5927\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cEndpoints API \u5c40\u9650\u6027\u53d8\u5f97\u8d8a\u6765\u8d8a\u660e\u663e\uff0c\u751a\u81f3\u6210\u4e3a\u6027\u80fd\u74f6\u9888\u3002\\n\\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u5c40\u9650\u6027\u95ee\u9898\uff0c\u5728 Kubernetes v1.21 \u7684\u7248\u672c\u4e2d\u5f15\u5165\u4e86\u5bf9 Endpointslice API \u7684\u652f\u6301\uff0c\u89e3\u51b3\u4e86 Endpoints API \u5904\u7406\u5927\u91cf\u7f51\u7edc\u7aef\u70b9\u5e26\u6765\u7684\u6027\u80fd\u95ee\u9898\uff0c\u540c\u65f6\u63d0\u4f9b\u4e86\u53ef\u6269\u5c55\u548c\u53ef\u4f38\u7f29\u7684\u80fd\u529b\u3002\\n\\n\u901a\u8fc7\u4e0b\u56fe\u6211\u4eec\u53ef\u4ee5\u660e\u663e\u770b\u5230\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\uff1a\\n\\n- Endpoints \u5728\u6d41\u91cf\u9ad8\u5cf0\u65f6\u7684\u53d8\u5316\uff1a\\n\\n![Endpoints \u5728\u6d41\u91cf\u9ad8\u5cf0\u65f6\u7684\u53d8\u5316](https://static.apiseven.com/2022/11/25/638039cf30502.png)\\n\\n- Endpointslices \u5728\u6d41\u91cf\u9ad8\u5cf0\u65f6\u7684\u53d8\u5316\uff1a\\n\\n![Endpointslices \u5728\u6d41\u91cf\u9ad8\u5cf0\u65f6\u7684\u53d8\u5316](https://static.apiseven.com/2022/11/25/638039cf982b0.png)\\n\\n\u5728 Kubernetes \u4e2d\uff0c\u5e94\u7528\u4e4b\u95f4\u662f\u5982\u4f55\u8fdb\u884c\u76f8\u4e92\u8bbf\u95ee\u7684\u5462\uff1fEndpoints \u548c Endpointslice \u5177\u4f53\u533a\u522b\u53c8\u662f\u4ec0\u4e48\uff1f\u548c Pod \u6709\u7740\u4ec0\u4e48\u6837\u7684\u5173\u7cfb\uff1fAPISIX Ingress \u4e2d\u4e3a\u4ec0\u4e48\u8981\u652f\u6301\u8fd9\u4e9b\u7279\u6027\uff0c\u4ee5\u53ca\u5982\u4f55\u8fdb\u884c\u5b89\u88c5\u548c\u4f7f\u7528\uff1f\u672c\u6587\u5c06\u7740\u91cd\u4ecb\u7ecd\u8fd9\u4e9b\u95ee\u9898\u3002\\n\\n## Kubernetes \u4e2d\u5982\u4f55\u8bbf\u95ee\u5e94\u7528\uff1f\\n\\n\u5728 Kubernetes \u4e2d\uff0c\u6bcf\u4e2a Pod \u90fd\u6709\u5176\u81ea\u5df1\u552f\u4e00\u7684 IP \u5730\u5740\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cService \u901a\u8fc7 selector \u548c\u4e00\u7ec4 Pod \u5efa\u7acb\u5173\u8054\uff0c\u5e76\u63d0\u4f9b\u4e86\u76f8\u540c\u7684 DNS \u540d\uff0c\u5e76\u53ef\u4ee5\u5728\u5b83\u4e4b\u95f4\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u3002Kubernetes \u96c6\u7fa4\u5185\u4e0d\u540c\u5e94\u7528\u4e4b\u95f4\u53ef\u901a\u8fc7 DNS \u8fdb\u884c\u76f8\u4e92\u8bbf\u95ee\u3002\\n\\n\u5728 Service \u521b\u5efa\u65f6\uff0cKubernetes \u4f1a\u6839\u636e Service \u5173\u8054\u4e00\u4e2a Endpoints \u8d44\u6e90\uff0c\u82e5 Service \u6ca1\u6709\u5b9a\u4e49 selector \u5b57\u6bb5\uff0c\u5c06\u4e0d\u4f1a\u81ea\u52a8\u521b\u5efa Endpoints\u3002\\n\\n### \u4ec0\u4e48\u662f Endpoints\uff1f\\n\\nEndpoints \u662f Kubernetes \u4e2d\u7684\u4e00\u4e2a\u8d44\u6e90\u5bf9\u8c61\uff0c\u5b58\u50a8\u5728 etcd \u4e2d\uff0c\u7528\u6765\u8bb0\u5f55\u4e00\u4e2a Service \u5bf9\u5e94\u4e00\u7ec4 Pod \u7684\u8bbf\u95ee\u5730\u5740\uff0c\u4e00\u4e2a Service \u53ea\u6709\u4e00\u4e2a Endpoints \u8d44\u6e90\u3002\\nEndpoints \u8d44\u6e90\u4f1a\u53bb\u89c2\u6d4b Pod \u96c6\u5408\uff0c\u53ea\u8981\u670d\u52a1\u4e2d\u7684\u67d0\u4e2a Pod \u53d1\u751f\u53d8\u66f4\uff0cEndpoints \u5c31\u4f1a\u8fdb\u884c\u540c\u6b65\u66f4\u65b0\u3002\\n\\n\u6bd4\u5982\u90e8\u7f72 3 \u4e2a httpbin \u526f\u672c\uff0c\u67e5\u770b Pod \u7684\u60c5\u51b5\uff0c\u5305\u62ec IP \u4fe1\u606f\u3002\\n\\n```bash\\n$ kubectl get pods -o wide\\nNAME                                 READY   STATUS    RESTARTS        AGE   IP            NODE             NOMINATED NODE   READINESS GATES\\nhttpbin-deployment-fdd7d8dfb-8sxxq   1/1     Running   0               49m   10.1.36.133   docker-desktop   <none>           <none>\\nhttpbin-deployment-fdd7d8dfb-bjw99   1/1     Running   4 (5h39m ago)   23d   10.1.36.125   docker-desktop   <none>           <none>\\nhttpbin-deployment-fdd7d8dfb-r5nf9   1/1     Running   0               49m   10.1.36.131   docker-desktop   <none>           <none>\\n```\\n\\n\u521b\u5efa httpbin \u670d\u52a1\uff0c\u5e76\u67e5\u770b\u5e94 Endpoints \u7aef\u70b9\u60c5\u51b5\u3002\\n\\n```shell\\n$ kubectl get endpoints httpbin\\nNAME      ENDPOINTS                                      AGE\\nhttpbin   10.1.36.125:80,10.1.36.131:80,10.1.36.133:80   23d\\n\\n```\\n\\n**\u4ece\u4e0a\u8ff0\u793a\u4f8b\u53ef\u4ee5\u770b\u5230\uff0cEndpoints \u4e2d httpbin \u8d44\u6e90\u5bf9\u8c61\u7684\u6240\u6709\u7f51\u7edc\u7aef\u70b9\uff0c\u5206\u522b\u5bf9\u5e94\u4e86\u6bcf\u4e2a Pod \u7684 IP \u5730\u5740\u3002**\\n\\n\u5f53\u7136\uff0c Endpoints \u4e5f\u6709\u5b83\u7684\u4e00\u4e9b\u4e0d\u8db3\u4e4b\u5904\uff0c\u6bd4\u5982\uff1a\\n\\n1. Endpoints \u5177\u6709\u5bb9\u91cf\u9650\u5236\uff0c\u5982\u679c\u67d0\u4e2a Endpoints \u8d44\u6e90\u4e2d\u7aef\u53e3\u7684\u4e2a\u6570\u8d85\u8fc7 1000\uff0c\u90a3\u4e48 Endpoints \u63a7\u5236\u5668\u4f1a\u5c06\u5176\u622a\u65ad\u4e3a 1000\u3002\\n2. \u4e00\u4e2a Service \u53ea\u6709\u4e00\u4e2a Endpoints \u8d44\u6e90\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u9700\u8981\u4e3a\u652f\u6301\u76f8\u5e94\u670d\u52a1\u7684\u6bcf\u4e2a Pod \u5b58\u50a8 IP \u7b49\u7f51\u7edc\u4fe1\u606f\u3002\u8fd9\u5bfc\u81f4 Endpoints \u8d44\u6e90\u53d8\u7684\u5341\u5206\u5de8\u5927\uff0c\u5176\u4e2d\u4e00\u4e2a\u7aef\u70b9\u53d1\u751f\u4e86\u53d8\u66f4\uff0c\u5c06\u4f1a\u5bfc\u81f4\u6574\u4e2a Endpoints \u8d44\u6e90\u66f4\u65b0\u3002\u5f53\u4e1a\u52a1\u9700\u8981\u8fdb\u884c\u9891\u7e41\u7aef\u70b9\u66f4\u65b0\u65f6\uff0c\u4e00\u4e2a\u5de8\u5927\u7684 API \u8d44\u6e90\u88ab\u76f8\u4e92\u4f20\u9012\uff0c\u800c\u8fd9\u4f1a\u5f71\u54cd\u5230 Kubernetes \u7ec4\u4ef6\u7684\u6027\u80fd\uff0c\u5e76\u4e14\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u7f51\u7edc\u6d41\u91cf\u548c\u989d\u5916\u7684\u5904\u7406\u3002\\n\\n### \u4ec0\u4e48\u662f Endpointslices\uff1f\\n\\nEndpointslices \u4e3a Endpoints \u63d0\u4f9b\u4e86\u4e00\u79cd\u53ef\u6269\u7f29\u548c\u53ef\u62d3\u5c55\u7684\u66ff\u4ee3\u65b9\u6848\uff0c\u7f13\u89e3\u5904\u7406\u5927\u91cf\u7f51\u7edc\u7aef\u70b9\u5e26\u6765\u7684\u6027\u80fd\u95ee\u9898\uff0c\u8fd8\u80fd\u4e3a\u4e00\u4e9b\u8bf8\u5982\u62d3\u6251\u8def\u7531\u7684\u989d\u5916\u529f\u80fd\u63d0\u4f9b\u4e00\u4e2a\u53ef\u6269\u5c55\u7684\u5e73\u53f0\u3002**\u8be5\u7279\u6027\u5728 Kubernetes v1.21+ \u7684\u7248\u672c\u4e2d\u5df2\u63d0\u4f9b\u652f\u6301\u3002**\\n\\nEndpointSlice \u65e8\u5728\u901a\u8fc7\u5206\u7247\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u6b64\u95ee\u9898\uff0c\u5e76\u6ca1\u6709\u4f7f\u7528\u5355\u4e2a Endpoints \u8d44\u6e90\u8ddf\u8e2a\u670d\u52a1\u7684\u6240\u6709\u7f51\u7edc\u7aef\u70b9\uff0c\u800c\u662f\u5c06\u5b83\u4eec\u62c6\u5206\u4e3a\u591a\u4e2a\u8f83\u5c0f\u7684 EndpointSlice\u3002\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u63a7\u5236\u9762\u521b\u5efa\u548c\u7ba1\u7406\u7684 EndpointSlice \u5c06\u5305\u542b\u4e0d\u8d85\u8fc7 100 \u4e2a\u7aef\u70b9\u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528 [kube-controller-manager](https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-controller-manager/) \u7684 `--max-endpoints-per-slice` \u6807\u5fd7\u8bbe\u7f6e\u6b64\u503c\uff0c\u5176\u6700\u5927\u503c\u4e3a 1000\u3002\\n\\n### \u4e3a\u4ec0\u4e48\u9700\u8981 Endpointslices\uff1f\\n\\n\u9996\u5148\uff0c\u6211\u4eec\u8003\u8651\u5177\u6709 2000 \u4e2a Pod \u7684\u670d\u52a1\u5b83\u6700\u7ec8\u53ef\u80fd\u5177\u6709 1.0 MB \u7684 Endpoints \u8d44\u6e90\u3002\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5982\u679c\u8be5\u670d\u52a1\u53d1\u751f\u6eda\u52a8\u66f4\u65b0\u6216\u8282\u70b9\u8fc1\u79fb\uff0c\u90a3\u4e48 Endpoints \u8d44\u6e90\u5c06\u4f1a\u9891\u7e41\u53d8\u66f4\u3002\\n\\n\u60f3\u8c61\u4e00\u4e0b\uff0c\u5982\u679c\u6eda\u52a8\u66f4\u65b0\u4f1a\u5bfc\u81f4\u5168\u90e8 Pod \u90fd\u88ab\u66ff\u6362\uff0c[\u7531\u4e8e etcd \u5177\u6709\u6700\u5927\u8bf7\u6c42\u5927\u5c0f\u9650\u5236](https://etcd.io/docs/v3.3/dev-guide/limit/#request-size-limit)\uff0cKubernetes \u5bf9 Endpoints \u6700\u5927\u5bb9\u91cf\u9650\u5236\u4e3a 1000\uff0c\u5982\u679c\u7f51\u7edc\u7aef\u70b9\u6570\u91cf\u8d85\u51fa\u4e86 1000\uff0c\u90a3\u4e48\u591a\u51fa\u6765\u7684\u7f51\u7edc\u7aef\u70b9\uff0c\u5c06\u4e0d\u4f1a\u88ab Endpoints \u8d44\u6e90\u8bb0\u5f55\u3002\\n\\n\u5f53\u7136\u4e5f\u53ef\u80fd\u56e0\u4e3a\u4e00\u4e9b\u9700\u6c42\uff0c\u9700\u8981\u591a\u6b21\u8fdb\u884c\u6eda\u52a8\u66f4\u65b0\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5de8\u5927\u7684 API \u8d44\u6e90\u5bf9\u8c61\u5c06\u4f1a Kubernetes \u7ec4\u4ef6\u4e2d\u6765\u56de\u4f20\u9012\uff0c\u6781\u5927\u5f71\u54cd\u4e86 Kubernetes \u7ec4\u4ef6\u7684\u6027\u80fd\u3002\\n\u5982\u679c\u4f7f\u7528\u4e86 Endpointslices\uff0c\u5047\u8bbe\u4e00\u4e2a\u670d\u52a1\u540e\u7aef\u6709 2000 \u4e2a Pod\u3002\u5982\u679c\u5c06\u914d\u7f6e\u4fee\u6539\u4e3a\u6bcf\u4e2a  Endpointslices \u5b58\u50a8 100 \u4e2a\u7aef\u70b9\uff0c\u6700\u7ec8\u5c06\u83b7\u5f97 20 \u4e2a Endpointslices\u3002\u6dfb\u52a0\u6216\u5220\u9664 Pod \u65f6\uff0c\u53ea\u9700\u8981\u66f4\u65b0\u5176\u4e2d 1 \u4e2a Endpointslice \u8d44\u6e90\u5373\u53ef\uff0c\u8fd9\u6837\u64cd\u4f5c\u540e\uff0c\u53ef\u6269\u5c55\u6027\u548c\u7f51\u7edc\u53ef\u4f38\u7f29\u6709\u4e86\u5f88\u5927\u7684\u63d0\u5347\u3002\\n\\n\u6bd4\u8d77\u5728\u6d41\u91cf\u9ad8\u5cf0\u65f6\uff0c\u670d\u52a1\u4e3a\u4e86\u627f\u8f7d\u6d41\u91cf\uff0c\u6269\u5bb9\u51fa\u5927\u91cf\u7684 Pod\uff0cEndpoints \u8d44\u6e90\u4f1a\u88ab\u9891\u7e41\u66f4\u65b0\uff0c\u4e24\u4e2a\u4f7f\u7528\u573a\u666f\u7684\u5dee\u5f02\u5c31\u53d8\u5f97\u975e\u5e38\u660e\u663e\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0c\u65e2\u7136\u670d\u52a1\u7684\u6240\u6709 Pod IP \u90fd\u4e0d\u9700\u8981\u5b58\u50a8\u5728\u5355\u4e2a\u8d44\u6e90\u4e2d\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u5fc5\u62c5\u5fc3 etcd \u4e2d\u5b58\u50a8\u7684\u5bf9\u8c61\u7684\u5927\u5c0f\u9650\u5236\u3002\\n\\n### Endpoints VS Endpointslice\\n\\n> \u56e0\u4e3a Endpointslice \u662f\u5728 Kubernetes v1.21+ \u7684\u7248\u672c\u5f97\u5230\u652f\u6301\uff0c\u6240\u4ee5\u8be5\u7ed3\u8bba\u662f\u57fa\u4e8e Kubernetes v1.21+ \u7248\u672c\u3002\\n\\n\u901a\u8fc7\u4e0a\u6587\u7684\u63cf\u8ff0\u6211\u4eec\u603b\u7ed3\u4e00\u4e0b\u4e24\u79cd\u8d44\u6e90\u7684\u9002\u7528\u60c5\u51b5\u3002\\n\\nEndpoints \u9002\u7528\u573a\u666f\uff1a\\n\\n- \u6709\u5f39\u6027\u4f38\u7f29\u9700\u6c42\uff0cPod \u6570\u91cf\u8f83\u5c11\uff0c\u4f20\u9012\u8d44\u6e90\u4e0d\u4f1a\u9020\u6210\u5927\u91cf\u7f51\u7edc\u6d41\u91cf\u548c\u989d\u5916\u5904\u7406\u3002\\n- \u65e0\u5f39\u6027\u4f38\u7f29\u9700\u6c42\uff0cPod \u6570\u91cf\u4e0d\u4f1a\u592a\u591a\u3002\u54ea\u6015 Pod \u6570\u91cf\u662f\u56fa\u5b9a\uff0c\u4f46\u662f\u603b\u662f\u8981\u6eda\u52a8\u66f4\u65b0\u6216\u8005\u51fa\u73b0\u6545\u969c\u7684\u3002\\n\\nEndpointslice \u9002\u7528\u573a\u666f:\\n\\n- \u6709\u5f39\u6027\u9700\u6c42\uff0c\u4e14 Pod \u6570\u91cf\u8f83\u591a\uff08\u51e0\u767e\u4e0a\u5343\uff09\u3002\\n- Pod \u6570\u91cf\u5f88\u591a\uff08\u51e0\u767e\u4e0a\u5343\uff09\uff0c\u56e0\u4e3a Endpoints \u7f51\u7edc\u7aef\u70b9\u6700\u5927\u6570\u91cf\u9650\u5236\u4e3a 1000\uff0c\u6240\u4ee5\u8d85\u8fc7 1000 \u7684 Pod \u5fc5\u987b\u5f97\u7528 Endpointslice\u3002\\n\\n## \u5728 APISIX Ingress \u4e2d\u7684\u5b9e\u8df5\\n\\nAPISIX Ingress Controller \u662f\u4e00\u4e2a Ingress \u63a7\u5236\u5668\u7684\u5b9e\u73b0\u3002\u53ef\u4ee5\u5c06\u7528\u6237\u914d\u7f6e\u7684\u89c4\u5219\u8f6c\u6362\u4e3a Apache APISIX\u4e2d\u7684\u89c4\u5219\uff0c\u4ece\u800c\u4f7f\u7528 APISIX \u5b8c\u6210\u5177\u4f53\u7684\u6d41\u91cf\u627f\u8f7d\u3002\\n\u5728\u5177\u4f53\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\uff0cAPISIX Ingress \u901a\u8fc7 watch Endpoints \u6216 Endpointslice \u8d44\u6e90\u7684\u53d8\u5316\uff0c\u4ece\u800c\u8ba9 APISIX \u80fd\u591f\u5bf9 Pod \u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u548c\u5065\u5eb7\u68c0\u67e5\u7b49\u3002\u4e3a\u4e86\u80fd\u591f\u652f\u6301 Kubernetes v1.16+ \u7684\u7248\u672c\uff0cAPISIX Ingress \u5728\u5b89\u88c5\u65f6\uff0c\u9ed8\u8ba4\u4f7f\u7528 Endpoints \u7684\u7279\u6027\u3002\\n\\n**\u5982\u679c\u4f60\u7684\u96c6\u7fa4\u7248\u672c\u4e3a Kubernetes v1.21+\uff0c\u5728\u5b89\u88c5 APISIX Ingress \u65f6\uff0c\u9700\u8981\u6307\u5b9a `watchEndpointSlice=true` \u6807\u5fd7\u6765\u5f00\u542f Endpointslice \u7279\u6027\u7684\u652f\u6301\u3002**\\n\\n> \u6ce8\u610f\uff1a\u5728\u96c6\u7fa4\u7684\u7248\u672c\u4e3a Kubernetes v1.21+ \u65f6\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528 Endpointslice \u7279\u6027\u3002\u5426\u5219\u5f53\u670d\u52a1\u4e2d Pod \u6570\u91cf\u8d85\u8fc7 `--max-endpoints-per-slice` \u6807\u5fd7\u8bbe\u5b9a\u7684\u503c\u65f6\uff0c\u7531\u4e8e APISIX Ingress watch \u7684\u662f Endpoints \u8d44\u6e90\u5bf9\u8c61\uff0c\u5219\u4f1a\u5bfc\u81f4\u914d\u7f6e\u7684\u4e22\u5931\u3002\u5f00\u542f\u6b64\u7279\u6027\uff0c\u5c31\u4e0d\u989d\u5916\u5173\u6ce8 `--max-endpoints-per-slice` \u7684\u503c\u3002\\n\\n\u4ee5\u4e0b\u5c06\u4e3a\u4f60\u7b80\u5355\u4ecb\u7ecd\u5982\u4f55\u5728 APISIX Ingress \u4e2d\u5e94\u7528 Endpointslice \u7279\u6027\u3002\\n\\n### \u521b\u5efa\u5305\u542b 20 \u4e2a\u526f\u672c\u7684 Service\\n\\n\u4f7f\u7528 `kubectl apply -f httpbin-deploy.yaml` \u547d\u4ee4\uff0c\u5728 Kuernetes \u4e2d\u90e8\u7f72 httpbin \u5e94\u7528\u670d\u52a1\uff0c\u5e76\u521b\u5efa 20 \u4e2a Pod \u526f\u672c\u3002\u5177\u4f53 `htppbin-deploy.yaml` \u6587\u4ef6\u914d\u7f6e\u53ef\u53c2\u8003\u4e0b\u65b9\u4ee3\u7801\u3002\\n\\n```YAML\\n# htppbin-deploy.yaml\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: httpbin-deployment\\nspec:\\n  replicas: 20\\n  selector:\\n    matchLabels:\\n      app: httpbin-deployment\\n  strategy:\\n    rollingUpdate:\\n      maxSurge: 50%\\n      maxUnavailable: 1\\n    type: RollingUpdate\\n  template:\\n    metadata:\\n      labels:\\n        app: httpbin-deployment\\n    spec:\\n      terminationGracePeriodSeconds: 0\\n      containers:\\n        - livenessProbe:\\n            failureThreshold: 3\\n            initialDelaySeconds: 2\\n            periodSeconds: 5\\n            successThreshold: 1\\n            tcpSocket:\\n              port: 80\\n            timeoutSeconds: 2\\n          readinessProbe:\\n            failureThreshold: 3\\n            initialDelaySeconds: 2\\n            periodSeconds: 5\\n            successThreshold: 1\\n            tcpSocket:\\n              port: 80\\n            timeoutSeconds: 2\\n          image: \\"kennethreitz/httpbin:latest\\"\\n          imagePullPolicy: IfNotPresent\\n          name: httpbin-deployment\\n          ports:\\n            - containerPort: 80\\n              name: \\"http\\"\\n              protocol: \\"TCP\\"\\n\\n---\\n\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: httpbin\\nspec:\\n  selector:\\n    app: httpbin-deployment\\n  ports:\\n    - name: http\\n      port: 80\\n      protocol: TCP\\n      targetPort: 80\\n  type: ClusterIP\\n```\\n\\n### \u901a\u8fc7 APISIX Ingress \u4ee3\u7406\\n\\n\u7b2c\u4e00\u6b65\uff0c\u4f7f\u7528 Helm \u5b89\u88c5 APISIX Ingress\u3002\\n\u901a\u8fc7 `--set ingress-controller.config.kubernetes.watchEndpointSlice=true` \u5f00\u542f Endpointslice \u7279\u6027\u7684\u652f\u6301\u3002\\n\\n```YAML\\nhelm repo add apisix https://charts.apiseven.com\\nhelm repo add bitnami https://charts.bitnami.com/bitnami\\nhelm repo update\\n\\n\\nkubectl create ns ingress-apisix\\nhelm install apisix apisix/apisix \\\\\\n  --set gateway.type=NodePort \\\\\\n  --set ingress-controller.enabled=true \\\\\\n  --namespace ingress-apisix \\\\\\n  --set ingress-controller.config.apisix.serviceNamespace=ingress-apisix \\\\\\n  --set ingress-controller.config.kubernetes.watchEndpointSlice=true\\n```\\n\\n\u7b2c\u4e8c\u6b65\uff0c\u4f7f\u7528 CRD \u8d44\u6e90\u8fdb\u884c\u4ee3\u7406\u3002\u6ce8\u610f\uff0cAPISIX Ingress \u4e2d\u5bf9 Endpoints \u548c Endpointslice \u7279\u6027\u7684\u652f\u6301\uff0c\u4f7f\u7528\u8005\u662f\u611f\u77e5\u4e0d\u5230\u7684\uff0c\u5b83\u4eec\u7684\u914d\u7f6e\u90fd\u662f\u4e00\u81f4\u7684\u3002\\n\\n```YAML\\napiVersion: apisix.apache.org/v2\\nkind: ApisixRoute\\nmetadata:\\n  name: httpbin-route\\nspec:\\n  http:\\n  - name: rule\\n    match:\\n      hosts:\\n      - httpbin.org\\n      paths:\\n      - /get\\n    backends:\\n       - serviceName: httpbin\\n         servicePort: 80\\n```\\n\\n\u7b2c\u4e09\u6b65\uff0c\u8fdb\u5165 APISIX Pod \u4e2d\u67e5\u770b\u3002\u53ef\u4ee5\u770b\u5230\u5728 APISIX \u4e2d\u7684 upstream \u5bf9\u8c61 nodes \u5b57\u6bb5\u5305\u542b\u4e86 20 \u4e2a Pod \u7684 IP \u5730\u5740\u3002\\n\\n```bash\\nkubectl exec -it ${Pod for APISIX} -n ingress-apisix -- curl \\"http://127.0.0.1:9180/apisix/admin/upstreams\\" -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\'\\n```\\n\\n```JSON\\n{\\n    \\"action\\": \\"get\\",\\n    \\"count\\": 1,\\n    \\"node\\": {\\n        \\"key\\": \\"\\\\/apisix\\\\/upstreams\\",\\n        \\"nodes\\": [\\n            {\\n                \\"value\\": {\\n                    \\"hash_on\\": \\"vars\\",\\n                    \\"desc\\": \\"Created by apisix-ingress-controller, DO NOT modify it manually\\",\\n                    \\"pass_host\\": \\"pass\\",\\n                    \\"nodes\\": [\\n                        {\\n                            \\"weight\\": 100,\\n                            \\"host\\": \\"10.1.36.100\\",\\n                            \\"priority\\": 0,\\n                            \\"port\\": 80\\n                        },\\n                        {\\n                            \\"weight\\": 100,\\n                            \\"host\\": \\"10.1.36.101\\",\\n                            \\"priority\\": 0,\\n                            \\"port\\": 80\\n                        },\\n                        {\\n                            \\"weight\\": 100,\\n                            \\"host\\": \\"10.1.36.102\\",\\n                            \\"priority\\": 0,\\n                            \\"port\\": 80\\n                        },\\n                        {\\n                            \\"weight\\": 100,\\n                            \\"host\\": \\"10.1.36.103\\",\\n                            \\"priority\\": 0,\\n                            \\"port\\": 80\\n                        },\\n                        {\\n                            \\"weight\\": 100,\\n                            \\"host\\": \\"10.1.36.104\\",\\n                            \\"priority\\": 0,\\n                            \\"port\\": 80\\n                        },\\n                        {\\n                            \\"weight\\": 100,\\n                            \\"host\\": \\"10.1.36.109\\",\\n                            \\"priority\\": 0,\\n                            \\"port\\": 80\\n                        },\\n                        {\\n                            \\"weight\\": 100,\\n                            \\"host\\": \\"10.1.36.92\\",\\n                            \\"priority\\": 0,\\n                            \\"port\\": 80\\n                        }\\n                        ... // \u4ee5\u4e0b\u7701\u7565 13 \u4e2a\u8282\u70b9\\n                        // 10.1.36.118\\n                        // 10.1.36.115\\n                        // 10.1.36.116\\n                        // 10.1.36.106\\n                        // 10.1.36.113\\n                        // 10.1.36.111\\n                        // 10.1.36.108\\n                        // 10.1.36.114\\n                        // 10.1.36.107\\n                        // 10.1.36.110\\n                        // 10.1.36.105\\n                        // 10.1.36.112\\n                        // 10.1.36.117\\n                    ],\\n                    \\"labels\\": {\\n                        \\"managed-by\\": \\"apisix-ingress-controller\\"\\n                    },\\n                    \\"type\\": \\"roundrobin\\",\\n                    \\"name\\": \\"default_httpbin_80\\",\\n                    \\"scheme\\": \\"http\\"\\n                },\\n                \\"key\\": \\"\\\\/apisix\\\\/upstreams\\\\/5ce57b8e\\"\\n            }\\n        ],\\n        \\"dir\\": true\\n    }\\n}\\n```\\n\\n\u4e0a\u8ff0\u4fe1\u606f\u4e0e Endpointslice \u4e2d\u7684\u7f51\u7edc\u7aef\u70b9\u76f8\u5bf9\u5e94\u3002\\n\\n```YAML\\naddressType: IPv4\\napiVersion: discovery.k8s.io/v1\\nendpoints:\\n- addresses:\\n  - 10.1.36.92\\n  ...\\n- addresses:\\n  - 10.1.36.100\\n  ...\\n- addresses:\\n  - 10.1.36.104\\n  ...\\n- addresses:\\n  - 10.1.36.102\\n  ...\\n- addresses:\\n  - 10.1.36.101\\n  ...\\n- addresses:\\n  - 10.1.36.103\\n  ...\\n- addresses:\\n  - 10.1.36.109\\n  ...\\n- addresses:\\n  - 10.1.36.118\\n  ...\\n- addresses:\\n  - 10.1.36.115\\n  ...\\n- addresses:\\n  - 10.1.36.116\\n  ...\\n- addresses:\\n  - 10.1.36.106\\n  ...\\n- addresses:\\n  - 10.1.36.113\\n  ...\\n- addresses:\\n  - 10.1.36.111\\n  ...\\n- addresses:\\n  - 10.1.36.108\\n  ...\\n- addresses:\\n  - 10.1.36.114\\n  ...\\n- addresses:\\n  - 10.1.36.107\\n  ...\\n- addresses:\\n  - 10.1.36.110\\n  ...\\n- addresses:\\n  - 10.1.36.105\\n  ...\\n- addresses:\\n  - 10.1.36.112\\n  ...\\n- addresses:\\n  - 10.1.36.117\\n  ...\\nkind: EndpointSlice\\nmetadata:\\n  labels:\\n    endpointslice.kubernetes.io/managed-by: endpointslice-controller.k8s.io\\n    kubernetes.io/service-name: httpbin\\n  name: httpbin-dkvtr\\n  namespace: default\\nports:\\n- name: http\\n  port: 80\\n  protocol: TCP\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4ecb\u7ecd\u4e86 Kubernetes \u9700\u8981\u90e8\u7f72\u5927\u91cf Pod \u7684\u573a\u666f\u548c\u9047\u5230\u7684\u95ee\u9898\uff0c\u5bf9\u6bd4\u4e86 Endpoints \u548c Endpointslice \u4e4b\u95f4\u533a\u522b\uff0c\u4ee5\u53ca\u5982\u4f55\u5b89\u88c5 APISIX Ingress \u6765\u4f7f\u7528 Endpointslice \u7684\u7279\u6027\u3002\\n\\n\u5982\u679c\u4f60\u7684\u96c6\u7fa4\u7248\u672c\u4e3a Kubernetes v1.21+\uff0c\u63a8\u8350\u5728\u5b89\u88c5 APISIX Ingress \u65f6\u5f00\u542f Endpointslice \u7279\u6027\u652f\u6301\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u5173\u6ce8 `--max-endpoints-per-slice` \u6807\u5fd7\u8bbe\u5b9a\u7684\u503c\uff0c\u4ece\u800c\u907f\u514d\u914d\u7f6e\u4e22\u5931\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (11.5 - 11.20)","metadata":{"permalink":"/zh/blog/2022/11/23/weekly-report-1123","source":"@site/blog/2022/11/23/weekly-report-1123.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (11.5 - 11.20)","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86 `proxy-mirror` \u63d2\u4ef6\u652f\u6301\u89e3\u6790 host \u57df\u540d\u3001`kafka-logger` \u63d2\u4ef6\u65b0\u589e brokers \u5c5e\u6027\uff0c\u652f\u6301\u4e0d\u540c broker \u8bbe\u7f6e\u76f8\u540c host \u7b49\u529f\u80fd\u3002","date":"2022-11-23T00:00:00.000Z","formattedDate":"2022\u5e7411\u670823\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.355,"truncated":true,"authors":[],"prevItem":{"title":"APISIX Ingress \u662f\u5982\u4f55\u652f\u6301\u4e0a\u5343\u4e2a Pod \u526f\u672c\u7684\u5e94\u7528","permalink":"/zh/blog/2022/11/25/how-apisix-support-1000-pods"},"nextItem":{"title":"\u4e3a\u4ec0\u4e48 NGINX \u7684 reload \u4e0d\u662f\u70ed\u52a0\u8f7d\uff1f","permalink":"/zh/blog/2022/11/23/why-is-not-reload-hot-loaded-in-nginx"}},"content":"> \u4ece 11.5 - 11.20\uff0c\u6709 31 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 69 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2022/11/24/637ed683c50d5.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/2022/11/24/637ed68473f14.png)\\n\\n## Good first issue\\n\\n### Issue #8354\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/8354\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4e3a\u907f\u514d\u4e3b\u673a\u5339\u914d\u4e89\u8bae\uff0c\u5c06\u9ed8\u8ba4 HTTP \u8def\u7531\u5668\u4ece `radixtree_uri` \u66f4\u6539\u4e3a `radixtree_host_uri`\u3002\\n\\n### Issue #8311\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/8311\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5e0c\u671b Kubernetes \u7684\u670d\u52a1\u53d1\u73b0\u53ef\u4ee5\u652f\u6301\u66f4\u591a\u7684\u914d\u7f6e\u9879\uff0c\u7528\u4ee5\u5e94\u5bf9\u4e0d\u540c\u7684\u9a8c\u8bc1\u573a\u666f\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [`jwt-auth` \u652f\u6301\u9690\u85cf\u5ba2\u6237\u7aef\u8ba4\u8bc1\u51ed\u636e](https://github.com/apache/apisix/pull/8206)\uff08\u8d21\u732e\u8005\uff1a[pixeldin](https://github.com/pixeldin)\uff09\\n\\n- [APISIX \u517c\u5bb9\u8fd0\u884c OpenSSL 3.0 \u5e76\u5f00\u542f FIPS \u7279\u6027](https://github.com/apache/apisix/pull/8298)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u662f\u4ec0\u4e48](https://apisix.apache.org/zh/blog/2022/11/10/what-is-service-in-microservice-discovery/)\\n\\n    \u672c\u6587\u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u7684\u76f8\u5173\u80cc\u666f\u548c APISIX \u5bf9\u4e8e\u670d\u52a1\u53d1\u73b0\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\uff0c\u6765\u4ecb\u7ecd\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5185\u5bb9\u3002\\n\\n- [\u5b9e\u8df5\u4e00\u5e74\u4e4b\u4e45\uff0cvivo \u5982\u4f55\u57fa\u4e8e APISIX \u8fdb\u884c\u4e1a\u52a1\u57fa\u7840\u67b6\u6784\u7684\u6f14\u8fdb](https://apisix.apache.org/zh/blog/2022/11/13/vivo-with-apache-apisix/)\\n\\n    \u672c\u6587\u4ece\u5e94\u7528 APISIX \u540e\u7684\u8c03\u6574\u4e0e\u5b9e\u8df5\u56f0\u96be\u89d2\u5ea6\u5165\u624b\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 vivo \u57fa\u4e8e APISIX \u7684\u4f01\u4e1a\u5b9e\u8df5\u7ec6\u8282\u3002\\n\\n- [\u817e\u8baf\u84dd\u9cb8 API \u7f51\u5173\u5982\u4f55\u501f\u52a9 APISIX \u5b9e\u73b0\u4ea7\u54c1\u5347\u7ea7\u4e0e\u4e1a\u52a1\u5b8c\u5584](https://apisix.apache.org/zh/blog/2022/11/05/tencent-blueking-with-apisix/)\\n\\n    \u672c\u6587\u4ece\u84dd\u9cb8\u7f51\u5173\u7684\u8fed\u4ee3\u8fc7\u7a0b\u548c\u5e94\u7528 APISIX \u540e\u7684\u4ea7\u54c1\u5b9e\u8df5\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u57fa\u4e8e APISIX \u7684\u7f51\u5173\u5e94\u7528\u5b9e\u4f8b\u3002\\n\\n- [\u4ece Traefik \u5230 APISIX\uff0c\u6c7d\u8f66\u667a\u80fd\u8ba1\u7b97\u5e73\u53f0\u516c\u53f8\u300c\u5730\u5e73\u7ebf\u300d\u5728 Ingress Controller \u7684\u63a2\u7d22\u548c\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/10/28/apisix-ingress-with-horizon-ai/)\\n\\n    \u5730\u5e73\u7ebf\u4f5c\u4e3a\u4e00\u5bb6\u81f4\u529b\u4e8e\u6c7d\u8f66\u81ea\u52a8\u9a7e\u9a76\u82af\u7247\u7684\u516c\u53f8\uff0c\u5728\u4e1a\u52a1\u8fed\u4ee3\u4e2d\u4e3a\u4f55\u4ece Traefik \u5207\u6362\u5230\u4e86 APISIX Ingress \u53bb\u652f\u6491\u4e1a\u52a1\uff1f"},{"id":"\u4e3a\u4ec0\u4e48 NGINX \u7684 reload \u4e0d\u662f\u70ed\u52a0\u8f7d\uff1f","metadata":{"permalink":"/zh/blog/2022/11/23/why-is-not-reload-hot-loaded-in-nginx","source":"@site/blog/2022/11/23/why-is-not-reload-hot-loaded-in-nginx.md","title":"\u4e3a\u4ec0\u4e48 NGINX \u7684 reload \u4e0d\u662f\u70ed\u52a0\u8f7d\uff1f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 APISIX \u5982\u4f55\u89e3\u51b3 NGINX \u70ed\u52a0\u8f7d\u5e26\u6765\u7684\u7f3a\u9677\u3002","date":"2022-11-23T00:00:00.000Z","formattedDate":"2022\u5e7411\u670823\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.98,"truncated":true,"authors":[{"name":"\u5218\u7ef4","url":"https://github.com/monkeyDluffy6017","imageURL":"https://github.com/monkeyDluffy6017.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (11.5 - 11.20)","permalink":"/zh/blog/2022/11/23/weekly-report-1123"},"nextItem":{"title":"\u5b9e\u8df5\u4e00\u5e74\u4e4b\u4e45\uff0cvivo \u5982\u4f55\u57fa\u4e8e APISIX \u8fdb\u884c\u4e1a\u52a1\u57fa\u7840\u67b6\u6784\u7684\u6f14\u8fdb","permalink":"/zh/blog/2022/11/13/vivo-with-apache-apisix"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 APISIX \u5982\u4f55\u89e3\u51b3 NGINX \u70ed\u52a0\u8f7d\u5e26\u6765\u7684\u7f3a\u9677\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u8fd9\u6bb5\u65f6\u95f4\u5728 Reddit \u770b\u5230\u4e00\u4e2a\u8ba8\u8bba\uff0c\u4e3a\u4ec0\u4e48 NGINX \u4e0d\u652f\u6301\u70ed\u52a0\u8f7d\uff1f\u4e4d\u770b\u4e4b\u4e0b\u5f88\u53cd\u5e38\u8bc6\uff0c\u4f5c\u4e3a\u4e16\u754c\u7b2c\u4e00\u5927 Web \u670d\u52a1\u5668\uff0c\u4e0d\u652f\u6301\u70ed\u52a0\u8f7d\uff1f\u96be\u9053\u5927\u5bb6\u90fd\u5728\u4f7f\u7528\u7684 `nginx -s reload` \u547d\u4ee4\u90fd\u7528\u9519\u4e86\uff1f \u5e26\u7740\u8fd9\u4e2a\u7591\u95ee\uff0c\u8ba9\u6211\u4eec\u5f00\u59cb\u8fd9\u6b21\u63a2\u7d22\u4e4b\u65c5\uff0c\u4e00\u8d77\u804a\u804a\u70ed\u52a0\u8f7d\u548c NGINX \u7684\u6545\u4e8b\u3002\\n\\n## NGINX \u76f8\u5173\u4ecb\u7ecd\\n\\nNGINX \u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u5f00\u6e90 Web \u670d\u52a1\u5668\uff0c\u4f7f\u7528 C \u8bed\u8a00\u5f00\u53d1\u3002\u636e\u7edf\u8ba1\uff0c\u5168\u4e16\u754c\u6d41\u91cf\u6700\u9ad8\u7684\u524d 1000 \u540d\u7f51\u7ad9\u4e2d\uff0c\u6709\u8d85\u8fc7 40% \u7684\u7f51\u7ad9\u90fd\u5728\u4f7f\u7528 NGINX \u5904\u7406\u6d77\u91cf\u8bf7\u6c42\u3002\\n\\nNGINX \u6709\u4ec0\u4e48\u4f18\u52bf\uff0c\u5bfc\u81f4\u5b83\u4ece\u4f17\u591a\u7684 Web \u670d\u52a1\u5668\u4e2d\u8131\u9896\u800c\u51fa\uff0c\u5e76\u4e00\u76f4\u4fdd\u6301\u9ad8\u4f7f\u7528\u91cf\u5462\uff1f\\n\\n\u6211\u89c9\u5f97\u6838\u5fc3\u539f\u56e0\u5728\u4e8e\uff0cNGINX \u5929\u751f\u5584\u4e8e\u5904\u7406\u9ad8\u5e76\u53d1\uff0c\u80fd\u5728\u9ad8\u5e76\u53d1\u8bf7\u6c42\u7684\u540c\u65f6\u4fdd\u6301\u9ad8\u6548\u7684\u670d\u52a1\u3002\u76f8\u6bd4\u4e8e\u540c\u65f6\u4ee3\u7684\u5176\u4ed6\u7ade\u4e89\u5bf9\u624b\u4f8b\u5982 Apache\u3001Tomcat \u7b49\uff0c\u5176\u9886\u5148\u7684\u4e8b\u4ef6\u9a71\u52a8\u578b\u8bbe\u8ba1\u548c\u5168\u5f02\u6b65\u7684\u7f51\u7edc I/O \u5904\u7406\u673a\u5236\uff0c\u4ee5\u53ca\u6781\u81f4\u7684\u5185\u5b58\u5206\u914d\u7ba1\u7406\u7b49\u4f17\u591a\u4f18\u79c0\u8bbe\u8ba1\uff0c\u5c06\u670d\u52a1\u5668\u786c\u4ef6\u8d44\u6e90\u538b\u7f29\u5230\u4e86\u6781\u81f4\u3002\u4f7f\u5f97 NGINX \u6210\u4e3a\u9ad8\u6027\u80fd Web \u670d\u52a1\u5668\u7684\u4ee3\u540d\u8bcd\u3002\\n\\n\u5f53\u7136\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u539f\u56e0\uff0c\u6bd4\u5982\uff1a\\n\\n- \u9ad8\u5ea6\u6a21\u5757\u5316\u7684\u8bbe\u8ba1\uff0c\u4f7f\u5f97 NGINX \u62e5\u6709\u65e0\u6570\u4e2a\u529f\u80fd\u4e30\u5bcc\u7684\u5b98\u65b9\u6a21\u5757\u548c\u7b2c\u4e09\u65b9\u62d3\u5c55\u6a21\u5757\u3002\\n- \u6700\u81ea\u7531\u7684 BSD \u8bb8\u53ef\u534f\u8bae\uff0c\u4f7f\u5f97\u65e0\u6570\u5f00\u53d1\u8005\u613f\u610f\u4e3a NGINX \u8d21\u732e\u81ea\u5df1\u7684\u60f3\u6cd5\u3002\\n- \u652f\u6301\u70ed\u52a0\u8f7d\uff0c\u80fd\u4fdd\u8bc1 NGINX \u63d0\u4f9b 7x24h \u4e0d\u95f4\u65ad\u7684\u670d\u52a1\u3002\\n\\n## \u5173\u4e8e\u70ed\u52a0\u8f7d\\n\\n\u5927\u5bb6\u671f\u671b\u7684\u70ed\u52a0\u8f7d\u529f\u80fd\u662f\u4ec0\u4e48\u6837\u7684\uff1f\u6211\u4e2a\u4eba\u8ba4\u4e3a\uff0c\u9996\u5148\u5e94\u8be5\u662f\u7528\u6237\u7aef\u65e0\u611f\u77e5\u7684\uff0c\u5728\u4fdd\u8bc1\u7528\u6237\u8bf7\u6c42\u6b63\u5e38\u548c\u8fde\u63a5\u4e0d\u65ad\u7684\u60c5\u51b5\u4e0b\uff0c\u5b9e\u73b0\u670d\u52a1\u7aef\u6216\u4e0a\u6e38\u7684\u52a8\u6001\u66f4\u65b0\u3002\\n\\n\u90a3\u4ec0\u4e48\u60c5\u51b5\u4e0b\u9700\u8981\u70ed\u52a0\u8f7d\uff1f\u5728\u5982\u4eca\u4e91\u539f\u751f\u65f6\u4ee3\u4e0b\uff0c\u5fae\u670d\u52a1\u67b6\u6784\u76db\u884c\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u5e94\u7528\u573a\u666f\u6709\u4e86\u66f4\u52a0\u9891\u7e41\u7684\u670d\u52a1\u53d8\u66f4\u9700\u6c42\u3002\u5305\u62ec\u53cd\u5411\u4ee3\u7406\u57df\u540d\u4e0a\u4e0b\u7ebf\u3001\u4e0a\u6e38\u5730\u5740\u53d8\u66f4\u3001IP \u9ed1\u767d\u540d\u5355\u66f4\u65b0\u7b49\uff0c\u8fd9\u4e9b\u90fd\u548c\u70ed\u52a0\u8f7d\u606f\u606f\u76f8\u5173\u3002\\n\\n\u90a3\u4e48 NGINX \u662f\u5982\u4f55\u5b9e\u73b0\u70ed\u52a0\u8f7d\u7684\uff1f\\n\\n## NGINX \u70ed\u52a0\u8f7d\u7684\u539f\u7406\\n\\n\u6267\u884c `nginx -s reload` \u70ed\u52a0\u8f7d\u547d\u4ee4\uff0c\u5c31\u7b49\u540c\u4e8e\u5411 NGINX \u7684 master \u8fdb\u7a0b\u53d1\u9001 HUP \u4fe1\u53f7\u3002\u5728 master \u8fdb\u7a0b\u6536\u5230 HUP \u4fe1\u53f7\u540e\uff0c\u4f1a\u4f9d\u6b21\u6253\u5f00\u65b0\u7684\u76d1\u542c\u7aef\u53e3\uff0c\u7136\u540e\u542f\u52a8\u65b0\u7684 worker \u8fdb\u7a0b\u3002\\n\\n\u6b64\u65f6\u4f1a\u5b58\u5728\u65b0\u65e7\u4e24\u5957 worker \u8fdb\u7a0b\uff0c\u5728\u65b0\u7684 worker \u8fdb\u7a0b\u8d77\u6765\u540e\uff0cmaster \u4f1a\u5411\u8001\u7684 worker \u8fdb\u7a0b\u53d1\u9001 QUIT \u4fe1\u53f7\u8fdb\u884c\u4f18\u96c5\u5173\u95ed\u3002\u8001\u7684 worker \u8fdb\u7a0b\u6536\u5230 QUIT \u4fe1\u53f7\u540e\uff0c\u4f1a\u9996\u5148\u5173\u95ed\u76d1\u542c\u53e5\u67c4\uff0c\u6b64\u65f6\u65b0\u7684\u8fde\u63a5\u5c31\u53ea\u4f1a\u6d41\u8fdb\u5230\u65b0\u7684 worker \u8fdb\u7a0b\u4e2d\uff0c\u8001\u7684 worker \u8fdb\u7a0b\u5904\u7406\u5b8c\u5f53\u524d\u8fde\u63a5\u540e\u5c31\u4f1a\u7ed3\u675f\u8fdb\u7a0b\u3002\\n\\n![worker \u8fdb\u7a0b](https://static.apiseven.com/2022/11/25/638039cf15879.png)\\n\\n\u4ece\u539f\u7406\u4e0a\u770b\uff0cNGINX \u7684\u70ed\u52a0\u8f7d\u80fd\u5f88\u597d\u5730\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u5417\uff1f\u7b54\u6848\u5f88\u53ef\u80fd\u662f\u5426\u5b9a\u7684\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u4e0b NGINX \u7684\u70ed\u52a0\u8f7d\u5b58\u5728\u54ea\u4e9b\u95ee\u9898\u3002\\n\\n## NGINX \u70ed\u52a0\u8f7d\u7684\u7f3a\u9677\\n\\n**\u9996\u5148\uff0cNGINX \u9891\u7e41\u70ed\u52a0\u8f7d\u4f1a\u9020\u6210\u8fde\u63a5\u4e0d\u7a33\u5b9a\uff0c\u589e\u52a0\u4e22\u5931\u4e1a\u52a1\u7684\u53ef\u80fd\u6027\u3002**\\n\\nNGINX \u5728\u6267\u884c reload \u6307\u4ee4\u65f6\uff0c\u4f1a\u5728\u65e7\u7684 worker \u8fdb\u7a0b\u4e0a\u5904\u7406\u5df2\u7ecf\u5b58\u5728\u7684\u8fde\u63a5\uff0c\u5904\u7406\u5b8c\u8fde\u63a5\u4e0a\u7684\u5f53\u524d\u8bf7\u6c42\u540e\uff0c\u4f1a\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5\u3002\u6b64\u65f6\u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u5904\u7406\u597d\uff0c\u5c31\u53ef\u80fd\u4f1a\u4e22\u5931\u4e1a\u52a1\uff0c\u8fd9\u5bf9\u4e8e\u5ba2\u6237\u7aef\u6765\u8bf4\u660e\u663e\u5c31\u4e0d\u662f\u65e0\u611f\u77e5\u7684\u4e86\u3002\\n\\n**\u5176\u6b21\uff0c\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\uff0c\u65e7\u8fdb\u7a0b\u56de\u6536\u65f6\u95f4\u957f\uff0c\u8fdb\u800c\u5f71\u54cd\u6b63\u5e38\u4e1a\u52a1\u3002**\\n\\n\u6bd4\u5982\u4ee3\u7406 WebSocket \u534f\u8bae\u65f6\uff0c\u7531\u4e8e NGINX \u4e0d\u89e3\u6790\u901a\u8baf\u5e27\uff0c\u6240\u4ee5\u65e0\u6cd5\u77e5\u9053\u8be5\u8bf7\u6c42\u662f\u5426\u4e3a\u5df2\u5904\u7406\u5b8c\u6bd5\u72b6\u6001\u3002\u5373\u4f7f worker \u8fdb\u7a0b\u6536\u5230\u6765\u81ea master \u7684\u9000\u51fa\u6307\u4ee4\uff0c\u5b83\u4e5f\u65e0\u6cd5\u7acb\u523b\u9000\u51fa\uff0c\u800c\u662f\u9700\u8981\u7b49\u5230\u8fd9\u4e9b\u8fde\u63a5\u51fa\u73b0\u5f02\u5e38\u3001\u8d85\u65f6\u6216\u8005\u67d0\u4e00\u7aef\u4e3b\u52a8\u65ad\u5f00\u540e\uff0c\u624d\u80fd\u6b63\u5e38\u9000\u51fa\u3002\\n\\n\u518d\u6bd4\u5982 NGINX \u505a TCP \u5c42\u548c UDP \u5c42\u7684\u53cd\u5411\u4ee3\u7406\u65f6\uff0c\u5b83\u4e5f\u6ca1\u6cd5\u77e5\u9053\u4e00\u4e2a\u8bf7\u6c42\u7a76\u7adf\u8981\u7ecf\u8fc7\u591a\u5c11\u6b21\u8bf7\u6c42\u624d\u7b97\u771f\u6b63\u5730\u7ed3\u675f\u3002\\n\\n\u8fd9\u5c31\u5bfc\u81f4\u65e7 worker \u8fdb\u7a0b\u7684\u56de\u6536\u65f6\u95f4\u7279\u522b\u957f\uff0c\u5c24\u5176\u662f\u5728\u76f4\u64ad\u3001\u65b0\u95fb\u5a92\u4f53\u6d3b\u8bed\u97f3\u8bc6\u522b\u7b49\u884c\u4e1a\u3002\u65e7 worker \u8fdb\u7a0b\u7684\u56de\u6536\u65f6\u95f4\u901a\u5e38\u80fd\u8fbe\u5230\u534a\u5c0f\u65f6\u751a\u81f3\u66f4\u957f\uff0c\u8fd9\u65f6\u5982\u679c\u518d\u9891\u7e41 reload\uff0c\u5c06\u4f1a\u5bfc\u81f4 shutting down \u8fdb\u7a0b\u6301\u7eed\u589e\u52a0\uff0c\u6700\u7ec8\u751a\u81f3\u4f1a\u5bfc\u81f4 NGINX OOM\uff0c\u4e25\u91cd\u5f71\u54cd\u4e1a\u52a1\u3002\\n\\n```shell\\n# \u4e00\u76f4\u5b58\u5728\u65e7 worker \u8fdb\u7a0b\uff1a\\nnobody 6246 6241 0 10:51 ? 00:00:00 nginx: worker process\\nnobody 6247 6241 0 10:51 ? 00:00:00 nginx: worker process\\nnobody 6247 6241 0 10:51 ? 00:00:00 nginx: worker process\\nnobody 6248 6241 0 10:51 ? 00:00:00 nginx: worker process\\nnobody 6249 6241 0 10:51 ? 00:00:00 nginx: worker process\\nnobody 7995 10419 0 10:30 ? 00:20:37 nginx: worker process is shutting down  <= here\\nnobody 7995 10419 0 10:30 ? 00:20:37 nginx: worker process is shutting down\\nnobody 7996 10419 0 10:30 ? 00:20:37 nginx: worker process is shutting down\\n```\\n\\n\u4ece\u4e0a\u8ff0\u5185\u5bb9\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7 `nginx -s reload` \u65b9\u5f0f\u652f\u6301\u7684\u201c\u70ed\u52a0\u8f7d\u201d\uff0c\u867d\u7136\u5728\u4ee5\u5f80\u7684\u6280\u672f\u573a\u666f\u4e2d\u591f\u7528\uff0c\u4f46\u662f\u5728\u5fae\u670d\u52a1\u548c\u4e91\u539f\u751f\u8fc5\u901f\u53d1\u5c55\u7684\u4eca\u5929\uff0c\u5b83\u5df2\u7ecf\u6349\u895f\u89c1\u8098\u4e14\u4e0d\u5408\u65f6\u5b9c\u3002\\n\\n\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u53d8\u66f4\u9891\u7387\u662f\u6bcf\u5468\u6216\u8005\u6bcf\u5929\uff0c\u90a3\u4e48 NGINX \u8fd9\u79cd reload \u8fd8\u662f\u6ee1\u8db3\u4f60\u7684\u9700\u6c42\u7684\u3002\u4f46\u5982\u679c\u53d8\u66f4\u9891\u7387\u662f\u6bcf\u5c0f\u65f6\u3001\u6bcf\u5206\u949f\u5462\uff1f\u5047\u8bbe\u4f60\u6709 100 \u4e2a NGINX \u670d\u52a1\uff0c\u6bcf\u5c0f\u65f6 reload \u4e00\u6b21\u7684\u8bdd\uff0c\u5c31\u8981 reload 2400 \u6b21\uff1b\u5982\u679c\u6bcf\u5206\u949f reload \u4e00\u6b21\uff0c\u5c31\u662f 864 \u4e07\u6b21\u3002\u8fd9\u663e\u7136\u662f\u65e0\u6cd5\u63a5\u53d7\u7684\u3002\\n\\n\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u4e0d\u9700\u8981\u8fdb\u7a0b\u66ff\u6362\u7684 reload \u65b9\u6848\uff0c\u5728\u73b0\u6709 NGINX \u8fdb\u7a0b\u5185\u53ef\u4ee5\u76f4\u63a5\u5b8c\u6210\u5185\u5bb9\u7684\u66f4\u65b0\u548c\u5b9e\u65f6\u751f\u6548\u3002\\n\\n## \u5728\u5185\u5b58\u4e2d\u76f4\u63a5\u751f\u6548\u7684\u70ed\u52a0\u8f7d\u65b9\u6848\\n\\n\u5728 Apache APISIX \u8bde\u751f\u4e4b\u521d\uff0c\u5c31\u662f\u5e0c\u671b\u6765\u89e3\u51b3 NGINX \u70ed\u52a0\u8f7d\u8fd9\u4e2a\u95ee\u9898\u7684\u3002\\n\\nApache APISIX \u662f\u57fa\u4e8e NGINX + Lua \u7684\u6280\u672f\u6808\uff0c\u4ee5  etcd \u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3\u5b9e\u73b0\u7684\u4e91\u539f\u751f\u3001\u9ad8\u6027\u80fd\u3001\u5168\u52a8\u6001\u7684\u5fae\u670d\u52a1 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u7cbe\u7ec6\u5316\u8def\u7531\u3001\u9650\u6d41\u9650\u901f\u3001\u670d\u52a1\u964d\u7ea7\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u6570\u767e\u9879\u529f\u80fd\u3002\\n\\n\u4f7f\u7528 APISIX \u4f60\u4e0d\u9700\u8981\u91cd\u542f\u670d\u52a1\u5c31\u53ef\u4ee5\u66f4\u65b0\u914d\u7f6e\uff0c\u8fd9\u610f\u5473\u7740\u4fee\u6539\u4e0a\u6e38\u3001\u8def\u7531\u3001\u63d2\u4ef6\u65f6\u90fd\u4e0d\u7528\u91cd\u542f\u3002\u65e2\u7136\u662f\u57fa\u4e8e NGINX\uff0cAPISIX \u53c8\u662f\u5982\u4f55\u6446\u8131 NGINX \u7684\u9650\u5236\u5b9e\u73b0\u5b8c\u7f8e\u70ed\u66f4\u65b0\uff1f\u6211\u4eec\u5148\u770b\u4e0b APISIX \u7684\u67b6\u6784\u3002\\n\\n![APISIX \u67b6\u6784\u56fe](https://static.apiseven.com/2022/10/09/6341c29869628.png)\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u67b6\u6784\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u4e4b\u6240\u4ee5 APISIX \u80fd\u6446\u8131 NGINX \u7684\u9650\u5236\u662f\u56e0\u4e3a\u5b83\u628a\u4e0a\u6e38\u7b49\u914d\u7f6e\u5168\u90e8\u653e\u5230 APISIX Core \u548c Plugin Runtime \u4e2d\u52a8\u6001\u6307\u5b9a\u3002\\n\\n\u4ee5\u8def\u7531\u4e3a\u4f8b\uff0cNGINX \u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u5185\u8fdb\u884c\u914d\u7f6e\uff0c\u6bcf\u6b21\u66f4\u6539\u90fd\u9700\u8981 reload \u4e4b\u540e\u624d\u80fd\u751f\u6548\u3002\u800c\u4e3a\u4e86\u5b9e\u73b0\u8def\u7531\u52a8\u6001\u914d\u7f6e\uff0cApache APISIX \u5728 NGINX \u914d\u7f6e\u6587\u4ef6\u5185\u914d\u7f6e\u4e86\u5355\u4e2a server\uff0c\u8fd9\u4e2a server \u4e2d\u53ea\u6709\u4e00\u4e2a location\u3002\u6211\u4eec\u628a\u8fd9\u4e2a location \u4f5c\u4e3a\u4e3b\u5165\u53e3\uff0c\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u4f1a\u7ecf\u8fc7\u8fd9\u4e2a location\uff0c\u518d\u7531 APISIX Core \u52a8\u6001\u6307\u5b9a\u5177\u4f53\u4e0a\u6e38\u3002\u56e0\u6b64 Apache APISIX \u7684\u8def\u7531\u6a21\u5757\u652f\u6301\u5728\u8fd0\u884c\u65f6\u589e\u51cf\u3001\u4fee\u6539\u548c\u5220\u9664\u8def\u7531\uff0c\u5b9e\u73b0\u4e86\u52a8\u6001\u52a0\u8f7d\u3002\u6240\u6709\u7684\u8fd9\u4e9b\u53d8\u5316\uff0c\u5bf9\u5ba2\u6237\u7aef\u90fd\u96f6\u611f\u77e5\uff0c\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\u3002\\n\u518d\u6765\u51e0\u4e2a\u5178\u578b\u573a\u666f\u7684\u63cf\u8ff0\u3002\\n\\n\u6bd4\u5982\u589e\u52a0\u67d0\u4e2a\u65b0\u57df\u540d\u7684\u53cd\u5411\u4ee3\u7406\uff0c\u5728 APISIX \u4e2d\u53ea\u9700\u521b\u5efa\u4e0a\u6e38\uff0c\u5e76\u6dfb\u52a0\u65b0\u7684\u8def\u7531\u5373\u53ef\uff0c\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u4e0d\u9700\u8981 NGINX \u8fdb\u7a0b\u6709\u4efb\u4f55\u91cd\u542f\u3002\u518d\u6bd4\u5982\u63d2\u4ef6\u7cfb\u7edf\uff0cAPISIX \u53ef\u4ee5\u901a\u8fc7 `ip-restriction` \u63d2\u4ef6\u5b9e\u73b0 IP \u9ed1\u767d\u540d\u5355\u529f\u80fd\uff0c\u8fd9\u4e9b\u80fd\u529b\u7684\u66f4\u65b0\u4e5f\u662f\u52a8\u6001\u65b9\u5f0f\uff0c\u540c\u6837\u4e0d\u9700\u8981\u91cd\u542f\u670d\u52a1\u3002\u501f\u52a9\u67b6\u6784\u5185\u7684 etcd\uff0c\u914d\u7f6e\u7b56\u7565\u4ee5\u589e\u91cf\u65b9\u5f0f\u5b9e\u65f6\u63a8\u9001\uff0c\u6700\u7ec8\u8ba9\u6240\u6709\u89c4\u5219\u5b9e\u65f6\u3001\u52a8\u6001\u7684\u751f\u6548\uff0c\u4e3a\u7528\u6237\u5e26\u6765\u6781\u81f4\u4f53\u9a8c\u3002\\n\\n## \u603b\u7ed3\\n\\nNGINX \u7684\u70ed\u52a0\u8f7d\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u4f1a\u957f\u65f6\u95f4\u5b58\u5728\u65b0\u65e7\u4e24\u5957\u8fdb\u7a0b\uff0c\u5bfc\u81f4\u989d\u5916\u6d88\u8017\u8d44\u6e90\uff0c\u540c\u65f6\u9891\u7e41\u70ed\u52a0\u8f7d\u4e5f\u4f1a\u5bfc\u81f4\u5c0f\u6982\u7387\u4e1a\u52a1\u4e22\u5931\u3002 \u9762\u5bf9\u5f53\u4e0b\u4e91\u539f\u751f\u548c\u5fae\u670d\u52a1\u7684\u6280\u672f\u8d8b\u52bf\u4e0b\uff0c \u670d\u52a1\u53d8\u5316\u66f4\u52a0\u7684\u9891\u7e41\uff0c\u63a7\u5236 API \u7684\u7b56\u7565\u4e5f\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u5bfc\u81f4\u6211\u4eec\u5bf9\u70ed\u52a0\u8f7d\u7684\u9700\u6c42\u63d0\u51fa\u4e86\u65b0\u9700\u6c42\uff0cNGINX \u7684\u70ed\u52a0\u8f7d\u5df2\u7ecf\u4e0d\u80fd\u6ee1\u8db3\u5b9e\u9645\u4e1a\u52a1\u9700\u6c42\u3002\\n\\n\u73b0\u5728\u662f\u65f6\u5019\u5207\u6362\u5230\u66f4\u8d34\u5408\u4e91\u539f\u751f\u65f6\u4ee3\u5e76\u4e14\u66f4\u5b8c\u5584\u7684\u70ed\u52a0\u8f7d\u7b56\u7565\u3001\u6027\u80fd\u8868\u73b0\u5353\u8d8a\u7684 API \u7f51\u5173 \u2014\u2014 Apache APISIX\uff0c\u4ece\u800c\u4eab\u53d7\u52a8\u6001\u3001\u7edf\u4e00\u7ba1\u7406\u7b49\u7279\u6027\u5e26\u6765\u7684\u7ba1\u7406\u6548\u7387\u4e0a\u7684\u6781\u5927\u63d0\u5347\u3002"},{"id":"\u5b9e\u8df5\u4e00\u5e74\u4e4b\u4e45\uff0cvivo \u5982\u4f55\u57fa\u4e8e APISIX \u8fdb\u884c\u4e1a\u52a1\u57fa\u7840\u67b6\u6784\u7684\u6f14\u8fdb","metadata":{"permalink":"/zh/blog/2022/11/13/vivo-with-apache-apisix","source":"@site/blog/2022/11/13/vivo-with-apache-apisix.md","title":"\u5b9e\u8df5\u4e00\u5e74\u4e4b\u4e45\uff0cvivo \u5982\u4f55\u57fa\u4e8e APISIX \u8fdb\u884c\u4e1a\u52a1\u57fa\u7840\u67b6\u6784\u7684\u6f14\u8fdb","description":"\u672c\u6587\u4ece\u5e94\u7528 APISIX \u540e\u7684\u8c03\u6574\u4e0e\u5b9e\u8df5\u56f0\u96be\u89d2\u5ea6\u5165\u624b\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 vivo \u57fa\u4e8e APISIX \u7684\u4f01\u4e1a\u5b9e\u8df5\u7ec6\u8282\u3002","date":"2022-11-13T00:00:00.000Z","formattedDate":"2022\u5e7411\u670813\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":20.97,"truncated":true,"authors":[{"name":"\u8d75\u65ed","title":"Speaker"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u4e3a\u4ec0\u4e48 NGINX \u7684 reload \u4e0d\u662f\u70ed\u52a0\u8f7d\uff1f","permalink":"/zh/blog/2022/11/23/why-is-not-reload-hot-loaded-in-nginx"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (10.16 - 11.4)","permalink":"/zh/blog/2022/11/10/weekly-report-1110"}},"content":"> \u672c\u6587\u4ece\u5e94\u7528 APISIX \u540e\u7684\u8c03\u6574\u4e0e\u5b9e\u8df5\u56f0\u96be\u89d2\u5ea6\u5165\u624b\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 vivo \u57fa\u4e8e APISIX \u7684\u4f01\u4e1a\u5b9e\u8df5\u7ec6\u8282\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u5206\u4eab\u5609\u5bbe\u8d75\u65ed\uff0cvivo \u4e92\u8054\u7f51\u67b6\u6784\u5e08\uff0c\u4e3b\u8981\u4e13\u6ce8\u4e8e\u57fa\u7840\u67b6\u6784\u7814\u53d1\u65b9\u5411\u3002\\n\\nApache APISIX \u5728\u8fd9\u4e24\u5e74\u5df2\u7ecf\u53d7\u5230\u4e86\u56fd\u5185\u5f88\u591a\u77e5\u540d\u4f01\u4e1a\u7684\u4fe1\u8d56\uff0c\u5e76\u7eb7\u7eb7\u5f00\u59cb\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\u5e94\u7528 APISIX\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u4e5f\u5305\u63fd\u4e86\u5f88\u591a\u4e0d\u540c\u884c\u4e1a\u7684\u4f01\u4e1a\u7528\u6237\uff0c\u6bd4\u5982\u91d1\u878d\u884c\u4e1a\u7684\u4f17\u5b89\u4fdd\u9669\u548c\u5b89\u4fe1\u8bc1\u5238\uff0c\u56fd\u4ea7\u5934\u90e8\u8f66\u4f01\u7684\u5409\u5229\u548c\u5c0f\u9e4f\u6c7d\u8f66\u3002\u5176\u5b9e\u5728\u56fd\u4ea7\u624b\u673a\u9886\u57df\u4e2d\uff0c\u4e5f\u6709\u4e00\u4e9b\u5934\u90e8\u4f01\u4e1a\u7528\u6237\u5728\u4f7f\u7528\uff0c\u6bd4\u5982 vivo\u3002\\n\\nvivo \u662f\u4ece\u53bb\u5e74\u5e74\u4e2d\u5f00\u59cb\u5728\u4e1a\u52a1\u751f\u4ea7\u4e2d\u6b63\u5f0f\u4f7f\u7528 APISIX \u6765\u66ff\u6362\u4e4b\u524d\u4f20\u7edf\u7684 NGINX\u3002\u76ee\u524d APISIX \u5728 vivo \u4e1a\u52a1\u67b6\u6784\u7684\u5b9e\u8df5\u548c\u573a\u666f\u652f\u6301\u4e0a\u90fd\u8868\u73b0\u5f97\u5341\u5206\u51fa\u8272\uff1a\\n\\n* **\u9ad8\u53ef\u7528\u6027**\uff1a\u4e0a\u7ebf\u81f3\u4eca\u6ca1\u6709\u51fa\u73b0\u91cd\u5927\u6545\u969c\uff0c\u7cfb\u7edf\u53ef\u7528\u6027\u8d85\u8fc7 99.99%\uff1b\\n\\n* **\u9ad8\u6027\u80fd**\uff1a\u627f\u8f7d\u8f83\u5927\u7ebf\u4e0a\u6d41\u91cf\uff0c\u670d\u52a1\u4e8e\u8f83\u591a\u4e1a\u52a1\u3002\u7ebf\u4e0a\u76ee\u524d\u8f6c\u53d1\u6d41\u91cf\u63a5\u8fd1\u767e\u4e07\u7ea7 QPS\uff0c\u76ee\u524d\u4ecd\u5904\u4e8e\u6301\u7eed\u589e\u957f\u7684\u8fc7\u7a0b\u4e2d\uff1b\\n\\n* **\u529f\u80fd\u4e30\u5bcc**\uff1a\u57fa\u672c\u8986\u76d6\u4e86\u5e38\u89c1\u7684 NGINX \u4ee3\u7406\u573a\u666f\uff0c50% \u7684\u4e1a\u52a1\u5df2\u7ecf\u8fc1\u79fb\u5230 APISIX \u96c6\u7fa4\uff1b\\n\\n* **\u652f\u6491\u4e86\u4e91\u539f\u751f\u7684\u5efa\u8bbe\u548c\u53d1\u5c55**\uff1a\u6709\u6548\u652f\u6491\u548c\u63a8\u52a8\u4e86\u516c\u53f8\u5bb9\u5668\u5316\u8fdb\u5c55\uff0c\u652f\u6491\u5bb9\u5668\u5e73\u53f0\u7684\u7269\u7406\u673a\u5668\u5df2\u6709\u4e07\u7ea7\u89c4\u6a21\uff0c40% \u7684\u4e1a\u52a1\u5df2\u7ecf\u4ece\u7269\u7406\u673a\u865a\u62df\u673a\u8fc1\u79fb\u5230\u5bb9\u5668\u5e73\u53f0\u3002\\n\\n## \u57fa\u4e8e APISIX \u67b6\u6784\u8bbe\u8ba1\u4e0e\u5b9a\u5236\u8c03\u6574\\n\\n![\u57fa\u4e8e APISIX \u7684\u5185\u90e8\u67b6\u6784\u8c03\u6574](https://static.apiseven.com/2022/11/14/6371aaec16a68.png)\\n\\n\u4ece\u4e0a\u56fe\u67b6\u6784\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u7f51\u5173\u5c42\u9762\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86\u201c\u56db\u5c42+\u4e03\u5c42\u201d\u7684\u4ee3\u7406\u6a21\u5f0f\u3002\u5176\u4e2d\u56db\u5c42\u7f51\u5173\u6211\u4eec\u662f\u7528 LVS+DPDK \u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7684\uff0c\u6d41\u91cf\u4ece\u5916\u7f51\u8fdb\u5165\u56db\u5c42\u7f51\u5173\u540e\u4f1a\u8f6c\u6362\u5230\u4e03\u5c42\u7f51\u5173\u3002\u800c\u4e03\u5c42\u7f51\u5173\u5c31\u662f APISIX \u96c6\u7fa4\uff0c\u76ee\u524d\u8fd9\u5957 APISIX \u96c6\u7fa4\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5bb9\u5668\u3001\u7269\u7406\u673a\u3001\u865a\u62df\u673a\u7b49\u5bb9\u5668\u6df7\u5408\u6d41\u91cf\u90e8\u7f72\u7684\u63a5\u5165\u529f\u80fd\u3002\\n\\n\u56fe\u4e2d\u7ea2\u8272\u90e8\u5206\uff0c\u5219\u662f\u6211\u4eec\u6b63\u5728\u4f7f\u7528\u7684\u4e00\u4e9b\u81ea\u7814\u548c\u5f00\u6e90\u9879\u76ee\uff0c\u5e76\u501f\u52a9\u8fd9\u4e9b\u9879\u76ee\u5b9e\u73b0\u6574\u4e2a\u6d41\u91cf\u8f6c\u53d1\u4f53\u7cfb\u3002\u53e6\u5916\u5728\u67b6\u6784\u4e2d\uff0c\u6211\u4eec\u8fd8\u5b9e\u73b0\u4e86 APISIX \u96c6\u7fa4\u62c6\u5206\u7684\u7ba1\u7406\u529f\u80fd\u3002\\n\\n\u8fd9\u5957\u67b6\u6784\u57fa\u4e8e APISIX \u5f00\u6e90\u7248\u672c\u6211\u4eec\u4e5f\u8fdb\u884c\u4e86\u4e00\u4e9b\u8c03\u6574\uff0c\u4e3b\u8981\u662f\u5728\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\u8fdb\u884c\u4e86\u66f4\u8d34\u5408\u5185\u90e8\u4e1a\u52a1\u7684\u6539\u9020\u3002\\n\\n### \u914d\u7f6e\u7ba1\u7406\u4e0e\u53d1\u5e03\u6539\u9020\\n\\n![\u914d\u7f6e\u7ba1\u7406\u4e0e\u53d1\u5e03\u6d41\u7a0b](https://static.apiseven.com/2022/11/14/6371aaebb4201.png)\\n\\n\u5f53\u4e1a\u52a1\u4ece APISIX \u53d8\u66f4\u5e73\u53f0\u914d\u7f6e\u597d\u76f8\u5173\u6570\u636e\u540e\uff0c\u53d8\u66f4\u5e73\u53f0\u4f1a\u901a\u8fc7 RPC notify \u7684\u65b9\u5f0f\u53d1\u9001\u7ed9 Manager API\u3002\u4e4b\u540e Manager API \u4f1a\u901a\u8fc7 RPC notify \u65b9\u5f0f\u53d1\u9001\u7ed9\u90e8\u7f72\u5728 APISIX \u96c6\u7fa4\u4e2d\u7684 apisix-agent\u3002\u7136\u540e APISIX \u4f1a\u901a\u8fc7 privilege \u7279\u6743\u8fdb\u7a0b\uff0c\u5b9a\u65f6\u8f6e\u8be2 apisix-agent \u53bb\u6279\u91cf\u83b7\u53d6\u53d8\u66f4\u4efb\u52a1\u3002\\n\\n\u4e4b\u540e APISIX \u901a\u8fc7\u5171\u4eab\u961f\u5217\u7684\u65b9\u5f0f\uff0c\u7531\u7279\u6743\u8fdb\u7a0b\u901a\u77e5\u7ed9\u5404\u4e2a\u5b9e\u9645\u7684 worker \u6765\u5b9e\u73b0\u5185\u5b58\u4e0a\u7684\u53d8\u66f4\u3002\u53d8\u66f4\u5b8c\u6210\u540e\uff0cworker \u4f1a\u5c06\u76f8\u5173\u7684\u914d\u7f6e\u4fe1\u606f\u8fdb\u884c\u4e00\u4e2a\u843d\u76d8\u5904\u7406\u3002\u5f53\u6574\u4e2a\u4efb\u52a1\u5b8c\u6210\u540e\uff0c APISIX \u4f1a\u628a\u76f8\u5173\u7ed3\u679c\u901a\u77e5\u4f20\u9001\u7ed9 apisix-agent \u5e76\u4f20\u9012\u7ed9 Manager API\u3002\\n\\n\u672c\u8eab\u8fd9\u5957\u6d41\u7a0b\u662f\u4e00\u4e2a\u5f02\u6b65\u67e5\u8be2\uff0c\u5bf9\u4e8e\u914d\u7f6e\u662f\u5426\u5b8c\u5168\u751f\u6548\u6216\u8005\u4efb\u52a1\u662f\u5426\u6210\u529f\uff0c\u90fd\u662f\u901a\u8fc7\u8f6e\u8be2\u63a5\u53e3\u8fdb\u884c\u67e5\u8be2\u3002\u53ef\u4ee5\u770b\u5230\u4e0a\u8ff0\u6d41\u7a0b\u4e2d\uff0c\u6211\u4eec\u5bf9\u5f00\u6e90 APISIX \u8fdb\u884c\u4e86\u5982\u4e0b\u7684\u53d8\u52a8\uff1a\\n\\n**\u53bb\u6389 etcd \u7ec4\u4ef6\uff0c\u81ea\u7814\u5b9e\u73b0\u4e86\u57fa\u4e8e APISIX \u7684 A6 \u914d\u7f6e\u7ba1\u7406\u7cfb\u7edf\u3002**\\n\\n\u4e4b\u6240\u4ee5\u53bb\u6389 etcd \u7ec4\u4ef6\uff0c\u662f\u56e0\u4e3a etcd \u672c\u8eab\u8fd8\u662f\u4e00\u4e2a\u504f\u5185\u5b58\u7684\u6570\u636e\u5e93\uff0c\u4e0d\u9002\u7528\u4e8e\u591a\u7ef4\u5ea6\u8d44\u6e90\u7684\u67e5\u8be2\uff1b\u540c\u65f6\u5bf9\u4e8e\u6211\u4eec\u672c\u8eab\u4e1a\u52a1\u800c\u8a00\uff0cetcd \u7684\u4fee\u6539\u4e8b\u4ef6\u6a21\u5f0f\uff08\u4e3b\u8981\u662f\u5220\u9664\uff09\u5177\u6709\u4e0d\u53ef\u91cd\u5165\u6027\uff0c\u4e00\u65e6\u5220\u9664\u76f8\u5173\u8d44\u6e90\uff0c\u5c31\u65e0\u6cd5\u518d\u8fdb\u884c\u91cd\u590d\u6027\u64cd\u4f5c\uff1b\u6700\u540e\u5c31\u662f\u8003\u8651\u5230\u5355\u72ec\u589e\u52a0\u4e00\u4e2a\u7cfb\u7edf\u7ec4\u4ef6\uff08\u4e14\u5904\u4e8e\u6838\u5fc3\u5730\u4f4d\uff09\uff0c\u5728\u5927\u91cf watch client \u4e0b\u7684\u7cfb\u7edf\u7ef4\u62a4\u590d\u6742\u5ea6\u4f1a\u5927\u91cf\u589e\u52a0\uff0c\u56e0\u6b64\u5728\u6211\u4eec\u7684\u6539\u9020\u67b6\u6784\u4e2d\u5220\u9664\u4e86 etcd\u3002\\n\\n**\u81ea\u7814 apisix-agent \u7ec4\u4ef6\u3002**\\n\\n\u5728\u5f15\u5165 APISIX \u4e4b\u524d\uff0c\u6211\u4eec\u56e2\u961f\u5bf9\u4e8e OpenResty \u548c Lua \u7684\u4f7f\u7528\u7ecf\u9a8c\u57fa\u672c\u4e3a 0\u3002\u6240\u4ee5\u8003\u8651\u5230\u5df2\u7ecf\u53bb\u6389 etcd \u7684\u524d\u63d0\u4e0b\uff0c\u6211\u4eec\u56e2\u961f\u786e\u5b9e\u4e0d\u5177\u5907\u80fd\u591f\u6539\u9020 APISIX \u6838\u5fc3\u5e95\u5c42\u6280\u672f\u7684\u80fd\u529b\uff0c\u6240\u4ee5\u901a\u8fc7\u81ea\u7814 apisix-agent \u7ec4\u4ef6\uff0c\u6765\u7b80\u5316\u73b0\u6709 APISIX \u7684\u4e00\u4e9b\u80fd\u529b\uff0c\u964d\u4f4e\u6211\u4eec\u5185\u90e8\u4f7f\u7528\u4e0a\u7684\u4e00\u4e9b\u590d\u6742\u5ea6\uff0c\u4ece\u800c\u8fbe\u5230\u590d\u6742\u6027\u548c\u7a33\u5b9a\u6027\u4e4b\u95f4\u7684\u6743\u8861\u3002\\n\\n**\u5b9e\u73b0 APISIX \u8d44\u6e90\u914d\u7f6e\u6587\u4ef6\u672c\u5730\u843d\u76d8\u3002**\\n\\n\u8fd9\u4e00\u70b9\u4e3b\u8981\u662f\u6211\u4eec\u5728\u8bbe\u8ba1\u65f6\uff0c\u5e0c\u671b\u6570\u636e\u9762\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\u800c\u4e0d\u662f\u53bb\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u63a7\u5236\u4e2d\u5fc3\uff0c\u51cf\u5c11\u8fde\u5e26\u5f71\u54cd\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u5f53 APISIX \u542f\u52a8\u65f6\u5c31\u53ef\u4ee5\u4ece\u914d\u7f6e\u4e2d\u5fc3\u5168\u91cf\u62c9\u53d6\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4ece\u672c\u5730\u843d\u76d8\u7684\u6587\u4ef6\u76ee\u5f55\u8fdb\u884c\u62c9\u53d6\u3002\u5728\u8fd9\u79cd\u65b9\u6848\u4e0b\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u6570\u636e\u9762\u7684\u72ec\u7acb\u6027\u4e0e\u7cfb\u7edf\u7684\u5065\u58ee\u6027\uff0c\u540c\u65f6\u5bf9\u4e8e\u95ee\u9898\u7684\u6392\u67e5\u4e5f\u5e26\u6765\u4e86\u66f4\u6e05\u6670\u7684\u8def\u5f84\u5c55\u793a\u3002\\n\\n**\u589e\u52a0\u201c\u53d8\u66f4\u4efb\u52a1\u3001\u7ed3\u679c\u56de\u8c03\u201d\u7684\u4e0a\u62a5\u673a\u5236\u3002**\\n\\n\u6574\u4e2a\u6d41\u7a0b\u7684\u540e\u534a\u6bb5\uff0c\u5176\u5b9e\u90fd\u662f\u5728\u6267\u884c\u8fd9\u79cd\u4e0a\u62a5\u673a\u5236\u3002\u4e4b\u6240\u4ee5\u5236\u4f5c\u8fd9\u79cd\u903b\u8f91\uff0c\u662f\u4e3a\u4e86\u4fdd\u969c\u50cf\u8def\u7531\u548c\u4e0a\u6e38\u7b49\u6838\u5fc3\u8d44\u6e90\u7684\u65f6\u6548\u6027\u3002\u4e00\u65e6\u51fa\u73b0\u90a3\u79cd\u4f60\u4ee5\u4e3a\u8d44\u6e90\u4e0b\u53d1\u6210\u529f\u4f46\u5b9e\u9645\u6ca1\u6210\u529f\u7684\u73b0\u72b6\uff0c\u5c31\u5fc5\u7136\u4f1a\u5bfc\u81f4\u4e00\u6bb5\u65f6\u95f4\u7684\u6d41\u91cf\u5f71\u54cd\u3002\u8fd9\u5957\u903b\u8f91\u5c31\u53ef\u4ee5\u4fdd\u8bc1 APISIX \u4e0a\u6240\u6709\u7684 worker \u90fd\u628a\u9700\u8981\u7684\u8d44\u6e90\u53d8\u52a8\u66f4\u65b0\u5230\u4e86\u5bf9\u5e94\u5185\u5b58\u4e2d\u3002\\n\\n### \u96c6\u7fa4\u62c6\u5206\u7ba1\u7406\u6539\u9020\\n\\n![\u96c6\u7fa4\u62c6\u5206\u7ba1\u7406\u6d41\u7a0b](https://static.apiseven.com/2022/11/14/6371aaebf0ccc.png)\\n\\nAPISIX \u5f00\u6e90\u7248\u672c\u4e2d\u662f\u4e0d\u652f\u6301\u96c6\u7fa4\u7ba1\u7406\u529f\u80fd\u7684\uff0c\u57fa\u672c\u4e0a\u6240\u6709\u4e1a\u52a1\u90fd\u5171\u7528\u4e00\u4e2a etcd\u3002\u4f46\u662f\u5bf9\u4e8e\u6211\u4eec\u8fd9\u79cd\u4e2d\u5927\u578b\u4f01\u4e1a\u6765\u8bf4\uff0c\u4e1a\u52a1\u573a\u666f\u4e0e\u4e1a\u52a1\u903b\u8f91\u90fd\u5341\u5206\u590d\u6742\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5982\u679c\u4f7f\u7528\u8fd9\u79cd\u5927\u4e00\u7edf\u7684\u96c6\u7fa4\u65b9\u5f0f\uff0c\u5728\u4e1a\u52a1\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u5f88\u5bb9\u6613\u51fa\u73b0\u4e0d\u53ef\u63a7\u7684\u573a\u666f\u3002\u5176\u6b21\uff0c\u968f\u7740\u4e1a\u52a1\u590d\u6742\u5ea6\u7684\u63d0\u5347\uff0c\u6709\u4e9b\u4e1a\u52a1\u5c31\u4e0d\u53ef\u907f\u514d\u5730\u4f1a\u7528\u5230\u66f4\u590d\u6742\u7684\u63d2\u4ef6\uff0c\u4e00\u65e6\u6570\u91cf\u53d8\u591a\uff0c\u5bf9\u4e8e\u6574\u4e2a\u96c6\u7fa4\u7684\u6027\u80fd\u4e5f\u4f1a\u9020\u6210\u4e00\u5b9a\u5f71\u54cd\u3002\\n\\n\u57fa\u4e8e\u4ee5\u4e0a\u8003\u8651\uff0c\u6211\u4eec\u51b3\u5b9a\u5c06 APISIX \u8fdb\u884c\u96c6\u7fa4\u62c6\u5206\u5316\u7684\u7ba1\u7406\uff0c\u4ece\u800c\u5b9e\u73b0\u4e1a\u52a1\u548c\u670d\u52a1\u96c6\u7fa4\u7684\u7cbe\u7ec6\u5316\u7ba1\u7406\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u7684\u57df\u540d\u6216\u4e1a\u52a1\u901a\u8fc7\u6620\u5c04\u7ba1\u7406\u7b49\u5404\u79cd\u65b9\u5f0f\uff0c\u5206\u914d\u7ed9\u4e0d\u540c\u7684 APISIX \u96c6\u7fa4\uff0c\u4ece\u800c\u5b9e\u73b0 APISIX \u96c6\u7fa4\u4e0a\u7684\u914d\u7f6e\u9694\u79bb\u3002\u540c\u65f6\u8fd8\u80fd\u63a7\u5236\u6545\u969c\u57df\uff0c\u5bf9\u4e8e\u4e1a\u52a1\u590d\u6742\u5ea6\u4e5f\u80fd\u8d77\u5230\u4e00\u4e2a\u6709\u6548\u7684\u652f\u6491\u3002\\n\\n\u5982\u679c\u4e1a\u52a1\u8fc7\u4e8e\u590d\u6742\uff0c\u5c31\u53ef\u4ee5\u7ed9\u5b83\u5355\u72ec\u5206\u914d\u96c6\u7fa4\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u4e1a\u52a1\u3002\u6709\u6548\u964d\u4f4e\u4e86 APISIX \u975e\u8f6c\u53d1\u5c42\u9762\u6240\u9020\u6210\u96c6\u7fa4\u8d1f\u8f7d\uff0c\u5305\u62ec\u914d\u7f6e\u4e0b\u53d1\u3001\u9ad8\u9891\u5bb9\u5668\u8282\u70b9\u53d8\u66f4\u4ee5\u53ca\u5065\u5eb7\u68c0\u67e5\u6240\u5e26\u6765\u7684\u8d1f\u8f7d\u5f71\u54cd\u3002\\n\\n### \u65b0\u589e Intel QAT HTTPS \u52a0\u901f\u5361\\n\\n\u6839\u636e\u56fd\u5bb6\u5de5\u4fe1\u90e8\u7684\u76f8\u5173\u8981\u6c42\uff0c\u5916\u7f51\u6d41\u91cf\u5fc5\u987b\u8981\u8d70 HTTPS \u534f\u8bae\u3002\u4f5c\u4e3a\u4e00\u4e2a\u57fa\u4e8e TLS \u7684 HTTP \u52a0\u5bc6\u534f\u8bae\uff0cHTTPS \u7684\u52a0\u89e3\u5bc6\u8fc7\u7a0b\u5bf9\u4e8e CPU \u7684\u8d1f\u62c5\u662f\u6bd4\u8f83\u5927\u7684\u3002\\n\\n\u6211\u4eec\u5185\u90e8\u8fdb\u884c\u8fc7\u4e00\u4e2a\u7edf\u8ba1\uff0c\u5982\u679c\u7eaf\u8f6c\u53d1 HTTP \u548c HTTPS \u4e24\u79cd\uff0c\u540c\u6837\u7684\u8def\u7531\u548c\u5176\u4ed6\u76f8\u5173\u914d\u7f6e\u9f50\u5e73\u7684\u60c5\u51b5\u4e0b\uff0cHTTPS \u53ea\u80fd\u627f\u8f7d\u5927\u6982 HTTP \u7684 1/8 \u5230 1/10 \u5de6\u53f3\u3002\u56e0\u6b64 HTTPS \u7684\u52a0\u89e3\u5bc6\u5bf9\u4e8e\u6027\u80fd\u5f71\u54cd\u8fd8\u662f\u975e\u5e38\u5927\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u91cd\u65b0\u7f16\u8bd1\u4e86 OpenResty \u6a21\u5757\u3002\\n\\n\u4e3b\u8981\u64cd\u4f5c\u5c31\u662f\u5728 NGINX \u4ee3\u7801\u4e2d Patch \u4e86 Intel QAT \u6a21\u5757\uff0c\u901a\u8fc7 SSL \u5f02\u6b65\u89e3\u5bc6\u65b9\u5f0f\uff0c\u5c06\u52a0\u89e3\u5bc6\u7684\u8fc7\u7a0b\u4ea4\u7ed9\u4e86 QAT \u5361\u8fdb\u884c\u3002\u4ece\u800c\u91ca\u653e\u4e86 CPU\uff0c\u589e\u5927\u4e86\u5355\u673a HTTPS \u627f\u8f7d\u7684 QPS\u3002\u901a\u8fc7\u5f15\u5165\u8fd9\u5957\u6a21\u5757\uff0c\u5355\u673a HTTPS \u627f\u8f7d\u91cf\u63d0\u5347\u4e86\u4e00\u500d\u5de6\u53f3\u3002\\n\\n## \u843d\u5730 APISIX \u7684\u95ee\u9898\u4e0e\u89e3\u51b3\u65b9\u6848\\n\\n### \u652f\u6301\u5bb9\u5668\u5316\uff0c\u81ea\u7814 Ingress \u7ec4\u4ef6\\n\\n\u4e3a\u4e86\u8ba9\u8fd9\u5957\u67b6\u6784\u7b26\u5408\u516c\u53f8\u7684\u5bb9\u5668\u5316\u53d1\u5c55\uff0c\u6211\u4eec\u8fd8\u81ea\u7814\u4e86\u4e00\u5957\u5185\u90e8\u7684 K8s-ingress \u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u7684\u4f5c\u7528\u5c31\u662f\u5c06 K8s \u8282\u70b9\u7684\u53d8\u66f4\u901a\u77e5\u5230 APISIX \u4e2d\u3002\\n\\n\u5728\u4e4b\u524d\u516c\u53f8\u5185\u90e8\u5df2\u7ecf\u5229\u7528 Calico \u65b9\u6848\u5b9e\u73b0\u4e86\u5bb9\u5668\u4e0e IDC \u673a\u623f\u7684\u7f51\u7edc\u4e92\u901a\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u4f55\u5feb\u901f\u7a33\u5b9a\u5730\u5c06\u53d8\u66f4\u901a\u77e5\u5230 APISIX \u8fdb\u884c\u6d41\u91cf\u8f6c\u53d1\uff0c\u662f\u63a5\u5165 K8s \u7684\u91cd\u8981\u4e00\u73af\u3002\\n\\n\u56e0\u6b64\u6211\u4eec\u5728\u8c03\u7814\u8fc7\u4e00\u4e9b K8s Ingress \u5b9e\u73b0\u65b9\u6848\u4e4b\u540e\uff0c\u57fa\u4e8e\u516c\u53f8\u7684\u4e1a\u52a1\u573a\u666f\u548c\u53d1\u5c55\uff0c\u6700\u7ec8\u9009\u62e9\u4e86\u81ea\u7814\u5f00\u53d1\u3002\u4e3b\u8981\u8003\u8651\u4e86\u4ee5\u4e0b\u51e0\u70b9\uff1a\\n\\n* **\u9002\u914d\u6539\u9020\u7684\u5f02\u6b65\u63a8\u9001\u914d\u7f6e\u53d8\u66f4\u673a\u5236**\u3002\u524d\u6587\u4ecb\u7ecd\u8fc7\u7684\u5f02\u6b65\u8f6e\u8be2\u673a\u5236\u5176\u5b9e\u662f\u6bd4\u8f83\u590d\u6742\u7684\uff0c\u56e0\u6b64\u4e3a\u4e86\u9002\u914d\u8fd9\u5957\u673a\u5236\uff0c\u6211\u4eec\u9009\u62e9\u4e86\u7528\u81ea\u7814\u7ec4\u4ef6\u53bb\u914d\u5408\u3002\\n* **\u9002\u914d\u591a\u5957 K8s \u96c6\u7fa4\u4e8b\u4ef6\u5904\u7406\u901a\u77e5**\u3002\u7531\u4e8e\u516c\u53f8\u4e1a\u52a1\u4e30\u5bcc\uff0c\u6211\u4eec\u4e0d\u53ef\u80fd\u53ea\u90e8\u7f72\u540c\u4e00\u5957 K8s \u96c6\u7fa4\u3002\u56e0\u6b64\u4ece\u7a33\u5b9a\u6027\u4e0e\u53ef\u63a7\u7ba1\u7406\u5c42\u9762\u56e0\u7d20\u8003\u8651\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u4e5f\u8fdb\u884c\u4e86\u591a\u96c6\u7fa4\u573a\u666f\u7684\u9002\u914d\uff0c\u4fdd\u8bc1\u591a\u96c6\u7fa4\u7684\u53d8\u66f4\u80fd\u6b63\u5e38\u901a\u77e5\u5230 APISIX \u4e2d\u3002\\n* **\u9002\u914d\u590d\u6742\u7684\u4e1a\u52a1\u573a\u666f**\u3002\u6bd4\u5982\u6ee1\u8db3\u4e00\u4e2a Server \u76d1\u542c\u591a\u4e2a\u7aef\u53e3\uff08\u6d89\u53ca\u4e0d\u540c\u534f\u8bae\uff09\u7684\u573a\u666f\uff0c\u6216\u8005\u662f\u5c06 Dubbo\u3001gRPC \u7b49\u5176\u4ed6 RPC \u6846\u67b6\u670d\u52a1\u5668\u63a5\u5165 K8s \u7684\u573a\u666f\uff0c\u8fd9\u4e9b\u90fd\u9700\u8981\u5355\u72ec\u5f00\u53d1\u4e00\u5957\u903b\u8f91\u53bb\u5b9e\u73b0\u3002\\n* **\u9002\u914d\u5185\u90e8 DevOps \u7b49\u81ea\u52a8\u5316\u573a\u666f**\u8f83\u7279\u6b8a\u9700\u6c42\uff0c\u65b9\u4fbf\u4e1a\u52a1\u80fd\u5feb\u901f\u90e8\u7f72\u548c\u542f\u7528\u6d41\u91cf\u7b49\u3002\\n\\n### \u81ea\u7814\u5de5\u5177\uff0c\u964d\u4f4e\u8fc1\u79fb\u6210\u672c\\n\\n\u524d\u9762\u6211\u4eec\u4e5f\u63d0\u5230\u4e86\uff0c\u4e4b\u524d\u516c\u53f8\u7684\u4e1a\u52a1\u90fd\u662f\u90e8\u7f72\u5728 NGINX \u96c6\u7fa4\u5f53\u4e2d\uff0c\u8fd0\u884c\u5f97\u4e5f\u6bd4\u8f83\u7a33\u5b9a\u4e86\u3002\u6240\u4ee5\u5f53\u6211\u4eec\u5c06\u57fa\u7840\u67b6\u6784\u66f4\u6362\u5230 APISIX \u65f6\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u539f\u672c\u4f7f\u7528 NGINX \u7684\u4e1a\u52a1\u90e8\u95e8\u6765\u8bf4\u5c31\u4f1a\u5b58\u5728\u4e00\u4e9b\u62b5\u89e6\u5fc3\u7406\u3002\u56e0\u4e3a\u4e00\u65e6\u9700\u8981\u914d\u5408\u57fa\u7840\u67b6\u6784\u53bb\u66f4\u6362\u8fd9\u4e9b\u5e95\u5c42\u7ec4\u4ef6\uff0c\u5c31\u4f1a\u6d89\u53ca\u5230\u4e00\u4e9b\u81ea\u8eab\u4e1a\u52a1\u4e0a\u7684\u5f71\u54cd\u548c\u6536\u76ca\u7b49\uff0c\u6bd4\u5982\u5de5\u4f5c\u91cf\u7684\u589e\u52a0\u6216\u8005\u7cfb\u7edf\u7684\u4e0d\u7a33\u5b9a\u8868\u73b0\u3002\\n\\n\u6240\u4ee5\u5982\u4f55\u5728\u516c\u53f8\u5185\u90e8\u53bb\u63a8\u52a8\u4e1a\u52a1\u90e8\u95e8\u8fdb\u884c\u914d\u5408\u67b6\u6784\u6f14\u8fdb\uff0c\u4e5f\u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u73af\u8282\u3002\u6211\u4eec\u81ea\u5df1\u7684\u7ecf\u9a8c\u603b\u7ed3\u4e86\u5982\u4e0b\u51e0\u70b9\uff1a\\n\\n* \u5148\u627e\u4e00\u4e2a\u5408\u4f5c\u90e8\u95e8\u7684\u4e1a\u52a1\uff0c\u670d\u52a1\u597d\u8be5\u4e1a\u52a1\u90e8\u95e8\uff0c\u5229\u7528\u597d\u7684\u6548\u679c\u53cd\u9988\u6765\u6811\u7acb\u6807\u6746\u3002\u540c\u65f6\u63d0\u4f9b\u6280\u672f\u4e0a\u7684\u4eba\u5458\u6307\u5bfc\u548c\u8f85\u52a9\uff0c\u4e3a\u540e\u7eed\u7684\u8fd0\u7ef4\u670d\u52a1\u6253\u4e0b\u57fa\u7840\u3002\\n* \u5728\u672c\u8eab\u67b6\u6784\u642d\u5efa\u4e2d\uff0c\u6253\u9020\u5bf9\u4e8e\u4e1a\u52a1\u5c42\u9762\u66f4\u6613\u7528\u7684\u63a7\u5236\u9762\u7cfb\u7edf\uff0c\u65b9\u4fbf\u4e1a\u52a1\u63a5\u5165\u3002\u6bd4\u5982\u524d\u6587\u63d0\u5230\u7684\u53bb\u6389 etcd \u8fdb\u884c\u81ea\u7814\u63a7\u5236\u9762\uff0c\u5c31\u662f\u8003\u8651\u5230\u4e86\u8fd9\u4e2a\u56e0\u7d20\u3002\\n* \u63d0\u4f9b\u4ece NGINX \u914d\u7f6e\u4e00\u952e\u5207\u6362\u5230 APISIX \u914d\u7f6e\u7684\u81ea\u52a8\u8f6c\u6362\u80fd\u529b\uff0c\u5c06\u6f14\u8fdb\u6210\u672c\u964d\u4f4e\u3002\u4e3a\u6b64\u6211\u4eec\u4e13\u95e8\u5f00\u53d1\u4e86\u4e00\u5957\u7cfb\u7edf\uff0c\u4e1a\u52a1\u65b9\u53ea\u9700\u8f93\u5165\u57df\u540d\uff0c\u5c31\u53ef\u4ee5\u628a\u76f8\u5173 NGINX \u4e0a\u7684\u670d\u52a1\u548c\u4e0a\u6e38\u7b49\u914d\u7f6e\u4fe1\u606f\u62c9\u53d6\u8fc7\u6765\u3002\u7136\u540e\u7ecf\u8fc7\u7b80\u5355\u7684\u903b\u8f91\u8f6c\u6362\u4e0e\u5173\u8054\u540e\uff0c\u5373\u53ef\u81ea\u52a8\u53d1\u5e03\u3002\\n\\n\u867d\u7136\u505a\u8fd9\u4e48\u4e00\u5957\u81ea\u52a8\u5316\u914d\u7f6e\u7cfb\u7edf\u56f0\u96be\u8f83\u5927\uff0c\u4f46\u6211\u4eec\u8fd8\u662f\u5c1d\u8bd5\u53bb\u505a\u4e86\u5e76\u57fa\u672c\u5b9e\u73b0\u4e86\u516c\u53f8\u5185\u90e8\u4e1a\u52a1\u7684\u4e00\u4e9b\u5b9e\u9645\u9700\u6c42\u3002\u6bd4\u5982\u8fdb\u884c location \u4e0e upstream \u7684\u8f6c\u6362\u4e0e\u7ed1\u5b9a\u3001\u628a NGINX \u5173\u952e\u5b57\u8f6c\u6362\u6210 APISIX \u63d2\u4ef6\u7b49\uff0c\u76ee\u524d\u4ec5\u628a\u5728 NGINX \u4e0a\u4f7f\u7528\u7684\u4e00\u4e9b\u5e38\u89c4\u914d\u7f6e\u8f6c\u6362\u6210\u4e86\u63d2\u4ef6\u4f7f\u7528\u3002\\n\\n\u5f53\u7136\u8fd9\u4e2a\u8f6c\u6362\u6210\u529f\u7387\u5e76\u4e0d\u4e00\u5b9a\u662f\u5b8c\u5168\u5951\u5408\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u8fd9\u5957\u7cfb\u7edf\u4e2d\u4e5f\u589e\u52a0\u4e86\u786e\u8ba4\u73af\u8282\u3002\u5982\u679c\u5728\u8f6c\u5316\u540e\u89c9\u5f97\u5e76\u4e0d\u5b8c\u5168\u9002\u7528 APISIX \u7684\u4e00\u4e9b\u914d\u7f6e\u7ec6\u8282\uff0c\u8fd8\u53ef\u4ee5\u81ea\u884c\u8fdb\u884c\u5c11\u91cf\u4fee\u6539\u3002\u4ece\u800c\u4f9d\u8d56\u8fd9\u5957\u5de5\u5177\uff0c\u53bb\u6700\u5927\u7a0b\u5ea6\u5730\u964d\u4f4e\u5404\u4e1a\u52a1\u90e8\u5206\u7684\u8fc1\u79fb\u5de5\u4f5c\u91cf\u3002\\n\\n### \u81ea\u7814\u96c6\u6210\u6d4b\u8bd5\uff0c\u89e3\u51b3\u7248\u672c\u5347\u7ea7\u95ee\u9898\\n\\nvivo \u662f\u4ece 2021 \u5e74\u5e74\u4e2d\u57fa\u4e8e APISIX 2.4 \u7248\u672c\u8fdb\u884c\u6539\u9020\u5e76\u9646\u7eed\u4e0a\u7ebf\u7684\uff0c\u5728\u4eca\u5e74 Q2 \u9636\u6bb5\u5df2\u5347\u7ea7\u5230 2.13 \u7248\u672c\u3002\u5728\u4ece 2.4 \u5347\u7ea7\u5230 2.13 \u7248\u672c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5728\u4e1a\u52a1\u4e0a\u4e5f\u662f\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\u3002\u4e3b\u8981\u6d89\u53ca\u5230 APISIX Lua \u548c OpenResty \u76f8\u5173\u7684\u90e8\u5206\u3002\\n\\n\u5728 APISIX \u7684 Lua \u90e8\u5206\uff0c\u5f97\u76ca\u4e8e APISIX \u6a21\u5757\u5316\u7684\u7ec4\u7ec7\u65b9\u5f0f\uff0c\u628a\u6211\u4eec\u81ea\u5df1\u4fee\u6539\u7684\u4ee3\u7801\u5408\u5e76\u5230 APISIX \u9ad8\u7248\u672c\u5206\u652f\u4e2d\uff0c\u5e76\u4e0d\u7b97\u9ebb\u70e6\u3002\u518d\u901a\u8fc7\u5b8c\u6574\u7684\u56de\u5f52\u6d4b\u8bd5\u540e\uff0c\u6bd4\u8f83\u8f7b\u677e\u5730\u5b8c\u6210\u4e86\u5347\u7ea7\u3002\\n\\n\u800c\u5728 OpenResty \u90e8\u5206\u5219\u8e29\u5751\u6bd4\u8f83\u591a\u3002APISIX \u5347\u7ea7\u7684\u8fc7\u7a0b\u4e2d\uff0cOpenResty \u4e5f\u5728\u5347\u7ea7\uff0c\u5dee\u4e0d\u591a\u4e00\u5e74\u5347\u7ea7\u4e00\u4e2a\u7248\u672c\u3002\u7531\u4e8e\u6211\u4eec\u516c\u53f8\u4f7f\u7528\u4e86\u8f83\u591a\u7684 Patch \u5305\u548c\u4e00\u4e9b\u975e\u5e38\u7528\u529f\u80fd \uff08\u5982 QAT \u7b49\uff09\uff0cPatch \u8fc7\u591a\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e9b\u4ee3\u7801\u51b2\u7a81\u7b49\u95ee\u9898\uff0c\u5bfc\u81f4\u8be5\u7ec4\u4ef6\u7684\u540e\u7eed\u5347\u7ea7\u6bd4\u8f83\u8d39\u65f6\u8d39\u529b\u3002\\n\\n\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u6211\u4eec\u4e5f\u8fdb\u884c\u4e86\u524d\u6587\u63d0\u5230\u7684\u4e00\u4e9b\u63a7\u5236\u9762\u4e0e\u6570\u636e\u9762\u7684\u6539\u9020\u3002\u540c\u65f6\u4e3a\u4e86\u4fdd\u8bc1\u8fd9\u4e9b\u6539\u9020\u662f\u8fd0\u884c\u5b8c\u7f8e\u7684\uff0c\u5c31\u9700\u8981\u53bb\u8fdb\u884c\u76f8\u5173\u7684\u6d4b\u8bd5\u3002\u4f46\u662f\u5982\u679c\u662f\u5355\u7eaf\u5229\u7528 APISIX \u7684\u6d4b\u8bd5\u573a\u666f\u5219\u53ea\u4f1a\u987e\u53ca\u5230 APISIX \u5355\u4e2a\u6a21\u5757\uff0c\u7531\u4e8e\u6211\u4eec\u5df2\u7ecf\u5bf9\u63a7\u5236\u9762\u8fdb\u884c\u4e86\u6bd4\u8f83\u5927\u7684\u6539\u52a8\uff0c\u6240\u4ee5\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 Python \u7684 robot framework \u63d2\u4ef6\u6765\u6253\u9020\u4e86\u81ea\u7814\u7684\u7cfb\u7edf\u96c6\u6210\u6d4b\u8bd5\u3002\u540c\u65f6\u7531\u4e8e Python \u8bed\u8a00\u7684\u666e\u9002\u6027\uff0c\u5bf9\u4e8e\u5f00\u53d1\u548c\u8fd0\u7ef4\u4eba\u5458\u4e5f\u975e\u5e38\u53cb\u597d\u3002\\n\\n## APISIX \u4f7f\u7528\u5fc3\u5f97\u4e0e\u672a\u6765\u8ba1\u5212\\n\\n\u300aGoogle SRE\u300b\u4e66\u4e2d\u63d0\u5230\u8fc7\uff0c\u201c\u6b63\u5e38\u8fd0\u884c\u662f\u65e0\u6570\u79cd\u5f02\u5e38\u60c5\u51b5\u4e2d\u7684\u4e00\u79cd\u5f02\u5e38\u201d\uff0c\u8f6f\u4ef6\u80fd\u591f\u4fdd\u6301\u6b63\u5e38\u5730\u8fd0\u884c\uff0c\u5176\u5b9e\u662f\u975e\u5e38\u56f0\u96be\u7684\u3002\u5728\u4f7f\u7528\u5f00\u6e90\u4ea7\u54c1 Apache APISIX \u4e00\u5e74\u591a\u7684\u65f6\u95f4\u91cc\uff0c\u6211\u4eec\u4e5f\u6162\u6162\u611f\u609f\u51fa\u4e86\u4e00\u4e9b\u6280\u672f\u4f7f\u7528\u4e0a\u7684\u5fc3\u5f97\u3002\\n\\n\u5728\u4f7f\u7528\u5f00\u6e90\u4ea7\u54c1\u65f6\uff0c\u5fc3\u6001\u4e00\u5b9a\u8981\u5f00\u653e\uff0c\u4e0d\u80fd\u56e0\u4e3a\u51fa\u73b0\u4e00\u70b9\u70b9\u95ee\u9898\u5c31\u5f00\u59cb\u5230\u5904\u62b1\u6028\u3002\u5728\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u8981\u62b1\u7740\u79ef\u6781\u6539\u8fdb\u4e0e\u5408\u4f5c\u7684\u5fc3\u6001\u3002\u867d\u7136\u4efb\u4f55\u8f6f\u4ef6\u90fd\u4e0d\u53ef\u907f\u514d\u51fa\u73b0\u95ee\u9898\uff0c\u4f46\u672c\u8eab\u4f5c\u4e3a\u4e00\u4e2a Apache \u7684\u9876\u7ea7\u9879\u76ee\uff0c\u81f3\u5c11\u5728\u4ee3\u7801\u8d28\u91cf\u548c\u6d41\u7a0b\u6d4b\u8bd5\u4e2d\u90fd\u662f\u975e\u5e38\u6709\u4fdd\u969c\u7684\u3002\\n\\n\u56e0\u6b64\u5728\u4f7f\u7528\u4e2d\u9047\u5230\u95ee\u9898\u65f6\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u662f\u5426\u81ea\u5df1\u6b63\u786e\u5730\u4f7f\u7528\u4e86\u76f8\u5173\u529f\u80fd\uff0c\u5148\u81ea\u5df1\u53bb\u5bfb\u627e\u539f\u56e0\u3002\u5982\u679c\u672c\u8eab\u6ca1\u6709\u5145\u8db3\u7684\u65f6\u95f4\u6210\u672c\u548c\u6280\u672f\u5b9e\u529b\uff0c\u5c31\u53ef\u4ee5\u53bb\u5bfb\u6c42\u793e\u533a\u7684\u5e2e\u52a9\u3002\u5f97\u76ca\u4e8e APISIX \u7684\u793e\u533a\u6d3b\u8dc3\uff0c\u6211\u4eec\u5728\u793e\u533a\u91cc\u63d0\u7684\u5f88\u591a issue \u90fd\u53ca\u65f6\u5f97\u5230\u4e86\u54cd\u5e94\u4e0e\u8ddf\u8fdb\u3002\\n\\n\u540c\u65f6\u5728\u4f7f\u7528 APISIX \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u81ea\u5df1\u5176\u5b9e\u505a\u4e86\u975e\u5e38\u591a\u7684\u6539\u9020\u3002\u56e0\u6b64\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u975e\u5e38\u91cd\u89c6\u6d4b\u8bd5\u73af\u8282\uff0c\u53ea\u6709\u8db3\u591f\u7684\u6d4b\u8bd5\u624d\u80fd\u4fdd\u8bc1\u4ee3\u7801\u7684\u6b63\u5e38\u8fd0\u884c\u3002\\n\\n\u5f53\u7136\u5728\u4f7f\u7528 APISIX \u7684\u8fd9\u4e00\u5e74\u591a\u7684\u65f6\u95f4\u91cc\uff0c\u6211\u4eec\u4e5f\u5728\u79ef\u6781\u63a2\u7d22\u4e0e\u53d1\u73b0\u66f4\u591a APISIX \u7684\u529f\u80fd\u573a\u666f\u3002\u5728\u540e\u7eed\u4f7f\u7528\u8ba1\u5212\u4e2d\uff0c\u6211\u4eec\u5c06\u5f00\u62d3\u4ee5\u4e0b\u65b9\u5411\uff1a\\n\\n1. \u63a8\u52a8 APISIX \u4ece HTTP \u6d41\u91cf\u7f51\u5173\u6269\u5c55\u5230 API \u7f51\u5173\uff0c\u8fd9\u70b9\u662f\u6211\u4eec\u516c\u53f8\u660e\u5e74\u7684\u8ba1\u5212\u4e4b\u4e00\u3002\u6bd4\u5982\u4f7f\u7528 APISIX \u5c06 HTTP \u534f\u8bae\u8f6c\u53d1\u5230\u540e\u7aef\u7684 Dubbo\u3001gRPC \u6216\u8005 MQ \u4e0a\u8fdb\u884c\u534f\u8bae\u8f6c\u6362\uff0c\u6216\u8005\u4f7f\u7528 API \u7f51\u5173\u7684\u4e00\u4e9b\u901a\u7528\u529f\u80fd\uff08\u9650\u6d41\u3001\u7194\u65ad\u3001\u9274\u6743\u7b49\uff09\u3002\\n\\n2. \u52a0\u5f3a NGINX \u4e0e OpenResty \u7684\u81ea\u5efa\u80fd\u529b\u3002\u76ee\u524d\u5f00\u6e90\u7684 NGINX \u793e\u533a\u5df2\u7ecf\u4e0d\u6d3b\u8dc3\u4e86\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u529f\u80fd\u7684\u652f\u6301\u4e0d\u53ca\u65f6\uff0c\u4e0d\u5229\u4e8e\u516c\u53f8\u7edf\u4e00\u63a5\u5165\u5c42\u7684\u672a\u6765\u53d1\u5c55\u8d8b\u52bf\u3002\u540c\u65f6\u6211\u4eec\u4e5f\u4e00\u81f4\u81f4\u529b\u4e8e\u63d0\u9ad8\u516c\u53f8\u5185\u90e8\u5bf9\u4e8e APISIX \u7684\u4ea7\u54c1\u4f7f\u7528\u719f\u6089\u5ea6\uff0c\u5e0c\u671b\u540e\u7eed\u4e5f\u80fd\u548c APISIX \u793e\u533a\u4e00\u8d77\u534f\u540c\u5171\u5efa\u4e00\u4e9b\u529f\u80fd\u3002\\n\\n3. \u62e5\u62b1\u670d\u52a1\u7f51\u683c\u8d8b\u52bf\u3002\u968f\u7740\u4e91\u539f\u751f\u8d8b\u52bf\u7684\u53d1\u5c55\uff0c\u670d\u52a1\u7f51\u683c\u9886\u57df\u4e5f\u5f00\u59cb\u53d8\u5f97\u70ed\u95e8\u8d77\u6765\u3002\u4f46\u662f\u5728\u6211\u4e2a\u4eba\u770b\u6765\uff0c\u670d\u52a1\u7f51\u683c\u8ddd\u79bb\u5927\u90e8\u5206\u516c\u53f8\u8fd8\u6bd4\u8f83\u9065\u8fdc\uff0c\u76ee\u524d\u8fd8\u5f88\u96be\u628a\u8fd9\u5957\u4e1c\u897f\u5e94\u7528\u8d77\u6765\u3002\u4f46\u5982\u679c\u5c06\u6765\u6709\u4e00\u5929\u6211\u4eec\u771f\u7684\u9700\u8981\u542f\u7528\u8fd9\u4e00\u5757\uff0c\u5c31\u9700\u8981\u4ece\u73b0\u5728\u5c31\u6253\u597d\u57fa\u672c\u529f\u3002\u6240\u8c13\u7684\u57fa\u672c\u529f\u5c31\u662f\u6d41\u91cf\u6cbb\u7406\u548c\u670d\u52a1\u6cbb\u7406\u8fd9\u79cd\u57fa\u7840\u80fd\u529b\uff0c\u628a\u4ed6\u4eec\u5efa\u8bbe\u5730\u66f4\u597d\uff0c\u53bb\u8fce\u63a5\u672a\u6765\u6280\u672f\u8d8b\u52bf\u7684\u53d8\u5316\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (10.16 - 11.4)","metadata":{"permalink":"/zh/blog/2022/11/10/weekly-report-1110","source":"@site/blog/2022/11/10/weekly-report-1110.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (10.16 - 11.4)","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e0a\u6e38\u8f6e\u8be2\u89c4\u5219\u7b56\u7565\uff0c\u652f\u6301 etcd \u5730\u5740\u4e3a IPv6\uff0c\u5904\u7406\u4e0a\u6e38 header \u65f6\u81ea\u5b9a\u4e49 X-Forwarded-Pord \u53c2\u6570\u3002APISIX Dashboard \u4fee\u6b63\u8fde\u63a5\u4e2d\u65ad\u65f6\u6570\u636e\u4e0d\u540c\u6b65\u7684\u95ee\u9898\u3002","date":"2022-11-10T00:00:00.000Z","formattedDate":"2022\u5e7411\u670810\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.64,"truncated":true,"authors":[],"prevItem":{"title":"\u5b9e\u8df5\u4e00\u5e74\u4e4b\u4e45\uff0cvivo \u5982\u4f55\u57fa\u4e8e APISIX \u8fdb\u884c\u4e1a\u52a1\u57fa\u7840\u67b6\u6784\u7684\u6f14\u8fdb","permalink":"/zh/blog/2022/11/13/vivo-with-apache-apisix"},"nextItem":{"title":"\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u662f\u4ec0\u4e48","permalink":"/zh/blog/2022/11/10/what-is-service-in-microservice-discovery"}},"content":"> \u4ece 10.16 - 11.4\uff0c\u6709 44 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 98 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2022/11/24/637ed74d4be75.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/2022/11/24/637ed7650c400.jpg)\\n\\n## Good first issue\\n\\n### Issue #8164\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/8164\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4e3a\u63d2\u4ef6\u6dfb\u52a0\u5206\u7c7b\u6807\u7b7e\u3002\\n\\n### Issue #8122\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/8122\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4e3a `jwt-auth` \u63d2\u4ef6\u9690\u85cf\u51ed\u8bc1\uff0c\u53ef\u907f\u514d\u5728\u4e0a\u6e38\u6cc4\u9732 Token\u3002\\n\\n### Issue #1416\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1416\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c5000 \u7aef\u53e3\u53ef\u80fd\u4f1a\u88ab\u5176\u5b83\u8fdb\u7a0b\u5360\u7528\uff0c\u662f\u5426\u53ef\u4ee5\u652f\u6301\u81ea\u5b9a\u4e49\u7aef\u53e3\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [\u6dfb\u52a0\u4e0a\u6e38\u8f6e\u8be2\u7b56\u7565\u9ed8\u8ba4\u7c7b\u578b roundrobin](https://github.com/apache/apisix/pull/8180)\uff08\u8d21\u732e\u8005\uff1a[Hazel6869](https://github.com/Hazel6869)\uff09\\n\\n- [\u652f\u6301\u8bbe\u7f6e etcd \u5730\u5740\u4e3a IPv6 \u683c\u5f0f](https://github.com/apache/apisix/pull/8245)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [\u652f\u6301\u5904\u7406\u4e0a\u6e38 header \u65f6\u81ea\u5b9a\u4e49 `X-Forwarded-Port` \u53c2\u6570](https://github.com/apache/apisix/pull/8266)\uff08\u8d21\u732e\u8005\uff1a[biakecw](https://github.com/biakecw)\uff09\\n\\n- [\u4fee\u6b63 Dashboard etcd \u8fde\u63a5\u4e2d\u65ad\u65f6\u6570\u636e\u4e0d\u540c\u6b65\u95ee\u9898](https://github.com/apache/apisix-dashboard/pull/2650)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u817e\u8baf\u84dd\u9cb8 API \u7f51\u5173\u5982\u4f55\u501f\u52a9 APISIX \u5b9e\u73b0\u4ea7\u54c1\u5347\u7ea7\u4e0e\u4e1a\u52a1\u5b8c\u5584](https://apisix.apache.org/zh/blog/2022/11/05/tencent-blueking-with-apisix/)\\n\\n    \u672c\u6587\u4ece\u84dd\u9cb8\u7f51\u5173\u7684\u8fed\u4ee3\u8fc7\u7a0b\u548c\u5e94\u7528 APISIX \u540e\u7684\u4ea7\u54c1\u5b9e\u8df5\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u57fa\u4e8e APISIX \u7684\u7f51\u5173\u5e94\u7528\u5b9e\u4f8b\u3002\\n\\n- [\u4ece Traefik \u5230 APISIX\uff0c\u6c7d\u8f66\u667a\u80fd\u8ba1\u7b97\u5e73\u53f0\u516c\u53f8\u300c\u5730\u5e73\u7ebf\u300d\u5728 Ingress Controller \u7684\u63a2\u7d22\u548c\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/10/28/apisix-ingress-with-horizon-ai/)\\n\\n    \u5730\u5e73\u7ebf\u4f5c\u4e3a\u4e00\u5bb6\u81f4\u529b\u4e8e\u6c7d\u8f66\u81ea\u52a8\u9a7e\u9a76\u82af\u7247\u7684\u516c\u53f8\uff0c\u5728\u4e1a\u52a1\u8fed\u4ee3\u4e2d\u4e3a\u4f55\u4ece Traefik \u5207\u6362\u5230\u4e86 APISIX Ingress \u53bb\u652f\u6491\u4e1a\u52a1\uff1f\\n\\n- [APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff01\u5e26\u6765\u4e30\u5bcc\u529f\u80fd\u4e0e\u8fed\u4ee3\u7ec6\u8282](https://apisix.apache.org/zh/blog/2022/09/28/apache-apisix-3.0.0-beta-release/)\\n\\n    Apache APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff0c\u4e3a\u4f60\u6574\u7406\u4e86\u6b64\u6b21\u9884\u89c8\u7248\u4e0a\u7ebf\u7684\u4e00\u4e9b\u529f\u80fd\u4e0e\u8c03\u6574\u7ec6\u8282\u3002\\n\\n- [\u4e3a\u4ec0\u4e48\u8bf4 Apache APISIX \u662f\u6700\u597d\u7684 API \u7f51\u5173\uff1f](https://apisix.apache.org/zh/blog/2022/09/27/why-apache-apisix-is-best-apigateway/)\\n\\n    \u672c\u6587\u9996\u53d1\u4e8e [API7.ai](https://www.apiseven.com/blog/why-is-apache-apisix-the-best-api-gateway)\uff0c\u4ece\u591a\u4e2a\u89d2\u5ea6\uff08\u5728\u5f00\u53d1\u4eba\u5458\u4e2d\u7684\u53d7\u6b22\u8fce\u7a0b\u5ea6\u3001\u5f00\u6e90\u8bb8\u53ef\u8bc1\u3001\u6027\u80fd\u548c\u6574\u4e2a\u751f\u6001\u7cfb\u7edf\uff09\u5bf9\u6bd4\u591a\u4e2a API \u7f51\u5173\uff08Kong\u3001Tyk\u3001Gloo\uff09\u3002"},{"id":"\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u662f\u4ec0\u4e48","metadata":{"permalink":"/zh/blog/2022/11/10/what-is-service-in-microservice-discovery","source":"@site/blog/2022/11/10/what-is-service-in-microservice-discovery.md","title":"\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u662f\u4ec0\u4e48","description":"\u672c\u6587\u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u7684\u76f8\u5173\u80cc\u666f\u548c APISIX \u5bf9\u4e8e\u670d\u52a1\u53d1\u73b0\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\uff0c\u6765\u4ecb\u7ecd\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5185\u5bb9\u3002","date":"2022-11-10T00:00:00.000Z","formattedDate":"2022\u5e7411\u670810\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":13.41,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://github.com/spacewander.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (10.16 - 11.4)","permalink":"/zh/blog/2022/11/10/weekly-report-1110"},"nextItem":{"title":"\u817e\u8baf\u84dd\u9cb8 API \u7f51\u5173\u5982\u4f55\u501f\u52a9 APISIX \u5b9e\u73b0\u4ea7\u54c1\u5347\u7ea7\u4e0e\u4e1a\u52a1\u5b8c\u5584","permalink":"/zh/blog/2022/11/05/tencent-blueking-with-apisix"}},"content":"> \u672c\u6587\u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u7684\u76f8\u5173\u80cc\u666f\u548c APISIX \u5bf9\u4e8e\u670d\u52a1\u53d1\u73b0\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\uff0c\u6765\u4ecb\u7ecd\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5185\u5bb9\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u670d\u52a1\u53d1\u73b0\u662f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u9700\u8981\uff1f\\n\\n\u5728\u4e92\u8054\u7f51\u521a\u5f00\u59cb\u51fa\u73b0\u7684\u5e74\u4ee3\uff0c\u4eba\u4eec\u8981\u60f3\u8bbf\u95ee\u67d0\u4e2a\u5728\u7ebf\u670d\u52a1\uff0c\u9700\u8981\u8f93\u5165\u4e00\u957f\u4e32\u7684 IP \u5730\u5740\u3002IP \u5730\u5740\u867d\u7136\u4e0d\u957f\uff0c\u4f46\u662f\u4f5c\u4e3a\u4e00\u4e32\u65e0\u610f\u4e49\u7684\u6570\u5b57\uff0c\u8981\u6c42\u8bb0\u4f4f\u7279\u5b9a\u670d\u52a1\u7684\u7279\u5b9a\u5730\u5740\u8fd8\u662f\u5f88\u8003\u9a8c\u4eba\u7684\u8bb0\u5fc6\u529b\u3002\u6240\u4ee5\u540e\u6765\u4eba\u4eec\u5c31\u53d1\u660e\u4e86\u57df\u540d\u7cfb\u7edf\u3002\u6bcf\u4e2a\u5728\u7ebf\u670d\u52a1\u4f1a\u5230\u57df\u540d\u5546\u6ce8\u518c\u4e00\u4e2a\u57df\u540d\uff0c\u7136\u540e\u901a\u8fc7 DNS \u5efa\u7acb\u57df\u540d\u548c\u5177\u4f53 IP \u7684\u8054\u7cfb\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4eba\u4eec\u53ea\u9700\u8981\u8f93\u5165\u4e00\u4e2a\u597d\u8bb0\u7684\u57df\u540d\uff0c\u5c31\u80fd\u8bbf\u95ee\u5230\u5177\u4f53 IP \u4e0a\u7684\u5728\u7ebf\u670d\u52a1\u3002\u8fd9\u5c31\u662f\u6700\u65e9\u7684\u670d\u52a1\u53d1\u73b0\u3002\\n\\n\u5f53\u4e00\u4e2a\u516c\u53f8\u5185\u90e8\u7684\u670d\u52a1\u6570\u5230\u4e86\u4e00\u5b9a\u7684\u89c4\u6a21\uff08\u6bd4\u5982\u5728\u505a\u4e86\u5fae\u670d\u52a1\u62c6\u5206\u4e4b\u540e\uff09\uff0c\u4e5f\u4f1a\u9047\u5230 IP \u5b9e\u5728\u4e0d\u597d\u8bb0\u7684\u95ee\u9898\u3002\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u6709\u4e00\u5957\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u3002\u516c\u53f8\u91cc\u9762\u5404\u4e2a\u670d\u52a1\u5728\u8be5\u7cfb\u7edf\u4e0a\u6ce8\u518c\uff0c\u7136\u540e\u60f3\u8981\u8bbf\u95ee\u8fd9\u4e9b\u670d\u52a1\u7684\u5176\u4ed6\u670d\u52a1\u4f1a\u4ece\u8be5\u7cfb\u7edf\u4e0a\u67e5\u8be2\u5bf9\u5e94\u7684 IP \u5730\u5740\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u8ba9\u67d0\u4e2a\u670d\u52a1\u201c\u8bb0\u4f4f\u201d\u590d\u6742\u591a\u53d8\u7684 IP \u5730\u5740\u4e86\u3002\\n\\n\u5982\u4e0b\u56fe\uff0cIP \u5730\u5740\u7684\u53d8\u66f4\uff0c\u4f1a\u8ba9\u8bbf\u95ee\u8005\u65e0\u6240\u9002\u4ece\u3002\\n\\n![IP \u53d8\u66f4](https://static.apiseven.com/2022/11/14/637210cb18c04.png)\\n\\n\u901a\u8fc7\u5f15\u5165\u57df\u540d\u7cfb\u7edf\u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0\u673a\u5236\uff0c\u73b0\u5728\u53ef\u4ee5\u7075\u6d3b\u5bf9\u5f85 IP \u7684\u53d8\u66f4\u4e86\u3002\\n\\n![\u5f15\u5165\u670d\u52a1\u53d1\u73b0](https://static.apiseven.com/2022/11/09/636b130c875ca.png)\\n\\n## \u5e38\u89c1\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u4ecb\u7ecd\\n\\n\u9274\u4e8e\u672c\u4eba\u7684\u80fd\u529b\u6709\u9650\uff0c\u672c\u6587\u5185\u5bb9\u4ec5\u4ecb\u7ecd\u4e86\u4e0e APISIX \u76f8\u5173\u7684\uff0c\u8fd8\u8bf7\u5404\u4f4d\u591a\u591a\u89c1\u8c05\u3002\\n\\n\u4f5c\u4e3a\u4e00\u4e2a\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\uff0c\u5b83\u9700\u8981\u6ee1\u8db3\u81f3\u5c11\u56db\u4e2a\u529f\u80fd\uff1a\\n\\n1. \u63d0\u4f9b\u6ce8\u518c\u7684 API\u3002\\n2. \u63d0\u4f9b\u67e5\u8be2\u7684 API\u3002\\n3. \u9ad8\u53ef\u7528\uff0c\u6bd5\u7adf\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u662f\u6574\u4e2a\u7cfb\u7edf\u7684\u795e\u7ecf\uff0c\u4e0d\u80fd\u9ebb\u75f9\u751a\u81f3\u762b\u75ea\u3002\\n4. \u751f\u6001\u5b8c\u6574\u3002\u4f17\u6240\u5468\u77e5\uff0c\u7a0b\u5e8f\u5458\u662f\u4e00\u7fa4\u5f88\u61d2\u60f0\u7684\u4eba\uff0c\u6700\u597d\u6709\u4e00\u4e2a\u5e93\uff0c\u5f15\u5165\u8fdb\u6765\u5c31\u80fd\u8ddf API \u5b8c\u6210\u5bf9\u63a5\u3002\\n\\n\u4e0b\u9762\u8ba9\u6211\u4eec\u6765\u770b\u770b\u5e02\u9762\u4e0a\u4e3b\u6d41\u7684\u51e0\u4e2a\u5f00\u6e90\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u3002\\n\\n### Consul\\n\\n[Consul](https://github.com/hashicorp/consul) \u662f\u7531\u8457\u540d\u7684\u5f00\u6e90\u9879\u76ee\u5b75\u5316\u516c\u53f8 Hashicorp \u5f00\u53d1\u7684\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u3002\u4f5c\u4e3a\u4e00\u4e2a\u5728 2014 \u5e74 4 \u6708 17 \u65e5\u5c31\u53d1\u5e03\u4e86\u7b2c\u4e00\u7248\u7684\u8001\u724c\u8f6f\u4ef6\uff0cConsul \u6709\u7740\u6700\u4e3a\u4e30\u5bcc\u7684\u751f\u6001\uff0c\u751a\u81f3\u6709\u7b2c\u4e09\u65b9\u5f00\u53d1\u8005\u4e3a\u5b83\u5f00\u53d1\u4e86 Haskell \u7684 SDK\u3002\u5927\u90e8\u5206 Consul \u7684 SDK \u53ea\u662f\u5bf9\u5176 HTTP API \u7684\u5c01\u88c5\uff0c\u6240\u4ee5\u5176\u5b9e\u5f00\u53d1\u91cf\u5e76\u4e0d\u5927\u3002\\n\\nConsul \u652f\u6301\u901a\u8fc7 HTTP API \u6765\u5b8c\u6210\u670d\u52a1\u7684\u6ce8\u518c\u548c\u67e5\u8be2\u3002\u5b83\u652f\u6301\u5728\u67e5\u8be2\u65f6\u901a\u8fc7 HTTP long polling \u6765\u5b9e\u73b0\u53ca\u65f6\u7684\u6570\u636e\u63a8\u9001\uff0c\u907f\u514d\u8f6e\u8be2\u3002\u6b64\u5916 Consul \u4e5f\u652f\u6301\u901a\u8fc7 DNS \u7684\u65b9\u5f0f\u67e5\u8be2\u5bf9\u5e94\u670d\u52a1\u7684\u5b9e\u4f8b\u3002\\n\\nConsul \u7684\u90e8\u7f72\u65b9\u5f0f\u6bd4\u8f83\u6709\u8da3\u3002Consul \u7684\u6bcf\u4e2a\u5b9e\u4f8b\u53eb\u505a agent\uff0c\u5b83\u65e2\u53ef\u4ee5\u662f\u5ba2\u6237\u7aef\uff0c\u4e5f\u53ef\u4ee5\u662f\u670d\u52a1\u7aef\u3002\u5728\u5ba2\u6237\u7aef\uff0cConsul \u4f1a\u7ef4\u6301\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u72b6\u6001\uff1b\u5bf9\u4e8e\u670d\u52a1\u7aef\uff0c Consul \u901a\u8fc7\u4e00\u81f4\u6027\u7b97\u6cd5 Raft\uff0c\u652f\u6301\u5206\u5e03\u5f0f\u90e8\u7f72\uff0c\u4ee5\u6b64\u6765\u5b9e\u73b0\u9ad8\u53ef\u7528\u3002\\n\\n### Eureka\\n\\n[Eureka](https://github.com/Netflix/eureka) \u662f\u7531 Netflix \u5f00\u6e90\u51fa\u6765\u7684\u9879\u76ee\u3002\u5b83\u4e5f\u662f\u76f8\u5f53\u7684\u53e4\u8001\uff0c\u6709\u8ff9\u53ef\u5faa\u7684[\u63d0\u4ea4](https://github.com/Netflix/eureka/commit/53939453474e39a8a68236f940c72de043ea20bd)\u53ef\u4ee5\u8ffd\u6eaf\u5230 2012 \u5e74\u3002\u4e0d\u8fc7\u8fd9\u4e2a\u9879\u76ee\u5df2\u7ecf\u6709 1 \u5e74\u4e0d\u7ef4\u62a4\u4e86\u3002\u8bb8\u591a\u7528\u6237\u8fc1\u79fb\u5230\u4e0b\u6587\u4f1a\u63d0\u5230\u7684 Nacos \u4e0a\u9762\u3002\\n\\nEureka \u652f\u6301\u901a\u8fc7 HTTP API \u548c Java SDK \u6765\u4ea4\u4e92\u3002\u8bb8\u591a Eureka \u7684\u7528\u6237\uff0c\u5176\u5b9e\u662f\u901a\u8fc7 Spring Cloud \u7b49 Java \u751f\u6001\u5708\u91cc\u7684\u9879\u76ee\u5e26\u8fdb\u6765\u7684\u3002Eureka \u9ad8\u53ef\u7528\u7684\u8bbe\u8ba1\uff0c\u5982\u679c\u8981\u7528 CAP \u7684\u672f\u8bed\u6765\u63cf\u8ff0\uff0c\u5c5e\u4e8e AP\uff0c\u5373\u5141\u8bb8\u7f51\u7edc\u5206\u88c2\u65f6\u5ba2\u6237\u7aef\u770b\u5230\u8fc7\u671f\u7684\u6570\u636e\uff0c\u907f\u514d\u56e0\u4e3a\u7f51\u7edc\u95ee\u9898\u51fa\u73b0\u6b21\u751f\u707e\u5bb3\u3002\\n\\n### Nacos\\n\\n[Nacos](https://github.com/alibaba/nacos) \u662f\u7531\u963f\u91cc\u5df4\u5df4\u5f00\u53d1\u7684\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u3002\u5176\u540d\u79f0\u6765\u81ea\u4e8e Naming and Configuration Service \u524d\u51e0\u4e2a\u5b57\u6bcd\u7684\u6c47\u603b\u3002\u81ea 2018 \u5e74 7 \u6708 20 \u65e5\u53d1\u5e03\u4e86 0.1.0 \u7248\u672c\u4ee5\u6765\uff0cNacos \u76ee\u524d\u5df2\u7ecf\u53d1\u5c55\u5230\u4e86 2.1 \u7248\u672c\u3002\\n\\n\u5c31\u50cf\u963f\u91cc\u5df4\u5df4\u7684\u8bb8\u591a\u5f00\u6e90\u9879\u76ee\u4e00\u6837\uff0cNacos \u5728\u4e2d\u56fd\u7684 Java \u5f00\u53d1\u8005\u4e2d\u76f8\u5f53\u6d41\u884c\uff0c\u5176\u77e5\u540d\u5ea6\u751a\u81f3\u6bd4 Eureka \u8fd8\u8981\u5927\u4e0d\u5c11\u3002\\n\\n\u5b83\u652f\u6301\u901a\u8fc7 HTTP API \u548c Java/Go/Python/NodeJS/C# \u7b49 SDK \u6765\u5b8c\u6210\u670d\u52a1\u7684\u6ce8\u518c\u548c\u67e5\u8be2\u3002\u76ee\u524d\uff0cNacos \u5f00\u53d1\u8005\u4e5f\u5728\u5f00\u53d1\u57fa\u4e8e gRPC \u7684\u65b0 API\u3002\u5bf9\u4e8e HTTP API\uff0c\u76ee\u524d Nacos \u53ea\u652f\u6301\u901a\u8fc7\u8f6e\u8be2\u7684\u65b9\u5f0f\u6765\u83b7\u53d6\u670d\u52a1\u5217\u8868\u3002\u6240\u4ee5 Nacos \u5b98\u65b9\u66f4\u52a0\u63a8\u8350\u91c7\u53d6 SDK \u7684\u65b9\u5f0f\u3002\u5176 SDK \u7684\u5b9e\u73b0\uff0c\u662f\u8f6e\u8be2+\u57fa\u4e8e UDP \u7684\u63a8\u9001\u4e24\u79cd\u65b9\u5f0f\uff0c\u56e0\u6b64\u4f1a\u6709\u66f4\u597d\u7684\u5b9e\u65f6\u6027\u3002\u53e6\u5916 Nacos \u4e5f\u5728\u5f00\u53d1\u57fa\u4e8e gRPC \u7684\u65b0 API\uff0c\u8be5 API \u5c06\u4f1a\u5f15\u5165\u670d\u52a1\u7aef\u63a8\u9001\u7684\u80fd\u529b\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u4e0d\u80fd\u63a5\u5165 SDK \u7684\u7cfb\u7edf\u5c06\u662f\u4e00\u5927\u5229\u597d\u3002\\n\\nNacos \u7684\u9ad8\u53ef\u7528\uff0c\u4e00\u65b9\u9762\u662f\u5ba2\u6237\u7aef SDK \u4e2d\u63d0\u4f9b\u4e86\u6301\u4e45\u5316\u7684\u80fd\u529b\uff0c\u53e6\u5916\u670d\u52a1\u7aef\u901a\u8fc7 Raft \u548c Distro \u4e24\u5957\u534f\u8bae\u5b9e\u73b0\u4e86\u4e00\u81f4\u6027\u3002\\n\\n## \u5e38\u89c1\u5bf9\u63a5\u65b9\u5f0f\u53ca\u5404\u81ea\u4f18\u7f3a\u70b9\\n\\n\u629b\u5f00\u79c1\u6709\u534f\u8bae\u4e0d\u8c08\uff0c\u670d\u52a1\u53d1\u73b0\u7684\u5bf9\u63a5\u65b9\u5f0f\u53ef\u4ee5\u5206\u6210\u4e09\u7c7b\uff1a\\n\\n1. HTTP \u8f6e\u8be2\\n2. DNS\\n3. HTTP long poll \u6216 gRPC server stream\\n\\nHTTP \u8f6e\u8be2\u80dc\u5728\u5b9e\u73b0\u7b80\u5355\uff0c\u4e0d\u8fc7\u5e76\u4e0d\u5177\u6709\u5b9e\u65f6\u6027\u3002\\n\\nDNS \u7684\u6027\u80fd\u5f00\u9500\u662f\u6700\u5c0f\u7684\u3002\u7531\u4e8e DNS cache \u7684\u5b58\u5728\uff0cDNS \u4e5f\u5e76\u4e0d\u5177\u6709\u5b9e\u65f6\u6027\u3002DNS \u5bf9\u6bd4\u4e8e\u5176\u4ed6\u65b9\u5f0f\uff0c\u6709\u4e2a\u597d\u5904\u5728\u4e8e\u5b83\u662f\u4e00\u5957\u5e7f\u4e3a\u63a5\u53d7\u3001\u5b9e\u73b0\u65e0\u5173\u7684\u6807\u51c6\u3002\u4f46\u662f\u51e1\u4e8b\u603b\u6709\u4e24\u9762\u6027\uff0c\u8fd9\u610f\u5473\u7740\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u65e0\u6cd5\u7ed9 DNS \u54cd\u5e94\u589e\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u5b57\u6bb5\uff0c\u9664\u975e\u6d3b\u7528 DNS \u54cd\u5e94\u91cc\u7684 Additional \u5b57\u6bb5\uff0c\u4f46\u662f\u8fd9\u4e48\u4e00\u6765\u5c31\u9700\u8981\u5ba2\u6237\u7aef\u7279\u522b\u7684\u5904\u7406\u3002\\n\\nHTTP long poll \u6216 gRPC server stream \u662f\u4e09\u8005\u4e2d\u6700\u6709\u5b9e\u65f6\u6027\u7684\uff0c\u53e6\u5916\u7531\u4e8e\u4ed6\u4eec\u90fd\u662f\u57fa\u4e8e HTTP \u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u65b9\u4fbf\u5730\u81ea\u5b9a\u4e49\u54cd\u5e94\u3002\u800c\u7f3a\u70b9\u5c31\u662f\u5ba2\u6237\u7aef\u5b9e\u73b0\u8d77\u6765\u76f8\u5bf9\u6709\u96be\u5ea6\u3002\\n\\n## APISIX \u5982\u4f55\u5bf9\u63a5\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\\n\\n\u4f5c\u4e3a\u4e00\u4e2a\u4e91\u539f\u751f\u7684\u7f51\u5173\uff0cAPISIX \u652f\u6301\u4ece\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u4e2d\u83b7\u53d6\u4e0a\u6e38\u8282\u70b9\uff0c\u800c\u4e14\u662f\u540c\u65f6\u652f\u6301\u5728\u6570\u636e\u9762\u548c\u63a7\u5236\u9762\u4e0a\u5bf9\u63a5\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u3002\\n\\n### \u6570\u636e\u9762\\n\\nAPISIX \u5728\u6570\u636e\u9762\u4e0a\u652f\u6301\u8ddf DNS\u3001Eureka\u3001Consul\uff08KV \u6a21\u5f0f\uff09\u3001Nacos\u3001K8s \u5bf9\u63a5\u3002\\n\\n\u5728\u5bf9\u63a5 DNS \u670d\u52a1\u53d1\u73b0\uff0cAPISIX \u4f1a\u901a\u8fc7 DNS \u7684 SRV \u6216 A/AAAA \u8bb0\u5f55\u83b7\u53d6\u67d0\u4e2a\u670d\u52a1\u5177\u4f53\u7684\u4e0a\u6e38\u8282\u70b9\u3002\u5f53\u8bf7\u6c42\u8bbf\u95ee\u4e0a\u6e38\u65f6\uff0c\u4f1a\u5148\u5c1d\u8bd5\u4ece DNS cache \u4e2d\u83b7\u53d6\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u53d1\u8d77 DNS \u67e5\u8be2\uff0c\u5f97\u5230\u5bf9\u5e94\u8bb0\u5f55\u91cc\u9762\u7684\u5177\u4f53 IP \u5730\u5740\u3002\\n\\n\u81f3\u4e8e\u5176\u4ed6\u7684\u670d\u52a1\u53d1\u73b0\u7c7b\u578b\uff0c\u5219\u662f\u5728\u540e\u53f0\u540c\u6b65\u7684\u3002\u5f53\u8bf7\u6c42\u8bbf\u95ee\u4e0a\u6e38\u65f6\uff0c\u4ece\u5f53\u524d\u540c\u6b65\u5230\u7684\u6570\u636e\u91cc\u83b7\u53d6\u670d\u52a1\u540d\u5bf9\u5e94\u7684\u90a3\u4e00\u90e8\u5206\u6570\u636e\u3002\u5bf9\u4e8e K8s \u548c Consul KV\uff0c\u7531\u4e8e\u4ed6\u4eec\u652f\u6301 HTTP long polling\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8be5\u65b9\u5f0f\u5b9e\u65f6\u83b7\u53d6\u53d8\u66f4\u7684 IP \u5730\u5740\u3002\u800c\u5bf9\u4e8e Eureka \u548c Nacos\uff0c\u76ee\u524d\u6211\u4eec\u53ea\u662f\u901a\u8fc7\u8f6e\u8be2\u7684\u65b9\u5f0f\u6765\u83b7\u53d6\u6570\u636e\u3002\\n\\n### \u63a7\u5236\u9762\\n\\nAPISIX \u540c\u65f6\u8fd8\u652f\u6301\u5728\u63a7\u5236\u9762\u4e0a\u505a\u670d\u52a1\u53d1\u73b0\u3002\u6211\u4eec\u6b63\u5728\u5f00\u53d1 [apisix-seed](https://github.com/api7/apisix-seed/)\uff0c\u8be5\u9879\u76ee\u4f1a\u4ece\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u4e2d\u540c\u6b65\u6570\u636e\u5230 etcd \u4e2d\uff0c\u8fd9\u6837\u6570\u636e\u9762\u5c31\u80fd\u4ece etcd \u4e2d\u540c\u6b65\u6700\u65b0\u7684\u4e0a\u6e38\u8282\u70b9\u4e86\u3002\\n\\n\u76ee\u524d\u6211\u4eec\u5df2\u7ecf\u5728\u63a7\u5236\u9762\u4e0a\u5b9e\u73b0\u4e86\u5bf9 Nacos \u548c Zookeeper \u7684\u652f\u6301\u3002\u7531\u4e8e\u5728\u63a7\u5236\u9762\u4e0a\u7684\u670d\u52a1\u53d1\u73b0\u652f\u6301\uff0c\u662f\u901a\u8fc7\u5b98\u65b9\u63d0\u4f9b\u7684 SDK \u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u62e5\u6709\u666e\u901a\u7684 HTTP \u5bf9\u63a5\u6240\u6ca1\u6709\u7684\u4f18\u52bf\u3002\u6bd4\u5982\u5728 apisix-seed \u7684 Nacos \u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u652f\u6301\u57fa\u4e8e UDP \u7684\u63a8\u9001\uff0c\u6240\u4ee5\u6570\u636e\u7684\u65f6\u6548\u6027\u8981\u6bd4 HTTP \u8f6e\u8be2\u8f83\u597d\u3002\\n\\n## APISIX \u652f\u6301\u670d\u52a1\u53d1\u73b0\u6709\u54ea\u4e9b\u573a\u666f\u4f18\u52bf\\n\\n\u901a\u8fc7\u5728\u7f51\u5173\u4e0a\u76f4\u63a5\u96c6\u6210\u670d\u52a1\u53d1\u73b0\uff0c\u53ef\u4ee5\u5927\u5927\u7b80\u5316\u670d\u52a1\u4e0a\u7ebf\u7684\u5de5\u4f5c\u91cf\u3002\u914d\u7f6e APISIX \u6765\u5bf9\u63a5\u4f60\u7684\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\uff0c\u7136\u540e\u5269\u4e0b\u7684\u4e8b\u5c31\u8ba9 APISIX \u66ff\u4f60\u64cd\u5fc3\u597d\u4e86\u3002\\n\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4f60\u7684\u516c\u53f8\u6b63\u5728\u4f7f\u7528 Nacos \u6765\u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\uff0c\u90a3\u4e48\u4f60\u53ea\u9700\u8981\u914d\u7f6e APISIX\uff0c\u542f\u7528 Nacos \u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff0c\u540e\u9762\u53ea\u8981\u628a\u670d\u52a1\u540d\u914d\u7f6e\u5230 APISIX \u7684\u4e0a\u6e38\uff0cAPISIX \u5c31\u4f1a\u81ea\u52a8\u83b7\u53d6\u8be5\u4e0a\u6e38\u5bf9\u5e94\u7684\u5177\u4f53 IP \u8282\u70b9\u3002\\n\\n\u8fd9\u4e00\u4f18\u52bf\u5728\u9700\u8981\u5728\u7f51\u5173\u8fc1\u79fb\u65f6\uff0c\u6bd4\u5982\u4ece Spring Cloud Gateway \u8fc1\u79fb\u5230 APISIX \u4e0a\u6765\uff0c\u53ef\u4ee5\u660e\u663e\u51cf\u5c11\u6240\u9700\u7684\u5de5\u4f5c\u91cf\u3002\u5982\u679c\u8fc7\u53bb\u7528\u7684 Spring Cloud Gateway \u4f7f\u7528\u4e86 Eureka \u6291\u6216 Nacos \u6765\u505a\u670d\u52a1\u53d1\u73b0\uff0c\u90a3\u4e48\u8fc1\u79fb\u5230\u65b0\u7cfb\u7edf\u65f6\uff0c\u4ec5\u9700\u5728 APISIX \u91cc\u9762\u542f\u7528\u5bf9 Eureka \u6216 Nacos \u7684\u652f\u6301\uff0c\u5373\u53ef\u5b8c\u6210\u8fc7\u6e21\u5de5\u4f5c\u3002\\n\\n\u4e0b\u56fe\u662f\u300c\u8fd8\u5457\u300d\u5728\u8fd9\u65b9\u9762\u7684\u6280\u672f\u5b9e\u8df5\uff0c\u66ff\u6362 Spring Cloud Gateway \u662f\u4e3a\u4e86\u8fdb\u4e00\u6b65\u63d0\u5347\u7a33\u5b9a\u6027\u3001\u5f3a\u76d1\u7ba1\u4ee5\u53ca\u51c6\u786e\u6027\u548c\u6709\u6548\u6027\uff1a\\n\\n![\u8fd8\u5457\u67b6\u6784\u8c03\u6574](https://static.apiseven.com/2022/11/09/636b130d299e4.png)\\n\\n> \u5f15\u7528\u300c\u8fd8\u5457\u300d\u539f\u6587\uff1a\\n> \u4f5c\u4e3a\u4f01\u4e1a\u6765\u8bf4\uff0c\u6210\u672c\u4f18\u5148\u4f9d\u65e7\u662f\u9700\u8981\u8003\u8651\u7684\u539f\u5219\u3002\u91ce\u86ee\u751f\u957f\u9636\u6bb5\u53ef\u80fd\u53ea\u9700\u8981\u5c3d\u5feb\u5b9e\u73b0\u4e1a\u52a1\uff0c\u800c\u5728\u76ee\u524d\u5927\u73af\u5883\u4e0b\uff0c\u9884\u7b97\u8303\u56f4\u4e4b\u5185\u80af\u5b9a\u662f\u6210\u672c\u4f18\u5148\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u6548\u7387\u548c\u6210\u672c\u6c38\u8fdc\u53ea\u80fd\u4fdd\u4f4f\u4e00\u9879\u3002\u56e0\u6b64\u5728\u6210\u672c\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u4f01\u4e1a\u5c31\u4f1a\u5c11\u8c08\u6280\u672f\u7684\u5148\u8fdb\u6027\u3002\u6280\u672f\u4eba\u5458\u5728\u9009\u578b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5c31\u4e0d\u4f1a\u8003\u8651\u5f53\u4e0b\u9009\u62e9\u7684\u8fd9\u4e2a\u6280\u672f\u5bf9\u56e2\u961f\u6709\u591a\u5927\u51b2\u51fb\u3001\u5bf9\u73b0\u6709\u7684\u8fd0\u7ef4\u548c\u67b6\u6784\u5e26\u6765\u591a\u5c11\u6536\u76ca\u7b49\u7b49\uff0c\u66f4\u591a\u662f\u4ece\u6210\u672c\u89d2\u5ea6\u8003\u8651\u3002\\n\\n\u6b64\u5916\uff0cAPISIX \u652f\u6301\u540c\u65f6\u914d\u7f6e\u591a\u4e2a\u670d\u52a1\u53d1\u73b0\u3002\u8bb8\u591a\u516c\u53f8\u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u53ef\u80fd\u4f1a\u5b58\u5728\u591a\u5957\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u3002\u6bd4\u5982\u5c31\u6211\u77e5\u9053\u7684\u60c5\u51b5\uff0c\u6709\u7684\u516c\u53f8\u4f1a\u540c\u65f6\u6709\u65e7\u7684 Eureka \u670d\u52a1\u53d1\u73b0\u548c\u65b0\u7684 Nacos \u670d\u52a1\u53d1\u73b0\u3002APISIX \u53ea\u9700\u8981\u540c\u65f6\u542f\u7528 Eureka \u548c Nacos\uff0c\u5c31\u53ef\u4ee5\u5e94\u5bf9\u8fd9\u79cd\u60c5\u51b5\u3002\\n\\n\u5982\u679c\u4f60\u73b0\u5728\u662f\u76f4\u63a5\u5728 APISIX \u4e0a\u914d\u7f6e\u4e0a\u6e38\u8282\u70b9\uff0c\u4e5f\u53ef\u4ee5\u8003\u8651\u53e6\u5916\u90e8\u7f72\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\uff0c\u5e76\u6539\u7531\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u6765\u5b58\u50a8\u5177\u4f53\u7684\u8282\u70b9\u914d\u7f6e\u3002\u5c06\u4e0a\u6e38\u8282\u70b9\u7684\u914d\u7f6e\uff0c\u7531 APISIX \u79fb\u52a8\u5230\u4e13\u95e8\u7684\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\uff0c\u597d\u5904\u5728\u4e8e\u5ba2\u6237\u7aef\u53ef\u4ee5\u81ea\u5df1\u6765\u5b8c\u6210\u670d\u52a1\u7684\u6ce8\u518c\uff0c\u800c\u4e14\u4e13\u95e8\u7684\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u5f80\u5f80\u4f1a\u63d0\u4f9b\u989d\u5916\u7684\u529f\u80fd\uff0c\u5982\u66f4\u4e30\u5bcc\u7684\u5065\u5eb7\u68c0\u67e5\u7b49\u3002\\n\\n\u672a\u6765\uff0c\u6211\u4eec\u4e5f\u4f1a\u5728 APISIX Ingress Controller \u4e0a\u652f\u6301\u96c6\u6210\u5404\u79cd\u670d\u52a1\u6ce8\u518c\u53d1\u73b0\u7ec4\u4ef6\uff0c\u4fbf\u4e8e\u7528\u6237\u4f7f\u7528\u3002\u5230\u90a3\u65f6\uff0c\u7528\u6237\u5c06\u4e0d\u4ec5\u4ec5\u80fd\u5728 APISIX Ingress Controller \u4e0a\u6307\u5b9a K8s service \u7684 endpoints \u4f5c\u4e3a\u4e0a\u6e38\u8282\u70b9\uff0c\u8fd8\u80fd\u591f\u628a\u670d\u52a1\u53d1\u73b0\u5f97\u5230\u7684\u8282\u70b9\u6574\u5408\u8fdb\u6765\u3002"},{"id":"\u817e\u8baf\u84dd\u9cb8 API \u7f51\u5173\u5982\u4f55\u501f\u52a9 APISIX \u5b9e\u73b0\u4ea7\u54c1\u5347\u7ea7\u4e0e\u4e1a\u52a1\u5b8c\u5584","metadata":{"permalink":"/zh/blog/2022/11/05/tencent-blueking-with-apisix","source":"@site/blog/2022/11/05/tencent-blueking-with-apisix.md","title":"\u817e\u8baf\u84dd\u9cb8 API \u7f51\u5173\u5982\u4f55\u501f\u52a9 APISIX \u5b9e\u73b0\u4ea7\u54c1\u5347\u7ea7\u4e0e\u4e1a\u52a1\u5b8c\u5584","description":"\u672c\u6587\u4ece\u84dd\u9cb8\u7f51\u5173\u7684\u8fed\u4ee3\u8fc7\u7a0b\u548c\u5e94\u7528 APISIX \u540e\u7684\u4ea7\u54c1\u5b9e\u8df5\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u57fa\u4e8e APISIX \u7684\u7f51\u5173\u5e94\u7528\u5b9e\u4f8b\u3002","date":"2022-11-05T00:00:00.000Z","formattedDate":"2022\u5e7411\u67085\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":21.77,"truncated":true,"authors":[{"name":"\u6731\u96f7","title":"Author"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u5fae\u670d\u52a1\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u662f\u4ec0\u4e48","permalink":"/zh/blog/2022/11/10/what-is-service-in-microservice-discovery"},"nextItem":{"title":"\u5f53 Amazon Lambda \u9047\u4e0a Apache APISIX \u53ef\u4ee5\u64e6\u51fa\u4ec0\u4e48\u706b\u82b1\uff1f","permalink":"/zh/blog/2022/11/04/why-do-you-need-apache-apisix-when-using-amazon-lambda"}},"content":"> \u672c\u6587\u4ece\u84dd\u9cb8\u7f51\u5173\u7684\u8fed\u4ee3\u8fc7\u7a0b\u548c\u5e94\u7528 APISIX \u540e\u7684\u4ea7\u54c1\u5b9e\u8df5\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u57fa\u4e8e APISIX \u7684\u7f51\u5173\u5e94\u7528\u5b9e\u4f8b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u5206\u4eab\u5609\u5bbe\u6731\u96f7\uff0c\u817e\u8baf IEG \u8fd0\u7ef4 PaaS \u5e73\u53f0\u6280\u672f\u8d1f\u8d23\u4eba\u3002\\n\\n\u84dd\u9cb8\uff08\u5168\u540d\u201c\u84dd\u9cb8\u667a\u4e91\u201d\uff09\u662f\u4e00\u5957\u5b75\u5316\u4e8e\u817e\u8baf IEG\uff08\u4e92\u52a8\u5a31\u4e50\u4e8b\u4e1a\u7fa4\uff09\u5185\u90e8\uff0c\u670d\u52a1\u4e8e\u591a\u4e1a\u52a1\u4e0e\u5404\u5185\u90e8\u5e73\u53f0\u7684\u7814\u8fd0\u4e00\u4f53\u5316 PaaS\u3002\u5176\u4f5c\u7528\u662f\u5728 CI\u3001CD \u548c CO \u4e09\u4e2a\u9636\u6bb5\uff0c\u5bf9\u516c\u53f8\u4e1a\u52a1\u63d0\u4f9b\u5168\u751f\u547d\u5468\u671f\u7684\u670d\u52a1\u3002\\n\\n![\u84dd\u9cb8\u4f5c\u7528\u9636\u6bb5](https://static.apiseven.com/2022/11/14/6371a5edf3dfb.png)\\n\\n## \u84dd\u9cb8 API \u7f51\u5173\\n\\n\u65e2\u7136\u662f\u4e3a\u5185\u90e8\u4e1a\u52a1\u670d\u52a1\uff0c\u90a3\u4e48\u817e\u8baf\u6e38\u620f\u7684\u4e1a\u52a1\u90fd\u6709\u54ea\u4e9b\u7279\u70b9\u5462\uff1f\\n\\n\u5927\u5bb6\u5728\u65e5\u5e38\u751f\u6d3b\u4e2d\u80af\u5b9a\u4e5f\u63a5\u89e6\u8fc7\u5f88\u591a\u817e\u8baf\u51fa\u54c1\u7684\u6e38\u620f\u3002\u5728\u817e\u8baf\u5185\u90e8\uff0c\u53ef\u80fd\u6709\u4e0a\u5343\u6b3e\u7684\u6e38\u620f\u4e1a\u52a1\uff0c\u9664\u90e8\u5206\u81ea\u7814\u6e38\u620f\u5916\uff0c\u5927\u90e8\u5206\u90fd\u5c5e\u4e8e\u4ee3\u7406\u7c7b\u3002\u4ee3\u7406\u4e1a\u52a1\u7684\u7279\u70b9\u5728\u4e8e\uff0c\u5b83\u4eec\u662f\u7531\u4e0d\u540c\u516c\u53f8\u6240\u5f00\u53d1\uff0c\u56e0\u6b64\u5404\u4ea7\u54c1\u4f7f\u7528\u7684\u8bed\u8a00\u3001\u4f9d\u8d56\u7684\u5b58\u50a8\u6216\u8005\u6574\u4e2a\u67b6\u6784\u98ce\u683c\u53ef\u80fd\u90fd\u662f\u5343\u5dee\u4e07\u522b\u7684\u3002\\n\\n\u9762\u5bf9\u8fd9\u79cd\u5305\u542b\u5927\u91cf\u5f02\u6784\u67b6\u6784\u7684\u590d\u6742\u4e1a\u52a1\u573a\u666f\uff0c\u84dd\u9cb8\u4f5c\u4e3a\u4e00\u4e2a\u670d\u52a1\u4e8e\u5185\u90e8\u7684\u5e73\u53f0\u4ea7\u54c1\uff0c\u5728\u5efa\u8bbe\u65f6\u5c31\u9700\u8981\u505a\u5230\u4ee5\u4e0b\u51e0\u70b9\uff1a\\n\\n* \u91c7\u7528\u539f\u5b50\u5316\u8bbe\u8ba1\uff0c\u5c06\u5e73\u53f0\u80fd\u529b\u62bd\u8c61\u3001\u6253\u6563\uff0c\u8fdb\u884c\u5fae\u670d\u52a1\u5316\u6539\u9020\uff0c\u5f62\u6210\u4e00\u5957 PaaS \u67b6\u6784\uff1b\\n\\n* \u4f7f\u7528\u4f4e\u4ee3\u7801\u6280\u672f\u9ad8\u6548\u5f00\u53d1 SaaS\uff0c\u6765\u4f7f\u7528 PaaS \u5e73\u53f0\u7684\u539f\u5b50\u80fd\u529b\uff1b\\n\\n* \u901a\u8fc7\u5404\u7c7b SaaS \u6765\u7075\u6d3b\u5e94\u5bf9\u4e0d\u540c\u7684\u670d\u52a1\u573a\u666f\u3002\\n\\n### \u8bde\u751f\u80cc\u666f\\n\\n\u8003\u8651\u5230\u73b0\u5b9e\u4e2d\u7684\u4e1a\u52a1\u73af\u5883\u4e0e\u5185\u90e8\u4e1a\u52a1\u9700\u6c42\uff0c\u6700\u7ec8\u84dd\u9cb8\u5e73\u53f0\u7684\u6574\u4f53\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![\u84dd\u9cb8\u5185\u90e8\u4e1a\u52a1\u67b6\u6784](https://static.apiseven.com/2022/11/14/6371a5daa2bc8.png)\\n\\n\u4e2d\u95f4\u7684\u84dd\u8272\u90e8\u5206\u662f PaaS \u5c42\uff0c\u5176\u4e2d\u6700\u5927\u7684\u4e00\u5757\u662f\u524d\u9762\u63d0\u5230\u7684\u5404\u7c7b\u539f\u5b50\u80fd\u529b\u3002\u5305\u62ec\u7528\u6237\u7ba1\u7406\u3001\u7edf\u4e00\u6743\u9650\u4e2d\u5fc3\u3001\u7edf\u4e00\u914d\u7f6e\u5e73\u53f0\u7b49\u3002\\n\\n\u4e0a\u5c42\u7684\u6a59\u8272\u90e8\u5206\u662f SaaS \u5c42\uff0c\u4e3b\u8981\u7531\u5f88\u591a\u4e0d\u540c\u89d2\u8272\u9488\u5bf9\u7279\u5b9a\u9700\u6c42\u573a\u666f\u5f00\u53d1\u7684 SaaS \u6784\u6210\u3002\u8fd9\u4e9b SaaS \u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u6216\u591a\u6216\u5c11\u5730\u90fd\u9700\u8981\u901a\u8fc7 API \u4f7f\u7528 PaaS \u5c42\u6700\u6838\u5fc3\u7684\u5404\u5e73\u53f0\u539f\u5b50\u80fd\u529b\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c31\u52bf\u5fc5\u9700\u8981\u4e00\u4e2a\u7edf\u4e00\u7684 API \u7f51\u5173\u3002\\n\\n\u4ee5\u4e0a\u5c31\u662f\u6700\u521d\u60f3\u8981\u6253\u9020\u84dd\u9cb8 API \u7f51\u5173\u7684\u539f\u56e0\u3002\u5c06\u524d\u9762\u7684\u67b6\u6784\u56fe\u505a\u4e00\u4e9b\u62bd\u8c61\uff0c\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a\u5982\u4e0b\u7b80\u5355\u7684\u7f51\u5173\u753b\u50cf\u3002\\n\\n![\u7f51\u5173\u7b80\u6613\u753b\u50cf](https://static.apiseven.com/2022/11/14/6371a5de3e023.png)\\n\\n\u84dd\u9cb8\u662f\u4e00\u4e2a\u6bd4\u8f83\u590d\u6742\u7684\u5e73\u53f0\uff0c\u5b83\u5bf9\u4e8e\u7edf\u4e00\u7f51\u5173\u7684\u9700\u6c42\u4e5f\u4f1a\u6bd4\u8f83\u590d\u6742\u3002\u9664\u4e86\u6700\u57fa\u7840\u7684\u4f5c\u4e3a\u4ee3\u7406\u53bb\u8c03\u7528\u539f\u5b50\u5e73\u53f0\u7684 API \u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u63d0\u4f9b\u4e00\u4e9b\u989d\u5916\u7684\u7f51\u5173\u80fd\u529b\u3002\u6bd4\u5982\u670d\u52a1\u53d1\u73b0\u3001\u7edf\u4e00\u7528\u6237\u8ba4\u8bc1\u3001\u9274\u6743\u548c\u9650\u6d41\u9650\u901f\u7b49\u7b49\u3002\\n\\n\u53e6\u4e00\u65b9\u9762\uff0c\u968f\u7740\u4e91\u539f\u751f\u6280\u672f\u7684\u53d1\u5c55\uff0c\u5982\u4eca\u5185\u90e8\u5f88\u591a SaaS \u548c\u539f\u5b50\u5e73\u53f0\u4e5f\u5f00\u59cb\u90e8\u7f72\u5728 K8s \u96c6\u7fa4\u4e2d\u3002\u8fd9\u7c7b\u573a\u666f\u53c8\u5411\u7f51\u5173\u63d0\u51fa\u4e86\u65b0\u7684\u8981\u6c42\uff0c\u6bd4\u5982\u9700\u8981\u901a\u8fc7\u7edf\u4e00\u6d41\u91cf\u7f51\u5173\u6216 API \u7f51\u5173\u6765\u5c06\u5916\u90e8\u7684\u8c03\u7528\u8bf7\u6c42\u6d41\u91cf\u7edf\u4e00\u7ba1\u63a7\u3002\\n\\n\u540c\u65f6\uff0c\u5185\u90e8\u8fd8\u5b58\u5728\u4e00\u4e9b\u4e1a\u52a1\u7cfb\u7edf\uff0c\u672c\u8eab\u4f7f\u7528\u4e86\u84dd\u9cb8\u5e73\u53f0\u7684\u4e00\u4e9b\u57fa\u7840\u67b6\u6784\u80fd\u529b\uff0c\u5982\u5bb9\u5668\u7ba1\u7406\u6216\u76d1\u63a7\u7b49\uff0c\u5b83\u4eec\u4e5f\u9700\u8981\u4e00\u4e2a\u7edf\u4e00\u7684\u670d\u52a1\u7f51\u5173\u6765\u7ba1\u7406\u6240\u6709\u8c03\u7528\u6d41\u91cf\u3002\\n\\n\u9762\u5bf9\u5916\u90e8\u6280\u672f\u7684\u8d8b\u52bf\u4e0e\u5185\u90e8\u4e1a\u52a1\u7684\u53d1\u5c55\u8981\u6c42\uff0c\u84dd\u9cb8\u7684 API \u7f51\u5173\u9700\u8981\u652f\u6301\u7684\u573a\u666f\u5f00\u59cb\u53d8\u5f97\u8d8a\u6765\u8d8a\u591a\u6837\u5316\u3002\\n\\n### \u5f80\u671f\u8fed\u4ee3\\n\\n\u84dd\u9cb8 API \u7f51\u5173\u5230\u76ee\u524d\u4e3a\u6b62\u7ecf\u5386\u4e86\u4e09\u4e2a\u9636\u6bb5\u7684\u8fed\u4ee3\u3002\\n\\n\u84dd\u9cb8 API \u7f51\u5173\u7684 1.0 \u7248\u672c\uff0c\u4e3b\u8981\u662f\u8ba9\u539f\u5b50\u5e73\u53f0\u7684\u8c03\u7528\u65b9\uff08\u542b\u5404 SaaS \u548c\u6d41\u7a0b\u5f15\u64ce\uff09\u4e0d\u518d\u76f4\u63a5\u5bf9\u63a5\u5404\u4e2a\u539f\u5b50\u5e73\u53f0\uff0c\u800c\u662f\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528 API \u7f51\u5173\uff0c\u901a\u8fc7\u7f51\u5173\u5b8c\u6210\u534f\u8bae\u8f6c\u6362\u3001\u6743\u9650\u6821\u9a8c\u7b49\u76f8\u5173\u529f\u80fd\u3002\\n\\n![\u84dd\u9cb8 1.0 \u6d41\u7a0b\u56fe](https://static.apiseven.com/2022/11/14/6371a5df6be29.png)\\n\\n\u90a3\u65f6\u7684\u67b6\u6784\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u6574\u4f53\u5206\u4e3a\u4e24\u5927\u5757\uff1a\u670d\u52a1\u7aef\u548c\u7ba1\u7406\u7aef\u3002\u539f\u5b50\u5e73\u53f0\u9700\u8981\u628a\u81ea\u8eab\u670d\u52a1\u6ce8\u518c\u5230 API \u7f51\u5173\u4e0a\uff0c\u9996\u5148\u5f97\u8bbf\u95ee\u7ba1\u7406\u7aef\uff0c\u914d\u7f6e\u597d\u5e73\u53f0\u7684 API \u8d44\u6e90\u5730\u5740\u548c\u5404\u81ea\u5bf9\u5e94\u7684\u6743\u9650\u7b49\u7b49\u3002\\n\\n\u5f53\u539f\u5b50\u5e73\u53f0\u901a\u8fc7\u7ba1\u7406\u7aef\u63d0\u4f9b\u4e86\u7f51\u5173\u6240\u9700\u7684\u914d\u7f6e\u7ec6\u8282\u540e\uff0c\u6570\u636e\u4f1a\u88ab\u5199\u5165\u5230 MySQL \u4e2d\uff0c\u4f9b\u670d\u52a1\u7aef\u8bfb\u53d6\u3002\u4e4b\u540e\uff0c\u5f53 SaaS \u8bf7\u6c42\u67d0\u539f\u5b50\u5e73\u53f0\u7684 API \u65f6\uff0c\u9996\u5148\u7ecf\u8fc7\u524d\u7aef\u7684 NGINX \u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u7136\u540e\u900f\u5230\u7f51\u5173\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u8bfb\u53d6\u4e86\u76f8\u5173\u914d\u7f6e\u540e\uff0c\u518d\u5c06\u8bf7\u6c42\u901a\u8fc7\u8def\u7531\u8f6c\u53d1\u529f\u80fd\u4f20\u7ed9\u540e\u65b9\u7684\u5404\u539f\u5b50\u5e73\u53f0\uff0c\u5b8c\u6210\u6574\u5957\u8bf7\u6c42\u6d41\u7a0b\u3002\u4e3a\u4e86\u63d0\u5347\u6027\u80fd\uff0c\u8fd9\u5957\u67b6\u6784\u4e5f\u5f15\u5165\u4e86 Redis \u5904\u7406\u4e86\u4e00\u4e9b\u7f13\u5b58\u52a0\u901f\u7b49\u573a\u666f\u3002\\n\\n![1.0 \u67b6\u6784\u56fe](https://static.apiseven.com/2022/11/14/6371a5e2d5b46.png)\\n\\n1.0 \u7248\u672c\u7684\u67b6\u6784\u5728\u5185\u90e8\u8fd0\u884c\u4e86\u51e0\u5e74\u540e\uff0c\u968f\u7740\u8bf7\u6c42\u91cf\u7684\u589e\u957f\u548c\u573a\u666f\u7684\u590d\u6742\u5316\uff0c\u7f3a\u70b9\u5f00\u59cb\u9010\u6e10\u663e\u73b0\u51fa\u6765\u3002\u6bd4\u5982\uff1a\\n\\n* **\u6846\u67b6\u6027\u80fd\u4e0d\u4f73**\u3002\u5f53\u65f6\u5b9e\u73b0\u65f6\u9009\u62e9\u4e86 Django \u6846\u67b6\uff0c\u5b83\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u8868\u73b0\u4e00\u822c\uff0c\u5904\u7406\u6d77\u91cf\u8bf7\u6c42\u65f6\u6027\u80fd\u6349\u895f\u89c1\u8098\u3002\\n\\n* **\u8def\u7531\u5b9e\u73b0\u6027\u80fd\u4e00\u822c**\u3002API \u8def\u7531\u91c7\u7528\u7684\u7b97\u6cd5\u6027\u80fd\u8f83\u4f4e\uff0c\u5f71\u54cd\u5230\u8def\u7531\u7684\u5339\u914d\u548c\u8f6c\u53d1\u901f\u5ea6\u3002\\n\\n* **DB \u538b\u529b\u5927**\u3002\u8def\u7531\u7b56\u7565\u5168\u90e8\u5b58\u50a8\u5728 MySQL \u4e2d\uff0c\u89c4\u5219\u591a\u65f6\u9700\u627f\u8f7d\u5927\u91cf\u68c0\u7d22\u8bf7\u6c42\uff0c\u67e5\u8be2\u538b\u529b\u5927\u3002\\n\\n* **\u7f51\u7edc\u5f00\u9500\u5927**\u3002Redis \u5728\u591a\u79cd\u573a\u666f\u4e0b\u88ab\u9ad8\u5f3a\u5ea6\u4f7f\u7528\uff0c\u5bfc\u81f4\u7f51\u7edc\u5f00\u9500\u592a\u5927\u3002\\n\\n\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u6211\u4eec\u5728 1.0 \u7248\u672c\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u4e86\u8fed\u4ee3\uff0c\u8bbe\u8ba1\u5b9e\u73b0\u4e86 2.0 \u7248\u672c\u3002\u76f8\u6bd4\u524d\u4ee3\uff0c2.0 \u7248\u672c\u6700\u5927\u7684\u6539\u52a8\u5c31\u662f\u4f7f\u7528 Go \u8bed\u8a00\u91cd\u65b0\u5b9e\u73b0\u4e86\u7f51\u5173\u7684\u6846\u67b6\u548c\u8f6c\u53d1\u5c42\u3002\u56e0\u4e3a Go \u76f8\u6bd4 Python\uff0c\u5728\u5904\u7406\u5927\u5e76\u53d1\u8bf7\u6c42\u7684\u573a\u666f\u4e0b\u4f1a\u66f4\u6709\u4f18\u52bf\u3002\\n\\n![\u84dd\u9cb8 2.0 \u7f51\u5173\u67b6\u6784](https://static.apiseven.com/2022/11/14/6371a5e4de2e6.png)\\n\\n\u540c\u65f6\u8fd8\u8fdb\u884c\u4e86\u5176\u4ed6\u4f18\u5316\u53d8\u52a8\u3002\u6bd4\u5982\u5728\u5185\u5b58\u4e2d\u7ef4\u62a4\u4e86\u4e00\u4e2a\u66f4\u9ad8\u6548\u7684\u8def\u7531\u5b9e\u73b0\uff1b\u5728\u4e2d\u95f4\u5c42\u5f15\u5165\u4e86\u57fa\u4e8e\u5185\u5b58\u7684\u7f13\u5b58\uff0c\u4ee5\u51cf\u5c11\u5bf9 Redis \u7684\u4f9d\u8d56\u3002\u65b0\u67b6\u6784\u4e5f\u589e\u52a0\u4e86\u5bf9\u7f51\u5173\u591a\u7248\u672c\u548c\u591a\u73af\u5883\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\uff0c\u5f15\u5165\u6269\u5c55\u63d2\u4ef6\u673a\u5236\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\u901a\u8fc7\u63d2\u4ef6\u5bf9\u7f51\u5173\u80fd\u529b\u8fdb\u884c\u6269\u5c55\u3002\\n\\n\u603b\u4f53\u6765\u8bf4\uff0c2.0 \u7248\u672c\u89e3\u51b3\u4e86 1.0 \u7248\u672c\u4e2d\u9047\u5230\u7684\u6027\u80fd\u95ee\u9898\u548c\u5927\u90e8\u5206\u75db\u70b9\u3002\u4f46\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u65b0\u7684\u95ee\u9898\u4e5f\u5f00\u59cb\u6162\u6162\u6d6e\u51fa\u6c34\u9762\u3002\\n\\n### \u6280\u672f\u9009\u578b\\n\\n\u8fdb\u5165\u4e91\u539f\u751f\u65f6\u4ee3\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u7f51\u5173 2.0 \u7248\u672c\u5728\u4e00\u4e9b\u65b9\u9762\u6e10\u6e10\u65e0\u6cd5\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\uff0c\u4e3b\u8981\u7684\u95ee\u9898\u5305\u62ec\u4ee5\u4e0b\u51e0\u70b9\uff1a\\n\\n* **\u9694\u79bb\u6027\u4e0d\u8db3**\uff1a\u65e0\u6cd5\u5b9e\u73b0\u771f\u6b63\u7684\u7269\u7406\u9694\u79bb\uff1b\u53d1\u5e03\u8fc7\u7a0b\u4f1a\u5bfc\u81f4\u957f\u8fde\u63a5\u95ea\u65ad\u3002\\n\\n* **\u534f\u8bae\u652f\u6301\u5355\u4e00**\uff1a\u4ec5\u652f\u6301 HTTP\uff0c\u800c\u5b9e\u9645\u573a\u666f\u4e2d\u5bf9\u975e HTTP \u534f\u8bae\u7684\u9700\u6c42\u5728\u589e\u591a\u3002\\n\\n* **\u4e0d\u652f\u6301\u52a8\u6001\u8def\u7531\u89c4\u5219**\uff1a\u4e0d\u652f\u6301\u6309\u6761\u4ef6\u5339\u914d\u7684\u52a8\u6001\u8def\u7531\u89c4\u5219\uff1b\u5bf9\u7070\u5ea6\u53d1\u5e03\u573a\u666f\u4e0d\u591f\u53cb\u597d\uff1b\u7f3a\u4e4f\u573a\u666f\u5316\u7ec4\u5408\u5c01\u88c5\u7684\u80fd\u529b\u3002\\n\\n* **\u7f3a\u4e4f\u670d\u52a1\u53d1\u73b0\u80fd\u529b**\uff1a\u7f3a\u4e4f\u81ea\u52a8\u670d\u52a1\u53d1\u73b0\u80fd\u529b\uff0c\u5bf9\u5fae\u670d\u52a1\u67b6\u6784\u4e0d\u53cb\u597d\u3002\\n\\n\u7ed3\u5408\u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u6765\u8bf4\uff0c\u516c\u53f8\u5185\u90e8\u6709\u5f88\u591a\u4e1a\u52a1\u7cfb\u7edf\u90fd\u9700\u8981\u4f7f\u7528\u8fd9\u4e2a API \u7f51\u5173\uff0c\u5b83\u4eec\u5bf9\u7f51\u5173\u7684\u9700\u6c42\u867d\u7136\u5927\u90e8\u5206\u76f8\u4f3c\uff0c\u4f46\u7ec6\u5fae\u5904\u5176\u5b9e\u53c8\u5404\u6709\u5dee\u5f02\u3002\u5047\u5982\u628a\u5bf9\u7f51\u5173\u7684\u6240\u6709\u591a\u6837\u5316\u9700\u6c42\u90fd\u6574\u5408\u5728\u540c\u4e00\u5957\u7f51\u5173\u4e2d\uff0c\u96be\u5ea6\u5f88\u5927\u3002\\n\\n\u56e0\u6b64\uff0c\u6211\u4eec\u6709\u4e86\u8bbe\u8ba1\u5206\u5e03\u5f0f\u7f51\u5173\u7684\u60f3\u6cd5\u3002\u5373\u628a\u4e00\u4e2a\u5927\u7f51\u5173\u62c6\u5206\u6210\u8bb8\u591a\u4e2a\u5fae\u7f51\u5173\uff0c\u5229\u7528\u8fd9\u4e9b\u5fae\u7f51\u5173\u53bb\u5e73\u8861\u4e0d\u540c\u4e1a\u52a1\u7cfb\u7edf\u5bf9\u7f51\u5173\u7684\u9700\u6c42\u5dee\u5f02\u3002\\n\\n![\u5206\u5e03\u5f0f\u7f51\u5173](https://static.apiseven.com/2022/11/14/6371a5e5d1c50.png)\\n\\n\u5206\u5e03\u5f0f\u7f51\u5173\u67b6\u6784\u7684\u7ec4\u4ef6\u4e3b\u8981\u5206\u4e3a\u4e24\u7c7b\uff1a\u7ba1\u7406\u7aef\u548c\u5fae\u7f51\u5173\u5b9e\u4f8b\u3002\u7ba1\u7406\u7aef\u7edf\u4e00\u7ba1\u63a7\u7740\u5404\u4e2a\u5fae\u7f51\u5173\uff0c\u7531\u5404\u7f51\u5173\u7684\u7ba1\u7406\u5458\u5bf9\u7f51\u5173\u8fdb\u884c\u914d\u7f6e\u548c\u7ba1\u7406\u3002\u5fae\u7f51\u5173\u5b9e\u4f8b\u662f\u72ec\u7acb\u90e8\u7f72\u7684\u5404\u4e2a\u7f51\u5173\u670d\u52a1\uff0c\u5404\u81ea\u72ec\u7acb\u627f\u62c5\u7279\u5b9a\u7684\u67d0\u4e00\u7ec4\u670d\u52a1\u7684\u8bbf\u95ee\u6d41\u91cf\uff0c\u6839\u636e\u7ba1\u7406\u7aef\u7684\u8bbe\u5b9a\u8fdb\u884c\u76f8\u5173\u8bbf\u95ee\u63a7\u5236\u3002\u6240\u6709\u5fae\u7f51\u5173\u5b9e\u4f8b\u7531\u540c\u4e00\u5957\u7ba1\u7406\u7aef\u7ba1\u63a7\u3002\\n\\n\u5728\u5fae\u7f51\u5173\u7684\u6280\u672f\u9009\u578b\u65b9\u9762\uff0c\u6211\u4eec\u5f53\u65f6\u53c2\u8003\u4e86\u5e02\u9762\u4e0a\u6bd4\u8f83\u6d41\u884c\u7684\u591a\u4e2a\u7f51\u5173\u5f00\u6e90\u4ea7\u54c1\uff0c\u4ece\u6d41\u884c\u5ea6\u3001\u6280\u672f\u6808\u3001\u534f\u8bae\u652f\u6301\u7b49\u5404\u4e2a\u5c42\u9762\u5bf9\u6bd4\u540e\uff0c\u6700\u7ec8\u9009\u62e9\u4e86\u4f7f\u7528 APISIX \u4f5c\u4e3a\u5fae\u7f51\u5173\u6700\u91cd\u8981\u7684\u540e\u7aef\u6280\u672f\u3002\\n\\n![\u5404\u7f51\u5173\u5bf9\u6bd4\u7ec6\u8282](https://static.apiseven.com/2022/11/14/6371a5e867133.png)\\n\\n\u4e4b\u6240\u4ee5\u9009\u62e9 APISIX\uff0c\u662f\u56e0\u4e3a\u5b83\u662f\u57fa\u4e8e NGINX+Lua \u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6574\u4f53\u6027\u80fd\u76f8\u6bd4 Go \u800c\u8a00\u662f\u6709\u4f18\u52bf\u7684\u3002\u540c\u65f6 APISIX \u7684\u6269\u5c55\u6027\u975e\u5e38\u597d\uff0c\u8fd8\u652f\u6301\u901a\u8fc7\u591a\u8bed\u8a00\u63d2\u4ef6\u53bb\u6269\u5c55\u80fd\u529b\uff0c\u5728\u5f53\u65f6\u4e5f\u6709\u975e\u5e38\u591a\u7684\u6210\u719f\u7684\u7528\u6237\u6848\u4f8b\u3002\\n\\n\u4e0d\u8fc7\uff0cAPISIX \u5728\u5f53\u65f6\u5bf9\u4e8e\u6211\u4eec\u7684\u5185\u90e8\u4f7f\u7528\u573a\u666f\u6765\u8bf4\uff0c\u8fd8\u662f\u5b58\u5728\u4e00\u4e9b\u4e0d\u8db3\u7684\u3002\u6bd4\u5982\u5b83\u7684\u63a7\u5236\u9762\u80fd\u529b\u6709\u4e9b\u7f3a\u4e4f\uff0c\u63a7\u5236\u9762\u677f\u6bd4\u8f83\u7b80\u964b\u3002\u56e0\u6b64\u5728 APISIX \u7684\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u6309\u7167\u5185\u90e8\u9700\u6c42\u53bb\u5b9e\u73b0\u5b9a\u5236\u4e86 APISIX \u7684\u63a7\u5236\u9762\u3002\\n\\n## \u57fa\u4e8e APISIX \u7684\u84dd\u9cb8\u7f51\u5173 3.0 \u8fed\u4ee3\\n\\n\u4e91\u539f\u751f\u73af\u5883\u4e0b\uff0cK8s \u5c31\u662f\u6211\u4eec\u9700\u8981\u5173\u6ce8\u7684\u6700\u91cd\u8981\u7684\u57fa\u7840\u7ec4\u4ef6\u3002\u56e0\u4e3a\u6574\u4e2a\u5fae\u7f51\u5173\u90fd\u662f\u9762\u5411\u4e91\u539f\u751f\u8bbe\u8ba1\uff0c\u6240\u4ee5 3.0 \u7248\u672c\u7684\u7f51\u5173\u5c31\u57fa\u4e8e K8s \u8fdb\u884c\u4e86\u65b0\u7684\u67b6\u6784\u8bbe\u8ba1\u3002\\n\\n\u5176\u4e2d\u6700\u6838\u5fc3\u7684\u90e8\u5206\uff0c\u5c31\u662f\u4f7f\u7528 K8s \u63d0\u4f9b\u7684 CRD \u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u5b9e\u73b0\u4e86\u5bf9\u7f51\u5173\u7684\u6574\u5957\u64cd\u4f5c\u548c\u6269\u5c55\u3002\\n\\n![\u57fa\u4e8e APISIX \u7684\u67b6\u6784\u8c03\u6574](https://static.apiseven.com/2022/11/14/6371a5ece0ea6.png)\\n\\n\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u7f51\u5173\u5f15\u5165\u4e86\u4e00\u6574\u5957 K8s \u7684 CRD \u8d44\u6e90\u5b9a\u4e49\uff0c\u5305\u62ec\uff1aBkGatewayStage\uff08\u7f51\u5173\u73af\u5883\uff09\u3001BkGatewayService\uff08\u540e\u7aef\u670d\u52a1\uff09\u7b49\u3002\u901a\u8fc7\u8fd9\u4e9b CRD\uff0c\u6211\u4eec\u5f97\u4ee5\u63a7\u5236\u6bcf\u4e2a\u5fae\u7f51\u5173\u5b9e\u4f8b\u7684\u5177\u4f53\u884c\u4e3a\u3002\\n\\n\u56fe\u4e2d\u7684\u51e0\u4e2a\u201cOperator\u201d\u662f\u8fd9\u5957\u67b6\u6784\u4e2d\u6700\u6838\u5fc3\u7684\u90e8\u5206\u3002\u4e0a\u65b9\u662f Plugin Operators \u670d\u52a1\uff0c\u91cc\u9762\u5305\u542b\u4e00\u7cfb\u5217\u7684\u63d2\u4ef6 Operator\u3002\u6bd4\u5982\u8d1f\u8d23\u670d\u52a1\u53d1\u73b0\u7684 Operator\uff0c\u4f1a\u5c06\u540e\u7aef\u670d\u52a1\u6ce8\u518c\u5728\u670d\u52a1\u53d1\u73b0\u4e2d\u5fc3\u7684\u5730\u5740\u5199\u5165\u5230 K8s \u96c6\u7fa4\u4e2d\u3002\\n\\n\u4e2d\u95f4\u7684\u6838\u5fc3 Operator \u76d1\u542c\u7740\u6240\u6709\u548c\u7f51\u5173\u76f8\u5173\u7684 CRD \u8d44\u6e90\u3002\u5176\u4e2d\u7684\u8d44\u6e90\u8c03\u548c\u5668\uff08reconciler\uff09\uff0c\u8d1f\u8d23\u5c06\u8bfb\u53d6\u5230\u7684\u7f51\u5173\u914d\u7f6e\u8f6c\u6362\u6210 APISIX \u5fae\u7f51\u5173\u5b9e\u4f8b\u80fd\u7406\u89e3\u7684\u683c\u5f0f\uff0c\u4ece\u800c\u5b9e\u73b0\u5fae\u7f51\u5173\u7684\u5168\u5957\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002\\n\\n\u76ee\u524d\uff0c\u8fd9\u5957\u5fae\u7f51\u5173\u4e3b\u8981\u5206\u4e3a\u4e24\u79cd\u90e8\u7f72\u7c7b\u578b\uff1a\\n\\n1. \u5171\u4eab\u7f51\u5173\uff1a\u9ed8\u8ba4\u7c7b\u578b\uff0c\u5e73\u53f0\u7edf\u4e00\u90e8\u7f72\uff0c\u7531\u5e73\u53f0\u7edf\u4e00\u751f\u6210\u4e0e\u7ba1\u7406 API \u8bbf\u95ee\u5730\u5740\uff1b\\n\\n2. \u4e13\u4eab\u7f51\u5173\uff1a\u4f7f\u7528\u65b9\u81ea\u884c\u90e8\u7f72\u201c\u5fae\u7f51\u5173\u201d\u5b9e\u4f8b\uff0c\u63a5\u5165\u5e73\u53f0\u540e\u53d8\u4e3a\u201c\u4e13\u4eab\u7f51\u5173\u201d\uff0c\u9700\u624b\u52a8\u7ba1\u7406 API \u8bbf\u95ee\u5730\u5740\uff0c\u6d41\u91cf\u76f4\u63a5\u4ece\u201c\u4e13\u4eab\u7f51\u5173\u201d\u6d41\u5165\u540e\u7aef\u670d\u52a1\u3002\\n\\n![\u5171\u4eab\u7f51\u5173\u4e0e\u4e13\u4eab\u7f51\u5173](https://static.apiseven.com/2022/11/14/6371a5e9f0e9a.png)\\n\\n\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u7ba1\u7406\u7aef\u7edf\u4e00\u53ea\u6709\u4e00\u5957\uff0c\u56e0\u6b64\u5b83\u7684\u80fd\u529b\u5e76\u4e0d\u63d0\u4f9b\u4efb\u4f55\u5dee\u5f02\u5316\uff0c\u50cf\u591a\u73af\u5883\u7ba1\u7406\u3001\u6743\u9650\u7ba1\u7406\u7b49\u529f\u80fd\u90fd\u662f\u6240\u6709\u7f51\u5173\u5171\u6709\u3002\u4f46\u5728\u5b83\u6240\u7ba1\u7406\u7684\u4e0d\u540c\u7c7b\u578b\u7684\u5fae\u7f51\u5173\u5b9e\u4f8b\u4e2d\uff0c\u6240\u652f\u6301\u7684\u7279\u6027\u96c6\u5c31\u4f1a\u4e92\u6709\u5dee\u5f02\u3002\\n\\n\u62ff\u5171\u4eab\u7f51\u5173\u5b9e\u4f8b\u6765\u8bf4\uff0c\u5b83\u6240\u652f\u6301\u7684\u7279\u6027\u96c6\u662f\u6bd4\u8f83\u57fa\u7840\u7684\u3002\u4e3b\u8981\u5305\u542b\u7edf\u4e00\u7684\u767b\u5f55\u9274\u6743\u3001\u9650\u6d41\u7194\u65ad\u548c\u591a\u534f\u8bae\u652f\u6301\u7b49\u3002\u800c\u5230\u4e86\u6bcf\u4e2a\u4e1a\u52a1\u72ec\u7acb\u7684\u4e13\u4eab\u7f51\u5173\u5b9e\u4f8b\uff0c\u5c31\u53ef\u4ee5\u62e5\u6709\u4e00\u4e9b\u4e0d\u4e00\u6837\u7684\u4e2a\u6027\u5316\u80fd\u529b\u3002\u56e0\u4e3a\u4e13\u4eab\u7f51\u5173\u548c\u4e1a\u52a1\u540c\u5c5e\u4e00\u4e2a\u96c6\u7fa4\uff0c\u6240\u4ee5\u5b83\u53ef\u8f7b\u677e\u5b9e\u73b0\u52a8\u6001\u8def\u7531\u3001\u81ea\u5b9a\u4e49\u670d\u52a1\u53d1\u73b0\u7b49\u80fd\u529b\uff0c\u4e5f\u5229\u7528 APISIX \u7684\u5f3a\u62d3\u5c55\u6027\u53bb\u81ea\u5b9a\u4e49\u66f4\u591a\u80fd\u529b\u3002\\n\\n\u57fa\u4e8e\u8fd9\u5957\u67b6\u6784\u548c\u6a21\u5f0f\uff0c\u84dd\u9cb8 API \u7f51\u5173 3.0 \u7248\u672c\u5728 APISIX \u80fd\u529b\u7684\u52a0\u6301\u4e0b\uff0c\u63d0\u4f9b\u4e86\u66f4\u52a0\u4e30\u5bcc\u7684\u529f\u80fd\u3002\\n\\n![\u84dd\u9cb8\u7f51\u5173 3.0 \u529f\u80fd](https://static.apiseven.com/2022/11/14/6371a5d86f604.png)\\n\\n## \u57fa\u4e8e APISIX \u84dd\u9cb8\u7f51\u5173 3.0 \u5b9e\u8df5\u573a\u666f\\n\\n### \u670d\u52a1\u53d1\u73b0\\n\\n\u670d\u52a1\u53d1\u73b0\u662f\u5fae\u670d\u52a1\u67b6\u6784\u6240\u9700\u7684\u4e00\u4e2a\u57fa\u672c\u80fd\u529b\uff0c\u5728\u5185\u90e8\uff0c\u6211\u4eec\u4e3b\u8981\u901a\u8fc7\u81ea\u5b9a\u4e49\u8d44\u6e90 CRD \u53bb\u5b9e\u73b0\u3002\u4e00\u4efd\u6709\u6548\u7684\u670d\u52a1\u53d1\u73b0 YAML \u5b9a\u4e49\u5982\u4e0b\u56fe\u53f3\u4fa7\u4ee3\u7801\u6240\u793a\u3002\\n\\n![\u670d\u52a1\u53d1\u73b0\u5b9e\u8df5](https://static.apiseven.com/2022/11/14/6371a5d9e162f.png)\\n\\n\u5c06\u4e0a\u8ff0 CRD \u8d44\u6e90\u5199\u5165 K8s \u96c6\u7fa4\u540e\uff0c\u5c31\u4f1a\u89e6\u53d1\u670d\u52a1\u53d1\u73b0\u76f8\u5173\u7684\u63a7\u5236\u5668\u7684\u76f8\u5173\u52a8\u4f5c\u3002\u4e4b\u540e\u8c03\u548c\u5668\uff08Reconciler\uff09\u4f1a\u6355\u83b7\u5230\u5bf9\u5e94\u7684\u670d\u52a1\u53d1\u73b0\u914d\u7f6e\uff0c\u521b\u5efa\u670d\u52a1\u53d1\u73b0\u76f8\u5173\u7684\u7a0b\u5e8f\u5bf9\u8c61\u3002\\n\\n\u7136\u540e\u5b83\u4f1a\u901a\u8fc7\u5185\u7f6e\u7684\u670d\u52a1\u53d1\u73b0\u63a5\u53e3\uff08\u5305\u542b Watcher\u3001Lister\uff09\u8bfb\u53d6\u670d\u52a1\u53d1\u73b0\u4e2d\u5fc3\u7684\u76f8\u5173\u5730\u5740\u4fe1\u606f\uff0c\u5c06\u83b7\u53d6\u5230\u7684\u5730\u5740\u901a\u8fc7 BkGatewayEndpoints \u8fd9\u4e2a CRD \u8d44\u6e90\u91cd\u65b0\u5199\u56de\u5230 K8s \u96c6\u7fa4\u5185\u3002\u518d\u7ecf\u7531\u53f3\u4fa7\u7684\u6838\u5fc3 Operator \u8fdb\u884c\u4e00\u4e9b\u590d\u6742\u5904\u7406\u540e\uff0c\u8fd9\u4e9b endpoints \u6700\u7ec8\u88ab\u540c\u6b65\u5230 APISIX \u5bf9\u5e94\u7684\u4e0a\u6e38\u4e2d\uff0c\u4e00\u6b21\u5b8c\u6574\u7684\u670d\u52a1\u53d1\u73b0\u6d41\u7a0b\u5c31\u6b64\u5b8c\u6210\u3002\\n\\n\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\uff0c\u6211\u4eec\u5b9e\u73b0\u4e86\u4e00\u4e2a\u901a\u7528\u7684\u670d\u52a1\u53d1\u73b0\u6846\u67b6\u3002\u5b83\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u5f00\u53d1\u63a5\u53e3\u548c\u89c4\u8303\uff0c\u4f7f\u7528\u5b83\u53ef\u4ee5\u4f4e\u6210\u672c\u5730\u652f\u6301\u5176\u4ed6\u7c7b\u578b\u7684\u670d\u52a1\u53d1\u73b0\u573a\u666f\u3002\\n\\n### \u7edf\u4e00\u8ba4\u8bc1\u6388\u6743\\n\\n\u7edf\u4e00\u8ba4\u8bc1\u90e8\u5206\u6bd4\u8f83\u7b80\u5355\u3002\u5728\u4e1a\u52a1\u5b9e\u8df5\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u652f\u6301\u6765\u81ea\u4e09\u79cd\u4e0d\u540c\u6765\u6e90\u7684\u8bf7\u6c42\uff0c\u5206\u522b\u662f\u6d4f\u89c8\u5668\u3001\u5e73\u53f0\u548c\u4e2a\u4eba\u7528\u6237\u3002\u6211\u4eec\u57fa\u4e8e APISIX \u5b9e\u73b0\u4e86\u4e00\u4e2a\u8ba4\u8bc1\u63d2\u4ef6\uff0c\u6765\u5b9e\u73b0\u7edf\u4e00\u8ba4\u8bc1\u3002\\n\\n![\u8ba4\u8bc1\u6d41\u7a0b\u56fe](https://static.apiseven.com/2022/11/14/6371a5db4d0ac.png)\\n\\n\u5177\u4f53\u5b9e\u73b0\u6d41\u7a0b\u5982\u4e0a\u56fe\u6240\u793a\u3002\u8bf7\u6c42\u8fdb\u6765\u540e\uff0c\u63d2\u4ef6\u4f1a\u4ece Header \u4e2d\u8bfb\u53d6\u76f8\u5173\u7684\u51ed\u636e\u4fe1\u606f\uff0c\u7136\u540e\u7edf\u4e00\u8c03\u7528 BK-Auth \u8ba4\u8bc1\u670d\u52a1\u53bb\u6821\u9a8c\u8be5\u51ed\u636e\uff0c\u5e76\u8bfb\u53d6\u5bf9\u5e94\u7684 SaaS \u4fe1\u606f\u3002\u4e4b\u540e\u518d\u7528\u548c\u540e\u7aef\u7ea6\u5b9a\u597d\u7684\u79c1\u94a5\uff0c\u7b7e\u53d1\u4e00\u4e2a JWT token \u5e76\u5c06\u5176\u5199\u5165\u8bf7\u6c42\u5934\u4e2d\uff0c\u6700\u540e\u5199\u5165 APISIX \u53d8\u91cf\u3002\\n\\n\u9664\u7edf\u4e00\u8ba4\u8bc1\u5916\uff0c\u5185\u90e8\u4e1a\u52a1\u4e2d\u4e5f\u5b58\u5728\u4e00\u4e9b\u590d\u6742\u7684\u9274\u6743\u573a\u666f\u3002\u5176\u4e3b\u8981\u89e3\u51b3\u7684\u95ee\u9898\u662f\uff0c\u5f53\u4e00\u4e2a SaaS \u8c03\u7528\u67d0\u539f\u5b50\u5e73\u53f0\u7684\u67d0\u4e2a\u8d44\u6e90\u65f6\uff0c\u5224\u65ad\u8be5 SaaS \u6709\u6ca1\u6709\u8fd9\u4e2a\u6743\u9650\u3002\u76ee\u524d\u7edf\u4e00\u7684\u8d44\u6e90\u9274\u6743\u4e5f\u662f\u901a\u8fc7 APISIX \u63d2\u4ef6\u5b9e\u73b0\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e86 Go \u8bed\u8a00\u5b9e\u73b0\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![\u9274\u6743\u6d41\u7a0b\u56fe](https://static.apiseven.com/2022/11/14/6371a5e095f79.png)\\n\\n\u5f53\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u8fc7\u6765\u540e\uff0c\u4f1a\u9996\u5148\u7ecf\u8fc7\u8ba4\u8bc1\u73af\u8282\u62ff\u5230 SaaS \u5e94\u7528\u4fe1\u606f\u3002\u7136\u540e\u7ecf\u8fc7 ext-plugin \u5904\uff0c\u57fa\u4e8e RPC \u4e0e\u9274\u6743\u63d2\u4ef6\u8fdb\u884c\u4ea4\u4e92\u3002\u6b64\u65f6\u9274\u6743\u63d2\u4ef6\u4f1a\u76f4\u63a5\u53bb\u67e5\u8be2\u7f13\u5b58\u4e2d\u7684\u9274\u6743\u76f8\u5173\u6570\u636e\uff08\u901a\u8fc7\u5168\u91cf\u548c\u589e\u91cf\u673a\u5236\u7531\u7ba1\u7406\u7aef\u540c\u6b65\uff09\uff0c\u4e4b\u540e\u5b8c\u6210\u9274\u6743\u3002\\n\\n### \u52a8\u6001\u8def\u7531\\n\\n![\u52a8\u6001\u8def\u7531](https://static.apiseven.com/2022/11/14/6371a5e3d1788.png)\\n\\n\u6bd4\u8f83\u5178\u578b\u7684\u52a8\u6001\u8def\u7531\u5e94\u7528\u573a\u666f\u6765\u81ea\u84dd\u9cb8\u7684\u5bb9\u5668\u7ba1\u7406\u5e73\u53f0\u3002\u84dd\u9cb8\u5bb9\u5668\u5e73\u53f0\u7ba1\u7406\u7740\u975e\u5e38\u591a\u7684 K8s \u96c6\u7fa4\uff0c\u6709\u4e00\u4e9b\u662f\u4e1a\u52a1\u7684\u670d\u52a1\u96c6\u7fa4\uff0c\u6709\u4e00\u4e9b\u662f\u4e1a\u52a1\u7684\u6570\u636e\u96c6\u7fa4\u3002\\n\\n\u4f5c\u4e3a\u7528\u6237\uff0c\u5e38\u5e38\u9700\u8981\u8bf7\u6c42\u8fd9\u4e9b\u96c6\u7fa4\u7684 APIServer \u53bb\u5b8c\u6210\u4e00\u4e9b\u4e8b\u60c5\u3002\u5f53\u7528\u6237\u8bf7\u6c42\u8fdb\u5165\u5230\u5fae\u7f51\u5173\u65f6\uff0c\u7f51\u5173\u9700\u8981\u6839\u636e\u8bf7\u6c42\u8def\u5f84\uff0c\u5224\u65ad\u8be5\u5c06\u5176\u8f6c\u53d1\u5230\u54ea\u4e2a\u96c6\u7fa4\u7684 APIServer \u4e2d\u3002\u5177\u4f53\u5b9e\u73b0\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![\u52a8\u6001\u8def\u7531\u6d41\u7a0b\u56fe](https://static.apiseven.com/2022/11/14/6371a5e6c758c.png)\\n\\n\u8bf7\u6c42\u8fdb\u5165\u540e\uff0c\u52a8\u6001\u8def\u7531\u63d2\u4ef6\u9996\u5148\u63d0\u53d6\u51fa\u96c6\u7fa4\u7684 ID \u4fe1\u606f\uff0c\u7136\u540e\u5bf9\u8def\u7531\u8fdb\u884c\u91cd\u5199\uff0c\u4e4b\u540e\u5224\u65ad\u8be5\u96c6\u7fa4\u662f\u5426\u4e3a\u76f4\u8fde\u96c6\u7fa4\u3002\\n\\n\u5bf9\u4e8e\u975e\u76f4\u8fde\u96c6\u7fa4\uff0c\u9996\u5148\u4f1a\u751f\u6210\u4e00\u4e2a BCS \u96c6\u7fa4\u7ba1\u7406\u5668\u4e0a\u6e38\uff0c\u7136\u540e\u501f\u5176\u548c BCS Agent \u8fdb\u884c\u4ea4\u4e92\uff0c\u6700\u540e\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u96c6\u7fa4\u7684 APIServer\u3002\\n\\n\u5bf9\u4e8e\u76f4\u8fde\u7684\u96c6\u7fa4\uff0c\u6d41\u7a0b\u5219\u7c7b\u4f3c\u4e8e\u524d\u6587\u7684\u7edf\u4e00\u9274\u6743\u63d2\u4ef6\uff0c\u63d2\u4ef6\u4f1a\u5b9a\u671f\u540c\u6b65\u4e00\u4e9b\u4e0e\u96c6\u7fa4\u76f8\u5173\u7684\u57fa\u672c\u4fe1\u606f\u3002\u627e\u5230\u96c6\u7fa4\u4fe1\u606f\u540e\u751f\u6210\u76f8\u5173\u4e0a\u6e38\uff0c\u518d\u901a\u8fc7 APISIX \u63d2\u4ef6\u53bb\u91cd\u5b9a\u4e49\u8fde\u63a5\u903b\u8f91\uff0c\u6700\u540e\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u96c6\u7fa4 APIServer\u3002\\n\\n### \u5ba2\u6237\u7aef\u8bc1\u4e66\u7ba1\u7406\\n\\n\u5728\u6211\u4eec\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u6709\u4e00\u7c7b\u539f\u5b50\u7cfb\u7edf\u5728\u5c06\u8d44\u6e90\u6ce8\u518c\u5230\u7f51\u5173\u65f6\uff0c\u4f7f\u7528\u7684\u662f\u6bd4\u8f83\u590d\u6742\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u9a8c\u8bc1\u6a21\u5f0f\u3002\u56e0\u6b64\uff0c\u5982\u679c\u67d0\u4e2a\u7528\u6237\u8981\u8bf7\u6c42\u5b83\u7684\u8d44\u6e90\uff0c\u5c31\u5fc5\u987b\u63d0\u4f9b\u4e00\u4efd\u6709\u6548\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002\\n\\n![\u8bc1\u4e66\u7ba1\u7406\u6d41\u7a0b\u56fe](https://static.apiseven.com/2022/11/14/6371a5eb39d81.png)\\n\\n\u5177\u4f53\u5b9e\u73b0\u5982\u4e0a\u56fe\u6240\u793a\u3002\u5bf9\u4e8e\u7f51\u5173\u7ba1\u7406\u8005\uff0c\u9996\u5148\u8981\u5728\u7ba1\u7406\u7aef\u914d\u7f6e\u597d\u7f51\u5173\u5728\u4e0d\u540c\u73af\u5883\u4e2d\u4f7f\u7528\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u8bc1\u4e66\u4f1a\u88ab\u53d1\u5e03\u5230\u5bf9\u5e94\u7684\u5fae\u7f51\u5173\u6240\u5728\u7684 K8s \u96c6\u7fa4\u4e2d\u3002\\n\\n\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u4f7f\u7528\u4e00\u4e9b CRD \u8d44\u6e90\u548c K8s \u5b98\u65b9\u7684 Secret \u8d44\u6e90\uff0c\u5e76\u7531\u6838\u5fc3\u7684 Operator \u670d\u52a1\u8fdb\u884c\u6301\u7eed\u5730\u8c03\u548c\u5904\u7406\uff0c\u6bd4\u5982\u6839\u636e\u57df\u540d\u5bfb\u627e\u5bf9\u5e94\u8bc1\u4e66\u7b49\u3002\u6709\u6548\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u914d\u7f6e\uff0c\u6700\u7ec8\u4f1a\u4f53\u73b0\u5728 APISIX Service \u7684\u76f8\u5173\u914d\u7f6e\u4e2d\uff08\u5982\u4e0a\u56fe\u53f3\u4e0a\u65b9\u4ee3\u7801\u7ea2\u6846\u5904\uff09\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4ece\u84dd\u9cb8 API \u7f51\u5173\u7684\u8bde\u751f\u80cc\u666f\u4e0e\u8fed\u4ee3\u8fc7\u7a0b\u5165\u624b\uff0c\u4e3a\u5927\u5bb6\u5448\u73b0\u4e86\u4e00\u4e2a API \u7f51\u5173\u4ea7\u54c1\u7684\u4ece 0 \u5230 1 \u7684\u63a2\u7d22\u8fc7\u7a0b\u3002\u4e5f\u5e26\u6765\u4e86\u9009\u62e9 APISIX \u8fdb\u884c\u7f51\u5173\u4ea7\u54c1\u8fed\u4ee3\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e9b\u4e1a\u52a1\u5b9e\u8df5\u573a\u666f\u7684\u7ec6\u8282\u5206\u4eab\u3002\u5e0c\u671b\u5bf9\u4e8e\u60f3\u8981\u4f7f\u7528 APISIX \u8fdb\u884c\u7f51\u5173\u8fed\u4ee3\u7684\u4f01\u4e1a\u6709\u4e00\u4e9b\u5efa\u8bbe\u6027\u7684\u542f\u53d1\u3002"},{"id":"\u5f53 Amazon Lambda \u9047\u4e0a Apache APISIX \u53ef\u4ee5\u64e6\u51fa\u4ec0\u4e48\u706b\u82b1\uff1f","metadata":{"permalink":"/zh/blog/2022/11/04/why-do-you-need-apache-apisix-when-using-amazon-lambda","source":"@site/blog/2022/11/04/why-do-you-need-apache-apisix-when-using-amazon-lambda.md","title":"\u5f53 Amazon Lambda \u9047\u4e0a Apache APISIX \u53ef\u4ee5\u64e6\u51fa\u4ec0\u4e48\u706b\u82b1\uff1f","description":"\u672c\u6587\u9996\u5148\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f Serverless\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u9700\u8981 Serverless\uff1b\u5176\u6b21\uff0c\u8bb2\u8ff0\u4e86\u4e00\u4e2a\u597d\u7684\u7f51\u5173\u5728 Serverless \u67b6\u6784\u4e0b\u7684\u91cd\u8981\u6027\uff0c\u800c APISIX \u5c31\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u7f51\u5173\uff1b\u6700\u540e\uff0c\u672c\u6587\u91cd\u70b9\u4ecb\u7ecd\u4e86 APISIX \u4e2d\u7684 Serverless \u7c7b\u578b\u7684\u63d2\u4ef6 aws-lambda\uff0c\u540c\u65f6\u5217\u4e3e\u4e86 Apache APISIX \u5176\u5b83 Serverless \u76f8\u5173\u63d2\u4ef6\u3002","date":"2022-11-04T00:00:00.000Z","formattedDate":"2022\u5e7411\u67084\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":9.63,"truncated":true,"authors":[{"name":"\u7a0b\u5c0f\u5170","title":"Author","url":"https://github.com/Hazel6869","image_url":"https://github.com/Hazel6869.png","imageURL":"https://github.com/Hazel6869.png"}],"prevItem":{"title":"\u817e\u8baf\u84dd\u9cb8 API \u7f51\u5173\u5982\u4f55\u501f\u52a9 APISIX \u5b9e\u73b0\u4ea7\u54c1\u5347\u7ea7\u4e0e\u4e1a\u52a1\u5b8c\u5584","permalink":"/zh/blog/2022/11/05/tencent-blueking-with-apisix"},"nextItem":{"title":"\u4ece Traefik \u5230 APISIX\uff0c\u6c7d\u8f66\u667a\u80fd\u8ba1\u7b97\u5e73\u53f0\u516c\u53f8\u300c\u5730\u5e73\u7ebf\u300d\u5728 Ingress Controller \u7684\u63a2\u7d22\u548c\u5b9e\u8df5","permalink":"/zh/blog/2022/10/28/apisix-ingress-with-horizon-ai"}},"content":"> \u672c\u6587\u9996\u5148\u4ecb\u7ecd\u4e86\u4ec0\u4e48\u662f Serverless\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u9700\u8981 Serverless\uff1b\u5176\u6b21\uff0c\u8bb2\u8ff0\u4e86\u4e00\u4e2a\u597d\u7684\u7f51\u5173\u5728 Serverless \u67b6\u6784\u4e0b\u7684\u91cd\u8981\u6027\uff0c\u800c APISIX \u5c31\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u7f51\u5173\uff1b\u6700\u540e\uff0c\u672c\u6587\u91cd\u70b9\u4ecb\u7ecd\u4e86 APISIX \u4e2d\u7684 Serverless \u7c7b\u578b\u7684\u63d2\u4ef6 `aws-lambda`\uff0c\u540c\u65f6\u5217\u4e3e\u4e86 Apache APISIX \u5176\u5b83 Serverless \u76f8\u5173\u63d2\u4ef6\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005[\u7a0b\u5c0f\u5170](https://github.com/Hazel6869)\uff0cAPI7.ai \u6280\u672f\u5de5\u7a0b\u5e08\uff0cApache APISIX Contributor\u3002\\n\\n## Serverless \u548c Amazon Lambda\\n\\n### \u4ec0\u4e48\u662f Serverless\uff1f\\n\\nServerless \u7684\u57fa\u7840\u6982\u5ff5\u662f\u5c06\u8fd0\u884c\u670d\u52a1\u6240\u9700\u7684\u57fa\u7840\u8bbe\u65bd\u4ea4\u7531\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u7ba1\u7406\uff0c\u4ee5\u53ca\u4e00\u4e9b\u81ea\u90e8\u7f72\u7684 Serverless \u5e73\u53f0\uff0c\u4ece\u800c\u8ba9\u4f7f\u7528 Serverless \u7684\u5de5\u7a0b\u5e08\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u9762\u5411\u5ba2\u6237\u4e1a\u52a1\u5e94\u7528\u5c42\u7684\u5f00\u53d1\uff0c\u800c\u4e0d\u9700\u8981\u5728\u57fa\u7840\u8bbe\u65bd\u7684\u6784\u5efa\u3001\u7ba1\u7406\u3001\u6269\u5bb9\u7b49\u4efb\u52a1\u4e0a\u6295\u5165\u8fc7\u591a\u7cbe\u529b\u3002\u5f88\u591a\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u4e5f\u5728\u63a8\u51fa Serverless \u76f8\u5173\u7684\u4ea7\u54c1\uff0cAmazon Serverless \u7684\u6838\u5fc3\u662f\u540d\u4e3a [Amazon Lambda](https://aws.amazon.com/lambda) \u7684\u8ba1\u7b97\u670d\u52a1\u3002\\n\\n\u5982\u56fe 1 \u6240\u793a\uff0c\u548c\u4f20\u7edf\u7684\u5f00\u53d1\u3001\u7f16\u8bd1\u3001\u90e8\u7f72\u8fd0\u884c\u65b9\u5f0f\u4e0d\u540c\uff0c\u4f7f\u7528 Amazon Serverless \u8ba1\u7b97\u670d\u52a1 Lambda\uff0c\u4ec5\u9700\u8981\u4e0a\u4f20\u6e90\u6587\u4ef6\uff0c\u9009\u62e9\u6267\u884c\u73af\u5883\u5e76\u6267\u884c\uff0c\u4fbf\u80fd\u5f97\u5230\u8fd0\u884c\u7ed3\u679c\u3002\u5728\u8be5\u8fc7\u7a0b\u4e2d\uff0c\u670d\u52a1\u5668\u90e8\u7f72\uff0c runtime \u5b89\u88c5\u3001\u7f16\u8bd1\u3001\u90fd\u7531 Amazon Serverless \u8ba1\u7b97\u5e73\u53f0\u7ba1\u7406\u6267\u884c\u3002\u5bf9\u5de5\u7a0b\u5e08\u6765\u8bf4\uff0c\u53ea\u9700\u8981\u7ef4\u62a4\u6e90\u4ee3\u7801\u548c Amazon Serverless \u6267\u884c\u73af\u5883\u7684\u76f8\u5173\u914d\u7f6e\u5373\u53ef\u3002\u4e8e\u6b64\u76f8\u5173\u7684\u6280\u672f\u6709BaaS\uff08Backend as a Service\uff0c\u540e\u7aef\u5373\u670d\u52a1\uff09\uff0c\u662f\u6307\u6211\u4eec\u4e0d\u518d\u7f16\u5199\u548c/\u6216\u7ba1\u7406\u6240\u6709\u670d\u52a1\u7aef\u7ec4\u4ef6\uff0c\u628a\u5e94\u7528\u4e2d\u7684\u5404\u4e2a\u90e8\u5206\u5b8c\u5168\u5916\u5305\u51fa\u53bb\uff0c\u800c Serverless \u662f\u4e00\u79cd\u65b0\u7684\u8fd0\u884c\u4ee3\u7801\u7684\u6258\u7ba1\u73af\u5883\u3002\\n\\n![Architecture Diagram](https://static.apiseven.com/2022/11/29/6386054bc6c9c.png)\\n<center>\u56fe1 Server vs Serverless</center>\\n\\n### \u4e3a\u4ec0\u4e48\u9700\u8981 Serverless\uff1f\\n\\n\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u800c\u8a00\uff0cServerless \u53ef\u4ee5\u5bf9\u7a0b\u5e8f\u6267\u884c\u7ec6\u8282\u8fdb\u884c\u62bd\u8c61\uff0c\u8ba9\u4e1a\u52a1\u5f00\u53d1\u5de5\u7a0b\u5e08\u4e13\u6ce8\u4e8e\u4ee3\u7801\u672c\u8eab\uff1b\u5bf9\u4e8e\u6210\u672c\u800c\u8a00\uff0c\u53ea\u9700\u6309\u7167\u4f7f\u7528\u91cf\u4ed8\u8d39\uff1b\u5bf9\u4e8e\u670d\u52a1\u6027\u80fd\u800c\u8a00\uff0c\u53ef\u4ee5\u81ea\u52a8\u54cd\u5e94\u4efb\u4f55\u89c4\u6a21\u7684\u4ee3\u7801\u6267\u884c\u8bf7\u6c42\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u51fd\u6570\u5185\u5b58\u5927\u5c0f\u4f18\u5316\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u548c\u54cd\u5e94\u65f6\u95f4\u3002\u4ece\u5982\u56fe 1 \u4e2d\u7684\u5bf9\u6bd4\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u57fa\u4e8e Serverless \u7684\u5f00\u53d1\uff0c\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u6765\u8bf4\u66f4\u53cb\u597d\u3002\\n\\n### \u4f7f\u7528 Serverless \u65f6\u4e3a\u4ec0\u4e48\u9700\u8981\u4e00\u4e2a\u7f51\u5173\uff1f\\n\\nServerless \u670d\u52a1\u7684\u4f7f\u7528\u4e5f\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff1a\u6bd4\u5982\u5c06\u51fd\u6570 URL \u786c\u7f16\u7801\u5230\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff1b\u5176\u6b21\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\u7684\u6388\u6743\u548c\u8eab\u4efd\u9a8c\u8bc1\u95ee\u9898\u4e5f\u6bd4\u8f83\u7e41\u7410\uff1b\u518d\u8005\u66f4\u65b0\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u7684\u8fc7\u7a0b\u4e5f\u662f\u4e00\u4e2a\u6bd4\u8f83\u8270\u5de8\u7684\u5de5\u7a0b\u3002\u7f51\u5173\u53ef\u4ee5\u5929\u7136\u7684\u89e3\u51b3\u4e0a\u8ff0\u7684\u95ee\u9898\uff0c\u901a\u8fc7\u7ec4\u5408\u7684\u65b9\u5f0f\uff0cServerless\u53ef\u4ee5\u66f4\u597d\u7684\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002\u56fe 2 \u63cf\u8ff0\u7684\u662f\u5982\u4f55\u7528 Amazon Serverless \u7684\u76f8\u5173\u670d\u52a1\u8fc5\u901f\u7ec4\u88c5\u4e00\u4e2a\u7b80\u5355\u7684 Web Service\uff0c\u7f51\u5173\u5728\u6388\u6743\u7b49\u95ee\u9898\u4e2d\u53d1\u6325\u91cd\u8981\u4f5c\u7528\u3002\u4ee5 Apache APISIX \u4e3a\u4f8b\uff0c\u5b83\u4e3a\u6d41\u884c\u7684\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\uff08AWS\u3001Azure\uff09\u63d0\u4f9b Serverless \u6846\u67b6\u652f\u6301\uff1b\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u8def\u7531\u53bb\u542f\u7528 Serverless \u63d2\u4ef6\uff0c\u800c\u4e0d\u662f\u5c06\u51fd\u6570 URL \u786c\u7f16\u7801\u5230\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff1b\u4e3a\u5f00\u53d1\u4eba\u5458\u63d0\u4f9b\u4e86\u70ed\u66f4\u65b0\u51fd\u6570 URI \u7684\u7075\u6d3b\u6027\uff0c\u66f4\u65b0\u4e0d\u540c\u7684 FaaS \u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u4e5f\u6ca1\u6709\u4ec0\u4e48\u989d\u5916\u7684\u9ebb\u70e6\uff1b\u6b64\u5916\uff0c\u8fd9\u79cd\u65b9\u6cd5\u51cf\u8f7b\u4e86\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\u7684\u6388\u6743\u548c\u8eab\u4efd\u9a8c\u8bc1\u95ee\u9898\u3002\\n\\n![Architecture Diagram](https://static.apiseven.com/2022/11/29/6385ff2ce13c3.png)\\n<center>\u56fe2 \u7528 Amazon Serverless \u7684\u76f8\u5173\u670d\u52a1\u7ec4\u88c5\u4e00\u4e2a Web Service </center>\\n\\n## Apache APISIX\\n\\n[Apache APISIX](https://apisix.apache.org/) \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0b\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u5b83\u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7b49\u7279\u70b9\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\uff08\u91d1\u4e1d\u96c0\u53d1\u5e03\uff09\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\n\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u6765\u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5904\u7406\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\u3002\u540c\u65f6\uff0c\u5b83\u4e5f\u652f\u6301\u4f5c\u4e3a K8s Ingress Controller \u6765\u4f7f\u7528\u3002APISIX \u901a\u8fc7\u63d2\u4ef6\u6765\u6269\u5145\u751f\u6001\uff0c\u76ee\u524d\u4e5f\u5185\u7f6e\u4e86\u5404\u7c7b\u63d2\u4ef6\uff0c\u8986\u76d6\u4e86 API \u7f51\u5173\u7684\u5404\u79cd\u9886\u57df\uff0c\u5982\u8ba4\u8bc1\u9274\u6743\u3001\u5b89\u5168\u3001\u53ef\u89c2\u6d4b\u6027\u3001\u6d41\u91cf\u7ba1\u7406\u3001\u591a\u534f\u8bae\u63a5\u5165\u7b49\uff0c\u5f53\u7136\uff0c\u4e5f\u5305\u542b\u5f88\u591a Serverless \u76f8\u5173\u63d2\u4ef6\u3002\\n\\n## AWS Lambda \u63d2\u4ef6\\n\\n`aws-lambda` \u63d2\u4ef6\u7528\u4e8e\u5c06 AWS Lambda \u4f5c\u4e3a\u52a8\u6001\u4e0a\u6e38\u96c6\u6210\u81f3 APISIX\uff0c\u4ece\u800c\u5b9e\u73b0\u5c06\u8bbf\u95ee\u6307\u5b9a URI \u7684\u8bf7\u6c42\u4ee3\u7406\u5230 AWS \u4e91\u3002\u7528\u6237\u4f7f\u7528\u8be5\u63d2\u4ef6\u7ec8\u6b62\u5bf9\u5df2\u914d\u7f6e URI \u7684\u8bf7\u6c42\uff0c\u5e76\u4ee3\u8868\u5ba2\u6237\u7aef\u5411 AWS Lambda Gateway URI \u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\u3002\\n\\n\u8fd9\u4e2a\u65b0\u8bf7\u6c42\u4e2d\u643a\u5e26\u4e86\u4e4b\u524d\u914d\u7f6e\u7684\u6388\u6743\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u4f53\u548c\u53c2\u6570\uff08\u4ee5\u4e0a\u53c2\u6570\u90fd\u662f\u4ece\u539f\u59cb\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684\uff09\uff0c\u7136\u540e `aws-lambda` \u63d2\u4ef6\u4f1a\u5c06\u5e26\u6709\u54cd\u5e94\u5934\u3001\u72b6\u6001\u7801\u548c\u54cd\u5e94\u4f53\u7684\u54cd\u5e94\u4fe1\u606f\u8fd4\u56de\u7ed9\u4f7f\u7528 APISIX \u53d1\u8d77\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u3002\u8be5\u63d2\u4ef6\u652f\u6301\u901a\u8fc7 AWS API key \u548c AWS IAM secrets \u8fdb\u884c\u6388\u6743\u3002\u63d2\u4ef6\u7ec6\u8282\u53ef\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/plugins/aws-lambda) \u6216\u8005 [\u535a\u5ba2](https://blog.bisakh.com/blog/aws-lambda-apisix)\u3002\\n\\n## Apache APISIX \u4e0e Serverless \u76f8\u5173\u63d2\u4ef6\u603b\u7ed3\\n\\n\u9664\u4e86 Amazon Lambda\uff0cApache APISIX \u8fd8\u652f\u6301\u4e0e Azure Function\u3001Lua \u51fd\u6570\u548c Apache OpenWhisk \u7b49 Serverless \u76f8\u5173\u751f\u6001\u7684\u96c6\u6210\uff0c\u4ece\u800c\u63d0\u4f9b\u76f8\u5e94\u7684 Serverless \u63d2\u4ef6\uff0c\u5177\u4f53\u5982\u4e0b\u3002\\n\\n![Architecture Diagram](https://static.apiseven.com/2022/12/01/638842425ec60.png)\\n<center>\u56fe3 Apache APISIX \u4e0e Serverless \u76f8\u5173\u4ea7\u54c1\u7684\u5173\u8054\u56fe </center>\\n\\n|  \u63d2\u4ef6\u540d\u79f0 | \u63cf\u8ff0  |\\n|  ----  | ----- |\\n| [serverless](https://apisix.apache.org/docs/apisix/plugins/serverless/) | \u7528\u6237\u53ef\u4ee5\u901a\u8fc7 Serverless \u63d2\u4ef6\u4e0a\u4f20\u81ea\u5b9a\u4e49\u7684 Lua \u811a\u672c\uff0c\u5e76\u6839\u636e\u914d\u7f6e\u4e2d\u7684 phase \u6765\u6307\u5b9a\u4ee3\u7801\u8fd0\u884c\u9636\u6bb5\u3002\u4f8b\u5982\u5728 access \u9636\u6bb5\u5bf9\u8bf7\u6c42\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\uff0c\u5728 header filter\uff0cbody filter \u9636\u6bb5\uff0c\u5bf9\u54cd\u5e94\u5934\u6216\u54cd\u5e94\u4f53\u8fdb\u884c\u4fee\u6539\uff0c\u6216\u8005\u5728 log \u9636\u6bb5\u6253\u5370\u4e2a\u6027\u5316\u65e5\u5fd7\u7b49\u3002\u53e6\u5916\uff0c\u7531\u4e8e Serverless \u63d2\u4ef6\u662f\u70ed\u52a0\u8f7d\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u4e0d\u9700\u8981\u91cd\u65b0\u542f\u52a8 Apache APISIX \u4fbf\u53ef\u7acb\u5373\u751f\u6548\u3002|\\n| [azure-functions](https://apisix.apache.org/docs/apisix/plugins/azure-functions/) | \u7528\u4e8e\u5c06 Azure Serverless Function \u4f5c\u4e3a\u52a8\u6001\u4e0a\u6e38\u96c6\u6210\u81f3 APISIX\uff0c\u4ece\u800c\u5b9e\u73b0\u5c06\u8bbf\u95ee\u6307\u5b9a URI \u7684\u8bf7\u6c42\u4ee3\u7406\u5230 Microsoft Azure \u4e91\u670d\u52a1\u3002\u542f\u7528 azure-functions \u63d2\u4ef6\u540e\uff0c\u8be5\u63d2\u4ef6\u4f1a\u7ec8\u6b62\u5bf9\u5df2\u914d\u7f6e URI \u7684\u8bf7\u6c42\uff0c\u5e76\u4ee3\u8868\u5ba2\u6237\u7aef\u5411 Azure Functions \u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\u3002\u8be5\u65b0\u8bf7\u6c42\u4e2d\u643a\u5e26\u4e86\u4e4b\u524d\u914d\u7f6e\u7684\u6388\u6743\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u4f53\u548c\u53c2\u6570\uff08\u4ee5\u4e0a\u53c2\u6570\u90fd\u662f\u4ece\u539f\u59cb\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684\uff09\u3002\u4e4b\u540e\u4fbf\u4f1a\u901a\u8fc7 azure-functions \u63d2\u4ef6\uff0c\u5c06\u5e26\u6709\u54cd\u5e94\u5934\u3001\u72b6\u6001\u7801\u548c\u54cd\u5e94\u4f53\u7684\u4fe1\u606f\u8fd4\u56de\u7ed9\u4f7f\u7528 APISIX \u53d1\u8d77\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u3002 |\\n| [openwhisk](https://apisix.apache.org/docs/apisix/plugins/openwhisk/) | \u7528\u4e8e\u5c06\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u65e0\u670d\u52a1\u5668\u5e73\u53f0 Apache OpenWhisk \u4f5c\u4e3a\u52a8\u6001\u4e0a\u6e38\u96c6\u6210\u81f3 APISIX\u3002\u542f\u7528 openwhisk \u63d2\u4ef6\u540e\uff0c\u8be5\u63d2\u4ef6\u4f1a\u7ec8\u6b62\u5bf9\u5df2\u914d\u7f6e URI \u7684\u8bf7\u6c42\uff0c\u5e76\u4ee3\u8868\u5ba2\u6237\u7aef\u5411 OpenWhisk \u7684 API Host \u7aef\u70b9\u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\uff0c\u7136\u540e openwhisk \u63d2\u4ef6\u4f1a\u5c06\u54cd\u5e94\u4fe1\u606f\u8fd4\u56de\u81f3\u5ba2\u6237\u7aef\u3002 |\\n| [openfunction](https://apisix.apache.org/docs/apisix/plugins/openfunction/) | \u7528\u4e8e\u5c06\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u65e0\u670d\u52a1\u5668\u5e73\u53f0 CNCF OpenFunction \u4f5c\u4e3a\u52a8\u6001\u4e0a\u6e38\u96c6\u6210\u81f3 APISIX\u3002\u542f\u7528 openfunction \u63d2\u4ef6\u540e\uff0c\u8be5\u63d2\u4ef6\u4f1a\u7ec8\u6b62\u5bf9\u5df2\u914d\u7f6e URI \u7684\u8bf7\u6c42\uff0c\u5e76\u4ee3\u8868\u5ba2\u6237\u7aef\u5411 OpenFunction \u7684 function \u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\uff0c\u7136\u540e openfunction \u63d2\u4ef6\u4f1a\u5c06\u54cd\u5e94\u4fe1\u606f\u8fd4\u56de\u81f3\u5ba2\u6237\u7aef\u3002 |\\n\\n<center>\u8868 1 Apache APISIX Serverless \u76f8\u5173\u63d2\u4ef6\u5177\u4f53\u4fe1\u606f</center>\\n\\n## \u603b\u7ed3\\n\\n\u8fd1\u5e74\u6765\uff0c\u968f\u7740\u5fae\u670d\u52a1\u67b6\u6784\u7684\u51fa\u73b0\uff0c\u4e00\u5207\u90fd\u5728\u8fc1\u79fb\u5230\u4e91\u7aef\uff0c\u4e0d\u5c11\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u4e5f\u5728\u63a8\u51fa Serverless \u76f8\u5173\u7684\u4ea7\u54c1\uff0c\u57fa\u4e8e Serverless \u7684\u5f00\u53d1\u5df2\u7ecf\u6210\u4e3a\u4e00\u79cd\u5341\u5206\u4fbf\u5229\u7684\u5f00\u53d1\u6a21\u5f0f\u3002\\n\\n\u672c\u6587\u9996\u5148\u4ecb\u7ecd\u4e86 Serverless \u662f\u4ec0\u4e48\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u9700\u8981 Serverless\uff1b\u5176\u6b21\uff0c\u8bb2\u8ff0\u4e86\u4e00\u4e2a\u597d\u7684\u7f51\u5173\u5728 Serverless \u67b6\u6784\u4e0b\u7684\u91cd\u8981\u6027\uff0c\u800c APISIX \u5c31\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u7f51\u5173\uff1b\u6700\u540e\uff0c\u672c\u6587\u91cd\u70b9\u4ecb\u7ecd\u4e86 APISIX \u4e2d\u7684 Serverless \u7c7b\u578b\u7684\u63d2\u4ef6 aws-lambda\uff0c\u540c\u65f6\u5217\u4e3e\u4e86 Apache APISIX \u5176\u5b83 Serverless \u76f8\u5173\u63d2\u4ef6\u3002"},{"id":"\u4ece Traefik \u5230 APISIX\uff0c\u6c7d\u8f66\u667a\u80fd\u8ba1\u7b97\u5e73\u53f0\u516c\u53f8\u300c\u5730\u5e73\u7ebf\u300d\u5728 Ingress Controller \u7684\u63a2\u7d22\u548c\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/10/28/apisix-ingress-with-horizon-ai","source":"@site/blog/2022/10/28/apisix-ingress-with-horizon-ai.md","title":"\u4ece Traefik \u5230 APISIX\uff0c\u6c7d\u8f66\u667a\u80fd\u8ba1\u7b97\u5e73\u53f0\u516c\u53f8\u300c\u5730\u5e73\u7ebf\u300d\u5728 Ingress Controller \u7684\u63a2\u7d22\u548c\u5b9e\u8df5","description":"\u5730\u5e73\u7ebf\u4f5c\u4e3a\u4e00\u5bb6\u81f4\u529b\u4e8e\u6c7d\u8f66\u81ea\u52a8\u9a7e\u9a76\u82af\u7247\u7684\u516c\u53f8\uff0c\u5728\u4e1a\u52a1\u8fed\u4ee3\u4e2d\u4e3a\u4f55\u4ece Traefik \u5207\u6362\u5230\u4e86 APISIX Ingress \u53bb\u652f\u6491\u4e1a\u52a1\u3002","date":"2022-10-28T00:00:00.000Z","formattedDate":"2022\u5e7410\u670828\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":11.335,"truncated":true,"authors":[{"name":"\u5f20\u6615","title":"Author"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"\u5f53 Amazon Lambda \u9047\u4e0a Apache APISIX \u53ef\u4ee5\u64e6\u51fa\u4ec0\u4e48\u706b\u82b1\uff1f","permalink":"/zh/blog/2022/11/04/why-do-you-need-apache-apisix-when-using-amazon-lambda"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (10.1 - 10.15)","permalink":"/zh/blog/2022/10/18/weekly-report-0731"}},"content":"> \u5730\u5e73\u7ebf\u4f5c\u4e3a\u4e00\u5bb6\u81f4\u529b\u4e8e\u6c7d\u8f66\u81ea\u52a8\u9a7e\u9a76\u82af\u7247\u7684\u516c\u53f8\uff0c\u5728\u4e1a\u52a1\u8fed\u4ee3\u4e2d\u4e3a\u4f55\u4ece Traefik \u5207\u6362\u5230\u4e86 APISIX Ingress \u53bb\u652f\u6491\u4e1a\u52a1\uff1f\\n\\n\x3c!--truncate--\x3e\\n\\n> \u4f5c\u8005\u5f20\u6615\uff0c\u5730\u5e73\u7ebf\u4e91\u539f\u751f\u5f00\u53d1\u5de5\u7a0b\u5e08\u3002\\n\\n\u5728\u5f53\u524d\u7684\u6c7d\u8f66\u884c\u4e1a\uff0c\u5927\u591a\u6570\u516c\u53f8\u90fd\u5728\u5411\u81ea\u52a8\u9a7e\u9a76\u548c\u65b0\u80fd\u6e90\u65b9\u5411\u8f6c\u578b\uff0c\u800c\u5bf9\u4e8e\u81ea\u52a8\u9a7e\u9a76\u65b9\u9762\uff0c\u6bcf\u5bb6\u4f01\u4e1a\u90fd\u6295\u5165\u4e86\u5927\u91cf\u7684\u8d44\u6e90\u6765\u5b8c\u6210\u81ea\u52a8\u9a7e\u9a76\u6a21\u578b\u7684\u5f00\u53d1\u4e0e\u8bad\u7ec3\uff0c\u5176\u4e2d\u51fa\u73b0\u4e86\u5f88\u591a\u660e\u661f\u4f01\u4e1a\uff0c\u6bd4\u5982\u6c7d\u8f66\u667a\u80fd\u8ba1\u7b97\u5e73\u53f0\u5f15\u9886\u8005\u2014\u2014\u5730\u5e73\u7ebf\u3002\u5730\u5e73\u7ebf\u4e3b\u8981\u4ece\u4e8b\u6c7d\u8f66\u667a\u80fd\u8ba1\u7b97\u5e73\u53f0\u7684\u7814\u53d1\uff0c\u5177\u6709\u9886\u5148\u7684\u6df1\u5ea6\u5b66\u4e60\u7b97\u6cd5\u548c\u82af\u7247\u8bbe\u8ba1\u80fd\u529b\uff0c\u81f4\u529b\u4e8e\u901a\u8fc7\u5e95\u5c42\u6280\u672f\u8d4b\u80fd\uff0c\u63a8\u52a8\u6c7d\u8f66\u4ea7\u4e1a\u7684\u521b\u65b0\u53d1\u5c55\u3002\\n\\n\u667a\u80fd\u6c7d\u8f66\u662f\u673a\u5668\u4eba\u65f6\u4ee3\u7b2c\u4e00\u4e2a\u5927\u7ec8\u7aef\uff0c\u5730\u5e73\u7ebf\u540c\u65f6\u4e5f\u901a\u8fc7\u8f6f\u786c\u4ef6\u7684\u7ed3\u5408\uff0c\u5e7f\u6cdb\u8d4b\u80fd\u6cdb\u673a\u5668\u4eba\u884c\u4e1a\u7684\u5e94\u7528\u843d\u5730\u3002\u5728\u786c\u4ef6\u5c42\u9762\uff0c\u5730\u5e73\u7ebf\u57fa\u4e8e\u81ea\u4e3b\u7814\u53d1\u7684\u4e13\u7528\u8ba1\u7b97\u67b6\u6784 BPU\uff08Brain Processing Unit\uff09\uff0c\u63a8\u51fa\u9762\u5411\u667a\u80fd\u9a7e\u9a76\u7684\u8ba1\u7b97\u5e73\u53f0\u5f81\u7a0b\u7cfb\u5217\u548c\u9762\u5411\u6cdb\u673a\u5668\u4eba\u7684\u65ed\u65e5\u7cfb\u5217\u3002\\n\\n\u5728\u8f6f\u4ef6\u5c42\u9762\uff0c\u9762\u5411\u667a\u80fd\u6c7d\u8f66 AI \u8f6f\u4ef6\u4ea7\u54c1\u5f00\u53d1\u53ca\u8fed\u4ee3\u9700\u6c42\uff0c\u5730\u5e73\u7ebf\u6253\u9020\u5730\u5e73\u7ebf\u827e\u8fea\xaeAI \u5f00\u53d1\u5e73\u53f0\uff0c\u80fd\u591f\u4e3a\u667a\u80fd\u6c7d\u8f66 AI \u5f00\u53d1\u8005\u63d0\u4f9b\u6570\u636e\u6807\u6ce8\u3001\u8bad\u7ec3\u3001\u4f18\u5316\u3001\u90e8\u7f72\u3001\u7ba1\u7406\u4e0e\u6027\u80fd\u5206\u6790\u7b49\u80fd\u529b\u3002\u6574\u5957\u57fa\u7840\u8bbe\u65bd\uff0c\u5f00\u7bb1\u5373\u7528\uff0c\u7528\u6237\u65e0\u9700\u4ece\u96f6\u642d\u5efa\u4e00\u5957\u590d\u6742\u7684\u81ea\u52a8\u9a7e\u9a76\u8de8\u5e73\u53f0\u7cfb\u7edf\uff0c\u53ea\u9700\u805a\u7126\u4e8e\u6838\u5fc3\u4ef7\u503c\u79ef\u7d2f\u3002\\n\\n![\u5730\u5e73\u7ebf\u516c\u53f8](https://static.apiseven.com/2022/10/25/635796032156c.png)\\n\\n\u5bf9\u4e8e\u4e00\u5bb6\u5feb\u901f\u53d1\u5c55\u7684\u79d1\u6280\u516c\u53f8\u800c\u8a00\uff0c\u5982\u4f55\u4fdd\u8bc1\u4e1a\u52a1\u7a33\u5b9a\u8fd0\u884c\u4e0e\u8f7b\u677e\u7ba1\u7406\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u800c\u7f51\u5173\u5219\u662f\u4fdd\u8bc1\u4e1a\u52a1\u7a33\u5b9a\u7684\u7b2c\u4e00\u9053\u5173\u5361\u3002\u7531\u4e8e\u4e4b\u524d\u7f51\u5173\u5b58\u5728\u4e86\u4e00\u4e9b\u65e0\u6cd5\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u56e0\u6b64\u5730\u5e73\u7ebf\u5bf9\u7f51\u5173\u91cd\u65b0\u8fdb\u884c\u9009\u578b\uff0c\u6700\u7ec8\u9009\u62e9\u4e86 [Apache APISIX Ingress Controller](https://apisix.apache.org/zh/docs/ingress-controller/getting-started/) \u4f5c\u4e3a\u516c\u53f8\u7684\u6d41\u91cf\u7f51\u5173\uff0c\u7edf\u4e00\u63d0\u4f9b\u670d\u52a1\u3002\\n\\n## \u7f51\u5173\u9009\u578b\u4e4b\u8def\\n\\n### Traefik \u7684\u4e0d\u8db3\\n\\n\u5728\u4f7f\u7528 APISIX Ingress \u4e4b\u524d\uff0c\u4e1a\u52a1\u7cfb\u7edf\u4f7f\u7528\u7684 Ingress Controller \u662f Traefik 1.x \u7248\u672c\uff0c\u4f46\u662f\u5b58\u5728\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a\\n\\n* Traefik 1.x \u662f\u901a\u8fc7 Ingress \u6765\u914d\u7f6e\u8def\u7531\u89c4\u5219\u7684\uff0c\u90e8\u5206\u63d2\u4ef6\u9700\u8981\u901a\u8fc7\u6dfb\u52a0 `annotation` \u7684\u65b9\u5f0f\u8fdb\u884c\u914d\u7f6e\u3002\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ea\u80fd\u9488\u5bf9\u5f53\u524d Ingress\u4e0b\u7684\u6240\u6709\u89c4\u5219\u6dfb\u52a0\u63d2\u4ef6\uff0c\u65e0\u6cd5\u5b9e\u73b0\u66f4\u7ec6\u7c92\u5ea6\u7684\u914d\u7f6e\u3002\\n\\n* Traefik 1.x \u4e0d\u652f\u6301\u5177\u4f53\u89c4\u5219\u53ef\u89c6\u5316\u914d\u7f6e\uff0c\u65e0\u6cd5\u6839\u636e Request URL \u901a\u8fc7\u9875\u9762\u76f4\u63a5\u5b9a\u4f4d\u5230\u5177\u4f53\u670d\u52a1\u3002\\n\\n* Traefik \u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\uff08`configmap`\uff09\u5185\u5bb9\u8f83\u5c11\uff0c\u8bb8\u591a\u9ed8\u8ba4\u914d\u7f6e\u9700\u8981\u7ffb\u9605\u5b98\u65b9\u6587\u6863\uff0c\u5e76\u4e14\u6709\u4e9b\u53c2\u6570\u548c NGINX \u9ed8\u8ba4\u914d\u7f6e\u4e0d\u4e00\u81f4\uff0c\u5bfc\u81f4\u7ef4\u62a4\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\u3002\\n\\n\u9488\u5bf9\u4ee5\u4e0a\u95ee\u9898\uff0c\u5730\u5e73\u7ebf\u7684\u6280\u672f\u56e2\u961f\u51b3\u5b9a\u66f4\u6362 Ingress Controller\uff0c\u5728\u9009\u578b\u521d\u671f\u4e5f\u6709\u8003\u8651\u5c06 Traefik \u5347\u7ea7\u5230 Traefik 2.0 \u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u4f46\u662f\u56e0\u4e3a\u4e5f\u9700\u8981\u91c7\u7528\u65b0\u7684 CRD \u6765\u8fdb\u884c\u5347\u7ea7\uff0c\u8fc1\u79fb\u6210\u672c\u4e5f\u4e0d\u4f4e\uff0c\u4e0d\u5982\u5c1d\u8bd5\u4e0b\u5176\u4ed6 Ingress \u65b9\u6848\u3002\\n\\n### APISIX Ingress \u7684\u4f18\u52bf\\n\\n\u5728\u9009\u578b\u521d\u671f\uff0c\u6211\u4eec\u4e3b\u8981\u5bf9\u6bd4\u4e86 APISIX Ingress\u3001Kong Ingress \u548c Envoy\uff0c\u4f46\u662f\u9664\u4e86 APISIX Ingress \u5176\u4ed6\u7f51\u5173\u6216\u591a\u6216\u5c11\u5728\u529f\u80fd\u6216\u6027\u80fd\u4e0a\u65e0\u6cd5\u6ee1\u8db3\u73b0\u6709\u573a\u666f\u7684\u9700\u6c42\uff0c\u56e0\u6b64\u6700\u7ec8\u9009\u62e9\u4e86 APISIX Ingress\uff0c\u9664\u4e86\u4e00\u4e9b\u901a\u7528\u7684\u529f\u80fd\u5916\uff0c\u6211\u4eec\u66f4\u770b\u91cd\u4ee5\u4e0b\u51e0\u70b9\uff1a\\n\\n* \u63d2\u4ef6\u4e30\u5bcc\uff1a\u63d2\u4ef6\u751f\u6001\u597d\uff0cAPISIX \u652f\u6301\u7684\u63d2\u4ef6\uff0c\u5747\u53ef\u4ee5\u4f7f\u7528 `apisix-ingress-controller` \u505a\u58f0\u660e\u5f0f\u914d\u7f6e\uff0c\u5e76\u4e14\u53ef\u4ee5\u9488\u5bf9 `ApisixRoute` \u4e0b\u7684\u5355\u6761 `backend` \u5b9a\u5236\u63d2\u4ef6\u3002\\n\\n* \u53ef\u89c6\u5316\u914d\u7f6e\uff1a\u642d\u914d APISIX Dashboard \u53ef\u4ee5\u770b\u5230\u6bcf\u6761`apisix` `route`\u3002\u5982\u679c\u540c\u4e00\u57df\u540d\u914d\u7f6e\u5728\u591a\u4e2a `namespace` \u6216\u8005\u662f\u591a\u4e2a `yaml` \u6587\u4ef6\u4e2d\uff0c\u53d1\u751f\u51b2\u7a81\u65f6\u53ef\u4ee5\u7ed3\u5408 APISIX Dashboard \u641c\u7d22 `path` \u524d\u7f00\u5373\u53ef\u5feb\u901f\u5b9a\u4f4d\u3002\\n\\n* \u7ec6\u7c92\u5ea6\u6821\u9a8c\uff1aAPISIX Ingress Controller \u4f1a\u5bf9\u5176\u7ba1\u7406\u7684 CRD \u58f0\u660e\u7684\u8d44\u6e90\u8fdb\u884c\u6821\u9a8c\uff0c\u5047\u5982\u5728 CRD \u4e2d\u58f0\u660e\u4e86\u4e0d\u5b58\u5728\u7684 Service\uff0c\u5219\u4f1a\u5c06\u62a5\u9519\u4fe1\u606f\u5b58\u50a8\u5728 `ApisixRoute` \u7684 `event` \u4e2d\uff0c\u6b64\u6b21\u53d8\u66f4\u4e5f\u4e0d\u4f1a\u751f\u6548\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u51cf\u5c11\u4e86\u4e00\u4e9b\u56e0\u8bef\u64cd\u4f5c\u9020\u6210\u7684\u95ee\u9898\u3002\\n\\n* \u529f\u80fd\u4e30\u5bcc\uff1aAPISIX \u652f\u6301\u70ed\u66f4\u65b0\u548c\u70ed\u63d2\u4ef6\u3001\u4ee3\u7406\u8bf7\u6c42\u91cd\u5199\u3001\u591a\u79cd\u8eab\u4efd\u8ba4\u8bc1\u3001\u591a\u8bed\u8a00\u63d2\u4ef6\u5f00\u53d1\u7b49\u8bf8\u591a\u7279\u6027\uff0c\u66f4\u591a\u529f\u80fd\u8bf7\u53c2\u8003 [APISIX \u7684\u529f\u80fd](https://github.com/apache/apisix/tree/master/docs/zh/latest#%E7%89%B9%E6%80%A7)\u3002\\n\\n* \u793e\u533a\u6d3b\u8dc3\uff1aIssue \u7684\u54cd\u5e94\u901f\u5ea6\u5f88\u5feb\uff0c\u76f8\u5bf9\u5176\u4ed6\u793e\u533a\uff0c APISIX \u6d3b\u8dc3\u5f00\u53d1\u8005\u6570\u91cf\u591a\u3002\\n\\n* \u9ad8\u6027\u80fd\uff1a\u4ece\u4e0b\u56fe\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u5728\u548c Envoy \u8fdb\u884c\u538b\u6d4b\u5bf9\u6bd4\u65f6\uff0cAPISIX \u7684\u6027\u80fd\u662f Envoy \u7684 120% \u5de6\u53f3\uff0c\u5e76\u4e14\u6838\u5fc3\u6570\u8d8a\u591a QPS \u5dee\u8ddd\u8d8a\u5927\u3002\\n\\n![\u6027\u80fd\u5bf9\u6bd4\u56fe](https://static.apiseven.com/2022/10/25/6357960098fe0.png)\\n\\n## \u6574\u4f53\u67b6\u6784\\n\\n\u4ece\u4e0b\u9762\u7684\u67b6\u6784\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0cAPISIX Ingress \u4f5c\u4e3a\u4e00\u4e2a\u5168\u6d41\u91cf\u7684\u5165\u53e3\uff0c\u65e0\u8bba\u662f\u547d\u4ee4\u884c\u5de5\u5177\u3001Web\u3001SaaS \u5e73\u53f0\u6216\u8005 OpenAPI\uff0c\u6240\u6709\u8bbf\u95ee\u7684\u6d41\u91cf\u5747\u901a\u8fc7 APISIX Ingress \u8fdb\u5165\u4e0a\u6e38\uff08\u4e1a\u52a1\u670d\u52a1\uff09\u3002\u800c\u5728\u8ba4\u8bc1\u9274\u6743\u4e0a\uff0c\u56e0\u4e3a\u516c\u53f8\u672c\u8eab\u6709\u4e00\u4e2a\u4e13\u95e8\u7684\u8ba4\u8bc1\u670d\u52a1\uff0c\u6240\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e86 APISIX \u7684 `forward-auth` \u63d2\u4ef6\uff0c\u5b9e\u73b0\u5916\u90e8\u9274\u6743\u8ba4\u8bc1\u3002\\n\\n![\u5e94\u7528 APISIX \u7684\u67b6\u6784](https://static.apiseven.com/2022/10/25/63579600ca70e.png)\\n\\n\u5728\u7f51\u5173\u5c42\uff0c\u6240\u6709\u7684\u6d41\u91cf\u5747\u662f\u901a\u8fc7\u8bbf\u95ee\u57df\u540d\u8fdb\u5165\uff0c\u6b64\u65f6\u6d41\u91cf\u4f1a\u5148\u7ecf\u8fc7 LVS\uff0c\u7531 LVS \u5206\u522b\u8f6c\u53d1\u5230\u540e\u7aef\u7684 APISIX \u8282\u70b9\u4e2d\uff0c\u6700\u540e\u518d\u7531 APISIX \u6839\u636e\u8def\u7531\u89c4\u5219\u5bf9\u6d41\u91cf\u8fdb\u884c\u5206\u53d1\uff0c\u8f6c\u53d1\u81f3\u76f8\u5bf9\u5e94\u7684 Pod \u4e2d\u3002\u800c\u5728 LVS \u4e0a\uff0c\u4e3a\u4e86\u4f7f LVS \u53ef\u4ee5\u76f4\u63a5\u6307\u5411 APISIX Ingress\uff0c \u4ed6\u4eec\u4e5f\u5c06 APISIX Ingress \u9ed8\u8ba4\u7aef\u53e3\u7531 `9180` \u66f4\u6362\u4e3a `80` \uff0c\u53ef\u4ee5\u66f4\u65b9\u4fbf\u5730\u5bf9\u6d41\u91cf\u8fdb\u884c\u8f6c\u53d1\u5904\u7406\u3002\\n\\n![\u6d41\u91cf\u5904\u7406\u8fc7\u7a0b](https://static.apiseven.com/2022/10/25/63579606c7a90.png)\\n\\n## \u4f7f\u7528\u573a\u666f\\n\\n\u4e86\u89e3\u5b8c\u6574\u4f53\u67b6\u6784\u540e\uff0c\u63a5\u4e0b\u6765\u5c06\u5206\u4eab\u51e0\u4e2a\u6211\u4eec\u516c\u53f8\u76ee\u524d\u5229\u7528 APISIX Ingress \u5b9e\u73b0\u7684\u573a\u666f\u3002\\n\\n### \u8d85\u5927\u6587\u4ef6\u4e0a\u4f20\\n\\n\u9996\u5148\u662f\u5927\u6587\u4ef6\u4e0a\u4f20\u573a\u666f\uff0c\u8be5\u573a\u666f\u5728\u4e00\u822c\u516c\u53f8\u53ef\u80fd\u4f1a\u6bd4\u8f83\u5c11\uff0c\u4f46\u662f\u5982\u679c\u662f\u505a AI \u6a21\u578b\u8bad\u7ec3\u7684\u516c\u53f8\uff0c\u8fd9\u4e2a\u573a\u666f\u5c31\u6bd4\u8f83\u5e38\u89c1\u4e86\u3002\u8be5\u573a\u666f\u4e3b\u8981\u662f\u5728\u5730\u5e73\u7ebf\u6a21\u578b\u8bad\u7ec3\u7cfb\u7edf\u4e2d\uff0c\u7814\u53d1\u8f66\u91c7\u96c6\u5230\u7684\u6570\u636e\u4f1a\u901a\u8fc7\u7f51\u7edc\u4e0a\u4f20\u5230\u8be5\u7cfb\u7edf\u4e2d\uff0c\u6570\u636e\u5927\u5c0f\u4e00\u822c\u90fd\u662f\u5728\u51e0\u767e GB \u4ee5\u4e0a\uff0c\u5728\u4e0d\u8c03\u6574 APISIX \u4efb\u4f55\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0a\u4f20\u6570\u636e\u91cf\u8fc7\u5927\u65f6\u5c31\u4f1a\u53d1\u751f OOM\u3002\\n\\n![\u6587\u4ef6\u6570\u636e](https://static.apiseven.com/2022/10/25/63579603ed287.png)\\n\\n\u56e0\u4e3a\u9ed8\u8ba4 `client_body_buffer_size` \u662f `1MB`\uff0c\u7f13\u51b2\u533a\u6ee1\u4e86\u5c31\u4f1a\u628a\u4e34\u65f6\u6587\u4ef6\u5199\u5165\u78c1\u76d8\uff0c\u56e0\u6b64\u9020\u6210\u78c1\u76d8 IO \u8fc7\u9ad8\u3002\\n\\n![\u78c1\u76d8\u53cd\u5e94](https://static.apiseven.com/2022/10/25/63579600a13fd.png)\\n\\n\u5982\u679c\u5c06\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u6307\u5411 `/dev/shm` \u5171\u4eab\u5185\u5b58\uff0c\u5219\u53c8\u4f1a\u5bfc\u81f4 APISIX\uff08cache\uff09\u8fc7\u9ad8\u3002\\n\\n![\u7f13\u5b58\u53cd\u5e94](https://static.apiseven.com/2022/10/25/6357960182c2b.png)\\n\\n\u7ecf\u8fc7\u4e0d\u65ad\u7684\u8c03\u8bd5\uff0c\u53d1\u73b0\u662f\u56e0\u4e3a APISIX \u6ca1\u6709\u5f00\u542f\u6d41\u5f0f\u4e0a\u4f20\uff0c\u9488\u5bf9\u8fd9\u4e2a\u573a\u666f\uff0c\u6211\u4eec\u5c06 APISIX \u7248\u672c\u7531 2.11 \u5347\u7ea7\u81f3 2.13\uff0c\u5e76\u4e14\u5bf9 APISIX \u7684\u53c2\u6570\u8fdb\u884c\u4e86\u8c03\u6574\uff0c\u9996\u5148\u66f4\u6539 `apisix configmap`\u542f\u7528\u6d41\u5f0f\u4e0a\u4f20\u7684\u53c2\u6570 `proxy_request_buffering off`\uff0c\u5176\u6b21\u518d\u901a\u8fc7 APISIX Ingress Controller \u63d0\u4f9b\u7684 CRD `ApisixPluginConfig` \u5c06\u53ef\u590d\u7528\u7684\u914d\u7f6e\u62bd\u79bb\u51fa\u6765\uff0c\u4f5c\u4e3a `namespace` \u7ea7\u522b\u7684\u914d\u7f6e\u4e3a\u9700\u8981\u6b64\u573a\u666f\u7684\u8def\u7531\u52a8\u6001\u8bbe\u7f6e `client_max_body_size` \u7684\u5927\u5c0f\u3002\\n\\n![\u6570\u636e\u7ec6\u8282](https://static.apiseven.com/2022/10/25/6357960290e3f.png)\\n\\n### \u591a\u4e91\u73af\u5883\u4e0b\u7684\u670d\u52a1\u8c03\u7528\\n\\n\u5728\u591a\u4e91\u73af\u5883\u4e0b\u7684\u670d\u52a1\u8c03\u7528\u4e2d\uff0c\u90e8\u5206\u4e1a\u52a1\u6d41\u91cf\u9996\u5148\u4f1a\u5230\u8fbe\u672c\u5730 IDC\uff0c\u4e4b\u540e\u4f1a\u7ecf\u8fc7 APISIX Ingress \u5230\u8fbe Pod\uff0c\u800c\u5728 Pod \u4e2d\uff0c\u6709\u4e9b\u670d\u52a1\u5219\u4f1a\u901a\u8fc7\u57df\u540d\u8bbf\u95ee Acloud \u7684\u670d\u52a1\uff0c\u90e8\u5206\u573a\u666f\u4e5f\u4f1a\u5b58\u5728\u670d\u52a1\u4e0e\u670d\u52a1\u4e4b\u95f4\u8fdb\u884c\u8c03\u7528\u3002\\n\\n\u4e3b\u8981\u662f\u6d89\u53ca\u5230\u591a\u4e91\u8bad\u7ec3\uff0c\u7528\u6237\u4f1a\u4ee5 IDC \u4e3a\u5165\u53e3\uff0c\u9009\u62e9\u96c6\u7fa4\u540e\u5373\u53ef\u5c06\u4efb\u52a1\u63d0\u4ea4\u5230\u5bf9\u5e94\u7684\u4e91\u7aef\u96c6\u7fa4\u3002\\n\\n![\u591a\u4e91\u670d\u52a1\u8c03\u7528](https://static.apiseven.com/2022/10/25/635796054b054.png)\\n\\n### \u4f7f\u7528 `forward-auth` \u5b9e\u73b0\u5916\u90e8\u8ba4\u8bc1\\n\\n\u5728\u6211\u4eec\u521a\u5f00\u59cb\u4f7f\u7528 APISIX Ingress \u65f6\uff0cAPISIX \u5e76\u6ca1\u6709\u652f\u6301 `forward-auth` \u63d2\u4ef6\uff0c\u56e0\u6b64\u6211\u4eec\u57fa\u4e8e [`apisix-go-plugin-runner`](https://apisix.apache.org/zh/docs/go-plugin-runner/getting-started/) \u81ea\u5b9a\u4e49\u4e86\u4e00\u4e2a\u63d2\u4ef6\uff0c\u4f46\u662f\u8fd9\u6837\u505a\u5c31\u591a\u4e86\u4e00\u5c42 gRPC \u7684\u8c03\u7528\uff0c\u8c03\u8bd5\u6bd4\u8f83\u56f0\u96be\uff0c\u5f88\u591a\u65e5\u5fd7\u90fd\u65e0\u6cd5\u770b\u5230\u3002\\n\\n\u800c\u5728\u4eca\u5e74\u5e74\u521d APISIX \u652f\u6301\u4e86 [`forward-auth`](https://apisix.apache.org/zh/docs/apisix/plugins/forward-auth/) \u63d2\u4ef6\uff0c\u6211\u4eec\u5c31\u5c06\u81ea\u5b9a\u4e49\u63d2\u4ef6\u66f4\u6362\u4e3a\u5b98\u65b9\u63d2\u4ef6\uff0c\u8fd9\u6837\u5c31\u51cf\u5c11\u4e00\u5c42 gRPC \u7684\u8c03\u7528\uff0c\u4e5f\u66f4\u52a0\u65b9\u4fbf\u8fdb\u884c\u76d1\u63a7\u3002\\n\\n![\u5916\u90e8\u8ba4\u8bc1\u6d41\u7a0b](https://static.apiseven.com/2022/10/25/635796062d19a.png)\\n\\n### \u5e94\u7528\u76d1\u63a7\\n\\n\u5728\u5e94\u7528\u76d1\u63a7\u4e2d\uff0c\u6211\u4eec\u5728\u5168\u5c40\u542f\u7528\u4e86 APISIX \u7684 `prometheus` \u63d2\u4ef6\uff0c\u5e76\u9488\u5bf9\u81ea\u8eab\u4e1a\u52a1\u8fdb\u884c\u4e86\u4e00\u4e9b\u8c03\u8bd5\u548c\u4f18\u5316\uff0c\u6bd4\u5982\u589e\u52a0\u4e86\u5b9e\u65f6\u5e76\u53d1\u6570\u3001QPS\u3001APISIX \u5b9e\u65f6\u63a5\u53e3\u6210\u529f\u7387\u4ee5\u53ca APISIX \u7684\u5b9e\u65f6\u5e26\u5bbd\uff0c\u5bf9 APISIX \u8fdb\u884c\u66f4\u7ec6\u7c92\u5ea6\u5730\u76d1\u63a7\u3002\\n\\n![\u5e94\u7528\u76d1\u63a7\u793a\u4f8b](https://static.apiseven.com/2022/10/25/63579601ca17f.png)\\n\\n## \u603b\u7ed3\\n\\n\u5f53\u524d\u6211\u4eec\u4ec5\u5728\u90e8\u5206\u4e1a\u52a1\u7ebf\u4f7f\u7528\u4e86 Apache APISIX Ingress Controller \u4f5c\u4e3a\u6d41\u91cf\u7f51\u5173\uff0c\u540e\u7eed\u4e5f\u5c06\u4e0a\u7ebf\u5176\u4ed6\u4e1a\u52a1\uff0c\u4e3a\u793e\u533a\u5e26\u6765\u66f4\u52a0\u4e30\u5bcc\u7684\u5e94\u7528\u573a\u666f\u3002\u5982\u679c\u4f60\u4e5f\u6b63\u5728\u5bf9 Ingress Controller \u8fdb\u884c\u9009\u578b\uff0c\u5e0c\u671b\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u80fd\u591f\u7ed9\u4f60\u4e00\u4e9b\u5e2e\u52a9\u3002\\n\\n\u8d8a\u6765\u8d8a\u591a\u7684\u7528\u6237\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528 Apache APISIX Ingress\uff0c\u5982\u679c\u4f60\u4e5f\u6b63\u5728\u4f7f\u7528 APISIX Ingress\uff0c\u6b22\u8fce\u5728\u793e\u533a\u4e2d[\u5206\u4eab\u4f60\u7684\u4f7f\u7528\u6848\u4f8b](https://github.com/apache/apisix-ingress-controller/issues/501)\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (10.1 - 10.15)","metadata":{"permalink":"/zh/blog/2022/10/18/weekly-report-0731","source":"@site/blog/2022/10/18/weekly-report-0731.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (10.1 - 10.15)","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86 `proxy-mirror` \u63d2\u4ef6\u652f\u6301\u89e3\u6790 host \u57df\u540d\u3001`kafka-logger` \u63d2\u4ef6\u65b0\u589e brokers \u5c5e\u6027\uff0c\u652f\u6301\u4e0d\u540c broker \u8bbe\u7f6e\u76f8\u540c host \u7b49\u529f\u80fd\u3002","date":"2022-10-18T00:00:00.000Z","formattedDate":"2022\u5e7410\u670818\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.645,"truncated":true,"authors":[],"prevItem":{"title":"\u4ece Traefik \u5230 APISIX\uff0c\u6c7d\u8f66\u667a\u80fd\u8ba1\u7b97\u5e73\u53f0\u516c\u53f8\u300c\u5730\u5e73\u7ebf\u300d\u5728 Ingress Controller \u7684\u63a2\u7d22\u548c\u5b9e\u8df5","permalink":"/zh/blog/2022/10/28/apisix-ingress-with-horizon-ai"},"nextItem":{"title":"\u653e\u5f03 Spring Cloud Gateway\uff01APISIX \u5728\u300c\u8fd8\u5457\u300d\u7684\u6280\u672f\u5b9e\u8df5","permalink":"/zh/blog/2022/09/30/huanbei-in-apache-apisix"}},"content":"> \u4ece 10.1 - 10.15\uff0c\u6709 19 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 32 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2022/10/18/634e520810ea5.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/2022/10/18/634e5208ed0b4.png)\\n\\n## Good first issue\\n\\n### Issue #7990\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/7990\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5e94\u8be5\u5728\u6d4b\u8bd5\u6848\u4f8b\u4e2d\u5408\u5e76 `extra_init_by_lua_start` \u548c `extra_init_by_lua` \u6307\u4ee4\uff0c\u5b83\u4eec\u53ea\u662f\u5728\u4f4d\u7f6e\u4e0a\u6709\u6240\u4e0d\u540c\u3002\\n\\n### Issue #1339\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1339\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1aApache APISIX v3 \u7248\u672c\u5373\u5c06\u53d1\u5e03\uff0c\u5728\u8fd9\u4e2a\u7248\u672c\u4e2d\uff0cAdmin API \u505a\u4e86\u5f88\u591a\u8c03\u6574\uff08\u8fd9\u662f\u76ee\u524d APISIX Ingress Controller \u4e0e APISIX \u4e4b\u95f4\u901a\u4fe1\u7684\u4e3b\u8981\u65b9\u5f0f\uff09\u3002\\n\\n\u56e0\u6b64\uff0cAPISIX Ingress Controller \u4e5f\u9700\u8981\u4e0e APISIX v3 \u4e2d\u7684 Admin API \u517c\u5bb9\uff1a\\n\\n1. \u4e3a e2e \u6d4b\u8bd5\u6dfb\u52a0 APISIX v3 \u955c\u50cf\u3002(\u53ef\u4ee5\u4f7f\u7528 apache/apisix:dev)\\n2. \u4fee\u6539\u4ee3\u7801\u4e2d Admin API \u8fd4\u56de\u7ed3\u679c\u7684\u5904\u7406\u903b\u8f91\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [`proxy-mirror` \u63d2\u4ef6\u652f\u6301\u89e3\u6790 host \u57df\u540d](https://github.com/apache/apisix/pull/7861)\uff08\u8d21\u732e\u8005\uff1a[Strangevy](https://github.com/Strangevy)\uff09\\n\\n- [`kafka-logger` \u63d2\u4ef6\u65b0\u589e brokers \u5c5e\u6027\uff0c\u652f\u6301\u4e0d\u540c broker \u8bbe\u7f6e\u76f8\u540c host](https://github.com/apache/apisix/pull/7999)\uff08\u8d21\u732e\u8005\uff1a[starsz](https://github.com/starsz)\uff09\\n\\n- [\u65b0\u589e consumer group](https://github.com/apache/apisix/pull/7980)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n- [`kafka-logger` \u652f\u6301\u8bbe\u7f6e sasl \u76f8\u5173\u914d\u7f6e](https://github.com/apache/apisix/pull/8050)\uff08\u8d21\u732e\u8005\uff1a[starsz](https://github.com/starsz)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 Issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 Issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e Issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff01\u5e26\u6765\u4e30\u5bcc\u529f\u80fd\u4e0e\u8fed\u4ee3\u7ec6\u8282](https://apisix.apache.org/zh/blog/2022/09/28/apache-apisix-3.0.0-beta-release/)\\n\\n    Apache APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff0c\u4e3a\u4f60\u6574\u7406\u4e86\u6b64\u6b21\u9884\u89c8\u7248\u4e0a\u7ebf\u7684\u4e00\u4e9b\u529f\u80fd\u4e0e\u8c03\u6574\u7ec6\u8282\u3002\\n\\n- [\u4e3a\u4ec0\u4e48\u8bf4 Apache APISIX \u662f\u6700\u597d\u7684 API \u7f51\u5173\uff1f](https://apisix.apache.org/zh/blog/2022/09/27/why-apache-apisix-is-best-apigateway/)\\n\\n    \u672c\u6587\u9996\u53d1\u4e8e [API7.ai](https://www.apiseven.com/blog/why-is-apache-apisix-the-best-api-gateway)\uff0c\u4ece\u591a\u4e2a\u89d2\u5ea6\uff08\u5728\u5f00\u53d1\u4eba\u5458\u4e2d\u7684\u53d7\u6b22\u8fce\u7a0b\u5ea6\u3001\u5f00\u6e90\u8bb8\u53ef\u8bc1\u3001\u6027\u80fd\u548c\u6574\u4e2a\u751f\u6001\u7cfb\u7edf\uff09\u5bf9\u6bd4\u591a\u4e2a API \u7f51\u5173\uff08Kong\u3001Tyk\u3001Gloo\uff09\u3002\\n\\n- [API \u7f51\u5173 Apache APISIX \u96c6\u6210 CNCF OpenFunction](https://apisix.apache.org/zh/blog/2022/09/20/apisix-integrate-cncf-openfunction/)\\n\\n    \u672c\u6587\u4f5c\u8005\u674e\u4ece\u65fa\uff0c\u5f00\u6e90\u7231\u597d\u8005\u4e0e\u4e91\u539f\u751f\u6280\u672f\u7231\u597d\u8005\uff0c\u76ee\u524d\u4e8e\u4f50\u6cbb\u4e9a\u7406\u5de5\u5b66\u9662\u6df1\u5733\u6821\u533a\u8fdb\u4fee\u7855\u58eb\u5b66\u4f4d\u3002\u672c\u7bc7\u6587\u7ae0\u662f\u5728\u53c2\u4e0e APISIX \u5f00\u6e90\u4e4b\u590f\u9879\u76ee\u300c\u96c6\u6210 OpenFunction \u81f3 Apache APISIX\u300d\u7684\u529f\u80fd\u5448\u73b0\uff0c\u5e0c\u671b\u6b64\u529f\u80fd\u53ef\u4ee5\u8ba9\u4f60\u5728\u4f7f\u7528 APISIX \u8fdb\u884c\u6269\u5c55\u65f6\u66f4\u52a0\u4fbf\u6377\u3002"},{"id":"\u653e\u5f03 Spring Cloud Gateway\uff01APISIX \u5728\u300c\u8fd8\u5457\u300d\u7684\u6280\u672f\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/09/30/huanbei-in-apache-apisix","source":"@site/blog/2022/09/30/huanbei-in-apache-apisix.md","title":"\u653e\u5f03 Spring Cloud Gateway\uff01APISIX \u5728\u300c\u8fd8\u5457\u300d\u7684\u6280\u672f\u5b9e\u8df5","description":"\u672c\u6587\u5c06\u4ecb\u7ecd\u4f5c\u4e3a\u91d1\u878d\u4f01\u4e1a\u7684\u8fd8\u5457\uff0c\u4e3a\u4f55\u5f03\u7528 Spring Cloud Gateway \u800c\u9009\u62e9 APISIX \u4f5c\u4e3a\u4ed6\u4eec\u7684\u7f51\u5173\u3002","date":"2022-09-30T00:00:00.000Z","formattedDate":"2022\u5e749\u670830\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":19.63,"truncated":true,"authors":[{"name":"\u738b\u6654\u501e","url":"https://github.com/wang-yeliang","imageURL":"https://github.com/wang-yeliang.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (10.1 - 10.15)","permalink":"/zh/blog/2022/10/18/weekly-report-0731"},"nextItem":{"title":"APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff01\u5e26\u6765\u4e30\u5bcc\u529f\u80fd\u4e0e\u8fed\u4ee3\u7ec6\u8282","permalink":"/zh/blog/2022/09/28/apache-apisix-3.0.0-beta-release"}},"content":"> \u672c\u6587\u5c06\u4ecb\u7ecd\u4f5c\u4e3a\u91d1\u878d\u4f01\u4e1a\u7684\u8fd8\u5457\uff0c\u4e3a\u4f55\u5f03\u7528 Spring Cloud Gateway \u800c\u9009\u62e9 APISIX \u4f5c\u4e3a\u4ed6\u4eec\u7684\u7f51\u5173\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4e0d\u540c\u884c\u4e1a\u4e4b\u95f4\uff0c\u90fd\u4f1a\u5b58\u5728\u4e00\u4e9b\u4e1a\u52a1\u5c5e\u6027\u4e0a\u7684\u5dee\u8ddd\u3002\u5bf9\u4e8e\u91d1\u878d\u9886\u57df\u7684\u5e94\u7528\u8f6f\u4ef6\u6765\u8bf4\uff0c\u56e0\u5176\u6d89\u53ca\u5230\u94b1\u7b49\u56e0\u7d20\uff0c\u6240\u4ee5\u5728\u4e1a\u52a1\u4e0a\u4f1a\u6709\u4ee5\u4e0b\u72ec\u7279\u5c5e\u6027\uff1a\\n\\n* **\u7a33\u5b9a\u6027**\uff1a\u91d1\u878d\u9886\u57df\u8ddf\u94b1\u5f3a\u76f8\u5173\uff0c\u8fd9\u5bf9\u4e8e\u4e1a\u52a1\u7a33\u5b9a\u6027\u5c31\u6709\u7740\u975e\u5e38\u4e25\u683c\u7684\u8981\u6c42\uff0c\u7a33\u5b9a\u6027\u4e00\u65e6\u51fa\u73b0\u95ee\u9898\uff0c\u5b83\u5c06\u5f71\u54cd\u6574\u4e2a\u4ea4\u6613\u7cfb\u7edf\u7684\u6210\u8d25\u3002\\n\\n* **\u5f3a\u76d1\u7ba1**\uff1a\u5f3a\u76d1\u7ba1\u4e00\u822c\u662f\u9488\u5bf9\u751f\u7269\u533b\u836f\u9886\u57df\u3001\u533b\u7597\u9886\u57df\u548c\u91d1\u878d\u9886\u57df\uff0c\u56e0\u4e3a\u5b83\u4eec\u6240\u5448\u73b0\u7684\u5185\u5bb9\u90fd\u4e0e\u4eba\u7684\u751f\u547d\u76f8\u5173\u3002\u6240\u4ee5\uff0c\u66f4\u9ad8\u5c42\u9762\u7684\u5f3a\u76d1\u7ba1\u8981\u6c42\u52bf\u5fc5\u4f1a\u5f71\u54cd\u4e00\u4e9b\u4e1a\u52a1\u5c42\u9762\u7684\u9009\u578b\u548c\u67b6\u6784\u5448\u73b0\u3002\\n\\n* **\u51c6\u786e\u6027\u548c\u6709\u6548\u6027**\uff1a\u7531\u4e8e\u8ddf\u94b1\u5f3a\u76f8\u5173\uff0c\u6240\u4ee5\u5728\u6570\u5b57\u5c42\u9762\u7684\u5448\u73b0\u66f4\u662f\u8981\u6c42\u96f6\u504f\u5dee\u3002\u5c31\u50cf\u80a1\u7968\u4ef7\u683c\u4e00\u6837\uff0c\u5b83\u7684\u6570\u5b57\u5448\u73b0\u90fd\u662f\u7cbe\u786e\u5230\u4e86\u6bcf\u5206\u6bcf\u79d2\u548c\u56fa\u5b9a\u6570\u4f4d\u7684\u3002\\n\\n\u57fa\u4e8e\u4ee5\u4e0a\u8fd9\u4e9b\u7279\u70b9\uff0c\u91d1\u878d\u884c\u4e1a\u8f6f\u4ef6\u7cfb\u7edf\u5728\u8fdb\u884c\u7cfb\u7edf\u8bbe\u8ba1\u3001\u673a\u623f\u62d3\u6251\u4ee5\u53ca\u4e2d\u95f4\u4ef6\u9009\u578b\u65f6\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e9b\u4e0e\u5176\u4ed6\u901a\u7528\u884c\u4e1a\u4e0d\u592a\u4e00\u6837\u7684\u5730\u65b9\u3002\\n\\n## \u5bf9 Java \u7684\u90a3\u4e9b\u7231\u4e0e\u6068\\n\\n### \u91d1\u878d\u7cfb\u7edf\u4e3a\u4f55\u72ec\u7231 Java\\n\\nJava \u81ea\u8bde\u751f\u4ee5\u6765\u5c31\u6df1\u53d7\u5f00\u53d1\u8005\u7684\u559c\u7231\u3002\u5728\u4e2d\u56fd\u6709\u5c06\u8fd1 50% \u7684\u5f00\u53d1\u8005\u5728\u4f7f\u7528 Java \u4f5c\u4e3a\u5f00\u53d1\u8bed\u8a00\u3002\u8fd9\u4e0d\u5355\u5355\u662f\u56e0\u4e3a\u5176\u8bed\u8a00\u7684\u4f18\u52bf\uff0c\u4e5f\u56e0\u4e3a Java \u76f8\u5173\u7684\u751f\u6001\u975e\u5e38\u5e9e\u5927\uff0c\u5c24\u5176\u662f\u56fd\u5185\u7684\u91d1\u878d\u7cfb\u7edf\u5f88\u591a\u90fd\u662f\u57fa\u4e8e Java \u7684\uff0c\u8fd9\u5bfc\u81f4\u6709\u6bb5\u65f6\u95f4\u5927\u5bb6\u90fd\u8bef\u4ee5\u4e3a\u6240\u6709\u7684\u7cfb\u7edf\u90fd\u662f\u7528 Java \u505a\u7684\u3002\\n\\n\u8fd1 15\uff5e20 \u5e74\u4ee5\u6765\uff0c\u5927\u90e8\u5206\u91d1\u878d\u7cfb\u7edf\u57fa\u672c\u90fd\u9009\u62e9\u4e86 Java \u6280\u672f\u6808\uff0c\u6df1\u7a76\u5176\u539f\u56e0\uff0c\u6211\u4eec\u8ba4\u4e3a\u4e3b\u8981\u662f\u56e0\u4e3a Java \u6280\u672f\u6808\u6709\u4ee5\u4e0b\u51e0\u70b9\u4f18\u52bf\u3002\\n\\n![Java \u6280\u672f\u6808\u4f18\u52bf](https://static.apiseven.com/2022/10/10/6343d598b7c94.png)\\n\\n\u6b63\u662f\u5982\u6b64\uff0cJava \u9010\u6e10\u5f97\u5230\u4e86\u91d1\u878d\u7c7b\u8f6f\u4ef6\u7cfb\u7edf\u7684\u9752\u7750\u3002\\n\\n### \u4e91\u539f\u751f\u65f6\u4ee3\u4e0b\u7684 Java \u73b0\u72b6\\n\\n\u968f\u7740\u6280\u672f\u884c\u4e1a\u7684\u5feb\u901f\u53d1\u5c55\uff0c\u5355\u4f53\u67b6\u6784\u9010\u6e10\u88ab\u6dd8\u6c70\uff0c\u5fae\u670d\u52a1\u548c\u4e91\u539f\u751f\u65f6\u4ee3\u6b63\u5728\u98ce\u9761\u56db\u6d77\u3002\u7136\u800c\u5728\u8fd1\u51e0\u5e74\u7684\u6280\u672f\u5927\u73af\u5883\u4e0b\uff0c\u4f5c\u4e3a\u9762\u5411\u5bf9\u8c61\u7684\u9ad8\u7ea7\u8bed\u8a00\uff0cJava \u4e5f\u5728\u4e00\u4e9b\u4e1a\u52a1\u573a\u666f\u4e2d\u5f00\u59cb\u7565\u663e\u75b2\u60eb\uff1a\\n\\n![\u4e91\u539f\u751f\u65f6\u4ee3\u4e0b\u7684 Java \u4e0d\u8db3](https://static.apiseven.com/2022/10/10/6343d598b6124.png)\\n\\n\u9996\u5148\uff0cJava \u6027\u80fd\u8f83\u4f4e\uff0c\u8fd9\u70b9\u5bf9\u6bd4\u4e00\u4e0b C \u8bed\u8a00\u76f8\u5173\u6280\u672f\u6808\u5c31\u4f1a\u660e\u767d\u3002Java \u662f\u57fa\u4e8e\u865a\u62df\u673a\uff0c\u5b83\u7684\u5185\u5b58\u7ba1\u7406\u662f\u4ea4\u7ed9\u865a\u62df\u673a\u6765\u89e3\u51b3\u7684\uff0c\u6240\u4ee5\u5f53\u9762\u5bf9\u4e00\u4e9b\u9ad8\u6027\u80fd\u6216\u52a8\u6001\u53d8\u5316\u7684\u4e1a\u52a1\u573a\u666f\u65f6\uff0cJava \u8bed\u8a00\u5728\u5904\u7406\u4e0a\u6ca1\u6709\u90a3\u4e48\u5f3a\u52bf\u3002\\n\\n\u5176\u6b21\uff0cJava \u8bed\u8a00\u9700\u8981\u66f4\u591a\u7684\u8d44\u6e90\u3002\u4e00\u4e2a\u67b6\u6784\u7684\u6253\u9020\u5982\u679c\u4e0d\u8003\u8651\u6210\u672c\uff0c\u5f88\u591a\u95ee\u9898\u90fd\u5f88\u597d\u89e3\u51b3\uff0c\u4f46\u5728\u4e91\u539f\u751f\u65f6\u4ee3\u4e0b\uff0c\u6240\u6709\u7684\u8d44\u6e90\u8ba1\u7b97\u53d8\u5f97\u8d8a\u6765\u8d8a\u7ec6\u3001\u8d8a\u6765\u8d8a\u9897\u7c92\u5316\u3002Java \u5728\u8fd0\u4f5c\u65f6\u9700\u8981\u6d88\u8017\u5927\u91cf\u7684\u8d44\u6e90\uff0c\u7531\u4e8e Java \u5206\u91cf\u91cd\u548c\u9700\u8981\u91cd\u542f\u7684\u57fa\u7840\u7279\u6027\uff0c\u56e0\u6b64\u5728\u9ad8 QPS \u6216\u8005\u4e1a\u52a1\u8fde\u7eed\u6027\u8981\u6c42\u8f83\u9ad8\u7684\u573a\u666f\u4e0b\uff0c\u8be5\u8bed\u8a00\u4f1a\u66f4\u5bb9\u6613\u51fa\u73b0\u95ee\u9898\u3002\\n\\n\u6700\u540e\u5c31\u662f\u6307\u9488\u53d8\u91cf\u7684\u95ee\u9898\u3002\u4e60\u60ef\u4e8e\u5199 C/C++ \u8bed\u8a00\u7684\u540c\u5b66\u90fd\u77e5\u9053\uff0c\u6307\u9488\u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u8d44\u6e90\u3002\u4f46 Java \u662f\u57fa\u4e8e\u865a\u62df\u673a\uff0c\u5b83\u628a\u5185\u5b58\u7ba1\u7406\u4ea4\u7ed9\u4e86 GC\uff08Garbage Collection\uff09\uff0c\u800c\u4e0d\u662f\u7531\u624b\u52a8\u7a0b\u5e8f\u8fdb\u884c\u7ba1\u7406\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4e00\u4e9b\u7279\u5b9a\u60c5\u51b5\u6216\u8005\u9ad8\u5e76\u53d1\u3001\u9ad8\u8bbf\u95ee\u91cf\u548c\u9ad8\u6027\u80fd\u7684\u573a\u666f\u4e0b\uff0cJava \u7684\u5b9e\u9645\u6027\u80fd\u53ef\u80fd\u5c31\u7565\u663e\u4e0d\u8db3\u4e86\u3002\\n\\n## \u8fd8\u5457\u4e3a\u4f55\u9009\u62e9 APISIX\uff1f\\n\\n\u6570\u79be\u79d1\u6280\u662f\u4e00\u5bb6\u63d0\u4f9b\u667a\u80fd\u5316\u91d1\u878d\u7684\u670d\u52a1\u5e73\u53f0\uff0c\u65d7\u4e0b\u4e3b\u8981\u4ea7\u54c1\u6709\u8fd8\u5457\u3001\u8fd8\u4eab\u82b1\u7b49\u3002\u8fd8\u5457 APP \u662f\u4e00\u6b3e\u57fa\u4e8e\u6d88\u8d39\u591a\u573a\u666f\u7684\u5206\u671f\u670d\u52a1\u5e73\u53f0\uff0c\u901a\u8fc7\u4e0e\u6301\u724c\u91d1\u878d\u673a\u6784\u5408\u4f5c\uff0c\u4e3a\u5927\u4f17\u63d0\u4f9b\u4e2a\u4eba\u6d88\u8d39\u4fe1\u8d37\u670d\u52a1\uff0c\u5e76\u4e3a\u5c0f\u5fae\u4f01\u4e1a\u4e3b\u63d0\u4f9b\u8d37\u6b3e\u8d44\u91d1\u652f\u6301\u3002\u5728\u4e1a\u52a1\u67b6\u6784\u5c42\u9762\uff0c\u8fd8\u5457\u7684\u4ea7\u54c1\u5b9e\u73b0\u4e00\u76f4\u662f\u4f9d\u8d56 Java \u6280\u672f\u6808\u7684\u3002\\n\\nSpring Cloud Gateway \u662f Spring Cloud \u751f\u6001\u4e0b\u4e3a\u66f4\u597d\u7ba1\u7406\u5fae\u670d\u52a1\u800c\u8bde\u751f\u7684\u7f51\u5173\u9879\u76ee\uff0c\u5bf9\u4e8e\u516c\u53f8\u4e1a\u52a1\u4ee5 Java \u4e3a\u4e3b\u8981\u5f00\u53d1\u8bed\u8a00\u7684\u60c5\u51b5\u4e0b\uff0cSpring Cloud Gateway \u901a\u5e38\u662f\u4e2a\u4e0d\u9519\u7684 API \u7f51\u5173\u9009\u62e9\u3002**\u4f46\u5728\u8fd1\u671f\u7684 API \u7f51\u5173\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u5457\u653e\u5f03\u4e86\u4f7f\u7528\u5df2\u4e45\u7684 Spring Cloud Gateway\uff0c\u9009\u62e9\u4e86 Apache APISIX**\u3002\\n\\n### \u67b6\u6784\u7684\u524d\u540e\u53d8\u5316\\n\\n\u5728\u67b6\u6784\u5c42\u9762\uff0c\u8fd8\u5457\u5728\u4f7f\u7528 APISIX \u524d\u540e\u5448\u73b0\u4e86\u5982\u4e0b\u56fe\u6240\u793a\u7684\u53d8\u5316\u3002\\n\\n![\u5e94\u7528 APISIX \u67b6\u6784\u53d8\u5316](https://static.apiseven.com/2022/10/10/6343d5999838a.png)\\n\\n\u5728\u5de6\u4fa7\u7684\u4f7f\u7528\u524d\u67b6\u6784\u4e2d\uff0c\u8fd8\u5457\u4e00\u5171\u4f7f\u7528\u4e86\u4e09\u5957\u7f51\u5173\u7cfb\u7edf\uff0c\u5e76\u628a\u7f51\u5173\u5206\u4e3a\u5165\u53e3\u7f51\u5173\u548c\u51fa\u53e3\u7f51\u5173\u4e24\u5927\u7c7b\u3002\u5176\u4e2d\u5728\u8fd0\u8425\u7cfb\u7edf\u7f51\u5173\u548c\u51fa\u53e3\u7cfb\u7edf\u7f51\u5173\u4e2d\uff0c\u90fd\u4f7f\u7528\u4e86 Spring Cloud Gateway \u4f5c\u4e3a\u7f51\u5173\uff0c\u800c\u5728\u4e1a\u52a1\u7cfb\u7edf\u7f51\u5173\u4e2d\u5219\u4f7f\u7528\u4e86 OpenResty \u4f5c\u4e3a\u4e1a\u52a1\u7cfb\u7edf\u7f51\u5173\u3002\\n\\n\u5bf9\u4e8e\u4e00\u5f00\u59cb\u4f7f\u7528 Spring Cloud Gateway \u4f5c\u4e3a\u8fd0\u8425\u548c\u51fa\u53e3\u7cfb\u7edf\u7f51\u5173\uff0c\u4e3b\u8981\u662f\u770b\u4e2d\u4e86 Spring Cloud \u5e9e\u5927\u7684\u751f\u6001\u7cfb\u7edf\uff0c\u4ee5\u53ca\u7b80\u5355\u6613\u90e8\u7f72\u548c\u6613\u7ef4\u62a4\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u5f00\u53d1\u6846\u67b6\uff0c\u6240\u4ee5\u5728\u65e9\u671f\u8fdb\u884c\u4e1a\u52a1\u67b6\u6784\u90e8\u7f72\u65f6\uff0c\u4e3a\u4e86\u66f4\u5feb\u642d\u5efa\u8d77\u4e1a\u52a1\u800c\u9009\u62e9\u4f7f\u7528 Spring Cloud \u5168\u5bb6\u6876\u3002\\n\\n\u4f46\u968f\u7740\u4e1a\u52a1\u6162\u6162\u53d1\u5c55\uff0c\u539f\u5148\u67b6\u6784\u4e2d\u7684\u7f51\u5173\u5f00\u59cb\u51fa\u73b0\u4e00\u4e9b\u7a33\u5b9a\u6027\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u5185\u5b58\u6ea2\u51fa\u3001CPU \u4f7f\u7528\u7387\u8fc7\u9ad8\u7b49\u60c5\u51b5\u3002\u4e3a\u4e86\u5347\u7ea7\u7f51\u5173\u6027\u80fd\u53ca\u7edf\u4e00\u591a\u4e2a\u7f51\u5173\uff0c\u8fd8\u5457\u5c06\u67b6\u6784\u4e2d\u7684\u7f51\u5173\u5168\u90e8\u7edf\u4e00\u66ff\u6362\u4e3a\u4e86 Apache APISIX\u3002\\n\\n\u5728\u65b0\u7f51\u5173\u67b6\u6784\u4e2d\uff0c\u4e1a\u52a1\u7cfb\u7edf\u7f51\u5173\u4f1a\u4f18\u5148\u628a\u8bf7\u6c42\u6d41\u91cf\u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u7684\u65b9\u5f0f\u76f4\u63a5\u8f6c\u53d1\u5230\u4e1a\u52a1\u7cfb\u7edf\u3002\u5982\u679c\u540e\u7aef\u5e94\u7528\u5728 Consul \u4e2d\u6ca1\u6709\u5065\u5eb7 Pod \u6216\u8005\u540e\u7aef\u5e94\u7528\u4e0d\u652f\u6301\u670d\u52a1\u53d1\u73b0\u7b49\uff0c\u5c31\u4f1a\u628a\u6d41\u91cf\u8f6c\u53d1\u5230\u4ee5\u524d\u7684\u5185\u7f51 K8s Ingress\uff0c\u4f5c\u4e3a\u515c\u5e95\u7684\u4e0a\u6e38\u6765\u4f7f\u7528\u3002\\n\\n\u65b0\u67b6\u6784\u540c\u65f6\u4e5f\u7edf\u4e00\u4e86\u51fa\u53e3\u7f51\u5173\u7684\u4e24\u4e2a\u5e94\u7528\uff0c\u65b0\u51fa\u53e3\u7f51\u5173\u90e8\u7f72\u5728 K8s \u96c6\u7fa4\u5916\u7684\u5916\u8054\u533a\u3002\u540c\u65f6\u4e5f\u5728\u51fa\u53e3\u7f51\u5173\u96c6\u7fa4\u524d\u65b0\u589e\u4e00\u4e2a SLB\uff0c\u53ef\u4ee5\u7edf\u4e00\u51fa\u53e3\u7f51\u5173\u7684\u5165\u53e3 \uff0c\u65b9\u4fbf\u6ca1\u6709\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u7684\u5e94\u7528\u6216\u8005\u5176\u4ed6 VPC \u5185\u7684\u7cfb\u7edf\u8c03\u7528\u3002\\n\\n### \u57fa\u4e8e APISIX \u7684\u5e94\u7528\u5b9e\u8df5\\n\\n\u5b9e\u9645\u4e1a\u52a1\u60c5\u51b5\u4e0b\uff0c\u7531\u4e8e\u5185\u90e8\u5df2\u5b58\u5728\u591a\u79cd\u7f51\u5173\u67b6\u6784\uff0c\u6ca1\u529e\u6cd5\u76f4\u63a5\u4f7f\u7528 Apache APISIX\uff0c\u4e8e\u662f\u8fd8\u5457\u57fa\u4e8e APISIX \u8fdb\u884c\u4e86\u4e00\u4e9b\u6539\u9020\u548c\u6784\u5efa\u3002\\n\\n#### APISIX \u6784\u5efa\u90e8\u7f72\\n\\n\u5728\u5185\u90e8\u8fdb\u884c\u5f00\u53d1\u65f6\uff0c\u5c06 APISIX \u7f51\u5173\u7684\u4ee3\u7801\u548c\u5b9a\u5236\u4ee3\u7801\u5b58\u653e\u5728\u4e0d\u540c\u8def\u5f84\u4e0b\uff0c\u4e24\u8005\u534f\u540c\u5de5\u4f5c\uff0c\u5404\u81ea\u53ef\u72ec\u7acb\u8fed\u4ee3\u3002\u5728\u90e8\u7f72\u65f6\u5219\u91c7\u7528 Docker \u955c\u50cf\u65b9\u5f0f\u90e8\u7f72\uff0c\u6784\u5efa\u4e00\u4e2a APISIX \u6307\u5b9a\u7248\u672c\u7684\u57fa\u7840\u955c\u50cf\uff0c\u7136\u540e\u518d\u628a\u81ea\u5b9a\u4e49\u4ee3\u7801\u6253\u5305\u5f62\u6210\u65b0\u955c\u50cf\u3002\\n\\n\u81ea\u5b9a\u4e49\u4ee3\u7801\u6253\u5305\u65f6\u6ca1\u6709\u4f7f\u7528 `lua_package_path` \u6765\u6307\u5b9a\u4ee3\u7801\u76ee\u5f55\uff0c\u800c\u662f\u76f4\u63a5\u8986\u76d6\u57fa\u7840\u955c\u50cf `apisix` \u6e90\u7801\u76ee\u5f55\uff0c\u5982\u679c\u6709\u540c\u540d\u6587\u4ef6\u5219\u8986\u76d6\u6e90\u7801\u6587\u4ef6\u3002Dockerfile \u5982\u4e0b\u6240\u793a\uff1a\\n\\n```dockerfile\\nFROM registry.xxx.net:5001/apisix-shuhe:v1.5\\nENV APP_NAME={{APP_NAME}}\\nCOPY {{PRODUCT_FILE}} /tmp/deploy2/artifact.tar.gz\\n\\nRUN mkdir /tmp/deploy/ && tar -xf /tmp/deploy2/artifact.tar.gz -C /tmp/deploy/ && \\\\\\ncp -R /tmp/deploy/apisix/ /usr/local/apisix/ && \\\\\\ncp /tmp/deploy/bin/apisix /usr/bin/apisix && \\\\\\ncp /tmp/deploy/conf/apisix-$APP_NAME.yaml /usr/local/apisix/conf/apisix.yaml && \\\\\\ncp /tmp/deploy/conf/config-$APP_NAME.yaml /usr/local/apisix/conf/config.yaml && \\\\\\nset -x && \\\\\\nbin=\'#! /usr/local/openresty/luajit/bin/luajit\\\\npackage.path = \\"/usr/local/apisix/?.lua;\\" .. package.path\' && \\\\\\nsed -i \\"1s@.*@$bin@\\" /usr/bin/apisix && \\\\\\nrm -rf /tmp/*\\n```\\n\\nAPISIX \u7684\u65e5\u5fd7\u9ed8\u8ba4\u5b58\u50a8\u5728\u672c\u5730\uff08\u4e5f\u53ef\u4ee5\u901a\u8fc7 Syslog \u7b49\u63d2\u4ef6\u6536\u96c6\uff09\uff0c\u901a\u8fc7\u8c03\u6574 `nginx` \u914d\u7f6e\u6a21\u677f\u548c\u5224\u65ad\u542f\u7528\u7684 Profile \u6765\u51b3\u5b9a\u65e5\u5fd7\u5b58\u50a8\u5728\u672c\u5730\u8fd8\u662f\u901a\u8fc7 Syslog \u5b58\u50a8\u5230 FLUENTD \u4e2d\u3002\u540c\u65f6\u5728\u6784\u5efa\u955c\u50cf\u65f6\u66ff\u6362\u6a21\u677f\u4e2d `FLUENTD_HOST` \u53d8\u91cf\u3002\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```nginx\\n{% if gw_profile and string.find( gw_profile,\'local\') then %}\\naccess_log logs/access.log main;error_log  logs/\\nerror.log warn;\\n{%else%}\\naccess_log syslog:server=${FLUENTD_HOST}:5141 json_format;\\nerror_log  syslog:server=${FLUENTD_HOST}:5142 warn;\\n{%end%}\\n```\\n\\n\u5728 `nginx` \u914d\u7f6e\u6a21\u677f\u4e2d\uff0c\u8fd8\u5457\u4e0d\u5149\u4fee\u6539\u4e86\u65e5\u5fd7\u5b58\u50a8\uff0c\u8fd8\u8c03\u6574\u4e86\u5faa\u73af\u6dfb\u52a0 ENV \u73af\u5883\u53d8\u91cf\u3001\u5faa\u73af\u6dfb\u52a0 lua_shared_dicts \u914d\u7f6e\u53ca\u5199\u6b7b\u4e00\u4e9b NGINX \u5176\u4ed6\u8c03\u4f18\u53c2\u6570\u3002\\n\\n\u56e0\u4e3a\u516c\u53f8\u662f\u6309\u7167\u4e1a\u52a1\u6d41\u91cf\u5212\u5206\u4e3a\u591a\u79cd\u7f51\u5173\uff0c\u8fd9\u4e9b\u7f51\u5173\u7684\u57fa\u672c\u529f\u80fd\u90fd\u5dee\u4e0d\u591a\uff0c\u56e0\u6b64\u8fd8\u5457\u5185\u90e8\u91c7\u53d6\u4e86\u300c\u4e00\u5957\u4ee3\u7801\u90e8\u7f72\u591a\u4e2a\u7f51\u5173\u5e94\u7528\u300d\u65b9\u6848\u3002\u901a\u8fc7 Profile \u529f\u80fd\u914d\u7f6e\u5404\u4e2a\u7f51\u5173\u7684 config-xxx.yaml \u6587\u4ef6\uff0c\u7136\u540e\u901a\u8fc7\u516c\u53f8 DEVOPS \u5e73\u53f0\u6784\u5efa\u955c\u50cf\u65f6\uff0c\u6839\u636e\u5e94\u7528\u540d\u6784\u5efa\u4e0d\u540c\u7f51\u5173\u7684 Docker \u955c\u50cf\u5373\u53ef\u3002\\n\\n#### \u516c\u53f8\u7ea7\u5b9a\u5236\u63d2\u4ef6\\n\\n\u5728\u5185\u90e8\u8bbf\u95ee\u8fd0\u8425\u7cfb\u7edf\u9875\u9762\u65f6\uff0c\u4f1a\u8c03\u7528\u5f88\u591a\u540e\u7aef\u7684 API \u83b7\u53d6\u6570\u636e\uff0c\u8fd9\u4e9b API \u90fd\u9700\u8981\u5728 API \u7f51\u5173\u4e2d\u914d\u7f6e\u5bf9\u5e94\u7684\u767d\u540d\u5355\u3002\u5728\u9875\u9762\u4e2d\u6839\u636e\u767b\u5f55\u8fd0\u8425\u7cfb\u7edf\u7528\u6237\u7684\u89d2\u8272\u4e0d\u540c\uff0c\u80fd\u591f\u8bbf\u95ee\u7684 API \u8303\u56f4\u4e5f\u4e0d\u4e00\u6837\uff0c\u56e0\u6b64\u6743\u9650\u7cfb\u7edf\u4e5f\u9700\u8981\u7ef4\u62a4\u76f8\u5173 API \u5217\u8868\u3002\u6bcf\u5f53\u5728\u9875\u9762\u4e0a\u65b0\u589e\u540e\u7aef API \u8c03\u7528\u65f6 \uff0c\u90fd\u9700\u8981\u5f00\u53d1\u4eba\u5458\u5728\u7f51\u5173\u9875\u9762\u53ca\u6743\u9650\u7cfb\u7edf\u9875\u9762\u914d\u7f6e\u4e24\u6b21\uff0c\u5de5\u4f5c\u5197\u4f59\u4e14\u91cd\u590d\u3002\\n\\n\u4e3a\u6b64\uff0c\u8fd8\u5457\u628a\u7f51\u5173\u914d\u7f6e\u4e0e\u6743\u9650\u7cfb\u7edf\u914d\u7f6e\u6253\u901a\uff0c\u53ea\u4fdd\u7559\u6743\u9650\u914d\u7f6e\u7cfb\u7edf\u7684\u914d\u7f6e\u5165\u53e3\uff0c\u7f51\u5173\u914d\u7f6e\u7ba1\u7406\u7cfb\u7edf\u5219\u5b9a\u65f6\u62c9\u53d6\u6743\u9650 API\uff0c\u4e4b\u540e\u8f6c\u6362\u6210\u7f51\u5173 API \u767d\u540d\u5355\u914d\u7f6e\u3002\u8fd9\u6837\u505a\u4e0d\u4ec5\u80fd\u51cf\u5c11\u7528\u6237\u4e00\u6b21\u914d\u7f6e\u64cd\u4f5c\uff0c\u540c\u65f6\u4e5f\u534f\u52a9\u6743\u9650\u7cfb\u7edf\u8fdb\u884c\u4e86\u6743\u9650\u7ba1\u63a7\u3002\u53ef\u4ee5\u4fdd\u8bc1\u5728\u8fd0\u8425\u9875\u9762\u8c03\u7528\u7684\u540e\u7aef API\uff0c\u4e00\u5b9a\u662f\u5728\u6743\u9650\u7cfb\u7edf\u914d\u7f6e\u4e86\u76f8\u5173\u6743\u9650\u3002\\n\\n![\u914d\u7f6e\u6d41\u7a0b](https://static.apiseven.com/2022/10/10/6343d724c78cb.png)\\n\\n\u5728\u516c\u53f8\u7684\u5b9e\u9645\u4e1a\u52a1\u4e2d\uff0c\u7ecf\u5e38\u4f1a\u9047\u5230\u539f\u751f\u63d2\u4ef6\u4e0d\u80fd\u6ee1\u8db3\u5b9e\u9645\u9700\u6c42\u7684\u60c5\u51b5\uff0c\u5c31\u9700\u8981\u5b9a\u5236\u5f00\u53d1\u3002\u597d\u5728 APISIX \u63d0\u4f9b\u4e86\u5f88\u591a\u5de5\u5177\u7c7b\uff0c\u53c2\u7167\u539f\u751f\u63d2\u4ef6\u5c31\u53ef\u4ee5\u8f7b\u677e\u5b9e\u73b0\uff0c\u5f00\u53d1\u8fc7\u7a0b\u4e5f\u975e\u5e38\u7b80\u5355\u3002\u4ee5\u4e0b\u5217\u4e3e\u4e86\u8fd8\u5457\u5185\u90e8\u57fa\u4e8e APISIX \u8fdb\u884c\u7684\u5176\u4ed6\u5b9a\u5236\u63d2\u4ef6\uff1a\\n\\n![\u5185\u90e8\u63d2\u4ef6\u793a\u4f8b](https://static.apiseven.com/2022/10/10/6343d59a4de5a.png)\\n\\n#### \u7f51\u5173\u6d41\u91cf\u7070\u5ea6\\n\\n\u4e4b\u524d\u8fd8\u5457\u4f7f\u7528\u7684 K8s \u5bb9\u5668\u662f OpenShift\uff08\u73b0\u5df2\u5347\u7ea7\u4e3a ACK \u96c6\u7fa4\uff09\uff0c\u5176\u4e2d Ingress \u662f Haproxy \u642d\u5efa\u3002\u7531\u4e8e\u516c\u7f51 K8s Ingress \u7684 Haproxy \u4e0d\u80fd\u628a\u4e00\u4e2a\u57df\u540d\u7684\u6d41\u91cf\u8f6c\u53d1\u5230\u4e24\u4e2a Namespace \u7684\u8def\u7531\u4e2d\uff0c\u56e0\u6b64\u8003\u8651\u628a\u65b0\u7f51\u5173\u90e8\u7f72\u5728\u548c\u8001\u7f51\u5173\u76f8\u540c\u7684 Namespace \u4e0b\u3002\u5373\u57df\u540d\u7684\u8def\u7531\u4e0b\u6302\u8f7d\u591a\u4e2a\u670d\u52a1\uff0c\u4e4b\u540e\u4fbf\u53ef\u4ee5\u901a\u8fc7\u8def\u7531\u8c03\u6574\u6d41\u91cf\u6bd4\u4f8b\uff0c\u63a7\u5236\u6d41\u91cf\u8d70\u65b0\u7f51\u5173\u8fd8\u662f\u8001\u7f51\u5173\u3002\\n\\n\u5177\u4f53\u5b9e\u65bd\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5728\u8001\u7f51\u5173\u7684 Namespace \u4e0b\u65b0\u589e c\u3001d \u7ec4\u7528\u4e8e\u90e8\u7f72\u65b0\u7f51\u5173\uff0c\u901a\u8fc7\u8def\u7531\u63a7\u5236\u65b0\u8001\u7f51\u5173\u7684\u6d41\u91cf\u6bd4\u4f8b\u3002\\n\\n![\u5b9e\u65bd\u6d41\u7a0b\u56fe](https://static.apiseven.com/2022/10/10/6343d59a4bb73.png)\\n\\n## Java \u5c42\u9762\u7f51\u5173\u7684\u8003\u8651\u56e0\u7d20\\n\\n\u5f88\u591a Java \u5de5\u7a0b\u5e08\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u90fd\u4f1a\u9009\u62e9 Spring Cloud\uff0c\u4e3b\u8981\u662f\u8bed\u8a00\u7ed1\u5b9a\uff0c\u5e76\u7528\u7c7b\u5e93\u7684\u65b9\u5f0f\u653e\u5728\u4ee3\u7801\u91cc\u3002\u4f46\u662f\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u5347\u7ea7\u56f0\u96be\u7684\u60c5\u51b5\uff0c\u5982\u679c\u56e2\u961f\u662f\u591a\u8bed\u8a00\u5c31\u9700\u8981\u7ef4\u62a4\u591a\u4e2a\u7c7b\u5e93\uff0c\u5047\u8bbe\u6709 10 \u4e2a\u7248\u672c\u4e0e 10 \u79cd\u8bed\u8a00\uff0c\u5c31\u9700\u8981\u7ef4\u62a4 100 \u4e2a\u7c7b\u5e93\u3002\\n\\n\u6b64\u65f6\u5c31\u53ef\u4ee5\u901a\u8fc7\u4ee3\u7406\u7684\u65b9\u5f0f\uff08\u5373 API \u7f51\u5173\uff09\u628a\u591a\u7248\u672c\u548c\u591a\u8bed\u8a00\u7684\u95ee\u9898\u8f7b\u677e\u89e3\u51b3\u3002\u90a3 Java \u6280\u672f\u6808\u516c\u53f8\u9009\u62e9 APISIX \u4f5c\u4e3a API \u7f51\u5173\u540e\u90fd\u6709\u54ea\u4e9b\u6536\u76ca\uff1f\u6211\u4eec\u6839\u636e\u8fd8\u5457\u7684\u5b9e\u8df5\u7ecf\u5386\uff0c\u4ece\u4ee5\u4e0b\u4e24\u4e2a\u89d2\u5ea6\u8fdb\u884c\u4e86\u603b\u7ed3\u3002\\n\\n### \u516c\u53f8\u89d2\u5ea6\\n\\n1. **\u529f\u80fd\u4e0e\u6027\u80fd\u517c\u5177**\\n\\n    \u8fd8\u5457\u5728\u5185\u90e8\u4f7f\u7528 4 \u6838\u865a\u62df\u673a\u65e0\u63d2\u4ef6\u7a7a\u8dd1\u538b\u6d4b APISIX \u7684 QPS \u53ef\u4ee5\u8fbe\u5230 80K\uff0c\u5f88\u597d\u5730\u89e3\u51b3\u4e86 Spring Cloud Gateway \u5728\u627f\u63a5 C \u7aef\u6d41\u91cf\u65f6\u51fa\u73b0\u7684\u6027\u80fd\u95ee\u9898\uff0c**\u800c\u4e14\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u53d1\u73b0 APISIX \u76f8\u8f83\u4e8e\u4e4b\u524d\u7f51\u5173\u6027\u80fd\u63d0\u5347\u4e86 30% \u4ee5\u4e0a\u3002**\\n\\n    ![\u6027\u80fd\u6570\u636e](https://static.apiseven.com/2022/10/10/6343d59b244bc.png)\\n\\n    \u5176\u6b21\uff0c\u5f97\u76ca\u4e8e\u4e91\u539f\u751f\u5c5e\u6027\uff0cAPISIX \u5728\u5b9e\u9645\u7684\u6d4b\u8bd5\u4e2d\u5b8c\u5168\u53ef\u4ee5\u6ee1\u8db3\u516c\u53f8\u7684\u9700\u6c42\uff0c\u6bd4\u5982\u8ba4\u8bc1\u9274\u6743\u3001\u53ef\u89c2\u6d4b\u6027\u3001\u670d\u52a1\u53d1\u73b0\u3001\u9650\u6d41\u9650\u901f\u4ee5\u53ca\u56db\u5c42\u548c\u4e03\u5c42\u6d41\u91cf\u8f6c\u53d1\u3002\u800c\u5728\u529f\u80fd\u6269\u5c55\u65b9\u9762\uff0cAPISIX \u4e5f\u652f\u6301\u4e86 70 \u4f59\u6b3e\u63d2\u4ef6\uff0c\u5927\u90e8\u5206\u7684\u4e1a\u52a1\u53ef\u4ee5\u4f7f\u7528\u5176\u539f\u751f\u63d2\u4ef6\uff0c\u5f88\u5927\u7a0b\u5ea6\u4e0a\u51cf\u5c11\u4e86\u5f00\u53d1\u5de5\u4f5c\u3002\\n\\n2. **\u4e1a\u52a1\u652f\u51fa\u6210\u672c\u4e0b\u964d**\\n\\n    \u5728\u4f7f\u7528 APISIX \u4e4b\u524d\uff0c\u5982\u679c\u6027\u80fd\u51fa\u73b0\u4e86\u74f6\u9888\uff0c\u516c\u53f8\u53ea\u80fd\u901a\u8fc7\u4e0d\u65ad\u7684\u589e\u52a0\u670d\u52a1\u5668\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u56e0\u6b64\u76f8\u5e94\u7684\u786c\u4ef6\u6210\u672c\u4e5f\u4f1a\u975e\u5e38\u7684\u9ad8\u3002\\n\\n    \u8fd8\u5457\u5728\u8fdb\u884c\u6210\u672c\u8ba1\u7b97\u65f6\u53d1\u73b0\uff0c\u4f7f\u7528 APISIX \u540e\uff0c\u670d\u52a1\u5668\u7684\u6570\u91cf\u5927\u6982**\u51cf\u5c11\u4e86 60% \u5de6\u53f3**\u3002\u7edf\u4e00\u6280\u672f\u6808\u540e\uff0c\u4e1a\u52a1\u4e0a\u4e5f\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u57fa\u4e8e APISIX \u539f\u751f\u6846\u67b6\u5b9e\u73b0\u529f\u80fd\u7684\u6269\u5c55\uff0c\u8282\u7701\u4e86\u5f00\u53d1\u6210\u672c\uff0c\u52a0\u5feb\u4e86\u9879\u76ee\u4e0a\u7ebf\u65f6\u95f4\u901f\u5ea6\u3002\\n\\n### \u5f00\u53d1\u8005\u89d2\u5ea6\\n\\n1. **\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42**\\n\\n    \u4e1a\u52a1\u4e2d\u6240\u4f7f\u7528\u7684\u8f6f\u4ef6\u6216\u6280\u672f\u90fd\u5e94\u8be5\u662f\u4e3a\u9700\u6c42\u800c\u670d\u52a1\u3002\u4ece\u5b9e\u9645\u6d4b\u8bd5\u7ed3\u679c\u53ca\u8c03\u7814\u6570\u636e\u6765\u770b\uff0cAPISIX \u7684\u7a33\u5b9a\u6027\u3001\u53ef\u89c2\u6d4b\u6027\u3001\u53ef\u6269\u5c55\u6027\u4f1a\u66f4\u597d\u3002\\n\\n    \u8f6f\u4ef6\u6700\u7ec8\u670d\u52a1\u4e8e\u4e1a\u52a1\u3002\u5982\u679c\u4e1a\u52a1\u9700\u8981\uff0c\u53ef\u4ee5\u4e3a\u516c\u53f8\u8282\u7ea6\u8d44\u6e90\uff0c\u90a3\u4e48\u65e0\u8bba\u516c\u53f8\u7684\u6280\u672f\u6808\u662f\u4ec0\u4e48\uff0c\u90fd\u4f1a\u4f7f\u7528\u6700\u7b26\u5408\u516c\u53f8\u4e1a\u52a1\u7684\u7ec4\u4ef6\u3002\\n\\n2. **\u964d\u4f4e\u7ef4\u62a4\u6210\u672c**\\n\\n    \u76f8\u6bd4\u4e4b\u524d\u4f7f\u7528\u7684 OpenResty\uff0cAPISIX \u7684\u5b66\u4e60\u6210\u672c\u76f8\u5bf9\u8f83\u4f4e\uff0c\u7ef4\u62a4\u8d77\u6765\u4e5f\u6bd4\u8f83\u7701\u5fc3\u3002\u540c\u65f6\uff0cAPISIX \u4e30\u5bcc\u7684\u63d2\u4ef6\u7b80\u5316\u4e86\u4e00\u4e9b\u901a\u7528\u529f\u80fd\u7684\u5b9e\u73b0\u4e0e\u90e8\u7f72\uff0c\u5927\u5927\u8282\u7ea6\u4e86\u9879\u76ee\u4e0a\u7ebf\u7684\u65f6\u95f4\u3002\\n\\n    \u540c\u65f6\u5229\u7528 APISIX \u5f3a\u5927\u7684\u65e5\u5fd7\u548c\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\uff0c\u4e1a\u52a1\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u6392\u67e5\u51fa\u6545\u969c\u70b9\uff0c\u4ece\u800c\u5feb\u901f\u5b9a\u4f4d\u3001\u8282\u7ea6\u65f6\u95f4\u3002\\n\\n## \u603b\u7ed3\uff1a\u91d1\u878d\u4e1a\u52a1\u53d1\u5c55\u8d8b\u52bf\\n\\n\u5728\u8fc7\u53bb\u7684\u5341\u5e74\u91cc\uff0c\u4e92\u8054\u7f51\u91d1\u878d\u4ece\u300c\u91ce\u86ee\u751f\u957f\u300d\u5f00\u59cb\u9010\u6e10\u5411\u300c\u7cbe\u8015\u7ec6\u4f5c\u300d\u6a21\u5f0f\u8f6c\u53d8\uff0c\u8fd9\u4e2a\u8f6c\u53d8\u4e3b\u8981\u6d89\u53ca\u5230\u7684\u5c31\u662f\u7cfb\u7edf\u7684\u53d8\u9769\u3002\\n\\n\u5728\u91ce\u86ee\u751f\u957f\u9636\u6bb5\uff0c\u4e1a\u52a1\u8bb2\u7a76\u7684\u662f\u6548\u7387\u3002\u4e3a\u4e86\u4e1a\u52a1\u66f4\u5feb\u901f\u5730\u5efa\u8bbe\uff0c\u5728\u57fa\u7840\u67b6\u6784\u9009\u62e9\u7684\u65f6\u5019\uff0c\u8d1f\u8d23\u4eba\u66f4\u591a\u662f\u9009\u62e9\u81ea\u5df1\u719f\u6089\u7684\u8bed\u8a00\u67b6\u6784\u8fdb\u884c\u642d\u5efa\u3002\u4e0d\u540c\u7684\u8d1f\u8d23\u4eba\u4fbf\u4f1a\u9009\u62e9\u4f7f\u7528\u4e0d\u540c\u7684\u6280\u672f\u6808\uff0c\u56e0\u6b64\u7559\u4e0b\u4e86\u5f88\u591a\u6280\u672f\u503a\u52a1\u3002\u4ece 2017 \u5e74\u5f00\u59cb\uff0c\u4f9d\u65e7\u6d3b\u8dc3\u7684\u91d1\u878d\u4f01\u4e1a\u6216\u670d\u52a1\u516c\u53f8\u5927\u591a\u90fd\u4f1a\u9762\u4e34\u540c\u6837\u7684\u6280\u672f\u73b0\u72b6\uff0c\u90a3\u5c31\u662f\u5b58\u5728\u591a\u5957\u6280\u672f\u7ec4\u4ef6\u3002\u8fd9\u65f6\u5c31\u9700\u8981\u8fdb\u884c\u57fa\u7840\u8bbe\u65bd\u7684\u7edf\u4e00\u3002\\n\\n\u6765\u5230\u7cbe\u8015\u7ec6\u4f5c\u9636\u6bb5\uff0c\u4f01\u4e1a\u5c31\u9700\u8981\u5bf9\u7cfb\u7edf\u8fdb\u884c\u5782\u76f4\u62c6\u5206\uff0c\u7531\u4ee5\u524d\u7684\u70df\u56f1\u5f0f\u62c6\u5206\u6210\u524d\u53f0\u3001\u4e2d\u53f0\u53ca\u540e\u53f0\u7b49\u6a21\u5f0f\u3002\u7cfb\u7edf\u5230\u8fbe\u4e00\u4e2a\u7a33\u5b9a\u9636\u6bb5\u65f6\uff0c\u5c31\u9700\u8981\u628a\u4e00\u4e9b\u4e1c\u897f\u592f\u5b9e\u4e0b\u6765\u3002\\n\\n\u800c\u7cfb\u7edf\u5efa\u8bbe\u7684\u6839\u672c\u76ee\u7684\u5176\u5b9e\u5c31\u662f\u4e3a\u4e86\u5171\u7528\u3002\u91cd\u590d\u6027\u4f7f\u7528\u8d8a\u5f3a\uff0c\u7cfb\u7edf\u7684\u8fd0\u7ef4\u6210\u672c\u5c31\u8d8a\u4f4e\u3002\u6240\u4ee5\u5f88\u591a\u516c\u53f8\u5230\u4e86\u7cbe\u8015\u7ec6\u4f5c\u9636\u6bb5\uff0c\u8981\u4e48\u662f\u8fdb\u884c\u7cfb\u7edf\u7684\u5782\u76f4\u62c6\u5206\uff0c\u8981\u4e48\u5c31\u662f\u8fdb\u884c\u57fa\u7840\u7ec4\u4ef6\u7684\u4e0b\u6c89\uff0c\u8fdb\u800c\u63a7\u5236\u8fd0\u7ef4\u6210\u672c\u3002\\n\\n\u4f5c\u4e3a\u4f01\u4e1a\u6765\u8bf4\uff0c\u6210\u672c\u4f18\u5148\u4f9d\u65e7\u662f\u9700\u8981\u8003\u8651\u7684\u539f\u5219\u3002\u91ce\u86ee\u751f\u957f\u9636\u6bb5\u53ef\u80fd\u53ea\u9700\u8981\u5c3d\u5feb\u5b9e\u73b0\u4e1a\u52a1\uff0c\u800c\u5728\u76ee\u524d\u5927\u73af\u5883\u4e0b\uff0c\u9884\u7b97\u8303\u56f4\u4e4b\u5185\u80af\u5b9a\u662f\u6210\u672c\u4f18\u5148\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u6548\u7387\u548c\u6210\u672c\u6c38\u8fdc\u53ea\u80fd\u4fdd\u4f4f\u4e00\u9879\u3002\u56e0\u6b64\u5728\u6210\u672c\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u4f01\u4e1a\u5c31\u4f1a\u5c11\u8c08\u6280\u672f\u7684\u5148\u8fdb\u6027\u3002\u6280\u672f\u4eba\u5458\u5728\u9009\u578b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5c31\u4e0d\u4f1a\u8003\u8651\u5f53\u4e0b\u9009\u62e9\u7684\u8fd9\u4e2a\u6280\u672f\u5bf9\u56e2\u961f\u6709\u591a\u5927\u51b2\u51fb\u3001\u5bf9\u73b0\u6709\u7684\u8fd0\u7ef4\u548c\u67b6\u6784\u5e26\u6765\u591a\u5c11\u6536\u76ca\u7b49\u7b49\uff0c\u66f4\u591a\u662f\u4ece\u6210\u672c\u89d2\u5ea6\u8003\u8651\u3002"},{"id":"APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff01\u5e26\u6765\u4e30\u5bcc\u529f\u80fd\u4e0e\u8fed\u4ee3\u7ec6\u8282","metadata":{"permalink":"/zh/blog/2022/09/28/apache-apisix-3.0.0-beta-release","source":"@site/blog/2022/09/28/apache-apisix-3.0.0-beta-release.md","title":"APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff01\u5e26\u6765\u4e30\u5bcc\u529f\u80fd\u4e0e\u8fed\u4ee3\u7ec6\u8282","description":"Apache APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff0c\u4e3a\u4f60\u6574\u7406\u4e86\u6b64\u6b21\u9884\u89c8\u7248\u4e0a\u7ebf\u7684\u4e00\u4e9b\u529f\u80fd\u4e0e\u8c03\u6574\u7ec6\u8282\u3002","date":"2022-09-28T00:00:00.000Z","formattedDate":"2022\u5e749\u670828\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":6.1,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","title":"Author","url":"https://github.com/spacewander","image_url":"https://github.com/spacewander.png","imageURL":"https://github.com/spacewander.png"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u653e\u5f03 Spring Cloud Gateway\uff01APISIX \u5728\u300c\u8fd8\u5457\u300d\u7684\u6280\u672f\u5b9e\u8df5","permalink":"/zh/blog/2022/09/30/huanbei-in-apache-apisix"},"nextItem":{"title":"\u4e3a\u4ec0\u4e48\u8bf4 Apache APISIX \u662f\u6700\u597d\u7684 API \u7f51\u5173\uff1f","permalink":"/zh/blog/2022/09/27/why-apache-apisix-is-best-apigateway"}},"content":"> Apache APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff0c\u4e3a\u4f60\u6574\u7406\u4e86\u6b64\u6b21\u9884\u89c8\u7248\u4e0a\u7ebf\u7684\u4e00\u4e9b\u529f\u80fd\u4e0e\u8c03\u6574\u7ec6\u8282\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u672c\u6b21\u53d1\u5e03\u7684\u65b0\u7248\u672c\uff0c\u662f 3.0.0 \u7684 Beta \u9884\u89c8\u7248\u3002\u4f5c\u4e3a 3.0 \u6b63\u5f0f\u7248\u7684\u63a2\u8def\u5148\u950b\uff0c\u9884\u89c8\u7248\u5df2\u7ecf\u5305\u542b\u4e86 3.0 \u5927\u7248\u672c\u4e2d\u5e26\u6765\u7684\u591a\u9879\u65b0\u529f\u80fd\u3002\u5982\u679c\u4f60\u60f3\u63d0\u524d\u611f\u53d7 APISIX 3.0 \u7248\u672c\u7684\u529f\u80fd\u76db\u5bb4\uff0c\u6b22\u8fce\u5c1d\u9c9c\u6b64\u6b21\u9884\u89c8\u7248\uff0c\u4e5f\u671f\u5f85\u4f60\u5728\u4f7f\u7528\u4e2d\u5411\u793e\u533a\u53cd\u9988\u76f8\u5173\u4f53\u9a8c\u3002\\n\\n\u6b63\u56e0\u4e3a 3.0.0-beta \u7248\u672c\u65b0\u589e\u4e86\u5f88\u591a\u4e0d\u5411\u4e0b\u517c\u5bb9\u7684\u6539\u52a8\uff0c\u672c\u6b21\u53d1\u7248\u516c\u544a\u4f1a\u4e00\u4e00\u5217\u51fa\u8fd9\u4e9b\u6539\u52a8\uff0c\u8ba9\u5404\u4f4d\u7528\u6237\u5728\u8fc1\u79fb\u914d\u7f6e\u65f6\u6709\u6240\u51c6\u5907\u3002\\n\\n## \u65b0\u53d8\u5316\\n\\n### \u79fb\u52a8 config_center\u3001etcd \u548c Admin API \u914d\u7f6e\u5230 deployment \u4e2d\\n\\n\u5728 3.0 \u7248\u672c\u4e2d\uff0c\u8c03\u6574\u4e86\u9759\u6001\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\uff0c\u6240\u4ee5\u4f60\u9700\u8981\u540c\u6b65\u66f4\u65b0\u4e0b `config.yaml` \u6587\u4ef6\u5185\u7684\u914d\u7f6e\u3002\\n\\n- `config_center` \u529f\u80fd\u6539\u7531 `deployment` \u4e2d\u7684 `config_provider` \u5b9e\u73b0\uff08[#7901](https://github.com/apache/apisix/pull/7901)\uff09\\n- `etcd` \u5b57\u6bb5\u6574\u4f53\u642c\u8fc1\u5230 `deployment` \u4e2d\uff08[#7860](https://github.com/apache/apisix/pull/7860)\uff09\\n- \u4ee5\u4e0b Admin API \u914d\u7f6e\u79fb\u52a8\u5230 `deployment` \u4e2d\u7684 `admin` \u5b57\u6bb5\uff08[#7823](https://github.com/apache/apisix/pull/7823)\uff09\uff1a\\n  - admin_key\\n  - enable_admin_cors\\n  - allow_admin\\n  - admin_listen\\n  - https_admin\\n  - admin_api_mtls\\n  - admin_api_version\\n\\n\u66f4\u591a\u8be6\u60c5\u53ef\u53c2\u8003\u6700\u65b0\u7684 `[config-default.yaml](https://github.com/apache/apisix/blob/master/conf/config-default.yaml)` \u6587\u4ef6\u3002\\n\\n### \u79fb\u9664\u591a\u4e2a\u5df2\u5e9f\u5f03\u914d\u7f6e\\n\\n\u5728 3.0 \u65b0\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u628a\u8bb8\u591a\u4e4b\u524d\u6807\u8bb0\u4e3a `deprecated` \u7684\u914d\u7f6e\u8fdb\u884c\u4e86\u6e05\u7406\u3002\\n\\n\u5728\u9759\u6001\u914d\u7f6e\u4e2d\uff0c\u79fb\u9664\u4e86\u4ee5\u4e0b\u82e5\u5e72\u5b57\u6bb5\uff1a\\n\\n- \u79fb\u9664 `apisix.ssl` \u4e2d\u7684 `enable_http2` \u548c `listen_port`\uff08[#7717](https://github.com/apache/apisix/pull/7717)\uff09\\n- \u79fb\u9664 `apisix.port_admin`\uff08[#7716](https://github.com/apache/apisix/pull/7716)\uff09\\n- \u79fb\u9664 `etcd.health_check_retry`\uff08[#7676](https://github.com/apache/apisix/pull/7676)\uff09\\n- \u79fb\u9664 `nginx_config.http.lua_shared_dicts`\uff08[#7677](https://github.com/apache/apisix/pull/7677)\uff09\\n- \u79fb\u9664 `nginx_config.http.real_ip_header`\uff08[#7696](https://github.com/apache/apisix/pull/7696)\uff09\\n\\n\u5728\u52a8\u6001\u914d\u7f6e\u4e2d\uff0c\u8fdb\u884c\u4e86\u4ee5\u4e0b\u8c03\u6574\uff1a\\n\\n- \u5c06\u63d2\u4ef6\u914d\u7f6e\u7684 `disable` \u79fb\u5230 `_meta` \u4e2d\uff08[#7707](https://github.com/apache/apisix/pull/7707)\uff09\\n- \u4ece Route \u4e2d\u79fb\u9664\u4e86 `service_protocol`\uff08[#7701](https://github.com/apache/apisix/pull/7701)\uff09\\n\\n\u6b64\u5916\u8fd8\u6709\u5177\u4f53\u63d2\u4ef6\u7ea7\u522b\u4e0a\u7684\u6539\u52a8\uff1a\\n\\n- authz-keycloak \u4e2d\u79fb\u9664\u4e86 `audience` \u5b57\u6bb5\uff08[#7683](https://github.com/apache/apisix/pull/7683)\uff09\\n- mqtt-proxy \u4e2d\u79fb\u9664\u4e86 `upstream` \u5b57\u6bb5\uff08[#7694](https://github.com/apache/apisix/pull/7694)\uff09\\n- error-log-logger \u4e2d\u628a TCP \u76f8\u5173\u914d\u7f6e\u653e\u5230 `tcp` \u5b57\u6bb5\u4e2d\uff08[#7700](https://github.com/apache/apisix/pull/7700)\uff09\\n- syslog \u4e2d\u79fb\u9664\u4e86 `max_retry_times` \u548c `retry_interval` \u5b57\u6bb5\uff08[#7699](https://github.com/apache/apisix/pull/7699)\uff09\\n- proxy-rewrite \u4e2d\u79fb\u9664\u4e86 `scheme` \u5b57\u6bb5\uff08[#7695](https://github.com/apache/apisix/pull/7695)\uff09\\n\\n### \u8c03\u6574 Admin API \u54cd\u5e94\u683c\u5f0f\\n\\n\u6211\u4eec\u5728\u4ee5\u4e0b\u4e24\u4e2a PR \u4e2d\u8c03\u6574\u4e86 Admin API \u7684\u54cd\u5e94\u683c\u5f0f\uff1a\\n\\n- [#7630](https://github.com/apache/apisix/pull/7630)\\n- [#7622](https://github.com/apache/apisix/pull/7622)\\n\\n\u65b0\u7684\u54cd\u5e94\u683c\u5f0f\u8c03\u6574\u4e3a\u4ee5\u4e0b\u7c7b\u578b\u3002\\n\\n\u8fd4\u56de\u5355\u4e2a\u914d\u7f6e\uff1a\\n\\n```yaml\\n{\\n  \\"modifiedIndex\\": 2685183,\\n  \\"value\\": {\\n    \\"id\\": \\"1\\",\\n    ...\\n  },\\n  \\"key\\": \\"/apisix/routes/1\\",\\n  \\"createdIndex\\": 2684956\\n}\\n```\\n\\n\u8fd4\u56de\u591a\u4e2a\u914d\u7f6e\uff1a\\n\\n```yaml\\n{\\n  \\"list\\": [\\n    {\\n      \\"modifiedIndex\\": 2685183,\\n      \\"value\\": {\\n        \\"id\\": \\"1\\",\\n        ...\\n      },\\n      \\"key\\": \\"/apisix/routes/1\\",\\n      \\"createdIndex\\": 2684956\\n    },\\n    {\\n      \\"modifiedIndex\\": 2685163,\\n      \\"value\\": {\\n        \\"id\\": \\"2\\",\\n        ...\\n      },\\n      \\"key\\": \\"/apisix/routes/2\\",\\n      \\"createdIndex\\": 2685163\\n    }\\n  ],\\n  \\"total\\": 2\\n}\\n```\\n\\n### \u5176\u4ed6\\n\\n- Admin API \u7684\u7aef\u53e3\u6539\u4e3a 9180\uff08[#7806](https://github.com/apache/apisix/pull/7806)\uff09\\n- APISIX \u5c06\u53ea\u652f\u6301 OpenResty 1.19.3.2 \u53ca\u4ee5\u4e0a\u7248\u672c\uff08[#7625](https://github.com/apache/apisix/pull/7625)\uff09\\n- \u8c03\u6574\u4e86 Plugin Config \u5bf9\u8c61\u7684\u4f18\u5148\u7ea7\uff0c\u540c\u540d\u63d2\u4ef6\u914d\u7f6e\u7684\u4f18\u5148\u7ea7\u7531 Consumer > Plugin Config > Route > Service \u4fee\u6539\u4e3a **Consumer > Route > Plugin Config > Service**\uff08[#7614](https://github.com/apache/apisix/pull/7614)\uff09\\n\\n## \u65b0\u529f\u80fd\\n\\n### \u65b0\u73a9\u6cd5\uff1a\u76f4\u63a5\u4ece APISIX \u53d1\u8d77 gRPC \u8bf7\u6c42\\n\\n\u4ece 3.0.0-beta \u7248\u672c\u5f00\u59cb\uff0cAPISIX \u96c6\u6210\u4e86 `grpc-client-nginx-module`\uff0c\u8fd9\u662f\u4e00\u4e2a\u652f\u6301\u5728 NGINX \u4e2d\u53d1\u8d77 gRPC \u8bf7\u6c42\u7684\u6a21\u5757\u3002\u53ea\u9700\u5be5\u5be5\u6570\u5341\u884c Lua \u4ee3\u7801\uff0c\u5373\u53ef\u5b8c\u6210\u8ddf gRPC \u670d\u52a1\u7684\u76f4\u63a5\u4ea4\u4e92\u3002\\n\\n\u5728\u4e0b\u65b9\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u8fde\u63a5\u4e86\u76d1\u542c 50051 \u7aef\u53e3\u7684 gRPC \u670d\u52a1\uff0c\u53d1\u9001\u4e00\u6b21 `{ name = \\"apisix\\" }` \u6765\u521b\u5efa\u5bf9\u5e94\u7684 stream\uff0c\u7136\u540e\u53d1\u9001\u4e09\u6b21\u8bf7\u6c42\uff0c\u6700\u540e\u63a5\u6536\u5230\u4e86\u4e94\u6b21\u54cd\u5e94\u3002\\n\\n```lua\\nlocal core = require \\"apisix.core\\"\\nlocal gcli = core.grpc\\nassert(gcli.load(\\"t/grpc_server_example/proto/helloworld.proto\\"))\\nlocal conn = assert(gcli.connect(\\"127.0.0.1:50051\\"))\\nlocal st, err = conn:new_bidirectional_stream(\\"helloworld.Greeter\\",\\n    \\"SayHelloBidirectionalStream\\", { name = \\"apisix\\" })\\nif not st then\\n    ngx.status = 503\\n    ngx.say(err)\\n    return\\nend\\n\\nfor i = 1, 3 do\\n    local ok, err = st:send({ name = \\"apisix\\" })\\n    if not ok then\\n        ngx.status = 503\\n        ngx.say(err)\\n        return\\n    end\\nend\\n\\nassert(st:close_send())\\nfor i = 1, 5 do\\n    local res, err = st:recv()\\n    if not res then\\n        ngx.status = 503\\n        ngx.say(err)\\n        return\\n    end\\n    ngx.say(res.message)\\nend\\n```\\n\\n\u66f4\u591a\u8be6\u7ec6\u7ec6\u8282\u53ef\u53c2\u8003[\u76f8\u5173\u6587\u6863](https://github.com/api7/grpc-client-nginx-module)\u3002\\n\\n\u76ee\u524d APISIX \u5bf9 `grpc-client-nginx-module` \u7684\u6574\u5408\u53ea\u662f\u4e2a\u5f00\u59cb\uff0c\u540e\u7eed\u5c06\u4f1a\u5728 APISIX \u4e2d\u8fdb\u884c\u66f4\u591a\u6539\u9020\u5de5\u4f5c\uff0c\u6bd4\u5982\u76f4\u63a5\u4f7f\u7528 gRPC \u6765\u8fde\u63a5 APISIX \u7684\u63a7\u5236\u9762\u3002\\n\\n### \u65b0\u63d2\u4ef6\uff1aelasticsearch-logger \u548c tencent-cloud-cls\\n\\nAPISIX \u51e0\u4e4e\u6bcf\u4e2a\u65b0\u7248\u672c\u7684\u53d1\u5e03\u90fd\u4f1a\u5f15\u5165\u65b0\u7684\u65e5\u5fd7\u63d2\u4ef6\uff0c\u6b64\u6b21\u4e5f\u4e0d\u4f8b\u5916\uff0c\u5f15\u5165\u4e86\u4e24\u4e2a\u65b0\u7684\u65e5\u5fd7\u63d2\u4ef6\u3002\\n\\n`elasticsearch-logger` \u63d2\u4ef6\u662f\u5199\u5165\u5230 Elasticsearch \u7684\u65e5\u5fd7\u63d2\u4ef6\u3002\u901a\u8fc7\u914d\u7f6e\u8be5\u63d2\u4ef6\uff0c\u4f60\u53ef\u4ee5\u628a\u65e5\u5fd7\u6279\u91cf\u4f20\u8f93\u5230 Elasticsearch\u3002\u5982\u4e0b\u8ff0\u914d\u7f6e\uff0c\u4f1a\u5c06\u65e5\u5fd7\u53d1\u9001\u5230 9200 \u7aef\u53e3\u7684 Elasticsearch \u4e0a\uff1a\\n\\n```json\\n    \\"plugins\\":{\\n        \\"elasticsearch-logger\\":{\\n            \\"endpoint_addr\\":\\"http://127.0.0.1:9200\\",\\n            \\"field\\":{\\n                \\"index\\":\\"services\\"\\n            }\\n        },\\n        ...\\n    },\\n    ...\\n```\\n\\n`tencent-cloud-cls` \u63d2\u4ef6\u5219\u662f\u5bf9\u63a5[\u817e\u8baf\u4e91\u65e5\u5fd7\u670d\u52a1](https://cloud.tencent.com/document/product/614)\u7684\u63d2\u4ef6\u3002\\n\\n\u8ddf `elasticsearch-logger` \u7c7b\u4f3c\uff0c\u4e5f\u9700\u8981\u914d\u7f6e\u76f8\u5173\u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u540c\u65f6\u8fd8\u9700\u8981\u914d\u7f6e\u7528\u6237\u7684\u8eab\u4efd\u4fe1\u606f\uff1a\\n\\n```json\\n    \\"plugins\\": {\\n        \\"tencent-cloud-cls\\": {\\n            \\"cls_host\\": \\"ap-guangzhou.cls.tencentyun.com\\",\\n            \\"cls_topic\\": \\"${your CLS topic name}\\",\\n            \\"global_tag\\": {\\n                \\"module\\": \\"cls-logger\\",\\n                \\"server_name\\": \\"YourApiGateWay\\"\\n            },\\n            \\"include_req_body\\": true,\\n            \\"include_resp_body\\": true,\\n            \\"secret_id\\": \\"${your secret id}\\",\\n            \\"secret_key\\": \\"${your secret key}\\"\\n        },\\n        ...\\n    },\\n\\n```\\n\\n### \u73b0\u6709\u529f\u80fd\u62d3\u5c55\\n\\n\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u51e0\u4e2a\u5927\u7684\u65b0\u53d8\u5316\u5916\uff0c\u6b64\u6b21\u7248\u672c\u53d1\u5e03\u4e5f\u5305\u542b\u5f88\u591a\u503c\u5f97\u4e00\u63d0\u7684\u7279\u6027\uff1a\\n\\n- K8s \u670d\u52a1\u53d1\u73b0\u652f\u6301\u914d\u7f6e\u591a\u4e2a\u96c6\u7fa4\uff1b\\n- log-rotate \u65f6\u652f\u6301\u9650\u5236\u65e5\u5fd7\u6587\u4ef6\u7684\u4e0a\u9650\u5927\u5c0f\uff1b\\n- \u65b0\u589e `openfunction` \u63d2\u4ef6\uff0c\u53ef\u4ee5\u8c03\u7528 OpenFunction \u5e73\u53f0\u7684 FaaS \u51fd\u6570\uff1b\\n- \u65b0\u589e `workflow` \u63d2\u4ef6\uff0c\u53ef\u4ee5\u7075\u6d3b\u6267\u884c\u66f4\u591a\u903b\u8f91\u3002\\n\\n\u5982\u679c\u4f60\u5bf9\u6b64\u6b21\u53d1\u7248\u7684\u5b8c\u6574\u5185\u5bb9\u611f\u5174\u8da3\uff0c\u8bf7\u53c2\u8003 3.0.0-beta \u53d1\u5e03\u7684 [changelog](https://github.com/apache/apisix/blob/release/2.99/docs/zh/latest/CHANGELOG.md#300-beta)\u3002"},{"id":"\u4e3a\u4ec0\u4e48\u8bf4 Apache APISIX \u662f\u6700\u597d\u7684 API \u7f51\u5173\uff1f","metadata":{"permalink":"/zh/blog/2022/09/27/why-apache-apisix-is-best-apigateway","source":"@site/blog/2022/09/27/why-apache-apisix-is-best-apigateway.md","title":"\u4e3a\u4ec0\u4e48\u8bf4 Apache APISIX \u662f\u6700\u597d\u7684 API \u7f51\u5173\uff1f","description":"\u672c\u6587\u4ece\u591a\u4e2a\u89d2\u5ea6\uff08\u5728\u5f00\u53d1\u4eba\u5458\u4e2d\u7684\u53d7\u6b22\u8fce\u7a0b\u5ea6\u3001\u5f00\u6e90\u8bb8\u53ef\u8bc1\u3001\u6027\u80fd\u548c\u6574\u4e2a\u751f\u6001\u7cfb\u7edf\uff09\u5bf9\u6bd4\u591a\u4e2a API \u7f51\u5173\uff08Kong\u3001Tyk\u3001Gloo\uff09\u3002","date":"2022-09-27T00:00:00.000Z","formattedDate":"2022\u5e749\u670827\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":19.5,"truncated":true,"authors":[{"name":"\u6e29\u94ed","title":"Author","url":"https://github.com/moonming","image_url":"https://avatars.githubusercontent.com/u/26448043","imageURL":"https://avatars.githubusercontent.com/u/26448043"}],"prevItem":{"title":"APISIX 3.0.0 \u9884\u89c8\u7248\u73b0\u5df2\u53d1\u5e03\uff01\u5e26\u6765\u4e30\u5bcc\u529f\u80fd\u4e0e\u8fed\u4ee3\u7ec6\u8282","permalink":"/zh/blog/2022/09/28/apache-apisix-3.0.0-beta-release"},"nextItem":{"title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 CNCF OpenFunction","permalink":"/zh/blog/2022/09/20/apisix-integrate-cncf-openfunction"}},"content":"> \u672c\u6587\u9996\u53d1\u4e8e [API7.ai](https://www.apiseven.com/blog/why-is-apache-apisix-the-best-api-gateway)\uff0c\u4ece\u591a\u4e2a\u89d2\u5ea6\uff08\u5728\u5f00\u53d1\u4eba\u5458\u4e2d\u7684\u53d7\u6b22\u8fce\u7a0b\u5ea6\u3001\u5f00\u6e90\u8bb8\u53ef\u8bc1\u3001\u6027\u80fd\u548c\u6574\u4e2a\u751f\u6001\u7cfb\u7edf\uff09\u5bf9\u6bd4\u591a\u4e2a API \u7f51\u5173\uff08Kong\u3001Tyk\u3001Gloo\uff09\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n<head>\\n  <link rel=\\"canonical\\" href=\\"https://www.apiseven.com/blog/why-is-apache-apisix-the-best-api-gateway\\" />\\n</head>\\n\\n\u4eca\u5929\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u624b\u673a\u548c\u5404\u79cd APP \u5b8c\u6210\u5404\u79cd\u5404\u6837\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u793e\u4ea4\uff0c\u7f51\u8d2d\u7b49\u3002\u8fd9\u4e9b\u884c\u4e3a\u7684\u80cc\u540e\uff0cAPI \u8d77\u5230\u4e86\u5173\u952e\u7684\u4f5c\u7528\u3002\u4f5c\u4e3a API \u7684\u4f7f\u7528\u8005\uff0c\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3 API \u7684\u7a33\u5b9a\u3001\u5b89\u5168\u548c\u9ad8\u6548\uff0c\u4f46\u662f\u901a\u8fc7 API \u63d0\u4f9b\u6570\u636e\u670d\u52a1\u7684\u4f01\u4e1a\u5219\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684 API \u7f51\u5173\uff0c\u7528\u6765\u4fdd\u8bc1\u6570\u5343\u4e43\u81f3\u6570\u4e07\u7684 API \u4e3a\u63d0\u4f9b\u5feb\u901f\u548c\u5b89\u5168\u7684\u670d\u52a1\u3002\\n\\n\u5728 CNCF \u7684 [API Gateway landscape](https://landscape.cncf.io/card-mode?category=api-gateway&grouping=category&sort=contributors) \u4e2d\u6709\u63a5\u8fd1 20 \u4e2a API \u7f51\u5173\u7684\u9009\u578b\uff08\u4e0d\u5305\u62ec\u516c\u6709\u4e91\u5382\u5546\u7684\u4ea7\u54c1\uff09\uff0c\u5305\u62ec Apache APISIX\u3001Kong\u3001Tyk \u7b49\u7b49\u3002\\n\\n\u5f88\u591a\u7f51\u5173\u90fd\u79f0\u81ea\u5df1\u662f\u4e0b\u4e00\u4ee3 API \u7f51\u5173\uff0c\u662f\u6700\u53d7\u6b22\u8fce\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\uff0c\u90a3\u4e48\u4e8b\u5b9e\u5982\u4f55\u5462\uff1f\u672c\u6587\u5c06\u901a\u8fc7\u5f00\u53d1\u8005\u3001\u77e5\u8bc6\u4ea7\u6743\u548c\u54c1\u724c\u3001\u6280\u672f\u3001\u751f\u6001\u7b49\u591a\u4e2a\u7ef4\u5ea6\u6765\u770b\u770b Apache APISIX \u4e3a\u4ec0\u4e48\u662f\u4e0b\u4e00\u4ee3 API \u7f51\u5173\uff1f\\n\\n![API Gateway landscape](https://static.apiseven.com/2022/09/13/632052e8c6f34.png)\\n\\n## \u5de5\u7a0b\u5e08\u7684\u773c\u775b\u662f\u96ea\u4eae\u7684\\n\\n\u5de5\u7a0b\u5e08\u662f API \u548c API \u7f51\u5173\u7684\u4f7f\u7528\u8005\u548c\u5f00\u53d1\u8005\uff0c\u66f4\u591a\u5de5\u7a0b\u5e08\u5173\u6ce8\u548c\u53c2\u4e0e\u7684 API \u7f51\u5173\u9879\u76ee\uff0c\u4ee3\u8868\u7684\u5c31\u662f\u6280\u672f\u7684\u8d8b\u52bf\u3002\u6211\u4eec\u4ece GitHub \u4ee3\u7801\u8d21\u732e\u8005\u7684\u7ef4\u5ea6\uff0c\u9009\u53d6\u4e86 4 \u4e2a\u5f00\u6e90 API \u7f51\u5173\u8fdb\u884c\u5bf9\u6bd4\uff1aApache APISIX\u3001Kong\u3001Tyk \u548c Gloo\u3002\\n\\n![GitHub \u8d21\u732e\u8005\u7edf\u8ba1\u56fe](https://static.apiseven.com/2022/09/13/632055a37ac26.png)\\n\\nKong \u548c Tyk \u90fd\u662f 2015 \u5e74\u4e4b\u524d\u5f00\u59cb\u7814\u53d1\u7684\uff0cApache APISIX \u548c\u57fa\u4e8e Envoy \u7684 Gloo \u662f\u5728 2019 \u5e74\u5de6\u53f3\u5f00\u59cb\u7814\u53d1\u7684\u3002\u4ece\u4e0a\u56fe\u4e2d\u7684 [Github Contributor Over Time](https://git-contributor.com/?chart=contributorOverTime&repo=apache/apisix,solo-io/gloo,kong/kong,tyktechnologies/tyk) \u53ef\u4ee5\u770b\u51fa\uff0cKong \u7ecf\u8fc7\u8fd1 7 \u5e74\u7684\u53d1\u5c55\u5df2\u7ecf\u6709\u8d85\u8fc7 250 \u4e2a\u8d21\u732e\u8005\u53c2\u4e0e\uff0c\u8fdc\u8fdc\u8d85\u8fc7\u4e86 Tyk \u548c Gloo\uff1b\u800c\u6700\u5e74\u8f7b\u7684 Apache APISIX\uff0c\u5df2\u7ecf\u8d85\u8fc7 320 \u4e2a\u8d21\u732e\u8005\uff0c\u6570\u91cf\u548c\u589e\u901f\u90fd\u8fdc\u8d85 Kong\uff0c\u6210\u4e3a\u6700\u591a\u5f00\u53d1\u8005\u53c2\u4e0e\u8d21\u732e\u7684 API \u7f51\u5173\u9879\u76ee\u3002\\n\\n\u9664\u4e86\u8d21\u732e\u8005\u603b\u6570\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u6307\u6807\u53ef\u4ee5\u770b\u5230\u66f4\u6df1\u5c42\u6b21\u7684\u6570\u636e\uff1a\u8d21\u732e\u8005\u7684\u6708\u5ea6\u6d3b\u8dc3\u3002\u4e0b\u56fe\u5c55\u793a\u4e86\u4ee5\u4e0a\u56db\u4e2a\u5f00\u6e90 API \u7f51\u5173\u7684\u6708\u5ea6\u6d3b\u8dc3\u7684\u5f00\u53d1\u8005\u6570\u91cf\uff1a\\n\\n![\u6708\u5ea6\u6d3b\u8dc3\u8d21\u732e\u8005\u56fe](https://static.apiseven.com/2022/09/13/63205698e44f5.png)\\n\\nTyk \u7684\u8d21\u732e\u8005\u6708\u6d3b\u8dc3\u4eba\u6570\uff0c\u957f\u671f\u90fd\u662f\u5728 5 \u4e2a\u4eba\u5de6\u53f3\uff0c\u5f88\u5c11\u8d85\u8fc7 10 \u4e2a\u4eba\uff1b\u800c Kong \u548c Gloo \u7684\u8d21\u732e\u8005\u6708\u6d3b\u8dc3\u4eba\u6570\u5747\u5728 10 \u5230 20 \u4e4b\u95f4\u6d6e\u52a8\uff1b\u800c Apache APISIX \u57fa\u672c\u4fdd\u6301\u5728 20 \u4eba\u4ee5\u4e0a\uff0c\u6700\u9ad8\u63a5\u8fd1 40 \u4eba\uff0c\u662f\u5f00\u53d1\u8005\u6700\u6d3b\u8dc3\u7684 API \u7f51\u5173\u3002\\n\\n\u8fd9\u56db\u4e2a\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u80cc\u540e\uff0c\u90fd\u662f\u6709\u5bf9\u5e94\u7684\u5546\u4e1a\u5316\u516c\u53f8\u7684\uff0c\u6240\u4ee5\u8fd8\u6709\u7b2c\u4e09\u4e2a\u6307\u6807\u6570\u636e\uff0c\u90a3\u5c31\u662f\u5f00\u6e90\u9879\u76ee\u8d21\u732e\u8005\u548c\u5546\u4e1a\u516c\u53f8\u5458\u5de5\u6570\u7684\u5bf9\u6bd4\uff1a\\n\\n|    **API Gateway**     | **APISIX** | **Kong** | **Tyk** | **Gloo** |\\n| :--------------------: | :--------: | :------: | :-----: | :------: |\\n|      \u6708\u5ea6\u6d3b\u8dc3\u4eba\u6570      |     38     |    20    |    8    |    24    |\\n| \u516c\u53f8\u6210\u5458(\u6570\u636e\u6765\u81ea\u9886\u82f1) |    40+     |   500+   |  200+   |   100+   |\\n\\n\u5f53\u524d\uff082022 \u5e74\u7b2c\u4e09\u5b63\u5ea6\uff09Kong \u548c Tyk \u7684\u5f00\u6e90\u6295\u5165\u6bd4\u4f8b\uff08\u6708\u5ea6\u6d3b\u8dc3\u8d21\u732e\u8005/\u5458\u5de5\u603b\u6570\uff09\u662f 4%\uff0cGloo \u662f 24%\uff0cAPISIX \u5219\u662f\u63a5\u8fd1 100%\u3002\u5373\u4f7f\u56de\u5230 2017 \u5e74\uff0cKong \u7684\u6708\u5ea6\u6d3b\u8dc3\u8d21\u732e\u8005\u4e5f\u5728 5 \u4e2a\u4eba\u5de6\u53f3\u3002\\n\\n\u663e\u800c\u6613\u89c1\uff0c\u5f00\u6e90\u9879\u76ee Apache APISIX \u548c\u5b83\u80cc\u540e\u7684\u5546\u4e1a\u5316\u516c\u53f8 API7.ai \u4ece\u521b\u5efa\u4f0a\u59cb\uff0c\u5c31\u4fdd\u6301\u4e86\u5bf9\u4e8e\u5f00\u6e90\u9879\u76ee\u7684\u6301\u7eed\u6295\u5165\uff0c\u8d62\u5f97\u4e86\u4f17\u591a\u5f00\u53d1\u8005\u7684\u559c\u7231\u3002\\n\\n## \u5f00\u6e90\u534f\u8bae\uff1a\u4f01\u4e1a\u7528\u6237\u9009\u62e9\u5f00\u6e90\u9879\u76ee\u7684\u9996\u8981\u8003\u8651\u56e0\u7d20\\n\\n\u81ea\u4ece MongoDB \u4fee\u6539\u4e86\u5f00\u6e90\u9879\u76ee\u7684 License \u4e4b\u540e\uff0c\u5728\u505a\u57fa\u7840\u8f6f\u4ef6\u7684\u9009\u578b\u65f6\uff0c\u5f00\u6e90\u9879\u76ee\u7684 License \u98ce\u9669\u5c31\u662f\u4f01\u4e1a\u7528\u6237\u9996\u8981\u8003\u8651\u7684\u56e0\u7d20\u3002\\n\\n\u4ece\u8868\u9762\u4e0a\u770b\uff0cApache APISIX\u3001Kong \u548c Gloo \u4f7f\u7528\u7684\u90fd\u662f\u5546\u4e1a\u53cb\u597d\u7684 Apache License Version 2.0\uff0cTyk \u4f7f\u7528\u7684\u662f\u5e26\u6709\u4f20\u67d3\u6027\u7684 Mozilla Public License Version 2.0\u3002\\n\\n\u66f4\u6df1\u5165\u7684\u770b\uff0cKong\u3001Gloo \u548c Tyk \u8fd9\u4e09\u4e2a\u90fd\u662f\u5b8c\u5168\u7531\u5546\u4e1a\u516c\u53f8\u63a7\u5236\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u5b83\u4eec\u53ef\u4ee5\u50cf MongoDB \u4e00\u6837\u968f\u65f6\u5728\u65b0\u7248\u672c\u4e2d\u4fee\u6539 License\uff0c\u9650\u5236\u516c\u6709\u4e91\u6216\u8005\u5176\u4ed6\u516c\u53f8\u514d\u8d39\u4f7f\u7528\uff0c\u8fdb\u800c\u8981\u6c42\u4f60\u4ece\u5f00\u6e90\u7528\u6237\u8f6c\u4e3a\u4ed8\u8d39\u5ba2\u6237\u6765\u7ee7\u7eed\u4f7f\u7528\u6700\u65b0\u7248\u672c\u3002\\n\\n\u6ca1\u6709\u4eba\u77e5\u9053\u8fd9\u6837\u7684\u4e8b\u60c5\u662f\u5426\u4f1a\u53d1\u751f\uff0c\u4ee5\u53ca\u53d1\u751f\u7684\u51e0\u7387\u6709\u591a\u5927\u3002\u8fd9\u79cd\u98ce\u9669\uff0c\u5c31\u50cf\u8fbe\u6469\u514b\u5229\u65af\u4e4b\u5251\u4e00\u6837\uff0c\u60ac\u6302\u5728\u4f01\u4e1a\u7528\u6237\u7684\u5934\u4e0a\u3002\\n\\n\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u6216\u8005 CNCF \u7684\u5f00\u6e90\u9879\u76ee\u662f\u6700\u660e\u667a\u7684\u3002\u800c Apache APISIX \u662f\u5168\u7403\u6700\u5927\u7684\u8f6f\u4ef6\u57fa\u91d1\u4f1a--Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u9879\u76ee\uff0c\u6240\u6709\u7684\u4ee3\u7801\u548c\u54c1\u724c\u90fd\u5f52\u5c5e\u4e8e Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\uff0c\u4efb\u4f55\u5546\u4e1a\u516c\u53f8\u90fd\u4e0d\u80fd\u63a7\u5236 Apache APISIX \u9879\u76ee\uff0c\u4e5f\u4e0d\u53ef\u80fd\u4fee\u6539\u5f00\u6e90\u9879\u76ee\u7684 license\u3002\u4f01\u4e1a\u7528\u6237\u53ef\u4ee5\u4e00\u76f4\u653e\u5fc3\u7684\u4f7f\u7528\uff0c\u800c\u4e0d\u7528\u62c5\u5fc3\u6536\u5230\u5f8b\u5e08\u548c\u5408\u89c4\u90e8\u95e8\u7684\u95ee\u8be2\u90ae\u4ef6\u3002\\n\\n## \u6027\u80fd\u6d4b\u8bd5\u5bf9\u6bd4\\n\\n\u5728\u793e\u533a\u4e2d\u7ecf\u5e38\u4f1a\u6709\u7528\u6237\u63d0\u95ee\uff1a\u57fa\u4e8e Envoy \u7684 Gloo\uff0c\u548c\u57fa\u4e8e NGINX \u7684 APISIX\uff0c\u8c01\u7684\u6027\u80fd\u66f4\u80dc\u4e00\u7b79\uff1f\\n\u867d\u7136\u6027\u80fd\u5e76\u4e0d\u662f\u9009\u578b\u4e2d\u6700\u91cd\u8981\u7684\u6307\u6807\uff0c\u4f46\u5b83\u786e\u5b9e\u662f\u6700\u76f4\u63a5\u7684\u6307\u6807\u3002\u4e0b\u8868\u7684\u8868\u683c\u662f Apache APISIX \u548c Gloo \u7684 Benchmark \u7ed3\u679c\u3002\u4ece\u8868\u683c\u4e2d\u53ef\u4ee5\u770b\u5230\uff0cApache APISIX \u7684 QPS \u662f Gloo \u7684 4.6 \u500d\uff0c\u540c\u65f6 Apache APISIX \u7684\u5ef6\u8fdf\u8fd8\u4e0d\u5230 Gloo \u7684 7%\u3002\\n\\n| **API Gateway** |                                Apache APISIX                                |                                 Gloo Edge                                 |\\n| :-------------: | :-------------------------------------------------------------------------: | :-----------------------------------------------------------------------: |\\n|     **QPS**     |                                    59122                                    |                                   12903                                   |\\n|   **Latency**   | 50.000% 470.00us<br/>75.000% 648.00us<br/>90.000% 0.89ms<br/>99.000% 1.60ms | 50.000% 6.80ms<br/>75.000% 9.25ms<br/>90.000% 11.32ms<br/>99.000% 17.06ms |\\n\\n\u8fd9\u5e76\u4e0d\u4ec5\u4ec5\u662f NGINX \u548c Envoy \u4e4b\u95f4\u7684\u5dee\u5f02\u9020\u6210\u7684\uff0c\u800c\u662f\u56e0\u4e3a APISIX \u5728\u5e95\u5c42\u505a\u4e86\u5927\u91cf\u7684\u4f18\u5316\uff0c\u6240\u4ee5\u540c\u6837\u57fa\u4e8e NGINX \u7684 APSIX \u76f8\u5bf9\u4e8e Kong \u4e5f\u6709\u5de8\u5927\u7684\u6027\u80fd\u4f18\u52bf\u3002\\n\\n\u4e3a\u4ec0\u4e48 APISIX \u7684\u6027\u80fd\u4f18\u52bf\u5982\u4f55\u4e4b\u5927\uff1f\u5728\u4ee3\u7801\u9762\u524d\uff0c\u6ca1\u6709\u4efb\u4f55\u79d8\u5bc6\u3002\u8ba9\u6211\u4eec\u4ece\u6280\u672f\u7684\u89d2\u5ea6\u6765\u8be6\u7ec6\u5206\u6790\u4e0b\u3002\\n\\n## Apache APISIX \u7684\u6280\u672f\u4f18\u52bf\\n\\n\u4ee5\u4e0b\u5185\u5bb9\u662f Apache APISIX \u548c Kong\u3001Gloo \u76f8\u6bd4\u5728\u6280\u672f\u65b9\u9762\u7684\u4e3b\u8981\u4f18\u52bf\uff0c\u5927\u90e8\u5206\u90fd\u662f\u5728\u5e95\u5c42\u6a21\u5757\u4e0a\u7684\u4f18\u5316\u548c\u521b\u65b0\u3002\u5728\u7b80\u5355\u7684 PoC \u4e0a\u5e76\u4e0d\u4e00\u5b9a\u80fd\u591f\u4f53\u73b0\u51fa\u8fd9\u4e9b\u6280\u672f\u7684\u4f18\u52bf\uff0c\u4f46\u5728\u590d\u6742\u7684\u751f\u4ea7\u73af\u5883\u4e2d\uff0cApache APISIX \u7684\u8fd9\u4e9b\u4f18\u52bf\u5c06\u4f1a\u9020\u6210\u5de8\u5927\u7684\u5dee\u8ddd\u3002\\n\\n### \u65e0\u6570\u636e\u5e93\u4f9d\u8d56\\n\\n\u5728 APISIX \u9879\u76ee\u51fa\u73b0\u4e4b\u524d\uff0c\u4e5f\u6709\u975e\u5e38\u591a\u7684\u5546\u4e1a API \u7f51\u5173\u6216\u5f00\u6e90 API \u7f51\u5173\u4ea7\u54c1\uff0c\u4f46\u8fd9\u4e9b\u4ea7\u54c1\u5927\u591a\u6570\u90fd\u628a API \u6570\u636e\u3001\u8def\u7531\u3001\u8bc1\u4e66\u548c\u914d\u7f6e\u7b49\u4fe1\u606f\u5b58\u653e\u5728\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u3002\\n\\n\u5c06\u8fd9\u4e9b\u6570\u636e\u5b58\u50a8\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u4f18\u52bf\u975e\u5e38\u660e\u663e\uff0c\u7528\u6237\u53ef\u4ee5\u66f4\u52a0\u65b9\u4fbf\u5730\u4f7f\u7528 SQL \u8bed\u53e5\u8fdb\u884c\u7075\u6d3b\u67e5\u8be2\uff0c\u4e5f\u65b9\u4fbf\u7528\u6237\u8fdb\u884c\u5907\u4efd\u53ca\u540e\u7eed\u7ef4\u62a4\u3002\\n\\n\u4f46\u662f\u7f51\u5173\u4f5c\u4e3a\u4e00\u4e2a\u57fa\u7840\u4e2d\u95f4\u4ef6\uff0c\u5b83\u5904\u7406\u4e86\u6240\u6709\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u6d41\u91cf\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5bf9\u4e8e\u53ef\u7528\u6027\u7684\u8981\u6c42\u4fbf\u4f1a\u975e\u5e38\u9ad8\u3002\u5982\u679c\u4f60\u7684 API \u7f51\u5173\u4f9d\u8d56\u4e86\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e00\u65e6\u51fa\u73b0\u4e86\u6545\u969c\uff08\u6bd4\u5982\u5b95\u673a\u3001\u4e22\u5931\u6570\u636e\uff09\uff0cAPI \u7f51\u5173\u4e5f\u4f1a\u56e0\u6b64\u53d7\u5230\u5f71\u54cd\uff0c\u6574\u4e2a\u4e1a\u52a1\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u4e5f\u4f1a\u5927\u6253\u6298\u6263\u3002\\n\\n\u800c APISIX \u5728\u8bbe\u8ba1\u4e4b\u521d\uff0c\u5c31\u4ece\u5e95\u5c42\u67b6\u6784\u4e0a\u907f\u514d\u4e86\u5b95\u673a\u3001\u4e22\u5931\u6570\u636e\u7b49\u60c5\u51b5\u7684\u53d1\u751f\u3002\u56e0\u4e3a\u5728\u63a7\u5236\u9762\u4e0a\uff0cAPISIX \u4f7f\u7528\u4e86 etcd \u5b58\u50a8\u914d\u7f6e\u4fe1\u606f\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a\\n\\n- \u4e0e\u4ea7\u54c1\u67b6\u6784\u7684\u4e91\u539f\u751f\u6280\u672f\u4f53\u7cfb\u66f4\u7edf\u4e00\uff1b\\n- \u66f4\u8d34\u5408 API \u7f51\u5173\u5b58\u653e\u7684\u6570\u636e\u7c7b\u578b\uff1b\\n- \u80fd\u66f4\u597d\u5730\u4f53\u73b0\u9ad8\u53ef\u7528\u7279\u6027\uff1b\\n- \u62e5\u6709\u4f4e\u4e8e\u6beb\u79d2\u7ea7\u522b\u7684\u53d8\u5316\u901a\u77e5\u3002\\n\\n\u4f7f\u7528 etcd \u5b58\u50a8\u914d\u7f6e\u4fe1\u606f\u540e\uff0c\u5bf9\u4e8e\u6570\u636e\u9762\u800c\u8a00\u53ea\u9700\u76d1\u542c etcd \u7684\u53d8\u5316\u5373\u53ef\u3002\u5982\u679c\u91c7\u7528\u8f6e\u8be2\u6570\u636e\u5e93\u7684\u65b9\u5f0f\uff0c\u53ef\u80fd\u9700\u8981 5-10 \u79d2\u624d\u80fd\u83b7\u53d6\u5230\u6700\u65b0\u7684\u914d\u7f6e\u4fe1\u606f\uff1b\u5982\u679c\u76d1\u542c etcd \u7684\u914d\u7f6e\u4fe1\u606f\u53d8\u66f4\uff0cAPISIX \u5c31\u53ef\u4ee5\u5c06\u83b7\u53d6\u6700\u65b0\u914d\u7f6e\u7684\u65f6\u95f4\u63a7\u5236\u5728\u6beb\u79d2\u7ea7\u522b\u4e4b\u5185\uff0c\u8fbe\u5230\u5b9e\u65f6\u751f\u6548\u3002\\n\\n\u56e0\u6b64\u4f7f\u7528 etcd \u4f5c\u4e3a\u5b58\u50a8\uff0c\u4e0d\u4ec5\u8ba9 APISIX \u5728\u5e95\u5c42\u4e0a\u66f4\u52a0\u8d34\u5408\u4e91\u539f\u751f\uff0c\u4e5f\u8ba9\u5b83\u5728\u7cfb\u7edf\u9ad8\u53ef\u7528\u7684\u4f53\u73b0\u4e0a\u5e26\u6765\u4e86\u66f4\u591a\u4f18\u52bf\u3002\\n\\n### \u9ad8\u6027\u80fd\u8def\u7531\u5339\u914d\u7b97\u6cd5\\n\\nAPI \u7f51\u5173\u9700\u8981\u4ece\u6bcf\u4e2a\u8bf7\u6c42\u7684 Host\u3001URI\u3001HTTP \u65b9\u6cd5\u7b49\u7279\u5f81\u4e2d\u5339\u914d\u5230\u76ee\u6807\u89c4\u5219\uff0c\u4ee5\u51b3\u5b9a\u5982\u4f55\u5bf9\u8be5\u8bf7\u6c42\u8fdb\u884c\u5904\u7406\uff0c\u56e0\u6b64\u4e00\u4e2a\u4f18\u79c0\u7684\u5339\u914d\u7b97\u6cd5\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002Hash \u7b97\u6cd5\u6027\u80fd\u4e0d\u9519\uff0c\u4f46\u65e0\u6cd5\u5b9e\u73b0\u6a21\u7cca\u5339\u914d\uff1b\u6b63\u5219\u53ef\u4ee5\u6a21\u7cca\u5339\u914d\uff0c\u4f46\u6027\u80fd\u4e0d\u597d\uff0c\u56e0\u6b64 Apache APISIX \u9009\u62e9\u4f7f\u7528\u6811\u8fd9\u6837\u4e00\u79cd\u9ad8\u6548\u4e14\u652f\u6301\u6a21\u7cca\u5339\u914d\u7684\u641c\u7d22\u6570\u636e\u7ed3\u6784\u3002\\n\\n\u51c6\u786e\u4e00\u4e9b\uff0cApache APISIX \u4f7f\u7528\u7684\u662f RadixTree\uff0c\u5b83\u63d0\u4f9b\u4e86 KV \u5b58\u50a8\u67e5\u627e\u7684\u6570\u636e\u7ed3\u6784\u5e76\u5bf9\u53ea\u6709\u4e00\u4e2a\u5b50\u8282\u70b9\u7684\u4e2d\u95f4\u8282\u70b9\u8fdb\u884c\u4e86\u538b\u7f29\uff0c\u56e0\u6b64\u5b83\u53c8\u88ab\u79f0\u4e3a\u538b\u7f29\u524d\u7f00\u6811\u3002\u6b64\u5916\uff0c\u5728\u5df2\u77e5 API \u7f51\u5173\u4ea7\u54c1\u4e2d Apache APISIX \u9996\u6b21\u5c06 RadixTree \u5e94\u7528\u5230\u4e86\u8def\u7531\u5339\u914d\u4e2d\uff0c\u652f\u6301\u4e00\u4e2a\u524d\u7f00\u4e0b\u6709\u591a\u4e2a\u4e0d\u540c\u8def\u7531\u7684\u573a\u666f\uff0c\u5177\u4f53\u5b9e\u73b0\u53c2\u8003 [lua-resty-radixtree](https://github.com/api7/lua-resty-radixtree)\u3002\\n\\n\u5f53\u5bf9\u67d0\u4e2a\u8bf7\u6c42\u8fdb\u884c\u5339\u914d\u65f6\uff0cRadixTree \u5c06\u91c7\u7528\u5c42\u5c42\u9012\u8fdb\u7684\u65b9\u5f0f\u8fdb\u884c\u5339\u914d\uff0c\u5176\u590d\u6742\u5ea6\u4e3a O(K)\uff08K \u662f\u8def\u7531\u4e2d URI \u7684\u957f\u5ea6\uff0c\u4e0e API \u6570\u91cf\u591a\u5c11\u65e0\u5173\uff09\uff0c\u8be5\u7b97\u6cd5\u975e\u5e38\u9002\u5408\u516c\u6709\u4e91\u3001CDN \u4ee5\u53ca\u8def\u7531\u6570\u91cf\u6bd4\u8f83\u591a\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u5f88\u597d\u5730\u6ee1\u8db3\u8def\u7531\u6570\u91cf\u5feb\u901f\u589e\u957f\u7684\u9700\u6c42\u3002\\n\\n### \u9ad8\u6027\u80fd IP \u5339\u914d\u7b97\u6cd5\\n\\nIP \u5730\u5740\u6709 2 \u79cd\u8bb0\u6cd5\uff1a\u6807\u51c6 IP \u8868\u793a\u65b9\u6cd5\u4e0e CIDR \u8868\u793a\u65b9\u6cd5\uff0c\u4ee5 32 \u4f4d\u7684 IPv4 \u4e3a\u4f8b\uff1a\\n\\n- \u6807\u51c6 IP \u8bb0\u6cd5\uff1a192.168.1.1\\n- CIDR \u8bb0\u6cd5\uff1a192.168.1.1/8\\n\\nApache APISIX \u7684 IP \u5339\u914d\u7b97\u6cd5\u4e0e\u8def\u7531\u5339\u914d\u7b97\u6cd5\u6240\u4f7f\u7528\u7684\u539f\u7406\u4ee5\u53ca\u539f\u59cb\u6570\u636e\u662f\u4e0d\u4e00\u6837\u7684\u3002\u4ee5 192.168.1.1 \u8fd9\u4e2a IP \u4e3a\u4f8b\uff0c\u7531\u4e8e\u6bcf\u4e2a IP \u6bb5\u7684\u8303\u56f4\u662f 0 \u5230 255\uff0c\u56e0\u6b64\u5728\u5bf9 IP \u8fdb\u884c\u5339\u914d\u65f6\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a IP \u5730\u5740\u662f\u7531 4 \u4e2a 16 \u4f4d\u6574\u6570\u578b\u7684\u6570\u6784\u6210\u7684\uff0cIP \u957f\u5ea6\u662f\u56fa\u5b9a\u7684\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u66f4\u9ad8\u6548\u7684\u7b97\u6cd5\u5b8c\u6210\u5339\u914d\u3002\\n\\n\u5047\u8bbe\u73b0\u5728\u6709\u4e00\u4e2a\u5305\u542b 500 \u6761 IPv4 \u8bb0\u5f55\u7684 IP \u5e93\uff0cAPISIX \u4f1a\u5c06 500 \u6761 IPv4 \u7684\u8bb0\u5f55\u7f13\u5b58\u5728 Hash \u8868\u4e2d\uff0c\u5f53\u8fdb\u884c IP \u5339\u914d\u65f6\u4f7f\u7528 Hash \u7684\u65b9\u5f0f\u8fdb\u884c\u67e5\u627e\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\u3002\\n\\n\u800c\u5176\u4ed6 API \u7f51\u5173\u5219\u662f\u901a\u8fc7\u904d\u5386\u7684\u65b9\u5f0f\u5b8c\u6210 IP \u5339\u914d\uff0c\u53d1\u9001\u5230\u7f51\u5173\u6bcf\u4e2a\u8bf7\u6c42\u5c06\u9010\u4e2a\u904d\u5386\u6700\u591a 500 \u6b21\u662f\u5426\u76f8\u7b49\u540e\u624d\u80fd\u77e5\u9053\u8ba1\u7b97\u7ed3\u679c\u3002\u6240\u4ee5 APISIX \u7684\u9ad8\u7cbe\u5ea6 IP \u5339\u914d\u7b97\u6cd5\u5927\u5927\u63d0\u9ad8\u4e86\u9700\u8981\u8fdb\u884c\u6d77\u91cf IP \u9ed1\u767d\u540d\u5355\u5339\u914d\u573a\u666f\uff08\u5982 WAF\uff09\u7684\u6548\u7387\u3002\\n\\n### \u7cbe\u7ec6\u5316\u8def\u7531\\n\\nAPI \u7f51\u5173\u901a\u8fc7\u8bf7\u6c42\u4e2d\u7684\u6d41\u91cf\u7279\u5f81\u5b8c\u6210\u9884\u8bbe\u89c4\u5219\u7684\u5339\u914d\uff0c\u5e38\u89c1\u7279\u5f81\u5305\u542b\u4e86\u8bf7\u6c42\u4e2d\u7684 Host\u3001URI \u8def\u5f84\u3001URI \u67e5\u8be2\u53c2\u6570\u3001URI \u8def\u5f84\u53c2\u6570\u3001HTTP \u8bf7\u6c42\u65b9\u6cd5\u3001\u8bf7\u6c42\u5934\u7b49\uff0c\u8fd9\u4e9b\u7279\u5f81\u662f\u5927\u90e8\u5206 API \u7f51\u5173\u4ea7\u54c1\u6240\u652f\u6301\u7684\u3002\u76f8\u8f83\u4e8e\u5176\u5b83\u4ea7\u54c1\uff0cApache APISIX \u652f\u6301\u4e86\u66f4\u591a\u7279\u5f81\u4ee5\u89e3\u51b3\u590d\u6742\u591a\u53d8\u7684\u4f7f\u7528\u573a\u666f\u3002\\n\\n\u9996\u5148\uff0cApache APISIX \u652f\u6301 NGINX \u5185\u7f6e\u53d8\u91cf\uff0c\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u5c06\u8bf8\u5982 `uri`\u3001`server_name`\u3001`server_addr`\u3001`request_uri`\u3001`remote_port`\u3001`remote_addr`\u3001`query_string`\u3001`host`\u3001`hostname`\u3001`hostname`\u3001`arg_name` \u7b49\u6570\u5341\u79cd NGINX \u5185\u7f6e\u53d8\u91cf\u4f5c\u4e3a\u5339\u914d\u53c2\u6570\uff0c\u4ee5\u652f\u6301\u66f4\u590d\u6742\u591a\u53d8\u7684\u5339\u914d\u573a\u666f\u3002NGINX \u5185\u7f6e\u53d8\u91cf\u5217\u8868\u8bf7\u53c2\u8003 [NGINX \u53d8\u91cf](http://nginx.org/en/docs/varindex.html)\u6587\u6863\u3002\\n\\n\u5176\u6b21\uff0cApache APISIX \u652f\u6301\u5c06\u6761\u4ef6\u8868\u8fbe\u5f0f\u4f5c\u4e3a\u5339\u914d\u89c4\u5219\uff0c\u5176\u7ed3\u6784\u662f `[var, operator, val], ...]]`\uff0c\u5176\u4e2d\uff1a\\n\\n- `var` \u503c\u53ef\u4f7f\u7528 NGINX \u5185\u7f6e\u53d8\u91cf\uff1b\\n- `operator` \u652f\u6301\u76f8\u7b49\u3001\u4e0d\u7b49\u3001\u5927\u4e8e\u3001\u5c0f\u4e8e\u3001\u6b63\u5219\u3001\u5305\u542b\u7b49\u64cd\u4f5c\u7b26\u3002\\n\\n\u5047\u8bbe\u8868\u8fbe\u5f0f\u4e3a `[\\"arg_name\\", \\"==\\", \\"json\\"]` \uff0c\u5b83\u610f\u5473\u7740\u5f53\u524d\u8bf7\u6c42\u7684 URI \u67e5\u8be2\u53c2\u6570\u4e2d\uff0c\u662f\u5426\u6709\u4e00\u4e2a\u4e3a `name` \u7684\u53c2\u6570\u503c\u7b49\u4e8e `json`\u3002Apache APISIX \u662f\u901a\u8fc7\u81ea\u7814\u7684\u5e93 `lua-resty-expr` \u5b9e\u73b0\u8be5\u80fd\u529b\u7684\uff0c\u5177\u4f53\u8bf7\u53c2\u8003 [lua-resty-expr](https://github.com/api7/lua-resty-expr)\u3002\u8be5\u7279\u6027\u5c06\u9009\u62e9\u6743\u4ea4\u7ed9\u4e86\u7528\u6237\uff0c\u53ef\u6269\u5c55\u6027\u5f3a\u3002\\n\\n\u6b64\u5916\uff0cApache APISIX \u652f\u6301\u8bbe\u7f6e\u8def\u7531 `ttl` \u5b58\u6d3b\u65f6\u95f4\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/2?ttl=60 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n{\\n    \\"uri\\": \\"/aa/index.html\\",\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"39.97.63.215:80\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u4ee5\u4e0a\u914d\u7f6e\u8868\u793a\uff0c\u5728 60s \u540e APISIX \u4f1a\u81ea\u52a8\u5220\u9664\u8be5\u8def\u7531\u914d\u7f6e\uff0c\u975e\u5e38\u9002\u5408\u4e00\u4e9b\u4e34\u65f6\u9a8c\u8bc1\u7684\u573a\u666f\uff0c\u6bd4\u5982\u91d1\u4e1d\u96c0\u53d1\u5e03\u3001\u76d1\u63a7\u8f93\u51fa\u7b49\u3002\u5bf9\u4e8e\u7ebf\u4e0a\u7684\u6d41\u91cf\u5206\u6d41\u975e\u5e38\u65b9\u4fbf\uff0c\u662f\u5176\u5b83\u7f51\u5173\u4ea7\u54c1\u6240\u4e0d\u5177\u5907\u7684\u80fd\u529b\u3002\\n\\n\u6700\u540e\u4e00\u70b9\u662f Apache APISIX \u652f\u6301\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u51fd\u6570\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728 `filter_func` \u53c2\u6570\u4e2d\u7f16\u5199\u81ea\u5b9a\u4e49 Lua \u51fd\u6570\uff0c\u4f8b\u5982\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n{\\n    \\"uri\\": \\"/index.html\\",\\n    \\"hosts\\": [\\"foo.com\\", \\"*.bar.com\\"],\\n    \\"filter_func\\": \\"function(vars)\\n                    return vars[\'host\'] == \'api7.ai\'\\n                end\\",\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u5176\u4e2d `filter_func` \u5165\u53c2\u662f `vars`\uff0c\u53ef\u4ece `vars` \u83b7\u53d6 NGINX \u53d8\u91cf\uff0c\u7136\u540e\u5b9e\u73b0\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u903b\u8f91\u3002\\n\\n### \u652f\u6301\u591a\u8bed\u8a00\u63d2\u4ef6\\n\\n\u867d\u7136 API \u7f51\u5173\u3001\u6570\u636e\u5e93\u6216\u5176\u4ed6\u4e2d\u95f4\u4ef6\u90fd\u5c5e\u4e8e\u57fa\u7840\u7ec4\u4ef6\uff0c\u4f46\u662f\u66f4\u591a\u65f6\u5019\u7528\u6237\u662f\u6839\u636e\u4f7f\u7528\u573a\u666f\u5bf9 API \u7f51\u5173\u8fdb\u884c\u4e00\u4e9b\u5b9a\u5236\u5316\u5730\u5f00\u53d1\u548c\u7cfb\u7edf\u96c6\u6210\u3002\\n\\nAPISIX \u76ee\u524d\u5df2\u7ecf\u652f\u6301\u4e86 80 \u591a\u79cd\u63d2\u4ef6\uff0c\u4f46\u4ecd\u7136\u96be\u4ee5\u6db5\u76d6\u7528\u6237\u7684\u6240\u6709\u4f7f\u7528\u573a\u666f\u3002\u5728\u5b9e\u9645\u4f7f\u7528\u573a\u666f\u4e2d\uff0c\u5f88\u591a\u4f01\u4e1a\u90fd\u4f1a\u9488\u5bf9\u5177\u4f53\u4e1a\u52a1\u8fdb\u884c\u5b9a\u5236\u5316\u7684\u63d2\u4ef6\u5f00\u53d1\uff0c\u901a\u8fc7\u7f51\u5173\u53bb\u96c6\u6210\u66f4\u591a\u7684\u534f\u8bae\u6216\u8005\u7cfb\u7edf\uff0c\u6700\u7ec8\u5728\u7f51\u5173\u5c42\u5b9e\u73b0\u7edf\u4e00\u7ba1\u7406\u3002\\n\\n\u5728 APISIX \u65e9\u671f\u7248\u672c\u4e2d\uff0c\u5f00\u53d1\u8005\u4ec5\u80fd\u4f7f\u7528 Lua \u8bed\u8a00\u5f00\u53d1\u63d2\u4ef6\u3002\u867d\u7136\u901a\u8fc7\u539f\u751f\u8ba1\u7b97\u8bed\u8a00\u5f00\u53d1\u7684\u63d2\u4ef6\u5177\u5907\u975e\u5e38\u9ad8\u7684\u6027\u80fd\uff0c\u4f46\u662f\u5b66\u4e60 Lua \u8fd9\u95e8\u65b0\u7684\u5f00\u53d1\u8bed\u8a00\u662f\u9700\u8981\u65f6\u95f4\u548c\u7406\u89e3\u6210\u672c\u7684\u3002\\n\\n\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0cAPISIX \u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\u6765\u89e3\u51b3\uff1a\\n\\n\u7b2c\u4e00\u79cd\u65b9\u5f0f\u662f\u901a\u8fc7 Plugin Runner \u6765\u652f\u6301\u66f4\u591a\u7684\u4e3b\u6d41\u7f16\u7a0b\u8bed\u8a00\uff08\u6bd4\u5982 Java\u3001Python\u3001Go \u7b49\u7b49\uff09\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u8ba9\u540e\u7aef\u5de5\u7a0b\u5e08\u901a\u8fc7\u672c\u5730 RPC \u901a\u4fe1\uff0c\u4f7f\u7528\u719f\u6089\u7684\u7f16\u7a0b\u8bed\u8a00\u5f00\u53d1 APISIX \u7684\u63d2\u4ef6\u3002\\n\\n\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u51cf\u5c11\u4e86\u5f00\u53d1\u6210\u672c\uff0c\u63d0\u9ad8\u4e86\u5f00\u53d1\u6548\u7387\uff0c\u4f46\u662f\u5728\u6027\u80fd\u4e0a\u4f1a\u6709\u4e00\u4e9b\u635f\u5931\u3002\u90a3\u4e48\uff0c\u6709\u6ca1\u6709\u4e00\u79cd\u65e2\u80fd\u8fbe\u5230 Lua \u539f\u751f\u6027\u80fd\uff0c\u540c\u65f6\u53c8\u517c\u987e\u9ad8\u7ea7\u7f16\u7a0b\u8bed\u8a00\u7684\u5f00\u53d1\u6548\u7387\u65b9\u6848\u5462\uff1f\\n\\n![\u591a\u8bed\u8a00\u67b6\u6784](https://static.apiseven.com/2022/09/13/632057a0ad122.png)\\n\\n\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u662f\u4f7f\u7528 Wasm \u5f00\u53d1\u63d2\u4ef6\uff0c\u4e5f\u5c31\u662f\u4e0a\u56fe\u5de6\u4fa7\u90e8\u5206\u3002Wasm\uff08WebAssembly\uff09\u6700\u65e9\u662f\u7528\u5728\u524d\u7aef\u548c\u6d4f\u89c8\u5668\u4e0a\u7684\u4e00\u4e2a\u6280\u672f\uff0c\u4f46\u662f\u73b0\u5728\u5728\u670d\u52a1\u7aef\u5b83\u4e5f\u9010\u6e10\u5c55\u793a\u51fa\u6765\u5b83\u7684\u4f18\u52bf\u3002\u6211\u4eec\u5c06 Wasm \u5d4c\u5165\u5230\u4e86 APISIX \u4e2d\uff0c\u7528\u6237\u5c31\u53ef\u4ee5\u4f7f\u7528 Wasm \u53bb\u7f16\u8bd1\u6210 Wasm \u7684\u5b57\u8282\u7801\u5728 APISIX \u4e2d\u8fd0\u884c\u3002\u6700\u7ec8\u8fbe\u5230\u7684\u6548\u679c\u5c31\u662f\u5229\u7528\u9ad8\u6548\u7387\uff0c\u5f00\u53d1\u51fa\u4e86\u4e00\u4e2a\u65e2\u6709\u9ad8\u6027\u80fd\u53c8\u4f7f\u7528\u9ad8\u7ea7\u8ba1\u7b97\u8bed\u8a00\u7f16\u5199\u7684 APISIX \u63d2\u4ef6\u3002\\n\\n\u56e0\u6b64\uff0c\u5728\u5f53\u524d APISIX \u7248\u672c\u4e2d\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528 Lua\u3001Go\u3001Python \u548c Wasm \u7b49\u591a\u79cd\u65b9\u5f0f\uff0c\u57fa\u4e8e APISIX \u7f16\u5199\u81ea\u5b9a\u4e49\u63d2\u4ef6\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\uff0c\u964d\u4f4e\u4e86\u5f00\u53d1\u8005\u7684\u4f7f\u7528\u95e8\u69db\uff0c\u4e5f\u4e3a APISIX \u7684\u529f\u80fd\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u53ef\u80fd\u6027\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4ece\u5de5\u7a0b\u5e08\u3001\u5f00\u6e90\u534f\u8bae\u3001\u6027\u80fd\u8bc4\u6d4b\u3001\u6280\u672f\u3001\u751f\u6001\u7cfb\u7edf\u7b49\u591a\u4e2a\u89d2\u5ea6\u5206\u6790\u548c\u6bd4\u8f83\u4e86\u4e00\u4e9b API \u7f51\u5173\u4ea7\u54c1\uff0c\u53ef\u4ee5\u770b\u51fa Apache APISIX \u662f\u5176\u4e2d\u7684\u4f7c\u4f7c\u8005\uff0c\u5f15\u9886\u4e86 API \u7f51\u5173\u9886\u57df\u7684\u521b\u65b0\u3002\\n\\nApache APISIX \u4e0d\u4ec5\u662f\u4e00\u4e2a\u53ef\u4ee5\u5904\u7406\u5357\u5317\u5411\u6d41\u91cf\u7684 API \u7f51\u5173\uff0c\u540c\u65f6\u4e5f\u6709 APISIX Ingress Controller\u3001Service Mesh \u7b49\u5f00\u6e90\u4ea7\u54c1\u3002\u672c\u6708\u5e95 APISIX \u4e5f\u5c06\u53d1\u5e03 3.0 \u9884\u89c8\u7248\uff0c\u5e26\u6765\u5168\u65b0\u529f\u80fd\u4e0e\u5168\u65b9\u4f4d\u4ea7\u54c1\u63d0\u5347\uff0c\u656c\u8bf7\u671f\u5f85\uff01"},{"id":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 CNCF OpenFunction","metadata":{"permalink":"/zh/blog/2022/09/20/apisix-integrate-cncf-openfunction","source":"@site/blog/2022/09/20/apisix-integrate-cncf-openfunction.md","title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 CNCF OpenFunction","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX openfunction \u63d2\u4ef6\u7684\u529f\u80fd\u4e0e\u4f7f\u7528\u6b65\u9aa4\uff0c\u4e3a APISIX \u7684\u65e0\u670d\u52a1\u9886\u57df\u529f\u80fd\u518d\u6dfb\u4e00\u5458\u3002","date":"2022-09-20T00:00:00.000Z","formattedDate":"2022\u5e749\u670820\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":7.18,"truncated":true,"authors":[{"name":"\u674e\u4ece\u65fa","title":"Author","url":"https://github.com/jackkkkklee","image_url":"https://github.com/jackkkkklee.png","imageURL":"https://github.com/jackkkkklee.png"}],"prevItem":{"title":"\u4e3a\u4ec0\u4e48\u8bf4 Apache APISIX \u662f\u6700\u597d\u7684 API \u7f51\u5173\uff1f","permalink":"/zh/blog/2022/09/27/why-apache-apisix-is-best-apigateway"},"nextItem":{"title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Elasticsearch \u5b9e\u73b0\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7","permalink":"/zh/blog/2022/09/15/apache-apisix-integrat-with-elasticsearch-for-logger"}},"content":"> \u672c\u6587\u4f5c\u8005\u674e\u4ece\u65fa\uff0c\u5f00\u6e90\u7231\u597d\u8005\u4e0e\u4e91\u539f\u751f\u6280\u672f\u7231\u597d\u8005\uff0c\u76ee\u524d\u4e8e\u4f50\u6cbb\u4e9a\u7406\u5de5\u5b66\u9662\u6df1\u5733\u6821\u533a\u8fdb\u4fee\u7855\u58eb\u5b66\u4f4d\u3002\u672c\u7bc7\u6587\u7ae0\u662f\u5728\u53c2\u4e0e APISIX \u5f00\u6e90\u4e4b\u590f\u9879\u76ee\u300c\u96c6\u6210 OpenFunction \u81f3 Apache APISIX\u300d\u7684\u529f\u80fd\u5448\u73b0\uff0c\u5e0c\u671b\u6b64\u529f\u80fd\u53ef\u4ee5\u8ba9\u4f60\u5728\u4f7f\u7528 APISIX \u8fdb\u884c\u6269\u5c55\u65f6\u66f4\u52a0\u4fbf\u6377\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u5728\u65e0\u670d\u52a1\u65f6\u4ee3\uff0cAPI \u7f51\u5173\u4f9d\u65e7\u662f\u7ba1\u7406\u548c\u5145\u5206\u5229\u7528\u65e0\u670d\u52a1\u5668\u5e73\u53f0\u7684\u5173\u952e\u3002\u56e0\u6b64\uff0cApache APISIX \u793e\u533a\u4e5f\u7d27\u8ddf\u8d8b\u52bf\uff0c\u5728\u8fc7\u53bb\u7684\u4e00\u5e74\u591a\u65f6\u95f4\u5185\u96c6\u6210\u4e86\u65e0\u670d\u52a1\u5668\u63d0\u4f9b\u5546\uff0c\u5982 [AWS Lambda](https://aws.amazon.com/lambda/) \u548c [Azure Functions](https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview)\uff0c\u4ee5\u53ca\u5f00\u6e90\u7684\u65e0\u670d\u52a1\u5e73\u53f0 [Apache OpenWhisk](https://openwhisk.apache.org/) \u7b49\u3002\\n\\n\u672c\u6708\uff0cAPISIX \u53c8\u65b0\u589e\u4e86\u4e0d\u5c11\u751f\u6001\u63d2\u4ef6\uff0c\u5176\u4e2d\u5c31\u5305\u62ec\u4e0e [OpenFunction](https://openfunction.dev/) \u96c6\u6210\u7684\u65e0\u670d\u52a1\u63d2\u4ef6 `openfunction`\u3002\u672c\u6587\u5c06\u4ecb\u7ecd Apache APISIX \u65b0\u7684\u65e0\u670d\u52a1\u63d2\u4ef6 `openfunction`\uff0c\u5e76\u5e26\u6765\u66f4\u591a\u96c6\u6210\u7ec6\u8282\u3002\\n\\n## Apache APISIX\\n\\n[Apache APISIX](https://apisix.apache.org/) \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u4e0d\u4ec5\u652f\u6301\u63d2\u4ef6\u52a8\u6001\u53d8\u66f4\u548c\u70ed\u63d2\u62d4\uff0c\u800c\u4e14\u62e5\u6709\u4f17\u591a\u5b9e\u7528\u7684\u63d2\u4ef6\u3002\\n\\n## OpenFunction\\n\\nOpenFunction \u662f\u4e00\u4e2a\u4e91\u539f\u751f\u7684\u5f00\u6e90 FaaS \u5e73\u53f0\uff0c\u65e8\u5728\u8ba9\u7528\u6237\u4e13\u6ce8\u4e8e\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u800c\u4e0d\u5fc5\u7ef4\u62a4\u5e95\u5c42\u8fd0\u884c\u65f6\u73af\u5883\u548c\u57fa\u7840\u8bbe\u65bd\u3002\\n\\n\u6838\u5fc3\u529f\u80fd\u5305\u62ec\uff1a\\n\\n- \u4e0e\u4e91\u63d0\u4f9b\u5546\u7684 BaaS \u89e3\u8026\\n- \u53ef\u63d2\u5165\u7684\u67b6\u6784\uff0c\u5141\u8bb8\u591a\u4e2a\u51fd\u6570\u8fd0\u884c\u65f6\\n- \u540c\u65f6\u652f\u6301\u540c\u6b65\u548c\u5f02\u6b65\u51fd\u6570\\n- \u72ec\u7279\u7684\u5f02\u6b65\u51fd\u6570\u652f\u6301\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u6765\u81ea\u4e8b\u4ef6\u6e90\u7684\u4e8b\u4ef6\\n- \u652f\u6301\u76f4\u63a5\u4ece\u51fd\u6570\u6e90\u4ee3\u7801\u751f\u6210\u517c\u5bb9 OCI \u7684\u5bb9\u5668\u955c\u50cf\u3002\\n- \u7075\u6d3b\u7684\u4ece 0 \u5230 n \u7684\u81ea\u52a8\u7f29\u653e\\n- \u652f\u6301\u57fa\u4e8e\u4e8b\u4ef6\u6e90\u7684\u7279\u5b9a\u6307\u6807\u7684\u9ad8\u7ea7\u5f02\u6b65\u529f\u80fd\u81ea\u52a8\u7f29\u653e\\n- \u901a\u8fc7\u5f15\u5165 [Dapr](https://dapr.io/) \u7b80\u5316\u540c\u6b65\u548c\u5f02\u6b65\u529f\u80fd\u7684 BaaS \u96c6\u6210\\n- [K8s Gateway API](https://gateway-api.sigs.k8s.io/) \u63d0\u4f9b\u7684\u9ad8\u7ea7\u51fd\u6570\u5165\u53e3\u548c\u6d41\u91cf\u7ba1\u7406\uff08\u8fdb\u884c\u4e2d\uff09\\n- \u7075\u6d3b\u6613\u7528\u7684\u4e8b\u4ef6\u7ba1\u7406\u6846\u67b6\\n\\n## \u96c6\u6210\u539f\u7406\\n\\n\u8be5\u63d2\u4ef6\u4f1a\u5c06\u6b63\u5728\u8fdb\u884c\u7684\u8bf7\u6c42\u8f6c\u53d1\u5230\u7528\u6237\u5b9a\u4e49\u7684\u7279\u5b9a URI\uff0c\u5e76\u63d0\u4f9b\u76f8\u5173\u7684\u6388\u6743\u7ec6\u8282\u3001\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u6b63\u6587\u548c\u67e5\u8be2\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u5c06\u54cd\u5e94\u8fd4\u56de\u7ed9\u539f\u59cb\u7684\u5ba2\u6237\u7aef\u3002\\n\\n\u65e0\u670d\u52a1\u5177\u6709\u9ad8\u5ea6\u53ef\u6269\u5c55\u548c\u6210\u672c\u4f4e\u7b49\u4f18\u52bf\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u90e8\u7f72\u4e1a\u52a1\u670d\u52a1\u80fd\u591f\u6781\u5927\u964d\u4f4e\u8d44\u6e90\u4f7f\u7528\u548c\u6295\u5165\u6210\u672c\u3002\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528 OpenFunction \u4f5c\u4e3a\u65e0\u670d\u52a1\u5e73\u53f0\uff0c\u4f60\u5c31\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u53bb\u4ee3\u7406\u8fd9\u4e9b\u51fd\u6570\u7684\u8bf7\u6c42\uff0c\u4e3a\u51fd\u6570\u8bf7\u6c42\u8ffd\u52a0\u670d\u52a1\u6cbb\u7406\u7684\u80fd\u529b\u3002\\n\\n\u6b63\u5982\u524d\u6587\u63d0\u5230\u7684 OpenFunction \u6838\u5fc3\u529f\u80fd\uff0c[K8s Gateway API](https://gateway-api.sigs.k8s.io/) \u63d0\u4f9b\u4e86\u51fd\u6570\u7684\u5165\u53e3\u3002OpenFunction \u7684\u8ba4\u8bc1\u65b9\u5f0f\u53d6\u51b3\u4e8e K8s \u7f51\u5173\uff0c\u4e14\u968f\u7f51\u5173\u7684\u9009\u62e9\u800c\u53d8\u5316\u3002\u56e0\u6b64\u8be5\u63d2\u4ef6\u53ea\u652f\u6301\u6807\u51c6\u7684 Basic Auth \u8ba4\u8bc1\u65b9\u5f0f\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528\u63d2\u4ef6\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u5b89\u88c5\u4e0e\u8fd0\u884c APISIX\\n\\n\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528 Docker \u5feb\u901f\u5b89\u88c5 APISIX\uff0c\u56e0\u6b64\u4f60\u9700\u8981\u9884\u5148\u5b89\u88c5 [Docker](https://www.docker.com/) \u548c [Docker Compose](https://docs.docker.com/compose/)\u3002\\n\\n\u5b89\u88c5\u8be6\u60c5\u4ee5\u53ca\u66f4\u591a\u5b89\u88c5\u65b9\u5f0f\u8bf7\u53c2\u8003[APISIX \u5b89\u88c5\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/installation-guide/)\uff0c\u540e\u7eed\u7684\u4f7f\u7528\u6b65\u9aa4\u8bf7\u53c2\u8003 [\u5feb\u901f\u5165\u95e8\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/getting-started/)\u3002\\n\\n### \u6b65\u9aa4\u4e8c\uff1a \u901a\u8fc7 Helm Chart \u5b89\u88c5 OpenFunction\\n\\n\u8bf7\u786e\u4fdd\u5f53\u524d\u73af\u5883\u4e2d\u5df2\u7ecf\u5b89\u88c5\u5bf9\u5e94\u7248\u672c\u7684 Kubernetes \u96c6\u7fa4\u3002\u8be6\u60c5\u53ef\u53c2\u8003 [OpenFunction \u5b89\u88c5\u6307\u5357](https://openfunction.dev/docs/getting-started/installation/) \u3002\\n\\n```shell\\n# \u6dfb\u52a0 OpenFunction \u5230 Chart \u5b58\u50a8\u5e93\\nhelm repo add openfunction https://openfunction.github.io/charts/\\nhelm repo update\\n```\\n\\n```shell\\n# \u5b89\u88c5 OpenFunction chart\\nkubectl create namespace openfunction\\nhelm install openfunction openfunction/openfunction -n openfunction\\n```\\n\\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u6765\u9a8c\u8bc1 OpenFunction \u662f\u5426\u5df2\u7ecf\u5b89\u88c5\u6210\u529f\uff1a\\n\\n```shell\\nkubectl get pods --namespace openfunction\\n```\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u521b\u5efa\u5e76\u63a8\u9001\u51fd\u6570\\n\\n\u4f60\u53ef\u4ee5\u53c2\u8003 [OpenFunction \u5b98\u65b9\u793a\u4f8b](https://github.com/OpenFunction/samples) \u521b\u5efa\u51fd\u6570\u3002\u6784\u5efa\u51fd\u6570\u65f6\uff0c\u4f60\u9700\u8981\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u4e3a\u5bb9\u5668\u4ed3\u5e93\u751f\u6210\u4e00\u4e2a\u5bc6\u94a5\uff0c\u624d\u53ef\u4ee5\u5c06\u51fd\u6570\u5bb9\u5668\u955c\u50cf\u63a8\u9001\u5230\u5bb9\u5668\u4ed3\u5e93 ( \u4f8b\u5982 Docker Hub \u6216 Quay.io\uff09\u3002\\n\\n```shell\\nREGISTRY_SERVER=https://index.docker.io/v1/ REGISTRY_USER=${your_registry_user} REGISTRY_PASSWORD=${your_registry_password}\\nkubectl create secret docker-registry push-secret \\\\\\n    --docker-server=$REGISTRY_SERVER \\\\\\n    --docker-username=$REGISTRY_USER \\\\\\n    --docker-password=$REGISTRY_PASSWORD\\n```\\n\\n### \u6b65\u9aa4\u56db\uff1a\u542f\u7528\u63d2\u4ef6\\n\\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u5728\u6307\u5b9a\u8def\u7531\u4e2d\u542f\u7528\u8be5\u63d2\u4ef6\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {\\n        \\"openfunction\\": {\\n            \\"function_uri\\": \\"http://localhost:30583/default/function-sample/test\\",\\n            \\"authorization\\": {\\n                \\"service_token\\": \\"test:test\\"\\n            }\\n        }\\n    }\\n}\'\\n```\\n\\n\u5176\u4e2d `9180`\u662f APISIX admin API \u66b4\u9732\u7684\u7aef\u53e3 \uff0c\u800c `localhost:30583` \u662f\u5047\u8bbe\u672c\u6b21\u901a\u8fc7 NodePort \u65b9\u5f0f\u6620\u5c04\u7684\u7f51\u5173\u5165\u53e3\u3002\\n\\n\u66f4\u591a\u5173\u4e8e OpenFunction \u51fd\u6570\u5165\u53e3\u4ee5\u53ca\u5982\u4f55\u8bbe\u7f6e\u8bf7\u53c2\u8003 [Function Entrypoints | OpenFunction](https://openfunction.dev/docs/concepts/networking/function-entrypoints/)\u3002\\n\\n### \u6b65\u9aa4\u4e94\uff1a\u53d1\u9001\u8bf7\u6c42\\n\\n\u63d2\u4ef6\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u4f60\u53ef\u4ee5\u5411\u8def\u7531\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\uff0c\u5b83\u4f1a\u8c03\u7528\u914d\u7f6e\u597d\u7684\u51fd\u6570\u3002\u5b98\u65b9\u7684\u793a\u4f8b\u51fd\u6570 hello-world \u4f1a\u8f93\u51fa \u201cHello, {\u51fd\u6570 uri \u4e2d\u7684\u540e\u7f00\u90e8\u5206}!\\\\n\u201d\u3002\\n\\n```shell\\n# 9080 \u662f APISIX \u9664 admin API \u4ee5\u5916\u66b4\u9732\u7684\u7aef\u53e3\\ncurl -i http://127.0.0.1:9080/hello\\n```\\n\\n\u51fd\u6570\u8fd4\u56de\u7684\u54cd\u5e94\u5982\u4e0b\uff1a\\n\\n```text\\nhello, test!\\n```\\n\\n## \u5173\u95ed\u63d2\u4ef6\\n\\n\u5f53\u4f60\u4e0d\u9700\u8981\u518d\u4f7f\u7528\u8be5\u63d2\u4ef6\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ece\u8def\u7531\u914d\u7f6e\u4e2d\u53bb\u9664 `openfunction` \u63d2\u4ef6\u6765\u7981\u7528\u5b83\u7684\u529f\u80fd\uff08\u6ce8\u610f\uff0c\u6309\u7167 Apache APISIX \u8def\u7531 Schema \u8981\u6c42\uff0c\u5728\u53bb\u9664\u8be5\u63d2\u4ef6\u540e\uff0c\u5982\u679c\u8be5\u8def\u7531\u6ca1\u6709\u5176\u4ed6\u63d2\u4ef6\uff0c\u4f60\u5fc5\u987b\u4e3a\u8be5\u8def\u7531\u914d\u7f6e\u4e00\u4e2a\u4e0a\u6e38\u5bf9\u8c61\uff09\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n\\n    \\"uri\\": \\"/hello\\",\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86 Apache APISIX `openfunction` \u63d2\u4ef6\u7684\u529f\u80fd\u4e0e\u4f7f\u7528\u6b65\u9aa4\uff0c\u66f4\u591a\u5173\u4e8e `openfunction` \u63d2\u4ef6\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u5217\u8868\uff0c\u53ef\u4ee5\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/next/plugins/openfunction/)\u3002\\n\\n\u76ee\u524d\uff0cAPISIX \u793e\u533a\u4e5f\u5728\u5f00\u53d1\u5176\u4ed6 Serverless \u63d2\u4ef6\u4ee5\u4fbf\u4e0e\u66f4\u591a\u4e91\u670d\u52a1\u8fdb\u884c\u96c6\u6210\u3002\u5982\u679c\u4f60\u5bf9\u6b64\u7c7b\u96c6\u6210\u9879\u76ee\u611f\u5174\u8da3\uff0c\u4e5f\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Elasticsearch \u5b9e\u73b0\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7","metadata":{"permalink":"/zh/blog/2022/09/15/apache-apisix-integrat-with-elasticsearch-for-logger","source":"@site/blog/2022/09/15/apache-apisix-integrat-with-elasticsearch-for-logger.md","title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Elasticsearch \u5b9e\u73b0\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7","description":"\u672c\u6587\u5c06\u4e3a\u4f60\u4ecb\u7ecd Apache APISIX \u7684 elasticsearch-logger \u63d2\u4ef6\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u4ee5\u53ca\u5982\u4f55\u901a\u8fc7\u6b64\u63d2\u4ef6\u83b7\u53d6 APISIX \u7684\u5b9e\u65f6\u65e5\u5fd7\u3002","date":"2022-09-15T00:00:00.000Z","formattedDate":"2022\u5e749\u670815\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.65,"truncated":true,"authors":[{"name":"\u738b\u7a0b\u7a0b","title":"Author","url":"https://github.com/ccxhwmy","image_url":"https://github.com/ccxhwmy.png","imageURL":"https://github.com/ccxhwmy.png"}],"prevItem":{"title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 CNCF OpenFunction","permalink":"/zh/blog/2022/09/20/apisix-integrate-cncf-openfunction"},"nextItem":{"title":"Apache APISIX \u8fd0\u884c\u65f6\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u8be6\u89e3","permalink":"/zh/blog/2022/08/19/apache-apisix-runtime-dynamic-debugging"}},"content":"> \u672c\u6587\u5c06\u4e3a\u4f60\u4ecb\u7ecd Apache APISIX \u7684 elasticsearch-logger \u63d2\u4ef6\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u4ee5\u53ca\u5982\u4f55\u901a\u8fc7\u6b64\u63d2\u4ef6\u83b7\u53d6 APISIX \u7684\u5b9e\u65f6\u65e5\u5fd7\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\n**Apache APISIX** \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 **API** \u7f51\u5173\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f5c\u4e3a **API** \u7f51\u5173\uff0c**Apache APISIX** \u4e0d\u4ec5\u62e5\u6709\u4e30\u5bcc\u7684\u63d2\u4ef6\uff0c\u800c\u4e14\u652f\u6301\u63d2\u4ef6\u7684\u70ed\u52a0\u8f7d\u3002\\n\\n**Elasticsearch** \u662f\u4e00\u4e2a\u57fa\u4e8e [Lucene](https://zh.m.wikipedia.org/zh-hans/Lucene) \u5e93\u7684\u641c\u7d22\u5f15\u64ce\u3002\u5b83\u63d0\u4f9b\u4e86\u5206\u5e03\u5f0f\u3001RESTful \u98ce\u683c\u7684\u641c\u7d22\u548c\u6570\u636e\u5206\u6790\u5f15\u64ce\uff0c\u5177\u6709\u53ef\u6269\u5c55\u6027\u3001\u53ef\u5206\u5e03\u5f0f\u90e8\u7f72\u548c\u53ef\u8fdb\u884c\u76f8\u5173\u5ea6\u641c\u7d22\u7b49\u7279\u70b9\uff0c\u80fd\u591f\u89e3\u51b3\u4e0d\u65ad\u6d8c\u73b0\u51fa\u7684\u5404\u79cd\u7528\u4f8b\u3002\u540c\u65f6\u8fd8\u53ef\u4ee5\u96c6\u4e2d\u5b58\u50a8\u7528\u6237\u6570\u636e\uff0c\u5e2e\u52a9\u7528\u6237\u53d1\u73b0\u610f\u6599\u4e4b\u4e2d\u4ee5\u53ca\u610f\u6599\u4e4b\u5916\u7684\u60c5\u51b5\u3002\\n\\n## \u63d2\u4ef6\u4ecb\u7ecd\\n\\nAPISIX \u4ee5 **HTTP** \u8bf7\u6c42\u7684\u65b9\u5f0f\u5411 **Elasticsearch** \u53d1\u9001 APISIX \u7684 **Runtime** \u65e5\u5fd7\u3002\u63d2\u4ef6 `elasticsearch-logger` \u91c7\u7528 [bulk](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html#docs-bulk) \u7684\u683c\u5f0f\u8fdb\u884c\u65e5\u5fd7\u4e0a\u62a5\uff0c\u8fd9\u5141\u8bb8 APISIX \u53ef\u4ee5\u5c06\u591a\u6761\u65e5\u5fd7\u5408\u5e76\u540e\u518d\u8fdb\u884c\u4e0a\u62a5\uff0c\u8fd9\u4f7f\u5f97 APISIX \u5728\u5bf9 **Elasticsearch** \u8fdb\u884c\u65e5\u5fd7\u4e0a\u62a5\u65b9\u9762\u66f4\u52a0\u7075\u6d3b\u5e76\u4e14\u5177\u6709\u8f83\u597d\u7684\u6027\u80fd\u3002\u4f60\u53ef\u4ee5\u53c2\u8003\u6587\u6863 [APISIX \u6279\u5904\u7406\u5668](https://apisix.apache.org/zh/docs/apisix/batch-processor/) \u5bf9\u65e5\u5fd7\u5408\u8fdb\u884c\u66f4\u52a0\u7ec6\u81f4\u7684\u914d\u7f6e\u3002\\n\\n## \u914d\u7f6e\u6b65\u9aa4\\n\\n\u9996\u5148\uff0c\u4f60\u9700\u8981\u5b89\u88c5\u5b8c\u6210 APISIX\uff0c\u672c\u6587\u6240\u6709\u6b65\u9aa4\u57fa\u4e8e **Centos 7.5** \u7cfb\u7edf\u8fdb\u884c\u3002\u8be6\u7ec6\u7684\u5b89\u88c5\u6b65\u9aa4\u53c2\u8003 [APISIX \u5b89\u88c5\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/installation-guide/)\u3002\\n\\n### \u6b65\u9aa41\uff1a\u542f\u52a8 Elasticsearch\\n\\n\u672c\u793a\u4f8b\u53ea\u6f14\u793a\u4e86\u901a\u8fc7 `docker-compose` \u542f\u52a8 **Elasticsearch** \u5355\u8282\u70b9\u7684\u65b9\u5f0f\uff0c\u5176\u5b83\u542f\u52a8\u65b9\u5f0f\u53ef\u53c2\u8003 [Elasticsearch \u5b98\u65b9\u6587\u6863](https://www.elastic.co/cn/downloads/elasticsearch)\u3002\\n\\n```dockerfile\\n# \u4f7f\u7528 docker-compose \u542f\u52a8 1 \u4e2a Elasticsearch \u8282\u70b9, 1 \u4e2a kibana\\nversion: \'3.8\'\\nservices:\\n  elasticsearch:\\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.1\\n    container_name: elasticsearch\\n    environment:\\n      ES_JAVA_OPTS: -Xms512m -Xmx512m\\n      discovery.type: single-node\\n      xpack.security.enabled: \'false\'\\n    networks:\\n      - es-net\\n    ports:\\n      - \\"9200:9200\\"\\n      - \\"9300:9300\\"\\n\\n  kibana:\\n    image: docker.elastic.co/kibana/kibana:7.17.1\\n    container_name: kibana\\n    environment:\\n      ELASTICSEARCH_HOSTS: http://elasticsearch:9200\\n      I18N_LOCALE: zh-CN\\n    networks:\\n      - es-net\\n    depends_on:\\n      - elasticsearch\\n    ports:\\n      - \\"5601:5601\\"\\n\\nnetworks:\\n  es-net:\\n    driver: bridge\\n```\\n\\n### \u6b65\u9aa42\uff1a\u521b\u5efa\u8def\u7531\u5e76\u914d\u7f6e\u63d2\u4ef6\\n\\nAPISIX \u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u4e2d\u5df2\u542f\u7528 `elasticsearch-logger` \u63d2\u4ef6\uff0c\u6240\u4ee5\u4f60\u53ea\u9700\u8981\u901a\u8fc7\u4e0b\u65b9\u547d\u4ee4\u521b\u5efa\u8def\u7531\u5e76\u914d\u7f6e `elasticsearch-logger` \u63d2\u4ef6\u5c31\u53ef\u4ee5\u5728 APISIX \u4e2d\u6b63\u5e38\u4f7f\u7528\u4e86\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\":{\\n        \\"elasticsearch-logger\\":{\\n            \\"endpoint_addr\\":\\"http://127.0.0.1:9200\\",\\n            \\"field\\":{\\n                \\"index\\":\\"services\\",\\n                \\"type\\":\\"collector\\"\\n            },\\n            \\"ssl_verify\\":false,\\n            \\"retry_delay\\":1,\\n            \\"buffer_duration\\":60,\\n            \\"max_retry_count\\":0,\\n            \\"batch_max_size\\":1000,\\n            \\"inactive_timeout\\":5,\\n            \\"name\\":\\"elasticsearch-logger\\"\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    },\\n    \\"uri\\":\\"/elasticsearch.do\\"\\n}\'\\n```\\n\\n\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u914d\u7f6e\u4e86 **Elasticsearch** \u5730\u5740\u3001\u76ee\u6807 `field`\uff0c\u7528\u6237\u540d\u4e0e\u5bc6\u7801\u3002\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u8bbe\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5c06 `/elasticsearch.do` \u8def\u5f84\u7684 **API** \u8bf7\u6c42\u65e5\u5fd7\u53d1\u9001\u81f3 **Elasticsearch** \u7684\u529f\u80fd\u3002\\n\\n### \u6b65\u9aa43\uff1a\u53d1\u9001\u8bf7\u6c42\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u901a\u8fc7 **API** \u53d1\u9001\u4e00\u4e9b\u8bf7\u6c42\u3002\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/elasticsearch.do\\\\?q\\\\=hello\\nHTTP/1.1 200 OK\\n```\\n\\n```shell {title=\\"output\\"}\\nhello, world\\n```\\n\\n\u6b64\u65f6\u4f60\u53ef\u4ee5\u767b\u5f55 **Kibana** \u63a7\u5236\u53f0\u68c0\u7d22\u67e5\u770b\u76f8\u5173\u65e5\u5fd7\uff1a\\n\\n![Kibana \u67e5\u770b\u65e5\u5fd7](https://static.apiseven.com/2022/09/15/6322920fe2b8d.png)\\n\\n## \u81ea\u5b9a\u4e49\u65e5\u5fd7\u7ed3\u6784\\n\\n\u5f53\u7136\uff0c\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 `elasticsearch-logger` \u63d2\u4ef6\u63d0\u4f9b\u7684\u5143\u6570\u636e\u914d\u7f6e\uff0c\u6765\u8bbe\u7f6e\u53d1\u9001\u81f3 **Elasticsearch** \u7684\u65e5\u5fd7\u6570\u636e\u7ed3\u6784\u3002\u901a\u8fc7\u8bbe\u7f6e `log_format` \u6570\u636e\uff0c\u53ef\u4ee5\u63a7\u5236\u53d1\u9001\u7684\u6570\u636e\u7c7b\u578b\u3002\\n\\n\u6bd4\u5982\u4ee5\u4e0b\u6570\u636e\u4e2d\u7684 `$host`\u3001`$time_iso8601` \u7b49\uff0c\u90fd\u662f\u6765\u81ea\u4e8e **NGINX** \u63d0\u4f9b\u7684\u5185\u7f6e\u53d8\u91cf\uff1b\u4e5f\u652f\u6301\u5982 `$route_id` \u548c `$service_id` \u7b49 **Apache APISIX** \u63d0\u4f9b\u7684\u53d8\u91cf\u914d\u7f6e\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/plugin_metadata/elasticsearch-logger \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"log_format\\": {\\n        \\"host\\": \\"$host\\",\\n        \\"@timestamp\\": \\"$time_iso8601\\",\\n        \\"client_ip\\": \\"$remote_addr\\"\\n    }\\n}\'\\n```\\n\\n\u901a\u8fc7\u53d1\u9001\u8bf7\u6c42\u8fdb\u884c\u7b80\u5355\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u770b\u5230\u4e0a\u8ff0\u65e5\u5fd7\u7ed3\u6784\u8bbe\u7f6e\u5df2\u751f\u6548\u3002\u76ee\u524d **Apache APISIX** \u63d0\u4f9b\u591a\u79cd\u65e5\u5fd7\u683c\u5f0f\u6a21\u677f\uff0c\u5728\u914d\u7f6e\u4e0a\u5177\u6709\u6781\u5927\u7684\u7075\u6d3b\u6027\uff0c\u66f4\u591a\u65e5\u5fd7\u683c\u5f0f\u7ec6\u8282\u53ef\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/plugins/kafka-logger#metadata)\u3002\\n\\n\u6b64\u65f6\u4f60\u53ef\u4ee5\u767b\u5f55 **Kibana** \u63a7\u5236\u53f0\u68c0\u7d22\u67e5\u770b\u76f8\u5173\u81ea\u5b9a\u4e49\u65e5\u5fd7\uff1a\\n\\n![Kibana \u68c0\u7d22\u81ea\u5b9a\u4e49\u65e5\u5fd7](https://static.apiseven.com/2022/09/15/6322920e7cad5.png)\\n\\n\u5982\u9700\u5173\u95ed\u81ea\u5b9a\u4e49\u65e5\u5fd7\u7ed3\u6784\uff0c\u53ef\u53c2\u8003\u4e0b\u65b9\u64cd\u4f5c\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/plugin_metadata/elasticsearch-logger \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X DELETE\\n```\\n\\n\u6b64\u65f6\uff0c\u63d2\u4ef6 `elasticsearch-logger` \u5c06\u4f7f\u7528\u9ed8\u8ba4\u683c\u5f0f\u4e0a\u62a5\u65e5\u5fd7\u3002\\n\\n## \u5173\u95ed\u63d2\u4ef6\\n\\n\u5982\u4f7f\u7528\u5b8c\u6bd5\uff0c\u53ea\u9700\u79fb\u9664\u8def\u7531\u914d\u7f6e\u4e2d `elasticsearch-logger` \u63d2\u4ef6\u76f8\u5173\u7684\u914d\u7f6e\u5e76\u4fdd\u5b58\uff0c\u5373\u53ef\u5173\u95ed\u8def\u7531\u4e0a\u7684\u63d2\u4ef6\u3002\u5f97\u76ca\u4e8e Apache APISIX \u7684\u52a8\u6001\u5316\u4f18\u52bf\uff0c\u5f00\u542f\u548c\u5173\u95ed\u63d2\u4ef6\u7684\u8fc7\u7a0b\u90fd\u4e0d\u9700\u8981\u91cd\u542f Apache APISIX\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {},\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5173\u4e8e **elasticsearch-logger** \u63d2\u4ef6\u7684\u529f\u80fd\u4e0e\u4f7f\u7528\u6b65\u9aa4\uff0c\u66f4\u591a\u5173\u4e8e **elasticsearch-logger** \u63d2\u4ef6\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u5217\u8868\uff0c\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863\u3002\\n\\n\u4e5f\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"Apache APISIX \u8fd0\u884c\u65f6\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u8be6\u89e3","metadata":{"permalink":"/zh/blog/2022/08/19/apache-apisix-runtime-dynamic-debugging","source":"@site/blog/2022/08/19/apache-apisix-runtime-dynamic-debugging.md","title":"Apache APISIX \u8fd0\u884c\u65f6\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u8be6\u89e3","description":"\u672c\u6587\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u4ee5\u53ca\u8be5\u529f\u80fd\u7684\u5b9e\u73b0\u539f\u7406\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u8be5\u529f\u80fd\u66f4\u4fbf\u6377\u5730\u6392\u67e5 Bug \u5e76\u89e3\u51b3\u76f8\u5173\u95ee\u9898\u3002","date":"2022-08-19T00:00:00.000Z","formattedDate":"2022\u5e748\u670819\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":16.615,"truncated":true,"authors":[{"name":"\u5c60\u6b63\u677e","title":"Author","url":"https://github.com/tzssangglass","image_url":"https://github.com/tzssangglass.png","imageURL":"https://github.com/tzssangglass.png"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Elasticsearch \u5b9e\u73b0\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7","permalink":"/zh/blog/2022/09/15/apache-apisix-integrat-with-elasticsearch-for-logger"},"nextItem":{"title":"GCP\u3001AWS\u3001Azure \u548c Oracle ARM \u67b6\u6784\u670d\u52a1\u5668\u6027\u80fd\u6d4b\u8bd5\u5bf9\u6bd4","permalink":"/zh/blog/2022/08/12/arm-performance-google-aws-azure-with-apisix"}},"content":"> \u672c\u6587\u8be6\u7ec6\u4ecb\u7ecd\u4e86 Apache APISIX \u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u4ee5\u53ca\u8be5\u529f\u80fd\u7684\u5b9e\u73b0\u539f\u7406\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u8be5\u529f\u80fd\u66f4\u4fbf\u6377\u5730\u6392\u67e5 Bug \u5e76\u89e3\u51b3\u76f8\u5173\u95ee\u9898\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\uff0c\u5b9e\u65f6\uff0c\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u5b83\u57fa\u4e8e NGINX \u548c Lua \u5b9e\u73b0\uff0c\u56e0\u6b64\u5929\u7136\u7ee7\u627f\u4e86\u4e8c\u8005\u7684\u9ad8\u6027\u80fd\u3002\u52a8\u6001\u610f\u5473\u7740\u5982\u679c\u4f60\u5bf9\u5b83\u505a\u4e86\u4efb\u610f\u914d\u7f6e\u7684\u53d8\u66f4\uff0c\u4e0d\u9700\u8981\u91cd\u542f\u6216\u8005\u70ed\u66f4\u65b0\uff0c\u56e0\u6b64\u4e5f\u4e0d\u4f1a\u4ea7\u751f\u670d\u52a1\u4e2d\u65ad\u6216\u77ed\u6682\u4e0d\u53ef\u7528\u3002\u7531\u4e8e NGINX \u7684\u914d\u7f6e\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u53d8\u66f4\u914d\u7f6e\uff0c\u5c31\u9700\u8981\u91cd\u542f\u670d\u52a1\uff0c\u8be5\u64cd\u4f5c\u4f1a\u6d89\u53ca\u5230\u8fde\u63a5\u65ad\u5f00\uff0c\u5360\u7528\u9ad8\u8fbe\u4e24\u500d\u7684\u8d44\u6e90\u3002\\n\\nAPISIX \u901a\u8fc7\u5176\u52a8\u6001\u7684\u4f18\u52bf\uff0c \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u8fd0\u884c\u65f6\u52a8\u6001\u8c03\u8bd5\u7684\u80fd\u529b\uff0c\u4f46\u7531\u4e8e\u8be5\u529f\u80fd\u5bf9\u4f7f\u7528\u8005\u6709\u7740\u7565\u9ad8\u7684\u6280\u672f\u80cc\u666f\u8981\u6c42\uff0c\u5728\u5e38\u89c4\u4e1a\u52a1\u9700\u6c42\u4e2d\u4e5f\u4e0d\u592a\u4f1a\u7528\u5230\u8fd9\u9879\u529f\u80fd\uff0c\u56e0\u6b64\u5927\u5bb6\u5bf9 APISIX \u8fd0\u884c\u65f6\u52a8\u6001\u8c03\u8bd5\u80fd\u529b\u4e86\u89e3\u4e0d\u8db3\u3002\u672c\u6587\u5c06\u901a\u8fc7\u5b9e\u9645\u6848\u4f8b\u4e3a\u4f60\u8be6\u7ec6\u8bb2\u89e3 Apache APISIX \u8fd0\u884c\u65f6\u52a8\u6001\u8c03\u8bd5\u7684\u529f\u80fd\u3002\\n\\n## \u6545\u969c\u53d1\u751f\\n\\n\u67d0\u5e74\u67d0\u6708\u67d0\u65e5\uff0c\u4e00\u4e2a\u7528\u6237\u7684\u751f\u4ea7\u73af\u5883\u51fa\u73b0\u5f02\u5e38\uff0c\u4e0e\u7528\u6237\u4ea4\u6d41\u8fc7\u540e\u5e76\u6ca1\u6709\u53d1\u73b0\u7528\u6237\u64cd\u4f5c\u6709\u4ec0\u4e48\u5f02\u5e38\u4e4b\u5904\uff0c\u4e00\u5207\u90fd\u5f88\u5408\u7406\u3002\u800c\u4e14\u6839\u636e\u7528\u6237\u7684\u63cf\u8ff0\uff0c\u8be5 Bug \u4f1a\u5728 APISIX \u91cd\u542f\u540e\u6d88\u5931\uff0c\u7136\u540e\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\u5c31\u4f1a\u968f\u673a\u51fa\u73b0\u3002\u6ca1\u6709\u4eba\u77e5\u9053\u8fd9\u4e2a Bug \u53d1\u751f\u7684\u539f\u56e0\uff0c\u4e5f\u4e0d\u77e5\u9053\u5982\u4f55\u590d\u73b0\u8be5 Bug\u3002\u5728\u68c0\u67e5\u5b8c\u7528\u6237\u7684\u914d\u7f6e\u4e4b\u540e\uff0c\u6211\u4eec\u4e5f\u6ca1\u6709\u53d1\u73b0\u5f02\u5e38\u7684\u5730\u65b9\u3002\\n\\n\u800c\u5728\u7528\u6237\u63d0\u4f9b\u7684\u4e0e\u5f02\u5e38\u76f8\u5173\u7684\u65e5\u5fd7\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u5176\u4e2d\u6700\u5173\u952e\u7684\u4e00\u6761\u65e5\u5fd7\u3002\u8fd9\u6761\u65e5\u5fd7\u770b\u8d77\u6765\u7a00\u677e\u5e73\u5e38\uff0c\u53ea\u4e0d\u8fc7\u662f\u8c03\u7528 `eval` \u51fd\u6570\u5931\u8d25\u3002\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/1.PNG)\\n\\n\u4f46\u5728\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u5728\u8fd9\u884c\u65e5\u5fd7\u5bf9\u5e94\u7684\u4ee3\u7801\u6bb5\u4e0d\u5e94\u8be5\u4f1a\u629b\u51fa\u8fd9\u4e2a\u9519\u8bef\u3002\u4e3a\u4ec0\u4e48\u5462\uff1f\u6211\u4eec\u5148\u770b\u4e0b\u5f02\u5e38\u65e5\u5fd7\u5bf9\u5e94\u7684\u4ee3\u7801\u6bb5\uff0c\u4e0b\u56fe\u4e2d\u5012\u6570\u7b2c\u4e8c\u884c\u662f\u629b\u51fa\u5f02\u5e38\u7684\u5730\u65b9\uff1a\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/2.png)\\n\\n\u8fd9\u6bb5\u4ee3\u7801\u7684\u903b\u8f91\u662f\uff1a\u9996\u5148\u5bf9 `conf.response_expr` \u5bf9\u8c61\u505a\u4e86\u975e\u7a7a\u5224\u65ad\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u521b\u5efa\u8be5\u5bf9\u8c61\u3002\u5bf9\u8c61\u521b\u5efa\u5b8c\u6210\uff0c\u624d\u4f1a\u8c03\u7528\u5b83\u7684 `eval` \u51fd\u6570\uff0c\u800c\u5728\u8be5\u5bf9\u8c61\u5bf9\u5e94\u7684\u6a21\u5757\u4e2d\uff0c\u5df2\u7ecf\u5b9e\u73b0\u4e86 `eval` \u51fd\u6570\u3002\u6240\u4ee5\u6211\u4eec\u8ba4\u4e3a\u8fd9\u4e2a\u9519\u8bef\u662f\u4e0d\u5e94\u8be5\u51fa\u73b0\u7684\u3002\u90a3\u4e48\u4e3a\u4ec0\u4e48\u521b\u5efa\u4e86\u8fd9\u4e2a\u5bf9\u8c61\u4f46\u662f\u8c03\u7528\u5b83\u7684\u51fd\u6570\u5931\u8d25\u5462\uff1f\\n\\n## \u52a8\u6001\u8c03\u8bd5\u8be6\u89e3\\n\\n\u4ece\u524d\u6587\u63cf\u8ff0\u7684\u5df2\u77e5\u4fe1\u606f\u6765\u770b\uff0c\u6211\u4eec\u5df2\u7ecf\u65e0\u6cd5\u5224\u65ad Bug \u4ea7\u751f\u7684\u539f\u56e0\u4e86\uff0c\u56e0\u6b64\u6211\u4eec\u91c7\u7528\u52a8\u6001\u8c03\u8bd5\u7684\u65b9\u5f0f\u6765\u5bfb\u627e Bug \u7684\u6839\u672c\u539f\u56e0\u3002\\n\\n### \u52a8\u6001\u8c03\u8bd5\u7279\u6027\\n\\n\u5728\u6b63\u5f0f\u5f00\u542f\u5bfb Bug \u4e4b\u8def\u524d\uff0c\u5148\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e0b\u4ec0\u4e48\u662f\u52a8\u6001\u8c03\u8bd5\u4ee5\u53ca\u5b83\u7684\u7279\u6027\u3002\\n\\n\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u4e3b\u8981\u7528\u4e8e\u5728 APISIX \u8fd0\u884c\u8fc7\u7a0b\u4e2d\u901a\u8fc7\u54cd\u5e94\u3001\u65e5\u5fd7\u7b49\u65b9\u5f0f\uff0c\u8f93\u51fa\u66f4\u591a\u7684\u8c03\u8bd5\u4fe1\u606f\uff0c\u7528\u6765\u5e2e\u52a9\u6392\u67e5\u5f02\u5e38\uff0c\u6bd4\u5982\u7f29\u5c0f\u6392\u67e5\u8303\u56f4\u3001\u7aa5\u63a2\u5f02\u5e38\u4e0a\u4e0b\u6587\u7b49\u3002\u5176\u7279\u6027\u6709\u4ee5\u4e0b\u4e09\u70b9\uff1a\\n\\n- \u5b9e\u65f6\u5173\u95ed&\u5f00\u542f\\n\\n    \u52a8\u6001\u8c03\u8bd5\u53ef\u4ee5\u5728 APISIX \u8fd0\u884c\u65f6\u901a\u8fc7\u4fee\u6539\u6307\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\u5f00\u542f\u6216\u5173\u95ed\uff0c\u4e0d\u9700\u8981\u91cd\u542f APISIX \u6216\u8005\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002\\n\\n- \u6253\u5370\u4efb\u4f55\u6a21\u5757\u7ea7\u51fd\u6570\\n\\n    \u8be5\u529f\u80fd\u53ef\u4ee5\u8c03\u8bd5\u548c\u6253\u5370\u4efb\u4f55\u6a21\u5757\u7ea7\u522b\u51fd\u6570\u7684\u5165\u53c2\u548c\u51fa\u53c2\uff0c\u4e0d\u7ba1\u8fd9\u4e2a\u51fd\u6570\u662f\u4f4d\u4e8e APISIX \u7684\u4ee3\u7801\u4e2d\uff0c\u8fd8\u662f APISIX \u4f9d\u8d56\u7684\u8bf8\u591a `lua-resty` \u7b2c\u4e09\u65b9\u5e93\u4e2d\uff0c\u6216\u8005\u662f OpenResty \u7684 `lualib` \u4e2d\u7684\u6a21\u5757\u3002\u53ea\u8981\u80fd\u901a\u8fc7 `require` \u5f15\u7528\u8be5\u51fd\u6570\uff0c\u5c31\u53ef\u4ee5 `hook` \u8be5\u51fd\u6570\u3002\\n\\n- \u9488\u5bf9\u6307\u5b9a\u8bf7\u6c42\u5f00\u542f\\n\\n    \u9664\u4e86\u4ee5\u4e0a\u4e24\u70b9\uff0c\u8be5\u529f\u80fd\u4e5f\u652f\u6301\u9488\u5bf9\u6307\u5b9a\u8bf7\u6c42\u5f00\u542f\u3002\u901a\u8fc7\u8bbe\u7f6e\u7279\u6b8a\u7684\u8bf7\u6c42\u5934\uff0c\u5bf9\u8c03\u8bd5\u8bf7\u6c42\u8fdb\u884c\u67d3\u8272\uff0c\u4fbf\u4e8e\u8ffd\u8e2a\u548c\u5206\u6790\u3002\u8be5\u7279\u6027\u53ef\u4ee5\u901a\u8fc7 `curl xxx -H \u201cX-APISIX-Dynamic-Debug\u201d` \u547d\u4ee4\u5f00\u542f\uff0c\u8be5\u547d\u4ee4\u8868\u793a\u53ea\u6709\u8bf7\u6c42\u4e2d\u643a\u5e26 `X-APISIX-Dynamic-Debug` \u8bf7\u6c42\u5934\u65f6\uff0c\u624d\u4f1a\u5728\u65e5\u5fd7\u4e2d\u8f93\u51fa\u6307\u5b9a\u51fd\u6570\u7684\u5165\u53c2\u548c\u51fa\u53c2\u3002\u8be5\u529f\u80fd\u672c\u8d28\u4e0a\u662f\u8bf7\u6c42\u8fc7\u6ee4\uff0c\u9632\u6b62\u8f93\u51fa\u592a\u591a\u65e0\u610f\u4e49\u7684\u65e5\u5fd7\uff0c\u4e5f\u53ef\u4ee5\u501f\u6b64\u533a\u5206\u771f\u5b9e\u8bf7\u6c42\u548c\u8c03\u8bd5\u8bf7\u6c42\u3002\\n\\n### \u914d\u7f6e\u52a8\u6001\u8c03\u8bd5\\n\\n\u5f53\u4f60\u9700\u8981\u4f7f\u7528\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 `./conf/debug.yaml` \u914d\u7f6e\u6587\u4ef6\uff0c\u5f00\u542f APISIX \u7684\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u3002\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/3.png)\\n\\n\u5173\u4e8e\u4e0a\u56fe\u914d\u7f6e\u7684\u5177\u4f53\u542b\u4e49\uff0c\u8bf7\u53c2\u8003 [Debug Mode](https://apisix.apache.org/zh/docs/apisix/architecture-design/debug-mode/)\u3002\\n\\n\u4e0b\u56fe\u662f\u5f00\u542f\u52a8\u6001\u8c03\u8bd5\u540e\u5bf9\u5e94\u7684\u65e5\u5fd7\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u8be5\u65e5\u5fd7\u5305\u542b\u4e86\u6307\u5b9a\u51fd\u6570\u7684\u5165\u53c2\u548c\u51fa\u53c2\u3002\u5f53\u8c03\u7528 dns \u89e3\u6790\u7684\u51fd\u6570\u65f6\uff0c\u67e5\u8be2\u7684\u57df\u540d\u4e3a `httpbin.org`\uff0c\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u8be5\u57df\u540d\u89e3\u6790\u51fa\u7684 IP\uff0c\u5e76\u4e14\u8be5\u89e3\u6790\u7ed3\u679c\u662f\u4ece\u672c\u5730\u7f13\u5b58\u7684 DNS \u67e5\u8be2\u7ed3\u679c\u4e2d\u547d\u4e2d\u7684\uff0c\u751a\u81f3\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u57df\u540d\u5728\u672c\u5730\u7684 DNS \u7f13\u5b58\u4e2d\u7684\u5b58\u6d3b\u65f6\u95f4\u7b49\u8be6\u7ec6\u4fe1\u606f\u3002\u4f46\u662f\u5728\u6ca1\u6709\u542f\u7528\u52a8\u6001\u8c03\u8bd5\u7684\u65f6\u5019\uff0c\u65e5\u5fd7\u5c31\u6ca1\u6709\u90a3\u4e48\u8be6\u7ec6\u4e86\u3002\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/4.png)\\n\\n\u4e86\u89e3\u5b8c\u76f8\u5173\u6982\u5ff5\u548c\u4f7f\u7528\u65b9\u6cd5\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u8fdb\u884c Bug \u7684\u6392\u67e5\u4e86\u3002\\n\\n## \u95ee\u9898\u6392\u67e5\\n\\n\u9996\u5148\u91c7\u7528\u52a8\u6001\u8c03\u8bd5\u7684\u65b9\u5f0f `hook` \u4e86\u51fa\u73b0\u5f02\u5e38\u7684\u8fd9\u6bb5\u4ee3\u7801\u6240\u5728\u7684\u51fd\u6570\uff0c\u4e0b\u56fe\u662f\u9488\u5bf9\u8be5 Bug \u6240\u505a\u7684\u914d\u7f6e\uff1a\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/5.png)\\n\\n### \u9a8c\u8bc1\u95ee\u9898\\n\\n\u5f00\u542f\u52a8\u6001\u8c03\u8bd5\u540e\uff0c\u6211\u4eec\u5728\u65e5\u5fd7\u4e2d\u53d1\u73b0\u4e86\u7aef\u502a\u3002\u5728\u51fd\u6570\u7684\u5165\u53c2\u4e2d\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c`conf.response_expr` \u5bf9\u8c61\u662f\u5b58\u5728 `eval` \u51fd\u6570\u7684\uff0c\u5e76\u4e14\u8fd9\u4e2a\u51fd\u6570\u4f4d\u4e8e `metatable` \u4e2d\uff0c\u8fd9\u7b26\u5408\u6b63\u5e38\u8ba4\u77e5\u3002\u5f53\u5728 `conf.response_expr` \u5bf9\u8c61\u4e2d\u627e\u4e0d\u5230\u65f6\uff0c\u4f1a\u5728 `metatable` \u4e2d\u5bfb\u627e `eval` \u51fd\u6570\u5e76\u4e14\u6267\u884c\u6210\u529f\u3002\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/6.png)\\n\\n\u4f46\u662f\u5728\u5f02\u5e38\u6848\u4f8b\u4e2d\uff0c`conf.response_expr` \u5bf9\u8c61\u7684 `metatable` \u5bf9\u8c61\u4e22\u5931\u4e86\uff0c\u8fd9\u662f\u5bfc\u81f4\u65e0\u6cd5\u8c03\u7528 `eval` \u51fd\u6570\u7684\u76f4\u63a5\u539f\u56e0\uff0c\u4e0e\u5f02\u5e38\u65e5\u5fd7\u76f8\u4e92\u6620\u8bc1\u3002\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/7.png)\\n\\n\u4e3a\u4ec0\u4e48 `conf.response_expr` \u5bf9\u8c61\u7684 `metatable` \u5bf9\u8c61\u4e22\u5931\u4e86\uff1f\\n\\n### \u5927\u80c6\u63a8\u6d4b\\n\\n\u57fa\u4e8e\u4e00\u4e2a\u6734\u7d20\u7684\u8ba4\u77e5\uff0c\u8ba1\u7b97\u673a\u662f\u4e0d\u4f1a\u9a97\u4eba\u7684\uff0c`conf.response_expr` \u5bf9\u8c61\u7684 `metatable` \u5bf9\u8c61\u4e22\u5931\u4e00\u5b9a\u4f1a\u5b58\u5728\u975e\u5e38\u5408\u7406\u7684\u89e3\u91ca\u3002\u6211\u4eec\u67e5\u770b\u4e86\u76f8\u5173\u4ee3\u7801\uff0c\u5e76\u57fa\u4e8e\u5df2\u7684\u4fe1\u606f\u68b3\u7406\u4e86\u4ee3\u7801\u6267\u884c\u8def\u5f84\uff0c\u505a\u4e86\u4ee5\u4e0b\u4e24\u70b9\u63a8\u6d4b\uff1a\\n\\n1. `conf.response_expr` \u5bf9\u8c61\u53ef\u80fd\u5728\u5176\u4ed6\u5730\u65b9\u88ab\u4fee\u6539\u4e86\uff0c\u5bfc\u81f4\u4e22\u5931 `metatable`\uff1b\\n2. `conf.response_expr` \u5bf9\u8c61\u88ab\u66ff\u6362\u4e86\uff0c\u5e76\u5728\u66ff\u6362\u65f6\u4e22\u5931\u4e86 `metatable`\u3002\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/8.png)\\n\\n\u57fa\u4e8e\u7b2c\u4e00\u4e2a\u63a8\u6d4b\uff0c\u5206\u6790\u5b8c\u51fd\u6570\u6267\u884c\u8def\u5f84\u540e\uff0c\u786e\u5b9a\u6ca1\u6709\u4efb\u4f55\u5730\u65b9\u4f1a\u4fee\u6539 `conf.response_expr` \u5bf9\u8c61\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u5bf9\u8c61\u7684\u4f7f\u7528\u8303\u56f4\u5f88\u5c0f\uff0c\u4e5f\u4e0d\u4f1a\u6cc4\u6f0f\u5230\u5916\u9762\u3002\\n\\n\u6240\u4ee5\u6211\u4eec\u4e13\u6ce8\u4e8e\u5206\u6790\u7b2c\u4e8c\u70b9\uff0c`conf.response_expr` \u662f\u5b58\u5728\u88ab\u66ff\u6362\u53ef\u80fd\u6027\u7684\u3002\u6bd4\u5982\u63d2\u4ef6\u914d\u7f6e\u5408\u5e76\uff0c\u8be5\u64cd\u4f5c\u6d89\u53ca\u5230 Consumer\u3001Service\u3001Route \u7b49\u5bf9\u8c61\u4e0a\u7684\u63d2\u4ef6\u914d\u7f6e\u7684\u5408\u5e76\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u4f7f\u7528\u6838\u5fc3\u5e93\u4e2d\u7684\u7528\u6237 `table` \u64cd\u4f5c\u7684\u6a21\u5757\u4e2d\u7684 `deepcopy` \u51fd\u6570\u6765\u590d\u5236\u51fa\u65b0\u914d\u7f6e\u3002\\n\\n\u56e0\u6b64\u6211\u4eec\u53c8\u68c0\u67e5\u4e86 `deepcopy` \u51fd\u6570\uff0c\u53d1\u73b0\u786e\u5b9e\u6ca1\u6709\u5bf9 `metatable` \u8fdb\u884c\u4efb\u4f55\u64cd\u4f5c\u3002\\n\\n### \u5c0f\u5fc3\u6c42\u8bc1\\n\\n\u57fa\u4e8e\u4ee5\u4e0a\u4fe1\u606f\uff0c\u6211\u4eec\u53c8\u5bf9 `deepcopy` \u51fd\u6570\u8fdb\u884c\u4e86\u52a8\u6001\u8c03\u8bd5\uff0c\u4fee\u6539\u540e\u7684\u914d\u7f6e\u5982\u4e0b\uff1a\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/9.png)\\n\\n\u7ecf\u8fc7\u65e5\u5fd7\u5206\u6790\u548c\u63d0\u53d6\uff0c\u679c\u7136\u627e\u5230\u4e86\u5f02\u5e38\u7684 `case`\uff1a\\n\\n- \u5165\u53c2\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/10.png)\\n\\n- \u51fa\u53c2\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/11.png)\\n\\n\u5728 `deepcopy` \u7684\u5165\u53c2\u4e2d\uff0c\u662f\u5b58\u5728 `metatable` \u7684\uff0c\u4f46\u5728\u51fa\u53c2\u4e2d\uff0c`metatable` \u4e22\u5931\u4e86\u3002\u8fd9\u53ef\u4ee5\u9a8c\u8bc1\u5173\u4e8e `metatable` \u4e22\u5931\u7684\u63a8\u6d4b\uff0c\u5e76\u8bf4\u660e `metatable` \u4e22\u5931\u53d1\u751f\u5728\u63d2\u4ef6\u914d\u7f6e\u5408\u5e76\u4e2d\u3002\\n\\n\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\u51fa\u73b0\u8be5\u5f02\u5e38\u7684\u8fc7\u7a0b\u3002\u6bd4\u5982\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a Consumer \u5e76\u4e14\u914d\u7f6e\u4e86 `key-auth` \u63d2\u4ef6\uff0c\u53e6\u5916\u521b\u5efa\u4e86\u4e00\u6761 URI \u4e3a `/hello` \u7684\u8def\u7531\uff0c\u5e76\u5728\u8be5\u8def\u7531\u4e0a\u914d\u7f6e\u4e86 `kafka-logger` \u63d2\u4ef6\u3002\\n\\n\u7b2c\u4e00\u6b21\u53d1\u9001\u4e86\u6ca1\u6709 Consumer header \u7684\u8bf7\u6c42\uff0c\u8be5\u8bf7\u6c42\u547d\u4e2d `/hello` \u8def\u7531\u540e\uff0c\u4f1a\u88ab `key-auth` \u63d2\u4ef6\u62e6\u622a\uff0c\u4f46\u662f\u8be5\u8bf7\u6c42\u5e76\u6ca1\u6709\u5b8c\u5168\u9000\u51fa\uff0c\u4ecd\u7136\u6267\u884c\u4e86 `kafka-logger` \u63d2\u4ef6\u7684 body_filter \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u6700\u5f00\u59cb\u5f02\u5e38\u65e5\u5fd7\u5bf9\u5e94\u7684\u51fd\u6570\u3002\u8fd9\u5c31\u5bfc\u81f4\u7b2c\u4e00\u6b21\u8bf7\u6c42\u751f\u6210 `response_expr` \u5e76\u5b58\u50a8\u5728 `conf` \u4e2d\u3002\u6b64\u65f6\u7684 `conf.response_expr` \u5bf9\u8c61\u5c31\u4e0d\u662f\u7a7a\u503c\u4e86\uff0c\u5e76\u4e14 `conf.response` \u5bf9\u8c61\u8fd8\u662f\u6709 `metatable` \u7684\u3002\\n\\n\u5f53\u7b2c\u4e8c\u6b21\u53d1\u9001\u4e86\u643a\u5e26 Consumer header \u7684\u8bf7\u6c42\uff0c\u7ee7\u7eed\u547d\u4e2d `/hello` \u8def\u7531\uff0c\u4f46\u662f\u7531\u4e8e\u7b2c\u4e8c\u6b21\u7684\u8bf7\u6c42\u662f\u5408\u6cd5\u7684\uff0c\u6240\u4ee5\u5c06 Consumer \u548c Route \u4e0a\u7684\u63d2\u4ef6\u5408\u5e76\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d `conf.response_expr` \u5bf9\u8c61\u7684 `metatable` \u5bf9\u8c61\u4e22\u5931\u4e86\u3002\u90a3\u4e48\u6267\u884c\u5230 `kafka-logger` \u7684\u63d2\u4ef6\u7684\u4ee3\u7801\u4e2d\uff0c\u5c31\u4f1a\u51fa\u73b0\u5f02\u5e38\u65e5\u5fd7\u6240\u663e\u793a\u7684 Bug\u3002\\n\\n\u7ecf\u8fc7\u5927\u80c6\u63a8\u6d4b\u548c\u5c0f\u5fc3\u6c42\u8bc1\uff0c\u501f\u52a9\u52a8\u6001\u8c03\u8bd5\u6280\u672f\uff0c\u5728\u975e\u5e38\u56f0\u96be\u7684\u8fd0\u884c\u73af\u5883\u4e2d\u6211\u4eec\u5b8c\u6210\u4e86 Bug \u5b9a\u4f4d\u3002\\n\\n:::note \u6ce8\u610f\\n\\n\u76ee\u524d\u8be5\u95ee\u9898\u5df2\u88ab\u4fee\u590d\u3002\\n\\n:::\\n\\n\u76f8\u4fe1\u8bfb\u5230\u8fd9\u91cc\uff0c\u4f60\u5df2\u7ecf\u521d\u6b65\u4e86\u89e3 APISIX \u8fd0\u884c\u65f6\u52a8\u6001\u8c03\u8bd5\u5f3a\u5927\u7684\u80fd\u529b\u4e86\uff0c\u90a3\u4e48 APISIX \u662f\u5982\u4f55\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u5462\uff1f\\n\\n## \u529f\u80fd\u5b9e\u73b0\\n\\n\u4e0b\u56fe\u662f APISIX \u8fdb\u884c\u52a8\u6001\u8c03\u8bd5\u65f6\u7684\u6d41\u7a0b\u56fe\u3002\u9996\u5148\uff0cAPISIX \u4f1a\u89e3\u6790 `./conf/debug.yaml` \u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u627e\u5230\u9700\u8981\u52a8\u6001\u8c03\u8bd5\u7684\u6a21\u5757\uff0c\u7136\u540e\u66ff\u6362\u8fd9\u4e9b\u6a21\u5757\u4e2d\u7684\u51fd\u6570\uff0c\u90a3\u4e48 APISIX \u662f\u5982\u4f55\u66ff\u6362\u51fd\u6570\u7684\u5462\uff1f\u8bf7\u770b\u4e0b\u56fe\uff1a\\n\\n![network error/log error.png](https://static.apiseven.com/2022/blog/0820/12.png)\\n\\n\u5728\u9759\u6001\u8bed\u8a00\u4e2d\uff0c\u5982\u679c\u8981\u4fee\u6539\u4ee3\u7801\uff0c\u5c31\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u4ee3\u7801\uff0c\u4f46\u662f\u5728\u52a8\u6001\u8bed\u8a00 Lua \u4e2d\uff0c\u8fd0\u884c\u65f6\u66ff\u6362\u51fd\u6570\u662f\u975e\u5e38\u7b80\u5355\u7684\u3002\\n\\n\u5728 OpenResty \u4e16\u754c\u4e2d\uff0c\u6bcf\u4e2a\u6a21\u5757\u5b9e\u9645\u4e0a\u90fd\u662f\u4e00\u4e2a `table`\uff0cLua \u4e2d\u6709\u7279\u6b8a\u7684 `metatable`\uff0c\u4e5f\u5c31\u662f\u5143\u8868\u673a\u5236\uff0c\u4f60\u53ef\u4ee5\u7ed9\u6bcf\u4e2a `table` \u8bbe\u7f6e `metatable`\u3002\u800c `metatable` \u4e2d\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u88ab\u79f0\u4e3a `_call` \u7684\u5143\u51fd\u6570\uff0c\u8be5\u5143\u51fd\u6570\u53ef\u4ee5\u8bbe\u7f6e\u6a21\u5757\u4e2d\u51fd\u6570\u88ab\u8c03\u7528\u524d\u540e\u7684\u884c\u4e3a\u3002\\n\\n\u5f53\u4f60\u9700\u8981\u8c03\u8bd5\u67d0\u4e2a\u6a21\u5757\u65f6\uff0cAPISIX \u5c31\u4f1a\u627e\u5230\u8be5\u6a21\u5757\uff0c\u5e76\u4e14\u7ed9\u8be5\u6a21\u5757\u8bbe\u7f6e\u4e00\u4e2a `metatable`\uff0c\u5b9a\u4e49 `_call` \u5143\u51fd\u6570\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0cAPISIX \u5c31\u53ef\u4ee5\u63a7\u5236\u9700\u8981\u88ab\u52a8\u6001\u8c03\u8bd5\u7684\u51fd\u6570\uff0c\u83b7\u53d6\u8fd9\u4e9b\u51fd\u6570\u7684\u53c2\u6570\uff0c\u5728\u8c03\u8bd5\u6a21\u5757\u4e2d\u8fd0\u884c\u8fd9\u4e9b\u51fd\u6570\uff0c\u7136\u540e\u83b7\u5f97\u5b83\u4eec\u7684\u6267\u884c\u7ed3\u679c\uff0c\u8f93\u51fa\u5728\u65e5\u5fd7\u4e2d\uff0c\u5e76\u4e14\u8fd4\u56de\u51fd\u6570\u8c03\u7528\u7ed3\u679c\u3002\u4ee5\u4e0a\u6b65\u9aa4\u76f8\u5f53\u4e8e\u5229\u7528 `_call` \u5143\u51fd\u6570\u4f5c\u4e3a\u5207\u5165\u70b9\uff0c\u5bf9\u88ab\u8c03\u8bd5\u7684\u51fd\u6570\u8fdb\u884c\u4e86\u5207\u9762\u3002\u66f4\u591a\u7ec6\u8282\uff0c\u8bf7\u53c2\u8003[\u6e90\u7801](https://github.com/apache/apisix/blob/f0f5b48a8fbe78051e7ab97b979cc1632b2c9d2a/apisix/debug.lua)\u3002\\n\\n## \u6700\u4f73\u5b9e\u8df5\\n\\n\u901a\u8fc7\u4ee5\u4e0a\u5185\u5bb9\uff0c\u76f8\u4fe1\u4f60\u5bf9\u52a8\u6001\u8c03\u8bd5\u6709\u4e86\u66f4\u6df1\u523b\u7684\u7406\u89e3\u3002\u4ee5\u4e0b\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u8be5\u529f\u80fd\u7684\u8fc7\u7a0b\u4e2d\u603b\u7ed3\u51fa\u6765\u7684\u7ecf\u9a8c\uff0c\u5e0c\u671b\u5e2e\u52a9\u4f60\u5728\u4f7f\u7528\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u65f6\u66f4\u52a0\u5f97\u5fc3\u5e94\u624b\uff1a\\n\\n1. `hook_conf` \u4e00\u6b21\u53ea\u80fd\u914d\u7f6e 1 \u4e2a\u6a21\u5757\uff0c\u53ef\u4ee5\u914d\u7f6e\u8fd9\u4e2a\u6a21\u5757\u4e0b\u7684\u591a\u4e2a\u51fd\u6570\uff1b\\n2. `hook_conf` \u4f7f\u7528\u7684\u662f Lua \u7684 `package` \u641c\u7d22\u89c4\u5219\uff1a\\n    - \u5bf9\u4e8e APISIX \u5185\u7684\u51fd\u6570\u9700\u8981\u52a0\u4e0a `apisix` \u524d\u7f00\uff0c\u6bd4\u5982 `apisix/core/table.lua`\uff0c\u9700\u8981\u914d\u7f6e\u4e3a `apisix.core.table`\u3002\\n    - \u5bf9\u4e8e\u5176\u4ed6\u4f9d\u8d56\u6a21\u5757\u548c OpenResty \u6a21\u5757\uff0c\u6bd4\u5982 OpenResty \u7684 `dns resolver` \u6a21\u5757\uff0c\u914d\u7f6e\u4e3a `resty.dns.resolver`\u3002\\n3. \u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u53ea\u80fd\u6253\u5370\u6a21\u5757\u7ea7\u51fd\u6570\uff08\u4e00\u822c\u662f `function _M.xxx` \u5f62\u5f0f\uff09\uff0c\u79c1\u6709\u51fd\u6570\u4e0d\u80fd\u6253\u5370\uff1b\\n4. `hook_conf`\u53ef\u4ee5\u914d\u7f6e\u591a\u4efd\uff0c\u901a\u8fc7 `hook_conf.name` \u6765\u6307\u5b9a\u5177\u4f53\u7684\u67d0\u4e00\u4efd\u914d\u7f6e\uff1b\\n5. \u79ef\u7d2f\u6210\u719f\u7684 `debug.yaml`\uff0c\u9700\u8981\u65f6\u76f4\u63a5\u66ff\u6362\u3002\\n\\n## \u66f4\u591a\u671f\u5f85\\n\\n\u6700\u540e\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u76ee\u524d\u5bf9 APISIX \u52a8\u6001\u8c03\u8bd5\u80fd\u529b\u7684\u8bbe\u60f3\uff1a\\n\\n1. \u9700\u8981\u80fd\u591f\u52a8\u6001\u83b7\u53d6\u6307\u5b9a\u51fd\u6570\u7684\u53c2\u6570\u8f93\u51fa\uff08\u5141\u8bb8\u81ea\u7531\u6267\u884c\uff0c\u81ea\u5b9a\u4e49\u4ee3\u7801\uff09\\n    - \u83b7\u53d6 CPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u7b49\u73af\u5883\u4fe1\u606f\\n    - \u80fd\u591f\u81ea\u7531\u6253\u5370\u51fd\u6570\u7684\u8f93\u5165\u3001\u8f93\u51fa\u53c2\u6570\\n2. \u5728 `privilege agent` \u4e0a\u6267\u884c\u7279\u5b9a\u547d\u4ee4\uff0c\u5e76\u83b7\u53d6\u8fd4\u56de\u7ed3\u679c\\n3. \u8c03\u8bd5\u5de5\u5177\u5177\u5907\u8fd0\u884c\u65f6\u81ea\u8eab\u52a8\u6001\u66f4\u65b0\u7684\u80fd\u529b\uff08\u62c6\u5206 `debug` \u6a21\u5757\u4e3a\u89e3\u6790\u5668\u548c\u8fd0\u884c\u5668\uff09\\n\\n\u5bf9\u4e8e\u4ee5\u4e0a\u8bbe\u60f3\u53ef\u80fd\u4e0d\u592a\u5bb9\u6613\u7406\u89e3\uff0c\u53ef\u4ee5\u770b\u4e0b\u901a\u8fc7\u4e0a\u8ff0\u63cf\u8ff0\u6a21\u62df\u51fa\u6765\u7684\u914d\u7f6e\u3002\u5b83\u770b\u8d77\u6765\u7a0d\u663e\u590d\u6742\uff0c\u4f46\u662f\u5c55\u73b0\u7684\u6784\u60f3\u6548\u679c\u5374\u662f\u975e\u5e38\u60ca\u8273\u7684\uff1a\\n\\n```lua\\nhook_conf:\\n  enable: false\\n  log_level: warn\\n  is_print_input_args: true\\n  is_print_return_value: trueenable_modules:\\n    - hook_http_access_phase\\n    - hook_plugin_kafka\\n  modules:\\n    hook_http_access_phase:\\n      lua_code_before: |\\n        ... ...\\n        core.log.error(core.json.encode(conf))\\n      apisix:\\n        - http_access_phase\\n    hook_control_api_status:\\n      lua_code_before: |\\n        ... ...\\n        if ngx.var.uri == \\" /status\\" then\\n            -- CPU\\\\disk\\\\memory\\n            ngx.say( \\\\ \\"cpu : \\\\\\", ...)\\n            ngx.exit( 200)\\n        end\\n      apisix.control-api:\\n      - http_access_phase\\n    hook_plugin_kafka:\\n      lua_code_before:|\\n      ... ...\\n      core.log.error(core.json.encode(conf))\\n    apisix.plugins.kafka-logger:\\n      - access\\n      - body_filter\\n#END\\n```\\n\\n\u4ee5\u4e0a\u4ee3\u7801\u91ca\u4e49\u5982\u4e0b\uff1a\\n\\n- `hook_http_access_phase`\u3001 `hook_control_api_status`\u3001`hook_plugin_kafka` \u662f\u4e0d\u540c\u914d\u7f6e\u5757\u7684\u540d\u5b57\uff0c`debug` \u6a21\u5757\u6839\u636e `hook_conf.enable_modules` \u6765\u5bfb\u627e\u4e0b\u65b9\u7684\u5b9a\u4e49\u597d\u7684\u914d\u7f6e\u5757\u3002\\n  \u6bd4\u5982\u4e0a\u9762 `hook_conf.enable_modules` \u5bf9\u5e94\u7684\u662f `hook_plugin_kafka`\uff0c\u90a3\u4e48\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u53ea\u4f1a\u5173\u8054\u4e0b\u65b9 `hook_plugin_kafka` \u914d\u7f6e\u5757\u4e2d\u7684\u5185\u5bb9\u3002\\n  \u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u6211\u4eec\u53ef\u4ee5\u9884\u5148\u5728 debug.yaml \u4e2d\u5199\u597d\u4e00\u7ec4\u5e38\u7528\u7684\u914d\u7f6e\uff0c\u7136\u540e\u6839\u636e\u9700\u8981\u4fee\u6539 hook_conf.enable_modules \u6765\u5207\u6362\u4e0d\u540c\u7684\u914d\u7f6e\u5757\u3002\\n- `lua_code_before`\uff1a\u4e2d\u8868\u793a\u5728\u9700\u8981 `hook` \u7684\u51fd\u6570\u4e4b\u524d\u6267\u884c\u7684\u4ee3\u7801\uff0c\u6bd4\u5982 `hook_plugin_kafka` \u4e2d\u7684\u914d\u7f6e\uff0c\u8868\u793a\u5728\u6267\u884c `kafka-logger` \u63d2\u4ef6\u7684 access \u51fd\u6570\u4e4b\u524d\uff0c\u5148\u6267\u884c`core.log.error(core.json.encode(conf))` \u3002\u5f53\u7136\uff0c\u4e5f\u4f1a\u6709 `lua_code_after`\uff0c\u8868\u793a\u5728\u6267\u884c\u6307\u5b9a `hook` \u7684\u51fd\u6570\u4e4b\u540e\u6267\u884c\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u901a\u8fc7\u5b9e\u9645\u6848\u4f8b\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 Apache APISIX \u4e2d\u4f7f\u7528\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\uff0c\u5f53\u7cfb\u7edf\u4e2d\u51fa\u73b0\u4e0d\u660e Bug \u65f6\uff0c\u5229\u7528\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u53ef\u4ee5\u5e2e\u52a9\u4f60\u5feb\u901f\u5b9a\u4f4d Bug\uff0c\u4ece\u800c\u89e3\u51b3 Bug\u3002\u5982\u679c\u4f60\u5bf9\u52a8\u6001\u8c03\u8bd5\u6709\u66f4\u597d\u7684\u8bbe\u60f3\u548c\u5efa\u8bae\uff0c\u6b22\u8fce\u5230\u793e\u533a\u4e2d\u8fdb\u884c\u8ba8\u8bba\u3002"},{"id":"GCP\u3001AWS\u3001Azure \u548c Oracle ARM \u67b6\u6784\u670d\u52a1\u5668\u6027\u80fd\u6d4b\u8bd5\u5bf9\u6bd4","metadata":{"permalink":"/zh/blog/2022/08/12/arm-performance-google-aws-azure-with-apisix","source":"@site/blog/2022/08/12/arm-performance-google-aws-azure-with-apisix.md","title":"GCP\u3001AWS\u3001Azure \u548c Oracle ARM \u67b6\u6784\u670d\u52a1\u5668\u6027\u80fd\u6d4b\u8bd5\u5bf9\u6bd4","description":"\u672c\u6587\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u6765\u6bd4\u8f83 GCP\u3001AWS \u3001Azure \u548c Oracle ARM \u67b6\u6784\u670d\u52a1\u5668\u5728\u7f51\u7edc IO \u5bc6\u96c6\u578b\u573a\u666f\u4e0b\u7684\u6027\u80fd\u3002","date":"2022-08-12T00:00:00.000Z","formattedDate":"2022\u5e748\u670812\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.76,"truncated":true,"authors":[{"name":"\u8d75\u58eb\u745e","title":"Author","url":"https://github.com/soulbird","image_url":"https://github.com/soulbird.png","imageURL":"https://github.com/soulbird.png"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"},{"name":"\u6797\u4e9a\u4fca","title":"Technical Writer","url":"https://github.com/Yilialinn","image_url":"https://avatars.githubusercontent.com/u/114121331?v=4","imageURL":"https://avatars.githubusercontent.com/u/114121331?v=4"}],"prevItem":{"title":"Apache APISIX \u8fd0\u884c\u65f6\u52a8\u6001\u8c03\u8bd5\u529f\u80fd\u8be6\u89e3","permalink":"/zh/blog/2022/08/19/apache-apisix-runtime-dynamic-debugging"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (7.16 - 7.31)","permalink":"/zh/blog/2022/08/09/weekly-report-0731"}},"content":"> \u672c\u6587\u4f7f\u7528 Apache APISIX \u6765\u6bd4\u8f83 GCP\u3001AWS\u3001Azure \u548c Oracle ARM \u67b6\u6784\u670d\u52a1\u5668\u5728\u7f51\u7edc IO \u5bc6\u96c6\u578b\u573a\u666f\u4e0b\u7684\u6027\u80fd\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\\n\\nARM \u67b6\u6784\u5c5e\u4e8e [RISC\uff08Reduced instruction set computer\uff09\u8bbe\u8ba1\u5bb6\u65cf](https://en.wikipedia.org/wiki/Reduced_instruction_set_computer)\uff0cRISC \u5fae\u5904\u7406\u5668\u67b6\u6784\u8bbe\u8ba1\u901a\u8fc7\u4f7f\u7528\u4e00\u7ec4\u9ad8\u5ea6\u4f18\u5316\u7684\u6307\u4ee4\uff0c\u4f7f\u5c0f\u578b\u5904\u7406\u5668\u80fd\u591f\u6709\u6548\u5730\u5904\u7406\u590d\u6742\u7684\u4efb\u52a1\u3002ARM \u67b6\u6784\u88ab\u5e7f\u6cdb\u5730\u4f7f\u7528\u5728\u8bb8\u591a\u5d4c\u5165\u5f0f\u7cfb\u7edf\u8bbe\u8ba1\u4e2d\uff0c\u5df2\u6210\u4e3a\u5168\u7403\u6700\u5927\u7684\u8ba1\u7b97\u673a\u751f\u6001\u7cfb\u7edf\u548c\u79fb\u52a8\u8bbe\u5907\u7684\u57fa\u77f3\uff0c\u7531\u4e8e\u5b83\u529f\u8017\u4f4e\u3001\u6210\u672c\u4f4e\u3001\u6548\u80fd\u9ad8\u4ee5\u53ca\u8bb8\u53ef\u7075\u6d3b\uff0c\u8bb8\u591a\u4e13\u5bb6\u89c6\u5176\u4e3a\u4e91\u8ba1\u7b97\u7684\u672a\u6765\u3002\u56e0\u6b64\uff0c\u4ee5 AWS\uff08Amazon Web Services\uff09\u3001GCP\uff08Google Cloud Platform\uff09\u3001Azure\uff08Microsoft Azure\uff09\u548c Oracle \u4e3a\u9996\u7684\u4e3b\u6d41\u4e91\u5382\u5546\u90fd\u9646\u7eed\u63a8\u51fa\u4e86 ARM \u67b6\u6784\u7684\u670d\u52a1\u5668\uff0c\u672c\u6587\u5c06\u9009\u53d6\u8fd9\u51e0\u4e2a\u5382\u5546\u7684\u670d\u52a1\u5668\u8fdb\u884c\u6027\u80fd\u6d4b\u8bd5\u3002\u9996\u5148\u8ba9\u6211\u4eec\u4e86\u89e3\u4e0b\u8fd9\u56db\u5927\u5382\u5546\u53ca\u5176\u4ea7\u54c1\u3002\\n\\n## \u4e91\u5382\u5546 ARM \u670d\u52a1\u5668\u4ecb\u7ecd\\n\\n### AWS Graviton\\n\\n\u81ea 2018 \u5e74\u8d77\uff0c\u7ecf\u5386\u56db\u5e74\u7684\u53d1\u5c55\uff0cAWS Graviton \u5df2\u7ecf\u53d1\u5c55\u5230\u7b2c\u4e09\u4ee3\uff0cAWS \u8bbe\u8ba1\u7684 AWS Graviton \u5904\u7406\u5668\u4e3a Amazon EC2 \u4e2d\u8fd0\u884c\u7684\u4e91\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u6700\u4f73\u6027\u4ef7\u6bd4\u3002\u8fd9\u4e09\u4ee3\u5904\u7406\u5668\u7684\u7279\u5f81\u5982\u4e0b\uff1a\\n\\n- **AWS Graviton1** \u5904\u7406\u5668\u91c7\u7528\u5b9a\u5236\u82af\u7247\u548c 64 \u4f4d Neoverse \u5185\u6838\u3002\\n- **AWS Graviton2** \u5904\u7406\u5668\u57fa\u4e8e Graviton2 \u7684\u5b9e\u4f8b\u652f\u6301\u5e7f\u6cdb\u7684\u901a\u7528\u578b\u3001\u7a81\u53d1\u578b\u3001\u8ba1\u7b97\u4f18\u5316\u578b\u3001\u5185\u5b58\u4f18\u5316\u578b\u3001\u5b58\u50a8\u4f18\u5316\u578b\u548c\u52a0\u901f\u8ba1\u7b97\u578b\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5305\u62ec\u5e94\u7528\u7a0b\u5e8f\u670d\u52a1\u5668\u3001\u5fae\u670d\u52a1\u3001\u9ad8\u6027\u80fd\u8ba1\u7b97 (HPC)\u3001\u57fa\u4e8e CPU \u7684\u673a\u5668\u5b66\u4e60 (ML) \u63a8\u7406\u3001\u89c6\u9891\u7f16\u7801\u3001\u7535\u5b50\u8bbe\u8ba1\u81ea\u52a8\u5316\u3001\u6e38\u620f\u3001\u5f00\u6e90\u6570\u636e\u5e93\u548c\u5185\u5b58\u4e2d\u7684\u7f13\u5b58\u3002\u540c\u65f6\u4e3a\u63d0\u4f9b\u4e00\u7ad9\u5f0f\u670d\u52a1\u4f53\u9a8c\uff0c\u8bb8\u591a AWS \u670d\u52a1\u4e5f\u652f\u6301\u57fa\u4e8e Graviton2 \u7684\u5b9e\u4f8b\u3002\\n- **AWS Graviton3** \u5904\u7406\u5668\u4f5c\u4e3a\u8be5\u7cfb\u5217\u7684\u6700\u65b0\u4ea7\u54c1\uff0c\u76f8\u6bd4 AWS Graviton2 \u8ba1\u7b97\u6027\u80fd\u63d0\u9ad825%\uff0c\u6d6e\u70b9\u6027\u80fd\u63d0\u9ad82\u500d\uff0c\u52a0\u5bc6\u5de5\u4f5c\u8d1f\u8f7d\u6027\u80fd\u6700\u591a\u52a0\u5feb 2 \u500d\u3002\u9488\u5bf9\u673a\u5668\u5b66\u4e60 (ML) \u5de5\u4f5c\u8d1f\u8f7d\uff0cAWS Graviton3 \u5904\u7406\u5668\u6240\u63d0\u4f9b\u7684\u6027\u80fd\u6bd4 AWS Graviton2 \u5904\u7406\u5668\u9ad8\u51fa\u591a\u8fbe 3 \u500d\uff0c\u5e76\u652f\u6301 bfloat16\u3002\u5b83\u4eec\u8fd8\u652f\u6301 DDR5 \u5185\u5b58\uff0c\u76f8\u6bd4 DDR4 \u5185\u5b58\u5e26\u5bbd\u589e\u52a0\u4e86 50%\u3002\\n\\n\u4e0b\u56fe\u5c55\u793a\u4e86\u642d\u8f7d AWS Graviton3 \u5904\u7406\u5668\u7684\u4e3b\u8981\u673a\u578b\uff1a\\n\\n![AWS Graviton3 \u5904\u7406\u5668\u4e3b\u8981\u673a\u578b](https://static.apiseven.com/2022/blog/0812/1.png)\\n\\n### Google Cloud Platform T2A\\n\\n2022\u5e747\u6708\uff0c\u8c37\u6b4c\u4e91\u9996\u6b21\u63a8\u51fa ARM \u67b6\u6784\u7684\u865a\u62df\u673a\u9884\u89c8\u7248\uff0c\u5b83\u7531 Ampere\xae Altra\xae \u5904\u7406\u5668\u63d0\u4f9b\u652f\u6301\uff0c\u63d0\u4f9b\u5353\u8d8a\u7684\u5355\u7ebf\u7a0b\u6027\u80fd\u3002T2A VM \u6709\u591a\u79cd\u9884\u5b9a\u4e49\u7684 VM \u4ea7\u54c1\u5f62\u6001\uff0c\u6bcf\u4e2a VM \u6700\u591a\u6709 48 \u4e2a vCPU\uff0c\u6bcf\u4e2a vCPU \u6709 4GB \u5185\u5b58\u3002\u5b83\u4eec\u53ef\u4ee5\u63d0\u4f9b\u9ad8\u8fbe 32 Gbps \u7684\u7f51\u7edc\u5e26\u5bbd\u548c\u5e7f\u6cdb\u7684\u7f51\u7edc\u9644\u52a0\u5b58\u50a8\u9009\u9879\uff0c\u4f7f T2A VM \u975e\u5e38\u9002\u5408\u6a2a\u5411\u6269\u5c55\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5305\u62ec Web \u670d\u52a1\u5668\u3001\u5bb9\u5668\u5316\u5fae\u670d\u52a1\u3001\u6570\u636e\u8bb0\u5f55\u5904\u7406\u3001\u5a92\u4f53\u8f6c\u7801\u548c\u5927\u578b Java \u5e94\u7528\u7a0b\u5e8f\u3002\u53e6\u5916\uff0c\u5b83\u8fd8\u5177\u5907\u4ee5\u4e0b\u4e24\u5927\u7279\u70b9\uff1a\\n\\n- **\u4e0e\u8c37\u6b4c\u4e91\u751f\u6001\u7cfb\u7edf\u96c6\u6210**\uff1aT2A \u865a\u62df\u673a\u652f\u6301\u5927\u591a\u6570\u6d41\u884c\u7684Linux\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f8b\u5982 RHEL\u3001CentOS\u3001Ubuntu \u548c Rocky Linux\uff1b\u8fd8\u652f\u6301 Container-Optimized OS\uff0c\u4ee5\u5feb\u901f\u3001\u9ad8\u6548\u3001\u5b89\u5168\u5730\u542f\u52a8 Docker \u5bb9\u5668\uff1b\u540c\u65f6\uff0c\u5728 Google Cloud \u4e0a\u6784\u5efa\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u5c06\u591a\u4e2a Google Cloud \u670d\u52a1\u4e0e T2A \u865a\u62df\u673a\u4e00\u8d77\u4f7f\u7528\u3002\\n- **ISV \u5408\u4f5c\u4f19\u4f34\u548c\u751f\u6001\u7cfb\u7edf**\uff1aAmpere \u5f53\u524d\u5df2\u7f57\u5217\u4e86 100 \u591a\u4e2a\u5df2\u7ecf\u5728\u57fa\u4e8e Ampere \u7684 T2A \u865a\u62df\u673a\u4e0a\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u3001\u6570\u636e\u5e93\u3001\u4e91\u539f\u751f\u8f6f\u4ef6\u548c\u7f16\u7a0b\u8bed\u8a00\uff0c\u6570\u91cf\u8fd8\u5728\u4e0d\u65ad\u589e\u52a0\u3002\\n\\n\u4e3b\u8981\u673a\u578b\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![Tau T2A VM](https://static.apiseven.com/2022/blog/0812/2.png)\\n\\n### Azure ARM-based Virtual Machines\\n\\n2022 \u5e74 4 \u6708\uff0c\u5fae\u8f6f\u5ba3\u5e03\u63a8\u51fa\u57fa\u4e8e Ampere\xae Altra\xae Arm \u5904\u7406\u5668\u7684 Azure \u865a\u62df\u673a\u7cfb\u5217\u9884\u89c8\u7248\u3002\u65b0\u7684 VM \u65e8\u5728\u9ad8\u6548\u8fd0\u884c\u6a2a\u5411\u6269\u5c55\u5de5\u4f5c\u8d1f\u8f7d\u3001Web \u670d\u52a1\u5668\u3001\u5e94\u7528\u7a0b\u5e8f\u670d\u52a1\u5668\u3001\u5f00\u6e90\u6570\u636e\u5e93\u3001\u4e91\u539f\u751f\u4ee5\u53ca\u4e30\u5bcc\u7684 .NET \u5e94\u7528\u7a0b\u5e8f\u3001Java \u5e94\u7528\u7a0b\u5e8f\u3001\u6e38\u620f\u670d\u52a1\u5668\u548c\u5a92\u4f53\u670d\u52a1\u5668\u7b49\u3002\u65b0\u7684 VM \u7cfb\u5217\u5305\u62ec\u901a\u7528 Dpsv5 \u548c\u5185\u5b58\u4f18\u5316\u7684 Epsv5 VM\uff0c\u4e3b\u8981\u673a\u578b\u5982\u4e0b\u56fe\u6240\u793a:\\n\\n![Dpsv5 \u548c Epsv5 VM](https://static.apiseven.com/2022/blog/0812/3.png)\\n\\n### Oracle Cloud Infrastructure Ampere A1 Compute\\n\\n2021 \u5e74 5 \u6708\u5e95\uff0c\u7532\u9aa8\u6587\u53d1\u5e03\u4e86\u9996\u6b3e\u4ee5 Arm \u4e3a\u57fa\u7840\u7684\u8fd0\u7b97\u4ea7\u54c1\uff1aOCI Ampere A1 Compute\u3002\u8be5\u4ea7\u54c1\u5c06\u53ef\u4ee5\u5728 Oracle \u4e91\u7aef\u57fa\u7840\u8bbe\u65bd (Oracle Cloud Infrastructure\uff0c\u4ee5\u4e0b\u7b80\u79f0 OCI) \u4e0a\u8fd0\u884c\uff0c\u4e3b\u8981\u673a\u578b\u662f\uff1aVM.Standard.A1.Flex\uff08\u4ee5\u4e0b\u7b80\u79f0 OCI A1\uff09\uff0c\u5176CPU \u6838\u5fc3\u548c\u5185\u5b58\u90fd\u53ef\u4ee5\u7075\u6d3b\u914d\u7f6e\u3002\\n\\n\u4e3a\u4e86\u652f\u6301 OCI \u4e2d\u7684\u65b0 Ampere A1 Compute \u5b9e\u4f8b\uff0c Oracle \u521b\u5efa\u4e86\u4e00\u4e2a [Arm \u5f00\u53d1\u4eba\u5458\u751f\u6001\u7cfb\u7edf](https://blogs.oracle.com/cloud-infrastructure/oracle-makes-building-applications-on-ampere-a1-compute-instances-easy)\uff0c\u4f7f\u5f00\u53d1\u4eba\u5458\u80fd\u591f\u5728 OCI Arm \u5b9e\u4f8b\u4e0a\u65e0\u7f1d\u8f6c\u6362\u3001\u6784\u5efa\u548c\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u3002\u6b64\u5916\uff0cOracle \u5df2\u4e0e Ampere Computing\u3001Arm\u3001GitLab\u3001Jenkins \u7b49\u516c\u53f8\u5408\u4f5c\uff0c\u4ee5\u52a0\u901f Arm \u5f00\u53d1\u8005\u751f\u6001\u7cfb\u7edf\u3002Arm \u5904\u7406\u5668\u5df2\u4ece\u79fb\u52a8\u8bbe\u5907\u53d1\u5c55\u4e3a\u4e91\u7aef\u670d\u52a1\u5668\uff0c\u4e3a\u5f00\u53d1\u4eba\u5458\u63d0\u4f9b\u5de5\u5177\u548c\u5e73\u53f0\uff0c\u4ee5\u8fc7\u6e21\u3001\u6784\u5efa\u548c\u8fd0\u884c\u57fa\u4e8e Arm \u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002\\n\\n## \u4e91\u5382\u5546 ARM \u670d\u52a1\u5668\u6027\u80fd\u6d4b\u8bd5\\n\\n\u4e0b\u9762\u6211\u4eec\u5c06\u901a\u8fc7\u6d4b\u8bd5\u5355\u6838\u5fc3\u6027\u80fd\u6765\u53cd\u6620\u5404\u670d\u52a1\u5668\u7684\u6574\u4f53\u6027\u80fd\u3002\u8fd9\u91cc\u9009\u53d6\u7f51\u7edc IO \u5bc6\u96c6\u578b\u7684 API \u7f51\u5173 [Apache APISIX](https://apisix.apache.org/)\uff0c\u5206\u522b\u5728 AWS c7g.large\u3001GCP t2a-standard-2\u3001Azure D2ps v5\uff08\u5c5e\u4e8e Dpsv5 \u7cfb\u5217\uff0c\u53cc\u6838 CPU\uff09\u548c OCI A1 \u56db\u6b3e\u673a\u578b\u4e0a\u7ed1\u5b9a\u5355\u4e2a CPU \u6838\u5fc3\u8fdb\u884c\u538b\u529b\u6d4b\u8bd5\uff0c\u5e76\u901a\u8fc7 QPS \u548c\u54cd\u5e94\u5ef6\u8fdf\u4e24\u4e2a\u6307\u6807\u6765\u5206\u6790\u670d\u52a1\u5668\u7684\u6027\u80fd\u3002\\n\\n[Apache APISIX](https://github.com/apache/apisix) \u662f\u4e00\u4e2a\u4e91\u539f\u751f\u3001\u9ad8\u6027\u80fd\u3001\u53ef\u6269\u5c55\u3001\u5f00\u6e90\u7684 API \u7f51\u5173\u3002\u4e0e\u4f20\u7edf API \u7f51\u5173\u76f8\u6bd4\uff0cApache APISIX \u57fa\u4e8e NGINX \u4e0e LuaJIT \u5f00\u53d1\uff0c\u5177\u6709\u52a8\u6001\u8def\u7531\u548c\u63d2\u4ef6\u70ed\u52a0\u8f7d\u7b49\u7279\u6027\uff0c\u975e\u5e38\u9002\u5408\u4e91\u539f\u751f\u67b6\u6784\u4e0b\u7684 API \u7ba1\u7406\u3002\u67b6\u6784\u56fe\u5982\u4e0b\u6240\u793a\uff1a\\n\\n![Apache APISIX](https://static.apiseven.com/2022/blog/0812/4.png)\\n\\n\u6211\u4eec\u5c06\u4f7f\u7528 Apache APISIX \u5206\u522b\u5728 AWS c7g.large\u3001GCP t2a-standard-2\u3001Azure D2ps v5 \uff08\u867d\u7136\u540d\u79f0\u542bD2ps\uff0c\u4f46\u5b9e\u9645\u662f\u5c5e\u4e8e Dpsv5 \u7cfb\u5217\u7684\u53cc\u6838 CPU\uff09\u548c OCI A1 \u56db\u6b3e\u673a\u578b\u4e0a\u7ed1\u5b9a\u5355\u4e2a CPU \u6838\u5fc3\u8fdb\u884c\u538b\u529b\u6d4b\u8bd5\uff0c\u5e76\u901a\u8fc7 QPS \u548c\u54cd\u5e94\u5ef6\u8fdf\u4e24\u4e2a\u6307\u6807\u6765\u5206\u6790\u670d\u52a1\u5668\u7684\u6027\u80fd\u3002\\n\\n\u6211\u4eec\u5c06\u4f7f\u7528 APISIX \u5b98\u65b9\u5f00\u6e90\u7684[\u6027\u80fd\u6d4b\u8bd5\u811a\u672c](https://github.com/apache/apisix/blob/master/benchmark/run.sh)\u8fdb\u884c\u6d4b\u8bd5\u3002\\n\\n### \u6d4b\u8bd5\u7528\u4f8b\\n\\n\u672c\u6587\u6211\u4eec\u5c06\u6d4b\u8bd5 Apache APISIX \u5728\u4e24\u4e2a\u5178\u578b\u573a\u666f\u4e0b\u7684\u8868\u73b0\uff0c\u4ee5\u4fbf\u83b7\u53d6\u66f4\u52a0\u771f\u5b9e\u3001\u4e30\u5bcc\u7684\u6d4b\u8bd5\u6570\u636e\u8fdb\u884c\u5bf9\u6bd4\u3002\\n\\n- **\u573a\u666f\u4e00\uff1a\u5355\u4e2a\u4e0a\u6e38\u3002** \u8be5\u573a\u666f\u4e0b\u4f7f\u7528\u5355\u4e2a\u4e0a\u6e38\uff08\u4e0d\u5305\u542b\u4efb\u4f55\u63d2\u4ef6\uff09\uff0c\u4e3b\u8981\u6d4b\u8bd5 APISIX \u5728\u7eaf\u4ee3\u7406\u56de\u6e90\u6a21\u5f0f\u4e0b\u7684\u6027\u80fd\u8868\u73b0\u3002\\n- **\u573a\u666f\u4e8c\uff1a\u5355\u4e0a\u6e38+\u591a\u63d2\u4ef6\u3002** \u8be5\u573a\u666f\u4f7f\u7528\u5355\u4e0a\u6e38\u4e0e\u591a\u63d2\u4ef6\u914d\u5408\uff0c\u5728\u8fd9\u91cc\u4f7f\u7528\u4e86\u4e24\u4e2a\u63d2\u4ef6\u3002\u4e3b\u8981\u6d4b\u8bd5 APISIX \u5728\u5f00\u542f `limit-count` \u548c `prometheus` \u4e24\u4e2a\u6838\u5fc3\u6d88\u8017\u6027\u80fd\u63d2\u4ef6\u65f6\u7684\u6027\u80fd\u8868\u73b0\u3002\\n\\n### \u6d4b\u8bd5\u7ed3\u679c\\n\\n\u4e0b\u56fe\u662fAWS c7g.large\u3001GCP t2a-standard-2\u3001Azure D2ps v5 \u548c OCI A1 \u56db\u6b3e\u673a\u578b\u7684 QPS\uff08\u6bcf\u79d2\u67e5\u8be2\u6570\uff09\u6d4b\u8bd5\u7ed3\u679c\uff0cQPS \u6570\u503c\u8d8a\u5927\u4ee3\u8868\u8be5\u670d\u52a1\u5668\u7684\u6027\u80fd\u8d8a\u597d\u3002\\n\\n![QPS \u7ed3\u679c](https://static.apiseven.com/2022/10/14/6348f70deefc4.png)\\n\\n- \u5c06\u6027\u80fd\u4ece\u4f18\u81f3\u52a3\u8fdb\u884c\u6392\u5e8f\uff1a\\n\\n    **\u573a\u666f\u4e00\uff1aAWS c7g.large > Azure D2ps v5 > OCI A1 > GCP t2a-standard-2**\\n\\n    \u5728\u5355\u4e2a\u4e0a\u6e38\u4e0d\u5305\u542b\u4efb\u4f55\u63d2\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0c AWS c7g.large \u7684 QPS \u8fbe\u5230 23000 \u6b21/\u79d2\uff0c\u6027\u80fd\u51e0\u4e4e\u662f\u6700\u843d\u540e\u7684 GCP t2a-standard-2 \uff08QPS \u4e3a 11300 \u6b21/\u79d2\uff09\u7684\u4e24\u500d\uff0cAzure D2ps v5\u3001OCI A1 \u548c GCP t2a-standard-2 \u8fd9\u4e09\u8005\u5dee\u8ddd\u4e0d\u5927\uff0cOCI A1 \u548c GCP t2a-standard-2 \u6027\u80fd\u76f8\u5f53\uff0c\u4ec5\u76f8\u5dee 200 \u6b21/\u79d2\u3002\\n\\n    **\u573a\u666f\u4e8c\uff1aAWS c7g.large > Azure D2ps v5 > GCP t2a-standard-2 > OCI A1**\\n\\n    \u5728\u5355\u4e2a\u4e0a\u6e38\u53ca\u4e24\u4e2a\u63d2\u4ef6\u7684\u573a\u666f\u4e0b\uff0c AWS c7g.large \u7684 QPS \u8fbe 18000 \u6b21/\u79d2\uff0c\u4ecd\u4fdd\u6301\u9886\u5148\uff0c\u4f46\u5dee\u8ddd\u6709\u6240\u7f29\u5c0f\uff0cAzure D2ps v5 \u7684\u6027\u80fd\u7565\u9ad8\u4e8e OCI A1\uff0c\u4ec5\u76f8\u5dee 400 \u6b21/\u79d2\u3002\\n\\n\u4e0b\u56fe\u662f\u54cd\u5e94\u5ef6\u8fdf\u6d4b\u8bd5\u7ed3\u679c\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2\u3002\u6570\u503c\u8d8a\u5c0f\u4ee3\u8868\u5176\u6027\u80fd\u8d8a\u597d\u3002\\n\\n![\u54cd\u5e94\u5ef6\u8fdf\u7ed3\u679c](https://static.apiseven.com/2022/10/14/6348f70d506dd.png)\\n\\n\u4ece\u54cd\u5e94\u5ef6\u8fdf\u6765\u770b\uff0c\u5728\u7c7b\u4f3c Apache APISIX \u8fd9\u79cd\u7f51\u7edc IO \u5bc6\u96c6\u578b\u7684 API \u7f51\u5173\u4e0b\uff0c\u8fd9\u56db\u8005\u7684\u6027\u80fd\u8868\u73b0\u7ed3\u8bba\u5982\u4e0b\uff1a\\n\\n- \u5c06\u6027\u80fd\u4ece\u4f18\u81f3\u52a3\u8fdb\u884c\u6392\u5e8f\uff1a\\n\\n    **\u573a\u666f\u4e00\u548c\u573a\u666f\u4e8c\u5747\u4e3a\uff1aAWS c7g.large > Azure D2ps v5 > GCP t2a-standard-2 > OCI A1**\\n\\n \u5728\u8fd9\u4e24\u4e2a\u573a\u666f\u4e0b\uff0cAWS c7g.large \u7684\u6027\u80fd\u51e0\u4e4e\u90fd\u662f OCI A1 \u7684\u4e24\u500d\uff0c\u540e\u4e09\u8005\u7684\u5dee\u8ddd\u4e0d\u5927\u3002\\n\\n## \u603b\u7ed3\\n\\n\u901a\u8fc7 Apache APISIX \u7684\u6027\u80fd\u6d4b\u8bd5\u7ed3\u679c\u5206\u6790\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u51fa AWS Graviton3 \u62e5\u6709\u6bd4 GCP T2A\u3001Azure Dpsv5 \u548c OCI A1 \u66f4\u9ad8\u7684\u6027\u80fd\u3002\u6211\u4eec\u5728\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\u4ec5\u4f7f\u7528\u4e86 Apache APISIX \u7ed1\u5b9a\u5355\u6838\u5fc3\u6d4b\u8bd5\uff0c\u5982\u679c\u4f7f\u7528\u591a\u6838\uff0c\u8fd9\u56db\u8005\u6240\u5448\u73b0\u7684\u6027\u80fd\u53ef\u80fd\u4f1a\u6709\u6240\u4e0d\u540c\u3002\\n\\n\u540e\u7eed\u6709\u53ef\u80fd\u4f1a\u4f7f\u7528\u591a\u6838\u8fdb\u884c\u66f4\u591a\u6d4b\u8bd5\uff0c\u656c\u8bf7\u5173\u6ce8\uff01\\n\\n## \u53c2\u8003\u94fe\u63a5\\n\\n- [New \u2013 Amazon EC2 C7g Instances, Powered by AWS Graviton3 Processors](https://aws.amazon.com/cn/blogs/aws/new-amazon-ec2-c7g-instances-powered-by-aws-graviton3-processors/)\\n- [Tau T2A machine series (Preview)](https://cloud.google.com/compute/docs/general-purpose-machines#t2a_machines)\\n- [Now in preview: Azure Virtual Machines with Ampere Altra Arm-based processors](https://azure.microsoft.com/en-us/blog/now-in-preview-azure-virtual-machines-with-ampere-altra-armbased-processors/)\\n- [Ampere A1 Compute](https://www.oracle.com/hk/cloud/compute/arm/)"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (7.16 - 7.31)","metadata":{"permalink":"/zh/blog/2022/08/09/weekly-report-0731","source":"@site/blog/2022/08/09/weekly-report-0731.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (7.16 - 7.31)","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86 openid-connect \u63d2\u4ef6\u4e2d\u652f\u6301 PKCE\u3001Ingress \u8d44\u6e90\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 APISIX \u7684\u63d2\u4ef6\u7b49\u529f\u80fd\u3002","date":"2022-08-09T00:00:00.000Z","formattedDate":"2022\u5e748\u67089\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.625,"truncated":true,"authors":[],"prevItem":{"title":"GCP\u3001AWS\u3001Azure \u548c Oracle ARM \u67b6\u6784\u670d\u52a1\u5668\u6027\u80fd\u6d4b\u8bd5\u5bf9\u6bd4","permalink":"/zh/blog/2022/08/12/arm-performance-google-aws-azure-with-apisix"},"nextItem":{"title":"Apache APISIX \u5728 Azure Ddsv5 \u548c Dpdsv5 \u4e0a\u7684\u6027\u80fd\u6d4b\u8bd5","permalink":"/zh/blog/2022/08/08/apache-apisix-performance-test-in-azure"}},"content":"> \u4ece 7.16 - 7.31\uff0c\u6709 28 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 93 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2022/weeklyreport/0809/1.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/2022/weeklyreport/0809/2.png)\\n\\n## Good first issue\\n\\n### Issue #7538\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/7538\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5728\u76ee\u524d\u7684\u5b98\u7f51\u535a\u5ba2\u53ca\u6587\u6863\u4e2d\u786c\u6027\u89c4\u5b9a\u4e86 APISIX \u7684\u7248\u672c\uff0c\u5bfc\u81f4\u4e00\u4e9b\u65b0\u6765\u7684\u5c0f\u4f19\u4f34\u5728\u9605\u8bfb\u65e7\u7248\u672c\u7684\u535a\u5ba2\u65f6\u4ea7\u751f\u4e86\u8bef\u89e3\u3002\u8fd9\u4e5f\u4f7f\u5f97\u66f4\u65b0\u6587\u6863\u4e2d\u6700\u65b0\u7684 APISIX \u7248\u672c\u53d8\u5f97\u66f4\u52a0\u56f0\u96be\uff0c\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u540c\u65f6\u4fee\u6539\u597d\u51e0\u4e2a\u5730\u65b9\u3002\\n\\n\u6216\u8bb8\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u5305\u542b\u7248\u672c\u53f7\u7684\u9759\u6001\u6587\u4ef6\uff0c\u5e76\u63d0\u4f9b\u4e00\u4e2a\u7b80\u5355\u7684\u5355\u884c\u547d\u4ee4\u6765\u83b7\u53d6\u6587\u6863\u4e2d\u7684\u7248\u672c\u53f7\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [`proxy-rewrite` \u63d2\u4ef6\u652f\u6301\u4f7f\u7528\u539f\u59cb\u8bf7\u6c42\u7684 URI\uff0c\u7ed5\u8fc7\u9ed8\u8ba4\u7684 URI \u7f16\u7801](https://github.com/apache/apisix/pull/7401)\uff08\u8d21\u732e\u8005\uff1a[ilteriseroglu-ty](https://github.com/ilteriseroglu-ty)\uff09\\n\\n- [`prometheus` \u63d2\u4ef6\u652f\u6301\u76d1\u63a7\u5171\u4eab\u5185\u5b58\u76f8\u5173\u6307\u6807](https://github.com/apache/apisix/pull/7412)\uff08\u8d21\u732e\u8005\uff1a[ccxhwmy](https://github.com/ccxhwmy)\uff09\\n\\n- [\u652f\u6301\u52a8\u6001\u63a7\u5236\u662f\u5426\u6267\u884c\u67d0\u4e2a\u63d2\u4ef6](https://github.com/apache/apisix/pull/7453)\uff08\u8d21\u732e\u8005\uff1a[soulbird](https://github.com/soulbird)\uff09\\n\\n- [`jwt-auth` \u652f\u6301\u8bbe\u7f6e\u65f6\u949f\u6f02\u79fb\u53c2\u6570](https://github.com/apache/apisix/pull/7500)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [Control API \u652f\u6301\u6253\u5370\u6240\u6709\u63d2\u4ef6\u7684\u5143\u6570\u636e](https://github.com/apache/apisix/pull/7514)\uff08\u8d21\u732e\u8005\uff1a[kingluo](https://github.com/kingluo)\uff09\\n\\n- [`clickhouse-logger` \u63d2\u4ef6\u652f\u6301\u8bbe\u7f6e\u591a\u4e2a\u7aef\u70b9](https://github.com/apache/apisix/pull/7517)\uff08\u8d21\u732e\u8005\uff1a[zhendongcmss](https://github.com/zhendongcmss)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [Apache APISIX Ingress v1.5-rc1 \u6b63\u5f0f\u53d1\u5e03](https://apisix.apache.org/zh/blog/2022/08/05/apisix-ingress-1.5rc1-release/)\\n\\n    \u5386\u65f6 7 \u4e2a\u6708\uff0cApache APISIX Ingress Controller v1.5-rc1 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\u3002\u5e26\u6765 API Version \u5347\u7ea7\u3001Gateway API \u652f\u6301\u4ee5\u53ca Ingress \u76f8\u5173\u8d44\u6e90\u7684\u66f4\u65b0\u4e0e\u8c03\u6574\u3002\\n\\n- [Apache APISIX 2.15 \u6b63\u5f0f\u53d1\u5e03](https://apisix.apache.org/zh/blog/2022/07/29/release-apache-apisix-2.15/)\\n\\n    Apache APISIX 2.15 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\u63d2\u4ef6\u4f18\u5148\u7ea7\u548c\u6267\u884c\u7b56\u7565\u3001\u81ea\u5b9a\u4e49\u9519\u8bef\u54cd\u5e94\u4ee5\u53ca\u652f\u6301\u76d1\u63a7\u56db\u5c42\u6d41\u91cf\u7684\u6307\u6807\u7b49\u529f\u80fd\u3002\\n\\n- [\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX\uff1f](https://apisix.apache.org/zh/blog/2022/07/30/why-we-need-apache-apisix/)\\n\\n    \u672c\u6587\u4ecb\u7ecd\u4e86 Kong \u548c NGINX \u7684\u75db\u70b9\uff0c\u4ee5\u53ca Apache APISIX \u5982\u4f55\u89e3\u51b3\u5b83\u4eec\u7684\u75db\u70b9\uff0c\u5e76\u4e14\u4e3a\u4f60\u4ecb\u7ecd\u4e86 Apache APISIX \u7684\u5e94\u7528\u573a\u666f\u3002"},{"id":"Apache APISIX \u5728 Azure Ddsv5 \u548c Dpdsv5 \u4e0a\u7684\u6027\u80fd\u6d4b\u8bd5","metadata":{"permalink":"/zh/blog/2022/08/08/apache-apisix-performance-test-in-azure","source":"@site/blog/2022/08/08/apache-apisix-performance-test-in-azure.md","title":"Apache APISIX \u5728 Azure Ddsv5 \u548c Dpdsv5 \u4e0a\u7684\u6027\u80fd\u6d4b\u8bd5","description":"\u672c\u6587\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u6765\u5bf9\u6bd4 Azure Ddsv5 \u548c Azure Dpdsv5 \u5728\u7f51\u7edc IO \u5bc6\u96c6\u578b\u573a\u666f\u4e0b\u7684\u6027\u80fd\u3002","date":"2022-08-08T00:00:00.000Z","formattedDate":"2022\u5e748\u67088\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.805,"truncated":true,"authors":[{"name":"\u8d75\u58eb\u745e","title":"Author","url":"https://github.com/soulbird","image_url":"https://github.com/soulbird.png","imageURL":"https://github.com/soulbird.png"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (7.16 - 7.31)","permalink":"/zh/blog/2022/08/09/weekly-report-0731"},"nextItem":{"title":"Apache APISIX Ingress v1.5-rc1 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/08/05/apisix-ingress-1.5rc1-release"}},"content":"> \u672c\u6587\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u6765\u5bf9\u6bd4 Azure Ddsv5 \u548c Azure Dpdsv5 \u5728\u7f51\u7edc IO \u5bc6\u96c6\u578b\u573a\u666f\u4e0b\u7684\u6027\u80fd\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\\n\\n\u4eca\u5e74 4 \u6708\uff0c\u5fae\u8f6f\u5ba3\u5e03\u63a8\u51fa\u57fa\u4e8e Ampere\xae Altra\xae Arm \u5904\u7406\u5668\u7684 Azure \u865a\u62df\u673a\u7cfb\u5217\u9884\u89c8\u7248\u3002\u65b0\u7684 VM \u7cfb\u5217\u5305\u62ec\u901a\u7528 Dpsv5 \u548c\u5185\u5b58\u4f18\u5316\u7684 Epsv5 VM\uff0c\u5177\u4f53\u4fe1\u606f\u53c2\u8003\u4e0b\u56fe\uff1a\\n\\n![VM \u7cfb\u5217](https://static.apiseven.com/2022/blog/0808/1.png)\\n\\n\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cAmpere\xae Altra\xae Arm \u662f\u4e00\u6b3e\u4e91\u539f\u751f\u5904\u7406\u5668\uff0c\u57fa\u4e8e Ampere\xae Altra\xae Arm \u5904\u7406\u5668\u7684 Azure \u865a\u62df\u673a\u4e5f\u56e0\u6b64\u80fd\u4ee5\u9ad8\u6548\u7684\u65b9\u5f0f\u8fd0\u884c\u6a2a\u5411\u6269\u5c55\u7684\u4e91\u539f\u751f\u5e94\u7528\u7a0b\u5e8f\u3002\\n\\n\u90a3\u4e48\u5b9e\u9645\u4f53\u9a8c\u548c\u6027\u80fd\u5982\u4f55\u5462\uff1f\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u4ee5\u4e00\u4e2a\u4e91\u539f\u751f\u7684 API \u7f51\u5173\u4e3a\u4f8b\uff0c\u5e26\u5927\u5bb6\u4e00\u8d77\u770b\u770b\u57fa\u4e8e ARM \u67b6\u6784\u7684 Azure \u865a\u62df\u673a\u7684\u8868\u73b0\u3002\u8fd9\u91cc\uff0c\u6211\u4eec\u9009\u62e9\u4e86 Apache APISIX \u5728\u901a\u7528\u578b Dpdsv5 \u7cfb\u5217\u865a\u62df\u673a\u4e0a\u8fdb\u884c\u5b89\u88c5\u6d4b\u8bd5\u3002\\n\\nApache APISIX \u662f\u4e00\u4e2a\u4e91\u539f\u751f\u3001\u9ad8\u6027\u80fd\u3001\u53ef\u6269\u5c55\u7684 API \u7f51\u5173\u3002\u57fa\u4e8e NGNIX + LuaJIT \u548c etcd\uff0cAPISIX \u4e0e\u4f20\u7edf API \u7f51\u5173\u76f8\u6bd4\uff0c\u5177\u6709\u52a8\u6001\u8def\u7531\u548c\u63d2\u4ef6\u70ed\u52a0\u8f7d\u7279\u6027\uff0c\u7279\u522b\u9002\u5408\u4e91\u539f\u751f\u67b6\u6784\u4e0b\u7684 API \u7ba1\u7406\u3002\\n\\n![Apache APISIX](https://static.apiseven.com/2022/blog/0808/2.png)\\n\\n## \u524d\u671f\u51c6\u5907\\n\\n\u9996\u5148\uff0c\u6211\u4eec\u5728 Azure \u4e0a\u542f\u52a8\u4e00\u4e2a Dpdsv5 \u7cfb\u5217\u7684\u5b9e\u4f8b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9 Ubuntu 20.04\u3002\\n\\n![Dpdsv5](https://static.apiseven.com/2022/blog/0808/3.jpeg)\\n\\n\u7136\u540e\u5b89\u88c5 Docker\uff0c\u65b9\u4fbf\u540e\u7eed\u4f7f\u7528\u5bb9\u5668\u5316\u7684\u65b9\u5f0f\u6765\u90e8\u7f72 Apache APISIX\u3002\\n\\n```shell\\nsudo apt-get update && sudo apt-get install docker.io\\n```\\n\\n## \u90e8\u7f72 Apache APISIX\\n\\nApache APISIX \u4f7f\u7528 etcd \u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3\uff0c\u56e0\u6b64\u9700\u8981\u5148\u542f\u52a8\u4e00\u4e2a etcd \u5b9e\u4f8b\u3002\\n\\n```shell\\nsudo docker run -d --name etcd \\\\\\n    -p 2379:2379 \\\\\\n    -e ETCD_UNSUPPORTED_ARCH=arm64 \\\\\\n    -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\n    -e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\n    rancher/coreos-etcd:v3.4.16-arm64\\n```\\n\\n\u542f\u52a8 Apache APISIX \u5b9e\u4f8b\u3002\\n\\n```shell\\nsudo docker run --net=host -d apache/apisix:2.14.1-alpine\\n```\\n\\n\u521b\u5efa\u8def\u7531\u3002\\n\\n```shell\\ncurl \\"http://127.0.0.1:9080/apisix/admin/routes/1\\" \\\\\\n-H \\"X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\\" -X PUT -d \'\\n{  \\n    \\"uri\\": \\"/anything/*\\",\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n              \\"httpbin.org:80\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u8fdb\u884c\u8bbf\u95ee\u6d4b\u8bd5\u3002\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/anything/das\\n```\\n\\n\u8fd4\u56de\u4ee5\u4e0b\u7ed3\u679c\u5219\u8868\u793a\u5b89\u88c5\u6210\u529f\uff1a\\n\\n```shell\\nHTTP/1.1 200 OK\\n.....\\n```\\n\\n## Azure Ddsv5 vs Azure Dpdsv5\\n\\n\u4ece\u4e0a\u8ff0\u64cd\u4f5c\u6765\u770b\uff0cApache APISIX \u5728 Azure Dpdsv5 \u4e0a\u7684\u5b89\u88c5\u548c\u517c\u5bb9\u6027\u6d4b\u8bd5\u90fd\u80fd\u987a\u5229\u5b8c\u6210\u3002\u90a3\u4e48 Azure Dpdsv5 \u7684\u5b9e\u9645\u6027\u80fd\u5230\u5e95\u5982\u4f55\u5462\uff1f\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u4f7f\u7528 Apache APISIX \u5206\u522b\u5728 Azure Dpdsv5 \u548c  Azure Ddsv5 \u4e0a\u505a\u6027\u80fd\u6d4b\u8bd5\u5bf9\u6bd4\uff0c\u770b\u770b\u5b9e\u9645\u8868\u73b0\u3002\\n\\nAzure Ddsv5 \u662f Azure D \u7cfb\u5217\u7684\u53e6\u4e00\u6b3e\u673a\u578b\uff0c\u662f\u57fa\u4e8e Intel\xae x86 \u67b6\u6784\u7684\uff0c \u6240\u4ee5\u4e0a\u8ff0 etcd \u5b89\u88c5\u6b65\u9aa4\u7565\u6709\u4e0d\u540c\uff1a\\n\\n```shell\\nsudo docker run -d --name etcd \\\\\\n    -p 2379:2379 \\\\\\n    -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\n    -e ALLOW_NONE_AUTHENTICATION=yes \\\\\\n    -e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\n    bitnami/etcd:3.4.16\\n```\\n\\n\u4e3a\u7b80\u5355\u8d77\u89c1\uff0c\u672c\u6b21\u6d4b\u8bd5 APISIX \u4e2d\u53ea\u542f\u7528\u4e86\u4e00\u4e2a Worker\uff0c\u4ee5\u4e0b\u6027\u80fd\u6d4b\u8bd5\u6570\u636e\u5747\u5728\u5355\u6838 CPU \u4e0a\u8fd0\u884c\u3002\\n\\n### \u573a\u666f\u4e00\uff1a\u5355\u4e0a\u6e38\\n\\n\u8be5\u573a\u666f\u4e0b\u5c06\u4f7f\u7528\u5355\u4e2a\u4e0a\u6e38\uff08\u4e0d\u5305\u542b\u4efb\u4f55\u63d2\u4ef6\uff09\uff0c\u4e3b\u8981\u6d4b\u8bd5 APISIX \u5728\u7eaf\u4ee3\u7406\u56de\u6e90\u6a21\u5f0f\u4e0b\u7684\u6027\u80fd\u8868\u73b0\u3002\u5728\u672c\u5730\u73af\u5883\u4e2d\u8fdb\u884c\u6d4b\u8bd5\uff1a\\n\\n```shell\\n# apisix: 1 worker + 1 upstream + no plugin\\n\\n# \u6ce8\u518c\u8def\u7531\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u573a\u666f 2\uff1a\u5355\u4e2a\u4e0a\u6e38 + \u4e24\u4e2a\u63d2\u4ef6\\n\\n\u8be5\u573a\u666f\u4e0b\u5c06\u4f7f\u7528\u5355\u4e2a\u4e0a\u6e38\u4e0e\u4e24\u4e2a\u63d2\u4ef6\u8fdb\u884c\uff0c\u4e3b\u8981\u6d4b\u8bd5 APISIX \u5728\u5f00\u542f `limit-count` \u548c `prometheus` \u4e24\u4e2a\u6838\u5fc3\u6027\u80fd\u6d88\u8017\u63d2\u4ef6\u65f6\u7684\u8868\u73b0\u3002\\n\\n```shell\\n# apisix: 1 worker + 1 upstream + 2 plugins (limit-count + prometheus)\\n\\n# \u6ce8\u518c\u8def\u7531\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {\\n        \\"limit-count\\": {\\n            \\"count\\": 2000000000000,\\n            \\"time_window\\": 60,\\n            \\"rejected_code\\": 503,\\n            \\"key\\": \\"remote_addr\\"\\n        },\\n        \\"prometheus\\": {}\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u6570\u636e\u6bd4\u8f83\\n\\n\u4e0a\u8ff0\u4e24\u4e2a\u573a\u666f\u4e2d\uff0c\u5206\u522b\u4ece\u8bf7\u6c42 QPS\uff08\u6bcf\u79d2\u67e5\u8be2\u6570\uff09 \u548c\u5ef6\u8fdf\u65f6\u95f4\u4e24\u4e2a\u5c42\u9762\u8fdb\u884c\u4e86\u76f8\u5173\u7684\u6d4b\u8bd5\u5bf9\u6bd4\u3002\u7ed3\u679c\u5982\u4e0b\uff1a\\n\\n1. QPS \u6bd4\u8f83\\n\\n    ![QPS](https://static.apiseven.com/2022/blog/0808/4.png)\\n\\n2. \u8bf7\u6c42\u5ef6\u8fdf\u6bd4\u8f83\\n\\n    ![Latency](https://static.apiseven.com/2022/blog/0808/5.png)\\n\\n<table>\\n    <tr>\\n        <td><b>  </b></td>\\n        <td colspan=\\"2\\">\u5355\u4e2a\u4e0a\u6e38</td>\\n        <td colspan=\\"2\\">\u5355\u4e2a\u4e0a\u6e38+\u4e24\u4e2a\u63d2\u4ef6</td>\\n    </tr>\\n    <tr>\\n        <td><b>  </b></td>\\n        <td><b>Azure Ddsv5</b></td>\\n        <td><b>Azure Dpdsv5</b></td>\\n        <td><b>Azure Ddsv5</b></td>\\n        <td><b>Azure Dpdsv5</b></td>\\n    </tr>\\n    <tr>\\n        <td><b>QPS(request/s)</b></td>\\n        <td><b>14900</b></td>\\n        <td><b>13400</b></td>\\n        <td><b>13100</b></td>\\n        <td><b>11000</b></td>\\n    </tr>\\n    <tr>\\n        <td><b>Latency(ms)</b></td>\\n        <td><b>1.07</b></td>\\n        <td><b>1.21</b></td>\\n        <td><b>1.21</b></td>\\n        <td><b>1.43</b></td>\\n    </tr>\\n    </table>\\n\\n\u4ece\u4ee5\u4e0a\u6570\u636e\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u5728 API \u7f51\u5173\u7b49\u7f51\u7edc IO \u5bc6\u96c6\u8ba1\u7b97\u573a\u666f\u4e0b\uff0cDpdsv5 \u76f8\u6bd4\u540c\u7cfb\u5217 Ddsv5 \u5728\u6027\u80fd\u4e0a\u4ecd\u7136\u6709\u5dee\u8ddd\u3002\u4e0d\u8fc7\u53e6\u4e00\u4e2a\u597d\u6d88\u606f\u662f\uff0c\u5728\u540c\u7b49\u914d\u7f6e\u7684\u60c5\u51b5\u4e0b\uff0cDpdsv5 \u7684\u4ef7\u683c\u8981\u6bd4 Ddsv5 \u4fbf\u5b9c 20% \u5de6\u53f3\u3002\u5728\u5b9e\u9645\u673a\u5668\u9009\u578b\u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u4f53\u91cf\u6765\u7075\u6d3b\u51b3\u7b56\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u4f7f\u7528 Apache APISIX \u6765\u5bf9\u6bd4 Azure Ddsv5 \u548c Azure Dpdsv5 \u7684\u6027\u80fd\u3002\u4ece\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa Azure Dpdsv5 \u76f8\u6bd4 Ddsv5\uff0c\u8868\u73b0\u867d\u7136\u4e0d\u662f\u90a3\u4e48\u4eae\u773c\uff0c\u4f46\u662f\u7531\u4e8e\u8be5\u7cfb\u5217\u7684\u673a\u578b\u5c1a\u5904\u4e8e\u9884\u89c8\u7248\uff0c\u5fae\u8f6f\u6b63\u5728\u8fdb\u884c\u6301\u7eed\u7684\u6539\u8fdb\u548c\u4f18\u5316\uff0c\u6211\u4eec\u4e5f\u975e\u5e38\u671f\u5f85\u5b83\u7684\u540e\u7eed\u8868\u73b0\u3002\\n\\n## \u53c2\u8003\u94fe\u63a5\\n\\n[Now in preview: Azure Virtual Machines with Ampere Altra Arm-based processors](https://azure.microsoft.com/en-us/blog/now-in-preview-azure-virtual-machines-with-ampere-altra-armbased-processors/)"},{"id":"Apache APISIX Ingress v1.5-rc1 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2022/08/05/apisix-ingress-1.5rc1-release","source":"@site/blog/2022/08/05/apisix-ingress-1.5rc1-release.md","title":"Apache APISIX Ingress v1.5-rc1 \u6b63\u5f0f\u53d1\u5e03","description":"\u5386\u65f6 7 \u4e2a\u6708\uff0cApache APISIX Ingress Controller v1.5-rc1 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\u3002\u5e26\u6765 API Version \u5347\u7ea7\u3001Gateway API \u652f\u6301\u4ee5\u53ca Ingress \u76f8\u5173\u8d44\u6e90\u7684\u66f4\u65b0\u4e0e\u8c03\u6574\u3002","date":"2022-08-05T00:00:00.000Z","formattedDate":"2022\u5e748\u67085\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.335,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","url":"https://github.com/tao12345666333","imageURL":"https://github.com/tao12345666333.png"}],"prevItem":{"title":"Apache APISIX \u5728 Azure Ddsv5 \u548c Dpdsv5 \u4e0a\u7684\u6027\u80fd\u6d4b\u8bd5","permalink":"/zh/blog/2022/08/08/apache-apisix-performance-test-in-azure"},"nextItem":{"title":"\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX\uff1f","permalink":"/zh/blog/2022/07/30/why-we-need-apache-apisix"}},"content":"> \u5386\u65f6 7 \u4e2a\u6708\uff0cApache APISIX Ingress Controller v1.5-rc1 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\u3002\u5e26\u6765 API Version \u5347\u7ea7\u3001Gateway API \u652f\u6301\u4ee5\u53ca Ingress \u76f8\u5173\u8d44\u6e90\u7684\u66f4\u65b0\u4e0e\u8c03\u6574\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX Ingress Controller v1.5-rc1 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\u3002\u6b64\u7248\u672c\u5386\u65f6 7 \u4e2a\u6708\u5de6\u53f3\u7684\u65f6\u95f4\uff0c\u7531 36 \u4f4d\u8d21\u732e\u8005\u8fdb\u884c\u4e86 144 \u6b21\u63d0\u4ea4\u3002\u5176\u4e2d\u6709 22 \u4f4d\u65b0\u664b\u8d21\u732e\u8005\uff0c\u611f\u8c22\u5927\u5bb6\u5bf9\u672c\u9879\u76ee\u7684\u8d21\u732e\u4e0e\u652f\u6301\uff01\\n\\n![\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2022/blog/0805/ingress-1.png)\\n\\n\u63a5\u4e0b\u6765\u5c31\u8ba9\u6211\u4eec\u4e00\u8d77\u770b\u4e0b\uff0c\u5728 APISIX Ingress v1.5 \u7248\u672c\u4e2d\u6709\u54ea\u4e9b\u91cd\u8981\u66f4\u65b0\u3002\\n\\n## \u6240\u6709 CRD API Version \u5347\u7ea7\u81f3 v2\\n\\n\u5728 APISIX Ingress \u9879\u76ee\u521d\u59cb\uff0c\u53ea\u6709\u5c11\u6570\u7684\u51e0\u4e2a CRD \uff0c\u5e76\u4e14\u6bcf\u4e2a\u8d44\u6e90\u90fd\u662f\u5404\u81ea\u8fdb\u884c API Version \u7684\u7ef4\u62a4\u3002\u8fd9\u5c31\u5bfc\u81f4\u4e86\u540e\u7eed\u6709\u65b0\u8d44\u6e90\u5f15\u5165\u6216\u529f\u80fd\u8fed\u4ee3\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u51fa\u73b0\u6bcf\u4e2a\u81ea\u5b9a\u4e49\u8d44\u6e90\u4f7f\u7528\u7684 API Version \u90fd\u4e0d\u4e00\u6837\u7684\u72b6\u51b5\uff0c\u4ece\u800c\u589e\u52a0\u7528\u6237\u5b66\u4e60\u6210\u672c\u3002\\n\\n\u6240\u4ee5\u4ece v1.3 \u7248\u672c\u5f00\u59cb\uff0c\u6211\u4eec\u63d0\u51fa\u4e86\u7edf\u4e00\u6240\u6709\u8d44\u6e90 API Version \u7684 [Proposal](https://github.com/apache/apisix-ingress-controller/issues/707)\u3002\u7ecf\u8fc7\u4e24\u4e2a\u7248\u672c\u7684\u8fed\u4ee3\uff0c\u73b0\u5df2\u6b63\u5f0f\u5f15\u5165\u4e86 v2 API Version\uff0c\u540c\u65f6\u5c06 v2beta3 \u6807\u8bb0\u4e3a\u5e9f\u5f03\uff0c\u76f4\u5230 v1.7 \u7248\u672c\u65f6\u4f1a\u5b8c\u5168\u79fb\u9664 v2beta3\u3002\\n\\n## \u57fa\u672c\u652f\u6301 Gateway API\\n\\nGateway API \u53ef\u4ee5\u8bf4\u662f\u4e0b\u4e00\u4ee3\u7684 Ingress \u5b9a\u4e49\uff0c\u5177\u6709\u66f4\u52a0\u4e30\u5bcc\u7684\u8868\u73b0\u80fd\u529b\u3002\u6211\u4eec\u5df2\u7ecf\u5728 APISIX Ingress \u4e2d\u5b8c\u6210\u5176\u4e2d\u5927\u591a\u6570\u8d44\u6e90\u7684\u652f\u6301\u3002\\n\\n:::note \u6ce8\u610f\\n\\n\u6b64\u7279\u6027\u76ee\u524d\u8fd8\u5728\u5b9e\u9a8c\u9636\u6bb5\uff0c\u9ed8\u8ba4\u4e0d\u542f\u7528\u3002\\n\\n:::\\n\\n\u5982\u679c\u60f3\u8981\u5728 APISIX Ingress \u4e2d\u4f7f\u7528 Gateway API\uff0c\u53ef\u4ee5\u5728 controller \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f20\u9012 `enable_gateway_api: true` \u914d\u7f6e\u9879\u6765\u5f00\u542f\u6b64\u529f\u80fd\u3002\\n\\n\u5728\u5b89\u88c5\u5b8c Gateway API \u7684 CRD \u540e\uff0c\u5373\u53ef\u901a\u8fc7\u521b\u5efa `HTTPRoute` \u8d44\u6e90\u6765\u5b8c\u6210 7 \u5c42\u4ee3\u7406\u7684\u914d\u7f6e\u3002\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```yaml\\napiVersion: gateway.networking.k8s.io/v1alpha2\\nkind: HTTPRoute\\nmetadata:\\n  name: httpbin-route\\nspec:\\n  hostnames: [\\"httpbin.local\\"]\\n  rules:\\n  - matches:\\n    - path:\\n        type: PathPrefix\\n        value: /ip\\n    backendRefs:\\n    - name: httpbin\\n      port: 80\\n```\\n\\n\u8be5\u914d\u7f6e\u751f\u6548\u540e\uff0c\u5ba2\u6237\u7aef\u5c06\u53ef\u4ee5\u901a\u8fc7 `httpbin.local/ip` \u8bbf\u95ee\u5230\u540e\u7aef `httpbin` \u7684 `80` \u7aef\u53e3\u3002\\n\\n\u6b64\u5916\uff0c\u6211\u4eec\u8ba1\u5212\u5728 v1.6 \u7248\u672c\u4e2d\u5b9e\u73b0 Gateway API \u5269\u4f59 `TCPRoute` \u548c `UDPRoute` \u8fd9\u4e24\u79cd\u8d44\u6e90\u7684\u652f\u6301\uff0c\u5e76\u8ba1\u5212\u5f15\u5165 Gateway API \u7684\u4e00\u81f4\u6027\u6d4b\u8bd5\uff0c\u4ee5\u786e\u4fdd\u6211\u4eec\u7684\u5b9e\u73b0\u4e0e Gateway API \u7684\u9884\u671f\u4fdd\u6301\u4e00\u81f4\u3002\\n\\n## \u5141\u8bb8 Ingress \u8d44\u6e90\u7ed1\u5b9a\u4efb\u610f\u63d2\u4ef6\\n\\n\u5728 Apache APISIX Ingress Controller \u9879\u76ee\u4e2d\uff0c\u652f\u6301\u4f7f\u7528 Kubernetes \u539f\u751f\u7684 Ingress \u8d44\u6e90\u8fdb\u884c\u4ee3\u7406\u914d\u7f6e\uff0c\u4f46\u5982\u679c\u60f3\u8981\u5728 Ingress \u8d44\u6e90\u4e2d\u4f7f\u7528 APISIX \u4e30\u5bcc\u7684\u63d2\u4ef6\u80fd\u529b\uff0c\u5c31\u5fc5\u987b\u901a\u8fc7\u589e\u52a0 Annotation \u6765\u5b8c\u6210\uff0c\u5e76\u4e14\u9700\u8981\u5b9e\u73b0\u5bf9\u5e94 Annotation \u7684\u903b\u8f91\u3002\\n\\n\u8fd9\u79cd\u65b9\u5f0f\u9650\u5236\u4e86 Ingress \u8d44\u6e90\u7684\u63d2\u4ef6\u80fd\u529b\uff0c\u800c\u4e14\u4e3a\u6bcf\u4e2a\u63d2\u4ef6\u5355\u72ec\u5f00\u53d1 Annotaion \u662f\u4e00\u4e2a\u76f8\u5bf9\u9ad8\u6210\u672c\u7684\u4e8b\u60c5\u3002\\n\\n\u5728 v1.5 \u7248\u672c\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7\u4e3a Ingress \u8d44\u6e90\u589e\u52a0\u4e86\u4e00\u4e2a\u65b0\u7684 Annotaion `k8s.apisix.apache.org/plugin-config-name`\uff0c\u8fd9\u5141\u8bb8\u5f15\u7528\u4efb\u610f\u7684 `ApisixPluginConfig` \u8d44\u6e90\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u8ba9 Ingress \u8d44\u6e90\u53ef\u4ee5\u968f\u610f\u4f7f\u7528\u4efb\u610f APISIX \u63d2\u4ef6\u7684\u80fd\u529b\u3002\u8fd9\u5c06\u5927\u5927\u589e\u52a0 APISIX Ingress Controller \u7684\u6613\u7528\u6027\uff0c\u4e5f\u5c06\u964d\u4f4e\u7528\u6237\u4ece\u5176\u4ed6 Ingress controller \u5411 APISIX Ingress Controller \u8fc1\u79fb\u65f6\u7684\u6210\u672c\u3002\\n\\n## \u66f4\u591a\u7ec6\u8282\\n\\n\u9664\u4ee5\u4e0a\u8fd9\u4e9b\u7279\u6027\u5916\uff0c\u8be5\u7248\u672c\u4e2d\u8fd8\u52a0\u5165\u4e86\u5f88\u591a\u5176\u4ed6\u7279\u6027\u3002\u6bd4\u5982\uff1a\\n\\n- \u5b9a\u65f6 Kubernetes \u96c6\u7fa4\u5f80 APISIX \u96c6\u7fa4\u4e2d\u540c\u6b65\u6570\u636e\u7684\u673a\u5236\uff0c\u4fdd\u8bc1 APISIX \u96c6\u7fa4\u4e2d\u6570\u636e\u4e0e\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u914d\u7f6e\u7684\u4e00\u81f4\u6027\uff1b\\n- \u4e3a ApisixConsumer \u8d44\u6e90\u589e\u52a0\u4e86\u66f4\u591a\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff1b\\n- \u4e0e APISIX v2.15 \u7248\u7684\u517c\u5bb9\uff1b\\n- \u5c06\u6240\u6709\u4f9d\u8d56\u66f4\u65b0\u5230\u6700\u65b0\u7248\u672c\uff0c\u4ee5\u4fbf\u51cf\u5c11\u5b89\u5168\u9690\u60a3\uff1b\\n\\n\u66f4\u591a\u5177\u4f53\u53d1\u7248\u7ec6\u8282\uff0c\u8bf7\u53c2\u8003 v1.5-rc1 \u7684 [Changelog](https://github.com/apache/apisix-ingress-controller/blob/v1.5.0/CHANGELOG.md#150-rc1)\u3002"},{"id":"\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX\uff1f","metadata":{"permalink":"/zh/blog/2022/07/30/why-we-need-apache-apisix","source":"@site/blog/2022/07/30/why-we-need-apache-apisix.md","title":"\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX\uff1f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86Kong \u548c NGINX \u7684\u4e0d\u8db3\uff0c\u4ee5\u53ca\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u5982\u4f55\u89e3\u51b3 NGINX \u548c Kong \u6240\u5e26\u6765\u7684\u4e1a\u52a1\u75db\u70b9\u3001Apache APISIX \u7684\u4f18\u52bf\u548c\u4f7f\u7528\u573a\u666f\u3002","date":"2022-07-30T00:00:00.000Z","formattedDate":"2022\u5e747\u670830\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":10.055,"truncated":true,"authors":[{"name":"\u97e9\u98de","url":"https://github.com/hf400159","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"Apache APISIX Ingress v1.5-rc1 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/08/05/apisix-ingress-1.5rc1-release"},"nextItem":{"title":"Apache APISIX 2.15 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/07/29/release-apache-apisix-2.15"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Kong \u548c NGINX \u7684\u75db\u70b9\uff0c\u4ee5\u53ca Apache APISIX \u5982\u4f55\u89e3\u51b3\u5b83\u4eec\u7684\u75db\u70b9\uff0c\u5e76\u4e14\u4e3a\u4f60\u4ecb\u7ecd\u4e86 Apache APISIX \u7684\u5e94\u7528\u573a\u666f\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4e91\u539f\u751f\u65f6\u4ee3\uff0c\u52a8\u6001\u548c\u53ef\u89c2\u6d4b\u6027\u6210\u4e3a\u8861\u91cf API \u7f51\u5173\u7684\u6807\u51c6\u4e4b\u4e00\u3002Apache APISIX \u81ea\u8bde\u751f\u4e4b\u521d\u5c31\u4e00\u76f4\u8ddf\u968f\u7740\u4e91\u539f\u751f\u7684\u811a\u6b65\u524d\u884c\u3002\u7136\u800c Apache APISIX \u4f5c\u4e3a\u4e00\u4e2a\u8bde\u751f\u521a\u521a\u4e09\u5e74\u7684\u65b0\u4e00\u4ee3\u7f51\u5173\uff0c\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u4ece\u8bde\u751f 20 \u591a\u5e74\u7684 NGINX \u4e0e\u5f00\u6e90 8 \u5e74\u7684 Kong \u4e2d\u7a81\u51fa\u91cd\u56f4\uff0c\u6210\u4e3a\u4e91\u539f\u751f\u65f6\u4ee3\u6700\u6d41\u884c\u4ee5\u53ca\u6700\u6d3b\u8dc3\u7684\u7f51\u5173\uff1f\u6211\u8ba4\u4e3a\u5176\u4e2d\u6700\u91cd\u8981\u7684\u539f\u56e0\u662f\u89e3\u51b3\u4e86\u5f00\u53d1\u8005\u548c\u4f01\u4e1a\u5728\u4f7f\u7528 NGINX \u548c Kong \u4e2d\u7684\u75db\u70b9\u3002\\n\\n## NGINX \u4e0e Kong \u7684\u75db\u70b9\\n\\n\u5728\u5355\u4f53\u670d\u52a1\u65f6\u4ee3\uff0c\u4f7f\u7528 NGINX \u53ef\u4ee5\u5e94\u5bf9\u5927\u591a\u6570\u7684\u573a\u666f\uff0c\u800c\u5230\u4e86\u4e91\u539f\u751f\u65f6\u4ee3\uff0cNGINX \u56e0\u4e3a\u5176\u81ea\u8eab\u67b6\u6784\u7684\u539f\u56e0\u5219\u4f1a\u51fa\u73b0\u4e24\u4e2a\u95ee\u9898\uff1a\\n\\n- \u9996\u5148\u662f NGINX \u4e0d\u652f\u6301\u96c6\u7fa4\u7ba1\u7406\u3002\u51e0\u4e4e\u6bcf\u5bb6\u4e92\u8054\u7f51\u5382\u5546\u90fd\u6709\u81ea\u5df1\u7684 NGINX \u914d\u7f6e\u7ba1\u7406\u7cfb\u7edf\uff0c\u7cfb\u7edf\u867d\u7136\u5927\u540c\u5c0f\u5f02\u4f46\u662f\u4e00\u76f4\u6ca1\u6709\u7edf\u4e00\u7684\u65b9\u6848\u3002\\n- \u5176\u6b21\u662f NGINX \u4e0d\u652f\u6301\u914d\u7f6e\u7684\u70ed\u52a0\u8f7d\u3002\u5f88\u591a\u516c\u53f8\u4e00\u65e6\u4fee\u6539\u4e86\u914d\u7f6e\uff0c\u91cd\u65b0\u52a0\u8f7d NGINX \u7684\u65f6\u95f4\u53ef\u80fd\u9700\u8981\u534a\u4e2a\u5c0f\u65f6\u4ee5\u4e0a\u3002\u5e76\u4e14\u5728 Kubernetes \u4f53\u7cfb\u4e0b\uff0c\u4e0a\u6e38\u4f1a\u7ecf\u5e38\u53d1\u751f\u53d8\u5316\uff0c\u5982\u679c\u4f7f\u7528 NGINX \u6765\u5904\u7406\u5c31\u9700\u8981\u9891\u7e41\u91cd\u542f\u670d\u52a1\uff0c\u8fd9\u5bf9\u4e8e\u4f01\u4e1a\u662f\u4e0d\u53ef\u63a5\u53d7\u7684\u3002\\n\\n\u800c Kong \u7684\u51fa\u73b0\u5219\u89e3\u51b3\u4e86 NGINX \u7684\u75db\u70b9\uff0c\u4f46\u662f\u53c8\u5e26\u6765\u4e86\u65b0\u7684\u95ee\u9898\uff1a\\n\\n- Kong \u9700\u8981\u4f9d\u8d56\u4e8e PostgreSQL \u6216 Cassandra \u6570\u636e\u5e93\uff0c\u8fd9\u4f7f Kong \u7684\u6574\u4e2a\u67b6\u6784\u975e\u5e38\u81c3\u80bf\uff0c\u5e76\u4e14\u4f1a\u7ed9\u4f01\u4e1a\u5e26\u6765\u9ad8\u53ef\u7528\u7684\u95ee\u9898\u3002\u5982\u679c\u6570\u636e\u5e93\u6545\u969c\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a API \u7f51\u5173\u90fd\u4f1a\u51fa\u73b0\u6545\u969c\u3002\\n- Kong \u7684\u8def\u7531\u4f7f\u7528\u7684\u662f\u904d\u5386\u67e5\u627e\uff0c\u5f53\u7f51\u5173\u5185\u6709\u8d85\u8fc7\u4e0a\u5343\u4e2a\u8def\u7531\u65f6\uff0c\u5b83\u7684\u6027\u80fd\u5c31\u4f1a\u51fa\u73b0\u6bd4\u8f83\u6025\u5267\u7684\u4e0b\u964d\u3002\\n\\n\u800c APISIX \u7684\u51fa\u73b0\u5219\u89e3\u51b3\u4e86\u4e0a\u8ff0\u6240\u6709\u95ee\u9898\uff0c\u6210\u4e3a\u4e86\u4e91\u539f\u751f\u65f6\u4ee3\u6700\u5b8c\u7f8e\u7684 API \u7f51\u5173\u3002\u90a3\u4e48 Apache APISIX \u7684\u4f18\u52bf\u5230\u5e95\u662f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u5728\u77ed\u77ed\u4e09\u5e74\u7684\u65f6\u95f4\u91cc\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u7f51\u5173\uff1f\\n\\n## APISIX \u7684\u4f18\u52bf\\n\\n### \u4f18\u5f02\u7684\u67b6\u6784\\n\\n\u9996\u5148 Apache APISIX \u62e5\u6709\u4f18\u5f02\u7684\u67b6\u6784\uff0c\u73b0\u5728\u5f88\u591a\u5e94\u7528\u90fd\u5728\u5411\u5fae\u670d\u52a1\u3001\u5bb9\u5668\u5316\u8fc1\u79fb\uff0c\u5f62\u6210\u65b0\u7684\u4e91\u539f\u751f\u65f6\u4ee3\u3002\u4e91\u539f\u751f\u4f5c\u4e3a\u5f53\u4e0b\u7684\u6280\u672f\u6f6e\u6d41\uff0c\u5c06\u91cd\u5199\u4f20\u7edf\u4f01\u4e1a\u7684\u6280\u672f\u67b6\u6784\u3002\u800c APISIX \u81ea\u8bde\u751f\u4e4b\u521d\u5c31\u8ddf\u968f\u6280\u672f\u6f6e\u6d41\uff0c\u5e76\u5c06\u5176\u8bbe\u8ba1\u4e3a\u4e91\u539f\u751f\u67b6\u6784\uff1a\\n\\n![APISIX](https://static.apiseven.com/2022/blog/0729/1.png)\\n\\n\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5de6\u53f3\u5206\u522b\u662f APISIX \u7684\u6570\u636e\u9762\uff08Data Plane\uff09\u548c\u63a7\u5236\u9762\uff08Control Plane\uff09\uff1a\\n\\n- \u6570\u636e\u9762\uff1a\u4ee5 NGINX \u7684\u7f51\u7edc\u5e93\u4e3a\u57fa\u7840\uff08\u672a\u4f7f\u7528 NGINX \u7684\u8def\u7531\u5339\u914d\u3001\u9759\u6001\u914d\u7f6e\u548c C \u6a21\u5757\uff09\uff0c\u4f7f\u7528Lua \u548c NGINX \u52a8\u6001\u63a7\u5236\u8bf7\u6c42\u6d41\u91cf\uff1b\\n- \u63a7\u5236\u9762\uff1a\u4f7f\u7528 etcd \u6765\u5b58\u50a8\u548c\u540c\u6b65\u7f51\u5173\u7684\u914d\u7f6e\u6570\u636e\uff0c\u7ba1\u7406\u5458\u901a\u8fc7 Admin API \u6216\u8005 Dashboard \u53ef\u4ee5\u5728\u6beb\u79d2\u7ea7\u522b\u5185\u901a\u77e5\u5230\u6240\u6709\u6570\u636e\u9762\u8282\u70b9\u3002\\n\\n\u5728\u66f4\u65b0\u6570\u636e\u4e0a\uff0cKong \u91c7\u7528\u8f6e\u8be2\u6570\u636e\u5e93\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u53ef\u80fd\u9700\u8981 5-10 \u79d2\u624d\u80fd\u83b7\u53d6\u5230\u6700\u65b0\u7684\u914d\u7f6e\uff1b\u800c APISIX \u5219\u91c7\u7528\u76d1\u542c etcd \u7684\u914d\u7f6e\u53d8\u66f4\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5c06\u65f6\u95f4\u63a7\u5236\u5728\u6beb\u79d2\u7ea7\uff0c\u8fbe\u5230\u5b9e\u65f6\u751f\u6548\u7684\u6548\u679c\u3002\\n\u800c\u4e14\u7531\u4e8e APISIX \u548c etcd \u5747\u652f\u6301\u591a\u70b9\u90e8\u7f72\uff0c\u56e0\u6b64\u5728 APISIX \u5f53\u524d\u67b6\u6784\u4e2d\uff0c\u4efb\u4f55\u4e00\u4e2a\u670d\u52a1\u51fa\u73b0\u5f02\u5e38\u5b95\u673a\u7b49\u4e8b\u6545\uff0c\u90fd\u4e0d\u4f1a\u5f71\u54cd APISIX \u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\u80fd\u529b\u3002\\n\\n### \u5b8c\u5584\u7684\u751f\u6001\\n\\n\u4e0b\u56fe\u4e3a APISIX \u7684\u751f\u6001\u56fe\uff0c\u4ece\u8be5\u56fe\u53ef\u4ee5\u51c6\u786e\u770b\u5230 APISIX \u5df2\u7ecf\u652f\u6301\u7684 7 \u5c42\u534f\u8bae\u6709 HTTP(S)\u3001HTTP2\u3001Dubbo \u548c\u7269\u8054\u7f51\u534f\u8bae MQTT \u7b49\u7b49\uff0c4 \u5c42\u534f\u8bae\u6709 TCP/UDP\u3002\\n\u53f3\u4fa7\u90e8\u5206\u5219\u662f\u4e00\u4e9b\u5f00\u6e90\u6216\u8005 SaaS \u670d\u52a1\uff0c\u6bd4\u5982 SkyWalking\u3001Prometheus \u3001Vault \u7b49\u7b49\u3002\u800c\u6700\u4e0b\u9762\u5219\u662f\u6bd4\u8f83\u5e38\u89c1\u7684\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u3001\u4e91\u5382\u5546\u548c\u786c\u4ef6\u73af\u5883\u3002\u800c\u4f5c\u4e3a\u4e00\u4e2a\u5f00\u6e90\u8f6f\u4ef6\uff0cAPISIX \u4e5f\u652f\u6301\u5728 ARM64 \u7684\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u3002\\n\\n![APISIX\'s Ecosystem](https://static.apiseven.com/2022/blog/0729/2.PNG)\\n\\nAPISIX \u4e0d\u4ec5\u652f\u6301\u4f17\u591a\u534f\u8bae\u4e0e\u64cd\u4f5c\u7cfb\u7edf\uff0c\u800c\u4e14\u4e5f\u652f\u6301\u591a\u8bed\u8a00\u7f16\u7a0b\u63d2\u4ef6\u3002APISIX \u8bde\u751f\u4e4b\u521d\u4ec5\u652f\u6301\u4f7f\u7528 Lua \u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u9700\u8981\u5f00\u53d1\u8005\u638c\u63e1 Lua \u548c NGINX \u76f8\u5173\u7684\u6280\u672f\u6808\u3002\u7136\u800c Lua \u548c NGINX \u5c5e\u4e8e\u76f8\u5bf9\u5c0f\u4f17\u7684\u6280\u672f\uff0c\u5f00\u53d1\u8005\u5f88\u5c11\u3002\u56e0\u6b64\u6211\u4eec\u5728 APISIX \u4e0a\u652f\u6301\u4e86\u591a\u8bed\u8a00\u5f00\u53d1\u63d2\u4ef6\uff0c\u76ee\u524d\u5df2\u7ecf\u6b63\u5f0f\u652f\u6301\u4e86 Java\u3001Golang\u3001Node.js\u3001Python \u7b49\u8bed\u8a00\u3002\\n\\n![programming language](https://static.apiseven.com/2022/blog/0729/3.png)\\n\\n### \u6d3b\u8dc3\u7684\u793e\u533a\\n\\n\u4e0b\u56fe\u662f\u8d21\u732e\u8005\u589e\u957f\u66f2\u7ebf\uff0c\u5176\u4e2d\u6a2a\u5750\u6807\u4ee3\u8868\u65f6\u95f4\u7ebf\uff0c\u7eb5\u5750\u6807\u4ee3\u8868\u8d21\u732e\u8005\u603b\u6570\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230 APISIX \u548c Kong \u8fd9\u4e24\u4e2a\u9879\u76ee\u76f8\u5bf9\u66f4\u6d3b\u8dc3\uff0cAPISIX \u7684\u589e\u957f\u901f\u5ea6\u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4fdd\u6301\u7740\u975e\u5e38\u4e0d\u9519\u7684\u589e\u957f\u7387\uff0c\u5728\u4ee5\u63a5\u8fd1 Kong \u4e24\u500d\u7684\u901f\u5ea6\u5feb\u901f\u6210\u957f\uff0c\u5e76\u4e14\u8d21\u732e\u8005\u6570\u91cf\u5df2\u7ecf\u8fdc\u8fdc\u8d85\u8fc7\u4e86 Kong\uff0c\u7531\u6b64\u53ef\u89c1 APISIX \u53d7\u6b22\u8fce\u7a0b\u5ea6\u3002\u5f53\u7136\u8bc4\u4ef7\u4e00\u4e2a\u9879\u76ee\u6d3b\u8dc3\u5ea6\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u65b9\u6cd5\uff0c\u6bd4\u5982\u67e5\u770b\u6bcf\u6708\u6d3b\u8dc3 Issue\u3001PR \u603b\u6570\u7b49\u65b9\u5f0f\uff0c\u503c\u5f97\u9ad8\u5174\u7684\u662f APISIX \u5728\u8fd9\u4e9b\u65b9\u9762\u4e5f\u662f\u4e00\u9a91\u7edd\u5c18\u3002\\n\\n![Contributor graph](https://static.apiseven.com/2022/blog/0729/4.png)\\n\\n## APISIX \u7684\u5e94\u7528\u573a\u666f\\n\\n\u4ece\u4e0b\u56fe\u4e2d\uff0c\u76f8\u4fe1\u4f60\u5df2\u7ecf\u770b\u51fa APISIX \u7684\u76ee\u6807\uff1a**\u7edf\u4e00\u4ee3\u7406\u57fa\u7840\u8bbe\u65bd**\u3002\\n\\n![APISIX Application scenarios](https://static.apiseven.com/2022/blog/0729/5.png)\\n\\n\u4e5f\u8bb8\u4f60\u4f1a\u6709\u7591\u95ee\uff1aAPISIX \u8981\u652f\u6301\u8fd9\u4e48\u591a\u573a\u666f\uff0c\u662f\u5426\u4f1a\u8ba9 APISIX \u53d8\u5f97\u56db\u4e0d\u50cf\uff1f\\n\\n\u56e0\u4e3a APISIX \u7684\u6838\u5fc3\u662f\u9ad8\u6027\u80fd\u4ee3\u7406\u670d\u52a1\uff0c\u81ea\u8eab\u4e0d\u7ed1\u5b9a\u4efb\u4f55\u73af\u5883\u5c5e\u6027\u3002\u5f53\u5b83\u6f14\u53d8\u4e3a Ingress\u3001\u670d\u52a1\u7f51\u683c\u7b49\u4ea7\u54c1\u65f6\uff0c\u90fd\u662f\u5916\u90e8\u670d\u52a1\u4e0e APISIX \u914d\u5408\uff0c\u53d8\u5316\u7684\u662f\u5916\u90e8\u7a0b\u5e8f\u800c\u4e0d\u662f APISIX \u81ea\u8eab\uff0c\u4e0b\u9762\u5c06\u9010\u6b65\u4e3a\u5927\u5bb6\u4ecb\u7ecd APISIX \u662f\u5982\u4f55\u652f\u6301\u8fd9\u4e9b\u573a\u666f\u7684\u3002\\n\\n### Load Balancer \u548c API \u7f51\u5173\\n\\n\u9996\u5148\u662f\u9488\u5bf9\u4f20\u7edf\u7684 LB \u548c API \u7f51\u5173\u573a\u666f\uff0c\u56e0\u4e3a APISIX \u57fa\u4e8e NGINX + LuaJIT \u5b9e\u73b0\uff0c\u6240\u4ee5\u5929\u7136\u5177\u5907\u9ad8\u6027\u80fd\u3001\u5b89\u5168\u7b49\u7279\u6027\uff0c\u5e76\u4e14\u539f\u751f\u652f\u6301\u4e86\u52a8\u6001 SSL \u8bc1\u4e66\u5378\u8f7d\u3001SSL \u63e1\u624b\u4f18\u5316\u7b49\u529f\u80fd\uff0c\u5728\u8d1f\u8f7d\u5747\u8861\u7684\u670d\u52a1\u80fd\u529b\u4e0a\u4e5f\u66f4\u4f18\u79c0\u3002\u4ece NGINX \u5207\u6362\u5230 APISIX \u4e0d\u4ec5\u6027\u80fd\u4e0d\u4f1a\u4e0b\u964d\uff0c\u800c\u4e14\u53ef\u4ee5\u4eab\u53d7\u5230\u52a8\u6001\u3001\u7edf\u4e00\u7ba1\u7406\u7b49\u7279\u6027\u5e26\u6765\u7684\u7ba1\u7406\u6548\u7387\u7684\u63d0\u5347\u3002\\n\\n### \u5fae\u670d\u52a1\u7f51\u5173\\n\\nAPISIX \u76ee\u524d\u652f\u6301\u591a\u79cd\u8bed\u8a00\u7f16\u5199\u6269\u5c55\u63d2\u4ef6\uff0c\u53ef\u4ee5\u89e3\u51b3\u4e1c\u897f\u5411\u5fae\u670d\u52a1 API \u7f51\u5173\u9762\u4e34\u7684\u4e3b\u8981\u95ee\u9898\u2014\u2014\u5f02\u6784\u591a\u8bed\u8a00\u548c\u901a\u7528\u95ee\u9898\u3002\u5185\u7f6e\u652f\u6301\u7684\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u6709 Nacos\u3001etcd\u3001Eureka \u7b49\uff0c\u8fd8\u6709\u6807\u51c6\u7684 DNS \u65b9\u5f0f\uff0c\u53ef\u4ee5\u5e73\u6ed1\u66ff\u4ee3 Zuul\u3001Spring Cloud Gateway\u3001Dubbo \u7b49\u5fae\u670d\u52a1 API \u7f51\u5173\u3002\\n\\n### Kubernetes Ingress\\n\\n\u76ee\u524d K8s \u5b98\u65b9 Kubernetes Ingress Controller \u9879\u76ee\u4e3b\u8981\u57fa\u4e8e NGINX \u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u5f0f\uff0c\u6240\u4ee5\u5728\u8def\u7531\u80fd\u529b\u548c\u52a0\u8f7d\u6a21\u5f0f\u4e0a\u7a0d\u663e\u4e0d\u8db3\uff0c\u5e76\u4e14\u5b58\u5728\u4e00\u4e9b\u660e\u663e\u52a3\u52bf\u3002\u6bd4\u5982\u6dfb\u52a0\u3001\u4fee\u6539\u4efb\u4f55 API \u65f6\uff0c\u9700\u8981\u91cd\u542f\u670d\u52a1\u624d\u80fd\u5b8c\u6210\u65b0 NGINX \u914d\u7f6e\u7684\u66f4\u65b0\uff0c\u4f46\u91cd\u542f\u670d\u52a1\uff0c\u5bf9\u7ebf\u4e0a\u6d41\u91cf\u7684\u5f71\u54cd\u662f\u975e\u5e38\u5927\u7684\u3002\\n\\n\u800c [APISIX Ingress Controller](https://apisix.apache.org/zh/docs/ingress-controller/getting-started/) \u5219\u5b8c\u7f8e\u89e3\u51b3\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u6240\u6709\u95ee\u9898\uff1a\u652f\u6301\u5168\u52a8\u6001\uff0c\u65e0\u9700\u91cd\u542f\u52a0\u8f7d\u3002\u540c\u65f6\u7ee7\u627f\u4e86 APISIX \u7684\u6240\u6709\u4f18\u52bf\uff0c\u8fd8\u652f\u6301\u539f\u751f Kubernetes CRD\uff0c\u65b9\u4fbf\u7528\u6237\u8fc1\u79fb\u3002\\n\\n![APISIX Kubernetes Ingress](https://static.apiseven.com/2022/blog/0729/6.png)\\n\\n### \u670d\u52a1\u7f51\u683c\\n\\n\u672a\u6765\u4e94\u5230\u5341\u5e74\uff0c\u57fa\u4e8e\u4e91\u539f\u751f\u6a21\u5f0f\u67b6\u6784\u4e0b\u7684\u670d\u52a1\u7f51\u683c\u67b6\u6784\u5f00\u59cb\u5d2d\u9732\u5934\u89d2\u3002APISIX \u4e5f\u63d0\u524d\u5f00\u59cb\u9501\u5b9a\u8d5b\u9053\uff0c\u901a\u8fc7\u8c03\u7814\u548c\u6280\u672f\u5206\u6790\u540e\uff0cAPISIX \u5df2\u7ecf\u652f\u6301\u4e86 xDS \u534f\u8bae\uff0cAPISIX Mesh \u5c31\u6b64\u8bde\u751f\uff0c\u5728\u670d\u52a1\u7f51\u683c\u9886\u57df  APISIX \u4e5f\u62e5\u6709\u4e86\u4e00\u5e2d\u4e4b\u5730\u3002\\n\\n![APISXI Mesh](https://static.apiseven.com/2022/blog/0729/7.png)\\n\\n## \u603b\u7ed3\\n\\nApache APISIX \u81ea\u5f00\u6e90\u7b2c\u4e00\u5929\uff0c\u8fc4\u4eca\u4e3a\u6b62\u5df2\u7ecf\u6709\u4e09\u5e74\u7684\u65f6\u95f4\u4e86\uff0c\u9ad8\u6d3b\u8dc3\u5ea6\u7684\u793e\u533a\u4ee5\u53ca\u5b9e\u9645\u7684[\u7528\u6237\u6848\u4f8b](https://apisix.apache.org/zh/blog/tags/case-studies/)\u8bc1\u660e\u4e86 APISIX \u662f\u4e91\u539f\u751f\u65f6\u4ee3\u6700\u5b8c\u7f8e\u7684 API \u7f51\u5173\u3002\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u76f8\u4fe1\u4f60\u5df2\u7ecf\u5bf9 APISIX \u6709\u4e86\u66f4\u5168\u9762\u7684\u8ba4\u8bc6\uff0c\u671f\u5f85\u4f60\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528 APISIX \u4f5c\u4e3a\u4f60\u7684 API \u7f51\u5173\u3002\\n\\n\u66f4\u591a\u4fe1\u606f\u8bf7\u89c2\u770b[\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX?](https://www.bilibili.com/video/BV1w54y1V73Z?p=1&share_medium=android&share_plat=android&share_source=COPY&share_tag=s_i&timestamp=1621812452&unique_k=PEusrt)"},{"id":"Apache APISIX 2.15 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2022/07/29/release-apache-apisix-2.15","source":"@site/blog/2022/07/29/release-apache-apisix-2.15.md","title":"Apache APISIX 2.15 \u6b63\u5f0f\u53d1\u5e03","description":"API \u7f51\u5173 Apache APISIX 2.15 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b64\u7248\u672c\u65b0\u589e\u63d2\u4ef6\u76f8\u5173\u7684\u81ea\u5b9a\u4e49\u4f18\u5148\u7ea7\u3001\u6267\u884c\u7b56\u7565\u3001\u9519\u8bef\u54cd\u5e94\u53ca\u652f\u6301\u76d1\u63a7\u56db\u5c42\u6d41\u91cf\u7684\u6307\u6807\u7b49\u529f\u80fd\u3002","date":"2022-07-29T00:00:00.000Z","formattedDate":"2022\u5e747\u670829\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":6.12,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","title":"Author","url":"https://github.com/spacewander","image_url":"https://github.com/spacewander.png","imageURL":"https://github.com/spacewander.png"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX\uff1f","permalink":"/zh/blog/2022/07/30/why-we-need-apache-apisix"},"nextItem":{"title":"Apache APISIX \u5728 API \u548c\u5fae\u670d\u52a1\u9886\u57df\u7684\u63a2\u7d22","permalink":"/zh/blog/2022/07/22/exploration-of-apisix-in-api-and-microservices"}},"content":"> Apache APISIX 2.15 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\u63d2\u4ef6\u4f18\u5148\u7ea7\u548c\u6267\u884c\u7b56\u7565\u3001\u81ea\u5b9a\u4e49\u9519\u8bef\u54cd\u5e94\u4ee5\u53ca\u652f\u6301\u76d1\u63a7\u56db\u5c42\u6d41\u91cf\u7684\u6307\u6807\u7b49\u529f\u80fd\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4ece\u4e24\u5e74\u524d\u53d1\u5e03\u7b2c\u4e00\u4e2a 2.0 \u7248\u672c\u5f00\u59cb\uff0cAPISIX \u5df2\u7ecf\u53d1\u5e03\u4e86 15 \u4e2a minor \u7248\u672c\u548c\u8bb8\u591a\u4e2a patch \u7248\u672c\u3002\u4f5c\u4e3a 2.x \u7cfb\u5217\u6700\u540e\u7684\u4e00\u4e2a minor \u7248\u672c\uff0c2.15 \u7248\u672c\u53ef\u4ee5\u8bf4\u662f\u4e2a\u627f\u4e0a\u542f\u4e0b\u7684\u7248\u672c\u3002\\n\\n\u300c\u627f\u4e0a\u300d\u662f\u56e0\u4e3a\u8be5\u7248\u672c\u7ee7\u7eed\u5f15\u5165\u4e86\u66f4\u591a\u7684\u529f\u80fd\uff0c\u4f7f\u5f97\u63d2\u4ef6\u914d\u7f6e\u66f4\u52a0\u7075\u6d3b\uff1b\u300c\u542f\u4e0b\u300d\u5219\u662f\u56e0\u4e3a\u8be5\u7248\u672c\u5c06\u4f1a\u662f 2.x \u7248\u672c\u7684\u6700\u540e\u4e00\u4e2a LTS \u7248\u672c\uff0c\u540e\u7eed APISIX \u5c31\u8981\u5411 3.0 \u7248\u672c\u8fdb\u53d1\u4e86\u3002\u66f4\u591a\u7ec6\u8282\u4e00\u8d77\u6765\u770b\u4e0b\u6587\u5427\uff01\\n\\n![\u66f4\u65b0\u6c47\u603b](https://static.apiseven.com/2022/blog/0729/blog-1.png)\\n\\n## \u81ea\u5b9a\u4e49\u63d2\u4ef6\u4f18\u5148\u7ea7\\n\\n\u65b0\u7248\u672c\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684\u4f18\u5148\u7ea7\uff0c\u800c\u975e\u76f4\u63a5\u5e94\u7528\u63d2\u4ef6\u9ed8\u8ba4\u7684\u4f18\u5148\u7ea7\u5c5e\u6027\u3002\\n\\n\u6709\u4e86\u8fd9\u4e2a\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u67d0\u4e2a\u7279\u5b9a\u7684\u8def\u7531\u4e0a\u8c03\u6574\u67d0\u51e0\u4e2a\u63d2\u4ef6\u7684\u6267\u884c\u987a\u5e8f\uff0c\u4ece\u800c\u6253\u7834\u4e4b\u524d\u63d2\u4ef6\u4f18\u5148\u7ea7\u5c5e\u6027\u7684\u675f\u7f1a\u3002\\n\\n\u4f8b\u5982\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c`serverless-post-function` \u63d2\u4ef6\u662f\u5728 `serverless-pre-function` \u63d2\u4ef6\u4e4b\u540e\u6267\u884c\u7684\u3002\u4f46\u662f\u901a\u8fc7\u6b64\u529f\u80fd\uff0c\u53ef\u4ee5\u8ba9 `serverless-post-function` \u63d2\u4ef6\u4f18\u5148\u6267\u884c\u3002\u914d\u7f6e\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```json\\n {\\n    \\"serverless-post-function\\": {\\n        \\"_meta\\": {\\n            \\"priority\\": 10000\\n        },\\n        \\"phase\\": \\"rewrite\\",\\n        \\"functions\\" : [\\"return function(conf, ctx)\\n                    ngx.say(\\\\\\"serverless-post-function\\\\\\");\\n                    end\\"]\\n    },\\n    \\"serverless-pre-function\\": {\\n        \\"_meta\\": {\\n            \\"priority\\": -2000\\n        },\\n        \\"phase\\": \\"rewrite\\",\\n        \\"functions\\": [\\"return function(conf, ctx)\\n                    ngx.say(\\\\\\"serverless-pre-function\\\\\\");\\n                    end\\"]\\n    }\\n}\\n```\\n\\n:::note \u6ce8\u610f\\n\\n\u5982\u679c\u4e00\u4e2a\u63d2\u4ef6\u914d\u7f6e\u4e2d\u6ca1\u6709\u6ce8\u660e\u4f18\u5148\u7ea7\uff0c\u5219\u4f1a\u6839\u636e\u63d2\u4ef6\u4ee3\u7801\u4e2d\u7684\u4f18\u5148\u7ea7\u5c5e\u6027\u503c\u8fdb\u884c\u6392\u5e8f\u3002\\n\\n\u5982\u679c\u4f60\u5728 Service \u6216\u8005 Plugin Config \u7684\u63d2\u4ef6\u914d\u7f6e\u4e2d\u6307\u5b9a\u4e86\u63d2\u4ef6\u7684\u4f18\u5148\u7ea7\uff0c\u90a3\u4e48\u5728\u5408\u5e76\u5230\u8def\u7531\u540e\u4f9d\u7136\u751f\u6548\u3002\\n\\n:::\\n\\n## \u81ea\u5b9a\u4e49\u63d2\u4ef6\u662f\u5426\u6267\u884c\\n\\n\u9664\u4e86\u80fd\u591f\u8c03\u6574\u6267\u884c\u987a\u5e8f\u5916\uff0c\u8fd8\u53ef\u4ee5\u52a8\u6001\u51b3\u5b9a\u63d2\u4ef6\u662f\u5426\u9700\u8981\u6267\u884c\u30022.15 \u7248\u672c\u4e2d\u5f15\u5165\u4e86\u63d2\u4ef6\u914d\u7f6e\u7ea7\u522b\u7684\u8fc7\u6ee4\u5668\uff0c\u7531\u8fc7\u6ee4\u5668\u7684\u6267\u884c\u7ed3\u679c\u63a7\u5236\u63d2\u4ef6\u6267\u884c\u4e0e\u5426\u3002\\n\\n\u4e0b\u65b9\u914d\u7f6e\u4e2d\uff0c\u53ea\u6709\u53d8\u91cf `$status` \u5927\u4e8e\u6216\u7b49\u4e8e 400 \u65f6\uff0c\u624d\u4f1a\u6267\u884c `http-logger` \u63d2\u4ef6\u3002\u8fd9\u4e48\u4e00\u6765\uff0c\u53ea\u6709 4xx \u548c 5xx \u7684\u8bf7\u6c42\u624d\u4f1a\u88ab\u62a5\u544a\u5230\u8fdc\u7aef\u7684 HTTP \u65e5\u5fd7\u670d\u52a1\u5668\u4e0a\u3002\\n\\n```json\\n{\\n    \\"http-logger\\": {\\n        \\"_meta\\": {\\n            \\"filter\\": {\\n                {\\"status\\", \\"!\\", \\"<\\", \\"400\\"}\\n            }\\n        },\\n        ...\\n    }\\n}\\n```\\n\\n\u540c\u65f6\uff0c\u501f\u52a9 APISIX \u7684\u53e6\u4e00\u4e2a\u529f\u80fd[\u81ea\u5b9a\u4e49\u53d8\u91cf](https://apisix.apache.org/zh/docs/apisix/next/plugin-develop/#%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F)\uff0c\u5219\u53ef\u4ee5\u73a9\u51fa\u66f4\u591a\u82b1\u6837\u3002\u6bd4\u5982\u5ba2\u6237\u7aef\u5730\u5740\u4e3a\u5185\u7f51\u5730\u5740\uff0c\u5219\u8df3\u8fc7\u67d0\u4e2a Logger \u4e4b\u7c7b\u7684\u573a\u666f\u3002\\n\\n## \u81ea\u5b9a\u4e49\u9519\u8bef\u54cd\u5e94\\n\\n\u8be5\u529f\u80fd\u4e5f\u662f\u5728\u5177\u4f53\u63d2\u4ef6\u5c42\u9762\u914d\u7f6e\u7684\u65b0\u529f\u80fd\uff0c\u5c5e\u4e8e\u63d2\u4ef6\u914d\u7f6e\u7ea7\u522b\u4e0a\u7684\u9519\u8bef\u4fe1\u606f\u3002\\n\\n\u5982\u679c\u9700\u6c42\u65b9\u5bf9\u7279\u5b9a\u8def\u7531\u4e0a\u7684\u9519\u8bef\u54cd\u5e94\u6709\u6240\u8981\u6c42\uff0c\u90a3\u4e48\u8fd9\u4e00\u529f\u80fd\u5c31\u80fd\u6d3e\u4e0a\u7528\u573a\u4e86\u3002\u65e0\u8bba\u662f\u4ec0\u4e48\u63d2\u4ef6\uff0c\u901a\u8fc7\u8be5\u914d\u7f6e\u90fd\u80fd\u8bbe\u7f6e\u4e00\u4e2a\u56fa\u5b9a\u7684\u54cd\u5e94\u7ed3\u679c\uff0c\u907f\u514d\u56e0\u4e3a\u63d2\u4ef6\u5185\u7f6e\u7684\u9519\u8bef\u54cd\u5e94\u4fe1\u606f\u800c\u5e26\u6765\u56f0\u6270\u3002\\n\\n\u5982\u4e0b\u8ff0\u914d\u7f6e\u6240\u793a\uff0c\u4e0d\u7ba1 `jwt-auth` \u63d2\u4ef6\u8fd4\u56de\u4e86\u4ec0\u4e48\u9519\u8bef\u4fe1\u606f\uff0c\u90fd\u4f1a\u88ab\u6539\u5199\u6210 \\"Missing credential in request\\" \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\\n\\n```json\\n{\\n    \\"jwt-auth\\": {\\n        \\"_meta\\": {\\n            \\"error_response\\": {\\n                \\"message\\": \\"Missing credential in request\\"\\n            }\\n        }\\n    }\\n}\\n```\\n\\n## \u5141\u8bb8\u91c7\u96c6 Stream Route \u4e0a\u7684\u6307\u6807\\n\\n\u672c\u7248\u672c\u4e2d\u8fd8\u8fdb\u884c\u4e86\u4e00\u4e2a\u8f83\u5927\u7684\u6539\u52a8\uff0c\u5c31\u662f\u5141\u8bb8\u5728 Stream Route \u4e0a\u91c7\u96c6 metrics \u7684\u6307\u6807\uff0c\u5e76\u901a\u8fc7 Prometheus \u7684\u63a5\u53e3\u66b4\u9732\u51fa\u6765\u3002\\n\\n\u8be5\u529f\u80fd\u9ed8\u8ba4\u4e3a\u5173\u95ed\u72b6\u6001\uff0c\u5982\u679c\u9700\u8981\u542f\u7528\uff0c\u8bf7\u5728 [APISIX-Base](https://apisix.apache.org/zh/docs/apisix/FAQ/#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA-apisix-base-%E7%8E%AF%E5%A2%83) \u7248\u672c\u4e0a\u6784\u5efa APISIX\uff0c\u5e76\u5728 `config.yaml` \u4e2d\u542f\u7528 `prometheus` \u63d2\u4ef6\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```yaml  title=\\"./conf/config.yaml\\"\\nstream_plugins:\\n  - ...\\n  - prometheus\\n```\\n\\n\u5728\u542f\u7528\u8be5\u63d2\u4ef6\u540e\uff0c\u5373\u4f7f\u53ea\u7528 APISIX \u6765\u4ee3\u7406\u56db\u5c42\u4e0a\u7684 TCP \u6d41\u91cf\uff0c\u4e5f\u4f1a\u4e13\u95e8\u76d1\u542c 9091 \u7684\u7aef\u53e3\uff0c\u54cd\u5e94 Prometheus \u53d1\u6765\u7684 HTTP \u8bf7\u6c42\u3002\\n\\n\u8ddf HTTP \u4ee3\u7406\u5b50\u7cfb\u7edf\u90e8\u5206\u7684 `prometheus` \u63d2\u4ef6\u4e00\u6837\uff0c\u4e0b\u4e00\u6b65\u5219\u662f\u5728\u9700\u8981\u91c7\u96c6\u6307\u6807\u7684 Stream Route \u4e0a\u914d\u7f6e\u8be5\u63d2\u4ef6\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/stream_routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"prometheus\\":{}\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:80\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u5728\u5bf9\u8be5 Stream Route \u53d1\u8d77\u8fde\u63a5\u4e4b\u540e\uff0c\u8bbf\u95ee http://127.0.0.1:9091/apisix/prometheus/metrics \u5c31\u4f1a\u770b\u5230\u5982\u4e0b TCP \u4ee3\u7406\u7edf\u8ba1\u6570\u636e\uff1a\\n\\n```shell\\n...\\n# HELP apisix_node_info Info of APISIX node\\n# TYPE apisix_node_info gauge\\napisix_node_info{hostname=\\"desktop-2022q8f-wsl\\"} 1\\n# HELP apisix_stream_connection_total Total number of connections handled per stream route in APISIX\\n# TYPE apisix_stream_connection_total counter\\napisix_stream_connection_total{route=\\"1\\"} 1\\n```\\n\\n\u76ee\u524d\u8be5\u529f\u80fd\u53ea\u5b9e\u73b0\u4e86\u7edf\u8ba1\u8fde\u63a5\u6570\uff0c\u540e\u7eed\u8fd8\u4f1a\u6309\u9700\u52a0\u5165\u66f4\u591a\u7684\u7edf\u8ba1\u6307\u6807\u3002\\n\\n\u9664\u4e86\u666e\u901a\u7684 Stream Route \u5916\uff0c\u8be5\u7248\u672c\u4e2d\u8fd8\u7ed9 xRPC \u4e0b\u7684 Redis \u4ee3\u7406\u529f\u80fd\u63d0\u4f9b\u4e86\u7edf\u8ba1\u6307\u6807\u3002\u5982\u6309\u7167\u8def\u7531\u548c Command \u7ec6\u5206\u7684\u547d\u4ee4\u8ba1\u6570\u6307\u6807 `apisix_redis_commands_total` \u548c\u5ef6\u8fdf\u65f6\u95f4\u6307\u6807 `apisix_redis_commands_latency_seconds_bucket`\u3002\\n\\n## \u66f4\u591a\u529f\u80fd\\n\\n\u5728\u65b0\u589e\u529f\u80fd\u5c42\u9762\uff0c\u9664\u4e86\u4e0a\u8ff0\u63d0\u5230\u7684\u51e0\u4e2a\u529f\u80fd\u5916\uff0c\u6b64\u7248\u672c\u4e5f\u5305\u542b\u5f88\u591a\u7ec6\u8282\u6539\u52a8\uff1a\\n\\n* \u652f\u6301 Upstream \u5bf9\u8c61\u4ece SSL \u5bf9\u8c61\u4e2d\u5f15\u7528\u8bc1\u4e66\\n* `prometheus` \u6307\u6807\u4e2d\u63d0\u4f9b `ngx.shared.dict` \u7edf\u8ba1\u4fe1\u606f\\n* `openid-connect` \u63d2\u4ef6\u652f\u6301 PKCE \u62d3\u5c55\\n\\n\u66f4\u591a\u5177\u4f53\u53d1\u7248\u7ec6\u8282\uff0c\u8bf7\u53c2\u8003 [2.15 Changelog](https://github.com/apache/apisix/blob/release/2.15/docs/zh/latest/CHANGELOG.md#2150)\u3002"},{"id":"Apache APISIX \u5728 API \u548c\u5fae\u670d\u52a1\u9886\u57df\u7684\u63a2\u7d22","metadata":{"permalink":"/zh/blog/2022/07/22/exploration-of-apisix-in-api-and-microservices","source":"@site/blog/2022/07/22/exploration-of-apisix-in-api-and-microservices.md","title":"Apache APISIX \u5728 API \u548c\u5fae\u670d\u52a1\u9886\u57df\u7684\u63a2\u7d22","description":"Apache APISIX \u4f5c\u4e3a Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u9876\u7ea7\u9879\u76ee\uff0c\u5728\u9879\u76ee\u5feb\u901f\u53d1\u5c55\u7684\u80cc\u540e\uff0c\u8fdb\u884c\u4e86\u54ea\u4e9b\u63a2\u7d22\uff1f\u4e3a\u4ec0\u4e48\u4f1a\u5f97\u5230\u8d8a\u6765\u6108\u591a\u5f00\u53d1\u8005\u548c\u4f01\u4e1a\u7528\u6237\u7684\u9752\u7750\uff1f\u672c\u6587\u5c06\u4ece\u6280\u672f\u548c\u793e\u533a\u4e24\u4e2a\u5c42\u9762\u5e26\u6765\u8be6\u7ec6\u89e3\u8bfb\u3002","date":"2022-07-22T00:00:00.000Z","formattedDate":"2022\u5e747\u670822\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":29.1,"truncated":true,"authors":[{"name":"\u6e29\u94ed","title":"Apache APISIX PMC \u4e3b\u5e2d","url":"https://github.com/moonming","image_url":"https://avatars.githubusercontent.com/u/26448043?v=4","imageURL":"https://avatars.githubusercontent.com/u/26448043?v=4"},{"name":"\u82cf\u94b0","title":"Apache APISIX Committer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"Apache APISIX 2.15 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/07/29/release-apache-apisix-2.15"},"nextItem":{"title":"API \u7f51\u5173 APISIX \u5728\u8c37\u6b4c\u4e91 T2A \u548c T2D \u7684\u6027\u80fd\u6d4b\u8bd5","permalink":"/zh/blog/2022/07/22/how-is-google-cloud-tau-t2a-performing"}},"content":"> Apache APISIX \u4f5c\u4e3a Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u9876\u7ea7\u9879\u76ee\uff0c\u5728\u9879\u76ee\u5feb\u901f\u53d1\u5c55\u7684\u80cc\u540e\uff0c\u8fdb\u884c\u4e86\u54ea\u4e9b\u63a2\u7d22\uff1f\u4e3a\u4ec0\u4e48\u4f1a\u5f97\u5230\u8d8a\u6765\u6108\u591a\u5f00\u53d1\u8005\u548c\u4f01\u4e1a\u7528\u6237\u7684\u9752\u7750\uff1f\u672c\u6587\u5c06\u4ece\u6280\u672f\u548c\u793e\u533a\u4e24\u4e2a\u5c42\u9762\u5e26\u6765\u8be6\u7ec6\u89e3\u8bfb\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4ecb\u7ecd\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\n\u4f5c\u4e3a API \u7f51\u5173\uff0cApache APISIX \u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u5feb\u901f\u3001\u5b89\u5168\u5730\u5904\u7406 API \u548c\u5fae\u670d\u52a1\u6d41\u91cf\uff0c\u5e94\u7528\u4e8e\u7f51\u5173\u3001Kubernetes Ingress \u548c\u670d\u52a1\u7f51\u683c\u7b49\u573a\u666f\u3002\u5229\u7528 APISIX \u65e2\u53ef\u4ee5\u5904\u7406\u4ece\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u7aef\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5904\u7406\u4ece\u5404\u4e2a\u4f01\u4e1a\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\u3002\\n\\nAPISIX \u5728 2019 \u5e74 6 \u6708 6 \u53f7\u5f00\u6e90\uff0c\u540c\u5e74 10 \u6708\u4efd\u6350\u8d60\u7ed9\u4e86 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u3002\u5728\u4e4b\u540e\u4e0d\u5230\u4e00\u5e74\u7684\u65f6\u95f4\u5185\uff0c\u6bd5\u4e1a\u6210\u4e3a Apache \u9876\u7ea7\u9879\u76ee\u3002\\n\\n\u5728\u9879\u76ee\u5feb\u901f\u53d1\u5c55\u7684\u80cc\u540e\uff0cAPISIX \u5728\u6280\u672f\u4e0a\u8fdb\u884c\u4e86\u54ea\u4e9b\u63a2\u7d22\uff1f\u4e3a\u4ec0\u4e48\u4f1a\u5f97\u5230\u8d8a\u6765\u6108\u591a\u5f00\u53d1\u8005\u548c\u4f01\u4e1a\u7528\u6237\u7684\u9752\u7750\uff1f\u5728\u63a5\u4e0b\u6765\u7684\u5185\u5bb9\u4e2d\uff0c\u5c06\u4e3a\u4f60\u8bb2\u8ff0\u66f4\u591a\u7ec6\u8282\u3002\\n\\n## APISIX \u6280\u672f\u63a2\u7d22\u4e4b\u8def\\n\\n### \u6446\u8131\u6570\u636e\u5e93\u4f9d\u8d56\\n\\n\u5728 APISIX \u9879\u76ee\u95ee\u4e16\u4e4b\u524d\uff0c\u4e5f\u6709\u975e\u5e38\u591a\u7684\u5546\u4e1a API \u7f51\u5173\u6216\u5f00\u6e90 API \u7f51\u5173\u4ea7\u54c1\uff0c\u4f46\u8fd9\u4e9b\u4ea7\u54c1\u5927\u591a\u6570\u90fd\u628a API \u6570\u636e\u3001\u8def\u7531\u3001\u8bc1\u4e66\u548c\u914d\u7f6e\u7b49\u4fe1\u606f\u5b58\u653e\u5728\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u3002\\n\\n\u5b58\u653e\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u4f18\u52bf\u5176\u5b9e\u5f88\u660e\u663e\uff0c\u53ef\u4ee5\u8ba9\u7528\u6237\u66f4\u52a0\u65b9\u4fbf\u5730\u4f7f\u7528 SQL \u8bed\u53e5\u8fdb\u884c\u7075\u6d3b\u67e5\u8be2\uff0c\u65b9\u4fbf\u7528\u6237\u8fdb\u884c\u5907\u4efd\u53ca\u540e\u7eed\u7ef4\u62a4\u7b49\u73af\u8282\u3002\\n\\n\u4f46\u8fd9\u79cd\u60c5\u51b5\u4e5f\u4f1a\u989d\u5916\u5e26\u6765\u4e00\u4e2a\u95ee\u9898\u3002\u7f51\u5173\u4f5c\u4e3a\u4e00\u4e2a\u57fa\u7840\u4e2d\u95f4\u4ef6\uff0c\u5b83\u5904\u7406\u4e86\u6240\u6709\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u6d41\u91cf\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5bf9\u4e8e\u53ef\u7528\u6027\u7684\u8981\u6c42\u4fbf\u4f1a\u975e\u5e38\u9ad8\u3002\u5982\u679c\u4f60\u7684 API \u7f51\u5173\u4f9d\u8d56\u4e86\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e00\u65e6\u51fa\u73b0\u4e86\u6545\u969c\uff08\u6bd4\u5982\u5b95\u673a\u3001\u4e22\u5931\u6570\u636e\uff09\uff0c\u4f60\u7684API\u7f51\u5173\u4e5f\u4f1a\u56e0\u6b64\u53d7\u5230\u5f71\u54cd\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u7684\u6574\u4f53\u53ef\u7528\u6027\u5c31\u4f1a\u5927\u6253\u6298\u6263\u3002\\n\\n\u6240\u4ee5 APISIX \u5728\u8bbe\u8ba1\u4e4b\u521d\uff0c\u5c31\u4ece\u5e95\u5c42\u67b6\u6784\u4e0a\u907f\u514d\u4e86\u7c7b\u4f3c\u4e0a\u8ff0\u60c5\u51b5\u7684\u53d1\u751f\u3002\\n\\n![APISIX \u67b6\u6784](https://static.apiseven.com/2022/blog/0722/apisix-1.png)\\n\\nAPISIX \u7684\u67b6\u6784\u4e3b\u8981\u5206\u6210\u4e24\u90e8\u5206\u3002\u7b2c\u4e00\u90e8\u5206\u53eb\u505a\u6570\u636e\u9762\uff0c\u5b83\u662f\u771f\u6b63\u53bb\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u53bb\u5904\u7406\u7528\u6237\u7684\u771f\u5b9e\u6d41\u91cf\uff0c\u5305\u62ec\u50cf\u8eab\u4efd\u9a8c\u8bc1\u3001\u8bc1\u4e66\u5378\u8f7d\u3001\u65e5\u5fd7\u5206\u6790\u548c\u53ef\u89c2\u6d4b\u6027\u7b49\u529f\u80fd\u3002\u6570\u636e\u9762\u672c\u8eab\u5e76\u4e0d\u4f1a\u5b58\u50a8\u4efb\u4f55\u6570\u636e\uff0c\u6240\u4ee5\u5b83\u662f\u4e00\u4e2a\u65e0\u72b6\u6001\u7ed3\u6784\u3002\\n\\n\u7b2c\u4e8c\u90e8\u5206\u53eb\u505a\u63a7\u5236\u9762\u3002APISIX \u5728\u5e95\u5c42\u67b6\u6784\u4e0a\u548c\u5176\u5b83 API \u7f51\u5173\u7684\u4e00\u4e2a\u5f88\u5927\u4e0d\u540c\u5c31\u5728\u4e8e\u63a7\u5236\u9762\u3002APISIX \u5728\u63a7\u5236\u9762\u4e0a\u5e76\u6ca1\u6709\u4f7f\u7528\u4f20\u7edf\u7684\u7c7b\u4f3c\u4e8e\u50cf MySQL \u53bb\u505a\u914d\u7f6e\u5b58\u50a8\uff0c\u800c\u662f\u9009\u62e9\u4f7f\u7528 etcd\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a\\n\\n1. \u4e0e\u4ea7\u54c1\u67b6\u6784\u7684\u4e91\u539f\u751f\u6280\u672f\u4f53\u7cfb\u66f4\u7edf\u4e00\\n2. \u66f4\u8d34\u5408 API \u7f51\u5173\u5b58\u653e\u7684\u6570\u636e\u7c7b\u578b\\n3. \u80fd\u66f4\u597d\u5730\u4f53\u73b0\u9ad8\u53ef\u7528\u7279\u6027\\n4. \u62e5\u6709\u4f4e\u4e8e\u6beb\u79d2\u7ea7\u522b\u7684\u53d8\u5316\u901a\u77e5\\n\\n\u4f7f\u7528 etcd \u540e\uff0c\u5bf9\u4e8e\u6570\u636e\u9762\u800c\u8a00\u53ea\u9700\u76d1\u542c etcd \u7684\u53d8\u5316\u5373\u53ef\u3002\u5982\u679c\u8f6e\u8be2\u6570\u636e\u5e93\u7684\u8bdd\uff0c\u53ef\u80fd\u9700\u8981 5-10 \u79d2\u624d\u80fd\u83b7\u53d6\u53d6\u5230\u6700\u65b0\u7684\u914d\u7f6e\uff1b\u4f46\u5982\u679c\u76d1\u542c etcd \u7684\u914d\u7f6e\u53d8\u66f4\uff0c\u5c31\u53ef\u4ee5\u5c06\u65f6\u95f4\u63a7\u5236\u5728\u6beb\u79d2\u7ea7\u522b\u4e4b\u5185\uff0c\u8fbe\u5230\u5b9e\u65f6\u751f\u6548\u7684\u6548\u679c\u3002\\n\\n\u6240\u4ee5\u4f7f\u7528 etcd \u800c\u4e0d\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u4e0d\u4ec5\u8ba9 APISIX \u5728\u5e95\u5c42\u4e0a\u66f4\u52a0\u8d34\u5408\u4e91\u539f\u751f\uff0c\u4e5f\u8ba9\u5b83\u5728\u7cfb\u7edf\u9ad8\u53ef\u7528\u7684\u4f53\u73b0\u4e0a\u5e26\u6765\u4e86\u66f4\u591a\u4f18\u52bf\u3002\\n\\n### \u652f\u6301\u591a\u8bed\u8a00\u63d2\u4ef6\\n\\nAPI \u7f51\u5173\u5176\u5b9e\u548c\u6570\u636e\u5e93\u6216\u5176\u4ed6\u4e2d\u95f4\u4ef6\u4e0d\u592a\u4e00\u6837\uff0c\u867d\u7136\u90fd\u5c5e\u4e8e\u57fa\u7840\u7ec4\u4ef6\uff0c\u4f46\u5bf9\u4e8e\u7f51\u5173\u6765\u8bf4\uff0c\u5b83\u66f4\u591a\u4f7f\u7528\u573a\u666f\u662f\u8fdb\u884c\u4e00\u4e9b\u5b9a\u5236\u5316\u5f00\u53d1\u548c\u7cfb\u7edf\u96c6\u6210\u3002\\n\\n\u76ee\u524d APISIX \u5b98\u65b9\u867d\u7136\u6709\u975e\u5e38\u591a\u7684\u63d2\u4ef6\uff0c\u4f46\u4ecd\u96be\u4ee5\u6db5\u76d6\u7528\u6237\u7684\u6240\u6709\u4f7f\u7528\u573a\u666f\u3002\u6240\u4ee5\u5728\u771f\u5b9e\u4f7f\u7528\u573a\u666f\u4e2d\uff0c\u591a\u591a\u5c11\u5c11\u90fd\u4f1a\u9762\u5bf9\u4e1a\u52a1\u8fdb\u884c\u4e00\u4e9b\u5b9a\u5236\u5316\u7684\u63d2\u4ef6\u5f00\u53d1\u3002\u901a\u8fc7\u7f51\u5173\u53bb\u96c6\u6210\u66f4\u591a\u7684\u534f\u8bae\u6216\u8005\u7cfb\u7edf\uff0c\u6700\u7ec8\u5b9e\u73b0\u5728\u7f51\u5173\u5c42\u7684\u7edf\u4e00\u7ba1\u7406\u3002\\n\\nAPISIX \u5728\u521a\u5f00\u59cb\u53ea\u652f\u6301\u4f7f\u7528 Lua \u8bed\u8a00\u8fdb\u884c\u5f00\u53d1\u63d2\u4ef6\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u5728\u4e8e\uff0c\u901a\u8fc7\u539f\u751f\u8ba1\u7b97\u8bed\u8a00\u7684\u5e95\u5c42\u4f18\u5316\uff0c\u53ef\u4ee5\u8ba9\u5f00\u53d1\u51fa\u6765\u7684\u63d2\u4ef6\u5177\u5907\u975e\u5e38\u9ad8\u7684\u6027\u80fd\u3002\u4f46\u662f\u5b83\u7684\u52a3\u52bf\u4e5f\u975e\u5e38\u660e\u663e\uff0c\u5c31\u662f\u5b66\u4e60 Lua \u8fd9\u95e8\u65b0\u8bed\u8a00\u662f\u9700\u8981\u65f6\u95f4\u548c\u7406\u89e3\u6210\u672c\u7684\u3002\\n\\n\u4e3a\u6b64\uff0cAPISIX \u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u53bb\u89e3\u51b3\u4e86\u4e0a\u8ff0\u95ee\u9898\u3002\\n\\n\u7b2c\u4e00\u79cd\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7 Runner Plugin \u6765\u652f\u6301\u66f4\u591a\u7684\u4e3b\u6d41\u5f00\u53d1\u8bed\u8a00\uff0c\u6bd4\u5982 Java\u3001Python\u3001Go \u7b49\u3002\u5982\u679c\u4f60\u662f\u4e00\u4e2a\u540e\u7aef\u5de5\u7a0b\u5e08\uff0c\u81f3\u5c11\u5e94\u8be5\u4f1a\u5176\u4e2d\u4e00\u79cd\u8bed\u8a00\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\u4f60\u5c31\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u901a\u8fc7\u672c\u5730 RPC \u901a\u4fe1\uff0c\u4f7f\u7528\u4f60\u4e4b\u524d\u719f\u6089\u7684\u8ba1\u7b97\u8bed\u8a00\u53bb\u5f00\u53d1\u4e00\u4e2a APISIX \u63d2\u4ef6\u3002\\n\\n\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u51cf\u5c11\u4e86\u5f00\u53d1\u6210\u672c\uff0c\u63d0\u9ad8\u4e86\u5f00\u53d1\u6548\u7387\u3002\u5f53\u7136\u5f0a\u7aef\u5c31\u662f\u5728\u6027\u80fd\u5c42\u9762\u6709\u4e00\u4e9b\u635f\u5931\u3002\u90a3\u4e48\uff0c\u6709\u6ca1\u6709\u4e00\u79cd\u65e2\u80fd\u8fbe\u5230 Lua \u539f\u751f\u6027\u80fd\uff0c\u540c\u65f6\u53c8\u517c\u987e\u9ad8\u7ea7\u8bed\u8a00\u7684\u5f00\u53d1\u6548\u7387\u65b9\u6848\u5462\uff1f\\n\\n![APISIX \u591a\u8bed\u8a00\u67b6\u6784](https://static.apiseven.com/2022/blog/0722/apisix-2.png)\\n\\n\u8fd9\u91cc\u5c31\u5f15\u51fa\u4e86\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f\u4e0a\u56fe\u5de6\u4fa7\u90e8\u5206\u3002WebAssembly \u6700\u65e9\u662f\u7528\u5728\u524d\u7aef\u6216\u6d4f\u89c8\u5668\u4e0a\u7684\u4e00\u4e2a\u6280\u672f\uff0c\u5728\u670d\u52a1\u7aef\u5b83\u4e5f\u9010\u6e10\u5c55\u793a\u51fa\u6765\u5b83\u7684\u4f18\u52bf\u3002\\n\\n\u628a WebAssembly \u5d4c\u5165\u5230\u4e86 APISIX \u91cc\uff0c\u7528\u6237\u5c31\u53ef\u4ee5\u4f7f\u7528 WebAssembly \u53bb\u7f16\u8bd1\u6210 WebAssembly \u7684\u5b57\u8282\u7801\u5728 APISIX \u4e2d\u8fd0\u884c\u3002\u6700\u7ec8\u8fbe\u5230\u7684\u6548\u679c\u5c31\u662f\u5229\u7528\u9ad8\u6548\u7387\uff0c\u5f00\u53d1\u51fa\u4e86\u4e00\u4e2a\u65e2\u6709\u9ad8\u6027\u80fd\u53c8\u4f7f\u7528\u9ad8\u7ea7\u8ba1\u7b97\u8bed\u8a00\u7f16\u5199\u7684 APISIX \u63d2\u4ef6\u3002\\n\\n\u6240\u4ee5\u5728\u76ee\u524d\u7684 APISIX \u7248\u672c\u4e2d\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528 Lua\u3001Go\u3001Python \u548c Wasm \u7b49\u591a\u79cd\u65b9\u5f0f\uff0c\u57fa\u4e8e APISIX \u7f16\u5199\u81ea\u5b9a\u4e49\u4ee3\u7801\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\uff0c\u964d\u4f4e\u4e86\u5f00\u53d1\u8005\u7684\u4f7f\u7528\u95e8\u69db\uff0c\u4e5f\u4e3a APISIX \u7684\u529f\u80fd\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u53ef\u80fd\u6027\u3002\\n\\n### \u63d2\u4ef6\u70ed\u52a0\u8f7d\\n\\nAPISIX \u548c NGINX \u76f8\u6bd4\uff0c\u6709\u4e24\u5904\u975e\u5e38\u5927\u7684\u53d8\u5316\uff1aAPISIX \u652f\u6301\u96c6\u7fa4\u7ba1\u7406\u548c\u52a8\u6001\u52a0\u8f7d\u3002\\n\\n\u5982\u679c\u5927\u5bb6\u4f7f\u7528\u8fc7 NGINX\uff0c\u5c31\u77e5\u9053\u5b83\u7684\u6240\u6709\u914d\u7f6e\u90fd\u4f1a\u5199\u5728 nginx.conf \u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d\u3002\u5982\u679c\u60f3\u8981\u8fdb\u884c\u96c6\u7fa4\u63a7\u5236\uff0c\u5c31\u9700\u8981\u4e00\u53f0\u53f0\u53bb\u4fee\u6539\u5b83\u7684 nginx.conf \u6587\u4ef6\u3002\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u4e00\u4e2a\u96c6\u4e2d\u5316\u7ba1\u7406\u7684\u63a7\u5236\u5e73\u9762\uff0c\u6bcf\u4e00\u4e2a NGINX \u90fd\u662f\u4e00\u4e2a\u6570\u636e\u9762+\u63a7\u5236\u9762\u7684\u6df7\u5408\u4f53\u3002\u5982\u679c\u6b64\u65f6\u4f60\u6709\u51e0\u5341\u53f0\u51e0\u767e\u53f0 NGINX\uff0c\u5b83\u7684\u7ba1\u7406\u6210\u672c\u5c31\u4f1a\u7279\u522b\u9ad8\u3002\\n\\n\u5728\u4e0a\u8ff0\u573a\u666f\u4e2d\uff0c\u4fee\u6539\u5b8c\u6bcf\u53f0 NGINX \u7684 nginx.conf \u6587\u4ef6\u540e\uff0c\u90fd\u9700\u8981\u91cd\u542f\u624d\u80fd\u751f\u6548\u3002\u6bd4\u5982\u8fdb\u884c\u8bc1\u4e66\u66f4\u65b0\u6216\u8005\u4e0a\u6e38\u53d8\u66f4\uff0c\u90fd\u9700\u8981\u5148\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u542f\u751f\u6548\u3002\u5982\u679c\u4f60\u7684\u8bf7\u6c42\u4e0d\u662f\u7279\u522b\u591a\uff0c\u90a3\u4e48\u8fd9\u79cd\u65b9\u6cd5\u52c9\u5f3a\u8fd8\u80fd\u63a5\u53d7\u3002\u4f46\u968f\u7740\u8d8a\u6765\u8d8a\u591a API \u548c\u5fae\u670d\u52a1\u7684\u8c03\u7528\uff0c\u5982\u679c\u6bcf\u6b21\u4fee\u6539\u90fd\u8fdb\u884c\u91cd\u542f\uff0c\u8fd9\u5bf9\u4e8e\u5ba2\u6237\u7aef\u7684\u6ce2\u52a8\u5176\u5b9e\u4f1a\u975e\u5e38\u5927\u3002\\n\\n![\u52a8\u6001\u52a0\u8f7d\u5217\u8868](https://static.apiseven.com/2022/blog/0722/apisix-6.png)\\n\\n\u4e0a\u56fe\u4e2d\u5217\u51fa\u6765\u4e86 APISIX \u76ee\u524d\u5728\u54ea\u4e9b\u7ec4\u4ef6\u4e2d\u5b9e\u73b0\u4e86\u52a8\u6001\u52a0\u8f7d\uff0c\u4ece\u8fd9\u4e2a\u5217\u8868\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4ece\u4e0a\u6e38\u5230\u8bc1\u4e66\uff0c\u751a\u81f3\u63d2\u4ef6\u672c\u8eab\uff0c\u5b83\u7684\u4ee3\u7801\u90fd\u662f\u5b9e\u65f6\u751f\u6548\u7684\u3002\u90a3\u4e48\u5176\u5b9e\u5728\u793e\u533a\u91cc\u9762\u5c31\u4f1a\u6709\u4eba\u95ee\u5230\uff0c\u4ed6\u53ef\u4ee5\u7406\u89e3\u4e0a\u6e38\u3001\u8bc1\u4e66\u8fd9\u4e9b\u662f\u52a8\u6001\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u4f1a\u7ecf\u5e38\u53d8\u5316\uff0c\u4f46\u4e3a\u4ec0\u4e48\u63d2\u4ef6\u7684\u4fee\u6539\u4e5f\u8981\u505a\u6210\u52a8\u6001\u7684\u5462\uff1f\u56e0\u4e3a\u63d2\u4ef6\u7684\u4fee\u6539\u5e76\u4e0d\u662f\u4e00\u4e2a\u7279\u522b\u9891\u7e41\u7684\u64cd\u4f5c\uff0c\u6ca1\u6709\u5fc5\u8981\u505a\u6210\u4e00\u4e2a\u6781\u81f4\u7684\u52a8\u6001\u3002\\n\\n\u5bf9\u4e8e APISIX \u7684\u5e95\u5c42\u8bbe\u8ba1\u5de5\u7a0b\u5e08\u6765\u8bf4\uff0c\u6211\u4eec\u5e0c\u671b\u5b83\u53ef\u4ee5\u505a\u5230\u4e00\u4e2a\u6781\u81f4\u7684\u52a8\u6001\u3002\u56e0\u4e3a\u6781\u81f4\u52a8\u6001\u5e26\u6765\u4e86\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u4f18\u52bf\u5c31\u662f\u589e\u52a0\u4e86\u66f4\u591a\u53ef\u80fd\u6027\u3002\u6bd4\u5982\u8bf4\u7528\u6237\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u4efb\u4f55\u63d2\u4ef6\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u5df2\u6709\u4ee3\u7801\u8fdb\u884c\u6545\u969c\u6392\u67e5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u5b58\u5728\u8c03\u8bd5\u63d2\u4ef6\u7684\u4fee\u6539\u3002\u90a3\u4e48\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u5c31\u53ef\u4ee5\u4e0d\u7528\u91cd\u542f\uff0c\u7ee7\u800c\u968f\u65f6\u590d\u73b0\u95ee\u9898\u5e76\u8bb0\u5f55\u3002\u8fd9\u79cd\u8c03\u8bd5\u529f\u80fd\u7684\u63d2\u4ef6\u914d\u5408\u63d2\u4ef6\u70ed\u52a0\u8f7d\u7684\u673a\u5236\u540e\uff0c\u5c31\u4f1a\u53d8\u5f97\u975e\u5e38\u7075\u6d3b\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u5728\u6392\u67e5\u95ee\u9898\u7684\u8fc7\u7a0b\u4e2d\u7701\u65f6\u7701\u529b\u3002\\n\\n### \u63d2\u4ef6\u52a8\u6001\u7f16\u6392\\n\\n\u9664\u4e86\u4e0a\u8ff0\u63d0\u5230\u7684\u63d2\u4ef6\u70ed\u52a0\u8f7d\uff0cAPISIX \u5728\u63d2\u4ef6\u548c\u63d2\u4ef6\u4e4b\u95f4\u4e5f\u652f\u6301\u5b9e\u65f6\u7684\u52a8\u6001\u7f16\u6392\uff0c\u52a8\u6001\u7f16\u6392\u4e5f\u4e3a\u63d2\u4ef6\u7684\u8fd0\u884c\u5e26\u6765\u4e86\u65e0\u9650\u53ef\u80fd\u3002\\n\\n\u4ec0\u4e48\u53eb\u63d2\u4ef6\u7f16\u6392\uff1f\u6211\u4eec\u5728\u63d0\u51fa\u5404\u79cd\u5404\u6837\u7684\u9700\u6c42\u65f6\uff0c\u66f4\u591a\u662f\u5e0c\u671b\u53ef\u4ee5\u628a\u4e00\u4e2a\u9700\u6c42\u53d8\u6210\u4e00\u4e2a\u63d2\u4ef6\uff0c\u5c31\u50cf\u73a9\u4e50\u9ad8\u4e00\u6837\uff0c\u901a\u8fc7\u4e00\u4e2a\u7edf\u4e00\u7684\u6807\u51c6\uff08\u5f62\u72b6\u5951\u5408\u3001\u4ea4\u53c9\u7b49\uff09\uff0c\u5c31\u53ef\u4ee5\u642d\u51fa\u6765\u65e0\u9650\u79cd\u53ef\u80fd\u7684\u9020\u578b\uff0c\u8fd9\u4e5f\u662f\u4e50\u9ad8\u7684\u4e50\u8da3\u4e4b\u4e00\u3002\u90a3\u4e48\u5bf9\u4e8e APISIX \u7684\u63d2\u4ef6\u6765\u8bf4\uff0c\u6bcf\u4e00\u4e2a\u63d2\u4ef6\u5176\u5b9e\u90fd\u5b8c\u6210\u4e86\u4e00\u4e2a\u72ec\u7acb\u7684\u573a\u666f\u9700\u6c42\uff0c\u90a3\u4e48\u6709\u6ca1\u6709\u4e00\u79cd\u53ef\u80fd\uff0c\u53ef\u4ee5\u8ba9\u7528\u6237\u50cf\u642d\u4e50\u9ad8\u4e00\u6837\uff0c\u628a\u5404\u79cd\u63d2\u4ef6\u6446\u51fa\u6765\u8ba9\u7528\u6237\u81ea\u5df1\u6309\u7167\u9700\u6c42\u8fdb\u884c\u6392\u5217\u7ec4\u5408\u5462\uff1f\\n\\n\u6bd4\u5982 APISIX \u73b0\u5728\u63d0\u4f9b\u4e86 100 \u4e2a\u63d2\u4ef6\uff0c\u90a3\u4e48 APISIX \u7ed9\u7528\u6237\u66b4\u9732\u7684\u529f\u80fd\u5176\u5b9e\u4e5f\u5c31\u53ea\u6709\u8fd9 100 \u4e2a\u63d2\u4ef6\u6240\u5177\u6709\u7684\u529f\u80fd\uff0c\u5e76\u6ca1\u6709\u628a\u5e95\u5c42\u7684\u4e00\u4e9b\u7075\u6d3b\u6027\u5c55\u9732\u51fa\u6765\u3002\u5728\u8fdb\u884c\u6280\u672f\u4e2d\u95f4\u4ef6\u5f00\u53d1\u65f6\uff0c\u6211\u4eec\u4e0d\u4ec5\u9700\u8981\u8003\u8651\u8fd9\u4e2a\u4ea7\u54c1\u73b0\u5728\u80fd\u505a\u6210\u4ec0\u4e48\u6837\u5b50\uff0c\u800c\u66f4\u5e94\u8be5\u8003\u8651\u7684\u662f\u672a\u6765\u7528\u6237\u5728\u4e0a\u624b\u4f7f\u7528\u65f6\uff0c\u80fd\u5426\u5c06\u8fd9\u4e2a\u4ea7\u54c1\u8d4b\u4e88\u66f4\u591a\u53ef\u80fd\u6027\u3002\\n\\nAPISIX \u76ee\u524d\u6709\u5c06\u8fd1 100 \u4e2a\u63d2\u4ef6\uff0c\u5728\u52a0\u5165\u63d2\u4ef6\u7f16\u6392\u80fd\u529b\u540e\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u7684\u53ef\u80fd\u6027\u4e0d\u662f 100 \u79cd\uff0c\u800c\u662f100\xd799\xd798\xd797\xd796x\u2026\u2026\uff0c\u4e5f\u5c31\u662f\u63a5\u8fd1\u65e0\u9650\u79cd\u53ef\u80fd\u3002\\n\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u4f60\u60f3\u5bf9\u4e00\u4e2a\u7528\u6237\u8fdb\u884c\u9650\u6d41\u9650\u901f\uff0c\u5f53\u4ed6\u88ab\u9650\u901f\u4e4b\u540e\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u662f\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u7801\u3002\u8fd9\u65f6\u4f60\u662f\u5426\u53ef\u4ee5\u5c1d\u8bd5\u5bf9\u63a5\u4e00\u4e2a\u65e5\u5fd7\u8bb0\u5f55\u63d2\u4ef6\uff0c\u6216\u8005\u662f\u9519\u8bef\u4e0a\u62a5\u63d2\u4ef6\u6765\u8fdb\u884c\u540e\u7eed\u7684\u6d3b\u52a8\u8bb0\u5f55\u3002\u4e0b\u65b9\u56fe\u7247\u5c55\u793a\u4e86 APISIX \u7684\u63d2\u4ef6\u7f16\u6392\u6a21\u5f0f\u3002\\n\\n![\u63d2\u4ef6\u7f16\u6392](https://static.apiseven.com/2022/blog/0722/apisix-3.png)\\n\\n\u8fd9\u4e2a\u529f\u80fd\u5176\u5b9e\u9690\u85cf\u4e86\u4e00\u4e2a\u5f88\u5927\u7684\u597d\u5904\uff0c\u6bcf\u4e00\u4e2a\u63d2\u4ef6\u7684\u4ee3\u7801\u90fd\u88ab\u5b8c\u6574\u7684\u6d4b\u8bd5\u6848\u4f8b\u8986\u76d6\u5230\u3002\u4e5f\u5c31\u662f\u8bf4\u5f53\u7528\u6237\u8fdb\u884c\u63d2\u4ef6\u7f16\u6392\u65f6\uff0c\u53ef\u4ee5\u4e0d\u7528\u5199\u4efb\u4f55\u4ee3\u7801\u3002\u8fd9\u5bf9\u4e8e\u50cf\u4ea7\u54c1\u7ecf\u7406\u3001\u5b89\u5168\u5de5\u7a0b\u5e08\u4ee5\u53ca\u50cf\u8fd0\u7ef4\u5de5\u7a0b\u5e08\u6765\u8bf4\uff0c\u4e0d\u9700\u8981\u6295\u5165\u4e13\u95e8\u7684\u5b66\u4e60\u6210\u672c\uff0c\u53ea\u9700\u8981\u62d6\u62fd\u4e00\u4e9b\u63d2\u4ef6\u7136\u540e\u8bbe\u7f6e\u4e00\u4e9b\u6761\u4ef6\uff0c\u5c31\u53ef\u4ee5\u8bde\u751f\u4e00\u4e2a\u4e13\u5c5e\u81ea\u5df1\u7684 APISIX \u65b0\u63d2\u4ef6\uff0c\u540c\u65f6\u8fd9\u4e2a\u65b0\u63d2\u4ef6\u7684\u4ee3\u7801\u8d28\u91cf\u662f\u548c\u5f00\u6e90 APISIX \u7684\u5b98\u65b9\u4ee3\u7801\u8d28\u91cf\u4e00\u6837\u9ad8\u3002\\n\\n### \u5168\u6d41\u91cf\u7f51\u5173\\n\\n\u5bf9\u4e8e\u670d\u52a1\u7aef\u7684\u5de5\u7a0b\u5e08\u6765\u8bf4\uff0c\u5982\u679c\u4f60\u8fdb\u884c\u4e00\u4e9b\u548c\u7f51\u5173\u76f8\u5173\u7684\u5f00\u53d1\uff0c\u57fa\u672c\u90fd\u4f1a\u6d89\u53ca\u5230\u4e24\u4e2a\u6982\u5ff5\u3002\u4e00\u4e2a\u662f\u5357\u5317\u5411\u6d41\u91cf\uff0c\u6307\u7684\u662f\u4ece\u5ba2\u6237\u7aef\u3001\u6d4f\u89c8\u5668\u6216 IoT \u8bbe\u5907\u7b49\u5230\u8fbe\u670d\u52a1\u7aef\u7684\u6d41\u91cf\uff0c\u8fd9\u4e2a\u6d41\u91cf\u5c5e\u4e8e\u7eb5\u5411\u7684\u3002\u53e6\u4e00\u4e2a\u5c31\u662f\u4e1c\u897f\u5411\u6d41\u91cf\uff0c\u6307\u7684\u662f\u5728\u4f01\u4e1a\u5185\u90e8\uff0c\u7cfb\u7edf\u4e0e\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u4e92\u76f8\u8c03\u7528\uff0c\u8fd9\u4e2a\u6d41\u91cf\u5c5e\u4e8e\u6a2a\u5411\u7684\u3002\\n\\n\u5728\u5904\u7406\u7eb5\u5411\u548c\u6a2a\u5411\u7684\u8fd9\u4e9b\u6d41\u91cf\u65f6\uff0c\u5404\u7ec4\u4ef6\u7ec4\u6210\u4e5f\u4f1a\u6709\u6240\u4e0d\u540c\u3002\u6bd4\u5982\u5728\u5904\u7406\u5357\u5317\u5411\u6d41\u91cf\u7684\u7ec4\u4ef6\u4e2d\uff0c\u53ef\u80fd\u4f1a\u5148\u901a\u8fc7\u4e00\u4e2a LB\uff0c\u7136\u540e\u518d\u5230\u7f51\u5173\uff0c\u901a\u8fc7\u7f51\u5173\u4e4b\u540e\u53ef\u80fd\u4f1a\u8fdb\u5165\u4e00\u4e2a\u4e1a\u52a1\u7f51\u5173\u3002\u6240\u4ee5\u5c31\u4f1a\u6709\u7c7b\u4f3c\u4e8e\u50cf NGINX\u3001APISIX\u3001Sping Cloud Gateway \u8fd9\u6837\u7684\u7ec4\u4ef6\u3002\u90a3\u4e48\u5728\u4e1c\u897f\u5411\u6d41\u91cf\u4e2d\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u4e86\u670d\u52a1\u7f51\u683c\uff0c\u90a3\u4e48\u53ef\u80fd\u4f1a\u7528\u5230\u7c7b\u4f3c\u4e8e\u50cf Envoy \u8fd9\u6837\u7684\u7ec4\u4ef6\uff0c\u8fd9\u4e9b\u7ec4\u4ef6\u770b\u4e0a\u53bb\u4f1a\u975e\u5e38\u591a\uff0c\u4f46\u5982\u679c\u4ed4\u7ec6\u89c2\u5bdf\u5b83\u4eec\u7684\u529f\u80fd\uff0c\u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e9b\u7ec4\u4ef6\u57fa\u672c\u4e0a\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5927\u591a\u90fd\u662f\u8fdb\u884c\u50cf\u8def\u7531\u8c03\u5ea6\u3001\u52a8\u6001\u4e0a\u6e38\u4ee5\u53ca\u5b89\u5168\u8eab\u4efd\u8ba4\u8bc1\u7684\u63d2\u4ef6\u5b9e\u73b0\u7b49\u3002\\n\\n\u6240\u4ee5\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u80fd\u5426\u628a\u5904\u7406\u5357\u5317\u5411\u4e0e\u4e1c\u897f\u5411\u6d41\u91cf\u7684\u7ec4\u4ef6\u7edf\u4e00\u8d77\u6765\uff1f\u7406\u60f3\u72b6\u6001\u662f\u5f53\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u8fdb\u5230\u670d\u52a1\u7aef\u4e4b\u540e\uff0c\u5168\u90e8\u7531 APISIX \u6765\u5904\u7406\u3002\u5373\u4e0d\u7ba1\u6d41\u91cf\u662f\u5357\u5317\u5411\u8fd8\u662f\u4e1c\u897f\u5411\uff0c\u90fd\u662f\u901a\u8fc7\u63a7\u5236\u9762\u53bb\u63a7\u5236\u6240\u6709\u6d41\u91cf\u4e0e\u6570\u636e\u3002\u8fd9\u5728 APISIX \u76ee\u524d\u7684\u6280\u672f\u63a2\u7d22\u4e2d\uff0c\u662f\u5b8c\u5168\u53ef\u4ee5\u5b9e\u73b0\u7684\u3002\\n\\n\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u901a\u8fc7\u4e00\u4e9b\u73b0\u6709\u7528\u6237\u7684\u5b9e\u8df5\u53cd\u9988\uff0c\u4f60\u4f1a\u53d1\u73b0\u8fd9\u79cd\u6a21\u5f0f\u80fd\u591f\u5927\u5927\u964d\u4f4e\u7528\u6237\u81ea\u8eab\u7684\u8fd0\u7ef4\u6210\u672c\uff0c\u540c\u65f6\u53ef\u4ee5\u964d\u4f4e\u6574\u4f53\u7cfb\u7edf\u7684\u590d\u6742\u5ea6\uff0c\u4ece\u800c\u63d0\u5347\u4e86\u6574\u4e2a\u7cfb\u7edf\u4e4b\u95f4\u7684\u54cd\u5e94\u901f\u5ea6\u3002\u8fd9\u6837\u7684\u53cd\u9988\u7ed3\u679c\uff0c\u4e5f\u8ba9\u540e\u7eed APISIX \u7684\u8fed\u4ee3\u6709\u4e86\u66f4\u6e05\u6670\u7684\u65b9\u5411\uff0c\u8ba9 APISIX \u5728\u5168\u6d41\u91cf\u7f51\u5173\u5c42\u9762\u53bb\u5c1d\u8bd5\u66f4\u591a\u7684\u529f\u80fd\u548c\u89d2\u8272\u3002\\n\\n### \u591a\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\\n\\n\u7f51\u5173\u867d\u7136\u662f\u57fa\u7840\u7ec4\u4ef6\uff0c\u4f46\u5b83\u7684\u4f4d\u7f6e\u6781\u5176\u91cd\u8981\u3002\u5b83\u4f1a\u5904\u7406\u6240\u6709\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u5904\u7406\u5b8c\u6210\u540e\uff0c\u5bf9\u4e8e API \u7f51\u5173\u6765\u8bf4\u8fd8\u6709\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u804c\u8d23\uff0c\u5c31\u662f\u53bb\u548c\u5404\u79cd\u5404\u6837\u7684\u7cfb\u7edf\u53ca\u5f00\u6e90\u9879\u76ee\u8fdb\u884c\u96c6\u6210\u3002\\n\\n\u5728\u96c6\u6210\u8fc7\u7a0b\u4e2d\uff0c\u5c31\u4f1a\u7528\u5230\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u7ec4\u4ef6\u2014\u2014\u670d\u52a1\u53d1\u73b0\u4e0e\u6ce8\u518c\u3002\u56e0\u4e3a\u7528\u6237\u4f1a\u628a\u5404\u79cd\u5404\u6837\u7684\u670d\u52a1\u653e\u7f6e\u5230 Eureka\u3001Nacos \u8fd9\u6837\u5355\u72ec\u7684\u7ec4\u4ef6\u4e2d\u53bb\u5b8c\u6210\u3002\u5bf9\u4e8e\u4e00\u4e9b\u5927\u89c4\u6a21\u6216\u4e1a\u52a1\u5b58\u7eed\u8f83\u4e45\u7684 IT \u7cfb\u7edf\u6765\u8bf4\uff0c\u591a\u4e2a\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u5e76\u5b58\u662f\u975e\u5e38\u5e38\u89c1\u7684\u3002\\n\\n\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5176\u5b9e\u6240\u6709\u7684\u6d41\u91cf\u51fa\u5165\u53e3\u90fd\u662f\u7f51\u5173\u3002\u4f60\u53ef\u80fd\u9700\u8981\u5728A\u8def\u7531\u4e0a\u53bb\u5355\u72ec\u6307\u5b9a\u4e00\u4e2a Nacos \u670d\u52a1\u53d1\u73b0\uff0c\u5728B\u8def\u7531\u4e0a\u6307\u5b9a Consul \u7684\u670d\u52a1\u53d1\u73b0\u7b49\u3002\u8fd9\u5bf9\u4e8e\u7edd\u5927\u90e8\u5206\u7684\u7f51\u5173\u6765\u8bf4\uff0c\u4e00\u822c\u90fd\u53ea\u652f\u6301\u4e00\u4e2a\u670d\u52a1\u53d1\u73b0\uff0c\u8fd9\u65f6\u4f60\u53ef\u80fd\u5c31\u8981\u90e8\u7f72\u591a\u5957\u7f51\u5173\uff0c\u8ba9\u4e0d\u540c\u7684\u7f51\u5173\u5bf9\u63a5\u4e0d\u540c\u7684\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u3002\\n\\n\u76ee\u524d\u5728 APISIX \u4e2d\u4e0d\u4ec5\u652f\u6301\u5728\u6570\u636e\u9762\u7684\u670d\u52a1\u53d1\u73b0\uff0c\u4e5f\u9010\u6b65\u652f\u6301\u5728\u63a7\u5236\u9762\u4e0a\u53bb\u5bf9\u63a5\u591a\u4e2a\u670d\u52a1\u6ce8\u518c\u548c\u53d1\u73b0\u7684\u7ec4\u4ef6\u3002\u8fd9\u5bf9\u4e8e\u4e00\u4e9b\u5927\u89c4\u6a21\u548c\u4e1a\u52a1\u4e45\u8fdc\u7684\u4f01\u4e1a\u6765\u8bf4\uff0c\u5c31\u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u53ea\u90e8\u7f72\u4e00\u4e2a API \u7f51\u5173\uff0c\u5c31\u53ef\u4ee5\u8f7b\u677e\u5bf9\u63a5\u591a\u79cd\u4e0d\u540c\u7684\u670d\u52a1\u53d1\u73b0\u548c\u6ce8\u518c\u7ec4\u4ef6\u3002\\n\\n### \u591a\u4e91\u4e0e\u6df7\u5408\u4e91\u573a\u666f\u63a2\u7d22\\n\\n\u5bf9\u4e8e\u7f51\u5173\u6765\u8bf4\uff0c\u5f53\u7528\u6237\u628a\u5b83\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u4e2d\u65f6\uff0c\u5982\u679c\u662f\u4e91\u539f\u751f\u67b6\u6784\uff0c\u90a3\u4e48\u591a\u4e91\u548c\u6df7\u5408\u4e91\u5fc5\u7136\u662f\u4e00\u4e2a\u957f\u671f\u5b58\u5728\u7684\u6280\u672f\u573a\u666f\u3002\u5bf9\u4e8e APISIX \u6765\u8bf4\uff0c\u5f53\u5b83\u62e5\u6709\u4e86\u5b8c\u5584\u7684\u529f\u80fd\u3001\u6027\u80fd\u3001\u63d2\u4ef6\u548c\u591a\u670d\u52a1\u53d1\u73b0\u540e\uff0c\u5c31\u4e0d\u53ef\u907f\u514d\u5730\u53bb\u8003\u8651\u5982\u4f55\u8ba9\u7528\u6237\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u66f4\u597d\u5730\u53bb\u8fd0\u884c\u8d77\u6765\u3002\\n\\n\u591a\u4e91\u548c\u6df7\u5408\u4e91\u573a\u666f\u5176\u5b9e\u5bf9 APISIX \u5e26\u6765\u4e86\u66f4\u591a\u7684\u6311\u6218\uff0c\u9700\u8981\u8003\u8651\u66f4\u591a\u7ec6\u8282\u3002\\n\\n1. **\u4e0a\u4e0b\u6e38\u5747\u652f\u6301 mTLS**\\n\\n    \u4e4b\u524d\u6211\u4eec\u89c9\u5f97\u652f\u6301\u4e0a\u6e38\u7684 mTLS \u8fd9\u4e2a\u529f\u80fd\u7684\u4f18\u5148\u7ea7\u5e76\u4e0d\u9ad8\uff0c\u4f46\u4e00\u65e6\u5904\u4e8e\u8de8\u4e91\u573a\u666f\uff0c\u4e0a\u6e38\u53ef\u80fd\u5c31\u662f\u53e6\u5916\u4e00\u4e2a\u4e91\u4e0a\u7684\u670d\u52a1\uff0c\u6216\u8005\u53e6\u5916\u4e00\u4e2a SaaS \u670d\u52a1\u7b49\u3002\u4e3a\u4e86\u63d0\u9ad8\u6570\u636e\u7684\u5b89\u5168\u6027\uff0c\u5c31\u9700\u8981\u8fdb\u884c mTLS \u529f\u80fd\u7684\u52a0\u6301\u3002  \\n\\n2. **\u63a7\u5236\u9762\u4e0e\u6570\u636e\u9762\u67b6\u6784\u5b8c\u5168\u5206\u79bb**\\n\\n    APISIX \u5728\u6700\u8fd1\u4e00\u5e74\u4e2d\u88ab\u7206\u51fa\u6765\u51e0\u4e2a\u5b89\u5168\u6f0f\u6d1e\uff0c\u8fd9\u4e9b\u5b89\u5168\u6f0f\u6d1e\u7684\u6765\u6e90\u5f88\u591a\u662f\u56e0\u4e3a APISIX \u7684\u63a7\u5236\u9762\u4e0e\u6570\u636e\u9762\u662f\u6df7\u5408\u90e8\u7f72\u5728\u4e00\u8d77\u7684\u3002\u53ef\u4ee5\u7406\u89e3\u4e3a APISIX \u670d\u52a1\u542f\u52a8\u5b8c\u6210\u4e4b\u540e\uff0c\u5b83\u7684\u63a7\u5236\u9762\u4e0e\u6570\u636e\u9762\u5728\u540c\u4e00\u4e2a\u670d\u52a1\u91cc\u3002\u6b64\u65f6\u5982\u679c\u4e00\u4e2a\u9ed1\u5ba2\u901a\u8fc7\u5b89\u5168\u6f0f\u6d1e\u5165\u4fb5\u4e86\u67d0\u4e2a\u6570\u636e\u9762\uff0c\u90a3\u4e48\u4e5f\u5c31\u610f\u5473\u7740\u4ed6\u6709\u673a\u4f1a\u80fd\u591f\u5165\u4fb5\u5230\u63a7\u5236\u9762\uff0c\u4ece\u800c\u63a7\u5236\u6240\u6709\u7684\u6570\u636e\u9762\uff0c\u9020\u6210\u975e\u5e38\u5927\u7684\u5f71\u54cd\u3002\\n\\n    \u5728 APISIX \u540e\u7eed\u7684\u67b6\u6784\u8bbe\u8ba1\u4e2d\uff0c\u6211\u4eec\u5728\u8003\u8651\u628a\u6570\u636e\u9762\u4e0e\u63a7\u5236\u9762\u5b8c\u5168\u5206\u79bb\u3002\u91c7\u7528\u4e0d\u540c\u7684\u7aef\u53e3\u4e0e\u670d\u52a1\uff0c\u5c06\u5176\u90e8\u7f72\u5728\u5b8c\u5168\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u4ece\u800c\u907f\u514d\u51fa\u73b0\u4e0a\u8ff0\u5b89\u5168\u9690\u60a3\u3002\\n\\n3. **\u52a0\u5f3a\u5b89\u5168\u7ba1\u7406**\\n\\n    \u7f51\u5173\u4e00\u822c\u4f1a\u5b58\u50a8\u4e00\u4e9b\u6bd4\u8f83\u654f\u611f\u7684\u6570\u636e\uff0c\u6bd4\u5982\u6709\u4e9b\u7528\u6237\u53ef\u80fd\u5c31\u4f1a\u76f4\u63a5\u628a SSL \u8bc1\u4e66\u5b58\u50a8\u5728\u7f51\u5173\u4e0a\uff0c\u6216\u8005\u628a\u8fde\u63a5 etcd \u7684\u5bc6\u94a5\u4fe1\u606f\u5b58\u5728\u7f51\u5173\u4e0a\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e00\u65e6 etcd \u88ab\u4fb5\u5165\u4e86\u6216\u8005\u6570\u636e\u9762\u88ab\u653b\u7834\uff0c\u5c31\u6709\u53ef\u80fd\u9020\u6210\u6bd4\u8f83\u4e25\u91cd\u7684\u6570\u636e\u6cc4\u5bc6\u3002\\n\\n    \u56e0\u6b64\u5c31\u9700\u8981\u8003\u8651\u5728\u5b58\u50a8\u4e00\u4e9b\u5173\u952e\u4fe1\u606f\u65f6\uff0c\u53bb\u652f\u6301\u4f7f\u7528 Vault \u8fd9\u6837\u4e13\u95e8\u5b58\u5bc6\u94a5\u7684\u7ec4\u4ef6\u6765\u8fdb\u884c\u654f\u611f\u4fe1\u606f\u7684\u4fdd\u62a4\u3002\u8fd9\u6837\u505a\u4e0d\u4ec5\u53ef\u4ee5\u8ba9 APISIX \u81ea\u8eab\u66f4\u52a0\u5b89\u5168\uff0c\u4e5f\u80fd\u591f\u8ba9\u7528\u6237\u4f7f\u7528 APISIX \u65f6\u66f4\u52a0\u5408\u89c4\u3002\\n\\n4. **\u96c6\u6210\u66f4\u591a\u4e91\u4e0a\u6807\u51c6**\\n\\n    \u5728\u591a\u4e91\u60c5\u51b5\u4e0b\u6211\u4eec\u9700\u8981\u53bb\u8003\u8651\uff0cAPISIX \u5728\u7c7b\u4f3c\u963f\u91cc\u4e91\u3001\u817e\u8baf\u4e91\u53ca AWS \u7b49\u4e91\u670d\u52a1\u5546\u4e2d\u4f7f\u7528\u65f6\uff0c\u5982\u4f55\u4e0e\u4ed6\u4eec\u66f4\u597d\u5730\u878d\u5408\u5728\u4e00\u8d77\u6765\u4f7f\u7528\uff1f\u6211\u4eec\u7684\u521d\u8877\u662f\u5e0c\u671b\u7528\u6237\u4e0d\u7528\u914d\u7f6e\u4efb\u4f55\u4e1c\u897f\u5c31\u80fd\u591f\u5728\u5404\u4e2a\u4e91\u5e73\u53f0\u4e0a\u987a\u5229\u8fd0\u884c\u8d77\u6765\u3002\\n\\n    \u8fd9\u4e2a\u8fc7\u7a0b\u7684\u5b9e\u73b0\uff0c\u5e76\u4e0d\u8bf4\u8ba9\u7528\u6237\u518d\u8fdb\u884c\u81ea\u5b9a\u4e49\u63d2\u4ef6\u914d\u7f6e\uff0c\u800c\u662f\u76f4\u63a5\u8ba9 APISIX \u53bb\u96c6\u6210\u5404\u4e2a\u4e91\u4e0a\u7684\u6807\u51c6\u3001 API \u6216\u5176\u4ed6\u670d\u52a1\uff0c\u63d0\u524d\u5e2e\u7528\u6237\u505a\u597d\u9002\u914d\uff0c\u4fdd\u8bc1\u540e\u7eed\u7528\u6237\u7684\u76f4\u63a5\u4e0a\u624b\u4f53\u9a8c\u611f\u3002\\n\\n## \u524d\u884c\u4e4b\u8def\u7684\u652f\u6301\u8005\\n\\n\u7eb5\u89c2 APISIX \u7684\u53d1\u5c55\u5386\u7a0b\uff0c\u5176\u5b9e\u5728\u6280\u672f\u5c42\u9762\u505a\u4e86\u975e\u5e38\u591a\u7684\u521b\u65b0\u3002\u4e0d\u7ba1\u662f\u4ece\u4e00\u5f00\u59cb\u7684\u4ee3\u7801\u642d\u5efa\uff0c\u8fd8\u662f\u76ee\u524d\u4ecd\u7136\u4fdd\u6301\u7684\u5feb\u901f\u8fed\u4ee3\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u793e\u533a\u8d21\u732e\u8005\u4eec\u643a\u624b\u5e76\u8fdb\uff0c\u5c06 APISIX \u9010\u6e10\u642d\u5efa\u6210\u4e86\u5b8c\u6574\u4e14\u529f\u80fd\u65e5\u6e10\u4e30\u5bcc\u7684 API \u7f51\u5173\u3002\\n\\n\u4e00\u4e2a\u5f00\u6e90\u4ea7\u54c1\u7684\u8fed\u4ee3\u4e0e\u8fdb\u6b65\uff0c\u5fc5\u7136\u5c11\u4e0d\u4e86\u8d21\u732e\u8005\u4e0e\u4f7f\u7528\u8005\u7684\u529f\u52b3\u3002\\n\\n\u5728 APISIX \u521a\u6350\u8d60\u7ed9 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u65f6\uff0c\u5b83\u8fd8\u5e76\u4e0d\u662f\u4e00\u4e2a\u7279\u522b\u6210\u719f\u7684\u9879\u76ee\uff0c\u90a3\u65f6\u7684 APISIX \u53ea\u6709 20 \u4e2a\u8d21\u732e\u8005\u3002\u5982\u4eca\u7684\u8fc5\u901f\u53d1\u5c55\uff0c\u4e5f\u8ba9 APISIX \u5728\u5168\u7403\u8303\u56f4\u5185\u6536\u83b7\u4f17\u591a\u4f7f\u7528\u8005\u3001\u8d21\u732e\u8005\u548c\u4f01\u4e1a\u7528\u6237\u3002\u6bd4\u5982 WPS\u3001\u65b0\u6d6a\u5fae\u535a\u3001\u7231\u5947\u827a\u7b49\u56fd\u5185\u5927\u5382\uff0c\u8fd9\u4e9b\u90fd\u662f\u6bcf\u5929\u627f\u8f7d\u51e0\u767e\u4ebf\u6b21 API \u8c03\u7528\u7684\u4f01\u4e1a\u7528\u6237\u3002 \u5728\u6d77\u5916\u4e5f\u6709\u50cf NASA\u3001\u6b27\u76df\u6570\u5b57\u5de5\u5382\u3001\u745e\u58eb\u7535\u4fe1\u7b49\u975e\u5e38\u591a\u7684\u4e00\u4e9b\u7528\u6237\u5728\u4f7f\u7528\u3002\\n\\n![APISIX \u4f01\u4e1a\u7528\u6237](https://static.apiseven.com/2022/blog/0722/apisix-4.png)\\n\\n\u62ff WPS \u8fd9\u79cd\u4e91\u529e\u516c\u8f6f\u4ef6\u6765\u8bf4\uff0c\u4e0d\u7ba1\u4f60\u5728\u624b\u673a\u3001\u6d4f\u89c8\u5668\u8fd8\u662f\u7ec8\u7aef\u8bbe\u5907\u4e0a\u8fdb\u884c\u591a\u4eba\u534f\u540c\u529e\u516c\u65f6\uff0c\u51e0\u5341\u751a\u81f3\u51e0\u767e\u4e2a\u4eba\u53ef\u4ee5\u540c\u65f6\u53bb\u7f16\u8f91\u4e00\u4efd\u6587\u6863\uff0c\u540c\u65f6\u4f60\u53ef\u4ee5\u5b9e\u65f6\u67e5\u770b\u5230\u5176\u4ed6\u4eba\u8fdb\u884c\u7684\u4fee\u6539\u3002\u8fd9\u4e2a\u529f\u80fd\u5b9e\u73b0\u7684\u80cc\u540e\uff0c\u5c31\u662f\u901a\u8fc7 API \u7684\u5404\u79cd\u8c03\u7528\u6765\u5b9e\u73b0\u7684\u3002\\n\\n\u56fd\u5185\u8fd9\u4e9b\u5927\u5382\u4f01\u4e1a\u7528\u6237\u7684\u4f7f\u7528\u573a\u666f\u4e2d\uff0c\u591a\u662f\u5904\u7406\u4e0a\u767e\u4ebf API \u8c03\u7528\u548c\u5cf0\u503c QPS \u8d85\u767e\u4e07\u7684\u89c4\u6a21\u3002\u8fd9\u79cd\u4f7f\u7528\u89c4\u6a21\u4e0b\uff0c\u4e5f\u8ba9 APISIX \u771f\u6b63\u5728\u5927\u89c4\u6a21\u573a\u666f\u4e2d\u5f97\u5230\u5386\u7ec3\u4e0e\u6536\u83b7\u771f\u5b9e\u573a\u666f\u53cd\u9988\u3002\u5f97\u76ca\u4e8e\u8fd9\u4e9b\u4f01\u4e1a\u7528\u6237\u7684\u573a\u666f\u4f7f\u7528\uff0cAPISIX \u4f5c\u4e3a\u5f00\u6e90\u4ea7\u54c1\u624d\u5f97\u4ee5\u66f4\u6210\u719f\u5feb\u901f\u53d1\u5c55\u3002\\n\\n\u5f53\u7136\u9664\u4e86\u5c06 APISIX \u5e94\u7528\u5230\u4f01\u4e1a\u4e1a\u52a1\u4e2d\u6765\uff0c\u5f88\u591a\u4f7f\u7528\u8005\u5728\u4f7f\u7528 APISIX \u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u4f1a\u628a\u4ed6\u4eec\u7684\u4e00\u4e9b\u7ecf\u9a8c\u6216\u8005\u4ee3\u7801\u529f\u80fd\u8fed\u4ee3\u7b49\u53cd\u9988\u7ed9\u793e\u533a\uff0c\u5b9e\u73b0\u4e86\u53cc\u65b9\u4e92\u5229\u5171\u8d62\u7684\u8d8b\u52bf\u3002\u8fd9\u4e5f\u8bf4\u660e\u4f7f\u7528\u8005\u4eec\u4e0d\u4ec5\u89c9\u5f97 APISIX \u662f\u4e00\u4e2a\u597d\u7684\u4ea7\u54c1\uff0c\u66f4\u662f\u4e00\u4e2a\u503c\u5f97\u53bb\u53c2\u4e0e\u5176\u4e2d\u7684\u5f00\u6e90\u9879\u76ee\u3002\u5148\u8d62\u5f97\u5f00\u53d1\u8005\u4eec\u7684\u559c\u6b22\uff0c\u624d\u6709\u673a\u4f1a\u53bb\u53d8\u6210\u4e00\u4e2a\u771f\u6b63\u6709\u4ef7\u503c\u7684\u5f00\u6e90\u9879\u76ee\u3002\\n\\n\u8d21\u732e\u8005\u4eec\u7528\u4f53\u9a8c\u548c\u53cd\u9988\u6253\u9020\u4e86\u975e\u5e38\u591a\u7684\u4ea7\u54c1\u529f\u80fd\uff0c\u4f7f\u7528\u8005\u4eec\u5229\u7528\u8fd9\u4e9b\u529f\u80fd\u53c8\u53ef\u4ee5\u7ed9\u4f01\u4e1a\u5e26\u6765\u4ef7\u503c\u3002\u8fd9\u4e2a\u624d\u662f\u771f\u6b63\u5f00\u6e90\u7684\u7cbe\u9ad3\u6240\u5728\uff0c\u800c\u4e0d\u662f\u4e00\u5473\u53ea\u53bb\u8ffd\u6c42\u5404\u79cd\u8868\u9762\u6570\u636e\u800c\u5e26\u6765\u7684\u6570\u5b57\u7e41\u8363\u3002\\n\\n## APISIX 3.0 \u524d\u77bb\\n\\n\u81f3\u6b64\u6211\u4eec\u804a\u4e86\u975e\u5e38\u591a\u5173\u4e8e APISIX \u5728\u8fc7\u53bb\u53ca\u73b0\u5728\u8fdb\u884c\u7684\u63a2\u7d22\u3002\u4ece\u65f6\u95f4\u7ebf\u6765\u770b\uff0c\u53ef\u4ee5\u628a APISIX \u7684\u53d1\u5c55\u5386\u7a0b\u5206\u4e3a\u51e0\u4e2a\u9636\u6bb5\u3002\\n\\nAPISIX 1.0 \u9636\u6bb5\uff0c\u662f\u5728\u6253\u9020\u8fd9\u4e2a\u4ea7\u54c1\u7684\u6846\u67b6\uff0c\u5c06\u5e95\u5c42\u67b6\u6784\u6253\u7406\u597d\u5e76\u5448\u73b0\u4e00\u4e9b API \u7f51\u5173\u7684\u57fa\u672c\u529f\u80fd\u3002\u6765\u5230 2.0 \u9636\u6bb5\uff0c\u5219\u662f\u5728\u521d\u59cb\u7248\u672c\u4e0a\u8fdb\u884c\u4e86\u66f4\u7ec6\u81f4\u7684\u63a2\u7d22\uff0c\u8ba9\u5e95\u5c42\u66f4\u52a0\u7075\u6d3b\uff0c\u8ba9\u67b6\u6784\u66f4\u52a0\u4e30\u6ee1\u3002\\n\\n\u5bf9\u4e8e\u4e00\u4e2a\u6210\u719f\u7684\u5f00\u6e90\u9879\u76ee\u6765\u8bf4\uff0c\u5b83\u6210\u719f\u7684\u6807\u5fd7\u5e76\u4e0d\u662f\u8bf4\u529f\u80fd\u6709\u591a\u5f3a\u5927\uff0c\u800c\u662f\u5728\u4ea7\u54c1\u4f7f\u7528\u4e0a\uff0c\u4e3a\u7528\u6237\u548c\u5f00\u53d1\u8005\u5e26\u6765\u66f4\u597d\u7684\u4f7f\u7528\u4f53\u9a8c\u3002\\n\\n\u5728\u76ee\u524d\u9636\u6bb5\u4e2d\uff0cAPISIX \u90fd\u662f\u5728\u6280\u672f\u4e0a\u8fdb\u884c\u4e86\u975e\u5e38\u591a\u7684\u63a2\u7d22\u4e0e\u521b\u65b0\uff0c\u4f46\u5e76\u672a\u8003\u8651\u5230\u4f7f\u7528\u8005\u80cc\u540e\u7684\u611f\u53d7\uff0c\u6bd4\u5982\u6587\u6863\u8d28\u91cf\u53c2\u5dee\u4e0d\u9f50\u3001\u6559\u5b66\u89c6\u9891\u5c11\u4e4b\u53c8\u5c11\u7b49\u73b0\u72b6\u3002\u8fd9\u5c31\u8ba9\u5f88\u591a\u7528\u6237\u5728\u521a\u63a5\u89e6 APISIX \u65f6\uff0c\u5b58\u5728\u832b\u7136\u4e0e\u4e0d\u77e5\u6240\u63aa\u3002\u4e0d\u77e5\u9053\u600e\u4e48\u4f7f\u7528\uff0c\u4e0d\u77e5\u9053\u5982\u4f55\u5c06\u67d0\u4e9b\u529f\u80fd\u5e94\u7528\u5230\u4ec0\u4e48\u573a\u666f\uff0c\u4e0d\u77e5\u9053 APISIX \u8fd9\u4e9b\u5f3a\u5927\u7684\u529f\u80fd\u80cc\u540e\u80fd\u7ed9\u4f01\u4e1a\u5e26\u6765\u600e\u6837\u7684\u72ec\u7279\u4ef7\u503c\u3002\\n\\n\u6240\u4ee5\u5728\u63a5\u4e0b\u6765\u7684 APISIX 3.0 \u9636\u6bb5\u4e2d\uff0c\u4f1a\u5c1d\u8bd5\u89e3\u51b3\u7c7b\u4f3c\u7684\u95ee\u9898\uff0c\u91cd\u6784\u6389\u76ee\u524d\u5f88\u591a\u5bf9\u4e8e\u5f00\u53d1\u8005\u4f53\u9a8c\u4e0d\u53cb\u597d\u7684\u5730\u65b9\u3002\u6bd4\u5982\u91cd\u65b0\u53bb\u8bbe\u8ba1 API\uff0c\u53bb\u6389\u5bf9\u4e8e etcd \u7684\u4e00\u4e9b\u7279\u6b8a\u8fd4\u56de\u503c\u7684\u4f9d\u8d56\uff1b\u91cd\u6784\u5b98\u65b9\u4f7f\u7528\u6587\u6863\uff0c\u8ba9\u6587\u5b57\u6027\u8fd9\u79cd\u6700\u76f4\u63a5\u7684\u8868\u8fbe\u65b9\u5f0f\u5bf9\u5f00\u53d1\u8005\u66f4\u52a0\u53cb\u597d\u3002\u5728\u529f\u80fd\u5c42\u9762\uff0c\u4e5f\u4f1a\u8fdb\u884c\u63a7\u5236\u9762\u4e0e\u6570\u636e\u9762\u5206\u79bb\uff0c\u8ba9 APISIX \u672c\u8eab\u53d8\u5f97\u66f4\u52a0\u5b89\u5168\uff1b\u652f\u6301\u66f4\u591a\u7684 4 \u5c42\u534f\u8bae\uff0c\u652f\u6301\u66f4\u591a\u7684 RPC \u534f\u8bae\uff0c\u8ba9\u7528\u6237\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u53bb\u5b9e\u73b0\u5357\u5317\u4e1c\u897f\u5411\u7684\u5168\u6d41\u91cf\u7f51\u5173\u3002\\n\\n![APISIX 3.0 \u529f\u80fd\u4e00\u89c8](https://static.apiseven.com/2022/blog/0722/apisix-5.png)\\n\\n\u8fd9\u4e9b\u5f85\u5b9e\u73b0\u529f\u80fd\u52a0\u5728\u4e00\u8d77\uff0c\u4f60\u4f1a\u53d1\u73b0 APISIX 3.0 \u9636\u6bb5\u5c06\u4f1a\u53d8\u5f97\u6bd4\u4e4b\u524d\u7248\u672c\u66f4\u52a0\u5b89\u5168\u53ef\u9760\u4e0e\u6613\u7528\u3002\u529f\u80fd\u5f3a\u5927\u7684\u540c\u65f6\uff0c\u4ecd\u4e0d\u5fd8\u4f7f\u7528\u4f53\u9a8c\u3002\u6211\u4eec\u5e0c\u671b\u672a\u6765\u7684 APISIX\uff0c\u662f\u53ef\u4ee5\u5904\u7406\u5168\u7403\u6240\u6709 API \u548c\u5fae\u670d\u52a1\u7684\u8bf7\u6c42\uff0c\u6700\u7ec8\u8fbe\u5230\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u4f7f\u7528\u4ef7\u503c\uff0c\u52a9\u529b\u4f01\u4e1a\u5728 API \u548c\u5fae\u670d\u52a1\u6d41\u91cf\u7684\u5904\u7406\u4e0a\u66f4\u52a0\u4fbf\u5229\u3002\\n\\n\u9884\u8ba1\u5728 2022 \u5e74\u5e74\u5e95\uff0cAPISIX \u5c06\u4f1a\u53d1\u5e03\u5168\u65b0\u7684 3.0 \u7248\u672c\uff0c\u5e0c\u671b\u5927\u5bb6\u4e5f\u53ef\u4ee5\u6301\u7eed\u5173\u6ce8 APISIX \u65b0\u7248\u672c\u7684\u5404\u79cd\u52a8\u5411\uff0c\u8e0a\u8dc3\u53c2\u4e0e Apache APISIX \u9879\u76ee\u5171\u5efa\u3002"},{"id":"API \u7f51\u5173 APISIX \u5728\u8c37\u6b4c\u4e91 T2A \u548c T2D \u7684\u6027\u80fd\u6d4b\u8bd5","metadata":{"permalink":"/zh/blog/2022/07/22/how-is-google-cloud-tau-t2a-performing","source":"@site/blog/2022/07/22/how-is-google-cloud-tau-t2a-performing.md","title":"API \u7f51\u5173 APISIX \u5728\u8c37\u6b4c\u4e91 T2A \u548c T2D \u7684\u6027\u80fd\u6d4b\u8bd5","description":"\u672c\u6587\u4e3b\u8981\u4f7f\u7528\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u5206\u522b\u5728 Google Cloud T2A \u548c Google Cloud T2D \u8fdb\u884c\u6027\u80fd\u6d4b\u8bd5\uff0c\u5e76\u4e14\u8fdb\u884c\u5bf9\u6bd4\u4e24\u8005\u7684\u6027\u80fd\u3002","date":"2022-07-22T00:00:00.000Z","formattedDate":"2022\u5e747\u670822\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.855,"truncated":true,"authors":[{"name":"\u8d75\u58eb\u745e","title":"Author","url":"https://github.com/soulbird","image_url":"https://github.com/soulbird.png","imageURL":"https://github.com/soulbird.png"}],"prevItem":{"title":"Apache APISIX \u5728 API \u548c\u5fae\u670d\u52a1\u9886\u57df\u7684\u63a2\u7d22","permalink":"/zh/blog/2022/07/22/exploration-of-apisix-in-api-and-microservices"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (7.1 - 7.15)","permalink":"/zh/blog/2022/07/21/weekly-report-0715"}},"content":"> \u672c\u6587\u4e3b\u8981\u4f7f\u7528 Apache APISIX \u6765\u5bf9\u6bd4 Google Cloud T2A \u548c Google Cloud T2D \u7684\u6027\u80fd\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\\n\\n2022 \u5e74 7 \u6708 13 \u65e5 Google Cloud \u53d1\u5e03\u4e86\u7b2c\u4e00\u4e2a\u57fa\u4e8e Arm\xae \u67b6\u6784\u7684 Tau T2A \u7684 VM \u7cfb\u5217\u9884\u89c8\u7248\u3002T2A VM \u7531\u57fa\u4e8e Ampere\xae Altra\xae Arm \u7684\u5904\u7406\u5668\u63d0\u4f9b\u652f\u6301\uff0c\u8c37\u6b4c\u5ba3\u79f0\u5176\u62e5\u6709\u6781\u5177\u5438\u5f15\u529b\u7684\u4ef7\u683c\u548c\u5353\u8d8a\u7684\u5355\u7ebf\u7a0b\u6027\u80fd\u3002\\n\\n\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cAmpere\xae Altra\xae Arm \u662f\u4e00\u6b3e\u4e91\u539f\u751f\u5904\u7406\u5668\uff0c\u57fa\u4e8e Ampere\xae Altra\xae Arm \u5904\u7406\u5668\u7684 Tau T2A \u865a\u62df\u673a\u4e5f\u56e0\u6b64\u80fd\u4ee5\u9ad8\u6548\u7684\u65b9\u5f0f\u8fd0\u884c\u6a2a\u5411\u6269\u5c55\u7684\u4e91\u539f\u751f\u5e94\u7528\u7a0b\u5e8f\u3002\\n\\n\u90a3\u4e48\u5177\u4f53\u5b9e\u9645\u4f53\u9a8c\u548c\u6027\u80fd\u5982\u4f55\u5462\uff1f\u6211\u4eec\u4ee5\u4e00\u4e2a\u4e91\u539f\u751f\u7684 API \u7f51\u5173\u4e3a\u4f8b\uff0c\u5e26\u5927\u5bb6\u4e00\u8d77\u770b\u770b Google Cloud Tau T2A \u865a\u62df\u673a\u7684\u8868\u73b0\u3002\u8fd9\u91cc\uff0c\u6211\u4eec\u9009\u62e9\u4e86 Apache APISIX \u5728  Google Cloud Tau T2A \u670d\u52a1\u5668\u73af\u5883\u4e0a\u8fdb\u884c\u5b89\u88c5\u6d4b\u8bd5\u3002\\n\\nApache APISIX \u662f\u4e00\u4e2a\u4e91\u539f\u751f\u3001\u9ad8\u6027\u80fd\u3001\u53ef\u6269\u5c55\u7684 API \u7f51\u5173\u3002\u57fa\u4e8e NGNIX + LuaJIT \u548c etcd\uff0cAPISIX \u4e0e\u4f20\u7edf API \u7f51\u5173\u76f8\u6bd4\uff0c\u5177\u6709\u52a8\u6001\u8def\u7531\u548c\u63d2\u4ef6\u70ed\u52a0\u8f7d\u7279\u6027\uff0c\u7279\u522b\u9002\u5408\u4e91\u539f\u751f\u67b6\u6784\u4e0b\u7684 API \u7ba1\u7406\u3002\\n\\n![network error/APISIX Architecture.png](https://static.apiseven.com/2022/blog/0722/1.PNG)\\n\\n## \u524d\u671f\u51c6\u5907\\n\\n\u9996\u5148\u9700\u8981\u5728 Google Cloud \u4e0a\u542f\u52a8\u4e00\u4e2a T2A \u5b9e\u4f8b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9 Ubuntu 20.04\u3002\\n\\n![network error/Google Cloud T2A.png](https://static.apiseven.com/2022/blog/0722/2.png)\\n\\n\u7136\u540e\u5b89\u88c5 Docker\uff0c\u65b9\u4fbf\u540e\u7eed\u4f7f\u7528\u5bb9\u5668\u5316\u7684\u65b9\u5f0f\u6765\u5b89\u88c5\u90e8\u7f72 Apache APISIX\u3002\\n\\n```shell\\nsudo apt-get update && sudo apt-get install docker.io\\n```\\n\\n## \u90e8\u7f72 Apache APISIX\\n\\nApache APISIX \u4f7f\u7528 etcd \u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3\uff0c\u6240\u4ee5\u8fd9\u91cc\u9700\u8981\u5148\u542f\u52a8\u4e00\u4e2a etcd \u5b9e\u4f8b\u3002\\n\\n```shell\\nsudo docker run -d --name etcd \\\\\\n    -p 2379:2379 \\\\\\n    -e ETCD_UNSUPPORTED_ARCH=arm64 \\\\\\n    -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\n    -e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\n    rancher/coreos-etcd:v3.4.16-arm64\\n```\\n\\n\u542f\u52a8 Apache APISIX \u5b9e\u4f8b:\\n\\n```shell\\nsudo docker run --net=host -d apache/apisix:2.14.1-alpine\\n```\\n\\n\u6ce8\u518c\u8def\u7531\u3002\\n\\n```shell\\ncurl \\"http://127.0.0.1:9080/apisix/admin/routes/1\\" \\\\\\n-H \\"X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\\" -X PUT -d \'\\n{  \\n    \\"uri\\": \\"/anything/*\\",\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n              \\"httpbin.org:80\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u8bbf\u95ee\u6d4b\u8bd5\u3002\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/anything/das\\n```\\n\\n```shell\\nHTTP/1.1 200 OK\\n.....\\n```\\n\\n## Google Cloud T2D vs Google Cloud T2A\\n\\n\u4ece\u4e0a\u8ff0\u64cd\u4f5c\u6765\u770b\uff0cApache APISIX \u5728 Google Cloud Tau T2A \u4e0a\u7684\u5b89\u88c5\u548c\u517c\u5bb9\u6027\u6d4b\u8bd5\u90fd\u80fd\u987a\u5229\u5b8c\u6210\u3002\u90a3\u4e48 Google Cloud T2A \u7684\u5b9e\u9645\u6027\u80fd\u5230\u5e95\u5982\u4f55\u5462\uff1f\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u4f7f\u7528 Apache APISIX \u5206\u522b\u5728 Google Cloud T2A \u548c Google Cloud T2D \u4e0a\u505a\u6027\u80fd\u6d4b\u8bd5\u5bf9\u6bd4\uff0c\u6765\u770b\u770b\u5176\u5b9e\u9645\u8868\u73b0\u3002\\n\\nGoogle Cloud T2D \u662f Google Cloud Tau \u7cfb\u5217\u7684\u53e6\u4e00\u6b3e\u673a\u578b\uff0c\u662f\u57fa\u4e8e AMD x86 \u67b6\u6784\u7684\uff0c\u6240\u4ee5\u4e0a\u8ff0 etcd \u5b89\u88c5\u6b65\u9aa4\u7565\u6709\u4e0d\u540c\uff1a\\n\\n````shell\\nsudo docker run -d --name etcd \\\\\\n    -p 2379:2379 \\\\\\n    -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\n    -e ALLOW_NONE_AUTHENTICATION=yes \\\\\\n    -e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\n    bitnami/etcd:3.4.16\\n````\\n\\n\u4e3a\u7b80\u5355\u8d77\u89c1\uff0c\u672c\u6b21\u6d4b\u8bd5 APISIX \u4e2d\u53ea\u542f\u7528\u4e86\u4e00\u4e2a Worker\uff0c\u4ee5\u4e0b\u6027\u80fd\u6d4b\u8bd5\u6570\u636e\u5747\u5728\u5355\u6838 CPU \u4e0a\u8fd0\u884c\u3002\\n\\n### \u573a\u666f\u4e00\uff1a\u5355\u4e0a\u6e38\\n\\n\u8be5\u573a\u666f\u4e0b\u5c06\u4f7f\u7528\u5355\u4e2a\u4e0a\u6e38\uff08\u4e0d\u5305\u542b\u4efb\u4f55\u63d2\u4ef6\uff09\uff0c\u4e3b\u8981\u6d4b\u8bd5 APISIX \u5728\u7eaf\u4ee3\u7406\u56de\u6e90\u6a21\u5f0f\u4e0b\u7684\u6027\u80fd\u8868\u73b0\u3002\u5728\u672c\u5730\u73af\u5883\u4e2d\u8fdb\u884c\u6d4b\u8bd5\uff1a\\n\\n```shell\\n# apisix: 1 worker + 1 upstream + no plugin\\n\\n# \u6ce8\u518c\u8def\u7531\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u573a\u666f 2\uff1a\u5355\u4e2a\u4e0a\u6e38 + \u4e24\u4e2a\u63d2\u4ef6\\n\\n\u8be5\u573a\u666f\u4e0b\u5c06\u4f7f\u7528\u5355\u4e2a\u4e0a\u6e38\u4e0e\u4e24\u4e2a\u63d2\u4ef6\u8fdb\u884c\uff0c\u4e3b\u8981\u6d4b\u8bd5 APISIX \u5728\u5f00\u542f `limit-count` \u548c `prometheus` \u4e24\u4e2a\u6838\u5fc3\u6027\u80fd\u6d88\u8017\u63d2\u4ef6\u65f6\u7684\u8868\u73b0\u3002\\n\\n```shell\\n# apisix: 1 worker + 1 upstream + 2 plugins (limit-count + prometheus)\\n\\n# \u6ce8\u518c\u8def\u7531\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {\\n        \\"limit-count\\": {\\n            \\"count\\": 2000000000000,\\n            \\"time_window\\": 60,\\n            \\"rejected_code\\": 503,\\n            \\"key\\": \\"remote_addr\\"\\n        },\\n        \\"prometheus\\": {}\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u6570\u636e\u6bd4\u8f83\\n\\n\u4e0a\u8ff0\u4e24\u4e2a\u573a\u666f\u4e2d\uff0c\u5206\u522b\u4ece\u8bf7\u6c42 QPS\uff08\u6bcf\u79d2\u67e5\u8be2\u6570\uff09 \u548c\u5ef6\u8fdf\u65f6\u95f4\u4e24\u4e2a\u5c42\u9762\u8fdb\u884c\u4e86\u76f8\u5173\u7684\u6d4b\u8bd5\u5bf9\u6bd4\u3002\u7ed3\u679c\u5982\u4e0b\uff1a\\n\\n- QPS \u6bd4\u8f83\\n\\n![network error/QPS comparison.png](https://static.apiseven.com/2022/blog/0722/3.png)\\n\\n- \u8bf7\u6c42\u5ef6\u8fdf\u6bd4\u8f83\\n\\n![network error/Latency comparison.png](https://static.apiseven.com/2022/blog/0722/4.png)\\n\\n<table>\\n    <tr>\\n        <td><b>  </b></td>\\n        <td colspan=\\"2\\">\u5355\u4e2a\u4e0a\u6e38</td>\\n        <td colspan=\\"2\\">\u5355\u4e2a\u4e0a\u6e38 + \u4e24\u4e2a\u63d2\u4ef6</td>\\n    </tr>\\n    <tr>\\n        <td><b>  </b></td>\\n        <td><b>Google Cloud T2D</b></td>\\n        <td><b>Google Cloud T2A</b></td>\\n        <td><b>Google Cloud T2D</b></td>\\n        <td><b>Google Cloud T2A</b></td>\\n    </tr>\\n    <tr>\\n        <td><b>QPS(request/s)</b></td>\\n        <td><b>12500</b></td>\\n        <td><b>11300</b></td>\\n        <td><b>10600</b></td>\\n        <td><b>9900</b></td>\\n    </tr>\\n    <tr>\\n        <td><b>Latency(ms)</b></td>\\n        <td><b>1.26</b></td>\\n        <td><b>1.39</b></td>\\n        <td><b>1.45</b></td>\\n        <td><b>1.60</b></td>\\n    </tr>\\n    </table>\\n\\n\u4ece\u4ee5\u4e0a\u6570\u636e\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u5728 API Gateway \u7b49\u7f51\u7edc IO \u5bc6\u96c6\u8ba1\u7b97\u573a\u666f\u4e0b\uff0cT2A \u76f8\u6bd4\u540c\u7cfb\u5217\u7684 T2D \u865a\u62df\u673a\uff0c\u5728\u6027\u80fd\u4e0a\u4ecd\u7136\u6709\u5dee\u8ddd\u3002\u4e0d\u8fc7\u53e6\u4e00\u4e2a\u597d\u6d88\u606f\u662f\uff0c\u5728\u540c\u7b49\u914d\u7f6e\u60c5\u51b5\u4e0b\uff0cT2A \u7684\u4ef7\u683c\u8981\u6bd4 T2D \u4fbf\u5b9c 10% \u5de6\u53f3\u3002\u5728\u5b9e\u9645\u673a\u5668\u9009\u578b\u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u4f53\u91cf\u6765\u7075\u6d3b\u51b3\u7b56\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u4f7f\u7528 Apache APISIX \u5bf9\u6bd4 Google Cloud T2A \u548c Google Cloud T2D \u7684\u6027\u80fd\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u5728 API \u7f51\u5173\u7b49\u7f51\u7edc IO \u5bc6\u96c6\u8ba1\u7b97\u573a\u666f\u4e2d\uff0cGoogle Cloud T2A \u76f8\u6bd4 T2D\uff0c\u8868\u73b0\u867d\u7136\u4e0d\u662f\u90a3\u4e48\u4eae\u773c\uff0c\u4f46\u662f\u4f5c\u4e3a Google Cloud \u5728 ARM \u67b6\u6784\u4e0b\u7684\u7b2c\u4e00\u6b21\u5c1d\u8bd5\uff0c\u76f8\u4fe1\u5176\u4f1a\u5728 ARM \u67b6\u6784\u7684\u865a\u62df\u673a\u4e0a\u6301\u7eed\u53d1\u529b\uff0c\u4e5f\u671f\u5f85\u5b83\u7684\u540e\u7eed\u8fed\u4ee3\u8868\u73b0\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 (7.1 - 7.15)","metadata":{"permalink":"/zh/blog/2022/07/21/weekly-report-0715","source":"@site/blog/2022/07/21/weekly-report-0715.md","title":"\u793e\u533a\u53cc\u5468\u62a5 (7.1 - 7.15)","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86 openid-connect \u63d2\u4ef6\u4e2d\u652f\u6301 PKCE\u3001Ingress \u8d44\u6e90\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 APISIX \u7684\u63d2\u4ef6\u7b49\u529f\u80fd\u3002","date":"2022-07-21T00:00:00.000Z","formattedDate":"2022\u5e747\u670821\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.86,"truncated":true,"authors":[],"prevItem":{"title":"API \u7f51\u5173 APISIX \u5728\u8c37\u6b4c\u4e91 T2A \u548c T2D \u7684\u6027\u80fd\u6d4b\u8bd5","permalink":"/zh/blog/2022/07/22/how-is-google-cloud-tau-t2a-performing"},"nextItem":{"title":"\u4f7f\u7528 Prometheus \u76d1\u63a7\u4e91\u539f\u751f API \u7f51\u5173 APISIX","permalink":"/zh/blog/2022/07/13/monitor-api-gateway-apisix-with-prometheus"}},"content":"> \u4ece 7.1 - 7.15\uff0c\u6709 28 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 99 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2022/weeklyreport/0721/3.jpg)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/2022/weeklyreport/0721/6.png)\\n\\n## Good first issue\\n\\n### Issue #1146\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1146\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5e94\u8be5\u5728 Makefile \u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684 `make dev env`\uff0c\u4ee5\u542f\u52a8\u5f00\u53d1\u73af\u5883\u3002\\n\\n\u5b83\u9700\u8981\u5b8c\u6210\uff1a\\n\\n- \u4f7f\u7528 kind \u521b\u5efa\u65b0\u96c6\u7fa4\\n- \u90e8\u7f72 APISIX + etcd\\n- \u6784\u5efa `apisix-ingress-controller` \u7684\u955c\u50cf\\n- \u90e8\u7f72 `apisix-ingress-controller`\\n\\n\u5176\u4e2d\u5927\u591a\u6570\u5df2\u7ecf\u5305\u542b\u5728\u5f53\u524d\u7684 Makefile \u4e2d\uff0c\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u7ec4\u7ec7\u3002\\n\\n### Issue #1129\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1129\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5f53\u524d\u9879\u76ee\u7684 `e2e` \u4e2d\u4f7f\u7528\u4e86\u5927\u91cf\u7684 `time.sleep`\uff0c\u8fd9\u65e0\u7591\u4f1a\u589e\u52a0 CI \u7684\u6574\u4f53\u8017\u65f6\u3002\\n\\nhttps://pkg.go.dev/k8s.io/apimachinery/pkg/util/wait \u5305\u63d0\u4f9b\u4e86\u8f6e\u8be2\uff08Polling\uff09\u6216\u76d1\u542c\u6761\u4ef6\u53d8\u5316\u7684\u5de5\u5177\u3002\\n\\n\u53ef\u4ee5\u7528 `wait` \u4ee3\u66ff\u5f53\u524d\u7684 `time.sleep`\uff0c\u4ee5\u4e00\u79cd\u66f4\u597d\u7684\u65b9\u5f0f\u6765\u786e\u5b9a\u662f\u5426\u5df2\u7ecf\u8fbe\u5230\u6211\u4eec\u6240\u671f\u671b\u7684\u72b6\u6001\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [\u65b0\u589e\u5728 Ingress \u8d44\u6e90\u4e2d\u53ef\u4ee5\u901a\u8fc7 annotation \u7ed1\u5b9a ApisixPluginConfig \u7684\u80fd\u529b\uff0c\u8ba9 Ingress \u8d44\u6e90\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 APISIX \u7684\u63d2\u4ef6\u80fd\u529b](https://github.com/apache/apisix-ingress-controller/pull/1139)\uff08\u8d21\u732e\u8005\uff1a[dickens7](https://github.com/dickens7)\uff09\\n\\n- [\u4fee\u590d APISIX Dashboard \u4e2d\u8def\u7531\u590d\u5236\u65f6\u7684 ID \u51b2\u7a81\u95ee\u9898](https://github.com/apache/apisix-dashboard/pull/2501)\uff08\u8d21\u732e\u8005\uff1a[SkyeYoung](https://github.com/SkyeYoung)\uff09\\n\\n- [`openid-connect` \u63d2\u4ef6\u4e2d\u652f\u6301 PKCE](https://github.com/apache/apisix/pull/7370)\uff08\u8d21\u732e\u8005\uff1a[qihaiyan](https://github.com/qihaiyan)\uff09\\n\\n- [\u652f\u6301\u81ea\u5b9a\u4e49\u63d2\u4ef6\u4f18\u5148\u7ea7](https://github.com/apache/apisix/pull/7391)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"\u4f7f\u7528 Prometheus \u76d1\u63a7\u4e91\u539f\u751f API \u7f51\u5173 APISIX","metadata":{"permalink":"/zh/blog/2022/07/13/monitor-api-gateway-apisix-with-prometheus","source":"@site/blog/2022/07/13/monitor-api-gateway-apisix-with-prometheus.md","title":"\u4f7f\u7528 Prometheus \u76d1\u63a7\u4e91\u539f\u751f API \u7f51\u5173 APISIX","description":"\u672c\u6587\u5c06\u4e3a\u4f60\u4ecb\u7ecd\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684 prometheus \u63d2\u4ef6\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u5e76\u901a\u8fc7\u6b64\u63d2\u4ef6\u76d1\u63a7 APISIX\uff0c\u4e5f\u4e3a\u4f60\u6f14\u793a\u4e86\u5982\u4f55\u5728 APISIX Dashboard \u4e2d\u914d\u7f6e Grafana\u3002","date":"2022-07-13T00:00:00.000Z","formattedDate":"2022\u5e747\u670813\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":7.24,"truncated":true,"authors":[{"name":"\u97e9\u98de","title":"Author","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 (7.1 - 7.15)","permalink":"/zh/blog/2022/07/21/weekly-report-0715"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 6.16 - 6.30","permalink":"/zh/blog/2022/07/07/weekly-report-0630"}},"content":"> \u672c\u6587\u5c06\u4e3a\u4f60\u4ecb\u7ecd Apache APISIX \u7684 prometheus \u63d2\u4ef6\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u5e76\u901a\u8fc7\u6b64\u63d2\u4ef6\u76d1\u63a7 APISIX\uff0c\u5e76\u4e14\u4e5f\u4e3a\u4f60\u6f14\u793a\u4e86\u5982\u4f55\u5728 APISIX Dashboard \u4e2d\u914d\u7f6e Grafana\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f5c\u4e3a API \u7f51\u5173\uff0cApache APISIX \u4e0d\u4ec5\u62e5\u6709\u4e30\u5bcc\u7684\u63d2\u4ef6\uff0c\u800c\u4e14\u652f\u6301\u63d2\u4ef6\u7684\u70ed\u52a0\u8f7d\u3002\\n\\nPrometheus \u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u4e91\u539f\u751f\u76d1\u63a7\u62a5\u8b66\u7cfb\u7edf\uff0c\u5b83\u4e3a\u7528\u6237\u63d0\u4f9b\u5f3a\u5927\u7684\u6307\u6807\u5b58\u50a8\u529f\u80fd\u3001\u544a\u8b66\u529f\u80fd\u548c\u8fd1\u5b9e\u65f6\u67e5\u8be2\u5f15\u64ce\uff0c\u652f\u6301\u591a\u79cd exporter \u91c7\u96c6\u6570\u636e\u548c pushgateway \u8fdb\u884c\u6570\u636e\u4e0a\u62a5\u3002Prometheus \u7684\u6027\u80fd\u8db3\u591f\u652f\u6491\u4e0a\u4e07\u53f0\u89c4\u6a21\u7684\u96c6\u7fa4\uff0c\u662f\u76ee\u524d\u6700\u6d41\u884c\u7684\u5f00\u6e90\u76d1\u63a7\u7cfb\u7edf\u4e4b\u4e00\u3002\\n\\n## \u63d2\u4ef6\u4ecb\u7ecd\\n\\nAPISIX \u901a\u8fc7 Prometheus Exporter \u4ee5 HTTP \u7684\u65b9\u5f0f\u5411\u5916\u66b4\u9732 APISIX \u8bbe\u5b9a\u7684\u76d1\u63a7\u6307\u6807\uff0c\u5305\u62ec APISIX \u7684\u8fde\u63a5\u6570\u3001HTTP \u8bf7\u6c42\u7684\u72b6\u6001\u7801\u5206\u5e03\u3001HTTP \u8bf7\u6c42\u603b\u6570\u3001HTTP \u8bf7\u6c42\u5ef6\u65f6\u7b49\u91cd\u8981\u6307\u6807\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 `prometheus` \u63d2\u4ef6\uff0c\u6765\u76d1\u63a7 APISIX \u7684\u5404\u4e2a\u6307\u6807\uff0c\u4ee5\u4fbf\u53ca\u65f6\u5730\u4e86\u89e3\u7cfb\u7edf\u8fd0\u884c\u72b6\u6001\u3002\\n\\n## \u914d\u7f6e\u6b65\u9aa4\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u542f\u7528 prometheus \u63d2\u4ef6\\n\\n\u9996\u5148\uff0c\u4f60\u9700\u8981\u5b89\u88c5\u5b8c\u6210 APISIX\uff0c\u672c\u6587\u6240\u6709\u6b65\u9aa4\u57fa\u4e8e CentOS 7.6 \u7cfb\u7edf\u8fdb\u884c\u3002\u4f60\u9700\u8981\u5b8c\u6210 APISIX \u7684\u5b89\u88c5\uff0c\u5177\u4f53\u7ec6\u8282\u53ef\u53c2\u8003 [APISIX \u5b89\u88c5\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/how-to-build/)\u3002\\n\\nAPISIX \u9ed8\u8ba4\u542f\u7528 `prometheus` \u63d2\u4ef6\uff0c\u8be5\u63d2\u4ef6\u9ed8\u8ba4\u521b\u5efa `/apisix/prometheus/metrics` \u63a5\u53e3\uff0c\u5e76\u901a\u8fc7\u72ec\u7acb\u7684\u670d\u52a1\u5730\u5740\uff08\u9ed8\u8ba4\u4e3a `127.0.0.1:9091`\uff09\u66b4\u9732\u6307\u6807\uff0c\u672c\u6587\u5c06\u4f7f\u7528\u8be5\u5730\u5740\u8fdb\u884c\u3002\\n\\n\u4f60\u4e5f\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff0c\u4fee\u6539\u9ed8\u8ba4\u7684\u670d\u52a1\u5730\u5740\uff1a\\n\\n```yaml title=\\"./conf/config.yaml\\"\\nplugin_attr:\\n  prometheus:\\n    export_addr:\\n      ip: 127.0.0.1\\n      port: 9092\\n```\\n\\n\u5efa\u8bae\u5728 `ip` \u53c2\u6570\u4e2d\u914d\u7f6e\u5185\u7f51\u5730\u5740\uff0c\u786e\u4fdd\u4ec5\u5728\u5c40\u57df\u7f51\u5185\u66b4\u9732 Prometheus Exporter \u63a5\u53e3\u3002\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 [public-api](https://apisix.apache.org/zh/docs/apisix/plugins/public-api/) \u63d2\u4ef6\u4fdd\u62a4\u6b64\u63a5\u53e3\u3002\u4e3a\u4e86\u65b9\u4fbf\u5728\u6d4b\u8bd5\u73af\u5883\u4e2d\u4f7f\u7528\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5c06 Prometheus Exporter \u76f4\u63a5\u66b4\u9732\u5728\u6570\u636e\u9762\u7684\u7aef\u53e3\u4e0a\u3002\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```yaml\\nplugin_attr:\\n  prometheus:\\n    enable_export_server: false\\n```\\n\\n\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u63d0\u53d6\u76f8\u5173\u76d1\u63a7\u6307\u6807\uff1a\\n\\n```shell\\ncurl -i http://127.0.0.1:9091/apisix/prometheus/metrics\\n```\\n\\n\u8fd4\u56de\u5982\u4e0b\u7ed3\u679c\u5373\u4e3a\u914d\u7f6e\u6210\u529f\u3002\\n\\n```shell\\nHTTP/1.1 200 OK\\nServer: openresty\\nDate: Wed, 23 Mar 2022 13:22:58 GMT\\nContent-Type: text/plain; charset=utf-8\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\n\\n# HELP apisix_etcd_modify_indexes Etcd modify index for APISIX keys\\n# TYPE apisix_etcd_modify_indexes gauge\\napisix_etcd_modify_indexes{key=\\"consumers\\"} 0\\n...\\n# TYPE apisix_node_info gauge\\napisix_node_info{hostname=\\"APISIX\\"} 1\\n```\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u914d\u7f6e Prometheus\\n\\n1. \u5b89\u88c5 Prometheus\uff1a\\n\\n```shell\\ncd /usr/local && \\\\\\nwget https://github.com/prometheus/prometheus/releases/download/v2.33.0-rc.0/prometheus-2.33.0-rc.0.linux-amd64.tar.gz && \\\\\\ntar -zxvf prometheus-2.33.0-rc.0.linux-amd64.tar.gz && \\\\\\ncd /usr/local/prometheus-2.33.0-rc.0.linux-amd64/\\n```\\n\\n2. \u901a\u8fc7\u5728 Prometheus \u7684 `prometheus.yml` \u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u76f8\u5173\u914d\u7f6e\uff0cPrometheus \u5c31\u53ef\u4ee5\u81ea\u52a8\u6293\u53d6\u6307\u6807\u6570\u636e\u3002\u5177\u4f53\u914d\u7f6e\u5982\u4e0b\uff1a\\n\\n```shell title=\\"./prometheus.yml\\"\\nscrape_configs:\\n  - job_name: \\"apisix\\"\\n    scrape_interval: 15s\\n    metrics_path: \\"/apisix/prometheus/metrics\\"\\n    static_configs:\\n      - targets: [\\"127.0.0.1:9091\\"]\\n```\\n\\n\u5176\u4e2d `scrape_interval` \u7684\u53d6\u503c\u4e0e Prometheus QL \u4e2d `rate` \u51fd\u6570\u7684\u65f6\u95f4\u8303\u56f4\u6709\u5173\u7cfb\uff0c`rate` \u51fd\u6570\u4e2d\u7684\u65f6\u95f4\u8303\u56f4\u5e94\u8be5\u662f\u6b64\u53c2\u6570\u53d6\u503c\u7684\u4e24\u500d\u3002`targets` \u662f\u5728 APISIX \u4e2d\u914d\u7f6e\u7684 Prometheus Exporter \u66b4\u9732\u6307\u6807\u7684\u5730\u5740\u3002\u66f4\u591a\u5173\u4e8e Prometheus \u7684\u4f7f\u7528\u65b9\u6cd5\u8bf7\u53c2\u8003 [Prometheus \u5b98\u65b9\u6587\u6863](https://prometheus.io/docs/introduction/overview/)\u3002\\n\\n3. \u542f\u52a8 Prometheus\uff0c\u5e76\u6307\u5b9a\u76d1\u542c\u7aef\u53e3\u4e3a `9094`\u3002\\n\\n```shell\\n./prometheus --config.file=prometheus.yml --web.listen-address=:9094 --web.enable-lifecycle &\\n```\\n\\n\u8bbf\u95ee `127.0.0.1:9094`\uff0c\u9009\u62e9 `Status > Targets`\uff0c\u9875\u9762\u5982\u4e0b\u5219\u8868\u793a\u914d\u7f6e\u6210\u529f\uff1a\\n\\n![network error/prometheus.png](https://static.apiseven.com/2022/blog/0713/1.png)\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u521b\u5efa\u8def\u7531\\n\\n\u542f\u7528 `prometheus` \u63d2\u4ef6\u540e\uff0c\u8bbf\u95ee Prometheus Exporter \u83b7\u53d6\u7684 Metrics \u6570\u636e\u4e2d\u5e76\u4e0d\u5305\u62ec HTTP \u8bf7\u6c42\u7684\u76f8\u5173\u6307\u6807\uff0c\u4ec5\u6709 APISIX \u5b9e\u4f8b\u76f8\u5173\u7684\u6307\u6807\u3002\u56e0\u6b64\u542f\u7528\u63d2\u4ef6\u4e4b\u540e\u8fd8\u9700\u8981\u5c06\u5b83\u7ed1\u5b9a\u5728\u6307\u5b9a\u7684\u8def\u7531\u4e0a\u6216\u8005\u521b\u5efa\u4e00\u4e2a[\u5168\u5c40\u89c4\u5219](https://apisix.apache.org/zh/docs/apisix/terminology/global-rule/)\u3002\u4ee5\u4e0b\u793a\u4f8b\u662f\u521b\u5efa\u4e00\u4e2a\u8def\u7531\u5e76\u5c06\u8be5\u63d2\u4ef6\u7ed1\u5b9a\u5728\u8be5\u8def\u7531\u4e0a\uff1a\\n\\n```shell\\ncurl -X PUT http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n-d \'{\\n        \\"uri\\": \\"/*\\",\\n        \\"plugins\\": {\\n            \\"prometheus\\": {\\n                \\"prefer_name\\": false\\n            }\\n        },\\n        \\"upstream\\": {\\n            \\"type\\": \\"roundrobin\\",\\n            \\"nodes\\": {\\n                \\"httpbin.org\\": 1\\n            }\\n        }\\n    }\'\\n```\\n\\n\u5982\u679c\u4f60\u9700\u8981\u6536\u96c6\u6240\u6709\u8def\u7531\u7684\u6307\u6807\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\u5168\u5c40\u89c4\u5219\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/global_rules/1 -X PUT \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n  -d \'{\\n        \\"plugins\\": {\\n            \\"prometheus\\": {\\n                \\"prefer_name\\": false\\n            }\\n        }\\n    }\'\\n```\\n\\n### \u6b65\u9aa4\u56db\uff1a\u914d\u7f6e Grafana\\n\\n1. \u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5 Grafana\u3002\\n\\n```shell\\ncd /usr/local && \\\\\\nwget https://dl.grafana.com/enterprise/release/grafana-enterprise-8.3.3-1.x86_64.rpm && \\\\\\nsudo yum -y install grafana-enterprise-8.3.3-1.x86_64.rpm\\n```\\n\\n2. \u4f60\u9700\u8981\u4fee\u6539 Grafana \u76f8\u5173\u914d\u7f6e\u624d\u53ef\u4ee5\u5728 APISIX Dashboard \u6b63\u5e38\u4f7f\u7528 Grafana\u3002\u8bf7\u5728 Grafana \u914d\u7f6e\u6587\u4ef6 `defaults.ini` \u4fee\u6539\u5982\u4e0b\u914d\u7f6e\uff1a\\n\\n```ini title=\\"/usr/share/grafana/conf/defaults.ini\\"\\nallow_embedding = true\\n# \u7531\u4e8e\u5b89\u5168\u7b56\u7565\uff0c\u8bbe\u7f6e\u4e3a true \u65f6\uff0c\u6d4f\u89c8\u5668\u624d\u53ef\u4ee5\u6b63\u786e\u5448\u73b0 Grafana \u9875\u9762\u3002\\n#... \u5176\u4ed6\u914d\u7f6e\\n[auth.anonymous]\\n# \u542f\u7528\u533f\u540d\u767b\u5f55\\nenabled = true\\n```\\n\\n3. \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8 Grafana\uff1a\\n\\n```shell\\nsystemctl start grafana-server\\n```\\n\\n4. \u767b\u5f55 Grafana\uff08\u9ed8\u8ba4\u5730\u5740\u4e3a `http://127.0.0.1:3000`\uff09\uff0c\u9ed8\u8ba4\u7528\u6237\u548c\u5bc6\u7801\u5747\u4e3a `admin`\u3002\u767b\u5f55\u6210\u529f\u540e\uff0c\u5728\u5f53\u524d\u9875\u9762\u5355\u51fb `Add your first data source`\uff0c\u9009\u62e9 `Prometheus`\uff0c\u914d\u7f6e URL \u4e3a `http://127.0.0.1:9094`\u3002\\n\\n![network error/import.png](https://static.apiseven.com/2022/blog/0713/2.png)\\n\\n5. \u5355\u51fb\u5de6\u4fa7 `+` \u53f7\u5e76\u9009\u62e9 `Import`\uff0c\u5355\u51fb `Upload JSON file` \u4e0a\u4f20 [APISIX Grafana Dashboard \u5143\u6570\u636e\u6587\u4ef6](https://github.com/apache/apisix/blob/master/docs/assets/other/json/apisix-grafana-dashboard.json)\u3002\u4e0a\u4f20\u540e\uff0c\u5355\u51fb `Import`\uff0cGrafana \u5c31\u914d\u7f6e\u6210\u529f\u4e86\u3002\\n\\n![network error/apisix grafana.png](https://static.apiseven.com/2022/blog/0713/3.png)\\n\\n### \u6b65\u9aa4\u4e94\uff1a\u8bf7\u6c42 APISIX\\n\\n\u5b8c\u6210\u4e0a\u8ff0\u6b65\u9aa4\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u8bf7\u6c42\u8def\u7531\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/index.html\\n```\\n\\n\u8fd4\u56de Grafana \u9875\u9762\uff0c\u5355\u51fb\u5de6\u4fa7\u5bfc\u822a\u680f\u641c\u7d22\u6309\u94ae\uff0c\u5c31\u53ef\u4ee5\u67e5\u770b APISIX \u76f8\u5173\u7684\u6307\u6807\u4e86\u3002\\n\\n![network error/apisix grafana.png](https://static.apiseven.com/2022/blog/0713/4.png)\\n\\n### \u6b65\u9aa4\u516d\uff1a\u5d4c\u5165 APISIX Dashboard\\n\\n1. \u5b89\u88c5\u5e76\u767b\u5f55 APISIX Dashboard\uff0c\u9ed8\u8ba4\u5730\u5740\u4e3a `127.0.0.1:9000`\u3002\u5177\u4f53\u7ec6\u8282\u53ef\u53c2\u8003 [APISIX Dashboard \u5b89\u88c5\u6307\u5357](https://apisix.apache.org/zh/docs/dashboard/install/)\u3002\\n2. \u9009\u62e9\u53f3\u4e0a\u89d2 `APISIX USER >\u7cfb\u7edf\u8bbe\u7f6e`\u3002\\n3. \u5728\u8bbe\u7f6e\u9875\u9762\u4e2d\u7684 Grafana \u5730\u5740\u5904\u586b\u5199 Grafana \u7684\u5730\u5740\u5e76\u5355\u51fb\u63d0\u4ea4\u3002\\n\\n![network error/apisix dashboard.png](https://static.apiseven.com/2022/blog/0713/5.png)\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 Prometheus \u76d1\u63a7 APISIX\uff0c\u5e76\u4e14\u5c55\u793a\u4e86\u5982\u4f55\u5728 APISIX Dashboard \u4e2d\u5d4c\u5165 Grafana \u76d1\u63a7\u9762\u677f\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u4f60\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join/)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5 6.16 - 6.30","metadata":{"permalink":"/zh/blog/2022/07/07/weekly-report-0630","source":"@site/blog/2022/07/07/weekly-report-0630.md","title":"\u793e\u533a\u53cc\u5468\u62a5 6.16 - 6.30","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49\u63d2\u4ef6\u4f18\u5148\u7ea7\u3001\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 plugin_metadata\u3001`kafka` \u63d2\u4ef6\u65b0\u589e\u76f8\u5173\u53c2\u6570\u652f\u6301\u7b49\u529f\u80fd\u3002","date":"2022-07-07T00:00:00.000Z","formattedDate":"2022\u5e747\u67087\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.14,"truncated":true,"authors":[],"prevItem":{"title":"\u4f7f\u7528 Prometheus \u76d1\u63a7\u4e91\u539f\u751f API \u7f51\u5173 APISIX","permalink":"/zh/blog/2022/07/13/monitor-api-gateway-apisix-with-prometheus"},"nextItem":{"title":"\u4f7f\u7528 Keycloak \u4e0e API \u7f51\u5173\u4fdd\u62a4\u4f60\u7684 API","permalink":"/zh/blog/2022/07/06/use-keycloak-with-api-gateway-to-secure-apis"}},"content":"> \u4ece 6.16 - 6.30\uff0c\u6709 29 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 98 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2022/blog/0707/3.jpg)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/2022/blog/0707/1.png)\\n\\n## Good first issue\\n\\n### Issue #1075\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix-ingress-controller/issues/1075\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5728\u5f53\u524d\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u4f1a\u4f7f\u7528\u6700\u65b0\u7248\u672c\u7684 APISIX \u8fdb\u884c e2e \u6d4b\u8bd5\uff0c\u4ee5\u786e\u4fdd APISIX Ingress \u548c APISIX \u7684\u517c\u5bb9\u6027\uff0c\u4f46\u662f\u6211\u4eec\u65e0\u6cd5\u5f97\u77e5 APISIX \u6700\u65b0\u7684\u4e00\u4e9b\u53d8\u5316\u3002\u56e0\u6b64\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u8ba1\u5212\u4efb\u52a1\uff0c\u6765\u4f7f\u7528  `apisix:dev` \u955c\u50cf\u8fdb\u884c\u56de\u5f52\u6d4b\u8bd5\u3002\\n\\n\u5728\u6b64\u4e4b\u524d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528 `apisix:dev` \u8fdb\u884c e2e \u6d4b\u8bd5\uff0c\u4f46\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u5f71\u54cd\u5f00\u53d1\u4f53\u9a8c\uff0c\u56e0\u4e3a\u6709\u65f6\u5019\u53d1\u73b0 e2e \u6d4b\u8bd5\u5931\u8d25\u4e86\uff0c\u4f46\u5b9e\u9645\u4e0a\u662f\u7531\u4e8e APISIX \u53d1\u751f\u4e86\u53d8\u5316\u800c\u6ca1\u6709\u540c\u6b65\u5230 APISIX Ingress \u4e2d\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [`kafka` \u63d2\u4ef6\u65b0\u589e\u76f8\u5173\u53c2\u6570\u652f\u6301](https://github.com/apache/apisix/pull/7266)\uff08\u8d21\u732e\u8005\uff1a[mikawudi](https://github.com/mikawudi)\uff09\\n\\n- [\u5141\u8bb8\u7528\u6237\u81ea\u5b9a\u4e49\u63d2\u4ef6\u4f18\u5148\u7ea7](https://github.com/apache/apisix/pull/7273)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [\u652f\u6301\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 plugin_metadata](https://github.com/apache/apisix/pull/7315)\uff08\u8d21\u732e\u8005\uff1a[fesily](https://github.com/fesily)\uff09\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u52a9\u529b\u5f00\u53d1\u8005\uff0c\u5168\u65b9\u4f4d\u89e3\u8bfb APISIX \u6d4b\u8bd5\u6848\u4f8b](https://apisix.apache.org/zh/blog/2022/06/27/getting-start-with-apisix-test-cases)\\n\\n\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u5982\u4f55\u7f16\u5199\u4ee5\u53ca\u8fd0\u884c APISIX \u7684\u6d4b\u8bd5\u6848\u4f8b\u3002\\n\\n- [APISIX \u4e0e Ory Hydra \u96c6\u6210\u4e30\u5bcc\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f](https://apisix.apache.org/zh/blog/2022/07/04/apisix-integrates-with-hydra)\\n\\n\u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u5982\u4f55\u4e0e Ory Hydra \u96c6\u6210\u5b9e\u73b0\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u3002\\n\\n- [\u4f7f\u7528 Keycloak \u4e0e API \u7f51\u5173\u4fdd\u62a4\u4f60\u7684 API](https://apisix.apache.org/zh/blog/2022/07/06/use-keycloak-with-api-gateway-to-secure-apis)\\n\\n\u672c\u7bc7\u6587\u7ae0\u5c06\u4e00\u6b65\u4e00\u6b65\u5f15\u5bfc\u4f60\u5982\u4f55\u4f7f\u7528 API \u7f51\u5173\u4e0e Keycloak \u4fdd\u62a4\u4f60\u7684 API\u3002\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"\u4f7f\u7528 Keycloak \u4e0e API \u7f51\u5173\u4fdd\u62a4\u4f60\u7684 API","metadata":{"permalink":"/zh/blog/2022/07/06/use-keycloak-with-api-gateway-to-secure-apis","source":"@site/blog/2022/07/06/use-keycloak-with-api-gateway-to-secure-apis.md","title":"\u4f7f\u7528 Keycloak \u4e0e API \u7f51\u5173\u4fdd\u62a4\u4f60\u7684 API","description":"\u672c\u7bc7\u6587\u7ae0\u5c06\u4e00\u6b65\u4e00\u6b65\u5f15\u5bfc\u4f60\u5982\u4f55\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u4e0e Keycloak \u4fdd\u62a4\u4f60\u7684 API\uff0c\u5e76\u4e14\u4ecb\u7ecd\u4e86 OpenID Connect \u76f8\u5173\u6982\u5ff5\u4ee5\u53ca\u4ea4\u4e92\u6d41\u7a0b\u548c\u76f8\u5173\u672f\u8bed\u3002","date":"2022-07-06T00:00:00.000Z","formattedDate":"2022\u5e747\u67086\u65e5","tags":[{"label":"Authentication","permalink":"/zh/blog/tags/authentication"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":9.715,"truncated":true,"authors":[{"name":"\u6731\u6b23\u6b23","title":"Apache APISIX Committer","url":"https://github.com/starsz","image_url":"https://github.com/starsz.png","imageURL":"https://github.com/starsz.png"},{"name":"\u741a\u81f4\u8fdc","title":"Apache Member","url":"https://github.com/juzhiyuan","image_url":"https://github.com/juzhiyuan.png","imageURL":"https://github.com/juzhiyuan.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5 6.16 - 6.30","permalink":"/zh/blog/2022/07/07/weekly-report-0630"},"nextItem":{"title":"\u5982\u4f55\u4f7f\u7528 DataAnt \u76d1\u63a7 Apache APISIX","permalink":"/zh/blog/2022/07/05/use-dataant-to-monitor-apisix"}},"content":"> \u672c\u7bc7\u6587\u7ae0\u5c06\u4e00\u6b65\u4e00\u6b65\u5f15\u5bfc\u4f60\u5982\u4f55\u4f7f\u7528 API \u7f51\u5173\u4e0e Keycloak \u4fdd\u62a4\u4f60\u7684 API\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nOpenID Connect \u53c8\u540d OIDC\uff0c\u662f\u57fa\u4e8e OAuth 2.0 \u7684\u8ba4\u8bc1\u534f\u8bae\u3002\u5b83\u5141\u8bb8\u5ba2\u6237\u7aef\u4ece\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1 IdP \u83b7\u53d6\u7528\u6237\u57fa\u672c\u4fe1\u606f\uff0c\u5e38\u89c1\u7684 IdP \u6709\uff1aKeycloak\u3001Ory\u3001Okta\u3001Auth0\u3001Authing \u7b49\u3002\\n\\n\u5f00\u6e90\u7684 API \u7f51\u5173 Apache APISIX \u652f\u6301\u4f7f\u7528 openid-connect \u63d2\u4ef6\u5bf9\u63a5\u4ee5\u4e0a\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\uff0cAPISIX \u4f1a\u5c06\u6240\u6709\u672a\u8ba4\u8bc1\u7684\u8bf7\u6c42\u91cd\u5b9a\u5411\u81f3\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u7684\u767b\u5f55\u9875\uff0c\u5f53\u767b\u5f55\u6210\u529f\u540e APISIX \u4f1a\u5c06\u83b7\u53d6\u5230\u7684\u7528\u6237\u4fe1\u606f\u53d1\u9001\u81f3\u4e0a\u6e38\u670d\u52a1\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/1.png)\\n\\nKeycloak \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u8eab\u4efd\u8ba4\u8bc1\u7ba1\u7406\u670d\u52a1\uff0c\u53ef\u4f5c\u4e3a IdP \u6765\u4f7f\u7528\u3002\u5b83\u4e3a\u5e94\u7528\u7a0b\u5e8f\u589e\u52a0\u4e86\u8ba4\u8bc1\u670d\u52a1\uff0c\u5e76\u80fd\u901a\u8fc7\u6700\u5c0f\u7684\u4ee3\u4ef7\u4fdd\u8bc1\u670d\u52a1\u7684\u5b89\u5168\u3002\u540c\u65f6\uff0c\u5b83\u8fd8\u63d0\u4f9b\u4e86\u7528\u6237\u8054\u90a6\u3001\u5f3a\u8ba4\u8bc1\u3001\u7528\u6237\u7ba1\u7406\u3001\u7ec6\u7c92\u5ea6\u6388\u6743\u7b49\u529f\u80fd\u3002\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c06\u4ee5 Keycloak \u4e3a\u4f8b\uff0c\u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u5c06\u5176\u4e0e APISIX \u5bf9\u63a5\uff0c\u4ee5\u4fdd\u62a4\u4f60\u7684\u670d\u52a1\u3002\\n\\n## \u6d41\u7a0b\u63cf\u8ff0\\n\\n\u4e0b\u56fe\u4e3a OpenID Connect \u534f\u8bae\u4ea4\u4e92\u6d41\u7a0b\uff1a\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/2.png)\\n\\n\u5728\u91cd\u5b9a\u5411\u9636\u6bb5\uff08Redirect\uff09\uff0cIdP \u5c06\u7528\u6237\u91cd\u5b9a\u5411\u5230\u4e00\u4e2a\u9884\u5148\u914d\u7f6e\u597d\u7684\u91cd\u5b9a\u5411 URL\uff08redirect_url\uff09\uff0c\u4f8b\u5982 `http://127.0.0.1:9080/callback`\u3002\u8bf7\u6ce8\u610f\uff1a\u8fd9\u662f\u4e00\u4e2a\u5728 APISIX \u4e2d\u4e0d\u5b58\u5728\u7684 API\uff0c\u5b83\u53ea\u7528\u4e8e\u6355\u83b7\u76f8\u5173\u7684\u8bf7\u6c42\uff0c\u5e76\u5728 OIDC \u903b\u8f91\u4e2d\u5b8c\u6210 Token \u4ea4\u6362\u7684\u529f\u80fd\u3002\u8bf7\u4e0d\u8981\u4f7f\u7528\u8fd9\u4e2a\u5730\u5740\u4f5c\u4e3a\u89e6\u53d1 OIDC \u63d2\u4ef6\u91cd\u5b9a\u5411\u7684\u6761\u4ef6\uff0c\u5426\u5219\uff0c\u5b83\u5c06\u8fd4\u56de\u5982\u4e0b\u9519\u8bef\uff1a`the error request to the redirect_uri path, but there\'s no session state found`\u3002\\n\\n## \u76f8\u5173\u672f\u8bed\\n\\n1. Bearer Only\uff1a Keycloak \u652f\u6301\u8d26\u6237\u5bc6\u7801\u6216 AccessToken \u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\uff0c\u82e5\u542f\u7528 bearer_only \u9009\u9879\uff0c\u5219\u4ec5\u5141\u8bb8\u901a\u8fc7 AccessToken \u8fdb\u884c\u8ba4\u8bc1\uff0c\u8be5\u65b9\u5f0f\u9002\u7528\u4e8e\u670d\u52a1\u4e4b\u95f4\u7684\u8bbf\u95ee\u8ba4\u8bc1\uff1b\\n2. Realm\uff1a Keycloak \u4e2d\u7684 Realm \u76f8\u5f53\u4e8e\u4e00\u4e2a\u79df\u6237\uff0c\u4e0d\u540c Realm \u662f\u76f8\u4e92\u9694\u79bb\u7684\uff0c\u53ea\u80fd\u7ba1\u7406\u548c\u9a8c\u8bc1\u5b83\u4eec\u6240\u5177\u6709\u7684\u7528\u6237\uff1b\\n3. Scope\uff1a\u8fd9\u662f\u4e00\u79cd\u9650\u5236\u5728\u8bbf\u95ee\u4ee4\u724c\uff08AccessToken\uff09\u4e2d\u58f0\u660e\u7684\u89d2\u8272\u7684\u65b9\u6cd5\u3002\u4f8b\u5982\uff0c\u5f53\u4e00\u4e2a\u5ba2\u6237\u7aef\u8981\u6c42\u9a8c\u8bc1\u4e00\u4e2a\u7528\u6237\u65f6\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u7684\u8bbf\u95ee\u4ee4\u724c\u5c06\u53ea\u5305\u542b\u8303\u56f4\u660e\u786e\u6307\u5b9a\u7684\u89d2\u8272\u6620\u5c04\u3002\u5ba2\u6237\u7aef\u8303\u56f4\u5141\u8bb8\u4f60\u9650\u5236\u6bcf\u4e2a\u5355\u72ec\u7684\u8bbf\u95ee\u4ee4\u724c\u7684\u6743\u9650\uff0c\u800c\u4e0d\u662f\u8ba9\u5ba2\u6237\u7aef\u8bbf\u95ee\u7528\u6237\u7684\u6240\u6709\u6743\u9650\uff1b\\n4. User\uff1aUser \u662f\u53ef\u4ee5\u767b\u5f55\u5230 Keycloak \u7684\u7528\u6237\uff0c\u53ef\u4ee5\u601d\u8003\u4e0b\u4f60\u6240\u7528\u8fc7\u7684 SSO \u767b\u5f55\u670d\u52a1\uff1b\\n5. Client\uff1a\u5ba2\u6237\u7aef\u662f\u6307\u60f3\u8981\u4f7f\u7528 Keycloak \u6765\u4fdd\u62a4\u7684\u670d\u52a1\u3002\\n\\n## \u524d\u7f6e\u6b65\u9aa4\\n\\n> 1. \u672c\u6307\u5357\u5c06\u4f7f\u7528 Docker \u8fdb\u884c Keycloak \u7684\u5b89\u88c5\u4e0e\u542f\u52a8\uff1b\\n> 2. \u672c\u6307\u5357\u6240\u7528\u670d\u52a1\u5668\u73af\u5883\u4e3a CentOS 7\uff0cIP \u4e3a 127.0.0.1\u3002\\n\\n### \u5b89\u88c5 Apache APISIX\\n\\n\u8bf7\u53c2\u8003 https://apisix.apache.org/docs/apisix/getting-started \u5b89\u88c5\u3001\u542f\u52a8 APISIX\uff0c\u672c\u793a\u4f8b\u4e2d APISIX \u5b9e\u4f8b\u5730\u5740\u4e3a `http://127.0.0.1:9080/`\u3002\\n\\n### \u914d\u7f6e Keycloak\\n\\n\u8bf7\u5728\u670d\u52a1\u5668\u4e2d\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5 18.0.2 \u7248\u672c\u7684 Keycloak\uff1a\\n\\n```shell\\ndocker run -d -p 8080:8080 -e KEYCLOAK_ADMIN=admin -e KEYCLOAK_ADMIN_PASSWORD=admin quay.io/keycloak/keycloak:18.0.2 start-dev\\n```\\n\\n\u542f\u52a8\u5b8c\u6210\u540e Keycloak \u5c06\u76d1\u542c `8080` \u7aef\u53e3\uff0c\u5e76\u4f7f\u7528 admin \u4f5c\u4e3a\u7ba1\u7406\u5458\u8d26\u6237\u4e0e\u5bc6\u7801\u3002\\n\\n#### \u521b\u5efa Realm\\n\\n\u8bbf\u95ee `http://127.0.0.1:8080/` \u5c06\u663e\u793a\u5982\u4e0b\u754c\u9762\uff0c\u8fd9\u8868\u793a Keycloak \u5df2\u6210\u529f\u8fd0\u884c\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/3.png)\\n\\n\u8bbf\u95ee Administrator Console \u5e76\u4f7f\u7528 admin \u4f5c\u4e3a\u8d26\u6237\u4e0e\u5bc6\u7801\u8fdb\u884c\u767b\u5f55\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/4.png)\\n\\n\u5b89\u88c5\u5b8c\u6bd5\u9996\u6b21\u767b\u9646\u65f6\uff0c\u7cfb\u7edf\u5185\u5c06\u9ed8\u8ba4\u521b\u5efa\u540d\u4e3a master \u7684 Realm\u3002Realm \u662f OIDC \u4f53\u7cfb\u4e2d\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u53ef\u7406\u89e3\u4e3a\u79df\u6237\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/5.png)\\n\\n\u9f20\u6807\u79fb\u52a8\u5230\u5de6\u4fa7 Master \u4e0a\u65b9\u65f6\u70b9\u51fb Add realm \u5e76\u8f93\u5165 myrealm \u4f5c\u4e3a Realm \u7684\u540d\u79f0\uff0c\u521b\u5efa\u3002\\n\\n\u5f53\u5b89\u88c5 Keycloak \u9996\u6b21\u767b\u5f55\u65f6\uff0c\u7cfb\u7edf\u4e2d\u4f1a\u9ed8\u8ba4\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a master \u7684 Realm\uff0c\u4f46\u5b83\u662f\u4e13\u95e8\u7528\u6765\u7ba1\u7406 Keycloak \u7684\uff0c\u6211\u4eec\u4e0d\u5e94\u8be5\u628a\u5b83\u7528\u4e8e\u6211\u4eec\u7684\u5e94\u7528\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Realm\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/6.png)\\n\\n\u521b\u5efa\u6210\u529f\u540e\u5c06\u770b\u5230\u5df2\u5207\u6362\u81f3 myrealm\uff0c\u4e14\u5e95\u90e8\u5b58\u6709 Endpoints -> OpenID Endpoint Configuration\uff0c\u5730\u5740\u4e3a `http://127.0.0.1:8080/realms/myrealm/.well-known/openid-configuration`\uff0c\u8fd9\u662f\u4e00\u4e2a\u670d\u52a1\u53d1\u73b0\u7684\u89c4\u8303\uff0c\u7a0d\u540e\u5c06\u4f7f\u7528\u8be5\u5730\u5740\u4f5c\u4e3a OIDC \u6240\u9700\u8981\u4f7f\u7528\u7684\u5404\u4e2a\u8282\u70b9\u5730\u5740\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/7.png)\\n\\n#### \u521b\u5efa User\\n\\n\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7528\u6237\u7528\u4e8e\u901a\u8fc7\u8d26\u6237\u5bc6\u7801\u8fdb\u884c\u767b\u9646\u8ba4\u8bc1\u3002\u9009\u62e9 Manage -> Users -> Add user\uff0c\u5e76\u8f93\u5165 myuser \u4f5c\u4e3a\u7528\u6237\u540d\uff0c\u4fdd\u5b58\u540e\u8bbf\u95ee Users \u9875\u9762\u5e76\u9009\u62e9 `View all users`\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/8.png)\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/9.png)\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/10.png)\\n\\n\u70b9\u51fb ID \u540e\u8fdb\u5165 Credentials \u9009\u9879\u5361\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u65b0\u5bc6\u7801\uff08\u672c\u793a\u4f8b\u4f7f\u7528 mypassword \u4f5c\u4e3a\u5bc6\u7801\uff09\u3002\u540c\u65f6\u5c06 Temporary \u8bbe\u7f6e\u4e3a OFF\uff0c\u4ee5\u5173\u95ed\u9996\u6b21\u767b\u9646\u5fc5\u987b\u4fee\u6539\u5bc6\u7801\u7684\u9650\u5236\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/11.png)\\n\\n\u70b9\u51fb Set Password \u4fdd\u5b58\u8bbe\u7f6e\u3002\\n\\n#### \u521b\u5efa Client\\n\\n\u8bbf\u95ee Configure -> Clients -> Create \u4ee5\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Client\uff0c\u8fd9\u5c06\u7528\u4e8e\u4e4b\u540e\u914d\u7f6e APISIX\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/12.png)\\n\\n\u8f93\u5165 Client ID \u5e76\u4fdd\u5b58\uff0c\u672c\u4f8b\u4f7f\u7528 myclient \u4f5c\u4e3a ID\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/13.png)\\n\\n\u4fdd\u5b58\u540e\u9700\u8981\u914d\u7f6e 2 \u4e2a\u53c2\u6570\uff1a\\n\\n1. Access Type\uff1a\u9ed8\u8ba4\u4e3a public\uff0c\u8bf7\u4fee\u6539\u4e3a credential \u4ee5\u83b7\u53d6 Client Secret\uff1b\\n2. Valid Redirect URIs\uff1a\u5f53\u767b\u9646\u6210\u529f\u65f6\uff0cKeycloak \u5c06\u643a\u5e26 state \u4e0e code \u91cd\u5b9a\u5411\u5ba2\u6237\u7aef\u81f3\u8be5\u5730\u5740\uff0c\u56e0\u6b64\u8bbe\u7f6e\u4e3a Apache APISIX \u7684\u7279\u5b9a\u56de\u8c03\u5730\u5740\uff0c\u4f8b\u5982 `http://127.0.0.1:9080/anything/callback`\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/14.png)\\n\\n\u8bbe\u7f6e\u5b8c\u6210\u540e\u4fdd\u5b58\uff0c\u6b64\u65f6\u9875\u9762\u9876\u90e8\u5c06\u51fa\u73b0 Credentials \u9009\u9879\u5361\uff0c\u5c06 Secret \u590d\u5236\u4e0b\u6765\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/15.png)\\n\\n### \u914d\u7f6e\u6c47\u603b\\n\\n#### Apache APISIX\\n\\n\u5b9e\u4f8b\u5730\u5740\uff1a`http://127.0.0.1:9080/`\\n\\n#### Keycloak\\n\\n1. \u670d\u52a1\u5730\u5740\uff1a`http://127.0.0.1:8080/`\\n2. Realm\uff1a`myrealm`\\n3. Client ID\uff1a`myclient`\\n4. Client Secret\uff1ae91CKZQwhxyDqpkP0YFUJBxiXJ0ikJhq\\n5. Redirect URI\uff1a`http://127.0.0.1:9080/anything/callback`\\n6. Discovery\uff1a`http://127.0.0.1:8080/realms/myrealm/.well-known/openid-configuration`\\n7. Logout URL\uff1a`/anything/logout`\\n8. Bearer Only: `false`\\n9. Username\uff1a`myuser`\\n10. Password\uff1a`mypassword`\\n\\n## \u573a\u666f\u793a\u4f8b\\n\\n### \u524d\u7f6e\u6761\u4ef6\\n\\n\u672c\u793a\u4f8b\u4f7f\u7528 httpbin.org/anything \u4f5c\u4e3a\u4e0a\u6e38\u670d\u52a1\uff0c\u5b83\u5c06\u8fd4\u56de\u8bf7\u6c42\u4e2d\u7684\u6240\u6709\u5185\u5bb9\u3002\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/16.png)\\n\\n### \u573a\u666f\u4e00\uff1a\u4f7f\u7528\u8d26\u6237\u5bc6\u7801\u4fdd\u62a4\u4e0a\u6e38\u670d\u52a1\\n\\n\u672c\u793a\u4f8b\u5c06\u5f15\u5bfc\u5ba2\u6237\u7aef\u5230\u767b\u9646\u9875\u901a\u8fc7\u8d26\u6237\u5bc6\u7801\u7684\u65b9\u5f0f\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\uff1a\\n\\n1. \u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u521b\u5efa\u4e00\u6761 API\uff1a\\n\\n```shell\\ncurl -XPUT 127.0.0.1:9080/apisix/admin/routes/1 -H \\"X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\\" -d \'{\\n    \\"uri\\":\\"/anything/*\\",\\n    \\"plugins\\": {\\n        \\"openid-connect\\": {\\n            \\"client_id\\": \\"myclient\\",\\n            \\"client_secret\\": \\"e91CKZQwhxyDqpkP0YFUJBxiXJ0ikJhq\\",\\n            \\"discovery\\": \\"http://127.0.0.1:8080/realms/myrealm/.well-known/openid-configuration\\",\\n            \\"scope\\": \\"openid profile\\",\\n            \\"bearer_only\\": false,\\n            \\"realm\\": \\"myrealm\\",\\n            \\"redirect_uri\\": \\"http://127.0.0.1:9080/anything/callback\\",\\n            \\"logout_path\\": \\"/anything/logout\\"\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"httpbin.org:80\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/17.png)\\n\\n2. \u521b\u5efa API \u6210\u529f\u540e\u8bbf\u95ee `http://127.0.0.1:9080/anything/test` \u65f6\uff0c\u7531\u4e8e\u672a\u8fdb\u884c\u767b\u5f55\uff0c\u56e0\u6b64\u5c06\u88ab\u5f15\u5bfc\u5230 Keycloak \u7684\u767b\u5f55\u9875\u9762\uff1a\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/18.png)\\n\\n3. \u8f93\u5165\u8d26\u53f7\uff08myuser\uff09\u3001\u5bc6\u7801\uff08mypassword\uff09\u5b8c\u6210\u767b\u5f55\u540e\uff0c\u6210\u529f\u8df3\u8f6c\u5230 `http://127.0.0.1:9080/anything/test` \u9875\u9762\uff1a\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/19.png)\\n\\n4. \u8bbf\u95ee `http://127.0.0.1:9080/anything/logout` \u9000\u51fa\u767b\u5f55\uff1a\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/20.png)\\n\\n### \u573a\u666f\u4e8c\uff1a\u4f7f\u7528 AccessToken \u9a8c\u8bc1\u8eab\u4efd\\n\\n\u901a\u8fc7\u542f\u7528 bearer_only \u53c2\u6570\u5bf9\u5e94\u7528\u4e4b\u95f4\u7684\u8c03\u7528\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\uff0c\u6b64\u65f6\u5e94\u7528\u8bbf\u95ee APISIX \u65f6\u9700\u643a\u5e26 Authorization Header\uff0c\u5426\u5219\u8be5\u8bf7\u6c42\u5c06\u88ab\u62d2\u7edd\u3002\\n\\n1. \u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u521b\u5efa\u4e00\u6761 API\uff1a\\n\\n```shell\\ncurl -XPUT 127.0.0.1:9080/apisix/admin/routes/1 -H \\"X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\\" -d \'{\\n    \\"uri\\":\\"/anything/*\\",\\n    \\"plugins\\": {\\n        \\"openid-connect\\": {\\n            \\"client_id\\": \\"myclient\\",\\n            \\"client_secret\\": \\"e91CKZQwhxyDqpkP0YFUJBxiXJ0ikJhq\\",\\n            \\"discovery\\": \\"http://127.0.0.1:8080/realms/myrealm/.well-known/openid-configuration\\",\\n            \\"scope\\": \\"openid profile\\",\\n            \\"bearer_only\\": true,\\n            \\"realm\\": \\"myrealm\\",\\n            \\"redirect_uri\\": \\"http://127.0.0.1:9080/anything/callback\\",\\n            \\"logout_path\\": \\"/anything/logout\\"\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"httpbin.org:80\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/21.png)\\n\\n2. \u672a\u643a\u5e26 X-Access-Token \u8bbf\u95ee Apache APISIX \u65f6\u5c06\u8fd4\u56de 401 \u8868\u660e\u672a\u7ecf\u6388\u6743\uff1a\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/22.png)\\n\\n3. \u8c03\u7528 Keycloak API \u83b7\u53d6 AccessToken\uff1a\\n\\n```shell\\ncurl -XPOST \\"http://127.0.0.1:8080/realms/myrealm/protocol/openid-connect/token\\" -d \\"grant_type=password&username=myuser&client_id=myclient&client_secret=e91CKZQwhxyDqpkP0YFUJBxiXJ0ikJhq&password=mypassword\\"\\n```\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/23.png)\\n\\n4. \u5c06 AccessToken \u653e\u4e8e Authorization \u5934\u4e2d\u8bf7\u6c42 APISIX\uff08\u66ff\u6362\u6389 `${AccessToken}`\uff09\uff0c\u53ef\u4ee5\u8ba4\u8bc1\u6210\u529f\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/anything/test -H \\"Authorization: Bearer ${AccessToken}\\"\\n```\\n\\n![screenshot](https://static.apiseven.com/2022/blog/0706/24.png)\\n\\n### \u573a\u666f\u4e09\uff1a\u4e0a\u6e38\u670d\u52a1\u89e3\u6790 UserInfo \u4fe1\u606f\\n\\n\u5f53\u542f\u7528 APISIX `set_userinfo_header` \u914d\u7f6e\u540e\uff0c\u8ba4\u8bc1\u6210\u529f\u540e\u56de\u8c03\u8bf7\u6c42\u5c06\u643a\u5e26 `X-Userinfo` \u8bf7\u6c42\u5934\uff0c\u5b83\u5305\u542b\u4e86 User \u7684\u57fa\u672c\u4fe1\u606f\uff0c\u53ef\u901a\u8fc7 `base64_decode` \u83b7\u5f97\u7528\u6237\u5185\u5bb9\u3002\\n\\n## \u5e38\u89c1\u95ee\u9898\\n\\n1. **\u4e3a\u4ec0\u4e48 APISIX \u4e2d Cookie \u503c\u975e\u5e38\u957f\uff1f**\\n\\n\u56e0\u4e3a APISIX \u4f1a\u5c06 `id_token`\u3001`access_token`\u3001`refresh_token` \u7b49\u503c\u5199\u5165 Cookie \u4e2d\uff0c\u56e0\u6b64\u6574\u4e2a Cookie \u5185\u5bb9\u6bd4\u8f83\u957f\u3002\u5177\u4f53\u5b9e\u73b0\u53ef\u9605\u8bfb `lua-resty-openidc` \u5e93\u4e2d\u8bbe\u7f6e session \u7684\u903b\u8f91\u3002\\n\\n2. **\u5982\u4f55\u4fee\u6539 Session \u5b58\u50a8\u7684 Cookie \u540d\u79f0\u3001\u5b58\u50a8\u4f4d\u7f6e\uff1f**\\n\\n\u76ee\u524d openid-connect \u63d2\u4ef6\u672a\u63d0\u4f9b\u81ea\u5b9a\u4e49\u8fd9\u90e8\u5206\u914d\u7f6e\u7684\u80fd\u529b\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528 lua-resty-session \u4e2d\u63d0\u4f9b\u7684\u65b9\u6cd5\uff1a\u901a\u8fc7 NGINX \u53d8\u91cf\u7684\u65b9\u5f0f\u5bf9\u5176\u9ed8\u8ba4\u914d\u7f6e\u8fdb\u884c\u8986\u76d6\u3002\\n\u6b64\u5904\u501f\u52a9 APISIX \u63d0\u4f9b\u7684 NGINX \u914d\u7f6e\u6ce8\u5165\u80fd\u529b\u4ee5\u5b9e\u73b0\u8986\u76d6\uff1a\u901a\u8fc7\u5728\u914d\u7f6e\u6587\u4ef6 {apisix}/conf/config.yaml \u4e2d\u6dfb\u52a0\u8fd9\u4e9b\u4ee3\u7801\uff0c\u53ef\u4fee\u6539 Session \u5b58\u50a8 Cookie \u7684\u540d\u79f0\uff1a\\n\\n```yaml\\nnginx_config:\\n  http_server_configuration_snippet: |\\n    set $session_name \\"session_override\\";\\n```\\n\\n\u66f4\u591a\u914d\u7f6e\u9879\u53ef\u53c2\u8003\uff1a\\n\\n1. [lua-resty-session Init phase](https://github.com/bungle/lua-resty-session/blob/master/lib/resty/session.lua#L348-L380)\\n2. [lua-resty-session Pluggable Storage Adapters](https://github.com/bungle/lua-resty-session#pluggable-storage-adapters)\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n1. [Integrate Keycloak with APISIX](https://apisix.apache.org/zh/blog/2021/12/10/integrate-keycloak-auth-in-apisix/)\\n2. [Keycloak Getting Started](https://www.keycloak.org/getting-started/getting-started-docker)\\n3. [Keycloak Realm vs Client](https://stackoverflow.com/questions/56561554/keycloak-realm-vs-keycloak-client)\\n4. [Keycloak Client vs User](https://stackoverflow.com/questions/49107701/keycloak-client-vs-user)\\n5. [What is Client Scope?](https://wjw465150.gitbooks.io/keycloak-documentation/content/server_admin/topics/roles/client-scope.html)"},{"id":"\u5982\u4f55\u4f7f\u7528 DataAnt \u76d1\u63a7 Apache APISIX","metadata":{"permalink":"/zh/blog/2022/07/05/use-dataant-to-monitor-apisix","source":"@site/blog/2022/07/05/use-dataant-to-monitor-apisix.md","title":"\u5982\u4f55\u4f7f\u7528 DataAnt \u76d1\u63a7 Apache APISIX","description":"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u5982\u4f55\u901a\u8fc7 DataAnt Agent \u5c06\u4e91\u539f\u751f API Gateway Apache APISIX \u7684\u6307\u6807\u6570\u636e\u4e0a\u4f20\u5230 DataAnt \u76d1\u63a7\u7cfb\u7edf\uff0c\u5b9e\u73b0\u5bf9 Apache APISIX \u8fdb\u884c\u76d1\u63a7\u3002","date":"2022-07-05T00:00:00.000Z","formattedDate":"2022\u5e747\u67085\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":4.66,"truncated":true,"authors":[{"name":"\u97e9\u98de","title":"Author","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"\u4f7f\u7528 Keycloak \u4e0e API \u7f51\u5173\u4fdd\u62a4\u4f60\u7684 API","permalink":"/zh/blog/2022/07/06/use-keycloak-with-api-gateway-to-secure-apis"},"nextItem":{"title":"APISIX \u4e0e Ory Hydra \u96c6\u6210\u4e30\u5bcc\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f","permalink":"/zh/blog/2022/07/04/apisix-integrates-with-hydra"}},"content":"> \u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 DataAnt Agent \u5c06 API Gateway Apache APISIX \u7684\u6307\u6807\u6570\u636e\u4e0a\u4f20\u5230 DATAANT \u76d1\u63a7\u7cfb\u7edf\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\nApache APISIX \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u4f5c\u4e3a API \u7f51\u5173\uff0c\u5b83\u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7b49\u7279\u70b9\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u6765\u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4ee5\u53ca\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5f53\u505a K8s Ingress controller \u6765\u4f7f\u7528\u3002\u5f97\u76ca\u4e8e APISIX \u5168\u52a8\u6001\u7684\u8bbe\u8ba1\uff0c\u53ef\u4ee5\u968f\u65f6\u8fdb\u884c\u914d\u7f6e\u66f4\u6539\u5e76\u4e14\u5747\u4e0d\u9700\u8981\u91cd\u542f\u670d\u52a1\u3002\\n\\nDataAnt \u5168\u6808\u4e91\u76d1\u63a7\u7cfb\u7edf\u901a\u8fc7\u5927\u6570\u636e\u548c\u673a\u5668\u5b66\u4e60\u80fd\u591f\u6c47\u603b IaaS\u3001PaaS \u548c SaaS \u5c42\u6240\u6709\u8fd0\u7ef4\u6570\u636e\uff0c\u7ed9\u7528\u6237\u63d0\u4f9b\u7edf\u4e00\u53ef\u89c6\u5316\u754c\u9762\u3002DataAnt \u5141\u8bb8\u7528\u6237\u5728\u76f8\u5173\u76d1\u63a7\u6570\u636e\u6e90\u4e4b\u95f4\u65e0\u7f1d\u5feb\u901f\u5730\u79fb\u52a8\uff0c\u800c\u65e0\u9700\u5207\u6362\u5de5\u5177\uff0c\u66f4\u7cbe\u7ec6\u5730\u4e86\u89e3\u5230\u81ea\u5df1 IT \u7cfb\u7edf\u7684\u72b6\u6001\u3002\u5176\u63d0\u4f9b\u7684 DataAnt Agent \u53ef\u4ee5\u5b9e\u65f6\u76d1\u63a7 APISIX \u5e76\u5c06\u5176\u76d1\u63a7\u6570\u636e\u4e0a\u4f20\u5230 DataAnt PaSS \u5e73\u53f0\uff0c\u5b9e\u73b0\u4e91\u7aef\u4e00\u7ad9\u5f0f\u76d1\u63a7\u3002\\n\\n## \u539f\u7406\u7b80\u4ecb\\n\\n![principle](https://static.apiseven.com/2022/blog/0705/1.svg)\\n\\n1. \u91c7\u96c6\u914d\u7f6e\\n\\n  DataAnt Agent \u9996\u5148\u4f1a\u901a\u8fc7 `config.yaml` \u7684\u914d\u7f6e\u7684 APISIX \u9879\u8fdb\u884c\u91c7\u96c6\u5668\u521d\u59cb\u5316\u548c\u6ce8\u518c\u3002\u540c\u4e00\u4e2a Agent \u53ef\u4ee5\u6ce8\u518c\u591a\u4e2a\u91c7\u96c6\u5668\u3002\u91c7\u96c6\u5668\u6536\u96c6 APISIX \u66b4\u9732\u7684\u6307\u6807\u540e\uff0c\u5bf9\u6307\u6807\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\u4e0a\u4f20\u5230 DataAnt Cloud\u3002\\n\\n2. \u6570\u636e\u53ef\u89c6\u5316\\n\\n  DataAnt Cloud \u5728\u63a5\u6536\u5230\u6570\u636e\u540e\uff0c\u6570\u636e\u7ecf\u8fc7\u521d\u6b65\u7684\u76d1\u63a7\u4fe1\u606f\u8865\u5145\u548c\u5904\u7406\u4f1a\u5b58\u653e\u5230\u65f6\u5e8f\u6570\u636e\u5e93\u4e2d\uff0c\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7 DataAnt \u7684 Dashboard \u5b9e\u65f6\u76d1\u63a7 APISIX\u3002\\n\\n3. \u544a\u8b66\u901a\u77e5\\n\\n  \u6570\u636e\u8fd8\u5c06\u901a\u8fc7\u6d88\u606f\u5206\u53d1\u5230\u544a\u8b66\u5339\u914d\u5904\u7406\uff0c\u7136\u540e\u518d\u8fdb\u884c\u901a\u77e5\u805a\u5408\u6700\u7ec8\u901a\u8fc7\u914d\u7f6e\u7684\u901a\u77e5\u65b9\u5f0f\u5c06\u544a\u8b66\u53d1\u9001\uff0c\u5373\u53ef\u4ee5\u5b9e\u65f6\u63a5\u6536\u5230 APISIX \u7684\u5f02\u5e38\u60c5\u51b5\u3002\\n\\n## \u914d\u7f6e\u6307\u5357\\n\\n1. \u9996\u5148\u8bf7\u8bbf\u95ee [DataAnt Cloud](http://139.224.11.158)\uff0c\u6ce8\u518c\u8d26\u6237\u5e76\u767b\u5f55\u5e73\u53f0\u3002\\n\\n2. \u901a\u8fc7[\u4e0b\u8f7d\u94fe\u63a5](https://pan.baidu.com/s/1fabvSiDLDh8ZRTjpzINHLg?pwd=87d4)\u83b7\u53d6 DataAnt \u7684 Agent\uff0c\u4e0b\u8f7d\u5b8c\u6210\u540e\u4e0a\u4f20\u5230 APISIX \u6240\u5728\u7684\u673a\u5668\u4e0a\u5e76\u7ed9 Agent \u6dfb\u52a0\u6267\u884c\u6743\u9650\u3002\\n\\n3. \u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa DataAnt Agent \u6240\u9700\u7684\u914d\u7f6e\u6587\u4ef6 `./config.yaml`\u3002\u8be6\u7ec6\u914d\u7f6e\u5982\u4e0b\uff1a\\n\\n  ```yaml\\n  tenantId: 11       # \u8be5 ID \u662f\u60a8\u7684 DataAnt \u5e73\u53f0\u7684\u7528\u6237 ID\\n  hostIp: 127.0.0.1  # \u4e3b\u673a\u7684\u6807\u8bc6 IP\\n  hostName: apisix\\n  configs:\\n    - uri: http://127.0.0.1:9091  # APISIX \u76d1\u63a7\u6307\u6807\u6240\u66b4\u9732\u7684\u7aef\u53e3\\n      type: apisix                # \u76d1\u63a7\u7c7b\u578b\u9009\u62e9 APISIX\\n      asName: apisix_test         # \u522b\u540d\\n  ```\\n\\n4. \u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8 Agent\u3002\\n\\n  ```shell\\n  ./agent\\n  ```\\n\\n  \u542f\u52a8\u6210\u529f\u540e\uff0c\u5219\u4f1a\u8fd4\u56de\u4ee5\u4e0b\u6570\u636e\uff1a\\n\\n  ```shell\\n  2022/06/21 20:50:10 {\\"code\\":200,\\"msg\\":\\"\u8bf7\u6c42\u6210\u529f\\",\\"data\\":null}\\n  2022/06/21 20:50:30 {\\"code\\":200,\\"msg\\":\\"\u8bf7\u6c42\u6210\u529f\\",\\"data\\":null}\\n  2022-06-21 20:51:00:000        INFO        apisix/apisix.go:25        \u83b7\u53d6\u5bf9\u5e94\u76d1\u63a7\u6570\u636e\uff0c\u6570\u636e\u957f\u5ea61675\\n  2022-06-21 20:51:00:000        INFO        prometheus/prometheusCollector.go:43        \u83b7\u53d6\u5bf9\u5e94\u76d1\u63a7\u6570\u636e\u5f00\u59cb\u89e3\u67901675\\n  2022-06-21 20:51:00:000        INFO        prometheus/prometheusCollector.go:43        \u83b7\u53d6\u5bf9\u5e94\u76d1\u63a7\u6570\u636e\u5b8c\u6210\u89e3\u6790 \u89e3\u6790\u6307\u6807\u6570\u91cf21\\n  2022-06-21 20:51:00:000        INFO        collector/collector.go:82        apisix\u91c7\u96c6\u5230\u6570\u636e\u6570\u91cf21\\n  2022-06-21 20:51:00:000        INFO        runtime/asm_amd64.s:1581        apisix_test9091:\u6307\u6807\u6570:21\\n  ```\\n\\n5. \u5728 DataAnt \u5e73\u53f0\u9996\u9875\u5355\u51fb`\u5b89\u88c5\u96c6\u6210\u63d2\u4ef6`>`\u76d1\u63a7\u63d2\u4ef6`\uff0c\u9009\u62e9 APISIX\uff0c\u5e76\u5355\u51fb`\u914d\u7f6e`\u4e0b\u7684`\u70b9\u51fb\u914d\u7f6e`\u3002\\n\\n6. \u5728 DataAnt \u5e73\u53f0\u9996\u9875\u5355\u51fb\u5de6\u4fa7\u5bfc\u822a\u680f\u7684`\u4eea\u8868\u76d8`\u5e76\u65b0\u5efa\u4eea\u8868\u76d8\u3002\u9009\u62e9\u81ea\u5df1\u9700\u8981\u7684\u6307\u6807\uff0c\u5e76\u62d6\u62fd\u5230\u4eea\u8868\u76d8\u4e0a\uff0c\u914d\u7f6e\u5b8c\u6210\u7684\u6307\u6807\u5982\u4e0b\uff1a\\n\\n  ![dashboard](https://static.apiseven.com/2022/blog/0705/2.PNG)\\n\\n  :::note\\n\\n  DataAnt Agent \u6bcf\u9694 30 \u79d2\u4f1a\u4e0a\u62a5\u4e00\u6b21\u6570\u636e\uff0c\u56e0\u6b64\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u5ef6\u8fdf\u3002\\n\\n  :::\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u5982\u4f55\u901a\u8fc7 DataAnt Agent \u4e0a\u4f20 APISIX \u7684\u6307\u6807\u6570\u636e\u5230 DATAANT \u76d1\u63a7\u7cfb\u7edf\u4e2d\uff0c\u4f60\u53ef\u4ee5\u5728\u540e\u7eed\u4f7f\u7528\u4e2d\u914d\u7f6e\u76f8\u5173\u62a5\u8b66\u89c4\u5219\u53ca\u62a5\u8b66\u8054\u7cfb\u4eba\uff0c\u5f53\u670d\u52a1\u51fa\u73b0\u6545\u969c\u65f6\u53ef\u4ee5\u53ca\u65f6\u5730\u901a\u77e5\u5230\u4f60\u3002"},{"id":"APISIX \u4e0e Ory Hydra \u96c6\u6210\u4e30\u5bcc\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f","metadata":{"permalink":"/zh/blog/2022/07/04/apisix-integrates-with-hydra","source":"@site/blog/2022/07/04/apisix-integrates-with-hydra.md","title":"APISIX \u4e0e Ory Hydra \u96c6\u6210\u4e30\u5bcc\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 API \u7f51\u5173 Apache APISIX \u901a\u8fc7 OpenID Connect \u63d2\u4ef6\u4e0e Ory Hydra \u96c6\u6210\u5b9e\u73b0\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\uff0c\u5e76\u4e14\u4ecb\u7ecd\u4e86\u5173\u4e8e Ory Hydra \u7684\u5e94\u7528\u573a\u666f\u53ca OpenID \u76f8\u5173\u77e5\u8bc6\u3002","date":"2022-07-04T00:00:00.000Z","formattedDate":"2022\u5e747\u67084\u65e5","tags":[{"label":"Authentication","permalink":"/zh/blog/tags/authentication"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":11.385,"truncated":true,"authors":[{"name":"Fei Han","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"},{"name":"Sylvia","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u5982\u4f55\u4f7f\u7528 DataAnt \u76d1\u63a7 Apache APISIX","permalink":"/zh/blog/2022/07/05/use-dataant-to-monitor-apisix"},"nextItem":{"title":"\u52a9\u529b\u5f00\u53d1\u8005\uff0c\u5168\u65b9\u4f4d\u89e3\u8bfb APISIX \u6d4b\u8bd5\u6848\u4f8b","permalink":"/zh/blog/2022/06/27/getting-start-with-apisix-test-cases"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u5982\u4f55\u4e0e Ory Hydra \u96c6\u6210\u5b9e\u73b0\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4ecb\u7ecd\\n\\n### Apache APISIX\\n\\n[Apache APISIX](https://github.com/apache/apisix) \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u4f5c\u4e3a API \u7f51\u5173\uff0c\u5b83\u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7b49\u7279\u70b9\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 APISIX \u6765\u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4ee5\u53ca\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5f53\u505a K8s Ingress controller \u6765\u4f7f\u7528\u3002\\n\\nAPISIX \u7684 `openid-connect` \u63d2\u4ef6\u652f\u6301 OpenID Connect \u534f\u8bae\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u8be5\u63d2\u4ef6\u8ba9 APISIX \u5bf9\u63a5\u4f17\u591a\u8ba4\u8bc1\u9274\u6743\u8f6f\u4ef6\uff0c\u4f5c\u4e3a\u96c6\u4e2d\u5f0f\u8ba4\u8bc1\u7f51\u5173\u90e8\u7f72\u4e8e\u4f01\u4e1a\u4e2d\u3002\\n\\n### ORY Hydra\\n\\n[Ory Hydra](https://github.com/ory/hydra) \u662f\u652f\u6301 OAuth 2.0 \u548c OpenID Connect \u534f\u8bae\u7684\u8eab\u4efd\u63d0\u4f9b\u5546\u4e4b\u4e00\uff0c\u57fa\u4e8e OAuth 2.0 \u6388\u6743\u6846\u67b6\u4ee5\u53ca Open ID Connect Core 1.0 \u6846\u67b6\u5b9e\u73b0\uff0c\u517c\u5177\u5f00\u6e90\u4e0e\u4e91\u539f\u751f\u7279\u6027\u3002\u5b83\u53ef\u4ee5\u4e0e\u4efb\u4f55\u767b\u5f55\u7cfb\u7edf\u96c6\u6210\uff0c\u901a\u8fc7 OAuth 2.0 Acces\u3001Refresh \u548c ID Tokens\uff0c\u4f7f\u5f97\u7b2c\u4e09\u65b9\u80fd\u591f\u8f7b\u677e\u8bbf\u95ee\u4f60\u7684 API\uff0c\u5b9e\u73b0\u7528\u6237\u968f\u65f6\u968f\u5730\u4e0e\u4efb\u4f55\u5e94\u7528\u7a0b\u5e8f\u7684\u4ea4\u4e92\u3002\\n\\nOry Hydra \u91c7\u7528 Go \u8bed\u8a00\u5f00\u53d1\uff0c\u4e3a\u51e0\u4e4e\u6240\u6709\u5f00\u53d1\u8bed\u8a00\u90fd\u63d0\u4f9b\u4e86 SDK\uff0c\u5305\u62ec Dart\u3001.NET\u3001Go\u3001Java\u3001PHP\u3001Python\u3001Ruby\u3001Rust \u548c Typescript\u3002\u5b83\u9002\u7528\u4e8e\u4efb\u4f55\u767b\u5f55\u7cfb\u7edf\uff0c\u5e76\u4e14\u53ef\u4ee5\u8f7b\u677e\u81ea\u5b9a\u4e49\u767b\u5f55\u4f53\u9a8c\u3002\\n\\n## \u7b80\u4ecb\\n\\nOpenID \u662f\u4e00\u79cd\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\uff0c\u5b83\u662f\u4e00\u4e2a\u53bb\u4e2d\u5fc3\u5316\u7684\u8eab\u4efd\u8ba4\u8bc1\u7cfb\u7edf\u3002\u4f7f\u7528 OpenID \u7684\u597d\u5904\u662f\uff1a\u7528\u6237\u53ea\u9700\u8981\u5728\u4e00\u4e2a OpenID \u8eab\u4efd\u63d0\u4f9b\u65b9\u7684\u7f51\u7ad9\u4e0a\u6ce8\u518c\u548c\u767b\u5f55\uff0c\u4f7f\u7528\u4e00\u4efd\u8d26\u6237\u5bc6\u7801\u4fe1\u606f\u5373\u53ef\u8bbf\u95ee\u4e0d\u540c\u5e94\u7528\u3002\\n\\n\u901a\u8fc7 APISIX \u652f\u6301\u7684 `openid-connect` \u63d2\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0e\u652f\u6301 OpenID Connect \u534f\u8bae\u7684\u8ba4\u8bc1\u7a0b\u5e8f\u96c6\u6210\u3002\u6bd4\u5982 Ory Hydra\u3002\u66f4\u591a\u4fe1\u606f\u8bf7\u53c2\u8003\uff1a[\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1](https://apisix.apache.org/zh/blog/2021/08/25/using-the-apache-apisix-openid-connect-plugin-for-centralized-authentication)\u3002\\n\\nOry Hydra \u7684\u6700\u5927\u4f18\u52bf\u4e4b\u4e00\u662f\uff1a\u5b83\u5b9e\u73b0\u4e86 OAuth \u548c OpenID Connect \u6807\u51c6\uff0c\u800c\u4e0d\u662f\u5f3a\u5236\u4f60\u4f7f\u7528 \u201cHydra \u7528\u6237\u7ba1\u7406\u201d\uff08\u767b\u5f55\u3001\u6ce8\u9500\u3001\u914d\u7f6e\u6587\u4ef6\u7ba1\u7406\u3001\u6ce8\u518c\uff09\u3001\u7279\u5b9a\u6a21\u677f\u5f15\u64ce\u6216\u8005\u9884\u5b9a\u4e49\u7684\u524d\u7aef\u3002\\n\\n\u5b83\u5141\u8bb8\u4f7f\u7528\u4f60\u7684\u7a0b\u5e8f\u6240\u9700\u7684\u8eab\u4efd\u9a8c\u8bc1\u673a\u5236\uff08\u57fa\u4e8e\u4ee4\u724c\u7684 2FA\u3001SMS 2FA \u7b49\uff09\uff0c\u5e76\u4e14\u5728\u4f60\u7684\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u5b9e\u73b0\u7528\u6237\u7ba1\u7406\u548c\u767b\u5f55\u3002\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u73b0\u6709\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4f8b\u5982 [authboss](https://github.com/go-authboss/authboss)\uff0c\u5e76\u4e3a\u4f60\u63d0\u4f9b OAuth 2.0 \u548c OpenID Connect \u7684\u6240\u6709\u4f18\u52bf\u529f\u80fd\uff0c\u540c\u65f6\u5bf9\u4e1a\u52a1\u903b\u8f91\u548c\u6280\u672f\u6808\u7684\u4fb5\u5165\u6027\u6700\u5c0f\u3002\\n\\nOAuth 2.0 \u9002\u7528\u4e8e\u591a\u79cd\u73af\u5883\u548c\u591a\u7528\u9014\u573a\u666f\u3002\u4ee5\u4e0b\u4fe1\u606f\u53ef\u80fd\u4f1a\u5e2e\u52a9\u4f60\u786e\u5b9a OAuth 2.0 \u548c Hydra \u662f\u5426\u9002\u5408\u67d0\u4e2a\u573a\u666f\uff1a\\n\\n1. \u5141\u8bb8\u7b2c\u4e09\u65b9\u7684\u5408\u4f5c\u65b9\u8bbf\u95ee\u4f60\u7684 API\u3002\\n2. \u6210\u4e3a\u50cf Google\u3001Facebook \u6216 Microsoft \u8fd9\u6837\u7684\u8eab\u4efd\u8ba4\u8bc1\u63d0\u4f9b\u8005\u3002\\n3. \u4f7f\u6d4f\u89c8\u5668\u3001\u79fb\u52a8\u8bbe\u5907\u6216\u53ef\u7a7f\u6234\u5e94\u7528\u7a0b\u5e8f\u80fd\u591f\u8bbf\u95ee\u4f60\u7684 API\uff1a\u8fd0\u884c OAuth2 \u63d0\u4f9b\u7a0b\u5e8f\u53ef\u4ee5\u5f88\u597d\u5730\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002\u4f60\u4e0d\u5fc5\u5728\u8bbe\u5907\u4e0a\u5b58\u50a8\u5bc6\u7801\uff0c\u5e76\u4e14\u53ef\u4ee5\u968f\u65f6\u64a4\u9500\u8bbf\u95ee\u4ee4\u724c\u3002\\n4. \u60f3\u8981\u9650\u5236\u540e\u7aef\u670d\u52a1\u53ef\u4ee5\u76f8\u4e92\u8bfb\u53d6\u7684\u4fe1\u606f\u7c7b\u578b\u3002\u4f8b\u5982\uff0c\u53ea\u5141\u8bb8\u8bc4\u8bba\u670d\u52a1\u83b7\u53d6\u7528\u6237\u914d\u7f6e\u6587\u4ef6\u66f4\u65b0\uff0c\u4f46\u4e0d\u80fd\u8bfb\u53d6\u7528\u6237\u5bc6\u7801\u3002\\n\\n## \u64cd\u4f5c\u6b65\u9aa4\\n\\n\u63a5\u4e0b\u6765\uff0c\u5c06\u4f7f\u7528\u771f\u5b9e\u793a\u4f8b\u4e3a\u4f60\u5c55\u793a APISIX \u5982\u4f55\u4e0e Hydra \u96c6\u6210\u3002\u5728\u8be5\u793a\u4f8b\u4e2d\u5c06\u4f7f\u7528 Docker \u90e8\u7f72\u6240\u9700\u7684\u73af\u5883\uff0c\u8bf7\u5728\u6267\u884c\u672c\u64cd\u4f5c\u524d\u5b89\u88c5\u5b8c\u6210 [Docker](https://docs.docker.com/engine/install/)\u3002\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u521b\u5efa\u5e76\u90e8\u7f72\u6570\u636e\u5e93\\n\\n\u4e3a\u4e86\u5feb\u901f\u90e8\u7f72\u6d4b\u8bd5\u73af\u5883\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 Docker \u8fd0\u884c PostgreSQL \u4f5c\u4e3a Hydra \u7684\u6570\u636e\u5e93\u3002\u5efa\u8bae\u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528 Docker \u8fd0\u884c\u6570\u636e\u5e93\u3002\\n\\n```shell\\ndocker network create hydraguide && \\\\\\ndocker run \\\\\\n  --network hydraguide \\\\\\n  --name ory-hydra-example--postgres \\\\\\n  -e POSTGRES_USER=hydra \\\\\\n  -e POSTGRES_PASSWORD=secret \\\\\\n  -e POSTGRES_DB=hydra \\\\\\n  -d postgres:9.6\\n```\\n\\n\u4e0a\u8ff0\u547d\u4ee4\u5c06\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u4e3a `hydraguide` \u7684\u7f51\u7edc\uff0c\u5e76\u4e14\u542f\u52a8\u4e00\u4e2a\u540d\u79f0\u4e3a `ory-hydra-example--postgres` \u7684 Postgres \u5b9e\u4f8b\uff0c\u8be5\u5b9e\u4f8b\u521b\u5efa\u4e86\u6570\u636e\u5e93 `hydra`\uff0c\u7528\u6237 `hydra` \u548c\u7528\u6237\u5bc6\u7801 `secret`\u3002\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u90e8\u7f72 Hydra\\n\\n\u8be5\u6b65\u9aa4\u4e2d\u4f1a\u5206\u522b\u5c06 `4444` \u548c `4445` \u6620\u5c04\u5230 `5444` \u548c `5445` \u7aef\u53e3\uff0c\u8bf7\u786e\u4fdd\u8fd9\u4e9b\u7aef\u53e3\u672a\u88ab\u5360\u7528\u3002\\n\\n1. \u7cfb\u7edf\u5bc6\u94a5\u53ea\u80fd\u9488\u5bf9\u65b0\u6570\u636e\u5e93\u8bbe\u7f6e\uff0c\u4e0d\u652f\u6301\u5bc6\u94a5\u8f6e\u6362\u3002 \u6b64\u5bc6\u94a5\u7528\u4e8e\u52a0\u5bc6\u6570\u636e\u5e93\uff0c\u6bcf\u6b21\u8fdb\u7a0b\uff08\u91cd\u65b0\uff09\u542f\u52a8\u65f6\u90fd\u9700\u8981\u8bbe\u7f6e\u4e3a\u76f8\u540c\u7684\u503c\u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528 `/dev/urandom` \u751f\u6210\u5bc6\u94a5\u3002\u4f46\u8bf7\u786e\u4fdd\u5728\u4f60\u5b9a\u4e49\u5b83\u7684\u65f6\u5019\uff0c\u8be5\u5bc6\u94a5\u90fd\u5fc5\u987b\u76f8\u540c\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u5c06\u503c\u5b58\u50a8\u5728\u67d0\u5904:\\n\\n```shell\\nexport SECRETS_SYSTEM=$(export LC_CTYPE=C; cat /dev/urandom | tr -dc \'a-zA-Z0-9\' | fold -w 32 | head -n 1)\\n```\\n\\n\u901a\u8fc7\u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u8bbe\u7f6e Hydra \u7684\u6570\u636e\u5e93 URL \u6307\u5411 Postgres \u5b9e\u4f8b\u3002\\n\\n```shell\\nexport DSN=postgres://hydra:secret@ory-hydra-example--postgres:5432/hydra?sslmode=disable\\n```\\n\\n2. Ory Hydra \u6ca1\u6709\u81ea\u52a8\u8fc1\u79fb\u6570\u636e\u5e93\uff0c\u56e0\u6b64\u4f60\u9700\u8981\u624b\u52a8\u6267\u884c\u8fc1\u79fb\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u3002\\n\\n```shell\\ndocker pull oryd/hydra:v1.10.6 && \\\\\\ndocker run -it --rm \\\\\\n  --network hydraguide \\\\\\n  oryd/hydra:v1.10.6 \\\\\\n  migrate sql --yes $DSN\\n```\\n\\n3. \u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u8fd0\u884c Hydra \u670d\u52a1\u5668\u3002\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u8003 [deploy-ory-hydra](https://www.ory.sh/docs/hydra/configure-deploy#deploy-ory-hydra)\u3002\\n\\n```shell\\ndocker run -d \\\\\\n  --name ory-hydra-example--hydra \\\\\\n  --network hydraguide \\\\\\n  -p 5444:4444 \\\\\\n  -p 5445:4445 \\\\\\n  -e SECRETS_SYSTEM=$SECRETS_SYSTEM \\\\\\n  -e DSN=$DSN \\\\\\n  -e URLS_SELF_ISSUER=https://localhost:5444/ \\\\\\n  -e URLS_CONSENT=http://localhost:9020/consent \\\\\\n  -e URLS_LOGIN=http://localhost:9020/login \\\\\\n  oryd/hydra:v1.10.6 serve all\\n```\\n\\n\u4f60\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b Hydra \u7684\u65e5\u5fd7\uff1a\\n\\n```shell\\ndocker logs ory-hydra-example--hydra\\n```\\n\\n:::note\\n\\n\u5982\u679c\u672a\u6307\u5b9a Hydra \u7684\u5bc6\u7801\uff0c\u4f60\u53ef\u4ee5\u5728\u65e5\u5fd7\u4e2d\u67e5\u5230\u5bc6\u7801\u4fe1\u606f\u3002\u5982\u679c\u5fd8\u8bb0\u5bc6\u7801\u5c06\u65e0\u6cd5\u91cd\u65b0\u542f\u52a8 Hydra\u3002\\n\\n:::\\n\\n\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b Hydra \u76f8\u5173\u4ecb\u7ecd\u53ca\u64cd\u4f5c\u547d\u4ee4\u3002\\n\\n```shell\\ndocker run -it --rm --entrypoint hydra oryd/hydra:v1.10.6 help serve\\n```\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u90e8\u7f72\u767b\u5f55\u548c\u9a8c\u8bc1\u7a0b\u5e8f\\n\\nLogin Provider \u548c Consent Provider \u53ef\u4ee5\u662f\u4e24\u4e2a\u72ec\u7acb\u7684 Web \u670d\u52a1\u3002 Hydra \u63d0\u4f9b\u4e86\u793a\u4f8b\u7a0b\u5e8f\uff0c\u5b83\u5728\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7ed3\u5408\u4e86\u8fd9\u4e24\u4e2a\u529f\u80fd\u3002 \u63a5\u4e0b\u6765\u3002\u6211\u4eec\u5c06\u4f7f\u7528 Docker \u90e8\u7f72\u8be5\u5e94\u7528\u7a0b\u5e8f\u3002\\n\\n```shell\\ndocker pull oryd/hydra-login-consent-node:v1.10.6 && \\\\\\ndocker run -d \\\\\\n  --name ory-hydra-example--consent \\\\\\n  -p 9020:3000 \\\\\\n  --network hydraguide \\\\\\n  -e HYDRA_ADMIN_URL=https://ory-hydra-example--hydra:4445 \\\\\\n  -e NODE_TLS_REJECT_UNAUTHORIZED=0 \\\\\\n  oryd/hydra-login-consent-node:v1.10.6\\n```\\n\\n\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u68c0\u67e5\u7a0b\u5e8f\u662f\u5426\u8fd0\u884c\u6b63\u5e38\uff1a\\n\\n```shell\\ndocker logs ory-hydra-example--consent\\n```\\n\\n\u6b63\u5e38\u8fd4\u56de\u7ed3\u679c\uff1a\\n\\n```shell\\n> hydra-login-consent-logout@0.0.0 serve /usr/src/app\\n> node lib/app.js\\n\\nListening on http://0.0.0.0:3000\\n```\\n\\n### \u6b65\u9aa4\u56db\uff1a\u6267\u884c OAuth 2.0 \u6388\u6743\u4ee3\u7801\u6d41\u7a0b\\n\\nHydra \u652f\u6301\u901a\u8fc7 CLI \u8bbe\u7f6e OAuth 2.0 \u4f7f\u7528\u8005\u548c OAuth 2.0 \u56de\u8c03 URL \u7684\u529f\u80fd\uff0c\u8fd9\u662f\u4e00\u4e2a\u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u7684\u7528\u6237\u8d44\u6e90\u7684\u7b2c\u4e09\u65b9\u5e94\u7528\u7a0b\u5e8f\u3002\\n\\n\u914d\u7f6e APISIX `openid-connect` \u63d2\u4ef6\u65f6\u9700\u8981\u63d0\u4f9b\u8fd9\u4e9b\u4fe1\u606f\uff1a\\n\\n- `id` \u5bf9\u5e94\u7684\u662f\u4e0b\u8ff0\u8def\u7531\u4e2d\u63d2\u4ef6\u914d\u7f6e\u7684 `client_id`\u3002\\n- `secret` \u5bf9\u5e94\u7684\u662f\u4e0b\u8ff0\u8def\u7531\u4e2d\u63d2\u4ef6\u914d\u7f6e\u7684 `client_secret`\u3002\\n- `scope` \u5bf9\u5e94\u7684\u662f\u4e0b\u8ff0\u8def\u7531\u4e2d\u63d2\u4ef6\u914d\u7f6e\u7684 `scope`\u3002\\n\\n```shell\\ndocker run --rm -it \\\\\\n  -e HYDRA_ADMIN_URL=https://ory-hydra-example--hydra:4445 \\\\\\n  -- network hydraguide \\\\\\n  oryd/hydra:v1.10.6 \\\\\\n  clients create --skip-tls-verify \\\\\\n    --id facebook-photo-backup \\\\\\n    --secret some-secret \\\\\\n    --grant-types authorization_code,refresh_token,client_credentials,implicit \\\\\\n    --response-types token,code,id_token \\\\\\n    --scope openid,offline,photos.read \\\\\\n    --callbacks http://127.0.0.1:9010/callback\\n```\\n\\n\u4ee5\u4e0b\u793a\u4f8b\u5c06\u6267\u884c\u4e00\u4e2a OAuth 2.0 \u6388\u6743\u6d41\u7a0b\u3002\u4e3a\u7b80\u5316\u6b64\u64cd\u4f5c\uff0cHydra CLI \u63d0\u4f9b\u4e86\u4e00\u4e2a\u540d\u4e3a `hydra token user` \u7684\u8f85\u52a9\u547d\u4ee4\u3002\\n\\n```shell\\n docker run --rm -it \\\\\\n  --network hydraguide \\\\\\n  -p 9010:9010 \\\\\\n  oryd/hydra:v1.10.6 \\\\\\n  token user --skip-tls-verify \\\\\\n    --port 9010 \\\\\\n    --auth-url https://localhost:5444/oauth2/auth \\\\\\n    --token-url https://localhost:5444/oauth2/token \\\\\\n    --client-id facebook-photo-backup \\\\\\n    --client-secret some-secret \\\\\\n    --scope openid,offline,photos.read\\n```\\n\\n\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\u5219\u8868\u793a\u914d\u7f6e\u6b63\u5e38\uff1a\\n\\n```shell\\nSetting up home route on http://127.0.0.1:9010/\\nSetting up callback listener on http://127.0.0.1:9010/callback\\nPress ctrl + c on Linux / Windows or cmd + c on OSX to end the process.\\nIf your browser doesn\'t open automatically, navigate to:\\n\\n        http://127.0.0.1:9010/\\n```\\n\\n\u8be5\u6b65\u9aa4\u5c06\u4f1a\u542f\u52a8\u4e00\u4e2a\u7528\u6237\u767b\u5f55\u7a0b\u5e8f\uff0c\u6211\u4eec\u5c06\u5728\u4e0b\u9762\u7684\u6b65\u9aa4\u4e2d\u4f7f\u7528\u8be5\u7a0b\u5e8f\u3002\\n\\n### \u6b65\u9aa4\u4e94\uff1a\u542f\u52a8 APISIX \u5e76\u914d\u7f6e\u8def\u7531\\n\\n\u5982\u679c\u4f60\u8fd8\u6ca1\u6709\u5b89\u88c5 APISIX\uff0c\u8bf7\u53c2\u8003\uff1a[\u5b89\u88c5 APISIX](https://apisix.apache.org/zh/docs/apisix/next/installation-guide)\u3002\\n\\n\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u4ec5\u9700\u521b\u5efa\u8def\u7531\u5e76\u914d\u7f6e `openid-connect` \u63d2\u4ef6\u5373\u53ef\u3002\u4e3a\u4e86\u66f4\u76f4\u89c2\u5730\u9a8c\u8bc1\u6548\u679c\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u542f\u52a8\u4e86\u4e00\u4e2a NGINX \u670d\u52a1\u5f53\u505a\u4e0a\u6e38\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5df2\u6709\u7684\u4e0a\u6e38\u670d\u52a1\u3002\\n\\n:::note \u6ce8\u610f\\n\\n\u672c\u793a\u4f8b\u4e2d\u7684 APISIX \u662f\u5b89\u88c5\u5728\u5bbf\u4e3b\u673a\u4e0a\uff0c\u5982\u679c\u662f\u4f7f\u7528 Docker \u542f\u52a8\u7684 APISIX\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u7f51\u7edc\u95ee\u9898\u3002\\n\\n:::\\n\\n1. \u9996\u5148\u4f7f\u7528 Docker \u521b\u5efa\u4e00\u4e2a NGINX \u4e0a\u6e38\u3002\\n\\n```shell\\ndocker run -d --name test-nginx -p 8083:80 nginx\\n```\\n\\n2. \u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\u8def\u7531\uff0c\u5e76\u914d\u7f6e `openid-connect` \u63d2\u4ef6\u3002\\n\\n\u5176\u4e2d `client_id` \u548c `client_secret` \u548c `scope` \u662f\u6b65\u9aa4\u56db\u4e2d\u8bbe\u7f6e\u7684 ID\u3002\u4f60\u53ef\u4ee5\u53c2\u8003 [Preparing for Production](https://www.ory.sh/docs/hydra/production#exposing-administrative-and-public-api-endpoints) \u83b7\u53d6\u5176\u4ed6\u4fe1\u606f\u3002\u4ece\u4e0a\u8ff0\u94fe\u63a5\u7684\u5185\u5bb9\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 `discovery` \u7684\u5730\u5740\u4e3a `https://{IP:Port}/.well-known/openid-configuration`\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\":\\"/*\\",\\n    \\"plugins\\":{\\n        \\"openid-connect\\":{\\n            \\"client_id\\":\\"facebook-photo-backup\\",\\n            \\"client_secret\\":\\"some-secret\\",\\n            \\"discovery\\":\\"https://127.0.0.1:5444/.well-known/openid-configuration\\",\\n            \\"scope\\":\\"openid\\",\\n            \\"token_endpoint_auth_method\\": \\"client_secret_basic\\",\\n            \\"bearer_only\\": false,\\n            \\"redirect_uri\\":\\"http://127.0.0.1:9080/callback\\"\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"127.0.0.1:8083\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u6b65\u9aa4\u516d\uff1a\u8bbf\u95ee APISIX\\n\\n  1. \u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165 `http://127.0.0.1:9080/index.html`\uff0c\u7531\u4e8e\u5df2\u7ecf\u5f00\u542f\u4e86 `openid-connect` \u63d2\u4ef6\uff0c\u6240\u4ee5\u9875\u9762\u88ab\u91cd\u5b9a\u5411\u5230\u767b\u5f55\u9875\u9762\u3002\u5728\u6b64\u9875\u9762\u8f93\u5165\u7528\u6237\u9a8c\u8bc1\u7a0b\u5e8f\u4e2d\u9ed8\u8ba4\u7684\u8d26\u53f7\u5bc6\u7801\u3002\\n\\n  ![\u7f51\u7edc\u9519\u8bef/\u8ba4\u8bc1\u9875\u9762](https://static.apiseven.com/2022/blog/0704/1.png)\\n\\n  2. \u9009\u62e9\u8ba4\u8bc1\u534f\u8bae\uff0c\u5e76\u5355\u51fb `Allow Access`\u3002\\n\\n  ![\u7f51\u7edc\u9519\u8bef/\u9009\u62e9\u9875\u9762](https://static.apiseven.com/2022/blog/0704/2.png)\\n\\n  3. \u9a8c\u8bc1\u6210\u529f\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5230\u4e0a\u6e38\u670d\u52a1\u7684\u9875\u9762\u3002\\n\\n  ![\u7f51\u7edc\u9519\u8bef/\u4e0a\u6e38\u9875\u9762](https://static.apiseven.com/2022/blog/0704/3.png)\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86 Hydra \u5982\u4f55\u4e0e APISIX \u8fdb\u884c\u96c6\u6210\u4ee5\u53ca Hydra \u7684\u5e94\u7528\u573a\u666f\u3002\u4f60\u53ea\u9700\u8981\u5728\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 Hydra \u76f8\u5173\u7684\u7a0b\u5e8f\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5b83\u4f5c\u4e3a\u4f60\u7684\u8eab\u4efd\u8ba4\u8bc1\u7a0b\u5e8f\u3002\\n\\n## \u76f8\u5173\u9605\u8bfb\\n\\n- [\u4f7f\u7528 APISIX openid-connect \u63d2\u4ef6\u8fdb\u884c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1](https://apisix.apache.org/zh/blog/2021/08/25/using-the-apache-apisix-openid-connect-plugin-for-centralized-authentication)\\n- [Using the Apache APISIX OpenID Connect Plugin for Okta Centralized Authentication](https://apisix.apache.org/zh/blog/2021/08/16/using-the-apache-apisix-openid-connect-plugin-for-centralized-authentication)"},{"id":"\u52a9\u529b\u5f00\u53d1\u8005\uff0c\u5168\u65b9\u4f4d\u89e3\u8bfb APISIX \u6d4b\u8bd5\u6848\u4f8b","metadata":{"permalink":"/zh/blog/2022/06/27/getting-start-with-apisix-test-cases","source":"@site/blog/2022/06/27/getting-start-with-apisix-test-cases.md","title":"\u52a9\u529b\u5f00\u53d1\u8005\uff0c\u5168\u65b9\u4f4d\u89e3\u8bfb APISIX \u6d4b\u8bd5\u6848\u4f8b","description":"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86 APISIX \u7684\u6d4b\u8bd5\u6848\u4f8b\u548c\u5982\u4f55\u7f16\u5199 API \u7f51\u5173 Apache APISIX \u7684\u6d4b\u8bd5\u6848\u4f8b\uff0c\u5e76\u4ece\u672c\u5730\u548c GitHub \u5c42\u9762\u5c55\u793a\u4e86\u5b9e\u9645\u8fd0\u884c\u6548\u679c\u3002","date":"2022-06-27T00:00:00.000Z","formattedDate":"2022\u5e746\u670827\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":16.25,"truncated":true,"authors":[{"name":"\u767d\u6cfd\u5e73","title":"Author","url":"https://github.com/bzp2010","image_url":"https://github.com/bzp2010.png","imageURL":"https://github.com/bzp2010.png"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"APISIX \u4e0e Ory Hydra \u96c6\u6210\u4e30\u5bcc\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f","permalink":"/zh/blog/2022/07/04/apisix-integrates-with-hydra"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff086.01 - 6.15\uff09","permalink":"/zh/blog/2022/06/21/weekly-report-0621"}},"content":"> \u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86 APISIX \u7684\u6d4b\u8bd5\u6848\u4f8b\u548c\u5982\u4f55\u7f16\u5199 API \u7f51\u5173 Apache APISIX \u7684\u6d4b\u8bd5\u6848\u4f8b\uff0c\u5e76\u4ece\u672c\u5730\u548c GitHub \u5c42\u9762\u5c55\u793a\u4e86\u5b9e\u9645\u8fd0\u884c\u6548\u679c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\nApache APISIX \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0b\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u5b83\u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7b49\u7279\u70b9\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\uff08\u91d1\u4e1d\u96c0\u53d1\u5e03\uff09\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 APISIX \u6765\u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5904\u7406\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\u3002\u540c\u65f6\uff0c\u5b83\u4e5f\u652f\u6301\u4f5c\u4e3a K8s Ingress Controller \u6765\u4f7f\u7528\u3002\\n\\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u60f3\u8981\u4fdd\u8bc1\u8f6f\u4ef6\u6b63\u5e38\u8fd0\u884c\uff0c\u5728\u8f6f\u4ef6\u4e0a\u7ebf\u524d\u6211\u4eec\u4e00\u822c\u4f1a\u4f7f\u7528\u5404\u79cd\u6280\u672f\u548c\u65b9\u6cd5\uff0c\u901a\u8fc7\u624b\u52a8\u6216\u81ea\u52a8\u7684\u65b9\u5f0f\u5bf9\u8f6f\u4ef6\u7684\u529f\u80fd\u8fdb\u884c\u68c0\u67e5\u4ee5\u786e\u4fdd\u5176\u8fd0\u884c\u6b63\u5e38\u3002\u8be5\u64cd\u4f5c\u6211\u4eec\u79f0\u4e4b\u4e3a QA\uff08\u6d4b\u8bd5\uff09\u3002\u6d4b\u8bd5\u4e00\u822c\u5206\u4e3a\u5355\u5143\u6d4b\u8bd5\u3001E2E \u6d4b\u8bd5\u4ee5\u53ca\u6df7\u6c8c\u6d4b\u8bd5\u3002\\n\\n\u5355\u5143\u6d4b\u8bd5\u662f\u7528\u6765\u68c0\u67e5\u5355\u4e00\u6a21\u5757\u7684\u6b63\u786e\u6027\uff08\u6bd4\u5982\u68c0\u67e5\u67d0\u4e2a RPC \u7684\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u3001\u6570\u636e\u52a0\u89e3\u5bc6\u662f\u5426\u6b63\u5e38\uff09\uff0c\u4f46\u662f\u8be5\u6d4b\u8bd5\u7f3a\u4e4f\u5bf9\u7cfb\u7edf\u7684\u5168\u5c40\u89c6\u89d2\u3002\u800c E2E \u6d4b\u8bd5\uff08\u5373\u7aef\u5230\u7aef\u6d4b\u8bd5\uff09\uff0c\u53ef\u4ee5\u8865\u8db3\u5355\u5143\u6d4b\u8bd5\u7684\u4e0d\u8db3\uff0c\u8be5\u6d4b\u8bd5\u5c06\u6574\u4e2a\u7cfb\u7edf\u548c\u5916\u90e8\u4f9d\u8d56\u670d\u52a1\u8dd1\u8d77\u6765\uff0c\u901a\u8fc7\u771f\u5b9e\u7684\u8f6f\u4ef6\u8c03\u7528\u65b9\u5f0f\u68c0\u67e5\u672c\u7cfb\u7edf\u4e0e\u5176\u4ed6\u7cfb\u7edf\u7684\u96c6\u6210\u60c5\u51b5\uff1b\u6df7\u6c8c\u6d4b\u8bd5\u5219\u901a\u8fc7\u5728\u7cfb\u7edf\u5404\u7ec4\u4ef6\u95f4\u5236\u9020\u7a81\u53d1\u60c5\u51b5\uff0c\u5982 OOM Kill\u3001\u7f51\u7edc\u4e2d\u65ad\u7b49\uff0c\u6d4b\u8bd5\u6574\u4e2a\u7cfb\u7edf\u9519\u8bef\u9519\u8bef\u7684\u5bb9\u5fcd\u7a0b\u5ea6\u4e0e\u80fd\u529b\u3002APISIX \u7684\u6d4b\u8bd5\u66f4\u52a0\u504f\u5411\u4e8e E2E \u6d4b\u8bd5\uff0c\u4fdd\u8bc1\u81ea\u8eab\u529f\u80fd\u548c\u4e0e\u5176\u4ed6\u7cfb\u7edf\u96c6\u6210\u7684\u6b63\u786e\u6027\u3002\\n\\n## APISIX \u6d4b\u8bd5\u6848\u4f8b\u7b80\u4ecb\\n\\nAPISIX \u4f5c\u4e3a\u5168\u7403\u6700\u6d3b\u8dc3\u7684 API \u7f51\u5173\uff0c\u5176\u7a33\u5b9a\u6027\u53ca\u670d\u52a1\u7684\u5065\u58ee\u6027\u9700\u8981\u5f97\u5230\u4e00\u5b9a\u7684\u4fdd\u969c\uff0c\u90a3\u4e48\u5982\u4f55\u907f\u514d APISIX \u4e2d\u6f5c\u5728\u7684\u9519\u8bef\u5462\uff1f\u8fd9\u91cc\u5c31\u9700\u8981\u901a\u8fc7\u6d4b\u8bd5\u7528\u4f8b\u6765\u5b9e\u73b0\u4e86\u3002\\n\\n\u6d4b\u8bd5\u811a\u672c\u5e76\u4e0d\u4ec5\u4ec5\u662f\u4e00\u4e2a\u88ab\u6d4b\u8bd5\u673a\u5668\u6267\u884c\u7684\u7a0b\u5e8f\u6587\u4ef6\uff0c\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bb2\uff0c\u53ef\u4ee5\u901a\u8fc7\u6d4b\u8bd5\u811a\u672c\u5b8c\u6210\u8f6f\u4ef6\u6240\u6709\u529f\u80fd\u7684\u6d4b\u8bd5\uff0c\u5305\u62ec\u4e0d\u540c\u914d\u7f6e\u3001\u4e0d\u540c\u8f93\u5165\u53c2\u6570\u7b49\u60c5\u51b5\u4e0b\u7a0b\u5e8f\u7684\u8fd0\u884c\u72b6\u51b5\u3002\u800c\u5bf9\u4e8e\u7528\u6237\u6765\u8bf4\u6d4b\u8bd5\u63d0\u4f9b\u4e86\u67d0\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\u7684\u5177\u4f53\u4f7f\u7528\u793a\u4f8b\uff0c\u4f8b\u5982\uff1a\u7a0b\u5e8f\u53ef\u4ee5\u63a5\u53d7\u7684\u914d\u7f6e\u548c\u8f93\u5165\uff0c\u60f3\u8981\u5f97\u5230\u600e\u6837\u7684\u8f93\u51fa\u7ed3\u679c\u3002\u7528\u6237\u5728\u53c2\u8003\u4f7f\u7528\u6587\u6863\u65f6\u9047\u5230\u4e0d\u61c2\u7684\u5730\u65b9\uff0c\u5b8c\u5168\u53ef\u4ee5\u53c2\u8003\u73b0\u6709\u7684\u6d4b\u8bd5\u7528\u4f8b\uff0c\u5bfb\u627e\u662f\u5426\u6709\u7c7b\u4f3c\u7684\u4f7f\u7528\u573a\u666f\u3002\\n\\n\u5728 APISIX \u9879\u76ee\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528 Github Action \u8fd0\u884c CI \u6d4b\u8bd5\uff0c\u6267\u884c\u4e0b\u56fe\u5c55\u793a\u7684\u6d4b\u8bd5\u811a\u672c\u3002\u8bb8\u591a APISIX \u7684\u5f00\u53d1\u8005\u5728\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\u65f6\uff0c\u4f1a\u9047\u5230\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\u3002\u5e0c\u671b\u901a\u8fc7\u672c\u6587\uff0c\u53ef\u4ee5\u51cf\u5c11\u4f60\u5728\u7f16\u5199 APISIX \u6d4b\u8bd5\u6848\u4f8b\u65f6\u51fa\u73b0\u7684\u9519\u8bef\u3002\\n\\n![network error/apisix test case](https://static.apiseven.com/2022/blog/0627/1.png)\\n\\n## \u7f16\u5199\u6d4b\u8bd5\u6848\u4f8b\\n\\nAPISIX \u7684\u6d4b\u8bd5\u7528\u4f8b\u57fa\u4e8e `TEST::NGINX` \u6d4b\u8bd5\u6846\u67b6\u7f16\u5199\uff0c\u8be5\u6d4b\u8bd5\u6846\u67b6\u662f\u5728 Perl \u8bed\u8a00\u57fa\u7840\u4e0a\u5b9e\u73b0\u7684\u6d4b\u8bd5\u73af\u5883\uff0c\u53ef\u4ee5\u63d0\u4f9b\u57fa\u4e8e\u811a\u672c\u7684\u81ea\u52a8\u5316\u6d4b\u8bd5\u80fd\u529b\uff0c\u4e3a APISIX \u5f53\u524d\u5982\u6b64\u5927\u89c4\u6a21\u7684\u6d4b\u8bd5\u4e0e\u8d28\u91cf\u4fdd\u8bc1\u5de5\u4f5c\u63d0\u4f9b\u4e86\u652f\u6301\u3002\u5f53\u7136\u4f60\u4e0d\u4f1a\u4f7f\u7528 Perl \u4e5f\u6ca1\u6709\u5173\u7cfb\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u573a\u666f\u4e2d\u662f\u4e0d\u9700\u8981\u7f16\u5199 Perl \u4ee3\u7801\u7684\uff0c\u4ec5\u4f7f\u7528 `TEST::NGINX` \u5c01\u88c5\u7684\u80fd\u529b\u5373\u53ef\uff0c\u5982\u679c\u6709\u7279\u6b8a\u9700\u6c42\u53ef\u4ee5\u7ed3\u5408 Lua \u4ee3\u7801\u7684\u65b9\u5f0f\u8fdb\u884c\u589e\u5f3a\u3002\\n\\nAPISIX \u7684\u6d4b\u8bd5\u7528\u4f8b\u5747\u5b58\u653e\u5728 `./apisix/t` \u76ee\u5f55\u4e0b\u9762\uff0c\u63a5\u4e0b\u6765\u5c06\u4ee5\u6dfb\u52a0 `opa` \u63d2\u4ef6\u4e3a\u4f8b\u4e3a\u4f60\u4ecb\u7ecd\u5982\u4f55\u7f16\u5199\u6d4b\u8bd5\u6848\u4f8b\u3002\\n\\n1. \u4f60\u9700\u8981\u521b\u5efa\u4e00\u4e2a `.t` \u7ed3\u5c3e\u7684\u6d4b\u8bd5\u6587\u4ef6\uff0c\u4f8b\u5982 `./t/plugin/opa.t`\u3002\u5982\u679c\u4f60\u662f\u5728\u5df2\u6709\u529f\u80fd\u4e0a\u6dfb\u52a0\u7279\u6027\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u5bf9\u5e94\u7684\u6d4b\u8bd5\u6587\u4ef6\u4e2d\u6dfb\u52a0\u6d4b\u8bd5\u7528\u4f8b\u3002\u5e76\u5728\u6587\u4ef6\u4e2d\u6dfb\u52a0\u56fa\u5b9a\u683c\u5f0f\u7684 ASF 2.0 \u534f\u8bae\u3002\\n\\n2. \u8be5\u90e8\u5206\u4e3b\u8981\u4f5c\u7528\u662f\u7ed9 `opa.t` \u8fd9\u4e2a\u6587\u4ef6\u4e2d\u6240\u6709\u7684\u6d4b\u8bd5\u7528\u4f8b\u81ea\u52a8\u6dfb\u52a0 `no_error_log`\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u5728\u6bcf\u4e2a\u4ee3\u7801\u4e0b\u6dfb\u52a0 `error_log` \u76f8\u5173\u7684\u4ee3\u7801\u4e86\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u4f7f\u7528\u8fd9\u6bb5\u4ee3\u7801\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u51cf\u5c11\u4e00\u4e9b\u91cd\u590d\u7684\u4ee3\u7801\u3002\\n\\n```perl\\nadd_block_preprocessor(sub {\\n    my ($block) = @_;\\n\\n    if ((!defined $block->error_log) && (!defined $block->no_error_log)) {\\n        $block->set_value(\\"no_error_log\\", \\"[error]\\");\\n    }\\n\\n    if (!defined $block->request) {\\n        $block->set_value(\\"request\\", \\"GET /t\\");\\n    }\\n});\\n\\nrun_tests();\\n\\nDATA\\n```\\n\\n3. \u6bcf\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u90fd\u6709\u56fa\u5b9a\u7684\u5f00\u5934\uff0c\u4e00\u822c\u683c\u5f0f\u5982\u4e0b\u3002\\n\\n```perl\\n=== TEST 1: sanity\\n```\\n\\n`===`\u662f\u6d4b\u8bd5\u7528\u4f8b\u8d77\u59cb\u7684\u56fa\u5b9a\u8bed\u6cd5\u7ed3\u6784\uff0c`TEST 1` \u5219\u4ee3\u8868\u662f\u672c\u6587\u4ef6\u7684\u7b2c\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u3002`sanity` \u5219\u4e3a\u8be5\u6d4b\u8bd5\u7684\u540d\u79f0\uff0c\u4e00\u822c\u4ee5\u6d4b\u8bd5\u7528\u4f8b\u7684\u5177\u4f53\u76ee\u7684\u547d\u540d\u3002\\n\\n4. \u63a5\u4e0b\u6765\u5c31\u662f\u6d4b\u8bd5\u7528\u4f8b\u7684\u6b63\u6587\u90e8\u5206\u4e86\u3002\u5728 APISIX \u4e2d\u51e0\u4e4e\u6bcf\u4e2a\u63d2\u4ef6\u90fd\u4f1a\u5b9a\u4e49\u4e00\u4e9b\u53c2\u6570\u548c\u5c5e\u6027\uff0c\u5e76\u4e14\u4f1a\u9884\u5148\u5b9a\u4e49 JSON schema\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5148\u68c0\u67e5\u8be5\u63d2\u4ef6\u7684\u8f93\u5165\u53c2\u6570\u662f\u5426\u80fd\u591f\u6b63\u5e38\u5730\u6821\u9a8c\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5c31\u53ef\u4ee5\u68c0\u67e5\u6211\u4eec\u8f93\u5165\u7684\u6570\u636e\u662f\u5426\u53ef\u4ee5\u6b63\u786e\u5730\u88ab JSON schema \u7684\u89c4\u5219\u53bb\u6821\u9a8c\u3002\\n\\n```perl\\n--- config\\n    location /t {\\n        content_by_lua_block {\\n            local test_cases = {\\n                {host = \\"http://127.0.0.1:8181\\", policy = \\"example/allow\\"},\\n                {host = \\"http://127.0.0.1:8181\\"},\\n                {host = 3233, policy = \\"example/allow\\"},\\n            }\\n            local plugin = require(\\"apisix.plugins.opa\\")\\n            for _, case in ipairs(test_cases) do\\n                local ok, err = plugin.check_schema(case)\\n                ngx.say(ok and \\"done\\" or err)\\n            end\\n        }\\n    }\\n--- response_body\\ndone\\nproperty \\"policy\\" is required\\nproperty \\"host\\" validation failed: wrong type: expected string, got number\\n```\\n\\n\u901a\u8fc7\u9605\u8bfb `opa` \u63d2\u4ef6\u7684\u6e90\u7801\uff0c\u53ef\u4ee5\u770b\u5230 `opa` \u63d2\u4ef6\u8981\u6c42 `host` \u548c `policy` \u5fc5\u987b\u540c\u65f6\u5b58\u5728\uff0c\u56e0\u6b64\u8fd9\u91cc\u9700\u8981\u5b9a\u4e49\u4e09\u4e2a\u89c4\u5219\u3002\\n\\n- \u8f93\u5165\u6b63\u786e\u7684\u53c2\u6570\uff0c\u5305\u62ec `host` \u548c `policy`\u3002\u56e0\u6b64\u8fd4\u56de\u7ed3\u679c\u5c06\u662f `done`\uff1b\\n- \u4ec5\u8f93\u5165 `host` \u53c2\u6570\u3002\u4e0d\u7b26\u5408 `host`\u3001`policy` \u540c\u65f6\u5b58\u5728\u7684\u8981\u6c42\uff0c\u6240\u4ee5\u8be5\u6d4b\u8bd5\u9884\u671f\u8fd4\u56de\u7ed3\u679c\u5c06\u662f `property \\"policy\\" is required`\uff1b\\n- \u8f93\u5165\u7c7b\u578b\u9519\u8bef\uff08\u6574\u6570\uff09\u7684 `host` \u503c\u3002\u56e0\u4e3a\u5728\u6e90\u7801\u4e2d\u8bbe\u7f6e\u4e86 `host` \u53c2\u6570\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u6240\u4ee5\u8fd4\u56de\u7ed3\u679c\u5c06\u662f `property \\"host\\" validation failed: wrong type`\u3002\\n\\n```perl\\n--- config\\n    location /t {\\n        content_by_lua_block {\\n...\\n                ngx.say(ok and \\"done\\" or err)\\n            end\\n        }\\n    }\\n--- response_body\\ndone\\n...\\n```\\n\\n\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u6d4b\u8bd5\u6848\u4f8b\u4e2d\u9700\u8981\u4f7f\u7528 `/t` \u7684\u51fd\u6570\uff0c\u6bd4\u5982\u8bf4\u9700\u8981\u8c03\u7528 Lua \u4ee3\u7801\uff0c\u5b9a\u4e49 `location`\u3002\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 `content_by_lua_block` \u7684\u65b9\u5f0f\u8c03\u7528\u4e00\u4e9b\u4ee3\u7801\u8f85\u52a9\u6d4b\u8bd5\uff0c\u6700\u540e\u5c06\u54cd\u5e94\u4fe1\u606f\u4ee5 `ngx.say` \u7684\u65b9\u5f0f\u6253\u5370\u51fa\u6765\uff0c\u7136\u540e\u518d\u901a\u8fc7 `--- response_body` \u7684\u65b9\u5f0f\u68c0\u67e5\u4e0a\u9762\u7a0b\u5e8f\u8fd0\u884c\u7684\u662f\u5426\u6b63\u786e\u3002\u65e0\u9700\u624b\u52a8\u8f93\u5165 `request` \u548c `error`\uff0c\u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u901a\u8fc7\u811a\u672c\u81ea\u52a8\u6dfb\u52a0\u4e86\u3002\\n\\n```perl\\n    local plugin = require(\\"apisix.plugins.opa\\")\\n    for _, case in ipairs(test_cases) do\\n        local ok, err = plugin.check_schema(case)\\n        ngx.say(ok and \\"done\\" or err)\\n```\\n\\n\u4ee5\u4e0a\u4ee3\u7801\u8868\u793a\u5bfc\u5165 APISIX Plugin `opa` \u63d2\u4ef6\u7684\u6a21\u5757\uff0c\u5e76\u4e14\u8c03\u7528 `plugin.check_schema` \u51fd\u6570\u3002\u7136\u540e\u901a\u8fc7 `for` \u5faa\u73af\uff0c\u4ee5\u6b64\u8c03\u7528\u53c2\u6570\uff0c\u5e76\u4e14\u6839\u636e\u6d4b\u8bd5\u60c5\u51b5\u8fd4\u56de\u5bf9\u5e94\u7684\u7ed3\u679c\u3002\\n\\n5. \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u9700\u8981\u914d\u7f6e\u4e00\u4e2a\u6d4b\u8bd5\u65f6\u4f7f\u7528\u7684\u73af\u5883\u3002\u5bf9\u4e8e\u63d2\u4ef6\u6765\u8bf4\uff0c\u5c31\u662f\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff0c\u7136\u540e\u628a\u63d2\u4ef6\u5173\u8054\u5230\u8be5\u8def\u7531\u4e0a\u3002\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u53d1\u9001\u8bf7\u6c42\u6821\u9a8c\u63d2\u4ef6\u7684\u5185\u90e8\u903b\u8f91\u5b9e\u73b0\u662f\u5426\u6b63\u786e\u3002\\n\\n```perl\\n=== TEST 2: setup route with plugin\\n--- config\\n    location /t {\\n        content_by_lua_block {\\n            local t = require(\\"lib.test_admin\\").test\\n            local code, body = t(\'/apisix/admin/routes/1\',\\n                 ngx.HTTP_PUT,\\n                 [[{\\n                        \\"plugins\\": {\\n                            \\"opa\\": {\\n                                \\"host\\": \\"http://127.0.0.1:8181\\",\\n                                \\"policy\\": \\"example\\"\\n                            }\\n                        },\\n                        \\"upstream\\": {\\n                            \\"nodes\\": {\\n                                \\"127.0.0.1:1980\\": 1\\n                            },\\n                            \\"type\\": \\"roundrobin\\"\\n                        },\\n                        \\"uris\\": [\\"/hello\\", \\"/test\\"]\\n                }]]\\n                )\\n            if code >= 300 then\\n                ngx.status = code\\n            end\\n            ngx.say(body)\\n        }\\n    }\\n--- response_body\\npassed\\n```\\n\\n\u5728\u4ee5\u4e0a\u793a\u4f8b\u4e2d\uff0c\u4f7f\u7528\u4e86 `lib_test_admin` \u5bfc\u5165\u5230 `t` \u51fd\u6570\uff0c\u521b\u5efa\u4e00\u4e2a `id` \u4e3a `1` \u7684\u8def\u7531\uff0c\u7136\u540e\u4f7f\u7528 `PUT` \u7684\u65b9\u6cd5\uff0c\u4f20\u5165\u8fd9\u4e9b\u6570\u636e\u3002\u5728\u8be5\u6d4b\u8bd5\u4e2d\uff0c\u6211\u4eec\u5e76\u6ca1\u6709\u5bf9\u6570\u636e\u683c\u5f0f\u8fdb\u884c\u68c0\u9a8c\uff0c\u56e0\u4e3a\u8be5\u6d4b\u8bd5\u7528\u4f8b\u53ea\u8981\u4fdd\u8bc1\u4f7f\u7528 Admin API \u53ef\u4ee5\u6b63\u5e38\u521b\u5efa\u8def\u7531\u5c31\u53ef\u4ee5\u4e86\uff0c\u5f53\u7136\u6211\u4eec\u4e5f\u9700\u8981\u5bf9\u5f02\u5e38\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u72b6\u6001\u7801\u5927\u4e8e\u6216\u8005\u7b49\u4e8e `300` \u5c31\u4f1a\u6253\u5370\u51fa\u5177\u4f53\u7684\u4fe1\u606f\u3002\\n\\n\u5728 APISIX \u7684\u6d4b\u8bd5\u6848\u4f8b\u4e2d\uff0c\u4f60\u4f1a\u53d1\u73b0\u5f88\u591a\u6d4b\u8bd5\u4e2d\u90fd\u5305\u542b\u4e86\u4ee5\u4e0b\u4ee3\u7801\uff1a\\n\\n```perl\\nlocal t = require(\\"lib.test_admin\\").test\\nlocal code, body = t(\'/apisix/admin/routes/1\', ngx.HTTP_PUT)\\n```\\n\\n\u4ee5\u4e0a\u4ee3\u7801\u8868\u793a\u5bfc\u5165 `lib.test_admin` \u6a21\u5757\u5e76\u4f7f\u7528\u5176\u4e2d `test` \u51fd\u6570\u5c01\u88c5\u6765\u53d1\u9001\u8bf7\u6c42\uff0c\u5b83\u51cf\u5c11\u4e86\u6211\u4eec\u8c03\u7528 APISIX Admin API \u7b49 HTTP \u63a5\u53e3\u65f6\u7684\u91cd\u590d\u4ee3\u7801\uff0c\u53ea\u9700\u7b80\u5355\u8c03\u7528\u5e76\u68c0\u67e5\u8fd4\u56de\u7ed3\u679c\u5373\u53ef\u3002\\n\\n6. \u5728\u7b2c\u4e09\u4e2a\u6d4b\u8bd5\u4e2d\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u518d\u91cd\u590d\u521b\u5efa\u8def\u7531\uff0c\u56e0\u4e3a\u5728\u7b2c\u4e8c\u4e2a\u6d4b\u8bd5\u4e2d\u5df2\u7ecf\u521b\u5efa\u4e86\u3002\\n\\n```perl\\n=== TEST 3: hit route (with correct request)\\n--- request\\nGET /hello?test=1234&user=none\\n--- more_headers\\ntest-header: only-for-test\\n--- response_body\\nhello world\\n```\\n\\n\u4e0a\u8ff0\u793a\u4f8b\u5b9a\u4e49\u4e86 `request`\u3002\u56e0\u4e3a\u6211\u4eec\u5728\u4e0a\u4e00\u4e2a\u6d4b\u8bd5\u4e2d\u5b9a\u4e49\u4e86 `/hello` \u548c `/test` \u7684\u8def\u5f84\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `GET` \u7684\u65b9\u6cd5\u5411 `/hello` \u53d1\u9001\u8bf7\u6c42\uff0c\u5e76\u7136\u540e\u5b83\u4f1a\u53d1\u9001\u4e00\u4e2a `test=1234` \u548c `user=none` \u7684 `query` \u53c2\u6570\u3002\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7 `more_headers` \u7684\u65b9\u5f0f\u6dfb\u52a0\u54cd\u5e94\u5934\uff0c\u6bd4\u5982\u7ed9\u53d1\u9001\u5230 `hello` \u7684\u8bf7\u6c42\u6dfb\u52a0\u4e00\u4e2a\u53eb `test-header` \u7684\u54cd\u5e94\u5934\u3002\\n\\n\u4ee5\u4e0a\u6d4b\u8bd5\u662f\u4e3a\u4e86\u6d4b\u8bd5\u6dfb\u52a0\u6b63\u786e\u7684\u8bf7\u6c42\u5934\u662f\u5426\u53ef\u4ee5\u6210\u529f\u3002\u4f60\u4e5f\u53ef\u4ee5\u5728\u540e\u7eed\u7684\u6d4b\u8bd5\u793a\u4f8b\u4e2d\u6dfb\u52a0\u9519\u8bef\u5934\uff0c\u5e76\u9a8c\u8bc1\u7ed3\u679c\u3002\u5982\u679c\u4f60\u9700\u8981\u4f7f\u7528 `POST` \u8bf7\u6c42\uff0c\u4e5f\u53ef\u4ee5\u628a\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684 `GET /hello` \u4fee\u6539\u4e3a `POST /hello`\u3002\\n\\n\u5728\u6709\u4e9b\u6d4b\u8bd5\u4e2d\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u521b\u5efa\u591a\u4e2a\u4e0a\u6e38\u6216\u8005\u8def\u7531\uff0c\u6b64\u65f6\u4f60\u5c31\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u6570\u7ec4\uff0c\u7136\u540e\u5728\u6570\u7ec4\u4e2d\u5b9a\u4e49\u8fd9\u4e9b\u5bf9\u5e94\u7684\u503c\uff0c\u5e76\u901a\u8fc7 `for` \u65b9\u5f0f\u5faa\u73af\u5730\u8c03\u7528 `t` \u51fd\u6570\uff0c\u7136\u540e\u8ba9\u5b83\u628a\u8fd9\u4e2a\u4e1c\u897f\u6b63\u5e38\u5730\u901a\u8fc7 `put` \u7684\u65b9\u5f0f\u6765\u8c03\u7528 APISIX \u7684 Admin API \u63a5\u53e3\u6765\u6b63\u5e38\u521b\u5efa\u8def\u7531\u6216\u8005\u4e0a\u6e38\u3002\u8be5\u65b9\u5f0f\u4e5f\u662f\u6d4b\u8bd5\u6bd4\u8f83\u5e38\u89c1\u7684\u65b9\u5f0f\uff0c\u79f0\u4e3a\uff1a`Table driving test`\uff0c\u662f\u4e00\u79cd\u901a\u8fc7\u8868\u7684\u65b9\u5f0f\u9a71\u52a8\u6d4b\u8bd5\u7684\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u51cf\u5c11\u90e8\u5206\u91cd\u590d\u51fa\u73b0\u7684\u4ee3\u7801\u3002\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u8bf7\u53c2\u8003APISIX\u6d4b\u8bd5\u6848\u4f8b\u5feb\u901f\u5165\u95e8\u89c6\u9891\u548copa2.t\u6d4b\u8bd5\u7528\u4f8b\u3002\\n\\n## \u8fd0\u884c\u6d4b\u8bd5\u6848\u4f8b\\n\\n\u6d4b\u8bd5\u6848\u4f8b\u9700\u8981\u6e90\u7801\u5b89\u88c5 APISIX\uff0c\u5177\u4f53\u5b89\u88c5\u65b9\u6cd5\u8bf7\u53c2\u8003[\u5982\u4f55\u6784\u5efa Apache APISIX](https://apisix.apache.org/zh/docs/apisix/next/installation-guide)\u3002\u63a5\u4e0b\u6765\u5c06\u91cd\u70b9\u4ecb\u7ecd\u5982\u4f55\u8fd0\u884c\u6d4b\u8bd5\u6848\u4f8b\u53ca\u62a5\u9519\u68c0\u67e5\u3002\\n\\n### \u672c\u5730\u8fd0\u884c\\n\\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u5728\u672c\u5730\u4f7f\u7528\u4ee5\u4e0b\u6307\u4ee4\u6765\u8fd0\u884c\u6d4b\u8bd5\u6848\u4f8b\uff1a\\n\\n```shell\\nPATH=/usr/local/openresty/nginx/sbin:/usr/bin PERL5LIB=.:$PERL5LIB FLUSH_ETCD=1 prove -Itest-nginx/lib -r t/admin\\n```\\n\\n\u4ee5\u4e0a\u547d\u4ee4\u7684\u91ca\u4e49\u5982\u4e0b\uff1a\\n\\n- `PATH` \u6307\u5b9a\u4e86 `openresty/nginx` \u6240\u5728\u7684\u76ee\u5f55\uff0c\u53ef\u4ee5\u907f\u514d\u90e8\u5206\u73af\u5883\u914d\u7f6e\u9519\u8bef\u65f6\u5f15\u8d77\u7684\u51b2\u7a81\u95ee\u9898\uff0c\u5982\u679c\u73af\u5883\u4e2d\u7684 OpenResty \u5b89\u88c5\u5728\u5176\u4ed6\u4f4d\u7f6e\uff0c\u5219\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u547d\u4ee4\u8fdb\u884c\u6307\u5b9a\u3002\\n- `PERL5LIB` \u6307\u5b9a\u4e86\u4f7f\u7528 Perl \u5bfc\u5165\u5230\u672c\u5730\u3002\u5bfc\u5165\u672c\u8def\u5f84\u4e2d\u5b58\u5728\u7684\u4ee5\u53ca\u90e8\u5206\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u9644\u52a0\u7684 `PERL` \u5e93\u3002\\n- `FLUSH_ETCD` \u6307\u5b9a\u4e86\u5728\u6bcf\u4e2a\u6d4b\u8bd5\u6587\u4ef6\u6267\u884c\u5b8c\u6210\u540e\uff0c\u5219\u6e05\u7a7a\u6240\u6709\u6570\u636e\uff0c\u5b83\u9700\u8981\u8c03\u7528 `etcdctl` \u51fd\u6570\uff0c\u9700\u8981\u786e\u4fdd\u5728 `PATH` \u4e2d\u53ef\u4ee5\u627e\u5230 `etcdctl` \u53ef\u6267\u884c\u6587\u4ef6\u3002\\n- `prove` \u8c03\u7528\u6d4b\u8bd5\u7a0b\u5e8f\u5f00\u59cb\u6267\u884c\u6d4b\u8bd5\u3002\\n- `-Itest-nginx/lib` \u8868\u793a\u5bfc\u5165 `Itest-nginx/lib` \u8fd9\u4e2a\u5e93\u3002\\n- `-r` \u8868\u793a\u81ea\u52a8\u5bfb\u627e\u6d4b\u8bd5\u6587\u4ef6\u3002\u5982\u679c\u6307\u5b9a\u7684\u662f\u4e00\u4e2a\u8def\u5f84\uff0c\u5219\u4f1a\u5bfb\u627e\u8fd9\u4e2a\u8def\u5f84\u4e0b\u6240\u6709\u7684\u6d4b\u8bd5\u6587\u4ef6\u3002\\n- `t/admin` \u8868\u793a\u6307\u5b9a\u6d4b\u8bd5\u7528\u4f8b\u641c\u7d22\u8def\u5f84\uff0c\u6b64\u5904\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5230\u552f\u4e00\u4e00\u4e2a `.t` \u6587\u4ef6\u4e0a\u8fdb\u884c\u9650\u5b9a\u3002\\n\\n\u4ee5\u4e0b\u4e3a\u4e0a\u8ff0\u547d\u4ee4\u7684\u6b63\u5e38\u6267\u884c\u7ed3\u679c\u3002  \\n\\n![network error/normal return result](https://static.apiseven.com/2022/blog/0627/5.png)\\n\\n \u5982\u679c\u6d4b\u8bd5\u5931\u8d25\uff0c\u5219\u4f1a\u51fa\u73b0\u4ee5\u4e0b\u4fe1\u606f\uff1a\\n\\n![network error/fail return result](https://static.apiseven.com/2022/blog/0627/2.png)\\n\\n \u4ee5\u4e0a\u4fe1\u606f\u5219\u4f1a\u544a\u8bc9\u4f60\u5177\u4f53\u662f\u54ea\u4e2a\u6d4b\u8bd5\u6587\u4ef6\u4e2d\u7684\u54ea\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u6267\u884c\u5931\u8d25\u4e86\u3002\\n\\n### Github \u8fd0\u884c\\n\\n\u4e00\u822c\u60c5\u51b5\u5728 Github \u4e2d\u63d0\u4ea4\u4ee3\u7801\u65f6\uff0c\u8f93\u51fa\u7684\u7ed3\u679c\u548c\u5728\u672c\u5730\u6d4b\u8bd5\u76f8\u4f3c\u3002\\n\\n\u9996\u5148\u9009\u62e9\u9519\u8bef\u7684\u6267\u884c\u5de5\u4f5c\u6d41\uff0c\u4e3b\u8981\u7684\u6d4b\u8bd5\u7528\u4f8b\u5747\u5728 build \u7cfb\u5217 CI \u4e2d\u3002\\n\\n![network error/Github CI example](https://static.apiseven.com/2022/blog/0627/3.png)\\n\\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u8be5\u793a\u4f8b\u4e2d\uff0c`416` \u884c\u51fa\u73b0\u4e86\u62a5\u9519\u3002\u901a\u8fc7\u9519\u8bef\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u5728\u67d0\u4e2a\u6d4b\u8bd5\u6587\u4ef6\u4e2d\u7684\u67d0\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u51fa\u73b0\u9519\u8bef\uff0c\u5f00\u53d1\u8005\u5b9a\u5411\u67e5\u770b\u4fee\u6b63\u5373\u53ef\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cCI \u4e2d\u53ef\u80fd\u5b58\u5728\u4e00\u4e9b\u5947\u602a\u7684\u62a5\u9519\uff0c\u5b83\u4eec\u53ef\u80fd\u662f\u56e0\u4e3a CI \u73af\u5883\u7684\u4e34\u65f6\u5f02\u5e38\u5bfc\u81f4\u7684\uff0c\u5982\u679c\u672a\u4fee\u6539\u8fc7\u5bf9\u5e94\u6a21\u5757\u4e2d\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u5ffd\u7565\u8fd9\u4e9b\u9519\u8bef\u3002\\n\\n![network error/Github CI error example](https://static.apiseven.com/2022/blog/0627/4.png)\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u6d4b\u8bd5\u7684\u76f8\u5173\u6d41\u7a0b\uff0c\u4ee5\u53ca\u5728 APISIX \u6d4b\u8bd5\u6848\u4f8b\u7684\u6784\u6210\u548c\u5982\u4f55\u8fdb\u884c\u6d4b\u8bd5\u6848\u4f8b\u7684\u7f16\u5199\uff0c\u5e0c\u671b\u901a\u8fc7\u672c\u6587\u4f60\u53ef\u4ee5\u5bf9 APISIX \u7684\u6d4b\u8bd5\u6848\u4f8b\u6709\u4e00\u4e2a\u5927\u81f4\u7684\u8ba4\u8bc6\u3002\\n\\n\u7136\u800c\u672c\u6587\u53ea\u63d0\u5230\u4e86 APISIX \u6d4b\u8bd5\u6846\u67b6\u4e2d\u7684\u4e00\u4e9b\u6838\u5fc3\u5185\u5bb9\uff0c\u672a\u80fd\u8986\u76d6 `TEST::NGINX` \u6846\u67b6\u4e2d\u7684\u5168\u90e8\u5185\u5bb9\uff0c\u5b9e\u9645\u4e0a `TEST::NGINX` \u4e2d\u8fd8\u6709\u5f88\u591a\u5f3a\u5927\u7684\u80fd\u529b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 [`Test::Nginx::Socket` \u7684\u6587\u6863](https://metacpan.org/pod/Test::Nginx::Socket)\u4e86\u89e3\u66f4\u591a\u7528\u6cd5\u3002\u5982\u679c\u4f60\u60f3\u5b66\u4e60\u66f4\u591a\u7f16\u5199\u6d4b\u8bd5\u6848\u4f8b\u7684\u77e5\u8bc6\uff0c\u53ef\u4ee5\u89c2\u770b[APISIX \u6d4b\u8bd5\u6848\u4f8b\u5feb\u901f\u5165\u95e8\u89c6\u9891](https://www.bilibili.com/video/BV1qF411G78j?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=d427acb1117c07aeea8968e15736e375)\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff086.01 - 6.15\uff09","metadata":{"permalink":"/zh/blog/2022/06/21/weekly-report-0621","source":"@site/blog/2022/06/21/weekly-report-0621.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff086.01 - 6.15\uff09","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2022-06-21T00:00:00.000Z","formattedDate":"2022\u5e746\u670821\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.585,"truncated":true,"authors":[],"prevItem":{"title":"\u52a9\u529b\u5f00\u53d1\u8005\uff0c\u5168\u65b9\u4f4d\u89e3\u8bfb APISIX \u6d4b\u8bd5\u6848\u4f8b","permalink":"/zh/blog/2022/06/27/getting-start-with-apisix-test-cases"},"nextItem":{"title":"\u57fa\u4e8e Apache APISIX \u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0","permalink":"/zh/blog/2022/06/14/automated-operation-base-apache-apisix"}},"content":"> \u4ece 6.01 - 6.15\uff0c\u6709 30 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 73 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/2022/weeklyreport/0615/174759817-47eddcc7-a857-494b-9874-8daf95a71abe.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/2022/weeklyreport/0615/174759599-d832f5cd-3c61-44b9-90a6-3ceff3934c4c.png)\\n\\n## Good first issue\\n\\n### Issue #7164\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/7164\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u76ee\u524d\u793e\u533a\u6b63\u5728\u4f7f\u7528 Semantic Pull Requests \u6765\u68c0\u67e5 PR\uff0c\u4f46\u662f\u8be5\u9879\u76ee\u5df2\u7ecf\u4e0d\u518d\u7ef4\u62a4\u4e86\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e9b\u66ff\u4ee3\u65b9\u6848\u3002\\n\\n\u6bd4\u5982\uff1ahttps://github.com/amannn/action-semantic-pull-request\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [\u652f\u6301\u4ece SSL \u5bf9\u8c61\u4e2d\u83b7\u53d6\u4e0a\u6e38\u8bc1\u4e66](https://github.com/apache/apisix/pull/7221)\uff08\u8d21\u732e\u8005\uff1a[soulbird](https://github.com/soulbird)\uff09\\n\\n- [\u5728 RP \u573a\u666f\u4e2d\u589e\u52a0\u5bf9\u6355\u83b7 OpenID Connect (OIDC) \u5237\u65b0\u4ee4\u724c\u7684\u652f\u6301](https://github.com/apache/apisix/pull/7220)\uff08\u8d21\u732e\u8005\uff1a[NMichas](https://github.com/NMichas)\uff09\\n\\n- [\u4ee3\u7406 Redis \u534f\u8bae\u652f\u6301\u6536\u96c6\u6307\u6807](https://github.com/apache/apisix/pull/7183)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [Stream \u5b50\u7cfb\u7edf\u652f\u6301 `prometheus` \u63d2\u4ef6](https://github.com/apache/apisix/pull/7174)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [API \u7f51\u5173 Apache APISIX \u5728 AWS Graviton3 \u4e0a\u7684\u5b89\u88c5\u4e0e\u6027\u80fd\u6d4b\u8bd5](https://apisix.apache.org/zh/blog/2022/06/07/installation-performance-test-of-apigateway-apisix-on-aws-graviton3)\\n\\n- [API \u7f51\u5173 Apache APISIX \u52a9\u529b\u96ea\u7403\u53cc\u6d3b\u67b6\u6784\u6f14\u8fdb](https://apisix.apache.org/zh/blog/2022/06/14/xueqiu-with-apache-apisix)\\n\\n- [\u963f\u91cc\u4e91 MSE \u57fa\u4e8e Apache APISIX \u7684\u5168\u94fe\u8def\u7070\u5ea6\u65b9\u6848\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/06/14/how-mse-supports-canary-release-with-apache-apisix)\\n\\n- [APISIX \u52a9\u529b\u4e2d\u4e1c\u793e\u4ea4\u8f6f\u4ef6\uff0c\u5b9e\u73b0\u672c\u5730\u5316\u90e8\u7f72](https://apisix.apache.org/zh/blog/2022/06/14/beeto-with-apache-apisix)\\n\\n- [\u57fa\u4e8e Apache APISIX \u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0](https://apisix.apache.org/zh/blog/2022/06/14/automated-operation-base-apache-apisix)\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"\u57fa\u4e8e Apache APISIX \u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0","metadata":{"permalink":"/zh/blog/2022/06/14/automated-operation-base-apache-apisix","source":"@site/blog/2022/06/14/automated-operation-base-apache-apisix.md","title":"\u57fa\u4e8e Apache APISIX \u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0","description":"\u672c\u6587\u7531\u524d\u540c\u7a0b\u6570\u79d1\u8fd0\u7ef4\u7ecf\u7406\u9648\u5e86\u4ecb\u7ecd\u4e86\u5982\u4f55\u57fa\u4e8e Apache APISIX \u5b9e\u73b0\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\uff0c\u5e76\u4ece\u7528\u6237\u767b\u5f55\u53ca\u9274\u6743\u573a\u666f\uff0c\u5e26\u6765\u66f4\u591a\u7ec6\u8282\u5c55\u793a\u3002","date":"2022-06-14T00:00:00.000Z","formattedDate":"2022\u5e746\u670814\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":17.425,"truncated":true,"authors":[{"name":"\u9648\u5e86","title":"Author","url":"https://github.com/chenqing24","image_url":"https://avatars.githubusercontent.com/u/3502467?v=4","imageURL":"https://avatars.githubusercontent.com/u/3502467?v=4"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff086.01 - 6.15\uff09","permalink":"/zh/blog/2022/06/21/weekly-report-0621"},"nextItem":{"title":"APISIX \u52a9\u529b\u4e2d\u4e1c\u793e\u4ea4\u8f6f\u4ef6\uff0c\u5b9e\u73b0\u672c\u5730\u5316\u90e8\u7f72","permalink":"/zh/blog/2022/06/14/beeto-with-apache-apisix"}},"content":"> \u672c\u6587\u7531\u524d\u540c\u7a0b\u6570\u79d1\u8fd0\u7ef4\u7ecf\u7406\u9648\u5e86\u4ecb\u7ecd\u4e86\u5982\u4f55\u57fa\u4e8e Apache APISIX \u5b9e\u73b0\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\u3002\\r\\n\\r\\n\x3c!--truncate--\x3e\\r\\n\\r\\n## \u9879\u76ee\u80cc\u666f\\r\\n\\r\\n2019 \u5e74\u5e95\uff0c\u56e0\u4e3a\u516c\u53f8\u5728\u4e1a\u52a1\u7814\u53d1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9047\u5230\u4e86\u4e00\u4e9b\u4e1a\u52a1\u75db\u70b9\uff0c\u6bd4\u5982\uff1a\u516c\u53f8\u7684\u5f00\u53d1\u6280\u672f\u6808\u662f Java \u76f8\u5173\u7684\uff0c\u800c\u8fd0\u7ef4\u5de5\u7a0b\u5e08\u64c5\u957f\u7684\u5219\u662f Shell \u548c Python \u811a\u672c\uff0c\u65e0\u6cd5\u76f4\u63a5\u5bf9\u63a5\uff1b\u516c\u53f8\u672c\u8eab\u6b63\u5904\u4e8e\u5feb\u901f\u589e\u957f\u671f\uff0c\u5f00\u53d1\u5de5\u7a0b\u5e08\u4eba\u529b\u4e0d\u8db3\uff0c\u65e0\u6cd5\u652f\u63f4\u65e5\u5e38\u7684\u8fd0\u7ef4\u5de5\u4f5c\u53ca\u8fd0\u7ef4\u5e73\u53f0\u7684\u5f00\u53d1\uff1b\u5728\u73b0\u6709\u7684\u8fd0\u7ef4\u5e73\u53f0\u4e2d\uff0c\u4f7f\u7528\u4e86\u591a\u79cd\u5f00\u6e90\u5de5\u5177\uff0c\u800c\u4e14\u6ca1\u6709\u6574\u5408\uff0c\u8f83\u96be\u7ba1\u7406\u3002\u56e0\u6b64\u6211\u53d1\u8d77\u4e86\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\u7684\u9879\u76ee\uff0c\u5e0c\u671b\u901a\u8fc7\u8be5\u8fd0\u7ef4\u5e73\u53f0\u5b9e\u73b0\u5feb\u901f\u4e0a\u624b\u7684\u5f00\u53d1\u6a21\u578b\uff0c\u53ef\u4ee5\u5b9e\u73b0\u8fd0\u7ef4\u5de5\u7a0b\u5e08\u81ea\u5df1\u5f00\u53d1\u4e1a\u52a1\uff0c\u5e76\u8fdb\u884c\u5feb\u901f\u7684\u8fed\u4ee3\u670d\u52a1\u3002\\r\\n\\r\\n## \u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX\\r\\n\\r\\n\u5728\u8fdb\u884c\u7f51\u5173\u9009\u578b\u65f6\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u5b9e\u9645\u7684\u6d4b\u8bd5\u3002\u76f8\u5bf9\u4e8e\u5176\u4ed6\u7f51\u5173\uff0cAPISIX \u57fa\u672c\u4e0a\u53ef\u4ee5\u8fbe\u5230 NGINX 90% \u7684\u529f\u80fd\uff0c\u5e76\u4e14\u652f\u6301\u4e86\u591a\u79cd\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u4ee5\u53ca\u652f\u6301\u591a\u8bed\u8a00\u63d2\u4ef6\u7684\u673a\u5236\uff0c\u540c\u65f6\u652f\u6301\u4e86\u8f6f WAF\uff0c\u53ef\u4ee5\u8986\u76d6\u6211\u4eec95% \u7684\u5b89\u5168\u4e1a\u52a1\u573a\u666f\u3002\u4f5c\u4e3a\u4e91\u539f\u751f API \u7f51\u5173\uff0cAPISIX \u4e5f\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u65e5\u5fd7\u529f\u80fd\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u8ba9 access log \u5bf9\u63a5 ELK\u3002\u7531\u4e8e APISIX \u4e5f\u652f\u6301\u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684\u5f00\u53d1\uff0c\u53ef\u4ee5\u6839\u636e\u6211\u4eec\u7684\u9700\u6c42\u7075\u6d3b\u6269\u5c55\u3002\u5f97\u76ca\u4e8e APISIX \u7684\u57fa\u7840\u529f\u80fd\u548c\u5f3a\u5927\u7684\u63d2\u4ef6\u4f53\u7cfb\uff0c\u53ef\u4ee5\u6709\u6548\u964d\u4f4e\u5f00\u53d1\u6210\u672c\u3002\\r\\n\\r\\n## \u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\u67b6\u6784\\r\\n\\r\\n\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\u6574\u4f53\u67b6\u6784\u56fe\u5982\u4e0b\uff1a\\r\\n\\r\\n![\u67b6\u6784\u56fe](https://static.apiseven.com/2022/06/blog/1/173292289-2986c1b4-3704-4d34-a30a-df4ee6f09da7.png)\\r\\n\\r\\n- \u5b58\u50a8\u5c42\uff1a\u6838\u5fc3\u662f CMDB\uff0c\u4e3b\u8981\u529f\u80fd\u662f\u8bb0\u5f55\u548c\u7ba1\u7406\u7ec4\u7ec7\u4e1a\u52a1\u548c IT \u8d44\u6e90\u7684\u5c5e\u6027\uff0c\u4ee5\u53ca\u5176\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u3002\u4e0d\u4f46\u8d1f\u8d23\u6240\u6709\u4e1a\u52a1\u53d8\u66f4\u7684\u8d77\u59cb\u72b6\u6001\u67e5\u8be2\uff0c\u800c\u4e14\u6240\u6709\u7684\u4e1a\u52a1\u8d44\u6e90\u7684\u53d8\u66f4\u90fd\u8981\u53cd\u9988\u8bb0\u5f55\u5728\u5176\u4e2d\uff0c\u5b9e\u73b0\u4e1a\u52a1\u6807\u51c6\u89c4\u8303\u7684\u7ba1\u63a7\u3002\u5b58\u50a8\u5c42\u4e5f\u5305\u542b\u4e00\u4e9b\u6743\u9650\u7ba1\u7406\u7684\u6570\u636e\u3001\u4e1a\u52a1\u5de5\u5355\u7684\u6d41\u8f6c\u6570\u636e\u4ee5\u53ca\u76d1\u63a7\u544a\u8b66\u7684\u65f6\u5e8f\u6570\u636e\uff1b\\r\\n\\r\\n- \u516c\u5171\u57fa\u7840\u670d\u52a1\u5c42\uff1a\u63d0\u4f9b\u539f\u5b50\u4e1a\u52a1\u7684 API\uff0c\u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u662f\u57fa\u7840\u4e2d\u53f0\uff0c\u590d\u7528\u4e86\u5927\u91cf\u7684\u5f00\u6e90\u5de5\u5177\uff1b\\r\\n\\r\\n- \u4e1a\u52a1\u7f16\u6392\u5c42\uff1a\u9700\u8981\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u8fdb\u884c\u8bbe\u8ba1\uff0c\u5de5\u7a0b\u5e08\u7684\u5de5\u4f5c\u5c31\u662f\u628a\u539f\u5b50\u4e1a\u52a1 API \u6309\u9700\u6c42\u8fdb\u884c\u62a5\u6587\u9002\u914d\u3001\u6d41\u7a0b\u7ec4\u5408\u3001\u6570\u636e\u8bfb\u5199\uff0c\u5e76\u6253\u5305\u6210\u4e3a\u63a5\u53e3\u4f9b\u524d\u7aef\u8c03\u7528\uff1b\\r\\n\\r\\n- \u7f51\u5173\u5c42\uff1aAPISIX \u6240\u5728\u7684\u5c42\uff0c\u662f\u540e\u53f0\u670d\u52a1\u7684\u4e1a\u52a1\u8fb9\u754c\uff0c\u8d1f\u8d23\u8d1f\u8f7d\u5747\u8861\u3001\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\u3001\u7528\u6237\u9274\u6743\u3001\u57fa\u7840\u7f51\u7edc\u62a5\u6587\u6570\u636e\u8f6c\u7801\u3001\u5185\u5916\u4ea4\u4e92\u65e5\u5fd7\u7684\u7edf\u4e00\u8bb0\u5f55\u3001\u90e8\u5206\u5b89\u5168\u7ba1\u63a7\u7b49\u7b49\u3002\u4e0e\u4e1a\u52a1\u65e0\u5173\u5e76\u4e14\u901a\u7528\u7684\u670d\u52a1\u7edf\u4e00\u653e\u7f6e\u5230\u672c\u5c42\uff1b\\r\\n\\r\\n- \u5c55\u793a\u5c42\uff1a\u4ece\u7528\u6237\u89d2\u5ea6\u51fa\u53d1\uff0c\u8bbe\u8ba1\u4fbf\u5229\u7684\u4ea4\u4e92\u754c\u9762\u3002\u6b64\u5904\u4f7f\u7528\u4e86\u4e00\u4e2a\u5f00\u6e90\u7684\u524d\u7aef\u5168\u54cd\u5e94\u5f0f admin \u7f51\u9875\u6a21\u677f\uff0c\u5373\u4f7f\u5f00\u53d1\u8005\uff08\u8fd0\u7ef4\uff09\u4e0d\u719f\u6089 JavaScript \uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u57fa\u672c\u7684\u8868\u5355\u548c\u62a5\u8868\u3002\\r\\n\\r\\n## \u5e73\u53f0\u4f7f\u7528\u7684\u7ec4\u4ef6\\r\\n\\r\\n- \u6838\u5fc3\u7f51\u5173 [Apache APISIX](https://github.com/apache/apisix)\uff1a\u4e3b\u8981\u8d1f\u8d23\u65e5\u5fd7\u8bb0\u5f55\u3001\u7f51\u7edc\u5b89\u5168\u4ee5\u53ca\u8d1f\u8f7d\u5747\u8861\u3002\u53e6\u5916\u6211\u4eec\u4e0d\u4f46\u901a\u8fc7\u81ea\u5b9a\u4e49\u63d2\u4ef6\u5b9e\u73b0\u4e86\u9ad8\u7ea7\u4e1a\u52a1\u7f51\u5173\u7684\u90e8\u5206\u529f\u80fd\uff0c\u800c\u4e14\u8fd8\u901a\u8fc7 API \u80fd\u65b9\u4fbf\u7684\u548c\u5176\u4ed6\u670d\u52a1\u6574\u5408\uff0c\u5feb\u901f\u5b9e\u73b0\u5404\u79cd\u6307\u5b9a\u529f\u80fd\uff0c\u6709\u6548\u964d\u4f4e\u5f00\u53d1\u6210\u672c\uff1b\\r\\n\\r\\n- API \u7ba1\u7406\u5de5\u5177 [YAPI](https://github.com/ymfe/yapi)\uff1a\u8d1f\u8d23\u5bf9\u63a5\u53e3\u7684\u89c4\u8303\u5b9a\u4e49\uff0c\u6d4b\u8bd5\u7528\u4f8b\u7f16\u5199\u548c\u4f5c\u4e3a ACL \u7684\u6570\u636e\u6e90\uff1b\\r\\n\\r\\n- \u8bbf\u95ee\u63a7\u5236\u7ec4\u4ef6 [Casbin](https://github.com/casbin/casbin)\uff1a\u8f7b\u91cf\u7ea7\u3001\u591a\u6a21\u5f0f\u3001\u5f3a\u8303\u5f0f\u7684\u8de8\u8bed\u8a00\u5f00\u6e90\u8bbf\u95ee\u63a7\u5236\u6846\u67b6\uff0c\u6211\u4eec\u4f7f\u7528\u7684\u662f\u57fa\u4e8eRESTful \u7684 [PyCasbin](https://github.com/casbin/pycasbin)\uff1b\\r\\n\\r\\n- \u6570\u636e\u5b58\u50a8\uff1aMySQL 5.7\uff1b\\r\\n\\r\\n- \u81ea\u7814 Web \u6846\u67b6 [mug-skeleton](https://github.com/chenqing24/mug-skeleton)\uff1a\u4f7f\u7528\u81ea\u7814\u7684 Web \u6846\u67b6\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u66f4\u6df1\u5c42\u6b21\u7684\u6280\u672f\u63a7\u5236\u80fd\u529b\u3002\\r\\n\\r\\n- \u5bf9\u63a5\u7684\u7b2c\u4e09\u65b9\u5e73\u53f0\u76f8\u5173\u7ec4\u4ef6\\r\\n  - CMDB\uff08\u81ea\u7814\uff09\uff1a\u5728\u5f00\u6e90\u7684 CMDBuild \u5916\u5305\u4e86\u4e00\u5c42 RESTful \u7684 API\uff0c\u65b9\u4fbf\u4ea4\u4e92\uff1b\\r\\n\\r\\n  - OpenLDAP\uff1a\u7528\u4e8e\u7528\u6237\u7684\u8d26\u53f7\u9a8c\u8bc1\uff0c\u4e0d\u8d1f\u8d23\u9274\u6743\uff1b\\r\\n\\r\\n  - \u5de5\u4f5c\u6d41 [Activiti](https://github.com/Activiti/Activiti)\uff1a\u4f7f\u7528\u5b98\u65b9\u7684 RestAPI \u670d\u52a1\uff0c\u7531\u4e8e\u662f\u5904\u4e8e\u5728\u7f51\u5173\u540e\u65b9\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u8003\u8651\u5b89\u5168\u95ee\u9898\u3002\\r\\n\\r\\n## \u4e1a\u52a1\u573a\u666f\\r\\n\\r\\n### \u7528\u6237\u767b\u5f55\u53ca\u6743\u9650\u9a8c\u8bc1\\r\\n\\r\\n\u5bf9\u4e8e\u6240\u6709\u7684 Web \u6846\u67b6\uff0c\u7528\u6237\u767b\u5f55\u662f\u4e00\u4e2a\u5fc5\u9009\u9879\uff0c\u63a5\u4e0b\u6765\u6211\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u6b64\u573a\u666f\u3002\\r\\n\\r\\n![\u7528\u6237\u767b\u5f55](https://static.apiseven.com/2022/06/blog/1/173294822-ade65508-842e-450c-bcda-d8400e102f7a.png)\\r\\n\\r\\n\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u4e86\u89e3\u4e0b\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u7684\u4f7f\u7528\u7684\u76f8\u5173\u7ec4\u4ef6\uff0c\u7b2c\u4e00\u4e2a\u5c31\u662f\u8bbf\u95ee\u7684\u524d\u7aef\uff0c\u8fd9\u4e2a\u662f\u5728\u7f51\u5173\u4e4b\u5916\u7684\uff0c\u5176\u6b21\u4f7f\u7528 APISIX \u4e91\u539f\u751f API \u7f51\u5173\u4f5c\u4e3a\u4e1a\u52a1\u8fb9\u754c\u3002\u518d\u4e4b\u540e\u7684 Auth \u670d\u52a1\uff0c\u5b83\u662f\u81ea\u5b9a\u4e49\u5f00\u53d1\u7684\u5fae\u670d\u52a1\uff0c\u4f5c\u7528\u662f\u6821\u9a8c\u524d\u7aef\u7684 URL \u8bf7\u6c42\u548c\u7528\u6237\u767b\u5f55\u8bf7\u6c42\uff0c\u5e76\u5bf9\u901a\u8fc7\u8ba4\u8bc1\u7684\u7528\u6237\u53d1\u653e Token\u3002LDAP \u4e2d\u5b58\u653e\u7684\u662f\u516c\u53f8\u5185\u90e8\u7684\u5bc6\u7801\u4fe1\u606f\u3002CMDB \u5b58\u50a8\u7684\u662f\u4e00\u4e9b\u4e1a\u52a1\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u5305\u62ec\u7ec4\u7ec7\u7ed3\u6784\uff0c\u53ef\u4ee5\u8bbf\u95ee\u7684\u6743\u9650\u7684\u4e00\u4e9b\u7ec4\u7ec7\u4fe1\u606f\uff0c\u6700\u540e\u662f\u524d\u7aef\u9700\u8981\u8bbf\u95ee\u7684\u9875\u9762\u3002\\r\\n\\r\\n\u4e86\u89e3\u5b8c\u4ee5\u4e0a\u7ec4\u4ef6\u540e\uff0c\u63a5\u4e0b\u6765\uff0c\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u6574\u4f53\u6d41\u7a0b\uff1a\\r\\n\\r\\n\u7528\u6237\u767b\u5f55\u7684\u65f6\u5019\uff0c\u9996\u5148\u9700\u8981\u901a\u8fc7\u7f51\u5173\u67e5\u8be2\uff0c\u8bbf\u95ee\u7684\u9875\u9762\u662f\u5426\u5728\u767d\u540d\u5355\u4e2d\u3002\u56e0\u4e3a\u90e8\u5206\u9875\u9762\u662f\u4e0d\u9700\u8981\u6743\u9650\u9a8c\u8bc1\u7684\uff0c\u6bd4\u5982\uff1a\u9ed8\u8ba4\u9875\u9762\u6216\u8005\u4e00\u4e9b\u9519\u8bef\u9875\u9762\u3002\u5982\u679c\u8bbf\u95ee\u7684\u9875\u9762\u662f\u9700\u8981\u9a8c\u8bc1\u767b\u5f55\u7684\uff0c\u90a3\u4e48\u8fd9\u4e9b\u8bf7\u6c42\u5c31\u4f1a\u901a\u8fc7\u76f8\u5173\u63d2\u4ef6\uff0c\u8f6c\u53d1\u5230\u6743\u9650\u8ba4\u8bc1\u670d\u52a1\u3002\\r\\n\\r\\n\u5728\u6743\u9650\u8ba4\u8bc1\u4e2d\uff0c\u9274\u6743\u670d\u52a1\u4f1a\u6839\u636e\u4f20\u5165\u7684\u201c\u7528\u6237\u540d\u201d\u548c\u201c\u5bc6\u7801\u201d\uff0c\u4ece LDAP \u4e2d\u67e5\u8be2\u8d26\u53f7\u662f\u5426\u6b63\u786e\u3002\u5982\u679c\u6b63\u786e\uff0c\u5c31\u4f1a\u901a\u8fc7 CMDB \u67e5\u8be2\u8be5\u7528\u6237\u662f\u5c5e\u4e8e\u54ea\u4e2a\u7ec4\u7ec7\u3001\u53ef\u4ee5\u67e5\u770b\u54ea\u4e9b\u529f\u80fd\u6a21\u5757\uff1b\u5f97\u5230\u7ed3\u679c\u540e\uff0c\u4f7f\u7528 APISIX \u7684 JWT \u63d2\u4ef6\uff0c\u6839\u636e\u7528\u6237\u4fe1\u606f\u751f\u6210\u4e00\u4e2a Token\uff0c\u5e76\u6dfb\u52a0\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd4\u56de\u7ed9\u524d\u7aef\uff1b\u7528\u6237\u901a\u8fc7 Cookie \u7684\u65b9\u5f0f\u8fdb\u884cToken\u5b58\u50a8\u3002\u8be5\u7528\u6237\u540e\u7eed\u5982\u679c\u7ee7\u7eed\u8bbf\u95ee\uff0c\u7f51\u5173\u4f1a\u4ece Cookie \u4e2d\u628a\u4e4b\u524d\u5b58\u50a8\u7684 Token \u8c03\u51fa\u6765\uff0c\u9a8c\u8bc1\u5f53\u524d\u7528\u6237\u662f\u5426\u53ef\u4ee5\u7ee7\u7eed\u8bbf\u95ee\u540e\u9762\u7684\u9875\u9762\u3002\\r\\n\\r\\n\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 APISIX \u7684 [`consumer-restriction`](https://apisix.apache.org/zh/docs/apisix/plugins/consumer-restriction/) \u63d2\u4ef6\uff0c\u4e0a\u8ff0\u6240\u8bb2\u7684\u6743\u9650\u8ba4\u8bc1\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u901a\u8fc7 `consumer-restriction` \u63d2\u4ef6\u6765\u5b8c\u6210\u7684\uff0c\u4e0d\u9700\u8981\u6211\u4eec\u5728\u540e\u53f0\u591a\u6b21\u53cd\u590d\u8ba4\u8bc1\u3002\\r\\n\\r\\n\u901a\u8fc7\u4e0a\u8ff0\u7684\u63cf\u8ff0\uff0c\u76f8\u4fe1\u5927\u5bb6\u5df2\u7ecf\u5bf9\u6b63\u5e38\u7684\u8bf7\u6c42\u6d41\u7a0b\u6709\u4e86\u4e00\u5b9a\u7684\u7406\u89e3\uff0c\u63a5\u4e0b\u6765\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e0b\u5982\u4f55\u5224\u65ad\u8fd9\u4e9b\u7528\u6237\u6743\u9650\u4e0d\u8db3\u7684\u573a\u666f\u3002\u5728\u8fd0\u7ef4\u5e73\u53f0\u4e2d\uff0c\u5982\u679c\u6709\u6d89\u53ca\u5230\u6570\u636e\u53d8\u66f4\u7684\u64cd\u4f5c\uff0c\u5fc5\u987b\u8981\u643a\u5e26 Token\uff0c\u5f53\u8fd9\u4e2a Token \u88ab ACL \u7684\u63a5\u53e3\u9a8c\u8bc1\u65e0\u6743\u8bbf\u95ee\u540e\uff0c\u5c31\u4f1a\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u7981\u6b62\u8bbf\u95ee\u7684\u9875\u9762\uff0c\u8ba9\u524d\u7aef\u8fdb\u884c\u5904\u7406\u3002\u4ee5\u4e0b\u662f\u7528\u6237\u767b\u5f55\u53ca\u6743\u9650\u9a8c\u8bc1\u573a\u666f\u7684\u5177\u4f53\u6d41\u7a0b\u548c\u5176\u4e2d\u66f4\u4f7f\u7528\u7684\u76f8\u5173\u7ec4\u4ef6\u3002\\r\\n\\r\\n![\u6d41\u7a0b\u56fe](https://static.apiseven.com/2022/06/blog/1/173295581-983d945f-76da-4cc1-b9f3-5531f60e9af3.png)\\r\\n\\r\\n### \u65b0\u4e1a\u52a1\u5fae\u670d\u52a1\u63a5\u5165\\r\\n\\r\\n![\u5fae\u670d\u52a1\u63a5\u5165](https://static.apiseven.com/2022/06/blog/1/173296472-4048d0fc-247c-4855-a407-3d270d366a52.png)\\r\\n\\r\\n\u5728\u65e5\u5e38\u5de5\u4f5c\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u4e0a\u7ebf\u4e00\u4e9b\u5fae\u670d\u52a1\uff0c\u90a3\u4e48\u5982\u4f55\u8ba9\u8fd9\u4e2a\u5fae\u670d\u52a1\u63a5\u5165\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\u5462\uff1f\\r\\n\\r\\n\u6211\u4eec\u5185\u90e8\u4f1a\u89c4\u5b9a\u65e0\u8bba\u5de5\u7a0b\u5e08\u4f7f\u7528\u54ea\u79cd\u8bed\u8a00\u5f00\u53d1\u5fae\u670d\u52a1\uff0c\u90fd\u9700\u8981\u4f7f\u7528 YAPI \u5bf9 API \u8fdb\u884c\u5b9a\u4e49\u3002\u56e0\u6b64 YAPI \u5bf9\u6211\u4eec\u6240\u6709\u53ef\u8bbf\u95ee\u7684\u90a3\u4e9b URL \u8fdb\u884c\u7ba1\u63a7\uff0c\u7edf\u4e00\u4e00\u4e2a\u5165\u53e3\u5728\u8fd9\u8fb9\u3002\u56e0\u4e3a YAPI \u652f\u6301\u5b9a\u4e49\u5404\u79cd\u73af\u5883\uff0c\u6240\u4ee5\u6211\u4eec\u5728 YAPI \u4e2d\u5b9a\u4e49\u4e86\u4e0d\u540c\u8fd0\u884c\u73af\u5883\u3002\u6700\u5178\u578b\u7684\u793a\u4f8b\u5c31\u662f\uff1a\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u6211\u4eec\u4f1a\u4f7f\u7528\u57df\u540d\u8bbf\u95ee\uff1b\u800c\u5728\u5f00\u53d1\u73af\u5883\uff0c\u5c31\u76f4\u63a5\u4f7f\u7528 `127.0.0.1` \u8fdb\u884c\u8bbf\u95ee\u3002\u5b8c\u6210 YAPI \u7684\u5b9a\u4e49\u540e\uff0c\u5b83\u5c31\u53ef\u4ee5\u901a\u8fc7 mock \u7684\u65b9\u5f0f\uff0c\u751f\u6210\u4e00\u7cfb\u5217\u8bf7\u6c42\u7528\u4f8b\uff0c\u975e\u5e38\u6709\u5229\u4e8e\u540e\u7eed\u8fdb\u884c\u751f\u4ea7\u73af\u5883\u7684\u6d4b\u8bd5\u3002\u6240\u6709\u7684\u5fae\u670d\u52a1\u63a5\u53e3\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7 HTTP \u8bf7\u6c42\u7684\u65b9\u5f0f\u8fdb\u884c mock \u8c03\u7528\u3002\\r\\n\\r\\n\u63a5\u4e0b\u6765\uff0c\u5c31\u662f\u6743\u9650\u7ba1\u7406\u670d\u52a1\uff0c\u8fd9\u91cc\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u81ea\u52a8\u7684\uff1a\u5b83\u4f1a\u4ece YAPI \u4e2d\u8bfb\u53d6 API \u7684\u5b9a\u4e49\uff0c\u7136\u540e\u751f\u6210\u4e00\u7cfb\u5217\u7684 ACL \u89c4\u5219\u3002\u5bf9\u4e8e\u6743\u9650\u7684\u7ba1\u7406\uff0c\u6211\u4eec\u5728\u5e73\u53f0\u4e2d\u4f7f\u7528\u4e86\u4e00\u4e2a\u7ba1\u7406\u9875\u9762\uff1a\u7ba1\u7406\u5458\u53ef\u4ee5\u901a\u8fc7\u8be5\u9875\u9762\u7ba1\u7406 URL \u7684\u8bbf\u95ee\u89c4\u5219\uff0c\u8bbe\u7f6e\u5b8c\u6210\u540e\uff0c\u8868\u5355\u6570\u636e\u5c31\u4f1a\u53d8\u66f4\u4e3a\u4e00\u7cfb\u5217\u7684 ACL \u6743\u9650\u5b9a\u4e49\uff0c\u5b58\u5165\u6570\u636e\u5e93\u4e2d\u3002\u5728\u670d\u52a1\u542f\u52a8\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5e73\u53f0\u4f7f\u7528\u7684 cachebin \u7684\u8bbf\u95ee\u6a21\u578b\u5c31\u4f1a\u76f4\u63a5\u4ece\u6570\u636e\u5e93\u4e2d\uff0c\u628a\u8fd9\u4e9b\u89c4\u5219\u52a0\u8f7d\u5230\u5185\u5b58\u91cc\uff0c\u7136\u540e\u751f\u6210\u4e00\u7cfb\u5217 APISIX \u7684 Consumer \u7684\u5b9a\u4e49\u53ca\u8def\u7531\u8868\uff0c\u5199\u5165 APISIX \u7684 etcd \u4e2d\u3002\u5b8c\u6210\u4e0a\u8ff0\u64cd\u4f5c\u540e\uff0c\u5f53\u7528\u6237\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u5e73\u53f0\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 APISIX \u8fdb\u884c\u4e00\u4e2a\u6743\u9650\u7ba1\u7406\u3002\\r\\n\\r\\n\u8be5\u6a21\u578b\u4e0d\u4f46\u9002\u7528\u4e8e\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\uff0c\u4e5f\u540c\u6837\u9002\u7528\u4e8e\u5404\u79cd\u4e2d\u5c0f\u578b\u4e1a\u52a1\u4f53\u7cfb\u3002\\r\\n\\r\\n## \u6280\u672f\u7ec6\u8282\\r\\n\\r\\n\u901a\u8fc7\u4e0a\u8ff0\u7684\u573a\u666f\u63cf\u8ff0\uff0c\u76f8\u4fe1\u5927\u5bb6\u5df2\u7ecf\u5bf9\u6574\u5957\u4f53\u7cfb\u6709\u4e86\u5927\u6982\u7684\u8ba4\u8bc6\uff0c\u63a5\u4e0b\u6765\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e0b\u90e8\u5206\u6280\u672f\u7ec6\u8282\u3002\\r\\n\\r\\n![\u6280\u672f\u7ec6\u8282](https://static.apiseven.com/2022/06/blog/1/173297301-6ee14d6e-8398-4b34-80ce-4b04ce053bad.png)\\r\\n\\r\\n\u56e0\u4e3a APISIX \u662f\u57fa\u4e8e NGINX + Lua \u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u90e8\u5206\u529f\u80fd\u9700\u8981\u901a\u8fc7 NGINX \u7684\u5e93\u6765\u5b9e\u73b0\u3002\u4ece\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5404\u79cd Lua \u811a\u672c\u53ef\u4ee5\u5728\u54ea\u4e9b\u70b9\u5207\u5165\u5230 NGINX \u5f53\u4e2d\u3002\u5728\u672c\u6587\u4e2d\uff0c\u4e3b\u8981\u662f\u4e3a\u5927\u5bb6\u4ecb\u7ecd Rewrite/Access \u4ee5\u53ca Content \u9636\u6bb5\u53ef\u4ee5\u8fdb\u884c\u7684\u64cd\u4f5c\u3002\\r\\n\\r\\n\u56e0\u4e3a\u5728 Rewrite/Access \u9636\u6bb5\uff0c\u62a5\u6587\u8fd8\u6ca1\u6709\u8f6c\u7ed9 Upstream\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728\u8be5\u9636\u6bb5\u8fdb\u884c\u5404\u79cd\u5404\u6837\u7684\u6570\u636e\u9884\u5904\u7406\u3002\u4ece\u4e0a\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u4e2a `access_by_lua`\uff0c\u5728\u8be5\u9636\u6bb5\uff0c\u53ef\u4ee5\u4f7f\u7528 deny \u547d\u4ee4\u8fdb\u884c\u6743\u9650\u7684\u7ba1\u7406\uff0c\u5305\u62ec\u63a5\u53e3\u6743\u9650\u4ee5\u53ca IP \u51c6\u5165\u767d\u540d\u5355\u90fd\u53ef\u4ee5\u5728\u8be5\u9636\u6bb5\u5b9e\u73b0\u3002\u540e\u6587\u6240\u4ecb\u7ecd\u7684 `acl_plugin.lua` \u7684\u63d2\u4ef6\u5c31\u662f\u5728\u8be5\u9636\u6bb5\u5b9e\u73b0\u7684\u3002\\r\\n\\r\\n\u5176\u6b21\u5728 `access` \u8fd9\u4e2a\u9636\u6bb5\uff0c\u5e38\u7528\u4e8e\u5728\u8bf7\u6c42\u8bbf\u95ee\u65f6\uff0c\u989d\u5916\u7684\u5728 HTTP \u8bf7\u6c42\u5934\u63d2\u5165\u4e00\u4e9b `key:value`\uff0c\u4f9b\u540e\u7eed\u4f7f\u7528\u3002\u4f8b\u5982\uff0c\u5f53\u9700\u8981\u6211\u4eec\u7ebf\u4e0a\u7070\u5ea6\u53d1\u5e03\u65f6\uff0c\u5c31\u53ef\u4ee5\u5728\u7528\u6237\u7684\u8bf7\u6c42\u5934\u4e2d\u52a0\u5165\u6807\u5fd7\u4f4d\uff0c\u901a\u8fc7\u8fd9\u4e9b\u6807\u5fd7\u4f4d\uff0c\u5c31\u53ef\u4ee5\u63a7\u5236\u8fd9\u4e9b\u8bf7\u6c42\u8f6c\u53d1\u54ea\u4e9b\u540e\u7aef\u670d\u52a1\uff0c\u4ece\u800c\u5b9e\u73b0\u7070\u5ea6\u53d1\u5e03\u3002\u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528 APISIX \u7684 [`traffic-split`](https://apisix.apache.org/zh/docs/apisix/plugins/traffic-split) \u63d2\u4ef6\u5b9e\u73b0\u7070\u5ea6\u53d1\u5e03\u3002\\r\\n\\r\\n\u6700\u540e\u5c31\u662f `log_by_lua` \u9636\u6bb5\uff0c\u5728\u8be5\u9636\u6bb5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u4e9b trace \u4fe1\u606f\u6216\u8005\u4e00\u4e9b\u6545\u969c\u4fe1\u606f\u53ef\u4ee5\u76f4\u63a5\u8f93\u5165\u5230 log \u6587\u4ef6\u4e2d\u3002\u540c\u6837\u7684\uff0c\u9488\u5bf9 `Loggers`\uff0cAPISIX \u4e5f\u63d0\u4f9b\u4e86\u975e\u5e38\u591a\u7684\u63d2\u4ef6\uff0c\u5305\u62ec `skywalking-logger`\u3001`kafka-logger`\u3001`rocketmq-logger` \u7b49\u7b49\u3002\\r\\n\\r\\n## \u81ea\u5b9a\u4e49\u63d2\u4ef6 `acl-plugin.lua`\\r\\n\\r\\n`acl-plugin.lua` \u63d2\u4ef6\u7684\u5b9e\u73b0\u975e\u5e38\u7b80\u5355\u3002\u9996\u5148\u5f53\u7528\u6237\u5728\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4f1a\u7ed9\u7528\u6237\u6dfb\u52a0\u76f8\u5173\u7684  JWT token \u5b58\u50a8\u5728 cookie \u91cc\u9762\uff0c\u4e4b\u540e\u8be5\u7528\u6237\u4f1a\u4ece\u8bbf\u95ee\u7684 cookie \u4e2d\u63d0\u53d6 JWT token\uff0c\u7136\u540e\u5bf9\u8be5 token\u8fdb\u884c\u89e3\u7801\u5e76\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u3002\\r\\n\\r\\n\u5728 Rewrite \u9636\u6bb5\uff0c\u901a\u8fc7\u4f7f\u7528\u7528\u6237 ID\u3001method\u53ca URI\uff0c\u5411\u540e\u53f0 ACL \u63a5\u53e3\u53d1\u8d77\u8bf7\u6c42\u8fdb\u884c\u6743\u9650\u9a8c\u8bc1\u3002\u5982\u679c\u901a\u8fc7\u4e86\uff0c\u5c31\u4f1a\u628a\u76f8\u5173\u4fe1\u606f\u8bb0\u5f55\u5230 log \u4e2d\uff0c\u4f9b\u4ee5\u540e\u7684\u5b89\u5168\u8ba4\u8bc1\u4f7f\u7528\u3002\u5982\u679c\u5931\u8d25\u4e86\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u72b6\u6001\u7801\u5e76\u8bb0\u5f55\u5230 error log \u4e2d\u3002\\r\\n\\r\\n\u5728 APISIX 1.1 \u7248\u672c\u4e2d\uff0c\u5f53\u65f6 `cors` \u63d2\u4ef6\u8fd8\u6ca1\u6709\u53d1\u5e03\uff0c\u56e0\u6b64\u5bf9\u4e8e\u8de8\u57df\u8bf7\u6c42\uff0c\u6211\u4eec\u4e5f\u662f\u901a\u8fc7\u8be5\u63d2\u4ef6\u8fdb\u884c\u5b9e\u73b0\uff0c\u5f53\u8bf7\u6c42\u4f7f\u7528 GET \u548c POST \u7684\u8bf7\u6c42\u65b9\u6cd5\u65f6\uff0c\u4f1a\u8fdb\u884c\u76f8\u5173\u7684\u5904\u7406\u3002\u5982\u679c\u662f\u5176\u4ed6\u8bf7\u6c42\uff0c\u5219\u4f1a\u76f4\u63a5\u901a\u8fc7\uff0c\u800c\u73b0\u5728\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 APISIX \u7684 `cors` \u63d2\u4ef6\u5b9e\u73b0\u3002APISIX \u73b0\u5728\u4e5f\u53ef\u4ee5\u4f7f\u7528\u591a\u79cd\u8bed\u8a00\u8fdb\u884c\u63d2\u4ef6\u7684\u5f00\u53d1\uff0c \u4e0d\u4ec5\u4ec5\u662f Lua\uff0c\u8be6\u7ec6\u4fe1\u606f\u53ef\u53c2\u8003\uff1ahttps://apisix.apache.org/zh/docs/apisix/plugin-develop\u3002\\r\\n\\r\\n## Auth \u670d\u52a1\\r\\n\\r\\nAuth \u670d\u52a1\u662f\u4e0e `acl-plugin.lua` \u63d2\u4ef6\u914d\u5957\u7684\u8ba4\u8bc1\u670d\u52a1\u3002\u8be5\u670d\u52a1\u5b9e\u73b0\u7684\u529f\u80fd\u975e\u5e38\u7b80\u5355\uff0c\u4e3b\u8981\u662f\u8bfb\u53d6\u8bf7\u6c42\u62a5\u6587\u4e2d\u7684\u4fe1\u606f\uff0c\u7136\u540e\u89e3\u7801\u51fa\u6240\u9700\u7684\u8ba4\u8bc1\u5143\u7d20\uff0c\u4e4b\u540e\u518d\u628a\u5b83\u8f6c\u53d1\u5230\u76f8\u5173\u7684\u670d\u52a1\u63a5\u53e3\u4e2d\u3002\u670d\u52a1\u63a5\u53e3\u4f1a\u6839\u636e\u8ba4\u8bc1\u4fe1\u606f\u8fd4\u56de\u76f8\u5e94\u7684\u7ed3\u679c\uff0cAPISIX \u4f1a\u6839\u636e\u7ed3\u679c\u62d2\u7edd\u6216\u901a\u8fc7\u8be5\u8bf7\u6c42\u3002\\r\\n\\r\\nAuth \u670d\u52a1\u4e2d\u6700\u6838\u5fc3\u7684\u529f\u80fd\u5c31\u662f\u4ece\u6570\u636e\u5e93\u4e2d\u628a ACL \u89c4\u5219\u52a0\u8f7d\u5230\u5185\u5b58\u91cc\u9762\u3002\u4e3b\u8981\u529f\u80fd\u5206\u4e3a\u4e24\u90e8\u5206\uff1a\\r\\n\\r\\n- \u9996\u5148 `account` \u63a5\u53e3\u3002\u8be5\u63a5\u53e3\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\uff1a\u7528\u6237\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u5982\u679c\u9700\u8981\u6743\u9650\u8ba4\u8bc1\uff0c\u5219\u4f1a\u901a\u8fc7\u5411 LDAP \u670d\u52a1\u53d1\u9001\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u8fdb\u884c\u8ba4\u8bc1\u3002\u5982\u679c\u8ba4\u8bc1\u901a\u8fc7\uff0c\u5219\u4f1a\u4ece CMDB \u4e2d\u67e5\u8be2\u51fa\u7528\u6237\u53ef\u8bbf\u95ee\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u7136\u540e\u548c\u7528\u6237\u89d2\u8272\u3001\u8fc7\u671f\u65f6\u95f4\u7b49\u5143\u7d20\uff0c\u4e00\u8d77\u7ec4\u6210 JWT Token\uff0c\u5e76\u751f\u6210\u4e00\u4e2a Cookie \u8fd4\u56de\u7ed9\u7528\u6237\uff0c\u5e76\u4e14\u540c\u65f6\u628a\u8be5\u7528\u6237\u4fe1\u606f\u5728 APISIX \u4e2d\u6ce8\u518c\u4e00\u4e2a Consumer \u3002\u8be5\u63a5\u53e3\u8fd8\u5b9e\u73b0\u4e86\u4e00\u4e2a `acl_check` \u7684\u529f\u80fd\uff0c\u8d1f\u8d23\u5bf9\u7528\u6237\u8ba4\u8bc1\u4fe1\u606f\u9a8c\u8bc1\uff0c\u5224\u65ad\u8be5\u8ba4\u8bc1\u662f\u6210\u529f\u8fd8\u662f\u5931\u8d25\u3002\\r\\n- \u5176\u6b21\u662f `yapi` \u63a5\u53e3\u3002\u8be5\u63a5\u53e3\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u4e0e YAPI \u8fdb\u884c\u4ea4\u4e92\u3002\u56e0\u4e3a YAPI \u4e2d\u6709\u4e00\u4e2a\u662f\u4f9b\u9879\u76ee\u8bbf\u95ee\u7684token\uff0c\u5e26\u7740\u8fd9\u4e2a token\uff0c\u5c31\u53ef\u4ee5\u8bfb\u53d6\u5230\u8fd9\u4e2a\u9879\u76ee\u6240\u6709\u7684 API\u5b9a\u4e49\u3002\u56e0\u6b64\u8be5\u63a5\u53e3\u7684\u4e3b\u8981\u529f\u80fd\uff0c\u5c31\u662f\u4ece YAPI \u4e2d\u8bfb\u53d6 API \u7684 HTTP \u63a5\u53e3\u5b9a\u4e49\uff0c\u5b58\u50a8\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u7136\u540e\u548c\u6743\u9650\u7ba1\u7406\u7684\u9875\u9762\u8fdb\u884c\u4e00\u4e2a\u8868\u5355\u4ea4\u4e92\uff0c\u7ec4\u5408\u6210 ACL \u8868\uff0c\u6700\u540e\u751f\u6210\u4e00\u7cfb\u5217 Casbin \u7684\u89c4\u5219\u5b58\u5230\u6570\u636e\u5e93\u4e2d\u3002\\r\\n\\r\\n## \u603b\u7ed3\\r\\n\\r\\n\u4ee5\u4e0a\u5c31\u662f\u540c\u7a0b\u6570\u79d1\u57fa\u4e8e Apache APISIX \u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\u7684\u67b6\u6784\u53ca\u90e8\u5206\u573a\u666f\u7684\u4ecb\u7ecd\u3002\u73b0\u5728\uff0cAPISIX \u7684\u529f\u80fd\u8d8a\u6765\u8d8a\u5f3a\u5927\uff0c\u5df2\u7ecf\u652f\u6301\u4f7f\u7528 Wasm \u548c Python \u8fdb\u884c\u63d2\u4ef6\u5f00\u53d1\u3002Apache APISIX \u7684\u751f\u6001\u4e5f\u975e\u5e38\u5f3a\u5927\uff0c\u5982\u679c\u5927\u5bb6\u6709\u4efb\u4f55\u95ee\u9898\u6b22\u8fce\u5230\u793e\u533a\u4e2d\u8fdb\u884c\u4ea4\u6d41\u8ba8\u8bba\u3002"},{"id":"APISIX \u52a9\u529b\u4e2d\u4e1c\u793e\u4ea4\u8f6f\u4ef6\uff0c\u5b9e\u73b0\u672c\u5730\u5316\u90e8\u7f72","metadata":{"permalink":"/zh/blog/2022/06/14/beeto-with-apache-apisix","source":"@site/blog/2022/06/14/beeto-with-apache-apisix.md","title":"APISIX \u52a9\u529b\u4e2d\u4e1c\u793e\u4ea4\u8f6f\u4ef6\uff0c\u5b9e\u73b0\u672c\u5730\u5316\u90e8\u7f72","description":"\u672c\u6587\u6574\u7406\u81ea\u80e1\u4e3d\u9e9f\uff08Beeto \u5e73\u53f0\u7814\u53d1\uff09\u5728 Apache APISIX Summit ASIA 2022 \u4e2d\u8fdb\u884c\u7684\u5206\u4eab\uff0c\u4ecb\u7ecd\u4e86\u4e2d\u4e1c\u793e\u4ea4\u8f6f\u4ef6 Beeto \u5982\u4f55\u4f7f\u7528 APISIX \u5b9e\u73b0\u672c\u5730\u5316\u90e8\u7f72\u3002","date":"2022-06-14T00:00:00.000Z","formattedDate":"2022\u5e746\u670814\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":19.655,"truncated":true,"authors":[{"name":"\u80e1\u4e3d\u9e9f","title":"Author"},{"name":"Sylvia","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u57fa\u4e8e Apache APISIX \u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0","permalink":"/zh/blog/2022/06/14/automated-operation-base-apache-apisix"},"nextItem":{"title":"\u963f\u91cc\u4e91 MSE \u57fa\u4e8e Apache APISIX \u7684\u5168\u94fe\u8def\u7070\u5ea6\u65b9\u6848\u5b9e\u8df5","permalink":"/zh/blog/2022/06/14/how-mse-supports-canary-release-with-apache-apisix"}},"content":"> \u672c\u6587\u6574\u7406\u81ea\u80e1\u4e3d\u9e9f\uff08Beeto \u5e73\u53f0\u7814\u53d1\uff09\u5728 [Apache APISIX Summit ASIA 2022](https://apisix-summit.org/) \u4e2d\u8fdb\u884c\u7684\u5206\u4eab\uff0c\u4ecb\u7ecd\u4e86\u4e2d\u4e1c\u793e\u4ea4\u8f6f\u4ef6 Beeto \u5982\u4f55\u4f7f\u7528 APISIX \u5b9e\u73b0\u672c\u5730\u5316\u90e8\u7f72\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## Beeto \u4ecb\u7ecd\\n\\nBeeto \u662f\u4e00\u6b3e\u9762\u5411\u4e2d\u4e1c\u5e02\u573a\u4e3b\u6253\u963f\u62c9\u4f2f\u8bed\u8a00\u7684\u793e\u4ea4\u8f6f\u4ef6\uff0c\u5728\u4ea7\u54c1\u8bbe\u8ba1\u548c\u6280\u672f\u67b6\u6784\u4e0a\u90fd\u662f\u672c\u5730\u5316\u843d\u5730\u5b9e\u65bd\u7684\u3002\u66fe\u5728\u6c99\u7279 iOS \u5e94\u7528\u5546\u5e97 Top Charts \u699c\u5355\u4e2d\u8d85\u8fc7\u8001\u724c\u793e\u4ea4\u5de8\u5934 Facebook\uff0c\u4f4d\u5217\u7b2c 4 \u540d\u3002\\n\u5176\u5b9e\u4e2d\u4e1c\u5728\u4e92\u8054\u7f51\u9886\u57df\u7b97\u662f\u53d1\u5c55\u8f83\u6210\u719f\u7684\u533a\u57df\uff0c\u5728\u793e\u4ea4\u7f51\u7edc\u4e2d\u7684\u6d3b\u8dc3\u7528\u6237\u6e17\u900f\u7387\u975e\u5e38\u9ad8\uff0c\u5c24\u5176\u5728\u6c99\u7279\u533a\u57df\uff0c2019 \u5e74\u7684\u4e92\u8054\u7f51\u7528\u6237\u5c31\u5df2\u7ecf\u8fbe\u5230\u4e86 90%\uff0c\u6d3b\u8dc3\u7528\u6237\u6e17\u900f\u7387\u5728 2020 \u5e74\u5c31\u5df2\u7ecf\u6392\u5230\u4e86\u7b2c 9 \u4f4d\u3002\\n\\n\u4e92\u8054\u7f51\u5e02\u573a\u7684\u6210\u719f\uff0c\u5e26\u6765\u7684\u662f\u56fd\u9645\u6027\u8f6f\u4ef6\u7684\u8986\u76d6\uff0c\u50cf WhatsApp\u3001YouTube \u548c Instagram \u7b49\u90fd\u662f\u5f53\u5730\u4e3b\u6d41\u7684\u793e\u4ea4\u8f6f\u4ef6\u3002\u4f46\u56de\u8fc7\u5934\u770b\uff0c\u4f60\u4f1a\u53d1\u73b0\u5728\u4e2d\u4e1c\u5730\u533a\u57fa\u672c\u6ca1\u6709\u7c7b\u4f3c\u56fd\u5185\u5fae\u535a\u8fd9\u79cd\u672c\u5730\u5316\u7684\u793e\u4ea4\u7c7b\u8f6f\u4ef6\u3002\u6240\u4ee5\u5728 Beeto \u4ea7\u54c1\u8bde\u751f\u4e4b\u524d\uff0c\u5c31\u7784\u51c6\u4e86\u300c\u4e2d\u4e1c\u4e92\u8054\u7f51\u6210\u719f\u3001\u6e17\u900f\u7387\u9ad8\uff0c\u4f46\u672c\u5730\u5316\u5c11\u300d\u7684\u65b9\u5411\uff0c\u5e76\u5f00\u542f\u4e86\u4e13\u6ce8\u300c\u672c\u5730\u5316\u7279\u8272\u300d\u7684\u4ea7\u54c1\u51c6\u5907\u3002\\n\\n![\u672c\u5730\u5316\u8bc9\u6c42](https://static.apiseven.com/2022/06/blog/beeto-1.png)\\n\\nBeeto \u5728\u4e2d\u4e1c\u5176\u5b9e\u5bf9\u6807\u7684\u662f Twitter \u548c Facebook \u8fd9\u79cd Feed \u6d41\u5e94\u7528\uff0c\u6240\u4ee5\u5728\u4e1a\u52a1\u67b6\u6784\u7684\u90e8\u7f72\u4e0a\u4e00\u5f00\u59cb\u5c31\u89c4\u5212\u597d\u4e86\u76f8\u5bf9\u5b8c\u6574\u7684\u6846\u67b6\u3002\u6bd4\u5982\u6ee1\u8db3\u793e\u4ea4\u5c5e\u6027\u7684\u5173\u7cfb\u4e92\u52a8\u3001\u5185\u5bb9\u6d88\u8d39\uff08\u56fe\u6587\u3001\u89c6\u9891\u76f4\u64ad\u3001\u540c\u57ce\u5e7f\u544a\u7b49\uff09\uff0c\u8fd8\u6709\u91d1\u878d\u7c7b\u548c\u670d\u52a1\u7c7b\u7684\u6253\u8d4f\u3001\u63d0\u73b0\u3001\u6295\u7968\u548c\u62bd\u5956\u7b49\u7b49\u5404\u79cd\u4e1a\u52a1\uff0c\u751a\u81f3\u5305\u62ec\u5e73\u53f0\u4fa7\u7684\u76d1\u7ba1\u3001\u5185\u5bb9\u5b89\u5168\u5ba1\u6838\u7b49\u8981\u6c42\u3002\\n\\n\u5728\u524d\u6587\u6211\u4eec\u4e5f\u63d0\u5230\u8fc7\uff0c\u4e2d\u4e1c\u5e02\u573a\u7684\u4e92\u8054\u7f51\u6210\u719f\u5ea6\u52bf\u5fc5\u5bf9\u4e00\u4e2a\u4ea7\u54c1\u7684\u53d1\u5e03\u6709\u7740\u9ad8\u8d28\u91cf\u7684\u8981\u6c42\uff0c\u6240\u4ee5\u60f3\u8981\u5207\u5b9e\u6253\u5165\u4e2d\u4e1c\u5e02\u573a\uff0c\u4e0d\u53ef\u80fd\u5148\u505a\u4e00\u4e2a\u7b80\u5355\u529f\u80fd\u7684\u5e94\u7528\u76f4\u63a5\u4e0a\u7ebf\u3002\\n\\n\u6240\u4ee5 Beeto \u7684\u7b2c\u4e00\u7248\u4e1a\u52a1\u67b6\u6784\u5c31\u662f\u4e00\u4e2a\u5b8c\u6574\uff0c\u5e76\u4e14\u7b26\u5408\u4e3b\u6d41\u793e\u4ea4\u8f6f\u4ef6\u5e94\u8be5\u5177\u5907\u7684\u5404\u79cd\u529f\u80fd\u96c6\u4e00\u8eab\u7684\u4ea7\u54c1\u3002\u540c\u65f6 Beeto \u7684\u76ee\u6807\u4e5f\u5f88\u660e\u786e\uff0c\u5c31\u662f\u8981\u7528\u300c\u672c\u5730\u5316\u7279\u8272\u300d\u6210\u4e3a\u4e2d\u4e1c\u5730\u533a\u6700\u5927\u7684\u963f\u62c9\u4f2f\u8bed\u793e\u4ea4\u5e73\u53f0\u548c\u6700\u597d\u7684\u963f\u62c9\u4f2f\u8bed\u793e\u533a\u3002\\n\\n## Beeto \u67b6\u6784\u8bbe\u8ba1\u4e2d\u7684\u75db\u70b9\\n\\nBeeto \u4ea7\u54c1\u8981\u8d70\u672c\u5730\u5316\u6a21\u5f0f\uff0c\u9664\u4e86\u5728\u4e1a\u52a1\u5c42\u9762\u8981\u6ee1\u8db3\u5f53\u5730\u73b0\u6709\u7684\u793e\u4ea4\u9700\u6c42\u5916\uff0c\u5728\u6280\u672f\u5c42\u9762\u4e5f\u9700\u8981\u505a\u4e00\u4e9b\u672c\u5730\u5316\u64cd\u4f5c\uff0c\u6bd4\u5982\u670d\u52a1\u90e8\u7f72\u548c\u6570\u636e\u5b58\u50a8\u7b49\u90fd\u8981\u8981\u672c\u5730\u5316\u3002\u719f\u6089\u5fae\u535a\u6216\u8005 Twitter \u7684\u6280\u672f\u670b\u53cb\u5e94\u8be5\u90fd\u77e5\u9053\uff0c\u60f3\u8981\u5b9e\u73b0\u8fd9\u79cd\u5e9e\u5927\u4fe1\u606f\u6d41\u4ea7\u54c1\u7684\u80cc\u540e\uff0c\u5176\u5b9e\u662f\u9700\u8981\u51e0\u5341\u751a\u81f3\u4e0a\u767e\u4e2a\u67b6\u6784\u7cfb\u7edf\u6765\u534f\u4f5c\u5b8c\u6210\u7684\u3002\\n\\n### \u5355\u4f53\u670d\u52a1\u67b6\u6784\u8bbe\u8ba1\\n\\n![\u670d\u52a1\u5212\u5206](https://static.apiseven.com/2022/06/blog/beeto-2.png)\\n\\n\u76ee\u524d Beeto \u4ea7\u54c1\u7684\u4e1a\u52a1\u4e3b\u8981\u53ef\u5212\u5206\u4e3a\u4ee5\u4e0a\u8fd9\u4e9b\u3002\u8fd9\u4e9b\u4e1a\u52a1\u7684\u5b9e\u73b0\u5176\u5b9e\u90fd\u9700\u8981\u5728\u4e2d\u4e1c\u5730\u533a\u8fdb\u884c\u672c\u5730\u5316\u90e8\u7f72\u3002\u5982\u679c\u628a\u6bcf\u9879\u4e1a\u52a1\u6309\u7167\u670d\u52a1\u8fdb\u884c\u62c6\u5206\u7684\u8bdd\uff0c\u90a3\u6bcf\u4e2a\u670d\u52a1\u5176\u5b9e\u5c31\u662f\u72ec\u7acb\u7684\u5355\u4f53\u67b6\u6784\u3002\\n\\n![Deployment](https://static.apiseven.com/2022/06/blog/beeto-3.png)\\n\\n\u4e0a\u56fe\u5c55\u793a\u7684\u662f\u4e00\u4e2a\u5f88\u5e38\u89c1\u7684\u90e8\u7f72\u67b6\u6784\u3002\u62ff Beeto \u7684 Feed \u6d41\u670d\u52a1\u6765\u8bf4\uff0c\u60f3\u8981\u5b9e\u73b0\u7528\u6237\u6d4f\u89c8 Feed \u6d41\u9700\u6c42\uff0c\u5c31\u5fc5\u987b\u8981\u652f\u6301\u516c\u7f51\u8bbf\u95ee\uff0c\u5373\u5357\u5317\u5411\u6d41\u91cf\u7684\u8bbf\u95ee\uff1b\u540c\u65f6 Feed \u6d41\u670d\u52a1\u8fd8\u4f1a\u63d0\u4f9b\u4e00\u4e9b\u7c7b\u4f3c\u8bdd\u9898\u4e1a\u52a1\u7b49\u5f62\u5f0f\u7684\u5185\u90e8\u8c03\u7528\uff0c\u5373\u4e1c\u897f\u5411\u6d41\u91cf\u8c03\u7528\u3002\u6240\u4ee5\u6574\u4f53\u7684\u670d\u52a1\u5c5e\u6027\u662f\u660e\u786e\u652f\u6301\u5916\u90e8\u548c\u5185\u90e8\u4e24\u79cd\u8c03\u7528\u6a21\u5f0f\uff0c\u7528\u6237\u6d41\u91cf\u7ecf\u8fc7\u4e03\u5c42\u8d1f\u8f7d\u5747\u8861\uff0c\u5206\u914d\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\u518d\u8c03\u7528\u4e0d\u540c\u7684\u5b58\u50a8\u8d44\u6e90\uff0c\u4e1c\u897f\u5411\u4e5f\u7c7b\u4f3c\u3002\u6574\u4e2a\u4e03\u5c42\u96c6\u7fa4\u8d1f\u8d23\u5904\u7406\u5357\u5317\u548c\u4e1c\u897f\u5411\u6d41\u91cf\uff0c\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u3001\u5b89\u5168\u8ba4\u8bc1\u548c\u8282\u70b9\u76d1\u63a7\u3002\\n\\n\u5f53\u628a\u591a\u9879\u4e1a\u52a1\u7684\u7684\u670d\u52a1\u7ec4\u5408\u5728\u4e00\u8d77\u65f6\uff0c\u5c31\u4f1a\u5f62\u6210\u5982\u4e0b\u6240\u793a\u7684\u6574\u4f53\u67b6\u6784\uff1a\\n\\n![\u6574\u4f53\u67b6\u6784](https://static.apiseven.com/2022/06/blog/beeto-4.png)\\n\\n\u53ef\u4ee5\u770b\u5230\uff0c\u65e0\u8bba\u662f\u9002\u914d\u5c42\u3001\u4e1a\u52a1\u5c42\u8fd8\u662f\u57fa\u7840\u670d\u52a1\u5c42\uff0c\u90fd\u5b58\u5728\u7740\u82e5\u5e72\u670d\u52a1\u3002\u6bcf\u9879\u670d\u52a1\u7684\u90e8\u7f72\u67b6\u6784\u90fd\u62e5\u6709\u524d\u6587\u63d0\u5230\u7684\u5355\u4f53\u67b6\u6784\u7ec6\u8282\uff0c\u6240\u4ee5\u4e2d\u95f4\u5c31\u4f1a\u5b58\u5728\u7740\u82e5\u5e72\u4e2a\u4e03\u5c42\u96c6\u7fa4\uff0c\u8fd9\u5176\u5b9e\u5df2\u7ecf\u662f\u4e00\u5957\u975e\u5e38\u5e9e\u5927\u4e14\u590d\u6742\u7684\u7cfb\u7edf\u67b6\u6784\u4e86\u3002\\n\\n\u4f46\u7531\u4e8e\u76ee\u524d Beeto \u4ea7\u54c1\u8fd8\u5904\u4e8e\u521b\u4e1a\u9636\u6bb5\uff0c\u5c24\u5176\u662f\u4ea7\u54c1\u672c\u8eab\u5728\u4e2d\u4e1c\u672c\u571f\u843d\u5730\uff0c\u800c\u7814\u53d1\u4eba\u5458\u5728\u4e2d\u56fd\u7684\u60c5\u5f62\uff0c\u6309\u7167\u4e0a\u8ff0\u8fd9\u4e2a\u89c4\u6a21\u90e8\u7f72\uff0c\u9700\u8981\u6295\u5165\u975e\u5e38\u5927\u7684\u670d\u52a1\u5668\u6210\u672c\u548c\u7ef4\u62a4\u6210\u672c\u3002\u540c\u65f6\u540e\u671f\u968f\u7740\u4e1a\u52a1\u589e\u52a0\uff0c\u5355\u4f53\u670d\u52a1\u7684\u6570\u91cf\u52bf\u5fc5\u4e5f\u4f1a\u4e0d\u65ad\u589e\u52a0\uff0c\u4e0d\u7ba1\u5728\u6210\u672c\u8fd8\u662f\u8fd0\u7ef4\u64cd\u4f5c\u4e0a\u90fd\u4f1a\u53d8\u5f97\u66f4\u96be\u63a7\u5236\u3002\\n\\n### \u591a\u670d\u52a1\u843d\u5730\u56f0\u96be\\n\\n\u9664\u4e86\u4e0a\u8ff0\u63d0\u5230\u7684\u67b6\u6784\u90e8\u7f72\u590d\u6742\u5916\uff0c\u5176\u5b9e\u5728\u96c6\u7fa4\u5185\u90e8\u670d\u52a1\u4e4b\u95f4\u7684\u8c03\u7528\u4e5f\u662f\u975e\u5e38\u590d\u6742\u7684\u3002\\n\\n\u5357\u5317\u5411\u6d41\u91cf\u5206\u6563\u5230\u5404\u4e2a\u670d\u52a1\u6c60\uff0c\u4e1c\u897f\u5411\u6d41\u91cf\u4e5f\u4ea4\u9519\u5728\u5404\u4e2a\u670d\u52a1\u4e4b\u95f4\uff0c\u8fd9\u4e9b\u670d\u52a1\u7684\u8c03\u7528\u5173\u7cfb\u4e4b\u95f4\u9519\u7efc\u76f8\u4ea4\u3002\u5bf9\u6bcf\u4e00\u5957\u670d\u52a1\u800c\u8a00\u90fd\u9700\u8981\u53bb\u7ef4\u62a4\u8fd9\u4e9b\u8c03\u7528\u5173\u7cfb\uff0c\u4ece\u800c\u5bfc\u81f4\u8c03\u7528\u94fe\u8def\u4e0d\u6e05\u6670\u4e14\u4e0d\u597d\u7ba1\u7406\u3002\\n\\n![\u6280\u672f\u6808\u5dee\u5f02\u5316](https://static.apiseven.com/2022/06/blog/beeto-5.png)\\n\\n\u9664\u4e86\u8c03\u7528\u5173\u7cfb\u590d\u6742\u5916\uff0c\u6bcf\u4e2a\u670d\u52a1\u4e4b\u95f4\u8fd8\u5b58\u5728\u6280\u672f\u6808\u7684\u5dee\u5f02\u3002\u6bd4\u5982\u5728\u8c03\u7528\u534f\u8bae\u4e0a\uff0c\u6709\u4e9b\u670d\u52a1\u63d0\u4f9b\u7684\u662f HTTP\uff0c\u6709\u4e9b\u5219\u662f RPC\uff1b\u800c\u5728\u5f00\u53d1\u8bed\u8a00\u4e0a\uff0c\u5219\u4f1a\u51fa\u73b0 Java\u3001Go \u7b49\u591a\u8bed\u8a00\u6df7\u5408\u7684\u60c5\u51b5\u3002\\n\\n\u4ece\u4e0a\u8ff0\u8fd9\u4e9b\u7ec6\u8282\u5c31\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u6837\u7684\u591a\u670d\u52a1\u67b6\u6784\u4f53\u7cfb\u5728\u8fdb\u884c\u672c\u5730\u843d\u5730\u65f6\uff0c\u5c31\u4f1a\u5f88\u660e\u663e\u5730\u66b4\u9732\u51fa\u90e8\u7f72\u4e0e\u7ef4\u62a4\u6210\u672c\u9ad8\u7684\u95ee\u9898\uff0c\u540c\u65f6\u6bcf\u5957\u4e03\u5c42\u670d\u52a1\u90fd\u9700\u8981\u6295\u5165\u670d\u52a1\u5668\u6210\u672c\uff0c\u800c\u5404\u4e2a\u670d\u52a1\u7684\u6d41\u91cf\u5dee\u5f02\u53c8\u4f1a\u5bfc\u81f4\u6d41\u91cf\u4e0d\u5747\u8861\uff0c\u4ece\u800c\u5bfc\u81f4\u670d\u52a1\u5668\u7b49\u8d44\u6e90\u5229\u7528\u7387\u4f4e\uff0c\u9020\u6210\u8d44\u6e90\u6d6a\u8d39\u3002\\n\\n\u7531\u4e8e\u76ee\u524d Beeto \u7684\u6210\u672c\u91cd\u70b9\u653e\u5728\u4e86\u4e1a\u52a1\u5347\u7ea7\u4e0e\u8fed\u4ee3\u4e0a\uff0c\u6240\u4ee5\u5728\u67b6\u6784\u8bbe\u8ba1\u4e0a\u66f4\u503e\u5411\u4e8e\u4fbf\u4e8e\u7ef4\u62a4\u548c\u7edf\u4e00\u7ba1\u7406\uff0c\u90a3\u4e48\u5982\u4f55\u5b9e\u73b0\u8fd9\u4e2a\u76ee\u6807\u5462\uff1f\\n\\n## APISIX \u7f51\u5173\u4e3a Beeto \u67b6\u6784\u52a9\u529b\\n\\n\u4e3a\u4e86\u89e3\u51b3\u670d\u52a1\u7ba1\u7406\u4e0d\u4fbf\u4e0e\u6210\u672c\u6295\u5165\u5927\u7684\u75db\u70b9\uff0c\u540c\u65f6\u5f97\u76ca\u4e8e APISIX \u914d\u5408 etcd \u7684\u52a8\u6001\u8868\u73b0\u66f4\u7b26\u5408 Beeto \u7684\u4ea7\u54c1\u9700\u6c42\uff0c\u6240\u4ee5\u5728\u67b6\u6784\u90e8\u7f72\u4e2d\u5f15\u5165\u4e86 APISIX \u4f5c\u4e3a\u7f51\u5173\uff0c\u5e76\u642d\u5efa\u4e86\u7f51\u5173\u96c6\u7fa4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![\u5168\u65b0\u67b6\u6784](https://static.apiseven.com/2022/06/blog/beeto-6.png)\\n\\n\u7f51\u5173\u96c6\u7fa4\u5bf9\u6240\u6709\u7684\u670d\u52a1\u90fd\u63d0\u4f9b\u4e86\u6ce8\u518c\u4e2d\u5fc3\u3001\u670d\u52a1\u63a7\u5236\u3001\u670d\u52a1\u76d1\u63a7\u3001\u534f\u8bae\u8f6c\u53d1\u548c\u5e94\u7528\u63d2\u4ef6\u7b49\u6269\u5c55\u5de5\u5177\u3002\u5404\u4e2a\u670d\u52a1\u7684\u96c6\u7fa4\u90fd\u53ef\u4ee5\u7edf\u4e00\u5728\u7f51\u5173\u8fdb\u884c\u6ce8\u518c\uff0c\u65b0\u670d\u52a1\u4e0a\u4e0b\u7ebf\u4e5f\u90fd\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u7f51\u5173\u6765\u5b8c\u6210\u3002\\n\\n![\u96c6\u7fa4\u8c03\u7528\u94fe\u8def](https://static.apiseven.com/2022/06/blog/beeto-7.png)\\n\\n\u540c\u65f6\u5f15\u5165\u7f51\u5173\u540e\uff0c\u6574\u4e2a\u96c6\u7fa4\u7684\u8c03\u7528\u94fe\u8def\u4e5f\u53d8\u5f97\u975e\u5e38\u6e05\u6670\u3002\u5357\u5317\u5411\u6d41\u91cf\u7edf\u4e00\u7531\u7f51\u5173\u8fdb\u884c\u8def\u7531\u8f6c\u53d1\uff0c\u4e1c\u897f\u5411\u6d41\u91cf\u7531\u7f51\u5173\u8fdb\u884c\u5185\u7f51\u7684\u670d\u52a1\u8f6c\u53d1\u3002\u5728\u529f\u80fd\u5c42\u9762\uff0cAPISIX \u8d1f\u8d23\u7edf\u4e00\u7ef4\u62a4\u8fd9\u4e9b\u6d41\u91cf\u6240\u8c03\u7528\u7684\u8ba4\u8bc1\uff0c\u8fd9\u6837\u5728\u7f51\u5173\u5c42\u5c31\u80fd\u591f\u6e05\u6670\u4e86\u89e3\u5230\u5404\u670d\u52a1\u4e4b\u95f4\u7684\u6027\u80fd\u5dee\u5f02\u548c\u6d41\u91cf\u5dee\u5f02\u7b49\u4fe1\u606f\u3002\\n\\n\u603b\u7ed3\u6765\u8bf4\uff0c\u5f15\u5165 APISIX \u7f51\u5173\u505a\u67b6\u6784\u6574\u5408\u4e4b\u540e\uff1a\\n\\n- \u89e3\u51b3\u4e86\u5357\u5317\u5411\u548c\u4e1c\u897f\u5411\u6d41\u91cf\u7edf\u4e00\u7684\u95ee\u9898\uff0c\u8282\u7701\u4e86\u8d44\u6e90\u548c\u4eba\u529b\u6210\u672c\uff0c\u5b9e\u73b0\u52a8\u6001\u7edf\u4e00\u7ba1\u7406\uff1b\\n- \u4e1a\u52a1\u670d\u52a1\u7684\u90e8\u7f72\u67b6\u6784\u91cd\u70b9\u5728\u670d\u52a1\u672c\u8eab\uff0c\u4ece\u800c\u5b9e\u73b0\u7f51\u5173\u72ec\u7acb\u5b58\u5728\u548c\u4e1a\u52a1\u65e0\u611f\uff1b\\n- \u901a\u8fc7\u6269\u5c55\u63d2\u4ef6\uff0c\u5404\u670d\u52a1\u7684\u6743\u9650\u9a8c\u8bc1\u3001\u8def\u7531\u5206\u53d1\u548c\u5065\u5eb7\u68c0\u67e5\u7b49\u529f\u80fd\u5747\u7531\u7f51\u5173\u6258\u7ba1\uff1b\\n- \u65b0\u4e1a\u52a1\u4e0a\u7ebf\u4e0e\u670d\u52a1\u8fc1\u79fb\u90fd\u53ef\u4ee5\u52a8\u6001\u5b8c\u6210\uff0c\u5bf9\u8fd0\u7ef4\u5341\u5206\u53cb\u597d\u3002\\n\\n\u5f53\u7136\uff0c\u7531\u4e8e\u5728\u6b64\u67b6\u6784\u4e2d\uff0c\u7f51\u5173\u627f\u8f7d\u4e86\u6240\u6709\u7684\u6d41\u91cf\uff0c\u540e\u671f\u968f\u7740\u670d\u52a1\u7684\u4e0d\u65ad\u6269\u5f20\uff0c\u670d\u52a1\u6570\u91cf\u4e5f\u4f1a\u589e\u52a0\uff0c\u5c4a\u65f6\u7f51\u5173\u7684\u7ef4\u62a4\u6210\u672c\u4e5f\u4f1a\u589e\u5927\uff0c\u5c31\u4f1a\u9700\u8981\u8003\u8651\u65b0\u7684\u5e94\u5bf9\u65b9\u6848\u3002\u4f46\u5728\u76ee\u524d\u80cc\u666f\u4e0b\uff0c\u8be5\u65b9\u6848\u4ecd\u662f\u6700\u4f18\u9009\u62e9\u3002\\n\\n## \u5e94\u7528 APISIX \u540e\u7684\u4e1a\u52a1\u5b9e\u8df5\\n\\nApache APISIX \u4f5c\u4e3a\u7f51\u5173\u53ef\u4ee5\u5728\u7f51\u5173\u5c42\u7edf\u4e00\u5904\u7406\u591a\u79cd\u7b56\u7565\uff0c\u6bd4\u5982\u5b89\u5168\u8ba4\u8bc1\u3001\u670d\u52a1\u8f6c\u53d1\u548c\u5065\u5eb7\u68c0\u67e5\u7b49\u3002\u56e0\u6b64 Beeto \u5728\u5f15\u5165 APISIX \u540e\uff0c\u5728\u4e1a\u52a1\u5b9e\u8df5\u5c42\u9762\u4e5f\u505a\u4e86\u5f88\u591a\u5c1d\u8bd5\u3002\\n\\n### \u5b89\u5168\u6027\uff1a\u8ba4\u8bc1\u63d2\u4ef6\\n\\n#### \u5357\u5317\u5411\u6d41\u91cf-Cookie\\n\\n\u6211\u4eec\u524d\u9762\u8bb2\u4e86\u516c\u7f51\u7528\u6237\u7684\u8bbf\u95ee\u6d41\u91cf\u7edf\u4e00\u7ecf\u8fc7\u7f51\u5173\u3002\u800c\u5bf9\u4e8e\u516c\u7f51\u7528\u6237\u7684\u8ba4\u8bc1\uff0c\u5219\u662f\u57fa\u4e8e Cookie \u8ba4\u8bc1\u7684\u7528\u6237\u8bf7\u6c42\u3002\u5f53\u7528\u6237\u8bf7\u6c42\u643a\u5e26 Cookie \u5230\u8fbe\u7f51\u5173\u65f6\uff0c\u5728\u7f51\u5173\u4e0a\u901a\u8fc7\u8ba4\u8bc1\u63d2\u4ef6\u5bf9\u5176\u8fdb\u884c\u9a8c\u8bc1\u3002\\n\\n![Cookie \u5904\u7406\u6d41\u7a0b](https://static.apiseven.com/2022/06/blog/beeto-8.png)\\n\\n\u5982\u4e0a\u65b9\u6d41\u7a0b\u56fe\u6240\u793a\uff0c\u63d2\u4ef6\u5185\u90e8\u4f1a\u5148\u8fdb\u884c\u672c\u5730\u5316\u9a8c\u8bc1\uff0c\u7136\u540e\u6839\u636e\u7b56\u7565\u8fdb\u884c\u8fdc\u7aef\u670d\u52a1\u7684\u8ba4\u8bc1\u6821\u9a8c\u3002\u5f53\u8bf7\u6c42\u5b8c\u6210 Cookie \u6821\u9a8c\u540e\uff0c\u518d\u8f6c\u53d1\u5230\u6307\u5b9a\u7684\u670d\u52a1\u4e0a\u3002\\n\\n\u8fd9\u6837\u505a\u7684\u4f18\u52bf\u4e3b\u8981\u4f53\u73b0\u5728\u4e24\u65b9\u9762\uff1a\\n\\n- \u786e\u4fdd\u4e86\u7528\u6237 Cookie \u7684\u4fe1\u606f\u5b89\u5168\u3002\u56e0\u4e3a Cookie \u5c5e\u4e8e\u654f\u611f\u6570\u636e\uff0c\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u786e\u4fdd\u53ea\u6709\u7f51\u5173\u5c42\u80fd\u591f\u63a5\u6536\u5e76\u8fdb\u884c\u5904\u7406\uff0c\u5176\u4ed6\u4e1a\u52a1\u5c42\u5747\u4e0d\u80fd\u63a5\u89e6\u3002\u9632\u6b62\u4e1a\u52a1\u5904\u7406\u89c4\u5219\u4e0d\u4e00\u81f4\u800c\u5bfc\u81f4\u7684\u5b89\u5168\u95ee\u9898\uff0c\u4e5f\u6709\u6548\u907f\u514d\u4e86\u4eba\u4e3a\u56e0\u7d20\u548c\u4e0d\u89c4\u8303\u95ee\u9898\u5bfc\u81f4\u7684 Cookie \u6cc4\u9732\u7b49\u5b89\u5168\u95ee\u9898\u3002\\n- \u964d\u4f4e\u4e86\u5404\u4e2a\u670d\u52a1 Cookie \u8ba4\u8bc1\u7684\u590d\u6742\u6027\u3002\u524d\u6587\u63d0\u5230\u4e86 Cookie \u5728\u8fc7\u7a0b\u4e2d\u9700\u8981\u8fdb\u884c\u672c\u5730\u9a8c\u8bc1\u6216\u8fdc\u7aef\u9a8c\u8bc1\uff0c\u540c\u65f6 Cookie \u5347\u7ea7\u65f6\uff0c\u5404\u4e2a\u670d\u52a1\u4e5f\u90fd\u9700\u8981\u540c\u6b65\u5347\u7ea7\u3002\u901a\u8fc7\u7f51\u5173\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\u4e0e\u6821\u9a8c\uff0c\u5728\u4e1a\u52a1\u670d\u52a1\u7684\u5904\u7406\u4e0a\u5c31\u7701\u53bb\u4e86\u6821\u9a8c\u6210\u672c\uff0c\u53ea\u9700\u5173\u6ce8\u7ed3\u679c\uff0c\u5229\u7528\u7ed3\u679c\u8fdb\u884c\u4e1a\u52a1\u89c4\u5219\u5904\u7406\uff0c\u4ece\u800c\u4fdd\u8bc1\u5404\u4e2a\u4e1a\u52a1\u5904\u7406\u66f4\u805a\u7126\u4e8e\u4e1a\u52a1\u672c\u8eab\u3002\\n\\n#### \u4e1c\u897f\u5411\u6d41\u91cf-Token\\n\\n\u50cf\u4e0b\u56fe\u4e2d\u7684 A \u670d\u52a1\u8c03\u7528 B \u670d\u52a1\u7684\u64cd\u4f5c\uff0c\u901a\u5e38\u6765\u8bb2\u4e92\u76f8\u8c03\u7528\u65f6\u53ea\u9700\u63d0\u4f9b\u4e00\u4e2a API \u5373\u53ef\u5b8c\u6210\u3002\u4f46\u662f\u5728\u5185\u90e8\u6d41\u7a0b\u4e2d\uff0c\u9700\u8981\u53bb\u4e86\u89e3\u300cAPI \u88ab\u8c01\u8c03\u7528\u4e86\u3001\u901a\u8fc7\u4ec0\u4e48\u65b9\u5f0f\u8c03\u7528\u7684\u3001\u662f\u5426\u9700\u8981\u8fdb\u884c\u6743\u9650\u6821\u9a8c\uff0c\u662f\u5426\u9700\u8981\u5bf9\u8c03\u7814\u65b9\u8fdb\u884c\u63a7\u5236\u300d\u7b49\u8fd9\u4e9b\u95ee\u9898\uff0c\u90fd\u662f\u9700\u8981\u5185\u90e8\u53bb\u5904\u7406\u7684\u3002\\n\\n![Token \u5904\u7406\u6d41\u7a0b](https://static.apiseven.com/2022/06/blog/beeto-9.png)\\n\\n\u6709\u4e86 APISIX \u7f51\u5173\u4e4b\u540e\uff0c\u6d41\u7a0b\u5c31\u53d8\u5f97\u7b80\u5355\u5f88\u591a\u3002\u6240\u6709\u5185\u90e8\u670d\u52a1\u7684\u4e92\u76f8\u8c03\u7528\u53ea\u9700\u5728 Auth \u8ba4\u8bc1\u670d\u52a1\u4e0a\u8fdb\u884c\u6ce8\u518c\uff0c\u7ed9\u6bcf\u4e2a\u670d\u52a1\u9881\u53d1 App key \uff0c\u7528\u6765\u8868\u660e\u670d\u52a1\u7684\u8eab\u4efd ID\u3002\u540c\u65f6\u5185\u90e8\u670d\u52a1\u4e92\u76f8\u8c03\u7528\u4e5f\u4f1a\u7ecf\u8fc7\u7f51\u5173\uff0c\u643a\u5e26 Token \u7ecf\u8fc7\u7f51\u5173\u540e\uff0c\u7f51\u5173\u4f1a\u901a\u8fc7 Token \u63d2\u4ef6\u8fdb\u884c Token \u8ba4\u8bc1\u3002\u8ba4\u8bc1\u901a\u8fc7\u540e\u4f1a\u5c06\u8ba4\u8bc1\u6807\u8bc6\u4f20\u9012\u7ed9\u88ab\u8c03\u7528\u7684\u670d\u52a1\uff0c\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u670d\u52a1\u7edf\u4e00\u8fdb\u884c\u8ba4\u8bc1\u6ce8\u518c\uff0c\u5b8c\u6210\u4e92\u76f8\u8c03\u7528\u3002\\n\\n\u5f97\u76ca\u4e8e App key \u7684 Token \u89c4\u5219\uff0c\u4e0a\u8ff0\u64cd\u4f5c\u4fbf\u4e8e\u8ffd\u6eaf\u8c03\u7528\u6765\u6e90\uff0c\u4ece\u800c\u8fdb\u884c\u95ee\u9898\u6392\u67e5\u548c\u6743\u9650\u63a7\u5236\uff0c\u5bf9\u975e\u6cd5\u8c03\u7528\u4e5f\u8d77\u5230\u4e86\u6709\u6548\u7684\u63a7\u5236\u3002\\n\\n\u6240\u4ee5\u65e0\u8bba\u662f\u5357\u5317\u5411\u6d41\u91cf\u8fd8\u662f\u4e1c\u897f\u5411\u6d41\u91cf\u7684\u8ba4\u8bc1\uff0c\u7edf\u4e00\u8ba4\u8bc1\u7684\u4f18\u52bf\u5c31\u662f\u4fdd\u8bc1\u4e86\u96c6\u7fa4\u7684\u5b89\u5168\u6027\u4e0e\u7edf\u4e00\u6027\uff0c\u5728\u95ee\u9898\u6392\u67e5\u6eaf\u6e90\u548c\u8c03\u7528\u63a7\u5236\u7b49\u65b9\u9762\u90fd\u6709\u5f88\u5927\u7684\u5e2e\u52a9\u3002\\n\\n### \u4f38\u7f29\u6027\uff1a\u65e0\u72b6\u6001\u670d\u52a1\u6269\u5bb9\u8fc1\u79fb\\n\\n\u76ee\u524d Beeto \u7684\u96c6\u7fa4\u6574\u4f53\u90e8\u7f72\u67b6\u6784\u662f\u4ece\u4e0a\u5230\u4e0b\u662f\u6309\u7167 APISIX \u7f51\u5173\u96c6\u7fa4-\u65e0\u72b6\u6001\u670d\u52a1\u7684\u4e1a\u52a1\u670d\u52a1\u96c6\u7fa4-\u6709\u72b6\u6001\u670d\u52a1\u7684\u6570\u636e\u4e2d\u5fc3\u96c6\u7fa4\u7ec4\u6210\u3002\u5728\u4e2d\u4e1c\u672c\u5730\u843d\u5730\u90e8\u7f72\u65f6\uff0c\u90fd\u662f\u90e8\u7f72\u5728\u5404\u5927\u4e91\u96c6\u7fa4\u4e0a\u7684\u3002\u6309\u7167\u4e2d\u4e1c\u5730\u533a\u7684\u4e91\u8986\u76d6\u89c4\u6a21\u548c\u4e0d\u540c\u5730\u533a\u7684\u4e91\u5382\u5546\uff0c\u5728\u8fdb\u884c\u670d\u52a1\u90e8\u7f72\u65f6\u5c31\u9700\u8981\u8003\u8651\u4e91\u670d\u52a1\u7684\u6269\u5bb9\u548c\u8fc1\u79fb\u95ee\u9898\u3002\\n\\n\u5728\u8fc1\u79fb\u7684\u8fc7\u7a0b\u4e2d\uff0cBeeto \u91cd\u70b9\u5173\u6ce8\u5728\u65e0\u72b6\u6001\u670d\u52a1\u7684\u8fc1\u79fb\u3002\u56e0\u4e3a\u6570\u636e\u4e2d\u5fc3\u7684\u8fc1\u79fb\u6210\u672c\uff0c\u51b3\u5b9a\u4e86\u5b83\u4e0d\u9002\u5408\u9002\u5408\u505a\u52a8\u6001\u8c03\u6574\uff1b\u540c\u65f6\u5927\u90e8\u5206\u8bf7\u6c42\u538b\u529b\u90fd\u662f\u7531\u65e0\u72b6\u6001\u670d\u52a1\u6765\u627f\u8f7d\u7684\uff0c\u6240\u4ee5\u4fdd\u8bc1\u65e0\u72b6\u6001\u670d\u52a1\u5177\u6709\u4e00\u4e2a\u826f\u597d\u7684\u4f38\u7f29\u6027\u662f\u975e\u5e38\u91cd\u8981\u7684\u524d\u63d0\u3002\\n\\n![\u8fc1\u79fb\u8fc7\u7a0b](https://static.apiseven.com/2022/06/blog/beeto-10.png)\\n\\n\u5728 Beeto \u7684\u67b6\u6784\u4e2d\uff0c\u670d\u52a1\u4f38\u7f29\u6027\u4e3b\u8981\u4f53\u73b0\u5728\u4e24\u4e2a\u65b9\u9762\uff0c\u5373\u5355\u4f53\u670d\u52a1\u4f38\u7f29\u6027\u548c\u6574\u4f53\u96c6\u7fa4\u4f38\u7f29\u6027\u3002\u6bd4\u5982\u67d0\u4e2a\u5355\u4f53\u670d\u52a1\u51fa\u73b0\u8d44\u6e90\u4e0d\u591f\uff0c\u9700\u8981\u8fdb\u884c\u6269\u5bb9\u64cd\u4f5c\u65f6\uff0c\u5229\u7528 APISIX \u7f51\u5173\u5c31\u53ef\u4ee5\u8fdb\u884c\u52a8\u6001\u8282\u70b9\u6dfb\u52a0\u5b9e\u73b0\u6269\u5bb9\u3002\u540c\u6837\u5728\u8de8\u96c6\u7fa4\u6216\u8005\u8de8\u4e91\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u90e8\u7f72\u591a\u4e2a APISIX \u7f51\u5173\uff0c\u5c06\u4e0d\u540c\u7684\u670d\u52a1\u8fc1\u79fb\u5230\u4e0d\u540c\u7684\u7f51\u5173\u8282\u70b9\u4e0b\u5b9e\u73b0\u96c6\u7fa4\u4f38\u7f29\u6027\u3002\\n\\n\u5bf9\u4e8e\u4e1a\u52a1\u670d\u52a1\u6765\u8bf4\uff0c\u6574\u4f53\u67b6\u6784\u6ca1\u6709\u53d8\u5316\uff0c\u5c31\u53ef\u4ee5\u5728\u7f51\u5173\u5c42\u5b9e\u73b0\u5bf9\u5404\u4e2a\u670d\u52a1\u7684\u52a8\u6001\u6269\u7f29\u5bb9\u3001\u670d\u52a1\u8fc1\u79fb\u7b49\u3002\u6574\u4e2a\u8fc7\u7a0b\u7684\u65b9\u6848\u548c\u76ee\u6807\u90fd\u5f88\u660e\u786e\uff0c\u4e00\u65e6\u6d89\u53ca\u53d8\u66f4\uff0c\u4e5f\u4e0d\u4f1a\u9020\u6210\u6574\u4f53\u67b6\u6784\u7684\u4e0d\u7a33\u5b9a\u3002\\n\\n### \u529f\u80fd\u6269\u5c55\u6027\uff1a\u4e1a\u52a1\u52a8\u6001\u8f6c\u53d1\\n\\n\u9664\u4e86\u4e0a\u8ff0\u8fd9\u4e9b\u8033\u719f\u80fd\u8be6\u7684\u7f51\u5173\u901a\u7528\u573a\u666f\u5b9e\u8df5\u5916\uff0cApache APISIX \u4e3a Beeto \u7684\u4e1a\u52a1\u52a8\u6001\u8f6c\u53d1\u5c42\u9762\u4e5f\u63d0\u4f9b\u4e86\u975e\u5e38\u5927\u7684\u5e2e\u52a9\u3002\\n\\n\u719f\u6089 APP \u7aef UI \u548c\u540e\u7aef\u7684\u670b\u53cb\u5e94\u8be5\u90fd\u77e5\u9053\uff0c\u4e0d\u540c\u7684\u4ea7\u54c1\u9875\u9762\u662f\u7531\u4e0d\u540c\u7684\u670d\u52a1\u63d0\u4f9b\u3002\u4e00\u4e2a\u9875\u9762\u662f\u7531\u4e0d\u540c\u6a21\u5757\u7ec4\u6210\u7684\uff0c\u5176\u4e2d\u7684\u5185\u5bb9\u5168\u90e8\u7531\u63a5\u53e3\u4e0b\u53d1\u3002\u63a5\u53e3\u4e0b\u53d1\u4ec0\u4e48\u6a21\u5757\u7684\u6570\u636e\uff0c\u7aef\u4e0a\u5c31\u6e32\u67d3\u6210\u4ec0\u4e48\u6837\u3002\u8fd9\u662f\u4e00\u79cd\u8054\u5408\u5ba2\u6237\u7aef\u7684\u6e32\u67d3\u89c4\u8303\uff0c\u76ee\u7684\u662f\u8ba9\u5ba2\u6237\u7aef\u7684\u6e32\u67d3\u8fc7\u7a0b\u66f4\u901a\u7528\uff0c\u4e1a\u52a1\u5904\u7406\u66f4\u7075\u6d3b\u3002\\n\\n![PageA](https://static.apiseven.com/2022/06/blog/beeto-11.png)\\n\\n\u6bd4\u5982\u4e0a\u56fe PageA \u7684\u5b9e\u73b0\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\u8c03\u7528\u4e86\u670d\u52a1 A \u7684\u63a5\u53e3\uff0c\u4e0b\u53d1\u5bf9\u5e94\u6a21\u5757\u6570\u636e\uff0c\u5b8c\u6210 PageA \u7684\u6e32\u67d3\u3002\u8fd9\u79cd\u64cd\u4f5c\u4f1a\u51fa\u73b0\u4e00\u4e2a\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u53bb\u7ef4\u62a4\u6bcf\u4e00\u4e2a\u9875\u9762\uff0c\u5bf9\u63a5\u6bcf\u4e00\u4e2a\u670d\u52a1\u7684\u63a5\u53e3\u3002\u5982\u679c\u5185\u5bb9\u51fa\u73b0\u53d8\u66f4\uff0c\u5c31\u9700\u8981\u8fdb\u884c\u53d1\u7248\u89e3\u51b3\uff0c\u64cd\u4f5c\u6027\u548c\u6548\u7387\u4f53\u73b0\u4e0a\u90fd\u5f88\u4e0d\u53cb\u597d\u3002\\n\\n\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u7684\u4e3b\u8981\u601d\u8def\u5c31\u662f\u5728\u6574\u4f53\u67b6\u6784\u4e0a\u5b9e\u73b0\u670d\u52a1\u7684\u7edf\u4e00\u5206\u53d1\u3002\u5373\u5ba2\u6237\u7aef\u9996\u5148\u7edf\u4e00\u8bf7\u6c42\u63a5\u53e3\u5730\u5740\uff0c\u5c06\u8fd9\u4e00\u7c7b\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u8f6c\u53d1\u5230\u4e00\u4e2a\u63a5\u53e3\uff0c\u5728\u7f51\u5173\u5c42\u5bf9 URL \u5730\u5740\u8fdb\u884c\u8bf7\u6c42\u53c2\u6570\u548c URL \u89c4\u5219\u7684\u5904\u7406\uff0c\u7136\u540e\u5f15\u5165\u5206\u53d1\u63d2\u4ef6\u3002\u6700\u540e\u6309\u7167\u914d\u7f6e\u89c4\u5219\uff0c\u5c06\u89e3\u6790\u540e\u7684\u8bf7\u6c42\u5728\u7f51\u5173\u5c42\u76f4\u63a5\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u6307\u5b9a\u7684\u670d\u52a1\u4e0a\u53bb\u3002\\n\\n![\u4e1a\u52a1\u52a8\u6001\u8f6c\u53d1](https://static.apiseven.com/2022/06/blog/beeto-12.png)\\n\\n\u6574\u4e2a\u8fc7\u7a0b\u5ba2\u6237\u7aef\u53ea\u9700\u786e\u5b9a\u6e32\u67d3\u89c4\u8303\uff0c\u65e0\u9700\u5173\u5fc3\u6570\u636e\u6765\u6e90\u3002\u7f51\u5173\u5c42\u627f\u62c5\u4e86\u4e1a\u52a1\u5206\u53d1\u7684\u804c\u8d23\uff0c\u76f4\u63a5\u5c06\u6d41\u91cf\u8fdb\u884c\u8f6c\u53d1\u3002\u540c\u65f6 APISIX \u4e2d\u7684\u63d2\u4ef6\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u505a\u5230\u52a8\u6001\u5b9e\u65f6\u66f4\u65b0\uff0c\u8f6c\u53d1\u89c4\u5219\u4e5f\u53ef\u4ee5\u52a8\u6001\u8c03\u6574\uff0c\u5341\u5206\u7075\u6d3b\u3002\u5176\u5b9e\u7c7b\u4f3c\u50cf BFF(Backend for Frontend) \u67b6\u6784\u7684\u5e94\u7528\uff0c\u8fd9\u79cd\u9700\u6c42\u90fd\u53ef\u4ee5\u7f51\u5173\u5c42\u8fdb\u884c\u89e3\u51b3\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4ece Beeto \u7684\u4ea7\u54c1\u8bbe\u8ba1\u89c6\u89d2\uff0c\u5448\u73b0\u4e86 Beeto \u5f15\u5165 Apache APISIX \u7f51\u5173\u540e\u7684\u8bbe\u8ba1\u601d\u8def\u548c\u4e0e\u4e1a\u52a1\u5c42\u9762\u7684\u4e00\u4e9b\u5e94\u7528\u5b9e\u8df5\u3002\u6709\u4e86 APISIX \u7f51\u5173\u7684\u52a0\u6301\uff0c\u5728\u63a7\u5236\u8d44\u6e90\u6210\u672c\u4e0e\u4e1a\u52a1\u4ea7\u54c1\u7ebf\u591a\u7684\u524d\u63d0\u4e0b\uff0c\u4e5f\u5e2e\u52a9 Beeto \u5b9e\u73b0\u4e86\u4e2d\u4e1c\u672c\u5730\u5316\u90e8\u7f72\u3001\u7edf\u4e00\u7ba1\u7406\u53ca\u8fd0\u7ef4\u53cb\u597d\u7684\u573a\u666f\u3002"},{"id":"\u963f\u91cc\u4e91 MSE \u57fa\u4e8e Apache APISIX \u7684\u5168\u94fe\u8def\u7070\u5ea6\u65b9\u6848\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/06/14/how-mse-supports-canary-release-with-apache-apisix","source":"@site/blog/2022/06/14/how-mse-supports-canary-release-with-apache-apisix.md","title":"\u963f\u91cc\u4e91 MSE \u57fa\u4e8e Apache APISIX \u7684\u5168\u94fe\u8def\u7070\u5ea6\u65b9\u6848\u5b9e\u8df5","description":"\u672c\u6587\u63cf\u8ff0\u4e86\u963f\u91cc\u4e91\u5fae\u670d\u52a1\u5f15\u64ce MSE \u5982\u4f55\u57fa\u4e8e APISIX \u7075\u6d3b\u7684\u8def\u7531\u80fd\u529b\uff0c\u914d\u5408 MSE \u5168\u94fe\u8def\u7070\u5ea6\u80fd\u529b\u6765\u5b9e\u73b0\u5168\u94fe\u8def\u7070\u5ea6\uff0c\u91ca\u653e\u57fa\u4e8e APISIX \u7684\u5fae\u670d\u52a1\u67b6\u6784\u7684\u65b0\u4ef7\u503c\u3002","date":"2022-06-14T00:00:00.000Z","formattedDate":"2022\u5e746\u670814\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":13.53,"truncated":true,"authors":[{"name":"\u6cee\u5723\u4f1f","title":"Author"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"APISIX \u52a9\u529b\u4e2d\u4e1c\u793e\u4ea4\u8f6f\u4ef6\uff0c\u5b9e\u73b0\u672c\u5730\u5316\u90e8\u7f72","permalink":"/zh/blog/2022/06/14/beeto-with-apache-apisix"},"nextItem":{"title":"API \u7f51\u5173 Apache APISIX \u52a9\u529b\u96ea\u7403\u53cc\u6d3b\u67b6\u6784\u6f14\u8fdb","permalink":"/zh/blog/2022/06/14/xueqiu-with-apache-apisix"}},"content":"> \u672c\u7bc7\u6587\u7ae0\u63cf\u8ff0\u4e86\u963f\u91cc\u4e91\u5fae\u670d\u52a1\u5f15\u64ce MSE \u5982\u4f55\u57fa\u4e8e Apache APISIX \u7075\u6d3b\u7684\u8def\u7531\u80fd\u529b\uff0c\u914d\u5408 MSE \u5168\u94fe\u8def\u7070\u5ea6\u80fd\u529b\uff0c\u901a\u8fc7\u6781\u7b80\u7684\u914d\u7f6e\u4e0e\u65e0\u4ee3\u7801\u4fb5\u5165\u7684\u65b9\u5f0f\uff0c\u6765\u5b9e\u73b0\u5168\u94fe\u8def\u7070\u5ea6\uff0c\u91ca\u653e\u57fa\u4e8e APISIX \u7684\u5fae\u670d\u52a1\u67b6\u6784\u7684\u65b0\u4ef7\u503c\u3002\\r\\n\\r\\n\x3c!--truncate--\x3e\\r\\n\\r\\nApache APISIX \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u4f5c\u4e3a API \u7f51\u5173\uff0c\u5b83\u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7b49\u7279\u70b9\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u6765\u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4ee5\u53ca\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5f53\u505a K8s Ingress controller \u6765\u4f7f\u7528\u3002\u5f97\u76ca\u4e8e APISIX \u5168\u52a8\u6001\u7684\u8bbe\u8ba1\uff0c\u53ef\u4ee5\u968f\u65f6\u8fdb\u884c\u914d\u7f6e\u66f4\u6539\u5e76\u4e14\u5747\u4e0d\u9700\u8981\u91cd\u542f\u670d\u52a1\u3002\\r\\n\\r\\n\u963f\u91cc\u4e91\u5fae\u670d\u52a1\u5f15\u64ce MSE \u63d0\u4f9b\u4e86\u975e\u5e38\u6613\u7528\u7684\u6d41\u91cf\u6cf3\u9053\u80fd\u529b\uff0c\u57fa\u4e8e Java Agent \u5b57\u8282\u7801\u589e\u5f3a\u7684\u6280\u672f\u5b9e\u73b0\uff0c\u65e0\u7f1d\u652f\u6301\u5e02\u9762\u4e0a\u8fd1 5 \u5e74\u7684\u6240\u6709 Spring Cloud \u548c Dubbo \u7684\u7248\u672c\uff0c\u901a\u8fc7\u6781\u7b80\u7684\u914d\u7f6e\u4e0e\u65e0\u4ee3\u7801\u4fb5\u5165\u7684\u65b9\u5f0f\uff0c\u6765\u5b9e\u73b0\u5168\u94fe\u8def\u7070\u5ea6\uff0c\u91ca\u653e\u57fa\u4e8e APISIX \u7684\u5fae\u670d\u52a1\u67b6\u6784\u7684\u65b0\u4ef7\u503c\u3002\\r\\n\\r\\n## \u5168\u94fe\u8def\u7070\u5ea6\u65b9\u6848\u7b80\u4ecb\\r\\n\\r\\n### \u76f8\u5173\u6982\u5ff5\\r\\n\\r\\n- \u6cf3\u9053\uff1a\u4e3a\u76f8\u540c\u7248\u672c\u5e94\u7528\u5b9a\u4e49\u7684\u4e00\u5957\u9694\u79bb\u73af\u5883\u3002\u53ea\u6709\u6ee1\u8db3\u4e86\u6d41\u63a7\u8def\u7531\u89c4\u5219\u7684\u8bf7\u6c42\u6d41\u91cf\u624d\u4f1a\u8def\u7531\u5230\u5bf9\u5e94\u6cf3\u9053\u91cc\u7684\u6253\u6807\u5e94\u7528\u3002\u4e00\u4e2a\u5e94\u7528\u53ef\u4ee5\u5c5e\u4e8e\u591a\u4e2a\u6cf3\u9053\uff0c\u4e00\u4e2a\u6cf3\u9053\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u5e94\u7528\uff0c\u5e94\u7528\u548c\u6cf3\u9053\u662f\u591a\u5bf9\u591a\u7684\u5173\u7cfb\u3002\\r\\n- \u57fa\u7ebf\u73af\u5883\uff1a\u672a\u6253\u6807\u7684\u5e94\u7528\u5c5e\u4e8e\u57fa\u7ebf\u7a33\u5b9a\u7248\u672c\u7684\u5e94\u7528\uff0c\u5373\u7a33\u5b9a\u7684\u7ebf\u4e0a\u73af\u5883\u3002\\r\\n- \u6d41\u91cf\u56de\u9000\uff1a\u6cf3\u9053\u4e2d\u6240\u90e8\u7f72\u7684\u670d\u52a1\u6570\u91cf\u5e76\u975e\u8981\u6c42\u4e0e\u57fa\u7ebf\u73af\u5883\u5b8c\u5168\u4e00\u81f4\uff0c\u5f53\u6cf3\u9053\u4e2d\u5e76\u4e0d\u5b58\u5728\u8c03\u7528\u94fe\u4e2d\u6240\u4f9d\u8d56\u7684\u5176\u4ed6\u670d\u52a1\u65f6\uff0c\u6d41\u91cf\u9700\u8981\u56de\u9000\u81f3\u57fa\u7ebf\u73af\u5883\uff0c\u8fdb\u4e00\u6b65\u5728\u5fc5\u8981\u7684\u65f6\u5019\u8def\u7531\u56de\u5bf9\u5e94\u6807\u7b7e\u7684\u6cf3\u9053\u3002\\r\\n- \u6cf3\u9053\u7ec4\uff1a\u6cf3\u9053\u7684\u96c6\u5408\u3002\u6cf3\u9053\u7ec4\u7684\u4f5c\u7528\u4e3b\u8981\u662f\u4e3a\u4e86\u533a\u5206\u4e0d\u540c\u56e2\u961f\u6216\u4e0d\u540c\u573a\u666f\u3002\\r\\n\\r\\n### \u4e1a\u52a1\u573a\u666f\\r\\n\\r\\n\u57fa\u4e8e\u6d41\u91cf\u6cf3\u9053\u7684\u5168\u94fe\u8def\u7070\u5ea6\u80fd\u529b\uff0c\u9002\u7528\u4e8e\u4ee5\u4e0b\u4e1a\u52a1\u573a\u666f\uff1a\\r\\n\\r\\n- \u65e5\u5e38\u5f00\u53d1/\u9879\u76ee/\u6d4b\u8bd5\u73af\u5883\u9694\u79bb\uff1b\\r\\n- \u5168\u94fe\u8def\u7070\u5ea6\u53d1\u5e03\uff1b\\r\\n- \u9ad8\u53ef\u7528\u540c\u673a\u623f\u4f18\u5148\u8def\u7531\uff1b\\r\\n- \u5168\u94fe\u8def\u538b\u6d4b\u3002\\r\\n\\r\\n### \u6280\u672f\u539f\u7406\\r\\n\\r\\n\u5982\u4f55\u5728\u5b9e\u9645\u4e1a\u52a1\u573a\u666f\u4e2d\u53bb\u5feb\u901f\u843d\u5730\u5168\u94fe\u8def\u7070\u5ea6\u5462\uff1f\u76ee\u524d\u4e3b\u8981\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff0c\u57fa\u4e8e\u7269\u7406\u73af\u5883\u9694\u79bb\u548c\u57fa\u4e8e\u903b\u8f91\u73af\u5883\u9694\u79bb\u3002\\r\\n\\r\\n#### \u7269\u7406\u73af\u5883\u9694\u79bb\\r\\n\\r\\n\u7269\u7406\u73af\u5883\u9694\u79bb\uff0c\u5176\u5b9e\u5c31\u662f\u901a\u8fc7\u589e\u52a0\u673a\u5668\u7684\u65b9\u5f0f\u6765\u642d\u5efa\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u6d41\u91cf\u9694\u79bb\u3002\\r\\n\\r\\n![\u7269\u7406\u73af\u5883\u9694\u79bb](https://static.apiseven.com/2022/06/blog/2/173307762-c8d3c115-c7c0-415d-94eb-f259cadab3bb.png)\\r\\n\\r\\n\u8be5\u65b9\u6848\u9700\u8981\u4e3a\u7070\u5ea6\u7684\u670d\u52a1\u642d\u5efa\u4e00\u5957\u7f51\u7edc\u9694\u79bb\u3001\u8d44\u6e90\u72ec\u7acb\u7684\u73af\u5883\uff0c\u5e76\u5728\u5176\u4e2d\u90e8\u7f72\u670d\u52a1\u7684\u7070\u5ea6\u7248\u672c\u3002\u7531\u4e8e\u4e0e\u6b63\u5f0f\u73af\u5883\u9694\u79bb\uff0c\u6b63\u5f0f\u73af\u5883\u4e2d\u7684\u5176\u4ed6\u670d\u52a1\u65e0\u6cd5\u8bbf\u95ee\u5230\u9700\u8981\u7070\u5ea6\u7684\u670d\u52a1\uff0c\u6240\u4ee5\u9700\u8981\u5728\u7070\u5ea6\u73af\u5883\u4e2d\u5197\u4f59\u90e8\u7f72 \u8fd9\u4e9b\u7ebf\u4e0a\u670d\u52a1\uff0c\u4ee5\u4fbf\u6574\u4e2a\u8c03\u7528\u94fe\u8def\u6b63\u5e38\u8fdb\u884c\u6d41\u91cf\u8f6c\u53d1\u3002\u6b64\u5916\uff0c\u6ce8\u518c\u4e2d\u5fc3\u7b49\u4e00\u4e9b\u5176\u4ed6\u4f9d\u8d56\u7684\u4e2d\u95f4\u4ef6\u7ec4\u4ef6\u4e5f\u9700\u8981\u5197\u4f59\u90e8\u7f72\u5728\u7070\u5ea6\u73af\u5883\u4e2d\uff0c\u4fdd\u8bc1\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u53ef\u89c1\u6027\u95ee\u9898\uff0c\u786e\u4fdd\u83b7\u53d6\u7684\u8282\u70b9 IP \u5730\u5740\u53ea\u5c5e\u4e8e\u5f53\u524d\u7684\u7f51\u7edc\u73af\u5883\u3002\\r\\n\\r\\n\u8be5\u65b9\u6848\u4e00\u822c\u7528\u4e8e\u4f01\u4e1a\u7684\u6d4b\u8bd5\u3001\u9884\u5f00\u53d1\u73af\u5883\u7684\u642d\u5efa\uff0c\u5bf9\u4e8e\u7ebf\u4e0a\u7070\u5ea6\u53d1\u5e03\u5f15\u6d41\u7684\u573a\u666f\u6765\u8bf4\u5176\u7075\u6d3b\u6027\u4e0d\u591f\u3002\u5e76\u4e14\u5fae\u670d\u52a1\u591a\u7248\u672c\u7684\u5b58\u5728\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u662f\u975e\u5e38\u5e38\u89c1\u7684\uff0c\u9700\u8981\u4e3a\u8fd9\u4e9b\u4e1a\u52a1\u573a\u666f\u91c7\u7528\u5806\u673a\u5668\u7684\u65b9\u5f0f\u6765\u7ef4\u62a4\u591a\u5957\u7070\u5ea6\u73af\u5883\u3002\u5982\u679c\u5e94\u7528\u6570\u76ee\u5f88\u5c0f\uff0c\u8be5\u65b9\u5f0f\u662f\u53ef\u4ee5\u88ab\u53d7\u7684\uff1b\u5982\u679c\u60a8\u7684\u5e94\u7528\u6570\u76ee\u8fc7\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u9020\u6210\u8fd0\u7ef4\u3001\u673a\u5668\u6210\u672c\u8fc7\u5927\uff0c\u6210\u672c\u548c\u4ee3\u4ef7\u8fdc\u8d85\u6536\u76ca\u3002\\r\\n\\r\\n#### \u903b\u8f91\u73af\u5883\u9694\u79bb\\r\\n\\r\\n\u53e6\u4e00\u79cd\u65b9\u6848\u662f\u6784\u5efa\u903b\u8f91\u4e0a\u7684\u73af\u5883\u9694\u79bb\uff0c\u6211\u4eec\u53ea\u9700\u90e8\u7f72\u670d\u52a1\u7684\u7070\u5ea6\u7248\u672c\uff0c\u6d41\u91cf\u5728\u8c03\u7528\u94fe\u8def\u4e0a\u6d41\u8f6c\u65f6\uff0c\u7531\u7ecf\u8fc7\u7684\u7f51\u5173\u3001\u5404\u4e2a\u4e2d\u95f4\u4ef6\u4ee5\u53ca\u5404\u4e2a\u5fae\u670d\u52a1\u6765\u8bc6\u522b\u7070\u5ea6\u6d41\u91cf\uff0c\u5e76\u52a8\u6001\u8f6c\u53d1\u81f3\u5bf9\u5e94\u670d\u52a1\u7684\u7070\u5ea6\u7248\u672c\u3002\u5982\u4e0b\u56fe\uff1a\\r\\n\\r\\n![\u903b\u8f91\u73af\u5883\u9694\u79bb](https://static.apiseven.com/2022/06/blog/2/173314750-0a86a58f-b89f-4421-b841-015bb3cd5869.png)\\r\\n\\r\\n\u4e0a\u56fe\u53ef\u4ee5\u5f88\u597d\u5c55\u793a\u8fd9\u79cd\u65b9\u6848\u7684\u6548\u679c\uff0c\u6211\u4eec\u7528\u4e0d\u540c\u7684\u989c\u8272\u6765\u8868\u793a\u4e0d\u540c\u7248\u672c\u7684\u7070\u5ea6\u6d41\u91cf\uff0c\u53ef\u4ee5\u770b\u51fa\u65e0\u8bba\u662f\u5fae\u670d\u52a1\u7f51\u5173\u8fd8\u662f\u5fae\u670d\u52a1\u672c\u8eab\u90fd\u9700\u8981\u8bc6\u522b\u6d41\u91cf\uff0c\u6839\u636e\u6cbb\u7406\u89c4\u5219\u505a\u51fa\u52a8\u6001\u51b3\u7b56\u3002\u5f53\u670d\u52a1\u7248\u672c\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u8fd9\u4e2a\u8c03\u7528\u94fe\u8def\u7684\u8f6c\u53d1\u4e5f\u4f1a\u5b9e\u65f6\u6539\u53d8\u3002\u76f8\u6bd4\u4e8e\u5229\u7528\u673a\u5668\u642d\u5efa\u7684\u7070\u5ea6\u73af\u5883\uff0c\u8fd9\u79cd\u65b9\u6848\u4e0d\u4ec5\u53ef\u4ee5\u8282\u7701\u5927\u91cf\u7684\u673a\u5668\u6210 \u672c\u548c\u8fd0\u7ef4\u4eba\u529b\uff0c\u800c\u4e14\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u8005\u5b9e\u65f6\u5feb\u901f\u7684\u5bf9\u7ebf\u4e0a\u6d41\u91cf\u8fdb\u884c\u7cbe\u7ec6\u5316\u7684\u5168\u94fe\u8def\u63a7\u5236\u3002\\r\\n\\r\\n## \u57fa\u4e8e Apache APISIX \u5168\u94fe\u8def\u7070\u5ea6\u4ea7\u54c1\u5b9e\u8df5\\r\\n\\r\\n\u5168\u94fe\u8def\u7070\u5ea6\u662f\u5fae\u670d\u52a1\u6700\u6838\u5fc3\u7684\u529f\u80fd\u4e4b\u4e00\uff0c\u4e5f\u662f\u4e91\u4e0a\u7528\u6237\u5728\u5fae\u670d\u52a1\u5316\u6df1\u5165\u8fc7\u7a0b\u4e2d\u5fc5\u987b\u5177\u5907\u7684\u529f\u80fd\u3002\u5168\u94fe\u8def\u7070\u5ea6\u56e0\u4e3a\u6d89\u53ca\u5230\u7684\u6280\u672f\u548c\u573a\u666f\u4f17\u591a\uff0c\u5982\u679c\u4f01\u4e1a\u4e00\u4e00\u8fdb\u884c\u81ea\u6211\u5b9e\u73b0\uff0c\u9700\u8981\u82b1\u8d39\u5927\u91cf\u4eba\u529b\u6210\u672c\u5bf9\u5176\u8fdb\u884c\u6269\u5c55\u4e0e\u8fd0\u7ef4\u3002\\r\\n\\r\\nMSE \u670d\u52a1\u6cbb\u7406\u63d0\u4f9b\u4e86\u5b8c\u6574\u7684\u4ea7\u54c1\u5316\u7684\u5168\u94fe\u8def\u7070\u5ea6\u89e3\u51b3\u65b9\u6848\uff0c\u8986\u76d6 RPC\u3001MQ\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u7edd\u5927\u591a\u6570\u573a \u666f\u3002\u53ea\u8981\u67b6\u6784\u662f\u57fa\u4e8e Spring Cloud \u6216\u8005 Dubbo \u6846\u67b6\uff0c\u5e94\u7528\u65e0\u9700\u5347\u7ea7\u6216\u4ee3\u7801\u6539\u52a8\uff0c\u5373\u53ef\u5b9e\u73b0\u4f01\u4e1a\u7ea7\u5168\u94fe\u8def\u7070\u5ea6\u529f\u80fd\u3002\\r\\n\\r\\n### \u4f7f\u7528\u524d\u63d0\\r\\n\\r\\n#### \u7b2c\u4e00\u6b65\uff1a\u5b89\u88c5 APISIX \u76f8\u5173\u7ec4\u4ef6\\r\\n\\r\\n1. \u5b89\u88c5 APISIX\u3001apisix-ingress-controller\u3001etcd \u7b49\u7ec4\u4ef6\u3002\\r\\n\\r\\n```C++\\r\\nhelm repo add apisix https://charts.apiseven.com\\r\\nhelm repo add bitnami https://charts.bitnami.com/bitnami\\r\\nhelm repo update\\r\\nkubectl create ns ingress-apisix\\r\\nhelm install apisix apisix/apisix \\\\\\r\\n  --set gateway.type=LoadBalancer \\\\\\r\\n  --set ingress-controller.enabled=true \\\\\\r\\n  --set etcd.persistence.storageClass=\\"alicloud-disk-ssd\\" \\\\\\r\\n  --set etcd.persistence.size=\\"20Gi\\" \\\\\\r\\n  --namespace ingress-apisix \\\\\\r\\n  --set ingress-controller.config.apisix.serviceNamespace=ingress-apisix\\r\\nkubectl get service --namespace ingress-apisix\\r\\n```\\r\\n\\r\\n\u5728 `ingress-apisix` \u547d\u540d\u7a7a\u95f4\u4e0b\u53ef\u4ee5\u770b\u5230\u65e0\u72b6\u6001\u7684 APISIX \u548c `apisix-ingress-controller` \u5e94\u7528\u3001\u4ee5\u53ca\u6709\u72b6\u6001\u7684 etcd \u5e94\u7528\u3002\\r\\n\\r\\n2. \u4f7f\u7528 Helm \u5b89\u88c5 APISIX Dashboard\u3002\\r\\n\\r\\n```SQL\\r\\nhelm repo add apisix https://charts.apiseven.com\\r\\nhelm repo update\\r\\nhelm install apisix-dashboard apisix/apisix-dashboard --namespace\\r\\ningress-apisix\\r\\n```\\r\\n\\r\\n3. \u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u7ed1\u5b9a\u4e00\u4e2a SLB\u3002\\r\\n4. \u901a\u8fc7 `{slb-ip}:9000` \u8bbf\u95ee APISIX Dashboard\u3002\\r\\n\\r\\n![Dashboard](https://static.apiseven.com/2022/06/blog/2/173316825-e590decb-4c35-4602-9590-41ddde8b93cf.png)\\r\\n\\r\\n#### \u7b2c\u4e8c\u6b65\uff1a\u5f00\u542f\u5fae\u670d\u52a1\u6cbb\u7406\\r\\n\\r\\n\u8fd9\u4e00\u6b65\u9aa4\u4e2d\uff0c\u9700\u8981\u5f00\u901a MSE \u5fae\u670d\u52a1\u6cbb\u7406\u3001\u5b89\u88c5 MSE \u670d\u52a1\u6cbb\u7406\u7ec4\u4ef6\uff08ack-onepilot\uff09\u5e76\u4e3a\u5e94\u7528\u5f00\u542f\u5fae\u670d\u52a1\u6cbb\u7406\u3002\u5177\u4f53\u64cd\u4f5c\u4fe1\u606f\u53ef\u53c2\u8003[\u963f\u91cc\u4e91\u5b98\u65b9\u6559\u7a0b](https://help.aliyun.com/product/123350.html)\u3002\\r\\n\\r\\n#### \u7b2c\u4e09\u6b65\uff1a\u90e8\u7f72 Demo \u5e94\u7528\u7a0b\u5e8f\\r\\n\\r\\n\u5728\u963f\u91cc\u4e91\u5bb9\u5668\u670d\u52a1\u4e2d\u90e8\u7f72 A\u3001B\u3001C \u4e09\u4e2a\u5e94\u7528\uff0c\u6bcf\u4e2a\u5e94\u7528\u5206\u522b\u90e8\u7f72\u2f00\u4e2a`base` \u7248\u672c\u548c\u2f00\u4e2a`gray` \u7248\u672c\uff1b\u5e76\u90e8\u7f72\u2f00\u4e2a Nacos Server \u5e94\u7528\uff0c\u7528\u4e8e\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u3002\u5177\u4f53\u53ef\u53c2\u8003\u6b64\u6559\u7a0b\u5b8c\u6210\u5e94\u7528\u90e8\u7f72\uff1a[\u90e8\u7f72Demo \u5e94\u7528\u7a0b\u5e8f](https://help.aliyun.com/document_detail/404845.html#h3-url-3)\u3002\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 APISIX Dashboard \u4e3a\u5e94\u7528\u914d\u7f6e `Service` \u8fdb\u884c\u4e0a\u6e38\u914d\u7f6e\u3002\\r\\n\\r\\n### \u5e94\u7528\u573a\u666f\u4e00\uff1a\u6309\u57df\u540d\u8fdb\u884c\u8def\u7531\\r\\n\\r\\n\u5728\u90e8\u5206\u573a\u666f\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0d\u540c\u7684\u57df\u540d\u6765\u533a\u5206\u7ebf\u4e0a\u57fa\u7ebf\u73af\u5883\u548c\u7070\u5ea6\u73af\u5883\u3002\u7070\u5ea6\u73af\u5883\u6709\u5355\u72ec\u7684\u57df\u540d\u53ef\u4ee5\u914d\u7f6e\uff0c\u5047\u8bbe\u6211\u4eec\u901a\u8fc7\u8bbf\u95ee [www.gray.com](http://www.gray.com/) \u6765\u8bf7\u6c42\u7070\u5ea6\u73af\u5883\uff0c\u8bbf\u95ee [www.base.com](http://www.base.com/) \u8d70\u57fa\u7ebf\u73af\u5883\u3002\\r\\n\\r\\n![\u5e94\u7528\u573a\u666f\u4e00](https://static.apiseven.com/2022/06/blog/2/173319294-d27fc48a-4d42-4578-9457-4ab9072528a4.png)\\r\\n\\r\\n\u8c03\u7528\u94fe\u8def `Ingress-nginx -> A -> B -> C`\uff0c\u5176\u4e2d A \u53ef\u4ee5\u662f\u4e00\u4e2a `spring-boot` \u7684\u5e94\u7528\u3002\\r\\n\\r\\n#### \u914d\u7f6e APISIX \u8def\u7531\u89c4\u5219\\r\\n\\r\\n\u5728 APISIX Dashboard \u9009\u62e9\u8def\u7531\u5e76\u5355\u51fb\u521b\u5efa\u3002\u5339\u914d\u6761\u4ef6\u4e2d\u57df\u540d\u3001\u8bf7\u6c42\u8def\u5f84\u9009\u62e9 /*\uff0c\u9009\u62e9\u5bf9\u5e94\u7684\u4e0a\u6e38\u3002\u5206\u522b\u914d\u7f6e\u5982\u4e0b\u8def\u7531\uff1a\\r\\n\\r\\n- \u5f53 `host` \u4e3a `www.base.com` \u65f6\uff0c\u8def\u7531\u5230 id \u4e3a `401152455435354748` \u6240\u5bf9\u5e94\u7684\u4e0a\u6e38\uff0c\u5373 `spring-cloud-a-svc`\uff1b\\r\\n- \u5f53 `host`\u4e3a `www.gray.com` \u65f6\uff0c\u8def\u7531\u5230 id \u4e3a `401163331936715388` \u6240\u5bf9\u5e94\u7684\u4e0a\u6e38\uff0c\u5373 `spring-cloud-a-gray-svc`\u3002\\r\\n\\r\\n\u7136\u540e\u8fdb\u884c `base` \u5bf9\u5e94\u7684\u8def\u7531\u914d\u7f6e\uff1a\\r\\n\\r\\n```JSON\\r\\n{\\r\\n  \\"uri\\": \\"/*\\",\\r\\n  \\"name\\": \\"spring-cloud-a\\",\\r\\n  \\"methods\\": [\\r\\n    \\"GET\\",\\r\\n    \\"POST\\",\\r\\n    \\"PUT\\",\\r\\n    \\"DELETE\\",\\r\\n    \\"PATCH\\",\\r\\n    \\"HEAD\\",\\r\\n    \\"OPTIONS\\",\\r\\n    \\"CONNECT\\",\\r\\n    \\"TRACE\\"\\r\\n  ],\\r\\n  \\"host\\": \\"www.base.com\\",\\r\\n  \\"upstream_id\\": \\"401152455435354748\\",\\r\\n  \\"labels\\": {\\r\\n  \\"API_VERSION\\": \\"0.0.1\\"\\r\\n  },\\r\\n  \\"status\\": 1\\r\\n}\\r\\n```\\r\\n\\r\\n\u8fdb\u884c `gray` \u5bf9\u5e94\u7684\u8def\u7531\u914d\u7f6e\uff1a\\r\\n\\r\\n```JSON\\r\\n{\\r\\n  \\"uri\\": \\"/*\\",\\r\\n  \\"name\\": \\"spring-cloud-a-gray\\",\\r\\n  \\"priority\\": 1,\\r\\n  \\"methods\\": [\\r\\n    \\"GET\\",\\r\\n    \\"POST\\",\\r\\n    \\"PUT\\",\\r\\n    \\"DELETE\\",\\r\\n    \\"PATCH\\",\\r\\n    \\"HEAD\\",\\r\\n    \\"OPTIONS\\",\\r\\n    \\"CONNECT\\",\\r\\n    \\"TRACE\\"\\r\\n  ],\\r\\n  \\"host\\": \\"www.gray.com\\",\\r\\n  \\"upstream_id\\": \\"401163331936715388\\",\\r\\n  \\"labels\\": {\\r\\n    \\"API_VERSION\\": \\"0.0.1\\"\\r\\n  },\\r\\n  \\"status\\": 1\\r\\n}\\r\\n```\\r\\n\\r\\n#### \u914d\u7f6e MSE \u5168\u94fe\u8def\u7070\u5ea6\\r\\n\\r\\n\u4f60\u9700\u8981\u914d\u7f6e\u5b8c\u6210 MSE \u7684\u5168\u94fe\u8def\u53d1\u5e03\uff0c\u5177\u4f53\u64cd\u4f5c\u7ec6\u8282\u53ef\u53c2\u8003\u6b64\u6559\u7a0b\uff1a[\u914d\u7f6e\u5168\u94fe\u8def\u7070\u5ea6](https://help.aliyun.com/document_detail/404845.html)\u3002\\r\\n\\r\\n#### \u7ed3\u679c\u9a8c\u8bc1\\r\\n\\r\\n\u8bbf\u95ee `www.base.com` \u8def\u7531\u5230 A \u5e94\u7528\u7684 `base` \u7248\u672c\uff1a\\r\\n\\r\\n```Nginx\\r\\ncurl -H\\"Host:www.base.com\\" http://47.97.253.177/a\\r\\nA[172.18.144.15] -> B[172.18.144.125] -> C[172.18.144.90]%\\r\\n```\\r\\n\\r\\n\u8bbf\u95ee `www.gray.com` \u8def\u7531\u5230 A \u5e94\u7528\u7684 `gray` \u7248\u672c\uff1a\\r\\n\\r\\n```Nginx\\r\\ncurl -H\\"Host:www.gray.com\\" http://47.97.253.177/a\\r\\nAgray[172.18.144.16] -> Bgray[172.18.144.57] -> Cgray[172.18.144.157]%\\r\\n```\\r\\n\\r\\n### \u5e94\u7528\u573a\u666f\u4e8c\uff1a\u6309\u6307\u5b9a\u8bf7\u6c42\u53c2\u6570\u8fdb\u884c\u8def\u7531\\r\\n\\r\\n\u6709\u4e9b\u5ba2\u6237\u7aef\u65e0\u6cd5\u6539\u5199\u57df\u540d\uff0c\u5e0c\u671b\u80fd\u8bbf\u95ee `www.demo.com` \u901a\u8fc7\u4f20\u5165\u4e0d\u540c\u7684\u53c2\u6570\u6765\u8def\u7531\u5230\u7070\u5ea6\u73af\u5883\u3002\u4f8b\u5982\u4e0b\u56fe\u4e2d\uff0c\u901a\u8fc7 `env=gray` \u8fd9\u4e2a\u8bf7\u6c42\u53c2\u6570\uff0c\u6765\u8bbf\u95ee\u7070\u5ea6\u73af\u5883\u3002\\r\\n\\r\\n![\u5e94\u7528\u573a\u666f\u4e8c](https://static.apiseven.com/2022/06/blog/2/173321500-ee604a73-f41b-4fc1-8861-c591bbb9d257.png)\\r\\n\\r\\n\u8c03\u7528\u94fe\u8def `Ingress-APISIX -> A -> B -> C`\uff0c\u5176\u4e2d A \u53ef\u4ee5\u662f\u4e00\u4e2a `spring-boot` \u7684\u5e94\u7528\u3002\\r\\n\\r\\n#### \u914d\u7f6e APISIX \u8def\u7531\u89c4\u5219\\r\\n\\r\\n\u5728 APISIX Dashboard \u9009\u62e9\u8def\u7531\u5e76\u5355\u51fb\u521b\u5efa\u3002\u5339\u914d\u6761\u4ef6\u4e2d\u65b0\u5efa\u9ad8\u7ea7\u5339\u914d\u89c4\u5219\u3001\u8bf7\u6c42\u8def\u5f84\u9009\u62e9 /*\uff0c\u9009\u62e9\u5bf9\u5e94\u7684\u4e0a\u6e38\u3002\u5206\u522b\u914d\u7f6e\u5982\u4e0b\u8def\u7531\uff1a\\r\\n\\r\\n- \u5f53 `host` \u4e3a `www.demo.com`\uff0c\u8bf7\u6c42\u53c2\u6570 `env=gray` \u65f6\uff0c\u8def\u7531\u4f18\u5148\u5339\u914d `id` \u4e3a `401163331936715388` \u6240\u5bf9\u5e94\u7684\u4e0a\u6e38\uff0c\u5373 `spring-cloud-a-gray-svc`\uff1b\\r\\n- \u5f53 `host` \u4e3a www.demo.com \u65f6\uff0c\u8def\u7531\u7ecf\u4f1a\u5339\u914d `id` \u4e3a `401152455435354748` \u6240\u5bf9\u5e94\u7684\u4e0a\u6e38\uff0c\u5373 `spring-cloud-a-svc`\u3002\\r\\n\\r\\n\u7136\u540e\u8fdb\u884c `base` \u5bf9\u5e94\u7684\u8def\u7531\u914d\u7f6e\uff1a\\r\\n\\r\\n```JSON\\r\\n{\\r\\n  \\"uri\\": \\"/*\\",\\r\\n  \\"name\\": \\"spring-cloud-a\\",\\r\\n  \\"methods\\": [\\r\\n    \\"GET\\",\\r\\n    \\"POST\\",\\r\\n    \\"PUT\\",\\r\\n    \\"DELETE\\",\\r\\n    \\"PATCH\\",\\r\\n    \\"HEAD\\",\\r\\n    \\"OPTIONS\\",\\r\\n    \\"CONNECT\\",\\r\\n    \\"TRACE\\"\\r\\n  ],\\r\\n  \\"host\\": \\"www.demo.com\\",\\r\\n  \\"upstream_id\\": \\"401152455435354748\\",\\r\\n  \\"labels\\": {\\r\\n    \\"API_VERSION\\": \\"0.0.1\\"\\r\\n  },\\r\\n  \\"status\\": 1\\r\\n}\\r\\n```\\r\\n\\r\\n\u8fdb\u884c `gray` \u5bf9\u5e94\u7684\u8def\u7531\u914d\u7f6e\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\r\\n\\r\\n![\u914d\u7f6e\u56fe](https://static.apiseven.com/2022/06/blog/2/173322176-ab677577-8595-4875-85cb-2dc799070871.png)\\r\\n\\r\\n```JSON\\r\\n{\\r\\n  \\"uri\\": \\"/*\\",\\r\\n  \\"name\\": \\"spring-cloud-a-gray\\",\\r\\n  \\"priority\\": 1,\\r\\n  \\"methods\\": [\\r\\n    \\"GET\\",\\r\\n    \\"POST\\",\\r\\n    \\"PUT\\",\\r\\n    \\"DELETE\\",\\r\\n    \\"PATCH\\",\\r\\n    \\"HEAD\\",\\r\\n    \\"OPTIONS\\",\\r\\n    \\"CONNECT\\",\\r\\n    \\"TRACE\\"\\r\\n  ],\\r\\n  \\"host\\": \\"www.demo.com\\",\\r\\n  \\"vars\\": [\\r\\n    [\\r\\n      \\"arg_env\\",\\r\\n      \\"==\\",\\r\\n      \\"gray\\"\\r\\n    ]\\r\\n  ],\\r\\n  \\"upstream_id\\": \\"401163331936715388\\",\\r\\n  \\"labels\\": {\\r\\n  \\"API_VERSION\\": \\"0.0.1\\"\\r\\n  },\\r\\n  \\"status\\": 1\\r\\n}\\r\\n```\\r\\n\\r\\n#### \u914d\u7f6e MSE \u5168\u94fe\u8def\u7070\u5ea6\\r\\n\\r\\n\u914d\u7f6e MSE \u5168\u94fe\u8def\u7070\u5ea6\u6b65\u9aa4\u4e0e**\u5e94****\u7528****\u573a\u666f****\u4e00**\u7684\u5185\u5bb9\u4e00\u81f4\u3002\\r\\n\\r\\n#### \u7ed3\u679c\u9a8c\u8bc1\\r\\n\\r\\n\u6b64\u65f6\uff0c\u8bbf\u95ee `www.demo.com` \u8def\u7531\u5230\u57fa\u7ebf\u73af\u5883\uff1a\\r\\n\\r\\n```Nginx\\r\\ncurl -H\\"Host:www.demo.com\\" http://47.97.253.177/a\\r\\nA[172.18.144.15] -> B[172.18.144.125] -> C[172.18.144.90]%\\r\\n```\\r\\n\\r\\n\u6b64\u65f6\uff0c\u8bbf\u95ee `www.demo.com` \u540c\u65f6 `env=gray` \u65f6\u8def\u7531\u5230\u7070\u5ea6\u73af\u5883\uff1a\\r\\n\\r\\n```Nginx\\r\\ncurl -H\\"Host:www.demo.com\\" http://47.97.253.177/a?env=gray\\r\\nAgray[172.18.144.16] -> Bgray[172.18.144.57] -> Cgray[172.18.144.157]%\\r\\n```\\r\\n\\r\\n> \u6ce8\u610f\uff1a\u5176\u4e2d `47.97.253.177` \u4e3a APISIX \u7684\u516c\u7f51 IP\u3002\\r\\n\\r\\n## \u603b\u7ed3\\r\\n\\r\\n\u57fa\u4e8e Apache APISIX \u7075\u6d3b\u7684\u8def\u7531\u80fd\u529b\uff0c\u914d\u5408 MSE \u5168\u94fe\u8def\u7070\u5ea6\u80fd\u529b\uff0c\u53ef\u4ee5\u5feb\u901f\u5b9e\u73b0\u4f01\u4e1a\u7ea7\u7684\u5168\u94fe\u8def\u7070\u5ea6\u7684\u80fd\u529b\u3002\\r\\n\\r\\nAPSIX \u652f\u6301\u6309\u7167 Header\u3001Cookie\u3001Params\u3001\u57df\u540d\u7b49\u591a\u79cd\u65b9\u5f0f\u8fdb\u884c\u8def\u7531\uff0c\u53ea\u9700\u8981\u5728\u7f51\u5173\u4fa7\u6839\u636e\u9700\u6c42\u5c06\u6d41\u91cf\u8def\u7531\u81f3\u4e0d\u540c\u7684\u201c\u6cf3\u9053\u201d\u73af\u5883\u540e\uff0c\u6d41\u91cf\u5728\u5bf9\u5e94\u6807\u7b7e\u7684\u201c\u6cf3\u9053\u201d\u4e2d\u81ea\u52a8\u95ed\u73af\uff0c\u5f53\u6cf3\u9053\u4e2d\u5e76\u4e0d\u5b58\u5728\u8c03\u7528\u94fe\u4e2d\u6240\u4f9d\u8d56\u7684\u5176\u4ed6\u670d\u52a1\u65f6\uff0c\u6d41\u91cf\u9700\u8981\u56de\u9000\u81f3\u57fa\u7ebf\u73af\u5883\uff0c\u8fdb\u4e00\u6b65\u5728\u5fc5\u8981\u7684\u65f6\u5019\u8def\u7531\u56de\u5bf9\u5e94\u6807\u7b7e\u7684\u6cf3\u9053\u3002"},{"id":"API \u7f51\u5173 Apache APISIX \u52a9\u529b\u96ea\u7403\u53cc\u6d3b\u67b6\u6784\u6f14\u8fdb","metadata":{"permalink":"/zh/blog/2022/06/14/xueqiu-with-apache-apisix","source":"@site/blog/2022/06/14/xueqiu-with-apache-apisix.md","title":"API \u7f51\u5173 Apache APISIX \u52a9\u529b\u96ea\u7403\u53cc\u6d3b\u67b6\u6784\u6f14\u8fdb","description":"\u672c\u6587\u6574\u7406\u81ea\u96ea\u7403\u57fa\u7840\u7ec4\u4ef6\u56e2\u961f\u5728 Apache APISIX Summit ASIA 2022 \u4e0a\u7684\u5206\u4eab\uff0c\u4ecb\u7ecd\u4e86\u96ea\u7403\u5728\u53cc\u6d3b\u67b6\u6784\u7684\u8c03\u6574\u4e2d\u5982\u4f55\u501f\u52a9 APISIX \u5b9e\u73b0\u66f4\u7075\u6d3b\u7684\u4e1a\u52a1\u3002","date":"2022-06-14T00:00:00.000Z","formattedDate":"2022\u5e746\u670814\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":14.37,"truncated":true,"authors":[{"name":"\u96ea\u7403\u57fa\u7840\u7ec4\u4ef6\u56e2\u961f","title":"Author"},{"name":"Sylvia","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u963f\u91cc\u4e91 MSE \u57fa\u4e8e Apache APISIX \u7684\u5168\u94fe\u8def\u7070\u5ea6\u65b9\u6848\u5b9e\u8df5","permalink":"/zh/blog/2022/06/14/how-mse-supports-canary-release-with-apache-apisix"},"nextItem":{"title":"API \u7f51\u5173 Apache APISIX \u5728 AWS Graviton3 \u4e0a\u7684\u5b89\u88c5\u4e0e\u6027\u80fd\u6d4b\u8bd5","permalink":"/zh/blog/2022/06/07/installation-performance-test-of-apigateway-apisix-on-aws-graviton3"}},"content":"> \u672c\u6587\u6574\u7406\u81ea\u96ea\u7403\u57fa\u7840\u7ec4\u4ef6\u56e2\u961f\u5728 [Apache APISIX Summit ASIA 2022](https://apisix-summit.org/) \u4e0a\u7684\u5206\u4eab\uff0c\u4ecb\u7ecd\u4e86\u96ea\u7403\u5728\u53cc\u6d3b\u67b6\u6784\u7684\u8c03\u6574\u4e2d\u5982\u4f55\u501f\u52a9 APISIX \u5b9e\u73b0\u66f4\u7075\u6d3b\u7684\u4e1a\u52a1\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\\n\\n\u96ea\u7403\u6210\u7acb\u4e8e 2010 \u5e74\uff0c\u8d77\u6b65\u4e8e\u6295\u8d44\u793e\u533a\uff0c\u73b0\u5df2\u6210\u4e3a\u56fd\u5185\u9886\u5148\u7684\u96c6\u6295\u8d44\u3001\u4ea4\u6d41\u548c\u4ea4\u6613\u4e3a\u4e00\u4f53\u7684\u5728\u7ebf\u7ba1\u7406\u5e73\u53f0\uff0c\u4e3a\u6295\u8d44\u8005\u63d0\u4f9b\u4f18\u8d28\u5185\u5bb9\u3001\u5b9e\u65f6\u884c\u60c5\u3001\u4ea4\u6613\u5de5\u5177\u3001\u8d22\u5bcc\u7ba1\u7406\u7b49\u591a\u79cd\u670d\u52a1\u3002\\n\\n\u5176\u4e2d\u5b9e\u65f6\u884c\u60c5\u670d\u52a1\u5bf9\u63a5\u4e86\u591a\u79cd\u4e0a\u6e38\u6570\u636e\u6e90\uff0c\u901a\u8fc7\u6570\u636e\u6d41\u5f0f\u8ba1\u7b97\u3001\u5b58\u50a8\u4e0e\u5206\u53d1\uff0c\u4e3a\u6295\u8d44\u8005\u63d0\u4f9b\u7a33\u5b9a\u7684\u6570\u636e\u670d\u52a1\u3002\u6240\u4ee5\u5b9e\u65f6\u884c\u60c5\u4e00\u76f4\u662f\u96ea\u7403\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u7684\u8d44\u6e90\u6d88\u8017\u5927\u6237\uff0c\u6301\u7eed\u5728\u9ad8\u6c34\u4f4d\u8fd0\u884c\u3002\u96ea\u7403\u5185\u90e8\u4e00\u9879\u91cd\u8981\u7684\u5de5\u4f5c\u5c31\u662f\u6301\u7eed\u8fdb\u884c\u7a33\u5b9a\u6027\u5efa\u8bbe\uff0c\u5176\u4e2d\u5305\u62ec\u5bf9\u884c\u60c5\u670d\u52a1\u8fdb\u884c\u6027\u80fd\u4f18\u5316\u3002\u5373\u4fbf\u5982\u6b64\uff0c\u5728\u5076\u7136\u53d1\u751f\u6781\u7aef\u884c\u60c5\u7684\u60c5\u51b5\u4e0b\uff0c\u90e8\u5206\u7cfb\u7edf\u4ecd\u4f1a\u56e0\u4e3a\u6570\u636e\u91cf\u6fc0\u589e\u800c\u53d1\u751f\u54cd\u5e94\u53d8\u6162\uff0c\u751a\u81f3\u662f\u4e0d\u53ef\u7528\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\\n\\n\u5728\u6b64\u80cc\u666f\u4e0b\uff0c\u96ea\u7403\u4e3a\u4e86\u5411\u5e7f\u5927\u6295\u8d44\u8005\u63d0\u4f9b\u7a33\u5b9a\u4f18\u8d28\u7684\u670d\u52a1\uff0c\u542f\u52a8\u4e86\u670d\u52a1\u53cc\u6d3b\u6539\u9020\u8ba1\u5212\u3002Apache APISIX \u80fd\u6781\u5927\u5730\u7b80\u5316\u53cc\u6d3b\u67b6\u6784\u7684\u5b9e\u65bd\u590d\u6742\u5ea6\u3002\u540c\u65f6 APISIX \u81ea\u8eab\u7684\u4e91\u539f\u751f\u529f\u80fd\u7279\u6027\u3001\u4e30\u5bcc\u7684\u793e\u533a\u751f\u6001\u548c\u63d2\u4ef6\u7b49\uff0c\u4e5f\u4e3a\u96ea\u7403\u672a\u6765\u4e91\u539f\u751f\u67b6\u6784\u7684\u6f14\u8fdb\u6253\u4e0b\u4e86\u826f\u597d\u57fa\u7840\u3002\u672c\u6587\u5c06\u4ecb\u7ecd\u96ea\u7403\u516c\u53f8\u662f\u5982\u4f55\u501f\u52a9 Apache APISIX \u5b9e\u73b0\u5185\u90e8\u53cc\u6d3b\u67b6\u6784\u7684\u6f14\u8fdb\u3002\\n\\n![\u539f\u67b6\u6784](https://static.apiseven.com/2022/06/blog/xueqiu-1.png)\\n\\n\u4e0a\u56fe\u662f\u96ea\u7403\u5355\u673a\u623f\u65f6\u671f\u7684\u7b80\u5355\u67b6\u6784\u63cf\u8ff0\uff0c\u7528\u6237\u6d41\u91cf\u4ece\u4e91\u7aef\u5165\u53e3\uff08SLB\uff09\u8fdb\u6765\u540e\uff0c\u7ecf\u7f51\u5173\u8fdb\u884c\u7b80\u5355\u7684\u516c\u5171\u6027\u903b\u8f91\u5904\u7406\uff0c\u5411\u540e\u7aef\u670d\u52a1\u8f6c\u53d1\u3002\u540e\u7aef\u670d\u52a1\u4f1a\u901a\u8fc7 SDK \u7684\u65b9\u5f0f\uff0c\u7531\u96c6\u6210\u5728\u670d\u52a1\u4e2d\u7684\u9274\u6743\u6a21\u5757\u5411\u96ea\u7403\u7528\u6237\u4e2d\u5fc3\u53d1\u8d77\u7528\u6237\u9274\u6743\uff0c\u901a\u8fc7\u540e\u5219\u7ee7\u7eed\u8fdb\u884c\u540e\u7eed\u7684\u4e1a\u52a1\u5904\u7406\u3002\\n\\n### \u53cc\u6d3b\u6539\u9020\u75db\u70b9\\n\\n\u5728\u5b9e\u8df5\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u8be5\u67b6\u6784\u4e0b\u4e00\u4e9b\u75db\u70b9\u4e5f\u5f00\u59cb\u9010\u6e10\u663e\u73b0\u3002\\n\\n1. SDK \u9274\u6743\u6a21\u5757\u590d\u6742\\n\\n\u5728\u53cc\u6d3b\u6539\u9020\u5b9e\u65bd\u8fc7\u7a0b\u4e2d\uff0c\u5fae\u670d\u52a1\u7684\u63d0\u4f9b\u65b9\u548c\u6d88\u8d39\u65b9\u65e0\u6cd5\u5b8c\u5168\u540c\u6b65\u8fdb\u884c\u90e8\u7f72\u4e0a\u7ebf\u3002\u5f53\u884c\u60c5\u670d\u52a1\u9996\u5148\u5728\u4e91\u7aef\u4e0a\u7ebf\uff0c\u800c\u96ea\u7403\u7528\u6237\u4e2d\u5fc3\u8fd8\u4e0d\u5177\u5907\u4e91\u7aef\u670d\u52a1\u80fd\u529b\u65f6\uff0c\u4fbf\u4f1a\u51fa\u73b0\u8de8\u673a\u623f\u8c03\u7528\u7684\u60c5\u51b5\u3002\u6839\u636e\u7528\u6237\u4e2d\u5fc3\u7edf\u8ba1\uff0c\u5176 RPC \u8c03\u7528\u91cf\u65e5\u5747\u7ea6\u6570\u5341\u4ebf\uff0c\u5cf0\u503c\u53ef\u8fbe\u5230 50K QPS\uff0c\u5728\u884c\u60c5\u9ad8\u7684 QPS \u573a\u666f\u4e0b\u4f1a\u5e26\u6765\u8f83\u9ad8\u5ef6\u8fdf\u3002\\n\\n\u540c\u65f6\u96ea\u7403\u9274\u6743\u4e1a\u52a1\u590d\u6742\u5ea6\u8f83\u9ad8\uff0c\u9664 OAuth2.0 / JWT \u534f\u8bae\u5916\uff0c\u8fd8\u9700\u8981\u517c\u987e\u5ba2\u6237\u7aef\u7248\u672c\u3001\u96ea\u7403\u65d7\u4e0b\u591a\u4e2a APP \u7b49\u591a\u79cd\u56e0\u7d20\u3002\u7531\u4e8e\u9274\u6743\u6a21\u5757\u5d4c\u5165\u4e86\u670d\u52a1\u5185\uff0c\u5bfc\u81f4\u5347\u7ea7\u4e5f\u53d8\u5f97\u8f83\u4e3a\u56f0\u96be\u3002\\n\\n2. OpenResty \u529f\u80fd\u6027\u7a0d\u6709\u4e0d\u8db3\\n\\n\u96ea\u7403\u5728\u4e4b\u524d\u4e00\u76f4\u5c06 OpenResty \u4f5c\u4e3a\u7f51\u5173\uff0c\u5176\u81ea\u8eab\u529f\u80fd\u6027\u4e0a\u7565\u6709\u4e0d\u8db3\u3002\u6240\u4ee5\u5c06 OpenResty \u96c6\u6210\u96ea\u7403\u73b0\u6709\u76d1\u63a7\u4f53\u7cfb\u65f6\uff0c\u4ecd\u9700\u8981\u4e00\u5b9a\u7684\u5de5\u4f5c\u91cf\uff1b\u540c\u65f6\u6269\u5c55\u6d41\u7a0b\u7e41\u7410\uff0c\u8fd8\u9700\u8981\u8fd0\u7ef4\u4fa7\u53bb\u6dfb\u52a0\u81ea\u5b9a\u4e49\u811a\u672c\u8fdb\u884c\u5b9e\u73b0\u3002\\n\\n3. \u4f9d\u8d56\u81ea\u7814\u6ce8\u518c\u4e2d\u5fc3\\n\\n\u76ee\u524d\u96ea\u7403\u7684 HTTP \u670d\u52a1\u6ce8\u518c\u662f\u5728\u540e\u7aef\u670d\u52a1\u542f\u52a8\u65f6\uff0c\u8bf7\u6c42\u6ce8\u518c\u4e2d\u5fc3\u5c06\u81ea\u8eab\u6ce8\u518c\u5230\u7f51\u5173\uff0c\u670d\u52a1\u505c\u6b62\u65f6\u8bf7\u6c42\u6ce8\u518c\u4e2d\u5fc3\u8fdb\u884c\u670d\u52a1\u8282\u70b9\u6458\u9664\uff0c\u6ce8\u518c\u4e2d\u5fc3\u4f1a\u5b9a\u671f\u8f6e\u8be2\u670d\u52a1\u8282\u70b9\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\u3002\u4f46\u81ea\u7814\u7684\u670d\u52a1\u76f8\u6bd4\u5f00\u6e90\u9879\u76ee\u800c\u8a00\uff0c\u7ef4\u62a4\u6210\u672c\u8f83\u9ad8\u3002\\n\\n### API \u7f51\u5173\u9009\u578b\\n\\n\u6240\u4ee5\u5728\u8fd9\u4e9b\u75db\u70b9\u4e4b\u4e0a\uff0c\u96ea\u7403\u5185\u90e8\u5e0c\u671b\u5728\u4e0d\u5f15\u5165\u8fc7\u591a\u53d8\u91cf\u7684\u540c\u65f6\uff0c\u5c3d\u91cf\u4fdd\u8bc1\u5bf9\u4e1a\u52a1\u65b9\u900f\u660e\u4ee5\u53ca\u6700\u5c0f\u5316\u6539\u52a8\uff1b \u53ef\u4ee5\u5c06\u95ee\u9898\u5728\u57fa\u7840\u8bbe\u65bd\u5c42\u9762\u8fdb\u884c\u7edf\u4e00\u5904\u7406\uff0c\u5e76\u4e14\u5c3d\u91cf\u5c06\u9274\u6743\u670d\u52a1\u5728\u672c\u673a\u623f\u5b8c\u6210\u3002\u7efc\u4e0a\u8003\u8651\uff0c\u96ea\u7403\u51b3\u5b9a\u5c06\u9274\u6743\u670d\u52a1\u79fb\u81f3 API \u7f51\u5173\u8fdb\u884c\u5b8c\u6210\u3002\\n\\n![\u8bc9\u6c42\u4e0e\u8c03\u7814](https://static.apiseven.com/2022/06/blog/xueqiu-2.png)\\n\\n\u57fa\u4e8e\u5728\u4e1a\u52a1\u5b9e\u8df5\u573a\u666f\u4e2d\u9010\u6e10\u663e\u73b0\u7684\u75db\u70b9\uff0c\u96ea\u7403\u57fa\u7840\u8bbe\u65bd\u56e2\u961f\u5f00\u59cb\u4e86\u9488\u5bf9\u7f51\u5173\u4ea7\u54c1\u7684\u8c03\u7814\u3002\u901a\u8fc7\u5185\u90e8\u8bc9\u6c42\u548c\u76ee\u524d\u5e02\u573a\u4e2d\u7f51\u5173\u4ea7\u54c1\u7684\u5bf9\u6bd4\uff0c\u6700\u7ec8\u9009\u62e9\u4e86\u57fa\u4e8e Apache APISIX \u8fdb\u884c\u540e\u7eed\u67b6\u6784\u7684\u8c03\u6574\u4e0e\u4f7f\u7528\u3002\\n\\n![APISIX \u751f\u6001\u56fe](https://static.apiseven.com/2022/06/blog/xueqiu-3.png)\\n\\n## \u57fa\u4e8e Apache APISIX \u7684\u5b9e\u8df5\\n\\n### \u8c03\u6574\u540e\u67b6\u6784\\n\\n![\u65b0\u67b6\u6784](https://static.apiseven.com/2022/06/blog/xueqiu-4.png)\\n\\n\u5982\u4e0a\u56fe\u662f\u76ee\u524d\u96ea\u7403\u884c\u60c5\u53cc\u6d3b\u67b6\u6784\u3002\u5de6\u4fa7\u5c55\u793a\u7684\u662f\u5728\u539f\u673a\u623f\u91cc\u5bf9\u5e94\u7684\u67b6\u6784\uff0c\u5e76\u6ca1\u6709\u8fdb\u884c\u592a\u591a\u6539\u52a8\uff1b\u53f3\u4fa7\u5c55\u793a\u7684\u5219\u662f\u4e0a\u4e91\u4e4b\u540e\u57fa\u4e8e\u591a Region \u8bbe\u8ba1\u7684\u591a\u6d3b\u67b6\u6784\u3002\\n\\n\u4e0a\u8ff0\u67b6\u6784\u4e3b\u8981\u57fa\u4e8e APISIX \u8fdb\u884c\u4e86\u5982\u4e0b\u8c03\u6574\uff1a\\n\\n- \u5c06\u9274\u6743\u6a21\u5757\u7edf\u4e00\u8c03\u6574\u5230\u4ee3\u7406\u5c42\uff0c\u5229\u7528 APISIX \u8fdb\u884c\u7edf\u4e00\u9274\u6743\u65b9\u5f0f\u3002\u5176\u4e2d\u6d89\u53ca\u5230 JWT \u7c7b\u578b\u7684\u53ef\u4ee5\u76f4\u63a5\u5229\u7528 APISIX `jwt-auth` \u63d2\u4ef6\u8fdb\u884c\u672c\u5730\u9274\u6743\uff1b\\n- \u517c\u5bb9 OAuth 2.0 \u5f62\u5f0f\uff0c\u5229\u7528 APISIX \u7edf\u4e00\u8c03\u7528\u96ea\u7403\u7528\u6237\u4e2d\u5fc3\u8fdb\u884c\u5904\u7406\uff1b\\n- \u5bf9\u63a5\u96ea\u7403\u540e\u7aef RPC \u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\uff0c\u7528\u4e8e JWT \u9274\u6743\u5931\u8d25\u65f6\u4f7f\u7528\u96ea\u7403\u540e\u7aef\u670d\u52a1\u6765\u9274\u6743\u3002\\n\\n### \u5e94\u7528\u573a\u666f\u5c55\u793a\\n\\n\u5728\u540e\u7aef\u670d\u52a1\u63a5\u5165 APISIX \u540e\uff0c\u4e3b\u8981\u5728\u7f51\u5173\u9274\u6743\u548c\u53ef\u89c2\u6d4b\u6027\u7b49\u5c42\u9762\u8fdb\u884c\u4e86\u4e00\u4e9b\u5b9e\u8df5\u3002\\n\\n#### \u573a\u666f\u4e00\uff1a\u7f51\u5173\u9274\u6743\\n\\n\u5728\u524d\u6587\u4e2d\u63d0\u5230\u8fc7\uff0c\u96ea\u7403\u4e4b\u524d\u67b6\u6784\u6a21\u5f0f\u4e2d\u7684\u9274\u6743\u65b9\u5f0f\u5e76\u4e0d\u7edf\u4e00\u3002\u4e00\u79cd\u9700\u8981\u4f9d\u8d56\u4e8e\u5185\u90e8\u7684\u5e94\u7528\u7aef\uff0c\u901a\u8fc7 SDK \u5f62\u5f0f\u53bb\u8c03\u7528\u7528\u6237\u4e2d\u5fc3\u5b9e\u73b0\u9274\u6743\uff0c\u53e6\u4e00\u79cd\u5219\u4f7f\u7528 JWT \u9274\u6743\u3002\u5f53\u4e24\u79cd\u9274\u6743\u65b9\u5f0f\u5171\u5b58\u65f6\uff0c\u4f1a\u5e26\u6765\u6269\u5c55\u6027\u548c\u7ef4\u62a4\u6027\u8f83\u5dee\u7684\u95ee\u9898\u3002\\n\\n\u63a5\u5165 APISIX \u4f5c\u4e3a\u7f51\u5173\u4e4b\u540e\uff0c\u5728\u9274\u6743\u65b9\u6848\u7684\u6539\u9020\u4e0a\u5219\u662f\u901a\u8fc7 APISIX \u7f51\u5173\u5c42\u6765\u7edf\u4e00\u7ba1\u7406\u3002\u57fa\u4e8e\u5b98\u65b9\u63d2\u4ef6 `jwt-auth` \u53bb\u66ff\u4ee3\u539f\u6709\u7684 JWT \u9274\u6743\u65b9\u5f0f\uff1b\u540c\u65f6\u7ed3\u5408\u96ea\u7403\u5185\u90e8\u81ea\u8eab\u7684\u4e1a\u52a1\u8981\u6c42\uff0c\u4f7f\u7528 APISIX `grpc-transcode` \u63d2\u4ef6\u4ee3\u7406\u8c03\u7528\u9274\u6743\u670d\u52a1\uff0c\u6765\u5904\u7406\u4e4b\u524d OAuth 2.0 \u76f8\u5173\u7684\u9274\u6743\u65b9\u5f0f\u3002\\n\\n`jwt-auth` \u63d2\u4ef6\u7684\u914d\u7f6e\u4f7f\u7528\u8f83\u4e3a\u7b80\u5355\uff0c\u5728 Dashboard \u4e2d\u5c06\u8def\u7531\u548c\u4e0a\u4e0b\u6e38\u7b49\u76f8\u5173\u4fe1\u606f\u914d\u7f6e\u9f50\u5168\u5373\u53ef\u5f00\u542f\u4f7f\u7528\u3002\u8fd9\u91cc\u4e3b\u8981\u63cf\u8ff0\u4e0b\u96ea\u7403\u5185\u90e8\u662f\u5982\u4f55\u5229\u7528 APISIX \u8c03\u7528 gRPC \u6765\u5b9e\u73b0\u9274\u6743\u3002\\n\\n\u5728\u5b9e\u73b0\u8c03\u7528\u4e4b\u524d\uff0c\u96ea\u7403\u5185\u90e8\u8003\u8651\u4e86\u4ee5\u4e0b\u4e09\u79cd\u89e3\u51b3\u65b9\u6848\uff1a\\n\\n- \u65b9\u6848\u4e00\uff1aLua \u76f4\u63a5\u8c03\u7528 gRPC\u3002\u7531\u4e8e\u6b64\u65b9\u6848\u5728\u6267\u884c\u4e2d\uff0c\u9700\u8981\u53bb\u8003\u8651\u8d1f\u8f7d\u5747\u8861\u548c\u52a8\u6001\u4e0a\u6e38\u7b49\u76f8\u5173\u5b9e\u73b0\uff0c\u8fc7\u7a0b\u4f1a\u6bd4\u8f83\u9ebb\u70e6\uff0c\u6545\u820d\u5f03\u3002\\n- \u65b9\u6848\u4e8c\uff1aLua \u534f\u7a0b\u56de\u8c03 Golang\u3002\u7531\u4e8e\u516c\u53f8\u5185\u90e8\u7f3a\u4e4f\u76f8\u5e94\u7684\u5b9e\u8df5\u7ecf\u9a8c\uff0c\u4e0d\u53ef\u5984\u81ea\u5c1d\u8bd5\uff0c\u6545\u820d\u5f03\u3002\\n- \u65b9\u6848\u4e09\uff1aLua \u8fdb\u884c HTTP \u8c03\u7528\uff0cgRPC \u63a5\u53e3\u91c7\u7528 APISIX \u7684 `grpc-transcode` \u63d2\u4ef6\u8fdb\u884c\u5b9e\u73b0\u3002\u5f97\u76ca\u4e8e APISIX \u793e\u533a\u5bf9\u63d2\u4ef6\u4f18\u5316\u8fed\u4ee3\u5feb\u7684\u524d\u63d0\uff0c\u6700\u7ec8\u9009\u62e9\u4e86\u65b9\u6848\u4e09\u53bb\u5b9e\u73b0 gRPC \u8c03\u7528\u3002\\n\\n\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u76ee\u524d\u4ecd\u9700\u8981\u5bf9 protocol buffers \u6587\u4ef6\u8fdb\u884c\u624b\u52a8\u540c\u6b65\u3002\u56e0\u4e3a\u5982\u679c\u7528\u6237\u4e2d\u5fc3\u4fee\u6539\u4e86\u8be5 protocol buffers\u6587\u4ef6\uff0c\u4f46\u662f\u4e0e APISIX \u4fdd\u5b58\u7684 protocol buffers \u6587\u4ef6\u4e0d\u4e00\u81f4\u7684\u8bdd\uff0c\u4f1a\u5bfc\u81f4\u9274\u6743\u51fa\u73b0\u95ee\u9898\u3002\\n\\n#### \u573a\u666f\u4e8c\uff1a\u53ef\u89c2\u6d4b\u6027\u4e0b\u7684\u591a\u7ef4\u76d1\u63a7\\n\\n\u96ea\u7403\u7684\u65e5\u5e38\u4f7f\u7528\u573a\u666f\u4e2d\uff0c\u901a\u5e38\u5728\u7f51\u7ad9\u4e0a\u7ebf\u540e\u662f\u9700\u8981\u76d1\u63a7\u5f88\u591a\u6307\u6807\u7684\uff0c\u91cd\u70b9\u4e3b\u8981\u662f\u4ee5\u4e0b\u4e09\u90e8\u5206\uff1a\\n\\n- NGINX \u8fde\u63a5\u72b6\u6001\u548c\u8fdb\u51fa\u53e3\u6d41\u91cf\\n- HTTP \u9519\u8bef\u72b6\u6001\u7801\u901f\u7387\uff08\u7528\u4e8e\u6392\u67e5 Service \u6216\u4e0a\u4e0b\u6e38\u95ee\u9898\uff09\\n- APISIX \u8bf7\u6c42\u5ef6\u8fdf\u8017\u65f6\uff08APISIX \u8fdb\u884c\u8f6c\u53d1\u65f6\u903b\u8f91\u6267\u884c\u5e26\u6765\u7684\u8017\u65f6\uff09\\n\\n\u6bd4\u5982 APISIX \u7684\u5ef6\u8fdf\u6307\u6807\u4f1a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u51fa\u73b0\u6307\u6807\u975e\u5e38\u9ad8\u7684\u73b0\u8c61\uff08\u5982\u4e0b\u56fe\u6240\u793a\uff09\uff0c\u8fd9\u79cd\u5176\u5b9e\u662f\u8ddf\u8be5\u5ef6\u8fdf\u6307\u6807\u7684\u8ba1\u7b97\u903b\u8f91\u6709\u5173\u3002\u76ee\u524d APISIX \u5ef6\u8fdf\u6307\u6807\u7684\u8ba1\u7b97\u903b\u8f91\u662f\uff1a\u5355\u6761 HTTP \u8bf7\u6c42\u5728 NGINX \u4e0a\u7684\u8017\u65f6\u65f6\u95f4-\u8fd9\u6761\u8bf7\u6c42\u8def\u7531\u5230\u4e0a\u6e38\u7684\u5ef6\u8fdf\u3002\u4e24\u4e2a\u8017\u65f6\u4e4b\u95f4\u7684\u5dee\u6570\u503c\u5373\u4e3a APISIX \u5ef6\u8fdf\u6307\u6807\u6570\u636e\u3002\\n\\n![\u5ef6\u8fdf\u6307\u6807](https://static.apiseven.com/2022/06/blog/xueqiu-5.png)\\n\\n\u4f7f\u7528 APISIX \u540e\uff0c\u5728\u65b0\u589e\u6216\u4fee\u6539\u4e00\u4e9b\u63d2\u4ef6\u65f6\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u903b\u8f91\u7684\u53d8\u66f4\uff0c\u53d8\u66f4\u4e4b\u540e\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8017\u65f6\u76f8\u5173\u7684\u6570\u636e\u51fa\u73b0\u504f\u5dee\u3002\u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u6df7\u6dc6\u6570\u636e\u771f\u5b9e\u6027\u7684\u73b0\u8c61\u53d1\u751f\uff0c\u96ea\u7403\u5728\u76d1\u63a7\u5c42\u9762\u8fd8\u589e\u52a0\u4e86\u57fa\u4e8e\u63d2\u4ef6\u7ea7\u522b\u7684\u8017\u65f6\u76d1\u63a7\u3002\u5728\u4fdd\u8bc1\u5404\u6570\u636e\u76d1\u6d4b\u7684\u51c6\u786e\u6027\u4e0b\uff0c\u8fd8\u65b9\u4fbf\u4e86\u540e\u7eed\u8fdb\u884c\u63d2\u4ef6\u7ea7\u7684\u4e1a\u52a1\u6539\u9020\u65f6\uff0c\u63d0\u524d\u901a\u8fc7\u8017\u65f6\u5b9a\u4f4d\u4e00\u4e9b\u95ee\u9898\uff0c\u4ece\u800c\u65b9\u4fbf\u6392\u67e5\u3002\\n\\n![\u6570\u636e\u4f53\u73b0](https://static.apiseven.com/2022/06/blog/xueqiu-6.png)\\n\\n\u540c\u65f6\u53ef\u4ee5\u5229\u7528 APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\uff0c\u6536\u96c6 Access \u65e5\u5fd7\u4fe1\u606f\uff0c\u5e76\u901a\u8fc7\u683c\u5f0f\u5316\u7edf\u4e00\u6295\u9012\u5230\u6d41\u91cf\u5927\u76d8\u4e2d\u8fdb\u884c\u89c6\u56fe\u6c47\u603b\u3002\u66f4\u65b9\u4fbf\u5730\u4ece\u591a\u89d2\u5ea6\u63d0\u524d\u4e86\u89e3\u6574\u4f53\u8d8b\u52bf\uff0c\u53d1\u73b0\u6f5c\u5728\u95ee\u9898\u5e76\u53ca\u65f6\u8fdb\u884c\u5904\u7406\u3002\\n\\n![\u89c6\u56fe\u6c47\u603b](https://static.apiseven.com/2022/06/blog/xueqiu-7.png)\\n\\n#### \u573a\u666f\u4e09\uff1a\u6269\u5c55 ZooKeeper \u6ce8\u518c\u4e2d\u5fc3\\n\\n\u76ee\u524d\uff0c\u96ea\u7403 gRPC \u670d\u52a1\u8c03\u7528\u662f\u57fa\u4e8e Zookeeper \u6ce8\u518c\u4e2d\u5fc3\u8fdb\u884c\u6ce8\u518c\u548c\u53d1\u73b0\u3002\u5728\u5b9e\u73b0\u9274\u6743\u8fc7\u7a0b\u4e2d\uff0cAPI \u7f51\u5173\u5728\u672c\u5730 JWT \u6821\u9a8c\u5931\u8d25\u65f6\uff0c\u9700\u8981\u8bbf\u95ee\u96ea\u7403\u7528\u6237\u4e2d\u5fc3\u7684 gRPC \u670d\u52a1\u8fdb\u884c\u9274\u6743\uff0c\u8fd9\u5c31\u8981\u6c42 API \u7f51\u5173\u80fd\u591f\u4ece\u6ce8\u518c\u4e2d\u5fc3\u83b7\u53d6\u540e\u7aef gRPC \u670d\u52a1\u5730\u5740\u5217\u8868\u3002APISIX \u5b98\u65b9\u63d2\u4ef6 `apisix-seed` \u53ef\u4ee5\u53bb\u96c6\u6210 ZooKeeper \u8fdb\u884c\u670d\u52a1\u53d1\u73b0\uff0c\u4f46\u7ed3\u5408\u96ea\u7403\u81ea\u8eab\u4f7f\u7528\u573a\u666f\u9700\u6c42\uff0c\u5728 APISIX \u4e0a\u5219\u662f\u8fdb\u884c\u4e86\u66f4\u9488\u5bf9\u81ea\u5bb6\u4e1a\u52a1\u7684\u76f8\u5173\u62d3\u5c55\u3002\\n\\n\u5177\u4f53\u5b9e\u73b0\u4e3b\u8981\u662f\u5728 APISIX \u7684\u4e00\u4e2a\u5185\u5bb9\u8282\u70b9\u4e0a\uff0c\u5f53 Worker \u8fdb\u7a0b\u542f\u52a8\u65f6\u53bb\u8f6e\u8be2\u50cf\u4e0b\u56fe\u4e2d\u7684 ZK-Rest \u96c6\u7fa4\uff0c\u7136\u540e\u5b9a\u65f6\u53bb\u62c9\u53d6\u6574\u4e2a\u670d\u52a1\u7684\u6e90\u6570\u636e\u4fe1\u606f\u4ee5\u53ca\u5b9e\u9645\u4fe1\u606f\uff0c\u66f4\u65b0\u5230 Worker \u8fdb\u7a0b\u5185\u7684\u672c\u5730\u7f13\u5b58\uff0c\u7528\u4e8e\u670d\u52a1\u5217\u8868\u7684\u66f4\u65b0\u3002\\n\\n![\u6269\u5c55 ZooKeeper](https://static.apiseven.com/2022/06/blog/xueqiu-8.png)\\n\\n\u901a\u8fc7\u4e0a\u56fe\u4e5f\u53ef\u4ee5\u770b\u5230\uff0cZK-Rest \u96c6\u7fa4\u76f8\u5f53\u4e8e\u901a\u8fc7 Rest \u7684\u5f62\u5f0f\u8fdb\u884c\u8bbf\u95ee ZooKeeper \u7684\u6570\u636e\u3002\u6240\u4ee5\u6574\u4e2a\u8fc7\u7a0b\u5176\u5b9e\u5b9e\u73b0\u7684\u529f\u80fd\u6bd4\u8f83\u5c11\uff08\u4e3b\u8981\u662f\u57fa\u4e8e\u81ea\u8eab\u4e1a\u52a1\u573a\u666f\u9700\u6c42\uff09\uff0c\u53ea\u9700\u8981\u589e\u52a0\u5b83\u7684\u4e00\u4e2a\u5b9e\u4f8b\u5c31\u53ef\u4ee5\u5b9e\u73b0\u9ad8\u53ef\u7528\u7279\u6027\uff0c\u514d\u53bb\u4e00\u4e9b\u590d\u6742\u64cd\u4f5c\u3002\\n\\n\u4f46\u8fd9\u6837\u64cd\u4f5c\u4e5f\u4f1a\u5e26\u6765\u4e00\u4e2a\u6bd4\u8f83\u660e\u663e\u7684\u7f3a\u70b9\u3002\u5f53\u9700\u8981\u5b9a\u65f6\u53bb\u8f6e\u8be2 ZK-Rest \u96c6\u7fa4\u65f6\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u670d\u52a1\u5217\u8868\u5728\u66f4\u65b0\u4e0a\u51fa\u73b0\u5ef6\u8fdf\u3002\u6240\u4ee5\u8fd9\u91cc\u4e5f\u662f\u63d0\u4f9b\u7ed9\u5927\u5bb6\u4e00\u4e2a\u601d\u8def\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002\\n\\n## \u603b\u7ed3\u53ca\u5c55\u671b\\n\\n\u76ee\u524d\uff0cApache APISIX \u5728\u96ea\u7403\u5185\u90e8\u4f5c\u4e3a\u7f51\u5173\u5c42\u8fd0\u884c\u826f\u597d\u3002\u5177\u4f53\u8868\u73b0\u5728\uff1a\\n\\n- \u5b9e\u73b0\u4e86\u5728\u7f51\u5173\u5c42\u7edf\u4e00\u9274\u6743\u3001\u7194\u65ad\u4e0e\u9650\u6d41\u7b49\u529f\u80fd\uff1b\\n- \u964d\u4f4e\u4e86\u6574\u4f53\u7cfb\u7edf\u7684\u8026\u5408\u5ea6\uff0c\u63d0\u9ad8\u4e86\u53cc\u673a\u623f\u573a\u666f\u4e0b\u7684\u670d\u52a1\u8d28\u91cf\uff1b\\n- \u501f\u52a9\u4e8e APISIX \u76d1\u63a7\u4f53\u7cfb\uff0c\u5b8c\u5584\u4e86\u4ece\u7f51\u5173\u5230\u670d\u52a1\u7684\u7edf\u4e00\u76d1\u63a7\u65b9\u6848\uff1b\\n- \u5bf9\u5168\u94fe\u8def\u6392\u67e5\u8d77\u5230\u4e86\u5f88\u597d\u7684\u652f\u6491\uff1b\\n- \u5bf9 gRPC \u534f\u8bae\u7684\u8f6c\u6362\u4e0e\u670d\u52a1\u7ba1\u7406\u90fd\u63d0\u4f9b\u4e86\u6bd4\u8f83\u4f18\u96c5\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002\\n\\n\u5728\u540e\u7eed\u7684\u4f7f\u7528\u4e2d\uff0c\u96ea\u7403\u4e5f\u5728\u89c4\u5212\u5982\u4e0b\u8fdb\u7a0b\uff1a\\n\\n- \u4f7f\u7528 APISIX Ingress Controller \u5e94\u7528\u4e8e K8s \u96c6\u7fa4\uff1b\\n- \u5229\u7528 grpc-transcode \u63d2\u4ef6\u8fdb\u884c HTTP/gRPC \u534f\u8bae\u8f6c\u6362\uff0c\u8fbe\u5230\u540e\u7aef\u7edf\u4e00\u63a5\u53e3\u5f62\u5f0f\uff1b\\n- \u5229\u7528 `traffic-spilt` \u63d2\u4ef6\u8fdb\u884c\u6d41\u91cf\u6253\u6807\u3001\u5bf9\u63a5 Nacos \u6ce8\u518c\u4e2d\u5fc3\uff0c\u5b9e\u73b0\u5168\u94fe\u8def\u7070\u5ea6\u7b49\u670d\u52a1\u6cbb\u7406\u3002\\n\\n\u5e76\u5728\u540e\u7eed\u8ba1\u5212\u4e2d\uff0c\u7528 Apache APISIX \u53bb\u66ff\u4ee3\u73b0\u6709\u7684 OpenResty\uff0c\u6700\u7ec8\u5b9e\u73b0\u5168\u57df\u5357\u5317\u6d41\u91cf\u7684\u7ba1\u7406\u3002"},{"id":"API \u7f51\u5173 Apache APISIX \u5728 AWS Graviton3 \u4e0a\u7684\u5b89\u88c5\u4e0e\u6027\u80fd\u6d4b\u8bd5","metadata":{"permalink":"/zh/blog/2022/06/07/installation-performance-test-of-apigateway-apisix-on-aws-graviton3","source":"@site/blog/2022/06/07/installation-performance-test-of-apigateway-apisix-on-aws-graviton3.md","title":"API \u7f51\u5173 Apache APISIX \u5728 AWS Graviton3 \u4e0a\u7684\u5b89\u88c5\u4e0e\u6027\u80fd\u6d4b\u8bd5","description":"\u672c\u6587\u4f7f\u7528 APISIX \u8fdb\u884c\u4e86 AWS Graviton3 \u4e0e AWS Graviton2 \u7684\u6027\u80fd\u5bf9\u6bd4\uff0c\u5728 API \u7f51\u5173\u8fd9\u79cd\u7f51\u7edc IO \u5bc6\u96c6\u578b\u7684\u8ba1\u7b97\u573a\u666f\u4e0b\uff0cAWS Graviton3 \u53ef\u8c13\u5c55\u793a\u4e86\u6027\u80fd\u602a\u517d\u7684\u5c5e\u6027\u3002","date":"2022-06-07T00:00:00.000Z","formattedDate":"2022\u5e746\u67087\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.675,"truncated":true,"authors":[{"name":"\u8d75\u58eb\u745e","title":"Author","url":"https://github.com/soulbird","image_url":"https://avatars.githubusercontent.com/u/11553520?v=4","imageURL":"https://avatars.githubusercontent.com/u/11553520?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"API \u7f51\u5173 Apache APISIX \u52a9\u529b\u96ea\u7403\u53cc\u6d3b\u67b6\u6784\u6f14\u8fdb","permalink":"/zh/blog/2022/06/14/xueqiu-with-apache-apisix"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff085.16 - 5.31\uff09","permalink":"/zh/blog/2022/06/07/weekly-report-0607"}},"content":"> \u76ee\u524d Apache APISIX \u8fdb\u884c\u4e86 ARM64 \u5e73\u53f0\u4e0b\u7684\u5b8c\u6574\u56de\u5f52\u6d4b\u8bd5\uff0c\u4fee\u590d\u4e86\u6784\u5efa\u811a\u672c\u5728 ARM64 \u5e73\u53f0\u4e0b\u7684\u4e00\u4e9b\u517c\u5bb9\u6027\u95ee\u9898\u3002\u672c\u6587\u901a\u8fc7\u7b80\u8981\u7684\u90e8\u7f72\u6d4b\u8bd5\u63cf\u8ff0\uff0c\u5448\u73b0\u4e86\u5728 AWS Graviton \u73af\u5883\u4e0b\uff0c\u65e0\u8bba\u662f\u7a33\u5b9a\u6027\u8fd8\u662f\u6d41\u91cf\u5904\u7406\u5c42\u9762\uff0cAPISIX \u7684\u8868\u73b0\u90fd\u5341\u5206\u4eae\u773c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\\n\\nAWS \u5728 2022 \u5e74 5 \u6708\u5e95\u53d1\u5e03\u4e86\u6700\u65b0\u7684\u57fa\u4e8e ARM \u67b6\u6784\u7684 AWS Graviton \u7cfb\u5217\u5904\u7406\u5668\u2014\u2014[AWS Graviton3](https://aws.amazon.com/cn/blogs/aws/new-amazon-ec2-c7g-instances-powered-by-aws-graviton3-processors/)\u3002\u636e AWS \u5b98\u65b9\u6570\u636e\u663e\u793a\uff0c\u4e0e Graviton2 \u5904\u7406\u5668\u76f8\u6bd4\uff0c\u57fa\u4e8e\u9886\u5148\u7684 DDR5 \u5185\u5b58\u6280\u672f\uff0cGraviton3 \u5904\u7406\u5668\u53ef\u63d0\u4f9b\u9ad8\u8fbe 25% \u7684\u6027\u80fd\u63d0\u5347\u3001\u9ad8\u8fbe 2 \u500d\u7684\u6d6e\u70b9\u6027\u80fd\u4ee5\u53ca 50% \u7684\u5185\u5b58\u8bbf\u95ee\u901f\u5ea6\uff1b\u5728\u6027\u80fd\u4e0e\u540c\u7c7b EC2 \u5b9e\u4f8b\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0cGraviton3 \u8fd8\u53ef\u51cf\u5c11 60% \u7684\u80fd\u6e90\u3002\\n\\n\u90a3\u4e48\u5b9e\u9645\u6570\u636e\u4f1a\u600e\u6837\u5462\uff1f\u8ba9\u6211\u4eec\u4ee5\u7f51\u7edc IO \u5bc6\u96c6\u578b\u7684 API \u7f51\u5173\u4e3a\u4f8b\uff0c\u6765\u770b\u770b AWS Graviton3 \u7684\u8868\u73b0\u5982\u4f55\u3002\u5728\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 Apache APISIX \u5728 AWS Graviton2\uff08C6g\uff09\u548c AWS Graviton3\uff08C7g\uff09 \u4e24\u79cd\u670d\u52a1\u5668\u73af\u5883\u4e0b\u8fdb\u884c\u6027\u80fd\u5bf9\u6bd4\u6d4b\u8bd5\u3002\\n\\n[Apache APISIX](https://github.com/apache/apisix) \u662f\u4e00\u4e2a\u4e91\u539f\u751f\u3001\u9ad8\u6027\u80fd\u3001\u53ef\u6269\u5c55\u7684 API \u7f51\u5173\u3002\u57fa\u4e8e NGNIX+LuaJIT \u548c etcd \u6765\u5b9e\u73b0\uff0c\u548c\u4f20\u7edf API \u7f51\u5173\u76f8\u6bd4\uff0cAPISIX \u5177\u5907\u52a8\u6001\u8def\u7531\u548c\u63d2\u4ef6\u70ed\u52a0\u8f7d\u7684\u7279\u70b9\uff0c\u7279\u522b\u9002\u5408\u4e91\u539f\u751f\u67b6\u6784\u4e0b\u7684 API \u7ba1\u7406\u3002\\n\\n![Apache APISIX](https://user-images.githubusercontent.com/39793568/172329936-774992c0-070b-48d0-be8b-33abbd6a4f78.png)\\n\\n## \u51c6\u5907\uff1a\u5b89\u88c5\u90e8\u7f72\\n\\n\u5728\u8fdb\u884c\u6d4b\u8bd5\u524d\uff0c\u9700\u8981\u51c6\u5907\u4e00\u53f0\u642d\u8f7d ARM64 \u82af\u7247\u7684\u670d\u52a1\u5668\uff0c\u8fd9\u91cc\u6211\u4eec\u9009\u7528\u4e86 Amazon EC2 C7g\uff08\u73b0\u5728\u53ea\u6709\u8fd9\u4e2a\u578b\u53f7\u624d\u642d\u8f7d AWS Graviton3\uff09\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9\u4e86 Ubuntu 20.04\u3002\\n\\n![Amazon EC2](https://user-images.githubusercontent.com/39793568/172340229-caf59d9c-cba2-4c95-a892-ef7cf29a0436.png)\\n\\n\u540c\u65f6\u5b89\u88c5 Docker\u3002\\n\\n```shell\\nsudo apt-get update && sudo apt-get install docker.io\\n```\\n\\n\u76ee\u524d\uff0cAPISIX \u5df2\u7ecf\u53d1\u5e03\u4e86\u6700\u65b0\u7248\u672c\u7684 ARM64 \u955c\u50cf\uff0c\u53ef\u4ee5\u4f7f\u7528 Docker \u65b9\u5f0f\u8fdb\u884c\u4e00\u952e\u90e8\u7f72\u3002\u5177\u4f53\u8fc7\u7a0b\u53ef\u53c2\u8003\u4e0b\u65b9\uff1a\\n\\n1. \u542f\u52a8 etcd\\n\\n```shell\\nsudo docker run -d \\\\\\n--name etcd -p 2379:2379 -e ETCD_UNSUPPORTED_ARCH=arm64 \\\\\\n-e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\n-e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 \\\\\\nrancher/coreos-etcd:v3.4.16-arm64\\n```\\n\\n2. \u542f\u52a8 APISIX\\n\\n```\\nsudo docker run --net=host -d apache/apisix:2.14.1-alpine\\n```\\n\\n3. \u6ce8\u518c\u8def\u7531\\n\\n```\\ncurl \\"http://127.0.0.1:9080/apisix/admin/routes/1\\" \\\\\\n-H \\"X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\\" -X PUT -d \'\\n{\\n  \\"uri\\": \\"/anything/*\\",\\n  \\"upstream\\": {\\n    \\"type\\": \\"roundrobin\\",\\n    \\"nodes\\": {\\n      \\"httpbin.org:80\\": 1\\n    }\\n  }\\n}\'\\n```\\n\\n4. \u8bbf\u95ee\u6d4b\u8bd5\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/anything/das\\n```\\n\\n```shell\\nHTTP/1.1 200 OK\\n.....\\n```\\n\\n## AWS Graviton2 \u548c AWS Graviton3 \u7684\u6027\u80fd\u5bf9\u6bd4\\n\\n\u6839\u636e\u524d\u6587\u7684\u64cd\u4f5c\uff0c\u57fa\u4e8e[\u5b98\u65b9\u811a\u672c](https://github.com/apache/apisix/blob/master/benchmark/run.sh)\u6210\u529f\u5b8c\u6210\u4e86 APISIX \u5728 AWS Graviton3 \u5904\u7406\u5668\u4e0a\u5b89\u88c5\u548c\u517c\u5bb9\u6027\u6d4b\u8bd5\u3002\u4e0b\u9762\u8ba9\u6211\u4eec\u6765\u770b\u770b Apache APISIX \u5728 AWS Graviton2\uff08C6g\uff09\u548c AWS Graviton3\uff08C7g\uff09\u4e0a\u7684\u6027\u80fd\u8868\u73b0\u3002\\n\\n\u4e3a\u4e86\u65b9\u4fbf\u6d4b\u8bd5\uff0c\u672c\u793a\u4f8b\u4e2d APISIX \u53ea\u5f00\u542f\u4e86\u4e00\u4e2a Worker\uff0c\u4e0b\u9762\u7684\u6027\u80fd\u6d4b\u8bd5\u6570\u636e\u90fd\u662f\u5728\u5355\u6838 CPU \u4e0a\u8fd0\u884c\u7684\u3002\\n\\n### \u573a\u666f\u4e00\uff1a\u5355\u4e2a\u4e0a\u6e38\\n\\n\u8be5\u573a\u666f\u4e0b\u4f7f\u7528\u5355\u4e2a\u4e0a\u6e38\uff08\u4e0d\u5305\u542b\u4efb\u4f55\u63d2\u4ef6\uff09\uff0c\u4e3b\u8981\u6d4b\u8bd5 APISIX \u5728\u7eaf\u4ee3\u7406\u56de\u6e90\u6a21\u5f0f\u4e0b\u7684\u6027\u80fd\u8868\u73b0\u3002\u5728\u672c\u5730\u73af\u5883\u4e2d\u8fdb\u884c\u6d4b\u8bd5\uff1a\\n\\n```shell\\n# apisix: 1 worker + 1 upstream + no plugin\\n\\n# \u6ce8\u518c\u8def\u7531\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u573a\u666f\u4e8c\uff1a\u5355\u4e0a\u6e38+\u591a\u63d2\u4ef6\\n\\n\u53e6\u4e00\u573a\u666f\u5219\u4f7f\u7528\u5355\u4e0a\u6e38\u4e0e\u591a\u63d2\u4ef6\u914d\u5408\uff0c\u5728\u8fd9\u91cc\u4f7f\u7528\u4e86\u4e24\u4e2a\u63d2\u4ef6\u3002\u4e3b\u8981\u6d4b\u8bd5 APISIX \u5728\u5f00\u542f `limit-count` \u548c `prometheus` \u4e24\u4e2a\u6838\u5fc3\u6d88\u8017\u6027\u80fd\u63d2\u4ef6\u65f6\u7684\u6027\u80fd\u8868\u73b0\u3002\\n\\n```shell\\n# apisix: 1 worker + 1 upstream + 2 plugins (limit-count + prometheus)\\n\\n# \u6ce8\u518c\u8def\u7531\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {\\n        \\"limit-count\\": {\\n            \\"count\\": 2000000000000,\\n            \\"time_window\\": 60,\\n            \\"rejected_code\\": 503,\\n            \\"key\\": \\"remote_addr\\"\\n        },\\n        \\"prometheus\\": {}\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u6570\u636e\u5bf9\u6bd4\\n\\n\u5728\u4e0a\u8ff0\u4e24\u79cd\u573a\u666f\u4e0b\uff0c\u5206\u522b\u4ece\u8bf7\u6c42\u5904\u7406\u548c\u5ef6\u8fdf\u65f6\u95f4\u4e24\u4e2a\u5c42\u9762\u8fdb\u884c\u4e86\u76f8\u5173\u6d4b\u8bd5\u4e0e\u5bf9\u6bd4\u3002\u7ed3\u679c\u5982\u4e0b\uff1a\\n\\n1. QPS \u5bf9\u6bd4\\n\\n![QPS](https://user-images.githubusercontent.com/39793568/172340965-625d00b4-a97e-4f88-a1bc-fdfded5e9921.png)\\n\\n2. Latency \u5bf9\u6bd4\\n\\n![Latency](https://user-images.githubusercontent.com/39793568/172341233-797008d5-6287-41a1-86bb-dfaaed3d1589.png)\\n\\n<table>\\n    <tr>\\n        <td><b>  </b></td>\\n        <td colspan=\\"2\\">\u5355\u4e2a\u4e0a\u6e38</td>\\n        <td colspan=\\"2\\">\u5355\u4e2a\u4e0a\u6e38+\u4e24\u4e2a\u63d2\u4ef6</td>\\n    </tr>\\n    <tr>\\n        <td><b>  </b></td>\\n        <td><b>AWS Graviton2</b></td>\\n        <td><b>AWS Graviton3</b></td>\\n        <td><b>AWS Graviton2</b></td>\\n        <td><b>AWS Graviton3</b></td>\\n    </tr>\\n    <tr>\\n        <td><b>QPS(request/s)</b></td>\\n        <td><b>13000</b></td>\\n        <td><b>23000\uff08\u63d0\u534776%\uff09</b></td>\\n        <td><b>11000</b></td>\\n        <td><b>18000\uff08\u63d0\u534763%\uff09</b></td>\\n    </tr>\\n    <tr>\\n        <td><b>Latency(ms)</b></td>\\n        <td><b>1.11</b></td>\\n        <td><b>0.68\uff08\u964d\u4f4e38%\uff09</b></td>\\n        <td><b>1.39</b></td>\\n        <td><b>0.88\uff08\u964d\u4f4e37%\uff09</b></td>\\n    </tr>\\n    </table>\\n\\n\u4ece\u4e0a\u65b9\u6570\u636e\u53ef\u4ee5\u770b\u5230\uff0c\u5728 API \u7f51\u5173\u8fd9\u6837\u7f51\u7edc IO \u5bc6\u96c6\u578b\u7684\u8ba1\u7b97\u573a\u666f\u4e0b\uff0cAWS Graviton3 \u6bd4 AWS Graviton2 \u7684\u6027\u80fd\u63d0\u5347\u4e86 76%\uff0c\u540c\u65f6\u5ef6\u8fdf\u8fd8\u964d\u4f4e\u4e86 38%\u3002\u8fd9\u4e2a\u6570\u636e\u6bd4\u5f00\u5934\u63d0\u5230\u7684 AWS \u5b98\u65b9\u7ed9\u51fa\u7684\u6570\u636e\uff0825%\u6027\u80fd\u63d0\u5347\uff09\u8fd8\u8981\u4f18\u5f02\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u901a\u8fc7\u4f7f\u7528 Apache APISIX \u8fdb\u884c\u4e86 AWS Graviton3 \u4e0e AWS Graviton2 \u7684\u6027\u80fd\u5bf9\u6bd4\uff0c\u53ef\u4ee5\u770b\u5230\u5728 API \u7f51\u5173\u8fd9\u79cd\u7f51\u7edc IO \u5bc6\u96c6\u578b\u7684\u8ba1\u7b97\u573a\u666f\u4e0b\uff0cAWS Graviton3 \u53ef\u8c13\u5c55\u793a\u4e86\u6027\u80fd\u602a\u517d\u7684\u5c5e\u6027\u3002\u5f53\u7136\uff0c\u4e5f\u63a8\u8350\u5927\u5bb6\u591a\u591a\u8fdb\u884c\u5b9e\u8df5\uff0c\u671f\u5f85\u540e\u7eed\u66f4\u591a\u8ba1\u7b97\u5bc6\u96c6\u578b\u9879\u76ee\u7684\u6d4b\u8bd5\u6570\u636e\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff085.16 - 5.31\uff09","metadata":{"permalink":"/zh/blog/2022/06/07/weekly-report-0607","source":"@site/blog/2022/06/07/weekly-report-0607.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff085.16 - 5.31\uff09","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2022-06-07T00:00:00.000Z","formattedDate":"2022\u5e746\u67087\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.34,"truncated":true,"authors":[],"prevItem":{"title":"API \u7f51\u5173 Apache APISIX \u5728 AWS Graviton3 \u4e0a\u7684\u5b89\u88c5\u4e0e\u6027\u80fd\u6d4b\u8bd5","permalink":"/zh/blog/2022/06/07/installation-performance-test-of-apigateway-apisix-on-aws-graviton3"},"nextItem":{"title":"Apache APISIX 2.14.1 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/05/31/release-apache-apisix-2.14"}},"content":"> \u4ece 5.16 - 5.31\uff0c\u6709 33 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 96 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://user-images.githubusercontent.com/88811141/174761990-3a612e2c-594f-408c-a684-85b03c5261f2.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://user-images.githubusercontent.com/88811141/174762094-38e008d2-7170-4873-841d-caf4ab11ed67.png)\\n\\n## Good first issue\\n\\n### Issue #7164\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/7164\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u76ee\u524d\u793e\u533a\u6b63\u5728\u4f7f\u7528 Semantic Pull Requests\uff08\u8bed\u4e49\u62c9\u52a8\u8bf7\u6c42\uff09\u6765\u68c0\u67e5 PR\uff0c\u4f46\u662f\u8be5\u9879\u76ee\u5df2\u7ecf\u4e0d\u518d\u7ef4\u62a4\u4e86\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e9b\u66ff\u4ee3\u65b9\u6848\u3002\\n\\n\u6bd4\u5982\uff1ahttps://github.com/amannn/action-semantic-pull-request\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [xRPC \u6846\u67b6\u65b0\u589e `rpc_time` \u53d8\u91cf](https://github.com/apache/apisix/pull/7040)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [pubsub \u6846\u67b6\u652f\u6301 Kafka](https://github.com/apache/apisix/pull/7032)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [xRPC \u6846\u67b6\u4e0b\u4ee3\u7406 Redis \u534f\u8bae\u65b0\u589e `redis_cmd_line` \u53d8\u91cf](https://github.com/apache/apisix/pull/7041)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [pubsub \u6846\u67b6 ping \u547d\u4ee4\u6dfb\u52a0\u9ed8\u8ba4\u5904\u7406\u7a0b\u5e8f](https://github.com/apache/apisix/pull/7058)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [pubsub \u652f\u6301 Kafka TLS \u548c SASL/PLAIN \u8ba4\u8bc1](https://github.com/apache/apisix/pull/7046)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [\u5141\u8bb8\u5728\u63d2\u4ef6\u4e2d\u81ea\u5b9a\u4e49\u54cd\u5e94](https://github.com/apache/apisix/pull/7128)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [\u5728 APISIX Ingress \u9879\u76ee\u4e2d\u589e\u52a0 Gateway API \u7684 HTTPRoute \u7684\u652f\u6301](https://github.com/apache/apisix-ingress-controller/pull/1037)\uff08\u8d21\u732e\u8005\uff1a[lingsamuel](https://github.com/lingsamuel))\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"Apache APISIX 2.14.1 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2022/05/31/release-apache-apisix-2.14","source":"@site/blog/2022/05/31/release-apache-apisix-2.14.md","title":"Apache APISIX 2.14.1 \u6b63\u5f0f\u53d1\u5e03","description":"Apache APISIX 2.14.1 \u6b63\u5f0f\u53d1\u5e03\uff01\u8be5\u7248\u672c\u652f\u6301\u5728\u63a7\u5236\u9762\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\uff0c\u8fd8\u652f\u6301 Istio\u3001\u57fa\u4e8e WebSocket \u7684 pubsub \u4ee3\u7406\u6846\u67b6\u548c\u57fa\u4e8e xRPC \u6846\u67b6\u7ba1\u7406\u975e HTTP \u4e03\u5c42\u534f\u8bae\u3002","date":"2022-05-31T00:00:00.000Z","formattedDate":"2022\u5e745\u670831\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":9.325,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","title":"Author","url":"https://github.com/spacewander","image_url":"https://avatars.githubusercontent.com/u/4161644?v=4","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://github.com/hf400159.png","imageURL":"https://github.com/hf400159.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff085.16 - 5.31\uff09","permalink":"/zh/blog/2022/06/07/weekly-report-0607"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff085.01 - 5.15\uff09","permalink":"/zh/blog/2022/05/19/weekly-report-0519"}},"content":"> \u63a2\u7d22\u6027\u7248\u672c\u2014\u2014 Apache APISIX 2.14.1 \u6b63\u5f0f\u53d1\u5e03\u3002\u8be5\u7248\u672c\u4e0d\u4ec5\u652f\u6301\u4e86\u5728\u63a7\u5236\u9762\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\uff0c\u8fd8\u652f\u6301\u4e86 Istio\u3001\u57fa\u4e8e WebSocket \u7684 pubsub \u4ee3\u7406\u6846\u67b6\u548c\u57fa\u4e8e xRPC \u6846\u67b6\u7ba1\u7406\u975e HTTP \u7684 7 \u5c42\u534f\u8bae\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u8ddd\u79bb\u4e0a\u6b21 APISIX v2.13 LTS \u7248\u672c\u53d1\u5e03\u5df2\u7ecf\u6709\u4e24\u4e2a\u591a\u6708\u7684\u65f6\u95f4\uff0c\u4ee5\u5f80\u6bcf\u6b21 APISIX \u7684\u5c0f\u7248\u672c\u53d1\u5e03\uff0c\u90fd\u4f1a\u4e3a\u5927\u5bb6\u5e26\u6765\u65b0\u529f\u80fd\u3002\u7136\u800c APISIX v2.14.1 \u7248\u672c\u53d1\u5e03\u7684\u529f\u80fd\uff0c\u5c06\u7d27\u8ddf\u6280\u672f\u524d\u6cbf\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86\u8bf8\u591a\u63a2\u7d22\u6027\u7684\u65b0\u529f\u80fd\uff0c\u5e76\u4e3a APISIX v3 \u7248\u672c\u7684\u53d1\u5e03\u6295\u77f3\u95ee\u8def\uff0c\u6b22\u8fce\u5927\u5bb6\u63a2\u7d22\u8fd9\u4e9b\u65b0\u529f\u80fd\u3002\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u5148\u770b\u4e0b APISIX \u652f\u6301\u4e86\u54ea\u4e9b\u63a2\u7d22\u6027\u7684\u65b0\u529f\u80fd\u3002\\n\\n![Apache APISIX 2.14.1 \u66f4\u65b0\u6982\u89c8](https://static.apiseven.com/202108/1653981177761-fdd9509a-2caf-43d6-a710-ee5f81d4a193.png)\\n\\n## \u57fa\u4e8e WebSocket \u7684 pubsub \u4ee3\u7406\u6846\u67b6\\n\\n\u5728 APISIX v2.14.1 \u7248\u672c\u4e4b\u524d\uff0c\u65e0\u8bba\u662f\u4ee3\u7406 gRPC \u8bf7\u6c42\u8fd8\u662f\u666e\u901a\u7684 HTTP \u8bf7\u6c42\uff0cAPISIX \u7684\u4e0a\u6e38\u90fd\u662f\u5bf9\u63a5\u7684\u5e94\u7528\u670d\u52a1\u5668\uff0c\u65e0\u6cd5\u6ee1\u8db3\u591a\u5143\u5316\u573a\u666f\u9700\u6c42\u3002\u4f8b\u5982\u7528\u6237\u9700\u8981\u4f7f\u7528\u5176\u4ed6\u4e0a\u6e38\u7c7b\u578b\uff08\u6bd4\u5982 Kafka\uff09\uff0c\u5c31\u53ea\u80fd\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u5b9e\u73b0\u3002\u4f46\u662f\u5728 APISIX v2.14.1 \u7248\u672c\u4e2d\uff0cAPISIX \u65b0\u589e\u4e86\u4e00\u4e2a\u57fa\u4e8e Websocket \u7684\u6d88\u606f\u8ba2\u9605\u4ee3\u7406\u6846\u67b6\uff0c\u8be5\u6846\u67b6\u5141\u8bb8\u5ba2\u6237\u7aef\u901a\u8fc7 APISIX \u6765\u8ba2\u9605\u6307\u5b9a\u6d88\u606f\u961f\u5217\uff08\u4e0a\u6e38\uff09\u4e2d\u7684\u6d88\u606f\u3002\u73b0\u5728\u4f60\u53ef\u4ee5\u4f7f\u7528 APISIX \u6765\u8ba2\u9605 Kafka \u4e2d\u7684\u6d88\u606f\u3002\\n\\n\u4ee5 Kafka \u4e3a\u4f8b\uff0c\u6211\u4eec\u9700\u8981\u5982\u4e0b\u914d\u7f6e\uff1a\\n\\n```shell\\ncurl -X PUT \'http://127.0.0.1:9080/apisix/admin/routes/kafka\' \\\\\\n    -H \'X-API-KEY: ${api-key}\' \\\\\\n    -H \'Content-Type: application/json\' \\\\\\n    -d \'{\\n    \\"uri\\": \\"/kafka\\",\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"kafka-server1:9092\\": 1,\\n            \\"kafka-server2:9092\\": 1,\\n            \\"kafka-server3:9092\\": 1\\n        },\\n        \\"type\\": \\"none\\",\\n        \\"scheme\\": \\"kafka\\"\\n    }\\n}\'\\n```\\n\\n\u4e0a\u8ff0\u793a\u4f8b\u662f\u5728\u8def\u7531\u4e2d\u6dfb\u52a0\u4e86\u4e00\u4e2a Kafka \u7c7b\u578b\u7684\u4e0a\u6e38\uff0c\u5e76\u5305\u542b\u4e86\u591a\u4e2a Broker\u3002\\n\\n\u4f60\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u6b65\u9aa4\u8ba2\u9605\u8be5\u4e0a\u6e38\uff1a\\n\\n1. \u9996\u5148\u8bf7\u901a\u8fc7 WebSocket \u5efa\u7acb\u8fde\u63a5\u3002\\n2. \u83b7\u53d6 Topic \u4e2d\u7684\u67d0\u4e2a Partition \u5f53\u524d\u7684 offset\u3002\u4ee5\u4e0b\u793a\u4f8b\u4f7f\u7528\u4e86 Protobuf \u6765\u7f16\u7801\u76f8\u5173\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\uff1a\\n\\n    ```\\n    message PubSubReq {\\n        int64 sequence = 1;\\n        oneof req {\\n            CmdEmpty cmd_empty                       = 31;\\n            CmdPing cmd_ping                         = 32;\\n            CmdKafkaFetch      cmd_kafka_fetch       = 33;\\n            CmdKafkaListOffset cmd_kafka_list_offset = 34;\\n        };\\n    }\\n\\n    message PubSubResp {\\n        int64 sequence = 1;\\n        oneof resp {\\n            ErrorResp error_resp                       = 31;\\n            PongResp pong_resp                         = 32;\\n            KafkaFetchResp kafka_fetch_resp            = 33;\\n            KafkaListOffsetResp kafka_list_offset_resp = 34;\\n        };\\n    }\\n    ```\\n\\n    \u83b7\u53d6 offset \u7684\u8bf7\u6c42\u5982\u4e0b\uff1a\\n\\n    ```\\n    message CmdKafkaListOffset {\\n        string topic = 1;\\n        int32 partition = 2;\\n        int64 timestamp = 3;\\n    }\\n    ```\\n\\n    \u5404\u4e2a\u5b57\u6bb5\u5177\u4f53\u542b\u4e49\u8bf7\u53c2\u8003 [pubsub.proto](https://github.com/apache/apisix/blob/master/apisix/include/apisix/model/pubsub.proto)\u3002\\n\\n3. \u4e4b\u540e\u6bcf\u6b21\u8ba2\u9605\u64cd\u4f5c\u90fd\u53ef\u4ee5\u6839\u636e\u5f53\u524d\u7684 offset \u6765\u83b7\u53d6\u6700\u65b0\u7684\u6d88\u606f\u3002\\n\\n:::tip\\n\\n\u6210\u529f\u83b7\u53d6\u6d88\u606f\u4e4b\u540e\uff0c\u9700\u8981\u66f4\u65b0\u5f53\u524d\u7684 offset\uff0c\u66f4\u65b0\u540e\u7684 offset \u662f\u4e4b\u524d\u8fd4\u56de\u7684 offset + 1\u3002\\n\\n:::\\n\\n\u5177\u4f53\u64cd\u4f5c\u53ef\u53c2\u8003\u6e90\u7801\u548c\u6d4b\u8bd5\u7528\u4f8b\uff1a\\n\\n- https://github.com/apache/apisix/blob/master/t/pubsub/kafka.t\\n\\n- https://github.com/apache/apisix/blob/master/t/lib/pubsub.lua\\n\\n\u867d\u7136\u5f53\u524d\u7684 Pubsub \u6846\u67b6\u4ec5\u63d0\u4f9b\u4e86\u5e95\u5c42\u7684\u63a5\u53e3\uff0c\u4f46\u662f\u5b83\u5df2\u7ecf\u5b9e\u73b0\u4e86\u4e24\u4e2a\u6700\u57fa\u672c\u7684\u9700\u6c42\uff1a\\n\\n- \u901a\u8fc7\u5e38\u7528\u7684 `80/443` \u7aef\u53e3\u66b4\u9732 Kafka \u670d\u52a1\u80fd\u529b\uff0c\u65e0\u9700\u5e94\u7528\u670d\u52a1\u5668\u518d\u5c01\u88c5\u591a\u4e00\u5c42\u3002\\n- \u5141\u8bb8\u6dfb\u52a0\u9274\u6743\u63d2\u4ef6\uff0c\u50cf\u4f7f\u7528\u4e00\u822c\u7684 Websocket \u6846\u67b6\u90a3\u6837\u7ed9 Kafka \u7684\u670d\u52a1\u589e\u52a0\u5b89\u5168\u4fdd\u62a4\u3002\\n\\n\u5982\u679c\u4f60\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u9047\u5230\u95ee\u9898\uff0c\u53ef\u4ee5\u901a\u8fc7\u63d0\u4ea4 [issue](https://github.com/apache/apisix/issues) \u7684\u65b9\u5f0f\u53cd\u9988\u7ed9 Apache APISIX \u793e\u533a\uff0c\u793e\u533a\u5c06\u6839\u636e\u53cd\u9988\uff0c\u7ee7\u7eed\u5b8c\u5584\u548c\u589e\u5f3a\u8fd9\u4e00\u529f\u80fd\u3002\\n\\n## \u57fa\u4e8e xRPC \u6846\u67b6\u7ba1\u7406\u975e HTTP \u7684 7 \u5c42\u534f\u8bae\\n\\nAPISIX \u5728\u65e9\u671f\u7248\u672c\u5c31\u652f\u6301\u4ee3\u7406 TCP \u534f\u8bae\uff0c\u4f46\u662f\u90e8\u5206\u573a\u666f\u4e2d\uff0c\u7eaf\u7cb9\u7684 TCP \u534f\u8bae\u4ee3\u7406\u65e0\u6cd5\u6ee1\u8db3\u7528\u6237\u9700\u6c42\u3002\u56e0\u4e3a\u6709\u4e9b\u529f\u80fd\u5fc5\u987b\u5728\u5bf9\u5e94\u7528\u534f\u8bae\u8fdb\u884c\u7f16\u89e3\u7801\u4e4b\u540e\u624d\u80fd\u5b9e\u73b0\uff0c\u56e0\u6b64\u7528\u6237\u5c31\u9700\u8981\u7279\u5b9a\u5e94\u7528\u534f\u8bae\u7684\u4ee3\u7406\uff0c\u6bd4\u5982 Redis Proxy\u3001Kafka Proxy \u7b49\u3002\\n\\n\u4ece APISIX v2.14.1 \u7248\u672c\u5f00\u59cb\uff0cAPISIX \u63d0\u4f9b\u4e86 xRPC \u6846\u67b6\uff0c\u5141\u8bb8\u5f00\u53d1\u8005\u5728\u8be5\u6846\u67b6\u4e0a\u81ea\u5b9a\u4e49\u7279\u5b9a\u7684\u5e94\u7528\u534f\u8bae\u3002\u57fa\u4e8e xRPC \u6846\u67b6\uff0cAPISIX \u53ef\u4ee5\u63d0\u4f9b\u5bf9\u82e5\u5e72\u4e3b\u6d41\u5e94\u7528\u534f\u8bae\u7684\u4ee3\u7406\u652f\u6301\u3002\u540c\u65f6\u7528\u6237\u4e5f\u53ef\u4ee5\u57fa\u4e8e\u8be5\u6846\u67b6\u6765\u652f\u6301\u81ea\u5df1\u79c1\u6709\u7684\u57fa\u4e8e TCP \u7684\u5e94\u7528\u534f\u8bae\uff0c\u4f7f\u5176\u5177\u5907\u7c7b\u4f3c HTTP \u534f\u8bae\u4ee3\u7406\u7684\u7cbe\u51c6\u9897\u7c92\u5ea6\u548c\u66f4\u9ad8\u9636\u7684 7 \u5c42\u63a7\u5236\u3002\\n\\n\u76ee\u524d\uff0cAPISIX \u5df2\u7ecf\u5728 xRPC \u6846\u67b6\u4e0a\u5b9e\u73b0\u4e86 Redis \u7684\u4ee3\u7406\u529f\u80fd\uff0c\u652f\u6301\u4e86\u6839\u636e\u547d\u4ee4\u6ce8\u5165\u5ef6\u8fdf\u548c\u6709\u9009\u62e9\u6027\u5730\u8bb0\u5f55\u65e5\u5fd7\u5185\u5bb9\u3002\u5c3d\u7ba1 APISIX \u9700\u8981\u5bf9 Redis \u534f\u8bae\u8fdb\u884c\u7f16\u89e3\u7801\uff0c\u4f46\u662f\u5728\u7b80\u5355\u7684 SET/GET \u6027\u80fd\u6d4b\u8bd5\u4e2d\uff0c\u4f7f\u7528\u53cc Worker \u8fdb\u7a0b\u7684 APISIX \u8fdb\u884c\u4ee3\u7406\uff0c\u5176\u6027\u80fd\u53ef\u4ee5\u8fbe\u5230\u76f4\u8fde Redis \u7684 80%\u3002\\n\\n\u4f60\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u4ee3\u7406 Redis \u534f\u8bae\u7684\u6d41\u8def\u7531\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/stream_routes/1 \\\\\\n-H \'X-API-KEY: ${api-key}\' -X PUT -d \'\\n{\\n    \\"upstream\\": {\\n        \\"type\\": \\"none\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:6379\\": 1\\n        }\\n    },\\n    \\"protocol\\": {\\n        \\"name\\": \\"redis\\",\\n        \\"conf\\": {\\n            \\"faults\\": [{\\n                \\"commands\\": [\\"get\\", \\"ping\\"],\\n                \\"delay\\": 5\\n            }]\\n        },\\n        logger = {\\n            [\\n                \\"name\\": \\"syslog\\",\\n                \\"filter\\": [\\n                    [\\"rpc_time\\", \\">=\\", 1],\\n                ],\\n                \\"conf\\": {\\n                    \\"host\\": \\"127.0.0.1\\",\\n                    \\"port\\": 8125,\\n                    \\"sock_type\\": \\"udp\\",\\n                    \\"batch_max_size\\": 1,\\n                    \\"flush_limit\\": 1\\n                }\\n            ]\\n        }\\n    }\\n}\'\\n```\\n\\n\u4ee5\u4e0a\u914d\u7f6e\u91ca\u4e49\u5982\u4e0b\uff1a\\n\\n\u5f53\u547d\u4ee4\u662f GET \u6216 ping \u65f6\uff0c\u5c06\u4f1a\u6709 5 \u79d2\u5ef6\u8fdf\u3002\u540c\u65f6\u6bcf\u4e2a\u547d\u4ee4\u6267\u884c\u4e4b\u540e\uff0c\u4f1a\u5224\u65ad\u5176\u82b1\u8d39\u7684\u65f6\u95f4\u662f\u5426\u8d85\u8fc7 1 \u79d2\uff0c\u5982\u679c\u662f\uff0c\u5219\u89e6\u53d1\u5bf9\u5e94\u7684 `logger` \u5bf9\u8c61\uff0c\u5e76\u53d1\u9001 `syslog` UDP \u65e5\u5fd7\u5230 `127.0.0.1` \u7684 `8125` \u7aef\u53e3\u3002\\n\\n## \u63a7\u5236\u9762\u652f\u6301\u670d\u52a1\u53d1\u73b0\\n\\n\u5728 v2.14.1 \u7248\u672c\u4e4b\u524d\uff0cAPISIX \u4ec5\u5728\u6570\u636e\u9762\u652f\u6301\u4e86\u670d\u52a1\u53d1\u73b0\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a APISIX \u5b9e\u4f8b\u90fd\u9700\u8981\u83b7\u53d6\u670d\u52a1\u53d1\u73b0\u7684\u6570\u636e\uff0c\u4f46\u662f\u7528\u6237\u5728\u5b9e\u9645\u5e94\u7528\u8fc7\u7a0b\u4e2d\uff0c\u53cd\u9988\u4e86\u4ee5\u4e0b\u95ee\u9898\uff1a\\n\\n1. \u6bcf\u4e2a APISIX \u5b9e\u4f8b\u90fd\u9700\u8981\u4ece\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\u91cc\u62c9\u53d6\u6570\u636e\uff0c\u8fd9\u8ba9\u7f51\u7edc\u62d3\u6251\u53d8\u5f97\u590d\u6742\u3002\\n2. \u670d\u52a1\u53d1\u73b0\u914d\u7f6e\u9700\u8981\u5728\u6bcf\u4e2a APISIX \u5b9e\u4f8b\u90fd\u914d\u7f6e\u4e00\u904d\u3002\u5982\u9700\u4fee\u6539\u5bc6\u7801\uff0c\u5c31\u5fc5\u987b\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u53d1\u5e03\u5230\u6bcf\u4e2a APISIX \u5b9e\u4f8b\u4e0a\u3002\\n3. \u5f53\u524d\u8bb8\u591a\u670d\u52a1\u53d1\u73b0\u90fd\u6ca1\u6709\u63d0\u4f9b Lua SDK\uff0c\u5982\u679c\u8981\u4f7f\u7528\u8fd9\u4e9b\u670d\u52a1\u53d1\u73b0\u7cfb\u7edf\uff0c\u5c31\u9700\u8981\u81ea\u5df1\u76f4\u63a5\u5bf9\u63a5\u8be5\u670d\u52a1\u5668\u63d0\u4f9b\u7684 HTTP API \uff08\u5047\u5982\u5b58\u5728\uff09\u3002\\n\\n\u56e0\u6b64\u4ece v2.14.1 \u7248\u672c\u5f00\u59cb\uff0cAPISIX \u5c06\u5728\u63a7\u5236\u9762\u652f\u6301\u670d\u52a1\u53d1\u73b0\u529f\u80fd\u3002\u670d\u52a1\u53d1\u73b0\u5c06\u901a\u8fc7 [APISIX-Seed](https://github.com/api7/apisix-seed/) \u5b9e\u73b0\u3002\\n\\n\u8be5\u529f\u80fd\u5b9e\u73b0\u539f\u7406\u662f\u901a\u8fc7 `apisix-seed` \u540c\u65f6\u76d1\u542c etcd \u4e2d Upstream \u76f8\u5173\u7684\u8d44\u6e90\u548c\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u4e2d\u5bf9\u5e94\u7684\u4e0a\u6e38\u670d\u52a1\u8d44\u6e90\uff0c\u5f53\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u4e2d\u7684\u4e0a\u6e38\u670d\u52a1\u8d44\u6e90\u53d1\u751f\u53d8\u5316\u65f6\u66f4\u65b0 etcd \u4e2d\u76f8\u5173\u7684 Upstream \u4fe1\u606f\u3002\\n\\n\u5177\u4f53\u5b9e\u73b0\u6d41\u7a0b\u5982\u4e0b\u56fe\uff1a\\n\\n![error/APISIX-Seed \u67b6\u6784\u56fe.png](https://static.apiseven.com/202108/1653983575757-97b39a39-8bd1-4e1e-b708-a7b43976c342.png)\\n\\n\u76ee\u524d\u6765\u770b\uff0c\u63a7\u5236\u9762\u670d\u52a1\u53d1\u73b0\u7684\u65b9\u6848\u4e5f\u6709\u4e0d\u8db3\u4e4b\u5904\uff0c\u6bd4\u5982\u5bf9 etcd \u7684\u538b\u529b\u8f83\u5927\u3002\u56e0\u6b64 APISIX \u4f1a\u540c\u65f6\u4fdd\u7559\u4e24\u79cd\u670d\u52a1\u53d1\u73b0\u65b9\u6848\uff0c\u5e76\u901a\u8fc7\u66f4\u591a\u5b9e\u9645\u5e94\u7528\u6765\u8bc1\u660e\u54ea\u4e2a\u65b9\u6848\u4f1a\u66f4\u4f18\u3002\\n\\n## \u521d\u6b65\u652f\u6301 Istio\\n\\n\u4e3a\u4e86\u9002\u5e94\u66f4\u5e7f\u6cdb\u7684\u5e94\u7528\u573a\u666f\uff0c\u4ece v2.14.1 \u7248\u672c\u5f00\u59cb\uff0cAPISIX \u5c06\u5c1d\u8bd5\u517c\u5bb9 Istio\uff0c\u4ee5 Istio \u4e3a\u63a7\u5236\u9762\u3001APISIX \u4e3a\u6570\u636e\u9762\u7684\u5f62\u5f0f\uff0c\u5f00\u59cb\u5728\u670d\u52a1\u7f51\u683c\u9886\u57df\u4e2d\u63a2\u7d22\u3002\\n\\n\u7531\u4e8e Istio \u7684\u914d\u7f6e\u662f\u901a\u8fc7 xDS \u534f\u8bae\u4e0b\u53d1\u7684\uff0c\u6240\u4ee5\u5f00\u53d1\u4e86 [Amesh](https://github.com/api7/amesh) \u9879\u76ee\uff0c\u628a Istio \u4e0b\u53d1\u7684 xDS \u8f6c\u6362\u6210 APISIX \u7684\u914d\u7f6e\u3002\u76ee\u524d\uff0cAPISIX \u5df2\u7ecf\u80fd\u591f\u8dd1\u901a Istio \u5b98\u65b9\u7684 Simple Bookstore App demo\u3002\u5728\u540e\u7eed\u7248\u672c\u4e2d\uff0cAPISIX \u4e5f\u4f1a\u7ee7\u7eed\u62d3\u5bbd\u5bf9 xDS \u7684\u652f\u6301\uff0c\u628a Istio \u548c APISIX \u7684\u80fd\u529b\u8d8a\u6765\u8d8a\u7d27\u5bc6\u5730\u7ed3\u5408\u5728\u4e00\u8d77\u3002\\n\\n## \u66f4\u591a\u63d2\u4ef6\u548c\u529f\u80fd\\n\\n\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u51e0\u4e2a\u63a2\u7d22\u6027\u529f\u80fd\u5916\uff0c\u672c\u6b21\u7248\u672c\u53d1\u5e03\u4e5f\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u4e00\u4e9b\u8f83\u4e3a\u4f20\u7edf\u7684\u529f\u80fd\uff1a\\n\\n- \u65b0\u589e `casdoor` \u63d2\u4ef6\uff0c\u63d0\u9ad8\u4e0e Casdoor \u7684\u4ea4\u4e92\u4f53\u9a8c\u3002\\n- `response-rewrite` \u63d2\u4ef6\u589e\u52a0\u4e86\u9488\u5bf9 Body \u7684\u66ff\u6362\u8fc7\u6ee4\u5668\u3002\\n\\n\u66f4\u591a\u529f\u80fd\u66f4\u65b0\u548c Bug \u4fee\u590d\u7ec6\u8282\uff0c\u8bf7\u67e5\u770b\u5b98\u65b9 [Releases CHANGELOG](https://github.com/apache/apisix/blob/master/CHANGELOG.md)\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff085.01 - 5.15\uff09","metadata":{"permalink":"/zh/blog/2022/05/19/weekly-report-0519","source":"@site/blog/2022/05/19/weekly-report-0519.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff085.01 - 5.15\uff09","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2022-05-19T00:00:00.000Z","formattedDate":"2022\u5e745\u670819\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.19,"truncated":true,"authors":[],"prevItem":{"title":"Apache APISIX 2.14.1 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/05/31/release-apache-apisix-2.14"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff084.15-4.30\uff09","permalink":"/zh/blog/2022/05/10/weekly-report-0510"}},"content":"> \u4ece 5.01 - 5.15\uff0c\u6709 35 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 77 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1652939409552-1bae4e92-f70a-4715-9ba0-fb0dff31ebf9.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1652939511212-d95ad226-f8ff-41b7-a4c5-03ac049b4d5c.png)\\n\\n## Good first issue\\n\\n### Issue #7052\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/7052\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4f5c\u4e3a\u7528\u6237\uff0c\u5e0c\u671b\u80fd\u591f\u4f7f\u7528\u5e26\u6709 [PKCE](https://oauth.net/2/pkce/) \u652f\u6301\u7684 OAuth2\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u4e0d\u4f7f\u7528\u5ba2\u6237\u7aef/\u5bc6\u7801\u7684\u60c5\u51b5\u4e0b\u914d\u7f6e OAuth2 \u8fde\u63a5\u3002 \u6211\u7528\u7684\u662f IdP\u3002\u5b83\u5df2\u7ecf\u5b9e\u73b0\u4e86 [Authorization Code Flow](https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth)\u3002\u4ee5\u4e0b\u4ecb\u7ecd\u6765\u81ea IdP \u7684\u6587\u6863\uff1a\\n\\nIdP \u53ef\u4ee5\u5b9e\u73b0 Authorization Code Flow\uff0c\u6700\u597d\u642d\u914d PKCE (Proof Key for Code Exchange)\u3002PKCE \u6d41\u7a0b\u662f\u63a8\u8350\u548c\u6700\u901a\u7528\u7684\u6388\u6743\u6d41\u7a0b\uff0c\u5b83\u652f\u6301\u79fb\u52a8\u5e94\u7528\u7a0b\u5e8f\u3001\u5355\u9875\u5e94\u7528\u7a0b\u5e8f\u548c\u4f20\u7edf\u7684\u670d\u52a1\u5668\u6e32\u67d3\u5e94\u7528\u7a0b\u5e8f\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u4ea4\u6362\u5171\u4eab\u5bc6\u94a5\u3002\\n\\n\u5177\u4f53\u6d41\u7a0b\u5982\u4e0b\uff1a\\n\\n- \u7528\u6237\u6253\u5f00\u4e00\u4e2a web \u5e94\u7528\uff08\u5728\u6211\u7684\u4f8b\u5b50\u4e2d\u662f\u4e00\u4e2a `APISIXROUTE`\uff0c\u4f7f\u7528 `openid` \u63d2\u4ef6\uff09\\n- \u4f7f\u7528 **SHA256** \u7684\u4ee3\u7801\u96be\u9898\u662f\u7531 `openid` \u63d2\u4ef6\u521b\u5efa\u7684\\n- \u91cd\u5b9a\u5411\u5230 IdP \u6388\u6743\u7aef\u70b9\\n- \u7528\u6237\u767b\u5f55\\n- \u4f7f\u7528 `authcode` \u4f5c\u4e3a URL \u67e5\u8be2\u53c2\u6570\u91cd\u5b9a\u5411\u5230 `redirect_url`\\n- `openid` \u63d2\u4ef6\u4f7f\u7528 `authcode` \u4ece IdP \u4ee4\u724c\u7aef\u70b9\u63a5\u6536 JWT\\n\\n\u80fd\u5426\u7528 PKCE \u652f\u6301\u5b9e\u73b0\u8fd9\u4e2a OAuth \u6d41\uff1f\u6b64\u5916\uff0c\u8bf7\u5728\u6587\u6863\u4e2d\u6dfb\u52a0\u4e00\u8282\uff0c\u4ecb\u7ecd PKCE \u548c\u91cd\u5b9a\u5411 url \u7684\u914d\u7f6e\u3002\\n\\n## Issue #6939\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/6939\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5982 [ip_port.lua](https://github.com/apache/apisix/blob/dbe7eeebba06229d4a8df75263f2a78301cc1ca0/apisix/stream/router/ip_port.lua#L82) \u6587\u4ef6\u7684\u7b2c 82 \u884c\u4e2d\u6240\u793a\uff1a\\n\\n```Lua\\n   -- TODO: check the subordinate relationship in the Admin API\\n```\\n\\n\u4f5c\u4e3a\u7528\u6237\uff0c\u9700\u8981\u68c0\u67e5 Admin API \u4e2d\u7684\u4ece\u5c5e\u5173\u7cfb\uff0c\u5305\u62ec\uff1a\\n\\n- \u9a8c\u8bc1\u662f\u5426\u5b58\u5728\u5177\u6709\u4e0a\u7ea7 id \u7684\u6d41\u8def\u7531\u5e76\u4e14\u5176\u534f\u8bae\u4e0e\u4e0b\u7ea7\u5339\u914d\\n- \u5220\u9664\u6d41\u8def\u7531\u65f6\uff0c\u8bf7\u68c0\u67e5\u5b83\u662f\u5426\u88ab\u5176\u4ed6\u6d41\u8def\u7531\u5f15\u7528\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [xRPC \u6846\u67b6\u652f\u6301 timeout \u8bbe\u7f6e](https://github.com/apache/apisix/pull/6965)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [\u79fb\u690d syslog \u63d2\u4ef6\u5230 stream \u5b50\u7cfb\u7edf](https://github.com/apache/apisix/pull/6953)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [xRPC \u6846\u67b6\u5b9e\u73b0 Redis \u534f\u8bae\u652f\u6301 pipeline](https://github.com/apache/apisix/pull/6959)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [key-auth \u63d2\u4ef6\u9690\u85cf credentials \u65f6\u53ea\u9700\u66f4\u6539 uri args \u6216 headers](https://github.com/apache/apisix/pull/6991)\uff08\u8d21\u732e\u8005\uff1a[jwrookie](https://github.com/jwrookie)\uff09\\n\\n- [\u652f\u6301 servlet \u7684 URI \u89c4\u8303](https://github.com/apache/apisix/pull/6984)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [\u5728 APISIX \u521d\u59cb\u5316\u65f6\uff0cbatch-requests \u63d2\u4ef6\u652f\u6301\u5904\u7406 CIDR \u683c\u5f0f \u7684 real_ip_from](https://github.com/apache/apisix/pull/6981)\uff08\u8d21\u732e\u8005\uff1a[kwanhur](https://github.com/kwanhur)\uff09\\n\\n- [xRPC \u6846\u67b6\u652f\u6301\u65e5\u5fd7\u8fc7\u6ee4](https://github.com/apache/apisix/pull/6960)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass))\\n\\n- [\u65b0\u589e pubsub \u6846\u67b6](https://github.com/apache/apisix/pull/7028)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [xRPC \u6846\u67b6\u5b9e\u73b0 Redis \u534f\u8bae\u652f\u6301 pipeline \uff08\u589e\u52a0\u6d4b\u8bd5\uff09](https://github.com/apache/apisix/pull/7031)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [real-ip \u63d2\u4ef6\u652f\u6301\u9012\u5f52\u641c\u7d22](https://github.com/apache/apisix/pull/6988)\uff08\u8d21\u732e\u8005\uff1a[crazyMonkey1995](https://github.com/crazyMonkey1995)\uff09\\n\\n- [ext-plugin \u652f\u6301\u5904\u7406 response body](https://github.com/apache/apisix/pull/6968)\uff08\u8d21\u732e\u8005\uff1a[soulbird](https://github.com/soulbird)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff084.15-4.30\uff09","metadata":{"permalink":"/zh/blog/2022/05/10/weekly-report-0510","source":"@site/blog/2022/05/10/weekly-report-0510.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff084.15-4.30\uff09","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2022-05-10T00:00:00.000Z","formattedDate":"2022\u5e745\u670810\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.79,"truncated":true,"authors":[],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff085.01 - 5.15\uff09","permalink":"/zh/blog/2022/05/19/weekly-report-0519"},"nextItem":{"title":"\u741a\u81f4\u8fdc\uff1a95 \u540e Apache Member \u7684\u6210\u957f\u4e4b\u8def","permalink":"/zh/blog/2022/04/29/interview-juzhiyuan-apache-member"}},"content":"> \u4ece 4.15 \u5230 4.30\uff0c \u6709 28 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 88 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1652147147763-4ffa507f-e206-4197-bad3-35d7b0b3dc25.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1652147147751-a2cca84b-cff6-4993-bbc7-9199d1352b6d.png)\\n\\n## Good first issue\\n\\n### Issue #6923\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/6923\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5f53\u4e0a\u6e38\u5904\u4e8e\u4e0d\u5065\u5eb7\u72b6\u6001\u65f6\uff0c`api-breaker` \u4ec5\u8fd4\u56de `unhealthy.http_statuses`\uff0c\u4e3a\u4e86\u66f4\u517c\u5bb9\u5ba2\u6237\u7aef\uff0c\u662f\u5426\u53ef\u4ee5\u6dfb\u52a0\u5b57\u6bb5\uff0c\u8fd4\u56de\u9ed8\u8ba4\u54cd\u5e94\u4f53\u3002\u53c2\u8003\u6587\u6863 [api-breaker](https://apisix.apache.org/docs/apisix/plugins/api-breaker/) \u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [Kubernetes \u670d\u52a1\u53d1\u73b0\u6a21\u5f0f\u652f\u6301\u4ece\u73af\u5883\u53d8\u91cf\u8bfb\u53d6\u914d\u7f6e](https://github.com/apache/apisix/pull/6869)\uff08\u8d21\u732e\u8005\uff1a[zhixiongdu027](https://github.com/zhixiongdu027)\uff09\\n\\n- [xRPC \u652f\u6301\u57fa\u7840\u7684 Redis \u529f\u80fd](https://github.com/apache/apisix/pull/6873)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [xRPC \u652f\u6301\u57fa\u7840\u7684 Stream \u4ee3\u7406](https://github.com/apache/apisix/pull/6885)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [xRPC \u652f\u6301\u52a8\u6001\u4e0a\u6e38](https://github.com/apache/apisix/pull/6901)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [xRPC \u652f\u6301\u6839\u636e upstream_id \u52a8\u6001\u9009\u62e9\u4e0a\u6e38](https://github.com/apache/apisix/pull/6919)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u57fa\u4e8e TiDB \u7684 Apache APISIX \u9ad8\u53ef\u7528\u914d\u7f6e\u4e2d\u5fc3\u7684\u6700\u4f73\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/04/22/apisix-with-tidb-practice)\uff1a\\n\\n\u5728 TiDB Hackathon 2021 \u7684\u6bd4\u8d5b\u4e2d\uff0cAPISIX \u53c2\u8d5b\u56e2\u961f\u4ee5\u56db\u4eba\u7ec4\u961f\u65b9\u5f0f\uff08\u961f\u957f\uff1a\u5f20\u8d85\uff0c\u961f\u5458\uff1a\u767d\u6cfd\u5e73\u3001\u5c60\u6b63\u677e\u3001\u9648\u5a67\u6657\uff09\u5448\u73b0\u4e86 TiDB \u4e0e Apache APISIX \u5bf9\u63a5\u5b9e\u73b0\u901a\u7528\u914d\u7f6e\u4e2d\u5fc3\u7684\u80fd\u529b\u3002\u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u5e26\u6765\u8be5\u9879\u76ee\u80cc\u540e\u7684\u4e00\u4e9b\u6545\u4e8b\u4ee5\u53ca\u672a\u6765\u5c55\u671b\uff0c\u5982\u679c\u60a8\u5bf9\u8be5\u9879\u76ee\u611f\u5174\u8da3\uff0c\u4e5f\u6b22\u8fce\u968f\u65f6\u53c2\u4e0e\u5230\u9879\u76ee\u4e2d\u6765\u3002"},{"id":"\u741a\u81f4\u8fdc\uff1a95 \u540e Apache Member \u7684\u6210\u957f\u4e4b\u8def","metadata":{"permalink":"/zh/blog/2022/04/29/interview-juzhiyuan-apache-member","source":"@site/blog/2022/04/29/interview-juzhiyuan-apache-member.md","title":"\u741a\u81f4\u8fdc\uff1a95 \u540e Apache Member \u7684\u6210\u957f\u4e4b\u8def","description":"2022 \u5e74 3 \u6708\uff0cApache APISIX PPMC \u6210\u5458\u741a\u81f4\u8fdc\u5165\u9009 Apache Member \u548c\u4e2d\u56fd\u5f00\u6e90\u7801\u529b\u699c\u3002Apache APISIX \u793e\u533a\u9080\u8bf7\u4e86\u81f4\u8fdc\u804a\u804a\u4ed6\u7684\u5f00\u6e90\u7ecf\u5386\u548c\u6280\u672f\u6210\u957f\u4e4b\u8def\u3002","date":"2022-04-29T00:00:00.000Z","formattedDate":"2022\u5e744\u670829\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":39.92,"truncated":true,"authors":[{"name":"\u9976\u96c5\u60e0","title":"Author","url":"https://github.com/EstelleRao","image_url":"https://github.com/EstelleRao.png","imageURL":"https://github.com/EstelleRao.png"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff084.15-4.30\uff09","permalink":"/zh/blog/2022/05/10/weekly-report-0510"},"nextItem":{"title":"\u57fa\u4e8e TiDB \u7684 API \u7f51\u5173\u9ad8\u53ef\u7528\u914d\u7f6e\u6700\u4f73\u5b9e\u8df5","permalink":"/zh/blog/2022/04/22/apisix-with-tidb-practice"}},"content":"> 2022 \u5e74 3 \u6708\uff0cApache APISIX PPMC \u6210\u5458\u741a\u81f4\u8fdc\uff08GitHub ID\uff1ajuzhiyuan\uff09\u5165\u9009 Apache Member \u548c\u4e2d\u56fd\u5f00\u6e90\u7801\u529b\u699c\u3002Apache APISIX \u793e\u533a\u5bf9\u6b64\u8868\u793a\u795d\u8d3a\uff0c\u4e5f\u9080\u8bf7\u4e86\u81f4\u8fdc\u505a\u5ba2\u8bbf\u8c08\uff0c\u804a\u804a\u4ed6\u7684\u5f00\u6e90\u7ecf\u5386\u548c\u6280\u672f\u6210\u957f\u4e4b\u8def\u3002\\r\\n\\r\\n\x3c!--truncate--\x3e\\r\\n\\r\\n## \u5bfc\u8bed\\r\\n\\r\\n**\u741a\u81f4\u8fdc\uff08GitHub ID\uff1ajuzhiyuan\uff09\u4e8e 1997 \u5e74\u51fa\u751f\uff0c2019 \u5e74 10 \u6708\u6210\u4e3a Apache APISIX PPMC Member\uff0c2022 \u5e74 3 \u6708\u5165\u9009 Apache Member \u548c\u4e2d\u56fd\u5f00\u6e90\u7801\u529b\u699c\u3002\u4ed6\u662f\u5f00\u6e90\u8f6f\u4ef6\u5546\u4e1a\u516c\u53f8 API7.ai \u7684 Global Team Leader\uff0c\u4e5f\u662f ApacheCon Speaker\u3001OSPP Mentor\u3001GSoC Mentor\u3001\uff082019 \u5e74\u4e4b\u524d\uff09freeCodeCamp \u4e2d\u56fd\u6838\u5fc3\u7ec4\u7ec7\u8005\u4e4b\u4e00\u3002**\\r\\n\\r\\n![ASF Members](https://static.apiseven.com/202108/1651198214277-8bb73696-dbe0-4e24-b0b9-2bb65e1abbfd.png)\\r\\n\\r\\n\u4ed6\u5c0f\u5b66\u5f00\u59cb\u63a5\u89e6\u7535\u8111\uff0c\u5b66\u4e60 Flash \u6280\u672f\uff1b\u521d\u9ad8\u4e2d\u81ea\u5b66 Web \u6e17\u900f\uff0c\u7231\u4e0a\u9ed1\u5ba2\u6587\u5316\uff0c\u5411\u5f80\u6210\u4e3a\u4e00\u540d\u4e4c\u4e91\u767d\u5e3d\uff1b\u5927\u5b66\u52a0\u5165 freeCodeCamp \u793e\u533a\uff0c\u6210\u4e3a Web \u6280\u672f\u7684\u5e03\u9053\u5e08\u3001\u5f15\u8def\u4eba\uff0c\u4ece\u6b64\u548c\u5f00\u6e90\u7ed3\u4e0b\u4e0d\u89e3\u4e4b\u7f18\u3002\u6bd5\u4e1a\u540e\uff0c\u4ed6\u6210\u4e3a\u5f00\u6e90\u793e\u533a\u7684\u6df1\u5ea6\u53c2\u4e0e\u8005\u548c Apache APISIX PMC \u6210\u5458\uff0c\u5e7f\u6cdb\u53c2\u4e0e\u6d3b\u52a8\uff0c\u5bf9\u5916\u8bb2\u8ff0\u81ea\u5df1\u7684\u5f00\u6e90\u7ecf\u5386\u3001\u6280\u672f\u6210\u957f\u7ecf\u5386\uff0c\u4f20\u64ad\u5f00\u6e90\u6587\u5316\u548c Apache \u6587\u5316\u3002\\r\\n\\r\\n**\u4ed6\u8bf4\u4ed6\u662f\u4e2a\u6781\u5ba2\uff0c\u6562\u60f3\u6562\u505a\uff0c\u4e0d\u88ab\u6761\u6761\u6846\u6846\u675f\u7f1a\uff0c\u6240\u505a\u7684\u4e00\u5207\u53ea\u662f\u56e0\u4e3a\u70ed\u7231\uff0c\u56e0\u4e3a\u8ffd\u6c42\u771f\u7406\u3002\u4ed6\u8bf4\u6bcf\u4e2a\u5f00\u6e90\u9879\u76ee\u7684\u80cc\u540e\u90fd\u6709\u4e00\u4e2a\u5f00\u6e90\u793e\u533a\uff0c\u5f00\u6e90\u7cbe\u795e\u5728\u4e8e\u6211\u4eec\u6709\u60f3\u6cd5\uff0c\u6211\u4eec\u60f3\u5b9e\u73b0\u51fa\u6765\uff0c\u516c\u5f00\u51fa\u6765\uff0c\u9080\u8bf7\u66f4\u591a\u7684\u4eba\u53c2\u4e0e\u8fdb\u6765\u3002\u4ed6\u8bf4\u4ed6\u5f88\u5f00\u5fc3\u5728\u6280\u672f\u5b66\u4e60\u3001\u5f00\u6e90\u53c2\u4e0e\u8fd9\u6761\u8def\u4e0a\u80fd\u4e3a\u540e\u6765\u4eba\u63d0\u4f9b\u529b\u6240\u80fd\u53ca\u7684\u5e2e\u52a9\uff0c\u81ea\u5df1\u6210\u957f\u7684\u524d\u63d0\u662f\u8eab\u8fb9\u7684\u670b\u53cb\u4e00\u8d77\u6210\u957f\u3002**\\r\\n\\r\\n\u4f5c\u4e3a Apache APISIX PMC \u6210\u5458\uff0c\u81f4\u8fdc\u4e3a Apache APISIX \u6240\u505a\u7684\u8d21\u732e\u6709\u76ee\u5171\u7779\u3002\u5982\u4eca\uff0c\u4ed6\u52a0\u5165 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\uff0c\u6210\u4e3a Apache Member\uff0c\u5728\u5f00\u6e90\u8fd9\u6761\u8def\u4e0a\u8d70\u5f97\u66f4\u8fdc\u3002Apache APISIX \u793e\u533a\u5bf9\u6b64\u8868\u793a\u795d\u8d3a\uff0c\u4e5f\u9080\u8bf7\u4e86\u81f4\u8fdc\u505a\u5ba2\u8bbf\u8c08\uff0c\u804a\u804a\u4ed6**\u4ece\u63a5\u89e6\u5f00\u6e90\u5230\u62e5\u62b1\u5f00\u6e90\u3001\u8d21\u732e\u5f00\u6e90\u7684\u7ecf\u5386\uff0c\u4ee5\u53ca\u4e2a\u4eba\u7684\u6280\u672f\u79ef\u7d2f\u548c\u6210\u957f\u4e4b\u8def**\u3002\\r\\n\\r\\n![Open-Source Experience](https://static.apiseven.com/202108/1651201975732-aaafd882-b1ca-4bd3-945f-2eeb3aa72911.png)\\r\\n\\r\\n## \u5f00\u6e90\u7ecf\u5386\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u4f60\u4ece\u4ec0\u4e48\u65f6\u5019\u5f00\u59cb\u63a5\u89e6\u8ba1\u7b97\u673a\uff0c\u5b66\u4e60\u7f16\u7a0b\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u8fd9\u5f97\u4ece\u6211\u5c0f\u65f6\u5019\u8bf4\u8d77\u30022003 \u5e74\uff0c\u6211\u53d4\u53d4\u5728\u4e2d\u5173\u6751\u7ed9\u6211\u62fc\u4e86\u4e00\u53f0\u4e3b\u673a\uff0c\u6240\u4ee5\u6211\u63a5\u89e6\u8ba1\u7b97\u673a\u6bd4\u8f83\u65e9\uff0c\u4e00\u5f00\u59cb\u559c\u6b22\u73a9\u4e9b\u5c0f\u6e38\u620f\uff0c\u540e\u6765\u4f1a\u73a9\u9b54\u517d\u4e89\u9738\u7b49\u5927\u578b\u6e38\u620f\uff0c\u73a9\u8dd1\u8dd1\u5361\u4e01\u8f66\uff0c\u770b\u5927\u957f\u4eca\u3001\u54c6\u5566 A \u68a6\u7b49\u7535\u89c6\u5267\u30022008 \u5e74\u4ee5\u524d\uff0c\u6211\u63a5\u89e6\u5230\u4e86 Flash\uff0c\u56e0\u4e3a\u6211\u59d1\u59d1\u5b66\u8fc7 Flash\uff0c\u4f1a\u505a\u52a8\u753b\uff0c\u5979\u7684\u4f5c\u54c1\u5728\u7f51\u7edc\u4e0a\u88ab\u6cb3\u5357\u8c6b\u5267\u8282\u76ee\u9009\u4e2d\u4e86\u3002\u6211\u5f53\u65f6\u89c9\u5f97\u975e\u5e38\u9177\uff0c\u60f3\u5b66 Flash\uff0c\u7f20\u7740\u6211\u5988\u4e70\u6559\u7a0b\u3002\u8bf4\u5b9e\u8bdd\uff0c\u6211\u73b0\u5728\u505a\u7684\u4e8b\u60c5\u548c\u505a\u4e8b\u65b9\u6cd5\u53d7\u5bb6\u4eba\u7684\u5f71\u54cd\u5f88\u5927\u3002\u867d\u7136\u5bb6\u4eba\u6709\u65f6\u4f1a\u62ff\u81ea\u5df1\u7684\u7ecf\u9a8c\u5957\u5728\u6211\u8eab\u4e0a\uff0c\u4f46\u6211\u6bd4\u8f83\u56fa\u6267\uff0c\u4ed6\u4eec\u4e5f\u4f1a\u652f\u6301\u6211\u3002\\r\\n\\r\\n\u540e\u6765\u6211 QQ \u88ab\u76d7\uff0c\u4e3a\u4e86\u62ff\u56de\u6211\u7684\u5e10\u53f7\uff0c\u6211\u53d1\u8d77\u4e86\u7533\u8bc9\uff0c\u4e86\u89e3\u5230\u9ed1\u5ba2\u3001\u6728\u9a6c\u3001\u9493\u9c7c\u7b49\u6982\u5ff5\uff0c\u627e\u5230\u4e86\u9ed1\u5ba2\u57fa\u5730\u7b49\u5b89\u5168\u5708\u5b50\u719f\u77e5\u7684\u8bba\u575b\u548c\u76f8\u5173\u7684\u5728\u7ebf\u6559\u7a0b\u3002\u5982\u83b7\u81f3\u5b9d\u7684\u6211\u4ece\u6b64\u6c89\u6d78\u5728\u9ed1\u5ba2\u6280\u672f\u5b66\u4e60\u4e4b\u4e2d\u3002\u90a3\u65f6\u7684\u6211\u5e76\u4e0d\u77e5\u9053\u6709\u4e9b\u884c\u4e3a\u662f\u9519\u8bef\u7684\uff0c\u53ea\u77e5\u9053\u9ed1\u5ba2\u6280\u672f\u8ba9\u81ea\u5df1\u6709\u4e86\u8d85\u80fd\u529b\uff0c\u9664\u4e86\u6253\u6e38\u620f\uff0c\u8fd8\u53ef\u4ee5\u793e\u5de5\u3001\u505a\u6728\u9a6c\u3001\u76d7\u53d6 QQ \u8d26\u53f7\u5bc6\u7801\u3002\u4e3a\u4e86\u68c0\u9a8c\u6280\u672f\uff0c\u6211\u8fd8\u6e17\u900f\u4e86\u4e00\u4e9b\u7f51\u7ad9\uff0c\u5982\u679c\u53d1\u73b0\u7f51\u7ad9\u6709\u6f0f\u6d1e\uff0c\u6211\u4f1a\u544a\u77e5\u7f51\u7ad9\u7684\u7ba1\u7406\u5458\u3002\u6709\u4e00\u6b21\u6211\u5728\u6e17\u900f\u7684\u7f51\u7ad9\u4e0a\u7559\u4e86 QQ \u53f7\uff0c\u6211\u89c9\u5f97\u8fd9\u6837\u505a\u5f88\u9177\u3002\u540e\u6765\u7f51\u7ad9\u7ba1\u7406\u5458\u8054\u7cfb\u5230\u6211\uff0c\u77e5\u9053\u6211\u662f\u5b66\u751f\u540e\uff0c\u8ba9\u6211\u4e0d\u8981\u518d\u505a\u7c7b\u4f3c\u7684\u4e8b\u60c5\u3002\u8fd9\u662f\u7b2c\u4e00\u6b21\u6709\u4eba\u544a\u8bc9\u6211\u8fd9\u79cd\u884c\u4e3a\u662f\u4e0d\u5bf9\u7684\u3002  \\r\\n\\r\\n\u540e\u6765\u6211\u4e86\u89e3\u5230 WooYun \u793e\u533a\uff0c\u88ab\u8fd9\u7fa4\u53ef\u7231\u7684\u767d\u5e3d\u5b50\u6df1\u6df1\u5438\u5f15\u30022016 \u5e74\u4e4b\u524d\uff0c\u4e4c\u4e91\u662f\u4e00\u4e2a\u975e\u5e38\u68d2\u7684\u767d\u5e3d\u5b50\u805a\u96c6\u5730\uff0c\u6491\u8d77\u4e86\u4e2d\u56fd\u7f51\u7edc\u5b89\u5168\u7684\u5927\u534a\u8fb9\u5929\u3002\u5927\u4e00\u65f6\uff0c\u6211\u53c2\u52a0\u4e86\u4e4c\u4e91\u5cf0\u4f1a\u3002\u5f53\u65f6\uff0c\u6211\u7279\u522b\u60f3\u52a0\u5165\u8fd9\u5e2e\u6781\u5ba2\uff0c\u6210\u4e3a\u5176\u4e2d\u4e00\u5458\uff0c\u4ea4\u6d41\u548c\u5b66\u4e60\u6280\u672f\uff0c\u4f46\u6700\u7ec8\u6ca1\u6709\u901a\u8fc7\u52a0\u5165\u95e8\u69db\u3002\u5728\u4e4b\u540e\u5faa\u5e8f\u6e10\u8fdb\u7684\u81ea\u6211\u5b66\u4e60\u4e2d\uff0c\u6211\u80fd\u5206\u8fa8\u767d\u5e3d\u548c\u9ed1\u5e3d\u4e86\uff0c\u80fd\u5224\u65ad\u884c\u4e3a\u7684\u5bf9\u9519\u3002\\r\\n\\r\\n![Homepage of the WooYun Website](https://static.apiseven.com/202108/1651198239470-d23346d4-efeb-46ff-81d3-d80a7511488a.png)\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u540e\u6765\u662f\u56e0\u4e3a\u4ec0\u4e48\u5951\u673a\u63a5\u89e6\u5f00\u6e90\u3001\u53c2\u4e0e\u5f00\u6e90\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u8fdb\u5165\u5927\u5b66\u540e\uff0c\u6211\u4e86\u89e3\u5230\u4e00\u4e2a\u975e\u76c8\u5229\u7684\u3001\u5728\u7ebf\u6559\u6388 Web \u7f16\u7a0b\u7684\u5e73\u53f0 freeCodeCamp\uff0c\u4ee5\u5e2e\u52a9\u4e16\u754c\u5404\u5730\u7684\u4eba\u4eec\u514d\u8d39\u5b66\u4e60\u7f16\u7a0b\u4e3a\u4f7f\u547d\uff0c\u63a8\u52a8\u6559\u80b2\u516c\u76ca\u7684\u53d1\u5c55\u3002freeCodeCamp \u7684\u521b\u59cb\u4eba\u662f\u5916\u56fd\u4eba\uff0c2015 \u5e74\uff0c\u6210\u90fd\u7684 Miya \u628a\u5b83\u5f15\u5165\u5230\u4e2d\u56fd\uff0c\u5f00\u59cb\u5728\u4e2d\u56fd\u5efa\u7acb freeCodeCamp \u4e2d\u56fd\u793e\u533a\u3002\u73b0\u5728\uff0c\u6210\u90fd\u3001\u6df1\u5733\u3001\u676d\u5dde\u7b49\u56fd\u5185\u591a\u4e2a\u57ce\u5e02\u90fd\u6709 freeCodeCamp \u7684\u7ec4\u7ec7\u8005\uff0c\u8fd9\u4e9b\u7ec4\u7ec7\u8005\u4e0d\u7ba1\u5728\u5f53\u5730\uff0c\u8fd8\u662f\u5728\u56fd\u5185\u7684\u5708\u5b50\u91cc\u90fd\u6bd4\u8f83\u6709\u58f0\u671b\uff0c\u6bd4\u5982\u4e0a\u6d77\u7684\u7ec4\u7ec7\u8005\u4e8e\u822a\uff0c\u4ed6\u66fe\u662f\u997f\u4e86\u4e48\u7684\u524d\u7aef\u8d1f\u8d23\u4eba\uff0c\u73b0\u5728\u662f PayPal \u7684\u9ad8\u7ea7\u8f6f\u4ef6\u5de5\u7a0b\u5e08\uff0c\u6280\u672f\u80fd\u529b\u5f3a\uff0c\u4e3a\u4eba\u53cb\u5584\uff0c\u6027\u683c\u6d3b\u6cfc\u3002\u901a\u8fc7 freeCodeCamp \u793e\u533a\uff0c**\u6211\u7ed3\u4ea4\u4e86\u66f4\u591a\u670b\u53cb\uff0c\u9010\u6e10\u6253\u5f00\u4e86\u4ea4\u9645\u5708**\u3002\u5927\u5bb6\u76f8\u8ddd\u751a\u8fdc\u4f46\u540c\u5728\u4e00\u4e2a\u5708\u5b50\uff0c\u540c\u5728\u4e00\u4e2a\u66f4\u5927\u7684\u793e\u533a\uff0c\u8ba4\u8bc6\u4e86\u4ed6\u4eec\uff0c\u6211\u53bb\u5230\u6bcf\u4e2a\u57ce\u5e02\u90fd\u4e0d\u4f1a\u611f\u5230\u964c\u751f\u3002\\r\\n\\r\\n\u56e0\u4e3a freeCodeCamp \u662f\u5f00\u6e90\u9879\u76ee\uff0c\u8fde\u7eed\u591a\u5e74\u90fd\u662f GitHub Top 1 \u7684\u9879\u76ee\uff0c\u6709\u51e0\u767e K \u7684 Star\uff0c\u6211\u4f1a\u6539 Bug\uff0c\u63d0\u4ea4 PR\uff0c**\u5f88\u6709\u6210\u5c31\u611f**\u3002\u901a\u8fc7 freeCodeCamp \u5e73\u53f0\uff0c\u6211\u4eec\u4e5f**\u5438\u5f15\u4e86\u5f88\u591a\u6280\u672f\u7231\u597d\u8005\uff0c\u5e2e\u52a9\u4ed6\u4eec\u4ece 0 \u5230 1 \u5b66\u4e60\u6280\u672f**\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4e5f**\u5f62\u6210\u4e86\u81ea\u5df1\u7684\u505a\u4e8b\u65b9\u5f0f**\uff0c\u4e0d\u7ba1\u662f\u6559\u4eba\u5b66\u4e60 Web \u8fd8\u662f\u5e26\u4eba On Boarding\uff0c\u90fd**\u6c89\u6dc0\u4e86\u4e00\u4e9b\u53ef\u6301\u7eed\u7684\u6307\u5bfc\u7ecf\u9a8c**\uff0c\u8fd9\u4e5f\u662f\u6211\u540e\u9762\u6562\u5e26\u5176\u4ed6\u4eba\u7684\u539f\u56e0\u3002\u5e26\u4ed6\u4eec\u4e0a\u5cb8\u540e\uff0c\u6211\u4f1a\u7ee7\u7eed\u5f15\u5bfc\u4ed6\u4eec\u53bb\u5e26\u66f4\u591a\u4eba\u3002\u8fd9\u662f\u4e00\u4e2a**\u826f\u6027\u5faa\u73af**\u7684\u8fc7\u7a0b\u3002\u867d\u7136\u505a\u8fd9\u4e9b\u4e8b\u60c5\u4ed8\u51fa\u4e86\u5f88\u591a\u65f6\u95f4\uff0c\u770b\u4f3c\u6ca1\u6709\u4efb\u4f55\u76f4\u63a5\u7684\u7269\u8d28\u6536\u76ca\uff0c\u4f46\u5374\u7ed9\u6211\u5e26\u6765\u4e86\u5f88\u591a\u7cbe\u795e\u4e0a\u7684\u6536\u76ca\u548c\u6f5c\u5728\u6536\u76ca\uff0c\u6bd4\u5982\u4e2a\u4eba\u5f71\u54cd\u529b\u6709\u6162\u6162\u5730\u63d0\u5347\uff0c\u6536\u83b7\u7684\u611f\u609f\u548c\u5f62\u6210\u7684\u505a\u4e8b\u65b9\u5f0f\u8fd8\u5728\u5f71\u54cd\u7740\u6211\u7684\u73b0\u5728\u548c\u672a\u6765\u3002\\r\\n\\r\\n\u5728\u5927\u5b66\u671f\u95f4\uff0c\u6211\u6301\u7eed\u53c2\u4e0e\u4e86\u5404\u79cd\u793e\u533a\u548c\u6280\u672f\u5206\u4eab\uff0c\u5b66\u4e60\u6280\u672f\uff0c\u5206\u4eab\u6280\u672f\uff0c\u5b9e\u8df5\u9879\u76ee\u3002\u56e0\u4e3a\u70ed\u7231\uff0c\u6211\u575a\u5b9a\u8d70\u5728 Web \u6280\u672f\u5b66\u4e60\u8fd9\u6761\u8def\u4e0a\uff0c\u540c\u65f6\u4e5f\u4e0d\u5fd8\u9f13\u52b1\u8eab\u8fb9\u7684\u670b\u53cb\u4e00\u8d77\u5b66\u4e60\u3002\u6211\u4eec\u4f1a\u5728\u5bbf\u820d\u3001\u5728\u5b66\u6821\u673a\u623f\u4e3e\u529e\u8ba1\u7b97\u673a\u76f8\u5173\u7684\u6d3b\u52a8\uff0c\u4e00\u8d77\u505a\u9879\u76ee\uff0c\u4e5f\u4f1a\u53bb\u5176\u4ed6\u57ce\u5e02\u7684\u5b66\u6821\u7ed9\u540c\u5b66\u4eec\u505a\u5206\u4eab\u3002\u51e0\u5e74\u4e0b\u6765\uff0c\u6211\u79ef\u6512\u4e86\u5f88\u591a\u9879\u76ee\u7ecf\u9a8c\uff0c\u62d3\u5c55\u4e86\u6280\u672f\u6808\uff0c\u4f46\u662f\u6211\u53d1\u73b0\u91cd\u590d\u505a\u5916\u5305\u9879\u76ee\u867d\u7136\u53ef\u4ee5\u5e26\u6765\u6682\u65f6\u6027\u6536\u5165\uff0c\u4f46\u4e0d\u5229\u4e8e\u4e2a\u4eba\u6280\u672f\u7684\u6210\u957f\u3002\u6211\u610f\u8bc6\u5230\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u5f00\u6e90\u5e93\u4ee3\u7801\u8d28\u91cf\u9ad8\uff0c\u534f\u4f5c\u6d41\u7a0b\u89c4\u8303\uff0c\u6211\u4fbf\u5f00\u59cb\u5b66\u4e60\u5f00\u6e90\u9879\u76ee\u7684\u4ee3\u7801\uff0c\u5173\u6ce8\u5f00\u6e90\u793e\u533a\u7684\u52a8\u6001\u3002\u6bd5\u4e1a\u540e\uff0c\u6211\u63a5\u89e6\u5230\u4e86 APISIX \u5f00\u6e90\u9879\u76ee\uff0c\u6211\u5c31\u53c2\u4e0e\u8fdb\u6765\u4e86\u3002\\r\\n\\r\\n![Zhiyuan\'s Resume Written in 2018](https://static.apiseven.com/202108/1651202016764-e461af74-7aca-466d-8824-e823195fc24f.png)\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u5728 [Trillions and Trillions Served](https://www.youtube.com/watch?v=JUt2nb0mgwg) \u89c6\u9891\u91cc\uff0cApache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u521b\u59cb\u6210\u5458 Jim Jagielski \u5728\u5206\u4eab\u201c\u4ec0\u4e48\u662f\u5f00\u6e90\u201d\u65f6\u63d0\u5230\uff0c\u201c\u4e8e\u6211\u800c\u8a00\uff0c\u53c2\u4e0e\u5f00\u6e90\u662f\u51fa\u4e8e\u5bf9\u53e4\u8001\u7684\u9ed1\u5ba2\u6587\u5316\u7684\u8ba4\u540c\u3002\u5f00\u53d1\u8005\u3001\u8d21\u732e\u8005\u90fd\u662f\u827a\u672f\u5bb6\u3002\u5728\u6211\u770b\u6765\uff0c\u6240\u6709\u7684\u827a\u672f\u5bb6\u90fd\u4e50\u4e8e\u5206\u4eab\u6210\u679c\uff0c\u559c\u4e8e\u548c\u5fd7\u540c\u9053\u5408\u7684\u4eba\u534f\u4f5c\uff0c\u4e13\u6ce8\u4e8e\u78e8\u7ec3\u6280\u80fd\u3002\u201d\u4f60\u521d\u9ad8\u4e2d\u63a5\u89e6\u5230\u9ed1\u5ba2\u7fa4\u4f53\uff0c\u5927\u5b66\u63a5\u89e6\u5230\u5f00\u6e90\u793e\u533a\uff0c\u4f60\u5982\u4f55\u7406\u89e3\u9ed1\u5ba2\u7cbe\u795e\u3001\u5f00\u6e90\u7cbe\u795e\uff1f\u5728\u4f60\u770b\u6765\uff0c\u9ed1\u5ba2\u6587\u5316\u548c\u5f00\u6e90\u6587\u5316\u4e4b\u95f4\u6709\u4f55\u627f\u7ee7\u5173\u7cfb\u6216\u6709\u4f55\u6e0a\u6e90\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u5728\u6211\u770b\u6765\uff0c\u771f\u6b63\u7684\u9ed1\u5ba2\u4e0d\u662f\u5e26\u6709\u8d2c\u4e49\u8272\u5f69\u7684\u201c\u9a87\u5ba2\u201d\uff0c\u4e0d\u4f1a\u6000\u63e3\u7740\u6076\u610f\u53bb\u7834\u574f\u6216\u4fb5\u5165\u522b\u4eba\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\u3002**\u771f\u6b63\u7684\u9ed1\u5ba2\u662f\u4e00\u7fa4\u6562\u60f3\u6562\u505a\u7684\u6781\u5ba2\uff0c\u4ed6\u4eec\u4fe1\u5949\u81ea\u7531\u4e3b\u4e49\uff0c\u4e0d\u88ab\u6761\u6761\u6846\u6846\u675f\u7f1a\uff0c\u4ed6\u4eec\u6240\u505a\u7684\u4e00\u5207\u53ea\u662f\u56e0\u4e3a\u70ed\u7231\uff0c\u56e0\u4e3a\u5bf9\u771f\u7406\u7684\u4e0d\u61c8\u8ffd\u6c42**\u3002\u6211\u81ea\u8ba4\u4e3a\u6211\u662f\u4e2a\u5178\u578b\u7684\u6781\u5ba2\uff0c\u9047\u5230\u95ee\u9898\u5219\u89e3\u51b3\u95ee\u9898\uff0c\u89c1\u62db\u62c6\u62db\u3002\\r\\n\\r\\n\u81f3\u4e8e\u9ed1\u5ba2\u548c\u5f00\u6e90\u7684\u6e0a\u6e90\uff0c\u6211\u89c9\u5f97\u4e50\u4e8e\u5206\u4eab\u3001\u8ffd\u9010\u6781\u81f4\u7684\u7cbe\u795e\u5728\u9ed1\u5ba2\u548c\u5f00\u6e90\u8d21\u732e\u8005\u8eab\u4e0a\u5b9e\u73b0\u4e86\u5b8c\u7f8e\u7684\u878d\u5408\u3002\u5178\u578b\u7684\u4ee3\u8868\u6709 Linux \u64cd\u4f5c\u7cfb\u7edf\u548c Git \u7248\u672c\u63a7\u5236\u7cfb\u7edf\u7684\u4f5c\u8005 **Linus Benedict Torvalds**\u3001\u524d\u7aef\u6280\u672f\u5927\u725b **TJ Holowaychuk**\u3001\u524d\u7aef\u6846\u67b6 Vue.js \u7684\u4f5c\u8005**\u5c24\u96e8\u6eaa**\u3002\\r\\n\\r\\nLinus \u7684\u6781\u5ba2\u8868\u73b0\u5728\u4ed6\u4f1a\u628a\u81ea\u5df1\u7684\u60f3\u6cd5\u4ed8\u8bf8\u5b9e\u73b0\uff0c\u8fd8\u4f1a\u628a\u6210\u679c\u5f00\u6e90\u51fa\u6765\u3002\u4ed6\u505a Git \u7684\u521d\u8877\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a\u4ee3\u7801\u5728\u4e0d\u65ad\u5730\u8fed\u4ee3\uff0c\u4ed6\u5e0c\u671b\u6709\u4e00\u79cd\u65b9\u5f0f\u80fd\u7ba1\u7406\u4ee3\u7801\uff0c\u505a\u7248\u672c\u7ba1\u7406\u3002\u5c3d\u7ba1 Git \u548c Linux \u5df2\u6709\u5e9e\u5927\u7684\u62e5\u8db8\uff0c\u88ab\u5168\u7403\u7528\u6237\u5e7f\u6cdb\u4f7f\u7528\uff0c\u521b\u9020\u4e86\u96be\u4ee5\u9884\u4f30\u7684\u4ef7\u503c\uff0c\u4f46 Linus \u6ca1\u6709\u501f\u6b64\u76c8\u5229\uff0c\u9879\u76ee\u4ecd\u5728\u5f00\u6e90\u3002\\r\\n\\r\\n\u7b2c\u4e8c\u4f4d\u540c\u65f6\u4f53\u73b0\u4e86\u9ed1\u5ba2\u7cbe\u795e\u548c\u5f00\u6e90\u7cbe\u795e\u7684\u6280\u672f\u5927\u725b\u662f TJ\u30022015 \u5e74\uff0c\u6211\u5f00\u59cb\u4e86\u89e3\u5230\u4ed6\uff0c\u4ed6\u5728\u524d\u7aef\u5708\u5b50\u91cc\u5f88\u706b\uff0c\u505a\u4e86\u5f88\u591a Node.js \u76f8\u5173\u7684\u5de5\u5177\uff0c2017 \u5e74\u5f00\u59cb\u5199\u504f\u540e\u7aef\u7684 Go \u8bed\u8a00\u3002Go \u662f\u6bd4\u8f83\u9002\u5408\u4e91\u539f\u751f\u65f6\u4ee3\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u6211\u5728 2019 \u5e74\u624d\u542c\u8bf4\u4e91\u539f\u751f\u7684\u6982\u5ff5\uff0c\u4f46\u4ed6\u5728 2017 \u5e74\u5c31\u5df2\u7ecf\u5f00\u59cb\u6363\u9f13\u8fd9\u4e9b\u4e1c\u897f\u4e86\uff0c\u800c\u4e14\u4ed6\u7684\u6280\u672f\u90fd\u662f\u81ea\u5b66\u7684\uff0c\u4ed6\u6700\u5f00\u59cb\u7684\u80cc\u666f\u662f\u4e00\u4f4d\u8bbe\u8ba1\u5e08\u3002\\r\\n\\r\\n\u7b2c\u4e09\u4f4d\u6781\u5ba2\u662f Vue.js \u7684\u4f5c\u8005\u5c24\u96e8\u6eaa\u3002\u4ed6\u539f\u672c\u662f Google \u7684\u8bbe\u8ba1\u5e08\uff0c\u6ca1\u6709\u5b66\u8fc7\u4ee3\u7801\u3002\u5199 Vue.js \u662f\u56e0\u4e3a\u4ed6\u627e\u4e0d\u5230\u4e00\u4e2a\u6bd4\u8f83\u7b80\u6d01\u7684\u524d\u7aef\u6846\u67b6\uff0c\u4e8e\u662f 2015 \u5e74\u6216\u8005\u66f4\u65e9\u4e00\u4e9b\uff0c\u4ed6\u5f00\u59cb\u521b\u9020\u81ea\u5df1\u7406\u60f3\u4e2d\u7684\u524d\u7aef\u6846\u67b6\u3002\u5f53\u65f6\u8fd9\u4e2a\u9879\u76ee\u53ea\u662f\u4e00\u4e2a\u5f88\u5c0f\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u6ca1\u6709\u4ec0\u4e48\u4eba\u6c14\uff0c\u4f46 2017 \u5e74\u524d\u540e\uff0c\u4e00\u8dc3\u6210\u4e3a\u5168\u7403 Top 3 \u7684\u5f00\u6e90\u6846\u67b6\u3002\u4ed6\u4ece\u8bbe\u8ba1\u5e08\u8f6c\u53d8\u4e3a\u524d\u7aef\u5de5\u7a0b\u5e08\uff0c\u518d\u5230\u72ec\u7acb\u5f00\u6e90\u5f00\u53d1\u8005\uff0c\u5728\u5f00\u6e90\u6846\u67b6\u4e2d\u878d\u5165\u4e86\u4ed6\u7ec6\u817b\u7684\u8bbe\u8ba1\u7406\u5ff5\u3001\u827a\u672f\u7406\u5ff5\uff0c\u6700\u7ec8\u8d21\u732e\u4e86\u4e00\u4e2a\u5c0f\u800c\u7f8e\u3001\u9ad8\u6548\u597d\u7528\u7684\u5f00\u6e90\u9879\u76ee\u3002Vue.js \u7684\u6587\u6863\u7b49\u914d\u5957\u5468\u8fb9\u4e5f\u975e\u5e38\u53cb\u597d\uff0c\u793e\u533a\u4e5f\u5f88\u6d3b\u8dc3\uff0c\u5b8c\u5168\u662f\u9760\u793e\u533a\u9a71\u52a8\u3002  \\r\\n\\r\\n\u5176\u5b9e**\u6bcf\u4e2a\u5f00\u6e90\u9879\u76ee\u7684\u80cc\u540e\u662f\u4e00\u4e2a\u5f00\u6e90\u793e\u533a\uff0c\u5f00\u6e90\u7cbe\u795e\u5728\u4e8e\u6211\u4eec\u60f3\u5b9e\u73b0\u81ea\u5df1\u7684\u60f3\u6cd5\uff0c\u628a\u5b83\u505a\u51fa\u6765\uff0c\u516c\u5f00\u51fa\u6765\uff0c\u9080\u8bf7\u66f4\u591a\u7684\u4eba\u53c2\u4e0e\u8fdb\u6765**\u3002\u5728 GitHub \u4e0a\u6709\u5f88\u591a\u50cf\u5c24\u96e8\u6eaa\u4e00\u6837\u7684\u72ec\u7acb\u5f00\u53d1\u8005\uff0c\u4ed6\u4eec\u6709\u4e86\u4e00\u4e2a\u597d\u7684\u60f3\u6cd5\uff0c\u4f1a\u628a\u5b83\u505a\u51fa\u6765\uff0c\u5f00\u6e90\u51fa\u6765\uff0cStar \u6570\u591a\u4e86\uff0c\u5173\u6ce8\u7684\u4eba\u591a\u4e86\uff0c\u4e2a\u4eba\u7684\u5f71\u54cd\u529b\u81ea\u7136\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u5927\u3002\\r\\n\\r\\n\u5173\u4e8e\u9ed1\u5ba2\u6587\u5316\uff0c\u6211\u8fd8\u60f3\u7ed9\u5927\u5bb6\u63a8\u8350\u4e00\u672c\u4e66\u2014\u2014**\u300a\u9ed1\u5ba2\u4e0e\u753b\u5bb6\u300b**\u3002\u300a\u9ed1\u5ba2\u4e0e\u753b\u5bb6\u300b\u7684\u82f1\u6587\u7248\u51fa\u7248\u4e8e 2004 \u5e74\uff0c\u5341\u5e74\u540e\uff0c\u7531\u962e\u4e00\u5cf0\u8001\u5e08\u7ffb\u8bd1\u6210\u4e2d\u6587\uff0c\u4e8e 2013 \u5e74\u51fa\u7248\uff0c\u800c\u540e\u518d\u7248\u3002\u4e2d\u6587\u7248\u4e00\u7ecf\u4e0a\u5e02\uff0c\u5373\u5728\u56fd\u5185 IT \u4e1a\u754c\u3001\u5b66\u754c\u5f15\u8d77\u4e86\u5de8\u5927\u7684\u53cd\u54cd\uff0c\u5f97\u5230\u4e86\u5e7f\u6cdb\u7684\u80af\u5b9a\u3002\u8fd9\u672c\u4e66\u662f\u7845\u8c37\u521b\u4e1a\u4e4b\u7236 Paul Graham \u7684\u6587\u96c6\uff0c\u4e3b\u8981\u8ba8\u8bba\u4e86\u9ed1\u5ba2\u6587\u5316\u3001\u9ed1\u5ba2\u6210\u957f\u3001\u9ed1\u5ba2\u5bf9\u4e16\u754c\u7684\u8d21\u732e\u3001\u9ed1\u5ba2\u7684\u5de5\u4f5c\u65b9\u6cd5\u7b49\u8bdd\u9898\u3002  \\r\\n\\r\\n\u962e\u4e00\u5cf0\u8001\u5e08\u5728\u518d\u7248\u5e8f\u8a00\u4e2d\u5199\u9053\uff0c\u201c\u5728\u6211\u770b\u6765\uff0c\u300a\u9ed1\u5ba2\u4e0e\u753b\u5bb6\u300b\u80fd\u5438\u5f15 10 \u5e74\u540e\u7684\u8bfb\u8005\uff0c\u4e3b\u8981\u6709\u4e24\u5927\u539f\u56e0\uff1a\u7b2c\u4e00\uff0c**\u4ed6\u5199\u7684\u4e0d\u662f\u6280\u672f\uff0c\u800c\u662f\u6280\u672f\u80cc\u540e\u7684\u601d\u60f3**\u3002\u5c31\u50cf\u6570\u5b66\u4e00\u6837\uff0c\u6b63\u786e\u7684\u601d\u60f3\u4e0d\u4f1a\u8fc7\u65f6\u3002\u7b2c\u4e8c\uff0c**\u4ed6\u7684\u7740\u773c\u70b9\u662f\u957f\u8fdc\u7684\u672a\u6765**\uff0c\u4e0d\u662f\u5206\u6790\u73b0\u72b6\uff0c\u66f4\u4e0d\u662f\u603b\u7ed3\u8fc7\u53bb\uff0c\u800c\u662f\u5c55\u671b\u672a\u6765\uff0c\u4ee5\u672a\u6765\u6307\u5bfc\u73b0\u5728\u3002\u6bd4\u5982\u7b2c 11 \u7ae0\u300a\u4e00\u767e\u5e74\u540e\u7684\u7f16\u7a0b\u8bed\u8a00\u300b\u5c31\u662f\u7814\u7a76\u4e00\u767e\u5e74\u540e\u4eba\u4eec\u4f1a\u600e\u4e48\u7f16\u7a0b\uff0c\u4ece\u800c\u63a8\u5bfc\u51fa\u6211\u4eec\u73b0\u5728\u5e94\u8be5\u5982\u4f55\u7f16\u7a0b\u3002\u201d\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a2019 \u5e74 7 \u6708\u5f00\u59cb\u4e3a APISIX \u5f00\u6e90\u9879\u76ee\u505a\u8d21\u732e\uff0c\u540c\u5e74 10 \u6708 APISIX \u8fdb\u5165 Apache \u5b75\u5316\u5668\u3002\u9879\u76ee\u6bd5\u4e1a\u540e\uff0c\u4f60\u6210\u4e3a\u4e86 Apache APISIX PMC \u6210\u5458\u3002\u4e00\u8def\u8d70\u6765\uff0c\u4f60\u662f\u5982\u4f55\u8ba9\u81ea\u5df1\u5feb\u901f\u63d0\u5347\uff1f\u505a\u4e86\u54ea\u4e9b\u5c1d\u8bd5\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u6bd5\u4e1a\u540e\uff0c\u6211\u5173\u6ce8\u5230 APISIX \u5f00\u6e90\u9879\u76ee\u3002\u56e0\u4e3a\u5b83\u662f\u4e00\u4e2a\u7eaf\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u800c\u4e14\u662f\u4e00\u4e2a\u7eaf\u670d\u52a1\u7aef\u7684\u5e94\u7528\uff0c\u6211\u89c9\u5f97\u5f88\u9177\u5f88\u6709\u8da3\uff0c\u5c31\u53c2\u4e0e\u8fdb\u6765\u4e86\u3002APISIX \u521a\u5f00\u6e90\u65f6\u8fd8\u6ca1\u6709\u6350\u7ed9\u57fa\u91d1\u4f1a\uff0c\u6e29\u94ed\u8054\u7cfb\u5230\u6211\uff0c\u95ee\u6211\u80fd\u4e0d\u80fd\u5e2e APISIX \u505a\u4e00\u4e2a Dashboard \u63a7\u5236\u53f0\u3002\u5176\u5b9e\u6211\u4e0d\u592a\u4e86\u89e3\u8fd9\u65b9\u9762\uff0c\u4f46\u53c8\u60f3\u5c1d\u8bd5\uff0c\u4e8e\u662f\u5c31\u505a\u4e86\u7b2c\u4e00\u4e2a\u7248\u672c\u3002\u7b2c\u4e00\u4e2a\u7248\u672c\u6bd4\u8f83\u7c97\u7cd9\uff0c\u4f46\u5177\u5907 Apache APISIX \u7684\u6838\u5fc3\u80fd\u529b\u3002\\r\\n\\r\\n![Apache APISIX Dashboard V1.0](https://static.apiseven.com/202108/1651198249692-cb1180ee-b23d-4b40-86a8-ccae475534f8.png)\\r\\n\\r\\n\u540e\u6765\u8fd9\u4e2a\u9879\u76ee\u6350\u7ed9\u4e86 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u3002\u56e0\u4e3a\u6211\u53c2\u4e0e\u9879\u76ee\u6bd4\u8f83\u65e9\uff0c\u9879\u76ee\u6350\u7ed9\u57fa\u91d1\u4f1a\u540e\u8fd8\u5728\u5b75\u5316\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u6700\u65e9\u7684\u8fd9\u6279\u4eba\u5c31\u76f4\u63a5\u9009\u5165\u4e86 PPMC\uff08Podling Project Management Committee\uff0c\u5305\u62ec ASF Mentors \u548c Initial Committers\uff0cPodling \u6307\u5b75\u5316\u4e2d\uff09\uff0c\u6709\u4e86 Apache ID\uff0c\u975e\u5e38\u9177\u3002\u9879\u76ee\u6bd5\u4e1a\u540e\uff0c\u6211\u4eec\u5c31\u6210\u4e86 PMC\u3002\\r\\n\\r\\nPMC \u662f\u9879\u76ee\u7ba1\u7406\u59d4\u5458\u4f1a\uff0c\u5e26\u6709\u7ba1\u7406\u5c5e\u6027\uff0c\u9700\u8981\u4e3a\u9879\u76ee\u548c\u793e\u533a\u7684\u73b0\u5728\u548c\u672a\u6765\u8d1f\u8d23\uff0c\u5982\u679c\u4e0d\u5408\u683c\uff0c\u53ef\u80fd\u4f1a\u88ab\u6295\u7968\u53d6\u6d88\u8d44\u683c\u3002\u4f5c\u4e3a PMC \u6210\u5458\uff0c\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u8d23\u4efb\u5c31\u662f\u8981\u4e3a\u9879\u76ee\u548c\u793e\u533a\u5bfb\u627e\u66f4\u591a\u4f18\u79c0\u7684 Committer\uff0c\u4e3a\u9879\u76ee\u548c\u793e\u533a\u6ce8\u5165\u4e2d\u575a\u529b\u91cf\u548c\u751f\u547d\u529b\u3002\u5728 Committer \u7684\u8d44\u683c\u8981\u6c42\u4e0a\uff0cASF \u7684\u5b98\u65b9\u6587\u6863\u63d0\u5230**\u5f53\u6709 PMC \u4e3a\u8d21\u732e\u8005\u63d0\u540d\u65f6\uff0c\u5982\u679c\u6295\u8d5e\u540c\u7968\u7684 PMC \u6210\u5458\u4eba\u6570\u5927\u4e8e\u6295\u53cd\u5bf9\u7968\u7684 PMC \u6210\u5458\u4eba\u6570\uff0c\u5219\u8be5\u8d21\u732e\u8005\u53ef\u9009\u4e3a Committer**\u3002\u9009\u4e3a Committer \u662f\u5bf9\u8d21\u732e\u8005\u8fc7\u53bb\u6240\u505a\u8d21\u732e\u7684\u8ba4\u53ef\uff0c\u4f46\u540c\u65f6\u6bcf\u4e2a\u793e\u533a\u4e5f\u671f\u671b Committer \u672a\u6765\u80fd\u4e3a\u9879\u76ee\u7684\u53d1\u5c55\u7ee7\u7eed\u6dfb\u7816\u52a0\u74e6\u3002\\r\\n\\r\\n\u5177\u4f53\u5230\u6bcf\u4e2a\u793e\u533a\uff0c\u5728\u8bc4\u9009 Committer \u65f6\uff0c\u53ea\u8981\u7b26\u5408 Apache \u57fa\u91d1\u4f1a\u7684\u6d41\u7a0b\uff0c\u6bcf\u4e2a\u793e\u533a\u53ef\u4ee5\u6839\u636e\u793e\u533a\u7684\u5b9e\u9645\u60c5\u51b5\u548c\u671f\u671b\uff0c\u91c7\u53d6\u4e0d\u540c\u7684\u5b9e\u8df5\u51c6\u5219\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u95e8\u69db\u3002\u5728 Apache APISIX \u793e\u533a\uff0c\u65e0\u8bba\u662f\u4ee3\u7801\u8d21\u732e\uff0c\u8fd8\u662f\u975e\u4ee3\u7801\u8d21\u732e\uff0c\u53ea\u8981\u6240\u505a\u7684\u8d21\u732e\u5f97\u5230 PMC \u6210\u5458\u548c\u793e\u533a\u7684\u8ba4\u53ef\uff0c\u5373\u53ef\u6210\u4e3a Apache APISIX \u793e\u533a\u7684 Committer\u3002\\r\\n\\r\\n\u4f5c\u4e3a Apache APISIX \u7684 PMC \u6210\u5458\uff0c\u6211\u6709\u8d23\u4efb\u4e3a Apache APISIX \u793e\u533a\u5bfb\u627e\u4f18\u79c0\u7684 Committer\u3002\u5728\u53c2\u4e0e\u793e\u533a\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5929\u7136\u7684\u540c\u7406\u5fc3\u4e5f\u4f1a\u5f15\u5bfc\u6211\u5173\u6ce8\u793e\u533a\u4e2d\u7684\u6bcf\u4e00\u4e2a\u4eba\uff0c\u4e3b\u52a8\u53c2\u4e0e\u8fdb\u53bb\u3001\u521b\u9020\u6545\u4e8b\u3001\u4f20\u64ad\u6545\u4e8b\u3002\u867d\u7136\u5927\u90e8\u5206\u8d21\u732e\u8005\u90fd\u6ca1\u6709\u89c1\u8fc7\uff0c\u4f46\u57fa\u4e8e TA \u7684\u534f\u4f5c\u65b9\u5f0f\u3001\u4ea4\u6d41\u5185\u5bb9\u3001\u4ea4\u6d41\u65b9\u5f0f\uff0c\u6211\u80fd\u611f\u89c9\u5230 TA \u5bf9\u8fd9\u4e2a\u4e8b\u60c5\u7684\u7406\u89e3\u6709\u591a\u6df1\u3002\u5c31\u6211\u81ea\u5df1\u63d0\u540d Committer \u7684\u5b9e\u8df5\u800c\u8a00\uff0c\u5982\u679c\u6211\u8ba4\u4e3a\u67d0\u4f4d\u8d21\u732e\u8005\u505a\u4e86\u5f88\u591a\u8d21\u732e\uff0c\u6211\u4f1a\u4e3b\u52a8\u4e3a TA \u63d0\u540d\uff0c\u5728 PMC \u6210\u5458\u91cc\uff0c\u6211\u63d0\u540d\u7684 Committer \u53ef\u80fd\u6700\u591a\u3002\\r\\n\\r\\n\u5728 2020 \u5f00\u6e90\u4e4b\u590f\u7684\u6d3b\u52a8\u4e2d\uff0c\u6211\u8ba4\u8bc6\u4e86\u767d\u6cfd\u5e73\uff0c\u5f53\u65f6\u6211\u5728 GitHub \u4e0a\u653e\u4e86\u4e00\u4e2a Dashboard \u7684\u8bae\u9898\uff0c\u6cfd\u5e73\u7533\u8bf7\u4e86\u8fd9\u4e2a\u9879\u76ee\u3002\u4ed6\u6700\u5f00\u59cb\u8d21\u732e\u7684\u662f\u524d\u7aef\u4ee3\u7801\uff0c\u540e\u6765\u4ed6\u8fd8\u5199\u4e86 Go\uff0c\u5199\u4e86\u670d\u52a1\u7aef\uff0c\u7ed9 APISIX \u63d0\u4ea4\u4ee3\u7801\uff0c\u5199\u63d2\u4ef6\u3002\u5f53\u65f6\u4ed6\u8fd8\u5728\u8bfb\u5927\u4e09\uff0c\u6f5c\u529b\u975e\u5e38\u5927\uff0c\u6211\u5c31\u63d0\u540d\u4ed6\u4e3a Committer \u4e86\u3002\u540e\u9762\u6cfd\u5e73\u505a\u4e86\u8d8a\u6765\u8d8a\u591a\u7684\u8d21\u732e\uff0c\u5728\u793e\u533a\u3001QQ \u7fa4\u3001\u5fae\u4fe1\u7fa4\u7b54\u590d\u95ee\u9898\u4e5f\u975e\u5e38\u79ef\u6781\uff0c\u6240\u4ee5\u53bb\u5e74\u5e74\u5e95\uff0c\u6211\u53c8\u63d0\u540d\u4ed6\u4e3a PMC \u6210\u5458\uff0c\u4ed6\u6210\u4e3a\u4e86 Apache APISIX \u5e74\u7eaa\u6700\u5c0f\u7684 PMC Member\u3002\\r\\n\\r\\n\u53e6\u4e00\u4f4d\u5370\u8c61\u6bd4\u8f83\u6df1\u523b\u7684 Committer \u662f\u5218\u66e6\u5189\u30022020 \u5e74 7 \u6708\u5de6\u53f3\uff0c\u6211\u4eec\u5728 Dashboard \u7684\u9879\u76ee\u91cc\u8ba4\u8bc6\u3002\u66e6\u5189\u5728\u53c2\u4e0e Dashboard \u9879\u76ee\u65f6\u6709\u975e\u5e38\u597d\u7684\u8fdc\u7a0b\u534f\u4f5c\u4e60\u60ef\u3002\u5979\u4f1a\u5728 GitHub \u4e0a\u628a\u95ee\u9898\u80cc\u666f\u63cf\u8ff0\u5f97\u5f88\u6e05\u695a\uff0c\u903b\u8f91\u5f88\u6e05\u6670\uff0c\u5c3d\u7ba1\u7528\u82f1\u6587\u4ea4\u6d41\u5f88\u8270\u96be\uff0c\u5979\u8fd8\u662f\u4f1a\u5f88\u52aa\u529b\u5730\u53bb\u505a\u3002\u66e6\u5189\u4fee\u590d\u4e86\u5f88\u591a Bug\uff0c\u505a\u4e86\u5f88\u591a\u8d21\u732e\uff0c\u53d1\u8d77\u6216\u53c2\u4e0e\u7684\u8ba8\u8bba\u90fd\u5f88\u6709\u4ef7\u503c\uff0c\u6240\u4ee5\u6211\u5c31\u4e3a\u5979\u63d0\u540d Committer \u4e86\u3002\u540e\u6765\u5979\u4e3a APISIX \u793e\u533a\u5e26\u6765\u4e86\u66f4\u591a\u7684\u8d21\u732e\u8005\u548c Committer\uff0c\u5438\u5f15\u4e86\u66f4\u591a\u7684\u4eba\u52a0\u5165 APISIX \u793e\u533a\uff0c\u4e5f\u505a\u4e86\u66f4\u591a\u7684\u8d21\u732e\uff0c\u6211\u5c31\u5f00\u59cb\u4e3a\u5979\u63d0\u540d PMC \u6210\u5458\u3002\u5979\u662f\u6211\u4eec\u7684\u7b2c\u4e00\u4f4d\u5973\u6027 PMC \u6210\u5458\uff0c\u4e5f\u662f\u6211\u4eec\u73b0\u5728\u552f\u4e00\u7684\u5973\u6027 PMC \u6210\u5458\u3002\\r\\n\\r\\n\u9664\u4e86\u6cfd\u5e73\u548c\u66e6\u5189\uff0c\u793e\u533a\u91cc\u8fd8\u6709\u8bb8\u591a\u7ecf\u5386\u3001\u7ecf\u9a8c\u3001\u80cc\u666f\u5404\u4e0d\u76f8\u540c\u7684\u8d21\u732e\u8005\u3002\u5bf9\u793e\u533a\u800c\u8a00\uff0c\u6bcf\u4f4d\u8d21\u732e\u8005\u90fd\u5f88\u91cd\u8981\uff0c\u793e\u533a\u79bb\u4e0d\u5f00\u6bcf\u4f4d\u8d21\u732e\u8005\u7684\u652f\u6301\u3002\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1aApache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u5728\u5168\u7403\u53ea\u6709 850 \u591a\u4f4d\u6210\u5458\uff0c\u4f60\u89c9\u5f97\u4f60\u662f\u5728\u54ea\u65b9\u9762\u505a\u5f97\u6bd4\u8f83\u597d\uff0c\u6240\u4ee5\u5f97\u5230\u4e86\u8ba4\u53ef\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u9996\u5148\uff0c\u6e29\u94ed\u63d0\u540d\u6211\u4e3a Apache Member \u6709\u4ee5\u4e0b\u51e0\u70b9\u7406\u7531\uff1a\u7b2c\u4e00\uff0c\u6211\u662f Apache APISIX \u7684 PMC \u6210\u5458\uff0c\u5728 Apache APISIX \u793e\u533a\u6bd4\u8f83\u6d3b\u8dc3\u3002\u7b2c\u4e8c\uff0c\u6211\u66fe\u4e24\u6b21\u4ee5\u5bfc\u5e08\u8eab\u4efd\u53c2\u52a0\u8c37\u6b4c\u7f16\u7a0b\u4e4b\u590f\u6d3b\u52a8\uff0c\u540c\u65f6\u4e5f\u662f 2021 \u5f00\u6e90\u4e4b\u590f\u7684\u5bfc\u5e08\uff0c\u5e2e\u52a9\u8fc7\u5f88\u591a\u5927\u5b66\u751f\u53c2\u4e0e Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u5f00\u6e90\u9879\u76ee\u3002\u7b2c\u4e09\uff0c\u9664\u4e86\u5728 Apache APISIX \u793e\u533a\u6bd4\u8f83\u6d3b\u8dc3\uff0c\u6211\u5728 Apache Community \u90ae\u4ef6\u5217\u8868\u91cc\u4e5f\u5f88\u6d3b\u8dc3\uff0c\u4f1a\u79ef\u6781\u53c2\u4e0e\u8ba8\u8bba\uff0c\u63d0\u4f9b\u6211\u529b\u6240\u80fd\u53ca\u7684\u5e2e\u52a9\u3002\u7b2c\u56db\uff0c\u9664\u4e86\u5173\u6ce8\u5f00\u6e90\u9879\u76ee\uff0c\u6211\u4e5f\u4f1a\u53c2\u52a0\u64ad\u5ba2\u7684\u5f55\u5236\u548c\u5927\u4f1a\u7684\u5206\u4eab\uff0c\u505a\u4e00\u4e9b\u5f00\u6e90\u5e03\u9053\uff0c\u8ba9\u66f4\u591a\u4eba\u4e86\u89e3 Apache \u7684\u6587\u5316\u3002\\r\\n\\r\\n\u8fd9\u662f\u6e29\u94ed\u63d0\u540d\u6211\u4e3a Member \u7684\u51e0\u70b9\u7406\u7531\uff0c\u5c31\u6211\u81ea\u5df1\u770b\u6765\uff0c\u6211\u53ef\u80fd\u5728\u8fd9\u4e24\u65b9\u9762\u505a\u5f97\u8fd8\u53ef\u4ee5\u3002\u9996\u5148\uff0c\u793e\u533a\u7531\u4eba\u6784\u6210\uff0c\u9664\u4e86\u4ee3\u7801\uff0c\u8fd8\u9700\u8981\u548c\u4eba\u6253\u4ea4\u9053\u3002\u5728\u548c\u793e\u533a\u5c0f\u4f19\u4f34\u7684\u6c9f\u901a\u534f\u4f5c\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4f1a\u6bd4\u8f83\u53cb\u597d\uff0c\u4e50\u4e8e\u652f\u6301\u548c\u9f13\u52b1\u5927\u5bb6\u3002\u60f3\u8d77\u4e4b\u524d\u6709\u4e2a\u5f88\u5076\u7136\u7684\u673a\u4f1a\uff0c\u6211\u7ed3\u8bc6\u4e86\u4e00\u4f4d\u5370\u5ea6\u5c0f\u54e5 Ayush Das\uff0c\u5e76\u9f13\u52b1\u4ed6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u548c Summer 2021 \u6d3b\u52a8\u3002\u5728\u548c\u4ed6\u6570\u6708\u7684\u6c9f\u901a\u8fc7\u7a0b\u4e2d\uff0c\u4ed6\u5728\u4e0d\u505c\u5730\u5b66\u4e60\u65b0\u6280\u672f\uff0c\u5e2e\u52a9\u793e\u533a\u89e3\u51b3\u95ee\u9898\uff0c\u4f46\u7531\u4e8e\u8bbe\u5907\u8fc7\u4e8e\u8001\u65e7\uff0c\u4e0d\u5f97\u4e0d\u9891\u7e41\u91cd\u542f\uff0c\u4ed6\u7684\u5f00\u53d1\u73af\u5883\u53d7\u5230\u4e86\u5f88\u5927\u5f71\u54cd\u3002\u5728\u548c\u4ed6\u591a\u6b21\u6c9f\u901a\u548c\u4e86\u89e3\u60c5\u51b5\u540e\uff0c\u6211\u51b3\u5b9a\u8d5e\u52a9\u4ed6\u4e00\u53f0 MacBook Pro M1\uff0c\u5e0c\u671b\u8fd9\u53f0\u8bbe\u5907\u80fd\u591f\u5e2e\u52a9\u4ed6\u66f4\u6709\u6548\u7387\u5730\u5b66\u4e60\u3002\\r\\n\\r\\n![Ayush Das\'s Greeting to Zhiyuan on Happy Teacher\'s Day](https://static.apiseven.com/202108/1651198269797-6a64d882-5453-41df-bc83-7ef885537348.png)\\r\\n\\r\\n\u5176\u6b21\uff0c\u6211\u4f1a\u652f\u6301\u5e76\u9f13\u52b1\u5927\u5bb6\u5728\u793e\u533a\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\uff0c\u65e0\u8bba\u4e8b\u60c5\u5bf9\u9519\uff0cTA \u53ea\u8981\u613f\u610f\u63d0\u51fa\u6765\uff0c\u613f\u610f\u7ad9\u51fa\u6765\uff0c\u90fd\u662f\u4e00\u4ef6\u597d\u4e8b\u3002\u4f5c\u4e3a Apache APISIX \u7684 PMC \u6210\u5458\uff0c\u6211\u4f1a\u59cb\u7ec8\u575a\u6301 Apache \u7684\u7406\u5ff5\u548c\u539f\u5219\uff0c\u575a\u6301 **The Apache Way** \u548c\u6211\u4eec\u5e38\u8bf4\u7684 **Community Over Code**\uff0c\u5c06\u5176\u878d\u5165\u5230\u793e\u533a\u6cbb\u7406\u5f53\u4e2d\u3002\u6211\u4eec\u6709\u516c\u5f00\u7684 Dev \u90ae\u4ef6\u5217\u8868\uff0c\u4e5f\u6709 Private \u79c1\u4eba\u90ae\u4ef6\u5217\u8868\u3002\u5728\u4ec5\u6709 PMC \u6210\u5458\u7684\u79c1\u4eba\u90ae\u4ef6\u5217\u8868\u91cc\uff0c\u6211\u4eec\u5076\u5c14\u4f1a\u6709\u4e00\u4e9b\u4e89\u8bba\uff0c\u6bd4\u5982\u201c\u54ea\u4f4d\u8d21\u732e\u8005\u53ef\u4ee5\u6210\u4e3a Committer\u201d\u3001\u201c\u793e\u533a\u91cc\u7684\u95ee\u9898\u8981\u600e\u4e48\u89e3\u51b3\u201d\u3002\u5728\u8fd9\u4e9b\u573a\u5408\uff0c\u6709\u4e9b PMC \u6210\u5458\u4f1a\u9009\u62e9\u6c89\u9ed8\uff0c\u6709\u4e9b PMC \u6210\u5458\u4f1a\u79ef\u6781\u53c2\u4e0e\u8ba8\u8bba\uff0c\u800c\u6211\u5c31\u5c5e\u4e8e\u79ef\u6781\u7684\u8ba8\u8bba\u6d3e\u3002\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u5728\u5f00\u6e90\u8d21\u732e\u6216\u53c2\u4e0e\u5f00\u6e90\u793e\u533a\u65b9\u9762\uff0c\u540e\u7eed\u6709\u4ec0\u4e48\u8ba1\u5212\u5417\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u6211\u4f9d\u7136\u4f1a\u79ef\u6781\u53c2\u4e0e\u793e\u533a\u6d3b\u52a8\uff0c\u4e3a\u793e\u533a\u505a\u8d21\u732e\u3002\u8fd8\u8bb0\u5f97 2019 \u5e74\u5e74\u672b\u81f3 2020 \u5e74\u5e74\u521d\uff0cWeb \u9879\u76ee\u7684\u8d21\u732e\u8005\u5f88\u5c11\uff0c\u6211\u5c31\u9f13\u52b1\u6211\u8eab\u8fb9\u7684\u4eba\u53c2\u4e0e\u8fdb\u6765\uff0c\u8fd9\u4e2a\u9879\u76ee\u624d\u5f97\u4ee5\u4e3a\u7ee7\u3002\u73b0\u5728\u8fd9\u4e2a\u9879\u76ee\u53c8\u8fdb\u5165\u4e86\u4e00\u4e2a\u74f6\u9888\u671f\uff0c\u6240\u4ee5\u6211\u8fd8\u9700\u8981\u9f13\u52b1\u66f4\u591a\u7684\u5f00\u53d1\u8005\u53c2\u4e0e\u8fdb\u6765\u3002\\r\\n\\r\\n\u52a0\u5165 Apache APISIX \u793e\u533a\u540e\uff0c\u6211\u7684\u6ce8\u610f\u529b\u4e3b\u8981\u96c6\u4e2d\u5728\u8fd9\u4e00\u4e2a\u793e\u533a\u3002\u6210\u4e3a Apache Member \u540e\uff0c\u6211\u4f1a\u7ad9\u5728\u6574\u4e2a\u57fa\u91d1\u4f1a\u7684\u89d2\u5ea6\u601d\u8003\u95ee\u9898\uff0c\u4f1a\u627f\u62c5\u66f4\u591a\u7684\u8d23\u4efb\u3002\u4e0d\u4ec5\u5173\u6ce8\\r\\nApache APISIX \u8fd9\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u8fd8\u4f1a\u5173\u6ce8 ASF \u7684\u5176\u4ed6\u9879\u76ee\uff0c\u5305\u62ec\u5b75\u5316\u4e2d\u7684\u9879\u76ee\u548c\u5df2\u6bd5\u4e1a\u7684\u9879\u76ee\uff0c\u548c\u8bf8\u4f4d Apache Member \u4e00\u8d77\u4e3a\u5f00\u6e90\u5e03\u9053\uff0c\u4e3a\u9879\u76ee\u6ce8\u5165\u6d3b\u529b\uff0c\u63d0\u4f9b\u5e2e\u52a9\u548c\u6307\u5bfc\uff0c\u671f\u671b Apache \u57fa\u91d1\u4f1a\u5728\u672a\u6765\u65e0\u6570\u4e2a 20 \u5e74\u91cc\u4f9d\u65e7\u5e38\u9752\u3002\\r\\n\\r\\n## \u4e2a\u4eba\u751f\u6d3b\u4e0e\u6210\u957f\\r\\n\\r\\n![Zhiyuan Ju](https://static.apiseven.com/202108/1651198278354-f104ab0a-3939-42c3-b0a9-c2f91bdc3999.png)\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u6211\u770b\u4f60\u5728\u535a\u5ba2\u548c\u5206\u4eab\u4e2d\u6709\u63d0\u5230\uff0c\u81ea\u5df1\u70ed\u8877\u4e8e Web \u6280\u672f\uff0c\u6b63\u5728\u52aa\u529b\u6210\u4e3a\u4e00\u540d\u4f18\u79c0\u7684 Web \u5168\u6808\u5de5\u7a0b\u5e08\u3002\u8bf7\u95ee\u4f60\u5f53\u521d\u4e3a\u4ec0\u4e48\u4f1a\u9009\u62e9 Web \u524d\u7aef\u8fd9\u4e2a\u6280\u672f\u65b9\u5411\uff1f\u5728\u6210\u4e3a Web \u5168\u6808\u5de5\u7a0b\u5e08\u8fd9\u6761\u8def\u4e0a\uff0c\u73b0\u5728\u5904\u4e8e\u4ec0\u4e48\u9636\u6bb5\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u9ad8\u4e2d\u8bfe\u4f59\u65f6\u95f4\uff0c\u6211\u4e00\u76f4\u5728\u505a Web \u6e17\u900f\uff0c\u4e5f\u60f3\u505a Web \u5b89\u5168\u3002\u5bf9\u4e8e Web \u5b89\u5168\uff0c\u6211\u662f\u77e5\u5176\u7136\u800c\u4e0d\u77e5\u5176\u6240\u4ee5\u7136\uff0c\u6211\u4e0d\u77e5\u9053 Web \u670d\u52a1\u662f\u5982\u4f55\u642d\u5efa\u8d77\u6765\u7684\uff0c\u6240\u4ee5\u6211\u5f00\u59cb\u5b66\u4e60 Web \u7684\u6574\u5957\u7406\u8bba\u4f53\u7cfb\u548c\u8fd0\u4f5c\u539f\u7406\u3002\u5728 Web \u5b66\u4e60\u8fc7\u7a0b\u4e2d\uff0c\u6211\u7ecf\u5386\u4e86\u4e09\u4e2a\u9636\u6bb5\uff0c**\u4ece\u6700\u521d\u7684\u832b\u7136\u3001\u4e0d\u77e5\u6240\u63aa\u5230\u4ee5\u9879\u76ee\u9a71\u52a8\u3001\u52a8\u624b\u5b9e\u8df5\uff0c\u518d\u5230\u6700\u540e\u62e5\u62b1\u5f00\u6e90\u3001\u56de\u9988\u5f00\u6e90**\u3002\\r\\n\\r\\n\u5728\u7b2c\u4e00\u4e2a\u9636\u6bb5\uff0c\u5bf9\u4e8e\u9875\u9762\u6e32\u67d3\u3001\u9875\u9762\u8bbf\u95ee\u7684\u539f\u7406\u548c\u8fc7\u7a0b\uff0c\u6211**\u6beb\u65e0\u5934\u7eea**\u30022015 \u5e74\u9ad8\u8003\u7ed3\u675f\u540e\uff0c\u6211\u6709\u4e86\u7b2c\u4e00\u53f0 MacBook\uff0c\u4fbf\u5f00\u59cb\u901a\u8fc7\u641c\u7d22\u5f15\u64ce\u5b66\u4e60\u76f8\u5173\u6559\u7a0b\u3002\u5230\u4e86\u5927\u5b66\uff0c\u6211\u5f00\u59cb**\u4ee5\u9879\u76ee\u4e3a\u9a71\u52a8\uff0c\u52a8\u624b\u5b9e\u8df5\uff0c\u63d0\u5347\u6280\u672f\uff0c\u62d3\u5c55\u6280\u672f\u6808**\u3002\u6211\u63a5\u4e86\u5404\u79cd\u5404\u6837\u7684\u9879\u76ee\uff0c\u6216\u5355\u6253\u72ec\u6597\uff0c\u6216\u96c6\u56e2\u961f\u4e4b\u529b\u3002\u968f\u7740\u9879\u76ee\u8d8a\u6765\u8d8a\u591a\uff0c\u9700\u6c42\u53d8\u5f97\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u63a5\u89e6\u5230\u7684\u6280\u672f\u6808\u4e5f\u8d8a\u6765\u8d8a\u591a\u3002\u6211\u5728\u5927\u5b66\u63a5\u5230\u7684\u7b2c\u4e00\u4e2a\u9879\u76ee\u662f\u5168\u6808\u9879\u76ee\uff0c\u5e2e\u5b66\u751f\u5904\u5f00\u53d1\u4e00\u5957\u5185\u5bb9\u7ba1\u7406\u7cfb\u7edf\uff0c\u9700\u8981\u72ec\u7acb\u8d1f\u8d23\u9700\u6c42\u3001\u8bbe\u8ba1\u3001\u524d\u7aef\u3001\u670d\u52a1\u7aef\u3001\u6570\u636e\u5e93\u3002\u901a\u8fc7\u4e0d\u65ad\u5730\u5b66\u4e60\u3001\u5c1d\u8bd5\u3001\u8e29\u5751\uff0c\u6211\u6700\u7ec8\u5b8c\u6210\u4e86\u8fd9\u4e2a\u9879\u76ee\uff0c\u4e5f\u5b9e\u8df5\u4e86\u6240\u5b66\u5185\u5bb9\u3002\\r\\n\\r\\n\u5230\u4e86\u5927\u56db\uff0c\u6211**\u63a5\u89e6\u5230\u4e86\u5f00\u6e90\u9879\u76ee\uff0c\u5e76\u5f00\u59cb\u5173\u6ce8\u5f00\u6e90\u793e\u533a**\u3002\u56e0\u4e3a\u6211\u662f\u81ea\u5b66 Web \u6280\u672f\uff0c\u6240\u4ee5\u7ed5\u4e86\u8bb8\u591a\u5f2f\u8def\uff0c\u6ca1\u6709\u4f53\u7cfb\u5316\u5730\u5b66\u4e60 Web \u6280\u672f\u3002\u91cd\u590d\u505a\u5916\u5305\u9879\u76ee\u867d\u7136\u53ef\u4ee5\u5e26\u6765\u6682\u65f6\u6027\u7684\u6536\u5165\uff0c\u4f46\u4e0d\u5229\u4e8e\u4e2a\u4eba\u6280\u672f\u6210\u957f\u3002\u5076\u7136\u7684\u4e00\u6b21\u601d\u8003\uff0c\u8ba9\u6211\u610f\u8bc6\u5230\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u5230\u7684**\u5f00\u6e90\u5e93\u4ee3\u7801\u8d28\u91cf\u9ad8\u3001\u534f\u4f5c\u6d41\u7a0b\u89c4\u8303**\u3002\u56e0\u6b64\u6211\u6bc5\u7136\u628a\u5927\u90e8\u5206\u65f6\u95f4\u6295\u5165\u5230**\u5b66\u4e60\u5f00\u6e90\u9879\u76ee\u4ee3\u7801\u3001\u5173\u6ce8\u5f00\u6e90\u793e\u533a\u52a8\u6001\u4e2d**\u3002\\r\\n\\r\\n\u867d\u7136 Web \u5168\u6808\u6d89\u53ca\u524d\u7aef\u3001\u540e\u7aef\u3001\u9700\u6c42\u3001\u8bbe\u8ba1\u3001\u6d4b\u8bd5\u7b49\u5404\u79cd\u80fd\u529b\u548c\u6d3b\u52a8\uff0c\u4f46\u6ca1\u6709\u4e00\u4e2a\u5177\u4f53\u7684\u6307\u6807\u53ef\u4ee5\u8861\u91cf\u4e00\u4e2a\u4eba\u662f\u5426\u62e5\u6709\u5168\u6808\u80fd\u529b\u3002\u5c31\u5f53\u521d\u5b9a\u4e0b\u7684\u8fd9\u4e2a\u5c0f\u76ee\u6807\u800c\u8a00\uff0c\u6211\u89c9\u5f97\u6211\u5df2\u7ecf\u8fbe\u6210\u4e86\u3002\u81f3\u5c11\u9762\u5bf9\u4efb\u4f55\u9700\u6c42\uff0c\u6211\u4f1a\u8868\u73b0\u5f97\u66f4\u52a0\u4ece\u5bb9\u6de1\u5b9a\uff0c\u5185\u5fc3\u4f1a\u66f4\u52a0\u575a\u5b9a\uff0c\u81ea\u4fe1\u81ea\u5df1\u53ef\u4ee5\u57fa\u4e8e\u5df2\u6709\u7ecf\u9a8c\u505a\u524d\u540e\u7aef\u7684\u6280\u672f\u9009\u578b\uff0c\u53ef\u4ee5\u7ed9\u51fa\u6700\u7ec8\u7684\u65b9\u6848\u3002\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u963f\u91cc\u4e91\u521b\u59cb\u4eba\u738b\u575a\u535a\u58eb\u5728 ArchSummit \u5168\u7403\u67b6\u6784\u5e08\u5cf0\u4f1a\u4e0a\u63d0\u5230\uff0c\u201c\u53ea\u6709\u8fd9\u4e2a\u4e16\u754c\u7684\u6311\u6218\u79bb\u5e74\u8f7b\u4eba\u66f4\u8fd1\uff0c\u672a\u6765\u624d\u4f1a\u79bb\u6211\u4eec\u66f4\u8fd1\u3002\u201c\u4f60\u5982\u4f55\u7406\u89e3\u8fd9\u53e5\u8bdd\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u5f53\u65f6\u738b\u575a\u535a\u58eb\u8bf4\u5b8c\u8fd9\u53e5\u8bdd\u540e\uff0c\u6211\u7684\u7b2c\u4e00\u5370\u8c61\u662f\u6211\u8981\u7ee7\u7eed\u5e2e\u52a9\u66f4\u591a\u7684\u4eba\uff0c\u5e2e\u52a9\u66f4\u591a\u8eab\u8fb9\u7684\u4eba\u3002\u90a3\u65f6\uff0c\u6211\u5728 freeCodeCamp \u6bd4\u8f83\u6d3b\u8dc3\uff0c\u9664\u4e86\u7ebf\u4e0a\u9080\u8bf7\u4e16\u754c\u5404\u5730\u7684\u670b\u53cb\u5b66\u4e60\u7f16\u7a0b\uff0c\u4e5f\u4f1a\u5728\u5b66\u6821\u673a\u623f\u91cc\u4e3e\u529e\u4e00\u4e9b\u8ba1\u7b97\u673a\u6d3b\u52a8\uff0c\u5e26\u540c\u5b66\u3001\u5ba4\u53cb\u5b66\u4e60 Web \u6280\u672f\uff0c\u5176\u4e2d\u5c31\u6709\u6211\u9694\u58c1\u5bbf\u820d\u7684\u5927\u5b66\u540c\u5b66\u5b59\u6bc5\u3002\u6211\u4eec\u5728\u5927\u5b66\u505a\u4e86\u5f88\u591a\u9879\u76ee\uff0c\u540e\u6765\u4ed6\u4e5f\u662f\u52a0\u5165\u4e86 Apache APISIX \u793e\u533a\uff0c\u52a0\u5165\u4e86\u6211\u73b0\u5728\u7684\u516c\u53f8 API7.ai\u3002  \\r\\n\\r\\n\u8bb0\u5f97\u6709\u4e00\u6b21\uff0c\u6211\u548c\u5b59\u6bc5\u8fd8\u4e13\u95e8\u7ed9\u4e00\u6240\u6c5f\u82cf\u5b66\u6821\u7684\u51e0\u5343\u540d\u540c\u5b66\u5728\u7ebf\u8bb2\u8bfe\u3002\u8fd9\u4e2a\u6d3b\u52a8\u662f\u79d1\u5927\u8baf\u98de\u7ec4\u7ec7\u7684\uff0c\u5f53\u65f6\u8fd8\u6709\u70b9\u7d27\u5f20\uff0c\u6211\u4eec\u627e\u4e86\u4e2a\u9152\u5e97\uff0c\u7279\u610f\u51c6\u5907\u4e86\u5f88\u4e45\uff0c\u5206\u4eab\u4e86\u4e00\u4e2a\u591a\u5c0f\u65f6\u3002\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u53c2\u4e0e\u5f00\u6e90\u9879\u76ee\u5f80\u5f80\u662f\u8fdc\u7a0b\u5de5\u4f5c\uff0c\u4f60\u4e5f\u5f88\u65e9\u5c31\u5f00\u59cb\u8fdc\u7a0b\u5de5\u4f5c\u4e86\u3002\u4f60\u662f\u5982\u4f55\u770b\u5f85\u8fdc\u7a0b\u5de5\u4f5c\u548c\u81ea\u7531\u804c\u4e1a\u7684\u533a\u522b\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u5927\u4e8c\u65f6\uff0c\u6211\u5728\u60f3\u6bd5\u4e1a\u540e\u4e00\u5b9a\u8981\u4ece\u4e8b\u81ea\u7531\u804c\u4e1a\uff0c\u800c\u4e0d\u662f\u8fdc\u7a0b\u5de5\u4f5c\uff0c\u4f46\u5f53\u65f6\u6211\u6ca1\u6709\u641e\u6e05\u695a\u8fd9\u4e24\u8005\u7684\u533a\u522b\u3002\\r\\n\\r\\n2018 \u5e74\uff0c\u6211\u4ee5\u4ea4\u6362\u751f\u7684\u8eab\u4efd\u5728\u6cd5\u5170\u514b\u798f\u5f85\u4e86\u534a\u5e74\u3002\u5f53\u65f6\u6211\u6709\u4e86\u7b2c\u4e00\u4efd\u6b63\u5f0f\u7684\u8fdc\u7a0b\u5de5\u4f5c\uff0c\u6bcf\u4e2a\u6708\u4f1a\u6709\u4e00\u7b14\u6536\u5165\uff0c\u4f53\u9a8c\u975e\u5e38\u597d\u3002\u51fa\u56fd\u524d\uff0c\u5728\u5b66\u6821\u91cc\u63a5\u7684\u5404\u79cd\u9879\u76ee\u5176\u5b9e\u4e5f\u7b97\u8fdc\u7a0b\uff0c\u53cc\u65b9\u63d0\u524d\u7ea6\u5b9a\u597d deadline\uff0c\u5230\u70b9\u4ea4\u4ed8\u6210\u679c\uff0c\u5de5\u4f5c\u6bd4\u8f83\u81ea\u7531\u3002\u56de\u56fd\u540e\uff0c\u6211\u5728\u7f51\u6613\u5de5\u4f5c\u4e86\u4e00\u6bb5\u65f6\u95f4\uff0c\u79bb\u5f00\u540e\u53c8\u52a0\u5165\u4e86\u4e00\u5bb6\u7f8e\u56fd\u7684\u516c\u53f8\u2014\u2014Team 247\uff0c\u7ee7\u7eed\u8fdc\u7a0b\u529e\u516c\u3002 \u90a3\u662f\u6211\u7b2c\u4e00\u6b21\u5f3a\u70c8\u5730\u611f\u53d7\u5230 remote work \u548c freelancer \u7684\u533a\u522b\u3002Team 247 \u8981\u6c42\u6211\u4eec\u4fdd\u6301 Slack \u901a\u4fe1\uff0c\u8981\u54cd\u5e94\u5f97\u975e\u5e38\u53ca\u65f6\uff0c\u8fd9\u8ba9\u6211\u611f\u89c9\u4e0d\u592a\u81ea\u7531\uff0c\u6709\u70b9\u53d7\u9650\u5236\u3002\\r\\n\\r\\n\u540e\u6765\u6211\u6765\u5230\u4e86\u73b0\u5728\u7684\u8fd9\u5bb6\u516c\u53f8\uff0c\u5728\u8fdc\u7a0b\u534f\u4f5c\u65b9\u9762\u4f1a\u6709\u4e00\u4e9b\u8981\u6c42\u3002\u6700\u5f00\u59cb\u6211\u4f1a\u6bd4\u8f83\u62b5\u89e6\uff0c\u56e0\u4e3a\u6211\u6765\u516c\u53f8\u6bd4\u8f83\u65e9\uff0c\u521a\u5f00\u59cb\u89c4\u6a21\u6bd4\u8f83\u5c0f\uff0c\u6ca1\u6709\u8fd9\u4e48\u591a\u8981\u6c42\u3002\u4f46\u548c\u5927\u5bb6\u804a\u8fc7\u540e\uff0c\u6211\u6162\u6162\u7406\u89e3\u4e86\u516c\u53f8\u5728\u8fdc\u7a0b\u534f\u4f5c\u65b9\u9762\u7684\u8003\u8651\uff0c\u56e0\u4e3a\u56fd\u5185\u6574\u4e2a\u884c\u4e1a\u8fd8\u6ca1\u6709\u5f62\u6210\u4e00\u4e2a\u5f88\u597d\u7684\u8fdc\u7a0b\u529e\u516c\u73af\u5883\uff0c\u65e0\u8bba\u662f\u5de5\u7a0b\u5e08\u8fd8\u662f\u5176\u4ed6\u5c97\u4f4d\u7684\u540c\u5b66\uff0c\u8fd8\u6ca1\u6709\u517b\u6210\u5f88\u597d\u7684\u8fdc\u7a0b\u529e\u516c\u4e60\u60ef\uff0c\u6240\u4ee5\u516c\u53f8\u4f1a\u901a\u8fc7\u8fdc\u7a0b\u529e\u516c\u76f8\u5173\u8981\u6c42\u6765\u5e2e\u52a9\u5927\u5bb6\u517b\u6210\u826f\u597d\u7684\u8fdc\u7a0b\u534f\u4f5c\u4e60\u60ef\u3002\\r\\n\\r\\n\u5728\u4ee5\u5f80\u7684\u8fdc\u7a0b\u5de5\u4f5c\u7ecf\u5386\u4e2d\uff0c\u6211\u53d1\u73b0\u5927\u5bb6\u5728\u8fdc\u7a0b\u534f\u4f5c\u4e2d\u666e\u904d\u5b58\u5728\u4e24\u4e2a\u660e\u663e\u7684\u95ee\u9898\u3002\u7b2c\u4e00\u4e2a\u95ee\u9898\u662f**\u5927\u5bb6\u6f5c\u610f\u8bc6\u91cc\u4f1a\u88ab\u6761\u6761\u6846\u6846\u7ea6\u675f\uff0c\u4e0d\u6562\u95ee\uff0c\u4e0d\u6562\u8bf4**\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728\u8fdc\u7a0b\u534f\u4f5c\u65f6\uff0c\u5927\u5bb6\u53ef\u80fd\u4f1a\u6709\u8fd9\u4e9b\u60f3\u6cd5\u2014\u2014\u201c\u6211\u9700\u8981\u6280\u672f\u540c\u5b66\u7684\u5e2e\u52a9\uff0c\u4f46\u6211\u4e0d\u77e5\u9053\u5bf9\u65b9\u5fd9\u4e0d\u5fd9\uff0c\u6211 @TA \u5408\u4e0d\u5408\u9002\u201d\uff0c\u201c\u6211\u662f\u4e00\u4e2a\u5b9e\u4e60\u751f\uff0c\u6211 @TA \u5408\u4e0d\u5408\u9002\u201d\uff0c\u201c\u6211\u95ee\u7684\u95ee\u9898\u4f1a\u4e0d\u4f1a\u592a\u8822\u201d\u3002\u5176\u5b9e\u6211\u4eec\u4e0d\u7528\u987e\u8651\u8fd9\u4e48\u591a\uff0c\u53ea\u7ba1\u5927\u5927\u65b9\u65b9\u8bf7\u6559\uff0c\u6ca1\u4eba\u4f1a\u5728\u610f\u8fd9\u4e9b\u7ec6\u679d\u672b\u8282\u3002\u800c\u4e14\u5927\u90e8\u5206\u652f\u6301\u8fdc\u7a0b\u529e\u516c\u7684\u516c\u53f8\u90fd\u63d0\u5021\\"**Remote First**\\"\uff0c\u5728\u8fdc\u7a0b\u534f\u4f5c\u4e2d\uff0c\u6c9f\u901a\u5f88\u91cd\u8981\u3002\\r\\n\\r\\n\u7b2c\u4e8c\u4e2a\u95ee\u9898\u662f\u5927\u5bb6\u8fd8\u6ca1\u6709\u5b8c\u5168\u517b\u6210 **Document Anything \u7684\u4e60\u60ef**\u3002Document Anything \u662f\u5f88\u591a Remote First \u7684\u516c\u53f8\u666e\u904d\u63d0\u5021\u7684\u505a\u6cd5\uff0c\u8fd9\u4e5f\u662f\u6211\u5e26\u9886\u7684 Global Team \u628a\u4e8b\u9879\u5199\u8fdb\u90ae\u4ef6\u5217\u8868\u7684\u539f\u56e0\u3002\u4e00\u65b9\u9762\uff0c\u5982\u679c\u6709\u4eba\u5458\u53d8\u52a8\uff0c\u81f3\u5c11\u540e\u6765\u4eba\u53ef\u4ee5\u770b\u5230 Global Team \u4ece\u521a\u642d\u5efa\u5230\u73b0\u5728\u7684\u6574\u4e2a\u8fc7\u7a0b\uff0c\u4e86\u89e3\u5927\u5bb6\u505a\u8fc7\u4ec0\u4e48\u4e8b\u60c5\uff0c\u5f53\u524d\u5728\u505a\u4ec0\u4e48\u4e8b\u60c5\u548c\u5f53\u524d\u7684\u8fdb\u5c55\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u6bcf\u6b21\u90fd\u662f\u53e3\u5934\u4ea4\u6d41\uff0c\u6ca1\u6709\u6587\u5b57\u8bb0\u5f55\uff0c\u4f1a\u5bfc\u81f4\u4fe1\u606f\u6d41\u901a\u3001\u65b0\u4eba\u4e0a\u624b\u7684\u6210\u672c\u975e\u5e38\u9ad8\u3002\u6240\u4ee5\u5728\u65e5\u5e38\u5de5\u4f5c\u4e2d\uff0c\u5373\u4f7f\u662f\u9762\u5bf9\u9762\u6c9f\u901a\uff0c\u53ea\u8981\u4e0d\u662f\u79c1\u4e8b\uff0c\u6211\u90fd\u4f1a\u5728\u516c\u5f00\u6e20\u9053\u8868\u8fbe\uff0c\u8fd9\u6837\u65e2\u53ef\u4ee5\u6eaf\u6e90\uff0c\u4e5f\u53ef\u4ee5\u5c3d\u53ef\u80fd\u5730\u8986\u76d6\u5230\u66f4\u591a\u7684\u4eba\u3002\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u8fdc\u7a0b\u5de5\u4f5c\u9700\u8981\u5de5\u7a0b\u5e08\u6709\u8f83\u5f3a\u7684\u81ea\u6211\u9a71\u52a8\u529b\u3002\u5728\u8fdc\u7a0b\u5de5\u4f5c\u4e2d\uff0c\u4f60\u5982\u4f55\u4fdd\u6301\u81ea\u9a71\u529b\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u9996\u5148\uff0c\u6211\u4eec\u662f\u4e00\u4e2a\u521b\u4e1a\u516c\u53f8\uff0c\u6240\u4ee5\u4f1a\u6709\u5f88\u591a\u4e8b\u60c5\u8981\u505a\u3002\u5176\u6b21\uff0c\u6211\u65e9\u4e0a\u9192\u5f97\u6bd4\u8f83\u65e9\uff0c\u4e00\u822c 5 \u70b9\u5c31\u4f1a\u81ea\u7136\u9192\uff0c\u9192\u540e\u4fbf\u5f00\u59cb\u8ba1\u5212\u4e00\u5929\u7684\u5de5\u4f5c\u3002\u6211\u559c\u6b22\u6e05\u6668\u72ec\u5904\u7684\u51e0\u4e2a\u5c0f\u65f6\uff0c\u53ef\u4ee5\u5b89\u5b89\u9759\u9759\u5730\u505a\u5f88\u591a\u4e8b\u60c5\uff0c\u6548\u7387\u975e\u5e38\u9ad8\u3002\u5f80\u5f80\u5927\u5bb6\u5f00\u4f1a\u524d\uff0c\u6211\u5df2\u7ecf\u5904\u7406\u5b8c\u4e86\u4eca\u5929\u7684\u6240\u6709\u5de5\u4f5c\uff0c\u6240\u4ee5\u4e0b\u5348\u5076\u5c14\u4f1a\u770b\u770b\u4e66\uff0c\u7a0d\u5fae\u653e\u677e\u4e00\u4e0b\u3002\u4f46\u5927\u90e8\u5206\u65f6\u95f4\uff0c\u6211\u8fd8\u662f\u4f1a\u548c\u516c\u53f8\u7684\u540c\u4e8b\u4fdd\u6301\u540c\u6837\u7684\u8282\u594f\u3002\u65e2\u7136\u65e9\u4e0a\u5df2\u7ecf\u5fd9\u5b8c\u4e86\uff0c\u4e0b\u5348\u53ef\u4ee5\u518d\u591a\u505a\u4e00\u70b9\uff0c\u591a\u60f3\u4e00\u70b9\u3002\u56e0\u4e3a\u5bf9\u6211\u6765\u8bf4\uff0c\u4e8b\u60c5\u771f\u7684\u662f\u6c38\u8fdc\u505a\u4e0d\u5b8c\u3002\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u4f60\u5982\u4f55\u5e73\u8861\u5de5\u4f5c\u548c\u751f\u6d3b\uff1f\u8fdb\u884c\u4e24\u79cd\u6a21\u5f0f\u7684\u5207\u6362\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u5728\u5de5\u4f5c\u548c\u751f\u6d3b\u65b9\u9762\uff0c\u6211\u6b63\u5728\u9010\u6e10\u5e73\u8861\u5b83\u4eec\u7684\u5173\u7cfb\u3002\u4ece 2020 \u5e74\u5230\u73b0\u5728\uff0c\u6211\u5e73\u5747\u6bcf\u5929\u6709 13 \u4e2a\u5c0f\u65f6\u5728\u5de5\u4f5c\u3002\u4ece\u6211\u6765\u516c\u53f8\u7684\u7b2c\u4e00\u5929\uff0c\u6211\u5c31\u8bf4\u6211\u662f\u6765\u521b\u4e1a\u7684\uff0c\u6240\u4ee5\u6211\u4f1a\u6295\u5165\u975e\u5e38\u591a\u7684\u7cbe\u529b\u3002\u5728\u8fd9\u5341\u591a\u4e2a\u5c0f\u65f6\u91cc\uff0c\u6211\u7684\u6548\u7387\u4f1a\u975e\u5e38\u9ad8\uff0c\u56e0\u4e3a\u6211\u77e5\u9053\u6211\u8981\u505a\u4ec0\u4e48\uff0c\u6211\u8981\u4f18\u5148\u505a\u4ec0\u4e48\uff0c\u6211\u4e5f\u77e5\u9053\u8fd9\u4e2a\u95ee\u9898\u8be5\u600e\u4e48\u89e3\u51b3\u3002\\r\\n\\r\\n\u4ece 2020 \u5e74\u672b\uff0c\u6211\u5f00\u59cb\u505a\u516c\u53f8\u5185\u90e8\u7684\u4e00\u4e9b\u7ba1\u7406\u5de5\u4f5c\uff0c\u4eca\u5e74\u5f00\u59cb\u5e26\u9886\u6211\u4eec\u7684\u5168\u7403\u5316\u56e2\u961f\u3002\u867d\u7136\u6211\u4eec\u7684\u6d41\u7a0b\u5236\u5ea6\u8fd8\u5728\u4e0d\u65ad\u5b8c\u5584\uff0c\u4f46\u6574\u4e2a\u56e2\u961f\u8d70\u5728\u4e00\u4e2a\u6b63\u786e\u7684\u8f68\u9053\u4e0a\uff0c\u4ee5\u76ee\u6807\u4e3a\u5bfc\u5411\uff0c\u7528\u6570\u636e\u6765\u9a8c\u8bc1\uff0c\u534f\u4f5c\u6c9f\u901a\u8d8a\u6765\u8d8a\u987a\u7545\u3002\u6240\u4ee5\u5230\u4e86\u6708\u5e95\uff0c\u6211\u5e94\u8be5\u4e5f\u4f1a\u4f11\u606f\u4e00\u6bb5\u65f6\u95f4\uff0c\u6162\u4e0b\u6765\uff0c\u5145\u5145\u7535\u3002\\r\\n\\r\\n\u8fc7\u53bb\u4e24\u5e74\uff0c\u6211\u5728\u4e0d\u505c\u5730\u5904\u7406\u516c\u53f8\u5185\u90e8\u7684\u4e8b\u52a1\uff0c\u4ece\u8fd9\u4e2a\u6708\u5f00\u59cb\uff0c\u6211\u4f1a\u62a5\u540d\u53c2\u52a0\u6d3b\u52a8\uff0c\u505a\u66f4\u591a\u5bf9\u5916\u7684\u5206\u4eab\uff0c\u5206\u4eab Apache \u6587\u5316\u3001Apache APISIX \u5f00\u6e90\u9879\u76ee\u3001\u5f00\u6e90\u793e\u533a\u3002\\r\\n\\r\\n**Apache APISIX \u793e\u533a\uff1a\u9664\u4e86\u5de5\u4f5c\u4ee5\u5916\uff0c\u5e73\u65f6\u751f\u6d3b\u4e2d\u4f1a\u5173\u6ce8\u54ea\u4e9b\u9886\u57df\u7684\u4e1c\u897f\u5462\uff1f**\\r\\n\\r\\n**\u81f4\u8fdc**\uff1a\u6211\u628a\u5f53\u524d\u7684\u5de5\u4f5c\u770b\u6210\u4e00\u4e2a\u4e8b\u4e1a\uff0c\u4e5f\u662f\u4e00\u4e2a\u5174\u8da3\u7231\u597d\u3002\u800c\u4e14\u521b\u4e1a\u672c\u8eab\u5f88\u6709\u8da3\uff0c\u6211\u73b0\u5728\u8d1f\u8d23\u516c\u53f8\u7684 Global Team\uff0c\u56e2\u961f\u5185\u6709\u5f88\u591a\u5916\u56fd\u540c\u4e8b\u3002\\r\\n\\r\\n\u6211\u4e5f\u4f1a\u5173\u5fc3\u6559\u80b2\u516c\u76ca\uff0c\u6bd4\u5982\u53c2\u4e0e\u6216\u7ec4\u7ec7 freeCodeCamp \u7684\u6d3b\u52a8\uff0c\u9f13\u52b1\u5e76\u5e2e\u52a9\u8eab\u8fb9\u7684\u4eba\u5b66\u4e60\u8ba1\u7b97\u673a\u3001\u5b66\u4e60\u6280\u672f\u3002\u6211\u8ba4\u4e3a**\u81ea\u5df1\u6210\u957f\u7684\u524d\u63d0\u662f\u8eab\u8fb9\u7684\u4eba\u4e00\u8d77\u6210\u957f**\u3002\u80fd\u5e2e\u52a9\u4ed6\u4eec\u901a\u8fc7\u81ea\u5df1\u7684\u624b\u827a\u5b9e\u73b0\u81ea\u5df1\u7684\u60f3\u6cd5\uff0c\u8fd9\u662f\u4e00\u4ef6\u5f88\u9177\u7684\u4e8b\u60c5\u3002\u867d\u7136\u6211\u73b0\u5728\u4e2a\u4eba\u7cbe\u529b\u6709\u9650\uff0c\u4f46\u662f\u6211\u4f1a\u9f13\u52b1\u6211 Mentor \u8fc7\u7684\u540c\u5b66\u5e26\u65b0\u4eba\uff0c\u5e2e\u52a9\u65b0\u4eba\u5b66\u4e60 Web \u6280\u672f\u3002\\r\\n\\r\\n\u6709\u65f6\u6211\u4e5f\u5728\u60f3\uff0c\u5982\u679c\u6211\u4e0d\u5e72\u8fd9\u884c\uff0c\u6211\u4f1a\u505a\u4ec0\u4e48\u3002\u6211\u7684\u535a\u5ba2\u7b7e\u540d\u662f\u300c**\u7528\u9b54\u6cd5\u6253\u8d25\u9b54\u6cd5**\u300d\u3002\u6211\u89c9\u5f97\u5316\u5b66\u662f\u4e00\u79cd\u5f88\u795e\u5947\u7684\u4e1c\u897f\uff0c\u5c0f\u65f6\u5019\u53c2\u52a0\u8fc7\u5df4\u65af\u592b\u5c0f\u5c0f\u5316\u5b66\u5bb6\u6d3b\u52a8\uff0c\u77e5\u9053\u8457\u540d\u5316\u5de5\u4f01\u4e1a\u5df4\u65af\u592b\u5728\u7528\u5316\u5b66\u6539\u53d8\u751f\u6d3b\u3002\u6211\u5bf9\u81ea\u7136\u3001\u751f\u7269\u4e5f\u6bd4\u8f83\u611f\u5174\u8da3\uff0c\u770b\u8fc7\u5f88\u591a\u5b87\u5b99\u3001\u81ea\u7136\u76f8\u5173\u7684\u767e\u79d1\u5168\u4e66\u3002  \\r\\n\\r\\n\u5927\u5b66\u671f\u95f4\uff0c\u6211\u8fd8\u73a9\u8fc7\u65e0\u4eba\u673a\uff0c\u548c\u5c0f\u4f19\u4f34\u4eec\u4e00\u8d77\u822a\u62cd\u5b66\u6821\uff0c\u518d\u7528 Minecraft \u590d\u523b\u6210\u89c6\u9891\uff0cBilibili \u4e0a\u6709\u8fd9\u4e2a\u89c6\u9891\uff08[\u6cb3\u5357\u5e08\u8303\u5927\u5b66\u5ba3\u4f20\u89c6\u9891](https://www.bilibili.com/video/BV1As411a7Mc?from=search&seid=7847808159839607455&spm_id_from=333.337.0.0)\uff09\u3002\u6211\u4eec\u4e5f\u4f1a\u62ce\u7740\u65e0\u4eba\u673a\u5728\u6cf0\u5c71\u5c71\u9876\u62cd\u65e5\u51fa\uff0c\u5e2e\u5bb6\u4e61\u62cd\u5404\u79cd\u89c6\u9891\uff0c\u5e2e\u5b66\u6821\u76f4\u64ad\u5404\u79cd\u6d3b\u52a8\u3002\\r\\n\\r\\n## \u5199\u5728\u6700\u540e\\r\\n\\r\\n\u81f4\u8fdc\u6709\u957f\u671f\u5199\u4f5c\u7684\u4e60\u60ef\uff0c\u5e73\u5e38\u4f1a\u5728\u535a\u5ba2\u91cc\u5206\u4eab\u4ed6\u6700\u8fd1\u7684\u4e00\u4e9b\u601d\u8003\u548c\u611f\u609f\u3002\u5728\u6d3b\u6cfc\u5199\u5b9e\u3001\u5185\u5bb9\u4e30\u5bcc\u7684\u968f\u7b14\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e00\u4f4d\u671d\u6c14\u84ec\u52c3\u7684\u5e74\u8f7b\u4eba\u5728\u5f00\u6e90\u3001\u6280\u672f\u3001\u5de5\u4f5c\u3001\u751f\u6d3b\u4e2d\u7684\u6210\u957f\u8f68\u8ff9\u3002\u5982\u679c\u5927\u5bb6\u60f3\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u81f4\u8fdc\u7684\u6545\u4e8b\uff0c\u6b22\u8fce\u5173\u6ce8\u4ed6\u7684[\u535a\u5ba2](https://wineso.me/)\u548c [GitHub \u4e3b\u9875](https://github.com/juzhiyuan)\u3002\\r\\n\\r\\n\u671f\u5f85\u81f4\u8fdc\u540e\u7eed\u66f4\u7cbe\u5f69\u7684\u8868\u73b0\uff0c\u8ba9\u6211\u4eec\u4e00\u8d77\u5173\u6ce8\u8fd9\u4f4d\u5e74\u8f7b\u4eba\u5728\u5f00\u6e90\u3001\u5728\u6280\u672f\u4e0a\u7684\u4e0d\u61c8\u63a2\u7d22\u548c\u52aa\u529b\u3002"},{"id":"\u57fa\u4e8e TiDB \u7684 API \u7f51\u5173\u9ad8\u53ef\u7528\u914d\u7f6e\u6700\u4f73\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/04/22/apisix-with-tidb-practice","source":"@site/blog/2022/04/22/apisix-with-tidb-practice.md","title":"\u57fa\u4e8e TiDB \u7684 API \u7f51\u5173\u9ad8\u53ef\u7528\u914d\u7f6e\u6700\u4f73\u5b9e\u8df5","description":"APISIX \u53c2\u8d5b\u56e2\u961f\u4ee5\u56db\u4eba\u7ec4\u961f\u65b9\u5f0f\u5728 TiDB Hackathon 2021 \u4e2d\u5448\u73b0\u4e86 TiDB \u4e0e APISIX \u5bf9\u63a5\u5b9e\u73b0\u901a\u7528\u914d\u7f6e\u4e2d\u5fc3\u7684\u80fd\u529b\u3002\u672c\u6587\u5c06\u5e26\u6765\u8be5\u9879\u76ee\u80cc\u540e\u7684\u4e00\u4e9b\u6545\u4e8b\u4ee5\u53ca\u672a\u6765\u5c55\u671b\u3002","date":"2022-04-22T00:00:00.000Z","formattedDate":"2022\u5e744\u670822\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":16.17,"truncated":true,"authors":[{"name":"\u5f20\u8d85","title":"Author","url":"https://github.com/tokers","image_url":"https://avatars.githubusercontent.com/u/10428333?v=4","imageURL":"https://avatars.githubusercontent.com/u/10428333?v=4"},{"name":"\u9976\u96c5\u60e0","title":"Technical Writer","url":"https://github.com/EstelleRao","image_url":"https://github.com/EstelleRao.png","imageURL":"https://github.com/EstelleRao.png"}],"prevItem":{"title":"\u741a\u81f4\u8fdc\uff1a95 \u540e Apache Member \u7684\u6210\u957f\u4e4b\u8def","permalink":"/zh/blog/2022/04/29/interview-juzhiyuan-apache-member"},"nextItem":{"title":"APISIX jwt-auth \u63d2\u4ef6\u5b58\u5728\u9519\u8bef\u54cd\u5e94\u4e2d\u6cc4\u9732\u4fe1\u606f\u7684\u98ce\u9669\u516c\u544a\uff08CVE-2022-29266\uff09","permalink":"/zh/blog/2022/04/20/cve-2022-29266"}},"content":"> \u5728 TiDB Hackathon 2021 \u7684\u6bd4\u8d5b\u4e2d\uff0cAPISIX \u53c2\u8d5b\u56e2\u961f\u4ee5\u56db\u4eba\u7ec4\u961f\u65b9\u5f0f\uff08\u961f\u957f\uff1a\u5f20\u8d85\uff0c\u961f\u5458\uff1a\u767d\u6cfd\u5e73\u3001\u5c60\u6b63\u677e\u3001\u9648\u5a67\u6657\uff09\u5448\u73b0\u4e86 TiDB \u4e0e Apache APISIX \u5bf9\u63a5\u5b9e\u73b0\u901a\u7528\u914d\u7f6e\u4e2d\u5fc3\u7684\u80fd\u529b\u3002\u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u5e26\u6765\u8be5\u9879\u76ee\u80cc\u540e\u7684\u4e00\u4e9b\u6545\u4e8b\u4ee5\u53ca\u672a\u6765\u5c55\u671b\uff0c\u5982\u679c\u60a8\u5bf9\u8be5\u9879\u76ee\u611f\u5174\u8da3\uff0c\u4e5f\u6b22\u8fce\u968f\u65f6\u53c2\u4e0e\u5230\u9879\u76ee\u4e2d\u6765\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u9879\u76ee\u80cc\u666f\\n\\nAPI \u7f51\u5173\u4f5c\u4e3a\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u91cd\u8981\u7ec4\u4ef6\uff0c\u662f\u6d41\u91cf\u7684\u6838\u5fc3\u51fa\u5165\u53e3\uff0c\u7528\u4e8e\u7edf\u4e00\u5904\u7406\u548c\u4e1a\u52a1\u76f8\u5173\u7684\u8bf7\u6c42\uff0c\u53ef\u6709\u6548\u89e3\u51b3\u6d77\u91cf\u8bf7\u6c42\u3001\u6076\u610f\u8bbf\u95ee\u7b49\u95ee\u9898\uff0c\u4fdd\u969c\u4e1a\u52a1\u5b89\u5168\u6027\u4e0e\u7a33\u5b9a\u6027\u3002\\n\\n\u4f5c\u4e3a\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0cApache APISIX \u517c\u5177\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u4e09\u5927\u4f18\u52bf\uff0c\u53ef\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u9274\u6743\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\uff0c\u5e2e\u52a9\u4f01\u4e1a\u5feb\u901f\u3001\u5b89\u5168\u5730\u5904\u7406 API \u548c\u5fae\u670d\u52a1\u6d41\u91cf\uff0c\u53ef\u5e94\u7528\u4e8e\u7f51\u5173\u3001Kubernetes Ingress \u548c\u670d\u52a1\u7f51\u683c\u7b49\u573a\u666f\u3002\\n\\n\u540c\u65f6\uff0cApache APISIX \u5df2\u901a\u8fc7\u5e7f\u6cdb\u7684\u751f\u6001\u5408\u4f5c\u5efa\u7acb\u8d77\u4e30\u5bcc\u7684\u793e\u533a\u751f\u6001\u3002Apache APISIX \u4e5f\u652f\u6301\u9ad8\u5ea6\u5b9a\u5236\u5316\uff0c\u652f\u6301 Wasm\uff0c\u53ef\u7528 Java\u3001Go\u3001Python \u7b49\u4e3b\u6d41\u8ba1\u7b97\u673a\u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\u3002\\n\\n### Apache APISIX \u6280\u672f\u67b6\u6784\\n\\nApache APISIX \u91c7\u7528\u4e86\u6570\u636e\u5e73\u9762\u4e0e\u63a7\u5236\u5e73\u9762\u5206\u79bb\u7684\u67b6\u6784\u65b9\u5f0f\uff0c\u901a\u8fc7\u914d\u7f6e\u4e2d\u5fc3\u63a5\u6536\u3001\u4e0b\u53d1\u914d\u7f6e\uff0c\u4f7f\u5f97\u6570\u636e\u5e73\u9762\u4e0d\u4f1a\u53d7\u5230\u63a7\u5236\u5e73\u9762\u5f71\u54cd\u3002\\n\\n![APISIX \u67b6\u6784\u56fe](https://static.apiseven.com/202108/1650769844333-c2d90f33-8138-49cc-a511-0e96b75b47e8.png)\\n\\n\u5728\u6b64\u67b6\u6784\u4e2d\uff0c\u6570\u636e\u5e73\u9762\u8d1f\u8d23\u63a5\u6536\u5e76\u5904\u7406\u8c03\u7528\u65b9\u8bf7\u6c42\uff0c\u4f7f\u7528 Lua \u4e0e NGINX \u52a8\u6001\u63a7\u5236\u8bf7\u6c42\u6d41\u91cf\uff0c\u53ef\u7528\u4e8e\u7ba1\u7406 API \u8bf7\u6c42\u7684\u5168\u751f\u547d\u5468\u671f\u3002\u63a7\u5236\u5e73\u9762\u5219\u5305\u542b\u4e86 Manager API \u548c\u9ed8\u8ba4\u914d\u7f6e\u4e2d\u5fc3 etcd\uff0c\u53ef\u7528\u4e8e\u7ba1\u7406 API \u7f51\u5173\u3002\u7ba1\u7406\u5458\u5728\u8bbf\u95ee\u5e76\u64cd\u4f5c\u63a7\u5236\u53f0\u65f6\uff0c\u63a7\u5236\u53f0\u5c06\u8c03\u7528 Manager API \u4e0b\u53d1\u914d\u7f6e\u5230 etcd\uff0c\u501f\u52a9 etcd watch \u673a\u5236\uff0c\u914d\u7f6e\u5c06\u5728\u7f51\u5173\u4e2d\u5b9e\u65f6\u751f\u6548\u3002\\n\\n\u914d\u7f6e\u4e2d\u5fc3\u9ed8\u8ba4\u4e3a etcd\uff0c\u4e5f\u652f\u6301 Consul\u3001Nacos\u3001Eureka \u7b49\u3002etcd \u5929\u7136\u652f\u6301\u5206\u5e03\u5f0f\u3001\u9ad8\u53ef\u7528\uff0c\u652f\u6301\u96c6\u7fa4\uff0c\u5e76\u4e14\u5728 K8s \u7b49\u9886\u57df\u6709\u5927\u91cf\u7684\u5e94\u7528\u5b9e\u8df5\uff0c\u4f7f\u5f97 APISIX \u53ef\u4ee5\u8f7b\u677e\u652f\u6301\u6beb\u79d2\u7ea7\u914d\u7f6e\u66f4\u65b0\u3001\u652f\u6491\u6570\u5343\u7f51\u5173\u8282\u70b9\uff0c\u4e14\u7f51\u5173\u8282\u70b9\u65e0\u72b6\u6001\uff0c\u53ef\u4efb\u610f\u6269\u7f29\u5bb9\u3002\\n\\n### etcd \u7684\u5c40\u9650\u6027\\n\\n#### \u81ea\u8eab\u67b6\u6784\u95ee\u9898\\n\\n\u9996\u5148 etcd \u57fa\u4e8e BoltDB\uff0c\u5bb9\u91cf\u5177\u6709\u4e0a\u9650 \u3002etcd \u7684\u9ed8\u8ba4\u5b58\u50a8\u4e0a\u9650\u4e3a 2 GB\uff0c\u5982\u679c\u4e0a\u9650\u8981\u6c42\u8d85\u8fc7 2 GB\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7 `--quota-backend-bytes` \u53c2\u6570\u914d\u7f6e\u5b58\u50a8\uff0c\u6700\u5927\u53ef\u8c03\u6574\u81f3 8 GB\u3002\u4e00\u4e2a etcd \u96c6\u7fa4\u5982\u679c\u6709 8 GB \u7684\u5b58\u50a8\u91cf\uff0c\u5219\u8db3\u4ee5\u670d\u52a1\u4e00\u4e2a\u7f51\u5173\uff0c\u4f46\u5982\u679c\u540c\u65f6\u670d\u52a1 N \u4e2a APISIX \u96c6\u7fa4\uff0c\u5bb9\u91cf\u53ef\u80fd\u4e0d\u591f\u7528\uff0c\u6709\u53ef\u80fd\u4f1a\u5e26\u6765\u4e00\u4e9b\u9ebb\u70e6\u3002\\n\\n\u5176\u6b21\uff0cetcd \u672c\u8d28\u4e0a\u662f\u4e00\u4e2a CP \u7cfb\u7edf\uff0c\u65e0\u6cd5\u627f\u8f7d\u5927\u91cf\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u3002\u56e0\u4e3a etcd \u662f\u901a\u8fc7 Raft \u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u5171\u8bc6\uff0c\u6240\u6709\u7684\u8bfb\u5199\u8bf7\u6c42\u90fd\u4f1a\u7ecf\u7531 Raft \u7684 Leader \u8fdb\u884c\u5904\u7406\uff0c\u5927\u91cf\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u7684\u8d1f\u8f7d\u504f\u9ad8\uff0c\u6709\u53ef\u80fd\u4f1a\u5f71\u54cd\u5230\u8c03\u7528\u8005\u3002\\n\\n#### \u573a\u666f\u914d\u5408\u95ee\u9898\\n\\n\u5728 Ingress \u548c Service Mesh \u7b49\u573a\u666f\uff0c\u4f7f\u7528 etcd \u76f8\u5bf9\u6765\u8bf4\u6709\u70b9\u8fc7\u91cd\uff0c\u6709\u4e9b\u7528\u6237\u4e0d\u5e0c\u671b\u90e8\u7f72\u9664\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\u4ee5\u5916\u7684\u7ec4\u4ef6\u3002\u6bd4\u5982 NGINX Ingress Controller \u53ea\u9700\u4e00\u4e2a\u955c\u50cf\u5c31\u53ef\u4ee5\u8dd1\u8d77\u6765\uff0c\u4f46 APISIX Ingress Controller \u9664\u4e86 Ingress Controller \u63a7\u5236\u9762\u548c APISIX \u6570\u636e\u9762\uff0c\u8fd8\u6709\u4e00\u4e2a etcd\u3002\u5bf9\u7528\u6237\u6765\u8bf4\uff0c\u8fd9\u79cd\u6280\u672f\u67b6\u6784\u7684\u90e8\u7f72\u6210\u672c\u66f4\u9ad8\uff0c\u8fd8\u8981\u4fdd\u8bc1 etcd \u7684\u8fd0\u7ef4\u3002\\n\\n\u800c\u4e14\u672c\u8d28\u4e0a\uff0cetcd \u662f\u4e00\u4e2a\u5197\u4f59\u7ec4\u4ef6\uff0c\u5b8c\u5168\u53ef\u4ee5\u53bb\u6389\u3002K8s \u672c\u8eab\u652f\u6301\u5b58\u50a8\u670d\u52a1\uff0c\u6240\u6709\u7684\u914d\u7f6e\u4fe1\u606f\u3001\u5b58\u50a8\u5728 APISIX \u540e\u7aef\u7684 Endpoints \u4fe1\u606f\u90fd\u53ef\u4ee5\u4ece K8s \u7684 API Server \u83b7\u53d6\u3002\u5728\u8fd9\u79cd\u573a\u666f\u4f7f\u7528 etcd \u4f1a\u9020\u6210\u6574\u4e2a\u9009\u578b\u66f4\u52a0\u7b28\u91cd\u3002\\n\\n\u670d\u52a1\u7f51\u683c\u4e5f\u662f\u540c\u7406\u3002\u5728\u670d\u52a1\u7f51\u683c\u573a\u666f\u4f7f\u7528 APISIX\uff0c\u5982\u679c\u8fd8\u8981\u90e8\u7f72 etcd\uff0c\u6574\u4e2a\u9009\u578b\u5c31\u4f1a\u504f\u91cd\u3002\u800c\u4e14\u5728\u670d\u52a1\u7f51\u683c\u573a\u666f\uff0cPod \u7684\u6570\u91cf\u53ef\u80fd\u6210\u767e\u4e0a\u5343\u751a\u81f3\u4e0a\u4e07\uff0c\u8fd9\u79cd\u60c5\u51b5\u5f88\u5e38\u89c1\u3002\u5982\u679c\u4e0a\u4e07\u4e2a Pod \u5168\u90e8\u8fde\u5230 etcd\uff0cetcd \u4f1a\u6210\u4e3a\u6574\u4e2a\u670d\u52a1\u7684\u74f6\u9888\u3002\\n\\n#### \u6210\u672c\u95ee\u9898\\n\\n\u7b2c\u4e00\uff0cetcd \u7684\u8fd0\u7ef4\u6210\u672c\u8f83\u9ad8\uff0c\u6709\u4e9b\u516c\u53f8\u6ca1\u6709\u4e13\u95e8\u7684 etcd \u8fd0\u7ef4\u5de5\u7a0b\u5e08\u3002\u90e8\u7f72 etcd \u81f3\u5c11\u9700\u8981 3-5 \u4e2a\u5b9e\u4f8b\uff0cetcd \u6210\u529f\u8fd0\u884c\u540e\uff0c\u8fd8\u9700\u8981\u5b9a\u671f\u505a\u6570\u636e\u5907\u4efd\uff0c\u521b\u5efa\u5feb\u7167\u3002\u4e3a\u4e86\u76d1\u63a7 etcd \u7684\u8fd0\u884c\u60c5\u51b5\uff0c\u5b9e\u65f6\u4e86\u89e3 etcd \u7684\u5065\u5eb7\u72b6\u51b5\uff0c\u8fd8\u9700\u8981\u642d\u5efa\u53ef\u89c2\u6d4b\u6027\u7cfb\u7edf\uff0c\u63d0\u4f9b\u5fc5\u8981\u7684\u544a\u8b66\u652f\u6301\u3002\u5982\u679c\u4e00\u4e2a\u516c\u53f8\u6ca1\u6709\u4e13\u95e8\u7684 etcd \u8fd0\u7ef4\u5de5\u7a0b\u5e08\uff0c\u53ef\u80fd\u65e0\u6cd5\u505a\u597d etcd \u7684\u8fd0\u7ef4\u5de5\u4f5c\u3002\\n\\n\u7b2c\u4e8c\uff0c\u6709\u4e9b\u516c\u53f8\u6216\u7ec4\u7ec7\u6709\u957f\u671f\u4f7f\u7528\u7684\u4e2d\u95f4\u4ef6\u6216\u57fa\u7840\u8bbe\u65bd\uff0c\u5207\u6362\u914d\u7f6e\u4e2d\u5fc3\u4f1a\u5e26\u6765\u4e00\u5b9a\u7684\u6210\u672c\u3002\u5bf9\u8fd9\u4e9b\u516c\u53f8\u6216\u7ec4\u7ec7\u6765\u8bf4\uff0c\u4ed6\u4eec\u5f80\u5f80\u66f4\u5e0c\u671b\u590d\u2f64\u5df2\u6709\u7684\u4e2d\u95f4\u4ef6\u6216\u57fa\u7840\u8bbe\u65bd\u4f5c\u4e3a APISIX \u7684\u914d\u7f6e\u4e2d\u2f3c\uff0c\u2f50\u5982 TiDB\u3001Consul\u3001Apache ZooKeeper\uff0c\u4ece\u800c\u6536\u655b\u6280\u672f\u6808\uff0c\u907f\u514d\u5e26\u6765\u989d\u5916\u7684\u6210\u672c\u3002\\n\\n## \u9879\u76ee\u52a8\u673a\\n\\n\u57fa\u4e8e\u4ee5\u4e0a\u8003\u8651\uff0c\u6211\u4eec\u51b3\u5b9a\u7814\u7a76\u65b0\u7684\u65b9\u6848\uff0c\u6539\u53d8\u73b0\u5728\u8fc7\u91cd\u7684\u6280\u672f\u67b6\u6784\uff0c\u4e3a Apache APISIX \u7684\u7528\u6237\u63d0\u4f9b\u66f4\u7075\u6d3b\u7684\u9009\u62e9\uff0c\u4e0d\u88ab etcd \u7ed1\u5b9a\uff0c\u7f13\u89e3\u73b0\u6709\u7528\u6237\u7684 etcd \u8fd0\u7ef4\u538b\u529b\uff0c\u964d\u4f4e\u8fd0\u7ef4\u6210\u672c\uff0c\u540c\u65f6\u671f\u671b\u7ed9\u5230\u7528\u6237\u66f4\u591a\u3001\u66f4\u4f18\u7684\u9009\u62e9\uff0c\u7a81\u7834 etcd \u7684\u81ea\u8eab\u74f6\u9888\u3002\\n\\n\u89e3\u9664 APISIX \u548c etcd \u7684\u5f3a\u5173\u8054\uff0c\u8ba9\u7528\u6237\u62e5\u6709\u66f4\u591a\u3001\u66f4\u7075\u6d3b\u7684\u9009\u62e9\uff0c\u5176\u5b9e\u4e5f\u662f\u5f00\u6e90\u7684\u9b45\u529b\u6240\u5728\u3002\u5982\u679c\u80fd\u591f\u89e3\u9664\u8fd9\u4e00\u5c42\u9650\u5236\uff0c\u4e0d\u9650\u5236\u7528\u6237\u5982\u4f55\u7528\uff0c\u7528\u6237\u53ef\u80fd\u4f1a\u521b\u9020\u51fa\u66f4\u591a\u60ca\u559c\u3002\\n\\n## \u9879\u76ee\u4ecb\u7ecd\\n\\n### \u65b9\u6848\u8bbe\u8ba1\\n\\n#### \u5982\u4f55\u89e3\u8026 APISIX \u548c etcd\uff1f\\n\\n\u65b9\u6848\u8bbe\u8ba1\u4e4b\u521d\uff0c\u6211\u4eec\u8003\u8651\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u662f\u5982\u4f55\u5b9e\u73b0 APISIX \u4e0e etcd \u7684\u89e3\u8026\uff0c\u56e0\u4e3a APISIX \u7684\u6838\u2f3c\u4ee3\u7801\u3001\u6570\u636e\u7ed3\u6784\u4e0e etcd \u5173\u7cfb\u5bc6\u5207\u3002\u8d1f\u8d23\u64cd\u4f5c\u914d\u7f6e\u7684 Admin API \u901a\u5e38\u4f1a\u5728\u8fd4\u56de\u503c\u91cc\u5e26\u4e0a etcd \u7684\u5143\u6570\u636e\u3002\\n\\n\u6bd4\u5982 etcd v3 \u7684 Revision\u3001etcd v2 \u7684 createdIndex\u3001modifiedIndex\uff0c\u751a\u81f3\u5728 APISIX \u7684\u6838\u5fc3\u903b\u8f91\u91cc\uff0c\u67d0\u4e2a\u8def\u7531\u6216\u8005\u67d0\u4e2a Upstream \u5bf9\u8c61\u4e5f\u4f1a\u5e26\u4e0a\u8fd9\u4e9b\u5143\u6570\u636e\u3002\\n\\n\u5982\u679c\u4ece\u6839\u672c\u4e0a\u6539\u9020 APISIX\uff0c\u6210\u672c\u4f1a\u8fc7\u9ad8\u3002\u5728\u5982\u6b64\u6838\u5fc3\u7684\u5730\u65b9\u8fdb\u884c\u6539\u9020\u53ef\u80fd\u4e5f\u4f1a\u5f71\u54cd APISIX \u73b0\u6709\u7684\u7a33\u5b9a\u6027\uff0c\u56e0\u6b64\u76f4\u63a5\u4fee\u6539 APISIX \u53ef\u80fd\u5e76\u4e0d\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u65b9\u6848\u3002\\n\\n#### \u7834\u5c40\uff1a\u5f15\u5165\u989d\u5916\u7684\u4e2d\u95f4\u5c42\\n\\n\u5982\u679c\u76f4\u63a5\u6539\u9020\u6210\u672c\u592a\u9ad8\u4e14\u98ce\u9669\u592a\u5927\uff0c\u90a3\u4e48\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u8003\u8651\u5f15\u5165\u4e00\u5c42\u989d\u5916\u7684\u4e2d\u95f4\u5c42\uff1f\u5728\u8ba1\u7b97\u673a\u754c\u6709\u4e00\u53e5\u540d\u8a00\u2014\u2014\u201c\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\u662f\u52a0\u4e00\u5c42\u89e3\u51b3\u4e0d\u4e86\u7684\u201d\u3002\u5982\u679c\u8981\u52a0\u5165\u4e00\u5c42\uff0c\u8fd9\u4e00\u5c42\u5177\u4f53\u8981\u8d1f\u8d23\u4ec0\u4e48\u4e8b\u60c5\uff1f\u505a\u4ec0\u4e48\u4e8b\u60c5\uff1f\u603b\u7ed3\u4e0b\u6765\uff0c\u8fd9\u4e00\u5c42\u9700\u8981\u5b8c\u6210\u4e24\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u4e8b\u60c5\u3002\\n\\n\u7b2c\u4e00\uff0c\u8fd9\u4e2a\u989d\u5916\u7684\u4e2d\u95f4\u5c42\u9700\u63d0\u4f9b etcd v3 API \u5e76\u2f40\u6301 etcd gRPC Gateway\u3002\u76ee\u524d\uff0cAPISIX \u53ea\u652f\u6301 etcd v3\u3002\u5bf9 APISIX \u6765\u8bf4\uff0c\u8fd9\u4e2a\u4e2d\u95f4\u5c42\u4f9d\u7136\u662f\u4e00\u4e2a etcd\uff0c\u5b83\u5fc5\u987b\u63d0\u4f9b etcd v3 \u7684 API\u3002\u9664\u4e86\u63d0\u4f9b v3 \u7684 API\uff0c\u5b83\u8fd8\u8981\u652f\u6301 etcd \u7684 gRPC Gateway\uff0c\u56e0\u4e3a APISIX \u73b0\u5728\u8fd8\u662f\u901a\u8fc7 HTTP \u534f\u8bae\u548c etcd \u4ea4\u4e92\uff0c\u800c etcd v3 API \u662f\u57fa\u4e8e gRPC\uff0c\u6211\u4eec\u9700\u8981 etcd \u7684 gRPC Gateway \u628a HTTP \u7684\u8bf7\u6c42\u8f6c\u6210 gRPC \u8bf7\u6c42\uff0c\u4ece\u800c\u4f7f\u5f97\u6574\u4e2a\u4ea4\u4e92\u80fd\u591f\u987a\u5229\u8fdb\u884c\u4e0b\u53bb\u3002\\n\\n\u7b2c\u4e8c\uff0c\u8fd9\u4e2a\u989d\u5916\u7684\u4e2d\u95f4\u5c42\u80fd\u5bf9\u63a5\u5404\u79cd\u4e0d\u540c\u7684\u5b58\u50a8\u65b9\u6848\u3002\u6211\u4eec\u8981\u60f3\u6e05\u695a\u5982\u4f55\u652f\u6301 TiDB\u3001PostgreSQL\uff0cSQLite\uff0c\u751a\u81f3\u662f Consul\u3001Apachce ZooKeeper \u8fd9\u4e9b\u4e0d\u540c\u7684\u65b9\u6848\u3002\\n\\n\u53ea\u6709\u505a\u5230\u4e86\u8fd9\u4e24\u70b9\uff0c\u8fd9\u4e2a\u4e2d\u95f4\u5c42\u624d\u80fd\u5bf9\u63a5\u4e0d\u540c\u7684\u5b58\u50a8\u65b9\u6848\uff0c\u4ece\u800c\u7ed9 APISIX \u5e26\u6765\u5b8c\u6574\u7684\u914d\u7f6e\u4e2d\u5fc3\u7684\u529f\u80fd\u3002\\n\\n## \u65b9\u6848\u5b9e\u65bd\\n\\n![\u67b6\u6784\u8bbe\u8ba1\u56fe](https://static.apiseven.com/202108/1650769803987-7a297f15-baa7-4817-8d3a-89a99a76c94b.png)\\n\\n\u6709\u4e86\u8fd9\u4e2a\u4e2d\u95f4\u5c42\u540e\uff0c\u6211\u4eec\u8981\u600e\u4e48\u96c6\u6210 TiDB \u5462\uff1f\u5176\u5b9e\u6211\u4eec\u6709\u4e00\u4e2a\u7c7b\u4f3c\u7684\u9879\u76ee\u53ef\u4ee5\u53c2\u8003\u3002\u867d\u7136 K8s \u539f\u751f\u652f\u6301\u4f7f\u7528 etcd \u4f5c\u4e3a\u5b58\u50a8\u65b9\u6848\uff0c\u4f46 Rancher \u7684 [K3s](https://github.com/k3s-io/kine) \u9879\u76ee\u5e76\u6ca1\u7528 etcd\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u5982\u679c K3s \u90e8\u7f72\u5728\u67d0\u4e9b\u5d4c\u5165\u5f0f\u73af\u5883\u4e2d\uff0cetcd \u7684\u4e00\u4e9b\u9650\u5236\u4f7f\u5176\u6ca1\u6709\u529e\u6cd5\u5f88\u597d\u5730\u8fd0\u7ef4\u3002\u4e8e\u662f\uff0cRancher \u901a\u8fc7 Kine \u8fd9\u4e2a\u9879\u76ee\uff0c\u652f\u6301\u4e86\u4e00\u4e9b\u989d\u5916\u7684\u7ec4\u4ef6\uff0c\u6bd4\u5982 PostgreSQL\u3001MySQL\u3001SQLite\u3001 Dqlite\uff0c\u4f7f\u5f97 K3s \u7684\u7528\u6237\u53ef\u4ee5\u7075\u6d3b\u9009\u62e9\u5176\u4ed6\u5b58\u50a8\u65b9\u6848\u3002\u6982\u62ec\u6765\u8bf4\uff0cKine \u8fd9\u4e2a\u9879\u76ee\u6709\u4ee5\u4e0b\u51e0\u70b9\u503c\u5f97\u6211\u4eec\u501f\u9274\u3002\\n\\n\u7b2c\u4e00\uff0cTiDB \u517c\u5bb9 MySQL\uff0c\u800c Kine \u9879\u76ee\u672c\u8eab\u53c8\u652f\u6301 MySQL\u3002\u6211\u4eec\u53ef\u4ee5\u501f\u9274\u6216\u8005\u53c2\u8003 Kine \u7684\u4e00\u4e9b\u5b9e\u73b0\uff0c\u4ece\u800c\u5e2e\u52a9\u6211\u4eec\u8fd9\u4e2a\u9879\u76ee\u66f4\u597d\u5730\u652f\u6301\u548c\u5bf9\u63a5 TiDB\u3002\\n\\n\u7b2c\u4e8c\uff0c Kine \u5b8c\u6574\u5730\u5b9e\u73b0\u4e86 etcd \u9700\u8981\u652f\u6301\u7684 watch \u529f\u80fd\u3002\u56e0\u4e3a APISIX \u662f\u57fa\u4e8e\u63a8\u6a21\u5f0f\u6765\u611f\u77e5\u914d\u7f6e\u7684\u53d8\u66f4\uff0c\u914d\u7f6e\u53d8\u66f4\u7684\u65f6\u5ef6\u901a\u5e38\u5728\u6beb\u79d2\u7ea7\u522b\uff0c\u65f6\u5ef6\u975e\u5e38\u4f4e\u3002\u800c watch \u529f\u80fd\u6b63\u597d\u6d89\u53ca\u5230\u914d\u7f6e\u7684\u63a8\u9001\uff0c\u6240\u4ee5 watch \u673a\u5236\u76f8\u5f53\u91cd\u8981\u3002\\n\\n\u7b2c\u4e09\uff0cKine \u8fd8\u6a21\u62df\u4e86 etcd \u7684 MVCC \u7279\u6027\uff0c\u652f\u6301 Compact\u3002\u6bcf\u4e00\u6b21\u7684\u53d8\u66f4\u3001\u5199\u5165\u3001\u66f4\u65b0\u6216\u8005\u5220\u9664\u5728 Kine \u6216 TiDB \u91cc\u5c31\u662f\u4e00\u884c\u6570\u636e\u3002\u6bcf\u884c\u6570\u636e\u7684\u4e3b\u952e\u5c31\u662f etcd \u7684 Revision\uff0c\u4e5f\u5c31\u662f\u8ba1\u6570\u5668\uff0c\u8bb0\u5f55\u6700\u65b0\u53d8\u66f4\u7684\u6b21\u6570\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0cKine \u5b9e\u73b0\u4e86\u591a\u7248\u672c\u7684\u652f\u6301\u3002\\n\\n\u901a\u8fc7\u5f15\u5165\u7c7b\u4f3c\u67b6\u6784\uff0cApache APISIX \u4e0d\u7528\u548c\u771f\u6b63\u7684\u5b58\u50a8\u4e2d\u5fc3\u8fdb\u884c\u4ea4\u4e92\uff0c\u800c\u662f\u548c\u8fd9\u4e2a\u4e2d\u95f4\u5c42\uff08etcd adapter\uff09\u8fdb\u884c\u4ea4\u4e92\u3002\u5982\u4e0a\u56fe\uff0cAPISIX \u548c etcd adapter \u4f1a\u8d70 etcd \u7684 KV API \u548c Watch API\uff0cetcd adapter \u4f1a\u8f6e\u8be2 TiDB\uff0c\u611f\u77e5\u914d\u7f6e\u7684\u5199\u5165\uff0c\u5b8c\u6210 watch \u64cd\u4f5c\uff0c\u4ece\u800c\u628a\u6570\u636e\u63a8\u7ed9 APISIX\u3002\\n\\n## \u65b9\u6848\u6548\u679c\uff1aetcd adapter \u7684\u8bde\u751f\\n\\n\u6709\u4e86\u8fd9\u4e9b\u601d\u8003\u4ee5\u53ca Kine \u8fd9\u4e2a\u9879\u76ee\u7684\u53c2\u8003\uff0c\u6211\u4eec\u7ad9\u5728\u5de8\u4eba\u7684\u80a9\u8180\u4e0a\u5f00\u53d1\u51fa\u4e86 [etcd adapter](https://github.com/api7/ETCD-adapter) \u9879\u76ee\u3002\\n\\n\u9996\u5148\uff0c\u8fd9\u4e2a\u9879\u76ee\u652f\u6301\u4e86 TiDB\u3001MySQL \u4ee5\u53ca In-Memory B-Tree \u7b49\u591a\u79cd\u914d\u7f6e\u4e2d\u5fc3\uff0c\u4e0d\u4e45\u540e\uff0c\u4e5f\u4f1a\u652f\u6301 SQLite \u548c PostgreSQL\u3002\u5176\u4e2d\uff0cIn-Memory B \u6811\u548c APISIX Ingress Controller \u67b6\u6784\u8fc7\u91cd\u6709\u5173\u3002\u5982\u679c\u9009\u62e9 In-Memory \u7684 B \u6811\u9009\u578b\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u628a etcd adapter \u5185\u5d4c\u5230\u76ee\u6807\u7a0b\u5e8f\u91cc\u9762\u3002\u8fd9\u79cd\u65b9\u5f0f\u5c11\u4e86\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63d0\u5347\u6574\u4f53\u7684\u7528\u6237\u4f53\u9a8c\u3002\\n\\n\u5176\u6b21\uff0c\u8fd9\u4e2a\u9879\u76ee\u652f\u6301\u4e86 etcd v3 \u7684 API\u3002\u76ee\u524d\uff0c\u8fd9\u4e2a\u9879\u76ee\u53ea\u652f\u6301\u4e86 APISIX \u6240\u9700\u7684 API \u5b50\u96c6\uff0c\u6bd4\u5982 KV API \u548c Watch API\u3002\u81f3\u4e8e\u5176\u4ed6\u7c7b\u578b\u7684 API\uff0c\u6bd4\u5982 Lease\u3001\u504f\u8ba4\u8bc1\u7c7b\u7684 API \u8fd8\u6ca1\u6709\u5168\u90e8\u5b9e\u73b0\u3002\\n\\n\u6700\u540e\uff0c\u8fd9\u4e2a\u9879\u76ee\u2f40\u6301\u4e86 gRPC Gateway\u3002\u5b83\u4f1a\u628a\u5bf9\u5e94\u7684 gRPC \u63a5\u53e3\u7ffb\u8bd1\u6210\u5bf9\u5e94\u7684 Restful \u63a5\u53e3\uff0c\u4f9b APISIX \u8c03\u7528\u3002\\n\\n\u867d\u7136\u6211\u4eec\u628a etcd adapter \u653e\u5728\u4e86\u63a7\u5236\u9762\uff0c\u4f46\u6211\u4eec\u4e5f\u53ef\u4ee5\u628a\u5b83\u653e\u5728\u6bcf\u4e2a APISIX \u8fb9\u4e0a\uff0c\u4f5c\u4e3a\u4e00\u4e2a Sidecar \u5b58\u5728\u3002\u4e24\u79cd\u65b9\u6848\u5404\u6709\u597d\u5904\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u7075\u6d3b\u9009\u62e9\u3002\\n\\n## \u672a\u6765\u8ba1\u5212\\n\\n\u5173\u4e8e\u8fd9\u4e2a\u9879\u76ee\u7684\u540e\u7eed\u8ba1\u5212\u548c\u672a\u6765\u65b9\u5411\uff0c\u6211\u4eec\u6709\u4ee5\u4e0b\u51e0\u70b9\u60f3\u6cd5\u5206\u4eab\u7ed9\u5927\u5bb6\u3002\\n\\n### \u4e3a Apache APISIX \u7684\u2f64\u6237\u63d0\u4f9b\u66f4\u591a\u7684\u914d\u7f6e\u4e2d\u5fc3\u9009\u62e9\\n\\n\u6211\u4eec\u5e0c\u671b etcd adapter \u9879\u76ee\u80fd\u8ba9 Apache APISIX \u7684\u7528\u6237\u6709\u66f4\u591a\u7684\u914d\u7f6e\u4e2d\u5fc3\u9009\u62e9\uff0c\u4e0d\u88ab etcd \u9501\u5b9a\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u9009\u62e9\u89e3\u51b3\u65b9\u6848\u3002\u5982\u679c\u516c\u53f8\u7684\u8fd0\u7ef4\u3001\u5f00\u53d1\u7684\u6280\u672f\u6808\u66f4\u504f\u5411\u4e8e Consul\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 Consul\u3002Consul KV \u4e5f\u662f\u57fa\u4e8e Raft\uff0c\u53ef\u7528\u6027\u5f88\u9ad8\u3002\u9664\u6b64\u4ee5\u5916\uff0c\u4e5f\u53ef\u4ee5\u8003\u8651\u6bd4\u8f83\u4e3b\u6d41\u7684 Apollo \u6216\u8005\u548c etcd \u5bf9\u6807\u7684 Apache ZooKeeper\uff0c\u8fd8\u6709 PostgreSQL \u6216\u8005\u5176\u4ed6\u5907\u9009\u65b9\u6848\u3002\\n\\n### \u4e3a Apache APISIX Ingress Controller \u7684\u67b6\u6784\u6539\u826f\u52a9\u529b\\n\\n\u6211\u4eec\u5e0c\u671b etcd adapter \u9879\u76ee\u80fd\u4e3a APISIX Ingress Controller \u7684\u67b6\u6784\u6539\u826f\u52a9\u529b\u3002etcd adapter \u652f\u6301\u4e86 In-Memory B-Tree\uff0cIn-Memory B-Tree \u53ef\u4ee5\u628a\u6570\u636e\u5d4c\u5165\u5230\u5185\u5b58\u91cc\uff0c\u800c\u4e0d\u9700\u8981\u5b9e\u9645\u5730\u5b58\u50a8\u3002\\n\\n\u5982\u6b64\u4e00\u6765\uff0cetcd adapter \u53ef\u4ee5\u6210\u4e3a APISIX Ingress Controller \u7684\u4e00\u90e8\u5206\uff0cApache Ingress Controller \u53ea\u9700\u4fdd\u7559 Ingress Controller \u63a7\u5236\u9762\u548c APISIX \u6570\u636e\u9762\u4e24\u4e2a\u7ec4\u4ef6\u3002\u56e0\u4e3a\u6ca1\u6709\u4f7f\u7528 etcd\uff0cAPISIX \u751a\u81f3\u53ef\u4ee5\u548c Ingress Controller \u76f4\u63a5\u4ea4\u4e92\uff0c\u83b7\u53d6\u914d\u7f6e\u53d8\u66f4\u6570\u636e\u3002\\n\\n\u9664\u6b64\u4ee5\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u628a Ingress Controller \u63a7\u5236\u9762\u548c APISIX \u6570\u636e\u9762\u653e\u5728\u540c\u4e00\u4e2a\u955c\u50cf\u91cc\uff0c\u5b9e\u73b0\u63a7\u5236\u9762\u4e0e\u6570\u636e\u9762\u7684\u2f00\u4f53\u5316\u90e8\u7f72\u3002\u6700\u7ec8\u53ea\u9700\u8981\u4e00\u6761\u547d\u4ee4\u3001\u4e00\u4e2a\u955c\u50cf\uff0c\u5c31\u53ef\u4ee5\u5728 K8s \u76ee\u6807\u96c6\u7fa4\u4e2d\u628a APISIX Ingress Controller \u8fd0\u884c\u8d77\u6765\u3002\u5982\u679c\u63a7\u5236\u9762\u3001\u6570\u636e\u9762\u653e\u5728\u4e00\u8d77\uff0c\u7528\u6237\u5c31\u4e0d\u9700\u8981\u989d\u5916\u90e8\u7f72\u4e00\u4e2a etcd \u548c\u4e00\u4e2a\u63a7\u5236\u9762\uff0c\u76f8\u5f53\u4e8e\u76f4\u63a5\u5c11\u4e86\u4e24\u4e2a\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u6781\u5927\u5730\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u3002\\n\\n### \u6350\u8d60\u7ed9 Apache \u57fa\u91d1\u4f1a\uff0c\u4f5c\u4e3a Apache APISIX \u5b50\u9879\u76ee\u8fdb\u884c\u5b75\u5316\\n\\n\u76ee\u524d\uff0c\u8fd9\u4e2a[\u9879\u76ee](https://github.com/api7/etcd-adapter)\u653e\u5728 API7.ai \u4ed3\u5e93\u91cc\u3002\u672a\u6765\uff0c\u6211\u4eec\u671f\u671b\u6301\u7eed\u6253\u78e8\u8fd9\u4e2a\u9879\u76ee\uff0c\u5f85\u9879\u76ee\u8fed\u4ee3\u5730\u6bd4\u8f83\u5b8c\u5584\u540e\uff0c\u4f1a\u628a\u5b83\u6350\u8d60\u7ed9 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\uff0c\u4f5c\u4e3a Apache APISIX \u7684\u5b50\u9879\u76ee\u8fdb\u884c\u5b75\u5316\uff0c\u4ece\u800c\u5438\u5f15\u5230\u66f4\u591a\u793e\u533a\u7684\u6709\u5fd7\u4e4b\u58eb\uff0c\u548c\u6211\u4eec\u4e00\u8d77\u5b8c\u5584\u8fd9\u4e2a\u9879\u76ee\uff0c\u8ba9 Apache APISIX \u7684\u751f\u6001\u66f4\u52a0\u5e9e\u5927\u3002"},{"id":"APISIX jwt-auth \u63d2\u4ef6\u5b58\u5728\u9519\u8bef\u54cd\u5e94\u4e2d\u6cc4\u9732\u4fe1\u606f\u7684\u98ce\u9669\u516c\u544a\uff08CVE-2022-29266\uff09","metadata":{"permalink":"/zh/blog/2022/04/20/cve-2022-29266","source":"@site/blog/2022/04/20/cve-2022-29266.md","title":"APISIX jwt-auth \u63d2\u4ef6\u5b58\u5728\u9519\u8bef\u54cd\u5e94\u4e2d\u6cc4\u9732\u4fe1\u606f\u7684\u98ce\u9669\u516c\u544a\uff08CVE-2022-29266\uff09","description":"\u5728 APISIX 2.13.0 \u53ca\u4e4b\u524d\u7248\u672c\u4e2d\uff0c\u5b58\u5728\u56e0 jwt-auth \u63d2\u4ef6\u5f15\u8d77\u7684\u4fe1\u606f\u6cc4\u6f0f\u95ee\u9898\uff0c\u73b0\u5c06\u5904\u7406\u4fe1\u606f\u8fdb\u884c\u76f8\u5173\u516c\u544a\u3002","date":"2022-04-20T00:00:00.000Z","formattedDate":"2022\u5e744\u670820\u65e5","tags":[{"label":"Vulnerabilities","permalink":"/zh/blog/tags/vulnerabilities"}],"readingTime":1.515,"truncated":true,"authors":[],"prevItem":{"title":"\u57fa\u4e8e TiDB \u7684 API \u7f51\u5173\u9ad8\u53ef\u7528\u914d\u7f6e\u6700\u4f73\u5b9e\u8df5","permalink":"/zh/blog/2022/04/22/apisix-with-tidb-practice"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff084.1-4.14\uff09","permalink":"/zh/blog/2022/04/20/weekly-report-0420"}},"content":"> \u5728 APISIX 2.13.0 \u53ca\u4e4b\u524d\u7248\u672c\u4e2d\uff0c\u5b58\u5728\u56e0 jwt-auth \u63d2\u4ef6\u5f15\u8d77\u7684\u4fe1\u606f\u6cc4\u6f0f\u95ee\u9898\uff0c\u73b0\u5c06\u5904\u7406\u4fe1\u606f\u8fdb\u884c\u76f8\u5173\u516c\u544a\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u95ee\u9898\u63cf\u8ff0\\n\\n`jwt-auth` \u63d2\u4ef6\u5b58\u5728\u6cc4\u9732\u7528\u6237\u79d8\u94a5\u7684\u5b89\u5168\u95ee\u9898\uff0c\u56e0\u4e3a\u4ece\u4f9d\u8d56\u5e93 `lua-resty-jwt` \u8fd4\u56de\u7684\u9519\u8bef\u4fe1\u606f\u4e2d\u5305\u542b\u654f\u611f\u4fe1\u606f\u3002\\n\\n## \u5f71\u54cd\u7248\u672c\\n\\nApache APISIX 2.13.0 \u53ca\u5176\u4e4b\u524d\u5168\u90e8\u7248\u672c\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n1. \u8bf7\u7acb\u5373\u5347\u7ea7\u81f3 Apache APISIX 2.13.1 \u53ca\u4ee5\u4e0a\u7248\u672c\u3002\\n2. \u5982\u679c\u4e0d\u65b9\u4fbf\u66f4\u65b0\u7248\u672c\uff0c\u8bf7\u5728 Apache APISIX \u4e0a\u5b89\u88c5\u5bf9\u5e94\u7248\u672c\u7684\u8865\u4e01\u5305\uff0c\u5b9e\u73b0\u91cd\u6784\uff0c\u4ee5\u7ed5\u8fc7\u8be5\u6f0f\u6d1e\uff08\u8865\u4e01\u5305\u5b89\u88c5\u4e14\u751f\u6548\u540e\uff0c\u8c03\u7528\u65b9\u63a5\u6536\u5230\u7684\u9519\u8bef\u4fe1\u606f\u5c06\u4e3a\u4fee\u590d\u540e\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u4e0d\u518d\u5305\u542b\u654f\u611f\u4fe1\u606f\uff09\u3002\\n\\n\u4ee5\u4e0b\u8865\u4e01\u5305\u9002\u7528\u4e8e LTS 2.13.x \u6216\u4e3b\u7248\u672c\uff1a\\n\\n- https://github.com/apache/apisix/pull/6846\\n- https://github.com/apache/apisix/pull/6847\\n- https://github.com/apache/apisix/pull/6858\\n\\n\u4ee5\u4e0b\u8865\u4e01\u5305\u9002\u7528\u4e8e\u6700\u65b0\u7684 LTS 2.10.x \u7248\u672c\uff1a\\n\\n- https://github.com/apache/apisix/pull/6847\\n- https://github.com/apache/apisix/pull/6855\\n\\n## \u6f0f\u6d1e\u8be6\u60c5\\n\\n- \u6f0f\u6d1e\u4f18\u5148\u7ea7\uff1a\u7d27\u6025\\n- \u6f0f\u6d1e\u516c\u5f00\u65f6\u95f4\uff1a2022 \u5e74 4 \u6708 20 \u65e5\\n- CVE \u8be6\u7ec6\u4fe1\u606f\uff1ahttps://nvd.nist.gov/vuln/detail/CVE-2022-29266\\n\\n## \u8d21\u732e\u8005\u7b80\u4ecb\\n\\n\u8be5\u6f0f\u6d1e\u7531\u91d1\u8776\u8f6f\u4ef6(\u4e2d\u56fd)\u6709\u9650\u516c\u53f8\u7684\u5510\u5fe0\u8fdc\u3001\u8c22\u9e3f\u5cf0\u548c\u9648\u5175\u53d1\u73b0\u5e76\u62a5\u544a\uff0c\u611f\u8c22\u5404\u4f4d\u5bf9 Apache APISIX \u793e\u533a\u7684\u8d21\u732e\u3002\\n\\n![Kingdee logo](https://static.apiseven.com/202108/1650768035541-306d3c7d-cbd4-4b79-ad9c-9f916549b8e7.png)"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff084.1-4.14\uff09","metadata":{"permalink":"/zh/blog/2022/04/20/weekly-report-0420","source":"@site/blog/2022/04/20/weekly-report-0420.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff084.1-4.14\uff09","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2022-04-20T00:00:00.000Z","formattedDate":"2022\u5e744\u670820\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.565,"truncated":true,"authors":[],"prevItem":{"title":"APISIX jwt-auth \u63d2\u4ef6\u5b58\u5728\u9519\u8bef\u54cd\u5e94\u4e2d\u6cc4\u9732\u4fe1\u606f\u7684\u98ce\u9669\u516c\u544a\uff08CVE-2022-29266\uff09","permalink":"/zh/blog/2022/04/20/cve-2022-29266"},"nextItem":{"title":"Apache APISIX Summit ASIA 2022 \u91cd\u78c5\u6765\u88ad","permalink":"/zh/blog/2022/04/12/apisix-summit-asia-2022"}},"content":"> \u4ece 4.1 \u5230 4.14\uff0c \u6709 36 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 75 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1650441551212-28a65a2f-0d84-4f7d-a06e-fda4d072fff6.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1650441612598-a27f8798-8f70-44e7-8c11-207173f776d4.png)\\n\\n## Good first issue\\n\\n### Issue #6803\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/6803\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5f53\u7528\u6237\u5728 Apache APISIX \u4e2d\u4f7f\u7528 `openid-connect` \u63d2\u4ef6\u65f6\uff0c\u4f7f\u7528\u4e86\u9519\u8bef\u7684 `redirect_uri`\uff0c\u5982\u4e0b\uff1a\\n\\n```Bash\\n  \\"plugins\\":{\\n        \\"openid-connect\\":{\\n              ...\\n            \\"scope\\":\\"openid profile\\",\\n            \\"bearer_only\\":false,\\n            \\"introspection_endpoint_auth_method\\":\\"client_secret_post\\",\\n            \\"redirect_uri\\":\\"http://127.0.0.1:9080/\\"\\n             ...\\n        }\\n    },\\n```\\n\\n\u7136\u540e\u8bf7\u6c42 \\"127.0.0.1:9080/\\"\uff0c\u5c06\u8df3\u8f6c\u5230 500 \u9875\u9762\uff0c\u9519\u8bef\u65e5\u5fd7\u5982\u4e0b\uff1a\\n\\n![500\u9875\u9762](https://static.apiseven.com/202108/1650442371592-ad0c26f6-e3ab-49d8-a5cb-f2b033d87a91.png)\\n\\n```YAML\\n2022/04/07 17:13:50 [error] 31780#3492140: *1959 [lua] openidc.lua:1378: authenticate(): request to the redirect_uri path but there\'s no session state found, client: 127.0.0.1, server: _, request: \\"GET / HTTP/1.1\\", host: \\"127.0.0.1:9080\\"\\n2022/04/07 17:13:50 [error] 31780#3492140: *1959 [lua] openid-connect.lua:304: phase_func(): OIDC authentication failed: request to the redirect_uri path but there\'s no session state found, client: 127.0.0.1, server: _, request: \\"GET / HTTP/1.1\\", host: \\"127.0.0.1:9080\\"\\n```\\n\\n\u8fd9\u6837\u7684\u65e5\u5fd7\u975e\u5e38\u4e0d\u6e05\u695a\uff0c\u5e76\u4e14\u7528\u6237\u4e0d\u77e5\u9053\u4f1a\u53d1\u751f\u4ec0\u4e48\u3002\u6240\u4ee5\u5e94\u8be5\u6539\u8fdb\u9519\u8bef\u65e5\u5fd7\uff0c\u4ee5\u63d0\u9ad8\u4f7f\u7528 `openid-connect` \u63d2\u4ef6\u7684\u4f53\u9a8c\u3002\\n\\n### Issue #6797\\n\\n**\u94fe\u63a5**:https://github.com/apache/apisix/issues/6797\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5f53\u4f7f\u7528 `file-logger` \u63d2\u4ef6\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49 `/dev/stdout` \u5c06\u65e5\u5fd7\u53d1\u9001\u5230 stdout\u3002\u8fd9\u662f\u4e3a\u4e86\u4f7f\u7528 Docker \u8f93\u51fa\u5e76\u5c06\u5176\u5728 Kubernetes \u4e2d\u4f20\u9012\u5230 ELK \u5806\u6808\u3002\u4f46\u662f\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u4e00\u4e2a\u62a5\u9519\uff0c\u8868\u660e\u5f53\u524d\u7528\u6237\u7684\u6743\u9650\u88ab\u62d2\u7edd\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [`key-auth` \u652f\u6301\u9690\u85cf\u8ba4\u8bc1\u76f8\u5173\u7684\u8bf7\u6c42 header](https://github.com/apache/apisix/pull/6670)\uff08\u8d21\u732e\u8005\uff1a[bin-ya](https://github.com/bin-ya)\uff09\\n\\n- [\u652f\u6301 ZooKeeper \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0](https://github.com/apache/apisix/pull/6751)\uff08\u8d21\u732e\u8005\uff1a[shuaijinchao](https://github.com/shuaijinchao)\uff09\\n\\n- [`request-id` \u652f\u6301 nanoid \u4f5c\u4e3a ID \u751f\u6210\u7b97\u6cd5](https://github.com/apache/apisix/pull/6779)\uff08\u8d21\u732e\u8005\uff1a[aikin-vip](https://github.com/aikin-vip)\uff09\\n\\n- [`response-rewrite` \u652f\u6301\u7528\u8fc7\u6ee4\u5668\u6765\u4fee\u6539\u54cd\u5e94\u4f53](https://github.com/apache/apisix/pull/6750)\uff08\u8d21\u732e\u8005\uff1a[kwanhur](https://github.com/kwanhur)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u5b98\u5ba3\uff01API \u7f51\u5173 Apache APISIX Summit ASIA 2022 \u91cd\u78c5\u6765\u88ad](https://apisix.apache.org/zh/blog/2022/04/12/apisix-summit-asia-2022)\uff1a\\n\\n\u4e3a\u4e86\u5e2e\u52a9\u66f4\u591a\u7684\u4f01\u4e1a\u3001\u5f00\u53d1\u8005\u53ca\u5f00\u6e90\u7231\u597d\u8005\u4e86\u89e3\u5e76\u4f7f\u7528 Apache APISIX\uff0c\u540c\u65f6\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u9879\u76ee\u7684\u6700\u65b0\u8fdb\u5c55\u548c\u52a8\u6001\uff0cApache APISIX \u793e\u533a\u5c06\u4e8e 2022 \u5e74 5 \u6708 20-21 \u65e5\u901a\u8fc7\u300c\u7ebf\u4e0a\u76f4\u64ad\u300d\u7684\u65b9\u5f0f\u4e3e\u529e Apache APISIX Summit ASIA 2022\u3002"},{"id":"Apache APISIX Summit ASIA 2022 \u91cd\u78c5\u6765\u88ad","metadata":{"permalink":"/zh/blog/2022/04/12/apisix-summit-asia-2022","source":"@site/blog/2022/04/12/apisix-summit-asia-2022.md","title":"Apache APISIX Summit ASIA 2022 \u91cd\u78c5\u6765\u88ad","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u793e\u533a\u5c06\u4e8e 2022 \u5e74 5 \u6708 20-21 \u65e5\u901a\u8fc7\u300c\u7ebf\u4e0a\u76f4\u64ad\u300d\u7684\u65b9\u5f0f\u4e3e\u529e Apache APISIX Summit ASIA 2022\u3002","date":"2022-04-12T00:00:00.000Z","formattedDate":"2022\u5e744\u670812\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":7.235,"truncated":true,"authors":[],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff084.1-4.14\uff09","permalink":"/zh/blog/2022/04/20/weekly-report-0420"},"nextItem":{"title":"Apache APISIX 2.13.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/03/28/release-apache-apisix-2.13"}},"content":"> Apache APISIX \u793e\u533a\u5c06\u4e8e 2022 \u5e74 5 \u6708 20-21 \u65e5\u901a\u8fc7\u300c\u7ebf\u4e0a\u76f4\u64ad\u300d\u7684\u65b9\u5f0f\u4e3e\u529e Apache APISIX Summit ASIA 2022\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n[\u70b9\u51fb\u6b64\u5904](https://apisix-summit.org/)\u524d\u5f80 **Apache APISIX Summit ASIA 2022** \u5927\u4f1a\u5b98\u7f51\u3002\\n\\n![\u6d3b\u52a8\u6d77\u62a5](https://static.apiseven.com/202108/1649729812376-b05269c8-90b9-4d73-b97e-463beb351d1d.png)\\n\\n## \u5927\u4f1a\u4ecb\u7ecd\\n\\nApache APISIX \u81ea 2019 \u5e74 6 \u6708 6 \u65e5\u6b63\u5f0f\u5f00\u6e90\u540e\uff0c\u5c31\u4ee5\u793e\u533a\u7684\u65b9\u5f0f\u5feb\u901f\u6210\u957f\u3002\u77ed\u77ed\u4e24\u5e74\u591a\u7684\u65f6\u95f4\uff0c\u5168\u7403\u8d21\u732e\u8005\u5c31\u5df2\u7a81\u7834 400 \u4f4d\uff0c\u4e14\u4eba\u6570\u4ecd\u5728\u5feb\u901f\u589e\u957f\u3002\u5728\u6b64\u671f\u95f4\uff0cApache APISIX \u793e\u533a\u4e5f\u9646\u7eed\u6536\u83b7\u4e86\u6765\u81ea\u56fd\u5185\u5916\u5f00\u53d1\u8005\u4eec\u7684\u8ba4\u53ef\u3002\\n\\n\u4f5c\u4e3a\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0cApache APISIX \u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u5feb\u901f\u3001\u5b89\u5168\u5730\u5904\u7406 API \u548c\u5fae\u670d\u52a1\u6d41\u91cf\uff0c\u53ef\u5e94\u7528\u4e8e\u7f51\u5173\u3001Kubernetes Ingress \u548c\u670d\u52a1\u7f51\u683c\u7b49\u573a\u666f\u3002\u76ee\u524d\uff0c\u5168\u7403\u5df2\u6709\u6570\u767e\u5bb6\u4f01\u4e1a\u4f7f\u7528 Apache APISIX \u5904\u7406\u5173\u952e\u4e1a\u52a1\u6d41\u91cf\uff0c\u6db5\u76d6\u91d1\u878d\u3001\u4e92\u8054\u7f51\u3001\u5236\u9020\u3001\u96f6\u552e\u3001\u8fd0\u8425\u5546\u7b49\u7b49\u3002\\n\\n\u4e3a\u4e86\u5e2e\u52a9\u66f4\u591a\u7684\u4f01\u4e1a\u3001\u5f00\u53d1\u8005\u53ca\u5f00\u6e90\u7231\u597d\u8005\u4e86\u89e3\u5e76\u4f7f\u7528 Apache APISIX\uff0c\u540c\u65f6\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u9879\u76ee\u7684\u6700\u65b0\u8fdb\u5c55\u548c\u52a8\u6001\uff0cApache APISIX \u793e\u533a\u5c06\u4e8e 2022 \u5e74 5 \u6708 20-21 \u65e5\u901a\u8fc7\u300c\u7ebf\u4e0a\u76f4\u64ad\u300d\u7684\u65b9\u5f0f\u4e3e\u529e Apache APISIX Summit ASIA 2022\u3002\\n\\n\u6765\u81ea API7.ai\u3001\u963f\u91cc\u4e91\u3001\u817e\u8baf\u4e91\u3001\u817e\u8baf\u84dd\u9cb8\u3001WPS\u3001\u96ea\u7403\u3001VMware Tanzu\u3001Beeto\u3001\u5353\u76df\u79d1\u6280\u3001\u864e\u7259\u3001\u53c8\u62cd\u4e91\u7b49\u516c\u53f8\u7684\u6280\u672f\u5927\u4f6c\uff0c\u5c06\u5e26\u6765 Apache APISIX \u6700\u524d\u6cbf\u7684\u5e94\u7528\u548c\u5b9e\u6218\u5206\u4eab\u3002\\n\\n\u8fd8\u6709\u66f4\u591a\u91cd\u78c5\u5609\u5bbe\uff1a\u718a\u98de\uff08\u7ecf\u7eac\u6295\u521b\u5408\u4f19\u4eba\uff09\u3001\u5434\u665f\uff08Apache Member\uff09\u3001\u5355\u81f4\u8c6a\uff08\u817e\u8baf\u5f00\u6e90\u8054\u76df\u4e3b\u5e2d\uff09\u3001\u6e29\u94ed\uff08Apahce APISIX PMC \u4e3b\u5e2d\uff09\u3001\u6f58\u5a1f\uff08SphereEx \u8054\u5408\u521b\u59cb\u4eba&CTO\uff09\u3001\u7fdf\u4f73\uff08StreamNative \u8054\u5408\u521b\u59cb\u4eba\uff09\u3001\u738b\u6654\u501e\uff08API7.ai \u5408\u4f19\u4eba\uff09\u3001\u738b\u5b87\u535a\uff08\u4e9a\u9a6c\u900a\u5f00\u53d1\u8005\u5173\u7cfb\u603b\u76d1\uff09\u3001\u5468\u5c0f\u56db\uff08\u9752\u4e91\u5bb9\u5668\u5e73\u53f0\u8d1f\u8d23\u4eba\u3001KubeSphere \u521b\u59cb\u4eba\uff09\uff0c\u4e00\u8d77\u8ba8\u8bba\u5f00\u6e90\u57fa\u7840\u8f6f\u4ef6\u3001\u56fd\u9645\u5316\u4e0e\u751f\u6001\u5efa\u8bbe\u7b49\u8bdd\u9898\u3002\\n\\n## \u8bae\u9898\u4fe1\u606f\\n\\n### The Future of Apache APISIX: Empowering API Connectivities in the Digital World\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649753814098-6c7fa7d6-bac0-4f72-bcba-9367b7e4c59b.png\\" alt=\\"\u6e29\u94ed\\" style={{width: \\"300px\\"}} />\\n\\n\u6e29\u94ed\uff0cApache APISIX PMC \u4e3b\u5e2d\uff0cAPI7.ai \u8054\u5408\u521b\u59cb\u4eba\\n\\n### \u5f00\u6e90\u4ea7\u54c1\u901a\u8fc7\u793e\u533a\u751f\u6001\u8d70\u5411\u5168\u7403\u7684\u8def\u5f84\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754170526-0567dfa2-e092-42b9-b489-818844d5f60e.png\\" alt=\\"\u718a\u98de\\" style={{width: \\"300px\\"}} />\\n\\n\u718a\u98de\uff0c\u7ecf\u7eac\u6295\u521b\u5408\u4f19\u4eba\\n\\n### \u4f01\u4e1a\u5bf9\u5f00\u6e90\u7684\u6b63\u786e\u8ba4\u8bc6\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754208008-9a1c1c42-7443-4a05-bfc7-6bfada38be9b.png\\" alt=\\"\u5434\u665f\\" style={{width: \\"300px\\"}} />\\n\\n\u5434\u665f\uff0cTetrate \u521b\u59cb\u5de5\u7a0b\u5e08\uff0cApache SkyWalking \u521b\u59cb\u4eba\\n\\n### Apache APISIX Roadmap\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754287122-ffd70624-526e-4e47-8944-ea675e8cafb2.png\\" alt=\\"\u738b\u9662\u751f\\" style={{width: \\"300px\\"}} />\\n\\n\u738b\u9662\u751f\uff0cApache APISIX PMC \u6210\u5458\uff0cAPI7.ai \u8054\u5408\u521b\u59cb\u4eba&CTO\\n\\n### \u57fa\u4e8e Apache APISIX \u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\u5e73\u53f0\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754397286-265b70cd-00fb-4618-a2fb-b8ed3f156879.png\\" alt=\\"\u9648\u5e86\\" style={{width: \\"300px\\"}} />\\n\\n\u9648\u5e86\uff0c\u5353\u76df\u79d1\u6280\u8fd0\u7ef4\u67b6\u6784\u5e08\\n\\n### \u57fa\u4e8e Apache APISIX \u5168\u94fe\u8def\u7070\u5ea6\u80fd\u529b\u7684\u8bbe\u8ba1\u4e0e\u751f\u4ea7\u5b9e\u8df5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754486535-2384e0d3-09eb-4a4f-9749-f9eb789eefdf.png\\" alt=\\"\u6cee\u5723\u4f1f\\" style={{width: \\"300px\\"}} />\\n\\n\u6cee\u5723\u4f1f\uff0c\u963f\u91cc\u4e91\u5fae\u670d\u52a1\u4ea7\u54c1\u7814\u53d1\u5de5\u7a0b\u5e08\\n\\n### How to Secure an App Out of the Box with Apache APISIX and Keycloak?\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754632367-a2c926b8-38cd-46e6-a37c-15d09dfc58fc.png\\" alt=\\"Jean-Philippe GOUIN\\" style={{width: \\"300px\\"}} />\\n\\nJean-Philippe GOUIN\uff0cVMware Tanzu Labs Product Manager\\n\\n### Head of API Experience and Operations\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754730088-df00e488-4b91-41d4-a504-e007dbc7bb36.png\\" alt=\\"Daniel Kocot\\" style={{width: \\"300px\\"}} />\\n\\nDaniel Kocot\uff0cVMware Tanzu Labs Product Manager\\n\\n### \u57fa\u4e8e Apache APISIX \u4e0e RocketMQ \u6253\u9020\u4e91\u539f\u751f\u4e00\u4f53\u5316\u67b6\u6784\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754840337-d341f228-50aa-4b0f-9825-dff00a2694d9.png\\" alt=\\"\u675c\u6052\\" style={{width: \\"300px\\"}} />\\n\\n\u675c\u6052\uff0c\u963f\u91cc\u4e91\u9ad8\u7ea7\u6280\u672f\u4e13\u5bb6\uff0cApache RocketMQ PMC \u6210\u5458\\n\\n### \u5927\u89c4\u6a21 Apache APISIX \u573a\u666f\u4e0b\u7684 etcd \u6cbb\u7406\u5b9e\u8df5 - Kstone\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754905828-8662cabb-f2b7-484f-8853-364839f89fca.png\\" alt=\\"\u738b\u8d85\u51e1\\" style={{width: \\"300px\\"}} />\\n\\n\u738b\u8d85\u51e1\uff0c\u817e\u8baf\u4e91 TKE \u96c6\u7fa4\u7ba1\u7406\u8d1f\u8d23\u4eba\\n\\n### Use Apache APISIX on Kubernetes\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754972861-8ec9eced-075a-421f-835f-6ebf0811f967.jpg\\" alt=\\"\u5f20\u8d85\\" style={{width: \\"300px\\"}} />\\n\\n\u5f20\u8d85\uff0cApache APISIX PMC \u6210\u5458\uff0cAPI7.ai \u6280\u672f\u4e13\u5bb6\\n\\n### \u4ece\u7f51\u5173\u5230\u5168\u6d41\u91cf\u4ee3\u7406 Apache APISIX \u7684\u670d\u52a1\u7f51\u683c\u6f14\u8fdb\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649755032049-b35c2f44-aecc-4dce-8768-4b2500dfc4d4.png\\" alt=\\"\u5f20\u664b\u6d9b\\" style={{width: \\"300px\\"}} />\\n\\n\u5f20\u664b\u6d9b\uff0cApache APISIX PMC \u6210\u5458\uff0cAPI7.ai \u6280\u672f\u4e13\u5bb6\\n\\n### \u57fa\u4e8e Apache APISIX \u7684\u84dd\u9cb8 API \u7f51\u5173\u8bbe\u8ba1\u4e0e\u5e94\u7528\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649755117432-8b365e5e-eced-4363-8564-adeb81a006b8.png\\" alt=\\"\u9648\u777f\\" style={{width: \\"300px\\"}} />\\n\\n\u9648\u777f\uff0c\u817e\u8baf\u84dd\u9cb8\u5bb9\u5668\u5e73\u53f0\u5fae\u670d\u52a1\u9879\u76ee\u8d1f\u8d23\u4eba\\n\\n### \u670d\u52a1\u7f51\u683c\u5982\u4f55\u63d0\u4f9b\u5e73\u53f0\u7ea7\u7684\u5fae\u670d\u52a1\u6cbb\u7406\u80fd\u529b\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649755167267-a7759d7f-7864-4f2b-b7a7-1a2b5d1aa8d3.png\\" alt=\\"\u53e4\u7426\\" style={{width: \\"300px\\"}} />\\n\\n\u53e4\u7426\uff0c\u963f\u91cc\u4e91\u4e91\u539f\u751f\u5e94\u7528\u5e73\u53f0\u6280\u672f\u4e13\u5bb6\\n\\n### Apache APISIX \u5728\u96ea\u7403\u7684\u751f\u4ea7\u5b9e\u8df5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649755370572-5e134779-223e-4eec-9a96-857667131f0b.png\\" alt=\\"\u77f3\u6587\u6770\\" style={{width: \\"300px\\"}} />\\n\\n\u77f3\u6587\u6770\uff0c\u96ea\u7403\u8d44\u6df1\u5f00\u53d1\u5de5\u7a0b\u5e08\\n\\n### APISIX Ingress \u5728\u53c8\u62cd\u4e91\u7684\u843d\u5730\u5b9e\u8df5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649755492680-bd78091d-380a-491d-8e44-eb67cbcab7f6.png\\" alt=\\"\u9648\u5353\\" style={{width: \\"300px\\"}} />\\n\\n\u9648\u5353\uff0c\u53c8\u62cd\u4e91\u8d44\u6df1\u7cfb\u7edf\u5f00\u53d1\u5de5\u7a0b\u5e08\\n\\n### Apache APISIX \u5728\u91d1\u5c71\u529e\u516c\u7684\u5f00\u53d1\u548c\u843d\u5730\u5b9e\u8df5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649755650884-e463be09-c151-4b7d-9c90-3b6e942b9baf.png\\" alt=\\"\u5f20\u5f3a\\" style={{width: \\"300px\\"}} />\\n\\n\u5f20\u5f3a\uff0cWPS \u4e91\u5e73\u53f0\u7f51\u5173\u8d1f\u8d23\u4eba\\n\\n### \u4e2d\u4e1c\u793e\u4ea4\u4ea7\u54c1 Beeto \u7684 Apache APISIX \u5173\u5e94\u7528\u5b9e\u8df5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649755834307-fe88fc18-4385-4593-9cb5-b63c82344918.png\\" alt=\\"\u80e1\u4e3d\u9e9f\\" style={{width: \\"300px\\"}} />\\n\\n\u80e1\u4e3d\u9e9f\uff0cBeeto \u5e73\u53f0\u7814\u53d1\u603b\u76d1\\n\\n### Apache APISIX \u5728\u864e\u7259\u591a\u4e91\u63a5\u5165\u4e0b\u7684\u5b9e\u8df5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649755867711-ba0cb5c0-bf32-48e5-8417-777c98e946f6.png\\" alt=\\"\u5468\u5065\\" style={{width: \\"300px\\"}} />\\n\\n\u5468\u5065\uff0c\u864e\u7259\u9ad8\u7ea7 Java \u5f00\u53d1\u5de5\u7a0b\u5e08\\n\\n### \u5706\u684c\u4f1a\u8bae\uff1a\u5f00\u6e90\u57fa\u7840\u8f6f\u4ef6\u548c\u5546\u4e1a\u516c\u53f8\u7684\u5168\u7403\u5316\\n\\n#### \u4f1a\u8bae\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649753814098-6c7fa7d6-bac0-4f72-bcba-9367b7e4c59b.png\\" alt=\\"\u6e29\u94ed\\" style={{width: \\"300px\\"}} />\\n\\n\u6e29\u94ed\uff0cApache APISIX PMC \u4e3b\u5e2d\uff0cAPI7.ai \u8054\u5408\u521b\u59cb\u4eba\\n\\n<img src=\\"https://static.apiseven.com/202108/1649756082972-bc9125e7-75ea-4d49-9f77-2734f4e405ca.png\\" alt=\\"\u6f58\u5a1f\\" style={{width: \\"300px\\"}} />\\n\\n\u6f58\u5a1f\uff0cSphereEx \u8054\u5408\u521b\u59cb\u4eba&CTO\\n\\n<img src=\\"https://static.apiseven.com/202108/1649756136470-95ae5822-cb1f-4e52-bc07-b1012bddad70.png\\" alt=\\"\u5355\u81f4\u8c6a\\" style={{width: \\"300px\\"}} />\\n\\n\u5355\u81f4\u8c6a\uff0c\u817e\u8baf\u5f00\u6e90\u8054\u76df\u4e3b\u5e2d\\n\\n<img src=\\"https://static.apiseven.com/202108/1649756182945-e22cb5c9-c74b-4f1d-81db-0784c17f305c.jpg\\" alt=\\"\u7fdf\u4f73\\" style={{width: \\"300px\\"}} />\\n\\n\u7fdf\u4f73\uff0cStreamNative \u8054\u5408\u521b\u59cb\u4eba\\n\\n### \u5706\u684c\u4f1a\u8bae\uff1a\u751f\u6001\u5efa\u8bbe\u5bf9\u5f00\u6e90\u9879\u76ee\u7684\u91cd\u8981\u6027\\n\\n#### \u4f1a\u8bae\u5609\u5bbe\\n\\n<img src=\\"https://static.apiseven.com/202108/1649756270951-9479e9f2-c523-4927-a840-a6d2a8cf0b01.png\\" alt=\\"\u738b\u6654\u501e\\" style={{width: \\"300px\\"}} />\\n\\n\u738b\u6654\u501e\uff0c API7.ai \u5408\u4f19\u4eba&\u6280\u672f\u526f\u603b\u88c1\\n\\n<img src=\\"https://static.apiseven.com/202108/1649754208008-9a1c1c42-7443-4a05-bfc7-6bfada38be9b.png\\" alt=\\"\u5434\u665f\\" style={{width: \\"300px\\"}} />\\n\\n\u5434\u665f\uff0cTetrate \u521b\u59cb\u5de5\u7a0b\u5e08\uff0cApache SkyWalking \u521b\u59cb\u4eba\\n\\n<img src=\\"https://static.apiseven.com/202108/1649756372774-773e120d-3f67-419d-be0e-914579c24084.png\\" alt=\\"\u5468\u5c0f\u56db\\" style={{width: \\"300px\\"}} />\\n\\n\u5468\u5c0f\u56db\uff0c\u9752\u4e91\u79d1\u6280\u5bb9\u5668\u4e8b\u4e1a\u90e8\u8d1f\u8d23\u4eba\uff0cKubeSphere \u521b\u59cb\u4eba\\n\\n<img src=\\"https://static.apiseven.com/202108/1649756433342-96ad1548-7a66-4476-8288-03b108cb8dd3.jpg\\" alt=\\"\u738b\u5b87\u535a\\" style={{width: \\"300px\\"}} />\\n\\n\u738b\u5b87\u535a\uff0c\u4e9a\u9a6c\u900a\u4e91\u79d1\u6280\u5f00\u53d1\u8005\u5173\u7cfb\u603b\u76d1\\n\\n## \u53c2\u4e0e\u65b9\u5f0f\\n\\n\u626b\u63cf\u4e0b\u65b9\u4e8c\u7ef4\u7801\u6216[\u70b9\u51fb\u94fe\u63a5](http://hdxu.cn/vcGn3)\u5373\u53ef\u524d\u5f80\u62a5\u540d\u9884\u7ea6\u89c2\u770b\u76f4\u64ad\uff01\\n\\n<img src=\\"https://static.apiseven.com/202108/1649729975688-98b8a028-2261-4636-bbf2-c20ae9c63f8f.png\\" alt=\\"\u62a5\u540d\u4e8c\u7ef4\u7801\\" style={{width: \\"300px\\"}} />"},{"id":"Apache APISIX 2.13.0 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2022/03/28/release-apache-apisix-2.13","source":"@site/blog/2022/03/28/release-apache-apisix-2.13.md","title":"Apache APISIX 2.13.0 \u6b63\u5f0f\u53d1\u5e03","description":"\u5168\u65b0\u7684 LTS \u7248\u672c Apache APISIX 2.13.0 \u6b63\u5f0f\u53d1\u5e03\u3002\u8be5 LTS \u7248\u672c\u4e0d\u4ec5\u6027\u80fd\u66f4\u52a0\u7a33\u5b9a\uff0c\u800c\u4e14\u652f\u6301\u4e86\u66f4\u591a\u7684\u53ef\u89c2\u6d4b\u6027\u3001\u670d\u52a1\u53d1\u73b0\u63d2\u4ef6\u548c\u66f4\u5b8c\u5584\u7684\u591a\u8bed\u8a00\u5f00\u53d1\u4f53\u7cfb\u3002","date":"2022-03-28T00:00:00.000Z","formattedDate":"2022\u5e743\u670828\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":6.94,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","title":"Author","url":"https://github.com/spacewander","image_url":"https://avatars.githubusercontent.com/u/4161644?v=4","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://github.com/yzeng25.png","imageURL":"https://github.com/yzeng25.png"}],"prevItem":{"title":"Apache APISIX Summit ASIA 2022 \u91cd\u78c5\u6765\u88ad","permalink":"/zh/blog/2022/04/12/apisix-summit-asia-2022"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff083.1-3.14\uff09","permalink":"/zh/blog/2022/03/24/weekly-report-0314"}},"content":"> \u5168\u65b0\u7684 LTS \u7248\u672c Apache APISIX 2.13.0 \u6b63\u5f0f\u53d1\u5e03\u3002\u8be5 LTS \u7248\u672c\u4e0d\u4ec5\u6027\u80fd\u66f4\u52a0\u7a33\u5b9a\uff0c\u800c\u4e14\u652f\u6301\u4e86\u66f4\u591a\u7684\u53ef\u89c2\u6d4b\u6027\u3001\u670d\u52a1\u53d1\u73b0\u63d2\u4ef6\u548c\u66f4\u5b8c\u5584\u7684\u591a\u8bed\u8a00\u5f00\u53d1\u4f53\u7cfb\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u8ddd\u79bb Apache APISIX \u4e0a\u4e00\u6b21\u53d1\u5e03 LTS \u7248\u672c\u5df2\u7ecf\u8fc7\u53bb\u4e86\u5927\u534a\u5e74\u7684\u65f6\u95f4\uff0c\u4eca\u5929\uff0cApache APISIX \u793e\u533a\u5e26\u6765\u4e86\u4e00\u4e2a\u5168\u65b0\u7684 LTS \u7248\u672c\u2014\u20142.13.0\u3002\u8be5 LTS \u7248\u672c\u4e0d\u4ec5\u6027\u80fd\u66f4\u52a0\u7a33\u5b9a\uff0c\u800c\u4e14\u652f\u6301\u4e86\u66f4\u591a\u7684\u53ef\u89c2\u6d4b\u6027\u3001\u670d\u52a1\u53d1\u73b0\u63d2\u4ef6\u548c\u66f4\u5b8c\u5584\u7684\u591a\u8bed\u8a00\u5f00\u53d1\u4f53\u7cfb\u3002\\n\\n\u5982\u679c\u4f60\u5728\u8ffd\u6c42\u6574\u4f53\u7a33\u5b9a\u6027\u7684\u540c\u65f6\uff0c\u4e5f\u60f3\u5c1d\u8bd5\u4e00\u4e0b\u65b0\u529f\u80fd\uff0c\u4e0d\u59a8\u8003\u8651\u5c06\u73b0\u6709\u7684 Apache APISIX \u5347\u7ea7\u5230 2.13.0\u3002\u540e\u7eed\u793e\u533a\u4e5f\u4f1a\u5728 2.13.0 \u7248\u672c\u7684\u57fa\u7840\u4e0a\u53d1\u5e03\u4e00\u7cfb\u5217 patch \u7248\u672c\u3002\\n\\n![Apache APISIX 2.13.0 \u66f4\u65b0\u6982\u89c8](https://static.apiseven.com/202108/1648439024629-e286bd1f-ce1d-424e-a4c0-7ded1ab3d17e.png)\\n\\n## \u529f\u80fd\u66f4\u65b0\\n\\n### \u65b0\u53d8\u5316\uff1a\u4e0d\u518d\u9ed8\u8ba4\u66b4\u9732 API\\n\\n\u5728 2.13.0 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u5141\u8bb8\u63d2\u4ef6\u6ce8\u518c\u53ef\u4f9b\u5ba2\u6237\u7aef\u8c03\u7528\u7684 API\u3002\u4f8b\u5982\uff0c`jwt-auth` \u63d2\u4ef6\u4f1a\u6ce8\u518c\u4e00\u4e2a JWT \u7b7e\u540d\u7684\u63a5\u53e3\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u8bbf\u95ee\u8be5\u63a5\u53e3\uff0c\u4ee5\u751f\u6210\u7528\u4e8e\u6821\u9a8c\u7684\u7b7e\u540d\u3002\u4f46\u8fd9\u4e2a\u8bbe\u8ba1\u6709\u4e00\u4e2a\u6f5c\u5728\u7684\u7f3a\u9677\u2014\u2014\u7531\u4e8e\u66b4\u9732\u51fa\u6765\u7684\u662f\u63a5\u53e3\u800c\u4e0d\u662f\u8def\u7531\uff0c\u56e0\u6b64\u65e0\u6cd5\u50cf\u5bf9\u5f85\u8def\u7531\u4e00\u6837\u4e3a\u5176\u52a0\u5f3a\u5b89\u5168\u9632\u62a4\u3002\u867d\u7136\u73b0\u6709\u7684\u673a\u5236\u5141\u8bb8\u7528\u6237\u901a\u8fc7\u7f16\u5199\u5bf9\u5e94\u7684 plugin interceptor \u6765\u62e6\u622a\u63a5\u53e3\u8bbf\u95ee\uff0c\u4f46\u8fd9\u79cd\u65b9\u5f0f\u4ecd\u7136\u5b58\u5728\u5b89\u5168\u9690\u60a3\u3002\\n\\n**\u6240\u4ee5\u4ece 2.13.0 \u7248\u672c\u5f00\u59cb\uff0c\u6211\u4eec\u51b3\u5b9a\u505a\u51fa\u91cd\u5927\u53d8\u66f4\uff0c\u4e0d\u518d\u9ed8\u8ba4\u66b4\u9732 API\u3002**\u5982\u679c\u7528\u6237\u9700\u8981\u66b4\u9732\u63a5\u53e3\uff0c\u5219\u9700\u8981\u901a\u8fc7 `public-api` \u63d2\u4ef6\u5c06\u63a5\u53e3\u7ed1\u5b9a\u5230\u5bf9\u5e94\u7684\u8def\u7531\u4e0a\u3002\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u5e26\u6765\u4e24\u4e2a\u597d\u5904\uff1a\\n\\n1. \u6ce8\u518c\u7684 API \u4f1a\u6709\u66f4\u9ad8\u7684\u80fd\u89c1\u5ea6\uff0c\u76ee\u524d\u6ce8\u518c\u7684 API \u53ea\u6709\u901a\u8fc7\u663e\u793a\u914d\u7f6e\u624d\u4f1a\u751f\u6548\uff0c\u8bbf\u95ee\u65b9\u5f0f\u4e5f\u662f\u7531\u7528\u6237\u81ea\u5b9a\u4e49\u3002\\n2. \u5141\u8bb8\u91c7\u7528\u66f4\u591a\u7684\u5b89\u5168\u9632\u62a4\u9009\u9879\uff0c\u6ce8\u518c\u7684 API \u548c\u8def\u7531\u62e5\u6709\u540c\u6837\u7684\u6743\u9650\u63a7\u5236\u3002\\n\\n\u5f53\u7136\uff0c2.13.0 \u7248\u672c\u8fd8\u6709\u5176\u4ed6\u7684\u65b0\u53d8\u5316\uff0c\u6bd4\u5982\u4fee\u590d\u4e86\u5386\u53f2\u7248\u672c\u7684\u4e0d\u5408\u7406\u884c\u4e3a\u3002\u5982\u9700\u4e86\u89e3\u5177\u4f53\u4f18\u5316\u4fe1\u606f\uff0c\u8bf7\u67e5\u9605 [2.13.0 Changelog](https://github.com/apache/apisix/blob/release/2.13/docs/zh/latest/CHANGELOG.md#2130)\u3002\\n\\n### \u65b0\u529f\u80fd\uff1a\u53ef\u89c2\u6d4b\u6027\u5c42\u9762\u5bf9\u63a5\u66f4\u591a\u7684\u76d1\u63a7\u4f53\u7cfb\\n\\n\u4f5c\u4e3a API \u7f51\u5173\uff0cApache APISIX \u4e00\u76f4\u81f4\u529b\u4e8e\u8fde\u63a5\u66f4\u591a\u7684\u670d\u52a1\uff0c\u6253\u901a\u66f4\u591a\u7684\u53ef\u89c2\u6d4b\u6027\u4e0a\u4e0b\u6e38\u3002\u6211\u4eec\u5728\u6bcf\u4e2a\u7248\u672c\u90fd\u4f1a\u4e3a\u6b64\u6dfb\u7816\u52a0\u74e6\uff0c2.13.0 \u7248\u672c\u4e5f\u4e0d\u4f8b\u5916\u3002\\n\\n**\u8fd9\u6b21\u6211\u4eec\u65b0\u589e\u4e86\u4e00\u4e2a tracing \u63d2\u4ef6\uff1a`opentelemetry`\uff0c\u5141\u8bb8\u53d1\u9001 OpenTelemetry tracing \u6570\u636e\u5230\u914d\u7f6e\u7684 collector\u3002**\u4e0b\u9762\u7b80\u5355\u901a\u8fc7\u4e00\u4e2a\u793a\u4f8b\u6765\u770b\u4e00\u4e0b\u3002\\n\\n\u5728\u9759\u6001\u914d\u7f6e\u91cc\u9762\u8bbe\u7f6e\u4e86 collector\uff1a\\n\\n```yaml\\nplugin_attr:\\n  opentelemetry:\\n    resource:\\n      service.name: APISIX\\n      tenant.id: business_id\\n    collector:\\n      address: \\"127.0.0.1:4317\\"\\n    batch_span_processor:\\n      drop_on_queue_full: false\\n      max_queue_size: 6\\n      batch_timeout: 2\\n      inactive_timeout: 1\\n      max_export_batch_size: 2\\n```\\n\\n\u4e4b\u540e\u5c31\u53ef\u4ee5\u5728\u7279\u5b9a\u7684\u8def\u7531\u4e0a\u5f00\u542f tracing\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uris\\": [\\n        \\"/uid/*\\"\\n    ],\\n    \\"plugins\\": {\\n        \\"opentelemetry\\": {\\n            \\"sampler\\": {\\n                \\"name\\": \\"always_on\\"\\n            }\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:8089\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u547d\u4e2d\u8be5\u8def\u7531\u7684\u8bf7\u6c42\u5c06\u4f1a\u4e0a\u62a5 OpenTelemetry \u7684\u6570\u636e\u5230\u5bf9\u5e94\u7684 collector\u3002\\n\\n\u6b64\u5916\uff0c\u6211\u4eec\u8fd8\u65b0\u589e\u4e86\u4e24\u4e2a\u65e5\u5fd7\u63d2\u4ef6\uff0c\u652f\u6301\u628a\u65e5\u5fd7\u4e0a\u62a5\u5230 ClickHouse \u548c Loggly \u4e2d\u3002\\n\\nClickHouse \u662f\u5730\u8868\u6700\u5feb\u7684 OLAP \u6570\u636e\u5e93\u4e4b\u4e00\u3002Apache APISIX \u652f\u6301\u53d1\u9001 access log \u548c error log \u5230 ClickHouse\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n      \\"plugins\\": {\\n            \\"clickhouse-logger\\": {\\n                \\"user\\": \\"default\\",\\n                \\"password\\": \\"a\\",\\n                \\"database\\": \\"default\\",\\n                \\"logtable\\": \\"test\\",\\n                \\"endpoint_addr\\": \\"http://127.0.0.1:8123\\"\\n            }\\n       },\\n      \\"upstream\\": {\\n           \\"type\\": \\"roundrobin\\",\\n           \\"nodes\\": {\\n               \\"127.0.0.1:1980\\": 1\\n           }\\n      },\\n      \\"uri\\": \\"/hello\\"\\n}\'\\n```\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/plugin_metadata/error-log-logger  \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n  \\"clickhouse\\": {\\n      \\"user\\": \\"default\\",\\n      \\"password\\": \\"a\\",\\n      \\"database\\": \\"error_log\\",\\n      \\"logtable\\": \\"t\\",\\n      \\"endpoint_addr\\": \\"http://127.0.0.1:8123\\"\\n  }\\n}\'\\n```\\n\\nLoggly \u662f SolarWinds \u65d7\u4e0b\u7684\u65e5\u5fd7\u5904\u7406 SaaS \u5e73\u53f0\uff0c\u6211\u4eec\u652f\u6301\u901a\u8fc7 syslog \u6216 HTTP/HTTPS \u7684\u65b9\u5f0f\u53d1\u9001 access log\u3002\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n\u914d\u7f6e\u4e0a\u62a5\u65b9\u5f0f\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/plugin_metadata/loggly  \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n   \\"protocol\\": \\"http\\"\\n}\'\\n```\\n\\n\u914d\u7f6e\u9700\u8981\u4e0a\u62a5\u7684\u8def\u7531\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\":{\\n        \\"loggly\\":{\\n            \\"customer_token\\":\\"xxx\\",\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"127.0.0.1:80\\":1\\n        }\\n    },\\n    \\"uri\\":\\"/index.html\\"\\n}\'\\n```\\n\\n### \u66f4\u5b8c\u5584\u7684\u591a\u8bed\u8a00\u5f00\u53d1\u4f53\u7cfb\\n\\nApache APISIX \u81ea 2.11 \u7248\u672c\u8d77\u5f00\u59cb\u652f\u6301 Wasm\uff08Proxy Wasm SDK\uff09\uff0c\u4f46 LTS \u7248\u672c\u4e00\u76f4\u6ca1\u6709\u63d0\u4f9b\u76f8\u5e94\u652f\u6301\u3002\u5728\u6b64\u6b21\u53d1\u5e03\u7684 Apache APISIX 2.13.0 \u7248\u672c\u4e2d\uff0c\u6211\u4eec\u65b0\u589e\u5e76\u5b8c\u5584\u4e86\u8be5\u529f\u80fd\u3002\\n\\n\u5728\u7ecf\u8fc7\u534a\u5e74\u8d85\u8fc7 10000 \u884c\u4ee3\u7801\uff08\u5305\u62ec\u6d4b\u8bd5\u548c\u6587\u6863\uff09\u7684\u5f00\u53d1\u540e\uff0cAPISIX \u73b0\u5df2\u5168\u9762\u652f\u6301\u5728**\u5904\u7406\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u4f53\u3001\u54cd\u5e94\u5934\u3001\u54cd\u5e94\u4f53\u56db\u4e2a\u9636\u6bb5\u8fd0\u884c Wasm \u4ee3\u7801**\u30022.13.0 \u7248\u672c\u662f\u7b2c\u4e00\u4e2a\u652f\u6301 Wasm \u7684 LTS \u7248\u672c\uff0c\u53ef\u4ee5\u8bf4\u662f\u4e00\u4e2a\u65b0\u7684\u91cc\u7a0b\u7891\u3002\\n\\n\u9664\u4e86 Wasm \u4e4b\u5916\uff0c\u6211\u4eec\u4e5f\u6b63\u5728\u5f00\u53d1\u4f20\u7edf\u7684\u3001\u57fa\u4e8e RPC \u7684\u591a\u8bed\u8a00\u63d2\u4ef6\u4f53\u7cfb\u3002\u4e0d\u4e45\u4e4b\u524d\uff0c\u6211\u4eec\u53d1\u5e03\u4e86 Python Runner 0.2.0 \u7248\u672c\u3002\u51e0\u5929\u540e\uff0c\u6211\u4eec\u4e5f\u4f1a\u53d1\u5e03 Go Runner 0.3.0 \u7248\u672c\u3002\\n\\n## Bug \u4fee\u590d\\n\\n- SkyWalking \u548c OpenTelemetry \u6ca1\u6709\u8ffd\u8e2a\u8ba4\u8bc1\u5931\u8d25\u3002\\n- `log-rotate` \u5207\u5272\u65e5\u5fd7\u4e0d\u652f\u6301\u6309\u6574\u70b9\u5b8c\u6210\u3002\\n- `deepcopy` \u6ca1\u6709\u590d\u5236 `metatable`\u3002\\n- `request-validate` \u5bf9 JSON \u91cc\u9762\u91cd\u590d\u952e\u7684\u5904\u7406 \u3002\\n- `prometheus` \u91cd\u590d\u8ba1\u7b97\u6307\u6807\u3002\\n- \u5f53 `conf.headers` \u7f3a\u5931\u65f6\uff0c`proxy-rewrite` \u4e2d\u7684 `conf.method` \u4e0d\u751f\u6548 \u3002\\n- `traffic-split` \u9996\u6761\u89c4\u5219\u5931\u8d25\u65f6\u65e0\u6cd5\u5339\u914d\u3002\\n- etcd \u8d85\u65f6\u89e6\u53d1 `resync_delay` \u3002\\n- `proto` \u5b9a\u4e49\u51b2\u7a81\u3002\\n- `limit-count` \u914d\u7f6e\u4e0d\u53d8\uff0c\u91cd\u7f6e\u8ba1\u6570\u5668\u3002\\n- Admin API \u7684 `plugin-metadata` \u548c `global-rule` \u8ba1\u6570\u6709\u8bef\u3002\\n- \u5408\u5e76 route \u548c service \u65f6 labels \u4e22\u5931\u3002\\n\\n## \u66f4\u591a\u7ec6\u8282\\n\\n\u9664\u4e86\u4e0a\u8ff0\u529f\u80fd\u548c\u7ec4\u4ef6\u5916\uff0cApache APISIX 2.13.0 \u7248\u672c\u8fd8\u66f4\u65b0\u4e86\u5982\u4e0b\u529f\u80fd\uff1a\\n\\n- grpc-transcode \u652f\u6301\u901a\u8fc7 `.pb` \u6587\u4ef6\u5904\u7406\u5e26 import \u7684 proto \u5b9a\u4e49\u3002\\n- \u652f\u6301\u4ece K8s \u914d\u7f6e\u4e2d\u83b7\u53d6\u4e0a\u6e38\u8282\u70b9\u3002\\n- \u65b0\u589e `csrf` \u63d2\u4ef6\uff0c\u63d0\u4f9b\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\u9632\u62a4\u3002\\n- \u65b0\u589e `mocking` \u63d2\u4ef6\uff0c\u65b9\u4fbf\u751f\u6210\u6d4b\u8bd5\u6570\u636e\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff083.1-3.14\uff09","metadata":{"permalink":"/zh/blog/2022/03/24/weekly-report-0314","source":"@site/blog/2022/03/24/weekly-report-0314.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff083.1-3.14\uff09","description":"API \u7f51\u5173 Apache APISIX \u793e\u533a\u8fd1\u4e24\u5468\u65b0\u589e\u4e86 authz-keycloak \u63d2\u4ef6\u652f\u6301\u91cd\u5b9a\u5411\u975e\u6388\u6743\u7528\u6237\u3001csrf \u63d2\u4ef6\u652f\u6301\u68c0\u67e5\u4ee4\u724c\u662f\u5426\u8fc7\u671f\u3001proxy-mirror \u63d2\u4ef6\u652f\u6301\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u7b49\u529f\u80fd\u3002","date":"2022-03-24T00:00:00.000Z","formattedDate":"2022\u5e743\u670824\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":5.07,"truncated":true,"authors":[],"prevItem":{"title":"Apache APISIX 2.13.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/03/28/release-apache-apisix-2.13"},"nextItem":{"title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Eureka \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0","permalink":"/zh/blog/2022/03/05/apisix-integration-eureka-service-discovery"}},"content":"> \u4ece 3.1 \u5230 3.14\uff0c \u6709 44 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 131 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1647397912423-73900fe5-8155-4a3f-b609-79bf224ad7e1.jpg)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1647397912442-b726a867-fc81-45a6-bea1-c45beb71068f.png)\\n\\n## Good first issue\\n\\n### Issue #6344\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/6344\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4f5c\u4e3a\u4e00\u4e2a\u7528\u6237\uff0c\u6211\u60f3\u4f7f\u7528 `forward-auth` \u63d2\u4ef6\uff0c\u4f46\u8be5\u63d2\u4ef6\u4e0d\u652f\u6301\u5c06\u8bf7\u6c42\u4f53\u53d1\u9001\u5230\u6388\u6743\u670d\u52a1\u5668\u4e0a\u7684\u8ba4\u8bc1\u8868\u5355\u8bf7\u6c42\u4f53\uff0c\u6709\u529e\u6cd5\u652f\u6301\u5417\uff1f\\n\\n### Issue #6197\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/6197\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u76ee\u524d\uff0c`limit-count` \u63d2\u4ef6\u53ea\u8bbe\u7f6e\u4e86\u4e00\u79cd\u6d41\u91cf\u9650\u5236\u6a21\u5f0f\uff1a\u79d2\u6216\u5206\u949f\u3002\u4f46\u662f\uff0c\u8be5\u63d2\u4ef6\u4e0d\u652f\u6301\u540c\u65f6\u8bbe\u7f6e\u79d2\u548c\u5206\u949f\uff0c\u56e0\u4e3a\u7528\u6237\u540e\u9762\u8bbe\u7f6e\u7684\u5185\u5bb9\u4f1a\u8986\u76d6\u524d\u9762\u8bbe\u7f6e\u7684\u5185\u5bb9\uff0c\u662f\u5426\u6709\u529e\u6cd5\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1f\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [`open-connect` \u63d2\u4ef6\u652f\u6301\u8c03\u7528\u767b\u51fa\u63a5\u53e3\u540e\u60f3\u8981\u8df3\u8f6c\u7684\u5730\u5740](https://github.com/apache/apisix/pull/6455)\uff08\u8d21\u732e\u8005\uff1a[starsz](https://github.com/starsz)\uff09\\n\\n- [`ext-plugin` \u652f\u6301\u91cd\u5199 response headers](https://github.com/apache/apisix/pull/6426)\uff08\u8d21\u732e\u8005\uff1a[rampagecong](https://github.com/rampagecong)\uff09\\n\\n- [`proxy-mirror` \u63d2\u4ef6\u652f\u6301\u81ea\u5b9a\u4e49\u8def\u5f84](https://github.com/apache/apisix/pull/6506)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [WASM \u652f\u6301\u83b7\u53d6 response body](https://github.com/apache/apisix/pull/6514)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [\u652f\u6301\u8fd0\u884c\u7ed1\u5b9a\u5728 cousumer \u4e0a\u63d2\u4ef6\u7684 rewrite \u9636\u6bb5](https://github.com/apache/apisix/pull/6502)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [\u652f\u6301\u4ece `yaml` \u914d\u7f6e\u6587\u4ef6\u4e2d\u8bfb\u53d6\u73af\u5883\u53d8\u91cf](https://github.com/apache/apisix/pull/6505)\uff08\u8d21\u732e\u8005\uff1a[wilson-1024](https://github.com/wilson-1024)\uff09\\n\\n- [`authz-keycloak` \u63d2\u4ef6\u652f\u6301\u91cd\u5b9a\u5411\u975e\u6388\u6743\u7528\u6237](https://github.com/apache/apisix/pull/6485)\uff08\u8d21\u732e\u8005\uff1a[oil-oil](https://github.com/oil-oil)\uff09\\n\\n- [`cors` \u63d2\u4ef6\u652f\u6301\u8bbe\u7f6e\u5728 plugin metadata \u4e2d\u8bbe\u7f6e allow origins](https://github.com/apache/apisix/pull/6546)\uff08\u8d21\u732e\u8005\uff1a[Gary-Airwallex](https://github.com/Gary-Airwallex)\uff09\\n\\n- [`csrf` \u63d2\u4ef6\u652f\u6301\u68c0\u67e5\u4ee4\u724c\u662f\u5426\u8fc7\u671f](https://github.com/apache/apisix/pull/6201)\uff08\u8d21\u732e\u8005\uff1a[Baoyuantop](https://github.com/Baoyuantop)\uff09\\n\\n- [`jwt-auth` \u63d2\u4ef6\u652f\u6301\u6307\u5b9a\u83b7\u53d6 token \u7684\u4f4d\u7f6e](https://github.com/apache/apisix/pull/6561)\uff08\u8d21\u732e\u8005\uff1a[liangliang4ward](https://github.com/liangliang4ward)\uff09\\n\\n- [`proxy-mirror` \u63d2\u4ef6\u652f\u6301\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4](https://github.com/apache/apisix/pull/6562)\uff08\u8d21\u732e\u8005\uff1a[Gerrard-YNWA](https://github.com/Gerrard-YNWA)\uff09\\n\\n- [APISIX Dashboard \u652f\u6301\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u52a0\u8f7d\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6](https://github.com/apache/apisix-dashboard/pull/2293)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010) \u548c [kevinw66](https://github.com/kevinw66)\uff09\\n\\n- [APISIX Dashboard `limit` \u7cfb\u5217\u63d2\u4ef6 UI \u6dfb\u52a0\u6b20\u7f3a\u5b57\u6bb5](https://github.com/apache/apisix-dashboard/pull/2312)\uff08\u8d21\u732e\u8005\uff1a[oil-oil](https://github.com/oil-oil)\uff09\\n\\n- [APISIX Dashboard \u652f\u6301 UI \u914d\u7f6e Protocol Buffers](https://github.com/apache/apisix-dashboard/pull/2320)\uff08\u8d21\u732e\u8005\uff1a[oil-oil](https://github.com/oil-oil)\uff09\\n\\n- [APISIX Dashboard \u8def\u7531\u9ad8\u7ea7\u5339\u914d\u652f\u6301\u5904\u7406 \u201c!\u201d \u53d6\u53cd\u64cd\u4f5c\u7b26](https://github.com/apache/apisix-dashboard/pull/2364)\uff08\u8d21\u732e\u8005\uff1a[SkyeYoung](https://github.com/SkyeYoung)\uff09\\n\\n- [APISIX Dashboard \u652f\u6301 cors \u8be6\u7ec6\u914d\u7f6e](https://github.com/apache/apisix-dashboard/pull/2341)\uff08\u8d21\u732e\u8005\uff1a[zaunist](https://github.com/zaunist)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [API \u7f51\u5173 Apache APISIX \u96c6\u6210 Eureka \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0](https://apisix.apache.org/zh/blog/2022/03/05/apisix-integration-eureka-service-discovery/)\uff1a\\n\\n  \u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 API \u7f51\u5173 Apache APISIX \u4e2d\u542f\u7528 Eureka \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u8bca\u65ad\u5de5\u5177\u53d1\u73b0\u94fe\u8def\u4e2d\u51fa\u73b0\u7684\u95ee\u9898\u3002\\n\\n- [\u5316\u7e41\u4e3a\u7b80\uff0cApache APISIX \u96c6\u6210 ClickHouse \u63d2\u4ef6\u63d0\u5347\u5168\u94fe\u8def\u65e5\u5fd7\u6548\u7387](https://apisix.apache.org/zh/blog/2022/03/04/apigateway-clickhouse-makes-logging-easier)\uff1a\\n\\n  \u672c\u6587\u8bb2\u8ff0\u4e86\u793e\u533a\u8d21\u732e\u8005\u7941\u632f\u4e1c\u4e3a Apache APISIX \u8d21\u732e `clickhouse-logger` \u7684\u5386\u7a0b\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u8be5\u63d2\u4ef6\u7b80\u5316\u4e1a\u52a1\u67b6\u6784\uff0c\u63d0\u5347\u5168\u94fe\u8def\u65e5\u5fd7\u6548\u7387\u3002\\n\\n- [API \u7f51\u5173 Apache APISIX \u643a\u624b CoreDNS \u6253\u5f00\u670d\u52a1\u53d1\u73b0\u65b0\u5927\u95e8](https://apisix.apache.org/zh/blog/2022/03/04/apisix-uses-coredns-enable-service-discovery)\uff1a\\n\\n  \u4f5c\u4e3a\u4e91\u539f\u751f API \u7f51\u5173\uff0cApache APISIX \u4e5f\u96c6\u6210\u4e86\u591a\u79cd\u670d\u52a1\u53d1\u73b0\u7684\u80fd\u529b\uff0c\u672c\u6587\u5c06\u4e3a\u60a8\u5c55\u793a\u5728 Apache APISIX \u4e2d\u5982\u4f55\u914d\u7f6e CoreDNS\u3002\\n\\n- [\u5f00\u6e90\u4e91 IDE \u4ea7\u54c1\u65b0\u5ba0\u513f\uff0c\u5982\u4f55\u4f7f\u7528 Gitpod \u5f00\u53d1 API \u7f51\u5173 Apache APISIX\uff1f](https://apisix.apache.org/zh/blog/2022/03/03/develop-apisix-with-gitpod)\uff1a\\n\\n  \u672c\u6587\u4ecb\u7ecd\u4e86\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u548c\u4e91 IDE \u4ea7\u54c1 Gitpod\uff0c\u5e76\u4e3a\u5927\u5bb6\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Gitpod \u5bf9 API \u7f51\u5173 Apache APISIX \u8fdb\u884c\u5f00\u53d1\u53ca\u5e38\u89c1\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u3002"},{"id":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Eureka \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0","metadata":{"permalink":"/zh/blog/2022/03/05/apisix-integration-eureka-service-discovery","source":"@site/blog/2022/03/05/apisix-integration-eureka-service-discovery.md","title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Eureka \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4e2d\u542f\u7528 Eureka \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0\uff0c\u5e76\u4e14\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528\u8bca\u65ad\u5de5\u5177\u5feb\u901f\u53d1\u73b0\u94fe\u8def\u4e2d\u51fa\u73b0\u7684\u95ee\u9898\u3002","date":"2022-03-05T00:00:00.000Z","formattedDate":"2022\u5e743\u67085\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.83,"truncated":true,"authors":[{"name":"\u94b1\u52c7","title":"Author","url":"https://github.com/nic-6443","image_url":"https://avatars.githubusercontent.com/u/22141303?v=4","imageURL":"https://avatars.githubusercontent.com/u/22141303?v=4"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://avatars.githubusercontent.com/u/97138894?v=4","imageURL":"https://avatars.githubusercontent.com/u/97138894?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff083.1-3.14\uff09","permalink":"/zh/blog/2022/03/24/weekly-report-0314"},"nextItem":{"title":"API \u7f51\u5173\u96c6\u6210 ClickHouse \u63d2\u4ef6\u63d0\u5347\u5168\u94fe\u8def\u65e5\u5fd7\u6548\u7387","permalink":"/zh/blog/2022/03/04/apigateway-clickhouse-makes-logging-easier"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 API \u7f51\u5173 Apache APISIX \u4e2d\u542f\u7528 Eureka \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u8bca\u65ad\u5de5\u5177\u53d1\u73b0\u94fe\u8def\u4e2d\u51fa\u73b0\u7684\u95ee\u9898\u3002\\n\\n\x3c!--truncate--\x3e\\n\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u5927\u578b\u590d\u6742\u7684\u7cfb\u7edf\u6309\u529f\u80fd\u6216\u8005\u4e1a\u52a1\u9700\u6c42\u5782\u76f4\u5207\u5206\u6210\u66f4\u5c0f\u7684\u5b50\u7cfb\u7edf\uff0c\u8fd9\u4e9b\u5b50\u7cfb\u7edf\u4ee5\u72ec\u7acb\u90e8\u7f72\u7684\u5b50\u8fdb\u7a0b\u5b58\u5728\uff0c\u5b83\u4eec\u4e4b\u95f4\u901a\u8fc7\u7f51\u7edc\u8c03\u7528\u8fdb\u884c\u901a\u4fe1\u3002\u8fd9\u4e9b\u72ec\u7acb\u90e8\u7f72\u7684\u670d\u52a1\u5982\u4f55\u53d1\u73b0\u5bf9\u65b9\u6210\u4e3a\u4e86\u9996\u5148\u8981\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u5f80\u5f80\u90fd\u4f1a\u5b58\u5728\u4e00\u4e2a\u4e2d\u5fc3\u5316\u7684\u6ce8\u518c\u4e2d\u5fc3\u3002\\n\\nSpring \u4f5c\u4e3a Java \u751f\u6001\u4e2d\u6700\u6838\u5fc3\u7684\u5f00\u53d1\u6846\u67b6\uff0c\u4ece Spring MVC \u5230 Spring Boot \u6301\u7eed\u4e0d\u65ad\u89e3\u653e\u7740 Java \u5f00\u53d1\u8005\u7684\u751f\u4ea7\u529b\uff0c\u800c Spring Cloud \u662f Spring \u9762\u5411\u4e91\u539f\u751f\u65f6\u4ee3\u5fae\u670d\u52a1\u67b6\u6784\u7ed9\u51fa\u7684\u7b54\u6848\u3002\\n\\n\u5728 Spring Cloud \u4e2d\uff0cEureka \u5c31\u626e\u6f14\u4e86\u6ce8\u518c\u4e2d\u5fc3\u7684\u89d2\u8272\u3002Eureka \u662f\u4e00\u6b3e\u7531 Netflix \u5f00\u6e90\uff0c\u4f7f\u7528 Java \u8bed\u8a00\u7f16\u5199\u7684\u6ce8\u518c\u4e2d\u5fc3\u670d\u52a1\uff0c\u5176\u5728 Netflix \u7684\u57fa\u7840\u8bbe\u65bd\u4e2d\u626e\u6f14\u7740\u91cd\u8981\u89d2\u8272\u3002\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u4f5c\u4e3a\u4e1a\u754c\u9886\u5148\u7684\u5fae\u670d\u52a1 API \u7f51\u5173\uff0c\u5bf9 Eureka \u63d0\u4f9b\u4e86\u539f\u751f\u652f\u6301\u3002\u672c\u6587\u5c06\u4f1a\u4f7f\u7528 Spring Cloud \u6f14\u793a\u9879\u76ee\u4f5c\u4e3a\u6848\u4f8b\uff0c\u4e3a\u5927\u5bb6\u5c55\u793a Apache APISIX \u5bf9\u63a5 Eureka \u670d\u52a1\u53d1\u73b0\u7684\u4e3b\u8981\u529f\u80fd\u53ca\u7279\u6027\u3002\\n\\n## \u51c6\u5907\u9636\u6bb5\\n\\n\u672c\u6b21\u6f14\u793a\u4f7f\u7528 Spring \u5b98\u65b9\u63d0\u4f9b\u7684 [`spring-cloud-netflix`](https://spring.io/projects/spring-cloud-netflix#overview) \u6559\u7a0b\u4f5c\u4e3a\u793a\u4f8b\uff0c\u8be5\u6559\u7a0b\u4e2d\u63d0\u4f9b\u4e86\u4f7f\u7528 SpringBoot \u542f\u52a8\u7684 Eureka Server \u4f5c\u4e3a Spring Cloud \u7684\u6ce8\u518c\u4e2d\u5fc3\uff0c\u6211\u4eec\u4e5f\u4f7f\u7528\u76f8\u540c\u7684\u65b9\u5f0f\u6765\u542f\u52a8\u7528\u4e8e\u6f14\u793a\u7684 Eureka \u670d\u52a1\u7aef\u3002\u8be5\u9879\u76ee\u5730\u5740\u8bf7\u8bbf\u95ee [`spring-cloud-samples/eureka`](https://github.com/spring-cloud-samples/eureka\uff0c)\u3002\\n\\n\u63a5\u4e0b\u6765\u5c06\u4e3a\u60a8\u4ecb\u7ecd\u76f8\u5173\u4ee3\u7801\u548c\u542f\u52a8\u65b9\u5f0f\u3002\\n\\n## Eureka Server\\n\\nSpring Cloud \u4e3a Eureka \u63d0\u4f9b\u4e86\u4e00\u4e2a `EnableEurekaServer` \u7684\u6ce8\u89e3\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ee5 Spring Boot \u7684\u65b9\u5f0f\u542f\u52a8\u4e00\u4e2a Eureka Server\u3002\\n\\n\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```Java\\n@SpringBootApplication\\n@EnableEurekaServer\\npublic class EurekaApplication {\\n        public static void main(String[] args) {\\n                SpringApplication.run(EurekaApplication.class\uff0cargs);\\n        }\\n}\\n```\\n\\n\u542f\u52a8\u65b9\u5f0f\u53ef\u76f4\u63a5\u53c2\u8003\u4e0b\u65b9\u4ee3\u7801\uff1a\\n\\n```Shell\\ngit clone git@github.com:spring-cloud-samples/eureka.git\\n# \u5728\u9879\u76ee\u6839\u76ee\u5f55\u6267\u884c\\n./gradlew bootRun\\n```\\n\\n`resources` \u76ee\u5f55\u4e2d\u7684 `application.yml` \u6587\u4ef6\u5b9a\u4e49\u4e86 Eureka Server \u76d1\u542c\u5728 `8761` \u7aef\u53e3\u3002\\n\\n```YAML\\nserver:\\n  port: 8761\\n```\\n\\n### \u63a5\u5165 Eureka Client \u7684 HTTP \u670d\u52a1\\n\\n\u4e0e `EnableEurekaServer` \u5bf9\u5e94\u7684\u5ba2\u6237\u7aef\u6ce8\u89e3\u662f `EnableEurekaClient`\uff0c\u4f7f\u7528 `EnableEurekaClient` \u53ef\u4ee5\u975e\u5e38\u7b80\u5355\u5f97\u5c06\u4e00\u4e2a\u4f7f\u7528 Spring Boot \u542f\u52a8\u7684 HTTP \u5e94\u7528\u6ce8\u518c\u5230 Eureka \u4e0a\u3002\\n\\n\u4ee5\u4e0b\u4e3a\u793a\u4f8b\u4ee3\u7801\uff1a\\n\\n```Java\\n@SpringBootApplication\\n@EnableEurekaClient\\n@RestController\\npublic class Application {\\n\\n        @Value(\\"${server.port}\\")\\n        int serverPort;\\n\\n        @RequestMapping(\\"/\\")\\n        public String home() {\\n                return String.format(\\"server-%s\\",serverPort);\\n        }\\n\\n        public static void main(String[] args) {\\n                new SpringApplicationBuilder(Application.class).web(WebApplicationType.SERVLET).run(args);\\n        }\\n\\n}\\n```\\n\\n\u8fd9\u91cc\u6211\u4eec\u5728 `/` \u8def\u5f84\u4e0a\u66b4\u9732\u4e00\u4e2a HTTP \u670d\u52a1\uff0c\u8fd4\u56de\u5f53\u524d Spring Boot \u4f7f\u7528\u7684\u7aef\u53e3\uff0c\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u542f\u52a8\u591a\u4e2a\u5b9e\u4f8b\uff0c\u6765\u6f14\u793a APISIX \u5bf9\u6ce8\u518c\u5230 Eureka \u7684\u670d\u52a1\u7aef\u5b9e\u4f8b\u5217\u8868\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u7684\u6548\u679c\u3002\\n\\n\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\uff1a\\n\\n```JAVA\\nspring.application.name=a-bootiful-client #\u5c06\u4f1a\u4f5c\u4e3a\u6ce8\u518c\u5230 Eureka \u4e2d\u7684 application name\\nserver.port=8080 # \u4fee\u6539\u76d1\u542c\u7aef\u53e3\u4ee5\u542f\u52a8\u591a\u4e2a\u5b9e\u4f8b\\n```\\n\\n\u8bbe\u7f6e\u76d1\u542c\u7aef\u53e3\u4e3a `8080`\uff0c`8081`\uff0c`8082`\uff0c\u5e76\u542f\u52a8\u4e09\u4e2a Spring Boot \u5b9e\u4f8b\uff0c\u5b8c\u6210\u540e\uff0c\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee Eureka Server \u7684 `8761` \u7aef\u53e3\uff0c\u53ef\u4ee5\u67e5\u770b\u670d\u52a1\u6ce8\u518c\u7684\u7ed3\u679c\u3002\\n\\n![error/results example.png](https://static.apiseven.com/202108/1646350535070-7615a784-df05-4e94-a88e-b039c111de53.png)\\n\\n\u60a8\u53ef\u4ee5\u770b\u5230\u5e94\u7528 `A-BOOTIFUL-CLIENT` (\u6ce8\u610f\uff1aspring.application.name \u88ab\u5168\u90e8\u8f6c\u4e3a\u5927\u5199\u5b57\u7b26)\u4e0b\u6ce8\u518c\u4e86\u4e09\u4e2a\u5b9e\u4f8b\uff0c\u5206\u522b\u66b4\u9732\u4e86 `8080`\uff0c`8081`\uff0c`8082` \u7aef\u53e3\uff0c\u5e76\u4e14\u5747\u5904\u4e8e UP \u72b6\u6001\u3002\\n\\n## \u4f7f\u7528 APISIX \u4ee3\u7406 SpringCloud \u5e94\u7528\\n\\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u4f1a\u5b9e\u73b0\u5982\u4e0b\u56fe\u6240\u793a\u7684\u8bf7\u6c42\u94fe\u8def\uff1a\\n\\n![error/request link.png](https://static.apiseven.com/202108/1646350644536-7b68a4a3-b523-4c82-8e19-822624ff2c95.png)\\n\\n### \u542f\u52a8 Apache APISIX\\n\\n\u9996\u5148\uff0c\u9700\u8981\u5728 Apache APISIX \u7684\u914d\u7f6e\u6587\u4ef6 `config.yaml` \u4e2d\u627e\u5230 `apisix.discovery`\uff0c\u4fee\u6539 Eureka Server \u8fde\u63a5\u4fe1\u606f\u7684\u76f8\u5173\u914d\u7f6e\uff0c\u5e76\u542f\u52a8 APISIX\u3002\\n\\n```YAML\\n  discovery:                       # service discovery center\\n      eureka:\\n        host:                        # it\'s possible to define multiple eureka hosts addresses of the same eureka cluster.\\n          - \\"http://172.23.79.129:8761\\" # Access address of Eureka Server started by Spring Boot\\n        prefix: /eureka/\\n        fetch_interval: 30           # default 30s\\n        weight: 100                  # default weight for node\\n        timeout:\\n          connect: 2000              # default 2000ms\\n          send: 2000                 # default 2000ms\\n          read: 5000                 # default 5000ms\\n\\n```\\n\\n### \u521b\u5efa\u8def\u7531\\n\\n\u521b\u5efa\u4e00\u4e2a Route\uff0c\u5e76\u5728 Upstream \u4e2d\u914d\u7f6e\u542f\u7528 Eureka Service Discovery \u63d2\u4ef6\u3002\\n\\n- `upstream.discovery_type` \u4e3a `eureka`\u3002\\n- `upstream.service_name` \u662f\u5e94\u7528\u5728 Eureka \u4e2d\u6ce8\u518c\u7684\u5e94\u7528\u540d `A-BOOTIFUL-CLIENT`\u3002\\n\\n```Shell\\ncurl http://172.30.45.72:9180/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n    \\"uri\\": \\"/*\\",\\n    \\"host\\": \\"eureka-demo\\",\\n    \\"upstream\\": {\\n        \\"service_name\\": \\"A-BOOTIFUL-CLIENT\\",\\n        \\"type\\": \\"roundrobin\\",\\n        \\"discovery_type\\": \\"eureka\\"\\n    }\\n}\'\\n```\\n\\n### \u8bf7\u6c42\u8def\u7531\\n\\n\u4f7f\u7528 `curl` \u547d\u4ee4\u8fdb\u884c\u591a\u6b21\u8bf7\u6c42\uff0c\u9a8c\u8bc1\u8d1f\u8f7d\u5747\u8861\u6548\u679c\u3002\\n\\n```Shell\\n$ curl http://172.30.45.72:9080/ -H \\"Host: eureka-demo\\"\\nserver-8081%\\n$ curl http://172.30.45.72:9080/ -H \\"Host: eureka-demo\\"\\nserver-8080%\\n$ curl http://172.30.45.72:9080/ -H \\"Host: eureka-demo\\"\\nserver-8082%\\n$ curl http://172.30.45.72:9080/ -H \\"Host: eureka-demo\\"\\nserver-8081%\\n$ curl http://172.30.45.72:9080/ -H \\"Host: eureka-demo\\"\\nserver-8080%\\n$ curl http://172.30.45.72:9080/ -H \\"Host: eureka-demo\\"\\nserver-8082%\\n```\\n\\n\u4ece\u4e0a\u8ff0\u8fd4\u56de\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u8bf7\u6c42\u88ab\u4f9d\u6b21\u5206\u914d\u5230 Eureka \u4e2d\u6ce8\u518c\u7684\u4e09\u4e2a\u5b9e\u4f8b\u4e0a\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u662f `roundrobin`\uff0c\u6240\u6709\u7684\u540e\u7aef\u5b9e\u4f8b\u4f1a\u88ab\u8f6e\u6d41\u5206\u914d\u8bf7\u6c42\u3002\\n\\n### \u6a21\u62df\u5b9e\u4f8b\u5b95\u673a\\n\\n\u5173\u95ed\u5176\u4e2d `8081` \u5b9e\u4f8b\uff0c\u6a21\u62df\u5b9e\u4f8b\u5b95\u673a\u573a\u666f\uff0c\u89c2\u5bdf\u8bf7\u6c42\u6548\u679c\u3002\\n\\n```Shell\\n$ while true; do curl http://172.30.45.72:9080/ -H \\"Host: eureka-demo\\"; echo; sleep 1; done\\n\\nserver-8080\\nserver-8082\\nserver-8081\\n\\nserver-8080\\nserver-8082\\nserver-8081\\n\\nserver-8080\\nserver-8082\\n\\nserver-8080\\nserver-8082\\n```\\n\\n\u7531\u4e0a\u8ff0\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff0c\u5173\u95ed `8081` \u5b9e\u4f8b\u540e\uff0cApache APISIX \u4f1a\u53ca\u65f6\u540c\u6b65\u5230 Eureka \u7684\u6700\u65b0\u5b9e\u4f8b\u5217\u8868\uff0c\u7136\u540e\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u6b63\u786e\u7684\u540e\u7aef\u3002\\n\\n### \u8bca\u65ad\u5de5\u5177\\n\\n\u5728\u5fae\u670d\u52a1\u7cfb\u7edf\u4e2d\uff0c\u7ecf\u5e38\u4f1a\u9047\u5230\u975e\u9884\u671f\u8f6c\u53d1\u7684\u95ee\u9898\uff0c\u8fd9\u4e9b\u95ee\u9898\u7684\u539f\u56e0\u53ef\u80fd\u6765\u81ea\u670d\u52a1\u53d1\u73b0\u4e2d\u7684\u5404\u4e2a\u94fe\u8def\uff0c\u4f8b\u5982\uff1a\u5ba2\u6237\u7aef\u6ce8\u518c\u5f02\u5e38\uff0c\u6ce8\u518c\u4e2d\u5fc3\u672c\u8eab\u6570\u636e\u5f02\u5e38\uff0c\u7f51\u5173\u8bfb\u53d6\u6ce8\u518c\u6570\u636e\u5f02\u5e38\u7b49\u7b49\uff0c\u56e0\u6b64\u53d1\u751f\u5f02\u5e38\u65f6\u94fe\u8def\u4e2d\u53ef\u4ee5\u4f7f\u7528\u7684\u8bca\u65ad\u5de5\u5177\u5c06\u4f1a\u5c24\u4e3a\u91cd\u8981\u3002\\n\\n\u6240\u4ee5 APISIX \u5728 Service Discovery \u63d2\u4ef6\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8bca\u65ad\u63a5\u53e3\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u67e5\u8be2\u51fa\u5f53\u524d\u7f51\u5173\u6b63\u5728\u4f7f\u7528\u7684\u670d\u52a1\u5217\u8868\uff0c\u7ed3\u5408\u6ce8\u518c\u4e2d\u5fc3\u7684\u63a7\u5236\u53f0\uff0c\u6211\u4eec\u5c31\u5bf9\u7f51\u5173\u5230\u6ce8\u518c\u4e2d\u5fc3\u8fd9\u4e00\u94fe\u8def\u505a\u51fa\u5feb\u901f\u8bca\u65ad\u3002\\n\\n\u8bca\u65ad\u63a5\u53e3\u9ed8\u8ba4\u66b4\u9732\u5728\u56de\u73af\u63a5\u53e3\u7684 `9090` \u7aef\u53e3\uff0c\u8bbf\u95ee\u65b9\u5f0f\u4e3a `GET /v1/discovery/{discovery_type}/dump`\uff0c\u4f8b\uff1a\\n\\n```Shell\\ncurl http://localhost:9090/v1/discovery/eureka/dump\\n\\n{\\n  \\"services\\": {\\n    \\"A-BOOTIFUL-CLIENT\\": [\\n      {\\n        \\"weight\\": 100,\\n        \\"metadata\\": {\\n          \\"management.port\\": \\"8081\\"\\n        },\\n        \\"host\\": \\"192.168.50.164\\",\\n        \\"port\\": 8081\\n      },\\n      {\\n        \\"weight\\": 100,\\n        \\"metadata\\": {\\n          \\"management.port\\": \\"8080\\"\\n        },\\n        \\"host\\": \\"192.168.50.164\\",\\n        \\"port\\": 8080\\n      },\\n      {\\n        \\"weight\\": 100,\\n        \\"metadata\\": {\\n          \\"management.port\\": \\"8082\\"\\n        },\\n        \\"host\\": \\"192.168.50.164\\",\\n        \\"port\\": 8082\\n      }\\n    ]\\n  },\\n  \\"config\\": {\\n    \\"prefix\\": \\"\\\\/eureka\\\\/\\",\\n    \\"timeout\\": {\\n      \\"connect\\": 2000,\\n      \\"send\\": 2000,\\n      \\"read\\": 5000\\n    },\\n    \\"fetch_interval\\": 30,\\n    \\"host\\": [\\n      \\"http:\\\\/\\\\/172.23.79.129:8761\\"\\n    ],\\n    \\"weight\\": 100\\n  }\\n}\\n```\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u793a\u4f8b\u5c31\u53ef\u4ee5\u67e5\u8be2\u5230 APISIX \u6b63\u5728\u4f7f\u7528\u7684 Eureka \u6570\u636e\u3002\\n\\n## \u603b\u7ed3\\n\\nSpring Cloud \u662f\u4e00\u4e2a\u5e7f\u53d7\u7528\u6237\u6b22\u8fce\u7684\u5fae\u670d\u52a1\u6846\u67b6\uff0c\u800c Apache APISIX \u901a\u8fc7\u652f\u6301 Eureka Service Discovery \u63d0\u4f9b\u4e86\u5904\u7406 Spring Cloud \u5e94\u7528\u6d41\u91cf\u7684\u80fd\u529b\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8fd9\u4e24\u4e2a\u751f\u6001\u7684\u7d27\u5bc6\u7ed3\u5408\uff0c\u8ba9\u5fae\u670d\u52a1\u67b6\u6784\u7684\u843d\u5730\u53d8\u5f97\u66f4\u52a0\u7b80\u5355\u9ad8\u6548\uff0c\u4ece\u800c\u8ba9\u4e1a\u52a1\u5f00\u53d1\u53ef\u4ee5\u66f4\u52a0\u7684\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u4ef7\u503c\u3002\\n\\n\u5173\u4e8e `eureka` \u63d2\u4ef6\u7684\u66f4\u591a\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u4fe1\u606f\uff0c\u53ef\u53c2\u8003 [Apache APISIX \u5b98\u7f51\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/discovery#%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%EF%BC%9F)\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41."},{"id":"API \u7f51\u5173\u96c6\u6210 ClickHouse \u63d2\u4ef6\u63d0\u5347\u5168\u94fe\u8def\u65e5\u5fd7\u6548\u7387","metadata":{"permalink":"/zh/blog/2022/03/04/apigateway-clickhouse-makes-logging-easier","source":"@site/blog/2022/03/04/apigateway-clickhouse-makes-logging-easier.md","title":"API \u7f51\u5173\u96c6\u6210 ClickHouse \u63d2\u4ef6\u63d0\u5347\u5168\u94fe\u8def\u65e5\u5fd7\u6548\u7387","description":"\u672c\u6587\u8bb2\u8ff0\u4e86\u793e\u533a\u8d21\u732e\u8005\u7941\u632f\u4e1c\u4e3a\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8d21\u732e `clickhouse-logger` \u7684\u5386\u7a0b\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u8be5\u63d2\u4ef6\u7b80\u5316\u4e1a\u52a1\u67b6\u6784\uff0c\u63d0\u5347\u5168\u94fe\u8def\u65e5\u5fd7\u6548\u7387\u3002","date":"2022-03-04T00:00:00.000Z","formattedDate":"2022\u5e743\u67084\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":9.425,"truncated":true,"authors":[{"name":"\u7941\u632f\u4e1c","title":"Author","url":"https://github.com/zhendongcmss","image_url":"https://github.com/zhendongcmss.png","imageURL":"https://github.com/zhendongcmss.png"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://github.com/yzeng25.png","imageURL":"https://github.com/yzeng25.png"}],"prevItem":{"title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Eureka \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0","permalink":"/zh/blog/2022/03/05/apisix-integration-eureka-service-discovery"},"nextItem":{"title":"API \u7f51\u5173 APISIX \u643a\u624b CoreDNS \u6253\u5f00\u670d\u52a1\u53d1\u73b0\u65b0\u5927\u95e8","permalink":"/zh/blog/2022/03/04/apisix-uses-coredns-enable-service-discovery"}},"content":"> \u672c\u6587\u4f5c\u8005\u7941\u632f\u4e1c\uff0c\u6765\u81ea\u4e2d\u56fd\u79fb\u52a8\u4e91\u80fd\u529b\u4e2d\u5fc3\u3002\u4ece\u4e8b\u5206\u5e03\u5f0f\u5bf9\u8c61\u5b58\u50a8\u8f6f\u4ef6\u5f00\u53d1\u5de5\u4f5c\uff0c\u53c2\u4e0e\u79fb\u52a8\u4e91\u591a\u4e2a\u8d44\u6e90\u6c60\u7684\u5efa\u8bbe\u5de5\u4f5c\uff0c\u5728\u5bf9\u8c61\u5b58\u50a8\u9886\u57df\u6709\u4e30\u5bcc\u7684\u5b9e\u6218\u7ecf\u9a8c\u3002\u672c\u6587\u8bb2\u8ff0\u4e86\u793e\u533a\u8d21\u732e\u8005\u7941\u632f\u4e1c\u4e3a Apache APISIX \u8d21\u732e `clickhouse-logger` \u7684\u5386\u7a0b\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u8be5\u63d2\u4ef6\u7b80\u5316\u4e1a\u52a1\u67b6\u6784\uff0c\u63d0\u5347\u5168\u94fe\u8def\u65e5\u5fd7\u6548\u7387\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f5c\u4e3a API \u7f51\u5173\uff0cApache APISIX \u62e5\u6709\u591a\u79cd\u7c7b\u578b\u7684\u5b9e\u7528\u63d2\u4ef6\u3002\u5f97\u76ca\u4e8e Apache APISIX \u7684\u63d2\u4ef6\u70ed\u52a0\u8f7d\u673a\u5236\uff0c\u6211\u4eec\u65e0\u9700\u91cd\u542f\u4fbf\u53ef\u542f\u7528\u63d2\u4ef6\u3001\u4fee\u6539\u63d2\u4ef6\u914d\u7f6e\u548c\u505c\u7528\u63d2\u4ef6\u3002\\n\\nClickHouse \u7531 Yandex \u5f00\u53d1\uff0c\u5728 2016 \u5e74\u5f00\u6e90\u3002ClickHouse \u4e0d\u6b62\u662f\u4e00\u4e2a\u6570\u636e\u5e93\uff0c \u4e5f\u662f\u4e00\u4e2a\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5b83\u5141\u8bb8\u5728\u8fd0\u884c\u65f6\u521b\u5efa\u8868\u548c\u6570\u636e\u5e93\u3001\u52a0\u8f7d\u6570\u636e\u548c\u8fd0\u884c\u67e5\u8be2\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u914d\u7f6e\u6216\u91cd\u542f\u670d\u52a1\u3002\\n\\n\u968f\u7740\u8d8a\u6765\u8d8a\u591a\u7684\u516c\u53f8\u5f00\u59cb\u5c06\u4e1a\u52a1\u8fc1\u79fb\u4e0a\u4e91\uff0c\u5982\u4f55\u9ad8\u6548\u5730\u5b9e\u73b0\u65e5\u5fd7\u6536\u53d1\u53ca\u65e5\u5fd7\u5206\u6790\uff0c\u589e\u5f3a\u7cfb\u7edf\u7684\u53ef\u89c2\u6d4b\u6027\u6210\u4e3a\u4e86\u4e00\u4e2a\u96be\u9898\u3002\u4e2d\u56fd\u79fb\u52a8\u4e91\u80fd\u529b\u4e2d\u5fc3\u4f5c\u4e3a\u4e00\u5bb6\u63d0\u4f9b\u516c\u6709\u4e91\u670d\u52a1\u7684\u4f01\u4e1a\uff0c\u524d\u671f\u57fa\u4e8e Apache APISIX \u7684\u4e1a\u52a1\u65e5\u5fd7\u6536\u53d1\u548c\u548c\u5206\u6790\u7cfb\u7edf\u7684\u67b6\u6784\u5927\u81f4\u662f\u8fd9\u6837\u7684\u3002\\n\\n![initial bussiness architecture](https://static.apiseven.com/202108/1646363723740-f92d6a39-64e0-4464-8c44-c73832362bf6.png)\\n\\n\u968f\u7740\u4e1a\u52a1\u7684\u589e\u957f\uff0c\u4e0a\u8ff0\u65b9\u6848\u4e0d\u4ec5\u7ef4\u62a4\u6210\u672c\u5947\u9ad8\uff0c\u800c\u4e14\u96be\u4ee5\u6ee1\u8db3\u6211\u4eec\u5bf9\u4e8e\u7cbe\u7ec6\u5316\u6570\u636e\u5206\u6790\u7684\u9700\u6c42\u3002\u7531\u4e8e rsyslog \u63a5\u6536\u5230\u7684\u6570\u636e\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u800c\u4e0d\u662f JSON \u683c\u5f0f\u7684\u65e5\u5fd7\uff0c\u7ed9\u65e5\u5fd7\u5206\u6790\u5e26\u6765\u4e86\u4e00\u5b9a\u7684\u96be\u5ea6\u3002\\n\\n\u8ba1\u7b97\u673a\u9886\u57df\u6709\u53e5\u540d\u8a00\uff1a \u201c\u4efb\u4f55\u95ee\u9898\u90fd\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u4e00\u4e2a\u95f4\u63a5\u7684\u4e2d\u95f4\u5c42\u6765\u89e3\u51b3\u201d\u3002\u6211\u4eec\u5176\u5b9e\u4e5f\u8003\u8651\u8fc7\u5728 `tcp-logger` \u548c rsyslog \u4e4b\u95f4\u518d\u52a0\u4e00\u4e2a\u4e2d\u95f4\u5c42\uff0c\u4f7f\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a JSON\u3002\u4f46\u8fd9\u663e\u7136\u4e0d\u662f\u957f\u4e45\u4e4b\u8ba1\u3002\\n\\n\u6240\u4ee5\u6211\u4eec\u6362\u4e86\u4e00\u79cd\u601d\u8def\u53bb\u770b\u5f85\u8fd9\u4e2a\u95ee\u9898\uff1a\u5982\u679c\u628a\u73b0\u6709\u67b6\u6784\u4e2d\u7684\u201ctcp-logger+rsyslog+Promtail+Loki\u201d\u770b\u4f5c\u662f\u4e00\u4e2a\u5de8\u5927\u7684\u4e2d\u95f4\u5c42\uff0c\u90a3\u4e48\u4e0d\u8bba\u6211\u4eec\u5728\u8fd9\u4e2d\u95f4\u600e\u4e48\u6dfb\u52a0\u989d\u5916\u7684\u4e2d\u95f4\u5c42\uff0c\u9664\u4e86\u80fd\u89e3\u51b3\u71c3\u7709\u4e4b\u6025\u5916\uff0c\u53ea\u4f1a\u4f7f\u5b83\u53d8\u5f97\u66f4\u52a0\u81c3\u80bf\u548c\u96be\u4ee5\u7ef4\u62a4\u3002\u5e02\u9762\u4e0a\u6709\u6ca1\u6709\u4e00\u4e2a\u4ea7\u54c1\u80fd\u76f4\u63a5\u628a\u201ctcp-logger+rsyslog+Promtail+Loki\u201d\u7ed9\u66ff\u6362\u6389\u5462\uff1f\\n\\n\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u82b1\u4e86\u4e9b\u65f6\u95f4\u8fdb\u884c\u8c03\u7814\uff0c\u6700\u7ec8\u9009\u62e9 ClickHouse \u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u70b9\u539f\u56e0\u3002\\n\\n1. ClickHouse \u63d0\u4f9b HTTP \u63a5\u53e3\uff0c\u65b9\u4fbf\u5176\u5b83\u6a21\u5757\u8c03\u7528\u3002\\n2. \u57fa\u4e8e ClickHouse \u7684\u5206\u6790\u5de5\u5177\u94fe\u5f88\u6210\u719f\uff0c\u80fd\u591f\u6ee1\u8db3\u6211\u4eec\u5bf9\u65e5\u5fd7\u5206\u6790\u7684\u9700\u6c42\u3002\\n3. ClickHouse \u652f\u6301\u4f7f\u7528\u5bf9\u8c61\u5b58\u50a8\u4f5c\u4e3a\u5b58\u50a8\u5f15\u64ce\uff0c\u975e\u5e38\u65b9\u4fbf\u3002\\n4. \u6ca1\u6709\u5fc5\u8981\u81ea\u5df1\u91cd\u590d\u201c\u9020\u8f6e\u5b50\u201d\u3002\\n\\n\u63a5\u4e0b\u6765\u5c31\u53ea\u5269\u4e0b\u4e00\u4e2a\u95ee\u9898\u9700\u8981\u89e3\u51b3\u4e86\uff1a\u5982\u4f55\u5b9e\u73b0 Apache APISIX \u548c ClickHouse \u4e4b\u95f4\u7684\u5bf9\u63a5\uff1f\u4ee5\u63d2\u4ef6\u7684\u5f62\u5f0f\u5b9e\u73b0\u5bf9\u63a5\u5176\u5b9e\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u65b9\u6cd5\u3002\u4f5c\u4e3a Apache APISIX \u793e\u533a\u7684\u4e00\u5458\uff0c\u6211\u4e00\u76f4\u90fd\u5728\u793e\u533a\u91cc\u9762\u201c\u6f5c\u6c34\u201d\uff0c\u770b\u5230\u4e86\u6700\u8fd1 Apache APISIX \u5728\u751f\u6001\u65b9\u9762\u7684\u6301\u7eed\u8fdb\u6b65\uff0c\u5176\u5b9e\u6211\u4e5f\u6709\u4e9b\u5fc3\u52a8\uff0c\u4e00\u76f4\u5728\u4f7f\u7528 Apache APISIX\uff0c\u4f46\u8fd8\u6ca1\u6709\u7ed9\u793e\u533a\u8d21\u732e\u8fc7\u4ee3\u7801\uff0c\u4e0d\u5982\u5c31\u501f\u8fd9\u4e2a\u673a\u4f1a\u4e3a\u793e\u533a\u7684\u751f\u6001\u53d1\u5c55\u6dfb\u4e00\u628a\u706b\u5427\u3002\\n\\n## ClickHouse \u63d2\u4ef6\u5b9e\u73b0\u539f\u7406\\n\\n`clickhouse-logger` \u63d2\u4ef6\u7684\u4f5c\u4e3a\u4e00\u4e2a\u4e2d\u95f4\u5c42\uff0c\u5bf9\u63a5 Apache APISIX \u548c ClickHouse\u3002\u5982\u524d\u6587\u6240\u8bf4\uff0c\u6211\u4eec\u4f7f\u7528Apache APISIX \u4f5c\u4e3a\u4e03\u5c42\u8d1f\u8f7d\u5747\u8861\uff0c\u8bf7\u6c42\u7ecf\u8fc7 Apache APISIX \u4f1a\u4ea7\u751f\u65e5\u5fd7\uff0c\u6bd4\u5982 access log \u548c error log\u3002`clickhouse-logger` \u6536\u96c6\u5230\u65e5\u5fd7\u540e\uff0c\u4f1a\u6309\u7167\u81ea\u8eab metadata \u6240\u8bbe\u7f6e\u7684\u65e5\u5fd7\u683c\u5f0f\uff0c\u5bf9\u8fd9\u4e9b\u65e5\u5fd7\u8fdb\u884c\u6574\u7406\u3002\u6700\u540e\u4f9d\u9760\u6279\u5904\u7406\u5668\u5c06\u6574\u7406\u8fc7\u7684\u65e5\u5fd7\u6279\u91cf\u53d1\u9001\u81f3 ClickHouse\u3002\\n\\n![clickhouse-logger architecture](https://static.apiseven.com/202108/1646363936994-c2646095-1ea4-4c1f-8cad-1dcecfc41df3.png)\\n\\n`clickhouse-logger` \u5728\u6211\u4eec\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u8d77\u5230\u4e86\u66ff\u4ee3\u201ctcp-logger+rsyslog+Promtail+Loki\u201d\u7684\u4f5c\u7528\u3002\u514d\u9664\u4e86\u591a\u4e2a\u7ec4\u4ef6\u4e4b\u95f4\u7684\u683c\u5f0f\u8f6c\u6362\u548c\u6570\u636e\u8f6c\u53d1\uff0c\u53ef\u5c06 Log \u6570\u636e\u8bf7\u6c42\u76f4\u63a5\u63a8\u9001\u5230 ClickHouse \u670d\u52a1\u5668\u3002\\n\\n![improved bussiness architecture](https://static.apiseven.com/202108/1646364005040-93d70286-e7e6-4fb5-a164-1de1c865ce2b.png)\\n\\n## \u64cd\u4f5c\u6b65\u9aa4\\n\\n\u4ee5\u4e0b\u662f\u5728\u4e00\u4e2a\u8def\u7531\u4e2d\u542f\u7528 `clickhouse-logger` \u63d2\u4ef6\u7684\u793a\u4f8b\u8fc7\u7a0b\u3002\\n\\n### \u542f\u7528 ClickHouse \u63d2\u4ef6\\n\\n\u8fd0\u884c `curl` \u547d\u4ee4\uff0c\u4e3a\u6307\u5b9a\u8def\u7531\u5f00\u542f `clickhouse-logger` \u63d2\u4ef6\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n      \\"plugins\\": {\\n            \\"clickhouse-logger\\": {\\n                \\"user\\": \\"default\\",\\n                \\"password\\": \\"a\\",\\n                \\"database\\": \\"default\\",\\n                \\"logtable\\": \\"test\\",\\n                \\"endpoint_addr\\": \\"http://127.0.0.1:8123\\"\\n            }\\n       },\\n      \\"upstream\\": {\\n           \\"type\\": \\"roundrobin\\",\\n           \\"nodes\\": {\\n               \\"127.0.0.1:1980\\": 1\\n           }\\n      },\\n      \\"uri\\": \\"/hello\\"\\n}\'\\n```\\n\\n`clickhouse-logger` \u7684\u53c2\u6570\u8868\u5982\u4e0b\u3002\\n\\n|\u540d\u79f0|\u7c7b\u578b|\u5fc5\u586b|\u9ed8\u8ba4\u503c|\u53d6\u503c\u8303\u56f4|\u63cf\u8ff0|\\n|----|----|--------|------------|-----|-----------|\\n|endpoint_addr|string|\u662f|n/a|n/a|ClickHouse \u670d\u52a1\u5668\u7684 endpoint\u3002|\\n|database|string|\u662f|n/a|n/a|\u4f7f\u7528\u7684\u6570\u636e\u5e93\u3002|\\n|logtable|string|\u662f|n/a|n/a|\u5199\u5165\u7684\u8868\u540d \u3002|\\n|user|string|\u662f|n/a|n/a|ClickHouse \u7684\u7528\u6237\u3002|\\n|password|string|\u662f|n/a||ClickHouse \u7684\u5bc6\u7801 \u3002|\\n|timeout|integer|\u5426|3|[1,...]|\u53d1\u9001\u8bf7\u6c42\u540e\u4fdd\u6301\u8fde\u63a5\u6d3b\u52a8\u7684\u65f6\u95f4\u3002|\\n|name|string|\u5426|\\"clickhouse-logger\\"|n/a|\u6807\u8bc6 logger \u7684\u552f\u4e00\u6807\u8bc6\u7b26\u3002|\\n|batch_max_size|integer|\u5426|100|[1,...]|\u8bbe\u7f6e\u6bcf\u6279\u53d1\u9001\u65e5\u5fd7\u7684\u6700\u5927\u6761\u6570\uff0c\u5f53\u65e5\u5fd7\u6761\u6570\u8fbe\u5230\u8bbe\u7f6e\u7684\u6700\u5927\u503c\u65f6\uff0c\u4f1a\u81ea\u52a8\u63a8\u9001\u5168\u90e8\u65e5\u5fd7\u5230 `clickhouse`\u3002|\\n|max_retry_count|integer|\u5426|0|[0,...]|\u4ece\u5904\u7406\u7ba1\u9053\u4e2d\u79fb\u9664\u4e4b\u524d\u7684\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u3002|\\n|retry_delay|integer|\u5426|1|[0,...]|\u5982\u679c\u6267\u884c\u5931\u8d25\uff0c\u5219\u5e94\u5ef6\u8fdf\u6267\u884c\u6d41\u7a0b\u7684\u79d2\u6570\u3002|\\n|ssl_verify|boolean|\u5426|true|[true,false]|\u9a8c\u8bc1\u8bc1\u4e66\u3002|\\n\\n### \u6d4b\u8bd5 ClickHouse \u63d2\u4ef6\\n\\n1. \u4f7f\u7528 `curl` \u547d\u4ee4\u6d4b\u8bd5\u63d2\u4ef6\u3002\\n  \\n  ```shell\\n  curl -i http://127.0.0.1:9080/hello\\n  ```\\n\\n2. \u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\uff0c\u5219\u8868\u793a\u6210\u529f\u542f\u7528\u3002\\n\\n  ```shell\\n  HTTP/1.1 200 OK\\n  ...\\n  hello, world\\n  ```\\n\\n### \u8fdb\u9636\u64cd\u4f5c 1\uff1a\u8bbe\u7f6e\u65e5\u5fd7\u683c\u5f0f\\n\\n\u4f60\u53ef\u4ee5\u4f7f\u7528 `log_format` \u8fd9\u4e2a\u5143\u6570\u636e\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u65e5\u5fd7\u683c\u5f0f\uff0c\u793a\u4f8b\u5982\u4e0b\u3002\\n\\n1. \u914d\u7f6e `log_format` \u5143\u6570\u636e\u53c2\u6570\u3002\\n\\n  ```shell\\n  curl http://127.0.0.1:9080/apisix/admin/plugin_metadata/clickhouse-logger \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n  {\\n      \\"log_format\\": {\\n          \\"host\\": \\"$host\\",\\n          \\"@timestamp\\": \\"$time_iso8601\\",\\n          \\"client_ip\\": \\"$remote_addr\\"\\n      }\\n  }\'\\n  ```\\n\\n  > \u4ee5 JSON \u683c\u5f0f\u7684\u952e\u503c\u5bf9\u6765\u58f0\u660e\u65e5\u5fd7\u683c\u5f0f\u3002\u5bf9\u4e8e\u503c\u90e8\u5206\uff0c\u4ec5\u652f\u6301\u5b57\u7b26\u4e32\u3002\u5982\u679c\u662f\u4ee5 `$` \u5f00\u5934\uff0c\u5219\u8868\u660e\u662f\u8981\u83b7\u53d6 [APISIX \u53d8\u91cf](https://apisix.apache.org/docs/apisix/apisix-variable)\u6216 [Nginx \u5185\u7f6e\u53d8\u91cf](http://nginx.org/en/docs/varindex.html)\u3002**\u8be5\u8bbe\u7f6e\u662f\u5168\u5c40\u751f\u6548\u7684**\uff0c\u610f\u5473\u7740\u6307\u5b9a `log_format` \u540e\uff0c\u5c06\u5bf9\u6240\u6709\u7ed1\u5b9a `http-logger` \u7684 Route \u6216 Service \u751f\u6548\u3002\\n\\n2. \u521b\u5efa ClickHouse \u5199\u5165\u7684\u8868\u683c\u3002\\n\\n  ```sql\\n  CREATE TABLE default.test (\\n    `host` String,\\n    `client_ip` String,\\n    `route_id` String,\\n    `@timestamp` String,\\n    PRIMARY KEY(`@timestamp`)\\n  ) ENGINE = MergeTree()\\n  ```\\n\\n3. \u5728 ClickHouse \u4e0a\u6267\u884c `select * from default.test;`\uff0c\u5c06\u5f97\u5230\u7c7b\u4f3c\u4e0b\u9762\u7684\u6570\u636e\u3002\\n\\n  ```shell\\n  \u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500client_ip\u2500\u252c\u2500route_id\u2500\u252c\u2500@timestamp\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n  \u2502 127.0.0.1 \u2502 127.0.0.1 \u2502    1     \u2502 2022-01-17T10:03:10+08:00 \u2502\\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n  ```\\n\\n### \u8fdb\u9636\u64cd\u4f5c 2\uff1a\u4f7f\u7528 Grafana \u4e0e ClickHouse \u5bf9\u63a5\\n\\n1. \u5168\u5c40\u5f00\u542f `clickhouse-logger` \u63d2\u4ef6\u3002\\n\\n  ```shell\\n  curl http://127.0.0.1:9080/apisix/admin/global_rules/1 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n  {\\n      \\"plugins\\": {\\n          \\"clickhouse-logger\\": {\\n              \\"timeout\\": 3,\\n              \\"retry_delay\\": 1,\\n              \\"batch_max_size\\": 100,\\n              \\"user\\": \\"default\\",\\n              \\"password\\": \\"a\\",\\n              \\"database\\": \\"default\\",\\n              \\"logtable\\": \\"t\\",  \\"max_retry_count\\": 1,\\n              \\"endpoint_addr\\": \\"http://127.0.0.1:8123\\"\\n          }\\n      }\\n  }\'\\n  ```\\n\\n2. \u914d\u7f6e `log_format` \u5143\u6570\u636e\u53c2\u6570\u3002`log_format` \u7684\u683c\u5f0f\u5fc5\u987b\u4e0e\u6570\u636e\u5e93\u8868\u7684\u7ed3\u6784\u4fdd\u6301\u4e00\u81f4\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u5199\u5165\u5931\u8d25\u3002\\n\\n  ```shell\\n   curl http://127.0.0.1:9080/apisix/admin/plugin_metadata/clickhouse-logger \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n  {\\n      \\"log_format\\": {\\n          \\"upstream_header_time\\": \\"$upstream_header_time\\",\\n          \\"upstream_connect_time\\": \\"$upstream_connect_time\\",\\n          \\"status\\": \\"$status\\",\\n          \\"host\\": \\"$host\\",\\n          \\"body_bytes_sent\\": \\"$body_bytes_sent\\",\\n          \\"request\\": \\"$request\\",\\n          \\"remote_user\\": \\"$remote_user\\",\\n          \\"client_ip\\": \\"$remote_addr\\",\\n          \\"content_length\\": \\"$content_length\\",\\n          \\"local_time\\": \\"$fmt_ms_time_local\\",\\n          \\"http_referer\\": \\"$http_referer\\",\\n          \\"http_x_amz_target\\": \\"$http_x_amz_target\\",\\n          \\"http_x_request_id\\": \\"$http_x_request_id\\",\\n          \\"upstream_response_time\\": \\"$upstream_response_time\\",\\n          \\"upstream_status\\": \\"$upstream_status\\",\\n          \\"http_user_agent\\": \\"$http_user_agent\\",\\n          \\"request_time\\": \\"$request_time\\",\\n          \\"upstream_addr\\": \\"$upstream_addr\\",\\n          \\"http_host\\": \\"$http_host\\",\\n          \\"content_type\\": \\"$content_type\\"\\n      }\\n  }\'\\n  ```\\n\\n\u4ee5\u4e0b\u662f\u4f7f\u7528 Grafana \u4e0e Clickhouse \u5bf9\u63a5\u540e\u7684\u4eea\u8868\u76d8\u89c6\u56fe\u3002\\n\\n![Grafana-1](https://static.apiseven.com/202108/1646366781343-ab2848fe-d10a-4222-a90d-79f4fe58999a.png)\\n\\n![Grafana-2](https://static.apiseven.com/202108/1646366807867-4391a9ff-8b71-411c-8353-38957a5a2da1.png)\\n\\n![Grafana-3](https://static.apiseven.com/202108/1646366832282-e8f24c63-c914-4051-8239-582bc3e58f50.png)\\n\\n### \u7981\u7528 ClickHouse \u63d2\u4ef6\\n\\n\u5728\u63d2\u4ef6\u914d\u7f6e\u4e2d\u5220\u9664\u76f8\u5e94\u7684\u914d\u7f6e\u5373\u53ef\u7981\u7528 `clickhouse-logger`\u3002\u7531\u4e8e Apache APISIX \u63d2\u4ef6\u662f\u70ed\u52a0\u8f7d\u6a21\u5f0f\uff0c\u56e0\u6b64\u65e0\u9700\u91cd\u65b0\u542f\u52a8\u5373\u53ef\u66f4\u65b0\u914d\u7f6e\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {},\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u4ee5\u4e0a\u5c31\u662f\u6211\u4e3a Apache APISIX \u5f00\u53d1 `clickhouse-logger` \u7684\u5168\u8fc7\u7a0b\u3002\u5e0c\u671b\u793e\u533a\u91cc\u6709\u66f4\u591a\u7684\u4eba\u613f\u610f\u8d70\u51fa\u8212\u9002\u533a\uff0c\u5b9e\u73b0\u81ea\u8eab\u7684\u89d2\u8272\u8f6c\u6362\uff0c\u4ece\u5173\u6ce8\u8005\u53d8\u4e3a\u8d21\u732e\u8005\u7684\u8fc7\u7a0b\u8fdc\u6bd4\u4f60\u60f3\u8c61\u7684\u7b80\u5355\u3002"},{"id":"API \u7f51\u5173 APISIX \u643a\u624b CoreDNS \u6253\u5f00\u670d\u52a1\u53d1\u73b0\u65b0\u5927\u95e8","metadata":{"permalink":"/zh/blog/2022/03/04/apisix-uses-coredns-enable-service-discovery","source":"@site/blog/2022/03/04/apisix-uses-coredns-enable-service-discovery.md","title":"API \u7f51\u5173 APISIX \u643a\u624b CoreDNS \u6253\u5f00\u670d\u52a1\u53d1\u73b0\u65b0\u5927\u95e8","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u96c6\u6210\u4e86\u591a\u79cd\u670d\u52a1\u53d1\u73b0\u7684\u80fd\u529b\uff0c\u672c\u6587\u5c06\u4e3a\u60a8\u5c55\u793a\u5982\u4f55\u5728 APISIX \u4e2d\u914d\u7f6e CoreDNS \u5e76\u4e14\u4e3a\u4f60\u4ecb\u7ecd\u4e86\u670d\u52a1\u53d1\u73b0\u7684\u6a21\u5f0f\u4ee5\u53ca\u4f7f\u7528 CoreDNS \u7684\u4f18\u52bf\u3002","date":"2022-03-04T00:00:00.000Z","formattedDate":"2022\u5e743\u67084\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":12.595,"truncated":true,"authors":[{"name":"\u9648\u6893\u6770","title":"Author","url":"https://github.com/CP3cham","image_url":"https://avatars.githubusercontent.com/u/87352162?v=4","imageURL":"https://avatars.githubusercontent.com/u/87352162?v=4"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://avatars.githubusercontent.com/u/97138894?v=4","imageURL":"https://avatars.githubusercontent.com/u/97138894?v=4"}],"prevItem":{"title":"API \u7f51\u5173\u96c6\u6210 ClickHouse \u63d2\u4ef6\u63d0\u5347\u5168\u94fe\u8def\u65e5\u5fd7\u6548\u7387","permalink":"/zh/blog/2022/03/04/apigateway-clickhouse-makes-logging-easier"},"nextItem":{"title":"\u4f7f\u7528 Gitpod \u5f00\u53d1 API \u7f51\u5173 Apache APISIX","permalink":"/zh/blog/2022/03/03/develop-apisix-with-gitpod"}},"content":"> Apache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f5c\u4e3a\u4e91\u539f\u751f API \u7f51\u5173\uff0cApache APISIX \u4e5f\u96c6\u6210\u4e86\u591a\u79cd\u670d\u52a1\u53d1\u73b0\u7684\u80fd\u529b\uff0c\u672c\u6587\u5c06\u4e3a\u60a8\u5c55\u793a\u5728 Apache APISIX \u4e2d\u5982\u4f55\u914d\u7f6e CoreDNS\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\n\u5728\u4f20\u7edf\u7684\u7269\u7406\u673a\u548c\u865a\u62df\u673a\u90e8\u7f72\u4e2d\uff0c\u5404\u4e2a\u670d\u52a1\u4e4b\u95f4\u7684\u8c03\u7528\u53ef\u4ee5\u901a\u8fc7\u56fa\u5b9a **IP + \u7aef\u53e3**\u7684\u65b9\u5f0f\u8fdb\u884c\u3002\u968f\u7740\u4e91\u539f\u751f\u65f6\u4ee3\u7684\u5230\u6765\uff0c\u4f01\u4e1a\u4e1a\u52a1\u7684\u90e8\u7f72\u66f4\u503e\u5411\u4e8e\u4e91\u539f\u751f\u5bb9\u5668\u5316\u3002\u4f46\u662f\u5728\u5bb9\u5668\u5316\u73af\u5883\u4e2d\uff0c\u670d\u52a1\u5b9e\u4f8b\u7684\u542f\u52a8\u548c\u9500\u6bc1\u662f\u975e\u5e38\u9891\u7e41\u7684\uff0c\u5982\u679c\u901a\u8fc7\u8fd0\u7ef4\u4eba\u5458\u624b\u52a8\u7ef4\u62a4\u4e0d\u4ec5\u5de5\u4f5c\u91cf\u5927\uff0c\u800c\u4e14\u6548\u679c\u4e5f\u6b20\u4f73\u3002\u56e0\u6b64\u9700\u8981\u4e00\u79cd\u673a\u5236\u53ef\u4ee5\u81ea\u52a8\u68c0\u6d4b\u670d\u52a1\u72b6\u6001\uff0c\u5f53\u670d\u52a1\u5730\u5740\u51fa\u73b0\u53d8\u66f4\u65f6\uff0c\u52a8\u6001\u7ed1\u5b9a\u65b0\u7684\u5730\u5740\u3002\u670d\u52a1\u53d1\u73b0\u673a\u5236\u5e94\u8fd0\u800c\u751f\u3002\\n\\n## \u670d\u52a1\u53d1\u73b0\u7b80\u4ecb\\n\\n\u670d\u52a1\u53d1\u73b0\u673a\u5236\u53ef\u4ee5\u5206\u4e3a\u4e24\u90e8\u5206\uff1a\\n\\n- \u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\uff1a\u5b58\u50a8\u670d\u52a1\u7684\u4e3b\u673a\u548c\u7aef\u53e3\u4fe1\u606f\u3002\\n\\n\u5047\u5982\u67d0\u4e2a\u5bb9\u5668\u5bf9\u5916\u63d0\u4f9b\u8ba1\u7b97\u5e73\u5747\u503c\u7684\u670d\u52a1\uff0c\u6211\u4eec\u4f7f\u7528 `average` \u7684\u670d\u52a1\u540d\u4f5c\u4e3a\u552f\u4e00\u6807\u8bc6\u7b26\uff0c\u90a3\u4e48\u5728\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u5c31\u4f1a\u4ee5\u952e\u503c\u5bf9\uff08`average:192.168.1.21`\uff09\u7684\u65b9\u5f0f\u5b58\u50a8\u3002\\n\\n- \u670d\u52a1\u53d1\u73b0\uff1a\u5141\u8bb8\u5176\u4ed6\u7528\u6237\u53d1\u73b0\u670d\u52a1\u6ce8\u518c\u9636\u6bb5\u5b58\u50a8\u7684\u4fe1\u606f\u3002\u5206\u4e3a\u5ba2\u6237\u7aef\u53d1\u73b0\u6a21\u5f0f\u548c\u670d\u52a1\u7aef\u53d1\u73b0\u6a21\u5f0f\u3002\\n\\n### \u5ba2\u6237\u7aef\u670d\u52a1\u53d1\u73b0\u6a21\u5f0f\\n\\n\u5728\u4f7f\u7528\u5ba2\u6237\u7aef\u53d1\u73b0\u6a21\u5f0f\u65f6\uff0c\u5ba2\u6237\u7aef\u901a\u8fc7\u67e5\u8be2\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u7684\u5b58\u50a8\u4fe1\u606f\uff0c\u83b7\u53d6\u53ef\u7528\u670d\u52a1\u7684\u5b9e\u9645\u7f51\u7edc\u5730\u5740\u540e\uff0c\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u9009\u62e9\u4e00\u4e2a\u53ef\u7528\u7684\u670d\u52a1\u5b9e\u4f8b\uff0c\u5e76\u5c06\u8bf7\u6c42\u53d1\u9001\u81f3\u8be5\u670d\u52a1\u3002\\n\\n- \u4f18\u70b9\uff1a\u67b6\u6784\u7b80\u5355\uff0c\u6269\u5c55\u7075\u6d3b\uff0c\u65b9\u4fbf\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u529f\u80fd\u3002\\n- \u7f3a\u70b9\uff1a\u91cd\u5ba2\u6237\u7aef\uff0c\u5f3a\u8026\u5408\uff0c\u6709\u4e00\u5b9a\u5f00\u53d1\u6210\u672c\u3002\\n\\n![error/client service discovery.png](https://static.apiseven.com/202108/1646299482001-9bba7b28-1780-44c8-869d-b75bc993c021.png)\\n\\n\u5ba2\u6237\u7aef\u53d1\u73b0\u6a21\u5f0f\u5b9e\u73b0\u903b\u8f91\u5982\u4e0b\uff1a\\n\\n1. \u65b0\u670d\u52a1\u542f\u52a8\u65f6\uff0c\u4e3b\u52a8\u5411\u6ce8\u518c\u4e2d\u5fc3\u6ce8\u518c\uff0c\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u4f1a\u5b58\u50a8\u65b0\u670d\u52a1\u7684\u670d\u52a1\u540d\u548c\u5730\u5740\uff1b\\n2. \u5f53\u5ba2\u6237\u7aef\u9700\u8981\u8fd9\u4e2a\u670d\u52a1\u65f6\uff0c\u4f1a\u4f7f\u7528\u670d\u52a1\u540d\u5411\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u53d1\u8d77\u67e5\u8be2\uff1b\\n3. \u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u8fd4\u56de\u53ef\u7528\u7684\u5730\u5740\uff0c\u5ba2\u6237\u7aef\u518d\u6839\u636e\u5177\u4f53\u7684\u7b97\u6cd5\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u53d1\u8d77\u8c03\u7528\u3002\\n\\n\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u9664\u4e86\u670d\u52a1\u6ce8\u518c\uff0c\u670d\u52a1\u53d1\u73b0\u7684\u5de5\u4f5c\u57fa\u672c\u7531\u5ba2\u6237\u7aef\u72ec\u7acb\u5b8c\u6210\uff0c\u6ce8\u518c\u4e2d\u5fc3\u548c\u670d\u52a1\u7aef\u7684\u5730\u5740\u5bf9\u5ba2\u6237\u7aef\u4e5f\u662f\u5b8c\u5168\u53ef\u89c1\u7684\u3002\\n\\n### \u670d\u52a1\u7aef\u670d\u52a1\u53d1\u73b0\u6a21\u5f0f\\n\\n\u5ba2\u6237\u7aef\u5411 Load Balancer \u53d1\u9001\u8bf7\u6c42\uff0cLoad Balancer \u6839\u636e\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u67e5\u8be2\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\uff0c\u627e\u5230\u53ef\u7528\u7684\u670d\u52a1\u540e\u8f6c\u53d1\u8bf7\u6c42\u5230\u8be5\u670d\u52a1\u4e0a\uff0c\u548c\u5ba2\u6237\u7aef\u670d\u52a1\u53d1\u73b0\u6a21\u5f0f\u4e00\u6837\uff0c\u670d\u52a1\u90fd\u9700\u8981\u5728\u6ce8\u518c\u4e2d\u5fc3\u8fdb\u884c\u670d\u52a1\u6ce8\u518c\u548c\u6ce8\u9500\u3002\\n\\n- \u4f18\u70b9\uff1a\u670d\u52a1\u7684\u53d1\u73b0\u903b\u8f91\u5bf9\u5ba2\u6237\u7aef\u662f\u900f\u660e\u7684\u3002\\n- \u7f3a\u70b9\uff1a\u9700\u8981\u989d\u5916\u90e8\u7f72\u548c\u7ef4\u62a4\u8d1f\u8f7d\u5747\u8861\u5668\u3002\\n\\n![error/server service discovery.png](https://static.apiseven.com/202108/1646299531288-3ff99279-3ab6-49d7-8abf-68461f50c5c0.png)\\n\\n\u670d\u52a1\u7aef\u53d1\u73b0\u6a21\u5f0f\u5b9e\u73b0\u903b\u8f91\u5982\u4e0b\uff1a\\n\\n1. \u65b0\u670d\u52a1\u542f\u52a8\u65f6\uff0c\u4e3b\u52a8\u5411\u6ce8\u518c\u4e2d\u5fc3\u6ce8\u518c\uff0c\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u4f1a\u5b58\u50a8\u65b0\u670d\u52a1\u7684\u670d\u52a1\u540d\u548c\u5730\u5740\uff1b\\n2. \u5f53\u5ba2\u6237\u7aef\u9700\u8981\u67d0\u4e2a\u670d\u52a1\u65f6\uff0c\u4f1a\u4f7f\u7528\u670d\u52a1\u540d\u5411\u8d1f\u8f7d\u5747\u8861\u5668\u53d1\u8d77\u67e5\u8be2\uff1b\\n3. \u8d1f\u8f7d\u5747\u8861\u5668\u6839\u636e\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u670d\u52a1\u540d\uff0c\u4ee3\u7406\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u53d1\u8d77\u8bf7\u6c42\uff1b\\n4. \u8d1f\u8f7d\u5747\u8861\u5668\u83b7\u5f97\u8fd4\u56de\u7684\u5730\u5740\u540e\uff0c\u6839\u636e\u5177\u4f53\u7684\u7b97\u6cd5\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u53d1\u8d77\u8c03\u7528\u3002\\n\\n## \u4f7f\u7528 CoreDNS \u7684\u4f18\u52bf\\n\\nCoreDNS \u662f\u4e00\u4e2a\u7528 `Go` \u8bed\u8a00\u7f16\u5199\u7684\u5f00\u6e90 DNS \u670d\u52a1\u5668\uff0c\u7531\u4e8e\u5b83\u7684\u7075\u6d3b\u6027\u548c\u53ef\u6269\u5c55\u6027\uff0c\u5e38\u7528\u4e8e\u591a\u5bb9\u5668\u73af\u5883\u4e2d\u7684 DNS \u670d\u52a1\u548c\u670d\u52a1\u53d1\u73b0\u3002CoreDNS \u5efa\u7acb\u5728 Caddy \u8fd9\u4e2a HTTP/2 Web \u670d\u52a1\u5668\u4e4b\u4e0a\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u63d2\u4ef6\u94fe\u7684\u67b6\u6784\uff0c\u5c06\u5f88\u591a DNS \u76f8\u5173\u7684\u903b\u8f91\u90fd\u62bd\u8c61\u6210\u4e86\u4e00\u5c42\u4e00\u5c42\u7684\u63d2\u4ef6\uff0c\u5b9e\u73b0\u8d77\u6765\u66f4\u7075\u6d3b\u548c\u6613\u6269\u5c55\uff0c\u7528\u6237\u9009\u62e9\u7684\u63d2\u4ef6\u4f1a\u88ab\u7f16\u8bd1\u5230\u6700\u7ec8\u7684\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\uff0c\u8fd0\u884c\u6548\u7387\u4e5f\u975e\u5e38\u9ad8\u3002CoreDNS \u662f\u9996\u6279\u52a0\u5165 CNCF\uff08\u4e91\u539f\u751f\u8ba1\u7b97\u57fa\u91d1\u4f1a\uff09\u5e76\u4e14\u662f\u5df2\u7ecf\u6bd5\u4e1a\u7684\u4e91\u539f\u751f\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u662f Kuberneters \u4e2d\u9ed8\u8ba4\u7684 DNS \u670d\u52a1\u3002\\n\\n\u76f8\u6bd4\u4e8e\u5e38\u89c1\u7684\u670d\u52a1\u53d1\u73b0\u6846\u67b6\uff08Apache ZooKeeper \u548c Consul\uff09\uff0cCoreDNS \u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u6709\u54ea\u4e9b\u4f18\u52bf\u5462\uff1f\\n\\n\u670d\u52a1\u53d1\u73b0\u7684\u539f\u7406\u548c\u8ba1\u7b97\u673a\u7f51\u7edc\u4e2d\u91cd\u8981\u7684\u57fa\u7840\u8bbe\u65bd\u2014\u2014 DNS \u57df\u540d\u7cfb\u7edf\u6bd4\u8f83\u76f8\u4f3c\uff0cDNS \u57df\u540d\u7cfb\u7edf\u628a\u5f88\u5c11\u53d8\u52a8\u7684\u57df\u540d\u4e0e\u7ecf\u5e38\u53d8\u52a8\u7684\u670d\u52a1\u5668 IP \u5730\u5740\u8fdb\u884c\u7ed1\u5b9a\uff0c\u800c\u670d\u52a1\u53d1\u73b0\u673a\u5236\u5219\u662f\u628a\u5f88\u5c11\u53d8\u52a8\u7684\u670d\u52a1\u540d\u4e0e\u670d\u52a1\u5730\u5740\u7ed1\u5b9a\u3002\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u501f\u7531 DNS \u5b9e\u73b0\u7c7b\u4f3c\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u7684\u529f\u80fd\uff0c\u53ea\u9700\u8981\u5c06 DNS \u4e2d\u5b58\u50a8\u7684\u57df\u540d\u8f6c\u6362\u4e3a\u670d\u52a1\u540d\u5373\u53ef\u3002\u7531\u4e8e\u8bb8\u591a\u8ba1\u7b97\u673a\u5185\u7f6e\u4e86 DNS \u529f\u80fd\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5728\u539f\u6709 DNS \u7cfb\u7edf\u4e0a\u4fee\u6539\u914d\u7f6e\u5c31\u53ef\u4ee5\u4e86\uff0c\u4e0d\u9700\u8981\u505a\u592a\u591a\u989d\u5916\u7684\u4e8b\u60c5\u3002\\n\\n## \u539f\u7406\u67b6\u6784\\n\\n\u6574\u4f53\u67b6\u6784\u5982\u4e0b\uff1a\\n\\n1. \u5ba2\u6237\u7aef\u5411 APISIX \u53d1\u8d77\u8bf7\u6c42\u8c03\u7528\u670d\u52a1\u3002\\n2. APISIX \u6839\u636e\u8bbe\u7f6e\u597d\u7684\u8def\u7531\u6765\u8bbf\u95ee\u4e0a\u6e38\u670d\u52a1\u8282\u70b9\uff08\u5177\u4f53\u914d\u7f6e\u53ef\u89c1\u4e0b\u6587\uff09\uff0c\u5728 APISIX \u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u4e0a\u6e38\u4fe1\u606f\u901a\u8fc7 DNS \u65b9\u5f0f\u83b7\u53d6\uff0c\u53ea\u8981\u6b63\u786e\u8bbe\u7f6e\u4e86 DNS \u670d\u52a1\u5668\u7684 IP \u5730\u5740\uff0cAPISIX \u4f1a\u81ea\u52a8\u5411\u8be5\u5730\u5740\u53d1\u8d77\u8bf7\u6c42\uff0c\u83b7\u53d6 DNS \u4e2d\u5bf9\u5e94\u670d\u52a1\u7684\u5730\u5740\u3002\\n3. CoreDNS \u6839\u636e\u8bf7\u6c42\u7684\u670d\u52a1\u540d\u8fd4\u56de\u53ef\u7528\u7684\u5730\u5740\u5217\u8868\u3002\\n4. APISIX \u6839\u636e\u53ef\u7528\u5730\u5740\u548c\u914d\u7f6e\u7684\u7b97\u6cd5\uff0c\u4ece\u5176\u4e2d\u9009\u62e9\u4e00\u4e2a\u53d1\u8d77\u8c03\u7528\u3002\\n\\n![error/architecture.png](https://static.apiseven.com/202108/1646299586044-3b44e6a8-b7a9-4ba6-a69c-8d08772b6065.png)\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u524d\u63d0\u6761\u4ef6\\n\\n\u672c\u6587\u64cd\u4f5c\u57fa\u4e8e\u4ee5\u4e0b\u73af\u5883\u8fdb\u884c\u3002\\n\\n- \u64cd\u4f5c\u7cfb\u7edf Centos 7.9\u3002\\n- Apache APISIX 2.12.1\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[\u5982\u4f55\u6784\u5efa Apache APISIX](https://apisix.apache.org/zh/docs/apisix/how-to-build)\u3002\\n- CoreDNS 1.9.0\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[CoreDNS \u5b89\u88c5\u6307\u5357](https://coredns.io/manual/toc/#installation)\u3002\\n- Node.js 10.15.0\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[Node.js \u5b89\u88c5\u6307\u5357](https://github.com/nodejs/help/wiki/Installation)\u3002\\n\\n### \u64cd\u4f5c\u6b65\u9aa4\\n\\n1. \u4f7f\u7528 Node.js \u7684 `Koa` \u6846\u67b6\u5728 `3005` \u7aef\u53e3\u542f\u52a8\u4e00\u4e2a\u7b80\u5355\u7684\u6d4b\u8bd5\u670d\u52a1\u3002\\n\\n\u8bbf\u95ee\u6b64\u670d\u52a1\u4f1a\u8fd4\u56de `Hello World` \u7684\u5b57\u4e32\uff0c\u7a0d\u540e\u6211\u4eec\u5c06\u901a\u8fc7 CoreDNS \u83b7\u53d6\u8fd9\u4e2a\u670d\u52a1\u7684\u5730\u5740\u3002\\n\\n```Shell\\n  // \u4f7f\u7528 Koa \u6846\u67b6\u642d\u5efa\u670d\u52a1\\n  const Koa = require(\'koa\');\\n  const app = new Koa();\\n\\n  app.use(async ctx => {\\n    ctx.body = \'Hello World\';\\n  });\\n\\n  app.listen(3005);\\n```\\n\\n2. \u914d\u7f6e CoreDNS\u3002\\n\\nCoreDNS \u9ed8\u8ba4\u76d1\u542c `53` \u7aef\u53e3\uff0c\u5e76\u4e14\u4f1a\u8bfb\u53d6\u5728\u76f8\u540c\u76ee\u5f55\u4e2d\u7684 `Corefile` \u914d\u7f6e\u6587\u4ef6\u3002\u521d\u59cb\u6761\u4ef6\u4e0b\uff0c\u540c\u76ee\u5f55\u4e2d\u5e76\u6ca1\u6709 `Corefile` \u6587\u4ef6\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u521b\u5efa\u5e76\u5b8c\u6210\u914d\u7f6e\u3002\\n\\n`Corefile` \u4e3b\u8981\u662f\u901a\u8fc7\u914d\u7f6e\u63d2\u4ef6\u6765\u5b9e\u73b0\u529f\u80fd\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u914d\u7f6e\u4e09\u4e2a\u63d2\u4ef6\uff1a\\n\\n- `hosts`\uff1a\u53ef\u4ee5\u901a\u8fc7\u6b64\u53c2\u6570\u5c06\u670d\u52a1\u540d\u548c IP \u5730\u5740\u7ed1\u5b9a\uff0c`fallthrough` \u8868\u793a\u5728\u5f53\u524d\u63d2\u4ef6\u65e0\u6cd5\u8fd4\u56de\u6b63\u5e38\u6570\u636e\u65f6\u53ef\u4ee5\u628a\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u4e0b\u4e00\u4e2a\u63d2\u4ef6\u5904\u7406\uff08\u5982\u679c\u5b58\u5728\uff09\u3002\\n- `forward`\uff1a\u8868\u793a\u5c06\u8bf7\u6c42\u4ee3\u7406\u5230\u6307\u5b9a\u7684\u5730\u5740\uff0c\u4e00\u822c\u662f\u6743\u5a01 DNS \u670d\u52a1\u5668\u5730\u5740\u3002\\n- `log`\uff1a\u4e0d\u914d\u7f6e\u4efb\u4f55\u53c2\u6570\u4ee3\u8868\u5c06\u65e5\u5fd7\u4fe1\u606f\u6253\u5370\u5230\u63a7\u5236\u53f0\u754c\u9762\uff0c\u4ee5\u4fbf\u8fdb\u884c\u8c03\u8bd5\u3002\\n\\n```Shell\\n  .:1053 {              # \u76d1\u542c\u57281053\u7aef\u53e3\\n      hosts {\\n          10.10.10.10 hello\\n          # \u5c06\u670d\u52a1\u540d \u201ccoredns\u201d \u548cIP\u5730\u5740\u7ed1\u5b9a\\n          fallthrough\\n      }\\n      forward . 114.114.114.114:53\\n      log\\n  }\\n```\\n\\n3. \u914d\u7f6e Apache APISIX\u3002\\n\\n\u5728 `conf/config.yaml` \u6587\u4ef6\u4e2d\u6dfb\u52a0\u76f8\u5173\u914d\u7f6e\u5e76\u91cd\u65b0\u52a0\u8f7d Apache APISIX\u3002\\n\\n```Shell\\n  # config.yml\\n  # ...other config\\n  discovery:\\n     dns:\\n       servers:\\n          - \\"127.0.0.1:1053\\"  # \u4f7f\u7528 DNS \u670d\u52a1\u5668\u7684\u771f\u5b9e\u5730\u5740\\n                              # \u6b64\u5904\u4e3a\u672c\u673a\u76841053\u7aef\u53e3\\n```\\n\\n4. \u914d\u7f6e Apache APISIX \u4e2d\u7684\u8def\u7531\u4fe1\u606f\u3002\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u901a\u8fc7\u8bf7\u6c42 `Admin API` \u914d\u7f6e\u76f8\u5173\u8def\u7531\u4fe1\u606f\\n\\n```Shell\\n  curl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n  {\\n      \\"uri\\": \\"/core/*\\",\\n      \\"upstream\\": {\\n          \\"service_name\\": \\"hello:3005\\",\\n          # \u5c06\u670d\u52a1\u540d\u547d\u540d\u4e3acoredns\uff0c\u4e0eCoreDNS\u4e2dhosts\u63d2\u4ef6\u7684\u914d\u7f6e\u4fdd\u6301\u4e00\u81f4\\n          \\"type\\": \\"roundrobin\\",\\n          \\"discovery_type\\": \\"dns\\" # \u5c06\u670d\u52a1\u53d1\u73b0\u7c7b\u578b\u8bbe\u7f6e\u4e3aDNS\\n      }\\n  }\'\\n```\\n\\n5. \u9a8c\u8bc1\u3002\\n\\n- \u5728\u672c\u673a\u4e0a\u9a8c\u8bc1\\n\\n```Shell\\n  curl 127.0.0.1:9080/core/hello -i\\n\\n  HTTP/1.1 200 OK\\n  Content-Type: text/plain; charset=utf-8\\n  Content-Length: 11\\n  Connection: keep-alive\\n  Date: Wed, 16 Feb 2022 08:44:08 GMT\\n  Server: APISIX/2.12.1\\n\\n  Hello World\\n```\\n\\n- \u5728\u5176\u4ed6\u4e3b\u673a\u4e0a\u9a8c\u8bc1\\n\\n```Shell\\n  curl 10.10.10.10:9080/core/hello -i\\n\\n  HTTP/1.1 200 OK\\n  Content-Type: text/plain; charset=utf-8\\n  Content-Length: 11\\n  Connection: keep-alive\\n  Date: Wed, 16 Feb 2022 08:43:32 GMT\\n  Server: APISIX/2.12.0\\n\\n  Hello World\\n```\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u8fd4\u56de\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u670d\u52a1\u662f\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u7684\u3002\\n\\n6. \u6a21\u62df\u5bb9\u5668\u56e0\u5404\u79cd\u539f\u56e0\u65e0\u6cd5\u63d0\u4f9b\u670d\u52a1\uff0c\u5bfc\u81f4 IP \u5730\u5740\u53d1\u751f\u53d8\u66f4\u3002\\n\\n\u6211\u4eec\u9700\u8981\u5728\u53e6\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u642d\u5efa\u76f8\u540c\u7684\u670d\u52a1\uff0c\u540c\u6837\u8fd0\u884c\u5728 `3005` \u7aef\u53e3\uff0c\u4f46\u662f IP \u5730\u5740\u53d1\u751f\u53d8\u5316\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32\u6539\u4e3a `Hello, Apache APISIX`\u3002\\n\\n```Shell\\n// \u4f7f\u7528 Koa \u6846\u67b6\u642d\u5efa\u670d\u52a1\\nconst Koa = require(\'koa\');\\nconst app = new Koa();\\n\\napp.use(async ctx => {\\n  ctx.body = \'Hello, Apache APISIX\';\\n});\\n\\napp.listen(3005);\\n````\\n\\n\u4fee\u6539 `Corefile` \u914d\u7f6e\u5e76\u91cd\u542f CoreDNS\uff0c\u5176\u4ed6\u914d\u7f6e\u4e0d\u4f5c\u4fee\u6539\u3002\u914d\u7f6e\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```Shell\\n.:1053 {                           # \u76d1\u542c\u57281053\u7aef\u53e3\\n    hosts {\\n        10.10.10.11 hello        # \u4fee\u6539\u670d\u52a1IP\u5730\u5740\\n        # \u5c06\u670d\u52a1\u540d \u201ccoredns\u201d \u548cIP\u5730\u5740\u7ed1\u5b9a\\n        fallthrough\\n    }\\n    forward . 114.114.114.114:53  \\n    log\\n}\\n```\\n\\n> DNS \u5b58\u5728\u7f13\u5b58\u673a\u5236\uff0c\u5f53\u6211\u4eec\u7528 `dig` \u547d\u4ee4\u8bf7\u6c42\u89e3\u6790\u65b0\u7684\u57df\u540d\u65f6\uff0c\u5728\u8fd4\u56de\u7684 `DNS record` \u4e2d\u4f1a\u770b\u5230\u4e00\u4e2a\u6570\u5b57\u5b57\u6bb5\uff0c\u5373 `TTL` \u5b57\u6bb5\uff0c\u4e00\u822c\u662f `3600`\uff0c\u5373\u4e00\u4e2a\u5c0f\u65f6\u3002\u5728 `TTL` \u65f6\u95f4\u6bb5\u5185\u53d1\u5f80\u8be5\u57df\u540d\u7684\u8bf7\u6c42\u4e0d\u4f1a\u518d\u5411 DNS \u670d\u52a1\u5668\u8bf7\u6c42\u89e3\u6790\u5730\u5740\uff0c\u800c\u662f\u76f4\u63a5\u5728\u672c\u5730\u7f13\u5b58\u4e2d\u83b7\u53d6\u8be5\u57df\u540d\u5bf9\u5e94\u7684\u5730\u5740\u3002\\n\\n\u901a\u8fc7\u9a8c\u8bc1\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u8bf7\u6c42\u5df2\u7ecf\u91cd\u65b0\u6307\u5411\u65b0\u7684\u5730\u5740\u3002\u9a8c\u8bc1\u5982\u4e0b\uff1a\\n\\n```Shell\\n  curl 127.0.0.1:9080/core/hello -i\\n\\n  HTTP/1.1 200 OK\\n  Content-Type: text/plain; charset=utf-8\\n  Content-Length: 11\\n  Connection: keep-alive\\n  Date: Wed, 16 Feb 2022 08:44:08 GMT\\n  Server: APISIX/2.12.0\\n\\n  Hello, Apache APISIX\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u670d\u52a1\u53d1\u73b0\u7684\u7c7b\u578b\u4ee5\u53ca\u5728 Apache APISIX \u4e2d\u5982\u4f55\u4f7f\u7528 CoreDNS\u3002\u60a8\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u7684\u4e1a\u52a1\u9700\u6c42\u548c\u8fc7\u5f80\u6280\u672f\u67b6\u6784\u4f7f\u7528 Apache APISIX \u4e0e CoreDNS\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"\u4f7f\u7528 Gitpod \u5f00\u53d1 API \u7f51\u5173 Apache APISIX","metadata":{"permalink":"/zh/blog/2022/03/03/develop-apisix-with-gitpod","source":"@site/blog/2022/03/03/develop-apisix-with-gitpod.md","title":"\u4f7f\u7528 Gitpod \u5f00\u53d1 API \u7f51\u5173 Apache APISIX","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u548c\u4e91 IDE \u4ea7\u54c1 Gitpod\uff0c\u5e76\u4e3a\u5927\u5bb6\u6f14\u793a\u5982\u4f55\u4f7f\u7528 Gitpod \u5bf9 API \u7f51\u5173 Apache APISIX \u8fdb\u884c\u5f00\u53d1\u53ca\u5e38\u89c1\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u3002","date":"2022-03-03T00:00:00.000Z","formattedDate":"2022\u5e743\u67083\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":7.81,"truncated":true,"authors":[{"name":"\u94b1\u52c7","title":"Author","url":"https://github.com/nic-6443","image_url":"https://avatars.githubusercontent.com/u/22141303?v=4","imageURL":"https://avatars.githubusercontent.com/u/22141303?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"API \u7f51\u5173 APISIX \u643a\u624b CoreDNS \u6253\u5f00\u670d\u52a1\u53d1\u73b0\u65b0\u5927\u95e8","permalink":"/zh/blog/2022/03/04/apisix-uses-coredns-enable-service-discovery"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff082.15-2.28\uff09","permalink":"/zh/blog/2022/03/03/weekly-report-0228"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u548c\u4e91 IDE \u4ea7\u54c1 Gitpod\uff0c\u5e76\u4e3a\u5927\u5bb6\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Gitpod \u5bf9 API \u7f51\u5173 Apache APISIX \u8fdb\u884c\u5f00\u53d1\u53ca\u5e38\u89c1\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u968f\u7740\u4e91\u539f\u751f\u6d6a\u6f6e\u7684\u6765\u4e34\uff0c\u8f6f\u4ef6\u5f00\u53d1\u6d41\u7a0b\u4e2d\u7684\u5404\u4e2a\u73af\u8282\u90fd\u5728\u53d1\u751f\u53d8\u9769\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a\u975e\u5e38\u70ed\u95e8\u7684\u65b9\u5411\u5c31\u662f\u201c\u4e91 IDE\u201d\u3002\u6240\u8c13\u201c\u4e91 IDE\u201d\u5c31\u662f\u4f7f\u7528\u4e91\u7aef\u7684\u8ba1\u7b97\u8d44\u6e90\u4f5c\u4e3a\u5f00\u53d1\u73af\u5883\uff0c\u8fdb\u884c\u8f6f\u4ef6\u9879\u76ee\u7684\u5f00\u53d1\u3002\\n\\n\u8fd9\u79cd\u5f00\u53d1\u6a21\u5f0f\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bf4\u6709\u5f88\u591a\u597d\u5904\uff0c\u4f8b\u5982\uff1a\\n\\n- \u8ba1\u7b97\u8d44\u6e90\u4e88\u53d6\u4e88\u6c42\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u786c\u4ef6\u9650\u5236\u5f71\u54cd\u5f00\u53d1\u6548\u7387\uff1b\\n- \u5f00\u53d1\u73af\u5883\u6807\u51c6\u5316\uff0c\u6bcf\u4e2a\u9879\u76ee\u7684\u5f00\u53d1\u73af\u5883\u53ef\u80fd\u6709\u5f88\u591a\u8f6f\u4ef6\u4f9d\u8d56\uff0c\u8fd9\u4e9b\u4f9d\u8d56\u53ef\u4ee5\u901a\u8fc7 Docker \u955c\u50cf\u7684\u5f62\u5f0f\u8fdb\u884c\u6807\u51c6\u5316\uff1b\\n- \u5feb\u901f\u4e3a\u6bcf\u4e2a\u9879\u76ee\u542f\u52a8\u6216\u6467\u6bc1\u4e00\u4e2a\u5f00\u53d1\u73af\u5883\uff0c\u907f\u514d\u591a\u4e2a\u9879\u76ee\u5e76\u884c\u5f00\u53d1\u65f6\u5b58\u5728\u4f9d\u8d56\u51b2\u7a81\u7b49\u95ee\u9898\uff1b\\n- \u7eaf\u7cb9\u7684 Linux \u73af\u5883\u3002\u5bf9\u4e8e\u670d\u52a1\u7aef\u5f00\u53d1\u540c\u5b66\u6765\u8bf4\uff0cMacOS \u548c Windows \u7684\u4f9d\u8d56\u95ee\u9898\u5f80\u5f80\u6bd4\u5f00\u53d1\u9879\u76ee\u4ee3\u7801\u8fd8\u8981\u56f0\u96be\uff1b\\n\\n\u76ee\u524d\u6700\u6d41\u884c\u7684\u4e24\u79cd IDE\uff0c\u975e JetBrains \u7cfb\u548c VSCode \u83ab\u5c5e\uff0c\u800c\u8fd9\u4e24\u79cd\u5e7f\u53d7\u6b22\u8fce\u7684\u5f00\u53d1\u5de5\u5177\u90fd\u6709\u76f8\u5173\u7684\u4e91\u4ea7\u54c1\u9762\u4e16\uff0c\u53ef\u89c1\u5f88\u591a\u5f00\u53d1\u8005\u770b\u597d\u201c\u4e91 IDE\u201d\u8fd9\u4e2a\u65b9\u5411\u3002\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\nApache APISIX \u4f5c\u4e3a\u5f00\u6e90\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u5982\u4f55\u5feb\u901f\u7684\u90e8\u7f72 APISIX \u7684\u5f00\u53d1\u73af\u5883\u5bf9\u4e8e\u5f00\u53d1\u8005\u662f\u6bd4\u8f83\u91cd\u8981\u7684\u3002\u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 [Gitpod](https://gitpod.io/) \u5bf9 Apache APISIX \u8fdb\u884c\u76f8\u5173\u5f00\u53d1\u3002\\n\\n## \u5b89\u88c5 Gitpod Chrome \u63d2\u4ef6\\n\\nGitpod \u4e3a\u4e09\u4e2a\u4e3b\u6d41\u4ee3\u7801\u6258\u7ba1\u670d\u52a1 GitLab\u3001GitHub \u548c Bitbucket \u63d0\u4f9b\u4e86\u4e00\u952e\u542f\u52a8\u529f\u80fd\uff0c\u60a8\u53ea\u9700\u8981\u5b89\u88c5 [Chrome \u63d2\u4ef6](https://chrome.google.com/webstore/detail/gitpod-always-ready-to-co/dodmmooeoklaejobgleioelladacbeki)\u5373\u53ef\u8fdb\u884c\u540e\u7eed\u4f7f\u7528\u3002\\n\\n\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u8fd9\u4e2a\u63d2\u4ef6\u4f1a\u5728\u4ee3\u7801\u4ed3\u5e93\u9875\u9762\u6ce8\u5165\u4e00\u4e2a\u542f\u52a8\u6309\u94ae\uff0c\u4ee5 GitHub \u4e3a\u4f8b\u3002\u5b89\u88c5\u63d2\u4ef6\u540e\u6253\u5f00 APISIX \u9879\u76ee\u5730\u5740\uff0c\u53ef\u4ee5\u770b\u5230\u76f8\u5173\u6309\u94ae\uff1a\\n\\n![error/github example.png](https://static.apiseven.com/202108/1646233179407-391328ba-68cd-41df-8454-3c7d280bbc6e.png)\\n\\n\u5355\u51fb Gitpod \u6309\u94ae\u4f1a\u8df3\u8f6c\u5230 Gitpod \u7684\u9875\u9762\uff0c\u5b8c\u6210 GitHub \u5e94\u7528\u6388\u6743\u540e\uff0c\u8fdb\u5165\u4ee5\u4e0b\u754c\u9762\uff1a\\n\\n![erro/gitpod UI.png](https://static.apiseven.com/202108/1646233426671-547eb71c-9294-43af-b144-ea3298343341.png)\\n\\n\u662f\u4e0d\u662f\u975e\u5e38\u719f\u6089? \u5bf9\uff0c\u8fd9\u5c31\u662f\u65f6\u4e0b\u6700\u6d41\u884c\u7684\u4ee3\u7801\u7f16\u8f91\u5668 VSCode\u3002\\n\\n\u4e3a\u4e86\u5b9e\u73b0 VSCode \u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u5206\u79bb\u7684\u67b6\u6784\uff0cGitpod \u7ef4\u62a4\u4e00\u4e2a VSCode \u7684[\u5206\u652f](https://github.com/gitpod-io/openvscode-server)\u3002\u4f5c\u4e3a\u4e00\u4e2a\u4e91\u4e0a\u7684 VSCode \uff0c\u5b83\u4e0e\u684c\u9762\u7248\u7684\u529f\u80fd\u4e00\u81f4\u3002\u6211\u4eec\u5728\u672c\u5730\u5f00\u53d1\u65f6\u5e38\u7528\u7684\u63d2\u4ef6\u4e00\u6837\u53ef\u4ee5\u5728\u4e91\u4e0a\u4f7f\u7528\uff0c\u4e0e\u672c\u5730\u4e0d\u540c\u7684\u662f\uff0c\u4e91\u4e0a\u7684 VSCode \u6709\u7740\u670d\u52a1\u5668\u7ea7\u522b\u7684\u8ba1\u7b97\u8d44\u6e90\u548c\u7f51\u7edc\u73af\u5883\u3002\\n\\n## \u4f7f\u7528 Gitpod \u642d\u5efa APISIX \u5f00\u53d1\u73af\u5883\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u6267\u884c\u6d4b\u8bd5\u7528\u4f8b\\n\\n\u76f8\u4fe1\u5f88\u591a\u521a\u63a5\u89e6\u5f00\u6e90\u7684\u540c\u5b66\uff0c\u90fd\u4e3a\u5982\u4f55\u642d\u5efa\u5f00\u6e90\u9879\u76ee\u7684\u5f00\u53d1\u73af\u5883\u611f\u5230\u8fc7\u56f0\u6270\uff0c\u56e0\u4e3a\u5f00\u6e90\u9879\u76ee\u5f80\u5f80\u90fd\u4f1a\u5b58\u5728\u5927\u91cf\u81ea\u52a8\u5316\u6267\u884c\u7684\u6d4b\u8bd5\u7528\u4f8b\u6765\u4fdd\u8bc1\u6574\u4e2a\u9879\u76ee\u7684\u8d28\u91cf\uff0c\u6240\u4ee5\u5982\u4f55\u5728\u5f00\u53d1\u8005\u5728\u672c\u5730\u8fd0\u884c\u8fd9\u4e9b\u6d4b\u8bd5\u7528\u4f8b\uff0c\u53ef\u80fd\u662f\u6211\u4eec\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u8fd9\u4e00\u70b9\u548c\u4f01\u4e1a\u5185\u7684\u5f00\u53d1\u53ef\u80fd\u6709\u6bd4\u8f83\u5927\u7684\u5dee\u5f02\u3002\\n\\n\u4e0b\u9762\u6211\u4eec\u5c1d\u8bd5\u5728 Gitpod \u4e2d\u8fd0\u884c APISIX \u7684\u6d4b\u8bd5\u7528\u4f8b\uff0c\u8fd9\u91cc\u53ef\u4ee5\u53c2\u8003 APISIX \u4ed3\u5e93\u4e2d\u7684 [github workflow](https://github.com/apache/apisix/blob/master/.github/workflows/build.yml) \u914d\u7f6e\u4f9d\u8d56\u3002\u5728 Gitpod \u7684\u7ec8\u7aef\u4e2d\u6267\u884c\u5982\u4e0b\u6b65\u9aa4\uff1a\\n\\n```Shell\\n# \u542f\u52a8CI\u4f9d\u8d56\u7684\u7ec4\u4ef6\\nmake ci-env-up project_compose_ci=ci/pod/docker-compose.common.yml\\n\\n# \u5b89\u88c5\u7f16\u8bd1\u4f9d\u8d56\\nsudo apt install -y cpanminus build-essential libncurses5-dev libreadline-dev libssl-dev perl libpcre3 libpcre3-dev libldap2-dev\\n\\n# \u8fdb\u884c\u7f16\u8bd1\u548c\u6267\u884c\u6d4b\u8bd5\u7528\u4f8b\\nsudo OPENRESTY_VERSION=default ./ci/linux_openresty_1_17_runner.sh do_install\\nsudo ./ci/linux_openresty_1_17_runner.sh script\\n```\\n\\n:::tip \u63d0\u793a\\n\\n\u5982\u679c\u51fa\u73b0\u4ee5\u4e0b\u9519\u8bef\uff1a\\n\\n```\\nOPENRESTY_VERSION=default ./ci/linux_openresty_1_19_runner.sh do_install\\nbash: ./ci/linux_openresty_1_19_runner.sh: No such file or directory\\n```\\n\\n\u8bf7\u67e5\u770b `ci` \u76ee\u5f55\u4e0b APISIX \u6700\u65b0\u7248\u672c\u6240\u5bf9\u5e94\u7684 `linux_openresty_1_19_runner.sh` \u811a\u672c\u3002\\n\\n:::\\n\\n\u6574\u4e2a\u8fc7\u7a0b\u4f1a\u975e\u5e38\u6d41\u7545\uff0c\u56e0\u4e3a\u8fd9\u91cc\u6709\u4e00\u4e2a\u9690\u85cf\u7684\u4f18\u52bf\uff1aGitpod \u8fd0\u884c\u73af\u5883\u662f\u5728\u56fd\u5916\u7684\uff0c\u6240\u4ee5\u4e0b\u8f7d\u5404\u79cd\u4f9d\u8d56\u7684\u901f\u5ea6\u4f1a\u975e\u5e38\u7684\u5feb\uff0c\u4e0d\u4f1a\u9047\u5230\u7f51\u7edc\u95ee\u9898\u3002\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u8bbf\u95ee HTTP \u670d\u52a1\\n\\n\u90a3\u4e48\u5bf9\u4e8e\u9879\u76ee\u4e2d\u542f\u52a8\u7684 HTTP \u670d\u52a1\uff08\u4f8b\u5982 APISIX\uff09\u6211\u4eec\u8981\u5982\u4f55\u8bbf\u95ee\u5462\uff1f\\n\\n\u901a\u8fc7\u7ec8\u7aef\u8bbf\u95ee\u81ea\u7136\u662f\u53ef\u4ee5\u7684\uff0c\u4f46\u5982\u679c\u4f60\u60f3\u8981\u901a\u8fc7\u9875\u9762\u8bbf\u95ee\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 Remote Explorer \u5c06\u6253\u5f00\u7684\u7aef\u53e3\u66b4\u9732\u5230\u516c\u7f51\u4e0a\uff0c \u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![error/access page example.png](https://static.apiseven.com/202108/1646234288822-b7e30fce-604f-451a-b87f-3b72309b246a.png)\\n\\n\u7136\u540e\u518d\u901a\u8fc7\u5355\u51fb\u7aef\u53e3\u53f3\u4fa7\u7684\u6d4f\u89c8\u5668\u56fe\u6807\uff0cGitpod \u4f1a\u81ea\u52a8\u6253\u5f00\u4e00\u4e2a\u94fe\u63a5\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5230\u8fd9\u4e2a\u7aef\u53e3\u5bf9\u5e94\u7684\u670d\u52a1\u4e86\u3002\\n\\n## \u5e38\u89c1\u95ee\u9898\u6c47\u603b\\n\\n### \u6d4f\u89c8\u5668\u7aef\u4f53\u9a8c\\n\\n\u5728\u6d4f\u89c8\u5668\u4e2d\u4f7f\u7528 Gitpod \u6709\u4e00\u4e2a\u5f88\u5927\u7684\u95ee\u9898\u662f\uff0c\u5f88\u591a VSCode \u7684\u5feb\u6377\u952e\u4f1a\u88ab\u6d4f\u89c8\u5668\u6355\u83b7\uff0c\u5bfc\u81f4\u65e0\u6cd5\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 VSCode \u7684 Gitpod \u63d2\u4ef6\u6765\u5b9e\u73b0\u66f4\u52a0\u539f\u751f\u7684\u7f16\u7801\u4f53\u9a8c\u3002\\n\\n\u5177\u4f53\u65b9\u6cd5\u5982\u4e0b\uff1a\\n\\n1. \u5728 VSCode \u7684\u63d2\u4ef6\u5e02\u573a\uff0c\u5b89\u88c5 Gitpod \u63d2\u4ef6\u3002\\n\\n![error/install gitpod plugin.png](https://static.apiseven.com/202108/1646234524665-0e860b0b-ec80-4ba9-a893-cfa79d3f48c3.png)\\n\\n2. \u5728\u6d4f\u89c8\u5668\u7684 Gitpod \u9875\u9762\u5355\u51fb `Gitpod: Open in VS Code` \u5c31\u53ef\u4ee5\u5b9e\u73b0\u62c9\u8d77\u672c\u5730\u7684 VSCode \u4f5c\u4e3a\u5ba2\u6237\u7aef\u8fde\u63a5\u5230\u4e91\u7aef\u7684 Gitpod \uff0c\u8fbe\u5230\u4e0e\u684c\u9762\u7248\u76f8\u540c\u6548\u679c\u7684\u7f16\u7801\u4f53\u9a8c\u3002\\n\\n![error/open in vs code.png](https://static.apiseven.com/202108/1646234630208-bc8912a8-9542-4888-9cde-8889631d2ea8.png)\\n\\n### \u79c1\u6709\u5316\u90e8\u7f72\\n\\n\u524d\u9762\u6211\u4eec\u63d0\u5230 Gitpod \u662f\u4e00\u6b3e\u5f00\u6e90\u4ea7\u54c1\uff0c\u6240\u4ee5\u662f\u5b8c\u5168\u53ef\u4ee5\u5728\u7ec4\u7ec7\u5185\u90e8\u8fdb\u884c\u79c1\u6709\u5316\u90e8\u7f72\u670d\u52a1\u7684\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u79c1\u6709\u4ee3\u7801\u4ed3\u5e93\u4e2d\u4f7f\u7528\u4e0a\u8fd9\u6b3e\u4f18\u79c0\u7684\u5f00\u53d1\u5de5\u5177\u3002\u5177\u4f53\u90e8\u7f72\u65b9\u5f0f\u53ef\u4ee5\u53c2\u8003 Gitpod \u7684[\u5b98\u65b9\u6587\u6863\u548c\u4ed3\u5e93](https://github.com/gitpod-io/gitpod)\u3002\\n\\n## \u603b\u7ed3\\n\\nGitpod \u7684\u4f18\u70b9\u662f\u53ef\u4ee5\u8ba9\u5f00\u53d1\u8005\u5feb\u901f\u4e0a\u624b\u4e00\u4e2a\u9879\u76ee\uff0c\u8fd9\u4e00\u70b9\u975e\u5e38\u7b26\u5408\u5f00\u6e90\u793e\u533a\u7684\u9700\u6c42\u3002\u56e0\u4e3a\u5f00\u6e90\u9879\u76ee\u5f80\u5f80\u4f1a\u7ed9\u521a\u521a\u63a5\u89e6\u5f00\u6e90\u7684\u5f00\u53d1\u8005\u4e00\u79cd\u795e\u79d8\u83ab\u6d4b\u7684\u611f\u89c9\uff0c\u8ba9\u4eba\u671b\u800c\u5374\u6b65\uff0c\u4f46\u771f\u6b63\u63a5\u89e6\u540e\u4f60\u4f1a\u53d1\u73b0\u5e76\u4e0d\u5982\u6b64\u3002\\n\\n\u5e0c\u671b\u901a\u8fc7\u672c\u6587\u7684\u4ecb\u7ecd\u548c\u63cf\u8ff0\uff0c\u53ef\u4ee5\u8ba9\u6bcf\u4e00\u4e2a\u5bf9\u5f00\u6e90\u9879\u76ee\u611f\u5174\u8da3\u7684\u5f00\u53d1\u8005\u501f\u52a9\u5f00\u6e90\u5de5\u5177\u52a0\u6301\u4e0b\uff0c\u90fd\u80fd\u66f4\u52a0\u8f7b\u677e\u5f97\u52a0\u5165\u5230\u5f00\u6e90\u793e\u533a\u4e2d\u53bb\uff0c\u8ba9\u5f00\u6e90\u7684\u751f\u6001\u6301\u7eed\u7e41\u8363\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff082.15-2.28\uff09","metadata":{"permalink":"/zh/blog/2022/03/03/weekly-report-0228","source":"@site/blog/2022/03/03/weekly-report-0228.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff082.15-2.28\uff09","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86 mocking \u63d2\u4ef6\uff0c\u652f\u6301\u5c06 access log \u63a8\u9001\u5230 ClickHouse\uff0c\u6dfb\u52a0 Kubernetes \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0\u7b49\u529f\u80fd\u3002","date":"2022-03-03T00:00:00.000Z","formattedDate":"2022\u5e743\u67083\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.345,"truncated":true,"authors":[],"prevItem":{"title":"\u4f7f\u7528 Gitpod \u5f00\u53d1 API \u7f51\u5173 Apache APISIX","permalink":"/zh/blog/2022/03/03/develop-apisix-with-gitpod"},"nextItem":{"title":"GraphQL \u78b0\u649e API \u7f51\u5173 Apache APISIX\uff0c\u63d0\u5347 API \u9886\u57df\u7684\u5b89\u5168\u4e0e\u6027\u80fd","permalink":"/zh/blog/2022/03/02/apisix-integration-graphql"}},"content":"> \u4ece 2.15 \u5230 2.28, \u6709 43 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 101 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1646206544073-3e8b3bc8-b941-447e-af00-fb1273f1cfbf.jpg)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1646206544057-52a28a3f-7bc5-43be-9f21-5a0cd78a4863.jpg)\\n\\n## Good first issue\\n\\n### Issue #920\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix-website/issues/920\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u76ee\u524d\uff0c\u5728\u5b98\u7f51\u535a\u5ba2\u63d0\u4ea4\u65b0\u535a\u6587\u7684 pull request \u65f6\uff0c\u5fc5\u987b\u540c\u65f6\u63d0\u4ea4\u4e2d\u6587\u548c\u82f1\u6587\u4e24\u4e2a\u7248\u672c\u7684\u6587\u6863\u3002\\n\\n\u7136\u800c\u968f\u7740\u793e\u533a\u7684\u53d1\u5c55\uff0c\u4e24\u79cd\u8bed\u8a00\u7684\u535a\u5ba2\u53d8\u5f97\u6bd4\u4ee5\u524d\u66f4\u52a0\u591a\u6837\u5316\u3002\u56e0\u6b64\u4eca\u540e\u63d0\u4ea4\u7684\u535a\u5ba2\u66f4\u591a\u53ef\u80fd\u53ea\u6709\u4e00\u79cd\u8bed\u8a00\u3002\u4f46\u5b9e\u9645\u4e0a\uff0c\u5982\u679c\u53ea\u63d0\u4ea4\u82f1\u6587\u535a\u5ba2\uff0c\u800c\u6ca1\u6709\u4e2d\u6587\u535a\u5ba2\uff0c\u5f53\u7528\u6237\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684\u8bed\u8a00\u8f6c\u6362\u6309\u94ae\u65f6\uff0c\u4f1a\u8df3\u8f6c\u5230\u9ed8\u8ba4\u7684 404 \u9875\u9762\u3002\\n\\n\u6240\u4ee5\u9700\u8981\u5bf9\u5b98\u7f51\u7ed3\u6784\u8fdb\u884c\u4fee\u6539\uff0c\u4fdd\u8bc1\u5728\u5355\u8bed\u8a00\u7684\u535a\u5ba2\u9875\u9762\u70b9\u51fb\u8bed\u8a00\u8f6c\u6362\u540e\uff0c\u4f9d\u65e7\u505c\u7559\u5728\u539f\u6765\u7684\u9875\u9762\uff0c\u907f\u514d\u8df3\u8f6c\u81f3 404 \u9875\u9762\u3002\\n\\n### Issue #6460\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/6460\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5f53\u4f7f\u7528 `authz-keycloak` \u63d2\u4ef6\uff0c\u4e14\u8bbf\u95ee\u4e0d\u88ab\u5141\u8bb8\u65f6\uff0c\u5c06\u5728\u8bf7\u6c42\u7684 URL \u6b63\u6587\u4e2d\u6536\u5230\u4e00\u4e2a\u62d2\u7edd\u8bbf\u95ee\u7684\u4fe1\u606f\uff1a\\n\\n```Json\\n{\\"error\\":\\"access_denied\\",\\"error_description\\":\\"not_authorized\\"}\\n```\\n\\n\u5f53\u8bbf\u95ee\u88ab\u62d2\u7edd\u65f6\uff0c\u662f\u5426\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u91cd\u5b9a\u5411\u7684 URL\uff0c\u4f7f\u7528\u6237\u770b\u5230\u9884\u5b9a\u4e49\u7684\u9875\u9762\u800c\u4e0d\u662f\u4fe1\u606f\uff1f\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [\u652f\u6301\u5c06 access log \u63a8\u9001\u5230 ClickHouse](https://github.com/apache/apisix/pull/6215)\uff08\u8d21\u732e\u8005\uff1a[zhendongcmss](https://github.com/zhendongcmss)\uff09\\n\\n- [\u6dfb\u52a0 Kubernetes \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0](https://github.com/apache/apisix/pull/4880)\uff08\u8d21\u732e\u8005\uff1a[zhixiongdu027](https://github.com/zhixiongdu027)\uff09\\n\\n- [\u652f\u6301\u914d\u7f6e X-APISIX-Upstream-Status \u8fd4\u56de\u6240\u6709\u4e0a\u6e38\u72b6\u6001](https://github.com/apache/apisix/pull/6392)\uff08\u8d21\u732e\u8005\uff1a[liangliang4ward](https://github.com/liangliang4ward)\uff09\\n\\n- [\u65b0\u589e `mocking` \u63d2\u4ef6](https://github.com/apache/apisix/pull/5940)\uff08\u8d21\u732e\u8005\uff1a[Drery](https://github.com/Drery)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u5982\u4f55\u4f7f\u7528 Apache APISIX CSRF \u5b89\u5168\u63d2\u4ef6\u62e6\u622a\u8de8\u7ad9\u70b9\u4f2a\u9020\u653b\u51fb](https://apisix.apache.org/zh/blog/2022/02/23/csrf-api-gateway)\uff1a\\n\\n  \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u7684 CSRF \u5b89\u5168\u63d2\u4ef6 `csrf`\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u5728 Apache APISIX \u4e2d\u501f\u52a9 `csrf` \u63d2\u4ef6\u6765\u4fdd\u62a4\u60a8\u7684 API \u4fe1\u606f\u5b89\u5168\u3002\\n\\n- [\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u5347\u7ea7\uff0cAPI \u7f51\u5173 Apache APISIX \u96c6\u6210 OpenTelemetry](https://apisix.apache.org/zh/blog/2022/02/28/apisix-integration-opentelemetry-plugin)\uff1a\\n\\n  \u672c\u6587\u4e3a\u60a8\u4ecb\u7ecd\u4e86 API \u7f51\u5173 Apache APISIX \u4e2d\u7684 `opentelemetry` \u63d2\u4ef6\u7684\u6982\u5ff5\u4ee5\u53ca\u5982\u4f55\u90e8\u7f72 `opentelemetry` \u63d2\u4ef6\u3002\\n\\n- [API \u7f51\u5173 Apache APISIX \u96c6\u6210 Consul KV\uff0c\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u518d\u5347\u7ea7](https://apisix.apache.org/zh/blog/2022/02/25/consul-api-gateway)\uff1a\\n\\n  Apache APISIX \u652f\u6301\u57fa\u4e8e Consul KV \u7684\u670d\u52a1\u53d1\u73b0\u6ce8\u518c\u8868\u3002\u8fd9\u7bc7\u6587\u7ae0\u8bb2\u8ff0\u4e86\u5728 Apache APISIX \u4e2d\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u548c\u670d\u52a1\u6ce8\u518c\u7684\u5168\u8fc7\u7a0b\u3002\\n\\n- [Nacos \u5728 API \u7f51\u5173\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/02/21/nacos-api-gateway)\uff1a\\n\\n  \u672c\u6587\u4e3a\u60a8\u4ecb\u7ecd Apache APISIX \u57fa\u672c\u6982\u5ff5\u4ee5\u53ca\u6ce8\u518c\u4e2d\u5fc3\u7684\u4f5c\u7528\uff0c\u5e76\u4e3a\u60a8\u5c55\u793a\u4e86 API \u7f51\u5173\u57fa\u4e8e Nacos \u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u7684\u5177\u4f53\u64cd\u4f5c\u3002"},{"id":"GraphQL \u78b0\u649e API \u7f51\u5173 Apache APISIX\uff0c\u63d0\u5347 API \u9886\u57df\u7684\u5b89\u5168\u4e0e\u6027\u80fd","metadata":{"permalink":"/zh/blog/2022/03/02/apisix-integration-graphql","source":"@site/blog/2022/03/02/apisix-integration-graphql.md","title":"GraphQL \u78b0\u649e API \u7f51\u5173 Apache APISIX\uff0c\u63d0\u5347 API \u9886\u57df\u7684\u5b89\u5168\u4e0e\u6027\u80fd","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u548c GraphQL \u7684\u7279\u6027\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528 Apache APISIX \u4ee3\u7406 GraphQL \u8bf7\u6c42\uff0c\u5e76\u63d0\u51fa\u89e3\u51b3\u5b9e\u9645\u573a\u666f\u75db\u70b9\u7684\u65b9\u6848\u3002","date":"2022-03-02T00:00:00.000Z","formattedDate":"2022\u5e743\u67082\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":11.87,"truncated":true,"authors":[{"name":"\u6c5f\u6668\u709c","title":"Author","url":"https://github.com/Chever-John","image_url":"https://avatars.githubusercontent.com/u/43690894?v=4","imageURL":"https://avatars.githubusercontent.com/u/43690894?v=4"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://avatars.githubusercontent.com/u/97138894?v=4","imageURL":"https://avatars.githubusercontent.com/u/97138894?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff082.15-2.28\uff09","permalink":"/zh/blog/2022/03/03/weekly-report-0228"},"nextItem":{"title":"APISIX \u5728\u4f17\u5b89\u4fdd\u9669\u7684\u5e94\u7528\u5b9e\u8df5","permalink":"/zh/blog/2022/03/02/zhongan-usercase-with-apache-apisix"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u548c GraphQL \u7684\u7279\u6027\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u4ee3\u7406 GraphQL \u8bf7\u6c42\uff0c\u5e76\u63d0\u51fa\u89e3\u51b3\u5b9e\u9645\u573a\u666f\u75db\u70b9\u7684\u65b9\u6848\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\nGraphQL \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u3001\u9762\u5411 API \u800c\u521b\u9020\u51fa\u6765\u7684\u6570\u636e\u67e5\u8be2\u64cd\u4f5c\u8bed\u8a00\u4ee5\u53ca\u76f8\u5e94\u7684\u8fd0\u884c\u73af\u5883\u3002\u6700\u521d\u7531 Facebook \u4e8e 2012 \u5e74\u5185\u90e8\u5f00\u53d1\uff0c2015 \u5e74\u516c\u5f00\u53d1\u5e03\u30022018 \u5e74 11 \u6708 7 \u65e5\uff0cFacebook \u5c06 GraphQL \u9879\u76ee\u8f6c\u79fb\u5230\u65b0\u6210\u7acb\u7684 GraphQL \u57fa\u91d1\u4f1a\u3002\\n\\n\u60a8\u53ef\u4ee5\u628a GraphQL \u7c7b\u6bd4\u4e3a SQL \u67e5\u8be2\u8bed\u53e5\u6765\u7406\u89e3\uff0c\u4e0e SQL \u67e5\u8be2\u8bed\u53e5\u76f8\u6bd4\uff0cGraphQL \u5bf9 API \u4e2d\u7684\u6570\u636e\u63d0\u4f9b\u4e86\u4e00\u5957\u6613\u4e8e\u7406\u89e3\u7684\u5b8c\u6574\u63cf\u8ff0\uff0c\u8ba9\u5ba2\u6237\u7aef\u80fd\u591f\u901a\u8fc7\u81ea\u5b9a\u4e49\u7684\u63cf\u8ff0\u6765\u51c6\u786e\u83b7\u5f97\u5176\u6240\u9700\u8981\u7684\u6570\u636e\u3002\u8fd9\u4e5f\u8ba9 API \u80fd\u591f\u4ece\u5bb9\u9762\u5bf9\u65e5\u76ca\u590d\u6742\u7684\u63a5\u53e3\u53d1\u5c55\uff0c\u5e76\u907f\u514d\u6700\u7ec8\u6210\u4e3a\u4e00\u4e2a\u4ee4\u4eba\u671b\u800c\u751f\u754f\u7684\u590d\u6742\u63a5\u53e3\u3002\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\nApache APISIX \u4f5c\u4e3a\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u5728\u8bbe\u8ba1\u4e4b\u521d\u5c31\u5df2\u7ecf\u5177\u5907\u8bc6\u522b GraphQL \u8bed\u6cd5\u7684\u5339\u914d\u80fd\u529b\u3002\u901a\u8fc7\u5bf9\u8bf7\u6c42\u4e2d\u643a\u5e26\u7684 GraphQL \u8bed\u53e5\u8fdb\u884c\u9ad8\u6548\u5339\u914d\uff0c\u7b5b\u9664\u5f02\u5e38\u6d41\u91cf\uff0c\u8fdb\u4e00\u6b65\u4fdd\u8bc1\u5b89\u5168\u6027\u548c\u63d0\u9ad8\u7cfb\u7edf\u6027\u80fd\u3002\\n\\n### \u573a\u666f\u89e3\u6790\\n\\n\u6211\u4eec\u6b63\u5904\u4e8e\u5927\u6570\u636e\u5927\u6d41\u91cf\u7684\u65f6\u4ee3\uff0cApache APISIX \u548c  GraphQL \u53ef\u4ee5\u901a\u8fc7\u7ed3\u5408\u7684\u65b9\u5f0f\uff0c\u5f62\u6210\u5171\u8d62\u7684\u5c40\u9762\u3002\u63a5\u4e0b\u6765\u4e3e\u4e00\u4e2a\u573a\u666f\u5177\u4f53\u8bf4\u660e\u3002\\n\\n\u672c\u6587\u5c06\u4f1a\u8ba8\u8bba\u5fae\u670d\u52a1\u67b6\u6784\u573a\u666f\u4e0b\u7684 Apache APISIX \u548c GraphQL \u7684\u5b9e\u9645\u5e94\u7528\u3002\\n\\n### \u5b9e\u9645\u573a\u666f\u4e2d\u9047\u5230\u7684\u95ee\u9898\\n\\n\u5728\u9879\u76ee\u8fdb\u884c\u5230\u540e\u671f\u65f6\uff0c\u5f80\u5f80\u4f1a\u51fa\u73b0\u4e1a\u52a1\u590d\u6742\u5316\u3001\u56e2\u961f\u4eba\u5458\u6d41\u52a8\u6027\u9ad8\u7b49\u95ee\u9898\uff0c\u800c\u5fae\u670d\u52a1\u67b6\u6784\u5df2\u7ecf\u6210\u4e3a\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898\u7684\u5e38\u89c1\u89e3\u51b3\u65b9\u6848\u3002\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0cGraphQL \u66b4\u9732\u51fa\u7684\u63a5\u53e3\u5206\u4e3a\u5206\u6563\u5f0f\u548c\u96c6\u4e2d\u5f0f\u4e24\u79cd\uff0c\u7136\u800c\u53ea\u6709\u96c6\u4e2d\u5f0f\u63a5\u53e3\u8bbe\u8ba1\u624d\u80fd\u591f\u6700\u5927\u5316\u4f53\u73b0 GraphQL \u7684\u4f18\u52bf\uff0c\u4f46\u662f\u5728\u96c6\u4e2d\u5f0f\u63a5\u53e3\u8bbe\u8ba1\u4e2d\uff0c\u6240\u6709\u7684\u5fae\u670d\u52a1\u5bf9\u5916\u66b4\u9732\u7684\u662f\u540c\u4e00\u4e2a\u63a5\u53e3\uff0c**\u56e0\u6b64\u5904\u7406\u6d41\u91cf\u7684\u8def\u7531\u5c31\u4e0d\u80fd\u7b80\u5355\u5730\u6839\u636e URL \u8fdb\u884c\u8f6c\u53d1\uff0c\u800c\u662f\u5e94\u8be5\u6839\u636e\u8bf7\u6c42\u4e2d\u5305\u542b\u7684\u4e0d\u540c\u5b57\u6bb5\u8fdb\u884c\u8f6c\u53d1**\u3002\\n\\n\u7531\u4e8e NGINX \u5904\u7406\u8bf7\u6c42\u65f6\u4ec5\u4f1a\u5904\u7406 URL \u4ee5\u53ca\u4e00\u4e9b\u53c2\u6570\uff0c\u4f46\u662f\u53ea\u6709\u89e3\u6790\u8bf7\u6c42\u53c2\u6570\u4e2d\u7684\u67e5\u8be2\u4fe1\u606f\u624d\u53ef\u4ee5\u77e5\u9053\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u8d44\u6e90\uff0c\u4ece\u800c\u8fdb\u884c\u8def\u7531\u8f6c\u53d1\uff0c\u56e0\u6b64\u8fd9\u79cd\u8def\u7531\u8f6c\u53d1\u65b9\u5f0f\u901a\u8fc7\u4f20\u7edf\u7684 NGINX \u662f\u65e0\u6cd5\u5b8c\u6210\u7684\u3002\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u5c06 GraphQL \u63a5\u53e3\u76f4\u63a5\u5bf9\u5916\u66b4\u9732\u975e\u5e38\u5371\u9669\uff0c\u56e0\u6b64\u9700\u8981\u4e00\u4e2a\u4e13\u4e1a\u7684\u9ad8\u6027\u80fd API \u7f51\u5173\u4fdd\u62a4 GraphQL \u7684\u63a5\u53e3\u3002\\n\\n### \u89e3\u51b3\u65b9\u6848\\n\\n\u57fa\u4e8e Apache APISIX \u5b89\u5168\u3001\u7a33\u5b9a\u3001\u9ad8\u6027\u80fd\u7684\u7279\u6027\uff0c\u589e\u52a0 GraphQL \u7075\u6d3b\u7684\u8def\u7531\u5339\u914d\u89c4\u5219\u662f\u89e3\u51b3 GraphQL \u96c6\u4e2d\u5f0f\u63a5\u53e3\u8bbe\u8ba1\u95ee\u9898\u7684\u6700\u4f73\u65b9\u6848\u3002\\n\\n![error/graphql architecture.png](https://static.apiseven.com/202108/1646200966179-1d649ab0-8d49-49f5-a8fa-a1a30af0519d.png)\\n\\n\u5728\u6b64\u65b9\u6848\u4e2d\uff0cApache APISIX \u4f5c\u4e3a API \u7f51\u5173\u90e8\u7f72\u5728 GraphQL Server \u4e4b\u524d\uff0c\u4e3a\u6574\u4e2a\u540e\u7aef\u7cfb\u7edf\u63d0\u4f9b\u4e86\u5b89\u5168\u4fdd\u969c\uff0c\u5e76\u4e14 Apache APISIX \u6839\u636e\u81ea\u8eab\u6240\u5177\u5907\u7684 GraphQL \u5339\u914d\u529f\u80fd\uff0c\u7b5b\u9009\u4e00\u90e8\u5206\u8bf7\u6c42\u4e4b\u540e\u518d\u7531 GraphQL Server \u8fdb\u884c\u5904\u7406\uff0c\u4f7f\u6574\u4e2a\u8bf7\u6c42\u8d44\u6e90\u8fc7\u7a0b\u53d8\u5f97\u66f4\u9ad8\u6548\u3002\\n\\n\u5f97\u76ca\u4e8e Apache APISIX \u7684\u52a8\u6001\u7279\u6027\uff0c\u60a8\u53ef\u4ee5\u542f\u7528\u9650\u6d41\u9650\u901f\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u63d2\u4ef6\uff0c\u65e0\u9700\u91cd\u542f\u670d\u52a1\uff0c\u8fdb\u4e00\u6b65\u63d0\u9ad8\u6b64\u65b9\u6848\u7684\u8fd0\u884c\u6548\u7387\uff0c\u65b9\u4fbf\u8fd0\u7ef4\u5de5\u4f5c\u3002\\n\\n\u6b64\u5916\uff0cApache APISIX \u8fd8\u53ef\u4ee5\u9488\u5bf9\u4e0d\u540c\u7684 `graphql_operation` \u8fdb\u884c\u4e0d\u540c\u7684\u6743\u9650\u6821\u9a8c\u3001\u9488\u5bf9\u4e0d\u540c\u7684 `graphql_name` \u8f6c\u53d1\u5230\u4e0d\u540c\u7684 Upstream\uff0c\u5177\u4f53\u7ec6\u8282\u5c06\u4f1a\u5728\u4e0b\u6587\u4e2d\u8fdb\u884c\u63cf\u8ff0\u3002\\n\\n**\u7efc\u4e0a\u6240\u8ff0\uff0cApache APISIX + GraphQL \u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5728\u5145\u5206\u5229\u7528 GraphQL \u641c\u7d22\u4f18\u52bf\u7684\u540c\u65f6\u4e5f\u80fd\u62e5\u6709 Apache APISIX \u4f5c\u4e3a API \u7f51\u5173\u6240\u5177\u5907\u7684\u5b89\u5168\u6027\u548c\u7a33\u5b9a\u6027\u3002**\\n\\n## GraphQL \u5728 Apache APISIX \u4e2d\u7684\u5e94\u7528\\n\\n### \u57fa\u672c\u903b\u8f91\\n\\n![error/GraphQL principle.png](https://static.apiseven.com/202108/1646201215532-f5965158-7456-443a-84a7-cadadb95fc1f.png)\\n\\n\u76ee\u524d GraphQL \u5728 Apache APISIX \u4e2d\u7684\u6267\u884c\u903b\u8f91\u5982\u4e0b\uff1a\\n\\n1. Clients \u5411 Apache APISIX \u53d1\u8d77\u5e26\u6709 GraphQL \u8bed\u53e5\u7684\u8bf7\u6c42\uff1b\\n2. Apache APISIX \u5339\u914d\u8def\u7531\u5e76\u63d0\u53d6\u9884\u8bbe\u7684 GraphQL \u6570\u636e\uff1b\\n3. Apache APISIX \u901a\u8fc7\u9884\u8bbe GraphQL \u6570\u636e\u5bf9\u8bf7\u6c42\u6570\u636e\u8fdb\u884c\u5339\u914d\uff1b\\n\\n- \u5339\u914d\u6210\u529f\uff0cApache APISIX \u5c06\u7ee7\u7eed\u8f6c\u53d1\u8bf7\u6c42\uff1b\\n- \u5339\u914d\u5931\u8d25\uff0cApache APISIX \u5c06\u7acb\u523b\u7ec8\u6b62\u8bf7\u6c42\u3002\\n\\n4. \u662f\u5426\u5b58\u5728\u63d2\u4ef6\uff1b\\n\\n- \u5982\u679c\u5b58\u5728\u63d2\u4ef6\uff0c\u8bf7\u6c42\u5c06\u7ee7\u7eed\u88ab\u63d2\u4ef6\u5904\u7406\uff0c\u5904\u7406\u5b8c\u6210\u540e\uff0c\u7ee7\u7eed\u8f6c\u53d1\u5230 GraphQL Server\uff1b\\n- \u5982\u679c\u4e0d\u5b58\u5728\u63d2\u4ef6\uff0c\u8bf7\u6c42\u5c06\u76f4\u63a5\u8f6c\u53d1\u5230 GraphQL Server\u3002\\n\\n\u5728 APISIX core \u91cc\u5185\u90e8\u5339\u914d\u4e2d\uff0cApache APISIX \u901a\u8fc7 [`graphql-lua`](https://github.com/bjornbytes/graphql-lua) \u5e93\u5b9e\u73b0\u5bf9 GraphQL \u7684\u652f\u6301\u3002Apache APISIX GraphQL \u89e3\u6790\u5e93\u4f1a\u5148\u5bf9\u643a\u5e26 GraphQL \u8bed\u6cd5\u7684\u8bf7\u6c42\u8fdb\u884c\u89e3\u6790\uff0c\u4e4b\u540e\u5c06\u89e3\u6790\u540e\u7684\u8bf7\u6c42\u4e0e\u9884\u8bbe\u5728 Apache APISIX \u6570\u636e\u5e93\u91cc\u7684\u914d\u7f6e\u6570\u636e\u8fdb\u884c\u5339\u914d\u3002\u5982\u679c\u5339\u914d\u6210\u529f Apache APISIX \u4f1a\u653e\u884c\u5e76\u8f6c\u53d1\u8bf7\u6c42\uff0c\u53cd\u4e4b\u5219\u7ec8\u6b62\u8bf7\u6c42\\n\\n### \u5177\u4f53\u914d\u7f6e\\n\\nApache APISIX \u76ee\u524d\u652f\u6301\u901a\u8fc7 GraphQL \u7684\u4e00\u4e9b\u5c5e\u6027\u8fc7\u6ee4\u8def\u7531\uff1a\\n\\n- graphql_operation\\n- graphql_name\\n- graphql_root_fields\\n\\nGraphQL \u7684\u5c5e\u6027\u4e0e\u4e0b\u9762\u7684\u6240\u5c55\u793a GraphQL query \u8bed\u53e5\u4e00\u4e00\u5bf9\u5e94\uff1a\\n\\n```Nginx\\n  query getRepo {\\n      owner {\\n          name\\n      }\\n      repo {\\n          created\\n      }\\n  }\\n```\\n\\n- `graphql_operation` \u5bf9\u5e94 `query`\\n- `graphql_name` \u5bf9\u5e94 `getRepo`\\n- `graphql_root_fields` \u5bf9\u5e94 `[\\"owner\\", \\"repo\\"]`\\n\\n\u60a8\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u793a\u4f8b\u4e3a Apache APISIX \u8bbe\u7f6e\u4e00\u6761\u8def\u7531\u6765\u9a8c\u8bc1\u5bf9 GraphQL \u7684\u5339\u914d\u80fd\u529b\uff1a\\n\\n```Shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n  {\\n      \\"methods\\": [\\"POST\\"],\\n      \\"uri\\": \\"/graphql\\",\\n      \\"vars\\": [\\n          [\\"graphql_operation\\", \\"==\\", \\"query\\"],\\n          [\\"graphql_name\\", \\"==\\", \\"getRepo\\"],\\n          [\\"graphql_root_fields\\", \\"has\\", \\"owner\\"]\\n      ],\\n      \\"upstream\\": {\\n          \\"type\\": \\"roundrobin\\",\\n          \\"nodes\\": {\\n              \\"192.168.1.200:4000\\": 1\\n          }\\n      }\\n  }\'\\n```\\n\\n\u63a5\u4e0b\u6765\u4f7f\u7528\u5e26\u6709 GraphQL \u8bed\u53e5\u7684\u8bf7\u6c42\u53bb\u8bbf\u95ee\uff1a\\n\\n```Shell\\ncurl -H \'content-type: application/graphql\' \\\\\\n-X POST http://127.0.0.1:9080/graphql -d \'\\nquery getRepo {\\n    owner {\\n        name\\n    }\\n    repo {\\n        created\\n    }\\n}\'\\n```\\n\\n\u5982\u679c\u5339\u914d\u6210\u529f\uff0c\u5219 Apache APISIX \u7ee7\u7eed\u8fdb\u884c\u8bf7\u6c42\u8f6c\u53d1\u3002\\n\\n```Shell\\nHTTP/1.1 200 OK\\n```\\n\\n\u53cd\u4e4b\uff0c\u5219\u7ec8\u6b62\u8bf7\u6c42\u3002\\n\\n```Shell\\nHTTP/1.1 404 Not Found\\n```\\n\\n## \u8fdb\u9636\u64cd\u4f5c\\n\\n Apache APISIX \u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684 `graphql_name` \u8f6c\u53d1\u5230\u4e0d\u540c\u7684 Upstream\uff0c\u4ee5\u53ca\u6839\u636e\u4e0d\u540c `graphql_operation` \u8fdb\u884c\u4e0d\u540c\u7684\u6743\u9650\u6821\u9a8c\u3002\u4e0b\u6587\u5c06\u4e3a\u60a8\u5c55\u793a\u6b64\u7279\u6027\u7684\u4ee3\u7801\u914d\u7f6e\u3002\\n\\n### \u4f7f\u7528 `graphql_name` \u5339\u914d Upstream\\n\\n1. \u521b\u5efa\u7b2c\u4e00\u4e2a\u4e0a\u6e38\u670d\u52a1\uff1a\\n\\n```Shell\\n  curl http://192.168.1.200:9080/apisix/admin/upstreams/1 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n  {\\n      \\"type\\": \\"chash\\",\\n      \\"key\\": \\"remote_addr\\",\\n      \\"nodes\\": {\\n          \\"192.168.1.200:1980\\": 1\\n      }\\n  }\'\\n```\\n\\n2. \u521b\u5efa\u4e0e\u7b2c\u4e00\u4e2a\u4e0a\u6e38\u670d\u52a1\u7ed1\u5b9a\u7684 GraphQL \u8def\u7531\uff0c`graphql_name` \u8bbe\u7f6e\u4e3a `getRepo111`\uff1a\\n\\n```Shell\\n  curl http://192.168.1.200:9080/apisix/admin/routes/1 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n  {\\n      \\"methods\\": [\\"POST\\"],\\n      \\"uri\\": \\"/graphql\\",\\n      \\"vars\\": [\\n          [\\"graphql_operation\\", \\"==\\", \\"query\\"],\\n          [\\"graphql_name\\", \\"==\\", \\"getRepo111\\"],\\n          [\\"graphql_root_fields\\", \\"has\\", \\"owner\\"]\\n      ],\\n      \\"upstream_id\\": \\"1\\"\\n  }\'\\n```\\n\\n3. \u521b\u5efa\u7b2c\u4e8c\u4e2a\u4e0a\u6e38\u670d\u52a1\uff1a\\n\\n```Shell\\n  curl http://192.168.1.200:9080/apisix/admin/upstreams/2 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n  {\\n      \\"type\\": \\"chash\\",\\n      \\"key\\": \\"remote_addr\\",\\n      \\"nodes\\": {\\n          \\"192.168.1.200:1981\\": 1\\n      }\\n  }\'\\n```\\n\\n4. \u521b\u5efa\u4e0e\u7b2c\u4e8c\u4e2a\u4e0a\u6e38\u670d\u52a1\u7ed1\u5b9a\u7684 GraphQL \u8def\u7531\uff0c`graphql_name` \u8bbe\u7f6e\u4e3a `getRepo222`\uff1a\\n\\n```Shell\\n  curl http://192.168.1.200:9080/apisix/admin/routes/2 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n  {\\n      \\"methods\\": [\\"POST\\"],\\n      \\"uri\\": \\"/graphql\\",\\n      \\"vars\\": [\\n          [\\"graphql_operation\\", \\"==\\", \\"query\\"],\\n          [\\"graphql_name\\", \\"==\\", \\"getRepo222\\"],\\n          [\\"graphql_root_fields\\", \\"has\\", \\"owner\\"]\\n      ],\\n      \\"upstream_id\\": 2\\n  }\'\\n```\\n\\n5. \u6d4b\u8bd5\u793a\u4f8b\\n\\n\u4f7f\u7528\u4e4b\u524d\u6240\u521b\u5efa\u7684\u4e24\u4e2a `graphql_name` \u670d\u52a1\u8fdb\u884c\u6d4b\u8bd5\uff0c\u60a8\u53ef\u4ee5\u53d1\u73b0 Apache APISIX \u53ef\u4ee5\u6839\u636e\u8bf7\u6c42\u4e2d\u4e0d\u540c\u7684 `graphql_name` \u81ea\u52a8\u9009\u62e9\u8f6c\u53d1\u7684 Upstream\u3002\\n\\n- \u5982\u679c\u8bf7\u6c42\u662f\u6b64\u793a\u4f8b\uff1a\\n\\n```Shell\\n  curl -i -H \'content-type: application/graphql\' \\\\\\n  -X POST http://192.168.1.200:9080/graphql -d \'\\n  query getRepo111 {\\n      owner {\\n          name\\n      }\\n      repo {\\n          created\\n      }\\n  }\'\\n```\\n\\n\u5219\u4f1a\u8fd4\u56de\u6765\u81ea\u4e0a\u6e38 `192.168.1.200:1980` \u7684\u54cd\u5e94\uff1a\\n\\n```Shell\\n  HTTP/1.1 200 OK\\n  ---URI\\n  /graphql\\n  ---Service Node\\n  Centos-port: 1980\\n```\\n\\n- \u5982\u679c\u8bf7\u6c42\u662f\u8fd9\u4e2a\u793a\u4f8b\uff1a\\n\\n```Shell\\n  curl -i -H \'content-type: application/graphql\' \\\\\\n  -X POST http://192.168.1.200:9080/graphql -d \'\\n  query getRepo222 {\\n      owner {\\n          name\\n      }\\n      repo {\\n          created\\n      }\\n  }\'\\n  ```\\n\\n\u5219\u4f1a\u8fd4\u56de\u6765\u81ea\u4e0a\u6e38 `192.168.1.200:1981` \u7684\u54cd\u5e94\uff1a\\n\\n```Shell\\n  HTTP/1.1 200 OK\\n  ---URI\\n  /graphql\\n  ---Service Node\\n  Centos-port: 1981\\n```\\n\\n### \u4f7f\u7528 `graphql_operation` \u8fdb\u884c\u4e0d\u540c\u7684\u6743\u9650\u6821\u9a8c\\n\\n\u4e0a\u8ff0\u793a\u4f8b\u63d0\u4f9b\u4e86 `graphql_operation` \u4e3a `query` \u7684\u5339\u914d\u89c4\u5219\uff0c\u73b0\u5728\u4f7f\u7528 `mutation` \u5f62\u5f0f\u7684 GraphQL \u8bf7\u6c42\u3002\\n\\n1. \u914d\u7f6e Apache APISIX\uff1a\\n\\n```Shell\\ncurl http://192.168.1.200:9080/apisix/admin/routes/11 \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"POST\\"],\\n    \\"uri\\": \\"/hello\\",\\n    \\"vars\\": [\\n        [\\"graphql_operation\\", \\"==\\", \\"mutation\\"],\\n        [\\"graphql_name\\", \\"==\\", \\"repo\\"]\\n    ],\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"192.168.1.200:1982\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    }\\n}\'\\n```\\n\\n2. \u53d1\u8d77 `mutation` \u8bf7\u6c42\u7528\u6765\u9a8c\u8bc1 Apache APISIX \u7684\u914d\u7f6e\uff1a\\n\\n```Shell\\ncurl -i -H \'content-type: application/graphql\' \\\\\\n-X POST http://192.168.1.200:9080/hello -d \'\\nmutation repo($ep: Episode!, $review: ReviewInput!) {\\n  createReview(episode: $ep, review: $review) {\\n    stars\\n    commentary\\n  }\\n}\'\\n```\\n\\n\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```Shell\\nHTTP/1.1 200 OK\\n---URI\\n/hello\\n---Service Node\\nCentos-port: 1982\\n```\\n\\n## \u642d\u914d\u63d2\u4ef6\\n\\nApache APISIX \u62e5\u6709\u4e30\u5bcc\u7684\u63d2\u4ef6\u751f\u6001\u4ee5\u5e94\u5bf9\u4e0d\u540c\u7684\u4f7f\u7528\u573a\u666f\uff0c\u5982\u679c\u5728\u4f7f\u7528 Apache APISIX + GraphQL \u65f6\u6dfb\u52a0\u9002\u5408\u7684\u63d2\u4ef6\uff0c\u5c31\u53ef\u4ee5\u4f7f\u65b9\u6848\u5e94\u7528\u7684\u573a\u666f\u53d8\u5f97\u66f4\u591a\u3002\\n\\n\u672c\u6587\u4ec5\u9009\u53d6\u4e86\u4ee5\u4e0b\u4e24\u79cd\u7c7b\u578b\u7684\u63d2\u4ef6\u8fdb\u884c\u4e3e\u4f8b\u3002\\n\\n### `limit-count` \u901f\u5ea6\u63d2\u4ef6\\n\\n\u642d\u914d\u4f7f\u7528 `limit-count` \u63d2\u4ef6\uff0c\u6d41\u91cf\u7ecf\u8fc7 GraphQL \u5339\u914d\u89c4\u5219\u5f97\u5230\u8f6c\u53d1\u4e4b\u540e\u8fdb\u4e00\u6b65\u88ab\u9650\u5236\u3002\u5f97\u76ca\u4e8e Apache APISIX \u7684\u7279\u6027\uff0c\u53ef\u4ee5\u8fbe\u5230\u52a8\u6001\u3001\u7cbe\u7ec6\u5316\u3001\u5206\u5e03\u5f0f\u7684\u9650\u6d41\u9650\u901f\u3002\u8be6\u60c5\u8bf7\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/plugins/limit-count)\u3002\\n\\n### \u53ef\u89c2\u6d4b\u6027\u63d2\u4ef6\\n\\nApache APISIX \u63d0\u4f9b\u4e86\u5305\u62ec\u4f46\u4e0d\u4ec5\u9650\u4e8e [`prometheus`](https://apisix.apache.org/zh/docs/apisix/plugins/prometheus)\u3001[`skywalking`](https://apisix.apache.org/zh/docs/apisix/plugins/skywalking) \u7b49\u53ef\u89c2\u6d4b\u6027\u63d2\u4ef6\uff0c\u80fd\u591f\u4e3a\u7cfb\u7edf\u63d0\u4f9b\u66f4\u591a\u76d1\u63a7\u6307\u6807\u6570\u636e\uff0c\u65b9\u4fbf\u7cfb\u7edf\u540e\u7eed\u7684\u8fd0\u8425\u7ef4\u62a4\u7b49\u5b9e\u73b0\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u521d\u6b65\u4ecb\u7ecd\u4e86 GraphQL \u5728 Apache APISIX \u4e2d\u7684\u5e94\u7528\uff0c\u5e76\u4e14\u4f7f\u7528\u5b9e\u9645\u4ee3\u7801\uff0c\u4e3a\u60a8\u5c55\u793a\u4e86Apache APISIX \u4e0e GraphQL \u4e24\u9879\u6280\u672f\u7684\u7ed3\u5408\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u7684\u4e1a\u52a1\u9700\u6c42\u548c\u5b9e\u9645\u573a\u666f\u5728 Apache APISIX \u4e2d\u4f7f\u7528 GraphQL\u3002\\n\\n\u5173\u4e8e GraphQL \u7684\u66f4\u591a\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u4fe1\u606f\uff0c\u53ef\u53c2\u8003 [Apache APISIX\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/router-radixtree/#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87-graphql-%E5%B1%9E%E6%80%A7%E8%BF%87%E6%BB%A4%E8%B7%AF%E7%94%B1)\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41."},{"id":"APISIX \u5728\u4f17\u5b89\u4fdd\u9669\u7684\u5e94\u7528\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/03/02/zhongan-usercase-with-apache-apisix","source":"@site/blog/2022/03/02/zhongan-usercase-with-apache-apisix.md","title":"APISIX \u5728\u4f17\u5b89\u4fdd\u9669\u7684\u5e94\u7528\u5b9e\u8df5","description":"\u672c\u6587\u5c06\u901a\u8fc7\u4ecb\u7ecd\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u5728\u4f17\u5b89\u4fdd\u9669\u7684\u4e00\u4e9b\u4f7f\u7528\u573a\u666f\u4e0e\u5b9e\u8df5\u6848\u4f8b\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765\u5173\u4e8e\u4e92\u8054\u7f51\u4fdd\u9669\u573a\u666f\u4e0b\u7684\u7f51\u5173\u9009\u578b\u4e0e\u843d\u5730\u64cd\u4f5c\u3002","date":"2022-03-02T00:00:00.000Z","formattedDate":"2022\u5e743\u67082\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":13.865,"truncated":true,"authors":[{"name":"Sylvia","url":"https://github.com/SylviaBABY","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"GraphQL \u78b0\u649e API \u7f51\u5173 Apache APISIX\uff0c\u63d0\u5347 API \u9886\u57df\u7684\u5b89\u5168\u4e0e\u6027\u80fd","permalink":"/zh/blog/2022/03/02/apisix-integration-graphql"},"nextItem":{"title":"API \u7f51\u5173 APISIX Public API \u5904\u7406\u80fd\u529b\u518d\u589e\u5f3a","permalink":"/zh/blog/2022/03/01/apisix-integration-public-api-plugin"}},"content":"> \u672c\u6587\u5185\u5bb9\u6574\u7406\u81ea Apache APISIX Weekly Meeting \u4e2d\u4f17\u5b89\u4fdd\u9669\u548c\u79d1\u6280\u57fa\u7840\u67b6\u6784\u8d1f\u8d23\u4eba\u5f90\u654f\u5e26\u6765\u7684\u76f8\u5173\u5206\u4eab\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4f17\u5b89\u4fdd\u9669\u662f\u4e2d\u56fd\u9996\u5bb6\u548c\u89c4\u6a21\u6700\u5927\u7684\u4e92\u8054\u7f51\u4fdd\u9669\u516c\u53f8\uff0c\u9500\u552e\u91c7\u7528\u5168\u4e92\u8054\u7f51\u5f62\u5f0f\u8fdb\u884c\u4ea7\u54c1\u9500\u552e\uff0c\u4e0d\u8bbe\u7ebf\u4e0b\u4ee3\u7406\uff0c\u7ebf\u4e0a\u5219\u4e3b\u8981\u901a\u8fc7\u81ea\u8425\u3001\u4f19\u4f34\u516c\u53f8\u7f51\u7ad9\u3001\u6e20\u9053\u7b49\u65b9\u5f0f\u83b7\u53d6\u6d41\u91cf\u3002\u901a\u8fc7\u79ef\u6781\u63d0\u4f9b\u4e2a\u6027\u5316\u3001\u5b9a\u5236\u5316\u548c\u667a\u80fd\u5316\u7684\u4fdd\u9669\u54c1\u79cd\uff0c\u5f25\u8865\u4e86\u4f20\u7edf\u4fdd\u9669\u516c\u53f8\u4ea7\u54c1\u80fd\u529b\u7684\u4e0d\u8db3\u3002\\n\\n\u4ece\u4e1a\u52a1\u89d2\u5ea6\u6765\u770b\u6280\u672f\u5c42\u9762\u65f6\uff0c\u4e3a\u4e86\u6ee1\u8db3\u4f17\u5b89\u4fdd\u9669\u7684\u590d\u6742\u4e1a\u52a1\u573a\u666f\u548c\u884c\u4e1a\u7684\u4e13\u6709\u7279\u6027\uff0c\u5c31\u4f1a\u5bf9\u6280\u672f\u4fa7\u7684\u6d41\u91cf\u6cbb\u7406\u4ea7\u751f\u4e86\u5f3a\u70c8\u7684\u9700\u6c42\u3002\u672c\u6587\u5c06\u901a\u8fc7\u4ecb\u7ecd\u4f17\u5b89\u4fdd\u9669\u7684\u4e00\u4e9b\u4e1a\u52a1\u573a\u666f\u4e0e\u5b9e\u8df5\u6848\u4f8b\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765\u5173\u4e8e\u300c\u4e92\u8054\u7f51\u4fdd\u9669\u300d\u573a\u666f\u4e0b\u7684\u7f51\u5173\u9009\u578b\u4e0e\u843d\u5730\u64cd\u4f5c\u3002\\n\\n## \u4e1a\u52a1\u573a\u666f\u7279\u70b9\\n\\n### \u591a\u9669\u79cd\\n\\n\u5f00\u5934\u6211\u4eec\u63d0\u5230\u8fc7\uff0c\u4f17\u5b89\u4fdd\u9669\u4f5c\u4e3a\u56fd\u5185\u7b2c\u4e00\u5bb6\u4e92\u8054\u7f51\u4fdd\u9669\u4f01\u4e1a\uff0c\u63d0\u4f9b\u975e\u5e38\u591a\u7684\u4fdd\u9669\u54c1\u79cd\uff0c\u7279\u522b\u662f\u50cf\u8d22\u4ea7\u9669\u3002\u8d22\u4ea7\u9669\u7684\u79cd\u7c7b\u53ef\u8c13\u662f\u7e41\u591a\uff0c\u5927\u5bb6\u60f3\u5230\u60f3\u4e0d\u5230\u7684\u7c7b\u578b\u53ef\u80fd\u90fd\u4f1a\u6709\uff0c\u6bd4\u5982\u8f66\u9669\u3001\u788e\u5c4f\u9669\u548c\u5065\u5eb7\u9669\uff0c\u8fd8\u6709\u65e5\u5e38\u5e38\u89c1\u7684\u6dd8\u5b9d\u8d2d\u7269\u9000\u8fd0\u8d39\u9669\u7b49\u7b49\u3002\\n\\n\u57fa\u672c\u53ea\u8981\u662f\u5927\u5bb6\u751f\u6d3b\u4e2d\u9047\u5230\u7684\u4e1c\u897f\uff0c\u90fd\u6709\u53ef\u80fd\u4f1a\u88ab\u8bbe\u8ba1\u6210\u4e00\u79cd\u4fdd\u9669\u4ea7\u54c1\uff0c\u6240\u4ee5\u4e92\u8054\u7f51\u4fdd\u9669\u573a\u666f\u4e0b\uff0c\u9669\u79cd\u4ea7\u54c1\u4e4b\u591a\u662f\u5176\u6bd4\u8f83\u6709\u7279\u8272\u7684\u80cc\u666f\u3002\\n\\n### \u591a\u6e20\u9053\\n\\n\u867d\u7136\u8bf4\u4e92\u8054\u7f51\u4fdd\u9669\u7684\u6240\u6709\u64cd\u4f5c\u6d41\u7a0b\u90fd\u5728\u7ebf\u4e0a\u8fdb\u884c\uff0c\u662f\u5178\u578b\u7684\u4e92\u8054\u7f51+\u573a\u666f\u3002\u5b83\u65e2\u6709\u4e92\u8054\u7f51\u7684\u9ad8\u9891\u9ad8\u5e76\u53d1\u6216\u8005\u8bf4\u662f\u4e00\u4e9b\u7206\u6b3e\u73b0\u8c61\uff0c\u4e5f\u6709\u50cf\u5176\u5b83\u7684\u4f4e\u9891\u4f4e\u5e76\u53d1\u573a\u666f\u3002\u4f46\u5b83\u65e2\u6709\u4e92\u8054\u7f51\u7684\u6d41\u91cf\u7279\u6027\uff0c\u540c\u65f6\u4e5f\u8fd8\u5305\u542b\u975e\u5e38\u591a\u7684\u7ebf\u4e0b\u6216\u8005\u4f20\u7edf\u4fdd\u9669\u7684\u4e1a\u52a1\u7279\u6027\u3002\\n\\n\u66f4\u51c6\u786e\u5730\u8bf4\uff0c\u4e92\u8054\u7f51\u4fdd\u9669\u7684\u5f88\u591a\u573a\u666f\u5165\u53e3\u4f9d\u8d56\u6e20\u9053\u8fdb\u884c\uff0c\u591a\u6e20\u9053\u4f7f\u5f97\u4e1a\u52a1\u80fd\u591f\u8fdb\u884c\u66f4\u591a\u80fd\u529b\u7684\u91ca\u653e\u3002\u6240\u4ee5\u5bf9\u4e8e\u6e20\u9053\u6d41\u91cf\u7684\u7ba1\u7406\uff0c\u4e5f\u662f\u4e92\u8054\u7f51\u4fdd\u9669\u5728\u5b9e\u73b0\u4e1a\u52a1\u5c42\u9762\u7684\u91cd\u8981\u4e00\u73af\u3002\\n\\n### \u5f3a\u76d1\u7ba1\\n\\n![\u5f3a\u76d1\u7ba1](https://static.apiseven.com/202108/1646279054405-a55ded0a-986f-4d49-a927-545999070d65.png)\\n\\n\u9664\u4e86\u4e1a\u52a1\u9886\u57df\uff0c\u4f5c\u4e3a\u4e0e\u94b1\u76f4\u63a5\u6253\u4ea4\u9053\u7684\u884c\u4e1a\uff0c\u4fdd\u9669\u4e5f\u5c5e\u4e8e\u91d1\u878d\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\u662f\u548c\u94f6\u884c\u3001\u8bc1\u5238\u4e00\u6837\u4f1a\u53d7\u5230\u94f6\u4fdd\u76d1\u4f1a\u76d1\u7763\u7684\u91d1\u878d\u4ea7\u54c1\uff0c\u5e76\u9075\u5b88\u5bf9\u5e94\u7684\u6761\u6b3e\u3002\u540c\u65f6\u94f6\u4fdd\u76d1\u4f1a\u57fa\u672c\u4e0a\u6bcf\u5e74\u90fd\u4f1a\u9488\u5bf9\u4e1a\u52a1\u548c\u6280\u672f\u5c42\u9762\u63d0\u51fa\u4e0d\u540c\u7684\u8981\u6c42\uff0c\u8fd9\u4e9b\u90fd\u662f\u8981\u53bb\u914d\u5408\u548c\u53d1\u5c55\u7684\u3002\\n\\n\u5982\u4e0a\u56fe\u4e2d\u7ea2\u8272\u548c\u7eff\u8272\u90e8\u5206\uff0c\u5c31\u5c5e\u4e8e\u9488\u5bf9\u76d1\u7ba1\u6e20\u9053\u6216\u524d\u7f6e\u4e1a\u52a1\u4e0e\u6838\u5fc3\u4e1a\u52a1\u5206\u79bb\u7684\u67b6\u6784\u65b9\u5f0f\u3002\u5728\u8fd9\u91cc\u5bf9\u4e8e\u5b89\u5168\u5c42\u9762\u4e5f\u5b58\u5728\u4e00\u4e9b\u89c4\u8303\u8981\u6c42\uff0c\u5305\u62ec\u4e24\u5730\u4e09\u4e2d\u5fc3\u7684\u6cbb\u7406\u548c\u9488\u5bf9\u4e2d\u95f4\u4ef6\u6570\u636e\u4e1a\u52a1\u7684\u9694\u79bb\uff0c\u5bf9\u6d41\u91cf\u6cbb\u7406\u548c\u5b89\u5168\u6027\u7684\u8981\u6c42\u76f8\u5bf9\u662f\u6bd4\u8f83\u4e25\u683c\u7684\u3002\\n\\n## \u573a\u666f\u75db\u70b9\u4e0e\u9700\u6c42\\n\\n\u8003\u8651\u5230\u771f\u5b9e\u4f7f\u7528\u573a\u666f\uff0c\u6bcf\u5bb6\u516c\u53f8\u5bf9\u4e8e\u6d41\u91cf\u6cbb\u7406\u7684\u5c42\u6b21\u548c\u9700\u6c42\u5176\u5b9e\u4e5f\u5404\u4e0d\u76f8\u540c\u3002\u6bd4\u5982\u6709\u4e9b\u516c\u53f8\u53ef\u80fd\u76f8\u5bf9\u6765\u8bb2\u66f4\u5e0c\u671b\u7f51\u5173\u66f4\u524d\u7f6e\uff0c\u4ec5\u4f5c\u4e3a\u8fb9\u7f18\u7f51\u5173\u89d2\u8272\uff0c\u6709\u4e9b\u53ef\u80fd\u5e0c\u671b\u7f51\u5173\u80fd\u591f\u5904\u7406\u5357\u5317\u6d41\u91cf\u6216\u8005\u662f\u4e1c\u897f\u3001\u5357\u5317\u6d41\u91cf\u5171\u540c\u6cbb\u7406\u3002\\n\\n\u8fd9\u91cc\u4ece\u4e00\u4e9b\u5171\u6027\u89d2\u5ea6\uff08\u66f4\u8d34\u8fd1\u4f17\u5b89\u4fdd\u9669\u7684\u4e1a\u52a1\u573a\u666f\uff09\u5927\u6982\u6574\u7406\u51fa\u4e86\u4ee5\u4e0b\u51e0\u4e2a\u75db\u70b9\u8ddf\u89e3\u51b3\u65b9\u5411\uff0c\u5373\u5f53\u4e0b\u4e1a\u52a1\u573a\u666f\u5185\u7f51\u5173\u5c42\u9762\u7684\u4e0d\u8db3\u4ee5\u53ca\u4e4b\u540e\u60f3\u8981\u5f25\u8865\u7684\u52a8\u4f5c\u65b9\u5411\u3002\\n\\n![\u75db\u70b9\u6c47\u603b](https://static.apiseven.com/202108/1646279106033-216d6453-c051-464f-9c17-8f2f3d87a738.png)\\n\\n\u800c\u5728\u7f51\u5173\u90e8\u7f72\u7684\u771f\u5b9e\u573a\u666f\u4e0b\uff0c\u9664\u4e86\u4e0a\u8ff0\u95ee\u9898\u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u8003\u8651\u6574\u4f53\u4e1a\u52a1\u9700\u6c42\u4e0e\u90e8\u7f72\u73af\u8282\u4e2d\u591a\u7c7b\u578b\u7f51\u5173\u7684\u9002\u914d\u3002\u4e0b\u56fe\u5c55\u793a\u7684\u662f\u5728\u6d41\u91cf\u6cbb\u7406\u8fc7\u7a0b\u4e2d\u7684\u903b\u8f91\u90e8\u7f72\uff0c\u4e3b\u8981\u6d89\u53ca\u6d41\u91cf\u7f51\u5173\u3001\u5fae\u670d\u52a1\u7f51\u5173\u3001\u7edf\u4e00\u8fd0\u8425\u7f51\u5173\u3001BaaS \u7f51\u5173\u548c\u57df\u7f51\u5173\u3002\\n\\n![\u903b\u8f91\u90e8\u7f72](https://static.apiseven.com/202108/1646279112162-1d2e492d-b8a8-44b9-937b-e20fa3c67d58.png)\\n\\n\u5728\u68b3\u7406\u6e05\u6670\u5f53\u4e0b\u95ee\u9898\u540e\uff0c\u4f17\u5b89\u4fdd\u9669\u7684\u6280\u672f\u56e2\u961f\u5f00\u59cb\u5c06\u7f51\u5173\u9009\u578b\u805a\u7126\u5728\u4e00\u4e9b\u6bd4\u8f83\u6210\u719f\u7684\u5f00\u6e90\u4ea7\u54c1\u4e4b\u4e0a\uff0c\u5f00\u59cb\u4e86\u65b0\u4e00\u8f6e\u7684\u63a2\u7d22\u3002\\n\\n## \u9501\u5b9a Apache APISIX\\n\\n\u7531\u4e8e\u4f17\u5b89\u4fdd\u9669\u5728\u9009\u578b\u4e4b\u521d\u5c31\u6846\u5b9a\u4e86\u300c\u5f00\u6e90\u4ea7\u54c1\u300d\uff0c\u6240\u4ee5\u5728\u8bc4\u4f30\u5f00\u6e90\u4ea7\u54c1\u7684\u5c42\u9762\uff0c\u4e5f\u4ece\u4f01\u4e1a\u89d2\u5ea6\u7ed9\u51fa\u4e86\u4e00\u5b9a\u7684\u53c2\u8003\u6807\u51c6\uff0c\u5e76\u4ece\u8fd9\u4e9b\u89d2\u5ea6\u7ed9\u4e88\u4e86 Apache APISIX \u6700\u76f4\u63a5\u7684\u80af\u5b9a\u3002\\n\\n![Apache APISIX \u8bc4\u4f30](https://static.apiseven.com/202108/1646279116675-c10ebbe4-7e7a-49e0-aeb7-6af18568bf5b.png)\\n\\n\u5f53\u7136\uff0c\u9664\u4e86\u5bf9\u5f00\u6e90\u4ea7\u54c1\u672c\u8eab\u89d2\u5ea6\u7684\u8bc4\u4f30\u5916\uff0c\u4f17\u5b89\u4fdd\u9669\u4e5f\u5bf9\u6bd4\u4e86\u76ee\u524d\u516c\u53f8\u4e1a\u52a1\u4e2d\u4ecd\u5728\u4f7f\u7528\u7684 Kong \u548c Traefik\uff0c\u540c\u65f6\u4e5f\u63a5\u89e6\u4e86\u963f\u91cc\u4e91\u5206\u4eab\u7684 MSE \u4ea7\u54c1\u7b49\u3002\\n\\n\u6700\u7ec8\u5728\u4ee5\u4e0b\u9879\u76ee\u4e2d\u8fdb\u884c\u4e86\u5168\u9762\u7684\u6a2a\u5411\u5bf9\u6bd4\uff0c\u53ef\u4ee5\u770b\u5230\u4e0d\u7ba1\u662f\u5728\u4f01\u4e1a\u7ea7\u7684\u957f\u671f\u89c4\u5212\u8fd8\u662f\u77ed\u671f\u89c4\u5212\u4e2d\uff0cApache APISIX \u90fd\u80fd\u5f88\u597d\u5730\u6ee1\u8db3\u4f17\u5b89\u7684\u4e1a\u52a1\u9700\u6c42\u3002\\n\\n![\u6a2a\u5411\u5bf9\u6bd4\u7ec6\u8282](https://static.apiseven.com/202108/1646279121377-8f21e5d6-f32f-450b-9445-392a8253dee8.png)\\n\\n## \u57fa\u4e8e Apache APISIX \u7684\u843d\u5730\u6848\u4f8b\\n\\n### BaaS \u4ea7\u54c1\u7684\u8ba1\u91cf\u8ba1\u8d39\\n\\n\u4f17\u5b89\u4fdd\u9669\u76ee\u524d\u6b63\u5728\u4e1a\u52a1\u5185\u90e8\u9010\u6b65\u5c06\u5e95\u5c42\u4ea7\u54c1 BaaS \u5316\u3002\u7531\u4e8e\u662f\u91d1\u878d\u5c5e\u6027\uff0c\u6240\u4ee5\u5bf9\u4e8e BaaS \u4ea7\u54c1\u7684\u843d\u5730\u8981\u6c42\u4f1a\u66f4\u9ad8\uff0c\u9700\u8981\u5c06\u57fa\u7840\u67b6\u6784\u4ea7\u54c1\u4e0e\u4e91\u4ea7\u54c1\u4e00\u6837\u5b9e\u73b0\u7edf\u4e00\u6807\u51c6\u7684\u8ba1\u91cf\u8ba1\u8d39\u3002\\n\\n![BaaS \u67b6\u6784](https://static.apiseven.com/202108/1646279126510-bcfdcab1-7457-4ab6-8331-2a82e65a95d4.png)\\n\\n\u56e0\u4e3a\u516c\u53f8\u5185\u90e8\u7528\u5230\u7684\u6240\u6709\u4ea7\u54c1\uff0c\u90fd\u9700\u8981\u5b9e\u73b0\u8d22\u52a1\u62a5\u8868\u5f0f\u7684\u76d1\u7ba1\u8981\u6c42\u3002\u56e0\u6b64\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u5c31\u9700\u8981\u5b9e\u540d\u8ba4\u8bc1\u548c\u76f8\u5173\u5ba1\u8ba1\u529f\u80fd\uff0c\u8fd9\u91cc\u5c31\u9700\u8981\u7528\u5230 APISIX \u7684\u9274\u6743\u6a21\u5757\u4e86\u3002\u4e5f\u5c31\u662f\u8bf4\u516c\u53f8\u5185\u90e8\u7684\u4efb\u4f55\u8c03\u7528\u8fc7\u7a0b\u90fd\u9700\u8981\u88ab\u5ba1\u8ba1\u8bb0\u5f55\uff0c\u5305\u62ec\u8c03\u7528\u6b21\u6570\u3001\u53d1\u751f\u7684\u8d39\u7528\u7b49\u3002\u6240\u4ee5\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cApache APISIX  \u5f3a\u5927\u7684\u65e5\u5fd7\u76f8\u5173\u529f\u80fd\u4e5f\u662f\u8d77\u5230\u4e86\u5f88\u597d\u7684\u652f\u6301\u3002\\n\\n\u540c\u65f6\u5728\u5ba1\u8ba1\u8fc7\u7a0b\u4e2d\u4e5f\u9700\u8981\u8fdb\u884c\u5cf0\u503c\u5ba1\u8ba1\u7684\u8ba1\u7b97\uff0c\u8fd9\u91cc\u5c31\u4f1a\u6d89\u53ca\u5230\u5f88\u591a\u8ba1\u8d39\u516c\u5f0f\uff0c\u8fd9\u91cc\u7684\u8ba1\u8d39\u516c\u5f0f\u91cc\u4e0d\u4ec5\u6709\u8c03\u7528\u91cf\uff0c\u8fd8\u6709\u5cf0\u503c\u7b49\u4fe1\u606f\u3002\u6240\u4ee5\u57fa\u4e8e APISIX \u7684\u529f\u80fd\u652f\u6301\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u76f8\u5173 Metrics \u6307\u6807\u7684\u5448\u73b0\uff0c\u4ece\u800c\u4e3a\u8ba1\u91cf\u8ba1\u8d39\u573a\u666f\u5960\u5b9a\u575a\u5b9e\u57fa\u7840\u3002\\n\\n![\u5b9e\u73b0\u6846\u67b6](https://static.apiseven.com/202108/1646279130416-c1c161d2-9fbf-4a48-b621-eadfe851c6b0.png)\\n\\n\u5177\u4f53\u7684\u5b9e\u73b0\u6846\u67b6\u53ef\u4ee5\u53c2\u8003\u4e0a\u56fe\uff0c\u5176\u4e2d\u914d\u7f6e\u4e2d\u5fc3\u662f\u4e00\u4e2a\u7eaf\u4e03\u5c42\u6d41\u91cf\u7684\u534f\u8bae\uff0c\u6240\u4ee5\u53ef\u4ee5\u5b8c\u5168\u7eb3\u5165\u5230\u8ba1\u91cf\u8ba1\u8d39\u4f53\u7cfb\u4e2d\uff0c\u5305\u62ec ES \u4ee5\u53ca APISIX \u672c\u8eab\u7b49\u3002\u5177\u4f53\u64cd\u4f5c\u4e3b\u8981\u662f\u57fa\u4e8e APISIX \u76ee\u524d\u7684\u7ed3\u6784\u505a\u4e86\u4e00\u4e9b\u5b9a\u4e49\uff0c\u6bd4\u5982\u53bb\u8c03\u7528\u51e0\u4e2a\u9488\u5bf9\u516c\u53f8\u4e1a\u52a1\u7684\u9700\u6c42\uff0c\u4ee5\u53ca\u4f7f\u7528 APISIX \u7684\u4e00\u4e9b\u63d2\u4ef6\u8fdb\u884c\u76f8\u5173\u7f16\u6392\u80fd\u529b\u7684\u5b9e\u73b0\u3002\\n\\n### \u591a\u79df\u6237\u591a\u6e20\u9053\u6d41\u91cf\u9694\u79bb\\n\\n\u9762\u5bf9\u4f17\u5b89\u4fdd\u9669\u7684\u591a\u9669\u79cd\u591a\u6e20\u9053\u4f7f\u7528\u573a\u666f\uff0c\u591a\u79df\u6237\u591a\u6e20\u9053\u7684\u6d41\u91cf\u9694\u79bb\u4e5f\u6210\u4e3a\u5177\u5907\u884c\u4e1a\u7279\u5f81\u7684\u9700\u6c42\u3002\\n\\n\u800c\u57fa\u4e8e Apache APISIX \u7684\u843d\u5730\u5b9e\u8df5\u4e2d\uff0c\u4f17\u5b89\u4e5f\u9488\u5bf9\u591a\u6e20\u9053\u573a\u666f\u4e0b\u7684\u8981\u6c42\u4e0e\u5f3a\u7ba1\u63a7\u8fdb\u884c\u4e86\u4e00\u4e9b\u89c4\u5212\u3002\u5f97\u76ca\u4e8e APISIX \u5f3a\u5927\u7684\u6d41\u91cf\u7f16\u6392\u548c\u63d2\u4ef6\u7f16\u6392\u529f\u80fd\uff0c\u4e3a\u4e92\u8054\u7f51\u4fdd\u9669\u573a\u666f\u4e0b\u63d0\u4f9b\u4e86\u4e4b\u524d\u4ece\u672a\u4f53\u9a8c\u8fc7\u7684\u6d41\u91cf\u7cbe\u5bc6\u63a7\u5236\u6548\u679c\u3002\\n\\n\u6bd4\u5982\u6709\u7684\u4e1a\u52a1\u65b9\u89c4\u6a21\u6bd4\u8f83\u5927\uff0c\u6e20\u9053\u4e5f\u5f88\u5927\uff0c\u5c31\u53ef\u80fd\u4f1a\u628a\u6e20\u9053\u5355\u72ec\u5efa\u7acb\u4e00\u4e2a\u96c6\u7fa4\u6765\u7528\uff1b\u4f46\u6709\u4e9b\u6e20\u9053\u89c4\u6a21\u8f83\u5c0f\uff0c\u53ef\u80fd 10% \u7684\u89c4\u6a21\u662f\u5927\u7684\uff0c\u4f46\u5927\u90e8\u5206\u90fd\u5f88\u5c0f\u3002\u57fa\u4e8e\u8fd9\u6837\u7684\u573a\u666f\uff0c\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u5c06\u8fd9\u4e9b\u5c0f\u6e20\u9053\u878d\u5408\u5230\u4e00\u4e2a\u7f51\u5173\u5b9e\u4f53\u6216\u5b9e\u4f8b\u91cc\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5171\u4eab\u3002\\n\\n\u5f53\u7136\u8fd9\u91cc\u5c31\u4f1a\u6d89\u53ca\u5230\u6bcf\u4e2a\u5e94\u7528\u5728\u63a5\u5165\u7684\u8fc7\u7a0b\u4e2d\uff0c\u56e0\u4e3a\u4e0d\u540c\u6e20\u9053\u4f1a\u6709\u4e0d\u540c\u7684\u4e0a\u4e0b\u6e38\u53bb\u5bf9\u63a5\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e0d\u4e00\u6837\u7684\u57df\u540d\u3002\u57fa\u4e8e\u8fd9\u79cd\u573a\u666f\u7684\u9694\u79bb\uff08\u5982\u4e0b\u56fe\u7ed3\u6784\uff09\u79f0\u4e4b\u4e3a\u4e00\u7ea7\u9694\u79bb\u3002\\n\\n![\u4e00\u7ea7\u9694\u79bb](https://static.apiseven.com/202108/1646279134880-2d657934-68ac-40c4-9c29-2ead848ef663.png)\\n\\n\u4f46\u5f53\u6e20\u9053\u5bf9\u63a5\u8fdb\u6765\u540e\u5c31\u9700\u8981\u8fdb\u884c\u540e\u7eed\u76f8\u5173\u64cd\u4f5c\uff0c\u867d\u7136\u6d41\u7a0b\u662f\u4e00\u6a21\u4e00\u6837\u4f46\u63a5\u4e0b\u6765\u4e1a\u52a1\u7684\u7ba1\u63a7\u80fd\u529b\u8981\u6c42\u662f\u4e0e\u4e0a\u8fb9\u63d0\u5230\u7684\u4e0d\u540c\uff0c\u6240\u4ee5\u5c31\u9700\u8981\u518d\u5bf9\u6e20\u9053\u8fdb\u884c\u4e8c\u7ea7\u9694\u79bb\uff08\u5982\u4e0b\u56fe\u7ed3\u6784\u6240\u793a\uff09\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u4e00\u7ea7\u9694\u79bb\u52a0\u4e8c\u7ea7\u9694\u79bb\u6a21\u5f0f\uff0c\u5c31\u53ef\u4ee5\u5f88\u597d\u5730\u89e3\u51b3\u4e86\u7f51\u5173\u5728\u591a\u79df\u6237\u591a\u6e20\u9053\u4e2d\u7684\u6d41\u91cf\u9694\u79bb\u3002\\n\\n![\u4e8c\u7ea7\u9694\u79bb](https://static.apiseven.com/202108/1646279139544-01337e7a-6360-453d-95d9-be3550b864d6.png)\\n\\n## \u540e\u7eed\u89c4\u5212\u4e0e\u671f\u671b\\n\\n### \u52a0\u5f3a\u8de8\u90e8\u95e8\u4e4b\u95f4\u7684\u534f\u540c\\n\\n\u76ee\u524d\u4f17\u5b89\u4fdd\u9669\u4e0d\u4ec5\u4ec5\u53ea\u6709\u8fd9\u4e00\u9879\u4e1a\u52a1\uff0c\u540c\u65f6\u65d7\u4e0b\u8fd8\u6709\u975e\u5e38\u591a\u7684\u5b50\u516c\u53f8\uff0c\u5728\u540e\u7eed\u7684\u63a8\u8fdb\u8fc7\u7a0b\u4e2d\u4e00\u5b9a\u4f1a\u9762\u4e34\u5f88\u591a\u8fd9\u6837\u591a\u90e8\u95e8\u4e1a\u52a1\u5927\u89c4\u6a21\u7684\u90e8\u7f72\u3002\u6240\u4ee5\u5728\u63a8\u8fdb\u76f8\u5173\u6280\u672f\u6808\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u4e0d\u662f\u53ea\u7531\u4e00\u4e2a\u90e8\u95e8\u53bb\u4e3b\u5bfc\uff0c\u66f4\u591a\u7684\u662f\u8de8\u90e8\u95e8\u4e4b\u95f4\u7684\u5171\u540c\u534f\u4f5c\uff0c\u4ece\u800c\u5c3d\u65e9\u5b9e\u73b0 Apache APISIX \u5728\u4f17\u5b89\u7684\u843d\u5730\u90e8\u7f72\u3002\\n\\n### \u57fa\u4e8e APISIX \u66f4\u65b0 Nacos \u6ce8\u518c\u4e2d\u5fc3\u670d\u52a1\\n\\n\u76ee\u524d\u4f17\u5b89\u4fdd\u9669\u5185\u90e8\u6b63\u5728\u57fa\u4e8e Nacos \u8fdb\u884c\u670d\u52a1\u7684\u65e0\u635f\u4e0a\u4e0b\u7ebf\uff0c\u6240\u4ee5\u5728\u540e\u7eed\u89c4\u5212\u4e2d\u4f1a\u5c06 APISIX \u4e0e Nacos \u5bf9\u63a5\u5b9e\u73b0\u7edf\u4e00\u7ba1\u7406\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06\u5fae\u670d\u52a1\u901a\u8fc7\u8def\u7531\u65b9\u5f0f\u5bf9\u63a5\u5230 Apache APISIX\uff0c\u8fbe\u5230\u65e0\u635f\u6216\u57fa\u4e8e\u6e90\u6570\u636e\u7684\u6d41\u91cf\u5206\u53d1\u6548\u679c\u3002\u5f53\u7136\u4e5f\u4f1a\u7ee7\u7eed\u501f\u52a9 APISIX \u6765\u5b8c\u5584 BaaS \u7684\u76f8\u5173\u80fd\u529b\u3002\\n\\n### \u6301\u7eed\u89c2\u671b\u670d\u52a1\u7f51\u683c\u4ea7\u54c1\\n\\n\u4f17\u5b89\u4fdd\u9669\u5185\u90e8\u76ee\u524d\u662f\u5728\u8fdb\u884c\u81ea\u5df1\u5e73\u53f0\u7684\u670d\u52a1\u7f51\u683c\u642d\u5efa\uff0c\u4f46\u56e0\u4e3a\u4e1a\u52a1\u53d1\u5c55\u8fc5\u901f\u5bfc\u81f4\u76ee\u524d\u7684\u670d\u52a1\u7f51\u683c\u8fd0\u884c\u72b6\u6001\u6ee1\u8db3\u4e0d\u4e86\u5f53\u4e0b\u4e1a\u52a1\u843d\u5730\u7a7a\u95f4\u3002\u6240\u4ee5\u4e5f\u5728\u6301\u7eed\u5173\u6ce8\u5916\u90e8\u7684\u670d\u52a1\u7f51\u683c\u4ea7\u54c1\uff0c\u6bd4\u5982 APISIX Service Mesh\uff0c\u6216\u8005\u662f\u5c1d\u8bd5\u5229\u7528 APISIX \u4e0e etcd \u7684\u7ed3\u5408\u65b9\u6848\u3002\\n\\n## \u603b\u7ed3\\n\\n\u7eb5\u89c2\u4f17\u5b89\u4fdd\u9669\u5728\u8ffd\u6c42\u6d41\u91cf\u6cbb\u7406\u548c\u4e00\u4e9b\u843d\u5730\u89c4\u5212\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4ec5\u4ec5\u662f\u628a Apache APISIX \u4f5c\u4e3a\u4e00\u4e2a\u8fb9\u7f18\u7f51\u5173\u89d2\u8272\u53bb\u63a7\u5236\u70b9\u72b6\u6d41\u91cf\uff0c\u66f4\u591a\u7684\u5219\u662f\u57fa\u4e8e\u6574\u4f53\u67b6\u6784\u8fdb\u884c\u6d41\u91cf\u7684\u63a7\u5236\u3002\u5373\u9762\u5411\u6574\u4e2a DevOps \u7684\u5168\u751f\u547d\u5468\u671f\uff0c\u8fdb\u884c\u8bf8\u5982\u6d4b\u8bd5\u573a\u666f\u662f\u5426\u80fd\u63d0\u4f9b\u6d4b\u8bd5\u80fd\u529b\u6216\u8005\u591a\u7248\u672c\u5f00\u53d1\u80fd\u529b\uff1b\u751f\u4ea7\u4fa7\u63d0\u4f9b\u6d41\u91cf\u5f55\u5236\u3001\u56de\u653e\u80fd\u529b\uff1b\u5927\u6570\u636e\u90e8\u95e8\u662f\u5426\u53ef\u4ee5\u751f\u4ea7\u76f8\u5173\u7684\u6c99\u7bb1\u73af\u5883\uff0c\u6765\u8bc4\u4f30\u66f4\u597d\u7684\u6a21\u578b\u5e76\u8fdb\u884c\u57df\u73af\u5883\u7684\u9694\u79bb\u7b49\u80fd\u529b\u3002\\n\\n![\u603b\u4f53\u6a21\u5f0f](https://static.apiseven.com/202108/1646279144771-483cfabe-753e-4570-8013-1eedbf88aed8.png)\\n\\n\u5e0c\u671b\u5728\u540e\u7eed\u7684\u843d\u5730\u5b9e\u8df5\u4e2d\uff0c\u4f17\u5b89\u4fdd\u9669\u53ef\u4ee5\u57fa\u4e8e Apache APISIX \u5b9e\u73b0\u6574\u4f53\u6d41\u91cf\u6cbb\u7406\u7684\u5b8c\u6574\u843d\u5730\uff0c\u52a9\u529b\u4e92\u8054\u7f51\u4fdd\u9669\u9886\u57df\u7684\u6d41\u91cf\u7ba1\u63a7\u4e0e\u5b89\u5168\u6cbb\u7406\u3002\\n\\n:::note\\n\\n1. \u6587\u4e2d\u67b6\u6784\u56fe\u6d89\u53ca\u5230\u7684\u5177\u4f53\u540d\u8bcd\u5168\u90e8\u4e3a\u62bd\u8c61\u7406\u89e3\uff0c\u975e\u771f\u5b9e\u73af\u5883\u7528\u8bcd\u3002\\n2. API Gateway \u6a2a\u5411\u5bf9\u6bd4\u90e8\u5206\u6570\u636e\u6765\u6e90\u4e8e\u4e92\u8054\u7f51\uff0c\u53ef\u80fd\u4e0e\u6700\u65b0\u6216\u771f\u5b9e\u6570\u636e\u5b58\u5728\u504f\u5dee\uff0c\u4e0d\u4ee3\u8868\u5b98\u7f51\u6570\u636e\u3002\\n\\n:::"},{"id":"API \u7f51\u5173 APISIX Public API \u5904\u7406\u80fd\u529b\u518d\u589e\u5f3a","metadata":{"permalink":"/zh/blog/2022/03/01/apisix-integration-public-api-plugin","source":"@site/blog/2022/03/01/apisix-integration-public-api-plugin.md","title":"API \u7f51\u5173 APISIX Public API \u5904\u7406\u80fd\u529b\u518d\u589e\u5f3a","description":"\u4f60\u53ef\u4ee5\u901a\u8fc7 API \u7f51\u5173 Apache APISIX \u7684 public-api \u63d2\u4ef6\u4fdd\u62a4 APISIX \u63d2\u4ef6\u4e2d\u7684\u81ea\u5b9a\u4e49 API\uff0c\u672c\u6587\u7740\u91cd\u4ecb\u7ecd\u4e86 `public-api` \u63d2\u4ef6\u4e24\u79cd\u4f7f\u7528\u65b9\u6cd5\u548c\u4e00\u79cd\u573a\u666f\u793a\u4f8b\u3002","date":"2022-03-01T00:00:00.000Z","formattedDate":"2022\u5e743\u67081\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":11,"truncated":true,"authors":[{"name":"\u767d\u6cfd\u5e73","title":"Author","url":"https://github.com/bzp2010","image_url":"https://avatars.githubusercontent.com/u/8078418?v=4","imageURL":"https://avatars.githubusercontent.com/u/8078418?v=4"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://avatars.githubusercontent.com/u/97138894?v=4","imageURL":"https://avatars.githubusercontent.com/u/97138894?v=4"}],"prevItem":{"title":"APISIX \u5728\u4f17\u5b89\u4fdd\u9669\u7684\u5e94\u7528\u5b9e\u8df5","permalink":"/zh/blog/2022/03/02/zhongan-usercase-with-apache-apisix"},"nextItem":{"title":"\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u5347\u7ea7\uff0cAPI \u7f51\u5173 Apache APISIX \u96c6\u6210 OpenTelemetry","permalink":"/zh/blog/2022/02/28/apisix-integration-opentelemetry-plugin"}},"content":"> \u672c\u6587\u4e3a\u60a8\u4ecb\u7ecd\u4e86 API \u7f51\u5173 Apache APISIX `public-api` \u63d2\u4ef6\u7684\u539f\u7406\u53ca\u4f7f\u7528\u65b9\u6cd5\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f5c\u4e3a API \u7f51\u5173\uff0cApache APISIX \u4e0d\u4ec5\u62e5\u6709\u4f17\u591a\u5b9e\u7528\u7684\u63d2\u4ef6\uff0c\u800c\u4e14\u652f\u6301\u63d2\u4ef6\u52a8\u6001\u53d8\u66f4\u3001\u70ed\u63d2\u62d4\u548c\u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6\u3002\\n\\n\u5f53\u524d\u7528\u6237\u5728 Apache APISIX \u4e2d\u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6\u65f6\uff0c\u53ef\u4ee5\u4e3a\u63d2\u4ef6\u5b9a\u4e49\u4e00\u4e9b API\uff08\u4e0b\u79f0 public API\uff09\uff0c\u6bd4\u5982\u5728\u5f53\u524d\u7684 `jwt-auth` \u63d2\u4ef6\u4e2d\uff0c\u5b83\u5b9e\u73b0\u5e76\u63d0\u4f9b\u4e86\u4e00\u4e2a `/apisix/plugin/jwt/sign` \u63a5\u53e3\u7528\u4e8e\u7b7e\u53d1 JWT\uff0c\u7531\u4e8e\u6b64\u63a5\u53e3\u4e0d\u662f\u901a\u8fc7 Admin API \u6dfb\u52a0\u7684\uff0c\u56e0\u6b64\u65e0\u6cd5\u50cf\u7ba1\u7406 Route \u4e00\u6837\u7ba1\u7406\u6b64\u7c7b\u63a5\u53e3\u3002\\n\\n\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u63d0\u4f9b\u7684\u63a5\u53e3\u662f\u9762\u5411\u5185\u90e8\u8c03\u7528\u7684\uff0c\u800c\u975e\u5f00\u653e\u5728\u516c\u7f51\u4f9b\u4efb\u4f55\u4eba\u8c03\u7528\u3002\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u79cd\u573a\u666f\uff0cApache APISIX \u8bbe\u8ba1\u4e86 `public-api` \u63d2\u4ef6\uff0c\u5b83\u66ff\u6362\u4e86\u529f\u80fd\u6709\u9650\u4e14\u4f7f\u7528\u590d\u6742\u7684\u63d2\u4ef6\u62e6\u622a\u5668\u3002\u901a\u8fc7\u8fd9\u4e2a\u63d2\u4ef6\uff0c\u53ef\u4ee5\u89e3\u51b3 public API \u4f7f\u7528\u8fc7\u7a0b\u4e2d\u7684\u75db\u70b9\uff0c\u60a8\u53ef\u4ee5\u4e3a public API \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684 `uri`\uff0c\u53ef\u4ee5\u914d\u7f6e\u4efb\u4f55\u7c7b\u578b\u7684\u63d2\u4ef6\u3002\u4e0b\u56fe\u5c55\u793a\u4e86\u4f7f\u7528 `public-api` \u524d\u540e\u7684\u53d8\u5316\u3002\\n\\n## \u521d\u8bc6 public-api\\n\\n\u672c\u8282\u4ee5 `jwt-auth` \u63d2\u4ef6\u7684 `/apisix/plugin/jwt/sign` \u63a5\u53e3\u4e3a\u4f8b\uff0c\u4e3a\u60a8\u4ecb\u7ecd `public-api` \u63d2\u4ef6\u4e24\u79cd\u4f7f\u7528\u65b9\u6cd5\u548c\u4e00\u79cd\u573a\u666f\u793a\u4f8b\u3002\\n\\n\u5728\u4f7f\u7528 `public-api` \u63d2\u4ef6\u4e4b\u524d\uff0c\u5982\u679c\u5728\u63d2\u4ef6\u5f00\u53d1\u4e2d\u4f7f\u7528 `_M.api()` \u6ce8\u518c\u4e86 public API \u540e\uff0cAPISIX \u4f1a\u9ed8\u8ba4\u5c06\u5b83\u66b4\u9732\u51fa\u6765\uff0c\u60a8\u53ef\u4ee5\u76f4\u63a5\u5728 HTTP \u7aef\u53e3\u8c03\u7528\u8fd9\u4e2a API\u3002\u73b0\u5728\uff0c\u60a8\u9700\u8981\u624b\u52a8\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff0c\u914d\u7f6e `public-api` \u63d2\u4ef6\uff0c\u624d\u53ef\u4ee5\u5c06 API \u8f6c\u53d1\u81f3 `public-api` \u63d2\u4ef6\u4e2d\u3002\\n\\n### \u786e\u8ba4 API \u662f\u5426\u88ab\u5f00\u653e\\n\\n\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e0b\u8ff0\u547d\u4ee4\u8bf7\u6c42 API \u5730\u5740\uff0c\u901a\u8fc7\u8fd4\u56de\u7ed3\u679c\u53ef\u4ee5\u770b\u5230 `/apisix/plugin/jwt/sign` \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5e76\u6ca1\u6709\u88ab\u66b4\u9732\u51fa\u6765\uff0c\u662f\u4e0d\u53ef\u7528\u7684\u3002\\n\\n```Shell\\ncurl -XGET \'http://127.0.0.1:9080/apisix/plugin/jwt/sign?key=user-key\'\\n\\n{\\"error_msg\\":\\"404 Route Not Found\\"}\\n```\\n\\n### \u524d\u63d0\u6761\u4ef6\\n\\n\u60a8\u9700\u8981\u521b\u5efa Consumer \u5e76\u5f00\u542f `jwt-auth` \u63d2\u4ef6\uff0c\u624d\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\u3002\\n\\n> \u793a\u4f8b\u4e2d `jwt-auth` \u53c2\u6570\u914d\u7f6e\u4fe1\u606f\uff0c\u8bf7\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/plugins/jwt-auth)\u3002\\n\\n```Shell\\ncurl -XPUT \'http://127.0.0.1:9080/apisix/admin/consumers\' \\\\\\n-H \'X-API-KEY: <api-key>\' \\\\\\n-H \'Content-Type: application/json\' \\\\\\n-d \'{\\n    \\"username\\": \\"APISIX\\",\\n    \\"plugins\\": {\\n        \\"jwt-auth\\": {\\n            \\"key\\": \\"user-key\\",\\n            \\"algorithm\\": \\"HS256\\"\\n        }\\n    }\\n}\'\\n```\\n\\n### \u65b9\u6cd5\u4e00\uff1a\u57fa\u7840\u4f7f\u7528\\n\\n1. \u8bbe\u7f6e\u8def\u7531\\n\\n\u6839\u636e**\u524d\u63d0\u6761\u4ef6**\u4e2d\u7684 Consumer \u521b\u5efa Route\uff0c\u8bbe\u7f6e `uri` \u4e3a `jwt-auth` \u63d2\u4ef6\u4e2d\u7b7e\u53d1 `JWT` \u7684 API \u5730\u5740\uff0c\u5e76\u5728\u6b64 Route \u4e2d\u5f00\u542f `public-api` \u63d2\u4ef6\u3002\\n\\n```Shell\\n    curl -XPUT \'http://127.0.0.1:9080/apisix/admin/routes/r1\' \\\\\\n    -H \'X-API-KEY: <api-key>\' \\\\\\n    -H \'Content-Type: application/json\' \\\\\\n    -d\'{\\n        \\"uri\\": \\"/apisix/plugin/jwt/sign\\",\\n        \\"plugins\\": {\\n            \\"public-api\\": {}\\n        }\\n    }\'\\n```\\n\\n2. \u6d4b\u8bd5\u793a\u4f8b\\n\\n\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5982\u679c\u60a8\u770b\u5230\u8fd4\u56de\u7ed3\u679c\u662f\u4e00\u4e2a JWT \u5b57\u7b26\u4e32\uff0c\u8868\u793a\u6b64 public API \u5df2\u7ecf\u53ef\u4ee5\u4f7f\u7528\u3002\\n\\n```Shell\\n    curl -XGET \'http://127.0.0.1:9080/apisix/plugin/jwt/sign?key=user-key\'\\n\\n    <header>.<payload>.<signature>\\n```\\n\\n### \u65b9\u6cd5\u4e8c\uff1a\u81ea\u5b9a\u4e49\u8def\u5f84\\n\\n\u5728\u4f7f\u7528 `public-api` \u63d2\u4ef6\u4e4b\u524d\uff0c\u7528\u6237\u60f3\u8981\u4fee\u6539\u4e00\u4e2a public API \u5bf9\u5916\u5f00\u653e\u7684 `uri`\uff0c\u662f\u6bd4\u8f83\u56f0\u96be\u7684\u3002\u4f7f\u7528 `prometheus` \u63d2\u4ef6\u7684\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u6cd5\u81ea\u5b9a\u4e49 `exporter uri`\uff0c\u4f46\u662f\u5bf9\u4e8e\u5176\u4ed6 Apache APISIX \u7684\u63d2\u4ef6\uff0c\u53ea\u80fd\u901a\u8fc7\u4fee\u6539\u63d2\u4ef6\u6587\u4ef6\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\uff0c\u800c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6b64\u64cd\u4f5c\u662f\u6709\u56f0\u96be\u4e14\u6709\u98ce\u9669\u7684\u3002\\n\\n\u73b0\u5728\u60a8\u53ef\u4ee5\u4f7f\u7528 `public-api` \u63d2\u4ef6\u4fee\u6539 public API \u5bf9\u5916\u5f00\u653e\u7684 `uri`\uff0c\u5177\u4f53\u64cd\u4f5c\u793a\u4f8b\u5982\u4e0b\u3002\\n\\n1. \u8bbe\u7f6e\u8def\u7531\\n\\n\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u4fee\u6539**\u65b9\u6cd5\u4e00**\u4e2d\u521b\u5efa\u7684 Route\uff0c\u5e76\u8bbe\u7f6e `uri=/gen_token`\uff0c\u540c\u65f6\u5c06\u539f\u6709\u7684 `uri` \u914d\u7f6e\u5230 `public-api` \u63d2\u4ef6\u4e2d\u7684 `uri` \u5b57\u6bb5\u3002\\n\\n```Shell\\n    curl -XPUT \'http://127.0.0.1:9080/apisix/admin/routes/r1\' \\\\\\n    -H \'X-API-KEY: <api-key>\' \\\\\\n    -H \'Content-Type: application/json\' \\\\\\n    -d \'{\\n        \\"uri\\": \\"/gen_token\\",\\n        \\"plugins\\": {\\n            \\"public-api\\": {\\n                \\"uri\\": \\"/apisix/plugin/jwt/sign\\"\\n            }\\n        }\\n    }\'\\n```\\n\\n2. \u6d4b\u8bd5\u793a\u4f8b\\n\\n\u4f7f\u7528\u65b0 `uri` \u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee public API\u3002\\n\\n```Shell\\n    curl -XGET \'http://127.0.0.1:9080/gen_token?key=user-key\'\\n\\n    <header>.<payload>.<signature>\\n```\\n\\n\u4f7f\u7528\u65e7 `uri` \u65e0\u6cd5\u8bbf\u95ee public API\u3002\\n\\n```Shell\\n    curl -XGET \'http://127.0.0.1:9080/apisix/plugin/jwt/sign?key=user-key\'\\n\\n    {\\"error_msg\\":\\"404 Route Not Found\\"}\\n```\\n\\n### \u573a\u666f\u793a\u4f8b\uff1a\u4fdd\u62a4\u8def\u7531\\n\\n\u672c\u8282\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 `public-api` \u63d2\u4ef6\u89e3\u51b3 `plugin-interceptors` \u63d2\u4ef6\u6240\u5e26\u6765\u7684\u4e1a\u52a1\u75db\u70b9\u3002\\n\\n\u4ee5\u4e0b\u6b65\u9aa4\u4ee5 `key-auth` \u63d2\u4ef6\u4e3a\u4f8b\uff0c\u4e3a\u60a8\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 `public-api` \u63d2\u4ef6\u4fdd\u62a4 public API\u3002\\n\\n> \u793a\u4f8b\u4e2d `key-auth` \u914d\u7f6e\u4fe1\u606f\uff0c\u8bf7\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/plugins/jwt-auth)\u3002\\n\\n1. \u521b\u5efa Consumer\\n\\n\u521b\u5efa Consumer\uff0c\u5e76\u914d\u7f6e `key-auth` \u5bc6\u94a5\u3002\\n\\n```Shell\\n    curl -XPUT \'http://127.0.0.1:9080/apisix/admin/consumers\' \\\\\\n    -H \'X-API-KEY: <api-key>\' \\\\\\n    -H \'Content-Type: application/json\' \\\\\\n    -d \'{\\n        \\"username\\": \\"APISIX\\",\\n        \\"plugins\\": {\\n            \\"key-auth\\": {\\n                \\"key\\": \\"test-apikey\\"\\n            }\\n        }\\n    }\'\\n```\\n\\n2. \u8bbe\u7f6e\u8def\u7531\\n\\n\u4fee\u6539**\u65b9\u6cd5\u4e8c**\u4e2d\u521b\u5efa\u7684\u8def\u7531\uff0c\u5e76\u5f00\u542f `key-auth` \u63d2\u4ef6\u548c `public-api` \u63d2\u4ef6\u3002\\n\\n```Shell\\n    curl -XPUT \'http://127.0.0.1:9080/apisix/admin/routes/r1\' \\\\\\n    -H \'X-API-KEY: <api-key>\' \\\\\\n    -H \'Content-Type: application/json\' \\\\\\n    -d \'{\\n        \\"uri\\": \\"/gen_token\\",\\n        \\"plugins\\": {\\n            \\"public-api\\": {\\n                \\"uri\\": \\"/apisix/plugin/jwt/sign\\"\\n            },\\n            \\"key-auth\\": {}\\n        }\\n    }\'\\n```\\n\\n3. \u6d4b\u8bd5\u793a\u4f8b\\n\\n\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u5f53\u8bf7\u6c42\u643a\u5e26\u6b63\u786e\u7684 `apikey` \u65f6\uff0cpublic API \u53ef\u4ee5\u6b63\u5e38\u54cd\u5e94\uff0c\u800c\u6ca1\u6709\u643a\u5e26 `apikey` \u65f6\uff0c\u5c06\u8fd4\u56de `401` \u672a\u8ba4\u8bc1\u7684\u72b6\u6001\u7801\u3002\u5982\u679c\u60a8\u6d4b\u8bd5\u7684\u8fd4\u56de\u7ed3\u679c\u548c\u793a\u4f8b\u72b6\u6001\u4e00\u81f4\uff0c\u5219\u8bc1\u660e\u60a8\u521a\u521a\u914d\u7f6e\u7684 `key-auth` \u63d2\u4ef6\u5df2\u7ecf\u751f\u6548\u3002\\n\\n```Shell\\n    # with corrent apikey\\n    curl -XGET \'http://127.0.0.1:9080/gen_token?key=user-key\'\\n        -H \\"apikey: test-apikey\\"\\n\\n    <header>.<payload>.<signature>\\n\\n    # without apikey\\n    curl -i -XGET \'http://127.0.0.1:9080/gen_token?key=user-key\'\\n\\n    HTTP/1.1 401 UNAUTHORIZED\\n```\\n\\n## \u539f\u7406\u8be6\u89e3\\n\\n\u4ece\u4e0a\u8ff0\u793a\u4f8b\u4e2d\u60a8\u53ef\u4ee5\u770b\u51fa\uff0c`public-api` \u63d2\u4ef6\u53ef\u4ee5\u5f88\u597d\u7684\u89e3\u51b3\u7528\u6237\u5728\u4f7f\u7528 public API \u65f6\u7684\u7f3a\u9677\u3002\u672c\u8282\u4e3a\u60a8\u8be6\u7ec6\u4ecb\u7ecd\u5b9e\u73b0\u539f\u7406\u3002\\n\\n\u5173\u4e8e `public-api` \u7684\u539f\u7406\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u53e5\u8bdd\u63cf\u8ff0\uff1a`public-api` \u63d2\u4ef6\u5c06\u4e4b\u524d\u5355\u72ec\u7684 public API \u8def\u7531\u5339\u914d\u8f6c\u79fb\u5230\u63d2\u4ef6\u5185\u90e8\uff0c\u4ec5\u5bf9\u5f00\u542f\u63d2\u4ef6\u7684\u8def\u7531\u8fdb\u884c public API \u5339\u914d\u3002\u4ee5\u4e0b\u5c06\u4ece\u4e24\u4e2a\u65b9\u9762\u4e3a\u60a8\u8be6\u7ec6\u89e3\u91ca\u539f\u7406\u3002\\n\\n### \u4f7f\u7528 `public-api` \u63d2\u4ef6\u4e4b\u524d\\n\\n\u9996\u5148\uff0c\u60a8\u9700\u8981\u4e86\u89e3 Apache APISIX \u5728\u96c6\u6210 `public-api` \u63d2\u4ef6\u4e4b\u524d\u662f\u5982\u4f55\u5b9e\u73b0 public API \u7684\u529f\u80fd\u7684\u3002\\n\\n- \u5f53 APISIX \u542f\u52a8\u65f6\u4f1a\u52a0\u8f7d\u81ea\u5b9a\u4e49\u63d2\u4ef6\uff0c\u5e76\u4f7f\u7528\u4ece etcd \u83b7\u53d6\u7684 Route \u914d\u7f6e\u6784\u5efa radixtree \u8def\u7531\u5668\uff0c\u5b83\u5c06\u8d1f\u8d23\u6839\u636e\u8bf7\u6c42\u4fe1\u606f\u5339\u914d Route \u5e76\u8c03\u7528\u6b63\u786e\u7684 `handler` \u6765\u8f6c\u53d1\u8bf7\u6c42\u3002\\n- APISIX \u5c06\u4e3a\u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684 public API \u4e0e\u7528\u6237\u521b\u5efa\u7684 Route \u5206\u522b\u521b\u5efa\u4e0d\u540c\u7684\u8def\u7531\u5668\uff08\u4e0b\u6587\u5206\u522b\u79f0\u4e3a public API \u8def\u7531\u5668\u548c Route \u8def\u7531\u5668\uff09\\n- \u5f53\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0c\u5c06\u5148\u7531 public API \u8def\u7531\u5668\u8fdb\u884c\u5339\u914d\uff0c\u4e4b\u540e\u518d\u7531 Route \u8def\u7531\u5668\u8fdb\u884c\u5339\u914d\u3002\u5b83\u4eec\u5728\u8bf7\u6c42\u5904\u7406\u6d41\u7a0b\u4e0a\u662f\u5b8c\u5168\u5206\u5f00\u7684\u4e24\u4e2a\u90e8\u5206\u3002\\n\\n![error/flowchart.png](https://static.apiseven.com/202108/1646120195055-fff81b45-55bb-4100-8822-b14b173448d5.png)\\n\\n\u6839\u636e\u6b64\u6d41\u7a0b\uff0c\u5982\u679c\u60a8\u60f3\u5c06\u9762\u5411 Route \u8def\u7531\u5668\u7684\u63d2\u4ef6\u5e94\u7528\u5728 public API \u8def\u7531\u5668\u4e0a\uff0c\u5c31\u9700\u8981\u624b\u52a8\u7ef4\u62a4\u4e00\u4e2a\u63d2\u4ef6\u5217\u8868\uff0c\u5e76\u5728 public API \u8def\u7531\u5668\u5339\u914d\u5230\u4e4b\u540e\u624b\u52a8\u6267\u884c\u63d2\u4ef6\u51fd\u6570\u3002\u7531\u6b64\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u6837\u7684\u67b6\u6784\u662f\u590d\u6742\u4e14\u96be\u4ee5\u7ef4\u62a4\u7684\uff0c\u5e76\u4e14\u5e26\u6765\u4e86\u8bb8\u591a\u95ee\u9898\uff0c\u5982\u4f7f\u7528\u590d\u6742\uff08\u57fa\u4e8e `plugin_metadata` \u7684\u914d\u7f6e\u65b9\u5f0f\uff09\u3001\u7c97\u7c92\u5ea6\u914d\u7f6e\uff08\u96be\u4ee5\u4e3a\u4e00\u4e2a\u63d2\u4ef6\u4e2d\u63d0\u4f9b\u7684\u591a\u4e2a public API \u6267\u884c\u4e0d\u540c\u7684\u7b56\u7565\uff09\u7b49\u3002\\n\\n### \u589e\u52a0 `public-api` \u63d2\u4ef6\u4e4b\u540e\\n\\n\u5728\u6211\u4eec\u5f15\u5165\u4e86 `public-api` \u63d2\u4ef6\u540e\uff0c\u4e0a\u8ff0\u6d41\u7a0b\u5c06\u4f1a\u88ab\u7b80\u5316\uff0c\u5c06\u539f\u6765\u5148\u4e8e Route \u8def\u7531\u5339\u914d\u6267\u884c\u7684 public API \u8def\u7531\u5339\u914d\u88ab\u8f6c\u79fb\u5230\u4e86\u63d2\u4ef6\u4e2d\u3002\\n\\n- \u5f53\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0cAPISIX \u4f1a\u76f4\u63a5\u6267\u884c Route \u8def\u7531\u5339\u914d\uff0c\u5f53\u627e\u5230\u76f8\u5e94\u7684\u8def\u7531\u540e\uff0c\u5c06\u8f6c\u53d1\u8bf7\u6c42\u81f3\u63d2\u4ef6\u4e2d\u8fdb\u884c\u5904\u7406\u3002\\n- \u5f53\u4e00\u4e2a Route \u5f00\u542f\u4e86 `public-api` \u63d2\u4ef6\u65f6\uff0c\u5c06\u6839\u636e\u63d2\u4ef6\u7684\u914d\u7f6e\u8c03\u7528\u6307\u5b9a\u7684 public API \u8fdb\u884c\u8bf7\u6c42\u5904\u7406\uff0c\u4e0d\u518d\u6267\u884c\u8bf7\u6c42\u7684\u8f6c\u53d1\u3002\u800c\u6ca1\u6709\u5f00\u542f `public-api` \u63d2\u4ef6\u7684 Route\uff0c\u5c06\u4e0d\u4f1a\u8fdb\u884c\u5904\u7406\u3002\\n\\n![error/flowchart.png](https://static.apiseven.com/202108/1646136319962-68f66607-804c-4cbc-8742-0745a3ad0f5a.png)\\n\\n\u81ea\u5b9a\u4e49\u63d2\u4ef6\u63d0\u4f9b\u7684 public API \u9ed8\u8ba4\u5c06\u4e0d\u518d\u66b4\u9732\u51fa\u6765\uff0c\u800c\u662f\u7531\u7528\u6237\u914d\u7f6e Route \u6765\u51b3\u5b9a\u4ee5\u4f55\u79cd\u65b9\u5f0f\u63d0\u4f9b\uff0c\u53ef\u4ee5\u81ea\u7531\u7684\u8bbe\u7f6e\u8def\u7531\u53c2\u6570\uff0c\u5982 `uri`\u3001`host`\u3001`method` \u7b49\uff0c\u4e4b\u540e\u53ea\u9700\u8981\u4e3a\u8def\u7531\u5f00\u542f `public-api` \u63d2\u4ef6\u5373\u53ef\u3002\\n\\n\u7531\u4e8e `public-api` \u63d2\u4ef6\u5177\u6709\u8f83\u4f4e\u7684\u4f18\u5148\u7ea7\uff0c\u5b83\u5c06\u5728\u5927\u90e8\u5206\u63d2\u4ef6\u6267\u884c\u5b8c\u4e4b\u540e\u518d\u6267\u884c\uff0c\u8fd9\u6837\u7528\u6237\u5c31\u53ef\u4ee5\u4e3a Route \u914d\u7f6e\u4efb\u610f\u8ba4\u8bc1\u548c\u5b89\u5168\u7c7b\u63d2\u4ef6\u3002\\n\\nApache APISIX \u4e0d\u518d\u8fdb\u884c\u4e24\u9636\u6bb5\u7684 Route \u8def\u7531\u5339\u914d\u548c\u6267\u884c\u4e0d\u540c\u7684\u903b\u8f91\uff0c\u4e00\u5207\u5f52\u4e8e Route \u8def\u7531\u5339\u914d\uff0c\u8bf7\u6c42\u5904\u7406\u7684\u6d41\u7a0b\u4e5f\u88ab\u7b80\u5316\u3002\\n\\n## \u603b\u7ed3\\n\\n\u9700\u8981\u6ce8\u610f\uff0c`public-api` \u5728\u88ab\u7eb3\u5165\u6b63\u5f0f\u7248\u672c\u53d1\u5e03\u4e4b\u540e\uff0c\u5728 APISIX \u7684 HTTP \u8bf7\u6c42\u5904\u7406\u6d41\u7a0b\u4e2d\uff0cApache APISIX \u5c06\u4e0d\u518d\u8fdb\u884c public API \u7684\u8def\u7531\u5339\u914d\uff0c\u5373\u9ed8\u8ba4\u4e0d\u66b4\u9732\u63d2\u4ef6\u4e2d\u6ce8\u518c\u7684 public API\u3002\u60a8\u53ef\u4ee5\u53c2\u8003\u4e0a\u8ff0 `public-api` \u63d2\u4ef6\u7684\u64cd\u4f5c\u793a\u4f8b\u66f4\u52a0\u7075\u6d3b\u7684\u4f7f\u7528 public API \u7684\u529f\u80fd\u3002\\n\\n> \u6b64\u63d2\u4ef6\u5c06\u5728 `APISIX v2.13.0` \u7248\u672c\u4e0a\u7ebf\u652f\u6301\uff0c\u5982\u679c\u60a8\u5df2\u7ecf\u5728 `APISIX v2.13.0` \u4e4b\u524d\u7684\u7248\u672c\u5b8c\u6210\u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684\u5f00\u53d1\uff0c\u5347\u7ea7\u7248\u672c\u540e\u4f1a\u5bf9\u60a8\u7684\u4e1a\u52a1\u9020\u6210\u5f71\u54cd\uff0c\u8bf7\u60a8\u5347\u7ea7\u524d\u518d\u6b21\u786e\u8ba4\u3002\\n\\n\u5173\u4e8e `public-api` \u63d2\u4ef6\u7684\u66f4\u591a\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u4fe1\u606f\uff0c\u60a8\u53ef\u4ee5\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/next/plugins/public-api)\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41."},{"id":"\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u5347\u7ea7\uff0cAPI \u7f51\u5173 Apache APISIX \u96c6\u6210 OpenTelemetry","metadata":{"permalink":"/zh/blog/2022/02/28/apisix-integration-opentelemetry-plugin","source":"@site/blog/2022/02/28/apisix-integration-opentelemetry-plugin.md","title":"\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u5347\u7ea7\uff0cAPI \u7f51\u5173 Apache APISIX \u96c6\u6210 OpenTelemetry","description":"\u672c\u6587\u4e3a\u60a8\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684 opentelemetry \u63d2\u4ef6\u7684\u6982\u5ff5\u4ee5\u53ca\u5982\u4f55\u5728 APISIX \u4f7f\u7528 opentelemetry \u63d2\u4ef6\u5bf9\u63a5 OpenTelemetry\uff0c\u5b9e\u73b0 trace \u6570\u636e\u91c7\u96c6\u3002","date":"2022-02-28T00:00:00.000Z","formattedDate":"2022\u5e742\u670828\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.355,"truncated":true,"authors":[{"name":"\u5e84\u6d69\u6f6e","title":"Author","url":"https://github.com/dmsolr","image_url":"https://avatars.githubusercontent.com/u/29735230?v=4","imageURL":"https://avatars.githubusercontent.com/u/29735230?v=4"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://avatars.githubusercontent.com/u/97138894?v=4","imageURL":"https://avatars.githubusercontent.com/u/97138894?v=4"}],"prevItem":{"title":"API \u7f51\u5173 APISIX Public API \u5904\u7406\u80fd\u529b\u518d\u589e\u5f3a","permalink":"/zh/blog/2022/03/01/apisix-integration-public-api-plugin"},"nextItem":{"title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Consul KV\uff0c\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u518d\u5347\u7ea7","permalink":"/zh/blog/2022/02/25/consul-api-gateway"}},"content":"> \u672c\u6587\u4e3a\u60a8\u4ecb\u7ecd\u4e86 API \u7f51\u5173 Apache APISIX \u4e2d\u7684 `opentelemetry` \u63d2\u4ef6\u7684\u6982\u5ff5\u4ee5\u53ca\u5982\u4f55\u90e8\u7f72 `opentelemetry` \u63d2\u4ef6\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n<head>\\n    <link rel=\\"canonical\\" href=\\"https://opentelemetry.io/blog/2022/apisix/\\" />\\n</head>\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f5c\u4e3a API \u7f51\u5173\uff0cApache APISIX \u4e0d\u4ec5\u62e5\u6709\u4f17\u591a\u5b9e\u7528\u7684\u63d2\u4ef6\uff0c\u800c\u4e14\u652f\u6301\u63d2\u4ef6\u52a8\u6001\u53d8\u66f4\u548c\u70ed\u63d2\u62d4\u3002\\n\\nOpenTelemetry \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u9065\u6d4b\u6570\u636e\u91c7\u96c6\u548c\u5904\u7406\u7cfb\u7edf\uff0c\u5b83\u4e0d\u4ec5\u63d0\u4f9b\u4e86\u5404\u79cd SDK \u7528\u4e8e\u5e94\u7528\u7aef\u9065\u6d4b\u6570\u636e\u7684\u6536\u96c6\u548c\u4e0a\u62a5\uff0c\u4ee5\u53ca\u6570\u636e\u6536\u96c6\u7aef\u7528\u4e8e\u6570\u636e\u63a5\u6536\u3001\u52a0\u5de5\u548c\u5bfc\u51fa\uff0c\u8fd8\u652f\u6301\u901a\u8fc7\u914d\u7f6e\u5bfc\u51fa\u5230\u4efb\u610f\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u5df2\u7ecf\u9002\u914d OpenTelemetry Exporter \u7684\u540e\u7aef\uff0c\u6bd4\u5982 Jaeger\u3001Zipkin\u3001OpenCensus \u7b49\u3002\u60a8\u53ef\u4ee5\u5728 opentelemetry collector contrib \u5e93\u4e2d\u67e5\u770b\u5df2\u7ecf\u9002\u914d OpenTelemetry Collector \u7684\u63d2\u4ef6\u5217\u8868\u3002\\n\\n![error/OpenTelemetry](https://static.apiseven.com/202108/1646037628714-f542841e-ac27-4c13-a4c8-4cdef79ee501.png)\\n\\n## \u63d2\u4ef6\u4ecb\u7ecd\\n\\nApache APISIX `opentelemetry` \u63d2\u4ef6\u662f\u57fa\u4e8e OpenTelemetry \u539f\u751f\u6807\u51c6\uff08[OTLP/HTTP](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md#otlphttp-request)\uff09\u5b9e\u73b0\u7684 Tracing \u6570\u636e\u91c7\u96c6\uff0c\u5e76\u901a\u8fc7 HTTP \u534f\u8bae\u53d1\u9001\u81f3 OpenTelemetry Collector\u3002\u8be5\u529f\u80fd\u5c06\u5728 Apache APISIX 2.13.0  \u7248\u672c\u4e2d\u4e0a\u7ebf\u652f\u6301\u3002\\n\\n\u7531\u4e8e OpenTelemetry \u7684 Agent/SDK \u4e0e\u540e\u7aef\u5b9e\u73b0\u65e0\u5173\uff0c\u5f53\u5e94\u7528\u96c6\u6210\u4e86 OpenTelemetry \u7684 Agent/SDK \u4e4b\u540e\uff0c\u7528\u6237\u80fd\u591f\u5728\u5e94\u7528\u4fa7\u65e0\u611f\u77e5\u7684\u60c5\u51b5\u4e0b\u8f7b\u677e\u5730\u3001\u81ea\u7531\u5730\u53d8\u66f4\u53ef\u89c2\u6d4b\u6027\u540e\u7aef\u670d\u52a1\uff0c\u6bd4\u5982\u4ece Zipkin \u5207\u6362\u6210 Jaeger\u3002\\n\\n`opentelemetry` \u63d2\u4ef6\u5728 Apache APISIX \u4e2d\u96c6\u6210\u4e86 OpenTelemetry Agent/SDK\uff0c\u53ef\u4ee5\u5b9e\u73b0\u91c7\u96c6\u88ab\u8ffd\u8e2a\u7684\u8bf7\u6c42\u751f\u6210 trace \u540e\u8f6c\u53d1\u5230 OpenTelemetry Collector\u3002\\n\\n`opentelemetry` \u63d2\u4ef6\u4f4d\u4e8e\u4e0a\u56fe\u4e2d\u7684 Agent \u4fa7\uff0c\u4f46\u76ee\u524d\u4ec5\u652f\u6301 `trace` \u534f\u8bae\uff0c\u8fd8\u4e0d\u652f\u6301 OpenTelemetry \u7684 `logs` \u548c `metrics` \u534f\u8bae\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u542f\u7528\u63d2\u4ef6\\n\\n\u60a8\u9700\u8981\u5728 `conf/config.yaml` \u914d\u7f6e\u6587\u4ef6\u4e2d\u542f\u7528 `opentelemetry` \u63d2\u4ef6\u5e76\u4fee\u6539 `collector` \u914d\u7f6e\u3002\\n\\n\u5047\u8bbe\u60a8\u5df2\u7ecf\u5b8c\u6210 OpenTelemetry Collector \u7684\u90e8\u7f72\uff0c\u5e76\u4e14\u542f\u7528\u4e86 [OTLP HTTP Receiver](https://github.com/open-telemetry/opentelemetry-collector/blob/main/receiver/otlpreceiver/README.md)\u3002\\n\\n> \u5982\u679c\u60a8\u672a\u5b8c\u6210\u90e8\u7f72\uff0c\u53ef\u53c2\u8003\u4e0b\u4e00\u8282\u7684\u573a\u666f\u793a\u4f8b\u90e8\u5206\uff0c\u5b8c\u6210 OpenTelemetry Collector \u7684\u90e8\u7f72\u3002\\n\\n\u5176\u4e2d OTLP HTTP Receiver \u7684\u9ed8\u8ba4\u7aef\u53e3\u4e3a`4318`\uff0c`collector` \u7684\u5730\u5740\u4e3a OpenTelemetry Collector \u7684 HTTP Receiver \u5730\u5740\uff0c\u76f8\u5173\u5b57\u6bb5\u53ef\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/next/plugins/opentelemetry/)\u3002\\n\\n  ```YAML\\n  plugins\\n  ... # \u5df2\u7ecf\u542f\u7528\u7684\u5176\u5b83\u63d2\u4ef6\\n  - opentelemetry\\nplugin_attr:\\n  ...\\n  opentelemetry:\\n    trace_id_source: x-request-id\\n    resource:\\n      service.name: APISIX\\n    collector:\\n      address: 127.0.0.1:4318 # OTLP HTTP Receiver \u5730\u5740\\n      request_timeout: 3\\n  ```\\n\\n#### \u65b9\u6cd5\u4e00\uff1a\u5c06\u63d2\u4ef6\u7ed1\u5b9a\u5230\u6307\u5b9a\u8def\u7531\\n\\n\u4e3a\u4e86\u66f4\u65b9\u4fbf\u7684\u5c55\u793a\u6d4b\u8bd5\u6548\u679c\uff0c\u793a\u4f8b\u4e2d\u6682\u65f6\u5c06 `sampler` \u8bbe\u7f6e\u4e3a\u5168\u91c7\u6837\uff0c\u4ee5\u786e\u4fdd\u6bcf\u6b21\u8bf7\u6c42\u90fd\u88ab\u8ffd\u8e2a\u540e\u4ea7\u751f `trace` \u6570\u636e\uff0c\u65b9\u4fbf\u60a8\u5728 Web UI \u4e0a\u67e5\u770b `trace` \u7684\u76f8\u5173\u6570\u636e\u3002\u60a8\u4e5f\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\uff0c\u8bbe\u7f6e\u76f8\u5173\u53c2\u6570\u3002\\n\\n  ```Shell\\n  curl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n  -X PUT -d \'\\n{\\n    \\"uri\\": \\"/get\\",\\n    \\"plugins\\": {\\n        \\"opentelemetry\\": {\\n            \\"sampler\\": {\\n                \\"name\\": \\"always_on\\"\\n            }\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"httpbin.org:80\\": 1\\n        }\\n    }\\n}\'\\n  ```\\n\\n#### \u65b9\u5f0f\u4e8c\uff1a\u8bbe\u7f6e Global Rules\\n\\n\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7 Apache APISIX Plugins \u529f\u80fd\u542f\u7528 `opentelemetry` \u63d2\u4ef6\u3002\u5b8c\u6210\u5168\u5c40\u914d\u7f6e\u540e\uff0c\u60a8\u4ecd\u7136\u9700\u8981\u521b\u5efa\u8def\u7531\uff0c\u5426\u5219\u5c06\u65e0\u6cd5\u8fdb\u884c\u6d4b\u8bd5\u3002\\n\\n  ```Shell\\n  curl \'http://127.0.0.1:9080/apisix/admin/global_rules/1\' \\\\\\n-H \'X-API-KEY:  edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n-X PUT -d \'{\\n    \\"plugins\\": {\\n        \\"opentelemetry\\": {\\n            \\"sampler\\": {\\n                \\"name\\": \\"always_on\\"\\n            }\\n        }\\n    }\\n}\'\\n  ```\\n\\n#### \u65b9\u5f0f\u4e09\uff1a\u901a\u8fc7 `additional_attributes` \u4e3a Span \u81ea\u5b9a\u4e49\u6807\u7b7e\\n\\n\u5173\u4e8e `sampler` \u548c `additional_attributes` \u7684\u914d\u7f6e\u60a8\u53ef\u4ee5\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/next/plugins/opentelemetry/)\uff0c\u5176\u4e2d `additional_attributes` \u662f\u4e00\u7cfb\u5217\u7684 `Key:Value` \u952e\u503c\u5bf9\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u4e3a Span \u81ea\u5b9a\u4e49\u6807\u7b7e\uff0c\u5e76\u4e14\u53ef\u4ee5\u8ddf\u968f Span \u5728 Web UI \u4e0a\u5c55\u793a\u3002\u901a\u8fc7 `additional_attributes` \u4e3a\u67d0\u4e2a\u8def\u7531\u7684 Span \u589e\u52a0 `route_id` \u548c `http_x-custom-ot-key`\uff0c\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u914d\u7f6e\uff1a\\n\\n  ```Shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1001 \\\\\\n  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n  -X PUT -d \'\\n{\\n    \\"uri\\": \\"/put\\",\\n    \\"plugins\\": {\\n        \\"opentelemetry\\": {\\n            \\"sampler\\": {\\n                \\"name\\": \\"always_on\\"\\n            },\\n            \\"additional_attributes\\":[\\n                \\"route_id\\",\\n                \\"http_x-custom-ot-key\\"\\n            ]\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"httpbin.org:80\\": 1\\n        }\\n    }\\n}\'\\n  ```\\n\\n### \u6d4b\u8bd5\u793a\u4f8b\\n\\n\u60a8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0a\u4e09\u79cd\u65b9\u5f0f\u4e2d\u7684\u4efb\u610f\u4e00\u79cd\u65b9\u5f0f\u542f\u7528 `opentelemetry`\uff0c\u4ee5\u4e0b\u793a\u4f8b\u4f7f\u7528\u65b9\u5f0f\u4e09\u7684\u65b9\u6cd5\u521b\u5efa\u8def\u7531\uff0c\u521b\u5efa\u6210\u529f\u540e\uff0c\u60a8\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u547d\u4ee4\u8bbf\u95ee\u8def\u7531\uff1a\\n\\n```Shell\\ncurl -X PUT -H `x-custom-ot-key: test-ot-val` http://127.0.0.1:9080/put\\n```\\n\\n\u8bbf\u95ee\u6210\u529f\u4e4b\u540e\uff0c\u60a8\u53ef\u4ee5\u5728 Jaeger UI \u4e2d\u770b\u5230\u7c7b\u4f3c\u5982\u4e0b\u56fe\u6240\u793a /put \u7684 Span \u8be6\u60c5\uff0c\u5e76\u53ef\u4ee5\u770b\u5230 Tags \u5217\u8868\u4e2d\u5c55\u793a\u4e86\u8def\u7531\u4e2d\u81ea\u5b9a\u4e49\u7684 tag\uff1a`http_x-custom-ot-key` \u548c `route_id`\u3002\\n\\n![error/Span details.png](https://static.apiseven.com/202108/1646039676695-a346734b-0498-4ff6-8882-789a61008544.png)\\n\\n\u60a8\u9700\u8981\u6ce8\u610f\uff0c`additional_attributes` \u914d\u7f6e\u7684\u8bbe\u5b9a\u662f\u4ece Apache APISIX \u548c Nginx \u53d8\u91cf\u53d6\u503c\u4f5c\u4e3a `attribute` \u7684\u503c\uff0c\u56e0\u6b64 `additional_attributes` \u5fc5\u987b\u662f Apache APISIX \u6216\u8005 Nginx \u7684\u6709\u6548\u53d8\u91cf\u3002\u5176\u4e2d\u4e5f\u5305\u62ec HTTP Header\uff0c\u4f46\u662f\u5728\u53d6 `http_header` \u65f6\uff0c\u9700\u8981\u6dfb\u52a0 `http_` \u4f5c\u4e3a\u53d8\u91cf\u540d\u7684\u524d\u7f00\u3002\u5982\u679c\u53d8\u91cf\u4e0d\u5b58\u5728\uff0c\u5c31\u4e0d\u4f1a\u5c55\u793a\u8fd9\u4e2a `tag` \u4e86\u3002\\n\\n### \u573a\u666f\u793a\u4f8b\\n\\n\u672c\u573a\u666f\u793a\u4f8b\u901a\u8fc7\u7b80\u5355\u4fee\u6539 OpenTelemetry Collector \u5b98\u65b9\u793a\u4f8b\u90e8\u7f72 Collector\u3001Jaeger \u548c Zipkin \u4f5c\u4e3a\u540e\u7aef\u670d\u52a1\uff0c\u5e76\u4e14\u542f\u52a8\u4e24\u4e2a\u793a\u4f8b\u5e94\u7528\u7a0b\u5e8f\uff08Client \u548c Server\uff09\uff0c\u5176\u4e2d Server \u63d0\u4f9b\u4e86\u4e00\u4e2a HTTP \u670d\u52a1\uff0c\u800c Client \u4f1a\u5faa\u73af\u8c03\u7528 Server \u63d0\u4f9b\u7684 HTTP \u63a5\u53e3\uff0c\u4ece\u800c\u4ea7\u751f\u5305\u62ec\u4e24\u4e2a Span \u7684\u8c03\u7528\u94fe\u3002\\n\\n#### \u6b65\u9aa4\u4e00\uff1a\u90e8\u7f72 OpenTelemetry\\n\\n\u4ee5\u4e0b\u4f7f\u7528 `docker-compose` \u4f5c\u4e3a\u793a\u4f8b\uff0c\u5176\u5b83\u90e8\u7f72\u53ef\u4ee5\u53c2\u8003 [OpenTelemetry \u5b98\u65b9\u6587\u6863](https://opentelemetry.io/docs/collector/getting-started/)\u3002\\n\\n\u60a8\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u547d\u4ee4\u90e8\u7f72\uff1a\\n\\n  ```Shell\\ngit clone https://github.com/open-telemetry/opentelemetry-collector-contrib.git\\ncd opentelemetry-collector-contrib/examples/demo\\ndocker-compose up -d\\n  ```\\n\\n\u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165 `http://127.0.0.1:16886`\uff08Jaeger UI\uff09\u6216\u8005 `http://127.0.0.1:9411/zipkin`\uff08Zipkin UI\uff09\uff0c\u5982\u679c\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\uff0c\u5219\u8868\u793a\u90e8\u7f72\u6210\u529f\u3002\\n\\n\u4e0b\u56fe\u4e3a\u8bbf\u95ee\u6210\u529f\u793a\u4f8b\uff1a\\n\\n![error/Jaeger example.png](https://static.apiseven.com/202108/1646039980335-71bbb6f7-39d5-4153-b6e7-0305f52112f3.png)\\n\\n![error/Zipkin example.png](https://static.apiseven.com/202108/1646040117233-7a18f85f-4037-43e3-bc63-0ff6d1dbe5c1.png)\\n\\n#### \u6b65\u9aa4\u4e8c\uff1a\u914d\u7f6e\u6d4b\u8bd5\u73af\u5883\\n\\n\u5f15\u5165 Apache APISIX \u670d\u52a1\uff0c\u6700\u7ec8\u5e94\u7528\u7684\u62d3\u6251\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![error/Architecture diagram.png](https://static.apiseven.com/202108/1646040225319-819f10ab-9643-4bd7-8f99-07f9a6c84bf8.png)\\n\\nTrace \u6570\u636e\u4e0a\u62a5\u6d41\u7a0b\u5982\u4e0b\u3002\u5176\u4e2d\u7531\u4e8e Apache APISIX \u662f\u5355\u72ec\u90e8\u7f72\u7684\uff0c\u5e76\u4e0d\u5728 `docker-compose` \u7684\u7f51\u7edc\u5185\uff0c\u6240\u4ee5 Apache APISIX \u662f\u901a\u8fc7\u672c\u5730\u6620\u5c04\u7684\u7aef\u53e3\uff08\u5373 `127.0.0.1:4138`\uff09\u8bbf\u95ee\u5230 OpenTelemetry Collector \u7684 OTLP HTTP Receiver \u7684\u3002\\n\\n![error/Trace data reporting process.png](https://static.apiseven.com/202108/1646040470172-4d44c6ca-b890-4245-9c87-3a42d8b59f47.png)\\n\\n\u60a8\u9700\u8981\u786e\u4fdd\u5df2\u7ecf\u542f\u7528 `opentelemetry` \u63d2\u4ef6\uff0c\u5e76\u91cd\u65b0\u52a0\u8f7d Apache APISIX\u3002\\n\\n1. \u60a8\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u793a\u4f8b\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff0c\u5e76\u4e14\u542f\u7528 `opentelemetry` \u63d2\u4ef6\u8fdb\u884c\u91c7\u6837\uff1a\\n\\n  ```Shell\\n  curl http://127.0.0.1:9080/apisix/admin/routes/1 \\\\\\n    -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n    -X PUT -d \'\\n  {\\n      \\"uri\\": \\"/hello\\",\\n      \\"plugins\\": {\\n          \\"opentelemetry\\": {\\n              \\"sampler\\": {\\n                  \\"name\\": \\"always_on\\",\\n              }\\n          }\\n      },\\n      \\"upstream\\": {\\n          \\"type\\": \\"roundrobin\\",\\n          \\"nodes\\": {\\n              \\"127.0.0.1:7080\\": 1\\n          }\\n      }\\n  }\'\\n  ```\\n\\n2. \u4fee\u6539 `./examples/demo/otel-collector-config.yaml` \u6587\u4ef6\uff0c\u5e76\u6dfb\u52a0 OTLP HTTP Receiver\uff0c\u5982\u4e0b\u6240\u793a\uff1a\\n\\n  ```Shell\\n  receivers:\\n    otlp:\\n      protocols:\\n        grpc:\\n        http:${ip:port}   # \u6dfb\u52a0 OTLP HTTP Receiver\uff0c\u9ed8\u8ba4\u7aef\u53e3\u4e3a 4318\\n  ```\\n\\n3. \u4fee\u6539 `docker-compose.yaml`\u3002\\n\\n\u60a8\u9700\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u628a Client \u8c03\u7528 Server \u7684\u63a5\u53e3\u5730\u5740\u4fee\u6539\u4e3a Apache APISIX \u7684\u5730\u5740\uff0c\u5c06 OTLP HTTP Receiver \u548c Server \u670d\u52a1\u7684\u7aef\u53e3\u6620\u5c04\u5230\u672c\u5730\u3002\\n\\n\u4ee5\u4e0b\u793a\u4f8b\u662f\u4fee\u6539\u914d\u7f6e\u540e\u5b8c\u6574\u7684 `docker-compose.yaml`\uff1a\\n\\n  ```YAML\\nversion: \\"2\\"\\nservices:\\n\\n  # Jaeger\\n  jaeger-all-in-one:\\n    image: jaegertracing/all-in-one:latest\\n    ports:\\n      - \\"16686:16686\\" # jaeger ui \u7684\u7aef\u53e3\\n      - \\"14268\\"\\n      - \\"14250\\"\\n\\n  # Zipkin\\n  zipkin-all-in-one:\\n    image: openzipkin/zipkin:latest\\n    ports:\\n      - \\"9411:9411\\"\\n\\n  # Collector\\n  otel-collector:\\n    image: ${OTELCOL_IMG}\\n    command: [\\"--config=/etc/otel-collector-config.yaml\\", \\"${OTELCOL_ARGS}\\"]\\n    volumes:\\n      - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml\\n    ports:\\n      - \\"1888:1888\\"   # pprof extension\\n      - \\"8888:8888\\"   # Prometheus metrics exposed by the collector\\n      - \\"8889:8889\\"   # Prometheus exporter metrics\\n      - \\"13133:13133\\" # health_check extension\\n      - \\"4317\\"        # OTLP gRPC receiver\\n      - \\"4318:4318\\"   # \u6dfb\u52a0 OTLP HTTP Receiver \u7aef\u53e3\u6620\u5c04\\n      - \\"55670:55679\\" # zpages extension\\n    depends_on:\\n      - jaeger-all-in-one\\n      - zipkin-all-in-one\\n\\n  demo-client:\\n    build:\\n      dockerfile: Dockerfile\\n      context: ./client\\n    environment:\\n      - OTEL_EXPORTER_OTLP_ENDPOINT=otel-collector:4317\\n      - DEMO_SERVER_ENDPOINT=http://172.17.0.1:9080/hello # APISIX \u7684\u5730\u5740\\n    depends_on:\\n      - demo-server\\n\\n  demo-server:\\n    build:\\n      dockerfile: Dockerfile\\n      context: ./server\\n    environment:\\n      - OTEL_EXPORTER_OTLP_ENDPOINT=otel-collector:4317\\n    ports:\\n      - \\"7080:7080\\" # \u5c06 Server \u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\\n    depends_on:\\n      - otel-collector\\n\\n  prometheus:\\n    container_name: prometheus\\n    image: prom/prometheus:latest\\n    volumes:\\n      - ./prometheus.yaml:/etc/prometheus/prometheus.yml\\n    ports:\\n      - \\"9090:9090\\"\\n  ```\\n\\n\u9700\u8981\u6ce8\u610f\uff0c`demo-client.environment.DEMO_SERVER_ENDPOINT` \u5904\u9700\u8981\u6539\u4e3a\u60a8\u7684 Apache APISIX \u5730\u5740\uff0c\u4e14\u4fdd\u8bc1\u5728\u5bb9\u5668\u5185\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\u3002\\n\\n\u5f53\u7136\uff0c\u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7 `docker-compose.yaml` \u90e8\u7f72 Apache APISIX \uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://github.com/apache/apisix-docker/blob/master/docs/en/latest/example.md)\u3002\\n\\n#### \u6b65\u9aa4\u4e09\uff1a\u6d4b\u8bd5\\n\\n\u91cd\u65b0\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u8bbf\u95ee Jaeger UI \u6216\u8005 Zipkin UI \u5373\u53ef\u770b\u5230 Trace \u4e2d\u5305\u542b\u4e86 APISIX \u7684 Span\uff0c\u5982\u4e0b\u56fe\uff1a\\n\\n![error/Jaeger example.png](https://static.apiseven.com/202108/1646045290844-acfa071b-5a0d-4f7a-aa77-55838a3cb9f6.png)\\n\\n![error/Zipkin example.png](https://static.apiseven.com/202108/1646045376329-e1344754-58b4-4a73-8aea-50e6a04f3b70.png)\\n\\n## \u7981\u7528\u63d2\u4ef6\\n\\n\u5982\u679c\u60a8\u6682\u65f6\u4e0d\u9700\u8981\u67d0\u4e2a\u8def\u7531\u7684 Trace \u91c7\u96c6\uff0c\u5219\u4ec5\u9700\u4fee\u6539\u8def\u7531\u914d\u7f6e\uff0c\u5c06\u914d\u7f6e\u4e2d\u7684 `plugins` \u4e0b\u7684 `opentelemetry` \u76f8\u5173\u914d\u7f6e\u5220\u9664\u5373\u53ef\u3002\\n\\n\u5982\u679c\u60a8\u662f\u901a\u8fc7\u7ed1\u5b9a Global Rules \u5168\u5c40\u542f\u7528\u7684\uff0c\u5219\u53ea\u80fd\u5220\u9664 `opentelemetry` \u5168\u5c40\u63d2\u4ef6\u7684\u914d\u7f6e\u3002\u5f97\u76ca\u4e8e Apache APISIX \u7684\u52a8\u6001\u5316\u4f18\u52bf\uff0c\u5f00\u542f\u5173\u95ed\u63d2\u4ef6\u7684\u8fc7\u7a0b\u90fd\u4e0d\u9700\u8981\u91cd\u542f Apache APISIX\uff0c\u5341\u5206\u65b9\u4fbf\u3002\\n\\n## \u603b\u7ed3\\n\\nApache APISIX \u5728\u96c6\u6210 OpenTelemetry \u4e4b\u540e\uff0c\u501f\u52a9 OpenTelemetry \u4e30\u5bcc\u7684\u63d2\u4ef6\u80fd\u591f\u4e0e\u5e02\u573a\u4e0a\u5927\u90e8\u5206\u4e3b\u6d41\u7684 Trace \u7cfb\u7edf\u8f7b\u677e\u5b9e\u73b0\u5bf9\u63a5\u3002\u6b64\u5916\uff0cApache APISIX \u4e5f\u5b9e\u73b0\u4e86 SkyWalking \u548c Zipkin \u539f\u751f\u6807\u51c6\u534f\u8bae\u63d2\u4ef6\uff0c\u4e5f\u5728\u79ef\u6781\u4e0e\u5404\u5927\u793e\u533a\u5408\u4f5c\u6253\u9020\u66f4\u52a0\u5f3a\u5927\u7684\u751f\u6001\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41.\\n\\n## \u76f8\u5173\u9605\u8bfb\\n\\n- [\u6d45\u8c08 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027](https://apisix.apache.org/zh/blog/2021/11/04/skywalking)\\n\\n- [\u751f\u6001\u6269\u5927\u8fdb\u884c\u4e2d\uff01API \u7f51\u5173\u96c6\u6210 Splunk HTTP Event Collector](https://apisix.apache.org/zh/blog/2022/02/10/apisix-splunk-integration)"},{"id":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Consul KV\uff0c\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u518d\u5347\u7ea7","metadata":{"permalink":"/zh/blog/2022/02/25/consul-api-gateway","source":"@site/blog/2022/02/25/consul-api-gateway.md","title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Consul KV\uff0c\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u518d\u5347\u7ea7","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u652f\u6301\u57fa\u4e8e Consul KV \u7684\u670d\u52a1\u53d1\u73b0\u3002\u672c\u6587\u8bb2\u8ff0\u4e86\u5728 Apache APISIX \u4e2d\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u548c\u670d\u52a1\u6ce8\u518c\u7684\u5168\u8fc7\u7a0b\u53ca consul_kv \u7684\u76f8\u5173\u539f\u7406\u3002","date":"2022-02-25T00:00:00.000Z","formattedDate":"2022\u5e742\u670825\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":7.51,"truncated":true,"authors":[{"name":"\u6768\u9676","title":"Author","url":"https://github.com/SkyeYoung","image_url":"https://github.com/SkyeYoung.png","imageURL":"https://github.com/SkyeYoung.png"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://github.com/yzeng25.png","imageURL":"https://github.com/yzeng25.png"}],"prevItem":{"title":"\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u5347\u7ea7\uff0cAPI \u7f51\u5173 Apache APISIX \u96c6\u6210 OpenTelemetry","permalink":"/zh/blog/2022/02/28/apisix-integration-opentelemetry-plugin"},"nextItem":{"title":"\u5982\u4f55\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u7684 CSRF \u5b89\u5168\u63d2\u4ef6\u62e6\u622a\u8de8\u7ad9\u70b9\u4f2a\u9020\u653b\u51fb","permalink":"/zh/blog/2022/02/23/csrf-api-gateway"}},"content":"> Apache APISIX \u652f\u6301\u57fa\u4e8e Consul KV \u7684\u670d\u52a1\u53d1\u73b0\u6ce8\u518c\u8868\u3002\u8fd9\u7bc7\u6587\u7ae0\u8bb2\u8ff0\u4e86\u5728 Apache APISIX \u4e2d\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u548c\u670d\u52a1\u6ce8\u518c\u7684\u5168\u8fc7\u7a0b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\u3002\\n\\n\u4f5c\u4e3a API \u7f51\u5173\uff0cApache APISIX \u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\nConsul \u662f\u4e00\u4e2a\u670d\u52a1\u7f51\u683c\u89e3\u51b3\u65b9\u6848\uff0c\u5176\u6838\u5fc3\u4e4b\u4e00\u7684 Consul KV \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u952e\u503c\u6570\u636e\u5e93\uff0c\u4e3b\u8981\u7528\u9014\u662f\u5b58\u50a8\u914d\u7f6e\u53c2\u6570\u548c\u5143\u6570\u636e\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u7528\u6237\u5b58\u50a8\u7d22\u5f15\u5bf9\u8c61\u3002\\n\\n\u5728\u5fae\u670d\u52a1\u67b6\u6784\u6a21\u5f0f\u4e0b\uff0c\u5f53\u6269\u5bb9\u3001\u786c\u4ef6\u6545\u969c\u7b49\u5bfc\u81f4\u4e0a\u6e38\u670d\u52a1\u53d1\u751f\u53d8\u52a8\u7684\u60c5\u51b5\u51fa\u73b0\u65f6\uff0c\u901a\u8fc7\u624b\u52a8\u64b0\u5199\u914d\u7f6e\uff0c\u7ef4\u62a4\u4e0a\u6e38\u670d\u52a1\u4fe1\u606f\u7684\u65b9\u5f0f\uff0c\u4f1a\u5bfc\u81f4\u7ef4\u62a4\u6210\u672c\u9661\u589e\u3002\u5bf9\u6b64\uff0cApache APISIX \u63d0\u4f9b\u4e86\u670d\u52a1\u53d1\u73b0\u6ce8\u518c\u4e2d\u5fc3\u7684\u529f\u80fd\uff0c\u5b9e\u73b0\u52a8\u6001\u83b7\u53d6\u6700\u65b0\u7684\u670d\u52a1\u5b9e\u4f8b\u4fe1\u606f\uff0c\u4ee5\u964d\u4f4e\u7528\u6237\u7684\u7ef4\u62a4\u6210\u672c\u3002\\n\\n\u76ee\u524d\uff0cApache APISIX \u501f\u7531\u793e\u533a\u8d21\u732e\u7684 `consul_kv` \u6a21\u5757\uff0c\u652f\u6301\u4e86\u57fa\u4e8e Consul KV \u7684\u670d\u52a1\u53d1\u73b0\u6ce8\u518c\u4e2d\u5fc3\u3002\\n\\n## \u63d2\u4ef6\u5de5\u4f5c\u539f\u7406\\n\\nApache APISIX \u5229\u7528 Consul KV \u5206\u5e03\u5f0f\u952e\u503c\u5b58\u50a8\u80fd\u529b\u7684 `consul_kv` \u6a21\u5757\uff0c\u89e3\u8026\u4e86\u670d\u52a1\u7684\u63d0\u4f9b\u8005\u548c\u6d88\u8d39\u8005\uff0c\u5b9e\u73b0\u4e86\u670d\u52a1\u53d1\u73b0\u6ce8\u518c\u4e2d\u5fc3\u7684\u4e24\u5927\u6838\u5fc3\u529f\u80fd\u3002\\n\\n1. \u670d\u52a1\u6ce8\u518c\uff1a\u670d\u52a1\u63d0\u4f9b\u8005\u5411\u6ce8\u518c\u4e2d\u5fc3\u6ce8\u518c\u670d\u52a1\u3002\\n2. \u670d\u52a1\u53d1\u73b0\uff1a\u670d\u52a1\u6d88\u8d39\u8005\u901a\u8fc7\u6ce8\u518c\u4e2d\u5fc3\u67e5\u627e\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u8def\u7531\u4fe1\u606f\u3002\\n\\n\u5728\u6b64\u57fa\u7840\u4e0a\u6784\u5efa\u7684 Apache APISIX \u5c06\u66f4\u7075\u6d3b\u5730\u9002\u5e94\u73b0\u6709\u7684\u5fae\u670d\u52a1\u67b6\u6784\uff0c\u66f4\u597d\u5730\u6ee1\u8db3\u7528\u6237\u9700\u6c42\u3002\\n\\n![APISIX Consul \u5de5\u4f5c\u539f\u7406](https://static.apiseven.com/202108/1645769130815-f23e9e11-ca57-4262-9083-aab5509aa178.png)\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n\u672c\u6587\u4e2d\u7684\u6d4b\u8bd5\u73af\u5883\u5747\u4f7f\u7528 docker-compose \u5728 Docker \u4e2d\u642d\u5efa\u3002\\n\\n1. \u4e0b\u8f7d Apache APISIX\u3002\\n\\n  ```shell\\n  # \u62c9\u53d6 apisix-docker \u7684 Git \u4ed3\u5e93\\n  git clone https://github.com/apache/apisix-docker.git\\n  ```\\n\\n2. \u521b\u5efa Consul \u6587\u4ef6\u5939\u548c\u914d\u7f6e\u6587\u4ef6\u3002\\n\\n  ```shell\\n  # \u521b\u5efa consul \u6587\u4ef6\u5939\\n  mkdir -p ~/docker-things/consul/ && cd \\"$_\\"\\n  # \u521b\u5efa\u914d\u7f6e\u6587\u4ef6\\n  touch docker-compose.yml server1.json\\n  ```\\n\\n3. \u4fee\u6539 `docker-compose.yml` \u6587\u4ef6\u3002\\n\\n  ```yaml\\n  version: \'3.8\'\\n\\n  services:\\n    consul-server1:\\n      image: consul:1.9.3\\n      container_name: consul-server1\\n      restart: always\\n      volumes:\\n        - ./server1.json:/consul/config/server1.json:ro\\n      networks:\\n        - apisix\\n      ports:\\n        - \'8500:8500\'\\n      command: \'agent -bootstrap-expect=1\'\\n\\n  networks:\\n    apisix:\\n      external: true\\n      name: example_apisix\\n  ```\\n\\n4. \u4fee\u6539 `server1.json` \u6587\u4ef6\u3002\\n\\n  ```json\\n  {\\n    \\"node_name\\": \\"consul-server1\\",\\n    \\"server\\": true,\\n    \\"addresses\\": {\\n      \\"http\\": \\"0.0.0.0\\"\\n    }\\n  }\\n  ```\\n\\n5. \u5728 Apache APISIX \u4e2d\u7684\u914d\u7f6e\u6587\u4ef6 `apisix_conf/config.yaml` \u6dfb\u52a0 Consul \u7684\u76f8\u5173\u914d\u7f6e\u4fe1\u606f\u3002\\n\\n  ```yaml\\n  # config.yml\\n  # ...other config\\n  discovery:\\n    consul_kv:\\n      servers:\\n        - \\"http://consul-server1:8500\\"\\n      prefix: \\"upstreams\\"\\n  ```\\n\\n6. \u542f\u52a8 Apache APISIX \u548c Consul\u3002\\n\\n  ```shell\\n  # \u8fdb\u5165 example \u548c consul \u6587\u4ef6\u5939\uff0c\u4f9d\u6b21\u542f\u52a8 APISIX \u548c Consul\\n  docker-compose up -d\\n  ```\\n\\n7. \u5c06\u6d4b\u8bd5\u670d\u52a1\u6ce8\u518c\u5230 Consul\u3002`example` \u5305\u542b\u4e86\u4e24\u4e2a Web \u670d\u52a1\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e24\u4e2a\u670d\u52a1\u8fdb\u884c\u6d4b\u8bd5\u3002\\n\\n  ```shell\\n  # \u68c0\u67e5 example \u7684 docker-compose.yml \u5c31\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a Web \u670d\u52a1\\n  $ cat docker-compose.yml | grep web\\n  # \u8f93\u51fa\\n  web1:\\n    - ./upstream/web1.conf:/etc/nginx/nginx.conf\\n  web2:\\n    - ./upstream/web2.conf:/etc/nginx/nginx.conf\\n  ```\\n\\n8. \u786e\u8ba4 Web \u670d\u52a1\u7684 IP \u5730\u5740\u3002\\n\\n  ```shell\\n  $ sudo docker inspect -f=\'{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}\' $(sudo docker ps -aq) | grep web\\n  # \u8f93\u51fa\\n  /example-web1-1 - 172.26.0.7\\n  /example-web2-1 - 172.26.0.2\\n  ```\\n\\n9. \u5728\u7ec8\u7aef\u4e2d\u5bf9 Consul \u7684 HTTP API \u8fdb\u884c\u8bf7\u6c42\u4ee5\u6ce8\u518c\u6d4b\u8bd5\u670d\u52a1\u3002\\n  \\n  ```shell\\n  # \u4f7f\u7528\u5bf9\u5e94\u7684 IP \u8fdb\u884c\u6ce8\u518c\\n  curl \\\\\\n    -X PUT \\\\\\n    -d \' {\\"weight\\": 1, \\"max_fails\\": 2, \\"fail_timeout\\": 1}\' \\\\\\n    http://127.0.0.1:8500/v1/kv/upstreams/webpages/172.26.0.7:80\\n\\n  curl \\\\\\n    -X PUT \\\\\\n    -d \' {\\"weight\\": 1, \\"max_fails\\": 2, \\"fail_timeout\\": 1}\' \\\\\\n    http://127.0.0.1:8500/v1/kv/upstreams/webpages/172.26.0.2:80\\n  ```\\n\\n  \u5176\u4e2d\uff0c`/v1/kv/` \u540e\u7684\u8def\u5f84\u6309\u7167 `{Prefix}/{Service Name}/{IP}:{Port}` \u7684\u683c\u5f0f\u6784\u6210\u3002\\n  \\n  `{Prefix}` \u662f\u5728 APISIX \u4e2d\u914d\u7f6e Consul \u65f6\u5199\u5165\u7684 prefix\uff0c`{Service Name}` \u548c `{IP}:{Port}` \u5219\u9700\u8981\u6839\u636e\u4e0a\u6e38\u670d\u52a1\uff0c\u7531\u7528\u6237\u81ea\u884c\u786e\u5b9a\u3002\\n  \\n  \u800c\u6570\u636e\u7684\u683c\u5f0f\u5219\u4e3a `{\\"weight\\": <Num>, \\"max_fails\\": <Num>, \\"fail_timeout\\": <Num>}`\u3002\\n\\n10. \u67e5\u770b\u6d4b\u8bd5\u670d\u52a1\u662f\u5426\u6ce8\u518c\u6210\u529f\u3002\\n\\n  ```shell\\n  $ curl \\"http://127.0.0.1:8500/v1/kv/upstreams/webpages?keys\\"\\n  ```\\n\\n  \u8fd4\u56de\u6d88\u606f\u5982\u4e0b\u5219\u8868\u793a\u6ce8\u518c\u6210\u529f\u3002\\n\\n  ```shell\\n  [\\"upstreams/webpages/172.26.0.2:80\\",\\"upstreams/webpages/172.26.0.7:80\\"]%\\n  ```\\n\\n### \u521b\u5efa\u8def\u7531\u5e76\u4e3a\u5176\u542f\u7528 Consul\\n\\n\u4f7f\u7528 Apache APISIX \u63d0\u4f9b\u7684 Admin API \u5c06 Consul \u6dfb\u52a0\u5230\u8def\u7531\u4e2d\u3002\\n\\n\u5728\u6dfb\u52a0\u4e4b\u524d\u9700\u8981\u5148\u786e\u5b9a `X-API-KEY` \u548c `upstream.service_name` \u4e24\u4e2a\u6570\u636e\u3002\\n\\n- `X-API-KEY`\uff1aAdmin API \u7684\u8bbf\u95ee Token\uff0c\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u9ed8\u8ba4\u7684 `edd1c9f034335f136f87ad84b625c8f1` \u5373\u53ef\u3002\\n- `upstream.service_name`\uff1a\u4e0a\u6e38\u670d\u52a1\u7684\u540d\u79f0\uff0c\u5b83\u6307\u5b9a\u4e86\u5c06\u4e0e\u67d0\u4e2a\u8def\u7531\u7ed1\u5b9a\u7684\u67d0\u4e2a\u6ce8\u518c\u4e2d\u5fc3\u4e2d\u7684\u670d\u52a1\uff08Service\uff09\uff0c\u4f7f\u7528 Consul \u65f6\u9700\u8981\u8bbe\u7f6e\u4e3a\u6ce8\u518c\u6d4b\u8bd5\u670d\u52a1\u65f6\u7684 URL\uff0c\u5e76\u53bb\u6389\u6700\u540e\u7684 `{IP}:{Port}` \u90e8\u5206\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 Apache APISIX \u63d0\u4f9b\u7684 Memory Dump API \u83b7\u53d6\u670d\u52a1\u7684 URL\uff0c\u540c\u65f6\u786e\u8ba4\u662f\u5426\u80fd\u6b63\u5e38\u53d1\u73b0\u4e0a\u6e38\u670d\u52a1\u3002\\n\\n```shell\\n$ curl http://127.0.0.1:9092/v1/discovery/consul_kv/dump | jq\\n# \u8f93\u51fa\\n{\\n  \\"services\\": {\\n    # \u8fd9\u4e2a key \u5c31\u662f\u9700\u8981\u7684 URL\\n    \\"http://consul-server1:8500/v1/kv/upstreams/webpages/\\": [\\n      {\\n        \\"port\\": 80,\\n        \\"host\\": \\"172.26.0.7\\",\\n        \\"weight\\": 1\\n      },\\n      {\\n        \\"port\\": 80,\\n        \\"host\\": \\"172.26.0.2\\",\\n        \\"weight\\": 1\\n      }\\n    ]\\n  },\\n  \\"config\\": {\\n    # ...configs\\n  }\\n}\\n```\\n\\n### \u6dfb\u52a0\u8def\u7531\\n\\n\u8fd9\u91cc\u5c06 URL \u4e3a `/consul/*` \u7684\u8bf7\u6c42\u8def\u7531\u5206\u914d\u5230 `http://consul-server1:8500/v1/kv/upstreams/webpages/`\u3002\u540c\u65f6\uff0c `discovery_type` \u5fc5\u987b\u8bbe\u7f6e\u4e3a `consul_kv` \u4ee5\u542f\u52a8\u5bf9\u5e94\u6a21\u5757\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X POST -d \'\\n{\\n    \\"uri\\": \\"/consul/*\\",\\n    \\"upstream\\": {\\n        \\"service_name\\": \\"http://consul-server1:8500/v1/kv/upstreams/webpages/\\",\\n        \\"type\\": \\"roundrobin\\",\\n        \\"discovery_type\\": \\"consul_kv\\"\\n    }\\n}\'\\n```\\n\\n### \u6d4b\u8bd5\u914d\u7f6e\u7ed3\u679c\\n\\n\u901a\u8fc7\u8bf7\u6c42\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c Apache APISIX \u4e2d\u65b0\u589e\u7684\u8def\u7531\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7 Consul \u627e\u5230\u6b63\u786e\u7684\u670d\u52a1\u5730\u5740\uff0c\u5e76\u6839\u636e\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u8bf7\u6c42\u5230\u4e24\u4e2a\u8282\u70b9\u4e0a\u3002\\n\\n```shell\\n# \u7b2c\u4e00\u6b21\u8bf7\u6c42\\ncurl -s http://127.0.0.1:9080/consul/\\n# \u8f93\u51fa\\nhello web1%\\n\\n# \u7b2c\u4e8c\u6b21\u8bf7\u6c42\\ncurl -s http://127.0.0.1:9080/consul/\\n# \u8f93\u51fa\\nhello web2%\\n\\n# \u6ce8\u610f\uff1a\u4e5f\u6709\u53ef\u80fd\u4e24\u6b21\u8bf7\u6c42\u83b7\u53d6\u7684\u90fd\u662f web1 \u6216\u8005 web2\u3002\\n#      \u8fd9\u662f\u7531\u8d1f\u8f7d\u5747\u8861\u7684\u7279\u6027\u9020\u6210\u7684\uff0c\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u8fdb\u884c\u66f4\u591a\u6b21\u8bf7\u6c42\u3002\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u7684\u524d\u534a\u90e8\u5206\u4ecb\u7ecd\u4e86 Apache APISIX \u5982\u4f55\u914d\u5408 Consul \u5b9e\u73b0\u57fa\u4e8e Consul KV \u7684\u670d\u52a1\u53d1\u73b0\u6ce8\u518c\u4e2d\u5fc3\uff0c\u89e3\u51b3\u670d\u52a1\u4fe1\u606f\u7ba1\u7406\u7ef4\u62a4\u7684\u95ee\u9898\u3002\u800c\u5728\u540e\u534a\u90e8\u5206\u5219\u7740\u91cd\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 Docker \u4e2d\u642d\u914d Consul \u4f7f\u7528 Apache APISIX \u7684\u64cd\u4f5c\u6d41\u7a0b\u3002\u5f53\u7136\uff0c\u5728\u5b9e\u9645\u573a\u666f\u4e2d\u7684\u5e94\u7528\uff0c\u8fd8\u9700\u8981\u5404\u4f4d\u8bfb\u8005\u6839\u636e\u4e1a\u52a1\u4f7f\u7528\u573a\u666f\u548c\u5df2\u6709\u7684\u7cfb\u7edf\u67b6\u6784\u5177\u4f53\u5206\u6790\u3002\u5173\u4e8e\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Consul \u6ce8\u518c\u4e2d\u5fc3\u7684\u66f4\u591a\u8bf4\u660e\uff0c\u53ef\u4ee5\u5728[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/discovery/consul_kv/)\u4e2d\u627e\u5230\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41."},{"id":"\u5982\u4f55\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u7684 CSRF \u5b89\u5168\u63d2\u4ef6\u62e6\u622a\u8de8\u7ad9\u70b9\u4f2a\u9020\u653b\u51fb","metadata":{"permalink":"/zh/blog/2022/02/23/csrf-api-gateway","source":"@site/blog/2022/02/23/csrf-api-gateway.md","title":"\u5982\u4f55\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u7684 CSRF \u5b89\u5168\u63d2\u4ef6\u62e6\u622a\u8de8\u7ad9\u70b9\u4f2a\u9020\u653b\u51fb","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684 CSRF \u5b89\u5168\u63d2\u4ef6 `csrf`\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u5728 Apache APISIX \u4e2d\u501f\u52a9 `csrf` \u63d2\u4ef6\u6765\u4fdd\u62a4\u60a8\u7684 API \u4fe1\u606f\u5b89\u5168\u3002","date":"2022-02-23T00:00:00.000Z","formattedDate":"2022\u5e742\u670823\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":6.86,"truncated":true,"authors":[{"name":"\u66b4\u6e0a","title":"Author","url":"https://github.com/Baoyuantop","image_url":"https://github.com/Baoyuantop.png","imageURL":"https://github.com/Baoyuantop.png"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://github.com/yzeng25.png","imageURL":"https://github.com/yzeng25.png"}],"prevItem":{"title":"API \u7f51\u5173 Apache APISIX \u96c6\u6210 Consul KV\uff0c\u670d\u52a1\u53d1\u73b0\u80fd\u529b\u518d\u5347\u7ea7","permalink":"/zh/blog/2022/02/25/consul-api-gateway"},"nextItem":{"title":"Nacos \u5728 API \u7f51\u5173\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5b9e\u8df5","permalink":"/zh/blog/2022/02/21/nacos-api-gateway"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u7684 CSRF \u5b89\u5168\u63d2\u4ef6 `csrf`\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u5728 Apache APISIX \u4e2d\u501f\u52a9 `csrf` \u63d2\u4ef6\u6765\u4fdd\u62a4\u60a8\u7684 API \u4fe1\u606f\u5b89\u5168\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f5c\u4e3a API \u7f51\u5173\uff0cApache APISIX \u62e5\u6709\u591a\u79cd\u7c7b\u578b\u7684\u5b9e\u7528\u63d2\u4ef6\uff0c\u672c\u6587\u4ecb\u7ecd\u4e86 CSRF \u5b89\u5168\u63d2\u4ef6 `csrf`\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u5728 Apache APISIX \u4e2d\u501f\u52a9 `csrf` \u63d2\u4ef6\u6765\u4fdd\u62a4\u60a8\u7684 API \u4fe1\u606f\u5b89\u5168\u3002\\n\\nCSRF\uff08Cross-Site Request Forgery\uff09\uff0c\u5373\u8de8\u7ad9\u70b9\u8bf7\u6c42\u4f2a\u9020\u3002\u53d1\u8d77\u8de8\u7ad9\u70b9\u8bf7\u6c42\u4f2a\u9020\u653b\u51fb\u7684\u5173\u952e\u70b9\u5728\u4e8e\u8ba9\u76ee\u6807\u670d\u52a1\u5668\u65e0\u6cd5\u5206\u8fa8\u4f17\u591a\u8bf7\u6c42\u7684\u6765\u6e90\u662f\u771f\u5b9e\u7528\u6237\u8fd8\u662f\u653b\u51fb\u8005\u3002\u653b\u51fb\u7684\u4e00\u822c\u6d41\u7a0b\u4e3a\uff1a\u9996\u5148\u653b\u51fb\u8005\u4f1a\u8bf1\u5bfc\u7528\u6237\u5bfc\u822a\u81f3\u653b\u51fb\u8005\u63d0\u4f9b\u7684\u7f51\u9875\u4e0a\u3002\u8be5\u7f51\u9875\u5305\u542b\u4e00\u4e2a\u81ea\u52a8\u53d1\u9001\u5230\u76ee\u6807\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u3002\u7136\u540e\u8be5\u7f51\u9875\u6b63\u5e38\u52a0\u8f7d\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u5c31\u4f1a\u81ea\u52a8\u53d1\u9001\u81f3\u670d\u52a1\u5668\u3002\u5728\u670d\u52a1\u5668\u770b\u6765\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u548c\u7528\u6237\u6b63\u5e38\u53d1\u9001\u7684\u8bf7\u6c42\u4e00\u6a21\u4e00\u6837\uff0c\u6b8a\u4e0d\u77e5\u8fd9\u662f\u7531\u653b\u51fb\u8005\u53d1\u8d77\uff0c\u800c\u7528\u6237\u5374\u6beb\u4e0d\u77e5\u60c5\u3002\u7531\u4e8e\u8be5\u8bf7\u6c42\u643a\u5e26\u4e86\u7528\u6237\u7684\u4e00\u4e9b\u51ed\u636e\uff0c\u653b\u51fb\u8005\u901a\u8fc7\u89e3\u6790\u8fd9\u4e9b\u51ed\u636e\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u8fdb\u800c\u4ea7\u751f\u5b89\u5168\u98ce\u9669\u3002\\n\\n## \u63d2\u4ef6\u4ecb\u7ecd\\n\\n`csrf` \u63d2\u4ef6\u57fa\u4e8e `Double Submit Cookie` \u65b9\u6848\u5b9e\u73b0\u3002\u6839\u636e [RFC 7231#section-4.2.1](https://datatracker.ietf.org/doc/html/rfc7231.html#section-4.2.1) \u7684\u5b9a\u4e49\uff0c\u6211\u4eec\u628a `GET`\u3001`HEAD` \u548c `OPTIONS` \u8fd9\u4e09\u79cd\u65b9\u6cd5\u79f0\u4e3a\u5b89\u5168\u65b9\u6cd5\u3002\u6309\u7167\u8fd9\u4e00\u7ea6\u5b9a\uff0c`csrf` \u63d2\u4ef6\u4f1a\u76f4\u63a5\u653e\u884c\u8fd9\u4e09\u79cd\u65b9\u6cd5\uff0c\u4f46\u4f1a\u5bf9\u5176\u4ed6\u7684\u65b9\u6cd5\u505a\u68c0\u67e5\u5e76\u62e6\u622a\u5176\u4e2d\u7684\u4e0d\u5b89\u5168\u8bf7\u6c42\u3002\\n\\n\u4e3a\u4e86\u62b5\u5fa1 CSRF \u653b\u51fb\uff0c\u6211\u4eec\u9700\u8981\u5236\u9020\u4e00\u4e2a\u65e0\u6cd5\u4f2a\u9020\u7684\u4ee4\u724c\u6216\u6807\u8bc6\u7b26\uff0c\u5e76\u4e14\u4fdd\u8bc1\u8fd9\u4e2a\u4e0d\u4f1a\u4e0e\u653b\u51fb\u8005\u7684\u8bf7\u6c42\u4e00\u8d77\u53d1\u9001\u3002\u7528\u6237\u9700\u8981\u5c06 `csrf` \u63d2\u4ef6\u4f9d\u8d56\u7684 token \u643a\u5e26\u5728\u8bf7\u6c42\u5934\uff0ctoken \u4f7f\u7528\u5bc6\u94a5\u8fdb\u884c\u7b7e\u540d\u8ba1\u7b97\u3002\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86 token \u65e0\u6cd5\u88ab\u4ed6\u4eba\u4f2a\u9020\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86 API \u7684\u5b89\u5168\u3002\\n\\n![\u63d2\u4ef6\u5de5\u4f5c\u6d41\u7a0b](https://static.apiseven.com/202108/1645605178661-7c0bc3bc-9792-43fd-b3f6-b01c0f6b24db.png)\\n\\n\u5728\u8def\u7531\u4e2d\u5f00\u542f `csrf` \u63d2\u4ef6\u540e\uff0c\u8bbf\u95ee\u8be5\u8def\u7531\u7684\u6240\u6709\u8bf7\u6c42\u54cd\u5e94\u4e2d\u90fd\u4f1a\u5305\u542b\u643a\u5e26\u4e86 `csrf token` \u7684 Cookie\u3002\\n\\n\u7528\u6237\u9700\u8981\u5728\u5bf9\u8be5\u8def\u7531\u7684\u4e0d\u5b89\u5168\u8bf7\u6c42\u4e2d\u643a\u5e26\u8fd9\u4e00 Cookie\uff0c\u5e76\u5728\u8bf7\u6c42\u5934\u6dfb\u52a0\u989d\u5916\u7684\u5b57\u6bb5\u7528\u6765\u643a\u5e26 Cookie \u7684\u5185\u5bb9\u3002\u5b57\u6bb5\u4e3a\u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 `name` \u503c\uff0c\u8fd9\u6837\u7684\u8bf7\u6c42\u624d\u80fd\u901a\u8fc7 CSRF \u63d2\u4ef6\u7684\u6821\u9a8c\u3002\\n\\n\u7528\u6237\u5728\u63d2\u4ef6\u7684\u914d\u7f6e\u4e2d\u63d0\u4f9b\u4e00\u4e2a\u968f\u673a\u5bc6\u94a5\uff0c\u63d2\u4ef6\u4f7f\u7528\u8be5\u5bc6\u94a5\u5bf9 token \u4fe1\u606f\u8fdb\u884c sha256 \u54c8\u5e0c\u52a0\u5bc6\uff0c\u7136\u540e\u751f\u6210  CSRF token\uff0c\u4ece\u800c\u4fdd\u8bc1\u8be5 token \u4e0d\u53ef\u4f2a\u9020\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u914d\u7f6e\u5f00\u542f CSRF \u63d2\u4ef6\u7684\u8def\u7531\\n\\n\u5728 APISIX \u4e2d\u4f7f\u7528 Admin API \u521b\u5efa\u4e00\u6761\u8def\u7531\u5e76\u542f\u7528 `csrf` \u63d2\u4ef6\uff1a\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n  \\"uri\\": \\"/hello\\",\\n  \\"plugins\\": {\\n    \\"csrf\\": {\\n      \\"key\\": \\"edd1c9f034335f136f87ad84b625c8f1\\"\\n    }\\n  },\\n  \\"upstream\\": {\\n    \\"type\\": \\"roundrobin\\",\\n    \\"nodes\\": {\\n      \\"127.0.0.1:9001\\": 1\\n    }\\n  }\\n}\'\\n```\\n\\n\u5176\u4e2d\u5bf9\u4e8e\u63d2\u4ef6\u6709\u4e09\u4e2a\u914d\u7f6e\u9879\uff1a\\n\\n- `key`\uff1a\u5fc5\u586b\u9879\uff0c\u968f\u673a\u79d8\u94a5\u7684\u503c\u3002\u7528\u6237\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u968f\u673a\u5bc6\u94a5\u3002\\n- `expires`\uff1a\u9009\u586b\u9879\uff0c\u968f\u673a\u79d8\u94a5\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u9ed8\u8ba4\u503c\u4e3a 7200 \u79d2\u3002\u7531\u4e8e CSRF token \u4f7f\u7528 Cookie \u4e0b\u53d1\u81f3\u5ba2\u6237\u7aef\uff0c\u8be5\u914d\u7f6e\u4f1a\u88ab\u653e\u7f6e\u5728 Cookie \u7684\u914d\u7f6e\u4e2d\uff0c\u4ece\u800c\u63a7\u5236 Cookie \u7684\u8fc7\u671f\u65f6\u95f4\u3002\u53e6\u5916\u5728\u63d2\u4ef6\u5185\u90e8\u4e5f\u4f1a\u8ba1\u7b97\u65f6\u95f4\u6765\u5224\u65ad token \u662f\u5426\u8fc7\u671f\u3002\\n- `name`\uff1a\u9009\u586b\u9879\uff0c CSRF token \u7684\u540d\u79f0\uff0c\u9ed8\u8ba4\u503c\u4e3a `apisix-csrf-token`\u3002\\n\\n### \u53d1\u9001\u8bf7\u6c42\u6d4b\u8bd5\\n\\n\u9996\u5148\u4f7f\u7528 `POST` \u8bf7\u6c42\u8bbf\u95ee\u8be5\u8def\u7531\uff1a\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/hello -X POST\\n```\\n\\nApache APISIX \u4f1a\u62e6\u622a\u8be5\u8bf7\u6c42\u5e76\u8fd4\u56de `401` \u9519\u8bef\u3002\u5728\u8fd4\u56de\u7684\u5934\u90e8\u4e2d\u4f1a\u53d1\u73b0\u8bbe\u7f6e\u4e86\u4e00\u4e2a Cookie\uff0c\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u63d2\u4ef6\u7684 `name` \u5b57\u6bb5\u7684\u8bdd\uff0cCookie \u5185\u90e8\u5e94\u8be5\u4e3a\u9ed8\u8ba4\u503c `apisix-csrf-token=....` \u3002\u8fd9\u5c31\u662f CSRF \u63d2\u4ef6\u751f\u6210\u7684 CSRF token\u3002\u5728\u8bf7\u6c42\u4e2d\uff0c\u9700\u8981\u786e\u4fdd\u8bf7\u6c42\u643a\u5e26\u8be5 Cookie \u5e76\u4e14\u5728\u8bf7\u6c42\u5934\u5199\u5165\u8be5 token\u3002\\n\\n```shell\\nHTTP/1.1 401 Unauthorized\\nSet-Cookie: apisix-csrf-token= ${apisix-csrf-token};path=/;Expires=Mon, 13-Dec-21 09:33:55 GMT\\n{\\"error_msg\\":\\"no csrf token in headers\\"}\\n```\\n\\n\u5ba2\u6237\u7aef\u4f7f\u7528 JavaScript \u793a\u4f8b\uff1a\u4f7f\u7528 `js-cookie` \u8bfb\u53d6 Cookie \u5e76\u4f7f\u7528 `axios` \u53d1\u9001\u8bf7\u6c42\u3002\\n\\n```js\\nconst token = Cookie.get(\'apisix-csrf-token\');\\n\\nconst instance = axios.create({\\n  headers: {\'apisix-csrf-token\': token}\\n});\\n```\\n\\n\u5982\u679c Cookie \u4e2d\u7684 token \u548c\u8bf7\u6c42\u5934\u4e2d\u7684 token \u4e0d\u4e00\u81f4\uff0c\u8bf7\u6c42\u4f1a\u88ab `csrf` \u63d2\u4ef6\u62e6\u622a\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/hello -X POST -H \'apisix-csrf-token: ${apisix-csrf-token}\' -b \'apisix-csrf-token= ${apisix-csrf-token}\'\\n```\\n\\n```shell\\nHTTP/1.1 401 Unauthorized\\nSet-Cookie: apisix-csrf-token= ${apisix-csrf-token};path=/;Expires=Mon, 13-Dec-21 09:33:55 GMT\\n{\\"error_msg\\":\\"csrf token mismatch\\"}\\n```\\n\\n\u6700\u540e\u4f7f\u7528 `curl` \u9a8c\u8bc1\u6b63\u5e38\u7684\u8bbf\u95ee\uff1a\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/hello -X POST -H \'apisix-csrf-token: ${apisix-csrf-token}\' -b \'apisix-csrf-token= ${apisix-csrf-token}\'\\n```\\n\\n```shell\\nHTTP/1.1 200 OK\\n```\\n\\n\u63d2\u4ef6\u5728\u5185\u90e8\u9700\u8981\u6821\u9a8c Cookie \u4e2d\u7684 token \u4e0e \u8bf7\u6c42\u5934\u4e2d\u643a\u5e26 token \u7684\u662f\u5426\u4e00\u81f4\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u91cd\u65b0\u8ba1\u7b97\u7b7e\u540d\u6765\u9a8c\u8bc1\u8be5 token \u662f\u5426\u6709\u6548\u3002\\n\\n### \u7981\u7528\u63d2\u4ef6\\n\\n\u79fb\u9664 `csrf` \u63d2\u4ef6\u7684\u76f8\u5173\u914d\u7f6e\u4fe1\u606f\uff0c\u7136\u540e\u53d1\u9001\u4e00\u4e2a\u66f4\u65b0\u8def\u7531\u7684\u8bf7\u6c42\uff0c\u5373\u53ef\u505c\u7528\u8be5\u63d2\u4ef6\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n  \\"uri\\": \\"/hello\\",\\n  \\"upstream\\": {\\n    \\"type\\": \\"roundrobin\\",\\n    \\"nodes\\": {\\n      \\"127.0.0.1:1980\\": 1\\n    }\\n  }\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u8be6\u7ec6\u63cf\u8ff0\u4e86 `csrf` \u63d2\u4ef6\u7684\u5de5\u4f5c\u65b9\u5f0f\u4ee5\u53ca\u4f7f\u7528\u65b9\u6cd5\uff0c\u5e0c\u671b\u901a\u8fc7\u672c\u6587\u53ef\u4ee5\u8ba9\u5927\u5bb6\u5bf9\u5728 Apache APISIX \u4e2d\u4f7f\u7528\u63d2\u4ef6\u62e6\u622a CSRF \u653b\u51fb\u6709\u66f4\u6e05\u6670\u7684\u8ba4\u8bc6\uff0c\u65b9\u4fbf\u5728\u5b9e\u9645\u573a\u666f\u4e2d\u5e94\u7528\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41."},{"id":"Nacos \u5728 API \u7f51\u5173\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/02/21/nacos-api-gateway","source":"@site/blog/2022/02/21/nacos-api-gateway.md","title":"Nacos \u5728 API \u7f51\u5173\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5b9e\u8df5","description":"\u672c\u6587\u4e3a\u4f60\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u57fa\u672c\u6982\u5ff5\u4ee5\u53ca\u6ce8\u518c\u4e2d\u5fc3\u7684\u4f5c\u7528\uff0c\u5e76\u4e3a\u60a8\u5c55\u793a\u4e86 APISIX \u57fa\u4e8e Nacos \u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u7684\u5177\u4f53\u64cd\u4f5c\u3002","date":"2022-02-21T00:00:00.000Z","formattedDate":"2022\u5e742\u670821\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.33,"truncated":true,"authors":[{"name":"\u6797\u5fd7\u714c","title":"Author","url":"https://github.com/oil-oil","image_url":"https://avatars.githubusercontent.com/u/57465570?v=4","imageURL":"https://avatars.githubusercontent.com/u/57465570?v=4"},{"name":"\u97e9\u98de","title":"Technical Writer","url":"https://github.com/hf400159","image_url":"https://avatars.githubusercontent.com/u/97138894?v=4","imageURL":"https://avatars.githubusercontent.com/u/97138894?v=4"}],"prevItem":{"title":"\u5982\u4f55\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u7684 CSRF \u5b89\u5168\u63d2\u4ef6\u62e6\u622a\u8de8\u7ad9\u70b9\u4f2a\u9020\u653b\u51fb","permalink":"/zh/blog/2022/02/23/csrf-api-gateway"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff5c2.1-2.14 \u529f\u80fd\u4eae\u70b9\u66f4\u65b0\u8fdb\u884c\u4e2d","permalink":"/zh/blog/2022/02/17/weekly-report-0214"}},"content":"> \u672c\u6587\u4e3a\u60a8\u4ecb\u7ecd Apache APISIX \u57fa\u672c\u6982\u5ff5\u4ee5\u53ca\u6ce8\u518c\u4e2d\u5fc3\u7684\u4f5c\u7528\uff0c\u5e76\u4e3a\u60a8\u5c55\u793a\u4e86 API \u7f51\u5173\u57fa\u4e8e Nacos \u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u7684\u5177\u4f53\u64cd\u4f5c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4fe1\u606f\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u5b83\u4e0d\u4ec5\u62e5\u6709\u4f17\u591a\u5b9e\u7528\u7684\u63d2\u4ef6\uff0c\u800c\u4e14\u652f\u6301\u63d2\u4ef6\u52a8\u6001\u53d8\u66f4\u548c\u70ed\u63d2\u62d4\u3002\u540c\u65f6\u5728\u4f7f\u7528\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u65f6\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5229\u7528 etcd\uff0c\u4e5f\u53ef\u4ee5\u5c06 Eureka\u3001Consul \u548c Nacos \u4f5c\u4e3a\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u3002\u672c\u6587\u5c06\u8be6\u7ec6\u4e3a\u60a8\u4ecb\u7ecd\u5982\u4f55\u5728 Apache APISIX \u4e2d\u914d\u7f6e Nacos \u4f5c\u4e3a Apache APISIX API \u7f51\u5173\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u7ec4\u4ef6\u3002\\n\\n![error/Apache APISIX API Getway.png](https://static.apiseven.com/202108/1646038041730-3d9bfdd8-d2f0-41a2-84f5-cb1e1d567a86.png)\\n\\n\u6ce8\u518c\u4e2d\u5fc3\u662f\u670d\u52a1\u8981\u5b9e\u73b0\u670d\u52a1\u5316\u7ba1\u7406\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u7c7b\u4f3c\u4e8e\u76ee\u5f55\u670d\u52a1\u7684\u4f5c\u7528\uff0c\u4e5f\u662f\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u6700\u57fa\u7840\u7684\u8bbe\u65bd\u4e4b\u4e00\uff0c\u4e3b\u8981\u7528\u6765\u5b58\u50a8\u670d\u52a1\u4fe1\u606f\uff0c\u8b6c\u5982\u670d\u52a1\u63d0\u4f9b\u8005 URL \u3001\u8def\u7531\u4fe1\u606f\u7b49\u3002\u6ce8\u518c\u4e2d\u5fc3\u7684\u5b9e\u73b0\u662f\u901a\u8fc7\u4e00\u79cd\u6620\u5c04\u7684\u65b9\u5f0f\uff0c\u5c06\u590d\u6742\u7684\u670d\u52a1\u7aef\u4fe1\u606f\u6620\u5c04\u4e3a\u7b80\u5355\u6613\u61c2\u7684\u4fe1\u606f\u63d0\u4f9b\u7ed9\u5ba2\u6237\u7aef\u3002\\n\\n\u6ce8\u518c\u4e2d\u5fc3\u7684\u6838\u5fc3\u529f\u80fd\u4e3a\u4ee5\u4e0b\u4e09\u70b9\uff1a\\n\\n- \u670d\u52a1\u6ce8\u518c\uff1a**\u670d\u52a1\u63d0\u4f9b\u65b9**\u5411**\u6ce8\u518c\u4e2d\u5fc3**\u8fdb\u884c\u6ce8\u518c\u3002\\n- \u670d\u52a1\u53d1\u73b0\uff1a**\u670d\u52a1\u6d88\u8d39\u65b9**\u53ef\u4ee5\u901a\u8fc7\u6ce8\u518c\u4e2d\u5fc3\u5bfb\u627e\u5230\u670d\u52a1\u63d0\u4f9b\u65b9\u7684\u8c03\u7528\u8def\u7531\u4fe1\u606f\u3002\\n- \u5065\u5eb7\u68c0\u6d4b\uff1a\u786e\u4fdd\u6ce8\u518c\u5230\u6ce8\u518c\u4e2d\u5fc3\u7684\u670d\u52a1\u8282\u70b9\u662f\u53ef\u4ee5\u88ab\u6b63\u5e38\u8c03\u7528\u7684\uff0c\u907f\u514d\u65e0\u6548\u8282\u70b9\u5bfc\u81f4\u7684\u8c03\u7528\u8d44\u6e90\u6d6a\u8d39\u7b49\u95ee\u9898\u3002\\n\\n\u6ce8\u518c\u4e2d\u5fc3\u672c\u8d28\u4e0a\u662f\u4e3a\u4e86**\u89e3\u8026\u670d\u52a1\u63d0\u4f9b\u8005\u548c\u670d\u52a1\u6d88\u8d39\u8005**\uff0c\u5728\u5fae\u670d\u52a1\u4f53\u7cfb\u4e2d\uff0c\u5404\u4e2a\u4e1a\u52a1\u670d\u52a1\u4e4b\u95f4\u4f1a\u9891\u7e41\u4e92\u76f8\u8c03\u7528\uff0c\u5e76\u4e14\u9700\u8981\u5bf9\u5404\u4e2a\u670d\u52a1\u7684 IP\u3001port \u7b49\u8def\u7531\u4fe1\u606f\u8fdb\u884c\u7edf\u4e00\u7684\u7ba1\u7406\u3002\u4f46\u662f\u8981\u5982\u4f55\u8fdb\u884c\u7ba1\u7406\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6ce8\u518c\u4e2d\u5fc3\u7684**\u670d\u52a1\u6ce8\u518c**\u529f\u80fd\u5c06\u5df2\u6709\u670d\u52a1\u7684\u76f8\u5173\u4fe1\u606f\u63d0\u4f9b\u5230\u7edf\u4e00\u7684\u6ce8\u518c\u4e2d\u5fc3\u8fdb\u884c\u7ba1\u7406\u3002\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u63cf\u8ff0\uff0c\u60a8\u53ef\u4ee5\u4e86\u89e3\u5230\u6ce8\u518c\u4e2d\u5fc3\u53ef\u4ee5\u5e2e\u52a9\u7528\u6237\u901a\u8fc7\u6620\u5c04\u5feb\u901f\u627e\u5230\u670d\u52a1\u548c\u670d\u52a1\u5730\u5740\u3002\u968f\u7740\u4e1a\u52a1\u66f4\u65b0\u8fed\u4ee3\uff0c\u670d\u52a1\u4f1a\u9891\u7e41\u53d1\u751f\u53d8\u5316\uff0c\u5728\u670d\u52a1\u7aef\u4e2d\u6ce8\u518c\u4e86\u65b0\u7684\u670d\u52a1\u6216\u8005\u670d\u52a1\u5b95\u673a\u540e\uff0c\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7\u6ce8\u518c\u4e2d\u5fc3\u7684**\u670d\u52a1\u53d1\u73b0**\u529f\u80fd\u62c9\u53d6\u670d\u52a1\u5217\u8868\uff0c\u5982\u679c\u6ce8\u518c\u4e2d\u5fc3\u7684\u670d\u52a1\u8282\u70b9\u53d1\u751f\u53d8\u66f4\uff0c\u6ce8\u518c\u4e2d\u5fc3\u4f1a\u53d1\u9001\u8bf7\u6c42\u901a\u77e5\u5ba2\u6237\u7aef\u91cd\u65b0\u62c9\u53d6\u3002\\n\\n\u5982\u679c\u670d\u52a1\u7aef\u7684\u670d\u52a1\u7a81\u7136\u5b95\u673a\uff0c\u5e76\u4e14\u6ca1\u6709\u5411\u6ce8\u518c\u4e2d\u5fc3\u53cd\u9988\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7\u6ce8\u518c\u4e2d\u5fc3\u7684**\u5065\u5eb7\u68c0\u67e5**\u529f\u80fd\uff0c\u8fdb\u884c\u56fa\u5b9a\u65f6\u95f4\u95f4\u9694\u7684\u4e3b\u52a8\u4e0a\u62a5\u5fc3\u8df3\u65b9\u5f0f\u5411\u670d\u52a1\u7aef\u8868\u660e\u81ea\u5df1\u7684\u670d\u52a1\u72b6\u6001\u3002\u5982\u679c\u670d\u52a1\u72b6\u6001\u5f02\u5e38\uff0c\u5219\u4f1a\u901a\u77e5\u6ce8\u518c\u4e2d\u5fc3\uff0c\u6ce8\u518c\u4e2d\u5fc3\u53ef\u4ee5\u53ca\u65f6\u628a\u5df2\u7ecf\u5b95\u673a\u7684\u670d\u52a1\u8282\u70b9\u8fdb\u884c\u5254\u9664\uff0c\u907f\u514d\u8d44\u6e90\u7684\u6d6a\u8d39\u3002\\n\\nApache APISIX + Nacos \u53ef\u4ee5\u5c06\u5404\u4e2a\u5fae\u670d\u52a1\u8282\u70b9\u4e2d\u4e0e\u4e1a\u52a1\u65e0\u5173\u7684\u5404\u9879\u63a7\u5236\uff0c\u96c6\u4e2d\u5728 Apache APISIX \u4e2d\u8fdb\u884c\u7edf\u4e00\u7ba1\u7406\uff0c\u5373**\u901a\u8fc7 Apache APISIX \u5b9e\u73b0\u63a5\u53e3\u670d\u52a1\u7684\u4ee3\u7406\u548c\u8def\u7531\u8f6c\u53d1\u7684\u80fd\u529b**\u3002\u5728 Nacos \u4e0a\u6ce8\u518c\u5404\u4e2a\u5fae\u670d\u52a1\u540e\uff0cApache APISIX \u53ef\u4ee5\u901a\u8fc7 Nacos \u7684\u670d\u52a1\u53d1\u73b0\u529f\u80fd\u83b7\u53d6\u670d\u52a1\u5217\u8868\uff0c\u67e5\u627e\u5bf9\u5e94\u7684\u670d\u52a1\u5730\u5740\u4ece\u800c\u5b9e\u73b0\u52a8\u6001\u4ee3\u7406\u3002\\n\\n![error/Principle Introduction.png](https://static.apiseven.com/202108/1645433492822-5218e923-97ae-4d04-863b-3b3f901de84f.png)\\n\\n## API \u7f51\u5173\u57fa\u4e8e Nacos \u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\\n\\n### \u524d\u63d0\u6761\u4ef6\\n\\n\u672c\u6587\u64cd\u4f5c\u57fa\u4e8e\u4ee5\u4e0b\u73af\u5883\u8fdb\u884c\u3002\\n\\n- \u64cd\u4f5c\u7cfb\u7edf Centos 7.9\u3002\\n- \u5df2\u5b89\u88c5 Apache APISIX 2.12.1\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[\u5982\u4f55\u6784\u5efa Apache APISIX](https://apisix.apache.org/zh/docs/apisix/how-to-build)\u3002\\n- \u5df2\u5b89\u88c5 Nacos 2.0.4\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[Nacos \u5feb\u901f\u5165\u95e8](https://nacos.io/zh-cn/docs/quick-start.html)\u3002\\n- \u5df2\u5b89\u88c5 Node.js\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[Node.js \u5b89\u88c5\u6307\u5357](https://github.com/nodejs/help/wiki/Installation)\u3002\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u670d\u52a1\u6ce8\u518c\\n\\n1. \u4f7f\u7528 Node.js \u7684 Koa \u6846\u67b6\u5728 `3005` \u7aef\u53e3\u542f\u52a8\u4e00\u4e2a\u7b80\u5355\u7684\u6d4b\u8bd5\u670d\u52a1\u4f5c\u4e3a[\u4e0a\u6e38\uff08Upstream\uff09](https://apisix.apache.org/zh/docs/apisix/admin-api#upstream)\u3002\\n\\n  ```JavaScript\\n  const Koa = require(\'koa\');\\n  const app = new Koa();\\n\\n  app.use(async ctx => {\\n    ctx.body = \'Hello World\';\\n  });\\n\\n  app.listen(3005);\\n  ```\\n\\n2. \u5728\u547d\u4ee4\u884c\u4e2d\u901a\u8fc7\u8bf7\u6c42 Nacos Open API \u7684\u65b9\u5f0f\u8fdb\u884c\u670d\u52a1\u6ce8\u518c\u3002\\n\\n  ```Shell\\n  curl -X POST \'http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=APISIX-NACOS&ip=127.0.0.1&port=3005&ephemeral=false\'\\n  ```\\n\\n3. \u6267\u884c\u670d\u52a1\u6ce8\u518c\u540e\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u8be2\u5f53\u524d\u670d\u52a1\u60c5\u51b5\u3002\\n\\n  ```Shell\\n  curl -X GET \'http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=APISIX-NACOS\'\\n  ```\\n\\n\u6b63\u786e\u8fd4\u56de\u7ed3\u679c\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n  ```JSON\\n  {\\n    \\"name\\": \\"DEFAULT_GROUP@@APISIX-NACOS\\",\\n    \\"groupName\\": \\"DEFAULT_GROUP\\",\\n    \\"clusters\\": \\"\\",\\n    \\"cacheMillis\\": 10000,\\n    \\"hosts\\": [\\n      {\\n        \\"instanceId\\": \\"127.0.0.1#3005#DEFAULT#DEFAULT_GROUP@@APISIX-NACOS\\",\\n        \\"ip\\": \\"127.0.0.1\\",\\n        \\"port\\": 3005,\\n        \\"weight\\": 1.0,\\n        \\"healthy\\": true,\\n        \\"enabled\\": true,\\n        \\"ephemeral\\": true,\\n        \\"clusterName\\": \\"DEFAULT\\",\\n        \\"serviceName\\": \\"DEFAULT_GROUP@@APISIX-NACOS\\",\\n        \\"metadata\\": {},\\n        \\"instanceHeartBeatInterval\\": 5000,\\n        \\"instanceHeartBeatTimeOut\\": 15000,\\n        \\"ipDeleteTimeout\\": 30000,\\n        \\"instanceIdGenerator\\": \\"simple\\"\\n      }\\n    ],\\n    \\"lastRefTime\\": 1643191399694,\\n    \\"checksum\\": \\"\\",\\n    \\"allIPs\\": false,\\n    \\"reachProtectionThreshold\\": false,\\n    \\"valid\\": true\\n  }\\n  ```\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u65b0\u589e Nacos \u8def\u7531\\n\\n\u4f7f\u7528 Apache APISIX \u63d0\u4f9b\u7684 Admin API \u521b\u5efa\u4e00\u4e2a\u65b0\u7684[\u8def\u7531\uff08Route\uff09](https://apisix.apache.org/zh/docs/apisix/admin-api#route)\uff0cAPISIX \u901a\u8fc7 `upstream.discovery_type` \u5b57\u6bb5\u9009\u62e9\u4f7f\u7528\u7684\u670d\u52a1\u53d1\u73b0\u7c7b\u578b\uff0c`upstream.service_name` \u9700\u8981\u4e0e\u6ce8\u518c\u4e2d\u5fc3\u7684\u5bf9\u5e94\u670d\u52a1\u540d\u8fdb\u884c\u5173\u8054\uff0c\u56e0\u6b64\u521b\u5efa\u8def\u7531\u65f6\u6307\u5b9a\u670d\u52a1\u53d1\u73b0\u7c7b\u578b\u4e3a `nacos`\u3002\\n\\n  ```Shell\\n  curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -i -d \'\\n  {\\n      \\"uri\\": \\"/nacos/*\\",\\n      \\"upstream\\": {\\n          \\"service_name\\": \\"APISIX-NACOS\\",\\n          \\"type\\": \\"roundrobin\\",\\n          \\"discovery_type\\": \\"nacos\\"\\n      }\\n  }\'\\n  ```\\n\\n\u5728\u4e0a\u8ff0\u547d\u4ee4\u4e2d\uff0c\u8bf7\u6c42\u5934 `X-API-KEY` \u662f Admin API \u7684\u8bbf\u95ee token\uff0c\u53ef\u4ee5\u5728 `conf/config.yaml` \u6587\u4ef6\u4e2d\u7684 `apisix.admin_key.key` \u67e5\u770b\u3002\\n\\n\u6dfb\u52a0\u6210\u529f\u540e\uff0c\u6b63\u786e\u8fd4\u56de\u7ed3\u679c\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n  ```JSON\\n  {\\n    \\"action\\": \\"set\\",\\n    \\"node\\": {\\n      \\"key\\": \\"\\\\/apisix\\\\/routes\\\\/1\\",\\n      \\"value\\": {\\n        \\"update_time\\": 1643191044,\\n        \\"create_time\\": 1643176603,\\n        \\"priority\\": 0,\\n        \\"uri\\": \\"\\\\/nacos\\\\/*\\",\\n        \\"upstream\\": {\\n          \\"hash_on\\": \\"vars\\",\\n          \\"discovery_type\\": \\"nacos\\",\\n          \\"scheme\\": \\"http\\",\\n          \\"pass_host\\": \\"pass\\",\\n          \\"type\\": \\"roundrobin\\",\\n          \\"service_name\\": \\"APISIX-NACOS\\"\\n        },\\n        \\"id\\": \\"1\\",\\n        \\"status\\": 1\\n      }\\n    }\\n  }\\n  ```\\n\\n\u9664\u6b64\u4e4b\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u5728 `upstream.discovery_args` \u4e2d\u4f20\u9012\u5176\u4ed6\u670d\u52a1\u76f8\u5173\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u670d\u52a1\u6240\u5728\u7684\u547d\u540d\u7a7a\u95f4\u6216\u7ec4\u522b\uff0c\u5177\u4f53\u5185\u5bb9\u53ef\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/next/discovery/nacos/#%E5%8F%82%E6%95%B0)\u3002\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u9a8c\u8bc1\u914d\u7f6e\u7ed3\u679c\\n\\n\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u53d1\u9001\u8bf7\u6c42\u81f3\u9700\u8981\u914d\u7f6e\u7684\u8def\u7531\u3002\\n\\n  ```Shell\\n  curl -i http://127.0.0.1:9080/nacos/\\n  ```\\n\\n\u6b63\u5e38\u8fd4\u56de\u7ed3\u679c\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n  ```Shell\\n  HTTP/1.1 200 OK\\n  Content-Type: text/plain; charset=utf-8\\n  Content-Length: 11\\n  Connection: keep-alive\\n  Date: Thu, 27 Jan 2022 00:48:26 GMT\\n  Server: APISIX/2.12.0\\n\\n  Hello World\\n  ```\\n\\n\u901a\u8fc7\u793a\u4f8b\u770b\u5230\uff0cApache APISIX \u4e2d\u65b0\u589e\u7684\u8def\u7531\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7 Nacos \u670d\u52a1\u53d1\u73b0\u627e\u5230\u6b63\u786e\u7684\u670d\u52a1\u5730\u5740\uff0c\u5e76\u6b63\u5e38\u54cd\u5e94\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u6ce8\u518c\u4e2d\u5fc3\u7684\u6982\u5ff5\u4ee5\u53ca Apache APISIX \u5982\u4f55\u914d\u5408 Nacos \u5b9e\u73b0\u57fa\u4e8e\u670d\u52a1\u53d1\u73b0\u7684\u8def\u7531\u4ee3\u7406\u3002\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u7684\u4e1a\u52a1\u9700\u6c42\u548c\u8fc7\u5f80\u6280\u672f\u67b6\u6784\u4f7f\u7528 Apache APISIX \u4e0e Nacos\uff0c\u4ee5\u5b9e\u73b0\u63a5\u53e3\u670d\u52a1\u7684\u4ee3\u7406\u548c\u8def\u7531\u8f6c\u53d1\u7684\u80fd\u529b\u3002\\n\\n\u5173\u4e8e `nacos` \u63d2\u4ef6\u7684\u66f4\u591a\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u4fe1\u606f\uff0c\u53ef\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/discovery/nacos)\u3002\\n\\nApache APISIX \u9879\u76ee\u76ee\u524d\u6b63\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u6709\u5174\u8da3\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41."},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff5c2.1-2.14 \u529f\u80fd\u4eae\u70b9\u66f4\u65b0\u8fdb\u884c\u4e2d","metadata":{"permalink":"/zh/blog/2022/02/17/weekly-report-0214","source":"@site/blog/2022/02/17/weekly-report-0214.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff5c2.1-2.14 \u529f\u80fd\u4eae\u70b9\u66f4\u65b0\u8fdb\u884c\u4e2d","description":"API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86 csrf\u3001file-logger\u3001public-api\u3001opentelemetry\u3001loggly \u7b49\u63d2\u4ef6\uff0c\u5e76\u4e14\u4e5f\u652f\u6301\u8bb0\u5f55 apisix_latency \u548c upstream_latency\u3002","date":"2022-02-17T00:00:00.000Z","formattedDate":"2022\u5e742\u670817\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.82,"truncated":true,"authors":[],"prevItem":{"title":"Nacos \u5728 API \u7f51\u5173\u4e2d\u7684\u670d\u52a1\u53d1\u73b0\u5b9e\u8df5","permalink":"/zh/blog/2022/02/21/nacos-api-gateway"},"nextItem":{"title":"\u540e\u7aef\u65b0\u624b\u5982\u4f55\u4ece 0 \u5230 1 \u5728 API \u7f51\u5173\u4e0a\u5f00\u53d1 APISIX \u63d2\u4ef6","permalink":"/zh/blog/2022/02/16/file-logger-api-gateway"}},"content":"> \u4ece 2.1 \u5230 2.14, \u6709 25 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 55 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1644998110046-9b57e72b-95e0-4288-978a-2d8db16f11c8.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1644998110070-5b7b0085-0673-455d-adaa-727dc9e8a1ed.png)\\n\\n## Good first issue\\n\\n### Issue #6197\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/6197\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u76ee\u524d\uff0c`limit-count` \u63d2\u4ef6\u53ea\u8bbe\u7f6e\u4e86\u4e00\u79cd\u6d41\u91cf\u9650\u5236\u6a21\u5f0f\uff1a\u79d2\u6216\u5206\u949f\u3002\u4f46\u662f\uff0c\u8be5\u63d2\u4ef6\u4e0d\u652f\u6301\u540c\u65f6\u8bbe\u7f6e\u79d2\u548c\u5206\u949f\uff0c\u56e0\u4e3a\u7528\u6237\u540e\u9762\u8bbe\u7f6e\u7684\u5185\u5bb9\u4f1a\u8986\u76d6\u524d\u9762\u8bbe\u7f6e\u7684\u5185\u5bb9\uff0c\u662f\u5426\u6709\u529e\u6cd5\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1f\\n\\n### Issue #6265\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/6265\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a[t/core/utils.t](https://github.com/apache/apisix/blob/ec0fc2ceaf04a20b0bd0ebdaad67296a1d3f621c/t/core/utils.t) \u4e2d\u7684\u6d4b\u8bd5\u6848\u4f8b\u76ee\u524d\u6709\u4e00\u4e9b\u4ee3\u7801\u9519\u8bef\uff0c\u6bd4\u5982\uff1a\\n\\n```Lua\\n         content_by_lua_block {\\n             local core = require(\\"apisix.core\\")\\n             local resolvers = {\\"8.8.8.8\\"}\\n             core.utils.set_resolver(resolvers)\\n             local ip_info, err = core.utils.dns_parse(\\"github.com\\")\\n             if not ip_info then\\n                 core.log.error(\\"failed to parse domain: \\", host, \\", error: \\",err)\\n             end\\n             ngx.say(require(\\"toolkit.json\\").encode(ip_info))\\n         }\\n```\\n\\n\u5728\u8fd9\u91cc\u6267\u884c\u4ee3\u7801\u65f6\uff0c\u53d8\u91cf `host` \u662f\u4e00\u4e2a `nil`\uff08\u53ef\u80fd\u6c38\u8fdc\u4e0d\u4f1a\u89e6\u53d1\uff09\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [\u652f\u6301\u8bb0\u5f55 apisix_latency \u548c upstream_latency](https://github.com/apache/apisix/pull/6030)\uff08\u8d21\u732e\u8005\uff1a[jagerzhang](https://github.com/jagerzhang)\uff09\\n\\n- [\u65b0\u589e CSRF \u63d2\u4ef6](https://github.com/apache/apisix/pull/5727)\uff08\u8d21\u732e\u8005\uff1a[Baoyuantop](https://github.com/Baoyuantop)\uff09\\n\\n- [\u65b0\u589e file-logger \u63d2\u4ef6](https://github.com/apache/apisix/pull/5831)\uff08\u8d21\u732e\u8005\uff1a[guoqqqi](https://github.com/guoqqqi)\uff09\\n\\n- [\u65b0\u589e public-api \u63d2\u4ef6](https://github.com/apache/apisix/pull/6145)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [\u65b0\u589e opentelemetry \u63d2\u4ef6](https://github.com/apache/apisix/pull/6119)\uff08\u8d21\u732e\u8005\uff1a[yangxikun](https://github.com/yangxikun)\uff09\\n\\n- [\u65b0\u589e loggly \u63d2\u4ef6](https://github.com/apache/apisix/pull/6113)\uff08\u8d21\u732e\u8005\uff1a[bisakhmondal](https://github.com/bisakhmondal)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u751f\u6001\u6269\u5927\u8fdb\u884c\u4e2d\uff01Apache APISIX \u96c6\u6210 Splunk HTTP Event Collector](https://apisix.apache.org/zh/blog/2022/02/10/apisix-splunk-integration)\uff1a\\n\\n  \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u5728 Apache APISIX \u4e2d\u914d\u7f6e\u548c\u4f7f\u7528 Splunk HEC \u670d\u52a1\u3002\\n\\n- [\u65b0\u63d2\u4ef6 forward-auth \u5df2\u4e0a\u7ebf\uff0c\u8ba4\u8bc1\u529f\u80fd\u53c8\u591a\u4e00\u9879\u9009\u62e9](https://apisix.apache.org/zh/blog/2022/01/26/apisix-integrate-forward-auth-plugin)\uff1a\\n\\n  \u672c\u6587\u5c06\u4ecb\u7ecd Apache APISIX \u4e2d\u65b0\u589e\u63d2\u4ef6 `forward-auth` \u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u4e3a\u5927\u5bb6\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u8fd9\u6b3e\u8bbe\u8ba1\u7b80\u6d01\u7684\u8ba4\u8bc1\u6a21\u578b\u3002\\n\\n- [Apache APISIX \u65b0\u6280\u80fd\uff0c\u4ee3\u7406 gRPC-Web \u8bf7\u6c42](https://apisix.apache.org/zh/blog/2022/01/25/apisix-grpc-web-integration)\uff1a\\n\\n  Apache APISIX \u5df2\u7ecf\u652f\u6301\u4e86 gRPC \u534f\u8bae\u4ee3\u7406\uff0c\u4ee5\u53ca\u901a\u8fc7 gRPC Transcode \u63d2\u4ef6\u652f\u6301\u4e86 HTTP(s) \u5230 gRPC Server \u7684\u4ee3\u7406\u3002\u901a\u8fc7\u793e\u533a\u7684\u79ef\u6781\u8ba8\u8bba\u548c\u8d21\u732e\uff0cApache APISIX \u53c8\u62d3\u5bbd\u4e86 gRPC \u751f\u6001\u7684\u652f\u6301\u8303\u56f4\uff1a\u652f\u6301 gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406\u3002\\n\\n- [Apache APISIX \u96c6\u6210 HashiCorp Vault\uff0c\u751f\u6001\u7cfb\u7edf\u518d\u6dfb\u4e00\u5458](https://apisix.apache.org/zh/blog/2022/01/21/apisix-hashicorp-vault-integration)\uff1a\\n\\n  \u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 Vault \u63d2\u4ef6\u4ee5\u53ca\u76f8\u5173\u7ec6\u8282\u3002\u5728\u4e3a\u670d\u52a1\u63d0\u4f9b\u9ad8\u5e76\u53d1\u4f4e\u5ef6\u8fdf\u7684\u5353\u8d8a\u6027\u80fd\u7684\u540c\u65f6\uff0c\u4e3a\u670d\u52a1\u7684\u5b89\u5168\u4fdd\u9a7e\u62a4\u822a\u3002\\n\\n- [\u591a\u534f\u8bae\u63a5\u5165\u6846\u67b6 xRPC \u53d1\u5e03\u5728\u5373\uff0c\u4e3a\u4f60\u89e3\u8bfb\u66f4\u591a APISIX \u751f\u6001\u7ec6\u8282](https://apisix.apache.org/zh/blog/2022/01/21/apisix-xrpc-details-and-miltilingual)\uff1a\\n\\n  \u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 xRPC \u6846\u67b6\u4ee5\u53ca\u76f8\u5173\u7ec6\u8282\uff0c\u540c\u65f6\u4ecb\u7ecd\u4e86 Apache APISIX \u5728\u591a\u8bed\u8a00\u5f00\u53d1\u652f\u6301\u4e2d\u7684\u7ec6\u8282\u5c55\u793a\u3002\\n\\n- [CDN \u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u53c8\u62cd\u4e91\u7684\u516c\u7f51\u7f51\u5173\u573a\u666f\u5b9e\u8df5](https://apisix.apache.org/zh/blog/2022/01/20/upyun-public-gateway-usecase)\uff1a\\n\\n  \u5728\u4e4b\u524d\u7684\u5206\u4eab\u4e2d\uff0c\u6211\u4eec\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86\u53c8\u62cd\u4e91\u5728 Ingress \u5c42\u9762\u7684\u5e94\u7528\u3002\u800c\u8fd9\u6b21\u6211\u4eec\u4f1a\u5728\u516c\u7f51\u7f51\u5173\u573a\u666f\u4e0b\uff0c\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u76ee\u524d\u53c8\u62cd\u4e91\u7684\u5e94\u7528\u5b9e\u4f8b\uff0c\u5e0c\u671b\u80fd\u5728\u4e91\u5b58\u50a8\u884c\u4e1a\u9886\u57df\uff0c\u7ed9\u5927\u5bb6\u5e26\u6765\u4e00\u4e9b\u5b9e\u7528\u7684 Apache APISIX \u573a\u666f\u5206\u4eab\u3002"},{"id":"\u540e\u7aef\u65b0\u624b\u5982\u4f55\u4ece 0 \u5230 1 \u5728 API \u7f51\u5173\u4e0a\u5f00\u53d1 APISIX \u63d2\u4ef6","metadata":{"permalink":"/zh/blog/2022/02/16/file-logger-api-gateway","source":"@site/blog/2022/02/16/file-logger-api-gateway.md","title":"\u540e\u7aef\u65b0\u624b\u5982\u4f55\u4ece 0 \u5230 1 \u5728 API \u7f51\u5173\u4e0a\u5f00\u53d1 APISIX \u63d2\u4ef6","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u6ca1\u6709\u540e\u7aef\u7ecf\u9a8c\u7684\u524d\u7aef\u5de5\u7a0b\u5e08\u5982\u4f55\u5728\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4e0a\u5f00\u53d1 file-logger \u63d2\u4ef6\u7684\u5177\u4f53\u6b65\u9aa4\uff0c\u4ece\u4e2d\u4f60\u53ef\u4ee5\u5b66\u4e60\u5230\u5728 APISIX \u4e0a\u8fdb\u884c\u5f00\u53d1\u63d2\u4ef6\u3002","date":"2022-02-16T00:00:00.000Z","formattedDate":"2022\u5e742\u670816\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":12.6,"truncated":true,"authors":[{"name":"\u90ed\u5947","title":"Author","url":"https://github.com/guoqqqi","image_url":"https://avatars.githubusercontent.com/u/72343596?v=4","imageURL":"https://avatars.githubusercontent.com/u/72343596?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://avatars.githubusercontent.com/u/36651058?v=4","imageURL":"https://avatars.githubusercontent.com/u/36651058?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff5c2.1-2.14 \u529f\u80fd\u4eae\u70b9\u66f4\u65b0\u8fdb\u884c\u4e2d","permalink":"/zh/blog/2022/02/17/weekly-report-0214"},"nextItem":{"title":"Apache APISIX \u5b58\u5728\u6539\u5199 X-REAL-IP header \u7684\u98ce\u9669\u516c\u544a\uff08CVE-2022-24112\uff09","permalink":"/zh/blog/2022/02/11/cve-2022-24112"}},"content":"> \u672c\u7bc7\u6587\u7ae0\u8bb0\u5f55\u4e86\u4e00\u4e2a\u6ca1\u6709\u540e\u7aef\u7ecf\u9a8c\u7684\u524d\u7aef\u5de5\u7a0b\u5e08\u5f00\u53d1 `file-logger` \u63d2\u4ef6\u7684\u8fc7\u7a0b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u5728\u8fc7\u53bb\u7684\u51e0\u4e2a\u6708\uff0c\u793e\u533a\u7528\u6237\u4e3a Apache APISIX \u6dfb\u52a0\u4e86\u8bb8\u591a\u63d2\u4ef6\uff0c\u4e30\u5bcc\u4e86 Apache APISIX \u7684\u751f\u6001\u3002\u4ece\u4f7f\u7528\u8005\u7684\u89d2\u5ea6\u800c\u8a00\uff0c\u66f4\u591a\u6837\u5316\u7684\u63d2\u4ef6\u51fa\u73b0\u65e0\u7591\u662f\u4e00\u4ef6\u597d\u4e8b\uff0c\u5b83\u4eec\u5728\u5b8c\u5584 Apache APISIX \u9ad8\u6027\u80fd\u548c\u4f4e\u5ef6\u8fdf\u7684\u57fa\u7840\u4e4b\u4e0a\uff0c\u6ee1\u8db3\u4e86\u4f7f\u7528\u8005\u5bf9\u4e8e\u7f51\u5173\u7684\u66f4\u591a\u671f\u671b\uff0c\u5373\u201c\u4e00\u7ad9\u5f0f\u201d\u548c\u201c\u591a\u529f\u80fd\u201d\u3002\\n\\n\u793e\u533a\u7684\u8d21\u732e\u8005\u4eec\u662f\u5982\u4f55\u4e3a Apache APISIX \u5f00\u53d1\u63d2\u4ef6\u7684\u5462\uff1fApache APISIX \u535a\u5ba2\u4e0a\u7684\u6587\u7ae0\u4f3c\u4e4e\u90fd\u6ca1\u6709\u8be6\u7ec6\u8bb2\u8ff0\u8fc7\u5f00\u53d1\u63d2\u4ef6\u7684\u6d41\u7a0b\u3002\u90a3\u4e48\u8fd9\u6b21\u6211\u4eec\u6362\u4e00\u4e2a\u89c6\u89d2\uff0c\u4ece\u63d2\u4ef6\u5f00\u53d1\u8005\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u4e00\u8d77\u6765\u770b\u770b\u4e00\u6b3e\u63d2\u4ef6\u8bde\u751f\u7684\u5168\u8fc7\u7a0b\u5427\uff01\\n\\n\u672c\u7bc7\u6587\u7ae0\u8bb0\u5f55\u4e86\u4e00\u4e2a**\u6ca1\u6709\u540e\u7aef\u7ecf\u9a8c\u7684\u524d\u7aef\u5de5\u7a0b\u5e08**\u5728 API \u7f51\u5173\u4e0a\u5f00\u53d1 `file-logger` \u63d2\u4ef6\u7684\u8fc7\u7a0b\u3002\u5728\u8be6\u7ec6\u8bf4\u660e\u5b9e\u73b0\u8fc7\u7a0b\u4e4b\u524d\uff0c\u5148\u5411\u5927\u5bb6\u7b80\u5355\u4ecb\u7ecd\u4e0b `file-logger` \u7684\u529f\u80fd\u3002\\n\\n## \u529f\u80fd\u4ecb\u7ecd\\n\\n`file-logger` \u652f\u6301\u4f7f\u7528 Apache APISIX \u63d2\u4ef6\u5143\u6570\u636e\u751f\u6210\u81ea\u5b9a\u4e49\u7684\u65e5\u5fd7\u683c\u5f0f\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7 `file-logger` \u63d2\u4ef6\u5c06 JSON \u683c\u5f0f\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u6570\u636e\u9644\u52a0\u5230\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5c06 Log \u6570\u636e\u6d41\u63a8\u9001\u5230\u6307\u5b9a\u4f4d\u7f6e\u3002\\n\\n\u8bd5\u60f3\uff0c\u5728\u76d1\u63a7\u67d0\u4e00\u4e2a\u8def\u7531\u7684\u8bbf\u95ee\u65e5\u5fd7\u65f6\uff0c\u5f88\u591a\u65f6\u5019\u6211\u4eec\u5173\u6ce8\u7684\u4e0d\u4ec5\u662f\u67d0\u4e9b\u8bf7\u6c42\u548c\u54cd\u5e94\u6570\u636e\u7684\u503c\uff0c\u8fd8\u5e0c\u671b\u5c06\u65e5\u5fd7\u6570\u636e\u5355\u72ec\u5199\u5165\u5230\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u3002\u8fd9\u65f6\u5c31\u53ef\u4ee5\u4f7f\u7528 `file-logger` \u63d2\u4ef6\u6765\u5e2e\u5fd9\u5b9e\u73b0\u8fd9\u4e9b\u9700\u6c42\u3002\\n\\n![\u529f\u80fd\u4ecb\u7ecd](https://static.apiseven.com/202108/1644996258131-a0e32942-dcc5-4129-873f-0a7551532e77.png)\\n\\n\u5177\u4f53\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `file-logger` \u5c06\u65e5\u5fd7\u6570\u636e\u5355\u72ec\u5199\u5165\u6307\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u7b80\u5316\u76d1\u63a7\u548c\u8c03\u8bd5\u7684\u8fc7\u7a0b\u3002\\n\\n## \u5f00\u53d1\u5b9e\u73b0\u8fc7\u7a0b\\n\\n\u4ecb\u7ecd\u5b8c `file-logger` \u7684\u529f\u80fd\u4e4b\u540e\uff0c\u5927\u5bb6\u4e5f\u7b97\u5bf9\u8fd9\u4e2a\u63d2\u4ef6\u6709\u4e86\u66f4\u591a\u7684\u8ba4\u8bc6\u3002\u4e0b\u9762\u4e3a\u5927\u5bb6\u8be6\u7ec6\u8bb2\u89e3\u4e00\u4e0b\uff0c**\u6ca1\u6709\u670d\u52a1\u7aef\u7ecf\u9a8c**\u7684\u6211\u662f\u5982\u4f55\u4ece 0 \u5f00\u59cb\u4e3a Apache APISIX \u5b8c\u6210\u8be5\u63d2\u4ef6\u5e76\u6dfb\u52a0\u76f8\u5e94\u6d4b\u8bd5\u7684\u3002\\n\\n### \u786e\u5b9a\u63d2\u4ef6\u540d\u79f0\u53ca\u4f18\u5148\u7ea7\\n\\n\u6253\u5f00 [Apache APISIX \u63d2\u4ef6\u5f00\u53d1\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/plugin-develop/#%E6%8F%92%E4%BB%B6%E5%91%BD%E5%90%8D%EF%BC%8C%E4%BC%98%E5%85%88%E7%BA%A7%E5%92%8C%E5%85%B6%E4%BB%96)\uff0c\u6309\u7167\u5148\u540e\u987a\u5e8f\u9700\u8981\u786e\u5b9a\u4ee5\u4e0b\u51e0\u9879\uff1a\\n\\n1. \u786e\u5b9a\u63d2\u4ef6\u5206\u7c7b\u3002\\n2. \u786e\u5b9a\u63d2\u4ef6\u4f18\u5148\u7ea7\uff0c\u5e76\u66f4\u65b0 `conf/config-default.yaml` \u6587\u4ef6\u3002\\n\\n\u56e0\u4e3a\u6b64\u6b21\u5f00\u53d1\u7684 `file-logger` \u5c5e\u4e8e\u65e5\u5fd7\u7c7b\u578b\u7684\u63d2\u4ef6\uff0c\u6240\u4ee5\u6211\u53c2\u8003\u4e86 Apache APISIX \u5df2\u6709\u7684\u65e5\u5fd7\u63d2\u4ef6\u7684\u540d\u79f0\u548c\u6392\u5e8f\uff0c\u5c06 `file-logger` \u653e\u5230\u4e86\u8fd9\u91cc\uff1a\\n\\n![\u786e\u8ba4 file-logger \u63d2\u4ef6\u540d\u79f0\u548c\u4f18\u5148\u7ea7](https://static.apiseven.com/202108/1644996436166-58305d35-3798-4df2-b8df-1874f3e0cb01.png)\\n\\n\u54a8\u8be2\u4e86\u5176\u4ed6\u63d2\u4ef6\u7684\u4f5c\u8005\u548c\u793e\u533a\u7684\u70ed\u5fc3\u6210\u5458\u4e4b\u540e\uff0c\u6700\u7ec8\u786e\u8ba4\u4e86\u8be5\u63d2\u4ef6\u7684\u540d\u79f0 `file-logger` \u548c\u4f18\u5148\u7ea7 `399`\u3002\\n\\n> \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u63d2\u4ef6\u7684\u4f18\u5148\u7ea7\u4e0e\u6267\u884c\u987a\u5e8f\u6709\u5173\uff0c\u4f18\u5148\u7ea7\u7684\u503c\u8d8a\u5927\uff0c\u6267\u884c\u8d8a\u9760\u524d\u3002\u800c\u63d2\u4ef6\u540d\u79f0\u7684\u6392\u5e8f\u4e0e\u6267\u884c\u987a\u5e8f\u65e0\u5173\u3002\\n\\n### \u521b\u5efa\u6700\u5c0f\u53ef\u6267\u884c\u63d2\u4ef6\u6587\u4ef6\\n\\n\u786e\u8ba4\u597d\u63d2\u4ef6\u540d\u79f0\u548c\u4f18\u5148\u7ea7\u540e\uff0c\u4fbf\u53ef\u5728 `apisix/plugins/` \u76ee\u5f55\u4e0b\u521b\u5efa\u6211\u4eec\u7684\u63d2\u4ef6\u4ee3\u7801\u6587\u4ef6\uff0c\u8fd9\u91cc\u6709\u4e24\u70b9\u9700\u8981\u6ce8\u610f\uff1a\\n\\n- \u5982\u679c\u662f\u76f4\u63a5\u5728 `apisix/plugins/` \u76ee\u5f55\u4e0b\u76f4\u63a5\u521b\u5efa\u63d2\u4ef6\u4ee3\u7801\u6587\u4ef6\uff0c\u5c31\u65e0\u9700\u66f4\u6539 `Makefile` \u6587\u4ef6\u3002\\n- \u5982\u679c\u4f60\u7684\u63d2\u4ef6\u6709\u65b0\u5efa\u81ea\u5df1\u7684\u4ee3\u7801\u76ee\u5f55\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u66f4\u65b0 `Makefile \u6587\u4ef6`\uff0c\u8be6\u7ec6\u6b65\u9aa4\u53ef\u53c2\u8003 [Apache APISIX \u63d2\u4ef6\u5f00\u53d1\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/plugin-develop/#%E6%8F%92%E4%BB%B6%E5%91%BD%E5%90%8D%EF%BC%8C%E4%BC%98%E5%85%88%E7%BA%A7%E5%92%8C%E5%85%B6%E4%BB%96)\u3002\\n  \\n1. \u4e0b\u9762\u6211\u4eec\u5728 `apisix/plugins/` \u76ee\u5f55\u4e0b\u521b\u5efa `file-logger.lua` \u6587\u4ef6\u3002\\n2. \u7136\u540e\u6839\u636e\u5b98\u65b9\u7ed9\u51fa\u7684 `example-plugin` \u7684\u4f8b\u5b50\u505a\u53c2\u8003\uff0c\u6765\u5b8c\u6210\u4e00\u4e2a\u521d\u59cb\u5316\u7248\u672c\u3002\\n\\n```lua\\n-- \u5728\u5934\u90e8\u5f15\u5165\u6211\u4eec\u6240\u9700\u8981\u7684\u6a21\u5757\\nlocal log_util     =   require(\\"apisix.utils.log-util\\")\\nlocal core         =   require(\\"apisix.core\\")\\nlocal plugin       =   require(\\"apisix.plugin\\")\\nlocal ngx          =   ngx\\n\\n-- \u58f0\u660e\u63d2\u4ef6\u540d\u79f0\\nlocal plugin_name = \\"file-logger\\"\\n\\n-- \u5b9a\u4e49\u63d2\u4ef6 schema \u683c\u5f0f\\nlocal schema = {\\n    type = \\"object\\",\\n    properties = {\\n        path = {\\n            type = \\"string\\"\\n        },\\n    },\\n    required = {\\"path\\"}\\n}\\n\\n-- \u63d2\u4ef6\u5143\u6570\u636e schema\\nlocal metadata_schema = {\\n    type = \\"object\\",\\n    properties = {\\n        log_format = log_util.metadata_schema_log_format\\n    }\\n}\\n\\n\\nlocal _M = {\\n    version = 0.1,\\n    priority = 399,\\n    name = plugin_name,\\n    schema = schema,\\n    metadata_schema = metadata_schema\\n}\\n\\n-- \u68c0\u67e5\u63d2\u4ef6\u914d\u7f6e\u662f\u5426\u6b63\u786e\\nfunction _M.check_schema(conf, schema_type)\\n    if schema_type == core.schema.TYPE_METADATA then\\n        return core.schema.check(metadata_schema, conf)\\n    end\\n    return core.schema.check(schema, conf)\\nend\\n\\n-- \u65e5\u5fd7\u9636\u6bb5\\nfunction _M.log(conf, ctx)\\n    core.log.warn(\\"conf: \\", core.json.encode(conf))\\n    core.log.warn(\\"ctx: \\", core.json.encode(ctx, true))\\nend\\n\\n\\nreturn _M\\n```\\n\\n\u901a\u8fc7 `example-plugin` \u7684\u4f8b\u5b50\u5b8c\u6210\u4e86\u4e00\u4e2a\u6700\u5c0f\u7684\u53ef\u7528\u63d2\u4ef6\u6587\u4ef6\u540e\uff0c\u4fbf\u53ef\u901a\u8fc7 `core.log.warn(core.json.encode(conf))` \u548c `core.log.warn(\\"ctx: \\", core.json.encode(ctx, true))` \u5c06\u63d2\u4ef6\u7684\u914d\u7f6e\u6570\u636e\u548c\u8bf7\u6c42\u76f8\u5173\u7684\u6570\u636e\u4fe1\u606f\u8f93\u51fa\u5230 `error.log` \u6587\u4ef6\u4e2d\u53bb\u3002\\n\\n### \u542f\u7528\u63d2\u4ef6\u5e76\u6d4b\u8bd5\\n\\n\u4e0b\u9762\u901a\u8fc7\u521b\u5efa\u4e00\u6761\u6d4b\u8bd5\u8def\u7531\uff0c\u6765\u6d4b\u8bd5\u63d2\u4ef6\u662f\u5426\u80fd\u6210\u529f\u5c06\u6211\u4eec\u4e3a\u5176\u914d\u7f6e\u7684\u63d2\u4ef6\u6570\u636e\u548c\u8bf7\u6c42\u76f8\u5173\u7684\u6570\u636e\u4fe1\u606f\uff0c\u6253\u5370\u5230\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\u4e2d\u53bb\u3002\\n\\n1. \u5728\u672c\u5730\u51c6\u5907\u4e00\u4e2a\u6d4b\u8bd5\u4e0a\u6e38\uff08\u672c\u6587\u4e2d\u4f7f\u7528\u7684\u6d4b\u8bd5\u4e0a\u6e38\u662f\u6211\u5728\u672c\u5730\u521b\u5efa\u7684 `127.0.0.1:3030/api/hello`\uff09\u3002\\n2. \u901a\u8fc7 `curl` \u547d\u4ee4\u521b\u5efa\u4e00\u6761\u8def\u7531\u5e76\u542f\u7528\u6211\u4eec\u65b0\u589e\u7684\u63d2\u4ef6\u3002\\n\\n   ```shell\\n    curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n    {\\n    \\"plugins\\": {\\n        \\"file-logger\\": {\\n        \\"path\\": \\"logs/file.log\\"\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n        \\"127.0.0.1:3030\\": 1\\n        }\\n    },\\n    \\"uri\\": \\"/api/hello\\"\\n    }\'\\n   ```\\n\\n   \u63a5\u7740\u5c31\u4f1a\u770b\u5230\u4e00\u4e2a `200` \u7684\u72b6\u6001\u7801\uff0c\u8868\u660e\u5df2\u6210\u529f\u521b\u5efa\u4e86\u8def\u7531\u3002\\n3. \u8fd0\u884c `curl` \u547d\u4ee4\u5411\u8be5\u8def\u7531\u53d1\u9001\u8bf7\u6c42\uff0c\u6d4b\u8bd5 `file-logger` \u63d2\u4ef6\u662f\u5426\u5df2\u7ecf\u542f\u52a8\u3002\\n\\n   ```shell\\n   curl -i http://127.0.0.1:9080/api/hello\\n   HTTP/1.1 200 OK\\n   ...\\n   hello, world\\n   ```\\n\\n4. \u5728 `logs/error.log` \u6587\u4ef6\u4e2d\u4f1a\u6709\u4e00\u6761\u8fd9\u6837\u7684\u8bb0\u5f55\uff1a\\n\\n   ![logs/error.log \u8bb0\u5f55](https://static.apiseven.com/202108/1644996952020-7a79d5df-e679-42f1-94f3-40a913db790c.png)\\n\\n   \u53ef\u4ee5\u770b\u5230\uff0c \u5728 `conf` \u53c2\u6570\u4e2d\u6211\u4eec\u4e3a\u63d2\u4ef6\u914d\u7f6e\u7684 `path: logs/file.log` \u5df2\u7ecf\u6210\u529f\u5730\u4fdd\u5b58\u4e86\u3002\u5230\u6b64\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u521b\u5efa\u4e86\u4e00\u4e2a\u6700\u5c0f\u53ef\u7528\u7684\u63d2\u4ef6\uff0c\u5728\u65e5\u5fd7\u9636\u6bb5\u6253\u5370\u4e86 `conf` \u548c `ctx` \u53c2\u6570\u7684\u6570\u636e\u3002\\n\\n   \u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u8be5 `file-logger.lua` \u63d2\u4ef6\u4ee3\u7801\u6587\u4ef6\u4e2d\uff0c\u4e3a\u5b83\u7f16\u5199\u6838\u5fc3\u529f\u80fd\u3002\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c `apisix reload` \u547d\u4ee4\u6765\u91cd\u65b0\u52a0\u8f7d\u6700\u65b0\u7684\u63d2\u4ef6\u4ee3\u7801\uff0c\u800c\u65e0\u9700\u91cd\u542f Apache APISIX\u3002\\n\\n### \u4e3a file-logger \u63d2\u4ef6\u7f16\u5199\u6838\u5fc3\u529f\u80fd\\n\\n`file-logger` \u63d2\u4ef6\u7684\u4e3b\u8981\u529f\u80fd\u662f\u5199\u65e5\u5fd7\u6570\u636e\u3002\u5728\u7ecf\u8fc7\u8be2\u95ee\u548c\u67e5\u9605\u8d44\u6599\u540e\uff0c\u6211\u4e86\u89e3\u5230 [Lua \u7684 IO \u5e93](https://www.tutorialspoint.com/lua/lua_file_io.htm)\uff0c\u4e8e\u662f\u786e\u8ba4\u4e86\u8be5\u63d2\u4ef6\u7684\u529f\u80fd\u903b\u8f91\u5927\u81f4\u4e3a\u4ee5\u4e0b\u51e0\u6b65\uff1a\\n\\n1. \u6bcf\u6b21\u63a5\u53d7\u8bf7\u6c42\u4e4b\u540e\uff0c\u5c06\u65e5\u5fd7\u6570\u636e\u8f93\u51fa\u5230\u63d2\u4ef6\u914d\u7f6e\u7684 `path` \u4e2d\u53bb\u3002\\n   1. \u9996\u5148\uff0c\u5728\u65e5\u5fd7\u9636\u6bb5\u901a\u8fc7 `conf` \u62ff\u5230 `file-logger` \u4e2d `path` \u7684\u503c\u3002\\n   2. \u7136\u540e\uff0c\u901a\u8fc7 Lua IO \u5e93\u6765\u5b8c\u6210\u6587\u4ef6\u300c\u521b\u5efa\u300d\u3001\u300c\u6253\u5f00\u300d\u3001\u300c\u5199\u300d\u3001\u300c\u5237\u65b0\u7f13\u5b58\u300d\u3001\u300c\u5173\u95ed\u300d\u7684\u64cd\u4f5c\u3002\\n2. \u5904\u7406\u300c\u6587\u4ef6\u6253\u5f00\u300d\u5931\u8d25\u3001\u300c\u6587\u4ef6\u521b\u5efa\u300d\u5931\u8d25\u7b49\u9519\u8bef\u3002\\n\\n   ```lua\\n    local function write_file_data(conf, log_message)\\n        local msg, err = core.json.encode(log_message)\\n        if err then\\n            return core.log.error(\\"message json serialization failed, error info : \\", err)\\n        end\\n\\n        local file, err = io_open(conf.path, \'a+\')\\n\\n        if not file then\\n            core.log.error(\\"failed to open file: \\", conf.path, \\", error info: \\", err)\\n        else\\n            local ok, err = file:write(msg, \'\\\\n\')\\n            if not ok then\\n                core.log.error(\\"failed to write file: \\", conf.path, \\", error info: \\", err)\\n            else\\n                file:flush()\\n            end\\n            file:close()\\n        end\\n    end\\n   ```\\n\\n3. \u53c2\u8003 `http-logger` \u63d2\u4ef6\u6e90\u7801\uff0c\u5b8c\u6210\u4e86\u5c06\u65e5\u8bb0\u6570\u636e\u4f20\u7ed9\u5199\u65e5\u5fd7\u6570\u636e\u7684\u65b9\u6cd5\u548c metadata \u7684\u4e00\u4e9b\u5224\u65ad\u548c\u5904\u7406\u3002\\n\\n   ```lua\\n    function _M.log(conf, ctx)\\n        local metadata = plugin.plugin_metadata(plugin_name)\\n        local entry\\n\\n        if metadata and metadata.value.log_format\\n            and core.table.nkeys(metadata.value.log_format) > 0\\n        then\\n            entry = log_util.get_custom_format_log(ctx, metadata.value.log_format)\\n        else\\n            entry = log_util.get_full_log(ngx, conf)\\n        end\\n\\n        write_file_data(conf, entry)\\n    end\\n   ```\\n\\n## \u9a8c\u8bc1\u53ca\u6dfb\u52a0\u6d4b\u8bd5\\n\\n### \u9a8c\u8bc1\u6536\u96c6\u65e5\u5fd7\u8bb0\u5f55\\n\\n\u56e0\u4e3a\u5728\u521b\u5efa\u6d4b\u8bd5\u8def\u7531\u65f6\u5df2\u7ecf\u542f\u7528\u4e86 `file-logger` \u63d2\u4ef6\uff0c\u5e76\u4e14\u914d\u7f6e\u4e86 `path` \u4e3a `logs/file.log`\uff0c\u6240\u4ee5\u6b64\u65f6\u6211\u4eec\u53ea\u9700\u7ed9\u6d4b\u8bd5\u8def\u7531\u53d1\u9001\u8bf7\u6c42\uff0c\u4ee5\u9a8c\u8bc1\u65e5\u5fd7\u6536\u96c6\u7684\u7ed3\u679c\uff1a\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/api/hello\\n```\\n\\n\u5728\u5bf9\u5e94\u7684 `logs/file.log` \u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6bcf\u6761\u8bb0\u5f55\u90fd\u662f\u4ee5 JSON \u7684\u683c\u5f0f\u4fdd\u5b58\u4e0b\u6765\u3002\u5c06\u5176\u4e2d\u4e00\u6761\u6570\u636e\u683c\u5f0f\u5316\u4e4b\u540e\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```json\\n{\\n    \\"server\\":{\\n        \\"hostname\\":\\"....\\",\\n        \\"version\\":\\"2.11.0\\"\\n    },\\n    \\"client_ip\\":\\"127.0.0.1\\",\\n    \\"upstream\\":\\"127.0.0.1:3030\\",\\n    \\"route_id\\":\\"1\\",\\n    \\"start_time\\":1641285122961,\\n    \\"latency\\":13.999938964844,\\n    \\"response\\":{\\n        \\"status\\":200,\\n        \\"size\\":252,\\n        \\"headers\\":{\\n            \\"server\\":\\"APISIX\\\\/2.11.0\\",\\n            \\"content-type\\":\\"application\\\\/json; charset=utf-8\\",\\n            \\"date\\":\\"Tue, 04 Jan 2022 08:32:02 GMT\\",\\n            \\"vary\\":\\"Accept-Encoding\\",\\n            \\"content-length\\":\\"19\\",\\n            \\"connection\\":\\"close\\",\\n            \\"etag\\":\\"\\\\\\"13-5j0ZZR0tI549fSRsYxl8c9vAU78\\\\\\"\\"\\n        }\\n    },\\n    \\"service_id\\":\\"\\",\\n    \\"request\\":{\\n        \\"querystring\\":{\\n\\n        },\\n        \\"size\\":87,\\n        \\"method\\":\\"GET\\",\\n        \\"headers\\":{\\n            \\"host\\":\\"127.0.0.1:9080\\",\\n            \\"accept\\":\\"*\\\\/*\\",\\n            \\"user-agent\\":\\"curl\\\\/7.77.0\\"\\n        },\\n        \\"url\\":\\"http:\\\\/\\\\/127.0.0.1:9080\\\\/api\\\\/hello\\",\\n        \\"uri\\":\\"\\\\/api\\\\/hello\\"\\n    }\\n}\\n```\\n\\n\u81f3\u6b64\u9a8c\u8bc1\u6536\u96c6\u65e5\u5fd7\u8bb0\u5f55\u7684\u73af\u8282\u7ed3\u675f\u4e86\uff0c\u9a8c\u8bc1\u7ed3\u679c\u8bf4\u660e\u63d2\u4ef6\u6210\u529f\u542f\u52a8\u5e76\u8fd4\u56de\u4e86\u5e94\u6709\u7684\u6570\u636e\u3002\\n\\n### \u4e3a\u63d2\u4ef6\u6dfb\u52a0\u6d4b\u8bd5\\n\\n\u5bf9\u4e8e `add_block_preprocessor` \u90e8\u5206\u7684\u4ee3\u7801\uff0c\u7531\u4e8e\u6211\u6ca1\u6709\u5b66\u8fc7 Perl \uff0c\u6240\u4ee5\u5728\u521a\u5f00\u59cb\u7f16\u5199\u65f6\u6bd4\u8f83\u56f0\u60d1\u3002\u5728\u8be2\u95ee\u4e4b\u540e\u624d\u4e86\u89e3\u5230\u5b83\u7684\u6b63\u786e\u4f7f\u7528\u65b9\u5f0f\uff1a\u5982\u679c\u6211\u4eec\u5728\u6570\u636e\u90e8\u5206\u6ca1\u6709\u7f16\u5199\u76f8\u5173\u7684 `request` \u65ad\u8a00\u548c `no_error_log` \u65ad\u8a00\u65f6\uff0c\u90a3\u4e48\u9ed8\u8ba4\u65ad\u8a00\u5982\u4e0b\uff1a\\n\\n```lua\\n--- request\\nGET /t\\n--- no_error_log\\n[error]\\n```\\n\\n\u7efc\u5408\u53c2\u8003\u4e86\u4e00\u4e9b\u5176\u4ed6\u7684\u65e5\u5fd7\u6d4b\u8bd5\u6587\u4ef6\u4ee5\u540e\uff0c\u6211\u5728 `t/plugin/` \u76ee\u5f55\u4e0b\u521b\u5efa `file-logger.t` \u6587\u4ef6\u3002\\n\\n\u6bcf\u4e00\u4efd\u6d4b\u8bd5\u6587\u4ef6\u90fd\u7531 `__DATA__` \u5206\u4e3a\u5e8f\u8a00\u90e8\u5206\u548c\u6570\u636e\u90e8\u5206\u3002\u7531\u4e8e\u76ee\u524d\u5b98\u7f51\u6d4b\u8bd5\u76f8\u5173\u6587\u6863\u6ca1\u6709\u660e\u786e\u5f52\u6863\u5206\u7c7b\uff0c\u66f4\u591a\u5177\u4f53\u5185\u5bb9\u53ef\u53c2\u8003\u6587\u672b\u7684\u76f8\u5173\u8d44\u6599\u3002\u4e0b\u9762\u6211\u4e3a\u5927\u5bb6\u5217\u51fa\u53c2\u8003\u76f8\u5173\u8d44\u6599\u540e\u5b8c\u6210\u7684\u5176\u4e2d\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\uff1a\\n\\n```perl\\nuse t::APISIX \'no_plan\';\\n\\nno_long_string();\\nno_root_location();\\n\\nadd_block_preprocessor(sub {\\n    my ($block) = @_;\\n\\n    if (! $block->request) {\\n        $block->set_value(\\"request\\", \\"GET /t\\");\\n    }\\n\\n    if (! $block->no_error_log && ! $block->error_log) {\\n        $block->set_value(\\"no_error_log\\", \\"[error]\\");\\n    }\\n});\\n\\n\\nrun_tests;\\n\\n__DATA__\\n\\n=== TEST 1: sanity\\n--- config\\n    location /t {\\n        content_by_lua_block {\\n            local configs = {\\n                -- full configuration\\n                {\\n                    path = \\"file.log\\"\\n                },\\n                -- property \\"path\\" is required\\n                {\\n                    path = nil\\n                }\\n            }\\n\\n            local plugin = require(\\"apisix.plugins.file-logger\\")\\n\\n            for i = 1, #configs do\\n                ok, err = plugin.check_schema(configs[i])\\n                if err then\\n                    ngx.say(err)\\n                else\\n                    ngx.say(\\"done\\")\\n                end\\n            end\\n        }\\n    }\\n--- response_body_like\\ndone\\nproperty \\"path\\" is required\\n```\\n\\n\u81f3\u6b64\u63d2\u4ef6\u6dfb\u52a0\u6d4b\u8bd5\u73af\u8282\u7ed3\u675f\u3002\\n\\n## \u603b\u7ed3\\n\\n\u4ee5\u4e0a\u5c31\u662f\u6211\u4f5c\u4e3a\u4e00\u4e2a\u540e\u7aef\u65b0\u624b\uff0c\u4ece 0 \u5f00\u59cb\u5b9e\u73b0\u4e00\u6b3e Apache APISIX \u63d2\u4ef6\u7684\u5168\u8fc7\u7a0b\u3002\u5728\u5f00\u53d1\u63d2\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u786e\u5b9e\u78b0\u5230\u4e86\u5f88\u591a\u5751\uff0c\u6bd4\u8f83\u5e78\u8fd0\u7684\u662f Apache APISIX \u793e\u533a\u91cc\u9762\u6709\u5f88\u591a\u70ed\u5fc3\u7684\u5927\u4f6c\u5e2e\u6211\u89e3\u60d1\uff0c\u4f7f\u5f97 `file-logger` \u63d2\u4ef6\u7684\u5f00\u53d1\u548c\u6d4b\u8bd5\u5168\u7a0b\u90fd\u6bd4\u8f83\u987a\u7545\u3002\u5982\u679c\u4f60\u5bf9\u8fd9\u4e2a\u63d2\u4ef6\u611f\u5174\u8da3\uff0c\u6216\u60f3\u8981\u67e5\u770b\u63d2\u4ef6\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/next/plugins/file-logger/)\u3002\\n\\n\u76ee\u524d\uff0cApache APISIX \u4e5f\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u611f\u5174\u8da3\uff0c\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussion](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u4e5f\u53ef\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u8ba8\u8bba\u3002\\n\\n## \u53c2\u8003\u8d44\u6599\\n\\n- [Apache APISIX \u63d2\u4ef6\u5f00\u53d1\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/plugin-develop/)\\n- [Lua - File I/O \u4f7f\u7528\u6307\u5357](https://www.tutorialspoint.com/lua/lua_file_io.htm)\\n- [\u5982\u4f55\u8fd0\u884c Apache APISIX \u6d4b\u8bd5\u6848\u4f8b](https://apisix.apache.org/zh/docs/apisix/how-to-build/#%E6%AD%A5%E9%AA%A44%EF%BC%9A%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95%E6%A1%88%E4%BE%8B)\\n- [\u5982\u4f55\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b](https://apisix.apache.org/zh/docs/apisix/plugin-develop/#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B)\\n- [Apache APISIX \u6d4b\u8bd5\u6846\u67b6\u4ecb\u7ecd](https://apisix.apache.org/zh/docs/apisix/internal/testing-framework/)\\n- [test-nginx \u76f8\u5173\u7684\u4e00\u4e9b API \u4ecb\u7ecd](https://metacpan.org/pod/Test%3A%3ANginx%3A%3ASocket)"},{"id":"Apache APISIX \u5b58\u5728\u6539\u5199 X-REAL-IP header \u7684\u98ce\u9669\u516c\u544a\uff08CVE-2022-24112\uff09","metadata":{"permalink":"/zh/blog/2022/02/11/cve-2022-24112","source":"@site/blog/2022/02/11/cve-2022-24112.md","title":"Apache APISIX \u5b58\u5728\u6539\u5199 X-REAL-IP header \u7684\u98ce\u9669\u516c\u544a\uff08CVE-2022-24112\uff09","description":"\u5728 Apache APISIX 2.12.1 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u542f\u7528 Apache APISIX `batch-requests` \u63d2\u4ef6\u4e4b\u540e\u4f1a\u5b58\u5728\u6539\u5199 X-REAL-IP header \u98ce\u9669\uff0c\u73b0\u5c06\u5904\u7406\u4fe1\u606f\u8fdb\u884c\u76f8\u5173\u516c\u544a\u3002","date":"2022-02-11T00:00:00.000Z","formattedDate":"2022\u5e742\u670811\u65e5","tags":[{"label":"Vulnerabilities","permalink":"/zh/blog/tags/vulnerabilities"}],"readingTime":1.71,"truncated":true,"authors":[],"prevItem":{"title":"\u540e\u7aef\u65b0\u624b\u5982\u4f55\u4ece 0 \u5230 1 \u5728 API \u7f51\u5173\u4e0a\u5f00\u53d1 APISIX \u63d2\u4ef6","permalink":"/zh/blog/2022/02/16/file-logger-api-gateway"},"nextItem":{"title":"\u4e91\u539f\u751f API \u7f51\u5173 APISIX \u96c6\u6210 Splunk HTTP Event Collector","permalink":"/zh/blog/2022/02/10/splunk-apisix-integration"}},"content":"> \u5728 Apache APISIX 2.12.1 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u542f\u7528 Apache APISIX `batch-requests` \u63d2\u4ef6\u4e4b\u540e\u4f1a\u5b58\u5728\u6539\u5199 X-REAL-IP header \u98ce\u9669\uff0c\u73b0\u5c06\u5904\u7406\u4fe1\u606f\u8fdb\u884c\u76f8\u5173\u516c\u544a\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u95ee\u9898\u63cf\u8ff0\\n\\n\u5728 Apache APISIX 2.12.1 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff08\u4e0d\u5305\u542b 2.12.1 \u548c 2.10.4\uff09\uff0c\u542f\u7528 Apache APISIX `batch-requests` \u63d2\u4ef6\u4e4b\u540e\uff0c\u4f1a\u5b58\u5728\u6539\u5199 X-REAL-IP header \u98ce\u9669\u3002\\n\\n\u8be5\u98ce\u9669\u4f1a\u5bfc\u81f4\u4ee5\u4e0b\u4e24\u4e2a\u95ee\u9898\uff1a\\n\\n- \u653b\u51fb\u8005\u901a\u8fc7 `batch-requests` \u63d2\u4ef6\u7ed5\u8fc7 Apache APISIX \u6570\u636e\u9762\u7684 IP \u9650\u5236\u3002\u5982\u7ed5\u8fc7 IP \u9ed1\u767d\u540d\u5355\u9650\u5236\u3002\\n- \u5982\u679c\u7528\u6237\u4f7f\u7528 Apache APISIX \u9ed8\u8ba4\u914d\u7f6e\uff08\u542f\u7528 Admin API \uff0c\u4f7f\u7528\u9ed8\u8ba4 Admin Key \u4e14\u6ca1\u6709\u989d\u5916\u5206\u914d\u7ba1\u7406\u7aef\u53e3\uff09\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7 `batch-requests` \u63d2\u4ef6\u8c03\u7528 Admin API \u3002\\n\\n## \u5f71\u54cd\u7248\u672c\\n\\n- Apache APISIX 1.3 ~ 2.12.1  \u4e4b\u95f4\u7684\u6240\u6709\u7248\u672c\uff08\u4e0d\u5305\u542b 2.12.1 \uff09\\n- Apache APISIX 2.10.0 ~ 2.10.4 LTS \u4e4b\u95f4\u7684\u6240\u6709\u7248\u672c\uff08\u4e0d\u5305\u542b 2.10.4\uff09\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n- \u8be5\u95ee\u9898\u76ee\u524d\u5df2\u5728 2.12.1 \u548c 2.10.4 \u7248\u672c\u4e2d\u5f97\u5230\u89e3\u51b3\uff0c\u8bf7\u5c3d\u5feb\u66f4\u65b0\u81f3\u76f8\u5173\u7248\u672c\u3002\\n- \u5728\u53d7\u5f71\u54cd\u7684 Apache APISIX \u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u5bf9 `conf/config.yaml` \u548c `conf/config-default.yaml` \u6587\u4ef6\u663e\u5f0f\u6ce8\u91ca\u6389 `batch-requests`\uff0c\u5e76\u4e14\u91cd\u542f Apache APISIX \u5373\u53ef\u89c4\u907f\u6b64\u6b21\u98ce\u9669\u3002\\n\\n## \u6f0f\u6d1e\u8be6\u60c5\\n\\n\u6f0f\u6d1e\u4f18\u5148\u7ea7\uff1a\u9ad8\\n\\n\u6f0f\u6d1e\u516c\u5f00\u65f6\u95f4\uff1a2022 \u5e74 2 \u6708 11 \u65e5\\n\\nCVE \u8be6\u7ec6\u4fe1\u606f\uff1ahttps://nvd.nist.gov/vuln/detail/CVE-2022-24112\\n\\n## \u8d21\u732e\u8005\u7b80\u4ecb\\n\\n\u8be5\u6f0f\u6d1e\u7531 Sauercloud \u4e0a\u62a5\u7ed9 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u3002\u611f\u8c22\u5404\u4f4d\u5bf9 Apache APISIX \u793e\u533a\u7684\u8d21\u732e\u3002\\n\\n![Sauercloud](https://static.apiseven.com/202108/1644632196291-6b9bca14-7893-47c7-9f93-99c28ff54044.png)"},{"id":"\u4e91\u539f\u751f API \u7f51\u5173 APISIX \u96c6\u6210 Splunk HTTP Event Collector","metadata":{"permalink":"/zh/blog/2022/02/10/splunk-apisix-integration","source":"@site/blog/2022/02/10/splunk-apisix-integration.md","title":"\u4e91\u539f\u751f API \u7f51\u5173 APISIX \u96c6\u6210 Splunk HTTP Event Collector","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u901a\u8fc7\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4e2d\u7684 splunk-hec-logging \u63d2\u4ef6\u4e0e Splunk HEC \u670d\u52a1\u5b9e\u73b0\u5bf9\u63a5\uff0c\u4ece\u800c\u5c06 APISIX \u7684\u65e5\u5fd7\u53d1\u9001\u5230 Splunk HEC \u670d\u52a1\u4e2d\u3002","date":"2022-02-10T00:00:00.000Z","formattedDate":"2022\u5e742\u670810\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":7.725,"truncated":true,"authors":[{"name":"\u5e05\u8fdb\u8d85","title":"Author","url":"https://github.com/shuaijinchao","image_url":"https://avatars.githubusercontent.com/u/8529452?v=4","imageURL":"https://avatars.githubusercontent.com/u/8529452?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://avatars.githubusercontent.com/u/36651058?v=4","imageURL":"https://avatars.githubusercontent.com/u/36651058?v=4"}],"prevItem":{"title":"Apache APISIX \u5b58\u5728\u6539\u5199 X-REAL-IP header \u7684\u98ce\u9669\u516c\u544a\uff08CVE-2022-24112\uff09","permalink":"/zh/blog/2022/02/11/cve-2022-24112"},"nextItem":{"title":"\u65b0\u63d2\u4ef6 forward-auth \u5df2\u4e0a\u7ebf\uff0c\u8ba4\u8bc1\u529f\u80fd\u53c8\u591a\u4e00\u9879\u9009\u62e9","permalink":"/zh/blog/2022/01/26/apisix-integrate-forward-auth-plugin"}},"content":"> \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u5728\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4e2d\u914d\u7f6e\u548c\u4f7f\u7528 Splunk HEC \u670d\u52a1\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u968f\u7740\u6280\u672f\u7684\u4e0d\u65ad\u8fed\u4ee3\u548c\u4f01\u4e1a\u67b6\u6784\u7684\u4e0d\u65ad\u6f14\u8fdb\uff0c\u7cfb\u7edf\u7684\u590d\u6742\u5ea6\u8d8a\u6765\u8d8a\u9ad8\u3002**\u65e5\u5fd7\u4f5c\u4e3a\u5206\u6790\u548c\u89c2\u6d4b\u7684\u201c\u539f\u6750\u6599\u201d\uff0c\u80fd\u652f\u6301\u548c\u517c\u5bb9\u4e0d\u540c\u7684\u5206\u6790\u5f15\u64ce\u4f1a\u4e3a\u7528\u6237\u5728\u9009\u578b\u548c\u540e\u671f\u8fd0\u7ef4\u8fc7\u7a0b\u4e2d\u964d\u4f4e\u5f88\u5927\u6210\u672c\u3002**\u57fa\u4e8e\u65e5\u5fd7\u7684\u5206\u6790\u548c\u89c2\u6d4b\u4f5c\u4e3a\u4fdd\u969c\u7cfb\u7edf\u7a33\u5b9a\u7684\u57fa\u77f3\uff0c\u5b83\u7684\u89d2\u8272\u975e\u5e38\u91cd\u8981\u3002\\n\\nApache APISIX \u4f5c\u4e3a\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\u4e0d\u4ec5\u5728\u6027\u80fd\u4e0a\u6709\u7740\u826f\u597d\u7684\u8868\u73b0\uff0c\u5e76\u4e14\u5728\u6570\u636e\u548c\u65e5\u5fd7\u7684\u8fd0\u7ef4\u4e0a\u901a\u8fc7\u548c\u793e\u533a\u7528\u6237\u7684\u4ea4\u6d41\u5171\u5efa\u4e5f\u5df2\u7ecf\u652f\u6301\u4e86\u5927\u90e8\u5206\u4e3b\u6d41\u7684\u5f00\u6e90\u53ca\u5546\u4e1a\u65e5\u5fd7\u89e3\u51b3\u65b9\u6848\uff0c\u5305\u62ec\uff1a[HTTP Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/http-logger.md) \u3001[TCP Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/tcp-logger.md)\u3001[Kafka Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/kafka-logger.md)\u3001[UDP Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/udp-logger.md)\u3001[RocketMQ Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/rocketmq-logger.md)\u3001[SkyWalking Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/skywalking-logger.md)\u3001[Aliyun Cloud Logging\uff08SLS\uff09](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/sls-logger.md)\u3001[Google Cloud Logging](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/google-cloud-logging.md) \u7b49\u3002\\n\\n\u6700\u8fd1\u901a\u8fc7\u793e\u533a\u7684\u5171\u5efa\u652f\u6301\uff0cApache APISIX \u7684 Logger \u5168\u5bb6\u6876\u4e2d\u53c8\u591a\u4e86\u4e00\u4f4d\u65b0\u6210\u5458\uff1a[Splunk HEC Logging](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/google-cloud-logging.md)\u3002\\n\\n\u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u5728 Apache APISIX \u4e2d\u914d\u7f6e\u548c\u4f7f\u7528 [Splunk HEC](https://docs.splunk.com/Documentation/Splunk/8.2.3/Data/TroubleshootHTTPEventCollector) \u670d\u52a1\u3002\\n\\n## \u5173\u4e8e Splunk HTTP Event Collector\\n\\n[Splunk](https://www.splunk.com/) \u662f\u4e00\u4e2a\u673a\u5668\u6570\u636e\u7684\u5168\u6587\u641c\u7d22\u5f15\u64ce\uff0c\u53ef\u5e94\u7528\u4e8e\u91c7\u96c6\u3001\u7d22\u5f15\u3001\u641c\u7d22\u548c\u5206\u6790\u5404\u79cd\u5e94\u7528\u6570\u636e\uff0c\u6839\u636e [DB Engines \u7684\u68c0\u7d22\u5f15\u64ce\u6392\u540d](https://db-engines.com/en/ranking/search+engine)\uff0c\u76ee\u524d Splunk \u4f4d\u5217\u7b2c\u4e8c\uff0c\u662f\u4e00\u6b3e\u5e94\u7528\u5e7f\u6cdb\u7684\u5168\u6587\u68c0\u7d22\u8f6f\u4ef6\u3002Splunk \u548c ElasticSearch \u4e00\u6837\uff0c\u662f\u51c6\u5b9e\u65f6\u53ef\u4ee5\u63d0\u4f9b\u4e0d\u95f4\u65ad\u641c\u7d22\u7ed3\u679c\u7684\u6570\u636e\u6d41\u3002\\n\\n[Splunk HTTP Event Collector\uff08HEC\uff09](https://docs.splunk.com/Documentation/Splunk/latest/Data/UsetheHTTPEventCollector) \u662f Splunk \u63d0\u4f9b\u7684 HTTP \u4e8b\u4ef6\u6536\u96c6\u5668\uff0c\u4e3b\u8981\u63d0\u4f9b\u4ee5 HTTP(S) \u534f\u8bae\u5c06\u6570\u636e\u548c\u5e94\u7528\u7a0b\u5e8f\u4e8b\u4ef6\u53d1\u9001\u5230 Splunk \u7684\u80fd\u529b\u3002\\n\\n## \u5173\u4e8e Splunk HEC Logging \u63d2\u4ef6\\n\\n[splunk-hec-logging](https://github.com/apache/apisix/blob/master/docs/zh/latest/plugins/splunk-hec-logging.md) \u63d2\u4ef6\u7528\u4e8e\u5c06 Apache APISIX \u7684\u8bf7\u6c42\u65e5\u5fd7\u8f6c\u53d1\u5230 Splunk \u4e2d\u8fdb\u884c\u5206\u6790\u548c\u5b58\u50a8\u3002\u542f\u7528\u8be5\u63d2\u4ef6\u540e\uff0cApache APISIX \u5c06\u5728 Log \u9636\u6bb5\u83b7\u53d6\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u5e76\u5c06\u5176\u5e8f\u5217\u5316\u4e3a [Splunk Event Data \u683c\u5f0f](https://docs.splunk.com/Documentation/Splunk/latest/Data/FormateventsforHTTPEventCollector#Event_metadata)\u540e\u63d0\u4ea4\u5230\u6279\u5904\u7406\u961f\u5217\u4e2d\u3002\u5f53\u89e6\u53d1\u6279\u5904\u7406\u961f\u5217\u6bcf\u6279\u6b21\u6700\u5927\u5904\u7406\u5bb9\u91cf\uff0c\u6216\u5237\u65b0\u7f13\u51b2\u533a\u7684\u6700\u5927\u65f6\u95f4\u65f6\uff0c\u4f1a\u5c06\u961f\u5217\u4e2d\u7684\u6570\u636e\u63d0\u4ea4\u5230 Splunk HEC \u4e2d\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528 Splunk HEC Logging \u63d2\u4ef6\\n\\n### Splunk \u914d\u7f6e\u6b65\u9aa4\\n\\n#### \u90e8\u7f72 Splunk Enterprise\\n\\n\u8bf7\u53c2\u8003 Splunk \u7684 [\u5b98\u65b9\u5b89\u88c5\u6307\u5357](https://docs.splunk.com/Documentation/Splunk/8.2.3/Installation/Chooseyourplatform) \u8fdb\u884c\u90e8\u7f72\uff0c\u672c\u6587\u5c06\u901a\u8fc7 Docker \u8fdb\u884c\u90e8\u7f72\u6f14\u793a\u3002\\nDocker \u547d\u4ee4\u53c2\u6570\u5982\u4e0b\uff1a\\n\\n```shell\\ndocker run -p 18088:8088 -p 18000:8000 \\\\    # 8088\u4e3aHEC\u7aef\u53e3\uff0c8000\u4e3a\u7ba1\u7406\u540e\u53f0\u7aef\u53e3\\n  -e \\"SPLUNK_PASSWORD=your-password\\" \\\\      # \u7ba1\u7406\u540e\u53f0\u767b\u5f55\u5bc6\u7801\\n  -e \\"SPLUNK_START_ARGS=--accept-license\\" \\\\ # \u63a5\u53d7\u8bb8\u53ef\u8bc1\u6761\u6b3e\uff08Splunk\u9ed8\u8ba4\u5c06\u63d0\u4f9b\u4e00\u5f20Enterprise Trial License\uff09\\n  -e \\"SPLUNK_HEC_TOKEN=your-hec-token\\" \\\\    # \u8bbe\u7f6e\u9ed8\u8ba4HEC\u4ee4\u724c\uff0c\u914d\u7f6e\u6b64\u9879\u540e\u5c06\u521b\u5efa\u4e00\u4e2a\u9ed8\u8ba4\u7684HEC\\n  -itd --rm --name splunk-example splunk/splunk:latest\\n```\\n\\n\u547d\u4ee4\u53c2\u6570\u5177\u4f53\u91ca\u4e49\u53ef\u53c2\u8003\uff1a[Docker Splunk \u6587\u6863](https://splunk.github.io/docker-splunk/)\u3002\\n\\n#### \u914d\u7f6e Splunk HEC\\n\\nDocker \u4e2d\u5df2\u7ecf\u914d\u7f6e\u5e76\u521b\u5efa\u4e86\u9ed8\u8ba4\u7684 HEC\uff0c\u5728\u8fd9\u91cc\u4e0d\u518d\u8fc7\u591a\u8d58\u8ff0\u521b\u5efa HEC \u7684\u6d41\u7a0b\u3002\u5177\u4f53\u624b\u52a8\u521b\u5efa\u7684\u6d41\u7a0b\u53ef\u53c2\u8003\u6587\u6863\uff1a[Set up and use HTTP Event Collector in Splunk Web](https://docs.splunk.com/Documentation/Splunk/8.2.3/Data/UsetheHTTPEventCollector)\u3002\\n\\n#### \u767b\u5f55 Splunk Enterprise \u5e76\u68c0\u67e5 HEC\\n\\n\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee Docker \u7684\u6620\u5c04\u7aef\u53e3\u3002\u56e0\u4e3a\u9700\u8981\u628a\u7ba1\u7406\u540e\u53f0\u7684 `8000` \u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684 `18000` \u7aef\u53e3\uff0c\u6240\u4ee5\u5728\u64cd\u4f5c\u65f6\u53ef\u4ee5\u5728\u5bbf\u4e3b\u673a\u4e0a\u901a\u8fc7\u300c\u56de\u73af\u5730\u5740\u52a0\u7aef\u53e3\u300d\u7684\u65b9\u5f0f\u5728\u6d4f\u89c8\u5668\u8bbf\u95ee\u5373\u53ef\u3002\u4f8b\u5982\uff1ahttp://127.0.0.1:18000\uff0c\u767b\u5f55\u7684\u9ed8\u8ba4\u7528\u6237\u540d\u662f admin\uff0c\u5bc6\u7801\u662f\u5728\u4e0a\u4f8b\u7684\u73af\u5883\u53d8\u91cf\u4e2d\u8bbe\u7f6e\u7684 `SPLUNK_PASSWORD` \u7684\u503c\u3002\\n\\n\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8868\u793a\u767b\u5f55\u6210\u529f\u3002\\n\\n![Splunk \u767b\u5f55\u754c\u9762](https://static.apiseven.com/202108/1644488346684-867cb3a1-a6fd-4dc6-8cb7-f08c1843ac66.png)\\n\\n\u5355\u51fb\u754c\u9762\u53f3\u4e0a\u65b9 \u201cSettings > Data Inputs\u201d \u68c0\u67e5\u9ed8\u8ba4 HEC \u662f\u5426\u8bbe\u7f6e\u6210\u529f\uff1a\\n\\n![\u9ed8\u8ba4 HEC](https://static.apiseven.com/202108/1644488375914-ce04f987-eb8e-4708-93b7-f0685b145fff.png)\\n\\n\u5728 HTTP Event Collector \u7684 Inputs \u5217\u4e2d\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u770b\u5230 HEC \u7684\u6570\u91cf\uff0c\u8868\u793a\u8bbe\u7f6e\u6210\u529f\u3002\\n\\n![HEC \u7684\u6570\u91cf](https://static.apiseven.com/202108/1644488402376-09c44d02-c6aa-4948-8ca7-2b58a310d010.png)\\n\\n\u6b64\u65f6\u53ef\u4ee5\u70b9\u51fb HTTP Event Collector \u8fdb\u5165 HEC \u8be6\u60c5\u5217\u8868\u67e5\u770b HECs \u7684 Token \u4fe1\u606f\u3002\\n\\n![HECs \u7684 Token \u4fe1\u606f](https://static.apiseven.com/202108/1644488428695-db33a594-df06-4857-9421-60bd30cae91e.png)\\n\\nToken Values \u5373\u5728\u4e0a\u6587\u4e2d Docker \u73af\u5883\u53d8\u91cf\u4e2d\u914d\u7f6e\u7684 `SPLUNK_HEC_TOKEN` \u7684\u503c\u3002\\n\\n### Apache APISIX \u914d\u7f6e\u6b65\u9aa4\\n\\n#### \u542f\u7528\u63d2\u4ef6\\n\\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u542f\u7528 `splunk-hec-logging` \u63d2\u4ef6\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\":{\\n        \\"splunk-hec-logging\\":{\\n            \\"endpoint\\":{\\n                // HEC \u7aef\u70b9\u5730\u5740\\n                \\"uri\\":\\"http://127.0.0.1:18088/services/collector\\",\\n                // HEC Token\\n                \\"token\\":\\"BD274822-96AA-4DA6-90EC-18940FB2414C\\"\\n            },\\n            // // \u5237\u65b0\u6279\u5904\u7406\u961f\u5217\u7f13\u51b2\u533a\u7684\u6700\u5927\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\\n            \\"inactive_timeout\\":2,\\n             // \u6bcf\u4e2a\u6279\u5904\u7406\u961f\u5217\u6700\u5927\u5bb9\u7eb3\u65e5\u5fd7\u6761\u76ee\u6570\\n            \\"batch_max_size\\":10\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    },\\n    \\"uri\\":\\"/splunk.do\\"\\n}\'\\n```\\n\\n\u63d2\u4ef6\u53c2\u6570\u8bf4\u660e\u5982\u4e0b\u8868\u6240\u793a\u3002\\n\\n|\u540d\u79f0|\u662f\u5426\u5fc5\u586b|\u9ed8\u8ba4\u503c|\u63cf\u8ff0|\\n|----|----|----|----|\\n|endpoint|\u662f|N/A|Splunk HEC \u7aef\u70b9\u914d\u7f6e\u4fe1\u606f|\\n|endpoint.uri|\u662f|N/A|Splunk HEC \u4e8b\u4ef6\u6536\u96c6API|\\n|endpoint.token|\u662f|N/A|Splunk HEC \u8eab\u4efd\u4ee4\u724c|\\n|endpoint.channel|\u5426|N/A|Splunk HEC \u53d1\u9001\u6e20\u9053\u6807\u8bc6\uff0c\u53c2\u8003\uff1a[About HTTP Event Collector Indexer Acknowledgment](https://docs.splunk.com/Documentation/Splunk/8.2.3/Data/AboutHECIDXAck)|\\n|endpoint.timeout|\u5426|10|Splunk HEC \u6570\u636e\u63d0\u4ea4\u8d85\u65f6\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09|\\n|ssl_verify|\u5426|TRUE|\u542f\u7528 SSL \u9a8c\u8bc1\uff0c \u53c2\u8003\uff1a[OpenResty \u6587\u6863](https://github.com/openresty/lua-nginx-module#tcpsocksslhandshake)|\\n|max_retry_count|\u5426|0|\u4ece\u5904\u7406\u7ba1\u9053\u4e2d\u79fb\u9664\u4e4b\u524d\u7684\u6700\u5927\u91cd\u8bd5\u6b21\u6570|\\n|retry_delay|\u5426|1|\u5982\u679c\u6267\u884c\u5931\u8d25\uff0c\u6d41\u7a0b\u6267\u884c\u5e94\u5ef6\u8fdf\u7684\u79d2\u6570|\\n|buffer_duration|\u5426|60|\u5fc5\u987b\u5148\u5904\u7406\u6279\u6b21\u4e2d\u6700\u65e7\u6761\u76ee\u7684\u6700\u5927\u671f\u9650\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09|\\n|inactive_timeout|\u5426|5|\u5237\u65b0\u7f13\u51b2\u533a\u7684\u6700\u5927\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09|\\n|batch_max_size|\u5426|1000|\u6bcf\u4e2a\u6279\u5904\u7406\u961f\u5217\u53ef\u5bb9\u7eb3\u7684\u6700\u5927\u6761\u76ee\u6570|\\n\\n#### \u53d1\u9001\u8bf7\u6c42\\n\\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5411 Splunk \u53d1\u9001\u8bf7\u6c42\u3002\\n\\n```shell\\n$ curl -i http://127.0.0.1:9080/splink.do\\nHTTP/1.1 200 OK\\nContent-Type: text/html; charset=utf-8\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\nDate: Fri, 10 Dec 2021 09:57:52 GMT\\nServer: APISIX/2.11.0\\n\\nHello, Splunk HEC Logging\\n```\\n\\n#### \u9a8c\u8bc1\u65e5\u5fd7\\n\\n\u767b\u5f55 Splunk \u63a7\u5236\u53f0\uff0c\u70b9\u51fb \u201cSearch & Reporting\u201d\u3002\\n\\n![Splunk \u63a7\u5236\u53f0](https://static.apiseven.com/202108/1644487376250-7c5d32b0-368a-4ee2-9285-38cb0ee571f0.png)\\n\\n\u5728\u641c\u7d22\u8f93\u5165\u6846\u4e2d\u8f93\u5165\uff1a`source=\\"apache-apisix-splunk-hec-logging\\"`\uff0c\u5373\u53ef\u67e5\u8be2\u5230\u53d1\u9001\u7684\u8bf7\u6c42\u65e5\u5fd7\u3002\\n\\n![\u67e5\u8be2\u8bf7\u6c42\u65e5\u5fd7](https://static.apiseven.com/202108/1644487401080-b3b18cf9-f576-4e05-be98-2d5fde34fe8e.png)\\n\\n#### \u505c\u7528\u63d2\u4ef6\\n\\n\u79fb\u9664 `splunk-hec-logging` \u76f8\u5173\u914d\u7f6e\u5373\u53ef\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\":\\"/logging.do\\",\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    },\\n    \\"plugins\\":{\\n    }\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u76ee\u524d\uff0cApache APISIX \u4e5f\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u611f\u5174\u8da3\uff0c\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussion](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u4e5f\u53ef\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002\\n\\n## \u76f8\u5173\u9605\u8bfb\\n\\n- [Apache APISIX \u96c6\u6210 Kafka \u5b9e\u73b0\u9ad8\u6548\u7387\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7](https://apisix.apache.org/zh/blog/2022/01/17/apisix-kafka-integration)\\n- [Apache APISIX \u643a\u624b RocketMQ \u4e3a\u5b9e\u65f6 API \u65e5\u5fd7\u76d1\u63a7\u529f\u80fd\u518d\u4e0b\u4e00\u57ce](https://apisix.apache.org/zh/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin)\\n- [\u6377\u62a5\u9891\u4f20\uff01Apache APISIX \u73b0\u5df2\u652f\u6301\u5bf9\u63a5 Google Cloud Logging](https://apisix.apache.org/zh/blog/2021/12/22/google-logging)\\n- [\u5f3a\u5f3a\u8054\u5408\uff01APISIX \u96c6\u6210 SkyWalking \u6253\u9020\u5168\u65b9\u4f4d\u65e5\u5fd7\u5904\u7406](https://apisix.apache.org/zh/blog/2021/12/07/apisix-integrate-skywalking-plugin)"},{"id":"\u65b0\u63d2\u4ef6 forward-auth \u5df2\u4e0a\u7ebf\uff0c\u8ba4\u8bc1\u529f\u80fd\u53c8\u591a\u4e00\u9879\u9009\u62e9","metadata":{"permalink":"/zh/blog/2022/01/26/apisix-integrate-forward-auth-plugin","source":"@site/blog/2022/01/26/apisix-integrate-forward-auth-plugin.md","title":"\u65b0\u63d2\u4ef6 forward-auth \u5df2\u4e0a\u7ebf\uff0c\u8ba4\u8bc1\u529f\u80fd\u53c8\u591a\u4e00\u9879\u9009\u62e9","description":"\u672c\u6587\u5c06\u4ecb\u7ecd Apache APISIX \u4e2d\u65b0\u589e\u63d2\u4ef6 `forward-auth` \u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u4e3a\u5927\u5bb6\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u8fd9\u6b3e\u8bbe\u8ba1\u7b80\u6d01\u7684\u8ba4\u8bc1\u6a21\u578b\u3002","date":"2022-01-26T00:00:00.000Z","formattedDate":"2022\u5e741\u670826\u65e5","tags":[{"label":"Authentication","permalink":"/zh/blog/tags/authentication"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":4.715,"truncated":true,"authors":[{"name":"\u767d\u6cfd\u5e73","title":"Author","url":"https://github.com/bzp2010","image_url":"https://avatars.githubusercontent.com/u/8078418?v=4","imageURL":"https://avatars.githubusercontent.com/u/8078418?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u4e91\u539f\u751f API \u7f51\u5173 APISIX \u96c6\u6210 Splunk HTTP Event Collector","permalink":"/zh/blog/2022/02/10/splunk-apisix-integration"},"nextItem":{"title":"APISIX \u652f\u6301 gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406","permalink":"/zh/blog/2022/01/25/apisix-grpc-web-integration"}},"content":"> \u672c\u6587\u5c06\u4ecb\u7ecd Apache APISIX \u4e2d\u65b0\u589e\u63d2\u4ef6 `forward-auth` \u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u4e3a\u5927\u5bb6\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u8fd9\u6b3e\u8bbe\u8ba1\u7b80\u6d01\u7684\u8ba4\u8bc1\u6a21\u578b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nForward Auth \u80fd\u5de7\u5999\u5730\u5c06\u8ba4\u8bc1\u4e0e\u6388\u6743\u903b\u8f91\u8f6c\u79fb\u81f3\u4e13\u95e8\u7684\u5916\u90e8\u670d\u52a1\u4e2d\uff0c\u7f51\u5173\u4f1a\u5c06\u7528\u6237\u7684\u8bf7\u6c42\u8f6c\u53d1\u81f3\u8ba4\u8bc1\u670d\u52a1\u4e2d\uff0c\u5e76\u5728\u8ba4\u8bc1\u670d\u52a1\u54cd\u5e94\u975e 20x \u72b6\u6001\u65f6\uff0c\u963b\u6b62\u539f\u6709\u8bf7\u6c42\u5e76\u66ff\u6362\u7ed3\u679c\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u8ba4\u8bc1\u672a\u901a\u8fc7\u65f6\uff0c\u8fd4\u56de\u81ea\u5b9a\u4e49\u62a5\u9519\u6216\u7528\u6237\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u9875\u9762\u3002\u63a5\u4e0b\u6765\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd Apache APISIX \u4e2d\u65b0\u589e\u63d2\u4ef6 `forward-auth` \u7684\u4f7f\u7528\u65b9\u6cd5\u3002\\n\\n## \u539f\u7406\\n\\n![\u63d2\u4ef6\u539f\u7406\u56fe](https://static.apiseven.com/202108/1643096414141-ccbc33c0-7899-445a-a2f8-b6d5341c44df.jpg)\\n\\n\u5173\u4e8e `forward-auth` \u63d2\u4ef6\u5728 Apache APISIX \u4e2d\u7684\u8fd0\u884c\u539f\u7406\u4e0e\u6d41\u7a0b\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5177\u4f53\u603b\u7ed3\u4e3a\u4ee5\u4e0b\u51e0\u6b65\uff1a\\n\\n- \u7b2c\u4e00\u6b65\uff1a\u7531\u5ba2\u6237\u7aef\u5411 APISIX \u53d1\u8d77\u8bf7\u6c42\\n- \u7b2c\u4e8c\u6b65\uff1a\u7531 APISIX \u5411\u7528\u6237\u914d\u7f6e\u7684\u8ba4\u8bc1\u670d\u52a1\u53d1\u8d77\u8bf7\u6c42\\n- \u7b2c\u4e09\u6b65\uff1a\u8ba4\u8bc1\u670d\u52a1\u54cd\u5e94\uff082xx \u6216\u5f02\u5e38\u72b6\u6001\uff09\\n- \u7b2c\u56db\u6b65\uff1aAPISIX \u4f1a\u6839\u636e\u8ba4\u8bc1\u670d\u52a1\u54cd\u5e94\uff0c\u51b3\u5b9a\u5411\u4e0a\u6e38\u8f6c\u53d1\u8bf7\u6c42\u6216\u76f4\u63a5\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u62d2\u7edd\u54cd\u5e94\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u8bbe\u7f6e\u8ba4\u8bc1\u670d\u52a1\\n\\n\u5047\u8bbe\u6709\u8fd9\u6837\u4e00\u9879\u8ba4\u8bc1\u670d\u52a1\uff0c\u7528\u6237\u5411\u5176\u53d1\u9001\u5e26\u6709 Authorization \u8bf7\u6c42\u5934\u7684\u8bf7\u6c42\u3002\u5982\u679c\u8fd9\u4e2a\u6570\u636e\u901a\u8fc7\u9a8c\u8bc1\u5219\u8fd4\u56de 200 \u72b6\u6001\u7801\u548c\u4e00\u4e2a\u540d\u4e3a `X-User-ID` \u7684\u54cd\u5e94\u5934\uff1b\u5982\u679c\u6ca1\u6709\u901a\u8fc7\u9a8c\u8bc1\u5219\u8ba4\u4e3a\u8ba4\u8bc1\u72b6\u6001\u8fc7\u671f\uff0c\u8fd4\u56de 302 \u72b6\u6001\u7801\u548c `Location` \u54cd\u5e94\u5934\u5c06\u5ba2\u6237\u7aef\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762\u3002\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u521b\u5efa\u8def\u7531\u5e76\u5f00\u542f `forward-auth` \u63d2\u4ef6\\n\\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u914d\u7f6e\u4e00\u4e2a\u8def\u7531\u5e76\u5f00\u542f `forward-auth` \u63d2\u4ef6\uff0c\u5c06\u4e0a\u8ff0\u7684\u8ba4\u8bc1\u670d\u52a1\u548c\u4e0a\u6e38\u5e94\u7528\u5bf9\u63a5\u8d77\u6765\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"forward-auth\\": {\\n            \\"address\\": \\"http://127.0.0.1:9080/auth\\",\\n            \\"request_headers\\": [\\"Authorization\\"],\\n            \\"upstream_headers\\": [\\"X-User-ID\\"],\\n            \\"client_headers\\": [\\"Location\\"]\\n        }\\n    },\\n    \\"uri\\": \\"/user\\"\\n}\'\\n```\\n\\n\u4e0a\u8ff0\u914d\u7f6e\u7ec6\u8282\u91ca\u4e49\uff1a\\n\\n- \u5f53\u6709\u8bf7\u6c42\u5339\u914d\u5230\u5f53\u524d\u8def\u7531\u65f6\uff0c\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\u81f3 `address` \u4e2d\u7684\u5730\u5740\uff0c\u5176\u4e2d\u5c06\u9644\u5e26`request_headers` \u4e2d\u5b9a\u4e49\u7684\u8bf7\u6c42\u5934 `Authorization`\uff08\u5373\u914d\u7f6e\u9700\u8981\u7531\u5ba2\u6237\u7aef\u8f6c\u53d1\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684\u8bf7\u6c42\u5934\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u5219\u4e0d\u8f6c\u53d1\u4efb\u4f55\u8bf7\u6c42\u5934\uff09\uff0c\u8ba4\u8bc1\u670d\u52a1\u53ef\u4ee5\u636e\u6b64\u8fdb\u884c\u7528\u6237\u8eab\u4efd\u786e\u8ba4\u3002\\n- \u5982\u679c\u8ba4\u8bc1\u901a\u8fc7\uff0c\u72b6\u6001\u7801\u4e3a 200 \u5e76\u8fd4\u56de\u4e00\u4e2a `upstream_headers` \u4e2d\u5b9a\u4e49\u7684 `X-User-ID`\uff08\u5373\u8ba4\u8bc1\u901a\u8fc7\u65f6\u7531\u8ba4\u8bc1\u670d\u52a1\u8f6c\u53d1\u81f3\u4e0a\u6e38\u7684\u8bf7\u6c42\u5934\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u5219\u4e0d\u8f6c\u53d1\u4efb\u4f55\u8bf7\u6c42\u5934\uff09\u3002\\n- \u5982\u679c\u8ba4\u8bc1\u5931\u8d25\uff0c\u72b6\u6001\u7801\u4e3a 302 \u5e76\u8fd4\u56de\u4e00\u4e2a\u5728 `client_headers` \u4e2d\u5b9a\u4e49\u7684 `Location`\uff08\u5373\u8ba4\u8bc1\u5931\u8d25\u65f6\u7531\u8ba4\u8bc1\u670d\u52a1\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u54cd\u5e94\u5934\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u5219\u4e0d\u8f6c\u53d1\u4efb\u4f55\u54cd\u5e94\u5934\uff09\u3002\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u6d4b\u8bd5\u8bf7\u6c42\\n\\n```shell\\n# \u4f7f\u7528 POST \u8bf7\u6c42\u5e76\u53d1\u9001\u6570\u636e\\ncurl http://127.0.0.1:9080/user \\\\\\n    --header \'Authorization: true\'\\n\\nHTTP/1.1 200 OK\\nContent-Type: application/json\\nContent-Length: 28\\nServer: APISIX/2.11.0\\n\\n{\\"user_id\\":\\"i-am-real-user\\"}\\n\\n# \u4f7f\u7528 GET \u8bf7\u6c42\\ncurl -i http://127.0.0.1:9080/user \\\\\\n    --header \'Authorization: false\'\\n\\nHTTP/1.1 302 FOUND\\nServer: APISIX/2.11.0\\nLocation: https://example.com/auth\\n```\\n\\n### \u8865\u5145\uff1a\u5173\u95ed\u63d2\u4ef6\\n\\n\u5982\u5df2\u4f7f\u7528\u5b8c\u6bd5\uff0c\u53ea\u9700\u79fb\u9664\u8def\u7531\u914d\u7f6e\u4e2d `forward-auth` \u63d2\u4ef6\u76f8\u5173\u914d\u7f6e\u5e76\u4fdd\u5b58\uff0c\u5373\u53ef\u5173\u95ed\u8def\u7531\u4e0a\u7684 Forward Auth \u63d2\u4ef6\u3002\u5f97\u76ca\u4e8e Apache APISIX \u7684\u52a8\u6001\u5316\u7279\u6027\uff0c\u5f00\u542f\u5173\u95ed\u63d2\u4ef6\u7684\u8fc7\u7a0b\u90fd\u4e0d\u9700\u8981\u91cd\u542f Apache APISIX\u3002\\n\\n## \u603b\u7ed3\\n\\n\u60f3\u8981\u83b7\u53d6\u66f4\u591a\u5173\u4e8e `forward-auth` \u63d2\u4ef6\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u5217\u8868\uff0c\u53ef\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/next/plugins/forward-auth)\u3002\u540c\u65f6\uff0c\u5982\u679c\u60a8\u6709\u66f4\u52a0\u590d\u6742\u7684\u8ba4\u8bc1\u6216\u6388\u6743\u5e94\u7528\u573a\u666f\uff0c\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528 `opa` \u63d2\u4ef6\uff0c\u8be5\u63d2\u4ef6\u5141\u8bb8\u4ee5\u53ef\u7f16\u7a0b\u7684\u65b9\u5f0f\u63d0\u4f9b\u66f4\u5f3a\u5927\u7684\u529f\u80fd\u3002\\n\\n\u76ee\u524d\uff0cApache APISIX \u4e5f\u5728\u5f00\u53d1\u5176\u4ed6\u63d2\u4ef6\u4ee5\u652f\u6301\u96c6\u6210\u66f4\u591a\u670d\u52a1\uff0c\u5982\u679c\u60a8\u5bf9\u6b64\u611f\u5174\u8da3\uff0c\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussion](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u4e5f\u53ef\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"APISIX \u652f\u6301 gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406","metadata":{"permalink":"/zh/blog/2022/01/25/apisix-grpc-web-integration","source":"@site/blog/2022/01/25/apisix-grpc-web-integration.md","title":"APISIX \u652f\u6301 gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406","description":"\u901a\u8fc7\u793e\u533a\u7684\u79ef\u6781\u8ba8\u8bba\u548c\u8d21\u732e\uff0cApache APISIX \u53c8\u62d3\u5bbd\u4e86 gRPC \u751f\u6001\u7684\u652f\u6301\u8303\u56f4\u3002\u672c\u6587\u5c06\u4ecb\u7ecd gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406\u7684\u5177\u4f53\u4f7f\u7528\u6b65\u9aa4\u53ca\u7ec6\u8282\u3002","date":"2022-01-25T00:00:00.000Z","formattedDate":"2022\u5e741\u670825\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":7.89,"truncated":true,"authors":[{"name":"\u5e05\u8fdb\u8d85","title":"Author","url":"https://github.com/shuaijinchao","image_url":"https://avatars.githubusercontent.com/u/8529452?v=4","imageURL":"https://avatars.githubusercontent.com/u/8529452?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://avatars.githubusercontent.com/u/36651058?v=4","imageURL":"https://avatars.githubusercontent.com/u/36651058?v=4"}],"prevItem":{"title":"\u65b0\u63d2\u4ef6 forward-auth \u5df2\u4e0a\u7ebf\uff0c\u8ba4\u8bc1\u529f\u80fd\u53c8\u591a\u4e00\u9879\u9009\u62e9","permalink":"/zh/blog/2022/01/26/apisix-integrate-forward-auth-plugin"},"nextItem":{"title":"Apache APISIX 2.12.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/01/25/release-apache-apisix-2.12"}},"content":"> Apache APISIX \u5df2\u7ecf\u652f\u6301\u4e86 gRPC \u534f\u8bae\u4ee3\u7406\uff0c\u4ee5\u53ca\u901a\u8fc7 gRPC Transcode \u63d2\u4ef6\u652f\u6301\u4e86 HTTP(s) \u5230 gRPC Server \u7684\u4ee3\u7406\u3002\u901a\u8fc7\u793e\u533a\u7684\u79ef\u6781\u8ba8\u8bba\u548c\u8d21\u732e\uff0cApache APISIX \u53c8\u62d3\u5bbd\u4e86 gRPC \u751f\u6001\u7684\u652f\u6301\u8303\u56f4\uff1a\u652f\u6301 gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## gRPC Web \u80cc\u666f\u4ecb\u7ecd\\n\\ngRPC \u6700\u521d\u7531\u8c37\u6b4c\u5f00\u53d1\uff0c\u662f\u4e00\u4e2a\u57fa\u4e8e HTTP/2 \u5b9e\u73b0\u7684\u9ad8\u6027\u80fd\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u6846\u67b6\u3002\u4f46\u7531\u4e8e\u6d4f\u89c8\u5668\u6ca1\u6709\u76f4\u63a5\u66b4\u9732 HTTP/2\uff0c\u6240\u4ee5 Web \u5e94\u7528\u7a0b\u5e8f\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528 gRPC\u3002gRPC Web \u662f\u4e00\u4e2a\u6807\u51c6\u5316\u534f\u8bae\uff0c\u5b83\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\\n\\n\u7b2c\u4e00\u4e2a gRPC-web \u5b9e\u73b0\u662f\u5728 2018 \u5e74\u4f5c\u4e3a\u4e00\u4e2a JavaScript \u5e93\u53d1\u5e03\u7684\uff0cWeb \u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u5b83\u76f4\u63a5\u4e0e gRPC \u670d\u52a1\u901a\u4fe1\u3002\u5176\u539f\u7406\u662f\u521b\u5efa\u4e0e HTTP/1.1 \u548c HTTP/2 \u517c\u5bb9\u7684\u7aef\u5230\u7aef gRPC \u7ba1\u9053\uff0c\u7136\u540e\u6d4f\u89c8\u5668\u53d1\u9001\u5e38\u89c4\u7684 HTTP \u8bf7\u6c42\uff0c\u4f4d\u4e8e\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684 gRPC-Web \u4ee3\u7406\u5bf9\u8bf7\u6c42\u548c\u54cd\u5e94\u8fdb\u884c\u8f6c\u6362\u3002\u4e0e gRPC \u7c7b\u4f3c\uff0cgRPC Web \u5728 Web \u5ba2\u6237\u7aef\u548c\u540e\u7aef gRPC \u670d\u52a1\u4e4b\u95f4\u4f7f\u7528\u9884\u5b9a\u4e49\u7684\u5951\u7ea6\u3002Protocol Buffers \u88ab\u7528\u6765\u5e8f\u5217\u5316\u548c\u7f16\u7801\u6d88\u606f\u3002\\n\\n![gRPC-web \u5de5\u4f5c\u539f\u7406](https://static.apiseven.com/202108/1643099754071-1f5c3c68-f2bc-4746-95f5-cc083ace554b.png)\\n\\n\u6709\u4e86 gRPC Web\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u6d4f\u89c8\u5668\u6216 Node \u5ba2\u6237\u7aef\u76f4\u63a5\u8c03\u7528\u540e\u7aef\u7684 gRPC \u5e94\u7528\u7a0b\u5e8f\u3002\u4e0d\u8fc7\uff0c\u5728\u6d4f\u89c8\u5668\u7aef\u4f7f\u7528 gRPC-Web \u8c03\u7528 gRPC \u670d\u52a1\u4e5f\u5b58\u5728\u4e00\u4e9b\u9650\u5236\uff1a\\n\\n- \u4e0d\u652f\u6301\u5ba2\u6237\u7aef\u6d41\u548c\u53cc\u5411\u6d41\u8c03\u7528\u3002\\n- \u8de8\u57df\u8c03\u7528 gRPC \u670d\u52a1\u9700\u8981\u5728\u670d\u52a1\u5668\u7aef\u914d\u7f6e CORS\u3002\\n- gRPC \u670d\u52a1\u5668\u7aef\u5fc5\u987b\u914d\u7f6e\u4e3a\u652f\u6301 gRPC-Web\uff0c\u6216\u8005\u5fc5\u987b\u6709\u7b2c\u4e09\u65b9\u670d\u52a1\u4ee3\u7406\u5728\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u5bf9\u8c03\u7528\u8fdb\u884c\u8f6c\u6362\u3002\\n\\n## Apache APISIX gRPC Web Proxy\\n\\nApache APISIX \u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u652f\u6301 gRPC Web \u534f\u8bae\u7684\u4ee3\u7406\uff0c\u5728 `grpc-web` \u63d2\u4ef6\u4e2d\u5b8c\u6210\u4e86 gRPC Web\u4e0e gRPC Server \u901a\u8baf\u65f6\u7684\u534f\u8bae\u8f6c\u6362\u53ca\u6570\u636e\u7f16\u89e3\u7801\u5de5\u4f5c\uff0c\u5176\u901a\u8baf\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a\\n\\ngRPC Web Client -> Apache APISIX\uff08protocol conversion & data codec\uff09-> gRPC server\\n\\n\u63a5\u4e0b\u6765\u901a\u8fc7\u4e00\u4e2a\u5b8c\u6574\u7684\u793a\u4f8b\u5411\u5927\u5bb6\u6f14\u793a\u600e\u6837\u6784\u5efa\u4e00\u4e2a gRPC Web \u5ba2\u6237\u7aef\uff0c\u5e76\u901a\u8fc7 Apache APISIX \u8fdb\u884c gRPC Web \u8bf7\u6c42\u7684\u4ee3\u7406\u3002\u5728\u4ee5\u4e0b\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f1a\u5c06 Go \u4f5c\u4e3a gRPC Server \u670d\u52a1\u7aef\u5904\u7406\u7a0b\u5e8f\uff0cNode \u4f5c\u4e3a gRPC Web \u5ba2\u6237\u7aef\u8bf7\u6c42\u7a0b\u5e8f\u3002\\n\\n## \u914d\u7f6e Protocol Buffer\\n\\n\u9996\u5148\u8fdb\u884c\u7b2c\u4e00\u6b65\uff0c\u5b89\u88c5 Protocol Buffer \u7f16\u8bd1\u5668\u53ca\u76f8\u5173\u63d2\u4ef6\u3002\\n\\n1. \u5b89\u88c5 `protoc` \u548c `proto-grpc-*` \u63d2\u4ef6\u3002\\n\\n   \u5728\u7f16\u5199\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7a0b\u5e8f\u524d\uff0c\u9700\u8981\u5728\u7cfb\u7edf\u4e2d\u5b89\u88c5 Protocol Buffer \u7f16\u8bd1\u5668 `protoc` \u548c \u7528\u4e8e\u751f\u6210 `.proto` \u7684 Go\u3001JavaScript\u3001gRPC Web \u63a5\u53e3\u4ee3\u7801\u7684 `protoc-gen-go` \u548c `protoc-gen-grpc-web` \u63d2\u4ef6\u3002\\n\\n   \u8bf7\u8fd0\u884c\u4ee5\u4e0b\u811a\u672c\uff0c\u5b89\u88c5\u4e0a\u8ff0\u7ec4\u4ef6\u3002\\n\\n   ```bash\\n   #!/usr/bin/env bash\\n\\n    set -ex\\n\\n    PROTOBUF_VERSION=\\"3.19.0\\"\\n    wget https://github.com/protocolbuffers/protobuf/releases/download/v${PROTOBUF_VERSION}/protoc-${PROTOBUF_VERSION}-linux-x86_64.zip\\n    unzip protoc-${PROTOBUF_VERSION}-linux-x86_64.zip\\n    mv bin/protoc /usr/local/bin/protoc\\n    mv include/google /usr/local/include/\\n    chmod +x /usr/local/bin/protoc\\n\\n    PROTO_GO_PLUGIN_VER=\\"1.2.0\\"\\n    wget https://github.com/grpc/grpc-go/releases/download/cmd/protoc-gen-go-grpc/v${PROTO_GO_PLUGIN_VER}/protoc-gen-go-grpc.v${PROTO_GO_PLUGIN_VER}.linux.amd64.tar.gz\\n    tar -zxvf protoc-gen-go-grpc.v${PROTO_GO_PLUGIN_VER}.linux.amd64.tar.gz\\n    mv protoc-gen-go-grpc /usr/local/bin/protoc-gen-go\\n    chmod +x /usr/local/bin/protoc-gen-go\\n\\n    PROTO_JS_PLUGIN_VER=\\"1.3.0\\"\\n    wget https://github.com/grpc/grpc-web/releases/download/${PROTO_JS_PLUGIN_VER}/protoc-gen-grpc-web-${PROTO_JS_PLUGIN_VER}-linux-x86_64\\n    mv protoc-gen-grpc-web-${PROTO_JS_PLUGIN_VER}-linux-x86_64 /usr/local/bin/protoc-gen-grpc-web\\n    chmod +x /usr/local/bin/protoc-gen-grpc-web\\n   ```\\n\\n2. \u521b\u5efa `SayHello` \u793a\u4f8b `proto` \u6587\u4ef6\u3002\\n\\n   ```go\\n    // a6/echo.proto\\n\\n    syntax = \\"proto3\\";\\n\\n    package a6;\\n\\n    option go_package = \\"./;a6\\";\\n\\n    message EchoRequest {\\n    string message = 1;\\n    }\\n\\n    message EchoResponse {\\n    string message = 1;\\n    }\\n\\n    service EchoService {\\n    rpc Echo(EchoRequest) returns (EchoResponse);\\n    }\\n   ```\\n\\n## \u914d\u7f6e\u670d\u52a1\u7aef\u7a0b\u5e8f\\n\\n1. \u751f\u6210\u670d\u52a1\u7aef Go \u539f\u59cb\u6d88\u606f\u548c\u670d\u52a1/\u5ba2\u6237\u7aef\u5b58\u6839\u3002\\n\\n   ```bash\\n   protoc -I./a6 echo.proto --go_out=plugins=grpc:./a6\\n   ```\\n\\n2. \u5b9e\u73b0\u670d\u52a1\u7aef\u5904\u7406\u7a0b\u5e8f\u63a5\u53e3\u3002\\n\\n   ```go\\n   // a6/echo.impl.go\\n\\n    package a6\\n\\n    import (\\n    \\"errors\\"\\n    \\"golang.org/x/net/context\\"\\n    )\\n\\n    type EchoServiceImpl struct {\\n    }\\n\\n    func (esi *EchoServiceImpl) Echo(ctx context.Context, in *EchoRequest) (*EchoResponse, error) {\\n    if len(in.Message) <= 0 {\\n        return nil, errors.New(\\"message invalid\\")\\n    }\\n    return &EchoResponse{Message: \\"response: \\" + in.Message}, nil\\n    }\\n   ```\\n\\n3. \u670d\u52a1\u7aef\u7a0b\u5e8f\u8fd0\u884c\u5165\u53e3\u6587\u4ef6\u3002\\n\\n   ```go\\n   // server.go\\n    package main\\n\\n    import (\\n    \\"fmt\\"\\n    \\"log\\"\\n    \\"net\\"\\n\\n    \\"apisix.apache.org/example/a6\\"\\n    \\"google.golang.org/grpc\\"\\n    )\\n\\n    func main() {\\n    lis, err := net.Listen(\\"tcp\\", fmt.Sprintf(\\":%d\\", 50001))\\n    if err != nil {\\n        log.Fatalf(\\"failed to listen: %v\\", err)\\n    }\\n\\n    grpcServer := grpc.NewServer()\\n    a6.RegisterEchoServiceServer(grpcServer, &a6.EchoServiceImpl{})\\n\\n    if err = grpcServer.Serve(lis); err != nil {\\n        log.Fatalf(\\"failed to serve: %s\\", err)\\n    }\\n    }\\n   ```\\n\\n4. \u7f16\u8bd1\u5e76\u542f\u52a8\u670d\u52a1\u7aef\u670d\u52a1\u3002\\n\\n   ```bash\\n   go build -o grpc-server server.go\\n   ./grpc-server\\n   ```\\n\\n## \u914d\u7f6e\u5ba2\u6237\u7aef\u7a0b\u5e8f\\n\\n1. \u751f\u6210\u5ba2\u6237\u7aef `proto` \u4ee3\u7801\\n\\n   \u751f\u6210\u5ba2\u6237\u7aef JavaScript \u539f\u59cb\u6d88\u606f\u3001\u670d\u52a1/\u5ba2\u6237\u7aef\u5b58\u6839\u548c gRPC Web \u7684 JavaScript \u7684\u63a5\u53e3\u4ee3\u7801\u3002\\n   gRPC Web \u7684 `proto` \u63d2\u4ef6\u63d0\u4f9b\u4e86\u4e24\u79cd\u4ee3\u7801\u751f\u6210\u6a21\u5f0f\uff1a\\n\\n   1. mode=grpcwebtext\uff1a \u9ed8\u8ba4\u751f\u6210\u7684\u4ee3\u7801\u4ee5 grpc-web-text \u683c\u5f0f\u53d1\u9001 payload\\n\\n   - Content-type\uff1a application/grpc-web-text\\n   - Payload \u4f7f\u7528 base64 \u7f16\u7801\\n   - \u652f\u6301\u4e00\u5143\u548c\u670d\u52a1\u5668\u6d41\u5f0f\u8c03\u7528\\n\\n   1. mode=grpcweb\uff1a\u4ee5\u4e8c\u8fdb\u5236 protobuf \u683c\u5f0f\u53d1\u9001 payload\\n\\n   - Content-type\uff1a application/grpc-web+proto\\n   - Payload \u91c7\u7528\u4e8c\u8fdb\u5236 protobuf \u683c\u5f0f\\n   - \u76ee\u524d\u4ec5\u652f\u6301\u4e00\u5143\u8c03\u7528\\n  \\n  ```bash\\n  $ protoc -I=./a6 echo.proto --js_out=import_style=commonjs:./a6 --grpc-web_out=import_style=commonjs,mode=grpcweb:./a6\\n  ```\\n\\n2. \u5b89\u88c5\u5ba2\u6237\u7aef\u4f9d\u8d56\u5e93\\n\\n   ```shell\\n   $ npm i grpc-web\\n   $ npm i google-protobuf\\n   ```\\n\\n3. \u5ba2\u6237\u7aef\u6267\u884c\u5165\u53e3\u6587\u4ef6\\n\\n   ```shell\\n   // client.js\\n   const {EchoRequest} = require(\'./a6/echo_pb\');\\n   const {EchoServiceClient} = require(\'./a6/echo_grpc_web_pb\');\\n   // \u8fde\u63a5\u5230 Apache APISIX \u7684\u5165\u53e3\\n   let echoService = new EchoServiceClient(\'http://127.0.0.1:9080\');\\n\\n   let request = new EchoRequest();\\n   request.setMessage(\\"hello\\")\\n\\n   echoService.echo(request, {}, function (err, response) {\\n       if (err) {\\n            console.log(err.code);\\n            console.log(err.message);\\n        } else {\\n            console.log(response.getMessage());\\n        }\\n    });\\n   ```\\n\\n4. \u6700\u7ec8\u9879\u76ee\u7ed3\u6784\\n\\n   ```bash\\n   $ tree .\\n    \u251c\u2500\u2500 a6\\n    \u2502   \u251c\u2500\u2500 echo.impl.go\\n    \u2502   \u251c\u2500\u2500 echo.pb.go\\n    \u2502   \u251c\u2500\u2500 echo.proto\\n    \u2502   \u251c\u2500\u2500 echo_grpc_web_pb.js\\n    \u2502   \u2514\u2500\u2500 echo_pb.js\\n    \u251c\u2500\u2500 client.js\\n    \u251c\u2500\u2500 server.go\\n    \u251c\u2500\u2500 go.mod\\n    \u251c\u2500\u2500 go.sum\\n    \u251c\u2500\u2500 package.json\\n    \u2514\u2500\u2500 package-lock.json\\n   ```\\n\\n\u5b8c\u6210\u4e0a\u8ff0\u7684\u6b65\u9aa4\u4e4b\u540e\uff0c\u4f60\u5df2\u7ecf\u914d\u7f6e\u4e86\u628a gRPC Server \u7684\u670d\u52a1\u7aef\u7a0b\u5e8f\u548c gRPC Web \u7684\u5ba2\u6237\u7aef\u7a0b\u5e8f\uff0c\u5e76\u4e14\u542f\u52a8\u4e86\u670d\u52a1\u7aef\u7a0b\u5e8f\uff0c\u5b83\u5c06\u901a\u8fc7 `50001` \u7aef\u53e3\u63a5\u6536\u8bf7\u6c42\u3002\\n\\n## \u914d\u7f6e Apache APISIX\\n\\n\u63a5\u4e0b\u6765\u53ea\u9700\u5728 Apache APISIX \u8def\u7531\u7684\u63d2\u4ef6\u914d\u7f6e\u4e2d\u542f\u7528 `grpc-web` \u63d2\u4ef6\uff0c\u5373\u53ef\u8fdb\u884c gRPC Web \u8bf7\u6c42\u7684\u4ee3\u7406\u3002\\n\\n1. \u542f\u7528 `grpc-web` \u4ee3\u7406\u63d2\u4ef6\\n\\n   \u542f\u7528 `grpc-web` \u4ee3\u7406\u63d2\u4ef6\uff0c\u8def\u7531\u5fc5\u987b\u4f7f\u7528**\u524d\u7f00\u5339\u914d**\u6a21\u5f0f\uff08\u4f8b\u5982\uff1a`/* \u6216 /grpc/example/*`\uff09\uff0c \u56e0 gRPC Web \u5ba2\u6237\u7aef\u4f1a\u5728 URI \u4e2d\u4f20\u9012 `proto` \u4e2d\u58f0\u660e\u7684\u5305\u540d\u79f0\u3001\u670d\u52a1\u63a5\u53e3\u540d\u79f0\u3001\u65b9\u6cd5\u540d\u79f0\u7b49\u4fe1\u606f\uff08\u4f8b\u5982\uff1a`/path/a6.EchoService/Echo`\uff09\uff0c**\u4f7f\u7528\u7edd\u5bf9\u5339\u914d\u65f6\u4f1a\u4f7f\u63d2\u4ef6\u65e0\u6cd5\u4ece URI \u4e2d\u63d0\u53d6 `proto` \u4fe1\u606f**\u3002\\n\\n   ```shell\\n   $ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n    {\\n        \\"uri\\":\\"/*\\", // \u524d\u7f00\u5339\u914d\u6a21\u5f0f\\n        \\"plugins\\":{\\n            \\"grpc-web\\":{} //\u5f00\u542f gRPC Web \u4ee3\u7406\\n        },\\n        \\"upstream\\":{\\n            \\"scheme\\":\\"grpc\\",\\n            \\"type\\":\\"roundrobin\\",\\n            \\"nodes\\":{\\n                \\"127.0.0.1:50001\\":1 // gRPC Server Listen \u5730\u5740\u548c\u7aef\u53e3\\n            }\\n        }\\n    }\'\\n   ```\\n\\n2. \u9a8c\u8bc1 gRPC Web \u4ee3\u7406\u8bf7\u6c42\\n\\n   \u901a\u8fc7 Node \u6267\u884c `client.js` \u5373\u53ef\u5411 Apache APISIX \u53d1\u9001 gRPC Web \u534f\u8bae\u8bf7\u6c42\u3002\\n   \u4e0a\u8ff0\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u5904\u7406\u903b\u8f91\u5206\u522b\u662f\uff1a\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e00\u6761\u6d88\u606f\u5185\u5bb9\u662f `hello`\uff0c\u670d\u52a1\u7aef\u6536\u5230\u6d88\u606f\u540e\u54cd\u5e94 `response: hello`\uff0c\u6267\u884c\u7ed3\u679c\u5982\u4e0b\u3002\\n\\n   ```shell\\n   $ node client.js\\n   response: hello\\n   ```\\n\\n3. \u5173\u95ed `grpc-web` \u4ee3\u7406\u63d2\u4ef6\\n\\n   \u53ea\u9700\u5c06\u8def\u7531\u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 grpc-web \u5c5e\u6027\u79fb\u9664\u5373\u53ef\u3002\\n\\n   ```shell\\n   $ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n    {\\n        \\"uri\\":\\"/*\\",\\n        \\"plugins\\":{\\n        },\\n        \\"upstream\\":{\\n            \\"scheme\\":\\"grpc\\",\\n            \\"type\\":\\"roundrobin\\",\\n            \\"nodes\\":{\\n                \\"127.0.0.1:50001\\":1\\n            }\\n        }\\n    }\'\\n   ```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u7684 `grpc-web` \u63d2\u4ef6\u8bb2\u89e3\u53ca\u5b9e\u6218\u6848\u4f8b\u3002\\n\\n\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"Apache APISIX 2.12.0 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2022/01/25/release-apache-apisix-2.12","source":"@site/blog/2022/01/25/release-apache-apisix-2.12.md","title":"Apache APISIX 2.12.0 \u6b63\u5f0f\u53d1\u5e03","description":"APISIX \u5728\u5373\u5c06\u5230\u6765\u7684\u65b0\u6625\u4f73\u8282\uff0c\u5e26\u6765 2022 \u5e74\u7b2c\u4e00\u4e2a\u5e26\u6709\u65b0\u529f\u80fd\u7684\u7248\u672c\u3002\u652f\u6301\u66f4\u591a\u9274\u6743\u63d2\u4ef6\u548c Serverless \u96c6\u6210\uff0c\u4e30\u5bcc\u65e5\u5fd7\u529f\u80fd\u53ca\u591a\u8bed\u8a00\u63d2\u4ef6\u7b49\u7ec6\u8282\u3002","date":"2022-01-25T00:00:00.000Z","formattedDate":"2022\u5e741\u670825\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":7.145,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","title":"Author","url":"https://github.com/spacewander","image_url":"https://avatars.githubusercontent.com/u/4161644?v=4","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"APISIX \u652f\u6301 gRPC Web \u534f\u8bae\u8bf7\u6c42\u4ee3\u7406","permalink":"/zh/blog/2022/01/25/apisix-grpc-web-integration"},"nextItem":{"title":"\u76f4\u64ad\u9884\u544a | \u5f00\u6e90+\u4e91\u539f\u751f\u52a9\u529b\u4f01\u4e1a\u4e0a\u4e91\u4e0e\u884c\u52a8\u843d\u5730","permalink":"/zh/blog/2022/01/24/apisix-with-qingcloud-meetup"}},"content":"> \u7ee7 2.11.0 \u7248\u672c\u53d1\u5e03\u4e4b\u540e\uff0cApache APISIX \u4e5f\u5728\u5373\u5c06\u5230\u6765\u7684\u65b0\u6625\u4f73\u8282\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765 2022 \u5e74\u7b2c\u4e00\u4e2a\u5e26\u6709\u65b0\u529f\u80fd\u7684\u7248\u672c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u65b0\u529f\u80fd\uff1a\u66f4\u591a\u7684 Serverless \u96c6\u6210\\n\\n\u8fd8\u8bb0\u5f97\u5728\u4e0a\u4e2a\u7248\u672c\u91cc\uff0cApache APISIX \u589e\u52a0\u4e86\u5bf9 Azure Function \u7684\u652f\u6301\u3002\u800c\u8fd9\u6b21\u65b0\u7248\u672c\u4e2d\u4e5f\u662f\u7528\u610f\u6ee1\u6ee1\uff0c\u5728\u529f\u80fd\u4e0a\u53c8\u52a0\u5165\u4e86\u5bf9\u66f4\u591a Serverless \u5382\u5546\u7684\u652f\u6301\u3002\\n\\n\u5982\u4eca\u7528\u6237\u4e5f\u53ef\u4ee5\u5728 Apache APISIX \u4e2d\u7ed3\u5408 AWS Lambda \u548c Apache OpenWhisk\uff0c\u5728\u7f51\u5173\u4e0a\u8fdb\u884c\u7279\u5b9a\u51fd\u6570\u7684\u66b4\u9732\u3002\\n\\n## \u65b0\u529f\u80fd\uff1a\u66f4\u591a\u7684\u9274\u6743\u63d2\u4ef6\\n\\n\u6b64\u6b21\u7684\u65b0\u7248\u672c\uff0c\u8fd8\u5c06\u5e26\u6765\u4e24\u4e2a\u4f17\u4eba\u7fd8\u9996\u4ee5\u76fc\u7684\u65b0\u63d2\u4ef6\uff1a`forward-auth` \u548c `opa`\u3002\\n\\n- forward-auth \u63d2\u4ef6\u8ddf Traefik \u7684\u540c\u540d\u63d2\u4ef6\u529f\u80fd\u7c7b\u4f3c\uff0c\u8be5\u63d2\u4ef6\u53ef\u4ee5\u5141\u8bb8\u628a\u5f53\u524d\u8bf7\u6c42\u7684\u4fe1\u606f\u53d1\u9001\u7ed9\u5916\u90e8\u670d\u52a1\u8fdb\u884c\u9274\u6743\u3002\\n- opa \u63d2\u4ef6\u5219\u6574\u5408\u4e86\u8457\u540d\u7684 Open Policy Agent\uff0c\u8be5\u63d2\u4ef6\u53ef\u4ee5\u901a\u8fc7 OPA \u6765\u5b8c\u6210\u590d\u6742\u7684\u9274\u6743\u529f\u80fd\u3002\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u4e24\u4e2a\u63d2\u4ef6\uff0c\u5c06\u4e3a Apache APISIX \u7684\u9274\u6743\u529f\u80fd\u9526\u4e0a\u6dfb\u82b1\uff0c\u7ed9\u7528\u6237\u5e26\u6765\u66f4\u591a\u4e30\u5bcc\u548c\u4e0a\u624b\u7b80\u5355\u7684\u9274\u6743\u64cd\u4f5c\u3002\\n\\n## \u65b0\u529f\u80fd\uff1a\u66f4\u591a\u7684\u65e5\u5fd7\u529f\u80fd\\n\\n\u9664\u4e86\u4e0a\u8fb9\u63d0\u5230\u7684\u9274\u6743\u63d2\u4ef6\uff0c\u672c\u6b21\u65b0\u7248\u672c\u8fd8\u5c06\u5e26\u6765\u4e09\u4e2a\u65b0\u7684\u65e5\u5fd7\u63d2\u4ef6\uff1a`google-cloud-logging`\u3001`splunk-hec-logging` \u4ee5\u53ca `rocketmq-logger`\u3002\\n\\n\u4ece\u63d2\u4ef6\u540d\u79f0\u4e0a\u4e5f\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u901a\u8fc7\u4e0a\u8ff0\u4e09\u4e2a\u63d2\u4ef6\u53ef\u4ee5\u628a\u65e5\u5fd7\u5206\u522b\u53d1\u9001\u5230 Google Cloud\u3001Splunk \u548c Apache RocketMQ\u3002\u672a\u6765\uff0cApache APISIX \u5c06\u4f1a\u5bf9\u63a5\u8d8a\u6765\u8d8a\u591a\u7684\u65e5\u5fd7\u670d\u52a1\u5546\u548c\u5f00\u6e90 Broker\uff0c\u8ba9\u65e5\u5fd7\u5904\u7406\u53d8\u5f97\u66f4\u52a0\u8f7b\u677e\u3002\\n\\n### \u652f\u6301\u8bb0\u5f55\u54cd\u5e94\u4f53\\n\\n\u540c\u65f6\uff0c\u6b64\u6b21 2.12.0 \u7248\u672c\u8fd8\u5728\u65e5\u5fd7\u5c42\u9762\u652f\u6301\u8bb0\u5f55\u54cd\u5e94\u4f53\u3002\u4e0e Apache APISIX \u5176\u4ed6\u529f\u80fd\u4e00\u6837\uff0c\u8be5\u529f\u80fd\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8868\u8fbe\u5f0f\u8fdb\u884c\u52a8\u6001\u5f00\u542f\u3002\u8fd9\u6837\u5728\u4f7f\u7528\u4e2d\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4ec5\u5728\u4e0a\u6e38\u8fd4\u56de\u7279\u5b9a\u7684 Content-Type \u548c Content-Length \u65f6\u8fdb\u884c\u65e5\u5fd7\u8bb0\u5f55\uff0c\u4e0d\u7528\u518d\u53bb\u987e\u8651\u5168\u91cf\u91c7\u96c6\u54cd\u5e94\u4f53\u800c\u5e26\u6765\u7684\u95ee\u9898\u4e86\u3002\\n\\n\u5177\u4f53\u793a\u4f8b\u53ef\u53c2\u8003\u4e0b\u65b9\uff1a\\n\\n```json\\n{\\n    \\"plugins\\": {\\n        \\"kafka-logger\\": {\\n            \\"broker_list\\" : {\\n                \\"127.0.0.1\\":9092\\n            },\\n            \\"kafka_topic\\" : \\"test2\\",\\n            \\"include_resp_body\\": true,\\n            \\"include_resp_body_expr\\": [\\n                [\\n                    \\"sent_http_content_length\\",\\n                    \\"<\\",\\n                    \\"4096\\"\\n                ],\\n                [\\n                    \\"sent_http_content_type\\",\\n                    \\"==\\",\\n                    \\"application/json\\"\\n                ],\\n            ]\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"uri\\": \\"/hello\\"\\n}\\n```\\n\\n> \u4e0a\u8ff0\u914d\u7f6e\u4f1a\u4ec5\u5728 Content-Length < 4096 \u4e14 Content-Type \u4e3a \\"application/json\\" \u624d\u8bb0\u5f55\u65e5\u5fd7\u3002\\n\\n### \u652f\u6301\u6ce8\u518c\u81ea\u5b9a\u4e49\u53d8\u91cf\\n\\n\u53e6\u4e00\u4e2a\u8ddf\u65e5\u5fd7\u7d27\u5bc6\u76f8\u5173\u7684\u529f\u80fd\uff0c\u5c31\u662f\u65b0\u7248\u672c\u7684 Apache APISIX \u5df2\u652f\u6301\u6ce8\u518c\u81ea\u5b9a\u4e49\u53d8\u91cf\u3002\u540c\u65f6\u7ed3\u5408 APISIX \u7684\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5b8c\u5168\u81ea\u5b9a\u4e49\u4e0a\u62a5\u7684\u65e5\u5fd7\u5185\u5bb9\u3002\u5373\u65e0\u9700\u4fee\u6539\u5177\u4f53\u7684\u65e5\u5fd7\u63d2\u4ef6\uff0c\u5c31\u80fd\u5b9e\u73b0\u65e5\u5fd7\u751f\u6210\u548c\u4e0a\u62a5\u7684\u89e3\u8026\u5408\u3002\u8fd9\u91cc\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u793a\u4f8b\u8fdb\u884c\u7b80\u5355\u6f14\u793a\u4e00\u4e0b\u3002\\n\\n\u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u5728\u81ea\u5df1\u7684\u63d2\u4ef6\u4e2d\u6ce8\u518c\u4e00\u4e2a a6_route_labels \u7684\u53d8\u91cf\uff1a\\n\\n```c\\nlocal core = require \\"apisix.core\\"\\n\\ncore.ctx.register_var(\\"a6_route_labels\\", function(ctx)\\n    local route = ctx.matched_route and ctx.matched_route.value\\n    if route and route.labels then\\n        return route.labels\\n    end\\n    return nil\\nend)\\n```\\n\\n\u5e76\u5728\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f\u4e2d\u4f7f\u7528\u5b83\uff1a\\n\\n```json\\n{\\n    \\"log_format\\": {\\n        \\"host\\": \\"$host\\",\\n        \\"labels\\": \\"$a6_route_labels\\",\\n        \\"client_ip\\": \\"$remote_addr\\"\\n    }\\n}\\n```\\n\\n\u5047\u8bbe\u6211\u4eec\u7684 Route \u957f\u8fd9\u6837\uff1a\\n\\n```json\\n{\\n    \\"plugins\\": {\\n        \\"http-logger\\": {\\n            \\"uri\\": \\"http://127.0.0.1:1980/log\\",\\n            \\"batch_max_size\\": 1,\\n            \\"concat_method\\": \\"json\\"\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1982\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"labels\\": {\\n        \\"k\\": \\"v\\"\\n    },\\n    \\"uri\\": \\"/hello\\"\\n}\\n```\\n\\n\u6700\u7ec8\u5c31\u4f1a\u6536\u5230\u5982\u4e0b\u6240\u793a\u7684\u65e5\u5fd7\uff1a\\n\\n```\\n{\\"client_ip\\":\\"127.0.0.1\\",\\"host\\":\\"localhost\\",\\"labels\\":{\\"k\\":\\"v\\"},\\"route_id\\":\\"1\\"}\\n```\\n\\n## \u65b0\u529f\u80fd\uff1aL4 \u4ee3\u7406\u652f\u6301 TLS over TCP \u4e0a\u6e38\\n\\n\u5728 2.12.0 \u7248\u672c\u4e2d\u8fd8\u5f15\u5165\u4e86\u65b0\u7684 Upstream Scheme\uff0c\u73b0\u5728 Apache APISIX \u5df2\u652f\u6301\u4ee3\u7406\u5230 TLS over TCP \u4e0a\u6e38\u4e86\u3002\\n\\n\u5177\u4f53\u505a\u6cd5\u53ef\u53c2\u8003\u4e0b\u65b9\uff0c\u53ea\u9700\u5728 Upstream \u914d\u7f6e\u4e2d\u6307\u660e Scheme \u4e3a TLS \u5373\u53ef\u3002\\n\\n```json\\n{\\n    \\"scheme\\": \\"tls\\",\\n    \\"nodes\\": {\\n        \\"127.0.0.1:1995\\": 1\\n    },\\n    \\"type\\": \\"roundrobin\\"\\n}\\n```\\n\\n\u81f3\u6b64 Apache APISIX \u7684 TCP \u4ee3\u7406\u529f\u80fd\u5f97\u5230\u4e86 TLS \u5168\u65b9\u4f4d\u7684\u652f\u6301\u3002\u6b64\u5916\uff0c\u6211\u4eec\u8fd8\u652f\u6301\u5728\u9759\u6001\u6587\u4ef6\u4e2d\u914d\u7f6e L4 \u4ee3\u7406\u7684 Access Log\uff1a\\n\\n```\\nstream:\\n    enable_access_log: false         # enable access log or not, default false\\n    access_log: logs/access_stream.log\\n    access_log_format: \\"$remote_addr [$time_local] $protocol $status $bytes_sent $bytes_received $session_time\\"\\n                                            # create your custom log format by visiting http://nginx.org/en/docs/varindex.html\\n    access_log_format_escape: default       # allows setting json or default characters escaping in variables\\n```\\n\\n## \u66f4\u65b0\uff1a\u591a\u8bed\u8a00\u63d2\u4ef6\u6301\u7eed\u5b8c\u5584\\n\\n### WASM \u751f\u6001\u529f\u80fd\u66f4\u52a0\u4e30\u5bcc\\n\\n\u5728\u4e4b\u524d\u7248\u672c\u4e2d\uff0cApache APISIX \u5df2\u5f00\u653e\u4e86\u5bf9 WASM \u751f\u6001\u7684\u652f\u6301\u3002\u800c\u5728 2.12.0 \u7248\u672c\u4e2d\uff0c\u9488\u5bf9 WASM \u751f\u6001\u53c8\u505a\u4e86\u4e0d\u5c11\u7684\u66f4\u65b0\u7ec6\u8282\u3002\\n\\n\u76ee\u524d Apache APISIX \u5df2\u7ecf\u652f\u6301\u5728 header_filter \u7684\u9636\u6bb5\u8fd0\u884c WASM \u4ee3\u7801\uff0c\u5f25\u8865\u4e86\u73b0\u6709\u5916\u90e8\u63d2\u4ef6\u65e0\u6cd5\u4fee\u6539\u54cd\u5e94\u7684\u4e0d\u8db3\u3002\\n\\n\u6b64\u5916\uff0c\u6211\u4eec\u8fd8\u652f\u6301\u5728 WASM \u91cc\u9762\u901a\u8fc7 Apache APISIX \u8fd9\u4e2a\u5bbf\u4e3b\u8fdb\u884c HTTP \u901a\u8baf\u3002\u501f\u52a9\u8fd9\u4e00\u529f\u80fd\uff0c\u6211\u4eec\u7528 WASM \u4e5f\u91cd\u65b0\u5b9e\u73b0\u4e86 forward-auth \u63d2\u4ef6\u3002\u8be5\u63d2\u4ef6\u7684\u529f\u80fd\u51e0\u4e4e\u548c Lua \u7248\u672c\u4e00\u6a21\u4e00\u6837\uff0c\u751a\u81f3\u8fde\u6d4b\u8bd5\u7528\u4f8b\u4e5f\u662f\u5728 Lua \u7248\u672c\u4e0a\u6539\u4e86\u4e0b\u540d\u5b57\u5c31\u80fd\u901a\u8fc7\u4e86\u3002\\n\\n### Java Plugin Runner \u6700\u65b0\u7248\u672c\u53d1\u5e03\\n\\n\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u6ca1\u6709\u5fd8\u8bb0\u9488\u5bf9\u73b0\u6709\u7684\u5916\u90e8\u63d2\u4ef6\u8fdb\u884c\u66f4\u65b0\uff0c\u672c\u6b21 2.12.0 \u7248\u672c\u4e2d\uff0cApache APISIX \u5df2\u5141\u8bb8\u5916\u90e8\u63d2\u4ef6\u83b7\u53d6\u8bf7\u6c42\u4f53\u3002\\n\\n\u6bd4\u5982\u6700\u8fd1\u53d1\u5e03\u7684 Java Plugin Runner \u7b2c\u4e8c\u7248\u5c31\u5305\u542b\u4e86\u8fd9\u4e00\u529f\u80fd\u3002\u65b0\u7248\u672c\u7684 Java Plugin Runner \u8fd8\u652f\u6301\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u83b7\u53d6 APISIX \u53d8\u91cf\u3002\\n\\n## \u66f4\u591a\u7ec6\u8282\\n\\n\u9664\u4e86\u4e0a\u8ff0\u65b0\u529f\u80fd\u548c\u7ec4\u4ef6\u5916\uff0cApache APISIX 2.12.0 \u7248\u672c\u8fd8\u66f4\u65b0\u4e86\u5982\u4e0b\u529f\u80fd\uff1a\\n\\n- gRPC-Web \u7684\u652f\u6301\uff1a\u7ee7 gRPC \u4ee3\u7406\u3001HTTP \u8f6c gRPC \u4e4b\u540e\uff0c\u6211\u4eec\u8fce\u6765\u4e86 gRPC \u5bb6\u65cf\u7684\u7b2c\u4e09\u4e2a\u6210\u5458\u3002\u73b0\u5728 Apache APISIX \u4e5f\u652f\u6301\u4ee3\u7406 gRPC Web \u534f\u8bae\u4e86\u3002\\n- limit-count \u7684\u589e\u5f3a\uff1a\u5982\u4eca limit-count \u63d2\u4ef6\u7684\u8ba1\u6570\u5668\u5df2\u7ecf\u652f\u6301\u5728\u8bf7\u6c42\u95f4\u3001\u8def\u7531\u95f4\u8fdb\u884c\u5171\u4eab\uff0c\u53ef\u4ee5\u8bf4\u662f\u76f8\u5f53\u7075\u6d3b\u4e86\u3002\\n\\n\u66f4\u591a\u5173\u4e8e Apache APISIX 2.12.0 \u7684\u66f4\u65b0\u7ec6\u8282\uff0c\u53ef\u4ee5\u67e5\u770b\u672c\u6b21\u53d1\u5e03\u5bf9\u5e94\u7684 [Change log](https://github.com/apache/apisix/blob/release/2.12/CHANGELOG.md#2120)\u3002\\n\\n## \u4e0b\u8f7d\\n\\n\u60f3\u8981\u83b7\u53d6\u6700\u65b0\u7684 Apache APISIX 2.12.0 \u7248\u672c\uff0c\u53ef\u901a\u8fc7\u4ee5\u4e0b\u8def\u5f84\u4e0b\u8f7d\uff1a\\n\\n- \u6e90\u4ee3\u7801\uff1a\u8bf7\u8bbf\u95ee[\u4e0b\u8f7d\u9875\u9762](https://apisix.apache.org/downloads/)\\n- \u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\uff1a\u8bf7\u8bbf\u95ee[\u5b89\u88c5\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/how-to-build/)"},{"id":"\u76f4\u64ad\u9884\u544a | \u5f00\u6e90+\u4e91\u539f\u751f\u52a9\u529b\u4f01\u4e1a\u4e0a\u4e91\u4e0e\u884c\u52a8\u843d\u5730","metadata":{"permalink":"/zh/blog/2022/01/24/apisix-with-qingcloud-meetup","source":"@site/blog/2022/01/24/apisix-with-qingcloud-meetup.md","title":"\u76f4\u64ad\u9884\u544a | \u5f00\u6e90+\u4e91\u539f\u751f\u52a9\u529b\u4f01\u4e1a\u4e0a\u4e91\u4e0e\u884c\u52a8\u843d\u5730","description":"1 \u6708 28 \u65e5\uff0cApache APISIX \u793e\u533a\u5c06\u8054\u5408\u9752\u4e91\u4e3a\u5927\u5bb6\u5e26\u6765\u7ebf\u4e0a\u5206\u4eab\uff0c\u5feb\u6765\u770b\u770b\u6709\u54ea\u4e9b\u7cbe\u5f69\u7684\u8bae\u9898\u5427!","date":"2022-01-24T00:00:00.000Z","formattedDate":"2022\u5e741\u670824\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":1.295,"truncated":true,"authors":[],"prevItem":{"title":"Apache APISIX 2.12.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2022/01/25/release-apache-apisix-2.12"},"nextItem":{"title":"Apache APISIX \u96c6\u6210 HashiCorp Vault\uff0c\u751f\u6001\u7cfb\u7edf\u518d\u6dfb\u4e00\u5458","permalink":"/zh/blog/2022/01/21/apisix-hashicorp-vault-integration"}},"content":"> 1 \u6708 28 \u65e5\uff0cApache APISIX \u793e\u533a\u5c06\u8054\u5408\u9752\u4e91\u4e3a\u5927\u5bb6\u5e26\u6765\u7ebf\u4e0a\u5206\u4eab\uff0c\u5feb\u6765\u770b\u770b\u6709\u54ea\u4e9b\u7cbe\u5f69\u7684\u8bae\u9898\u5427!\\n\\n\x3c!--truncate--\x3e\\n\\n![\u6d3b\u52a8\u6d77\u62a5](https://static.apiseven.com/202108/1642747565874-a3e854c3-81ea-460b-aec6-1a23b28912f7.png)\\n\\n## \u8bae\u9898 1\uff1aAPI\u7f51\u5173\u4e0a\u4e91\uff0c\u5982\u4f55\u5b9a\u4e49\u4e00\u6b3e\u597d\u7684API\u7f51\u5173\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n\u5218\u5e86\uff0c\u9752\u4e91 QingCloud API \u7f51\u5173\u4ea7\u54c1\u7ecf\u7406\\n\\n\u7fdf\u70bc\uff0c\u9752\u4e91 QingCloud API \u7f51\u5173\u6280\u672f\u67b6\u6784\\n\\n### \u8bae\u9898\u8be6\u60c5\\n\\n1. \u4e3a\u4ec0\u4e48 API \u7f51\u5173\u4e0a\u4e91\uff0c\u89e3\u51b3\u4e86\u7528\u6237\u54ea\u4e9b\u75db\u70b9\\n2. \u6211\u4eec\u5982\u4f55\u7406\u89e3\u548c\u5b9a\u4e49\u4e00\u6b3e\u597d\u7684 API \u7f51\u5173\u4ea7\u54c1\\n3. \u9752\u4e91 QingCloud API \u7f51\u5173\u7684\u91cd\u8981\u4ea7\u54c1\u7279\u6027\u3001\u529f\u80fd\u53ca\u5e94\u7528\u573a\u666f\\n\\n## \u8bae\u9898 2\uff1aRun Apache APISIX in hybrid cloud\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n\u91d1\u536b\uff0cAPI7 Enginee\uff0cApache APISIX PMC\uff0cApache APISIX Ingress Controller Founder\\n\\n### \u8bae\u9898\u8be6\u60c5\\n\\n1. Apache APISIX \u4e0e\u5404\u4e2a\u516c\u6709\u4e91\u7684\u96c6\u6210\uff08\u63d2\u4ef6\u548c\u5b9e\u9645\u5e94\u7528\uff09\\n2. \u6df7\u5408\u4e91\u4e0b Apache APISIX \u7684\u67b6\u6784\u548c\u5b9e\u8df5\\n3. Apache APISIX \u5728\u516c\u6709\u4e91\u7684\u5b9e\u8df5\\n\\n## \u53c2\u4e0e\u65b9\u5f0f\\n\\n\u626b\u7801\u5173\u6ce8\u4e0b\u65b9\u89c6\u9891\u53f7\uff0c\u9884\u7ea6\u672c\u6b21\u76f4\u64ad\u3002\\n\\n![QR code](https://static.apiseven.com/202108/1642745385238-f661f79d-d429-41d0-95b9-ad85d8d08ce0.png)\\n\\n1 \u6708 28 \u65e5\u4e0b\u5348\uff0c\u671f\u5f85\u4e0e\u60a8\u5728\u76f4\u64ad\u95f4\u76f8\u9047\uff01"},{"id":"Apache APISIX \u96c6\u6210 HashiCorp Vault\uff0c\u751f\u6001\u7cfb\u7edf\u518d\u6dfb\u4e00\u5458","metadata":{"permalink":"/zh/blog/2022/01/21/apisix-hashicorp-vault-integration","source":"@site/blog/2022/01/21/apisix-hashicorp-vault-integration.md","title":"Apache APISIX \u96c6\u6210 HashiCorp Vault\uff0c\u751f\u6001\u7cfb\u7edf\u518d\u6dfb\u4e00\u5458","description":"\u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 Vault \u63d2\u4ef6\u4ee5\u53ca\u76f8\u5173\u4f7f\u7528\u7ec6\u8282\u3002\u5728\u4e3a\u670d\u52a1\u63d0\u4f9b\u9ad8\u5e76\u53d1\u4f4e\u5ef6\u8fdf\u7684\u5353\u8d8a\u6027\u80fd\u7684\u540c\u65f6\uff0c\u4e3a\u670d\u52a1\u7684\u5b89\u5168\u4fdd\u9a7e\u62a4\u822a\u3002","date":"2022-01-21T00:00:00.000Z","formattedDate":"2022\u5e741\u670821\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Authentication","permalink":"/zh/blog/tags/authentication"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":16.185,"truncated":true,"authors":[{"name":"Bisakh Mondal","title":"Author","url":"https://github.com/bisakhmondal","image_url":"https://avatars.githubusercontent.com/u/41498427?v=4","imageURL":"https://avatars.githubusercontent.com/u/41498427?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://avatars.githubusercontent.com/u/36651058?v=4","imageURL":"https://avatars.githubusercontent.com/u/36651058?v=4"}],"prevItem":{"title":"\u76f4\u64ad\u9884\u544a | \u5f00\u6e90+\u4e91\u539f\u751f\u52a9\u529b\u4f01\u4e1a\u4e0a\u4e91\u4e0e\u884c\u52a8\u843d\u5730","permalink":"/zh/blog/2022/01/24/apisix-with-qingcloud-meetup"},"nextItem":{"title":"\u591a\u534f\u8bae\u63a5\u5165\u6846\u67b6 xRPC \u7ec6\u8282\u524d\u77bb","permalink":"/zh/blog/2022/01/21/apisix-xrpc-details-and-miltilingual"}},"content":"> \u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 Vault \u63d2\u4ef6\u4ee5\u53ca\u76f8\u5173\u7ec6\u8282\u3002\u5728\u4e3a\u670d\u52a1\u63d0\u4f9b\u9ad8\u5e76\u53d1\u4f4e\u5ef6\u8fdf\u7684\u5353\u8d8a\u6027\u80fd\u7684\u540c\u65f6\uff0c\u4e3a\u670d\u52a1\u7684\u5b89\u5168\u4fdd\u9a7e\u62a4\u822a\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u968f\u7740\u5fae\u670d\u52a1\u67b6\u6784\u7684\u5174\u8d77\uff0c\u4fdd\u6301\u670d\u52a1\u5b89\u5168\u53d8\u5f97\u6bd4\u4ee5\u524d\u66f4\u6709\u6311\u6218\u6027\u3002\u591a\u4e2a\u540e\u7aef server \u5b9e\u4f8b\u4f7f\u7528\u5355\u4e00\u7684\u9759\u6001\u5bc6\u94a5\u51ed\u8bbf\u95ee\u6570\u636e\u5e93 server \u4f1a\u5e26\u6765\u5de8\u5927\u7684\u98ce\u9669\u3002\u5982\u679c\u53d1\u751f\u5bc6\u94a5\u51ed\u8bc1\u6cc4\u9732\uff0c\u6574\u4e2a\u7cfb\u7edf\u90fd\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u4e3a\u4e86\u89e3\u51b3\u5bc6\u94a5\u51ed\u8bc1\u6cc4\u9732\u6240\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u53ea\u80fd\u64a4\u9500\u8fd9\u4e2a\u5bc6\u94a5\u51ed\u8bc1\u3002\u800c\u64a4\u9500\u5bc6\u94a5\u51ed\u8bc1\u4f1a\u5bfc\u81f4\u5927\u89c4\u6a21\u7684\u670d\u52a1\u4e2d\u65ad\uff0c\u5bf9\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u670d\u52a1\u5927\u89c4\u6a21\u4e2d\u65ad\u662f\u5f00\u53d1\u8005\u6700\u4e0d\u60f3\u770b\u5230\u4e8b\u60c5\u3002\\n\\n\u867d\u7136\u6211\u4eec\u4e0d\u80fd\u63d0\u524d\u9884\u77e5\u5c06\u6765\u4f1a\u51fa\u73b0\u54ea\u4e9b\u5b89\u5168\u6f0f\u6d1e\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u591a\u4e2a\u5bc6\u94a5\u6765\u63a7\u5236\u8fd9\u4e9b\u5b89\u5168\u6f0f\u6d1e\u7684\u5f71\u54cd\u8303\u56f4\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u50cf HashiCorp Vault\uff08\u4e0b\u6587\u7b80\u79f0 Vault\uff09\u8fd9\u6837\u5bc6\u94a5\u51ed\u8bc1\u89e3\u51b3\u65b9\u6848\u5e94\u8fd0\u800c\u751f\u3002\\n\\n\u672c\u6587\u6f14\u793a\u4e86\u5982\u4f55\u5c06 Vault \u4e0e Apache APISIX \u7684 `jwt-auth` \u63d2\u4ef6\u96c6\u6210\uff0c\u5728\u4e3a\u670d\u52a1\u63d0\u4f9b\u9ad8\u5e76\u53d1\u4f4e\u5ef6\u8fdf\u7684\u5353\u8d8a\u6027\u80fd\u7684\u540c\u65f6\uff0c\u4e3a\u670d\u52a1\u7684\u5b89\u5168\u4fdd\u9a7e\u62a4\u822a\u3002\\n\\n## \u4ec0\u4e48\u662f Vault\\n\\nVault \u65e8\u5728\u5e2e\u52a9\u7528\u6237\u7ba1\u7406\u670d\u52a1\u5bc6\u94a5\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u5e76\u5728\u591a\u4e2a\u670d\u52a1\u4e4b\u95f4\u5b89\u5168\u5730\u4f20\u8f93\u8fd9\u4e9b\u5bc6\u94a5\u3002\u5bc6\u94a5\u53ef\u4ee5\u662f\u4efb\u4f55\u5f62\u5f0f\u7684\u51ed\u8bc1\uff0c\u56e0\u4e3a\u5bc6\u94a5\u53ef\u7528\u4e8e\u89e3\u9501\u654f\u611f\u4fe1\u606f\uff0c\u6240\u4ee5\u9700\u8981\u4e25\u5bc6\u63a7\u5236\u5bc6\u94a5\u3002\u5bc6\u94a5\u7684\u5f62\u5f0f\u53ef\u4ee5\u662f\u5bc6\u7801\u3001API \u5bc6\u94a5\u3001SSH \u5bc6\u94a5\u3001RSA \u4ee4\u724c\u6216 OTP\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5bc6\u94a5\u6cc4\u9732\u7684\u60c5\u51b5\u975e\u5e38\u666e\u904d\uff1a\u5bc6\u94a5\u901a\u5e38\u88ab\u50a8\u5b58\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u6216\u4f5c\u4e3a\u53d8\u91cf\u88ab\u50a8\u5b58\u5728\u4ee3\u7801\u4e2d\uff0c\u5982\u679c\u6ca1\u6709\u59a5\u5584\u4fdd\u5b58\uff0c\u5bc6\u94a5\u751a\u81f3\u4f1a\u51fa\u73b0\u5728 GitHub\u3001BitBucket \u6216 GitLab \u7b49\u516c\u5f00\u53ef\u89c1\u7684\u4ee3\u7801\u5e93\u4e2d\uff0c\u4ece\u800c\u5bf9\u5b89\u5168\u6784\u6210\u4e86\u91cd\u5927\u5a01\u80c1\u3002Vault \u901a\u8fc7\u96c6\u4e2d\u5bc6\u94a5\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u5b83\u4e3a\u9759\u6001\u5bc6\u94a5\u63d0\u4f9b\u52a0\u5bc6\u5b58\u50a8\uff0c\u751f\u6210\u5177\u6709 TTL \u79df\u7ea6\u7684\u52a8\u6001\u5bc6\u94a5\uff0c\u5bf9\u7528\u6237\u8fdb\u884c\u8ba4\u8bc1\uff0c\u4ee5\u786e\u4fdd\u4ed6\u4eec\u6709\u6743\u9650\u8bbf\u95ee\u7279\u5b9a\u7684\u5bc6\u94a5\u3002\u56e0\u6b64\uff0c\u5373\u4f7f\u5728\u5b89\u5168\u6f0f\u6d1e\u7684\u60c5\u51b5\u4e0b\uff0c\u5f71\u54cd\u8303\u56f4\u4e5f\u5c0f\u5f97\u591a\uff0c\u5e76\u80fd\u5f97\u5230\u66f4\u597d\u7684\u63a7\u5236\u3002\\n\\nVault \u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u6237\u754c\u9762\u7528\u4e8e\u5bc6\u94a5\u7ba1\u7406\uff0c\u4f7f\u63a7\u5236\u548c\u7ba1\u7406\u6743\u9650\u53d8\u5f97\u975e\u5e38\u5bb9\u6613\u3002\u4e0d\u4ec5\u5982\u6b64\uff0c\u5b83\u8fd8\u63d0\u4f9b\u4e86\u7075\u6d3b\u4e14\u8be6\u7ec6\u5ba1\u8ba1\u65e5\u5fd7\u529f\u80fd\uff0c\u80fd\u8ddf\u8e2a\u5230\u6240\u6709\u7528\u6237\u7684\u5386\u53f2\u8bbf\u95ee\u8bb0\u5f55\u3002\\n\\n![HashiCorp Vault](https://static.apiseven.com/202108/1642770417379-a91960a5-5aac-45fa-9277-801a4ee2afc6.png)\\n\\n## jwt-auth \u63d2\u4ef6\u4ecb\u7ecd\\n\\n`jwt-auth` \u662f\u4e00\u4e2a\u8ba4\u8bc1\u63d2\u4ef6\uff0c\u53ef\u4ee5\u9644\u52a0\u5230\u4efb\u4f55 APISIX \u8def\u7531\u4e0a\uff0c\u5728\u8bf7\u6c42\u88ab\u8f6c\u53d1\u5230\u4e0a\u6e38 URI \u4e4b\u524d\u6267\u884c JWT \u8ba4\u8bc1\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53d1\u884c\u8005\u4f7f\u7528\u79c1\u94a5\u6216\u6587\u672c\u5bc6\u94a5\u6765\u7b7e\u7f72 JWT\u3002JWT \u7684\u63a5\u6536\u8005\u5c06\u9a8c\u8bc1\u7b7e\u540d\uff0c\u4ee5\u786e\u4fdd\u4ee4\u724c\u5728\u88ab\u53d1\u884c\u8005\u7b7e\u540d\u540e\u6ca1\u6709\u88ab\u6539\u53d8\u3002\u6574\u4e2a JWT \u673a\u5236\u7684\u6574\u4f53\u5b8c\u6574\u6027\u53d6\u51b3\u4e8e\u7b7e\u540d\u5bc6\u94a5\uff08\u6216 RSA \u5bc6\u94a5\u5bf9\u7684\u6587\u672c\u5bc6\u94a5\uff09\u3002\u8fd9\u4f7f\u5f97\u672a\u7ecf\u8ba4\u8bc1\u7684\u6765\u6e90\u5f88\u96be\u731c\u5230\u7b7e\u540d\u5bc6\u94a5\u5e76\u8bd5\u56fe\u6539\u53d8 JWT \u4e2d\u7684\u58f0\u660e\u3002\\n\\n\u56e0\u6b64\uff0c\u5728\u5b89\u5168\u7684\u73af\u5883\u4e2d\u5b58\u50a8\u8fd9\u4e9b\u5bc6\u94a5\u662f\u975e\u5e38\u5173\u952e\u7684\u3002\u5982\u679c\u5bc6\u94a5\u843d\u5165\u574f\u4eba\u4e4b\u624b\uff0c\u53ef\u80fd\u4f1a\u5371\u53ca\u6574\u4e2a\u57fa\u7840\u8bbe\u65bd\u7684\u5b89\u5168\u3002\u867d\u7136 Apache APISIX \u91c7\u53d6\u4e86\u4e00\u5207\u624b\u6bb5\u6765\u9075\u5faa\u6807\u51c6\u7684 SecOps \u5b9e\u8df5\uff0c\u4f46\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6709\u4e00\u4e2a\u96c6\u4e2d\u7684\u5bc6\u94a5\u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u4e5f\u662f\u4e00\u4ef6\u597d\u4e8b\u3002\u4f8b\u5982 Vault\uff0c\u6709\u8be6\u7ec6\u7684\u5ba1\u8ba1\u65e5\u5fd7\uff0c\u5b9a\u65f6\u7684\u5bc6\u94a5\u8f6e\u6362\uff0c\u5bc6\u94a5\u64a4\u9500\u7b49\u529f\u80fd\u3002\u5982\u679c\u6bcf\u6b21\u5728\u6574\u4e2a\u57fa\u7840\u8bbe\u65bd\u53d1\u751f\u5bc6\u94a5\u8f6e\u6362\u65f6\uff0c\u4f60\u90fd\u8981\u66f4\u65b0 Apache APISIX \u914d\u7f6e\uff0c\u8fd9\u5c06\u662f\u4e00\u4e2a\u76f8\u5f53\u9ebb\u70e6\u7684\u95ee\u9898\u3002\\n\\n## \u5982\u4f55\u96c6\u6210 Vault \u548c Apache APISIX\\n\\n\u4e3a\u4e86\u4e0e Vault \u96c6\u6210\uff0cApache APISIX \u9700\u8981\u5728 [config.yaml](https://github.com/apache/apisix/blob/master/conf/config.yaml) \u6587\u4ef6\u4e2d\u52a0\u8f7d Vault \u7684\u76f8\u5173\u914d\u7f6e\u4fe1\u606f\u3002\\n\\nApache APISIX \u4e0e Vault server [KV secret engine v1](https://www.vaultproject.io/docs/secrets/kv/kv-v1) HTTP [APIs](https://www.vaultproject.io/api/secret/kv/kv-v1) \u8fdb\u884c\u901a\u4fe1\u3002\u7531\u4e8e\u5927\u591a\u6570\u4f01\u4e1a\u89e3\u51b3\u65b9\u6848\u503e\u5411\u4e8e\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528 KV Secrets Engine - Version 1\uff0c\u5728 APISIX-Vault \u652f\u6301\u7684\u521d\u59cb\u9636\u6bb5\uff0c\u6211\u4eec\u53ea\u4f7f\u7528\u8fd9\u4e2a\u7248\u672c\u3002\u5728\u4ee5\u540e\u7684\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u5c06\u589e\u52a0\u5bf9 K/V - Version 2 \u7684\u652f\u6301\u3002\\n\\n\u4f7f\u7528 Vault \u800c\u4e0d\u662f APISIX etcd \u540e\u7aef\u7684\u4e3b\u8981\u987e\u8651\u662f\u5728\u4f4e\u4fe1\u4efb\u5ea6\u73af\u5883\u4e0b\u7684\u5b89\u5168\u95ee\u9898\u3002\u56e0\u4e3a Vault \u8bbf\u95ee\u4ee4\u724c\u662f\u5c0f\u8303\u56f4\u7684\uff0c\u53ef\u4ee5\u6388\u4e88 APISIX server \u6709\u9650\u7684\u6743\u9650\u3002\\n\\n### \u914d\u7f6e Vault\\n\\n\u672c\u8282\u5206\u4eab\u4e86\u5728 Apache APISIX \u751f\u6001\u7cfb\u7edf\u4e2d\u4f7f\u7528 Vault \u7684\u6700\u4f73\u5b9e\u8df5\u3002\u5982\u679c\u4f60\u5df2\u7ecf\u6709\u4e86\u4e00\u4e2a\u5177\u6709\u5fc5\u8981\u6743\u9650\u7684 Vault \u5b9e\u4f8b\u5728\u8fd0\u884c\uff0c\u8bf7\u8df3\u8fc7\u672c\u8282\u3002\\n\\n#### \u542f\u52a8 Vault server\\n\\n\u5728\u8fd9\u91cc\uff0c\u4f60\u6709\u591a\u79cd\u9009\u62e9\uff0c\u53ef\u4ee5\u81ea\u7531\u9009\u62e9 Docker\u3001\u9884\u7f16\u8bd1\u4e8c\u8fdb\u5236\u5305\u6216\u4ece\u6e90\u4ee3\u7801\u6784\u5efa\u3002\u81f3\u4e8e\u4e0e Vault server \u7684\u901a\u4fe1\uff0c\u4f60\u9700\u8981\u4e00\u4e2a Vault CLI \u5ba2\u6237\u7aef\u3002\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8 server\uff1a\\n\\n```shell\\n$ vault server -dev -dev-root-token-id=root\\n\u2026\\nWARNING! dev mode is enabled! In this mode, Vault runs entirely in-memory\\nand starts unsealed with a single unseal key. The root token is already\\nauthenticated to the CLI, so you can immediately begin using Vault.\\nYou may need to set the following environment variable:\\nexport VAULT_ADDR=\'http://127.0.0.1:8200\'\\nThe unseal key and root token are displayed below in case you want to\\nseal/unseal the Vault or re-authenticate.\\nUnseal Key: 12hURx2eDPKK1tzK+8TkgH9pPhPNJFpyfc/imCLgJKY=\\nRoot Token: root\\nDevelopment mode should NOT be used in production installations!\\n```\\n\\n\u7528\u6b63\u786e\u7684\u73af\u5883\u53d8\u91cf\u8bbe\u7f6e Vault CLI \u5ba2\u6237\u7aef\u3002\\n\\n```shell\\n$ export VAULT_ADDR=\'http://127.0.0.1:8200\'\\n$ export VAULT_TOKEN=\'root\'\\n```\\n\\n\u7528\u4e00\u4e2a\u5408\u9002\u7684 `path` \u524d\u7f00\u542f\u7528 vault k/v version 1\u7684\u5bc6\u94a5\u5f15\u64ce\u540e\u7aef\u3002\u5728\u8fd9\u4e2a\u6f14\u793a\u4e2d\uff0c\u6211\u4eec\u8981\u9009\u62e9 `kv` \u8def\u5f84\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u4e0e vault \u9ed8\u8ba4\u7684 `kv` version 2 \u7684\u5bc6\u94a5\u8def\u5f84\u53d1\u751f\u51b2\u7a81\u3002\\n\\n```shell\\n$ vault secrets enable -path=kv -version=1 kv\\nSuccess! Enabled the kv secrets engine at: kv/\\n\\n\\n# To reconfirm the status, run\\n$ vault secrets list\\nPath          Type         Accessor              Description\\n----          ----         --------              -----------\\ncubbyhole/    cubbyhole    cubbyhole_4eeb394c    per-token private secret storage\\nidentity/     identity     identity_5ca6201e     identity store\\nkv/           kv           kv_92cd6d37           n/a\\nsecret/       kv           kv_6dd46a53           key/value secret storage\\nsys/          system       system_2045ddb1       system endpoints used for control, policy and debugging\\n```\\n\\n#### \u4e3a Apache APISIX \u751f\u6210\u4e00\u4e2a Vault \u8bbf\u95ee\u4ee4\u724c\\n\\n\u672c\u6587\u662f\u5173\u4e8e\u5728 `jwt-auth` \u63d2\u4ef6\u4e2d\u4f7f\u7528 Vault \u7684\u4ecb\u7ecd\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u4e00\u4e2a APISIX Consumer `jack`\uff0c`jwt-auth` \u63d2\u4ef6\u4f1a\u5728 `<vault.prefix inside config.yaml>/consumer/<consumer.username>/jwt-auth` \u4e2d\u67e5\u627e\uff08\u5982\u679c\u542f\u7528\u4e86 Vault \u914d\u7f6e\uff09`secret/s` \u5230 Vault \u952e\u503c\u5bf9 \u5b58\u50a8\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4f60\u5c06 `kv/apisix` \u547d\u540d\u7a7a\u95f4\uff08Vault \u8def\u5f84\uff09\u6307\u5b9a\u4e3a`config.yaml` \u5185\u7684 `vault.prefix`\uff0c\u7528\u4e8e\u6240\u6709 APISIX \u76f8\u5173\u6570\u636e\u7684\u68c0\u7d22\uff0c\u6211\u4eec\u5efa\u8bae\u4f60\u4e3a\u8def\u5f84 `kv/apisix/consumer/` \u521b\u5efa\u4e00\u4e2a\u7b56\u7565\u3002\u6700\u540e\u7684\u661f\u53f7\uff08*\uff09\u786e\u4fdd\u7b56\u7565\u5141\u8bb8\u8bfb\u53d6\u4efb\u4f55\u5177\u6709 `kv/apisix/consumer` \u524d\u7f00\u7684\u8def\u5f84\u3002\\n\\n\u7528 HashiCorp \u914d\u7f6e\u8bed\u8a00\uff08HCL\uff09\u521b\u5efa\u4e00\u4e2a\u7b56\u7565\u6587\u4ef6\u3002\\n\\n```shell\\n$ tee apisix-policy.hcl << EOF\\npath \\"kv/apisix/consumer/*\\" {\\n    capabilities = [\\"read\\"]\\n}\\nEOF\\n```\\n\\n\u5c06\u7b56\u7565\u5e94\u7528\u4e8e Vault \u5b9e\u4f8b\u3002\\n\\n```shell\\n$ vault policy write apisix-policy apisix-policy.hcl\\n\\nSuccess! Uploaded policy: apisix-policy\\n```\\n\\n\u7528\u65b0\u5b9a\u4e49\u7684\u7b56\u7565\u751f\u6210\u4e00\u4e2a\u4ee4\u724c\uff0c\u8be5\u7b56\u7565\u5df2\u88ab\u914d\u7f6e\u4e3a\u5f88\u5c0f\u7684\u8bbf\u95ee\u8fb9\u754c\u3002\\n\\n```shell\\n$ vault token create -policy=\\"apisix-policy\\"\\n\\n\\nKey                  Value\\n---                  -----\\ntoken                s.KUWFVhIXgoRuQbbp3j1eMVGa\\ntoken_accessor       nPXT3q0mfZkLmhshfioOyx8L\\ntoken_duration       768h\\ntoken_renewable      true\\ntoken_policies       [\\"apisix-policy\\" \\"default\\"]\\nidentity_policies    []\\npolicies             [\\"apisix-policy\\" \\"default\\"]\\n```\\n\\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c`s.KUWFVhIXgoRuQbbp3j1eMVGa` \u662f\u4f60\u7684\u8bbf\u95ee\u4ee4\u724c\u3002\\n\\n### \u5728 Apache APISIX \u4e2d\u6dfb\u52a0 Vault \u914d\u7f6e\\n\\nApache APISIX \u901a\u8fc7 Vault HTTP APIs \u4e0e Vault \u5b9e\u4f8b\u8fdb\u884c\u901a\u4fe1\u3002\u5fc5\u8981\u7684\u914d\u7f6e\u5fc5\u987b\u88ab\u6dfb\u52a0\u5230 [config.yaml](https://github.com/apache/apisix/blob/master/conf/config.yaml) \u4e2d\u3002\\n\\n\u4e0b\u9762\u662f\u5173\u4e8e\u4f60\u53ef\u4ee5\u4f7f\u7528\u7684\u4e0d\u540c\u5b57\u6bb5\u7684\u7b80\u8981\u4fe1\u606f\u3002\\n\\n- host\uff1a \u8fd0\u884c Vault server \u7684\u4e3b\u673a\u5730\u5740\u3002\\n- timeout\uff1a \u6bcf\u6b21\u8bf7\u6c42\u7684 HTTP \u8d85\u65f6\u3002\\n- token\uff1a \u4ece Vault \u5b9e\u4f8b\u751f\u6210\u7684\u4ee4\u724c\uff0c\u6388\u4e88\u4ece Vault \u8bfb\u53d6\u6570\u636e\u7684\u6743\u9650\u3002\\n- prefix\uff1a\u542f\u7528\u524d\u7f00\u53ef\u4ee5\u66f4\u597d\u5730\u6267\u884c\u7b56\u7565\uff0c\u751f\u6210\u6709\u9650\u8303\u56f4\u7684\u4ee4\u724c\uff0c\u4e25\u683c\u63a7\u5236\u53ef\u4ee5\u4ece APISIX \u8bbf\u95ee\u7684\u6570\u636e\u3002\u6709\u6548\u7684\u524d\u7f00\u662f\uff08`kv/apisix`\u3001`secret`\u7b49\uff09\u3002\\n\\n```shell\\nvault:\\n  host: \'http://0.0.0.0:8200\'\\n  timeout: 10\\n  token: \'s.KUWFVhIXgoRuQbbp3j1eMVGa\'\\n  prefix: \'kv/apisix\'\\n```\\n\\n### \u521b\u5efa\u4e00\u4e2a APISIX Consumer\\n\\nAPISIX \u6709\u4e00\u4e2a Consumer \u5c42\u9762\u7684\u62bd\u8c61\uff0c\u4e0e\u8ba4\u8bc1\u65b9\u6848\u5e76\u5217\u3002\u4e3a\u4e86\u542f\u7528\u4efb\u4f55 APISIX \u8def\u7531\u7684\u8ba4\u8bc1\uff0c\u9700\u8981\u4e00\u4e2a\u5177\u6709\u9002\u5408\u8be5\u7279\u5b9a\u7c7b\u578b\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e\u7684 Consumer\u3002\u4e4b\u540e\u5c06\u901a\u8fc7 APISIX \u6210\u529f\u6267\u884c Consumer \u914d\u7f6e\u65b9\u9762\u7684\u8ba4\u8bc1\u8bf7\u6c42\u8f6c\u53d1\u5230\u4e0a\u6e38 URI\u3002APISIX Consumer \u6709\u4e24\u4e2a\u5b57\u6bb5\uff1a\u4e00\u4e2a\u662f `username`\uff08\u5fc5\u586b\u9879\uff09\uff0c\u7528\u4e8e\u8bc6\u522b Consumer\uff1b\u53e6\u4e00\u4e2a\u662f `plugins`\uff0c\u7528\u4e8e\u4fdd\u5b58 Consumer \u6240\u4f7f\u7528\u7684\u7279\u5b9a\u63d2\u4ef6\u914d\u7f6e\u3002\\n\\n\u5728\u8fd9\u91cc\uff0c\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c06\u7528 `jwt-auth` \u63d2\u4ef6\u521b\u5efa\u4e00\u4e2a Consumer\u3002\u5b83\u4e3a\u5404\u81ea\u7684\u8def\u7531\u6216\u670d\u52a1\u6267\u884c JWT \u8ba4\u8bc1\u3002\\n\\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u542f\u7528 Vault \u914d\u7f6e\u7684 `jwt-auth`\u3002\\n\\n```shell\\n$ curl http://127.0.0.1:9080/apisix/admin/consumers -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"username\\": \\"jack\\",\\n    \\"plugins\\": {\\n        \\"jwt-auth\\": {\\n            \\"key\\": \\"test-key\\",\\n            \\"vault\\": {}\\n        }\\n    }\\n}\'\\n```\\n\\n\u5728\u8fd9\u91cc\uff0c\u63d2\u4ef6\u5728 Consumer \u914d\u7f6e\u4e2d\u63d0\u5230\u7684 Consumer `jack` \u7684 Vault \u8def\u5f84\uff08`<vault.prefix from conf.yaml>/consumer/jack/jwt-auth`\uff09\u4e2d\u67e5\u627e\u5bc6\u94a5 `secret`\uff0c\u5e76\u4f7f\u7528\u5b83\u8fdb\u884c\u540e\u7eed\u7684\u7b7e\u540d\u548c jwt \u9a8c\u8bc1\u3002\u5982\u679c\u5728\u540c\u4e00\u8def\u5f84\u4e2d\u6ca1\u6709\u627e\u5230\u5bc6\u94a5\uff0c\u8be5\u63d2\u4ef6\u4f1a\u8bb0\u5f55\u9519\u8bef\uff0c\u5e76\u4e14\u65e0\u6cd5\u6267\u884c JWT \u9a8c\u8bc1\u3002\\n\\n#### \u8bbe\u7f6e\u4e00\u4e2a\u6d4b\u8bd5\u7684\u4e0a\u6e38 server\\n\\n\u4e3a\u4e86\u6d4b\u8bd5\u8fd9\u4e2a\u884c\u4e3a\uff0c\u4f60\u53ef\u4ee5\u4e3a\u4e00\u4e2a\u4e0a\u6e38\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff08\u4e00\u4e2a\u7b80\u5355\u7684 ping \u5904\u7406\u7a0b\u5e8f\uff0c\u8fd4\u56de pong\uff09\u3002\u4f60\u53ef\u4ee5\u7528\u4e00\u4e2a\u666e\u901a\u7684 go HTTP-Server \u6765\u8bbe\u7f6e\u5b83\u3002\\n\\n```go\\n// simple upstream server\\npackage main\\n\\n\\nimport \\"net/http\\"\\n\\n\\nfunc ping(w http.ResponseWriter, req *http.Request) {\\n    w.Write([]byte(\\"secure/pong\\\\n\\"))\\n}\\n\\n\\nfunc main() {\\n    http.HandleFunc(\\"/secure/ping\\", ping)\\n    http.ListenAndServe(\\":9999\\", nil)\\n}\\n```\\n\\n#### \u521b\u5efa\u4e00\u4e2a\u542f\u7528\u4e86\u8ba4\u8bc1\u7684 APISIX \u8def\u7531\\n\\n\u7528\u8fd9\u4e2a\u5b89\u5168\u7684 ping HTTP server \u548c\u542f\u7528\u4e86 `jwt-auth` \u8ba4\u8bc1\u63d2\u4ef6\u521b\u5efa\u4e00\u4e2a APISIX \u8def\u7531\u3002\\n\\n```shell\\n$ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"jwt-auth\\": {}\\n    },\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"127.0.0.1:9999\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"uri\\": \\"/secure/ping\\"\\n}\'\\n```\\n\\n#### \u4ece jwt-auth \u63d2\u4ef6\u751f\u6210\u4ee4\u724c\\n\\n\u73b0\u5728\u4ece APISIX \u7b7e\u7f72\u4e00\u4e2a JWT \u5bc6\u6587\uff0c\u53ef\u4ee5\u7528\u4e8e\u5e76\u901a\u8fc7\u5411 APISIX server \u7684 `http://localhost:9080/secure/ping` \u4ee3\u7406\u8def\u7531\u53d1\u51fa\u8bf7\u6c42\u3002\\n\\n```shell\\n$ curl http://127.0.0.1:9080/apisix/plugin/jwt/sign\\\\?key\\\\=test-key -i\\nHTTP/1.1 200 OK\\nDate: Tue, 18 Jan 2022 07:50:57 GMT\\nContent-Type: text/plain; charset=utf-8\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\nServer: APISIX/2.11.0\\n\\n\\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJrZXkiOiJ0ZXN0LWtleSIsImV4cCI6MTY0MjU3ODY1N30.nkyev1_KUapVgY_QVYETsSApA6gEkDWS8tsHFV1EpD8\\n```\\n\\n\u5728\u4e0a\u4e00\u6b65\u4e2d\uff0c\u5982\u679c\u4f60\u770b\u5230\u7c7b\u4f3c `failed to sign jwt` \u7684\u4fe1\u606f\uff0c\u8bf7\u786e\u4fdd\u4f60\u6709\u4e00\u4e2a\u79c1\u6709\u5bc6\u94a5\u5b58\u50a8\u5728 vault `kv/apisix/consumers/jack/jwt-aut` \u8def\u5f84\u4e2d\u3002\\n\\n```shell\\n# example\\n$ vault kv put kv/apisix/consumer/jack/jwt-auth secret=$ecr3t-c0d3\\nSuccess! Data written to: kv/apisix/consumer/jack/jwt-auth\\n```\\n\\n#### \u5411 APISIX Server \u53d1\u9001\u8bf7\u6c42\\n\\n\u73b0\u5728\uff0c\u5411 APISIX \u4ee3\u7406\u53d1\u51fa\u4e00\u4e2a\u8def\u7531 `/secure/ping` \u7684\u8bf7\u6c42\u3002\u9a8c\u8bc1\u6210\u529f\u540e\uff0c\u5b83\u5c06\u628a\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u6211\u4eec\u7684 go HTTP server\u3002\\n\\n```shell\\n$ curl http://127.0.0.1:9080/secure/ping -H \'Authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJrZXkiOiJ0ZXN0LWtleSIsImV4cCI6MTY0MjU3ODU5M30.IYudBr7FTgRme70u4rEBoYNtGmGByzgfGlt8hctI__Q\' -i\\nHTTP/1.1 200 OK\\nContent-Type: text/plain; charset=utf-8\\nContent-Length: 12\\nConnection: keep-alive\\nDate: Tue, 18 Jan 2022 08:00:04 GMT\\nServer: APISIX/2.11.0\\n\\n\\nsecure/pong\\n```\\n\\n\u4efb\u4f55\u65e0\u6548\u7684 JWT \u8bf7\u6c42\u90fd\u4f1a\u629b\u51fa `HTTP 401 Unauthorized` \u7684\u9519\u8bef\u3002\\n\\n```shell\\n$ curl http://127.0.0.1:9080/secure/ping -i\\nHTTP/1.1 401 Unauthorized\\nDate: Tue, 18 Jan 2022 08:00:33 GMT\\nContent-Type: text/plain; charset=utf-8\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\nServer: APISIX/2.11.0\\n\\n\\n{\\"message\\":\\"Missing JWT token in request\\"}\\n```\\n\\n### Vault \u4e0e APISIX jwt-auth \u63d2\u4ef6\u96c6\u6210\u7684\u4e0d\u540c\u7528\u4f8b\\n\\nApache APISIX `jwt-auth` \u63d2\u4ef6\u53ef\u4ee5\u88ab\u914d\u7f6e\u4e3a\u4ece Vault \u5b58\u50a8\u4e2d\u83b7\u53d6\u7b80\u5355\u7684\u6587\u672c\u5bc6\u94a5\u4ee5\u53ca RS256 \u516c\u79c1\u5bc6\u94a5\u5bf9\u3002\\n\\n:::note\\n\u5bf9\u4e8e\u8be5\u96c6\u6210\u652f\u6301\u7684\u65e9\u671f\u7248\u672c\uff0c\u8be5\u63d2\u4ef6\u5e0c\u671b\u5b58\u50a8\u5230\u91d1\u5e93\u8def\u5f84\u4e2d\u7684\u5bc6\u94a5\u540d\u79f0\u5728 [`secret`, `public_key`, `private_key`] \u4e4b\u95f4\uff0c\u4ee5\u6210\u529f\u4f7f\u7528\u8be5\u5bc6\u94a5\u3002\u5728\u672a\u6765\u7684\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u5c06\u589e\u52a0\u5bf9\u5f15\u7528\u81ea\u5b9a\u4e49\u547d\u540d\u7684\u5bc6\u94a5\u7684\u652f\u6301\u3002\\n:::\\n\\n1. \u4f60\u5728 Vault \u5185\u5b58\u50a8\u4e86 HS256 \u7b7e\u540d\u5bc6\u94a5\uff0c\u4f60\u60f3\u7528\u5b83\u6765\u8fdb\u884c jwt \u7b7e\u540d\u548c\u9a8c\u8bc1\u3002\\n\\n   ```shell\\n   $ curl http://127.0.0.1:9080/apisix/admin/consumers -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n    {\\n        \\"username\\": \\"jack\\",\\n        \\"plugins\\": {\\n            \\"jwt-auth\\": {\\n                \\"key\\": \\"key-1\\",\\n                \\"vault\\": {}\\n            }\\n        }\\n    }\'\\n   ```\\n\\n   \u5728\u8fd9\u91cc\uff0c\u63d2\u4ef6\u5728 Consumer \u914d\u7f6e\u4e2d\u63d0\u5230\u7684 Consumer \u7528\u6237 `jack` \u7684 Vault \u8def\u5f84\uff08`<vault.prefix from conf.yaml>/consumer/jack/jwt-auth`\uff09\u4e2d\u67e5\u627e\u5bc6\u94a5 `secret`\uff0c\u5e76\u4f7f\u7528\u5b83\u8fdb\u884c\u540e\u7eed\u7684\u7b7e\u540d\u548c jwt \u9a8c\u8bc1\u3002\u5982\u679c\u5728\u540c\u4e00\u8def\u5f84\u4e2d\u6ca1\u6709\u627e\u5230\u5bc6\u94a5\uff0c\u8be5\u63d2\u4ef6\u5c06\u8bb0\u5f55\u4e00\u4e2a\u9519\u8bef\uff0c\u5e76\u4e14\u65e0\u6cd5\u6267\u884c JWT \u9a8c\u8bc1\u3002\\n\\n2. RS256 RSA \u5bc6\u94a5\u5bf9\uff0c\u516c\u94a5\u548c\u79c1\u94a5\u90fd\u5b58\u50a8\u5728 Vault \u4e2d\u3002\\n\\n   ```shell\\n   $ curl http://127.0.0.1:9080/apisix/admin/consumers -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n    {\\n        \\"username\\": \\"jim\\",\\n        \\"plugins\\": {\\n            \\"jwt-auth\\": {\\n                \\"key\\": \\"rsa-keypair\\",\\n                \\"algorithm\\": \\"RS256\\",\\n                \\"vault\\": {}\\n            }\\n        }\\n    }\'\\n   ```\\n\\n   \u8be5\u63d2\u4ef6\u5728 Vault \u952e\u503c\u5bf9\u8def\u5f84\uff08`<vault.prefix from conf.yaml>/consumer/jim/jwt-auth`\uff09\u4e2d\u4e3a\u63d2\u4ef6 Vault \u914d\u7f6e\u4e2d\u63d0\u5230\u7684\u7528\u6237 `jim` \u67e5\u627e `public_key` \u548c `private_key`\u3002\u5982\u679c\u6ca1\u6709\u627e\u5230\uff0c\u8ba4\u8bc1\u5931\u8d25\u3002\\n\\n   \u5982\u679c\u4f60\u4e0d\u786e\u5b9a\u5982\u4f55\u5c06\u516c\u94a5\u548c\u79c1\u94a5\u5b58\u50a8\u5230 Vault \u952e\u503c\u5bf9\u4e2d\uff0c\u8bf7\u4f7f\u7528\u8fd9\u4e2a\u547d\u4ee4\u3002\\n\\n   ```shell\\n   # provided, your current directory contains the files named \\"public.pem\\" and \\"private.pem\\"\\n    $ vault kv put kv/apisix/consumer/jim/jwt-auth public_key=@public.pem private_key=@private.pem\\n    Success! Data written to: kv/apisix/consumer/jim/jwt-auth\\n   ```\\n\\n3. Consumer \u914d\u7f6e\u4e2d\u7684\u516c\u94a5\uff0c\u800c\u79c1\u94a5\u5728 Vault \u4e2d\u3002\\n\\n   ```shell\\n   $ curl http://127.0.0.1:9080/apisix/admin/consumers -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n    {\\n        \\"username\\": \\"john\\",\\n        \\"plugins\\": {\\n            \\"jwt-auth\\": {\\n                \\"key\\": \\"user-key\\",\\n                \\"algorithm\\": \\"RS256\\",\\n                \\"public_key\\": \\"-----BEGIN PUBLIC KEY-----\\\\n\u2026\u2026\\\\n-----END PUBLIC KEY-----\\"\\n                \\"vault\\": {}\\n            }\\n        }\\n    }\'\\n   ```\\n\\n   \u8fd9\u4e2a\u63d2\u4ef6\u4f7f\u7528\u6765\u81ea Consumer \u914d\u7f6e\u7684 RSA \u516c\u94a5\uff0c\u5e76\u4f7f\u7528\u76f4\u63a5\u4ece Vault \u83b7\u53d6\u7684\u79c1\u94a5\u3002\\n\\n### \u7981\u7528 Vault \u63d2\u4ef6\\n\\n\u73b0\u5728\uff0c\u8981\u7981\u7528 `jwt-auth` \u63d2\u4ef6\u7684 Vault \u67e5\u8be2\uff0c\u53ea\u9700\u4ece Consumer \u63d2\u4ef6\u914d\u7f6e\u4e2d\u5220\u9664\u7a7a\u7684 Vault \u5bf9\u8c61\uff08\u672c\u4f8b\u4e2d\u662f `jack`\uff09\u3002\u8fd9\u5c06\u4f7f JWT \u63d2\u4ef6\u5728\u968f\u540e\u5bf9\u5df2\u542f\u7528 `jwt-auth` \u914d\u7f6e\u7684 URI \u8def\u7531\u7684\u8bf7\u6c42\u4e2d\uff0c\u5c06\u67e5\u627e\u7b7e\u540d\u5bc6\u94a5\uff08\u5305\u62ec HS256/HS512 \u6216 RS512 \u5bc6\u94a5\u5bf9\uff09\u7eb3\u5165\u63d2\u4ef6\u914d\u7f6e\u3002\u5373\u4f7f\u4f60\u5728 APISIX `config.yaml` \u4e2d\u542f\u7528\u4e86 Vault \u914d\u7f6e\uff0c\u4e5f\u4e0d\u4f1a\u6709\u8bf7\u6c42\u88ab\u53d1\u9001\u5230 Vault server\u3002\\n\\nApache APISIX \u63d2\u4ef6\u662f\u70ed\u52a0\u8f7d\u7684\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u91cd\u65b0\u542f\u52a8 Apache APISIX\uff0c\u914d\u7f6e\u53ef\u4ee5\u7acb\u5373\u751f\u6548\u3002\\n\\n```shell\\n$ curl http://127.0.0.1:9080/apisix/admin/consumers -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"username\\": \\"jack\\",\\n    \\"plugins\\": {\\n        \\"jwt-auth\\": {\\n            \\"key\\": \\"test-key\\",\\n            \\"secret\\": \\"my-secret-key\\"\\n        }\\n    }\\n}\'\\n```\\n\\n## \u7ed3\u8bed\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 Vault \u63d2\u4ef6\u4ee5\u53ca\u76f8\u5173\u7ec6\u8282\u3002\\n\\n\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002\\n\\n## Reference\\n\\n[Bisakh\'s Blog](https://blog.bisakh.com/blog/vault-apisix-jwt-auth)"},{"id":"\u591a\u534f\u8bae\u63a5\u5165\u6846\u67b6 xRPC \u7ec6\u8282\u524d\u77bb","metadata":{"permalink":"/zh/blog/2022/01/21/apisix-xrpc-details-and-miltilingual","source":"@site/blog/2022/01/21/apisix-xrpc-details-and-miltilingual.md","title":"\u591a\u534f\u8bae\u63a5\u5165\u6846\u67b6 xRPC \u7ec6\u8282\u524d\u77bb","description":"\u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 xRPC \u6846\u67b6\u4ee5\u53ca\u76f8\u5173\u7ec6\u8282\uff0c\u540c\u65f6\u4ecb\u7ecd\u4e86 Apache APISIX \u5728\u591a\u8bed\u8a00\u5f00\u53d1\u652f\u6301\u4e2d\u7684\u7ec6\u8282\u5c55\u793a\u3002","date":"2022-01-21T00:00:00.000Z","formattedDate":"2022\u5e741\u670821\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":11.33,"truncated":true,"authors":[{"name":"\u5e05\u8fdb\u8d85","title":"Author","url":"https://github.com/shuaijinchao","image_url":"https://avatars.githubusercontent.com/u/8529452?v=4","imageURL":"https://avatars.githubusercontent.com/u/8529452?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"Apache APISIX \u96c6\u6210 HashiCorp Vault\uff0c\u751f\u6001\u7cfb\u7edf\u518d\u6dfb\u4e00\u5458","permalink":"/zh/blog/2022/01/21/apisix-hashicorp-vault-integration"},"nextItem":{"title":"CDN \u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u53c8\u62cd\u4e91\u7684\u516c\u7f51\u7f51\u5173\u573a\u666f\u5b9e\u8df5","permalink":"/zh/blog/2022/01/20/upyun-public-gateway-usecase"}},"content":"> \u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 xRPC \u6846\u67b6\u4ee5\u53ca\u76f8\u5173\u7ec6\u8282\uff0c\u540c\u65f6\u4ecb\u7ecd\u4e86 Apache APISIX \u5728\u591a\u8bed\u8a00\u5f00\u53d1\u652f\u6301\u4e2d\u7684\u7ec6\u8282\u5c55\u793a\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u968f\u7740\u4e1a\u52a1\u573a\u666f\u548c\u9700\u6c42\u8d8a\u6765\u8d8a\u590d\u6742\u548c\u591a\u6837\u5316\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u6807\u51c6\u548c\u534f\u8bae\u90fd\u5f00\u59cb\u5d2d\u9732\u5934\u89d2\u3002Apache APISIX \u4f5c\u4e3a Apache \u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u4e00\u76f4\u79ef\u6781\u53c2\u4e0e\u5e76\u63a8\u8fdb\u76f8\u5173\u751f\u6001\u5c42\u9762\u7684\u6269\u5c55\u3002\\n\\n\u672c\u6587\u5c06\u4ece**\u591a\u534f\u8bae\u4ee3\u7406**\u4e0e**\u591a\u8bed\u8a00\u652f\u6301**\u4e24\u4e2a\u89d2\u5ea6\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 xRPC \u6846\u67b6\u4e0e\u591a\u8bed\u8a00\u63d2\u4ef6\u7684\u76f8\u5173\u793a\u4f8b\u3002\\n\\n## \u591a\u534f\u8bae\u4ee3\u7406\\n\\n\u5728 Apache APISIX \u4e2d\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u4f1a\u5bf9\u5e94\u4e00\u4e2a Route \u5bf9\u8c61\u3002\u76ee\u524d Apache APISIX \u7684\u4ee3\u7406\u573a\u666f\u4e3b\u8981\u4ee5\u4e0b\u4e24\u79cd\u3002\\n\\n![\u76ee\u524d APISIX \u4e24\u79cd\u4ee3\u7406\u573a\u666f](https://static.apiseven.com/202108/1642732975469-74071c65-e869-4133-857f-822b58d6b86e.png)\\n\\n\u7b2c\u4e00\u79cd\u662f HTTP \u534f\u8bae\u4ee3\u7406\uff0c\u4e5f\u662f\u76ee\u524d APISIX \u4e2d\u6700\u5e38\u7528\u7684\u8bf7\u6c42\u4ee3\u7406\u3002\u57fa\u4e8e HTTP \u534f\u8bae\u4ee3\u7406\uff0cApache APISIX \u76ee\u524d\u5df2\u7ecf\u5b9e\u73b0\u4e86\u6570\u5341\u79cd\u6d41\u91cf\u6cbb\u7406\u80fd\u529b\uff0c\u5982\uff1a\u7ec6\u7c92\u5ea6\u7684\u6d41\u63a7\u3001\u5b89\u5168\u548c\u53ef\u89c2\u6d4b\u6027\u7b49\u3002\\n\\n\u7b2c\u4e8c\u79cd\u5219\u662f\u57fa\u4e8e TCP \u548c UDP \u7684\u52a8\u6001\u534f\u8bae\u4ee3\u7406\u548c\u8d1f\u8f7d\u5747\u8861\uff0c\u5b83\u63d0\u4f9b\u4e86\u6700\u57fa\u7840\u7684\u6d41\u91cf\u51c6\u5165\u80fd\u529b\u548c\u94fe\u63a5\u7ea7\u522b\u7684\u65e5\u5fd7\u80fd\u529b\u3002\u8fd9\u79cd\u4ee3\u7406\u6a21\u5f0f\u53ef\u4ee5\u4ee3\u7406\u4efb\u4f55\u57fa\u4e8e TCP/UDP \u534f\u8bae\u7684\u8bf7\u6c42\uff0c\u5982\uff1aMySQL\u3001Redis\u3001Mongo \u6216 DNS \u7b49\u3002\u4f46\u7531\u4e8e\u5b83\u662f\u57fa\u4e8e TCP/UDP \u7684\u4ee3\u7406\u6ca1\u6709\u4e0a\u5c42\u7684\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u53ea\u80fd\u83b7\u53d6\u5230\u56db\u5143\u7ec4\u7684\u4e00\u4e9b\u57fa\u7840\u4fe1\u606f\uff0c\u6240\u4ee5\u5728\u6269\u5c55\u80fd\u529b\u4e0a\u4f1a\u7a0d\u5f31\u4e00\u4e9b\u3002\\n\\n### \u4e3a\u4ec0\u4e48\u8981\u5f00\u53d1 xRPC \u6846\u67b6\\n\\n\u7531\u4e8e Stream Route \u5728\u534f\u8bae\u4ee3\u7406\u4e0a\u7684\u9650\u5236\uff0c\u52a0\u4e4b\u6211\u4eec\u5e0c\u671b\u5728 APISIX \u4e0a\u53ef\u4ee5\u652f\u6301\u66f4\u591a\u7684\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u4ee5\u670d\u52a1\u66f4\u591a\u7528\u6237\u548c\u5e94\u7528\u573a\u666f\uff0cxRPC \u6846\u67b6\u5e94\u8fd0\u800c\u751f\u3002\\n\\n\u901a\u8fc7 xRPC \u6846\u67b6\u53ef\u4ee5\u975e\u5e38\u4fbf\u6377\u5730\u6269\u5c55\u534f\u8bae\u80fd\u529b\uff0c\u4e0d\u7ba1\u662f\u7279\u5b9a\u8fd8\u662f\u79c1\u6709\u6570\u636e\u534f\u8bae\uff0c\u90fd\u53ef\u4ee5\u5177\u5907\u7c7b\u4f3c HTTP \u534f\u8bae\u4ee3\u7406\u7684**\u7cbe\u51c6\u9897\u7c92\u5ea6**\u7684\u548c**\u66f4\u9ad8\u9636\u7684 7 \u5c42\u63a7\u5236**\uff0c\u6bd4\u5982\u8bf7\u6c42\u7ea7\u522b\u7684\u53ef\u89c2\u6d4b\u6027\u3001\u9ad8\u7ea7\u8bbf\u95ee\u63a7\u5236\u548c\u4ee3\u7406\u7b56\u7565\u7b49\u529f\u80fd\u3002\\n\\n### \u4ec0\u4e48\u662f xRPC\\n\\nxRPC \u4ece\u5b57\u9762\u89d2\u5ea6\u6765\u5206\u6790\uff0c\u5373 X \u4e3a\u534f\u8bae\u8d44\u6e90\u7684\u62bd\u8c61\u4ee3\u8868\u3002\u800c RPC \u662f\u6211\u4eec\u8ba4\u4e3a\u6240\u6709\u7ecf\u8fc7\u7f51\u5173\u7684\u8d44\u6e90\u90fd\u4e3a\u4e00\u4e2a\u8fc7\u7a0b\u8c03\u5ea6\uff0c\u5373\u5b83\u662f\u4e00\u4e2a\u534f\u8bae\u6269\u5c55\u6846\u67b6\u3002\u6240\u4ee5\u5728\u5b9a\u4f4d\u4e0a\uff0cxRPC \u662f\u4e00\u4e2a\u57fa\u7840\u6846\u67b6\uff0c\u800c\u4e0d\u662f\u4e00\u79cd\u5177\u4f53\u534f\u8bae\u7684\u5b9e\u73b0\u3002\\n\\n![xRPC \u67b6\u6784\u56fe](https://static.apiseven.com/202108/1642733068660-f479ffcc-5bda-49de-bbd9-0d04d7259450.png)\\n\\n\u4ece\u4e0a\u56fe\u67b6\u6784\u53ef\u4ee5\u770b\u51fa\uff0cxRPC \u662f\u57fa\u4e8e APISIX Core \u6269\u5c55\u51fa\u6765\u7684\u6846\u67b6\u3002\u5728\u8be5\u6846\u67b6\u7684\u57fa\u7840\u4e4b\u4e0a\uff0c\u7528\u6237\u53ef\u4ee5\u53bb\u5b9e\u73b0\u4e0d\u540c\u5e94\u7528\u5c42\u7684\u534f\u8bae\uff0c\u6bd4\u5982 Redis\u3001MySQL\u3001Mongo \u548c Postgres \u7b49\u3002\u800c\u5728\u4e0d\u540c\u7684\u534f\u8bae\u4e4b\u4e0a\uff0c\u53c8\u53ef\u4ee5\u53bb\u62bd\u8c61\u4e00\u4e9b\u5171\u6027\u56e0\u7d20\uff0c\u5b9e\u73b0\u76f8\u5173\u63d2\u4ef6\u80fd\u529b\uff0c\u8ba9\u4e0d\u540c\u7684\u534f\u8bae\u53ef\u4ee5\u5171\u4eab\u8fd9\u4e9b\u80fd\u529b\u3002\\n\\n\u6240\u4ee5 xRPC \u7684\u4e3b\u8981\u4f5c\u7528\u53ef\u4ee5\u603b\u7ed3\u4e3a\uff1a**\u63d0\u4f9b\u6807\u51c6\u5316\u5e94\u7528\u5c42\u534f\u8bae\u7684\u63a5\u5165\u80fd\u529b\uff0c\u652f\u6301\u8de8\u534f\u8bae\u7684\u80fd\u529b\u5171\u4eab\uff0c\u4ee5\u53ca\u8ba9\u7528\u6237\u53ef\u4ee5\u83b7\u5f97\u81ea\u5b9a\u4e49\u534f\u8bae\u7684\u6269\u5c55\u80fd\u529b**\u3002\\n\\n#### \u5e94\u7528\u573a\u666f\u793a\u4f8b\\n\\n\u6709\u4e86 xRPC \u534f\u8bae\u6846\u67b6\u4e4b\u540e\uff0c\u5b83\u53ef\u4ee5\u89e3\u51b3\u54ea\u4e9b\u573a\u666f\u5462\uff1f\u8fd9\u91cc\u7b80\u5355\u7ed9\u5927\u5bb6\u4e3e\u51e0\u4e2a\u4f8b\u5b50\u3002\\n\\n1. \u793a\u4f8b 1 \uff1a\u50cf Redis \u5728\u65e9\u671f\u7248\u672c\u4e2d\u662f\u4e0d\u652f\u6301 TLS \u7684\u3002\u5982\u679c\u6211\u4eec\u7cfb\u7edf\u91cc\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u7248\u672c\u7684 Redis\uff0c\u540c\u65f6\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u6682\u65f6\u4e0d\u80fd\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5347\u7ea7 Redis\uff0c\u4f46\u53c8\u6709\u589e\u52a0 TLS \u80fd\u529b\u7684\u9700\u6c42\u3002\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u4ee5\u57fa\u4e8e xPRC \u7684 Redis Protocol \u6765\u89e3\u51b3\u4e0a\u8ff0\u60c5\u51b5\u3002\\n2. \u793a\u4f8b 2\uff1a\u5f53\u6211\u4eec\u60f3\u5bf9\u67d0\u4e9b IP \u6216\u8005\u8c03\u7528\u65b9\u505a\u9891\u7387\u9650\u5236\u5e76\u4e14\u60f3\u76f4\u89c2\u7684\u770b\u5230\u6bcf\u4e2a\u8c03\u7528\u6765\u6e90\u7684\u8c03\u7528\u9891\u7387\uff0c\u8fd9\u4e9b Redis \u81ea\u8eab\u662f\u4e0d\u652f\u6301\u7684\u3002\u6b64\u65f6\u5c31\u53ef\u4ee5\u901a\u8fc7\u90a3\u901a\u8fc7 xRPC \u6269\u5c55\u51fa\u6765\u7684 Redis Protocol \u5b8c\u7f8e\u89e3\u51b3\u3002\\n3. \u793a\u4f8b 3\uff1a\u5982\u679c\u60f3\u5229\u7528 MySQL \u4e34\u65f6\u5f00\u542f\u6162\u67e5\u8be2\u529f\u80fd\uff0c\u53ea\u9700\u63a5\u5165 MySQL Protocol \u5e76\u5728 APISIX \u914d\u7f6e\u76f8\u5173\u7b56\u7565\u5373\u53ef\uff0c\u7701\u53bb\u4e86\u540e\u7eed\u518d\u4e00\u53f0\u53f0\u673a\u5668\u53bb\u767b\u5f55\u5b9e\u4f8b\u7684\u7e41\u7410\u6b65\u9aa4\u3002\\n\\n\u5f53\u7136\uff0c\u7c7b\u4f3c\u7684\u5e94\u7528\u573a\u666f\u8fd8\u5f88\u591a\uff0c\u4e5f\u5e0c\u671b\u5728\u529f\u80fd\u53d1\u5e03\u4e4b\u540e\uff0c\u5927\u5bb6\u591a\u591a\u5728\u5b9e\u9645\u7684\u5e94\u7528\u8fc7\u7a0b\u4e2d\u53bb\u4f53\u9a8c\u548c\u5b9e\u8df5\u3002\u63a5\u5165 xPRC \u540e\u7684\u8c03\u7528\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![\u8c03\u7528\u8fc7\u7a0b](https://static.apiseven.com/202108/1643103835579-d215a120-f62e-4ba5-aa14-59ea3d38a429.png)\\n\\n\u4e00\u65e6\u901a\u8fc7 Apache APISIX \u5b8c\u6210\u4e86\u4e0a\u6e38\u670d\u52a1\u7684\u63a5\u7ba1\uff0c\u5c31\u53ef\u4ee5\u628a\u4e0a\u6e38\u4e0d\u540c\u7684\u5e94\u7528\u670d\u52a1\u8fdb\u884c\u7edf\u4e00\u5316\u7ba1\u7406\u3002\u7c7b\u4f3c\u65e5\u5fd7\u8f93\u51fa\u3001\u76d1\u63a7\u3001\u5b89\u5168\u8fd8\u6709\u95ee\u9898\u6392\u67e5\u7b49\u529f\u80fd\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7\u4e00\u5957\u6807\u51c6\u5316\u7684\u7b56\u7565\u6765\u5b8c\u6210\u3002\\n\\n#### \u8ba1\u5212\u5b9e\u73b0\u9636\u6bb5\\n\\n\u76ee\u524d Apache APISIX xRPC \u6846\u67b6\u7684\u8bbe\u8ba1\uff0c\u521d\u6b65\u5212\u5206\u4e3a 5 \u4e2a\u9636\u6bb5\u3002\\n\\n![\u8ba1\u5212\u5b9e\u73b0\u9636\u6bb5\u56fe](https://static.apiseven.com/202108/1643103835583-40afb0a0-ec20-40e8-84de-b34afee2724c.png)\\n\\n- \u9636\u6bb5\u4e00\uff1aRead \u8bfb\u53d6\u6570\u636e\u4e0e\u534f\u8bae\u89e3\u7801\u3002\\n- \u9636\u6bb5\u4e8c\uff1aAccess Phase \u51c6\u5165\u9636\u6bb5\u3002\u63d0\u4f9b\u63d2\u4ef6\u63a5\u5165\u529f\u80fd\uff0c\u53ef\u5b9e\u73b0\u5b89\u5168\u3001\u6d41\u63a7\u548c\u51c6\u5165\u7b49\u9700\u6c42\u573a\u666f\u3002\\n- \u9636\u6bb5\u4e09\uff1aProxy \u6570\u636e\u8f6c\u53d1\u4e0e\u8d1f\u8f7d\u5747\u8861\u3002\u63d0\u4f9b\u81ea\u5b9a\u4e49\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u53ca\u7b97\u6cd5\u7684\u63a5\u5165\u652f\u6301\u3002\\n- \u9636\u6bb5\u56db\uff1aSend \u53d1\u9001\u6570\u636e\u4e0e\u534f\u8bae\u7f16\u7801\u3002\\n- \u9636\u6bb5\u4e94\uff1aLog Phase \u65e5\u5fd7\u9636\u6bb5\u3002\u63d0\u4f9b\u63d2\u4ef6\u63a5\u5165\u529f\u80fd\uff0c\u5b9e\u73b0\u65e5\u5fd7\u4e0a\u62a5\u548c\u8bb0\u5f55\u7b49\u9700\u6c42\u573a\u666f\u3002\\n\\n## \u591a\u8bed\u8a00\u751f\u6001\\n\\n\u4e3a\u4e86\u6ee1\u8db3\u65e5\u76ca\u4e30\u5bcc\u548c\u5e9e\u5927\u7684\u8ba1\u7b97\u8bed\u8a00\u5e93\uff0c\u6253\u9020\u591a\u8bed\u8a00\u73af\u5883\u7684\u4ee3\u7801\u652f\u6301\u6210\u4e3a\u5e94\u5bf9\u672a\u6765\u6280\u672f\u53d1\u5c55\u7684\u7b2c\u4e00\u95e8\u69db\u3002Apache APISIX \u5728\u591a\u8bed\u8a00\u5f00\u53d1\u7684\u9053\u8def\u4e0a\u4e5f\u505a\u4e86\u5f88\u591a\u7684\u63a2\u7d22\u4e0e\u5b9e\u8df5\u3002\\n\\n\u6bd4\u5982\u5728\u8fd1\u671f\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5bf9 **WebAssembly** \u7684\u652f\u6301\uff0c\u5177\u4f53\u5b9e\u73b0\u7ec6\u8282\u4e0e\u529f\u80fd\u53ef\u53c2\u8003\u300c[Apache APISIX \u62e5\u62b1 WASM \u751f\u6001\u300d](https://apisix.apache.org/zh/blog/2021/11/19/apisix-supports-wasm)\u6587\u7ae0\u3002\u5f53\u7136\uff0c\u76ee\u524d Apache APISIX \u5bf9 WASM \u7684\u529f\u80fd\u652f\u6301\u8fd8\u5c5e\u4e8e\u5b9e\u9a8c\u9636\u6bb5\uff0c\u672a\u6765\u4ecd\u4f1a\u7ee7\u7eed\u5b8c\u5584\u5bf9 WASM \u7684\u76f8\u5173\u652f\u6301\u3002\u5982\u679c\u60a8\u5bf9\u6b64\u9879\u76ee\u611f\u5174\u8da3\uff0c\u4e5f\u6b22\u8fce\u79ef\u6781\u53c2\u4e0e\u5230 [wasm-nginx-module](https://github.com/api7/wasm-nginx-module) \u9879\u76ee\u8d21\u732e\u4e2d\u3002\\n\\n\u540c\u65f6\uff0c\u5728\u5bf9 WASM \u5b9e\u73b0\u652f\u6301\u524d\uff0cApache APISIX \u5df2\u901a\u8fc7 \u300cxPluginRunner \u591a\u8bed\u8a00\u63d2\u4ef6\u8fd0\u884c\u65f6\u300d\u5b9e\u73b0\u4e86\u5bf9\u591a\u79cd\u5f00\u53d1\u8bed\u8a00\u7684\u652f\u6301\u3002\u5373\u5728\u5f00\u53d1 APISIX \u63d2\u4ef6\u65f6\uff0c\u7528\u6237\u4e0d\u4ec5\u53ef\u4ee5\u4f7f\u7528 APISIX \u539f\u751f\u652f\u6301\u7684 Lua \u4ee3\u7801\u53bb\u7f16\u5199\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5404\u81ea\u719f\u6089\u7684\u8bed\u8a00\uff0c\u6bd4\u5982 Go\u3001Java \u548c Python \u7b49\uff0c\u5b9e\u73b0\u5bf9 APISIX \u63d2\u4ef6\u7684\u7f16\u5199\u4e0e\u6269\u5c55\u3002\\n\\n### xPluginRunner\\n\\n![xPluginRunner \u5b9e\u73b0\u65b9\u5f0f\u56fe](https://static.apiseven.com/202108/1642733411405-19b13181-0f5e-46af-837b-66e485f2e0b0.png)\\n\\nxPluginRunner \u7684\u5b9e\u73b0\u65b9\u5f0f\u5982\u4e0a\u56fe\u6240\u793a\u3002\u6574\u4e2a\u901a\u4fe1\u8fc7\u7a0b\u662f\u5728\u5185\u7f6e\u63d2\u4ef6\u300c\u5f00\u59cb\u6267\u884c\u4e4b\u524d\u300d\u548c\u300c\u5b8c\u6210\u6267\u884c\u4e4b\u540e\u300d\uff0cAPISIX \u4f1a\u53d1\u8d77\u672c\u5730 RPC \u8bf7\u6c42\u5230\u5404\u8bed\u8a00\u7684\u63d2\u4ef6\u8fd0\u884c\u65f6\u3002\u5728\u63d2\u4ef6\u8fd0\u884c\u65f6\u4e2d\uff0c\u5b9e\u73b0\u5404\u4e2a\u63d2\u4ef6\u5185\u7684\u8ba1\u7b97\u548c\u7b56\u7565\u5904\u7406\uff0c\u6700\u540e\u5c06\u7ed3\u679c\u54cd\u5e94\u7ed9 APISIX\uff0c\u57fa\u4e8e\u54cd\u5e94\u7ed3\u679c\u518d\u8fdb\u884c\u540e\u7eed\u7684\u51b3\u7b56\u3002\\n\\nxPluginRunner \u4f5c\u4e3a\u8ddf Apache APISIX \u901a\u4fe1\u7684\u6865\u6881\uff0c\u4e3b\u8981\u5b9e\u73b0\u4e86**\u79c1\u6709\u6570\u636e\u534f\u8bae\u7684\u89e3\u6790\u4e0e RPC \u62a5\u6587\u7684\u5c01\u5305\u4e0e\u89e3\u5305**\u3002\\n\\n\u76ee\u524d Apache APISIX xPluginRunner \u7684\u65b9\u6848\u5df2\u7ecf\u5904\u4e8e\u6bd4\u8f83\u7a33\u5b9a\u7684\u9636\u6bb5\u4e86\uff0c\u4ece\u793e\u533a\u53cd\u9988\u4e2d\u4e5f\u5f97\u77e5\u90e8\u5206\u4f01\u4e1a\u5df2\u7ecf\u5f00\u59cb\u5c1d\u8bd5\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5e94\u7528\u4e86\u3002\u5982\u679c\u60a8\u5bf9\u6b64\u9879\u76ee\u611f\u5174\u8da3\uff0c\u4e5f\u6b22\u8fce\u79ef\u6781\u53c2\u4e0e\u5230\u5404\u4e2a\u5f00\u53d1\u8bed\u8a00\u63d2\u4ef6\u9879\u76ee\u4e2d\uff1a\\n\\n- [apisix-go-plugin-runner](https://github.com/apache/apisix-go-plugin-runner)\\n- [apisix-java-plugin-runner](https://github.com/apache/apisix-java-plugin-runner)\\n- [apache-apisix-python-runner](https://github.com/apache/apisix-python-plugin-runner)\\n\\n\u6700\u540e\u6211\u4eec\u5c06\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684 Java \u793a\u4f8b\uff0c\u4e3a\u5927\u5bb6\u5c55\u793a\u4e00\u4e0b\u5982\u4f55\u57fa\u4e8e Java Plugin Runner \u6765\u5f00\u53d1 APISIX \u63d2\u4ef6\u3002\\n\\n### Java Plugin Runner \u793a\u4f8b\\n\\n\u9996\u5148\u5728\u5f00\u53d1\u63d2\u4ef6\u65f6\uff0c\u6211\u4eec\u9700\u8981\u53bb\u5b9e\u73b0 PluginFilter \u7684 Interface\u3002Interface \u4e2d `name` \u65b9\u6cd5\u4e3b\u8981\u7528\u6765\u6807\u8bc6\u548c\u63d0\u53d6\u63d2\u4ef6\u540d\u79f0\uff0c`filter` \u65b9\u6cd5\u5219\u7528\u6765\u8fc7\u6ee4\u8bf7\u6c42\uff08\u4e5f\u5c31\u662f\u6267\u884c\u63d2\u4ef6\u4e3b\u4f53\u903b\u8f91\uff09\u3002\\n\\n![Plugin](https://static.apiseven.com/202108/1642733591297-642091b2-d4c7-4098-b7ff-41ffa5a2e00a.png)\\n\\n![Interface](https://static.apiseven.com/202108/1642733657248-5b7db563-f95f-4683-997e-47e76eeda4d9.png)\\n\\n\u9700\u8981\u989d\u5916\u6ce8\u610f\u4e00\u70b9\uff0c\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u51fa\u73b0\u7684 `request` \u548c `response` \u4e24\u4e2a\u53c2\u6570\u5728 Runner \u4e2d\u5b58\u5728\u56fa\u5b9a\u903b\u8f91\uff08\u6240\u6709 Runner \u90fd\u9002\u7528\uff09\uff1a\\n\\n1. \u5982\u679c\u5e0c\u671b\u8bf7\u6c42\u7ee7\u7eed\u8f6c\u53d1\uff0c\u4ec5\u8fdb\u884c\u4e00\u4e9b\u7b56\u7565\u8bbe\u7f6e\uff08\u5982\u6539\u5199\u8bf7\u6c42\u53c2\u6570\u3001\u5934\u4fe1\u606f\u7b49\uff09\uff0c\u53ea\u9700\u64cd\u4f5c `request` \u5bf9\u8c61\u5373\u53ef\u3002\\n2. \u5982\u679c\u60f3\u8981\u7ec8\u6b62\u8bf7\u6c42\uff0c\u53ef\u4ee5\u901a\u8fc7 `response` \u5bf9\u8c61\u6765\u5b8c\u6210\uff08\u5982\u8bbe\u7f6e\u54cd\u5e94\u4f53\u3001\u54cd\u5e94\u5934\u3001\u72b6\u6001\u7801\u7b49\uff09\u3002\\n\\n:::note \u6ce8\u610f\\nAPISIX \u4e00\u65e6\u611f\u77e5\u5230 Runner \u4e2d\u7684 `response` \u5bf9\u8c61\u88ab\u64cd\u4f5c\u5c31\u4f1a\u7acb\u5373\u7ec8\u6b62\u5f53\u524d\u8bf7\u6c42\u3002\\n:::\\n\\n\u63d2\u4ef6\u5f00\u53d1\u5b8c\u6210\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 APISIX \u4e2d\u8fdb\u884c\u5e94\u7528\u7684\u5b9e\u8df5\u4e86\u3002\u9996\u5148\u5c06 Runner \u53ca\u9879\u76ee\u4e2d\u7684\u63d2\u4ef6\u7f16\u8bd1\u4e3a jar \u5305\uff0c\u5e76\u5c06 jar \u5305\u7684\u7edd\u5bf9\u8def\u5f84\u914d\u7f6e\u5230 APISIX \u4e3b\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u914d\u7f6e\u65b9\u5f0f\u5982\u4e0b\uff1a\\n\\n![\u5c06 Runner jar \u914d\u7f6e\u5230 APISIX \u4e3b\u914d\u7f6e](https://static.apiseven.com/202108/1642733807923-9e3ad231-0094-4e37-a830-29973b43e495.png)\\n\\n\u6700\u540e\u91cd\u542f Apache APISIX\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u8def\u7531\u548c\u63d2\u4ef6\u7684\u914d\u7f6e\u53ca\u8bf7\u6c42\u9a8c\u8bc1\u73af\u8282\u4e86\u3002\\n\\n![\u8def\u7531\u548c\u63d2\u4ef6\u914d\u7f6e](https://static.apiseven.com/202108/1642733908224-64f3ec2c-6d33-4130-b8b6-0fe10e00c48e.png)\\n\\n![\u8bf7\u6c42\u9a8c\u8bc1](https://static.apiseven.com/202108/1642733944940-69b06c71-22f7-45e4-9b6d-7f1b62167180.png)\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86 Apache APISIX \u5373\u5c06\u53d1\u5e03\u7684 xRPC \u6846\u67b6\u4ee5\u53ca\u76f8\u5173\u7ec6\u8282\uff0c\u540c\u65f6\u4ecb\u7ecd\u4e86 Apache APISIX \u5728\u591a\u8bed\u8a00\u5f00\u53d1\u652f\u6301\u4e2d\u7684\u7ec6\u8282\u5c55\u793a\u3002\u901a\u8fc7\u591a\u534f\u8bae\u4ee3\u7406\u4e0e\u591a\u8bed\u8a00\u652f\u6301\u4e24\u4e2a\u89d2\u5ea6\uff0c\u5145\u5206\u5c55\u793a\u4e86 Apache APISIX \u5728\u9762\u5411\u751f\u6001\u7684\u591a\u9879\u52aa\u529b\u3002\u4e5f\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"CDN \u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u53c8\u62cd\u4e91\u7684\u516c\u7f51\u7f51\u5173\u573a\u666f\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/01/20/upyun-public-gateway-usecase","source":"@site/blog/2022/01/20/upyun-public-gateway-usecase.md","title":"CDN \u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u53c8\u62cd\u4e91\u7684\u516c\u7f51\u7f51\u5173\u573a\u666f\u5b9e\u8df5","description":"\u5728\u516c\u7f51\u7f51\u5173\u573a\u666f\u4e0b\uff0c\u53c8\u62cd\u4e91\u57fa\u4e8e APISIX \u8054\u52a8\u4e86\u516c\u53f8\u5185\u90e8\u5e73\u53f0\u4ee5\u53ca\u98de\u4e66\u63d0\u9192\u529f\u80fd\u7684\u63a5\u5165\u3002\u540c\u65f6\u4ece\u5f00\u6e90\u548c\u53ef\u62d3\u5c55\u6027\u65b9\u9762\u4e5f\u5e26\u6765\u4e86\u4e00\u4e9b\u4f01\u4e1a\u89d2\u5ea6\u53c2\u8003\u3002","date":"2022-01-20T00:00:00.000Z","formattedDate":"2022\u5e741\u670820\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":8.3,"truncated":true,"authors":[{"name":"\u82cf\u94b0","url":"https://github.com/SylviaBABY","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u591a\u534f\u8bae\u63a5\u5165\u6846\u67b6 xRPC \u7ec6\u8282\u524d\u77bb","permalink":"/zh/blog/2022/01/21/apisix-xrpc-details-and-miltilingual"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff081.1-1.16\uff09","permalink":"/zh/blog/2022/01/19/weekly-report-0116"}},"content":"> \u5728\u4e4b\u524d\u7684\u5206\u4eab\u4e2d\uff0c\u6211\u4eec\u4e3a\u5927\u5bb6\u5e26\u6765\u4e86\u53c8\u62cd\u4e91\u5728 Ingress \u5c42\u9762\u7684\u5e94\u7528\u3002\u800c\u8fd9\u6b21\u6211\u4eec\u4f1a\u5728\u516c\u7f51\u7f51\u5173\u573a\u666f\u4e0b\uff0c\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u76ee\u524d\u53c8\u62cd\u4e91\u7684\u5e94\u7528\u5b9e\u4f8b\uff0c\u5e0c\u671b\u80fd\u5728\u4e91\u5b58\u50a8\u884c\u4e1a\u9886\u57df\uff0c\u7ed9\u5927\u5bb6\u5e26\u6765\u4e00\u4e9b\u5b9e\u7528\u7684 Apache APISIX \u573a\u666f\u5206\u4eab\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u4e1a\u52a1\u573a\u666f\u6982\u89c8\\n\\n[\u53c8\u62cd\u4e91](https://www.upyun.com/)\u662f\u76ee\u524d\u5728\u4e1a\u52a1\u573a\u666f\u4e2d\u5df2\u90e8\u7f72 Apache APISIX \u7684\u7528\u6237\u4e4b\u4e00\u3002\u53c8\u62cd\u4e91\u4ee5\u573a\u666f\u5316 CDN \u4e3a\u6838\u5fc3\u4e1a\u52a1\uff0c\u4e3a\u5ba2\u6237\u63d0\u4f9b\u4e91\u5b58\u50a8\u3001\u4e91\u5904\u7406\u3001\u4e91\u5b89\u5168\u3001\u6d41\u91cf\u8425\u9500\u7b49\u670d\u52a1\uff0c\u5e2e\u52a9\u7528\u6237\u5b9e\u73b0\u5185\u5bb9\u5206\u53d1\u52a0\u901f\u3001\u4ea7\u54c1\u7814\u53d1\u52a0\u901f\u3001\u4e1a\u52a1\u6210\u957f\u52a0\u901f\u3002\\n\\n\u76ee\u524d Apache APISIX \u5df2\u5728\u53c8\u62cd\u4e91\u5185\u90e8\u7528\u4e8e\u300c\u516c\u7f51\u7f51\u5173\u300d\u548c\u300cIngress \u7f51\u5173\u300d\u4e24\u79cd\u4e1a\u52a1\u573a\u666f\u8fdb\u884c\u4f7f\u7528\u4e0e\u90e8\u7f72\u3002\u793e\u533a\u5185\u4e4b\u524d\u5df2\u7ecf\u53d1\u5e03\u4e86\u4e00\u7bc7\u5173\u4e8e[\u53c8\u62cd\u4e91\u4f7f\u7528 Apache APISIX Ingress \u7684\u76f8\u5173\u7528\u4f8b\u5206\u4eab](https://apisix.apache.org/zh/blog/2021/09/24/youpaicloud-usercase/)\uff0c\u800c\u8fd9\u6b21\u6211\u4eec\u4f1a\u5728\u300c\u516c\u7f51\u7f51\u5173\u300d\u573a\u666f\u4e0b\uff0c\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e00\u4e9b\u76ee\u524d\u53c8\u62cd\u4e91\u7684\u5e94\u7528\u5b9e\u4f8b\uff0c\u5e0c\u671b\u80fd\u5728\u4e91\u5b58\u50a8\u884c\u4e1a\u9886\u57df\uff0c\u7ed9\u5927\u5bb6\u5e26\u6765\u4e00\u4e9b\u5b9e\u7528\u7684 Apache APISIX \u573a\u666f\u5206\u4eab\u3002\\n\\n## \u573a\u666f\u7528\u4f8b\u5c55\u793a\\n\\n\u76ee\u524d\u53c8\u62cd\u4e91\u5185\u90e8\u7684\u7f51\u5173\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\u3002\u5916\u90e8\u6d41\u91cf\u901a\u8fc7 Apache APISIX \u4f20\u8f93\u5230\u5185\u90e8\uff0c\u4e4b\u540e\u518d\u5c06\u6d41\u91cf\u901a\u8fc7 Apache APISIX \u4f20\u8f93\u5230 APISIX Ingress\uff0c\u6700\u540e\u5230\u8fbe\u540e\u7aef\u670d\u52a1\u8fdb\u884c\u540e\u7eed\u4e1a\u52a1\u5904\u7406\u3002\\n\\n![\u5185\u90e8\u67b6\u6784](https://static.apiseven.com/202108/1642583575107-999099c4-adad-439b-8f31-bdca22f39f29.png)\\n\\n\u800c\u4f5c\u4e3a\u5916\u90e8\u6d41\u91cf\u7684\u5165\u53e3\u7b2c\u4e00\u5173\uff0c\u516c\u7f51\u7f51\u5173\u5219\u8981\u62c5\u8d77\u91cd\u4efb\uff0c\u5c06\u5916\u90e8\u8fdb\u5165\u5185\u90e8\u6570\u636e\u4e2d\u5fc3\u7684\u6d41\u91cf\u5168\u90e8\u63a7\u5236\u8d77\u6765\u3002\\n\\n\u53c8\u62cd\u4e91\u539f\u672c\u7684\u516c\u7f51\u7f51\u5173\u90e8\u7f72\u662f Kong\uff0c\u73b0\u5728\u5df2\u5c06 Kong \u6162\u6162\u8fc1\u79fb\u5230 Apache APISIX \u4e2d\u3002\u76ee\u524d\u5df2\u5c06\u4e4b\u524d Kong \u5904\u7406\u6d41\u91cf\u7684 30% \u8fc1\u79fb\u5230\u4e86 APISIX \u4e2d\uff0c\u8fc1\u79fb\u5de5\u4f5c\u8fd8\u5728\u9010\u6b65\u8fdb\u884c\u3002\\n\\n\u4e4b\u6240\u4ee5\u5c06 Kong \u5207\u6362\u4e3a APISIX \u662f\u56e0\u4e3a\uff0cKong \u67b6\u6784\u4e2d\u9700\u8981\u8fde\u63a5 PostgreSQL \u6570\u636e\u5e93\u3002\u5728\u6dfb\u52a0\u8def\u7531\u6216\u91cd\u542f\u8def\u7531\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u51fa\u73b0\u51e0\u5343\u4e0a\u4e07\u4e2a\u8fde\u63a5\u94fe\u5230 Postgre\u3002\u800c\u6b64\u65f6\u4e00\u65e6\u8fdb\u884c\u66f4\u65b0\u6216\u91cd\u542f\uff0c\u5373\u4fbf\u5728\u524d\u4fa7\u52a0\u4e86\u4ee3\u7406\u4e5f\u65e0\u6cd5\u63a7\u5236\u8fd9\u5957\u8fde\u63a5\uff0c\u5c24\u5176\u662f\u8def\u7531\u8d8a\u591a\u8fd9\u79cd\u60c5\u51b5\u8d8a\u9ebb\u70e6\u3002\\n\\n\u57fa\u4e8e\u6b64\uff0cApache APISIX \u5f00\u59cb\u9010\u6b65\u63a5\u624b\u53c8\u62cd\u4e91\u7684\u516c\u7f51\u7f51\u5173\u529f\u80fd\uff0c\u76ee\u524d\u4e3b\u8981\u5e94\u7528\u4e8e\u4ee5\u4e0b\u4e1a\u52a1\u573a\u666f\u670d\u52a1\uff1a\\n\\n1. \u901a\u8fc7 APISIX \u7f51\u5173\u5904\u7406 CDN \u8fb9\u7f18\u8282\u70b9\u7684 API \u8bbf\u95ee\uff0c\u4e3b\u8981\u7528\u4e8e\u540e\u7eed\u6d41\u91cf\u7ba1\u7406\\n2. \u901a\u8fc7 APISIX \u5904\u7406\u5b98\u7f51\u9759\u6001\u9875\u9762\u548c\u6280\u672f\u652f\u6301\u76f8\u5173\u7684\u6d41\u91cf\\n\\n\u7531\u4e8e\u76ee\u524d\u8fd8\u672a\u5168\u9762\u8fc1\u79fb\u5b8c\u6bd5\uff0c\u76ee\u524d Apache APISIX \u4ec5\u5bf9\u63a5\u4e86\u5185\u90e8 3 \u4e2a\u6570\u636e\u4e2d\u5fc3\uff0c\u5927\u6982 20 \u53f0\u673a\u5668\u3002\u5728\u6d41\u91cf\u5904\u7406\u65b9\u9762\uff0cApache APISIX \u5f88\u51fa\u8272\u5730\u5b8c\u6210\u4e86\u5907\u4efd\u4e0e\u6d41\u91cf\u627f\u8f7d\u65b9\u9762\u7684\u9700\u6c42\u3002\\n\\n\u800c\u4f5c\u4e3a\u53c8\u62cd\u4e91\u7684\u516c\u7f51\u7f51\u5173\uff0cApache APISIX \u9664\u4e86\u8981\u5728\u5165\u53e3\u8fdb\u884c\u7edf\u4e00\u7684\u6d41\u91cf\u7ba1\u7406\uff0c\u8fd8\u5728\u6570\u636e\u5c42\u9762\u5bf9\u7528\u6237\u767b\u5f55\u7b49\u573a\u666f\u8fdb\u884c\u4e86\u4e00\u4e9b\u4e0d\u540c\u529f\u80fd\u7684\u4f7f\u7528\u3002\\n\\n### \u63d2\u4ef6\u573a\u666f\uff1a\u767b\u5f55\u5185\u90e8\u5e73\u53f0\\n\\n\u76ee\u524d\u5728\u53c8\u62cd\u4e91\u516c\u53f8\u5185\u90e8\uff0c\u5458\u5de5\u767b\u5f55\u5185\u90e8\u5e73\u53f0\u9700\u8981\u901a\u8fc7\u90ae\u7bb1\u548c\u98de\u4e66\u7b49\u76f8\u5173\u8ba4\u8bc1\u8fdb\u884c\u63a5\u5165\u3002\\n\u5177\u4f53\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```json\\n    \\"openid-connect\\": {\\n      \\"access_token_in_authorization_header\\": false,\\n      \\"bearer_only\\": false,\\n      \\"client_id\\": \\"upyun-oauth\\",\\n      \\"client_secret\\": \\"xxxx\\",\\n      \\"disable\\": false,\\n      \\"discovery\\": \\"https://xxxx.upyun.com/oauth2/.well-known/openid-configuration\\",\\n      \\"introspection_endpoint_auth_method\\": \\"client_secret_basic\\",\\n      \\"logout_path\\": \\"/logout\\",\\n      \\"realm\\": \\"apisix\\",\\n      \\"redirect_uri\\": \\"/upyun-oauth\\",\\n      \\"scope\\": \\"openid email profile offline_access\\",\\n      \\"session_contents\\": {\\n        \\"access_token\\": true,\\n        \\"user\\": true\\n      },\\n      \\"set_access_token_header\\": false,\\n      \\"set_id_token_header\\": false,\\n      \\"set_userinfo_header\\": true,\\n      \\"timeout\\": 15\\n    },\\n```\\n\\n\u5229\u7528 Apache APISIX \u7684 `openid-connect` \u63d2\u4ef6\uff0c\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u5bf9\u63a5\u4e0a\u8ff0\u5e73\u53f0\u8fdb\u884c\u5458\u5de5\u8eab\u4efd\u8ba4\u8bc1\uff0c\u8fdb\u800c\u7edf\u4e00\u767b\u5f55\u5230\u53c8\u62cd\u4e91\u7684\u7ba1\u7406\u5e73\u53f0\u3002\\n\\n![\u767b\u5f55\u754c\u9762](https://static.apiseven.com/202108/1642583971338-e3aab730-2b75-4065-ba04-4c4fa3fafad9.png)\\n\\n### \u63d2\u4ef6\u573a\u666f\uff1a\u8054\u52a8\u98de\u4e66\u4efb\u52a1\u63d0\u9192\\n\\n\u800c\u5728\u66f4\u7ec6\u8282\u7684\u5e94\u7528\u573a\u666f\u4e0b\uff0c\u53c8\u62cd\u4e91\u5185\u90e8\u4e5f\u901a\u8fc7 `openid-connect` \u63d2\u4ef6\u914d\u5408 `serverless-post-function` \u63d2\u4ef6\u5b8c\u6210\u4e86\u4e0e\u98de\u4e66\u5e94\u7528\u7684\u8054\u52a8\u3002\\n\\n\u901a\u8fc7\u4ee5\u4e0a\u63d2\u4ef6\u7684\u914d\u5408\uff0c\u53ef\u4ee5\u5c06\u76f8\u5173\u7528\u6237\u4fe1\u606f\uff08username\u3001email \u6216\u8005\u7528\u6237\u5728\u98de\u4e66\u6709\u5e94\u7528\u5185\u7684\u552f\u4e00\u6807\u8bc6\uff09\u7b49\u4f20\u8f93\u7ed9\u516c\u7f51\u7f51\u5173\u540e\u7684\u670d\u52a1\u3002\u7f51\u5173\u83b7\u53d6\u5230\u76f8\u5173\u6807\u8bc6\u4fe1\u606f\u540e\u8f6c\u53d1\u7ed9\u670d\u52a1\u7aef\uff0c\u5b8c\u6210\u98de\u4e66\u63d0\u9192\u6216\u8005@\u7b49\u8054\u52a8\u529f\u80fd\u3002\\n\\n```c\\nreturn function(config, ctx)\\n  local core = require(\'apisix.core\');\\n  local user = ngx.req.get_headers()[\'X-Userinfo\'];\\n....\\n  if name then\\n    if not ctx.consumer_name then\\n      ctx.consumer_name = name;\\n    end;\\n    core.request.set_header(ctx, \'X-Forwarded-Username\', name)\\n  end;\\n  if user_id then\\n    core.request.set_header(ctx, \'X-Forwarded-UserID\', user_id)\\n  end;\\nend\\n```\\n\\n\u5f53\u7136\uff0c\u5728\u6b64\u8fc7\u7a0b\u4e2d\u4e5f\u53ef\u4ee5\u5229\u7528 `consumer-restriction` \u63d2\u4ef6\u5bf9 Consumer \u8fdb\u884c\u4e00\u4e9b\u6743\u9650\u9650\u5236\u3002\\n\\n## CDN \u4e1a\u52a1\u4e0b\uff0c\u5f71\u54cd\u7f51\u5173\u9009\u578b\u7684\u5173\u952e\u56e0\u7d20\\n\\n\u4f5c\u4e3a Apache APISIX \u7684\u4f01\u4e1a\u7528\u6237\uff0c\u53c8\u62cd\u4e91\u8fd9\u79cd\u4ee5\u573a\u666f\u5316 CDN \u8fdb\u884c\u4e91\u5b58\u50a8\u4e0e\u591a\u7ebf\u5904\u7406\u7684\u4e1a\u52a1\u573a\u666f\uff0c\u5728\u7f51\u5173\u4ea7\u54c1\u7684\u9009\u578b\u4e0a\u4e5f\u5206\u4eab\u4e86\u4ed6\u4eec\u7684\u4e00\u4e9b\u6807\u51c6\u3002\\n\\n### \u7a33\u5b9a\u6027\\n\\n\u4f5c\u4e3a\u4e91\u4e0a\u4e1a\u52a1\u7684\u5bf9\u5916\u5206\u53d1\uff0c\u9996\u5148\u770b\u91cd\u7684\u5fc5\u7136\u662f\u7a33\u5b9a\u6027\u3002\u4e00\u4e2a\u5177\u6709\u7a33\u5b9a\u6027\u7684\u7f51\u5173\u4e1a\u52a1\u4ea7\u54c1\uff0c\u9664\u4e86\u80fd\u4fdd\u8bc1\u5bf9\u5916\u7528\u6237\u4fa7\u7684\u4f7f\u7528\u4f53\u9a8c\u5916\uff0c\u8fd8\u80fd\u4fdd\u8bc1\u516c\u53f8\u5185\u90e8\u4e1a\u52a1\u90e8\u7f72\u7684\u8fd0\u7ef4\u6210\u672c\u5f97\u5230\u6709\u6548\u53ef\u63a7\u3002\u5c24\u5176\u662f\u5bf9\u4e8e\u4e00\u4e9b\u516c\u53f8\u89c4\u6a21\u4e0d\u5927\u6216\u8005\u662f\u8fd0\u7ef4\u56e2\u961f\u4eba\u5458\u4e0d\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u7a33\u5b9a\u6027\u662f\u5176\u9996\u8981\u8003\u8651\u7684\u5173\u952e\u56e0\u7d20\u3002\\n\\n### \u5f00\u6e90\u4e0e\u6269\u5c55\u6027\\n\\n\u5bf9\u4e8e\u53c8\u62cd\u4e91\u6280\u672f\u56e2\u961f\u800c\u8a00\uff0c\u5f00\u6e90\u4e0e\u5426\u4e5f\u6210\u4e3a\u7f51\u5173\u9009\u578b\u7684\u91cd\u8981\u56e0\u7d20\u3002\u5f97\u76ca\u4e8e\u793e\u533a\u7684\u6d3b\u8dc3\u5c5e\u6027\uff0c\u901a\u5e38\u5728\u51fa\u73b0 Bug \u7684\u7b2c\u4e00\u65f6\u95f4\u53cd\u9988\u7ed9\u793e\u533a\u5c31\u4f1a\u5f88\u5feb\u5f97\u5230\u56de\u5e94\u3002\u4e0d\u540c\u4e8e\u95ed\u6e90\u8f6f\u4ef6\uff0c\u5982\u679c\u51fa\u73b0 Bug\uff0c\u901a\u8fc7\u5b98\u65b9\u6e20\u9053\u53cd\u9988\u540e\u53ef\u80fd\u8fd8\u4e0d\u77e5\u9053\u8981\u7b49\u591a\u4e45\u624d\u80fd\u6536\u5230\u5b98\u65b9\u63a8\u9001\u5e26\u4fee\u590d Bug \u7684\u65b0\u7248\u672c\u3002\u5c24\u5176\u662f\u5bf9\u4e8e\u53c8\u62cd\u4e91\u8fd9\u79cd\u4e91\u4e0a\u4e1a\u52a1\u5904\u7406\u60c5\u51b5\uff0c\u54cd\u5e94\u901f\u5ea6\u76f4\u63a5\u5173\u7cfb\u7740\u516c\u53f8\u4e1a\u52a1\u3002\\n\\n\u540c\u65f6\u5f00\u6e90\u7684\u9ad8\u6269\u5c55\u6027\u4e5f\u662f\u7ed9\u5f00\u53d1\u4eba\u5458\u5e26\u6765\u4e86\u66f4\u65b9\u4fbf\u7684\u9002\u914d\u4e0e\u96c6\u6210\u3002\u50cf\u662f Apache APISIX \u7684\u591a\u8bed\u8a00\u6269\u5c55\uff0c\u65b9\u4fbf\u4e86\u53c8\u62cd\u4e91\u5728\u4e1a\u52a1\u6269\u5c55\u573a\u666f\u4e0b\uff0c\u57fa\u4e8e APISIX \u53bb\u5f00\u53d1\u66f4\u591a\u9002\u7528\u4e8e\u4ed6\u4eec\u4e1a\u52a1\u573a\u666f\u7684\u529f\u80fd\u3002\u5728\u51cf\u8f7b\u5f00\u53d1\u6210\u672c\u7684\u540c\u65f6\uff0c\u4e5f\u4e3a\u540e\u7eed\u7684\u529f\u80fd\u8fed\u4ee3\u548c\u7ef4\u62a4\u63d0\u9ad8\u4e86\u4fbf\u5229\u6027\u3002\\n\\n## \u603b\u7ed3\\n\\n\u53c8\u62cd\u4e91\u4f5c\u4e3a CDN \u4e91\u4e0a\u5904\u7406\u4e1a\u52a1\u65b9\uff0c\u5df2\u7ecf\u9010\u6e10\u5728\u516c\u7f51\u7f51\u5173\u548c Ingress \u5c42\u9762\u6df1\u5ea6\u4f7f\u7528 Apache APISIX\u3002\u5e0c\u671b\u901a\u8fc7\u8fd9\u4e00\u7cfb\u5217\u7684\u7528\u6237\u6848\u4f8b\u5206\u4eab\uff0c\u80fd\u4e3a\u5927\u5bb6\u5728\u7f51\u5173\u9009\u578b\u7684\u8fc7\u7a0b\u4e2d\u63d0\u4f9b\u4e00\u4e9b\u601d\u8def\u4e0e\u65b9\u5411\u3002\\n\\n\u540c\u65f6\uff0cApache APISIX \u4e5f\u6b22\u8fce\u6b63\u5728\u4f7f\u7528 APISIX \u7684\u4f01\u4e1a\u7528\u6237\u79ef\u6781\u53c2\u4e0e\u5206\u4eab\u76f8\u5173\u7528\u6237\u6848\u4f8b\u5b9e\u8df5\uff0c\u4e5f\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff081.1-1.16\uff09","metadata":{"permalink":"/zh/blog/2022/01/19/weekly-report-0116","source":"@site/blog/2022/01/19/weekly-report-0116.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff081.1-1.16\uff09","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2022-01-19T00:00:00.000Z","formattedDate":"2022\u5e741\u670819\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.175,"truncated":true,"authors":[],"prevItem":{"title":"CDN \u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u53c8\u62cd\u4e91\u7684\u516c\u7f51\u7f51\u5173\u573a\u666f\u5b9e\u8df5","permalink":"/zh/blog/2022/01/20/upyun-public-gateway-usecase"},"nextItem":{"title":"APISIX \u96c6\u6210 Kafka \u5b9e\u73b0\u9ad8\u6548\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7","permalink":"/zh/blog/2022/01/17/apisix-kafka-integration"}},"content":"> \u4ece 1.1 \u5230 1.16, \u6709 29 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 81 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1642497489523-6ecc24de-b678-40cb-9211-f6b7c4a042af.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1642497489549-c7a58466-2819-424f-a6db-416ecdb96f7c.png)\\n\\n## Good first issue\\n\\n### Issue #6078\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/6078\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5bf9 http_to_https \u4f7f\u7528\u63d2\u4ef6\u91cd\u5b9a\u5411\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee\u65e0\u9650301\u3002\\n\\n\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a APISIX \u5728\u4e00\u4e2a\u4ee3\u7406\u540e\u9762\uff0c\u8be5\u4ee3\u7406\u54cd\u5e94\u89e3\u5bc6 TLS \u5e76\u59cb\u7ec8\u5c06 HTTP \u65b9\u6848\u4ee3\u7406\u5230 APISIX\u3002\\n\\n\u5148\u770b\u770b\u91cd\u5b9a\u5411\u63d2\u4ef6\u4ee3\u7801\uff1a\\n\\n```Lua\\nif conf.http_to_https and ctx.var.scheme == \\"http\\" then\\n-- ignore\\nend\\n```\\n\\n\u8fd9\u663e\u7136\u4f1a\u4f7f\u91cd\u5b9a\u5411\u4e00\u76f4\u5faa\u73af\u3002\\n\\n\u89e3\u51b3\u7684\u529e\u6cd5\u662f\u7ed9\u8fd9\u4e2a\u63d2\u4ef6\u6253\u8865\u4e01\uff0c\u5c31\u50cf\uff1a\\n\\n```Lua\\nlocal proxy_proto = core.request.header(ctx, \\"x-forwarded-proto\\")\\nlocal _scheme = proxy_proto and proxy_proto or ctx.var.scheme\\nif conf.http_to_https and _scheme == \\"http\\" then\\n-- ignore\\nend\\n```\\n\\n### Issue #5915\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5915\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5047\u8bbe\u6709\u4e24\u4e2a\u5b57\u6bb5\uff0c`include_resp_body` \u4f5c\u4e3a\u5f00\u5173\uff0c`resp_limit_size` \u4f5c\u4e3a\u9650\u5236\u5927\u5c0f\u3002\u914d\u7f6e\u8fd9\u4e24\u4e2a\u53c2\u6570\u540e\uff0c\u5982\u679c resp_body \u8d85\u8fc7 resp_limit_size \u7684\u5927\u5c0f\uff0cresp_body \u5c06\u4e0d\u4f1a\u88ab\u8bb0\u5f55\u5728\u65e5\u5fd7\u4e2d\u3002\u5bf9\u4e8e req_body \u4e5f\u662f\u5982\u6b64\u3002\\n\\n\u6216\u8bb8\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u9650\u5236\u5927\u5c0f\u622a\u65ad\u8fc7\u5927\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u4e3b\u4f53\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [\u652f\u6301 TLS over TCP upstream](https://github.com/apache/apisix/pull/6030)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [\u652f\u6301\u5728 basic-auth \u4e2d\u9690\u85cf Authorization \u8bf7\u6c42\u5934](https://github.com/apache/apisix/pull/6039)\uff08\u8d21\u732e\u8005\uff1a[mangoGoForward](https://github.com/mangoGoForward)\uff09\\n\\n- [\u652f\u6301\u52a8\u6001\u8bbe\u7f6e proxy_request_buffering](https://github.com/apache/apisix/pull/6075)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [mqtt \u652f\u6301\u901a\u8fc7 client id \u8d1f\u8f7d\u5747\u8861](https://github.com/apache/apisix/pull/6079)\uff08\u8d21\u732e\u8005\uff1a[https://github.com/apache/apisix/pull/6079](https://github.com/https://github.com/apache/apisix/pull/6079)\uff09\\n\\n- [\u6dfb\u52a0 forward-auth \u63d2\u4ef6](https://github.com/apache/apisix/pull/6037)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [\u652f\u6301 gRPC-Web \u4ee3\u7406](https://github.com/apache/apisix/pull/5964)\uff08\u8d21\u732e\u8005\uff1a[shuaijinchao](https://github.com/shuaijinchao)\uff09\\n\\n- [limit-count \u652f\u6301\u8bf7\u6c42\u95f4\u5171\u4eab\u8ba1\u6570\u5668](https://github.com/apache/apisix/pull/5984)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [Apache APISIX \u96c6\u6210 Kafka \u5b9e\u73b0\u9ad8\u6548\u7387\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7](https://apisix.apache.org/zh/blog/2022/01/17/apisix-kafka-integration/)\uff1a\\n\\n  Apache APISIX \u65e9\u5728 1.2 \u7248\u672c\u5f00\u59cb\u5c31\u5df2\u7ecf\u63d0\u4f9b\u4e86 `kafka-logger` \u63d2\u4ef6\u7684\u652f\u6301\uff0c\u5176\u540e\u53c8\u7ecf\u8fc7\u591a\u6b21\u529f\u80fd\u5f3a\u5316\uff0c\u76ee\u524d\u5df2\u5177\u5907\u975e\u5e38\u6210\u719f\u4e14\u5b8c\u5584\u7684\u529f\u80fd\u3002\u652f\u6301\u5c06 API \u8bf7\u6c42\u65e5\u5fd7\uff0c\u751a\u81f3\u8bf7\u6c42\u4f53\u548c\u54cd\u5e94\u4f53\u4ee5 JSON \u683c\u5f0f\u63a8\u9001\u81f3 Kafka \u96c6\u7fa4\u4e2d\u3002\\n\\n- [\u4ece\u539f\u7406\u5230\u64cd\u4f5c\uff0c\u8ba9\u4f60\u5728 Apache APISIX \u4e2d\u4ee3\u7406 Dubbo \u670d\u52a1\u66f4\u4fbf\u6377](https://apisix.apache.org/zh/blog/2022/01/13/how-to-proxy-dubbo-in-apache-apisix)\uff1a\\n\\n  \u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5982\u4f55\u501f\u52a9 Apache APISIX \u5b9e\u73b0 Dubbo Service \u7684\u4ee3\u7406\uff0c\u901a\u8fc7\u5f15\u5165 dubbo-proxy \u63d2\u4ef6\u4fbf\u53ef\u4e3a Dubbo \u6846\u67b6\u7684\u540e\u7aef\u7cfb\u7edf\u6784\u5efa\u66f4\u7b80\u5355\u66f4\u9ad8\u6548\u7684\u6d41\u91cf\u94fe\u8def\u3002\\n\\n- [\u5982\u4f55\u5728 ARM Ubuntu \u4e2d\u6784\u5efa Apache APISIX](https://apisix.apache.org/zh/blog/2022/01/11/building-apisix-in-ubuntu-for-arm)\uff1a\\n\\n  \u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u60a8\u5c06\u4e86\u89e3\u5982\u4f55\u5728 ARM Ubuntu \u4e2d\u901a\u8fc7\u6e90\u7801\u6784\u5efa Apache APISIX\uff08M1 \u82af\u7247\u73af\u5883\uff09\u3002ARM Ubuntu \u7cfb\u7edf\u501f\u52a9\u4e86 https://multipass.run/ \u5b89\u88c5\u3002"},{"id":"APISIX \u96c6\u6210 Kafka \u5b9e\u73b0\u9ad8\u6548\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7","metadata":{"permalink":"/zh/blog/2022/01/17/apisix-kafka-integration","source":"@site/blog/2022/01/17/apisix-kafka-integration.md","title":"APISIX \u96c6\u6210 Kafka \u5b9e\u73b0\u9ad8\u6548\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 Apache APISIX \u4e2d\u4f7f\u7528 kafka-logger \u63d2\u4ef6\u3002\u7ecf\u8fc7\u591a\u6b21\u529f\u80fd\u5f3a\u5316\u540e\uff0c\u76ee\u524d\u8be5\u63d2\u4ef6\u5df2\u5177\u5907\u975e\u5e38\u6210\u719f\u4e14\u5b8c\u5584\u7684\u529f\u80fd\u3002","date":"2022-01-17T00:00:00.000Z","formattedDate":"2022\u5e741\u670817\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":6.185,"truncated":true,"authors":[{"name":"\u767d\u6cfd\u5e73","title":"Author","url":"https://github.com/bzp2010","image_url":"https://avatars.githubusercontent.com/u/8078418?v=4","imageURL":"https://avatars.githubusercontent.com/u/8078418?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff081.1-1.16\uff09","permalink":"/zh/blog/2022/01/19/weekly-report-0116"},"nextItem":{"title":"\u8ba9\u4f60\u5728 Apache APISIX \u4e2d\u4ee3\u7406 Dubbo \u670d\u52a1\u66f4\u4fbf\u6377","permalink":"/zh/blog/2022/01/13/how-to-proxy-dubbo-in-apache-apisix"}},"content":"> Apache APISIX \u65e9\u5728 1.2 \u7248\u672c\u5f00\u59cb\u5c31\u5df2\u7ecf\u63d0\u4f9b\u4e86 `kafka-logger` \u63d2\u4ef6\u7684\u652f\u6301\uff0c\u5176\u540e\u53c8\u7ecf\u8fc7\u591a\u6b21\u529f\u80fd\u5f3a\u5316\uff0c\u76ee\u524d\u5df2\u5177\u5907\u975e\u5e38\u6210\u719f\u4e14\u5b8c\u5584\u7684\u529f\u80fd\u3002\u652f\u6301\u5c06 API \u8bf7\u6c42\u65e5\u5fd7\uff0c\u751a\u81f3\u8bf7\u6c42\u4f53\u548c\u54cd\u5e94\u4f53\u4ee5 JSON \u683c\u5f0f\u63a8\u9001\u81f3 Kafka \u96c6\u7fa4\u4e2d\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache Kafka \u662f\u7531 Apache \u7ba1\u7406\u7684\u5f00\u6e90\u6d41\u5904\u7406\u5e73\u53f0\uff0c\u7531 Scala \u548c Java \u7f16\u5199\uff0c\u4e3a\u5904\u7406\u5b9e\u65f6\u6570\u636e\u63d0\u4f9b\u4e86\u7edf\u4e00\u3001\u9ad8\u541e\u5410\u3001\u4f4e\u5ef6\u8fdf\u7684\u529f\u80fd\u7279\u6027\u3002\\n\\n\u5176\u6301\u4e45\u5316\u5c42\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u201c\u6309\u7167\u5206\u5e03\u5f0f\u4e8b\u52a1\u65e5\u5fd7\u67b6\u6784\u7684\u5927\u89c4\u6a21\u53d1\u5e03/\u8ba2\u9605\u6d88\u606f\u961f\u5217\u201d\uff0c\u8fd9\u4f7f\u5b83\u4f5c\u4e3a\u4f01\u4e1a\u7ea7\u57fa\u7840\u8bbe\u65bd\u6765\u5904\u7406\u6d41\u5f0f\u6570\u636e\u975e\u5e38\u6709\u4ef7\u503c\u3002\u76ee\u524d\u5df2\u88ab\u6570\u5343\u5bb6\u516c\u53f8\u7528\u4e8e\u9ad8\u6027\u80fd\u6570\u636e\u7ba1\u9053\u3001\u6d41\u5206\u6790\u3001\u6570\u636e\u96c6\u6210\u548c\u4efb\u52a1\u5173\u952e\u578b\u5e94\u7528\u7a0b\u5e8f\u7b49\u9886\u57df\u3002\\n\\n## \u5b9e\u73b0\u65b9\u5f0f\uff1akafka-logger\\n\\nApache APISIX \u65e9\u5728 1.2 \u7248\u672c\u5f00\u59cb\u5c31\u5df2\u7ecf\u63d0\u4f9b\u4e86 `kafka-logger` \u63d2\u4ef6\u7684\u652f\u6301\uff0c\u5176\u540e\u53c8\u7ecf\u8fc7\u591a\u6b21\u529f\u80fd\u5f3a\u5316\uff0c\u76ee\u524d\u5df2\u5177\u5907\u975e\u5e38\u6210\u719f\u4e14\u5b8c\u5584\u7684\u529f\u80fd\u3002\u652f\u6301\u5c06 API \u8bf7\u6c42\u65e5\u5fd7\uff0c\u751a\u81f3\u8bf7\u6c42\u4f53\u548c\u54cd\u5e94\u4f53\u4ee5 JSON \u683c\u5f0f\u63a8\u9001\u81f3 Kafka \u96c6\u7fa4\u4e2d\u3002\\n\\n\u4f7f\u7528 `kafka-logger` \u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u53d1\u9001\u591a\u79cd\u6570\u636e\u5e76\u81ea\u5b9a\u4e49\u53d1\u9001\u7684\u65e5\u5fd7\u683c\u5f0f\uff0c\u540c\u65f6\u8fd8\u652f\u6301\u4ee5\u6279\u5904\u7406\u7684\u65b9\u5f0f\u6253\u5305\u53d1\u9001\u65e5\u5fd7\u6216\u8fdb\u884c\u81ea\u52a8\u91cd\u8bd5\u7b49\u529f\u80fd\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u6b65\u9aa41\uff1a\u542f\u52a8 Kafka \u96c6\u7fa4\\n\\n\u672c\u6587\u793a\u4f8b\u53ea\u6f14\u793a\u4e86\u4e00\u79cd\u542f\u52a8\u65b9\u5f0f\uff0c\u5176\u4ed6\u542f\u52a8\u65b9\u5f0f\u7ec6\u8282\u53ef\u53c2\u8003 [Kafka \u5b98\u65b9\u6587\u6863](https://kafka.apache.org/documentation/#quickstart)\u3002\\n\\n```yaml\\n# \u4f7f\u7528 docker-compose \u542f\u52a8\u4e00\u4e2a\u5177\u6709 1\u4e2a zookeeper \u8282\u70b9\u30013\u4e2a kafka \u8282\u70b9\u7684\u96c6\u7fa4\\n# \u540c\u65f6\u8fd8\u542f\u52a8\u4e00\u4e2a EFAK \u7528\u4e8e\u6570\u636e\u76d1\u63a7\u3002\\nversion: \'3\'\\n\\nservices:\\n  zookeeper:\\n    image: confluentinc/cp-zookeeper:6.2.1\\n    hostname: zookeeper\\n    ports:\\n      - \\"2181:2181\\"\\n    environment:\\n      ZOOKEEPER_CLIENT_PORT: 2181\\n      ZOOKEEPER_SERVER_ID: 1\\n      ZOOKEEPER_SERVERS: zookeeper:2888:3888\\n\\n  kafka1:\\n    image: confluentinc/cp-kafka:6.2.1\\n    hostname: kafka1\\n    ports:\\n      - \\"9092:9092\\"\\n    environment:\\n      KAFKA_ADVERTISED_LISTENERS: LISTENER_DOCKER_INTERNAL://kafka1:19092,LISTENER_DOCKER_EXTERNAL://${DOCKER_HOST_IP:-127.0.0.1}:9092\\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: LISTENER_DOCKER_INTERNAL:PLAINTEXT,LISTENER_DOCKER_EXTERNAL:PLAINTEXT\\n      KAFKA_INTER_BROKER_LISTENER_NAME: LISTENER_DOCKER_INTERNAL\\n      KAFKA_ZOOKEEPER_CONNECT: \\"zookeeper:2181\\"\\n      KAFKA_BROKER_ID: 1\\n      KAFKA_LOG4J_LOGGERS: \\"kafka.controller=INFO,kafka.producer.async.DefaultEventHandler=INFO,state.change.logger=INFO\\"\\n    depends_on:\\n      - zookeeper\\n\\n  kafka2:\\n    image: confluentinc/cp-kafka:6.2.1\\n    hostname: kafka2\\n    ports:\\n      - \\"9093:9093\\"\\n    environment:\\n      KAFKA_ADVERTISED_LISTENERS: LISTENER_DOCKER_INTERNAL://kafka2:19093,LISTENER_DOCKER_EXTERNAL://${DOCKER_HOST_IP:-127.0.0.1}:9093\\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: LISTENER_DOCKER_INTERNAL:PLAINTEXT,LISTENER_DOCKER_EXTERNAL:PLAINTEXT\\n      KAFKA_INTER_BROKER_LISTENER_NAME: LISTENER_DOCKER_INTERNAL\\n      KAFKA_ZOOKEEPER_CONNECT: \\"zookeeper:2181\\"\\n      KAFKA_BROKER_ID: 2\\n      KAFKA_LOG4J_LOGGERS: \\"kafka.controller=INFO,kafka.producer.async.DefaultEventHandler=INFO,state.change.logger=INFO\\"\\n    depends_on:\\n      - zookeeper\\n\\n\\n  kafka3:\\n    image: confluentinc/cp-kafka:6.2.1\\n    hostname: kafka3\\n    ports:\\n      - \\"9094:9094\\"\\n    environment:\\n      KAFKA_ADVERTISED_LISTENERS: LISTENER_DOCKER_INTERNAL://kafka3:19094,LISTENER_DOCKER_EXTERNAL://${DOCKER_HOST_IP:-127.0.0.1}:9094\\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: LISTENER_DOCKER_INTERNAL:PLAINTEXT,LISTENER_DOCKER_EXTERNAL:PLAINTEXT\\n      KAFKA_INTER_BROKER_LISTENER_NAME: LISTENER_DOCKER_INTERNAL\\n      KAFKA_ZOOKEEPER_CONNECT: \\"zookeeper:2181\\"\\n      KAFKA_BROKER_ID: 3\\n      KAFKA_LOG4J_LOGGERS: \\"kafka.controller=INFO,kafka.producer.async.DefaultEventHandler=INFO,state.change.logger=INFO\\"\\n    depends_on:\\n      - zookeeper\\n\\n  efak:\\n    image: nickzurich/kafka-eagle:2.0.9\\n    hostname: efak\\n    ports:\\n      - \\"8048:8048\\"\\n    depends_on:\\n      - kafka1\\n      - kafka2\\n      - kafka3\\n```\\n\\n### \u6b65\u9aa42\uff1a\u521b\u5efa Topic\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u521b\u5efa `test Topic` \u7528\u4e8e\u6536\u96c6\u65e5\u5fd7\u3002\\n\\n![test Topic](https://static.apiseven.com/202108/1642390784736-562187ed-ade9-4a2f-96e1-c79556f9dd7d.png)\\n\\n### \u6b65\u9aa43\uff1a\u521b\u5efa\u8def\u7531\u5e76\u5f00\u542f\u63d2\u4ef6\\n\\n\u901a\u8fc7\u4e0b\u65b9\u547d\u4ee4\u53ef\u8fdb\u884c\u8def\u7531\u521b\u5efa\u4e0e `kafka-logger` \u63d2\u4ef6\u7684\u5f00\u542f\u3002\\n\\n```shell\\ncurl -XPUT \'http://127.0.0.1:9080/apisix/admin/routes/r1\' \\\\\\n--header \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n--header \'Content-Type: application/json\' \\\\\\n--data-raw \'{\\n    \\"uri\\": \\"/*\\",\\n    \\"plugins\\": {\\n        \\"kafka-logger\\": {\\n            \\"batch_max_size\\": 1,\\n            \\"broker_list\\": {\\n                \\"127.0.0.1\\": 9092\\n            },\\n            \\"disable\\": false,\\n            \\"kafka_topic\\": \\"test\\",\\n            \\"producer_type\\": \\"sync\\"\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"httpbin.org:80\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    }\\n}\'\\n```\\n\\n\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u914d\u7f6e\u4e86 `kafka broker` \u5730\u5740\u3001\u76ee\u6807 Topic\u3001\u540c\u6b65\u7684\u751f\u4ea7\u6a21\u5f0f\u548c\u6bcf\u4e00\u6279\u6b21\u5305\u542b\u7684\u6700\u5927\u65e5\u5fd7\u6570\u91cf\u3002\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u5148\u5c06 `batch_max_size` \u8bbe\u7f6e\u4e3a 1\uff0c\u5373\u6bcf\u4ea7\u751f\u4e00\u6761\u65e5\u5fd7\u5c31\u5411 Kafka \u5199\u5165\u4e00\u6761\u6d88\u606f\u3002\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u8bbe\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5c06 `/*` \u8def\u5f84\u4e0b\u7684 API \u8bf7\u6c42\u65e5\u5fd7\u53d1\u9001\u81f3 Kafka \u7684\u529f\u80fd\u3002\\n\\n### \u6b65\u9aa44\uff1a\u53d1\u9001\u8bf7\u6c42\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u901a\u8fc7 API \u53d1\u9001\u4e00\u4e9b\u8bf7\u6c42\uff0c\u5e76\u8bb0\u5f55\u4e0b\u8bf7\u6c42\u6b21\u6570\u3002\\n\\n```shell\\n# \u5411 API \u53d1\u9001 10 \u6b21\u8bf7\u6c42\\ncurl http://127.0.0.1:9080/get\\n```\\n\\n\u901a\u8fc7\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u6709\u4e00\u4e9b\u65e5\u5fd7\u6d88\u606f\u5df2\u7ecf\u88ab\u5199\u5165\u5230\u6211\u4eec\u521b\u5efa\u7684 `test topic`2 \u4e2d\u3002\u70b9\u51fb\u67e5\u770b\u65e5\u5fd7\u5185\u5bb9\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e0a\u8ff0\u8fdb\u884c\u7684 API \u8bf7\u6c42\u65e5\u5fd7\u5df2\u7ecf\u88ab\u5199\u5165\u4e86\u3002\\n\\n![\u53d1\u9001\u8bf7\u6c42-1](https://static.apiseven.com/202108/1642390828394-721eccfa-ab02-4f8f-a0d8-8039e0eaabc1.png)\\n\\n![\u53d1\u9001\u8bf7\u6c42-2](https://static.apiseven.com/202108/1642390874028-89683dfb-ab16-48cd-92de-496cc60df3b5.png)\\n\\n#### \u81ea\u5b9a\u4e49\u65e5\u5fd7\u7ed3\u6784\\n\\n\u5f53\u7136\uff0c\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 `kafka-logger` \u63d2\u4ef6\u63d0\u4f9b\u7684\u5143\u6570\u636e\u914d\u7f6e\uff0c\u6765\u8bbe\u7f6e\u53d1\u9001\u81f3 Kafka \u7684\u65e5\u5fd7\u6570\u636e\u7ed3\u6784\u3002\u901a\u8fc7\u8bbe\u7f6e `log_format` \u6570\u636e\uff0c\u53ef\u4ee5\u63a7\u5236\u53d1\u9001\u7684\u6570\u636e\u7c7b\u578b\u3002\\n\\n\u6bd4\u5982\u4ee5\u4e0b\u6570\u636e\u4e2d\u7684 `$host`\u3001`$time_iso8601` \u7b49\uff0c\u90fd\u662f\u6765\u81ea\u4e8e Nginx \u63d0\u4f9b\u7684\u5185\u7f6e\u53d8\u91cf\uff1b\u4e5f\u652f\u6301\u5982 `$route_id` \u548c `$service_id` \u7b49 Apache APISIX \u63d0\u4f9b\u7684\u53d8\u91cf\u914d\u7f6e\u3002\\n\\n```shell\\ncurl -XPUT \'http://127.0.0.1:9080/apisix/admin/plugin_metadata/kafka-logger\' \\\\\\n--header \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n--header \'Content-Type: application/json\' \\\\\\n--data-raw \'{\\n    \\"log_format\\": {\\n        \\"host\\": \\"$host\\",\\n        \\"@timestamp\\": \\"$time_iso8601\\",\\n        \\"client_ip\\": \\"$remote_addr\\",\\n        \\"route_id\\": \\"$route_id\\"\\n    }\\n}\'\\n```\\n\\n\u901a\u8fc7\u53d1\u9001\u8bf7\u6c42\u8fdb\u884c\u7b80\u5355\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u770b\u5230\u4e0a\u8ff0\u65e5\u5fd7\u7ed3\u6784\u8bbe\u7f6e\u5df2\u751f\u6548\u3002\u76ee\u524d Apache APISIX \u63d0\u4f9b\u591a\u79cd\u65e5\u5fd7\u683c\u5f0f\u6a21\u677f\uff0c\u5728\u914d\u7f6e\u4e0a\u5177\u6709\u6781\u5927\u7684\u7075\u6d3b\u6027\uff0c\u66f4\u591a\u65e5\u5fd7\u683c\u5f0f\u7ec6\u8282\u53ef\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/plugins/kafka-logger#metadata)\u3002\\n\\n![\u81ea\u5b9a\u4e49\u65e5\u5fd7\u7ed3\u6784](https://static.apiseven.com/202108/1642390899127-d1eb560a-499e-4a9f-9227-4063ba711e2d.png)\\n\\n### \u5173\u95ed\u63d2\u4ef6\\n\\n\u5982\u4f7f\u7528\u5b8c\u6bd5\uff0c\u53ea\u9700\u79fb\u9664\u8def\u7531\u914d\u7f6e\u4e2d `kafka-logger` \u63d2\u4ef6\u76f8\u5173\u914d\u7f6e\u5e76\u4fdd\u5b58\uff0c\u5373\u53ef\u5173\u95ed\u8def\u7531\u4e0a\u7684\u63d2\u4ef6\u3002\u5f97\u76ca\u4e8e Apache APISIX \u7684\u52a8\u6001\u5316\u4f18\u52bf\uff0c\u5f00\u542f\u5173\u95ed\u63d2\u4ef6\u7684\u8fc7\u7a0b\u90fd\u4e0d\u9700\u8981\u91cd\u542f Apache APISIX\uff0c\u5341\u5206\u65b9\u4fbf\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {},\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5173\u4e8e kafka-logger \u63d2\u4ef6\u7684\u529f\u80fd\u524d\u77bb\u4e0e\u4f7f\u7528\u6b65\u9aa4\uff0c\u66f4\u591a\u5173\u4e8e kafka-logger \u63d2\u4ef6\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u5217\u8868\uff0c\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863\u3002\\n\\n\u4e5f\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"\u8ba9\u4f60\u5728 Apache APISIX \u4e2d\u4ee3\u7406 Dubbo \u670d\u52a1\u66f4\u4fbf\u6377","metadata":{"permalink":"/zh/blog/2022/01/13/how-to-proxy-dubbo-in-apache-apisix","source":"@site/blog/2022/01/13/how-to-proxy-dubbo-in-apache-apisix.md","title":"\u8ba9\u4f60\u5728 Apache APISIX \u4e2d\u4ee3\u7406 Dubbo \u670d\u52a1\u66f4\u4fbf\u6377","description":"\u672c\u6587\u4e3a\u4ecb\u7ecd\u4e86\u5982\u4f55\u501f\u52a9 Apache APISIX \u5b9e\u73b0 Dubbo Service \u7684\u4ee3\u7406\uff0c\u901a\u8fc7\u5f15\u5165 dubbo-proxy \u63d2\u4ef6\u4fbf\u53ef\u4e3a Dubbo \u6846\u67b6\u7684\u540e\u7aef\u7cfb\u7edf\u6784\u5efa\u66f4\u7b80\u5355\u66f4\u9ad8\u6548\u7684\u6d41\u91cf\u94fe\u8def\u3002","date":"2022-01-13T00:00:00.000Z","formattedDate":"2022\u5e741\u670813\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":7.925,"truncated":true,"authors":[{"name":"\u94b1\u52c7","title":"Author","url":"https://github.com/nic-6443","image_url":"https://avatars.githubusercontent.com/u/22141303?v=4","imageURL":"https://avatars.githubusercontent.com/u/22141303?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"APISIX \u96c6\u6210 Kafka \u5b9e\u73b0\u9ad8\u6548\u5b9e\u65f6\u65e5\u5fd7\u76d1\u63a7","permalink":"/zh/blog/2022/01/17/apisix-kafka-integration"},"nextItem":{"title":"\u76f4\u64ad\u9884\u544a | \u4ece\u7f51\u5173\u5230\u6570\u636e\uff0c\u5206\u5e03\u5f0f\u5168\u94fe\u8def\u5728\u7ebf\u5e94\u7528\u5b9e\u8df5","permalink":"/zh/blog/2022/01/11/apisix-with-shardingsphere-meetup"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u501f\u52a9 Apache APISIX \u5b9e\u73b0 Dubbo Service \u7684\u4ee3\u7406\uff0c\u901a\u8fc7\u5f15\u5165 dubbo-proxy \u63d2\u4ef6\u4fbf\u53ef\u4e3a Dubbo \u6846\u67b6\u7684\u540e\u7aef\u7cfb\u7edf\u6784\u5efa\u66f4\u7b80\u5355\u66f4\u9ad8\u6548\u7684\u6d41\u91cf\u94fe\u8def\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\\n\\n[Apache Dubbo](https://dubbo.apache.org/zh/) \u662f\u7531\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u5e76\u6350\u8d60\u7ed9 Apache \u7684\u5fae\u670d\u52a1\u5f00\u53d1\u6846\u67b6\uff0c\u5b83\u63d0\u4f9b\u4e86 RPC \u901a\u4fe1\u4e0e\u5fae\u670d\u52a1\u6cbb\u7406\u4e24\u5927\u5173\u952e\u80fd\u529b\u3002\u4e0d\u4ec5\u7ecf\u8fc7\u4e86\u963f\u91cc\u7535\u5546\u573a\u666f\u4e2d\u6d77\u91cf\u6d41\u91cf\u7684\u9a8c\u8bc1\uff0c\u4e5f\u5728\u56fd\u5185\u7684\u6280\u672f\u516c\u53f8\u4e2d\u88ab\u5e7f\u6cdb\u843d\u5730\u3002\\n\\n\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\uff0cApache Dubbo \u4e00\u822c\u4f1a\u4f5c\u4e3a\u540e\u7aef\u7cfb\u7edf\u95f4 RPC \u8c03\u7528\u7684\u5b9e\u73b0\u6846\u67b6\uff0c\u5f53\u9700\u8981\u63d0\u4f9b HTTP \u63a5\u53e3\u7ed9\u5230\u524d\u7aef\u65f6\uff0c\u4f1a\u901a\u8fc7\u4e00\u4e2a\u300c\u80f6\u6c34\u5c42\u300d\u5c06 Dubbo Service \u5305\u88c5\u6210 HTTP \u63a5\u53e3\uff0c\u518d\u4ea4\u4ed8\u5230\u524d\u7aef\u7cfb\u7edf\u3002\\n\\n[Apache APISIX](https://apisix.apache.org/) \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u662f\u5f53\u524d\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u3002\u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0cApache APISIX \u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\n\u5f97\u76ca\u4e8e Apache Dubbo \u7684\u5e94\u7528\u573a\u666f\u4f18\u52bf\uff0cApache APISIX \u57fa\u4e8e\u5f00\u6e90\u9879\u76ee tengine/mod_dubbo \u6a21\u5757\u4e3a Apache Dubbo \u670d\u52a1\u914d\u5907\u4e86HTTP \u7f51\u5173\u80fd\u529b\u3002\u901a\u8fc7 dubbo-proxy \u63d2\u4ef6\uff0c\u53ef\u4ee5\u8f7b\u677e\u5730\u5c06 Dubbo Service \u53d1\u5e03\u4e3a HTTP \u670d\u52a1\u3002\\n\\n![\u67b6\u6784\u56fe](https://static.apiseven.com/202108/1641873664933-65d02cb3-ec3e-4b95-945d-91cfb8106751.png)\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u5165\u95e8\u7bc7\uff1a\u5b89\u88c5\u4f7f\u7528\\n\\n>\u8fd9\u91cc\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 Apache APISIX 2.11 \u7248\u672c\u955c\u50cf\u8fdb\u884c\u5b89\u88c5\u3002\u8be5\u7248\u672c\u7684 APISIX-Base \u4e2d\u5df2\u9ed8\u8ba4\u7f16\u8bd1\u4e86 Dubbo \u6a21\u5757\uff0c\u53ef\u76f4\u63a5\u4f7f\u7528 `dubbo-proxy` \u63d2\u4ef6\u3002\\n\\n\u5728\u63a5\u4e0b\u6765\u7684\u64cd\u4f5c\u4e2d\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 [`dubbo-samples`](https://github.com/apache/dubbo-samples) \u9879\u76ee\u8fdb\u884c\u90e8\u5206\u5c55\u793a\u3002\u8be5\u9879\u76ee\u662f\u4e00\u4e9b\u4f7f\u7528 Apache Dubbo \u5b9e\u73b0\u7684 Demo \u5e94\u7528\uff0c\u672c\u6587\u4e2d\u6211\u4eec\u91c7\u7528\u5176\u4e2d\u7684\u4e00\u4e2a\u5b50\u6a21\u5757\u4f5c\u4e3a Dubbo Provider\u3002\\n\\n\u5728\u8fdb\u5165\u6b63\u5f0f\u64cd\u4f5c\u524d\uff0c\u6211\u4eec\u5148\u7b80\u5355\u770b\u4e0b Dubbo \u63a5\u53e3\u7684\u5b9a\u4e49\u3001\u914d\u7f6e\u4ee5\u53ca\u76f8\u5173\u5b9e\u73b0\u3002\\n\\n#### \u63a5\u53e3\u5b9e\u73b0\u4e00\u89c8\\n\\n```java\\npublic interface DemoService {\\n\\n    /**\\n     * standard samples dubbo infterace demo\\n     * @param context pass http infos\\n     * @return Map<String, Object></> pass to response http\\n     **/\\n    Map<String, Object> apisixDubbo(Map<String, Object> httpRequestContext);\\n}\\n```\\n\\n\u5982\u4e0a\u6240\u793a\uff0cDubbo \u63a5\u53e3\u7684\u5b9a\u4e49\u662f\u56fa\u5b9a\u7684\u3002\u5373\u65b9\u6cd5\u53c2\u6570\u4e2d `Map` \u8868\u793a APISIX \u4f20\u9012\u7ed9 Dubbo Provider \u5173\u4e8e HTTP request \u7684\u4e00\u4e9b\u4fe1\u606f\uff08\u5982\uff1aheader\u3001body...)\u3002\u800c\u65b9\u6cd5\u8fd4\u56de\u503c\u7684 `Map` \u8868\u793a Dubbo Provider \u4f20\u9012\u7ed9 APISIX \u8981\u5982\u4f55\u8fd4\u56de HTTP response \u7684\u4e00\u4e9b\u4fe1\u606f\u3002\\n\\n\u63a5\u53e3\u4fe1\u606f\u4e4b\u540e\u53ef\u901a\u8fc7 XML \u914d\u7f6e\u65b9\u5f0f\u53d1\u5e03 DemoService\u3002\\n\\n```xml\\n\x3c!-- service implementation, as same as regular local bean --\x3e\\n<bean id=\\"demoService\\" class=\\"org.apache.dubbo.samples.provider.DemoServiceImpl\\"/>\\n\\n\x3c!-- declare the service interface to be exported --\x3e\\n<dubbo:service interface=\\"org.apache.dubbo.samples.apisix.DemoService\\" ref=\\"demoService\\"/>\\n```\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0cConsumer \u53ef\u901a\u8fc7 `org.apache.dubbo.samples.apisix.DemoService` \u8bbf\u95ee\u5176\u4e2d\u7684`apisixDubbo` \u65b9\u6cd5\u3002\u5177\u4f53\u63a5\u53e3\u5b9e\u73b0\u5982\u4e0b\uff1a\\n\\n```java\\npublic class DemoServiceImpl implements DemoService {\\n    @Override\\n    public Map<String, Object> apisixDubbo(Map<String, Object> httpRequestContext) {\\n        for (Map.Entry<String, Object> entry : httpRequestContext.entrySet()) {\\n            System.out.println(\\"Key = \\" + entry.getKey() + \\", Value = \\" + entry.getValue());\\n        }\\n\\n        Map<String, Object> ret = new HashMap<String, Object>();\\n        ret.put(\\"body\\", \\"dubbo success\\\\n\\"); // http response body\\n        ret.put(\\"status\\", \\"200\\"); // http response status\\n        ret.put(\\"test\\", \\"123\\"); // http response header\\n\\n        return ret;\\n    }\\n}\\n```\\n\\n\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c`DemoServiceImpl` \u4f1a\u6253\u5370\u63a5\u6536\u5230\u7684 `httpRequestContext`\uff0c\u5e76\u901a\u8fc7\u8fd4\u56de\u5305\u542b\u6709\u6307\u5b9a Key \u7684 Map \u5bf9\u8c61\u53bb\u63cf\u8ff0\u8be5 Dubbo \u8bf7\u6c42\u7684 HTTP \u54cd\u5e94\u3002\\n\\n#### \u64cd\u4f5c\u6b65\u9aa4\\n\\n1. \u542f\u52a8 [`dubbo-samples`](https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-tengine#install-dubbo)\u3002\\n2. \u5728 `config.yaml` \u6587\u4ef6\u4e2d\u8fdb\u884c `dubbo-proxy` \u63d2\u4ef6\u542f\u7528\u3002\\n\\n```yaml\\n# Add this in config.yaml\\nplugins:\\n  - ... # plugin you need\\n  - dubbo-proxy\\n```\\n\\n3. \u521b\u5efa\u6307\u5411 Dubbo Provider \u7684 Upstream\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/upstreams/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"nodes\\": {\\n        \\"127.0.0.1:20880\\": 1\\n    },\\n    \\"type\\": \\"roundrobin\\"\\n}\'\\n```\\n\\n4. \u4e3a DemoService \u66b4\u9732\u4e00\u4e2a HTTP \u8def\u7531\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9180/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"host\\": \\"example.org\\"\\n    \\"uris\\": [\\n        \\"/demo\\"\\n    ],\\n    \\"plugins\\": {\\n        \\"dubbo-proxy\\": {\\n            \\"service_name\\": \\"org.apache.dubbo.samples.apisix.DemoService\\",\\n            \\"service_version\\": \\"0.0.0\\",\\n            \\"method\\": \\"apisixDubbo\\"\\n        }\\n    },\\n    \\"upstream_id\\": 1\\n}\'\\n```\\n\\n5. \u4f7f\u7528 curl \u547d\u4ee4\u8bf7\u6c42 Apache APISIX\uff0c\u5e76\u67e5\u770b\u8fd4\u56de\u7ed3\u679c\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/demo  -H \\"Host: example.org\\"  -X POST --data \'{\\"name\\": \\"hello\\"}\'\\n\\n< HTTP/1.1 200 OK\\n< Date: Sun, 26 Dec 2021 11:33:27 GMT\\n< Content-Type: text/plain; charset=utf-8\\n< Content-Length: 14\\n< Connection: keep-alive\\n< test: 123\\n< Server: APISIX/2.11.0\\n<\\ndubbo success\\n```\\n\\n:::note \u8bf4\u660e\\n\u4e0a\u8ff0\u4ee3\u7801\u8fd4\u56de\u4e2d\u5305\u542b\u4e86 `test: 123` Header\uff0c\u4ee5\u53ca `dubbo success` \u5b57\u7b26\u4e32\u4f5c\u4e3a Body \u4f53\u3002\u8fd9\u4e0e\u6211\u4eec\u5728 `DemoServiceImpl` \u7f16\u7801\u7684\u9884\u671f\u6548\u679c\u4e00\u81f4\u3002\\n:::\\n\\n6. \u67e5\u770b Dubbo Provider \u7684\u65e5\u5fd7\u3002\\n\\n```\\nKey = content-length, Value = 17\\nKey = host, Value = example.org\\nKey = content-type, Value = application/x-www-form-urlencoded\\nKey = body, Value = [B@70754265\\nKey = accept, Value = */*\\nKey = user-agent, Value = curl/7.80.0\\n```\\n\\n:::note \u8bf4\u660e\\n\u901a\u8fc7 `httpRequestContext` \u53ef\u4ee5\u62ff\u5230 HTTP \u8bf7\u6c42\u7684 Header \u548c Body\u3002\u5176\u4e2d Header \u4f1a\u4f5c\u4e3a Map \u5143\u7d20\uff0c\u800c Body \u4e2d Key \u503c\u662f\u56fa\u5b9a\u7684\u5b57\u7b26\u4e32\\"body\\"\uff0cValue \u5219\u4ee3\u8868 Byte \u6570\u7ec4\u3002\\n:::\\n\\n### \u8fdb\u9636\u7bc7\uff1a\u590d\u6742\u573a\u666f\u793a\u4f8b\\n\\n\u5728\u4e0a\u8ff0\u7684\u7b80\u5355\u7528\u4f8b\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u6211\u4eec\u786e\u5b9e\u901a\u8fc7 Apache APISIX \u5c06 Dubbo Service \u53d1\u5e03\u4e3a\u4e00\u4e2a HTTP \u670d\u52a1\uff0c\u4f46\u662f\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u7684\u9650\u5236\u4e5f\u975e\u5e38\u660e\u663e\u3002\u6bd4\u5982\uff1a\u63a5\u53e3\u7684\u53c2\u6570\u548c\u8fd4\u56de\u503c\u90fd\u5fc5\u987b\u8981\u662f `Map<String, Object>`\u3002\\n\\n\u90a3\u4e48\uff0c\u5982\u679c\u9879\u76ee\u4e2d\u51fa\u73b0\u5df2\u7ecf\u5b9a\u4e49\u597d\u3001\u4f46\u53c8\u4e0d\u7b26\u5408\u4e0a\u8ff0\u9650\u5236\u7684\u63a5\u53e3\uff0c\u8be5\u5982\u4f55\u901a\u8fc7 Apache APISIX \u6765\u66b4\u9732 HTTP \u670d\u52a1\u5462\uff1f\\n\\n#### \u64cd\u4f5c\u6b65\u9aa4\\n\\n\u9488\u5bf9\u4e0a\u8ff0\u573a\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 HTTP Request Body \u63cf\u8ff0\u8981\u8c03\u7528\u7684 Service \u548c Method \u4ee5\u53ca\u5bf9\u5e94\u53c2\u6570\uff0c\u518d\u5229\u7528 Java \u7684\u53cd\u5c04\u673a\u5236\u5b9e\u73b0\u76ee\u6807\u65b9\u6cd5\u7684\u8c03\u7528\u3002\u6700\u540e\u5c06\u8fd4\u56de\u503c\u5e8f\u5217\u5316\u4e3a JSON\uff0c\u5e76\u5199\u5165\u5230 HTTP Response Body \u4e2d\u3002\\n\\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06 Apache APISIX \u7684 \u300cHTTP to Dubbo\u300d \u80fd\u529b\u8fdb\u4e00\u6b65\u52a0\u5f3a\uff0c\u5e76\u5e94\u7528\u5230\u6240\u6709\u5df2\u5b58\u5728\u7684 Dubbo Service \u4e2d\u3002\u5177\u4f53\u64cd\u4f5c\u53ef\u53c2\u8003\u4e0b\u65b9\uff1a\\n\\n1. \u4e3a\u5df2\u6709\u9879\u76ee\u589e\u52a0\u4e00\u4e2a Dubbo Service \u7528\u6765\u7edf\u4e00\u5904\u7406 HTTP to Dubbo \u7684\u8f6c\u5316\u3002\\n\\n```java\\npublic class DubboInvocationParameter {\\n    private String type;\\n    private String value;\\n}\\n\\npublic class DubboInvocation {\\n    private String service;\\n    private String method;\\n    private DubboInvocationParameter[] parameters;\\n}\\n\\npublic interface HTTP2DubboService {\\n    Map<String, Object> invoke(Map<String, Object> context)  throws Exception;\\n}\\n\\n\\n@Component\\npublic class HTTP2DubboServiceImpl implements HTTP2DubboService {\\n\\n    @Autowired\\n    private ApplicationContext appContext;\\n\\n    @Override\\n    public Map<String, Object> invoke(Map<String, Object> context) throws Exception {\\n        DubboInvocation invocation = JSONObject.parseObject((byte[]) context.get(\\"body\\"), DubboInvocation.class);\\n        Object[] args = new Object[invocation.getParameters().size()];\\n        for (int i = 0; i < args.length; i++) {\\n            DubboInvocationParameter parameter = invocation.getParameters().get(i);\\n            args[i] = JSONObject.parseObject(parameter.getValue(), Class.forName(parameter.getType()));\\n        }\\n\\n        Object svc = appContext.getBean(Class.forName(invocation.getService()));\\n        Object result = svc.getClass().getMethod(invocation.getMethod()).invoke(args);\\n        Map<String, Object> httpResponse = new HashMap<>();\\n        httpResponse.put(\\"status\\", 200);\\n        httpResponse.put(\\"body\\", JSONObject.toJSONString(result));\\n        return httpResponse;\\n    }\\n\\n}\\n```\\n\\n2. \u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8bf7\u6c42\u6765\u53d1\u8d77\u76f8\u5173\u8c03\u7528\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/demo  -H \\"Host: example.org\\"  -X POST --data \'\\n{\\n    \\"service\\": \\"org.apache.dubbo.samples.apisix.DemoService\\",\\n    \\"method\\": \\"createUser\\",\\n    \\"parameters\\": [\\n        {\\n            \\"type\\": \\"org.apache.dubbo.samples.apisix.User\\",\\n            \\"value\\": \\"{\'name\': \'hello\'}\\"\\n        }\\n    ]\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5982\u4f55\u501f\u52a9 Apache APISIX \u5b9e\u73b0 Dubbo Service \u7684\u4ee3\u7406\uff0c\u901a\u8fc7\u5f15\u5165 `dubbo-proxy` \u63d2\u4ef6\u4fbf\u53ef\u4e3a Dubbo \u6846\u67b6\u7684\u540e\u7aef\u7cfb\u7edf\u6784\u5efa\u66f4\u7b80\u5355\u66f4\u9ad8\u6548\u7684\u6d41\u91cf\u94fe\u8def\u3002\\n\\n\u5e0c\u671b\u901a\u8fc7\u4e0a\u8ff0\u64cd\u4f5c\u6b65\u9aa4\u548c\u7528\u4f8b\u573a\u666f\u5206\u4eab\uff0c\u80fd\u4e3a\u5927\u5bb6\u5728\u76f8\u5173\u573a\u666f\u7684\u4f7f\u7528\u63d0\u4f9b\u501f\u9274\u601d\u8def\u3002\u66f4\u591a\u5173\u4e8e `dubbo-proxy` \u63d2\u4ef6\u7684\u4ecb\u7ecd\u4e0e\u4f7f\u7528\u53ef\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/plugins/dubbo-proxy/)\u3002"},{"id":"\u76f4\u64ad\u9884\u544a | \u4ece\u7f51\u5173\u5230\u6570\u636e\uff0c\u5206\u5e03\u5f0f\u5168\u94fe\u8def\u5728\u7ebf\u5e94\u7528\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2022/01/11/apisix-with-shardingsphere-meetup","source":"@site/blog/2022/01/11/apisix-with-shardingsphere-meetup.md","title":"\u76f4\u64ad\u9884\u544a | \u4ece\u7f51\u5173\u5230\u6570\u636e\uff0c\u5206\u5e03\u5f0f\u5168\u94fe\u8def\u5728\u7ebf\u5e94\u7528\u5b9e\u8df5","description":"1 \u6708 15 \u65e5\uff0cApache APISIX \u793e\u533a\u5c06\u8054\u5408 Apache Shardingshpere \u793e\u533a\u4e3a\u5927\u5bb6\u5e26\u6765\u7ebf\u4e0a\u5206\u4eab\uff0c\u5feb\u6765\u770b\u770b\u6709\u54ea\u4e9b\u7cbe\u5f69\u7684\u8bae\u9898\u5427\u3002","date":"2022-01-11T00:00:00.000Z","formattedDate":"2022\u5e741\u670811\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.425,"truncated":true,"authors":[],"prevItem":{"title":"\u8ba9\u4f60\u5728 Apache APISIX \u4e2d\u4ee3\u7406 Dubbo \u670d\u52a1\u66f4\u4fbf\u6377","permalink":"/zh/blog/2022/01/13/how-to-proxy-dubbo-in-apache-apisix"},"nextItem":{"title":"\u5982\u4f55\u5728 ARM Ubuntu \u4e2d\u6784\u5efa Apache APISIX","permalink":"/zh/blog/2022/01/11/building-apisix-in-ubuntu-for-arm"}},"content":"> 1 \u6708 15 \u65e5\uff0cApache APISIX \u793e\u533a\u5c06\u8054\u5408 Apache Shardingshpere \u793e\u533a\u4e3a\u5927\u5bb6\u5e26\u6765\u7ebf\u4e0a\u5206\u4eab\uff0c\u5feb\u6765\u770b\u770b\u6709\u54ea\u4e9b\u7cbe\u5f69\u7684\u8bae\u9898\u5427\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n![\u6d3b\u52a8\u6d77\u62a5](https://static.apiseven.com/202108/1641870767554-2f443190-e752-48e5-9624-ca8ee0aca1e4.png)\\n\\n## \u5206\u4eab\u8bae\u9898\\n\\n### CyborgFlow \u63ed\u79d8\uff1a\u4e09\u5927 Apache \u9876\u7ea7\u9879\u76ee\u643a\u624b\u642d\u5efa\u5168\u94fe\u8def\u538b\u6d4b\u9879\u76ee\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u5434\u665f\uff0cApache Skywalking \u521b\u59cb\u4eba\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n1. \u4ec0\u4e48\u662f CyborgFlow\uff1f\\n2. \u4e09\u5927\u793e\u533a\u5982\u4f55\u8054\u624b\u6253\u9020\u4e00\u6b3e\u652f\u6301\u5168\u94fe\u8def\u538b\u6d4b\u7684\u5de5\u5177\\n3. \u5982\u4f55\u57fa\u4e8e CyborgFlow \u5b9e\u73b0\u4ee5\u7edf\u4e00\u89c6\u89d2\u3001\u66f4\u4f4e\u6210\u672c\u6765\u5206\u6790\u5168\u94fe\u8def\u4e2d\u6d41\u91cf\u4e0e\u6570\u636e\u60c5\u51b5\\n4. \u5982\u4f55\u4f7f\u7528 CyborgFlow \u66f4\u5feb\u901f\u5730\u5206\u6790\u4ee5\u53ca\u6700\u5927\u5316\u5229\u7528\u3001\u7ba1\u7406\u6570\u636e\u8d44\u4ea7\\n\\n### Apache APISIX Ingress \u52a9\u529b\u6570\u636e\u5e93\u4e0a\u4e91\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u5f20\u664b\u6d9b, API7.ai \u4e91\u539f\u751f\u6280\u672f\u4e13\u5bb6\uff0cApache APISIX Committer\uff0cKubernetes ingress-NGINX Reviewer\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n1. \u6570\u636e\u5e93\u4e0a\u4e91\u7684\u75db\u70b9\\n2. Apache APISIX Ingress \u6570\u636e\u5e93\u4ee3\u7406\u53ef\u89c2\u6d4b\u80fd\u529b\\n3. Apache APISIX Ingress \u52a9\u529b\u6570\u636e\u5e93\u4e0a\u4e91\u5b9e\u8df5\\n\\n### Apache ShardingSphere Shadow DB \u53ca\u5728 CyborgFlow \u4e2d\u7684\u5e94\u7528\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u4faf\u9633\uff0cSphereEx \u4e2d\u95f4\u4ef6\u7814\u53d1\u5de5\u7a0b\u5e08\uff0cApache ShardingSphere Contributor\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n1. Apache ShardingSphere Shadow DB \u7684\u67b6\u6784\u8bbe\u8ba1\\n2. Apache ShardingSphere Shadow DB \u7684\u5e94\u7528\u573a\u666f\\n3. CyborgFlow \u4e2d Shadow DB \u7684\u6570\u636e\u8def\u7531\u80fd\u529b\\n\\n### Apache APISIX \u7684\u6570\u636e\u5e93\u591a\u534f\u8bae\u4ee3\u7406\u548c\u53ef\u89c2\u6d4b\u6027\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u5e05\u8fdb\u8d85\uff0cAPI7.ai \u5de5\u7a0b\u5e08\uff0cApache APISIX PMC Member\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n1. Apache APISIX \u4ecb\u7ecd\u53ca\u67b6\u6784\u8bbe\u8ba1\\n2. Apache APISIX \u53ef\u89c2\u6d4b\u6027\u80fd\u529b\\n3. Apache APISIX \u6570\u636e\u5e93\u591a\u534f\u8bae\u4ee3\u7406\u548cX-RPC\\n4. Apache APISIX \u5168\u6d41\u91cf\u5e94\u7528\u573a\u666f\u53ca\u591a\u8bed\u8a00\u751f\u6001\\n\\n### \u57fa\u4e8e DistSQL \u7684 ShardingSphere \u5206\u5e03\u5f0f\u6570\u636e\u5e93\u670d\u52a1\u7ba1\u7406\u5b9e\u8df5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u5170\u57ce\u7fd4\uff0cSphere-Ex \u5de5\u7a0b\u5e08\uff0cApache ShardingSphere Contributor\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n1. DistSQL \u7b80\u8ff0\\n2. DistSQL \u591a\u4e1a\u52a1\u573a\u666f\u5b9e\u8df5\\n3. DistSQL \u7ba1\u7406\u80fd\u529b\u5b9e\u8df5\\n\\n## \u53c2\u4e0e\u65b9\u5f0f\\n\\n\u626b\u7801\u5173\u6ce8\u4e0b\u65b9\u89c6\u9891\u53f7\uff0c\u9884\u7ea6\u672c\u6b21\u76f4\u64ad\u3002\\n\\n![QR code](https://static.apiseven.com/202108/1639618627132-2ce4f183-4d3f-40ca-ae5f-397a48f650ae.png)\\n\\n1 \u6708 15 \u65e5\u4e0b\u5348\uff0c\u671f\u5f85\u4e0e\u60a8\u5728\u76f4\u64ad\u95f4\u76f8\u9047\uff01"},{"id":"\u5982\u4f55\u5728 ARM Ubuntu \u4e2d\u6784\u5efa Apache APISIX","metadata":{"permalink":"/zh/blog/2022/01/11/building-apisix-in-ubuntu-for-arm","source":"@site/blog/2022/01/11/building-apisix-in-ubuntu-for-arm.md","title":"\u5982\u4f55\u5728 ARM Ubuntu \u4e2d\u6784\u5efa Apache APISIX","description":"\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u60a8\u5c06\u4e86\u89e3\u5982\u4f55\u5728 ARM Ubuntu \u4e2d\u901a\u8fc7\u6e90\u7801\u6784\u5efa Apache APISIX\uff08M1 \u82af\u7247\u73af\u5883\uff09\u3002","date":"2022-01-11T00:00:00.000Z","formattedDate":"2022\u5e741\u670811\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":6.235,"truncated":true,"authors":[{"name":"\u90ed\u5947","title":"Author","url":"https://github.com/guoqqqi","image_url":"https://avatars.githubusercontent.com/u/72343596?v=4","imageURL":"https://avatars.githubusercontent.com/u/72343596?v=4"}],"prevItem":{"title":"\u76f4\u64ad\u9884\u544a | \u4ece\u7f51\u5173\u5230\u6570\u636e\uff0c\u5206\u5e03\u5f0f\u5168\u94fe\u8def\u5728\u7ebf\u5e94\u7528\u5b9e\u8df5","permalink":"/zh/blog/2022/01/11/apisix-with-shardingsphere-meetup"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff0812.16-12.31\uff09","permalink":"/zh/blog/2022/01/05/weekly-report-1231"}},"content":"> \u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u60a8\u5c06\u4e86\u89e3\u5982\u4f55\u5728 ARM Ubuntu \u4e2d\u901a\u8fc7\u6e90\u7801\u6784\u5efa Apache APISIX\uff08M1 \u82af\u7247\u73af\u5883\uff09\u3002ARM Ubuntu \u7cfb\u7edf\u501f\u52a9\u4e86 [https://multipass.run/](https://multipass.run/) \u5b89\u88c5\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u524d\u63d0\u51c6\u5907\\n\\n### \u514b\u9686\u6e90\u7801\\n\\n\u9996\u5148\u6839\u636e [\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/how-to-build/) \u514b\u9686 Apache APISIX \u6e90\u7801\u4ed3\u5e93\u5e76\u8fdb\u5165\u9879\u76ee\u76ee\u5f55\u3002\\n\\n```shell\\ngit clone https://github.com/apache/apisix.git\\ncd apisix\\ngit checkout release/2.11\\n```\\n\\n### \u5b89\u88c5 OpenResty\\n\\n\u9996\u5148\u901a\u8fc7\u811a\u672c\u4e00\u952e\u5b89\u88c5\u9879\u76ee\u6240\u9700\u8981\u7684\u4f9d\u8d56\uff0c\u5728**\u9879\u76ee\u6839\u76ee\u5f55**\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u3002\\n\\n```shell\\nbash utils/install-dependencies.sh\\n```\\n\\n![\u5b89\u88c5\u4f9d\u8d56.png](https://static.apiseven.com/202108/1641911830267-75310d03-1039-4f5a-a8b1-94c01474a086.png)\\n\\n\u901a\u8fc7\u9519\u8bef\u63d0\u793a\u53ef\u77e5\uff0c\u662f\u7531\u4e8e\u672a\u80fd\u6210\u529f\u5b89\u88c5 `OpenResty` \u5bfc\u81f4\u3002\u6839\u672c\u539f\u56e0\u662f\u9ed8\u8ba4\u6ca1\u6709 `ARM 64` \u5e73\u53f0\u7684\u6e90\u3002\\n\\n\u6240\u4ee5\u9700\u8981\u6211\u4eec\u624b\u52a8\u5b89\u88c5 `OpenResty`\uff0c\u5177\u4f53\u5b89\u88c5\u6b65\u9aa4\u53ef\u53c2\u8003 [https://openresty.org/cn/linux-packages.html#ubuntu](https://openresty.org/cn/linux-packages.html#ubuntu)\u3002\\n\\n#### \u6b65\u9aa4\u4e00\uff1a\u5b89\u88c5\u5bfc\u5165 GPG \u516c\u94a5\u65f6\u6240\u9700\u7684\u4f9d\u8d56\u5305\\n\\n\u5177\u4f53\u4ee3\u7801\u793a\u4f8b\u53ef\u53c2\u8003\u4e0b\u65b9\uff08\u6574\u4e2a\u5b89\u88c5\u8fc7\u7a0b\u5b8c\u6210\u540e\u53ef\u4ee5\u968f\u65f6\u5220\u9664\u5b83\u4eec\uff09\u3002\\n\\n```shell\\nsudo apt-get -y install --no-install-recommends wget gnupg ca-certificates\\n```\\n\\n#### \u6b65\u9aa4\u4e8c\uff1a\u5bfc\u5165 GPG \u5bc6\u94a5\\n\\n```shell\\nwget -O - https://openresty.org/package/pubkey.gpg | sudo apt-key add -\\n```\\n\\n\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u51fa\u73b0\u5bfc\u5165\u6210\u529f\u63d0\u793a\u3002\\n\\n![\u5bfc\u5165 GPG \u5bc6\u94a5.png](https://static.apiseven.com/202108/1641911867662-8d1dcb8d-7c1e-4ddd-ad60-2d7448b6c544.png)\\n\\n#### \u6b65\u9aa4\u4e09\uff1a\u6dfb\u52a0 OpenResty \u5b98\u65b9 APT \u4ed3\u5e93\\n\\n\u5bf9\u4e8e x86_64 \u6216 amd64 \u7cfb\u7edf\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u3002\\n\\n```shell\\necho \\"deb http://openresty.org/package/ubuntu $(lsb_release -sc) main\\" \\\\\\n    | sudo tee /etc/apt/sources.list.d/openresty.list\\n```\\n\\n\u800c\u5bf9\u4e8e ARM64 \u6216 aarch64 \u7cfb\u7edf\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff08\u5728 M1 \u4e0a\u8fd0\u884c\u53ef\u8fd0\u884c\u8be5\u547d\u4ee4\uff0c\u4e0a\u4e2a\u547d\u4ee4\u4f1a\u62a5\u9519\uff09\u3002\\n\\n```shell\\necho \\"deb http://openresty.org/package/arm64/ubuntu $(lsb_release -sc) main\\" \\\\\\n    | sudo tee /etc/apt/sources.list.d/openresty.list\\n```\\n\\n#### \u6b65\u9aa4\u56db\uff1a\u66f4\u65b0 APT \u7d22\u5f15\\n\\n```shell\\nsudo apt-get update\\n```\\n\\n\u4e4b\u540e\u53ef\u4ee5\u6309\u7167\u4e0b\u65b9\u4ee3\u7801\u6765\u5b89\u88c5\u8f6f\u4ef6\u5305\uff0c\u8fd9\u91cc\u6211\u4eec\u4ee5 `OpenResty` \u4e3a\u4f8b\u3002\\n\\n```shell\\nsudo apt-get -y install openresty\\n```\\n\\n#### \u6b65\u9aa4\u4e94\uff1a\u5220\u9664\u5bf9\u5e94\u5173\u8054\u5305\uff08\u53ef\u9009\uff09\\n\\n\u6700\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u6765\u5220\u9664\u8be5\u5305\u548c\u5176\u5bf9\u5e94\u7684\u5173\u8054\u5305\u3002\\n\\n```shell\\nsudo apt-get -y install --no-install-recommends software-properties-common\\n```\\n\\n\u81f3\u6b64\uff0c`OpenResty` \u5b89\u88c5\u5b8c\u6bd5\u3002\\n\\n![OpenResty \u5b89\u88c5\u6210\u529f.png](https://static.apiseven.com/202108/1641911892167-2a6b56a9-aad8-400b-99d9-8401718c6ba9.png)\\n\\n### \u5b89\u88c5\u9879\u76ee\u4f9d\u8d56\\n\\n\u9996\u5148\uff0c\u91cd\u65b0\u8fd0\u884c\u5b89\u88c5\u4f9d\u8d56\u811a\u672c\u3002\u5e76\u8fd0\u884c `LUAROCKS_SERVER=https://luarocks.cn` \u547d\u4ee4\u5b89\u88c5\u4f9d\u8d56\u3002\\n\\n```shell\\nbash utils/install-dependencies.sh\\n```\\n\\n![\u5b89\u88c5\u9879\u76ee\u4f9d\u8d56.png](https://static.apiseven.com/202108/1641911909131-3f30b00e-2939-480e-809d-ccd17e5f15c4.png)\\n\\n\u4e4b\u540e\u8fd0\u884c\u4e0b\u8ff0\u547d\u4ee4\u3002\\n\\n```shell\\ncurl https://raw.githubusercontent.com/apache/apisix/master/utils/linux-install-luarocks.sh -sL | bash -\\n```\\n\\n![\u5b89\u88c5\u4f9d\u8d56\u53cd\u9988.png](https://static.apiseven.com/202108/1641911924788-7e0d2f90-90d6-41cc-8c98-450cdf55a3c1.png)\\n\\n\u6839\u636e\u4e0a\u56fe\u53cd\u9988\u53d1\u73b0\u9519\u8bef\u63d0\u793a\uff0c\u7136\u540e\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002\\n\\n```shell\\nsudo apt install wget sudo unzip\\n```\\n\\n\u63a5\u7740\u6211\u4eec\u518d\u91cd\u65b0\u8fd0\u884c\u4e0b\u8ff0\u547d\u4ee4\u3002\\n\\n```shell\\ncurl https://raw.githubusercontent.com/apache/apisix/master/utils/linux-install-luarocks.sh -sL | bash -\\n```\\n\\n\u6700\u540e\u8fd0\u884c\u5b89\u88c5\u4f9d\u8d56\u6307\u4ee4 `LUAROCKS_SERVER=https://luarocks.cn make deps`\u3002\\n\\n![\u9879\u76ee\u4f9d\u8d56\u5b89\u88c5\u6210\u529f.png](https://static.apiseven.com/202108/1641911942296-0ed90547-80b3-4e80-be5a-89cf60ba67b4.png)\\n\\n\u81f3\u6b64\uff0c\u5927\u90e8\u5206\u4f9d\u8d56\u90fd\u5df2\u6210\u529f\u5b89\u88c5\u5b8c\u6bd5\uff0c\u4f46\u53c8\u6709\u65b0\u7684\u9519\u8bef\u63d0\u793a\u51fa\u73b0\uff08\u770b\u8d77\u6765\u662f\u4e24\u4e2a\u4ed3\u5e93\u672a\u80fd\u6210\u529f\u514b\u9686\u4e0b\u6765\uff09\u3002\u6ca1\u5173\u7cfb\uff0c\u6682\u65f6\u6ca1\u4ec0\u4e48\u5f71\u54cd\uff0c\u8fd9\u91cc\u53ef\u4ee5\u5148\u6267\u884c APISIX \u7684\u5b89\u88c5\u547d\u4ee4\u3002\\n\\n```shell\\nmake install\\n// \u5982\u679c\u51fa\u73b0\u6743\u9650\u4e0d\u8db3\u7684\u63d0\u793a\uff0c\u7528 sudo make install\\n```\\n\\n![\u6267\u884c APISIX \u5b89\u88c5.png](https://static.apiseven.com/202108/1641911956728-0a64adb1-0bc5-489c-bf5b-929177325ab4.png)\\n\\n## \u5b89\u88c5 etcd\\n\\n\u542f\u52a8 Apache APISIX \u4e4b\u524d\u9700\u8981\u5148\u5b89\u88c5 etcd\uff0c\u5177\u4f53\u5b89\u88c5\u6b65\u9aa4\u53ef\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/2.10/install-dependencies/#ubuntu-1604--1804)\\n\\n:::info \u63d0\u793a\\n\u7531\u4e8e\u8be5\u5b89\u88c5\u6559\u7a0b\u5e76\u4e0d\u662f\u9488\u5bf9 arm \u5199\u7684\uff0c\u867d\u7136\u6210\u529f\u5b89\u88c5\u4e86 etcd\uff0c\u4f46\u672a\u80fd\u6210\u529f\u5c06 etcd \u8fd0\u884c\u8d77\u6765\uff0c\u539f\u56e0\u662f\u7531\u4e8e\u9ed8\u8ba4\u4f7f\u7528 x86 \u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u5bfc\u81f4\u3002\u5177\u4f53\u8e29\u5751\u90e8\u5206\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\uff0c\u76f4\u63a5\u653e\u4e0a\u6b63\u786e\u6b65\u9aa4\u4f9b\u5927\u5bb6\u53c2\u8003\u3002\\n:::\\n\\n### \u5728 Docker \u4e2d\u8fd0\u884c etcd \u670d\u52a1\\n\\n#### \u6b65\u9aa4\u4e00\uff1a\u5b89\u88c5 Docker\\n\\n```shell\\nsudo apt install docker.io\\n```\\n\\n:::tip\\ndocker \u5e38\u7528\u7684\u547d\u4ee4(\u5982\u679c\u51fa\u73b0\u65e0\u6743\u9650\u9519\u8bef\uff0c\u8bf7\u5728\u547d\u4ee4\u524d\u6dfb\u52a0 sudo)\uff1a\\n\\n- \u67e5\u770b\u6240\u6709\u5bb9\u5668\u5217\u8868 `docker ps -a`\\n- \u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u5217\u8868 `docker ps`\\n- \u67e5\u770b\u955c\u50cf\u5217\u8868 `docker image list`\\n- \u5220\u9664\u6240\u6709\u5bb9\u5668 `docker container prune`\\n- \u5220\u9664\u6240\u6709\u955c\u50cf `docker image prune -f -a`\\n:::\\n\\n\u66f4\u591a\u5173\u4e8e Docker \u7684\u4f7f\u7528\u53ef\u53c2\u8003[Docker \u5165\u95e8\u6559\u7a0b - \u962e\u4e00\u5cf0\u7684\u7f51\u7edc\u65e5\u5fd7](https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html)\u3002\\n\\n#### \u6b65\u9aa4\u4e8c\uff1a\u62c9\u53d6\u5e76\u8fd0\u884c etcd\\n\\n```shell\\nsudo docker run -d --name etcd -p 2379:2379 -e ETCD_UNSUPPORTED_ARCH=arm64 -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 -e ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379 gcr.io/etcd-development/etcd:v3.5.1-arm64\\n```\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8be5\u64cd\u4f5c\u4e2d\u955c\u50cf\u9700\u8981\u5f00\u542f\u4ee3\u7406\u8fdb\u884c\u3002\\n\\n![\u8fd0\u884c etcd.png](https://static.apiseven.com/202108/1641912022850-0ad47270-79e2-4227-a786-9d478906b8b0.png)\\n\\n#### \u6b65\u9aa4\u4e09\uff1a\u9a8c\u8bc1 etcd \u542f\u52a8\u72b6\u6001\\n\\n```shell\\nsudo docker ps -a\\n```\\n\\n![\u9a8c\u8bc1 etcd \u5f00\u542f\u72b6\u6001.png](https://static.apiseven.com/202108/1641912040567-141b520e-4c33-448d-ba33-86e01a9f6114.png)\\n\\n\u901a\u8fc7\u4e0a\u56fe\u53cd\u9988\u53ef\u77e5\uff0cetcd \u5df2\u7ecf\u6210\u529f\u542f\u52a8\u3002\\n\\n## \u542f\u52a8 Apache APISIX\\n\\n\u7ecf\u8fc7\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u76ee\u524d\u6240\u6709\u4f9d\u8d56\u9879\u76ee\u90fd\u5df2\u51c6\u5907\u5b8c\u6bd5\uff0c\u73b0\u5728\u5c31\u53ef\u4ee5\u542f\u52a8 Apache APISIX \u4e86\u3002\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u5b89\u88c5\u4f9d\u8d56\\n\\n```shell\\nmake deps\\nmake install\\n```\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u521d\u59cb\u5316\u4f9d\u8d56\u5e76\u542f\u52a8 APISIX\\n\\n```shell\\napisix init\\n\\n# start APISIX\\napisix start\\n\\n# stop APISIX\\napisix stop\\n```\\n\\n![\u6210\u529f\u542f\u52a8 APISIX.png](https://static.apiseven.com/202108/1641912056163-67b0f11b-a122-4f5b-b7a6-c09662443cce.png)\\n\\nApache APISIX \u5df2\u6210\u529f\u542f\u52a8\u3002\u66f4\u591a\u5b89\u88c5\u642d\u5efa Apache APISIX \u7684\u6b65\u9aa4\u7ec6\u8282\u53ef\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/how-to-build)\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u901a\u8fc7\u8be6\u7ec6\u6b65\u9aa4\uff0c\u4e3a\u5927\u5bb6\u5c55\u793a\u4e86\u5982\u4f55\u5728 Macbook M1 \u82af\u7247\u7cfb\u7edf\u4e0b\u8fdb\u884c Apache APISIX \u7684\u90e8\u7f72\u4e0e\u5b89\u88c5\u3002\u603b\u4f53\u5b9e\u8df5\u4e0b\u6765\uff0c\u591a\u591a\u5c11\u5c11\u4f1a\u51fa\u73b0\u4e00\u4e9b\u8e29\u5751\u7684\u8fc7\u7a0b\uff0c\u4f46\u603b\u4f53\u4f53\u9a8c\u4e0b\u6765\u4f9d\u65e7\u662f\u90e8\u7f72\u6210\u529f\u3002\\n\\n\u5982\u679c\u5404\u4f4d\u6709\u66f4\u597d\u7684\u5efa\u8bae\uff0c\u6b22\u8fce\u5927\u5bb6\u4e3a Apache APISIX [\u6784\u5efa\u6587\u6863](https://apisix.apache.org/docs/apisix/how-to-build/) \u8d21\u732e\uff0c\u7559\u4e0b\u60a8\u7684\u5efa\u8bae\uff0c\u6765\u5e2e\u52a9\u66f4\u591a\u7684\u4eba\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff0812.16-12.31\uff09","metadata":{"permalink":"/zh/blog/2022/01/05/weekly-report-1231","source":"@site/blog/2022/01/05/weekly-report-1231.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff0812.16-12.31\uff09","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2022-01-05T00:00:00.000Z","formattedDate":"2022\u5e741\u67085\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.175,"truncated":true,"authors":[],"prevItem":{"title":"\u5982\u4f55\u5728 ARM Ubuntu \u4e2d\u6784\u5efa Apache APISIX","permalink":"/zh/blog/2022/01/11/building-apisix-in-ubuntu-for-arm"},"nextItem":{"title":"Apache APISIX \u7ed3\u5408 Authing \u5b9e\u73b0\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7ba1\u7406","permalink":"/zh/blog/2022/01/04/authing"}},"content":"> \u4ece 12.16 \u5230 12.31, \u6709 33 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 90 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1641356905322-c0fdef6a-370f-4369-b4b8-3e296cdfeb7f.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1641363865367-2500996c-30e9-465e-9a52-2c2981b9b8b2.png)\\n\\n## Good first issue\\n\\n### Issue #5861\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5861\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5b8c\u6574\u7684 CI \\"linux_openresty\\" \u9700\u8981 50 \u5206\u949f\u624d\u80fd\u5b8c\u6210\u3002\\n\\n```YAML\\n - linux_openresty\\n```\\n\\n\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u5206\u6210\u591a\u4e2a\u90e8\u5206\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u6700\u5927\u7684\u5355\u9879\u5de5\u4f5c\u65f6\u95f4\u3002\\n\\n\u53ef\u4ee5\u5728\u4e0b\u65b9\u4e2d\u901a\u8fc7\u4e00\u4e2a\u73af\u5883\u53d8\u91cf\u4f5c\u4e3a\u6d4b\u8bd5\u6587\u4ef6\u7684\u8303\u56f4\uff1a\\n\\n```Shell\\n FLUSH_ETCD=1 PERL5LIB=.:$PERL5LIB prove -Itest-nginx/lib -r t\\n```\\n\\n### Issue #5900\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5900\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4f7f\u7528 `base-auth` \u63d2\u4ef6\u65f6\uff0c\u4e0d\u60f3\u5c06 `Authentication` \u5934\u4f20\u9012\u7ed9\u4e0a\u6e38\u3002\\n\\n\u4e0a\u6e38\u4e0d\u9700\u8981\u611f\u77e5\u8fd9\u4e9b\u8eab\u4efd\u9a8c\u8bc1\u6807\u5934\u3002\\n\\n\u5982\u4e0b\u6240\u793a\uff0c\u4f7f\u7528 proxy-rewrite \u63d2\u4ef6\u91cd\u5199 Authentication \u5934\u90e8\uff1a\\n\\n```Bash\\n \\"plugins\\": {\\n        \\"basic-auth\\": {},\\n        \\"proxy-rewrite\\": {\\n            \\"headers\\": {\\n                \\"Authorization\\": \\"\\"\\n            }\\n        }\\n    },\\n```\\n\\n\u6211\u4eec\u53ef\u4ee5\u5728 `basic-auth` \u63d2\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u914d\u7f6e\u6765\u9690\u85cf\u8eab\u4efd\u9a8c\u8bc1\u5934\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u4f7f\u7528\u8fd9\u4e9b\u63d2\u4ef6\u4f1a\u66f4\u65b9\u4fbf\u3002\u540c\u7406\uff0c`key-auth` \u63d2\u4ef6\u4e5f\u662f\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [\u5b8c\u6210\u4e86 ApisixPluginConfig \u81ea\u5b9a\u4e49\u8d44\u6e90\u7684\u63a7\u5236\u5668\u5faa\u73af\u548c\u76f8\u5173\u903b\u8f91\u3002\u5df2\u4e8e APISIX Ingress controller v1.4 \u4e2d\u53d1\u5e03](https://github.com/apache/apisix-ingress-controller/pull/815)\uff08\u8d21\u732e\u8005\uff1a[neverCase](https://github.com/neverCase)\uff09\\n\\n- [limit-count \u63d2\u4ef6\u652f\u6301\u5171\u4eab\u8ba1\u6570\u5668](https://github.com/apache/apisix/pull/5881)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [ext-plugin \u63d2\u4ef6\u652f\u6301\u964d\u7ea7\u7b56\u7565](https://github.com/apache/apisix/pull/5897)\uff08\u8d21\u732e\u8005\uff1a[arabot777](https://github.com/arabot777)\uff09\\n\\n- [control api \u652f\u6301 RESTful \u98ce\u683c\u8def\u5f84\u53c2\u6570\u5339\u914d](https://github.com/apache/apisix/pull/5934)\uff08\u8d21\u732e\u8005\uff1a[The-White-Lion](https://github.com/The-White-Lion)\uff09\\n\\n- [\u652f\u6301\u53d1\u9001 APISIX \u6570\u636e\u4ee5\u534f\u52a9 OPA \u63d2\u4ef6\u7684\u51b3\u7b56](https://github.com/apache/apisix/pull/5874)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [\u5141\u8bb8\u8bbe\u7f6e proxy_request_buffering \u800c\u4e0d\u7981\u7528 proxy-mirror](https://github.com/apache/apisix/pull/5943)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u6377\u62a5\u9891\u4f20\uff01Apache APISIX \u73b0\u5df2\u652f\u6301\u5bf9\u63a5 Google Cloud Logging](https://apisix.apache.org/zh/blog/2021/12/22/google-logging)\uff1a\\n\\n  \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u5728 Apache APISIX \u4e2d\u914d\u7f6e\u548c\u4f7f\u7528 Google Cloud Logging \u670d\u52a1\u3002\\n\\n- [\u518d\u63a5\u518d\u5389\uff01Apache APISIX \u96c6\u6210 Open Policy Agent](https://apisix.apache.org/zh/blog/2021/12/24/open-policy-agent)\uff1a\\n\\n  \u672c\u6587\u4ee5 HTTP API \u4e3a\u4f8b\u4e3a\u5927\u5bb6\u4ecb\u7ecd `OPA` \u63d2\u4ef6\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u5c06 Apache APISIX \u4e0e OPA \u8fdb\u884c\u96c6\u6210\uff0c\u5b9e\u73b0\u540e\u7aef\u670d\u52a1\u7684\u8ba4\u8bc1\u6388\u6743\u89e3\u8026\u3002\\n\\n- [\u751f\u6001\u4e30\u5bcc\u6301\u7eed\u8fdb\u884c\u4e2d\uff0cApache OpenWhisk \u96c6\u6210\u95ea\u4eae\u767b\u573a](https://apisix.apache.org/zh/blog/2021/12/24/apisix-integrate-openwhisk-plugin)\uff1a\\n\\n  \u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5173\u4e8e `openwhisk` \u63d2\u4ef6\u7684\u529f\u80fd\u524d\u77bb\u4e0e\u4f7f\u7528\u6b65\u9aa4\uff0c\u7ed3\u5408 Apache APISIX \u63d0\u4f9b\u7684\u591a\u79cd\u8eab\u4efd\u8ba4\u8bc1\u63d2\u4ef6\u6765\u5b9e\u73b0\u8ba4\u8bc1\u4e0e\u6388\u6743\u7b49\u529f\u80fd\u3002\\n\\n- [\u4f7f\u7528 Apache APISIX \u4ee3\u7406 gRPC \u670d\u52a1](https://apisix.apache.org/zh/blog/2021/12/30/apisix-proxy-grpc-service)\uff1a\\n\\n  \u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u5728 Apache APISIX \u4e2d\u901a\u8fc7 `grpc-transcode` \u63d2\u4ef6\u6765\u5c06\u5ba2\u6237\u7aef\u7684 HTTP \u6d41\u91cf\u4ee3\u7406\u5230\u540e\u7aef gRPC \u670d\u52a1\u4e0a\u3002"},{"id":"Apache APISIX \u7ed3\u5408 Authing \u5b9e\u73b0\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7ba1\u7406","metadata":{"permalink":"/zh/blog/2022/01/04/authing","source":"@site/blog/2022/01/04/authing.md","title":"Apache APISIX \u7ed3\u5408 Authing \u5b9e\u73b0\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7ba1\u7406","description":"\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u4f60\u53ef\u4ee5\u4e86\u89e3\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7684\u76f8\u5173\u7ec6\u8282\uff0c\u4ee5\u53ca\u5982\u4f55\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Authing \u7684\u5177\u4f53\u64cd\u4f5c\u6b65\u9aa4\u3002","date":"2022-01-04T00:00:00.000Z","formattedDate":"2022\u5e741\u67084\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Authentication","permalink":"/zh/blog/tags/authentication"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":12.595,"truncated":true,"authors":[{"name":"\u6731\u6b23\u6b23","title":"Author","url":"https://github.com/starsz","image_url":"https://avatars.githubusercontent.com/u/25628854?v=4","imageURL":"https://avatars.githubusercontent.com/u/25628854?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://avatars.githubusercontent.com/u/36651058?v=4","imageURL":"https://avatars.githubusercontent.com/u/36651058?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff0812.16-12.31\uff09","permalink":"/zh/blog/2022/01/05/weekly-report-1231"},"nextItem":{"title":"\u4f7f\u7528 Apache APISIX \u4ee3\u7406 gRPC \u670d\u52a1","permalink":"/zh/blog/2021/12/30/apisix-proxy-grpc-service"}},"content":"> \u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u4f60\u53ef\u4ee5\u4e86\u89e3\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7684\u76f8\u5173\u7ec6\u8282\uff0c\u4ee5\u53ca\u5982\u4f55\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Authing \u7684\u5177\u4f53\u64cd\u4f5c\u6b65\u9aa4\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n![APISIX-Authing Cover](https://static.apiseven.com/202108/1641274764710-e6f9fe4e-01de-4c7d-b465-fab4202a6475.png)\\n\\n## \u9879\u76ee\u4ecb\u7ecd\\n\\n### \u5173\u4e8e Apache APISIX\\n\\n[Apache APISIX](https://github.com/apache/apisix) \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u4e0d\u4ec5\u652f\u6301\u63d2\u4ef6\u52a8\u6001\u53d8\u66f4\u548c\u70ed\u63d2\u62d4\uff0c\u800c\u4e14\u62e5\u6709\u4f17\u591a\u5b9e\u7528\u7684\u63d2\u4ef6\u3002Apache APISIX \u7684 OpenID Connect \u63d2\u4ef6\u652f\u6301 OpenID Connect \u534f\u8bae\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u8be5\u63d2\u4ef6\u8ba9 Apache APISIX \u5bf9\u63a5 Authing \u670d\u52a1\uff0c\u4f5c\u4e3a\u96c6\u4e2d\u5f0f\u8ba4\u8bc1\u7f51\u5173\u90e8\u7f72\u4e8e\u4f01\u4e1a\u4e2d\u3002\\n\\n### \u5173\u4e8e Authing\\n\\n[Authing](https://www.authing.cn/) \u662f\u56fd\u5185\u9996\u6b3e\u4ee5\u5f00\u53d1\u8005\u4e3a\u4e2d\u5fc3\u7684\u5168\u573a\u666f\u8eab\u4efd\u4e91\u4ea7\u54c1\uff0c\u96c6\u6210\u4e86\u6240\u6709\u4e3b\u6d41\u8eab\u4efd\u8ba4\u8bc1\u534f\u8bae\uff0c\u4e3a\u4f01\u4e1a\u548c\u5f00\u53d1\u8005\u63d0\u4f9b\u5b8c\u5584\u5b89\u5168\u7684\u7528\u6237\u8ba4\u8bc1\u548c\u8bbf\u95ee\u7ba1\u7406\u670d\u52a1\u3002\u4ee5\u300cAPI First\u300d\u4f5c\u4e3a\u4ea7\u54c1\u57fa\u77f3\uff0c\u628a\u8eab\u4efd\u9886\u57df\u6240\u6709\u5e38\u7528\u529f\u80fd\u90fd\u8fdb\u884c\u4e86\u6a21\u5757\u5316\u7684\u5c01\u88c5\uff0c\u901a\u8fc7\u5168\u573a\u666f\u7f16\u7a0b\u8bed\u8a00 SDK \u5c06\u6240\u6709\u80fd\u529b API \u5316\u63d0\u4f9b\u7ed9\u5f00\u53d1\u8005\u3002\u540c\u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u7075\u6d3b\u7684\u4f7f\u7528 Authing \u5f00\u653e\u7684 RESTful APIs \u8fdb\u884c\u529f\u80fd\u62d3\u5c55\uff0c\u6ee1\u8db3\u4e0d\u540c\u4f01\u4e1a\u4e0d\u540c\u4e1a\u52a1\u573a\u666f\u4e0b\u7684\u8eab\u4efd\u7ba1\u7406\u9700\u6c42\u3002\\n\\n## \u4ec0\u4e48\u662f\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\\n\\n### \u4f20\u7edf\u8eab\u4efd\u8ba4\u8bc1\\n\\n\u5728\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u4e0b\uff0c\u5404\u4e2a\u540e\u7aef\u5e94\u7528\u670d\u52a1\u9700\u8981\u5355\u72ec\u5f00\u53d1\u529f\u80fd\u4ee5\u652f\u6301\u8eab\u4efd\u8ba4\u8bc1\u529f\u80fd\uff0c\u4f8b\u5982\u4e0e\u8eab\u4efd\u63d0\u4f9b\u5546\u8fdb\u884c\u4ea4\u4e92\u3001\u83b7\u53d6\u7528\u6237\u7684\u8eab\u4efd\u4fe1\u606f\u7b49\u529f\u80fd\u3002\\n\\n![\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u6d41\u7a0b\u56fe](https://static.apiseven.com/202108/1639467045776-715e1805-540b-4cef-87c5-6166e2af43a8.png)\\n\\n### \u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\\n\\n\u4e0e\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u4e0d\u540c\uff0c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u628a\u7528\u6237\u8ba4\u8bc1\u4ece\u5e94\u7528\u670d\u52a1\u4e2d\u62bd\u79bb\u4e86\u51fa\u6765\u3002\u4ee5 Apache APISIX \u4e3a\u4f8b\uff0c\u96c6\u4e2d\u8ba4\u8bc1\u7684\u6d41\u7a0b\u5982\u4e0a\u56fe\u6240\u793a\uff1a\u9996\u5148\u7531\u7528\u6237\u53d1\u8d77\u8bf7\u6c42\uff08request\uff09\uff0c\u7136\u540e\u7531\u524d\u7f6e\u7684\u7f51\u5173\u8d1f\u8d23\u7528\u6237\u8ba4\u8bc1\u6d41\u7a0b\uff0c\u4e0e\u8eab\u4efd\u63d0\u4f9b\u65b9\u5bf9\u63a5\uff0c\u5411\u8eab\u4efd\u63d0\u4f9b\u65b9\u53d1\u9001\u8eab\u4efd\u8ba4\u8bc1\uff08authorization\uff09\u8bf7\u6c42\u3002\u8eab\u4efd\u63d0\u4f9b\u65b9\u8fd4\u56de\u7528\u6237\u8eab\u4efd\u4fe1\u606f\uff08user info\uff09\u3002\u7f51\u5173\u5b8c\u6210\u7528\u6237\u8eab\u4efd\u8bc6\u522b\u540e\uff0c\u5c06\u7528\u6237\u8eab\u4efd\u4fe1\u606f\u901a\u8fc7\u8bf7\u6c42\u5934\u7684\u5f62\u5f0f\u8f6c\u53d1\u81f3\u540e\u7aef\u5e94\u7528\u3002\\n\\n![\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\u6d41\u7a0b\u56fe](https://static.apiseven.com/202108/1639467122244-d4292436-c5ce-48f6-b1d5-67645f24fbc9.png)\\n\\n### \u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7684\u4f18\u70b9\\n\\n\u76f8\u6bd4\u8f83\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\uff0c\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\u4e0b\u6709\u5982\u4e0b\u4f18\u70b9\uff1a\\n\\n1. \u7b80\u5316\u5e94\u7528\u5f00\u53d1\u6d41\u7a0b\uff0c\u964d\u4f4e\u5f00\u53d1\u5e94\u7528\u5de5\u4f5c\u91cf\u548c\u7ef4\u62a4\u6210\u672c\uff0c\u907f\u514d\u5404\u4e2a\u5e94\u7528\u91cd\u590d\u5f00\u53d1\u8eab\u4efd\u8ba4\u8bc1\u903b\u8f91\u3002\\n2. \u63d0\u9ad8\u4e1a\u52a1\u7684\u5b89\u5168\u6027\uff0c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u5728\u7f51\u5173\u5c42\u9762\u80fd\u591f\u53ca\u65f6\u62e6\u622a\u672a\u7ecf\u8eab\u4efd\u8ba4\u8bc1\u7684\u8bf7\u6c42\uff0c\u4fdd\u62a4\u540e\u7aef\u7684\u5e94\u7528\u3002\\n\\n\u540c\u65f6\u7ed3\u5408 Authing \u5f3a\u5927\u7684\u8eab\u4efd\u8ba4\u8bc1\u7ba1\u7406\u529f\u80fd\uff0c\u53ef\u5b9e\u73b0\u5982\u4e0b\u529f\u80fd\uff1a\\n\\n1. \u901a\u8fc7\u63a7\u5236\u53f0\u5bf9\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u8fdb\u884c\u751f\u547d\u5468\u671f\u7ba1\u7406\uff0c\u5305\u62ec\u521b\u5efa\u3001\u542f\u7528\u3001\u7981\u7528\u7b49\u3002\\n2. \u63d0\u4f9b\u5b9e\u65f6\u3001\u53ef\u89c6\u5316\u7684\u5e94\u7528\u76d1\u63a7\uff0c\u5305\u62ec\uff1a\u63a5\u53e3\u8bf7\u6c42\u6b21\u6570\u3001\u63a5\u53e3\u8c03\u7528\u5ef6\u8fdf\u548c\u63a5\u53e3\u9519\u8bef\u4fe1\u606f\uff0c\u5e76\u4e14\u8fdb\u884c\u5b9e\u65f6\u544a\u8b66\u901a\u77e5\u3002\\n3. \u96c6\u4e2d\u5f0f\u65e5\u5fd7\uff0c\u53ef\u4ee5\u65b9\u4fbf\u5730\u67e5\u770b\u7528\u6237\u767b\u5f55\u3001\u767b\u51fa\u4ee5\u53ca\u5bf9\u5e94\u7528\u7684\u8c03\u6574\u548c\u4fee\u6539\u4fe1\u606f\u3002\\n\\n\u66f4\u591a\u5177\u4f53\u5185\u5bb9\u53ef\u53c2\u8003 [Authing \u5e94\u7528\u96c6\u6210\u7f51\u5173](https://www.authing.cn/gateway-integration)\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u914d\u7f6e Authing\\n\\n1. \u767b\u5f55 Authing \u8d26\u53f7\uff0c\u9009\u62e9\u81ea\u5efa\u5e94\u7528\uff0c\u5e76\u586b\u5165\u5e94\u7528\u540d\u79f0\u548c\u8ba4\u8bc1\u5730\u5740\u3002\u5982\u679c\u4f60\u6ca1\u6709 Authing \u8d26\u53f7\uff0c\u8bf7\u8bbf\u95ee [Authing \u5b98\u7f51](https://www.authing.cn/)\uff0c\u5355\u51fb\u53f3\u4e0a\u89d2 \u201c\u767b\u5f55/\u6ce8\u518c\u201d\uff0c\u6ce8\u518c\u4e00\u4e2a Authing \u8d26\u53f7\u3002\\n    ![\u914d\u7f6e Authing](https://static.apiseven.com/202108/1641275135400-5a11226a-404d-43f7-bde5-6e1b9599cebd.png)\\n\\n2. \u5355\u51fb\u201c\u521b\u5efa\u201d\uff0c\u521b\u5efa\u4e00\u4e2a Authing \u5e94\u7528\u3002\\n    ![\u521b\u5efa Authing \u5e94\u7528](https://static.apiseven.com/202108/1641275174810-f78469f7-24dd-41c8-bdc7-eb7d5ff58672.png)\\n\\n3. \u8bbe\u7f6e\u767b\u5f55\u548c\u767b\u51fa\u7684\u8df3\u8f6c URL\u3002\u5728\u8ba4\u8bc1\u8fc7\u7a0b\u4e2d\uff0cAuthing \u5c06\u4f1a\u62d2\u7edd\u9664\u914d\u7f6e\u4ee5\u5916\u7684\u56de\u8c03 URL\uff0c\u7531\u4e8e\u672c\u6b21\u4e3a\u672c\u5730\u6d4b\u8bd5\uff0c\u6240\u4ee5\u5c06\u767b\u5f55\u56de\u8c03 URL \u548c\u767b\u51fa\u56de\u8c03 URL \u90fd\u8bbe\u7f6e\u4e3a APISIX \u8bbf\u95ee\u5730\u5740 http://127.0.0.1:9080/ \u3002\\n    ![\u8bbe\u7f6e\u767b\u5f55\u548c\u767b\u51fa\u7684\u8df3\u8f6c URL](https://static.apiseven.com/202108/1641275642514-65a2205a-22dd-43b2-ba06-e51b249754a8.png)\\n\\n4. \u521b\u5efa\u7528\u6237\uff08\u53ef\u9009\uff09\u3002\u5728\u7528\u6237\u5217\u8868\u9875\u9762\uff0c\u521b\u5efa\u7528\u6237\uff0c\u8d26\u53f7\u5bc6\u7801\u5206\u522b\u4e3a user1/user1\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u300c\u7528\u6237\u4fe1\u606f-\u6388\u6743\u7ba1\u7406\u300d\u9875\u9762\u4e2d\u8bbe\u7f6e\u662f\u5426\u5141\u8bb8\u5e94\u7528\u7684\u8bbf\u95ee\uff08\u9ed8\u8ba4\u4e3a\u5141\u8bb8\uff09\u3002\\n    ![\u521b\u5efa\u7528\u6237](https://static.apiseven.com/202108/1641275703261-ec7d98d4-50ee-428c-b73c-a70002e67dfb.png)\\n    ![\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650](https://static.apiseven.com/202108/1641275703263-90176798-6bb7-40d5-976f-dfc516db020f.png)\\n\\n5. \u8bbf\u95ee\u5e94\u7528\u9875\u9762\uff0c\u83b7\u53d6\u4ee5\u4e0b\u914d\u7f6e\uff0c\u914d\u7f6e Apache APISIX OpenID Connect \u65f6\u9700\u8981\u63d0\u4f9b\u8fd9\u4e9b\u4fe1\u606f\uff1a\\n   1. App ID\uff1a OAuth client ID\uff0c\u5373\u5e94\u7528\u7684 ID\u3002\u4e0e\u4e0b\u6587\u7684 `client_id` \u548c `{YOUR_CLIENT_ID}` \u5bf9\u5e94\u3002\\n   2. App secret\uff1aOAuth client secret\uff0c\u5373\u5e94\u7528\u5bc6\u94a5\u3002\u4e0e\u4e0b\u6587\u7684 `client_secret` \u548c `{YOUR_CLIENT_SECRET}` \u5bf9\u5e94\u3002\\n   3. \u670d\u52a1\u53d1\u73b0\u5730\u5740\uff1a\u5e94\u7528\u670d\u52a1\u53d1\u73b0\u7684\u5730\u5740\u3002\u4e0e\u4e0b\u6587\u7684 `{YOUR_DISCOVERY}` \u5bf9\u5e94\u3002\\n   ![\u914d\u7f6e\u4fe1\u606f](https://static.apiseven.com/202108/1641275800242-e937cfd4-6237-4928-adab-7ec99556bbac.png)\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u5b89\u88c5 Apache APISIX\\n\\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u6e90\u7801\u5305\u3001Docker\u3001Helm Chart \u7b49\u591a\u79cd\u65b9\u5f0f\u6765\u5b89\u88c5 Apache APISIX\u3002\\n\\n#### \u5b89\u88c5\u4f9d\u8d56\\n\\nApache APISIX \u7684\u8fd0\u884c\u73af\u5883\u9700\u8981\u4f9d\u8d56 NGINX \u548c etcd\uff0c\u6240\u4ee5\u5728\u5b89\u88c5 Apache APISIX \u524d\uff0c\u8bf7\u6839\u636e\u60a8\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u3002\u6211\u4eec\u63d0\u4f9b\u4e86 CentOS7\u3001Fedora 31 & 32 \u3001Ubuntu 16.04 & 18.04\u3001 Debian 9 & 10 \u548c MacOS \u4e0a\u7684\u4f9d\u8d56\u5b89\u88c5\u64cd\u4f5c\u6b65\u9aa4\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003[\u5b89\u88c5\u4f9d\u8d56](https://apisix.apache.org/zh/docs/apisix/install-dependencies/)\u3002\\n\\n\u901a\u8fc7 Docker \u6216 Helm Chart \u5b89\u88c5 Apache APISIX \u65f6\uff0c\u5df2\u7ecf\u5305\u542b\u4e86\u6240\u9700\u7684 NGINX \u548c etcd\uff0c\u8bf7\u53c2\u7167\u5404\u81ea\u5bf9\u5e94\u7684\u6587\u6863\u3002\\n\\n#### \u901a\u8fc7 RPM \u5305\u5b89\u88c5\uff08CentOS 7\uff09\\n\\n\u8fd9\u79cd\u5b89\u88c5\u65b9\u5f0f\u9002\u7528\u4e8e CentOS 7 \u64cd\u4f5c\u7cfb\u7edf\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5 Apache APISIX\u3002\\n\\n```shell\\nsudo yum install -y https://github.com/apache/apisix/releases/download/2.7/apisix-2.7-0.x86_64.rpm\\n```\\n\\n#### \u901a\u8fc7 Docker \u5b89\u88c5\\n\\n\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[\u4f7f\u7528 Docker \u5b89\u88c5 Apache APISIX](https://hub.docker.com/r/apache/apisix)\u3002\\n\\n#### \u901a\u8fc7 Helm Chart \u5b89\u88c5\\n\\n\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[\u4f7f\u7528 Helm Chart \u5b89\u88c5 Apache APISIX](https://github.com/apache/apisix-helm-chart)\u3002\\n\\n#### \u901a\u8fc7\u6e90\u7801\u5305\u5b89\u88c5\\n\\n1. \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a `apisix-2.7` \u7684\u76ee\u5f55\uff1a\\n  \\n  ```shell\\n  mkdir apisix-2.7\\n  ```\\n\\n2. \u4e0b\u8f7d Apache APISIX Release \u6e90\u7801\u5305\uff1a\\n  \\n  ```shell\\n  wget https://downloads.apache.org/apisix/2.7/apache-apisix-2.7-src.tgz\\n  ```\\n\\n  \u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7 Apache APISIX \u5b98\u7f51\u4e0b\u8f7d Apache APISIX Release \u6e90\u7801\u5305\u3002 Apache APISIX \u5b98\u7f51\u4e5f\u63d0\u4f9b\u4e86 Apache APISIX\u3001APISIX Dashboard \u548c APISIX Ingress Controller \u7684\u6e90\u7801\u5305\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003 [Apache APISIX \u5b98\u7f51-\u4e0b\u8f7d\u9875](https://apisix.apache.org/zh/downloads)\u3002\\n\\n3. \u89e3\u538b Apache APISIX Release \u6e90\u7801\u5305\uff1a\\n  \\n  ```shell\\n  tar zxvf apache-apisix-2.7-src.tgz -C apisix-2.7\\n  ```\\n\\n4. \u5b89\u88c5\u8fd0\u884c\u65f6\u4f9d\u8d56\u7684 Lua \u5e93\uff1a\\n\\n  ```shell\\n  # \u5207\u6362\u5230 apisix-2.7 \u76ee\u5f55\\n  cd apisix-2.7\\n  # \u521b\u5efa\u4f9d\u8d56\\n  make deps\\n  ```\\n\\n#### \u521d\u59cb\u5316\u4f9d\u8d56\\n\\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u521d\u59cb\u5316 NGINX \u914d\u7f6e\u6587\u4ef6\u548c etcd\u3002\\n\\n```shell\\n# initialize NGINX config file and etcd\\nmake init\\n```\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u542f\u52a8 Apache APISIX \u5e76\u914d\u7f6e\u5bf9\u5e94\u7684\u8def\u7531\\n\\n1. \u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u542f\u52a8 Apache APISIX\u3002\\n\\n   ```shell\\n   apisix start\\n   ```\\n\\n2. \u521b\u5efa\u8def\u7531\u5e76\u914d\u7f6e OpenID Connect \u63d2\u4ef6\u3002OpenID Connect \u914d\u7f6e\u5217\u8868\u5982\u4e0b\u3002\\n\\n|\u5b57\u6bb5|\u9ed8\u8ba4\u503c|\u4f7f\u7528\u8bf4\u660e|\\n|:--------|:--------|:---------------|\\n|client_id|N/A|OAuth \u5ba2\u6237\u7aef ID|\\n|client_secret|N/A|OAuth \u5ba2\u6237\u7aef\u5bc6\u94a5|\\n|discovery|N/A|\u8eab\u4efd\u63d0\u4f9b\u5546\u7684\u670d\u52a1\u53d1\u73b0\u7aef\u70b9|\\n|scope|openid|\u9700\u8981\u8bbf\u95ee\u8d44\u6e90\u8303\u56f4|\\n|relm|apisix|\u6307\u5b9a WWW-Authenticate \u54cd\u5e94\u5934\u9a8c\u8bc1\u4fe1\u606f|\\n|bearer_only|false|\u662f\u5426\u68c0\u67e5\u8bf7\u6c42\u5934\u4e2d\u7684 token|\\n|logout_path|/logout|\u767b\u51fa\u7684 URI|\\n|redirect_uri|request_uri|\u8eab\u4efd\u63d0\u4f9b\u5546\u8df3\u8f6c\u56de\u6765\u7684 URI\uff0c\u9ed8\u8ba4\u4e3a\u8bf7\u6c42\u5730\u5740|\\n|timeout|3|\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2|\\n|ssl_verify|false|\u662f\u5426\u8eab\u4efd\u63d0\u4f9b\u5546\u7684\u6821\u9a8c ssl \u8bc1\u4e66|\\n|introspection_endpoint|N/A|\u8eab\u4efd\u63d0\u4f9b\u5546\u7684\u4ee4\u724c\u9a8c\u8bc1\u7aef\u70b9\u7684 URL\uff0c\u4e0d\u586b\u5219\u5c06\u4ece discovery \u54cd\u5e94\u4e2d\u63d0\u53d6\u3002|\\n|introspection_endpoint_auth_method|client_secret_basic|\u4ee4\u724c\u81ea\u7701\u7684\u8ba4\u8bc1\u65b9\u6cd5\u540d\u79f0|\\n|public_key|N/A|\u9a8c\u8bc1\u4ee4\u724c\u7684\u516c\u94a5|\\n|token_signing_alg_values_expected|N/A|\u9a8c\u8bc1\u4ee4\u724c\u7684\u7b97\u6cd5|\\n|set_access_token_header|true|\u662f\u5426\u5728\u8bf7\u6c42\u5934\u4e2d\u643a\u5e26 access token|\\n|access_token_in_authorization_header|false|true \u65f6\u5c06 access token \u653e\u7f6e\u5728 Authorization \u5934\u4e2d\uff0cfalse \u65f6\u5c06 access token \u653e\u7f6e\u5728 X-Access-Token \u5934\u4e2d\u3002|\\n|set_id_token_header|false|\u662f\u5426\u5c06 ID token \u643a\u5e26\u81f3 X-ID-Token \u8bf7\u6c42\u5934|\\n|set_userinfo_header|false|\u662f\u5426\u5c06\u7528\u6237\u4fe1\u606f\u643a\u5e26\u81f3 X-Userinfo \u8bf7\u6c42\u5934|\\n\\n\u4ee5\u4e0b\u4ee3\u7801\u793a\u4f8b\u901a\u8fc7 Apache APISIX Admin API \u8fdb\u884c\u521b\u5efa\u8def\u7531\uff0c\u8bbe\u7f6e\u8def\u7531\u7684\u4e0a\u6e38\u4e3a [httpbin.org](http://httpbin.org)\u3002`httpbin.org` \u662f\u4e00\u4e2a\u7b80\u5355\u7684\u7528\u4e8e\u63a5\u6536\u8bf7\u6c42\u548c\u54cd\u5e94\u8bf7\u6c42\u7684\u540e\u7aef\u670d\u52a1\uff0c\u4e0b\u6587\u5c06\u4f7f\u7528 `httpbin.org` \u7684 `get` \u9875\u9762\uff0c\u53c2\u8003 [http bin get](http://httpbin.org/#/HTTP_Methods/get_get)\u3002\\n\\n\u5177\u4f53\u914d\u7f6e\u9879\u8bf7\u53c2\u8003 [Apache APISIX OpenID Connect Plugin](https://apisix.apache.org/zh/docs/apisix/plugins/openid-connect/)\u3002\\n\\n```shell\\ncurl  -XPOST 127.0.0.1:9080/apisix/admin/routes -H \\"X-Api-Key: edd1c9f034335f136f87ad84b625c8f1\\" -d \'{\\n    \\"uri\\":\\"/*\\",\\n    \\"plugins\\":{\\n        \\"openid-connect\\":{\\n            \\"client_id\\":\\"{YOUR_CLIENT_ID}\\",\\n            \\"client_secret\\":\\"{YOUR_CLIENT_SECRET}\\",\\n            \\"discovery\\":\\"https://{YOUR_DISCOVERY}\\",\\n            \\"scope\\":\\"openid profile\\",\\n            \\"bearer_only\\":false,\\n            \\"realm\\":\\"apisix\\",\\n            \\"introspection_endpoint_auth_method\\":\\"client_secret_post\\",\\n            \\"redirect_uri\\":\\"http://127.0.0.1:9080/\\"\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"httpbin.org:80\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u6b65\u9aa4\u56db\uff1a\u8bbf\u95ee Apache APISIX\\n\\n1. \u8bbf\u95ee \\"http://127.0.0.1:9080/get\\"\uff0c\u7531\u4e8e\u5df2\u7ecf\u5f00\u542f\u4e86 OpenID Connect \u63d2\u4ef6\uff0c\u6240\u4ee5\u9875\u9762\u88ab\u91cd\u5b9a\u5411\u5230 Authing \u767b\u5f55\u9875\u9762\uff08\u53ef\u5728 Authing \u63a7\u5236\u53f0\u4e2d \u300c\u5e94\u7528-\u54c1\u724c\u5316\u300d\u5bf9\u8be5\u9875\u9762\u8fdb\u884c\u5b9a\u5236\uff09\u3002\\n    ![\u8bbf\u95ee Apache APISIX](https://static.apiseven.com/202108/1641276796088-48cb415e-d5dd-4c15-a3da-ecbb4c987b06.png)\\n\\n2. \u8f93\u5165\u7528\u6237\u5728 Authing \u6ce8\u518c\u7684\u8d26\u53f7\u5bc6\u7801\uff0c\u6216\u8005\u5728\u6b65\u9aa4\u4e00\u4e2d\u521b\u5efa\u7684\u7528\u6237 user1/user1 \uff0c\u5355\u51fb\u201c\u767b\u5f55\u201d\uff0c\u767b\u5f55 Authing \u8d26\u6237\u3002\\n\\n3. \u767b\u5f55\u6210\u529f\u4e4b\u540e\uff0c\u80fd\u6210\u529f\u8bbf\u95ee\u5230 httpbin.org \u4e2d\u7684 get \u9875\u9762\u3002\u8be5 httpbin.org/get \u9875\u9762\u5c06\u8fd4\u56de\u8bf7\u6c42\u7684\u6570\u636e\u5982\u4e0b\uff1a\\n\\n    ```shell\\n    ...\\n    \\"X-Access-Token\\": \\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InFqeU55aVdVd2NhbUFxdEdVRUNCeFNsTWxQSWtTR2N1NmkyZzhEUk1OSGsifQ.eyJqdGkiOiJjTy16a0pCS0NSRFlHR2kyWkJhY0oiLCJzdWIiOiI2MWM5OGFmOTg0MjI4YWU0OTYyMDU4NTIiLCJpYXQiOjE2NDA1OTg4NTgsImV4cCI6MTY0MTgwODQ1OCwic2NvcGUiOiJvcGVuaWQgcHJvZmlsZSIsImlzcyI6Imh0dHBzOi8vYXBpc2l4LmF1dGhpbmcuY24vb2lkYyIsImF1ZCI6IjYxYzk4M2M0YjI4NzdkNDg2OWRkOGFjYiJ9.l2V8vDWcCObB1LjIhKs2ARG4J7WuB-0c-bnYZG2GP2zcpl6PMAPcId2B76CaXCU58ajGcfRmOlWJ67UaHrfWKv8IM4vcYN1gwhKdokSyrhEM31gQE-MzNEsEbPaVIGXdpR1N2JnAJK5-tKIjopDAXSwArfO6fQKTpjLhCi3COIA169WGRR4CKCwNzzpFAYP2ilNc18D_HRTBLS6UjxZSNUtWE5dbx7uBjblhwIwn5e1fxiEQcknVK8Dxf8NUliFECvr02HX2hNvmuCECkvA_mZYlshAeqidK8tSEXirAWsWS5jlXFqLiBJkhSHFrbxRyqeOSfJCJR_YcCwk9AzgZGg\\",\\n    \\"X-Id-Token\\": \\"eyJhdF9oYXNoIjoiRl8tRjZaUVgtWVRDNEh0TldmcHJmUSIsImJpcnRoZGF0ZSI6bnVsbCwiZmFtaWx5X25hbWUiOm51bGwsImdlbmRlciI6IlUiLCJnaXZlbl9uYW1lIjpudWxsLCJpc3MiOiJodHRwczpcL1wvYXBpc2l4LmF1dGhpbmcuY25cL29pZGMiLCJwaWN0dXJlIjoiaHR0cHM6XC9cL2ZpbGVzLmF1dGhpbmcuY29cL2F1dGhpbmctY29uc29sZVwvZGVmYXVsdC11c2VyLWF2YXRhci5wbmciLCJwcmVmZXJyZWRfdXNlcm5hbWUiOm51bGwsInVwZGF0ZWRfYXQiOiIyMDIxLTEyLTI3VDA5OjU0OjE3Ljc3M1oiLCJ3ZWJzaXRlIjpudWxsLCJ6b25laW5mbyI6bnVsbCwibmFtZSI6bnVsbCwiaWF0IjoxNjQwNTk4ODU4LCJuaWNrbmFtZSI6bnVsbCwibm9uY2UiOiJmMTlmZjhjODM5NzdmZjNlMDczMzZmMzg3Y2QxM2EzMSIsIm1pZGRsZV9uYW1lIjpudWxsLCJleHAiOjE2NDE4MDg0NTgsInN1YiI6IjYxYzk4YWY5ODQyMjhhZTQ5NjIwNTg1MiIsImxvY2FsZSI6bnVsbCwiYXVkIjoiNjFjOTgzYzRiMjg3N2Q0ODY5ZGQ4YWNiIiwicHJvZmlsZSI6bnVsbH0=\\",\\n    \\"X-Userinfo\\": \\"eyJ3ZWJzaXRlIjpudWxsLCJ6b25laW5mbyI6bnVsbCwibmFtZSI6bnVsbCwicHJvZmlsZSI6bnVsbCwibmlja25hbWUiOm51bGwsInN1YiI6IjYxYzk4YWY5ODQyMjhhZTQ5NjIwNTg1MiIsImxvY2FsZSI6bnVsbCwiYmlydGhkYXRlIjpudWxsLCJmYW1pbHlfbmFtZSI6bnVsbCwiZ2VuZGVyIjoiVSIsImdpdmVuX25hbWUiOm51bGwsIm1pZGRsZV9uYW1lIjpudWxsLCJwaWN0dXJlIjoiaHR0cHM6XC9cL2ZpbGVzLmF1dGhpbmcuY29cL2F1dGhpbmctY29uc29sZVwvZGVmYXVsdC11c2VyLWF2YXRhci5wbmciLCJwcmVmZXJyZWRfdXNlcm5hbWUiOm51bGwsInVwZGF0ZWRfYXQiOiIyMDIxLTEyLTI3VDA5OjU0OjE3Ljc3M1oifQ==\\"\\n    ...\\n    ```\\n\\n    \u5176\u4e2d\uff1a\\n\\n    **X-Access-Token**\uff1aApache APISIX \u5c06\u4ece\u7528\u6237\u63d0\u4f9b\u5546\u83b7\u53d6\u5230\u7684 access token \u653e\u5165 X-Access-Token \u8bf7\u6c42\u5934\uff0c\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 `access_token_in_authorization_header` \u6765\u9009\u62e9\u662f\u5426\u653e\u5165 Authorization \u8bf7\u6c42\u5934\u4e2d\u3002\\n\\n    ![X-Access-Token](https://static.apiseven.com/202108/1641278494765-139b6ffc-227b-4f02-8b2a-45d762422e15.png)\\n\\n    **X-Id-Token**\uff1aApache APISIX \u5c06\u4ece\u7528\u6237\u63d0\u4f9b\u5546\u83b7\u53d6\u5230\u7684 ID token \u901a\u8fc7 base64 \u7f16\u7801\u4e4b\u540e\u653e\u5165 X-Id-Token \u8bf7\u6c42\u5934\uff0c\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 `set_id_token_header` \u6765\u9009\u62e9\u662f\u5426\u5f00\u542f\u8be5\u529f\u80fd\uff0c\u9ed8\u8ba4\u4e3a\u4e3a\u5f00\u542f\u72b6\u6001\u3002\\n\\n    ![X-Id-Token](https://static.apiseven.com/202108/1641278494768-867dadf3-8ecd-4376-af03-d86b6a7aa698.png)\\n\\n    **X-Userinfo**\uff1a  Apache APISIX \u5c06\u4ece\u7528\u6237\u63d0\u4f9b\u5546\u83b7\u53d6\u5230\u7684\u7528\u6237\u4fe1\u606f\uff0c\u901a\u8fc7 base64 \u7f16\u7801\u4e4b\u540e\u653e\u5165 X-Userinfo\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 `set_userinfo_header` \u6765\u9009\u62e9\u662f\u5426\u5f00\u542f\u8be5\u529f\u80fd\uff0c\u9ed8\u8ba4\u4e3a\u5f00\u542f\u72b6\u6001\u3002\\n\\n    ![X-Userinfo](https://static.apiseven.com/202108/1641278494771-42567d0c-8424-46e2-9c5b-a12cf1af6bc8.png)\\n\\n    \u7531\u6b64\u53ef\u4ee5\u770b\u5230\uff0cApache APISIX \u5c06\u4f1a\u643a\u5e26 `X-Access-Token`\u3001`X-Id-Token` \u548c `X-Userinfo` \u4e09\u4e2a\u8bf7\u6c42\u5934\u4f20\u9012\u81f3\u4e0a\u6e38\u3002\u4e0a\u6e38\u53ef\u4ee5\u901a\u8fc7\u89e3\u6790\u8fd9\u51e0\u4e2a\u5934\u90e8\uff0c\u4ece\u800c\u83b7\u53d6\u5230\u7528\u6237 ID \u4fe1\u606f\u548c\u7528\u6237\u7684\u5143\u6570\u636e\u3002\\n\\n4. \u5728 Authing \u63a7\u5236\u53f0\u4e2d\u7684 \u300c\u5ba1\u8ba1\u65e5\u5fd7-\u7528\u6237\u884c\u4e3a\u65e5\u5fd7\u300d\u4e2d\u53ef\u4ee5\u89c2\u5bdf\u5230 user1 \u7684\u767b\u5f55\u4fe1\u606f\u3002\\n   ![\u767b\u5f55\u4fe1\u606f](https://static.apiseven.com/202108/1641276858261-00fb4d07-751e-42db-bbbf-e8550002466f.png)\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u63cf\u8ff0\u4e86 Apache APISIX \u548c Authing \u5bf9\u63a5\u7684\u8be6\u7ec6\u64cd\u4f5c\u6b65\u9aa4\uff0c\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u5927\u5bb6\u5bf9\u4e8e\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Authing \u6709\u4e86\u66f4\u6e05\u6670\u7684\u7406\u89e3\u3002\\n\\nApache APISIX \u4e0d\u4ec5\u81f4\u529b\u4e8e\u4fdd\u6301\u81ea\u8eab\u7684\u9ad8\u6027\u80fd\uff0c\u4e5f\u4e00\u76f4\u975e\u5e38\u91cd\u89c6\u5f00\u6e90\u751f\u6001\u7684\u5efa\u8bbe\u3002\u76ee\u524d Apache APISIX \u5df2\u7ecf\u62e5\u6709\u4e86 10+ \u4e2a\u8ba4\u8bc1\u6388\u6743\u76f8\u5173\u7684\u63d2\u4ef6\uff0c\u652f\u6301\u4e0e\u4e1a\u754c\u4e3b\u6d41\u7684\u8ba4\u8bc1\u6388\u6743\u670d\u52a1\u5bf9\u63a5\u3002\\n\\n\u5982\u679c\u4f60\u6709\u5bf9\u63a5\u5176\u4ed6\u8ba4\u8bc1\u6388\u6743\u7684\u9700\u6c42\uff0c\u4e0d\u59a8\u8bbf\u95ee Apache APISIX \u7684 [GitHub](https://github.com/apache/apisix/issues)\uff0c\u901a\u8fc7 issue \u7559\u4e0b\u4f60\u7684\u5efa\u8bae\uff1b\u6216\u8ba2\u9605 Apache APISIX \u7684[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\uff0c\u901a\u8fc7\u90ae\u4ef6\u8868\u8fbe\u4f60\u7684\u60f3\u6cd5\u3002"},{"id":"\u4f7f\u7528 Apache APISIX \u4ee3\u7406 gRPC \u670d\u52a1","metadata":{"permalink":"/zh/blog/2021/12/30/apisix-proxy-grpc-service","source":"@site/blog/2021/12/30/apisix-proxy-grpc-service.md","title":"\u4f7f\u7528 Apache APISIX \u4ee3\u7406 gRPC \u670d\u52a1","description":"\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u5728 Apache APISIX \u4e2d\u901a\u8fc7 `grpc-transcode`\u63d2\u4ef6\u6765\u5c06\u5ba2\u6237\u7aef\u7684 HTTP \u6d41\u91cf\u4ee3\u7406\u5230\u540e\u7aef gRPC \u670d\u52a1\u4e0a\u3002","date":"2021-12-30T00:00:00.000Z","formattedDate":"2021\u5e7412\u670830\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.235,"truncated":true,"authors":[{"name":"\u55bb\u67cf\u4ef2","title":"Author","url":"https://github.com/zaunist","image_url":"https://avatars.githubusercontent.com/u/38528079?v=4","imageURL":"https://avatars.githubusercontent.com/u/38528079?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"Apache APISIX \u7ed3\u5408 Authing \u5b9e\u73b0\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7ba1\u7406","permalink":"/zh/blog/2022/01/04/authing"},"nextItem":{"title":"Apache APISIX Dashboard \u672a\u6388\u6743\u8bbf\u95ee\u6f0f\u6d1e\u516c\u544a\uff08CVE-2021-45232)","permalink":"/zh/blog/2021/12/28/dashboard-cve-2021-45232"}},"content":"> \u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u5728 Apache APISIX \u4e2d\u901a\u8fc7 `grpc-transcode`\u63d2\u4ef6\u6765\u5c06\u5ba2\u6237\u7aef\u7684 HTTP \u6d41\u91cf\u4ee3\u7406\u5230\u540e\u7aef gRPC \u670d\u52a1\u4e0a\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u9879\u76ee\u4ecb\u7ecd\\n\\n### Apache APISIX\\n\\n[Apache APISIX](https://apisix.apache.org/) \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u4e0d\u4ec5\u652f\u6301\u63d2\u4ef6\u52a8\u6001\u53d8\u66f4\u548c\u70ed\u63d2\u62d4\uff0c\u800c\u4e14\u62e5\u6709\u4f17\u591a\u4e30\u5bcc\u7684\u63d2\u4ef6\u8d44\u6e90\u5e93\u3002\\n\\n### gRPC\\n\\n[gRPC](https://grpc.io/) \u662f Google \u53d1\u8d77\u7684\u4e00\u4e2a\u5f00\u6e90\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\uff08Remote procedure call\uff09\u7cfb\u7edf\u3002\u8be5\u7cfb\u7edf\u57fa\u4e8e HTTP/2 \u534f\u8bae\u4f20\u8f93\uff0c\u4f7f\u7528 Protocol Buffers \u4f5c\u4e3a\u63a5\u53e3\u63cf\u8ff0\u8bed\u8a00\uff0c\u53ef\u4ee5\u5728\u4efb\u4f55\u73af\u5883\u4e2d\u8fd0\u884c\u3002\u901a\u8fc7 gRPC \u670d\u52a1\u53ef\u5bf9\u8d1f\u8f7d\u5747\u8861\u3001\u94fe\u8def\u8ffd\u8e2a\u3001\u5065\u5eb7\u68c0\u67e5\u548c\u8eab\u4efd\u8ba4\u8bc1\u7b49\u529f\u80fd\u8fdb\u884c\u53ef\u63d2\u62d4\u6a21\u5f0f\u652f\u6301\uff0c\u6709\u6548\u5730\u8fde\u63a5\u6570\u636e\u4e2d\u5fc3\u4e4b\u95f4\u7684\u591a\u9879\u670d\u52a1\u3002\\n\\n## \u63d2\u4ef6\u4ecb\u7ecd\\n\\n\u4e3a\u4e86\u589e\u52a0\u5bf9 gRPC \u670d\u52a1\u4ee3\u7406\u7684\u652f\u6301\uff0cApache APISIX \u53d1\u5e03\u4e86\u57fa\u4e8e gRPC \u7684\u63d2\u4ef6 `grpc-transcode`\uff0c\u901a\u8fc7 RESTful \u65b9\u5f0f\u8c03\u7528 gRPC \u670d\u52a1\u3002\\n\\n\u8be5\u63d2\u4ef6\u652f\u6301\u5728 Apache APISIX \u4e2d\u6307\u5b9a `.proto` \u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u5e76\u901a\u8fc7\u7528\u6237\u81ea\u5b9a\u4e49 gRPC \u670d\u52a1\u6765\u5b9e\u73b0\u4e0d\u540c gRPC \u670d\u52a1\u7684\u4ee3\u7406\u3002\\n\\n### \u96c6\u6210\u539f\u7406\\n\\n\u7528\u6237\u5728 Apache APISIX \u4e2d\u6307\u5b9a `.proto` \u5185\u5bb9\uff0c\u901a\u8fc7\u5728 `grpc-transcode` \u63d2\u4ef6\u4e2d\u7684 `proto_id` \u7ed1\u5b9a\u76f8\u5e94\u7684 proto\uff0c\u5e76\u914d\u7f6e `.proto` \u4e2d\u5b9a\u4e49\u7684 Service \u548c Method\uff0c\u5373\u53ef\u5b9e\u73b0 gRPC \u670d\u52a1\u7684\u4ee3\u7406\u3002\\n\\n\u57fa\u672c\u539f\u7406\u5982\u4e0b\uff1a\u7528\u6237\u53ef\u4ee5\u5728\u8def\u7531\u4e2d\u914d\u7f6e\u4e00\u4e2a `grpc-transcode` \u63d2\u4ef6\uff0c\u5f53\u8def\u7531\u5339\u914d\u5230\u8bf7\u6c42\u65f6\uff0c\u4f1a\u8f6c\u53d1 gRPC \u8bf7\u6c42\u5230\u4e0a\u6e38\u7684\u670d\u52a1\u4e2d\u3002\\n\\n:::note\\n`grpc-transcode` \u63d2\u4ef6\u652f\u6301\u5bf9 `proto_id`\u3001`grpc service name`\u3001`grpc service method`\u3001`grpc deadline` \u4ee5\u53ca `pb_option` \u8fdb\u884c\u914d\u7f6e\u3002\u57fa\u4e8e\u914d\u7f6e\u8c03\u7528\u4e0a\u6e38\u7684 gRPC \u670d\u52a1\uff0c\u5e76\u5c06\u4ece\u4e0a\u6e38 gRPC \u670d\u52a1\u4e2d\u83b7\u53d6\u5230\u7684\u54cd\u5e94\u5185\u5bb9\u8fd4\u56de\u81f3\u5ba2\u6237\u7aef\u3002\\n:::\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u73af\u5883\u51c6\u5907\\n\\n\u5728\u914d\u7f6e Apache APISIX \u4e4b\u524d\uff0c\u9700\u8981\u5148\u542f\u52a8 gRPC \u670d\u52a1\u3002\\n\\n#### \u6b65\u9aa4\u4e00\uff1a\u914d\u7f6e grpc-server-example \u670d\u52a1\\n\\n1. \u514b\u9686 `grpc-server-example` \u4ed3\u5e93\u3002\\n\\n```shell\\ngit clone https://github.com/api7/grpc_server_example\\n```\\n\\n2. \u542f\u52a8 grpc-server\u3002\\n\\n```shell\\ncd grpc_server_example\\ngo run main.go\\n```\\n\\n3. \u9a8c\u8bc1 gRPC \u670d\u52a1\uff0c\u63a8\u8350\u4f7f\u7528 `grpcurl` \u6765\u9a8c\u8bc1\u670d\u52a1\u7684\u53ef\u7528\u6027\u3002\\n\\n```shell\\ngrpcurl -d \'{\\"name\\": \\"zhangsan\\"}\' -plaintext 127.0.0.1:50051 helloworld.Greeter.SayHello\\n```\\n\\n\u6b63\u786e\u542f\u52a8 gRPC \u670d\u52a1\u540e\uff0c\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u5c06\u4f1a\u8f93\u51fa\u4ee5\u4e0b\u5185\u5bb9\u3002\\n\\n```json\\n{\\n \\"message\\": \\"Hello zhangsan\\"\\n}\\n```\\n\\n#### \u6b65\u9aa4\u4e8c\uff1a\u914d\u7f6e Apache APISIX\\n\\n1. \u6dfb\u52a0 proto\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/proto/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"content\\" : \\"syntax = \\\\\\"proto3\\\\\\";\\n    package helloworld;\\n    service Greeter {\\n        rpc SayHello (HelloRequest) returns (HelloReply) {}\\n    }\\n    message HelloRequest {\\n        string name = 1;\\n    }\\n    message HelloReply {\\n        string message = 1;\\n    }\\"\\n}\'\\n```\\n\\n2. \u5728\u6307\u5b9a Route \u4e2d\uff0c\u4ee3\u7406 gRPC \u670d\u52a1\u63a5\u53e3\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/grpctest\\",\\n    \\"plugins\\": {\\n        \\"grpc-transcode\\": {\\n         \\"proto_id\\": \\"1\\",\\n         \\"service\\": \\"helloworld.Greeter\\",\\n         \\"method\\": \\"SayHello\\"\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"scheme\\": \\"grpc\\",\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:50051\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u5177\u4f53\u4ee3\u7801\u91ca\u4e49\u4e0e\u652f\u6301\u7684\u53c2\u6570\u8be6\u60c5\u53ef\u53c2\u8003\u4e0b\u65b9\uff1a\\n\\n| \u540d\u79f0      | \u7c7b\u578b                         | \u5b58\u5728 | \u9ed8\u8ba4\u503c | \u63cf\u8ff0                       |\\n|:-----------|:------------------------------|:------|:-------|:---------------------------|\\n| proto_id  | string/integer               | \u5fc5\u987b | N/A   | `.proto` \u5185\u5bb9\u7684 id         |\\n| service   | string                       | \u5fc5\u987b | N/A   | gRPC \u670d\u52a1\u540d                |\\n| method    | string                       | \u5fc5\u987b | N/A   | gRPC \u670d\u52a1\u4e2d\u8981\u8c03\u7528\u7684\u65b9\u6cd5\u540d  |\\n| deadline  | number                       | \u53ef\u9009 | 0     | gRPC \u670d\u52a1\u622a\u6b62\u65f6\u95f4        |\\n| pb_option | array[string(pb_option_def)] | \u53ef\u9009 | N/A   | proto \u7f16\u7801\u8fc7\u7a0b\u4e2d\u7684\u8f6c\u6362\u9009\u9879 |\\n\\n### \u6d4b\u8bd5\u8bf7\u6c42\\n\\n\u4e0b\u9762\u6211\u4eec\u5c06\u4f7f\u7528 cURL \u8fdb\u884c\u6d4b\u8bd5\u3002\\n\\n```shell\\ncurl -i http://127.0.0.1:9080/grpctest\\\\?name=world\\nHTTP/1.1 200 OK\\nDate: Mon, 27 Dec 2021 06:24:47 GMT\\nContent-Type: application/json\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\nServer: APISIX/2.11.0\\nTrailer: grpc-status\\nTrailer: grpc-message\\n\\n{\\"message\\":\\"Hello world\\"}\\ngrpc-status: 0\\ngrpc-message:\\n```\\n\\n\u901a\u8fc7\u4ee3\u7801\u53cd\u9988\u53ef\u77e5\uff0c\u5df2\u6210\u529f\u5c06\u8bf7\u6c42\u4ee3\u7406\u5230\u540e\u7aef gRPC \u670d\u52a1\u4e0a\u3002\\n\\n### \u5173\u95ed\u63d2\u4ef6\\n\\n\u5982\u4f7f\u7528\u5b8c\u6bd5\uff0c\u53ea\u9700\u8981\u79fb\u9664\u8def\u7531\u914d\u7f6e\u91cc `plugin` \u76f8\u5173\u7684\u914d\u7f6e\uff0c\u5373\u53ef\u5173\u95ed\u8def\u7531\u4e0a\u7684 `grpc-transcode` \u63d2\u4ef6\u3002\u5f97\u76ca\u4e8e Apache APISIX \u63d2\u4ef6\u70ed\u52a0\u8f7d\u6a21\u5f0f\uff0c\u5f00\u542f\u548c\u5173\u95ed\u90fd\u65e0\u9700\u91cd\u542f Apache APISIX\u3002\\n\\n```shell\\n# \u5173\u95ed\u63d2\u4ef6\\ncurl http://127.0.0.1:9080/apisix/admin/routes/111 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/grpctest\\",\\n    \\"plugins\\": {},\\n    \\"upstream\\": {\\n        \\"scheme\\": \\"grpc\\",\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:50051\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5173\u4e8e `grpc-transcode` \u63d2\u4ef6\u7684\u4f7f\u7528\u6b65\u9aa4\uff0c\u901a\u8fc7 RESTful \u5c06\u8bf7\u6c42\u4ee3\u7406\u5230\u540e\u7aef gRPC \u670d\u52a1\u4e0a\u3002\u901a\u8fc7\u4f7f\u7528\u8be5\u63d2\u4ef6\uff0cApache APISIX \u4ec5\u9700\u901a\u8fc7\u914d\u7f6e\u5373\u53ef\u5b9e\u73b0\u5bf9 gRPC \u670d\u52a1\u7684\u4ee3\u7406\u3002\\n\\n\u66f4\u591a\u5173\u4e8e `grpc-transcode` \u63d2\u4ef6\u7684\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u5217\u8868\uff0c\u8bf7\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/next/plugins/grpc-transcode/)\u3002"},{"id":"Apache APISIX Dashboard \u672a\u6388\u6743\u8bbf\u95ee\u6f0f\u6d1e\u516c\u544a\uff08CVE-2021-45232)","metadata":{"permalink":"/zh/blog/2021/12/28/dashboard-cve-2021-45232","source":"@site/blog/2021/12/28/dashboard-cve-2021-45232.md","title":"Apache APISIX Dashboard \u672a\u6388\u6743\u8bbf\u95ee\u6f0f\u6d1e\u516c\u544a\uff08CVE-2021-45232)","description":"\u5728 Apache APISIX Dashboard 2.7-2.10 \u7248\u672c\u4e2d\u51fa\u73b0\u4e86\u672a\u7ecf\u6388\u6743\u8bbf\u95ee\u7684\u5b89\u5168\u6f0f\u6d1e\uff0c\u73b0\u5c06\u5904\u7406\u4fe1\u606f\u8fdb\u884c\u76f8\u5173\u516c\u544a\u3002","date":"2021-12-28T00:00:00.000Z","formattedDate":"2021\u5e7412\u670828\u65e5","tags":[{"label":"Vulnerabilities","permalink":"/zh/blog/tags/vulnerabilities"}],"readingTime":1.225,"truncated":true,"authors":[{"name":"\u6731\u79b9\u6210","url":"https://github.com/f11t3rStAr","imageURL":"https://avatars.githubusercontent.com/u/71011664?v=4"}],"prevItem":{"title":"\u4f7f\u7528 Apache APISIX \u4ee3\u7406 gRPC \u670d\u52a1","permalink":"/zh/blog/2021/12/30/apisix-proxy-grpc-service"},"nextItem":{"title":"API \u7f51\u5173 APISIX \u96c6\u6210 OpenWhisk \u4e30\u5bcc\u8ba4\u8bc1\u573a\u666f","permalink":"/zh/blog/2021/12/24/apisix-integrate-openwhisk-plugin"}},"content":"> \u5728 Apache APISIX Dashboard 2.7-2.10 \u7248\u672c\u4e2d\u51fa\u73b0\u4e86\u672a\u7ecf\u6388\u6743\u8bbf\u95ee\u7684\u5b89\u5168\u6f0f\u6d1e\uff0c\u73b0\u5c06\u5904\u7406\u4fe1\u606f\u8fdb\u884c\u76f8\u5173\u516c\u544a\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u95ee\u9898\u63cf\u8ff0\\n\\n\u653b\u51fb\u8005\u65e0\u9700\u767b\u5f55 Apache APISIX Dashboard \u5373\u53ef\u8bbf\u95ee\u67d0\u4e9b\u63a5\u53e3\uff0c\u4ece\u800c\u8fdb\u884c\u672a\u6388\u6743\u66f4\u6539\u6216\u83b7\u53d6 Apache APISIX Route\u3001Upstream\u3001Service \u7b49\u76f8\u5173\u914d\u7f6e\u4fe1\u606f\uff0c\u5e76\u9020\u6210 SSRF\u3001\u653b\u51fb\u8005\u642d\u5efa\u6076\u610f\u6d41\u91cf\u4ee3\u7406\u548c\u4efb\u610f\u4ee3\u7801\u6267\u884c\u7b49\u95ee\u9898\u3002\\n\\n## \u5f71\u54cd\u7248\u672c\\n\\nApache APISIX Dashboard 2.7 - 2.10 \u7248\u672c\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u8bf7\u53ca\u65f6\u66f4\u65b0\u81f3 Apache APISIX Dashboard 2.10.1 \u53ca\u4ee5\u4e0a\u7248\u672c\u3002\\n\\n## \u5b89\u5168\u5efa\u8bae\\n\\n\u5efa\u8bae\u7528\u6237\u53ca\u65f6\u66f4\u6539\u9ed8\u8ba4\u7528\u6237\u540d\u4e0e\u5bc6\u7801\uff0c\u5e76\u9650\u5236\u6765\u6e90 IP \u8bbf\u95ee Apache APISIX Dashboard\u3002\\n\\n## \u6f0f\u6d1e\u8be6\u60c5\\n\\n\u6f0f\u6d1e\u516c\u5f00\u65f6\u95f4\uff1a2021 \u5e74 12 \u6708 27 \u65e5\\n\\nCVE \u8be6\u7ec6\u4fe1\u606f\uff1ahttps://nvd.nist.gov/vuln/detail/CVE-2021-45232\\n\\n## \u8d21\u732e\u8005\u7b80\u4ecb\\n\\n\u8be5\u6f0f\u6d1e\u7531\u6e90\u5821\u79d1\u6280\u5b89\u5168\u56e2\u961f\u7684\u6731\u79b9\u6210\u53d1\u73b0\uff0c\u5e76\u5411 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0a\u62a5\u8be5\u6f0f\u6d1e\u3002\u611f\u8c22\u5404\u4f4d\u5bf9 Apache APISIX \u793e\u533a\u7684\u8d21\u732e\u3002\\n\\n![\u6e90\u5821\u79d1\u6280](https://static.apiseven.com/202108/1640324848257-4978eaac-bfd7-4265-82d2-9c024956b933.png)"},{"id":"API \u7f51\u5173 APISIX \u96c6\u6210 OpenWhisk \u4e30\u5bcc\u8ba4\u8bc1\u573a\u666f","metadata":{"permalink":"/zh/blog/2021/12/24/apisix-integrate-openwhisk-plugin","source":"@site/blog/2021/12/24/apisix-integrate-openwhisk-plugin.md","title":"API \u7f51\u5173 APISIX \u96c6\u6210 OpenWhisk \u4e30\u5bcc\u8ba4\u8bc1\u573a\u666f","description":"\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5173\u4e8e `openwhisk` \u63d2\u4ef6\u7684\u529f\u80fd\u524d\u77bb\u4e0e\u4f7f\u7528\u6b65\u9aa4\uff0c\u7ed3\u5408 API \u7f51\u5173 Apache APISIX \u63d0\u4f9b\u7684\u591a\u79cd\u8eab\u4efd\u8ba4\u8bc1\u63d2\u4ef6\u6765\u5b9e\u73b0\u8ba4\u8bc1\u4e0e\u6388\u6743\u7b49\u529f\u80fd\u3002","date":"2021-12-24T00:00:00.000Z","formattedDate":"2021\u5e7412\u670824\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.715,"truncated":true,"authors":[{"name":"\u767d\u6cfd\u5e73","title":"Author","url":"https://github.com/bzp2010","image_url":"https://avatars.githubusercontent.com/u/8078418?v=4","imageURL":"https://avatars.githubusercontent.com/u/8078418?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"Apache APISIX Dashboard \u672a\u6388\u6743\u8bbf\u95ee\u6f0f\u6d1e\u516c\u544a\uff08CVE-2021-45232)","permalink":"/zh/blog/2021/12/28/dashboard-cve-2021-45232"},"nextItem":{"title":"Apache APISIX \u96c6\u6210 Open Policy Agent","permalink":"/zh/blog/2021/12/24/open-policy-agent"}},"content":"> \u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5173\u4e8e `openwhisk` \u63d2\u4ef6\u7684\u529f\u80fd\u524d\u77bb\u4e0e\u4f7f\u7528\u6b65\u9aa4\uff0c\u7ed3\u5408 Apache APISIX \u63d0\u4f9b\u7684\u591a\u79cd\u8eab\u4efd\u8ba4\u8bc1\u63d2\u4ef6\u6765\u5b9e\u73b0\u8ba4\u8bc1\u4e0e\u6388\u6743\u7b49\u529f\u80fd\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u672c\u6587\u5c06\u4ecb\u7ecd Apache APISIX \u4e2d\u65b0\u589e\u63d2\u4ef6\u2014\u2014`openwhisk`\uff0c\u5e76\u901a\u8fc7\u8be6\u7ec6\u6b65\u9aa4\u5411\u5927\u5bb6\u5c55\u793a\u5982\u4f55\u5c06 OpenWhisk \u670d\u52a1\u4e0e Apache APISIX \u8fdb\u884c\u96c6\u6210\uff0c\u6765\u4eab\u53d7\u65e0\u670d\u52a1\u5668\u8ba1\u7b97\u7684\u4f18\u52bf\u3002\u6b64\u63d2\u4ef6\u9884\u8ba1\u5728 Apache APISIX 2.12 \u7248\u672c\u4e2d\u6b63\u5f0f\u4e0a\u7ebf\uff0c\u656c\u8bf7\u671f\u5f85\uff01\\n\\n![APISIX&OpenWhisk](https://static.apiseven.com/202108/1640313816872-b2c018be-5433-4baf-ba6a-8330e160866a.png)\\n\\n## \u9879\u76ee\u4ecb\u7ecd\\n\\n### Apache APISIX\\n\\n[Apache APISIX](https://apisix.apache.org/) \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u4e0d\u4ec5\u652f\u6301\u63d2\u4ef6\u52a8\u6001\u53d8\u66f4\u548c\u70ed\u63d2\u62d4\uff0c\u800c\u4e14\u62e5\u6709\u4f17\u591a\u5b9e\u7528\u7684\u63d2\u4ef6\u3002\\n\\n### Apache OpenWhisk\\n\\n[Apache OpenWhisk](https://openwhisk.apache.org/) \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u65e0\u670d\u52a1\u5668\u5e73\u53f0\uff0c\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u51fd\u6570\u54cd\u5e94\u4efb\u4f55\u89c4\u6a21\u7684\u65f6\u95f4\u3002\u5b83\u4f7f\u7528 Docker \u5bb9\u5668\u7ba1\u7406\u57fa\u7840\u8bbe\u65bd\u3001\u670d\u52a1\u5668\u548c\u89c4\u6a21\u6269\u5c55\uff0c\u52a9\u529b\u7528\u6237\u6784\u5efa\u51fa\u8272\u4e14\u9ad8\u6548\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\\n\\n\u5728 OpenWhisk \u4e2d\u5f00\u53d1\u8005\u53ef\u4ee5\u4f7f\u7528\u591a\u79cd\u7f16\u7a0b\u8bed\u8a00\u6765\u7f16\u5199\u51fd\u6570\uff08\u79f0\u4e3a Action\uff09\uff0c\u8fd9\u4e9b\u51fd\u6570\u5c06\u7531 OpenWhisk \u8d1f\u8d23\u52a8\u6001\u8c03\u5ea6\u5e76\u5904\u7406\u6765\u81ea\u4e8b\u4ef6\uff08\u901a\u8fc7 trigger\uff09\u6216\u5916\u90e8\u8bf7\u6c42\uff08\u901a\u8fc7 HTTP \u8bf7\u6c42\uff09\u7684\u54cd\u5e94\u3002\\n\\n## \u96c6\u6210\u539f\u7406\\n\\nApache APISIX \u4e3a\u4fbf\u6377\u96c6\u6210 Apache OpenWhisk \u63d0\u4f9b\u4e86\u63d2\u4ef6\u652f\u6301\uff0c\u7528\u6237\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u5305\u542b\u65e0\u670d\u52a1\u5668\u63d2\u4ef6\u7684\u8def\u7531\uff0c\u5e76\u7ed3\u5408 Apache APISIX \u63d0\u4f9b\u7684\u591a\u79cd\u8eab\u4efd\u8ba4\u8bc1\u63d2\u4ef6\u6765\u5b9e\u73b0\u8ba4\u8bc1\u4e0e\u6388\u6743\u529f\u80fd\u3002\\n\\n\u5927\u4f53\u64cd\u4f5c\u539f\u7406\u5982\u4e0b\uff1a\u7528\u6237\u53ef\u4ee5\u4f7f\u7528openwhisk\u63d2\u4ef6\u5728\u8def\u7531\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u201c\u52a8\u6001\u4e0a\u6e38\u201d\uff0c\u5f53\u8def\u7531\u5339\u914d\u5230\u8bf7\u6c42\u65f6\uff0c\u5b83\u5c06\u4e2d\u6b62\u5230\u539f\u4e0a\u6e38\u7684\u8bf7\u6c42\uff0c\u5e76\u5411 OpenWhisk \u7684 API Host \u7aef\u70b9\u53d1\u9001\u8bf7\u6c42\u3002\\n\\n> \u8bf7\u6c42\u4e2d\u5c06\u5305\u542b\u7528\u6237\u4e3a\u63d2\u4ef6\u914d\u7f6e\u7684 Namespace\u3001Action\u3001Service Token \u4ee5\u53ca\u539f\u59cb HTTP \u8bf7\u6c42\u4f53\u6570\u636e\uff0c\u5e76\u5c06\u4ece OpenWhisk \u4e2d\u83b7\u53d6\u5230\u7684\u54cd\u5e94\u5185\u5bb9\u8fd4\u56de\u81f3\u5ba2\u6237\u7aef\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u642d\u5efa Apache OpenWhisk \u6d4b\u8bd5\u73af\u5883\\n\\n1. \u9996\u5148\uff0c\u60a8\u9700\u8981\u786e\u4fdd\u4f7f\u7528 Linux \u7cfb\u7edf\uff0c\u5e76\u4e14\u7cfb\u7edf\u4e2d\u5df2\u7ecf\u5b89\u88c5\u4e86 Docker \u8f6f\u4ef6\u3002\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\\n\\n```shell\\ndocker run --rm -d \\\\\\n  -h openwhisk --name openwhisk \\\\\\n  -p 3233:3233 -p 3232:3232 \\\\\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\\\\n  openwhisk/standalone:nightly\\n\\ndocker exec openwhisk waitready\\n```\\n\\n2. \u7b49\u5f85\u547d\u4ee4\u6267\u884c\u5b8c\u6210\u540e\uff0c\u5c06\u8f93\u51fa\u4ee5\u4e0b\u5185\u5bb9\uff1a\\n\\n```\\nok: whisk auth set. Run \'wsk property get --auth\' to see the new value.\\nok: whisk API host set to http://openwhisk:3233\\nok: updated action testme\\nserver initializing...\\nserver initializing...\\n    \\"ready\\": true\\nok: deleted action testme\\n```\\n\\n3. \u521b\u5efa\u4ee5\u4e0b\u6587\u4ef6 `test.js` \u7528\u4f5c\u6d4b\u8bd5\u51fd\u6570\u3002\\n\\n```java\\nfunction main(args) {\\n    return {\\n        \\"hello\\": args.name || \\"\\",\\n    };\\n}\\n```\\n\\n4. \u5728 OpenWhisk \u4e2d\u6ce8\u518c\u4ee5\u4e0a\u51fd\u6570\u3002\\n\\n```shell\\n# \u4e3a OpenWhisk CLI \u5de5\u5177\u8bbe\u7f6e API Host \u548c\u9274\u6743\u4fe1\u606f\uff0c\u60a8\u53ef\u4ee5\u4ece\u8fd9\u91cc https://s.apache.org/openwhisk-cli-download \u4e0b\u8f7d\u5b83\\nwsk property set \\\\\\n  --apihost \'http://localhost:3233\' \\\\\\n  --auth \'23bc46b1-71f6-4ed5-8c54-816aa4f8c502:123zO3xZCLrMN6v2BKK1dXYFpXlPkccOFqm12CdAsMgRU4VrNZ9lyGVCGuMDGIwP\'\\n\\n# \u521b\u5efa\u6d4b\u8bd5\u51fd\u6570\\nwsk action create test test.js\\n```\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u521b\u5efa\u8def\u7531\u5e76\u5f00\u542f `openwhisk` \u63d2\u4ef6\\n\\n\u4e0b\u9762\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff0c\u5e76\u4e3a\u5176\u6dfb\u52a0 `openwhisk` \u63d2\u4ef6\u3002\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"openwhisk\\": {\\n            \\"api_host\\": \\"http://localhost:3233\\",\\n            \\"service_token\\": \\"23bc46b1-71f6-4ed5-8c54-816aa4f8c502:123zO3xZCLrMN6v2BKK1dXYFpXlPkccOFqm12CdAsMgRU4VrNZ9lyGVCGuMDGIwP\\",\\n            \\"namespace\\": \\"guest\\",\\n            \\"action\\": \\"test\\"\\n        }\\n    },\\n    \\"uri\\": \\"/openwhisk\\"\\n}\'\\n```\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u6d4b\u8bd5\u8bf7\u6c42\\n\\n\u4e0b\u9762\u6211\u4eec\u5c06\u4f7f\u7528 cURL \u8fdb\u884c\u6d4b\u8bd5\u3002\\n\\n```shell\\n# \u4f7f\u7528 POST \u8bf7\u6c42\u5e76\u53d1\u9001\u6570\u636e\\ncurl http://127.0.0.1:9080/openwhisk -i -X POST -d \'{\\n    \\"name\\": \\"world\\"\\n}\'\\n\\nHTTP/1.1 200 OK\\nContent-Type: application/json\\nContent-Length: 17\\nServer: APISIX/2.10.2\\n\\n{\\"hello\\":\\"world\\"}\\n\\n# \u4f7f\u7528 GET \u8bf7\u6c42\\ncurl http://127.0.0.1:9080/openwhisk -i\\n\\nHTTP/1.1 200 OK\\nContent-Type: application/json\\nContent-Length: 12\\nServer: APISIX/2.10.2\\n\\n{\\"hello\\":\\"\\"}\\n```\\n\\n### \u6b65\u9aa4\u56db\uff1a\u6d4b\u8bd5\u590d\u6742\u54cd\u5e94\\n\\n1. \u521b\u5efa\u5e76\u66f4\u65b0 `test.js` \u6d4b\u8bd5\u51fd\u6570\\n\\n```java\\nfunction main(args) {\\n    return {\\n        \\"status\\": \\"403\\",\\n        \\"headers\\": {\\n            \\"test\\": \\"header\\"\\n        },\\n        \\"body\\": \\"A test body\\"\\n    };\\n}\\n\\n2. \u8fdb\u884c\u6d4b\u8bd5\u8bf7\u6c42\\n\\n```shell\\n# \u4f7f\u7528 GET \u8bf7\u6c42\\ncurl http://127.0.0.1:9080/openwhisk -i\\n\\nHTTP/1.1 403 FORBIDDEN\\nContent-Type: application/json\\nContent-Length: 12\\ntest: header\\nServer: APISIX/2.10.2\\n\\nA test body\\n```\\n\\n### \u8865\u5145\uff1a\u5173\u95ed\u63d2\u4ef6\\n\\n\u5982\u4f7f\u7528\u5b8c\u6bd5\uff0c\u53ea\u9700\u79fb\u9664\u8def\u7531\u914d\u7f6e\u4e2d OpenWhisk \u76f8\u5173\u914d\u7f6e\u5e76\u4fdd\u5b58\uff0c\u5373\u53ef\u5173\u95ed\u8def\u7531\u4e0a\u7684 OpenWhisk \u63d2\u4ef6\u3002\u6b64\u65f6\u60a8\u53ef\u4ee5\u5f00\u542f\u5176\u4ed6 Serverless \u7c7b\u63d2\u4ef6\u6216\u6dfb\u52a0\u4e0a\u6e38\u7b49\u540e\u7eed\u64cd\u4f5c\u3002\\n\\n\u5f97\u76ca\u4e8e Apache APISIX \u7684\u52a8\u6001\u5316\u4f18\u52bf\uff0c\u5f00\u542f\u5173\u95ed\u63d2\u4ef6\u7684\u8fc7\u7a0b\u90fd\u4e0d\u9700\u8981\u91cd\u542f Apache APISIX\uff0c\u5341\u5206\u65b9\u4fbf\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u5173\u4e8e `openwhisk` \u63d2\u4ef6\u7684\u529f\u80fd\u524d\u77bb\u4e0e\u4f7f\u7528\u6b65\u9aa4\uff0c\u66f4\u591a\u5173\u4e8e `openwhisk` \u63d2\u4ef6\u8bf4\u660e\u548c\u5b8c\u6574\u914d\u7f6e\u5217\u8868\uff0c\u53ef\u4ee5\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/next/plugins/openwhisk)\u3002\\n\\n\u76ee\u524d\uff0c\u6211\u4eec\u4e5f\u5728\u5f00\u53d1\u5176\u4ed6 Serverless \u63d2\u4ef6\u4ee5\u4fbf\u4e0e\u66f4\u591a\u4e91\u670d\u52a1\u8fdb\u884c\u96c6\u6210\u3002\u5982\u679c\u60a8\u5bf9\u6b64\u7c7b\u96c6\u6210\u9879\u76ee\u611f\u5174\u8da3\uff0c\u4e5f\u6b22\u8fce\u968f\u65f6\u5728 [GitHub Discussions](https://github.com/apache/apisix/discussions) \u4e2d\u53d1\u8d77\u8ba8\u8bba\uff0c\u6216\u901a\u8fc7[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8fdb\u884c\u4ea4\u6d41\u3002"},{"id":"Apache APISIX \u96c6\u6210 Open Policy Agent","metadata":{"permalink":"/zh/blog/2021/12/24/open-policy-agent","source":"@site/blog/2021/12/24/open-policy-agent.md","title":"Apache APISIX \u96c6\u6210 Open Policy Agent","description":"\u672c\u6587\u4ee5 HTTP API \u4e3a\u4f8b\u4e3a\u5927\u5bb6\u4ecb\u7ecd `opa` \u63d2\u4ef6\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u5c06 API \u7f51\u5173 Apache APISIX \u4e0e OPA \u8fdb\u884c\u96c6\u6210\uff0c\u5b9e\u73b0\u540e\u7aef\u670d\u52a1\u7684\u8ba4\u8bc1\u6388\u6743\u89e3\u8026\u3002","date":"2021-12-24T00:00:00.000Z","formattedDate":"2021\u5e7412\u670824\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Authentication","permalink":"/zh/blog/tags/authentication"}],"readingTime":6.035,"truncated":true,"authors":[{"name":"\u767d\u6cfd\u5e73","title":"Author","url":"https://github.com/bzp2010","image_url":"https://avatars.githubusercontent.com/u/8078418?v=4","imageURL":"https://avatars.githubusercontent.com/u/8078418?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://avatars.githubusercontent.com/u/36651058?v=4","imageURL":"https://avatars.githubusercontent.com/u/36651058?v=4"}],"prevItem":{"title":"API \u7f51\u5173 APISIX \u96c6\u6210 OpenWhisk \u4e30\u5bcc\u8ba4\u8bc1\u573a\u666f","permalink":"/zh/blog/2021/12/24/apisix-integrate-openwhisk-plugin"},"nextItem":{"title":"API \u7f51\u5173\u73b0\u5df2\u652f\u6301\u5bf9\u63a5 Google Cloud Logging","permalink":"/zh/blog/2021/12/22/google-logging"}},"content":"> \u672c\u6587\u4ee5 HTTP API \u4e3a\u4f8b\u4e3a\u5927\u5bb6\u4ecb\u7ecd `opa` \u63d2\u4ef6\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u5c06 Apache APISIX \u4e0e OPA \u8fdb\u884c\u96c6\u6210\uff0c\u5b9e\u73b0\u540e\u7aef\u670d\u52a1\u7684\u8ba4\u8bc1\u6388\u6743\u89e3\u8026\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n![APISIX-OPA cover](https://static.apiseven.com/202108/1640333490845-38542a3e-5d3a-4960-b11f-69ce3a61f7fc.png)\\n\\nOpen Policy Agent\uff08OPA\uff09\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u8f7b\u91cf\u7ea7\u901a\u7528\u7b56\u7565\u5f15\u64ce\uff0c\u53ef\u4ee5\u4ee3\u66ff\u8f6f\u4ef6\u4e2d\u5185\u7f6e\u7684\u7b56\u7565\u529f\u80fd\u6a21\u5757\uff0c\u5e2e\u52a9\u7528\u6237\u5b9e\u73b0\u670d\u52a1\u4e0e\u7b56\u7565\u5f15\u64ce\u7684\u89e3\u8026\u3002\u5f97\u76ca\u4e8e [OPA \u5b8c\u5584\u7684\u751f\u6001\u7cfb\u7edf](https://www.openpolicyagent.org/docs/latest/ecosystem/)\uff0c\u7528\u6237\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u96c6\u6210 OPA \u548c\u5176\u4ed6\u670d\u52a1\uff0c\u4f8b\u5982\u7a0b\u5e8f\u5e93\u3001HTTP API \u7b49\u3002\\n\\n\u5982\u4e0b\u56fe\u6240\u793a\uff0cOPA \u9996\u5148\u901a\u8fc7\u7b56\u7565\u8bed\u8a00 Rego \u63cf\u8ff0\u7b56\u7565\uff1b\u7136\u540e\u901a\u8fc7 JSON \u5b58\u50a8\u7b56\u7565\u6570\u636e\uff0c\u4e4b\u540e\u7528\u6237\u5c31\u53ef\u4ee5\u53d1\u9001\u67e5\u8be2\u8bf7\u6c42\u3002\u6536\u5230\u67e5\u8be2\u8bf7\u6c42\u540e\uff0cOPA \u5c06\u7ed3\u5408\u7b56\u7565\u3001\u6570\u636e\u548c\u7528\u6237\u8f93\u5165\u7684\u67e5\u8be2\u8bf7\u6c42\u5185\u5bb9\u751f\u6210\u7b56\u7565\u51b3\u7b56\uff0c\u5e76\u5c06\u51b3\u7b56\u53d1\u9001\u81f3\u670d\u52a1\u3002\\n\\n![OPA Workflow](https://static.apiseven.com/202108/1640332208554-40f574e3-0582-48f3-8e07-eb49fbd37ac7.png)\\n\\n## \u63d2\u4ef6\u4ecb\u7ecd\\n\\nApache APISIX \u63d0\u4f9b\u4e86\u4e00\u4e2a `opa` \u63d2\u4ef6\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u63d2\u4ef6\uff0c\u4fbf\u6377\u5730\u5c06 OPA \u63d0\u4f9b\u7684\u7b56\u7565\u80fd\u529b\u5f15\u5165\u5230 Apache APISIX\uff0c\u5b9e\u73b0\u7075\u6d3b\u7684\u8eab\u4efd\u8ba4\u8bc1\u4e0e\u51c6\u5165\u63a7\u5236\u529f\u80fd\u3002\\n\\n\u5c06 `opa` \u63d2\u4ef6\u914d\u7f6e\u5728\u8def\u7531\u4e0a\u540e\uff0cApache APISIX \u4f1a\u5728\u5904\u7406\u54cd\u5e94\u8bf7\u6c42\u65f6\uff0c\u5c06\u8bf7\u6c42\u4fe1\u606f\u3001\u8fde\u63a5\u4fe1\u606f\u7b49\u7ec4\u88c5\u6210 JSON \u6570\u636e\uff0c\u5e76\u5c06\u5176\u53d1\u9001\u5230\u7b56\u7565\u51b3\u7b56 API \u5730\u5740\u3002\u53ea\u8981\u5728 OPA \u4e2d\u90e8\u7f72\u7684\u7b56\u7565\u7b26\u5408 Apache APISIX \u8bbe\u5b9a\u7684\u6570\u636e\u89c4\u8303\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5982\u901a\u8fc7\u8bf7\u6c42\u3001\u62d2\u7edd\u8bf7\u6c42\u3001\u81ea\u5b9a\u4e49\u72b6\u6001\u7801\u3001\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934\u3001\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934\u7b49\u529f\u80fd\u3002\\n\\n\u672c\u6587\u4ee5 HTTP API \u4e3a\u4f8b\u4e3a\u5927\u5bb6\u4ecb\u7ecd `opa` \u63d2\u4ef6\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u5982\u4f55\u5c06 Apache APISIX \u4e0e OPA \u8fdb\u884c\u96c6\u6210\uff0c\u5b9e\u73b0\u540e\u7aef\u670d\u52a1\u7684\u8ba4\u8bc1\u6388\u6743\u89e3\u8026\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u642d\u5efa\u6d4b\u8bd5\u73af\u5883\\n\\n1. \u4f7f\u7528 Docker \u6784\u5efa OPA \u670d\u52a1\u3002\\n\\n   ```shell\\n   # \u4f7f\u7528 Docker \u8fd0\u884c OPA\\n   docker run -d --name opa -p 8181:8181 openpolicyagent/opa:0.35.0 run -s\\n    ```\\n\\n2. \u521b\u5efa `example` \u7b56\u7565\u3002\\n\\n    ```shell\\n    # \u521b\u5efa\u7b56\u7565\\n    curl -XPUT \'localhost:8181/v1/policies/example\' \\\\\\n    --header \'Content-Type: text/plain\' \\\\\\n    --data-raw \'package example\\n\\n    import input.request\\n    import data.users\\n\\n    default allow = false\\n\\n    allow {\\n        # \u5177\u6709\u540d\u4e3a test-header \u503c\u4e3a only-for-test\u8bf7\u6c42\u5934\\n        request.headers[\\"test-header\\"] == \\"only-for-test\\"\\n        # \u8bf7\u6c42\u65b9\u6cd5\u4e3a GET\\n        request.method == \\"GET\\"\\n        # \u8bf7\u6c42\u8def\u5f84\u4ee5 /get \u5f00\u5934\\n        startswith(request.path, \\"/get\\")\\n        # GET \u53c2\u6570 test \u5b58\u5728\u4e14\u4e0d\u7b49\u4e8e abcd\\n        request.query[\\"test\\"] != \\"abcd\\"\\n        # GET \u53c2\u6570 user \u5b58\u5728\\n        request.query[\\"user\\"]\\n    }\\n\\n    reason = users[request.query[\\"user\\"]].reason {\\n        not allow\\n        request.query[\\"user\\"]\\n    }\\n\\n    headers = users[request.query[\\"user\\"]].headers {\\n        not allow\\n        request.query[\\"user\\"]\\n    }\\n\\n    status_code = users[request.query[\\"user\\"]].status_code {\\n        not allow\\n        request.query[\\"user\\"]\\n    }\'\\n    ```\\n\\n3. \u521b\u5efa `users` \u6570\u636e\u3002\\n\\n    ```shell\\n    # \u521b\u5efa\u6d4b\u8bd5\u7528\u6237\u6570\u636e\\n    curl -XPUT \'localhost:8181/v1/data/users\' \\\\\\n    --header \'Content-Type: application/json\' \\\\\\n    --data-raw \'{\\n        \\"alice\\": {\\n            \\"headers\\": {\\n                \\"Location\\": \\"http://example.com/auth\\"\\n            },\\n            \\"status_code\\": 302\\n        },\\n        \\"bob\\": {\\n            \\"headers\\": {\\n                \\"test\\": \\"abcd\\",\\n                \\"abce\\": \\"test\\"\\n            }\\n        },\\n        \\"carla\\": {\\n            \\"reason\\": \\"Give you a string reason\\"\\n        },\\n        \\"dylon\\": {\\n            \\"headers\\": {\\n                \\"Content-Type\\": \\"application/json\\"\\n            },\\n            \\"reason\\": {\\n                \\"code\\": 40001,\\n                \\"desc\\": \\"Give you a object reason\\"\\n            }\\n        }\\n    }\'\\n    ```\\n\\n### \u521b\u5efa\u8def\u7531\u5e76\u542f\u7528\u63d2\u4ef6\\n\\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u521b\u5efa\u8def\u7531\uff0c\u5e76\u542f\u7528 `opa` \u63d2\u4ef6\u3002\\n\\n```shell\\ncurl -XPUT \'http://127.0.0.1:9080/apisix/admin/routes/r1\' \\\\\\n--header \'X-API-KEY: <api-key>\' \\\\\\n--header \'Content-Type: application/json\' \\\\\\n--data-raw \'{\\n    \\"uri\\": \\"/*\\",\\n    \\"methods\\": [\\n        \\"GET\\",\\n        \\"POST\\",\\n        \\"PUT\\",\\n        \\"DELETE\\"\\n    ],\\n    \\"plugins\\": {\\n        \\"opa\\": {\\n            \\"host\\": \\"http://127.0.0.1:8181\\",\\n            \\"policy\\": \\"example\\"\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"httpbin.org:80\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    }\\n}\'\\n```\\n\\n### \u6d4b\u8bd5\u8bf7\u6c42\\n\\n\u63a5\u4e0b\u6765\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5411 `opa` \u63d2\u4ef6\u53d1\u9001\u8bf7\u6c42\uff0c\u6d4b\u8bd5\u63d2\u4ef6\u8fd0\u884c\u72b6\u6001\u3002\\n\\n```shell\\n# \u5141\u8bb8\u8bf7\u6c42\\ncurl -XGET \'127.0.0.1:9080/get?test=none&user=dylon\' \\\\\\n    --header \'test-header: only-for-test\'\\n{\\n    \\"args\\": {\\n        \\"test\\": \\"abcd1\\",\\n        \\"user\\": \\"dylon\\"\\n    },\\n    \\"headers\\": {\\n        \\"Test-Header\\": \\"only-for-test\\",\\n        \\"with\\": \\"more\\"\\n    },\\n    \\"origin\\": \\"127.0.0.1\\",\\n    \\"url\\": \\"http://127.0.0.1/get?test=abcd1&user=dylon\\"\\n}\\n\\n# \u62d2\u7edd\u8bf7\u6c42\u5e76\u91cd\u5199\u72b6\u6001\u7801\u548c\u54cd\u5e94\u5934\\ncurl -XGET \'127.0.0.1:9080/get?test=abcd&user=alice\' \\\\\\n    --header \'test-header: only-for-test\'\\n\\nHTTP/1.1 302 Moved Temporarily\\nDate: Mon, 20 Dec 2021 09:37:35 GMT\\nContent-Type: text/html\\nContent-Length: 142\\nConnection: keep-alive\\nLocation: http://example.com/auth\\nServer: APISIX/2.11.0\\n\\n# \u62d2\u7edd\u8bf7\u6c42\u5e76\u8fd4\u56de\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934\\ncurl -XGET \'127.0.0.1:9080/get?test=abcd&user=bob\' \\\\\\n    --header \'test-header: only-for-test\'\\n\\nHTTP/1.1 403 Forbidden\\nDate: Mon, 20 Dec 2021 09:38:27 GMT\\nContent-Type: text/html; charset=utf-8\\nContent-Length: 150\\nConnection: keep-alive\\nabce: test\\ntest: abcd\\nServer: APISIX/2.11.0\\n\\n# \u62d2\u7edd\u8bf7\u6c42\u5e76\u8fd4\u56de\u81ea\u5b9a\u4e49\u54cd\u5e94\uff08\u5b57\u7b26\u4e32\uff09\\ncurl -XGET \'127.0.0.1:9080/get?test=abcd&user=carla\' \\\\\\n    --header \'test-header: only-for-test\'\\n\\nHTTP/1.1 403 Forbidden\\nDate: Mon, 20 Dec 2021 09:38:58 GMT\\nContent-Type: text/plain; charset=utf-8\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\nServer: APISIX/2.11.0\\n\\nGive you a string reason\\n\\n# \u62d2\u7edd\u8bf7\u6c42\u5e76\u8fd4\u56de\u81ea\u5b9a\u4e49\u54cd\u5e94\uff08JSON\uff09\\ncurl -XGET \'127.0.0.1:9080/get?test=abcd&user=dylon\' \\\\\\n    --header \'test-header: only-for-test\'\\n\\nHTTP/1.1 403 Forbidden\\nDate: Mon, 20 Dec 2021 09:42:12 GMT\\nContent-Type: application/json\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\nServer: APISIX/2.11.0\\n\\n{\\"code\\":40001,\\"desc\\":\\"Give you a object reason\\"}\\n```\\n\\n### \u5173\u95ed\u63d2\u4ef6\\n\\n\u5f97\u76ca\u4e8e Apache APISIX \u7684\u52a8\u6001\u5316\u7279\u6027\uff0c\u53ea\u9700\u8981\u79fb\u9664\u8def\u7531\u914d\u7f6e\u4e2d `opa` \u63d2\u4ef6\u76f8\u5173\u914d\u7f6e\u5e76\u4fdd\u5b58\uff0c\u5373\u53ef\u5173\u95ed\u8def\u7531\u4e0a\u7684 OPA \u63d2\u4ef6\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u63cf\u8ff0\u4e86 Apache APISIX \u548c Open Policy Agent \u5bf9\u63a5\u7684\u8be6\u7ec6\u64cd\u4f5c\u6b65\u9aa4\uff0c\u5e0c\u671b\u901a\u8fc7\u672c\u6587\u53ef\u4ee5\u8ba9\u5927\u5bb6\u5bf9\u4e8e\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Open Policy Agent \u6709\u4e86\u66f4\u6e05\u6670\u7684\u7406\u89e3\uff0c\u65b9\u4fbf\u540e\u7eed\u8fdb\u884c\u4e0a\u624b\u5b9e\u64cd\u3002\\n\\nApache APISIX \u4e0d\u4ec5\u81f4\u529b\u4e8e\u4fdd\u6301\u81ea\u8eab\u7684\u9ad8\u6027\u80fd\uff0c\u4e5f\u4e00\u76f4\u975e\u5e38\u91cd\u89c6\u5f00\u6e90\u751f\u6001\u7684\u5efa\u8bbe\u3002\u76ee\u524d Apache APISIX \u5df2\u7ecf\u62e5\u6709\u4e86 10+ \u4e2a\u8ba4\u8bc1\u6388\u6743\u76f8\u5173\u7684\u63d2\u4ef6\uff0c\u652f\u6301\u4e0e\u4e1a\u754c\u4e3b\u6d41\u7684\u8ba4\u8bc1\u6388\u6743\u670d\u52a1\u5bf9\u63a5\u3002\\n\\n\u5982\u679c\u4f60\u6709\u5bf9\u63a5\u5176\u4ed6\u8ba4\u8bc1\u6388\u6743\u7684\u9700\u6c42\uff0c\u4e0d\u59a8\u8bbf\u95ee Apache APISIX \u7684 [GitHub](https://github.com/apache/apisix/issues)\uff0c\u901a\u8fc7 issue \u7559\u4e0b\u4f60\u7684\u5efa\u8bae\uff1b\u6216\u8ba2\u9605 Apache APISIX \u7684[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\uff0c\u901a\u8fc7\u90ae\u4ef6\u8868\u8fbe\u4f60\u7684\u60f3\u6cd5\u3002"},{"id":"API \u7f51\u5173\u73b0\u5df2\u652f\u6301\u5bf9\u63a5 Google Cloud Logging","metadata":{"permalink":"/zh/blog/2021/12/22/google-logging","source":"@site/blog/2021/12/22/google-logging.md","title":"API \u7f51\u5173\u73b0\u5df2\u652f\u6301\u5bf9\u63a5 Google Cloud Logging","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u901a\u8fc7 API \u7f51\u5173 Apache APISIX \u7684 google-cloud-logging \u63d2\u4ef6\u4e0e Google Cloud Logging \u670d\u52a1\u5bf9\u63a5\uff0c\u5e76\u5c06 Apache APISIX \u7684\u65e5\u5fd7\u4e0a\u4f20\u5230 Google \u4e91\u4e2d\u3002","date":"2021-12-22T00:00:00.000Z","formattedDate":"2021\u5e7412\u670822\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":9.58,"truncated":true,"authors":[{"name":"\u5e05\u8fdb\u8d85","title":"Author","url":"https://github.com/shuaijinchao","image_url":"https://avatars.githubusercontent.com/u/8529452?v=4","imageURL":"https://avatars.githubusercontent.com/u/8529452?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://avatars.githubusercontent.com/u/36651058?v=4","imageURL":"https://avatars.githubusercontent.com/u/36651058?v=4"}],"prevItem":{"title":"Apache APISIX \u96c6\u6210 Open Policy Agent","permalink":"/zh/blog/2021/12/24/open-policy-agent"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff0812.1-12.15\uff09","permalink":"/zh/blog/2021/12/20/weekly-report-1215"}},"content":"> \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u5728 Apache APISIX \u4e2d\u914d\u7f6e\u548c\u4f7f\u7528 Google Cloud Logging \u670d\u52a1\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n![Apache APISIX-Google Cloud logging cover](https://static.apiseven.com/202108/1640155567091-2611f8b8-8181-42d8-8756-e892b3768a8d.png)\\n\\n\u65e5\u5fd7\u662f\u5927\u578b\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u91cd\u8981\u57fa\u7840\u8bbe\u65bd\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u8005\u68c0\u67e5\u89c2\u6d4b\u670d\u52a1\u8fd0\u884c\u7684\u72b6\u6001\uff0c\u63d0\u9ad8\u670d\u52a1\u6545\u969c\u6392\u67e5\u548c\u8bca\u65ad\u6548\u7387\u4ee5\u53ca\u8fdb\u884c\u591a\u7ef4\u5ea6\u7684\u5206\u6790\uff0c\u4ee5\u6b64\u63d0\u9ad8\u7cfb\u7edf\u6574\u4f53\u7684\u7a33\u5b9a\u6027\u548c\u8fd0\u884c\u6548\u7387\u3002\\n\\nGoogle Cloud Logging \u662f\u7531 Google Cloud \u63d0\u4f9b\u7684\u5168\u4ee3\u7ba1\u5f0f\u5b9e\u65f6\u65e5\u5fd7\u7ba1\u7406\u670d\u52a1\uff0c\u63d0\u4f9b EB \u7ea7\u7684\u5b58\u50a8\u3001\u641c\u7d22\u3001\u5206\u6790\u548c\u63d0\u9192\u7b49\u670d\u52a1\u3002\u901a\u8fc7 Google Cloud Loging \u7684\u65e5\u5fd7\u6d4f\u89c8\u5668\u4f60\u53ef\u4ee5\u7b80\u5355\u9ad8\u6548\u7684\u5bf9\u65e5\u5fd7\u8fdb\u884c\u5bf9\u65e5\u5fd7\u8fdb\u884c\u641c\u7d22\u3001\u6392\u5e8f\u548c\u5206\u6790\uff0c\u5e76\u4e14 Google Cloud Logging \u8fd8\u63d0\u4f9b\u4e86\u4fdd\u5b58\u67e5\u8be2\u548c\u4e30\u5bcc\u7684\u56fe\u8868\u529f\u80fd\u53ef\u4ee5\u4f7f\u65e5\u5fd7\u7b5b\u67e5\u7ed3\u679c\u53ef\u56de\u6eaf\u4e14\u6709\u66f4\u76f4\u89c2\u7684\u5448\u73b0\u3002\\n\\nApache APISIX \u5728\u6b64\u4e4b\u524d\u5df2\u7ecf\u652f\u6301\u96c6\u6210\u4e86 [HTTP Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/http-logger.md) \u3001[TCP Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/tcp-logger.md)\u3001[Kafka Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/kafka-logger.md)\u3001[UDP Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/udp-logger.md)\u3001[RocketMQ Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/rocketmq-logger.md)\u3001[SkyWalking Logger](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/skywalking-logger.md)\u3001[Aliyun Cloud Logging\uff08SLS\uff09](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/sls-logger.md)\u7b49\u4f17\u591a\u5f00\u6e90\u53ca\u4e91\u65e5\u5fd7\u670d\u52a1\u89e3\u51b3\u65b9\u6848\u3002\\n\\n\u6700\u8fd1\uff0cApache APISIX \u5bf9 Google Cloud Logging \u4e5f\u5b8c\u6210\u4e86\u652f\u6301\uff0c\u5728\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u7f51\u5173\u65f6\u7528\u6237\u53c8\u591a\u4e86\u4e00\u79cd\u65b0\u7684\u65e5\u5fd7\u89e3\u51b3\u65b9\u6848\uff1a\u4f7f\u7528 google-cloud-logging \u63d2\u4ef6\uff0c\u5c06 Apache APISIX \u7684\u8bf7\u6c42\u65e5\u5fd7\u8f6c\u53d1\u5230 Google Cloud Logging \u670d\u52a1\u4e2d\u8fdb\u884c\u5206\u6790\u548c\u5b58\u50a8\u3002\\n\\n\u542f\u7528\u8be5\u63d2\u4ef6\u540e\uff0c Apache APISIX \u5c06\u5728 Log Phase \u83b7\u53d6\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4fe1\u606f\u5e76\u5e8f\u5217\u5316\u4e3a Google Cloud Logging \u7684\u65e5\u5fd7\u683c\u5f0f\uff0c\u7136\u540e\u5c06\u5e8f\u5217\u5316\u540e\u7684\u65e5\u5fd7\u6570\u636e\u63d0\u4ea4\u5230\u6279\u5904\u7406\u961f\u5217\u4e2d\uff0c\u5f53\u6279\u5904\u7406\u961f\u5217\u89e6\u53d1\u7528\u6237\u8bbe\u7f6e\u7684\u65f6\u95f4\u6216\u6761\u76ee\u9608\u503c\u65f6\u4f1a\u5c06\u65e5\u5fd7\u6570\u636e\u901a\u8fc7 Google Cloud API \u6279\u91cf\u8f6c\u53d1\u5230 Google Cloud Logging \u670d\u52a1\u4e2d\u3002\\n\\n\u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u5728 Apache APISIX \u4e2d\u914d\u7f6e\u548c\u4f7f\u7528 Google Cloud Logging \u670d\u52a1\u3002\\n\\n## \u914d\u7f6e Google Cloud\\n\\n1. \u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u8bbf\u95ee Google Cloud \u9996\u9875\u3002\\n2. \u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u767b\u5f55 Google Cloud \u63a7\u5236\u53f0\u3002\\n3. \u5355\u51fb Google Cloud \u63a7\u5236\u53f0\u5de6\u4fa7\u83dc\u5355\uff0c\u9009\u62e9 \u201cIAM & Admin > Create a Project\u201d\uff0c\u5f00\u59cb\u521b\u5efa\u9879\u76ee\u3002\\n   ![\u521b\u5efa\u9879\u76ee](https://static.apiseven.com/202108/1640137078950-3a0b472b-df9f-4f75-9c03-816138860f74.png)\\n4. \u8f93\u5165\u9879\u76ee\u540d\u79f0\uff0c\u9009\u62e9\u7ec4\u7ec7\u540d\u79f0\uff0c\u5355\u51fb \u201cCREATE\u201d \u521b\u5efa\u9879\u76ee\u3002\\n   ![\u521b\u5efa\u9879\u76ee-2](https://static.apiseven.com/202108/1640137136967-effec599-2263-45e7-874d-53a547b83aae.png)\\n5. \u521b\u5efa\u9879\u76ee\u6210\u529f\u540e\uff0c\u63a7\u5236\u53f0\u53f3\u4e0a\u89d2\u63d0\u793a\u521b\u5efa\u6210\u529f\u3002\\n   ![\u6210\u529f\u521b\u5efa\u9879\u76ee](https://static.apiseven.com/202108/1640137177601-6ac703ef-99e4-4ac2-82e3-5b978348f458.png)\\n6. \u5728\u7a97\u53e3\u4e2d\u70b9\u51fb\u9009\u62e9\u9879\u76ee\uff0c\u6216\u5728\u63a7\u5236\u53f0\u9996\u9875\u9876\u90e8\u5bfc\u822a\u680f\u9009\u62e9\u9879\u76ee\u64cd\u4f5c\u8def\u5f84\u3002\u9009\u62e9\u9879\u76ee\u540e\uff0c\u5c06\u8df3\u8f6c\u81f3\u63a7\u5236\u53f0\u9996\u9875\uff0c\u6b64\u65f6\u5728\u9876\u90e8\u5bfc\u822a\u680f\u548c\u4fe1\u606f\u4e2d\u5fc3\u7684\u9879\u76ee\u4fe1\u606f\u4e2d\u5df2\u7ecf\u53ef\u4ee5\u770b\u5230\u5f53\u524d\u9879\u76ee\u7684\u76f8\u5173\u6570\u636e\u3002\\n   ![\u67e5\u770b\u9879\u76ee](https://static.apiseven.com/202108/1640137215687-4a2a4789-09d3-4cc0-85fa-be67762cf9b7.png)\\n7. \u5b8c\u6210\u9879\u76ee\u521b\u5efa\u540e\uff0c\u4f60\u9700\u8981\u4e3a\u8be5\u9879\u76ee\u521b\u5efa\u670d\u52a1\u8d26\u53f7\u3002\u8bf7\u8fd4\u56de Google Cloud \u63a7\u5236\u53f0\u9996\u9875\uff0c\u5355\u51fb\u5de6\u4fa7\u83dc\u5355\u201cIAM & Admin > Service Account\u201d\uff0c\u5f00\u59cb\u521b\u5efa\u670d\u52a1\u8d26\u53f7\u3002\\n   ![\u5f00\u59cb\u521b\u5efa\u670d\u52a1\u8d26\u53f7](https://static.apiseven.com/202108/1640137733012-6c9808c8-9c96-401e-a680-03a276b964c0.png)\\n8. \u5355\u51fb\u201cCREATE SERVICE ACCOUNT\u201d\u521b\u5efa\u670d\u52a1\u8d26\u53f7\u3002\\n   ![\u521b\u5efa\u670d\u52a1\u8d26\u53f7](https://static.apiseven.com/202108/1640137784375-e47cbe0e-7735-4e7b-a881-1a9ec1c12ffc.png)\\n9. \u8f93\u5165\u670d\u52a1\u8d26\u53f7\u540d\u79f0\u53ca ID\uff08ID \u4e00\u822c\u8ddf\u968f\u8d26\u53f7\u751f\u6210\uff09\uff0c\u7136\u540e\u5355\u51fb \u201cCREATE AND CONTINUE\u201d\u3002\\n    ![\u521b\u5efa\u670d\u52a1\u8d26\u53f7-2](https://static.apiseven.com/202108/1640137834702-76166e6f-ed98-4a85-a759-2ce78f795794.png)\\n10. \u5355\u51fb\u201cRole\u201d\uff0c\u5728\u641c\u7d22\u6846\u4e2d\u8f93\u5165\u201cLogging Admin\u201d\u641c\u7d22\u8fd9\u4e2a\u89d2\u8272\uff0c\u9009\u62e9\u201cLogging Admin\u201d\u4f5c\u4e3a\u89d2\u8272\u3002\\n    ![\u521b\u5efa\u670d\u52a1\u8d26\u53f7-3](https://static.apiseven.com/202108/1640137883981-0f780040-8398-4d38-9600-a5e54b29b48e.png)\\n11. \u5355\u51fb\u201cDONE\u201d\uff0c\u5b8c\u6210\u670d\u52a1\u8d26\u53f7\u521b\u5efa\uff0c\u8df3\u8f6c\u5230\u670d\u52a1\u8d26\u53f7\u9996\u9875\u3002\u6b64\u65f6\u4f60\u53ef\u4ee5\u5728\u5217\u8868\u4e2d\u770b\u5230\u521a\u521a\u521b\u5efa\u7684\u8d26\u53f7\u53ca\u8be6\u60c5\u3002\\n    ![\u67e5\u770b\u8d26\u53f7\u53ca\u8be6\u60c5](https://static.apiseven.com/202108/1640137970837-ed1994be-87d0-48b8-bec5-010200fe1f1d.png)\\n12. \u5728\u670d\u52a1\u8d26\u53f7\u6700\u540e\u4e00\u5217\u7684\u64cd\u4f5c\u680f\u5355\u51fb\u201cManage keys\u201d\uff0c\u8fdb\u5165\u79d8\u94a5\u7ba1\u7406\u754c\u9762\u3002\\n    ![\u8fdb\u5165\u79d8\u94a5\u7ba1\u7406\u754c\u9762](https://static.apiseven.com/202108/1640138660649-cd57da29-5965-4251-9deb-300de830dfd9.png)\\n13. \u5355\u51fb\u201cADD KEY > Create new key\u201d\uff0c\u5f00\u59cb\u521b\u5efa\u65b0\u79d8\u94a5\u3002\\n    ![\u521b\u5efa\u65b0\u79d8\u94a5](https://static.apiseven.com/202108/1640138732589-1aea201b-de2d-455a-8c04-c3f5a28dfa91.png)\\n14. \u5728\u5f39\u7a97\u9875\u4e2d\u9009\u62e9\u79d8\u94a5\u7c7b\u578b\u4e3a\u201cJSON\u201d\uff0c\u7136\u540e\u5355\u51fb\u201cCREATE\u201d\uff0c\u521b\u5efa\u65b0\u79d8\u94a5\u3002\\n    ![\u521b\u5efa\u65b0\u79d8\u94a5-2](https://static.apiseven.com/202108/1640138785425-23ee8efe-bc0d-428a-a627-2f428440da37.png)\\n15. \u79c1\u94a5\u4fe1\u606f\u5c06\u901a\u8fc7\u6d4f\u89c8\u5668\u81ea\u52a8\u4e0b\u8f7d\u5230\u7cfb\u7edf\u9ed8\u8ba4 Downloads \u76ee\u5f55\u4e2d\uff0c\u542f\u7528 google-cloud-logging \u63d2\u4ef6\u65f6\uff0c\u9700\u8981\u4f7f\u7528\u8fd9\u4e2a\u79c1\u94a5\u4e2d\u7684\u4fe1\u606f\uff0c\u56e0\u6b64\u8bf7\u59a5\u5584\u4fdd\u5b58\u79c1\u94a5\u6587\u4ef6\u3002\\n    ![\u4e0b\u8f7d\u79c1\u94a5\u6587\u4ef6](https://static.apiseven.com/202108/1640138820163-aa459874-e78e-4156-ab74-58fc7e2ae13f.png)\\n\\n## \u914d\u7f6e Apache APISIX\\n\\n### \u542f\u7528 google-cloud-logging \u63d2\u4ef6\\n\\n#### \u65b9\u5f0f\u4e00\uff1a\u4e0a\u4f20\u79c1\u94a5\u6587\u4ef6\u914d\u7f6e\\n\\n1. \u5c06\u79c1\u94a5\u6587\u4ef6\u4e0a\u4f20\u5230 Apache APISIX \u8282\u70b9\u670d\u52a1\u5668\u4e2d\u3002\\n2. \u5c06\u6587\u4ef6\u8def\u5f84\u914d\u7f6e\u5230 `google-cloud-logging. auth_file` \u914d\u7f6e\u9879\u4e0a\uff0c\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\":\\"/logging.do\\",\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    },\\n    \\"plugins\\":{\\n        \\"google-cloud-logging\\":{\\n            // Google Cloud Logging \u79c1\u94a5\u6587\u4ef6\\n            \\"auth_file\\":\\"/path/to/apache-apisix-fcafc68c2f41.json\\",\\n            // \u6bcf\u4e2a\u6279\u5904\u7406\u961f\u5217\u6700\u5927\u5bb9\u7eb3\u65e5\u5fd7\u6761\u76ee\u6570\\n            \\"batch_max_size\\": 1,\\n            // \u5237\u65b0\u6279\u5904\u7406\u961f\u5217\u7f13\u51b2\u533a\u7684\u6700\u5927\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\\n            \\"inactive_timeout\\": 10\\n        }\\n    }\\n}\'\\n```\\n\\n#### \u901a\u8fc7 JSON \u6587\u672c\u914d\u7f6e\\n\\n1. \u6253\u5f00\u79c1\u94a5\u6587\u4ef6\u3002\\n2. \u5c06 `project_id` \u7684\u503c\u914d\u7f6e\u5230 `google-cloud-logging. auth_config.project_id` \u914d\u7f6e\u9879\u4e2d\u3002\\n3. \u5c06 `private_key` \u7684\u503c\u914d\u7f6e\u5230 `google-cloud-logging. auth_config. private_key` \u914d\u7f6e\u9879\u4e2d\u3002\\n\\n\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\":\\"/logging.do\\",\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    },\\n    \\"plugins\\":{\\n        \\"google-cloud-logging\\":{\\n            // Google Cloud Logging \u79c1\u94a5\u6587\u4ef6\\n            \\"auth_config\\":{\\n                \\"project_id\\":\\"apache-apisix\\",\\n                \\"private_key\\":\\"-----BEGIN RSA PRIVATE KEY-----your private key-----END RSA PRIVATE KEY-----\\"\\n            },\\n            // \u6bcf\u4e2a\u6279\u5904\u7406\u961f\u5217\u6700\u5927\u5bb9\u7eb3\u65e5\u5fd7\u6761\u76ee\u6570\\n            \\"batch_max_size\\": 1,\\n            // \u5237\u65b0\u6279\u5904\u7406\u961f\u5217\u7f13\u51b2\u533a\u7684\u6700\u5927\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\\n            \\"inactive_timeout\\": 10\\n        }\\n    }\\n}\'\\n```\\n\\n#### \u53c2\u6570\u8bf4\u660e\\n\\n|\u53c2\u6570\u540d\u79f0|\u662f\u5426\u5fc5\u586b|\u9ed8\u8ba4\u503c|\u63cf\u8ff0|\\n|:-----|:-----|:-----|:-----|\\n|auth_config|\u5426|n/a|Google Cloud Logging \u79c1\u94a5\u6587\u4ef6\uff0c\u5fc5\u987b\u914d\u7f6e auth_config \u6216 auth_file \u4e4b\u4e00|\\n|auth_config.private_key|\u662f|n/a|Google Cloud Logging \u7684\u79c1\u94a5\u53c2\u6570|\\n|auth_config.project_id|\u662f|n/a|\u8c37\u6b4c\u670d\u52a1\u5e10\u53f7\u7684\u9879\u76ee ID|\\nauth_config.token_uri|\u5426|oauth2.googleapis.com/token|\u8bf7\u6c42 Google Service Account \u7684\u4ee4\u724c\u7684 URI|\\n|auth_config.entries_uri|\u5426|logging.googleapis.com/v2/entries:write|Google Cloud Logging \u5199\u5165\u65e5\u5fd7\u6761\u76ee\u7684 API|\\n|auth_config.scopes|\u5426|[\\"https://www.googleapis.com/auth/logging.read\\",\\"https://www.googleapis.com/auth/logging.write\\",\\"https://www.googleapis.com/auth/logging.admin\\",\\"https://www.googleapis.com/auth/cloud-platform\\"]|\u8c37\u6b4c\u670d\u52a1\u8d26\u53f7\u7684\u8bbf\u95ee\u8303\u56f4, \u53c2\u8003\uff1a[OAuth 2.0 Scopes for Google APIs](https://developers.google.com/identity/protocols/oauth2/scopes#logging)|\\n|auth_file|\u5426|n/a|\u8c37\u6b4c\u670d\u52a1\u8d26\u53f7 JSON \u6587\u4ef6\u7684\u8def\u5f84\uff08\u5fc5\u987b\u914d\u7f6e auth_config \u6216 auth_file \u4e4b\u4e00\uff09|\\n|ssl_verify|\u5426|TRUE|\u542f\u7528 SSL \u9a8c\u8bc1, \u914d\u7f6e\u6839\u636e [OpenResty documentation](https://github.com/openresty/lua-nginx-module#tcpsocksslhandshake)\u9009\u9879|\\n|resource|\u5426|{\\"type\\": \\"global\\"}|\u8c37\u6b4c\u76d1\u63a7\u8d44\u6e90\uff0c\u53c2\u8003\uff1a[MonitoredResource](https://cloud.google.com/logging/docs/reference/v2/rest/v2/MonitoredResource)|\\n|log_id|\u5426|apisix.apache.org%2Flogs|\u8c37\u6b4c\u65e5\u5fd7 ID\uff0c\u53c2\u8003\uff1a[LogEntry](https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry).|\\n|max_retry_count|\u5426|0|\u4ece\u5904\u7406\u7ba1\u9053\u4e2d\u79fb\u9664\u4e4b\u524d\u7684\u6700\u5927\u91cd\u8bd5\u6b21\u6570|\\n|retry_delay|\u5426|1|\u5982\u679c\u6267\u884c\u5931\u8d25\uff0c\u6d41\u7a0b\u6267\u884c\u5e94\u5ef6\u8fdf\u7684\u79d2\u6570|\\n|buffer_duration|\u5426|60|\u5fc5\u987b\u5148\u5904\u7406\u6279\u6b21\u4e2d\u6700\u65e7\u6761\u76ee\u7684\u6700\u5927\u671f\u9650\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09|\\n|inactive_timeout|\u5426|10|\u5237\u65b0\u7f13\u51b2\u533a\u7684\u6700\u5927\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09|\\n|batch_max_size|\u5426|100|\u6bcf\u4e2a\u6279\u5904\u7406\u961f\u5217\u53ef\u5bb9\u7eb3\u7684\u6700\u5927\u6761\u76ee\u6570|\\n\\n### \u9a8c\u8bc1\u63d2\u4ef6\u662f\u5426\u6210\u529f\u8fd0\u884c\\n\\n1. \u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5411 Google Cloud Logging \u53d1\u9001\u8bf7\u6c42\u3002\\n\\n  ```shell\\n  curl -i http://127.0.0.1:9080/logging.do\\n  HTTP/1.1 200 OK\\n  Content-Type: text/html; charset=utf-8\\n  Transfer-Encoding: chunked\\n  Connection: keep-alive\\n  Date: Fri, 10 Dec 2021 09:57:52 GMT\\n  Server: APISIX/2.11.0\\n\\n  Hello, Google Cloud Logging\\n  ```\\n\\n2. \u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u8bbf\u95ee Google Cloud \u9996\u9875\u3002\\n3. \u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u767b\u5f55 Google Cloud \u63a7\u5236\u53f0\u3002\\n4. \u901a\u8fc7\u65e5\u5fd7\u6d4f\u89c8\u5668\u67e5\u770b\u53d1\u9001\u7684\u8bf7\u6c42\u65e5\u5fd7\uff0c\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n   ![\u67e5\u770b\u65e5\u5fd7](https://static.apiseven.com/202108/1640139014263-fac86f87-d008-475c-aeae-289ab4ba62a8.png)\\n\\n### \u505c\u7528 google-cloud-logging \u63d2\u4ef6\\n\\n\u5982\u4f7f\u7528\u7ed3\u675f\uff0c\u53ef\u4ee5\u79fb\u9664 `google-cloud-logging` \u76f8\u5173\u914d\u7f6e\u5757\u8fdb\u884c\u505c\u7528\u8be5\u63d2\u4ef6\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\":\\"/logging.do\\",\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    },\\n    \\"plugins\\":{\\n    }\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3a\u5927\u5bb6\u63cf\u8ff0\u4e86 Apache APISIX \u548c Google Cloud Logging \u5bf9\u63a5\u7684\u8be6\u7ec6\u64cd\u4f5c\u6b65\u9aa4\uff0c\u5e0c\u671b\u901a\u8fc7\u672c\u6587\u53ef\u4ee5\u8ba9\u5927\u5bb6\u5bf9\u4e8e\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Google Cloud Logging \u6709\u66f4\u6e05\u6670\u7684\u7406\u89e3\uff0c\u65b9\u4fbf\u540e\u7eed\u8fdb\u884c\u4e0a\u624b\u5b9e\u64cd\u3002\\n\\nApache APISIX \u4e0d\u4ec5\u81f4\u529b\u4e8e\u4fdd\u6301\u81ea\u8eab\u7684\u9ad8\u6027\u80fd\uff0c\u4e5f\u4e00\u76f4\u975e\u5e38\u91cd\u89c6\u5f00\u6e90\u751f\u6001\u7684\u5efa\u8bbe\u3002\u76ee\u524d Apache APISIX \u5df2\u7ecf\u62e5\u6709\u4e86 10+ \u4e2a\u65e5\u5fd7\u76f8\u5173\u7684\u63d2\u4ef6\uff0c\u652f\u6301\u4e0e\u4e1a\u754c\u4e3b\u6d41\u7684\u5f00\u6e90\u65e5\u5fd7\u9879\u76ee\u5bf9\u63a5\u3002\\n\\n\u5982\u679c\u4f60\u6709\u5bf9\u63a5\u5176\u4ed6\u65e5\u5fd7\u7684\u9700\u6c42\uff0c\u4e0d\u59a8\u8bbf\u95ee Apache APISIX \u7684 [GitHub](https://github.com/apache/apisix/issues)\uff0c\u901a\u8fc7 issue \u7559\u4e0b\u4f60\u7684\u5efa\u8bae\uff1b\u6216\u8ba2\u9605 Apache APISIX \u7684[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\uff0c\u901a\u8fc7\u90ae\u4ef6\u8868\u8fbe\u4f60\u7684\u60f3\u6cd5\u3002\\n\\n## \u76f8\u5173\u9605\u8bfb\\n\\n[\u5f3a\u5f3a\u8054\u5408\uff01APISIX \u96c6\u6210 SkyWalking \u6253\u9020\u5168\u65b9\u4f4d\u65e5\u5fd7\u5904\u7406](https://apisix.apache.org/zh/blog/2021/12/07/apisix-integrate-skywalking-plugin/)\\n\\n[Apache APISIX \u643a\u624b RocketMQ \u4e3a\u5b9e\u65f6 API \u65e5\u5fd7\u76d1\u63a7\u529f\u80fd\u518d\u4e0b\u4e00\u57ce](https://apisix.apache.org/zh/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin/)"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff0812.1-12.15\uff09","metadata":{"permalink":"/zh/blog/2021/12/20/weekly-report-1215","source":"@site/blog/2021/12/20/weekly-report-1215.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff0812.1-12.15\uff09","description":"API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86 rocketmq-logger\u3001opa \u63d2\u4ef6\uff0c\u4ee5\u53ca Wasm \u652f\u6301\u5728 rewrite \u9636\u6bb5\u8fd0\u884c\uff0cmqtt-proxy \u63d2\u4ef6\u652f\u6301\u4f7f\u7528 route \u4e0a\u914d\u7f6e\u7684\u4e0a\u6e38\u4fe1\u606f\u7b49\u529f\u80fd\u3002","date":"2021-12-20T00:00:00.000Z","formattedDate":"2021\u5e7412\u670820\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":6.135,"truncated":true,"authors":[],"prevItem":{"title":"API \u7f51\u5173\u73b0\u5df2\u652f\u6301\u5bf9\u63a5 Google Cloud Logging","permalink":"/zh/blog/2021/12/22/google-logging"},"nextItem":{"title":"\u5229\u7528 APISIX Ingress \u5b9e\u73b0 Istio \u670d\u52a1\u7684\u5b89\u5168\u66b4\u9732","permalink":"/zh/blog/2021/12/17/exposure-istio-with-apisix-ingress"}},"content":"> \u4ece 12.1 \u5230 12.15, \u6709 38 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 114 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1639983576378-30662c63-d320-49b8-b301-5aecdf55c3d4.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1639983576389-e5f6a5b8-d54e-43c3-837b-39eafc22a855.png)\\n\\n## Good first issue\\n\\n### Issue #5795\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5795\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5b89\u88c5 etcd\u3002\u4f46 install_dependencies.sh \u4e0d\u652f\u6301\u8fd9\u4e2a\u529f\u80fd\uff0c\u5b83\u9ed8\u8ba4\u5b89\u88c5 APISIX \u7684\u6240\u6709\u4f9d\u8d56\u9879\u3002\u6211\u4eec\u53ef\u4ee5\u5728 install_dependencies.sh \u4e2d\u5355\u72ec\u652f\u6301\u5b89\u88c5 etcd \u5417\uff1f\\n\\n\u4f8b\u5982\uff1a\\n\\n```Nginx\\nbash install_dependencies.sh etcd\\n```\\n\\n### Issue #5756\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5756\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u76ee\u524d\u7684 OpenWhisk \u63d2\u4ef6\u4f1a\u4ece Apache OpenWhisk \u83b7\u53d6\u54cd\u5e94\uff0c\u5e76\u76f4\u63a5\u8fd4\u56de\uff0c\u800c\u4e0d\u8fdb\u884c\u89e3\u6790\u3002\u8fd9\u4e2a\u8bf7\u6c42\u53ef\u80fd\u5305\u542b\u590d\u6742\u7684\u6570\u636e\uff0c\u91cd\u5199\u72b6\u6001\u7801\u3001\u54cd\u5e94\u5934\u548c\u54cd\u5e94\u4f53\u3002\u6211\u4eec\u9700\u8981\u89e3\u6790\u5b83\u5e76\u6539\u53d8 APISIX \u7684\u54cd\u5e94\u3002\\n\\n\u50cf\u8fd9\u6837\u7684\u590d\u6742\u6570\u636e\uff1a\\n\\n```JSON\\n{\\n  \\"statusCode\\": 401,\\n  \\"headers\\": {\\n    \\"addition-header\\": \\"a-header\\"\\n  },\\n  \\"body\\": \\"xxx\\" | {\\"xxx\\":\\"xxx\\"}\\n}\\n```\\n\\n\u6211\u4eec\u9700\u8981\u786e\u5b9a OpenWhisk \u54cd\u5e94\u662f\u5426\u5305\u542b\u5b83\u4eec\uff0c\u5982\u679c\u5b83\u4eec\u5b58\u5728\uff0c\u5c31\u628a\u5b83\u4eec\u5199\u5165 APISIX \u54cd\u5e94\u3002\\n\\n### Issue #5634\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5634\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u76ee\u524d\u5728 apisix limit-* \u63d2\u4ef6\u4e2d\u5df2\u7ecf\u652f\u6301 `var`\u3001`var_combination` \u4e86\u3002\u53ef\u4ee5\u652f\u6301\u4e00\u4e2a\u7c7b\u4f3c\u4e8e `function` \u7684\u7c7b\u578b\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728 key \u4e2d\u628a\u4e00\u4e9b\u903b\u8f91\u5199\u6210\u4e00\u4e2a\u51fd\u6570\u3002\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u4ece\u51fd\u6570\u4e2d\u83b7\u5f97 key\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [APISIX mqtt-proxy \u63d2\u4ef6\u652f\u6301\u4f7f\u7528 route \u4e0a\u914d\u7f6e\u7684\u4e0a\u6e38\u4fe1\u606f](https://github.com/apache/apisix/pull/5666)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [APISIX \u652f\u6301\u5728\u672a\u8bbe\u7f6e\u73af\u5883\u65f6\u9ed8\u8ba4\u503c](https://github.com/apache/apisix/pull/5675)\uff08\u8d21\u732e\u8005: [kevinw66](https://github.com/kevinw66)\uff09\\n\\n- [APISIX \u65b0\u589e rocketmq-logger \u63d2\u4ef6\uff0c\u53ef\u4ee5\u5c06\u63a5\u53e3\u8bf7\u6c42\u65e5\u5fd7\u4ee5 JSON \u7684\u5f62\u5f0f\u63a8\u9001\u7ed9\u5916\u90e8 rocketmq \u96c6\u7fa4](https://github.com/apache/apisix/pull/5653)\uff08\u8d21\u732e\u8005\uff1a[yuz10](https://github.com/yuz10)\uff09\\n\\n- [APISIX WASM \u652f\u6301\u5728 rewrite \u9636\u6bb5\u8fd0\u884c](https://github.com/apache/apisix/pull/5695)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [APISIX \u652f\u6301\u5728 server \u4e0e location \u4e4b\u95f4\u8865\u5145\u81ea\u5b9a\u4e49 Nginx \u914d\u7f6e](https://github.com/apache/apisix/pull/5740)\uff08\u8d21\u732e\u8005\uff1a[zlhgo](https://github.com/zlhgo)\uff09\\n\\n- [APISIX stream \u5b50\u7cfb\u7edf\u652f\u6301\u8bb0\u5f55\u65e5\u5fd7](https://github.com/apache/apisix/pull/5768)\uff08\u8d21\u732e\u8005\uff1a[bisakhmondal](https://github.com/bisakhmondal)\uff09\\n\\n- [APISIX \u65b0\u589e OPA \u63d2\u4ef6\uff0c\u652f\u6301\u4f7f\u7528 OpenPolicyAgent \u670d\u52a1\u5bf9 API \u8fdb\u884c\u8bbf\u95ee\u63a7\u5236](https://github.com/apache/apisix/pull/5734)\uff08\u8d21\u732e\u8005: [bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [APISIX \u65b0\u589e vault \u6a21\u5757\uff0c\u5c06 HashiCorp Vault \u4e0e APISIX \u7684 jwt-auth \u8ba4\u8bc1\u63d2\u4ef6\u6574\u5408](https://github.com/apache/apisix/pull/5745)\uff08\u8d21\u732e\u8005\uff1a[bisakhmondal](https://github.com/bisakhmondal)\uff09\\n\\n- [Dashboard \u652f\u6301\u914d\u7f6e\u4f7f\u7528 POST \u8868\u5355\u6570\u636e\u4f5c\u4e3a\u9ad8\u7ea7\u5339\u914d\u6761\u4ef6](https://github.com/apache/apisix-dashboard/pull/2231)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [Apache APISIX Ingresss \u4e2d\u53ef\u907f\u514d\u65e0 spec \u5b57\u6bb5\u7684 ApisixUpstream \u8d44\u6e90\u5bfc\u81f4\u7684 panic](https://github.com/apache/apisix-ingress-controller/pull/794)\uff08\u8d21\u732e\u8005\uff1a[Brhetty](https://github.com/Brhetty)\uff09\\n\\n- [- Apache APISIX Ingress \u4e2d\u4e3a Ingress \u8d44\u6e90\u589e\u52a0\u6b63\u5219\u5339\u914d\u7684\u652f\u6301](https://github.com/apache/apisix-ingress-controller/pull/779)\uff08\u8d21\u732e\u8005: [lxm](https://github.com/lxm)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u5229\u7528 APISIX Ingress \u5b9e\u73b0 Istio \u670d\u52a1\u7684\u5b89\u5168\u66b4\u9732](https://apisix.apache.org/zh/blog/2021/12/17/exposure-istio-with-apisix-ingress)\uff1a\\n\\n  \u672c\u6587\u5c06\u901a\u8fc7\u975e\u5e38\u8be6\u7ec6\u7684\u64cd\u4f5c\u6b65\u9aa4\uff0c\u5411\u5927\u5bb6\u4e00\u6b65\u6b65\u5730\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Istio Service Mesh \u548c Apache APISIX\uff0c\u5c06\u542f\u7528 Service Mesh \u7684 Kubernetes \u96c6\u7fa4\u4e2d\u670d\u52a1\u66b4\u9732\u81f3\u96c6\u7fa4\u5916\u3002\\n\\n- [\u4e24\u79cd\u65b9\u5f0f\u6559\u4f60\u5728 K8s \u4e2d\u8f7b\u677e\u90e8\u7f72 Apache APISIX](https://apisix.apache.org/zh/blog/2021/12/15/deploy-apisix-in-kubernetes)\uff1a\\n\\n  Apache APISIX \u76ee\u524d\u652f\u6301\u591a\u79cd\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5\u90e8\u7f72\uff0c\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u5728 Kubernetes \u73af\u5883\u4e2d\u90e8\u7f72 Apach APISIX \u4ee5\u53ca APISIX-Dashboard\u3002\\n\\n- [\u4f7f\u7528 Prometheus \u76d1\u63a7 APISIX Ingress Controller](https://apisix.apache.org/zh/blog/2021/12/13/monitor-apisix-ingress-controller-with-prometheus)\uff1a\\n\\n  \u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 Prometheus \u76d1\u63a7 APISIX Ingress Controller \u7684\u76f8\u5173\u6b65\u9aa4\u548c\u90e8\u5206\u6307\u6807\u7684\u5c55\u793a\u6548\u679c\u3002\\n\\n- [\u5982\u4f55\u5728 Apache APISIX \u4e2d\u96c6\u6210 Keycloak \u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1](https://apisix.apache.org/zh/blog/2021/12/10/integrate-keycloak-auth-in-apisix)\uff1a\\n\\n  \u672c\u6587\u901a\u8fc7\u8be6\u7ec6\u7684\u6b65\u9aa4\u4e3a\u5927\u5bb6\u5c55\u793a\u4e86\u5982\u4f55\u5728 Apache APISIX \u4f7f\u7528 OpenID-Connect \u534f\u8bae\u548c Keycloak \u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u3002\u901a\u8fc7\u5bf9\u63a5 Keycloak\uff0cApache APISIX \u4ec5\u9700\u901a\u8fc7\u914d\u7f6e\u5373\u53ef\u5b9e\u73b0\u5bf9\u4f7f\u7528\u8005\u548c\u5e94\u7528\u670d\u52a1\u8fdb\u884c\u8ba4\u8bc1\u4e0e\u9274\u6743\uff0c\u4ece\u800c\u5927\u5927\u51cf\u5c11\u4e86\u76f8\u5173\u5f00\u53d1\u5de5\u4f5c\u3002\\n\\n- [Apache APISIX \u643a\u624b RocketMQ \u4e3a\u5b9e\u65f6 API \u65e5\u5fd7\u76d1\u63a7\u529f\u80fd\u518d\u4e0b\u4e00\u57ce](https://apisix.apache.org/zh/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin)\uff1a\\n\\n  \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd Apache APISIX \u4e0e Apache RocketMQ \u6700\u65b0\u96c6\u6210\u7684 rocketmq-logger \u63d2\u4ef6\u529f\u80fd\u4e0e\u4f7f\u7528\u4ecb\u7ecd\u3002\u501f\u52a9\u8be5\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5e2e\u52a9\u60a8\u5728\u4f7f\u7528 APISIX \u4e2d\u66f4\u65b9\u4fbf\u7684\u4e0e RocketMQ \u96c6\u7fa4\u8fde\u63a5\u3002\\n  \\n- [\u5f3a\u5f3a\u8054\u5408\uff01APISIX \u96c6\u6210 SkyWalking \u6253\u9020\u5168\u65b9\u4f4d\u65e5\u5fd7\u5904\u7406](https://apisix.apache.org/zh/blog/2021/12/07/apisix-integrate-skywalking-plugin)\uff1a\\n\\n  \u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u4e24\u6b3e Apache APISIX \u96c6\u6210 SkyWalking \u7684\u65e5\u5fd7\u63d2\u4ef6\uff0c\u4e3a\u4e4b\u540e\u5927\u5bb6\u5728 Apache APISIX \u4e2d\u8fdb\u884c\u65e5\u5fd7\u5904\u7406\u63d0\u4f9b\u66f4\u65b9\u4fbf\u7684\u64cd\u4f5c\u4e0e\u73af\u5883\u3002"},{"id":"\u5229\u7528 APISIX Ingress \u5b9e\u73b0 Istio \u670d\u52a1\u7684\u5b89\u5168\u66b4\u9732","metadata":{"permalink":"/zh/blog/2021/12/17/exposure-istio-with-apisix-ingress","source":"@site/blog/2021/12/17/exposure-istio-with-apisix-ingress.md","title":"\u5229\u7528 APISIX Ingress \u5b9e\u73b0 Istio \u670d\u52a1\u7684\u5b89\u5168\u66b4\u9732","description":"\u672c\u6587\u5c06\u901a\u8fc7\u8be6\u7ec6\u7684\u64cd\u4f5c\u6b65\u9aa4\uff0c\u5411\u5927\u5bb6\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Istio Service Mesh \u548c API \u7f51\u5173 Apache APISIX\uff0c\u5c06\u542f\u7528 Service Mesh \u7684 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u66b4\u9732\u81f3\u96c6\u7fa4\u5916\u3002","date":"2021-12-17T00:00:00.000Z","formattedDate":"2021\u5e7412\u670817\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":11.53,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","title":"Author","url":"https://github.com/tao12345666333","image_url":"https://avatars.githubusercontent.com/u/3264292?v=4","imageURL":"https://avatars.githubusercontent.com/u/3264292?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff0812.1-12.15\uff09","permalink":"/zh/blog/2021/12/20/weekly-report-1215"},"nextItem":{"title":"\u76f4\u64ad\u9884\u544a | Apache APISIX \xd7 Apache RocketMQ \u7ebf\u4e0a\u5206\u4eab","permalink":"/zh/blog/2021/12/16/apisix-with-rocketmq-meetup"}},"content":"> \u672c\u6587\u5c06\u901a\u8fc7\u975e\u5e38\u8be6\u7ec6\u7684\u64cd\u4f5c\u6b65\u9aa4\uff0c\u5411\u5927\u5bb6\u4e00\u6b65\u6b65\u5730\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Istio Service Mesh \u548c Apache APISIX\uff0c\u5c06\u542f\u7528 Service Mesh \u7684 Kubernetes \u96c6\u7fa4\u4e2d\u670d\u52a1\u66b4\u9732\u81f3\u96c6\u7fa4\u5916\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## Service Mesh \u7b80\u4ecb\\n\\n\u968f\u7740\u4e91\u539f\u751f\u6280\u672f\u7684\u706b\u70ed\u53d1\u5c55\uff0cService Mesh \u9010\u6e10\u5728\u5fae\u670d\u52a1\u9886\u57df\u6d41\u884c\u8d77\u6765\u3002\u5f53\u4e0b Service Mesh \u6bd4\u8f83\u6d41\u884c\u7684\u5b9e\u73b0\u65b9\u6848\u662f [Istio](https://istio.io/) \u548c [Linkerd](https://linkerd.io/)\u3002\\n\\n\u4e0b\u56fe\u4e3a Service Mesh \u793a\u610f\u56fe\uff0c\u901a\u8fc7\u5f15\u5165 Sidecar Proxy \u6765\u5b8c\u6210\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u4e92\u8054\u53ca\u901a\u4fe1\u3002\\n\\n![Service Mesh \u793a\u610f\u56fe](https://static.apiseven.com/202108/1639712507435-09449e11-8862-41ff-acdf-a35f1f1562e5.png)\\n\\n\u901a\u8fc7\u4e0a\u56fe\u6211\u4eec\u53ef\u4ee5\u770b\u51fa Service Mesh \u6bd4\u8f83\u4fa7\u91cd\u4f20\u7edf\u610f\u4e49\u4e0a\u7684\u4e1c\u897f\u5411\u6d41\u91cf\uff0c\u5373\u670d\u52a1\u95f4\u7684\u6d41\u91cf\u3002\u5f53\u6211\u4eec\u5c06 Service Mesh \u4e0e Kubernetes \u914d\u5408\u4f7f\u7528\u65f6\uff0c\u4e1c\u897f\u5411\u6d41\u91cf\u5bf9\u5e94\u7684\u5219\u662f Kubernetes \u96c6\u7fa4\u5185\u7684\u6d41\u91cf\u3002\\n\\n\u56de\u5230\u771f\u5b9e\u4f7f\u7528\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u4e0d\u4f1a\u53ea\u63a5\u89e6\u5230\u5305\u542b Kubernetes \u96c6\u7fa4\u5185\u7684\u6d41\u91cf\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u90fd\u9700\u8981\u5c06\u4e00\u4e9b\u670d\u52a1\u66b4\u9732\u5230\u96c6\u7fa4\u5916\uff0c\u4f9b\u7528\u6237\u6216\u5176\u4ed6\u670d\u52a1\u4f7f\u7528\u3002\u4f46\u5c06 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u66b4\u9732\u5230\u96c6\u7fa4\u5916\u65f6\uff0c\u6211\u4eec\u5c31\u5fc5\u987b\u8981\u8003\u8651\u8bf8\u5982\u5b89\u5168\u6027\u548c\u53ef\u89c2\u6d4b\u6027\u7b49\u76f8\u5173\u56e0\u7d20\u3002\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u901a\u8fc7\u4f7f\u7528 Istio Service Mesh \u548c Apache APISIX\uff0c\u4e3a\u5927\u5bb6\u6f14\u793a\u5982\u4f55\u5c06\u542f\u7528 Service Mesh \u7684 Kubernetes \u96c6\u7fa4\u4e2d\u670d\u52a1\u5b89\u5168\u66b4\u9732\u81f3\u96c6\u7fa4\u5916\u3002\\n\\n![\u6574\u4f53\u64cd\u4f5c\u793a\u610f\u56fe](https://static.apiseven.com/202108/1639730236819-0911b90b-811f-4451-b0e5-f89ac3e04b77.png)\\n\\n## \u7b2c\u4e00\u6b65\uff1a\u51c6\u5907 Kubernetes \u96c6\u7fa4\\n\\n\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 [Kind](https://github.com/kubernetes-sigs/kind/) \u5728\u672c\u5730\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u96c6\u7fa4\u7528\u4e8e\u6f14\u793a\u3002\u5173\u4e8e\u5982\u4f55\u901a\u8fc7 Kind \u547d\u4ee4\u8fdb\u884c\u5b89\u88c5\u53ef\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://kind.sigs.k8s.io/docs/user/quick-start/#installation)\u3002\\n\\n\u4ee5\u4e0b\u4e3a\u7528\u4e8e\u521b\u5efa\u6f14\u793a\u96c6\u7fa4\u6240\u4f7f\u7528\u7684 yaml \u914d\u7f6e\u6587\u4ef6\uff0c\u5c06\u5176\u4fdd\u5b58\u4e3a `kind-config.yaml`\u3002\\n\\n```yaml\\nkind: Cluster\\napiVersion: kind.x-k8s.io/v1alpha4\\nnodes:\\n- role: control-plane\\n- role: worker\\n- role: worker\\n- role: worker\\n```\\n\\n\u7136\u540e\u4f7f\u7528\u6b64\u914d\u7f6e\u6587\u4ef6\u521b\u5efa\u4e00\u4e2a\u96c6\u7fa4\u3002\\n\\n```bash\\n(MoeLove) \u279c kind create cluster --config kind-config.yaml\\nCreating cluster \\"kind\\" ...\\n \u2713 Ensuring node image (kindest/node:v1.22.2) \ud83d\uddbc\\n \u2713 Preparing nodes \ud83d\udce6 \ud83d\udce6 \ud83d\udce6 \ud83d\udce6\\n \u2713 Writing configuration \ud83d\udcdc\\n \u2713 Starting control-plane \ud83d\udd79\ufe0f\\n \u2713 Installing CNI \ud83d\udd0c\\n \u2713 Installing StorageClass \ud83d\udcbe\\n \u2713 Joining worker nodes \ud83d\ude9c\\nSet kubectl context to \\"kind-kind\\"\\nYou can now use your cluster with:\\n\\nkubectl cluster-info --context kind-kind\\n\\nNot sure what to do next? \ud83d\ude05  Check out https://kind.sigs.k8s.io/docs/user/quick-start/\\n```\\n\\n## \u7b2c\u4e8c\u6b65\uff1a\u90e8\u7f72 Istio\\n\\n\u5728 Kubernetes \u96c6\u7fa4\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u6211\u4eec\u6765\u8fdb\u884c Istio \u7684\u76f8\u5173\u90e8\u7f72\u3002\\n\\n\u8fd9\u91cc\u5148\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a `apisix-istio` \u7684\u76ee\u5f55\uff0c\u8fdb\u5165\u8be5\u76ee\u5f55\u540e\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c\u3002\\n\\n```bash\\n(MoeLove) \u279c mkdir apisix-istio\\n(MoeLove) \u279c cd apisix-istio\\n(MoeLove) \u279c curl -sL https://istio.io/downloadIstio | sh -\\n\\nDownloading istio-1.12.1 from https://github.com/istio/istio/releases/download/1.12.1/istio-1.12.1-linux-amd64.tar.gz ...\\n\\nIstio 1.12.1 Download Complete!\\n\\nIstio has been successfully downloaded into the istio-1.12.1 folder on your system.\\n\\nNext Steps:\\nSee https://istio.io/latest/docs/setup/install/ to add Istio to your Kubernetes cluster.\\n\\nTo configure the istioctl client tool for your workstation,\\nadd the /root/apisix-istio/istio-1.12.1/bin directory to your environment path variable with:\\n         export PATH=\\"$PATH:/root/apisix-istio/istio-1.12.1/bin\\"\\n\\nBegin the Istio pre-installation check by running:\\n         istioctl x precheck\\n\\nNeed more information? Visit https://istio.io/latest/docs/setup/install/\\n```\\n\\n\u4e0a\u8ff0\u64cd\u4f5c\u6267\u884c\u5b8c\u6bd5\uff0c\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa\u51fa\u4e00\u4e2a\u65b0\u76ee\u5f55\u3002\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0a\u547d\u4ee4\u7684\u8f93\u51fa\u7ee7\u7eed\u8fdb\u884c\u64cd\u4f5c\u3002\\n\\n```bash\\n(MoeLove) \u279c ls\\nistio-1.12.1\\n(MoeLove) \u279c export PATH=\\"$PATH:/root/apisix-istio/istio-1.12.1/bin\\"\\n(MoeLove) \u279c istioctl x precheck\\n\u2714 No issues found when checking the cluster. Istio is safe to install or upgrade!\\n  To get started, check out https://istio.io/latest/docs/setup/getting-started/\\n```\\n\\n\u63a5\u4e0b\u6765\u5f00\u59cb\u8fdb\u884c\u771f\u6b63\u7684\u90e8\u7f72\u64cd\u4f5c\u3002\u5c06\u5176\u8bbe\u7f6e `--set profile=minimal` \u8fdb\u884c\u6700\u5c0f\u5316\u5b89\u88c5\u5373\u53ef\u3002\\n\\n```bash\\n(MoeLove) \u279c istioctl install --set profile=minimal  -y\\n\u2714 Istio core\\ninstalled\\n\\n\u2714 Istiod\\ninstalled\\n\\n\u2714 Installation\\ncomplete\\n\\nMaking this installation the default for injection and validation.\\n\\nThank you for installing Istio 1.12.  Please take a few minutes to tell us about your install/upgrade experience!  https://forms.gle/FegQbc9UvePd4Z9z7\\n```\\n\\n\u6700\u540e\u68c0\u67e5\u5f53\u524d\u7684\u90e8\u7f72\u72b6\u6001\uff0c\u53ef\u4ee5\u770b\u5230 Pod \u5df2\u7ecf\u5728\u8fd0\u884c\u4e2d\u4e86\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl -n istio-system get pods\\nNAME                      READY   STATUS    RESTARTS   AGE\\nistiod-58d79b7bff-g66cv   1/1     Running   0          1m\\n```\\n\\n## \u7b2c\u4e09\u6b65\uff1a\u90e8\u7f72 Apache APISIX\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u8fdb\u884c Apache APISIX \u7684\u76f8\u5173\u90e8\u7f72\u3002\\n\\n\u9996\u5148\u521b\u5efa\u540d\u4e3a `apisix-istio` \u7684 Namespace \u5e76\u5f00\u542f\u81ea\u52a8\u6ce8\u5165\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl create ns apisix-istio\\nnamespace/apisix-istio created\\n(MoeLove) \u279c kubectl label namespace apisix-istio istio-injection=enabled\\nnamespace/apisix-istio labeled\\n```\\n\\n\u63a5\u4e0b\u6765\u6dfb\u52a0 Helm Repo \u5e76\u4f7f\u7528 Helm \u8fdb\u884c Apache APISIX \u548c Apache APISIX Ingress Controller \u7684\u90e8\u7f72\u3002\\n\\n```bash\\n(MoeLove) \u279c helm repo add apisix https://charts.apiseven.com\\n\\"apisix\\" has been added to your repositories\\n(MoeLove) \u279c helm install apisix-istio apisix/apisix --set gateway.type=NodePort --set ingress-controller.enabled=true --set ingress-controller.config.apisix.serviceNamespace=apisix-istio  --set ingress-controller.config.apisix.serviceName=apisix-istio-admin  --namespace apisix-istio\\nNAME: apisix-istio\\nLAST DEPLOYED: Wed Dec 15 14:16:33 2021\\nNAMESPACE: apisix-istio\\nSTATUS: deployed\\nREVISION: 1\\nTEST SUITE: None\\nNOTES:\\n1. Get the application URL by running these commands:\\n  export NODE_PORT=$(kubectl get --namespace apisix-istio -o jsonpath=\\"{.spec.ports[0].nodePort}\\" services apisix-istio-gateway)\\n  export NODE_IP=$(kubectl get nodes --namespace apisix-istio -o jsonpath=\\"{.items[0].status.addresses[0].address}\\")\\n  echo http://$NODE_IP:$NODE_PORT\\n```\\n\\n\u6267\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u540e\uff0c\u53ef\u901a\u8fc7\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u7b49\u5f85\u6240\u6709 Pod \u5747\u6b63\u5e38\u8fd0\u884c\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl -n apisix-istio wait --for=condition=Ready pods --all\\npod/apisix-istio-7bdfcb4bd9-89jcn condition met\\npod/apisix-istio-etcd-0 condition met\\npod/apisix-istio-etcd-1 condition met\\npod/apisix-istio-etcd-2 condition met\\npod/apisix-istio-ingress-controller-5fcbb75b8c-b4nnc condition met\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u5f53\u524d Pod \u5168\u90e8\u7684\u5df2\u7ecf\u6b63\u5e38\u8fd0\u884c\u4e86\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8fdb\u884c\u76f8\u5173\u6d4b\u8bd5\u548c\u9a8c\u8bc1\u3002\\n\\n## \u6d4b\u8bd5\u73af\u8282\\n\\n### \u7b80\u5355\u6d4b\u8bd5\\n\\n\u5728\u4e4b\u524d\u4f7f\u7528 Helm \u90e8\u7f72 Apache APISIX \u65f6\uff0c\u6211\u4eec\u5c06\u670d\u52a1\u66b4\u9732\u65b9\u5f0f\u9009\u62e9\u4e3a `NodePort`\uff0c\u6240\u4ee5\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u76f4\u63a5\u8bbf\u95ee\u5230 Apache APISIX\u3002\\n\\n```bash\\n(MoeLove) \u279c export NODE_PORT=$(kubectl get --namespace apisix-istio -o jsonpath=\\"{.spec.ports[0].nodePort}\\" services apisix-istio-gateway)\\n(MoeLove) \u279c export NODE_IP=$(kubectl get nodes --namespace apisix-istio -o jsonpath=\\"{.items[0].status.addresses[0].address}\\")\\n(MoeLove) \u279c curl http://$NODE_IP:$NODE_PORT\\n{\\"error_msg\\":\\"404 Route Not Found\\"}\\n```\\n\\n\u6ce8\u610f\uff0c\u5728\u4f7f\u7528 `curl` \u547d\u4ee4\u8bf7\u6c42\u65f6\u6211\u4eec\u589e\u52a0\u4e00\u4e2a `-v` \u9009\u9879\uff0c\u67e5\u770b\u4e00\u4e0b\u8bf7\u6c42\u7684\u54cd\u5e94\u5934\u3002\\n\\n```bash\\n(MoeLove) \u279c curl -v http://$NODE_IP:$NODE_PORT\\n* Rebuilt URL to: http://172.20.0.2:31225/\\n*   Trying 172.20.0.2...\\n* TCP_NODELAY set\\n* Connected to 172.20.0.2 (172.20.0.2) port 31225 (#0)\\n> GET / HTTP/1.1\\n> Host: 172.20.0.2:31225\\n> User-Agent: curl/7.58.0\\n> Accept: */*\\n>\\n< HTTP/1.1 404 Not Found\\n< date: Wed, 15 Dec 2021 14:31:40 GMT\\n< content-type: text/plain; charset=utf-8\\n< server: istio-envoy\\n< x-envoy-upstream-service-time: 1\\n< x-envoy-decorator-operation: apisix-istio-gateway.apisix-istio.svc.cluster.local:80/*\\n< transfer-encoding: chunked\\n<\\n{\\"error_msg\\":\\"404 Route Not Found\\"}\\n* Connection #0 to host 172.20.0.2 left intact\\n```\\n\\n\u4ece\u4e0a\u8ff0\u7684\u8f93\u51fa\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u54cd\u5e94\u5934\u4e2d\u5305\u542b\u5982\u4e0b\u5185\u5bb9\uff1a\\n\\n```bash\\n< server: istio-envoy\\n< x-envoy-upstream-service-time: 1\\n< x-envoy-decorator-operation: apisix-istio-gateway.apisix-istio.svc.cluster.local:80/*\\n```\\n\\n\u8fd9\u8bf4\u660e Istio \u7684\u81ea\u52a8\u6ce8\u5165\u5df2\u7ecf\u6210\u529f\uff0c\u5f53\u524d\u76f4\u63a5\u8fdb\u884c\u4ea4\u4e92\u7684\u5e76\u4e0d\u662f Apache APISIX \u800c\u662f Istio \u7684 Sidecar\u3002\\n\\n### BookInfo \u90e8\u7f72\u6d4b\u8bd5\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528 Istio \u81ea\u5e26\u7684 BookInfo \u793a\u4f8b\u7a0b\u5e8f\u8fdb\u884c\u76f8\u5173\u6d4b\u8bd5\u9a8c\u8bc1\u3002\\n\\n\u9996\u5148\u521b\u5efa\u4e00\u4e2a Namespace\uff0c\u5e76\u5f00\u542f Istio \u7684\u81ea\u52a8\u6ce8\u5165\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl create ns bookinfo\\nnamespace/bookinfo created\\n(MoeLove) \u279c kubectl label namespace bookinfo istio-injection=enabled\\nnamespace/bookinfo labeled\\n```\\n\\n\u7136\u540e\u8fdb\u884c BookInfo \u90e8\u7f72\uff0c\u76f8\u5173\u90e8\u7f72\u6587\u4ef6\u5728\u4e0a\u8ff0\u5b89\u88c5 Istio \u8fc7\u7a0b\u4e2d\u4f1a\u81ea\u52a8\u521b\u5efa\u5728\u76ee\u5f55\u4e2d\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl -n bookinfo apply -f istio-1.12.1/samples/bookinfo/platform/kube/bookinfo.yaml\\nservice/details created\\nserviceaccount/bookinfo-details created\\ndeployment.apps/details-v1 created\\nservice/ratings created\\nserviceaccount/bookinfo-ratings created\\ndeployment.apps/ratings-v1 created\\nservice/reviews created\\nserviceaccount/bookinfo-reviews created`\\ndeployment.apps/reviews-v1 created\\ndeployment.apps/reviews-v2 created\\ndeployment.apps/reviews-v3 created\\nservice/productpage created\\nserviceaccount/bookinfo-productpage created\\ndeployment.apps/productpage-v1 created\\n```\\n\\n\u7b49\u5f85\u6240\u6709 Pod \u6b63\u5e38\u8fd0\u884c\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl -n bookinfo get pods\\nNAME                             READY   STATUS    RESTARTS   AGE\\ndetails-v1-96cf758d8-qr6p9       2/2     Running   0          64s\\nproductpage-v1-5f75dfbfb-22hcw   2/2     Running   0          64s\\nratings-v1-779dbc4fdd-jt5zp      2/2     Running   0          64s\\nreviews-v1-ffbbf7fc8-kxvrr       2/2     Running   0          64s\\nreviews-v2-54546c6f84-pnjkn      2/2     Running   0          64s\\nreviews-v3-74d6bf84cd-h4r9z      2/2     Running   0          63s\\n```\\n\\n\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u5c06\u670d\u52a1\u66b4\u9732\u5230 Kubernetes \u96c6\u7fa4\u5916\u4e86\u3002\u4f7f\u7528\u5982\u4e0b\u5185\u5bb9\u521b\u5efa\u4e00\u6761\u8def\u7531\u914d\u7f6e\uff0c\u4fdd\u5b58\u4e3a `productpage-ar.yaml`\u3002\\n\\n```yaml\\napiVersion: apisix.apache.org/v2beta2\\nkind: ApisixRoute\\nmetadata:\\n name: productpage\\nspec:\\n http:\\n - name: rule1\\n   match:\\n     hosts:\\n     - apisix-istio.dev\\n     paths:\\n       - /*\\n   backends:\\n   - serviceName: productpage\\n     servicePort: 9080\\n```\\n\\n:::note \u5907\u6ce8\\n\u4ee5\u4e0a\u914d\u7f6e\u53ef\u7406\u89e3\u4e3a\uff1a\u521b\u5efa\u4e00\u6761\u8def\u7531\uff0c\u8bbe\u7f6e\u57df\u540d\u4e3a `apisix-istio.dev` \u5e76\u5c06\u6240\u6709\u8bf7\u6c42\u6d41\u91cf\u5747\u8f6c\u53d1\u81f3 `productpage` \u670d\u52a1\u7684 `9080` \u7aef\u53e3\u3002\\n:::\\n\\n\u7136\u540e\u521b\u5efa\u6b64\u8d44\u6e90\uff1a\\n\\n```bash\\n(MoeLove) \u279c kubectl -n bookinfo apply -f productpage-ar.yaml\\napisixroute.apisix.apache.org/productpage created\\n```\\n\\n\u643a\u5e26\u6211\u4eec\u521a\u624d\u914d\u7f6e\u7684\u57df\u540d\u518d\u6b21\u8bf7\u6c42 Apache APISIX \uff0c\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u4e86 `200` \u76f8\u5173\u63d0\u793a\u3002\\n\\n```bash\\n(MoeLove) \u279c curl -I -H \\"HOST: apisix-istio.dev\\" http://$NODE_IP:$NODE_PORT/\\nHTTP/1.1 200 OK\\ncontent-type: text/html; charset=utf-8\\ncontent-length: 1683\\ndate: Wed, 15 Dec 2021 15:47:30 GMT\\nx-envoy-upstream-service-time: 7\\nserver: istio-envoy\\nx-envoy-decorator-operation: apisix-istio-gateway.apisix-istio.svc.cluster.local:80/*\\n```\\n\\n\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7 `port-forward` \u7684\u65b9\u5f0f\u5c06 Apache APISIX \u7aef\u53e3\u66b4\u9732\u51fa\u6765\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl -n apisix-istio port-forward --address 0.0.0.0 svc/apisix-istio-gateway 8080:80\\nForwarding from 0.0.0.0:8080 -> 9080\\n```\\n\\n\u6700\u540e\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbe\u7f6e `HOST: apisix-istio.dev` \u7684 Header \u5e76\u5c1d\u8bd5\u8fdb\u884c\u8bf7\u6c42\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u6240\u793a\u7684\u6b63\u786e\u9875\u9762\u4e86\u3002\\n\\n![\u6700\u7ec8\u663e\u793a\u9875\u9762](https://static.apiseven.com/202108/1639713895938-dec7460b-fa51-443e-a32e-fe2000788127.png)\\n\\n## \u53ef\u89c6\u5316\u5904\u7406\u5229\u5668\uff1aKiali\\n\\nKiali \u662f\u4e00\u4e2a\u53ef\u4ee5\u5bf9 Istio \u8fdb\u884c\u53ef\u89c6\u5316\u7684\u5de5\u5177\uff0c\u53ef\u4f5c\u4e3a Istio add-on \u8fdb\u884c\u5b89\u88c5\u3002\\n\\n\u5728\u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528 Istio \u643a\u5e26\u7684 `addons` \u76ee\u5f55\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u90e8\u7f72\u3002\\n\\n```bash\\n(MoeLove) \u279c kubectl -n istio-system apply -f  istio-1.12.1/samples/addons/\\nserviceaccount/grafana created\\nconfigmap/grafana created\\nservice/grafana created\\ndeployment.apps/grafana created\\nconfigmap/istio-grafana-dashboards created\\nconfigmap/istio-services-grafana-dashboards created\\ndeployment.apps/jaeger created\\nservice/tracing created\\nservice/zipkin created\\nservice/jaeger-collector created\\nserviceaccount/kiali created\\nconfigmap/kiali created\\nclusterrole.rbac.authorization.k8s.io/kiali-viewer created\\nclusterrole.rbac.authorization.k8s.io/kiali created\\nclusterrolebinding.rbac.authorization.k8s.io/kiali created\\nrole.rbac.authorization.k8s.io/kiali-controlplane created\\nrolebinding.rbac.authorization.k8s.io/kiali-controlplane created\\nservice/kiali created\\ndeployment.apps/kiali created\\nserviceaccount/prometheus created\\nconfigmap/prometheus created\\nclusterrole.rbac.authorization.k8s.io/prometheus created\\nclusterrolebinding.rbac.authorization.k8s.io/prometheus created\\nservice/prometheus created\\ndeployment.apps/prometheus created\\n```\\n\\n\u7b49\u5f85 Pod \u6b63\u5e38\u8fd0\u884c\u540e\u67e5\u770b\uff1a\\n\\n```bash\\n(MoeLove) \u279c kubectl -n istio-system get pods\\nNAME                          READY   STATUS    RESTARTS   AGE\\ngrafana-6ccd56f4b6-wq6k5      1/1     Running   0          2m12s\\nistiod-58d79b7bff-g66cv       1/1     Running   0          42m\\njaeger-5d44bc5c5d-84ksf       1/1     Running   0          2m11s\\nkiali-79b86ff5bc-w457g        1/1     Running   0          2m3s\\nprometheus-64fd8ccd65-2mjcc   2/2     Running   0          2m9s\\n```\\n\\n\u63a5\u4e0b\u6765\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c Kiali \u7684\u7aef\u53e3\u8f6c\u53d1\u5e76\u5728\u6d4f\u89c8\u5668\u4e2d\u8fdb\u884c\u8bbf\u95ee\u3002\u5f53\u7136\u4f7f\u7528\u4e0a\u8ff0 `port-forward` \u7684\u65b9\u5f0f\u4e5f\u662f\u4e00\u6837\u7684\u3002\\n\\n```\\n(MoeLove) \u279c istioctl dashboard kiali  --address 0.0.0.0 --port 9999 --browser=false\\nhttp://0.0.0.0:9999/kiali\\nskipping opening a browser\\n```\\n\\n\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00 `http://0.0.0.0:9999/kiali`\uff0c\u540c\u65f6\u5c1d\u8bd5\u591a\u6b21\u901a\u8fc7 Apache APISIX \u8bbf\u95ee BookInfo \u670d\u52a1\uff0c\u5373\u53ef\u770b\u5230\u5982\u4e0b\u6548\u679c\u3002\\n\\n![\u8bbf\u95ee BookInfo](https://static.apiseven.com/202108/1639714083338-d5a0601e-5dcb-446d-9b25-89ec95044ebd.png)\\n\\n\u70b9\u51fb Graph \uff0c\u5c06 Namespace \u9009\u62e9\u4e3a BookInfo\u3002\u5728\u6d4b\u8bd5\u8bbf\u95ee BookInfo \u5e94\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u770b\u5230\u5982\u4e0b\u6240\u793a\u6548\u679c\u3002\u53ef\u4ee5\u770b\u5230\u6d41\u91cf\u4ece Apache APISIX \u8fdb\u6765\uff0c\u7136\u540e\u6d41\u5411\u5e94\u7528\u7a0b\u5e8f\u7684\u5404\u4e2a\u7ec4\u4ef6\u3002\\n\\n![\u6d41\u7a0b\u56fe](https://static.apiseven.com/202108/1639714198376-27882a16-751b-436d-9212-69cad379bb72.png)\\n\\n\u81f3\u6b64\uff0c\u5168\u90e8\u6d41\u7a0b\u7ed3\u675f\u3002\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u5730\u4f7f\u7528 Apache APISIX \u548c Apache APISIX Ingress Controller\uff0c\u5c06\u5f00\u542f Service Mesh \u7684 Kubernetes  \u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u5b89\u5168\u5730\u66b4\u9732\u51fa\u6765\u4e86\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u901a\u8fc7\u975e\u5e38\u8be6\u7ec6\u7684\u64cd\u4f5c\u6b65\u9aa4\uff0c\u5411\u5927\u5bb6\u4e00\u6b65\u6b65\u5730\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Istio Service Mesh \u548c Apache APISIX\uff0c\u5c06\u542f\u7528 Service Mesh \u7684 Kubernetes \u96c6\u7fa4\u4e2d\u670d\u52a1\u66b4\u9732\u81f3\u96c6\u7fa4\u5916\u3002\u540e\u7eed\u4e5f\u53ef\u4ee5\u901a\u8fc7 Apache APISIX \u4e30\u5bcc\u7684\u63d2\u4ef6\u80fd\u529b\u63d0\u4f9b\u66f4\u591a\u5b89\u5168\u9632\u62a4\u6216\u6d41\u91cf\u63a7\u5236\u3002\\n\\n\u5e0c\u671b\u901a\u8fc7\u4ee5\u4e0a\u7684\u7ec6\u8282\u6559\u5b66\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5927\u5bb6\u5728\u4f7f\u7528 Apache APISIX \u65f6\u66f4\u65b9\u4fbf\u5730\u5b9e\u73b0\u4e0e Istio \u7b49\u65b9\u6848\u8fdb\u884c\u96c6\u6210\u3002"},{"id":"\u76f4\u64ad\u9884\u544a | Apache APISIX \xd7 Apache RocketMQ \u7ebf\u4e0a\u5206\u4eab","metadata":{"permalink":"/zh/blog/2021/12/16/apisix-with-rocketmq-meetup","source":"@site/blog/2021/12/16/apisix-with-rocketmq-meetup.md","title":"\u76f4\u64ad\u9884\u544a | Apache APISIX \xd7 Apache RocketMQ \u7ebf\u4e0a\u5206\u4eab","description":"API \u7f51\u5173 Apache APISIX \u793e\u533a\u8054\u5408 Apache RockMQ \u793e\u533a\u4e3a\u5927\u5bb6\u5e26\u6765\u7ebf\u4e0a\u5206\u4eab\uff0c\u5305\u542b\u4e86\u5c0f\u7ea2\u4e66\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u8fd0\u7ef4\u5b9e\u8df5\u4e0e\u6cbb\u7406\u4e4b\u8def, \u57fa\u4e8e WASM \u7684 Apache APISIX \u591a\u8bed\u8a00\u63d2\u4ef6\u65b9\u6848\u7b49\u4e3b\u9898\u5206\u4eab\u3002","date":"2021-12-16T00:00:00.000Z","formattedDate":"2021\u5e7412\u670816\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.52,"truncated":true,"authors":[],"prevItem":{"title":"\u5229\u7528 APISIX Ingress \u5b9e\u73b0 Istio \u670d\u52a1\u7684\u5b89\u5168\u66b4\u9732","permalink":"/zh/blog/2021/12/17/exposure-istio-with-apisix-ingress"},"nextItem":{"title":"\u4e24\u79cd\u65b9\u5f0f\u6559\u4f60\u5728 K8s \u4e2d\u8f7b\u677e\u90e8\u7f72 Apache APISIX","permalink":"/zh/blog/2021/12/15/deploy-apisix-in-kubernetes"}},"content":"> 12 \u6708 26 \u65e5\uff0cApache APISIX \u793e\u533a\u8054\u5408 Apache RockMQ \u793e\u533a\u4e3a\u5927\u5bb6\u5e26\u6765\u7ebf\u4e0a\u5206\u4eab\uff0c\u5feb\u6765\u770b\u770b\u6709\u54ea\u4e9b\u7cbe\u5f69\u7684\u8bae\u9898\u5427\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n![\u6d3b\u52a8\u6d77\u62a5](https://static.apiseven.com/202108/1639618571630-50324e59-64df-4747-8139-fedc4a63a297.jpeg)\\n\\n## \u5206\u4eab\u8bae\u9898\\n\\n### Apache APISIX: Keeping Low-Bar for Devs\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u738b\u9662\u751f\uff0cApache APISIX PMC\uff0capi7.ai \u8054\u5408\u521b\u59cb\u4eba & CTO\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u6700\u8fd1\u51e0\u5e74\u5f00\u6e90\u9879\u76ee\u7edd\u5730\u800c\u8d77\uff0c\u5404\u79cd\u5404\u6837\u7684\u5f00\u6e90\u4ea7\u54c1\u8ff8\u53d1\u51fa\u5f3a\u52b2\u7684\u529b\u91cf\u3002\u751f\u6001\u5f00\u59cb\u6210\u4e3a\u5f00\u6e90\u9879\u76ee\u7684\u62a4\u57ce\u6cb3\u3002\u5982\u4f55\u9009\u62e9\u6b63\u786e\u8d5b\u9053\u6216\u8bb8\u662f\u4e4b\u540e\u7684\u5f00\u6e90\u9886\u5bfc\u8005\u5e94\u8be5\u5f00\u59cb\u8003\u8651\u7684\u95ee\u9898\u3002\\n\\n\u4ee5 Apache APISIX \u4e3a\u4f8b\uff0c\u672c\u6b21\u6f14\u8bb2\u4e5f\u4f1a\u5e26\u6765\u5173\u4e8e Apache APISIX \u7684\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u901a\u8fc7\u6b64\u6b21\u6f14\u8bb2\u53ef\u4ee5\u5145\u5206\u4e86\u89e3 Apache APISIX \u7684\u529f\u80fd\u7279\u6027\u53ca\u751f\u6001\uff0c\u8fd8\u6709\u5fc5\u4e0d\u53ef\u5c11\u7684\u6d3b\u8dc3\u793e\u533a\u6c1b\u56f4\u3002\\n\\n### \u5c0f\u7ea2\u4e66\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u8fd0\u7ef4\u5b9e\u8df5\u4e0e\u6cbb\u7406\u4e4b\u8def\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u5f20\u4ebf\u7693\uff0c\u5c0f\u7ea2\u4e66\u6d88\u606f\u4e2d\u95f4\u4ef6\u7814\u53d1\u5de5\u7a0b\u5e08\uff0c\u8d1f\u8d23\u516c\u53f8\u5185\u90e8 Kafka\u3001RocketMQ \u7684\u7814\u53d1\u548c\u6cbb\u7406\u5de5\u4f5c\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u5c0f\u7ea2\u4e66\u7684\u6d88\u606f\u4e2d\u95f4\u4ef6\u6574\u4f53\u6536\u655b\u8f83\u665a\uff0c\u9762\u5bf9\u5e9e\u5927\u7684\u4e1a\u52a1\u91cf\u548c\u7e41\u590d\u7684\u5386\u53f2\u95ee\u9898\uff0c\u5c0f\u7ea2\u4e66\u5728\u4e1a\u52a1\u5c42\u9762\u4ecd\u9700\u5728\u5176\u4ed6\u65b9\u9762\u505a\u597d\u51c6\u5907\u3002\u672c\u6b21\u6f14\u8bb2\u5c06\u4f1a\u5e26\u6765\u4ee5\u4e0b\u95ee\u9898\u7684\u63a2\u8ba8\uff0c\u6bd4\u5982\u5982\u4f55\u62c6\u89e3\u8fd0\u7ef4\u548c\u6cbb\u7406\u65b9\u5411\u5b9e\u73b0\u5728\u77ed\u65f6\u95f4\u5185\u6ee1\u8db3\u9ad8\u7a33\u5b9a\u6027\u7684\u8981\u6c42\uff1b\u5728\u540e\u7eed\u4e1a\u52a1\u8fc7\u7a0b\u4e2d\uff0c\u5728\u63d0\u9ad8\u96c6\u7fa4\u53ef\u89c6\u5316\u3001\u53ef\u8fd0\u7ef4\u548c\u53ef\u8ffd\u6eaf\u80fd\u529b\u65b9\u9762\u8fd8\u9700\u6ce8\u610f\u54ea\u4e9b\u95ee\u9898\u4ee5\u53ca\u5c0f\u7ea2\u4e66\u5185\u90e8\u5728\u6d88\u606f\u4e2d\u95f4\u4ef6\u65b9\u5411\u7684\u672a\u6765\u89c4\u5212\u3002\\n\\n### \u57fa\u4e8e WASM \u7684 Apache APISIX \u591a\u8bed\u8a00\u63d2\u4ef6\u65b9\u6848\uff08\u95ea\u7535\u6f14\u8bb2\uff09\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u7f57\u6cfd\u8f69\uff0capi7.ai \u5de5\u7a0b\u5e08\uff0cApache APISIX PMC\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u5728\u6b64\u6b21\u95ea\u7535\u6f14\u8bb2\u4e2d\uff0c\u5c06\u4f1a\u4e3a\u5927\u5bb6\u6f14\u793a\u5982\u4f55\u901a\u8fc7 WASM \u7684\u65b9\u5f0f\uff0c\u5728 Apache APISIX \u91cc\u9762\u8fd0\u884c Go \u548c Rust \u4ee3\u7801\u3002\\n\\n\u901a\u8fc7\u672c\u6b21\u6f14\u8bb2\u53ef\u4ee5\u91cd\u590d\u4e86\u89e3\u5230 WASM \u76f8\u5173\u7684\u77e5\u8bc6\uff0c\u5305\u62ec WASM \u7684\u4f18\u52bf\u548c\u5c40\u9650\u6027\uff0c\u4ee5\u53ca\u5982\u4f55\u5728\u81ea\u5df1\u7684\u7cfb\u7edf\u91cc\u5f15\u5165 WASM\u3002\\n\\n### \u653f\u91c7\u4e91\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u7070\u5ea6\u548c\u4e91\u539f\u751f\u6cbb\u7406\u4e4b\u8def\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u66fe\u6797\uff0c\u653f\u91c7\u4e91\u57fa\u7840\u5e73\u53f0\u8d1f\u8d23\u4eba\uff0c\u4e3b\u8981\u8d1f\u8d23\u516c\u53f8\u4e91\u539f\u751f\u3001\u533a\u5757\u94fe\u3001\u4eba\u5de5\u667a\u80fd\u3001\u4e2d\u95f4\u4ef6\u7b49\u6280\u672f\u65b9\u5411\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u672c\u6b21\u5206\u4eab\u5c06\u4ecb\u7ecd RocketMQ \u5982\u4f55\u52a9\u529b\u653f\u91c7\u4e91\u516c\u53f8\u5e94\u5bf9\u653f\u5e9c\u91c7\u8d2d\u4e1a\u52a1\u590d\u6742\u7684\u4e91\u3001\u5c9b\u6df7\u5408\u4e91\u573a\u666f\u3002\u901a\u8fc7\u672c\u6b21\u6f14\u8bb2\u53ef\u4ee5\u5145\u5206\u4e86\u89e3\u5230\u5982\u4f55\u5229\u7528 RocketMQ \u8fdb\u884c\u7070\u5ea6\u548c\u6d41\u91cf\u67d3\u8272\u3001\u5ef6\u8fdf\u6d88\u606f\u4e2a\u6027\u5316\u5b9a\u5236\u4ee5\u53ca\u57fa\u4e8e RocketMQ \u7684\u4e91\u539f\u751f\u8fd0\u884c\u6539\u9020\u843d\u5730\u7b49\u5b9e\u8df5\u7ecf\u9a8c\u5206\u4eab\u3002\\n\\n### \u6253\u9020\u66f4\u597d\u7528\u7684 Kubernetes Ingress Controller\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u5f20\u664b\u6d9b\uff0capi7.ai \u4e91\u539f\u751f\u6280\u672f\u4e13\u5bb6\uff0cApache APISIX committer\uff0cKubernetes ingress-nginx reviewer\u3002Containerd/Docker/Helm/Kubernetes/KIND \u7b49\u4f17\u591a\u5f00\u6e90\u9879\u76ee contributor\u3002\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u672c\u6b21\u6f14\u8bb2\u5c06\u4f1a\u5206\u4eab\u5173\u4e8e Apache APISIX Ingress Controller \u4e0a\u624b\u5b9e\u8df5\u53ca\u90e8\u5206\u5e94\u7528\u573a\u666f\u3002\u901a\u8fc7\u672c\u6b21\u6f14\u8bb2\u53ef\u4ee5\u5145\u5206\u4e86\u89e3 Apache APISIX Ingress Controller \u7684\u6838\u5fc3\u7279\u6027\u53ca\u5176\u751f\u6001\uff0c\u4ee5\u53ca\u5173\u4e8e Apache APISIX Ingress Controller \u7684\u672a\u6765\u89c4\u5212\u3002\\n\\n### \u57fa\u4e8e RocketMQ \u6784\u5efa\u8d85\u5927\u89c4\u6a21 MQTT \u670d\u52a1\u96c6\u7fa4\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u4fee\u621f\uff0c\u963f\u91cc\u4e91\u9ad8\u7ea7\u5f00\u53d1\u5de5\u7a0b\u5e08\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u901a\u8fc7\u672c\u6b21\u6f14\u8bb2\u53ef\u4ee5\u4e86\u89e3\u5982\u4f55\u57fa\u4e8e Apache RocketMQ \u6784\u5efa MQTT \u6d88\u606f\u6536\u53d1\u6a21\u578b\u4ee5\u53ca\u5982\u4f55\u5b9e\u73b0\u652f\u6301\u767e\u4e07\u8fde\u63a5\u7684\u8d85\u5927 MQTT \u670d\u52a1\u96c6\u7fa4\u3002\\n\\n## \u53c2\u4e0e\u65b9\u5f0f\\n\\n\u626b\u7801\u5173\u6ce8\u4e0b\u65b9\u89c6\u9891\u53f7\uff0c\u9884\u7ea6\u672c\u6b21\u76f4\u64ad\u3002\\n\\n![QR code](https://static.apiseven.com/202108/1639618627132-2ce4f183-4d3f-40ca-ae5f-397a48f650ae.png)\\n\\n12 \u6708 26 \u65e5\u4e0b\u5348\uff0c\u671f\u5f85\u4e0e\u60a8\u5728\u76f4\u64ad\u95f4\u76f8\u9047\uff01"},{"id":"\u4e24\u79cd\u65b9\u5f0f\u6559\u4f60\u5728 K8s \u4e2d\u8f7b\u677e\u90e8\u7f72 Apache APISIX","metadata":{"permalink":"/zh/blog/2021/12/15/deploy-apisix-in-kubernetes","source":"@site/blog/2021/12/15/deploy-apisix-in-kubernetes.md","title":"\u4e24\u79cd\u65b9\u5f0f\u6559\u4f60\u5728 K8s \u4e2d\u8f7b\u677e\u90e8\u7f72 Apache APISIX","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u76ee\u524d\u652f\u6301\u591a\u79cd\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5\u90e8\u7f72\uff0c\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u5728 Kubernetes \u73af\u5883\u4e2d\u90e8\u7f72 Apache APISIX \u4ee5\u53ca APISIX-Dashboard\u3002","date":"2021-12-15T00:00:00.000Z","formattedDate":"2021\u5e7412\u670815\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":6.94,"truncated":true,"authors":[{"name":"\u55bb\u67cf\u4ef2","title":"Author","url":"https://github.com/zaunist","image_url":"https://avatars.githubusercontent.com/u/38528079?v=4","imageURL":"https://avatars.githubusercontent.com/u/38528079?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u76f4\u64ad\u9884\u544a | Apache APISIX \xd7 Apache RocketMQ \u7ebf\u4e0a\u5206\u4eab","permalink":"/zh/blog/2021/12/16/apisix-with-rocketmq-meetup"},"nextItem":{"title":"\u4f7f\u7528 Prometheus \u76d1\u63a7 APISIX Ingress Controller","permalink":"/zh/blog/2021/12/13/monitor-apisix-ingress-controller-with-prometheus"}},"content":"> Apache APISIX \u76ee\u524d\u652f\u6301\u591a\u79cd\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5\u90e8\u7f72\uff0c\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u5728 Kubernetes \u73af\u5883\u4e2d\u90e8\u7f72 Apache APISIX \u4ee5\u53ca APISIX-Dashboard\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\n\u800c Kubernetes \u4f5c\u4e3a\u81ea\u52a8\u90e8\u7f72\u3001\u6269\u5c55\u548c\u7ba1\u7406\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u6e90\u7cfb\u7edf\uff0c\u65e8\u5728\u4e3a\u7528\u6237\u63d0\u4f9b**\u8de8\u4e3b\u673a\u96c6\u7fa4**\u7684\u81ea\u52a8\u90e8\u7f72\u3001\u6269\u5c55\u4ee5\u53ca\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u5bb9\u5668\u7b49\u76f8\u5173\u529f\u80fd\u652f\u6301\u3002\u5982\u4f55\u5feb\u901f\u5730\u5728 K8s \u4e2d\u90e8\u7f72 Apache APISIX \u5e76\u901a\u8fc7 Dashboard \u8fdb\u884c\u76f8\u5173\u4fe1\u606f\u7684\u5c55\u793a\uff0c\u8fd9\u91cc\u6211\u4eec\u4e3a\u5927\u5bb6\u6574\u7406\u4e86\u4e24\u79cd\u975e\u5e38\u5bb9\u6613\u4e0a\u624b\u7684\u5b89\u88c5\u601d\u8def\u3002\\n\\n## \u73af\u5883\u51c6\u5907\\n\\n\u5728\u6b63\u5f0f\u8fdb\u5165\u5b89\u88c5\u90e8\u7f72\u524d\uff0c\u786e\u4fdd\u7f51\u7edc\u7545\u901a\u5e76\u51c6\u5907\u597d\u76f8\u5e94\u7684 K8s \u96c6\u7fa4\u3002\\n\\n\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528 Kind \u8fdb\u884c\u672c\u5730\u642d\u5efa K8s \u96c6\u7fa4\u6d4b\u8bd5\u73af\u5883\uff0c\u975e\u5e38\u65b9\u4fbf\u4e14\u5bb9\u6613\u4e0a\u624b\u3002\u6839\u636e[\u5b98\u65b9\u6587\u6863](https://kind.sigs.k8s.io/docs/user/quick-start/)\u6b65\u9aa4\u5b89\u88c5\u597d Kind \u540e\uff0c\u53ea\u9700\u4e00\u6761\u6307\u4ee4\u5373\u53ef\u642d\u5efa\u597d K8s \u96c6\u7fa4\u73af\u5883\u3002\\n\\n```shell\\nkind create cluster\\n```\\n\\n## \u65b9\u5f0f\u4e00\uff1a\u901a\u8fc7 Helm \u5b89\u88c5\\n\\nHelm \u4e3b\u8981\u7528\u4e8e\u7ba1\u7406 Kubernetes \u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u7c7b\u4f3c apt\u3001yum\u3001pacman \u8fd9\u4e9b Linux \u4e2d\u7684\u5305\u7ba1\u7406\u5668\uff0c\u6240\u4ee5 Helm \u4e5f\u79f0\u4e3a Kubernetes \u4e2d\u7684\u5305\u7ba1\u7406\u5668\u3002\\n\\n\u76ee\u524d Apache APISIX \u5df2\u7ecf\u63d0\u4f9b\u4e86 [Helm Chart \u4ed3\u5e93](https://github.com/apache/apisix-helm-chart)\uff0c\u7528\u6237\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u901a\u8fc7 Helm \u6765\u90e8\u7f72\u548c\u5378\u8f7d Apache APISIX\u3002\\n\\n### \u90e8\u7f72 Apache APISIX\\n\\n\u9996\u5148\u6dfb\u52a0 Apache APISIX Helm Chart \u5730\u5740\u5e76\u66f4\u65b0\u4ed3\u5e93\u3002\\n\\n```shell\\nhelm repo add apisix https://charts.apiseven.com\\nhelm repo update\\n```\\n\\n\u8fdb\u884c\u5b89\u88c5 Apache APISIX\uff08\u6b64\u5904\u6f14\u793a\u662f\u5c06 Apache APISIX \u5b89\u88c5\u5230 Default Namespace\uff0c\u5982\u9700\u81ea\u5b9a\u4e49 Namespace\uff0c\u53ef\u53c2\u8003[\u76f8\u5173\u6587\u6863](https://kubernetes.io/docs/tasks/administer-cluster/namespaces/#creating-a-new-namespace)\uff09\u3002\\n\\n```shell\\nhelm install apisix apisix/apisix\\n```\\n\\n\u4e0a\u8ff0\u6307\u4ee4\u6267\u884c\u6210\u529f\u540e\uff0c\u4f1a\u5f97\u5230\u5982\u4e0b\u8fd4\u56de\u4fe1\u606f\uff1a\\n\\n```shell\\n\u25b6 helm install apisix apisix/apisix\\nNAME: apisix\\nLAST DEPLOYED: Sun Dec  5 14:43:19 2021\\nNAMESPACE: default\\nSTATUS: deployed\\nREVISION: 1\\nTEST SUITE: None\\nNOTES:\\n1. Get the application URL by running these commands:\\n  export NODE_PORT=$(kubectl get --namespace default -o jsonpath=\\"{.spec.ports[0].nodePort}\\" services apisix-gateway)\\n  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath=\\"{.items[0].status.addresses[0].address}\\")\\n  echo http://$NODE_IP:$NODE_PORT\\n```\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u65b9\u5f0f\u5b89\u88c5\u90e8\u7f72\u7684 Apache APISIX\uff0cAdmin API \u4f1a\u66b4\u9732\u5728\u96c6\u7fa4\u4e2d `9180` \u7aef\u53e3\uff0cGateway \u66b4\u9732\u5728 `80` \u7aef\u53e3\u3002\u5982\u679c\u8981\u8bbf\u95ee Admin API\uff0c\u53ef\u4ee5\u4f7f\u7528 `kubectl port-forward` \u5c06\u7aef\u53e3\u8f6c\u53d1\u5230\u672c\u5730\u4e3b\u673a\u4e0a\u7684\u7aef\u53e3\u3002\\n\\n\u8fd9\u91cc\u6f14\u793a\u7684\u662f\u8f6c\u53d1\u5230\u672c\u673a `9080` \u7aef\u53e3\u60c5\u51b5\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u548c Apache APISIX \u5b98\u65b9\u6587\u6863\u540c\u6b65\uff0c\u65b9\u4fbf\u540e\u7eed\u9a8c\u8bc1\u3002\\n\\n```shell\\nkubectl port-forward service/apisix-admin 9080:9180\\n```\\n\\n\u4e4b\u540e\u53ef\u53c2\u8003 [Apache APISIX \u5feb\u901f\u5165\u95e8\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/getting-started/)\uff0c\u8fdb\u884c Upstream \u7684\u6dfb\u52a0\u4e0e\u7ed1\u5b9a Route \u7b49\u76f8\u5173\u64cd\u4f5c\u3002\\n\\n\u6700\u540e\u8fdb\u884c\u65b0\u5efa\u8def\u7531\u7684\u9a8c\u8bc1\u73af\u8282\u3002\\n\\n\u7531\u4e8e\u5728\u672c\u6587\u6f14\u793a\u4e2d\u4f7f\u7528\u4e86 Kind \u6765\u642d\u5efa\u672c\u5730 K8s \u96c6\u7fa4\uff0c`apisix-gateway` \u7684 NodePort \u8bbf\u95ee\u4e0d\u4e86\uff0c\u6240\u4ee5\u5728\u9a8c\u8bc1\u4e4b\u524d\u8fd8\u9700\u8981\u989d\u5916\u4e00\u6b65\uff0c\u5373\u5c06\u96c6\u7fa4\u4e2d\u7684 `80` \u7aef\u53e3\u8f6c\u53d1\u5230\u672c\u673a `8080` \u7aef\u53e3\u3002\\n\\n```shell\\nkubectl port-forward service/apisix-gateway 8080:80\\n```\\n\\n\u5f00\u59cb\u8fdb\u884c\u9a8c\u8bc1\u3002\\n\\n```shell\\ncurl -X GET \\"http://127.0.0.1:8080/get?foo1=bar1&foo2=bar2\\" -H \\"Host: httpbin.org\\"\\n```\\n\\n\u671f\u671b\u7684\u8fd4\u56de\u7ed3\u679c\u53ef\u4ee5\u53c2\u8003\u4e0b\u65b9\u793a\u4f8b\u3002\\n\\n```json\\n{\\n  \\"args\\": {\\n    \\"foo1\\": \\"bar1\\",\\n    \\"foo2\\": \\"bar2\\"\\n  },\\n  \\"headers\\": {\\n    \\"Accept\\": \\"*/*\\",\\n    \\"Accept-Encoding\\": \\"gzip\\",\\n    \\"Host\\": \\"httpbin.org\\",\\n    \\"User-Agent\\": \\"curl/7.64.1\\",\\n    \\"X-Amzn-Trace-Id\\": \\"Root=1-61ac63b5-348d3c5567db393462cd0666\\",\\n    \\"X-Forwarded-Host\\": \\"httpbin.org\\"\\n  },\\n  \\"origin\\": \\"127.0.0.1, 192.46.208.201\\",\\n  \\"url\\": \\"http://httpbin.org/get?foo1=bar1&foo2=bar2\\"\\n}\\n```\\n\\n### \u90e8\u7f72 Apache APISIX-Dashboard\\n\\n\u4e0e\u90e8\u7f72 Apache APISIX \u4e00\u6837\uff0c\u901a\u8fc7 Helm \u5b89\u88c5 Apache APISIX-Dashboard \u4e5f\u53ea\u9700\u6267\u884c\u4e00\u6761\u6307\u4ee4\u3002\\n\\n```shell\\nhelm install apisix-dashboard apisix/apisix-dashboard\\n```\\n\\n\u63a5\u4e0b\u6765\u8f6c\u53d1 Dashboard \u7aef\u53e3\u5230\u672c\u673a\u3002\\n\\n```shell\\nkubectl port-forward service/apisix-dashboard 8080:80\\n```\\n\\n\u6700\u540e\u8bbf\u95ee\u672c\u5730 `localhost:8080` \u5c31\u53ef\u4ee5\u770b\u5230\u767b\u5f55\u9875\u9762\u4e86\u3002\\n\\n:::note \u6ce8\u610f\\n\u8fd9\u91cc\u90e8\u7f72\u51fa\u6765\u7684 Apache APISIX-Dashboard \u7cfb\u7edf\u4fe1\u606f\u4e2d\u4e0d\u4f1a\u51fa\u73b0 Apache APISIX \u7684\u8282\u70b9\u4fe1\u606f\u3002\u56e0\u4e3a\u901a\u8fc7 Helm \u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5\u7684\u8bdd\u9ed8\u8ba4\u662f\u6ca1\u6709\u542f\u7528 `server-info` \u63d2\u4ef6\uff0c\u5982\u6709\u9700\u8981\u53ef\u5728 apisix \u7684configmap \u4e2d\u81ea\u884c\u6dfb\u52a0\u3002`server-info` \u7684\u914d\u7f6e\u53ef\u53c2\u8003[\u76f8\u5173\u6587\u6863](https://apisix.apache.org/docs/apisix/plugins/server-info/)\u3002\\n:::\\n\\n## \u65b9\u5f0f\u4e8c\uff1a\u901a\u8fc7 yaml \u6587\u4ef6\u90e8\u7f72\\n\\n\u76f8\u8f83\u4e8e\u4e0a\u8ff0 Helm \u65b9\u5f0f\u7684\u90e8\u7f72\uff0c\u4f7f\u7528 yaml \u6587\u4ef6\u6765\u90e8\u7f72 Apache APISIX\uff0c\u53ef\u4ee5\u66f4\u52a0\u65b9\u4fbf\u5730\u8fdb\u884c\u81ea\u5b9a\u4e49\u914d\u7f6e\u3002\\n\\n### \u90e8\u7f72 APISIX \u53ca Dashboard\\n\\n:::note \u6ce8\u610f\\n\u5982\u679c\u5df2\u7ecf\u4f7f\u7528\u65b9\u5f0f\u4e00\u90e8\u7f72\u8fc7\uff0c\u5728\u8fdb\u884c\u4e0b\u8ff0\u5b89\u88c5\u524d\u9700\u8981\u5148\u6e05\u9664 ETCD \u7684 PVC \u5b58\u50a8\u4ee5\u65b9\u4fbf\u540e\u7eed\u64cd\u4f5c\u3002\\n:::\\n\\n\u8fd9\u91cc\u6211\u4eec\u5df2\u7ecf\u6574\u7406\u597d\u4e86\u5728\u90e8\u7f72 Apache APISIX\u3001APISIX-Dashboard \u53ca etcd \u96c6\u7fa4\u65f6\u9700\u8981\u7528\u5230\u7684 yaml \u6587\u4ef6\uff0c\u5927\u5bb6\u53ef\u901a\u8fc7 [apisix-on-kubernetes \u4ed3\u5e93](https://github.com/zaunist/apisix-on-kubernetes)\u8fdb\u884c\u8c03\u7528\u63a5\u4e0b\u6765\u63d0\u5230\u7684\u76f8\u5173\u6587\u4ef6\u3002\\n\\n\u9996\u5148\u514b\u9686\u4e0a\u8ff0\u63d0\u5230\u7684 `apisix-on-kubernetes` \u4ed3\u5e93\u3002\\n\\n```shell\\ngit clone https://github.com/zaunist/apisix-on-kubernetes.git\\n```\\n\\n\u7136\u540e\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002\\n\\n```shell\\nkubectl apply -f etcd.yaml\\nkubectl apply -f apisix.yaml\\nkubectl apply -f apisix-dashboard.yaml\\n```\\n\\n\u7b49\u5f85 Pod \u5168\u90e8\u542f\u52a8\uff0c\u5c06 `apisix-dashboard` \u7aef\u53e3\u8f6c\u53d1\u5230\u672c\u673a\u3002\\n\\n```shell\\nkubectl port-forward service/apisix-dashboard 8080:80\\n```\\n\\n\u6700\u540e\u8bbf\u95ee `localhost:8080`\uff0c\u5373\u53ef\u67e5\u770b Dashboard \u76f8\u5173\u4fe1\u606f\u3002\u9ed8\u8ba4\u767b\u5f55\u8d26\u53f7\u5bc6\u7801\u4e3a `admin`\u3001`admin`\u3002\\n\\n:::tip \u63d0\u793a\\n\u5728\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4e3a\u4e86\u66f4\u76f4\u89c2\u5730\u770b\u5230\u90e8\u7f72\u60c5\u51b5\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5229\u7528 [Kubernetes Dashboard](https://github.com/kubernetes/dashboard) \u5728\u7f51\u9875\u7aef\u67e5\u770b Pod \u7684\u8fd0\u884c\u60c5\u51b5\u3002\\n:::\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4ecb\u7ecd\u4e86\u4e24\u79cd\u5728 Kubernetes \u4e2d\u90e8\u7f72 Apache APISIX \u548c Apache APISIX-Dashboard \u7684\u65b9\u5f0f\u3002\u4e24\u79cd\u65b9\u5f0f\u7684\u6700\u7ec8\u76ee\u7684\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4f46\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u4e5f\u5404\u6709\u5404\u7684\u4f18\u52bf\u3002\\n\\n\u6bd4\u5982\u4f7f\u7528 Helm \u8fdb\u884c\u5b89\u88c5\u975e\u5e38\u65b9\u4fbf\uff0c\u4ec5\u9700\u51e0\u6761\u6307\u4ee4\u5c31\u53ef\u6267\u884c\u6240\u6709\u64cd\u4f5c\uff1b\u901a\u8fc7 YAML \u6587\u4ef6\u90e8\u7f72\u5219\u6bd4\u8f83\u65b9\u4fbf\u5730\u8fdb\u884c\u76f8\u5173\u81ea\u5b9a\u4e49\u914d\u7f6e\u7684\u4fee\u6539\uff0c\u66f4\u5177\u6709\u53ef\u64cd\u63a7\u6027\u3002\\n\\n\u5177\u4f53\u5728\u5b9e\u9645\u573a\u666f\u4e2d\u5982\u4f55\u8fdb\u884c Apache APISIX \u7684\u5b89\u88c5\u4e0e\u90e8\u7f72\uff0c\u8fd8\u8981\u770b\u5927\u5bb6\u7684\u4f7f\u7528\u4e60\u60ef\uff0c\u8fd9\u91cc\u4e5f\u4ec5\u4e3a\u5927\u5bb6\u63d0\u4f9b\u4e86\u4e24\u79cd\u601d\u8def\u8fdb\u884c\u53c2\u8003\u3002\u5e0c\u671b\u5404\u4f4d\u5728\u540e\u7eed\u4f7f\u7528 Apache APISIX \u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u5f00\u53d1\u51fa\u66f4\u591a\u6709\u8da3\u7684\u6280\u5de7\u548c\u65b9\u6cd5\u3002"},{"id":"\u4f7f\u7528 Prometheus \u76d1\u63a7 APISIX Ingress Controller","metadata":{"permalink":"/zh/blog/2021/12/13/monitor-apisix-ingress-controller-with-prometheus","source":"@site/blog/2021/12/13/monitor-apisix-ingress-controller-with-prometheus.md","title":"\u4f7f\u7528 Prometheus \u76d1\u63a7 APISIX Ingress Controller","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 Prometheus \u76d1\u63a7 Apache APISIX Ingress Controller \u7684\u76f8\u5173\u6b65\u9aa4\u548c\u90e8\u5206\u6307\u6807\u7684\u5c55\u793a\u6548\u679c\uff0c\u5e76\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u76f8\u5173\u76d1\u63a7\u6307\u6807\u7684\u5b9a\u4e49\u3002","date":"2021-12-13T00:00:00.000Z","formattedDate":"2021\u5e7412\u670813\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.675,"truncated":true,"authors":[{"name":"\u5f20\u8d85","title":"Author","url":"https://github.com/tokers","image_url":"https://avatars.githubusercontent.com/u/10428333?v=4","imageURL":"https://avatars.githubusercontent.com/u/10428333?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u4e24\u79cd\u65b9\u5f0f\u6559\u4f60\u5728 K8s \u4e2d\u8f7b\u677e\u90e8\u7f72 Apache APISIX","permalink":"/zh/blog/2021/12/15/deploy-apisix-in-kubernetes"},"nextItem":{"title":"\u5982\u4f55\u5728 Apache APISIX \u4e2d\u96c6\u6210 Keycloak \u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1","permalink":"/zh/blog/2021/12/10/integrate-keycloak-auth-in-apisix"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 Prometheus \u76d1\u63a7 APISIX Ingress Controller \u7684\u76f8\u5173\u6b65\u9aa4\u548c\u90e8\u5206\u6307\u6807\u7684\u5c55\u793a\u6548\u679c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u65e0\u8bba\u662f\u4e4b\u524d\u5355\u4f53\u5e94\u7528\u7684\u65f6\u4ee3\uff0c\u6216\u662f\u4e91\u539f\u751f\u5927\u884c\u5176\u9053\u7684\u4eca\u5929\uff0c\u300c\u76d1\u63a7\u529f\u80fd\u300d\u4e00\u76f4\u626e\u6f14\u7740\u5341\u5206\u91cd\u8981\u7684\u89d2\u8272\u3002\u4e00\u4e2a\u826f\u597d\u7684\u76d1\u63a7\u4f53\u7cfb\u80fd\u591f\u5e2e\u52a9\u5de5\u7a0b\u5e08\u4eec\u5feb\u901f\u4e86\u89e3\u8fd0\u884c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u7684\u670d\u52a1\u72b6\u6001\uff0c\u5e76\u5728\u670d\u52a1\u5f02\u5e38\u65f6\u5feb\u901f\u5b9a\u4f4d\u95ee\u9898\u6216\u8005\u63d0\u524d\u9884\u8b66\u5f02\u5e38\u7684\u53d1\u751f\u3002\\n\\nApache APISIX Ingress Controller \u5728\u6700\u8fd1\u51e0\u4e2a\u7248\u672c\u4e2d\u52a0\u5f3a\u4e86\u5bf9 Prometheus Metrics \u7684\u652f\u6301\u3002\u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Prometheus \u6536\u96c6 APISIX Ingress Controller \u7684 Metrics \u6570\u636e\uff0c\u5e76\u901a\u8fc7 Grafana \u8fdb\u884c\u540e\u7eed\u53ef\u89c6\u5316\u5448\u73b0\u3002\\n\\n## \u6b65\u9aa4\u4e00\uff1a\u5b89\u88c5 APISIX Ingress Controller\\n\\n\u9996\u5148\u6211\u4eec\u901a\u8fc7 [Helm](https://helm.sh/) \u5c06 Apache APISIX\u3001ETCD \u548c APISIX Ingress Controller \u90e8\u7f72\u5230\u672c\u5730\u7684 Kubernetes \u96c6\u7fa4\u4e2d\u3002\\n\\n```shell\\nhelm repo add apisix https://charts.apiseven.com\\nhelm repo update\\nkubectl create namespace ingress-apisix\\nhelm install apisix apisix/apisix --namespace ingress-apisix \\\\\\n --set ingress-controller.enabled=true\\n```\\n\\n\u5b89\u88c5\u5b8c\u6bd5\u540e\u8bf7\u7b49\u5f85\uff0c\u76f4\u81f3\u6240\u6709\u670d\u52a1\u90fd\u5df2\u6b63\u5e38\u8fd0\u884c\u3002\u5177\u4f53\u72b6\u6001\u786e\u8ba4\u53ef\u901a\u8fc7\u4e0b\u8ff0\u547d\u4ee4\u8fdb\u884c\u68c0\u67e5\u3002\\n\\n```shell\\nkubectl get all -n ingress-apisix\\n```\\n\\n## \u6b65\u9aa4\u4e8c\uff1a\u542f\u7528 Prometheus \u63d2\u4ef6\\n\\n\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u76d1\u63a7\u529f\u80fd\u7684\u6d89\u53ca\u9762\u80af\u5b9a\u4e0d\u6b62 APISIX Ingress Controller \u8fd9\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5982\u679c\u9700\u8981\u540c\u65f6\u76d1\u63a7 Apache APISIX\uff0c\u53ef\u4ee5\u521b\u5efa\u4ee5\u4e0b `ApisixClusterConfig` \u8d44\u6e90\u3002\\n\\n```yaml\\napiVersion: apisix.apache.org/v2alpha1\\nkind: ApisixClusterConfig\\nmetadata:\\n  name: default\\nspec:\\n  monitoring:\\n    prometheus:\\n      enable: true\\n```\\n\\n### \u5b89\u88c5 Prometheus \u548c Grafana\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u901a\u8fc7 Prometheus Operator \u6765\u542f\u7528 Prometheus \u670d\u52a1\uff0c\u56e0\u6b64\u9700\u8981\u5148\u5b89\u88c5 Prometheus Operator\u3002\\n\\n:::note \u6ce8\u610f\\n\u4e0b\u8ff0\u547d\u4ee4\u540c\u65f6\u4e5f\u4f1a\u5b89\u88c5 Grafana\\n:::\\n\\n```shell\\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\\nheml repo update\\nkubectl create namespace prometheus\\nhelm install prometheus prometheus-community/kube-prometheus-stack -n prometheus\\n```\\n\\n\u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u9700\u8981\u51c6\u5907 Prometheus \u5b9e\u4f8b\u7684 RBAC \u914d\u7f6e\u3002\u8be5\u914d\u7f6e\u53ef\u8d4b\u4e88 Prometheus \u5b9e\u4f8b\u5411 Kubernetes API Server \u83b7\u53d6 Pod \u548c Service \u8d44\u6e90\u7684\u80fd\u529b\u3002\\n\\n```yaml\\napiVersion: v1\\nkind: ServiceAccount\\nmetadata:\\n  name: ingress-apisix\\n  namespace: ingress-apisix\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRole\\nmetadata:\\n  name: ingress-apisix\\nrules:\\n- apiGroups: [\\"\\"]\\n  resources:\\n  - nodes\\n  - nodes/metrics\\n  - services\\n  - endpoints\\n  - pods\\n  verbs: [\\"get\\", \\"list\\", \\"watch\\"]\\n- apiGroups: [\\"\\"]\\n  resources:\\n  - configmaps\\n  verbs: [\\"get\\"]\\n- apiGroups:\\n  - networking.k8s.io\\n  resources:\\n  - ingresses\\n  verbs: [\\"get\\", \\"list\\", \\"watch\\"]\\n- nonResourceURLs: [\\"/metrics\\"]\\n  verbs: [\\"get\\"]\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRoleBinding\\nmetadata:\\n  name: ingress-apisix\\nroleRef:\\n  apiGroup: rbac.authorization.k8s.io\\n  kind: ClusterRole\\n  name: ingress-apisix\\nsubjects:\\n- kind: ServiceAccount\\n  name: ingress-apisix\\n  namespace: ingress-apisix\\n```\\n\\n\u5b8c\u6210\u4e0a\u8ff0\u5b9e\u4f8b\u914d\u7f6e\u540e\uff0c\u9700\u8981\u5b9a\u4e49 PodMonitor\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u573a\u666f\u9700\u6c42\u9009\u62e9\u4f7f\u7528 ServiceMonior\u3002\u4e0b\u8ff0 PodMonitor \u8d44\u6e90\u5c06\u805a\u7126\u4e8e APISIX Ingress Controller Pod \u7684 Metrics \u6536\u96c6\u3002\\n\\n```yaml\\napiVersion: monitoring.coreos.com/v1\\nkind: PodMonitor\\nmetadata:\\n  name: ingress-apisix\\n  namespace: ingress-apisix\\n  labels:\\n    use-for: ingress-apisix\\nspec:\\n  selector:\\n    matchLabels:\\n      app.kubernetes.io/name: ingress-controller\\n  podMetricsEndpoints:\\n  - port: http\\n```\\n\\n:::note \u989d\u5916\u8bf4\u660e\\n\u8fd9\u91cc\u4e0d\u4f7f\u7528 ServiceMonitor \u7684\u539f\u56e0\u662f `http` \u8fd9\u4e00\u7aef\u53e3\u6ca1\u6709\u66b4\u9732\u5230 Service \u7ea7\u522b\u3002\\n:::\\n\\n\u6700\u540e\u53ef\u901a\u8fc7\u4e0b\u8ff0\u6307\u4ee4\u8fdb\u884c Prometheus \u5b9e\u4f8b\u7684\u5b9a\u4e49\u3002\\n\\n```yaml\\napiVersion: monitoring.coreos.com/v1\\nkind: Prometheus\\nmetadata:\\n  name: ingress-apisix\\n  namespace: ingress-apisix\\nspec:\\n  serviceAccountName: ingress-apisix\\n  podMonitorSelector:\\n    matchLabels:\\n      use-for: ingress-apisix\\n  resources:\\n    requests:\\n      memory: 400Mi\\n  enableAdminAPI: false\\n  image: prom/prometheus:v2.31.0\\n```\\n\\n\u5c06\u4e0a\u8ff0\u8d44\u6e90\u5168\u90e8\u5e94\u7528\u5230 Kubernetes \u96c6\u7fa4\u540e\uff0c\u7b49\u5f85\u76f8\u5173\u7ec4\u4ef6\u5c31\u7eea\u3002\\n\\n## \u6b65\u9aa4\u4e09\uff1a\u914d\u7f6e Grafana\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u901a\u8fc7\u914d\u7f6e Grafana \u8fdb\u884c\u53ef\u89c6\u5316\u5448\u73b0\u3002\\n\\n\u9996\u5148\u8bbf\u95ee `prometheus-grafana` \u670d\u52a1\u3002\u6ce8\u610f\uff0c\u5982\u679c\u6ca1\u6709\u66b4\u9732 Service \u5230\u96c6\u7fa4\u5916\u90e8\u7684\u624b\u6bb5\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u7aef\u53e3\u8f6c\u53d1\u7684\u65b9\u5f0f\uff0cGrafana \u7684\u7ba1\u7406\u5458\u7528\u6237\u540d\u548c\u5bc6\u7801\u4fdd\u5b58\u5728 `prometheus-grafana` \u8fd9\u4e00 Secret \u4e2d\u3002\\n\\n\u6253\u5f00 Grafana \u540e\uff0c\u5bfc\u5165 APISIX Ingress Controller \u7684 [Dashboard \u6a21\u7248](https://raw.githubusercontent.com/apache/apisix-ingress-controller/22e548bc267115ccd36aec4200d5399aab565958/docs/assets/other/json/apisix-ingress-controller-grafana.json)\u5373\u53ef\u770b\u5230\u76d1\u63a7\u5927\u76d8\uff0c\u6548\u679c\u56fe\u5982\u4e0b\uff1a\\n\\n![\u6548\u679c\u56fe1](https://static.apiseven.com/202108/1639381275740-d9e3b2a7-6895-43f2-8119-212ea616dddd.png)\\n\\n![\u6548\u679c\u56fe2](https://static.apiseven.com/202108/1639381348652-7fb30365-179c-4b68-a168-ec3c9da7324d.png)\\n\\n![\u6548\u679c\u56fe3](https://static.apiseven.com/202108/1639381376926-d6af92c7-16dd-4306-8931-9b83e7e8dce1.png)\\n\u521b\u5efa Dashboard \u6a21\u7248\u53ef\u53c2\u8003[\u76f8\u5173 PR](https://github.com/apache/apisix-ingress-controller/pull/731)\u3002\\n\\n## \u8865\u5145\uff1a\u76d1\u63a7\u6307\u6807\u91ca\u4e49\\n\\n\u76ee\u524d APISIX Ingress Controller \u7684\u76d1\u63a7\u6307\u6807\u805a\u7126\u4e8e\u5b83\u548c\u6570\u636e\u9762 Apache APISIX \u5b9e\u4f8b\u7684\u4ea4\u4e92\uff08\u914d\u7f6e\u4e0b\u53d1\uff09\u4e0a\uff0c\u5305\u62ec\u914d\u7f6e\u540c\u6b65\u7684\u6570\u91cf\u4e0e\u5ef6\u8fdf\u7b49\u76f8\u5173\u6570\u636e\u3002\\n\\n- `is_leader`\uff1a\u5f53\u524d APISIX Ingress Controller \u5b9e\u4f8b\u662f\u5426\u4e3a Leader \u89d2\u8272\u3002\u540c\u4e00\u7ec4 APISIX Ingress Controller \u53ea\u4f1a\u6709\u4e00\u4e2a Leader\uff0c\u5176\u4f59\u5b9e\u4f8b\u5747\u4e3a Candidate\u3002\\n- `sync_operations`\uff1a\u5305\u62ec APISIX Ingress Controller \u5411\u6570\u636e\u9762\u540c\u6b65\u914d\u7f6e\u65f6\u7684\u4e00\u4e9b\u6307\u6807\uff0c\u5305\u62ec\u63a8\u9001\u6b21\u6570\u3001\u5931\u8d25\u7387\u3001\u5ef6\u8fdf\u7b49\u3002\u901a\u8fc7\u8fd9\u7c7b\u6307\u6807\u53ef\u4ee5\u76d1\u63a7\u914d\u7f6e\u4e0b\u53d1\u662f\u5426\u6b63\u5e38\uff0c\u4ee5\u6b64\u6765\u5e2e\u52a9\u7814\u53d1\u548c\u8fd0\u7ef4\u540c\u5b66\u8fdb\u884c\u76d1\u63a7\u9884\u8b66\u548c\u6545\u969c\u5b9a\u4f4d\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 Prometheus \u76d1\u63a7 APISIX Ingress Controller \u7684\u76f8\u5173\u6b65\u9aa4\u548c\u90e8\u5206\u6307\u6807\u7684\u5c55\u793a\u6548\u679c\u3002\u76ee\u524d\u53ea\u5305\u542b\u4e86\u4e00\u4e9b\u57fa\u672c\u7684\u76d1\u63a7\u6307\u6807\uff0c\u6211\u4eec\u4f1a\u5728\u540e\u7eed\u7ee7\u7eed\u8fdb\u884c\u6253\u78e8\u548c\u5347\u7ea7\uff0c\u589e\u52a0\u66f4\u591a\u7684\u6307\u6807\u9879\u548c\u96c6\u6210\u6570\u636e\u9762 APISIX \u7684\u6307\u6807\uff0c\u4e3a\u5927\u5bb6\u5e26\u6765\u66f4\u597d\u7684\u76d1\u63a7\u4f53\u9a8c\u3002\\n\\n\u5f53\u7136\u4e5f\u6b22\u8fce\u611f\u5174\u8da3\u7684\u670b\u53cb\u53c2\u4e0e [Apache APISIX Ingress Controller \u9879\u76ee](https://github.com/apache/apisix-ingress-controller)\u7684\u4ee3\u7801\u8d21\u732e\u4e2d\u6765\uff0c\u671f\u5f85\u6211\u4eec\u4e00\u8d77\u5c06 APISIX Ingress Controller \u6253\u9020\u5730\u66f4\u52a0\u5168\u9762\u5316\u3002"},{"id":"\u5982\u4f55\u5728 Apache APISIX \u4e2d\u96c6\u6210 Keycloak \u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1","metadata":{"permalink":"/zh/blog/2021/12/10/integrate-keycloak-auth-in-apisix","source":"@site/blog/2021/12/10/integrate-keycloak-auth-in-apisix.md","title":"\u5982\u4f55\u5728 Apache APISIX \u4e2d\u96c6\u6210 Keycloak \u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1","description":"\u901a\u8fc7 API \u7f51\u5173 Apache APISIX \u7684 openid-connect \u63d2\u4ef6\u53ef\u4ee5\u4e0e Keycloak \u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u3002\u901a\u8fc7\u8be5\u63d2\u4ef6\uff0cAPISIX \u4ec5\u9700\u901a\u8fc7\u914d\u7f6e\u5373\u53ef\u5b9e\u73b0\u5bf9\u4f7f\u7528\u8005\u548c\u5e94\u7528\u670d\u52a1\u8fdb\u884c\u8ba4\u8bc1\u4e0e\u9274\u6743\u3002","date":"2021-12-10T00:00:00.000Z","formattedDate":"2021\u5e7412\u670810\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Authentication","permalink":"/zh/blog/tags/authentication"}],"readingTime":7.645,"truncated":true,"authors":[{"name":"\u6731\u6b23\u6b23","title":"Author","url":"https://github.com/starsz","image_url":"https://avatars.githubusercontent.com/u/25628854?v=4","imageURL":"https://avatars.githubusercontent.com/u/25628854?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u4f7f\u7528 Prometheus \u76d1\u63a7 APISIX Ingress Controller","permalink":"/zh/blog/2021/12/13/monitor-apisix-ingress-controller-with-prometheus"},"nextItem":{"title":"API \u7f51\u5173 APISIX \u96c6\u6210 RocketMQ \u6269\u5c55\u65e5\u5fd7\u76d1\u63a7\u529f\u80fd","permalink":"/zh/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin"}},"content":"> \u672c\u6587\u901a\u8fc7\u8be6\u7ec6\u7684\u6b65\u9aa4\u4e3a\u5927\u5bb6\u5c55\u793a\u4e86\u5982\u4f55\u5728 Apache APISIX \u4f7f\u7528 OpenID-Connect \u534f\u8bae\u548c Keycloak \u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u3002\u901a\u8fc7\u5bf9\u63a5 Keycloak\uff0cApache APISIX \u4ec5\u9700\u901a\u8fc7\u914d\u7f6e\u5373\u53ef\u5b9e\u73b0\u5bf9\u4f7f\u7528\u8005\u548c\u5e94\u7528\u670d\u52a1\u8fdb\u884c\u8ba4\u8bc1\u4e0e\u9274\u6743\uff0c\u4ece\u800c\u5927\u5927\u51cf\u5c11\u4e86\u76f8\u5173\u5f00\u53d1\u5de5\u4f5c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n<head>\\n    <link rel=\\"canonical\\" href=\\"https://www.keycloak.org/2021/12/apisix\\" />\\n</head>\\n\\n![Keycloak-APISIX \u96c6\u6210](https://static.apiseven.com/202108/1639129658486-393e8a3a-ccf2-496d-9b46-4db741bd6e55.png)\\n\\n## \u4ec0\u4e48\u662f Keycloak\\n\\n[Keycloak](https://www.keycloak.org/) \u662f\u4e00\u4e2a\u9488\u5bf9\u73b0\u4ee3\u5e94\u7528\u7a0b\u5e8f\u548c\u670d\u52a1\u7684\u5f00\u6e90\u8eab\u4efd\u548c\u8bbf\u95ee\u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u3002Keycloak \u652f\u6301\u5355\u70b9\u767b\u5f55\uff08Single-Sign On\uff09\uff0c\u56e0\u6b64\u670d\u52a1\u53ef\u4ee5\u901a\u8fc7 OpenID Connect\u3001OAuth 2.0 \u7b49\u534f\u8bae\u5bf9\u63a5 Keycloak\u3002\u540c\u65f6 Keycloak \u4e5f\u652f\u6301\u96c6\u6210\u4e0d\u540c\u7684\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\uff0c\u4f8b\u5982 Github\u3001Google \u548c Facebook \u7b49\u3002\\n\\n\u53e6\u5916 Keycloak \u4e5f\u652f\u6301\u7528\u6237\u8054\u90a6\u529f\u80fd\uff0c\u53ef\u4ee5\u901a\u8fc7 LDAP \u6216 Kerberos \u6765\u5bfc\u5165\u7528\u6237\u3002\u66f4\u591a Keycloak \u5185\u5bb9\u53ef\u4ee5\u53c2\u8003[\u5b98\u65b9\u6587\u6863\u4ecb\u7ecd](https://www.keycloak.org/documentation)\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u73af\u5883\u51c6\u5907\\n\\n\u5728\u8fdb\u884c\u5982\u4e0b\u6b65\u9aa4\u524d\uff0c\u8bf7\u786e\u4fdd\u73af\u5883\u4e2d\u5df2\u542f\u52a8 Apache APISIX\u3002\\n\\n#### \u542f\u52a8 Keycloak\\n\\n\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 `docker-compose` \u5c06 Keycloak \u4e0e\u5176\u6240\u4f9d\u8d56\u7684\u7684 PostgreSQL \u4e00\u5e76\u542f\u52a8\u3002\\n\\n```yaml\\nversion: \'3.7\'\\n\\nservices:\\n  postgres:\\n      image: postgres:12.2\\n      container_name: postgres\\n      environment:\\n        POSTGRES_DB: keycloak\\n        POSTGRES_USER: keycloak\\n        POSTGRES_PASSWORD: password\\n\\n  keycloak:\\n      image: jboss/keycloak:9.0.2\\n      container_name: keycloak\\n      environment:\\n        DB_VENDOR: POSTGRES\\n        DB_ADDR: postgres\\n        DB_DATABASE: keycloak\\n        DB_USER: keycloak\\n        DB_PASSWORD: password\\n        KEYCLOAK_USER: admin\\n        KEYCLOAK_PASSWORD: password\\n        PROXY_ADDRESS_FORWARDING: \\"true\\"\\n      ports:\\n        - 8080:8080\\n      depends_on:\\n        - postgres\\n```\\n\\n```shell\\ndocker-compose up\\n```\\n\\n\u6267\u884c\u5b8c\u6bd5\u540e\u9700\u8981\u786e\u8ba4 Keycloak \u548c PostgreSQL \u662f\u5426\u5df2\u6210\u529f\u542f\u52a8\u3002\\n\\n```shell\\ndocker-compose ps\\n```\\n\\n#### \u914d\u7f6e Keycloak\\n\\nKeycloak \u542f\u52a8\u5b8c\u6210\u4e4b\u540e\uff0c\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee \\"http://127.0.0.1:8080/auth/admin/\\"\uff0c\u5e76\u952e\u5165 `admin/password` \u8d26\u53f7\u5bc6\u7801\u8fdb\u884c\u767b\u5f55\u7ba1\u7406\u5458\u63a7\u5236\u53f0\u3002\\n\\n##### \u521b\u5efa realm\\n\\n\u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u4e3a `apisix_test_realm`\u7684 `realm`\u3002\u5728 Keycloak \u4e2d\uff0c`realm` \u662f\u4e00\u4e2a\u4e13\u95e8\u7528\u6765\u7ba1\u7406\u9879\u76ee\u7684\u5de5\u4f5c\u533a\uff0c\u4e0d\u540c `realm`\u4e4b\u95f4\u7684\u8d44\u6e90\u662f\u76f8\u4e92\u9694\u79bb\u7684\u3002\\n\\nKeycloak \u4e2d `realm` \u5206\u4e3a\u4e24\u7c7b\uff1a\u4e00\u7c7b\u662f `master realm`\uff0c\u7531 Keycloak \u521a\u542f\u52a8\u65f6\u521b\u5efa\uff0c\u7528\u4e8e\u7ba1\u7406 admin \u8d26\u53f7\u4ee5\u53ca\u521b\u5efa\u5176\u4ed6\u7684 `realm`\u3002\u7b2c\u4e8c\u7c7b\u662f `other realm`\uff0c\u7531 `master realm` \u4e2d\u7684 admin \u521b\u5efa\uff0c\u53ef\u4ee5\u5728\u8be5 `realm` \u4e2d\u8fdb\u884c\u7528\u6237\u548c\u5e94\u7528\u7684\u521b\u5efa\u5e76\u8fdb\u884c\u7ba1\u7406\u548c\u4f7f\u7528\u3002\u66f4\u591a\u7ec6\u8282\u53ef\u53c2\u8003 [Keycloak \u4e2d realm \u548c users](https://www.keycloak.org/docs/latest/getting_started/index.html#realms-and-users) \u76f8\u5173\u5185\u5bb9\u3002\\n\\n![\u521b\u5efa realm](https://static.apiseven.com/202108/1639101202459-72803240-b358-4c69-a9ca-4b6751a8547d.png)\\n\\n![\u7f16\u8f91 realm \u540d\u79f0](https://static.apiseven.com/202108/1639101243617-0498379f-392e-4837-8f37-eee558c21e3d.png)\\n\\n##### \u521b\u5efa Client\\n\\n\u63a5\u4e0b\u6765\u9700\u8981\u521b\u5efa `OpenID Connect Client`\u3002\u5728 Keycloak \u4e2d\uff0cClient \u8868\u793a\u5141\u8bb8\u5411 Keycloak \u53d1\u8d77\u8eab\u4efd\u8ba4\u8bc1\u7684\u5ba2\u6237\u7aef\u3002\\n\\n\u5728\u672c\u793a\u4f8b\u573a\u666f\u4e2d\uff0c`Apache APISIX` \u76f8\u5f53\u4e8e\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u8d1f\u8d23\u5411 Keycloak \u53d1\u8d77\u8eab\u4efd\u8ba4\u8bc1\u8bf7\u6c42\uff0c\u56e0\u6b64\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u4e3a `apisix` \u7684 Client\u3002\u5173\u4e8e Client \u66f4\u591a\u7ec6\u8282\u53ef\u53c2\u8003 [Keycloak OIDC Clients](https://www.keycloak.org/docs/latest/server_admin/#_oidc_clients)\u3002\\n\\n![\u521b\u5efa OpenID Client](https://static.apiseven.com/202108/1639101288379-9a46b92a-294e-4b40-ac7e-408284a3d0ad.png)\\n\\n![\u521b\u5efa Client \u540d\u79f0](https://static.apiseven.com/202108/1639101327347-c8ab463a-1cb0-4eb0-a26f-17d7c0c54846.png)\\n\\n##### \u914d\u7f6e Client\\n\\nClient \u521b\u5efa\u5b8c\u6210\u540e\uff0c\u9700\u8981\u4e3a Client \u914d\u7f6e Apache APISIX \u7684\u8bbf\u95ee\u7c7b\u578b\u3002\\n\\n \u5728 Keycloak \u4e2d `Access Type` \u5206\u4e3a\u4e09\u7c7b\uff1a\\n\\n1. **confidential**\u3002\u9002\u7528\u4e8e\u9700\u8981\u6267\u884c\u6d4f\u89c8\u5668\u767b\u5f55\u7684\u5e94\u7528\uff0c\u5ba2\u6237\u7aef\u4f1a\u901a\u8fc7 `client secret` \u6765\u83b7\u53d6 `access token` , \u591a\u8fd0\u7528\u4e8e\u670d\u52a1\u7aef\u6e32\u67d3\u7684 web \u7cfb\u7edf\u3002\\n2. **public**\u3002\u9002\u7528\u4e8e\u9700\u8981\u6267\u884c\u6d4f\u89c8\u5668\u767b\u5f55\u7684\u5e94\u7528\uff0c\u591a\u8fd0\u7528\u4e8e\u4f7f\u7528 vue \u548c react \u5b9e\u73b0\u7684\u524d\u7aef\u9879\u76ee\u3002\\n3. **bearer-only**\u3002\u9002\u7528\u4e8e\u4e0d\u9700\u8981\u6267\u884c\u6d4f\u89c8\u5668\u767b\u5f55\u7684\u5e94\u7528\uff0c\u53ea\u5141\u8bb8\u643a\u5e26 `bearer token` \u8bbf\u95ee\uff0c\u591a\u8fd0\u7528\u4e8e RESTful API \u7684\u4f7f\u7528\u573a\u666f\u3002\\n\\n\u66f4\u591a\u5173\u4e8e Client \u8bbe\u7f6e\u7ec6\u8282\u53ef\u53c2\u8003 [Keycloak OIDC Clients \u9ad8\u7ea7\u8bbe\u7f6e](https://www.keycloak.org/docs/latest/server_admin/#advanced-settings)\u3002\\n\\n\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528\u4e86 Apache APISIX \u4f5c\u4e3a\u670d\u52a1\u7aef\u7684 Client\uff0c \u56e0\u6b64\u53ef\u4ee5\u9009\u62e9\u7c7b\u578b\u4e00\u6216\u7c7b\u578b\u4e09\uff08\u8fd9\u91cc\u4ee5\u7c7b\u578b\u4e00\u4e3a\u4f8b\u8fdb\u884c\u6f14\u793a\uff09\u3002\\n\\n![\u914d\u7f6e Client \u7c7b\u578b](https://static.apiseven.com/202108/1639101355171-e368730b-2a72-4c4d-9397-cf4a1c8f2806.png)\\n\\n##### \u521b\u5efa User\\n\\nKeycloak \u652f\u6301\u5bf9\u63a5\u5176\u4ed6\u7b2c\u4e09\u65b9\u7684\u7528\u6237\u7cfb\u7edf\uff0c\u4f8b\u5982 Google \u548c Facebook\u3002\u6216\u8005\u4f7f\u7528 LDAP \u7684\u65b9\u5f0f\u8fdb\u884c\u5bfc\u5165\u6216\u624b\u52a8\u521b\u5efa\u7528\u6237\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u300c\u624b\u52a8\u521b\u5efa\u7528\u6237\u300d\u6765\u8fdb\u884c\u6f14\u793a\u3002\\n\\n![\u521b\u5efa\u7528\u6237](https://static.apiseven.com/202108/1639101385277-b2f578c0-e68a-4945-83ac-7a77145bb056.png)\\n\\n![\u6dfb\u52a0\u7528\u6237\u76f8\u5173\u4fe1\u606f](https://static.apiseven.com/202108/1639101406281-724bbb50-96fc-4aa8-aec1-9414f83c199d.png)\\n\\n\u5728 Credentials \u9875\u9762\u8bbe\u7f6e\u7528\u6237\u7684\u5bc6\u7801\u3002\\n\\n![\u8bbe\u7f6e\u7528\u6237\u5bc6\u7801](https://static.apiseven.com/202108/1639101430209-d289459a-5014-4a2d-864f-7917b84b1c0c.png)\\n\\n#### \u521b\u5efa\u8def\u7531\\n\\nKeycloak \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5728 Apache APISIX \u4e2d\u521b\u5efa\u8def\u7531\u5e76\u5f00\u542f `Openid-Connect` \u63d2\u4ef6\uff0c\u5177\u4f53\u5173\u4e8e\u8be5\u63d2\u4ef6\u7684\u914d\u7f6e\u6587\u6863\u53ef\u4ee5\u53c2\u8003 [Apache APISIX OpenID-Connect \u63d2\u4ef6](https://apisix.apache.org/docs/apisix/plugins/openid-connect)\u3002\\n\\n#### \u83b7\u53d6 client_id \u548c client_secret\\n\\n![\u83b7\u53d6 Client \u76f8\u5173\u4fe1\u606f](https://static.apiseven.com/202108/1639101454807-ff8c8b77-bdac-4ac6-966e-a2f5e2418b7a.png)\\n\\n\u4e0a\u56fe\u914d\u7f6e\u4e2d\uff1a\\n\\n* `client_id` \u4e3a\u4e4b\u524d\u521b\u5efa Client \u65f6\u4f7f\u7528\u7684\u540d\u79f0\uff0c\u5373 `apisix`\uff1b\\n* `client_secret` \u5219\u9700\u8981\u8fdb\u5165 Clients-apisix-Credentials \u4e2d\u83b7\u53d6\uff0c\u4f8b\u5982\uff1a`d5c42c50-3e71-4bbe-aa9e-31083ab29da4`\u3002\\n\\n#### \u83b7\u53d6 discovery \u914d\u7f6e\u9879\\n\\n![\u83b7\u53d6\u914d\u7f6e](https://static.apiseven.com/202108/1639101585273-7eb31728-fe4c-4af3-84d1-76c1a97e7e35.png)\\n\\n\u8fdb\u5165 Realm Settings-General-Endpoints \u4e2d\uff0c\u9009\u62e9 `OpenID Endpoint Configuration` \u94fe\u63a5\uff0c\u590d\u5236\u8be5\u94fe\u63a5\u6307\u5411\u7684\u5730\u5740\u3002\u4f8b\u5982\uff1a`http://127.0.0.1:8080/auth/realms/apisix_test_realm/.well-known/openid-configuration`\u3002\\n\\n##### \u521b\u5efa\u8def\u7531\u5e76\u5f00\u542f\u63d2\u4ef6\\n\\n\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u8bbf\u95ee Apache APISIX Admin \u63a5\u53e3\u6765\u521b\u5efa\u4e00\u6761\u8def\u7531\uff0c\u8bbe\u7f6e\u4e0a\u6e38\u4e3a `httpbin.org`\uff0c\u5e76\u5f00\u542f\u63d2\u4ef6 OpenID Connect \u7528\u4e8e\u8eab\u4efd\u8ba4\u8bc1\u3002\\n\\n> \u6ce8\u610f\uff1a\u5982\u679c\u521b\u5efa Client \u65f6\uff0c\u9009\u62e9 `bearer-only` \u4f5c\u4e3a `Access Type`\uff0c\u5728\u914d\u7f6e\u8def\u7531\u662f\u9700\u8981\u5c06 `bearer_only` \u8bbe\u7f6e\u4e3a true\uff0c\u6b64\u65f6\u8bbf\u95ee Apache APISIX \u5c06\u4e0d\u4f1a\u8df3\u8f6c\u5230 Keycloak \u767b\u5f55\u754c\u9762\u3002\\n\\n```shell\\ncurl  -XPOST 127.0.0.1:9080/apisix/admin/routes -H \\"X-Api-Key: edd1c9f034335f136f87ad84b625c8f1\\" -d \'{\\n    \\"uri\\":\\"/*\\",\\n    \\"plugins\\":{\\n        \\"openid-connect\\":{\\n            \\"client_id\\":\\"apisix\\",\\n            \\"client_secret\\":\\"d5c42c50-3e71-4bbe-aa9e-31083ab29da4\\",\\n            \\"discovery\\":\\"http://127.0.0.1:8080/auth/realms/apisix_test_realm/.well-known/openid-configuration\\",\\n            \\"scope\\":\\"openid profile\\",\\n            \\"bearer_only\\":false,\\n            \\"realm\\":\\"apisix_test_realm\\",\\n            \\"introspection_endpoint_auth_method\\":\\"client_secret_post\\",\\n            \\"redirect_uri\\":\\"http://127.0.0.1:9080/\\"\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"httpbin.org:80\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u8bbf\u95ee\u6d4b\u8bd5\\n\\n\u4e0a\u8ff0\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728 Apache APISIX \u4e2d\u8fdb\u884c\u76f8\u5173\u7684\u6d4b\u8bd5\u8bbf\u95ee\u4e86\u3002\\n\\n#### \u8bbf\u95ee Apache APISIX\\n\\n\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee `http://127.0.0.1:9080/image/png`\u3002\\n\\n\u7531\u4e8e\u5f00\u542f\u4e86 OpenID-Connect \u63d2\u4ef6\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e86 `bearer-only` \u4e3a `false` \u3002\u56e0\u6b64\u7b2c\u4e00\u6b21\u8bbf\u95ee\u8be5\u8def\u5f84\u65f6\uff0c Apache APISIX \u5c06\u91cd\u5b9a\u5411\u5230 Keycloak \u4e2d `apisix_test_realm` \u4e2d\u914d\u7f6e\u7684\u767b\u5f55\u754c\u9762\uff0c\u8fdb\u884c\u7528\u6237\u767b\u5f55\u8bf7\u6c42\u3002\\n\\n![\u767b\u5f55\u9875\u9762](https://static.apiseven.com/202108/1639101623370-cc668e0f-0c2c-469c-9a3e-3118c271d63f.png)\\n\\n\u8f93\u5165\u4e4b\u524d\u914d\u7f6e Keycloak \u65f6\u521b\u5efa\u7684 User peter\uff0c\u5373\u53ef\u5b8c\u6210\u7528\u6237\u767b\u5f55\u3002\\n\\n#### \u8bbf\u95ee\u6210\u529f\\n\\n\u767b\u5f55\u6210\u529f\u540e\uff0c\u6d4f\u89c8\u5668\u53c8\u4f1a\u5c06\u94fe\u63a5\u91cd\u5b9a\u5411\u5230 \\"[http://127.0.0.1:9080/image/png](http://127.0.0.1:9080/image/png)\\"\u3002\u5e76\u6210\u529f\u8bbf\u95ee\u5230\u8be5\u56fe\u7247\u5185\u5bb9\uff0c\u8be5\u5185\u5bb9\u4e0e\u4e0a\u6e38 \\"[http://httpbin.org/image/png](http://httpbin.org/image/png)\\" \u4e00\u81f4\u3002\\n\\n![\u8bbf\u95ee\u6210\u529f](https://static.apiseven.com/202108/1639101644015-6d541202-dfff-4de3-ad47-f49dd65911a6.png)\\n\\n#### \u767b\u51fa\u8d26\u53f7\\n\\n\u6d4b\u8bd5\u5b8c\u6bd5\u540e\uff0c\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee \\"http:/127.0.0.1:9080/logout\\" \u8fdb\u884c\u8d26\u53f7\u767b\u51fa\u3002\\n\\n> \u6ce8\u610f\uff1a\u767b\u51fa\u8def\u5f84\u53ef\u901a\u8fc7 OpenID-Connect \u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 `logout_path` \u6307\u5b9a\uff0c\u9ed8\u8ba4\u4e3a `logout`\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u901a\u8fc7\u8be6\u7ec6\u7684\u6b65\u9aa4\u4e3a\u5927\u5bb6\u5c55\u793a\u4e86\u5982\u4f55\u5728 Apache APISIX \u4f7f\u7528 OpenID-Connect \u534f\u8bae\u548c Keycloak \u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u3002\u901a\u8fc7\u5bf9\u63a5 Keycloak\uff0cApache APISIX \u4ec5\u9700\u901a\u8fc7\u914d\u7f6e\u5373\u53ef\u5b9e\u73b0\u5bf9\u4f7f\u7528\u8005\u548c\u5e94\u7528\u670d\u52a1\u8fdb\u884c\u8ba4\u8bc1\u4e0e\u9274\u6743\uff0c\u4ece\u800c\u5927\u5927\u51cf\u5c11\u4e86\u76f8\u5173\u5f00\u53d1\u5de5\u4f5c\u3002\\n\\n\u66f4\u591a\u5173\u4e8e Apache APISIX \u4e2d\u7684\u8eab\u4efd\u8ba4\u8bc1\u529f\u80fd\u5b9e\u73b0\u4e5f\u53ef\u53c2\u8003\u6587\u7ae0[\u300a\u4f7f\u7528 Apache APISIX \u548c Okta \u6765\u5b9e\u73b0\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u300b](https://apisix.apache.org/zh/blog/2021/08/16/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication)\u3002"},{"id":"API \u7f51\u5173 APISIX \u96c6\u6210 RocketMQ \u6269\u5c55\u65e5\u5fd7\u76d1\u63a7\u529f\u80fd","metadata":{"permalink":"/zh/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin","source":"@site/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin.md","title":"API \u7f51\u5173 APISIX \u96c6\u6210 RocketMQ \u6269\u5c55\u65e5\u5fd7\u76d1\u63a7\u529f\u80fd","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 API \u7f51\u5173 Apache APISIX \u65b0\u589e\u7684 rocketmq-logger \u65e5\u5fd7\u63d2\u4ef6\uff0c\u901a\u8fc7\u8be5\u63d2\u4ef6\u53ef\u4ee5\u5e2e\u52a9\u4f60\u5728\u4f7f\u7528 Apache APISIX \u65f6\u66f4\u65b9\u4fbf\u7684\u4e0e RocketMQ \u96c6\u7fa4\u8fde\u63a5\u3002","date":"2021-12-08T00:00:00.000Z","formattedDate":"2021\u5e7412\u67088\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":4.96,"truncated":true,"authors":[{"name":"\u4f59\u6d32","title":"Author","url":"https://github.com/yuz10","image_url":"https://avatars.githubusercontent.com/u/14816818?v=4","imageURL":"https://avatars.githubusercontent.com/u/14816818?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"\u5982\u4f55\u5728 Apache APISIX \u4e2d\u96c6\u6210 Keycloak \u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1","permalink":"/zh/blog/2021/12/10/integrate-keycloak-auth-in-apisix"},"nextItem":{"title":"API \u7f51\u5173\u96c6\u6210 SkyWalking \u6253\u9020\u5168\u65b9\u4f4d\u65e5\u5fd7\u5904\u7406","permalink":"/zh/blog/2021/12/07/apisix-integrate-skywalking-plugin"}},"content":"> \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u4ecb\u7ecd Apache APISIX \u4e0e Apache RocketMQ \u6700\u65b0\u96c6\u6210\u7684 rocketmq-logger \u63d2\u4ef6\u529f\u80fd\u4e0e\u4f7f\u7528\u4ecb\u7ecd\u3002\u501f\u52a9\u8be5\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5e2e\u52a9\u60a8\u5728\u4f7f\u7528 APISIX \u4e2d\u66f4\u65b9\u4fbf\u7684\u4e0e RocketMQ \u96c6\u7fa4\u8fde\u63a5\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache RocketMQ \u81ea 2016 \u5e74\u8d70\u5165\u5168\u7403\u5f00\u53d1\u8005\u89c6\u91ce\u4ee5\u6765\uff0c\u76ee\u524d\u5df2\u53d1\u5c55\u6210\u4e3a\u7535\u5546\u3001\u91d1\u878d\u3001\u6559\u80b2\u3001\u79d1\u6280\u7b49\u591a\u9886\u57df\u6280\u672f\u4e2d\u53f0\u7684\u6838\u5fc3\u6570\u636e\u5e95\u5ea7\u3002\\n\\n\u636e\u4e0d\u5b8c\u5168\u7edf\u8ba1\uff0c\u56fd\u5185\u7528\u6237\uff08\u5305\u62ec\u91d1\u878d\u3001\u4fdd\u9669\u3001\u8d22\u5bcc\u548c\u5238\u5546\u7b49\u5404\u9886\u57df\u767e\u5f3a\u4f01\u4e1a\uff09\u8d85\u8fc7 70% \u7684\u4f01\u4e1a\u90fd\u5728\u6838\u5fc3\u5e94\u7528\u94fe\u8def\u4e0a\u89c4\u6a21\u5316\u90e8\u7f72\u4e86 Apache RocketMQ\uff0c\u5305\u62ec\u5168\u7403  5 \u5927\u4e91\u5382\u5546\u4e5f\u7eb7\u7eb7\u4e0a\u7ebf\u4e86\u6709\u5173 Apache  RocketMQ \u7684\u4e91\u4ea7\u54c1\u670d\u52a1\u3002\\n\\n\u9664\u4e86\u5e38\u89c4\u5e94\u7528\u4e8e\u6838\u5fc3\u4e1a\u52a1\u6d88\u606f\u7684\u5904\u7406\uff0c\u4e5f\u6709\u975e\u5e38\u591a\u7684\u516c\u53f8\u5f00\u59cb\u4f7f\u7528 Apache RocketMQ \u8fdb\u884c\u65e5\u5fd7\u5904\u7406\u4e0e\u5206\u6790\u3002\\n\\n## \u63d2\u4ef6\u4ecb\u7ecd\\n\\n\u4e3a\u4e86\u6ee1\u8db3\u5e7f\u5927\u4f01\u4e1a\u7528\u6237\u5bf9\u4e8e\u65e5\u5fd7\u5904\u7406\u7684\u9700\u6c42\uff0cApache APISIX \u53d1\u5e03\u4e86\u57fa\u4e8e Apache RocketMQ \u7684\u65e5\u5fd7\u63d2\u4ef6 `rocketmq-logger`\uff0c\u652f\u6301\u5c06 API \u63a5\u53e3\u8bf7\u6c42\u65e5\u5fd7\u4ee5 JSON \u5f62\u5f0f\u63a8\u9001\u7ed9 RocketMQ \u96c6\u7fa4\u3002\\n\\n\u8be5\u63d2\u4ef6\u4f7f\u7528 RocketMQ \u539f\u751f\u652f\u6301\u7684 TCP \u534f\u8bae\uff0c\u901a\u8fc7 OpenResty \u63d0\u4f9b\u7684\u65e0\u963b\u585e TCP Socket API\uff0c\u5b9e\u73b0\u4e86\u9ad8\u5e76\u53d1\u3001\u9ad8\u6027\u80fd\u8bbf\u95ee\u7b49\u529f\u80fd\u7279\u6027\u3002\\n\\n\u540c\u65f6\uff0c\u4f7f\u7528 `rocketmq-logger` \u63d2\u4ef6\u53d1\u9001\u7684 API \u65e5\u5fd7\u683c\u5f0f\u4e0e\u5176\u4ed6\u65e5\u5fd7\u63d2\u4ef6\u76f8\u540c\uff0c\u540c\u6837\u652f\u6301\u6279\u91cf\u53d1\u9001\u65e5\u5fd7\u3001\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f\u3001\u652f\u6301\u91cd\u8bd5\u7b49\u529f\u80fd\u3002\\n\\n\u6b64\u5916\uff0c\u8be5\u63d2\u4ef6\u8fd8\u652f\u6301 TLS \u52a0\u5bc6\u4f20\u8f93\uff0c\u4ee5\u53ca\u914d\u7f6e AK\u3001SK \u8ba4\u8bc1\u65b9\u5f0f\u8bbf\u95ee Apache RocketMQ\uff0c\u6ee1\u8db3\u7528\u6237\u5bf9\u4e8e\u6570\u636e\u5b89\u5168\u7684\u9700\u6c42\u3002\\n\\n## \u5982\u4f55\u4f7f\u7528\\n\\n### \u542f\u52a8 RocketMQ\\n\\n\u9996\u5148\u5728\u672c\u5730\u5229\u7528\u4e0b\u8ff0\u547d\u4ee4\u6765\u542f\u52a8 RocketMQ\uff0c\u5177\u4f53\u8be6\u7ec6\u6b65\u9aa4\u53ef\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://rocketmq.apache.org/docs/quick-start/)\u3002\\n\\n```shell\\nwget https://dlcdn.apache.org/rocketmq/4.9.2/rocketmq-all-4.9.2-bin-release.zip\\n\\nunzip rocketmq-all-4.9.2-bin-release.zip\\n\\ncd rocketmq-4.9.2/\\n\\nnohup sh bin/mqnamesrv &\\n\\nnohup sh bin/mqbroker -n 127.0.0.1:9876 -c conf/broker.conf &\\n```\\n\\n### \u5728 Apache APISIX \u4e2d\u5f00\u542f\u63d2\u4ef6\\n\\n\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u53ea\u9700\u6267\u884c\u4e00\u6761\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u4e3a\u6307\u5b9a\u8def\u7531\u542f\u7528 `rocketmq-logger` \u63d2\u4ef6\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n       \\"rocketmq-logger\\": {\\n           \\"nameserver_list\\" : [ \\"127.0.0.1:9876\\" ],\\n           \\"topic\\" : \\"test\\",\\n       }\\n    },\\n    \\"upstream\\": {\\n       \\"nodes\\": {\\n           \\"127.0.0.1:1980\\": 1\\n       },\\n       \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"uri\\": \\"/hello\\"\\n}\'\\n```\\n\\n\u542f\u7528 `rocketmq-logger` \u63d2\u4ef6\u540e\uff0c\u4efb\u4f55\u5bf9\u7aef\u70b9 `URI/hello` \u7684\u8bf7\u6c42\u90fd\u4f1a\u5c06\u65e5\u5fd7\u63a8\u9001\u5230 Apache RocketMQ \u4e2d\u3002\\n\\n\u5177\u4f53\u652f\u6301\u7684\u53c2\u6570\u8be6\u60c5\u53ef\u53c2\u8003\u4e0b\u65b9\u8868\u683c\uff1a\\n\\n| \u540d\u79f0             | \u7c7b\u578b    | \u63cf\u8ff0                                             |\\n| ---------------- | ------- |  ------------------------------------------------ |\\n| nameserver_list  | object  | \u8981\u63a8\u9001\u7684 rocketmq \u7684 nameserver \u5217\u8868\u3002        |\\n| topic            | string  | \u8981\u63a8\u9001\u7684 topic\u3002                             |\\n| key              | string  | \u53d1\u9001\u6d88\u606f\u7684keys\u3002                             |\\n| tag              | string  | \u53d1\u9001\u6d88\u606f\u7684tags\u3002                             |\\n| timeout          | integer | \u53d1\u9001\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4\u3002                          |\\n| use_tls          | boolean | \u662f\u5426\u5f00\u542fTLS\u52a0\u5bc6\u3002                             |\\n| access_key       | string  | ACL\u8ba4\u8bc1\u7684access key\uff0c\u7a7a\u5b57\u7b26\u4e32\u8868\u793a\u4e0d\u5f00\u542fACL\u3002     |\\n| secret_key       | string  | ACL\u8ba4\u8bc1\u7684secret key\u3002                        |\\n\\n#### \u63d2\u4ef6\u5143\u6570\u636e\u8bbe\u7f6e\\n\\n\u5f53\u7136\uff0c\u5982\u679c\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u4e0d\u60f3\u4f7f\u7528\u9ed8\u8ba4\u7684\u65e5\u5fd7\u683c\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u63d2\u4ef6\u8fdb\u884c\u5143\u6570\u636e\u8bbe\u7f6e\u3002\\n\\n\u9996\u5148\u53ef\u4ee5\u901a\u8fc7\u6a21\u677f\u5f62\u5f0f\u6765\u8c03\u6574\u76f8\u5173\u65e5\u5fd7\u683c\u5f0f\u3002\\n\\n| \u540d\u79f0             |  \u9ed8\u8ba4\u503c        |  \u63cf\u8ff0                                             |\\n| ---------------- |  ------------- | ------------------------------------------------ |\\n| log_format       |  {\\"host\\": \\"$host\\", \\"@timestamp\\": \\"$time_iso8601\\", \\"client_ip\\": \\"$remote_addr\\"} |    \u4ee5 JSON \u683c\u5f0f\u7684\u952e\u503c\u5bf9\u6765\u58f0\u660e\u65e5\u5fd7\u683c\u5f0f\u3002\u5bf9\u4e8e\u503c\u90e8\u5206\uff0c\u4ec5\u652f\u6301\u5b57\u7b26\u4e32\u3002\u5982\u679c\u662f\u4ee5 `$` \u5f00\u5934\uff0c\u5219\u8868\u660e\u662f\u8981\u83b7\u53d6 __APISIX__ \u53d8\u91cf\u6216 [Nginx \u5185\u7f6e\u53d8\u91cf](http://nginx.org/en/docs/varindex.html)\u3002\u7279\u522b\u7684\uff0c__\u8be5\u8bbe\u7f6e\u662f\u5168\u5c40\u751f\u6548\u7684__\uff0c\u610f\u5473\u7740\u6307\u5b9a log_format \u540e\uff0c\u5c06\u5bf9\u6240\u6709\u7ed1\u5b9a http-logger \u7684 Route \u6216 Service \u751f\u6548\u3002 |\\n\\n\u65e5\u5fd7\u683c\u5f0f\u8c03\u6574\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5411 `/apisix/admin/plugin_metadata` \u7aef\u70b9\u53d1\u51fa\u8bf7\u6c42\u6765\u66f4\u65b0\u5143\u6570\u636e\uff0c\u5177\u4f53\u53ef\u53c2\u8003\u4e0b\u65b9\u4ee3\u7801\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/plugin_metadata/rocketmq-logger -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"log_format\\": {\\n        \\"host\\": \\"$host\\",\\n        \\"@timestamp\\": \\"$time_iso8601\\",\\n        \\"client_ip\\": \\"$remote_addr\\"\\n    }\\n}\'\\n```\\n\\n## \u7981\u7528\u63d2\u4ef6\\n\\n\u5982\u679c\u60a8\u4e0d\u518d\u4f7f\u7528\u8be5\u63d2\u4ef6\uff0c\u53ef\u901a\u8fc7\u5728\u63d2\u4ef6\u914d\u7f6e\u4e2d\u5220\u9664\u76f8\u5e94\u7684 JSON \u914d\u7f6e\u6765\u7981\u7528 `rocketmq-logger` \u63d2\u4ef6\u3002\u8be5\u8fc7\u7a0b\u65e0\u9700\u91cd\u65b0\u542f\u52a8\u670d\u52a1\uff0c\u8f93\u5165\u4e0b\u65b9\u4ee3\u7801\u5373\u53ef\u7acb\u5373\u751f\u6548\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {},\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```"},{"id":"API \u7f51\u5173\u96c6\u6210 SkyWalking \u6253\u9020\u5168\u65b9\u4f4d\u65e5\u5fd7\u5904\u7406","metadata":{"permalink":"/zh/blog/2021/12/07/apisix-integrate-skywalking-plugin","source":"@site/blog/2021/12/07/apisix-integrate-skywalking-plugin.md","title":"API \u7f51\u5173\u96c6\u6210 SkyWalking \u6253\u9020\u5168\u65b9\u4f4d\u65e5\u5fd7\u5904\u7406","description":"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u96c6\u6210 SkyWalking \u7684\u65e5\u5fd7\u63d2\u4ef6\uff0c\u4e3a\u4e4b\u540e\u7528\u6237\u5728 Apache APISIX \u4e2d\u8fdb\u884c\u65e5\u5fd7\u5904\u7406\u63d0\u4f9b\u66f4\u65b9\u4fbf\u7684\u64cd\u4f5c\u4e0e\u73af\u5883\u3002","date":"2021-12-07T00:00:00.000Z","formattedDate":"2021\u5e7412\u67087\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.635,"truncated":true,"authors":[{"name":"\u5e84\u6d69\u6f6e","title":"Author","url":"https://github.com/dmsolr","image_url":"https://avatars.githubusercontent.com/u/29735230?v=4","imageURL":"https://avatars.githubusercontent.com/u/29735230?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"API \u7f51\u5173 APISIX \u96c6\u6210 RocketMQ \u6269\u5c55\u65e5\u5fd7\u76d1\u63a7\u529f\u80fd","permalink":"/zh/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff0811.15-11.30\uff09","permalink":"/zh/blog/2021/12/02/weekly-report-1130"}},"content":"> \u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u4e24\u6b3e Apache APISIX \u96c6\u6210 SkyWalking \u7684\u65e5\u5fd7\u63d2\u4ef6\uff0c\u4e3a\u4e4b\u540e\u5927\u5bb6\u5728 Apache APISIX \u4e2d\u8fdb\u884c\u65e5\u5fd7\u5904\u7406\u63d0\u4f9b\u66f4\u65b9\u4fbf\u7684\u64cd\u4f5c\u4e0e\u73af\u5883\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u5728\u53ef\u89c2\u6d4b\u6027\u9886\u57df\uff0c\u901a\u5e38\u91c7\u7528 Metrics\u3001Logger \u4e0e Tracing \u4e09\u5927\u65b9\u5411\u7684\u6570\u636e\u6536\u96c6\u4e0e\u5206\u6790\uff0c\u4ee5\u8fbe\u5230\u6d1e\u5bdf\u5e94\u7528\u8fd0\u884c\u72b6\u6001\u7684\u76ee\u7684\uff0cApache SkyWalking \u7684\u65e5\u5fd7\u5904\u7406\u6b63\u597d\u5177\u5907\u4e86\u4ee5\u4e0a\u4e09\u65b9\u9762\u3002\\n\\nApache APISIX \u65e9\u5728 1.4 \u7248\u672c\u5c31\u5df2\u7ecf\u96c6\u6210 Apache SkyWaling Tracing \u80fd\u529b\uff0c\u5e76\u5728\u540e\u7eed\u7248\u672c\u4e2d\u52a0\u5165\u4e86\u9519\u8bef\u65e5\u5fd7\u548c\u8bbf\u95ee\u65e5\u5fd7\u6536\u96c6\u7b49\u529f\u80fd\u3002\u5982\u4eca\u968f\u7740 Apache SkyWalking \u5bf9 Metrics \u7684\u652f\u6301\uff0c\u80fd\u591f\u5e2e\u52a9 Apache APISIX \u5728\u96c6\u6210\u6a21\u5f0f\u4e0b\u5b9e\u73b0\u4e00\u7ad9\u5f0f\u53ef\u89c2\u6d4b\u65b9\u6848\uff0c\u540c\u65f6\u8986\u76d6\u5230\u65e5\u5fd7\u3001\u5ea6\u91cf\u548c\u8c03\u7528\u8ffd\u8e2a\u3002\\n\\n## \u529f\u80fd\u5f00\u53d1\u80cc\u666f\\n\\n\u719f\u6089 Apache APISIX \u7684\u5c0f\u4f19\u4f34\u5e94\u8be5\u77e5\u9053\uff0cApache APISIX \u5728\u8fd0\u884c\u4e2d\u4f1a\u4ea7\u51fa\u4e24\u79cd\u65e5\u5fd7\uff0c\u5373\u8bbf\u95ee\u65e5\u5fd7\u548c\u9519\u8bef\u65e5\u5fd7\u3002\\n\\n\u8bbf\u95ee\u65e5\u5fd7\u8bb0\u5f55\u7740\u6bcf\u4e2a\u8bf7\u6c42\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5c5e\u4e8e**\u8bf7\u6c42\u8303\u56f4**\u5185\u4ea7\u751f\u7684\u65e5\u5fd7\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u4e0e Tracing \u5173\u8054\u3002\u800c\u9519\u8bef\u65e5\u5fd7\u5219\u662f Apache APISIX **\u8fd0\u884c\u65f6**\u4ea7\u51fa\u65e5\u5fd7\u4fe1\u606f\uff0c\u662f\u6574\u4e2a\u5e94\u7528\u7ea7\u522b\u65e5\u5fd7\uff0c\u4f46\u65e0\u6cd5\u786e\u4fdd\u80fd\u767e\u5206\u767e\u5173\u8054\u5230\u8bf7\u6c42\u4e0a\u3002\\n\\n\u76ee\u524d Apache APISIX \u63d0\u4f9b\u4e86\u975e\u5e38\u4e30\u5bcc\u7684\u65e5\u5fd7\u5904\u7406\u63d2\u4ef6\uff0c\u5305\u62ec TCP/HTTP/Kafka \u7b49\u6536\u96c6\u4e0a\u62a5\u63d2\u4ef6\uff0c\u4f46\u5b83\u4eec\u4e0e Tracing \u5173\u8054\u90fd\u6bd4\u8f83\u5f31\u3002\u4ee5 Apache SkyWalking \u4e3a\u4f8b\uff0c\u63d0\u53d6 Apache APISIX \u7aef\u65e5\u5fd7\u8bb0\u5f55\u4e2d\u7684 SkyWalking Tracing Conetxt Header \u5e76\u8f93\u51fa\u5230\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e4b\u540e\u5229\u7528\u65e5\u5fd7\u5904\u7406\u6846\u67b6\uff08fluentbit\uff09\u5c06\u65e5\u5fd7\u8f6c\u6210 SkyWalking \u53ef\u63a5\u53d7\u7684\u65e5\u5fd7\u683c\u5f0f\u3002\u540e\u7eed\u4ece\u4e2d\u89e3\u6790\u63d0\u53d6 Tracing Context\uff0c\u4ece\u800c\u83b7\u5f97 Tracing ID \u8fdb\u800c\u4e0e Trace \u5efa\u7acb\u8054\u7cfb\u3002\\n\\n\u663e\u7136\uff0c\u4e0a\u8ff0\u65b9\u5f0f\u5904\u7406\u6d41\u7a0b\u6bd4\u8f83\u7e41\u7410\u590d\u6742\uff0c\u8fd8\u9700\u8981\u989d\u5916\u8f6c\u6362\u65e5\u5fd7\u683c\u5f0f\u3002\u4e3a\u6b64\uff0c\u5728 [PR#5500](https://github.com/apache/apisix/pull/5550) \u4e2d\u6211\u4eec\u5b9e\u73b0\u4e86\u5c06 Apache SkyWalking \u8bbf\u95ee\u65e5\u5fd7\u63a5\u5165 Apache APISIX \u63d2\u4ef6\u751f\u6001\uff0c\u65b9\u4fbf\u7528\u6237\u5728\u4f7f\u7528 Apache APISIX \u4e2d\u66f4\u65b9\u4fbf\u5730\u5229\u7528 Apache SkyWalking \u8fdb\u884c\u6536\u96c6\u548c\u5904\u7406\u76f8\u5173\u65e5\u5fd7\u3002\\n\\n## \u5168\u65b0\u65e5\u5fd7\u63d2\u4ef6\u4ecb\u7ecd\\n\\n### SkyWalking Logger \u63d2\u4ef6\\n\\nSkyWalking Logger \u63d2\u4ef6\u80fd\u591f\u89e3\u6790 SkyWalking Tracing Context Header\uff0c\u5e76\u5c06\u76f8\u5173 Tracing Context \u4fe1\u606f\u6253\u5370\u5230\u65e5\u5fd7\u4e2d\uff0c\u4ece\u800c\u5b9e\u73b0\u65e5\u5fd7\u4e0e\u8c03\u7528\u94fe\u5efa\u7acb\u5173\u8054\u3002\\n\\n\u901a\u8fc7\u4f7f\u7528\u6b64\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5728\u4e0b\u6e38\u5df2\u7ecf\u96c6\u6210 Apache SkyWalking \u7684\u60c5\u51b5\u4e0b\uff0cApache APISIX \u5373\u4fbf\u6ca1\u6709\u6253\u5f00 SkyWalking Tracing \u63d2\u4ef6\u4e5f\u80fd\u83b7\u53d6\u5230 SkyWalking Tracing Context \u5e76\u5b9e\u73b0\u4e0e Tracing \u5173\u8054\u3002\\n\\n![\u65e5\u5fd7\u5185\u5bb9](https://static.apiseven.com/202108/1638781626018-da50a39d-da16-4914-b4f5-8ac9b4312e19.png)\\n\\n>\u4e0a\u56fe Content \u4e3a\u65e5\u5fd7\u5185\u5bb9\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e86 Apache APISIX metadata \u914d\u7f6e\u6765\u6536\u96c6 Request \u76f8\u5173\u4fe1\u606f\u3002\u540e\u7eed\u53ef\u901a\u8fc7 Plugin Metadata \u4fee\u6539 Log Format \u5b9a\u5236\u65e5\u5fd7\u5185\u5bb9\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003[\u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/plugins/skywalking-logger#metadata)\u3002\\n\\n#### \u4f7f\u7528\u65b9\u6cd5\\n\\n\u5728\u4f7f\u7528\u8be5\u63d2\u4ef6\u65f6\uff0c\u7531\u4e8e SkyWalking \u63d2\u4ef6\u9ed8\u8ba4\u4e3a\u300c\u4e0d\u5f00\u542f\u300d\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u4fee\u6539 `conf/default-apisix.yaml` \u6587\u4ef6\u4e2d `plugins` \u7ae0\u8282\u6765\u89e3\u5f00SkyWalking \u6ce8\u91ca\u4ece\u800c\u542f\u7528\u63d2\u4ef6\u3002\\n\\n```yaml\\nplugins:\\n  ...\\n  - skywalking\\n  ...\\n```\\n\\n\u4e4b\u540e\u4fbf\u53ef\u4f7f\u7528 SkyWalking Tracing \u63d2\u4ef6\u76f4\u63a5\u5f97\u5230 Tracing \u6570\u636e\uff0c\u4ee5\u4fbf\u63a5\u4e0b\u6765\u9a8c\u8bc1 Logging \u63d2\u4ef6\u76f8\u5173\u529f\u80fd\u662f\u5426\u80fd\u591f\u6b63\u5e38\u5f00\u542f\u4e0e\u5de5\u4f5c\u3002\\n\\n##### \u6b65\u9aa4\u4e00\uff1a\u521b\u5efa\u8def\u7531\\n\\n\u63a5\u4e0b\u6765\u521b\u5efa\u4e00\u4e2a\u8def\u7531\uff0c\u5e76\u7ed1\u5b9a SkyWalking Tracing \u63d2\u4ef6\u548c SkyWalking Logging \u63d2\u4ef6\u3002\u5173\u4e8e\u63d2\u4ef6\u5177\u4f53\u914d\u7f6e\u7ec6\u8282\u53ef\u4ee5\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863](https://apisix.apache.org/docs/apisix/plugins/skywalking-logger)\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\\n\\n```shell\\ncurl -X PUT \'http://192.168.0.108:9080/apisix/admin/routes/1001\' \\\\\\n-H \'X-API-KEY:  edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n-H \'Content-Type: application/json\' \\\\\\n-d \'{\\n    \\"uri\\": \\"/get\\",\\n    \\"plugins\\": {\\n        \\"skywalking\\": {\\n            \\"sample_ratio\\": 1\\n        },\\n        \\"skywalking-logger\\": {\\n            \\"endpoint_addr\\": \\"http://127.0.0.1:12800\\"\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"httpbin.org:80\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n##### \u6b65\u9aa4\u4e8c\uff1a\u65e5\u5fd7\u5904\u7406\\n\\n\u5728 Apache SkyWalking \u4fa7\uff0c\u53ef\u4ee5\u4f7f\u7528 LAL\uff08Logger Analysis Language\uff09\u811a\u672c\u8fdb\u884c\u65e5\u5fd7\u5904\u7406\uff0c\u6bd4\u5982 Tag \u63d0\u53d6\u3001SkyWalking \u5143\u6570\u636e\u4fee\u6b63\u7b49\u3002\\n\\n\u8fd9\u91cc\u8fdb\u884c Tag \u63d0\u53d6\u4e3b\u8981\u662f\u4e3a\u4e86\u540e\u7eed\u68c0\u7d22\u65b9\u4fbf\uff0c\u4ee5\u53ca\u5728 Metrics \u7edf\u8ba1\u65f6\u6dfb\u52a0\u76f8\u5173\u4f9d\u8d56\u3002\u53ef\u4f7f\u7528\u5982\u4e0b\u4ee3\u7801\u8fdb\u884c SkyWalking LAL \u811a\u672c\u914d\u7f6e\u6765\u5b8c\u6210 Tag \u63d0\u53d6\uff0c\u66f4\u591a\u5173\u4e8e SkyWalking LAL \u811a\u672c\u4f7f\u7528\u65b9\u6cd5\u53ef\u4ee5\u53c2\u8003 [Apache SkyWalking \u5b98\u65b9\u6587\u6863](https://skywalking.apache.org/docs/main/latest/en/concepts-and-designs/lal/)\u3002\\n\\n```yaml\\n# The default LAL script to save all logs, behaving like the versions before 8.5.0.\\nrules:\\n  - name: default\\n    dsl: |\\n      filter {\\n        json {\\n          abortOnFailure false\\n        }\\n\\n        extractor {\\n          tag routeId: parsed.route_id\\n          tag upstream: parsed.upstream\\n          tag clientIp: parsed.client_ip\\n          tag latency: parsed.latency\\n        }\\n\\n        sink {\\n        }\\n      }\\n```\\n\\n\u5728 SkyWalking OAP Server \u914d\u7f6e\u4e0a\u8ff0 LAL \u811a\u672c\u540e\u5c06\u663e\u793a\u5982\u4e0b\u65e5\u5fd7\uff1a\\n\\n![LAL \u811a\u672c\u65e5\u5fd7\u663e\u793a](https://static.apiseven.com/202108/1638781696137-6ba3a486-08c0-49e1-bc57-e144f95918a2.png)\\n\\n\u5c55\u5f00\u65e5\u5fd7\u8be6\u60c5\u5982\u4e0b\uff1a\\n\\n![\u5c55\u5f00\u65e5\u5fd7\u8be6\u60c5](https://static.apiseven.com/202108/1638781751540-d597ace7-1de1-4baf-b361-1c136dfe5e05.png)\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u64cd\u4f5c\u53ef\u4ee5\u770b\u5230\uff0c\u5c06 `routeId`\uff0c`upstream` \u548c `clientIp` \u4ee5\u952e\u503c\u5bf9\u5f62\u5f0f\u5c55\u793a\uff0c\u6bd4\u5728\u65e5\u5fd7\u6b63\u6587\u4e2d\u76f4\u63a5\u67e5\u627e\u8981\u65b9\u4fbf\u8bb8\u591a\uff0c\u8fd8\u80fd\u7528\u4e8e MAL \u7edf\u8ba1\u751f\u6210\u76f8\u5173\u7684\u5ea6\u91cf\u6307\u6807\u3002\\n\\n### SkyWalking Error Logger \u63d2\u4ef6\\n\\n\u76ee\u524d error-log-logger \u63d2\u4ef6\u5df2\u652f\u6301 SkyWalking \u65e5\u5fd7\u683c\u5f0f\uff0c\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 error-log-logger \u63d2\u4ef6\u5c06 Apache APISIX \u9519\u8bef\u65e5\u5fd7\u5feb\u6377\u63a5\u5165\u5230 Apache SkyWalking \u4e2d\u3002\u76ee\u524d\uff0c\u9519\u8bef\u65e5\u5fd7\u8fd8\u65e0\u6cd5\u83b7\u53d6 SkyWalking Tracing Context \u4fe1\u606f\uff0c\u56e0\u6b64\u65e0\u6cd5\u76f4\u63a5\u4e0e SkyWalking Tracing \u4ea7\u751f\u5173\u8054\u3002\\n\\n\u5173\u4e8e Error Log \u63a5\u5165 SkyWalking \u4e3b\u8981\u662f\u4e3a\u4e86\u80fd\u96c6\u4e2d\u7ba1\u7406 Apache APISIX \u7684\u65e5\u5fd7\u6570\u636e\uff0c\u540c\u65f6\u4e5f\u65b9\u4fbf\u5728 SkyWalking \u5185\u67e5\u770b\u6240\u6709\u53ef\u89c2\u6d4b\u6027\u6570\u636e\u3002\\n\\n![SkyWalking \u9762\u677f\u67e5\u770b](https://static.apiseven.com/202108/1638781827612-f7d88e0e-0159-44ba-bc1e-b718695bc3b8.png)\\n\\n#### \u4f7f\u7528\u65b9\u6cd5\\n\\n\u7531\u4e8e error-log-logger \u63d2\u4ef6\u9ed8\u8ba4\u300c\u4e0d\u5f00\u542f\u300d\uff0c\u6240\u4ee5\u4ecd\u9700\u8981\u4e0a\u6587\u4e2d\u63d0\u5230\u7684\u65b9\u6cd5\u8fdb\u884c\u63d2\u4ef6\u5f00\u542f\u3002\\n\\n```yaml\\nplugins:\\n  ...\\n  - error-log-logger\\n  ...\\n```\\n\\n##### \u6b65\u9aa4\u4e00\uff1a\u7ed1\u5b9a\u8def\u7531\\n\\n\u542f\u7528\u4e4b\u540e\uff0c\u9700\u8981\u5c06\u63d2\u4ef6\u7ed1\u5b9a\u5230\u8def\u7531\u6216\u8005 `global rules` \u4e0a\uff0c\u8fd9\u91cc\u6211\u4eec\u4ee5\u300c\u7ed1\u5b9a\u8def\u7531\u300d\u4e3a\u4f8b\u3002\\n\\n```shell\\ncurl -X PUT \'http://192.168.0.108:9080/apisix/admin/plugin_metadata/error-log-logger\' \\\\\\n-H \'X-API-KEY:  edd1c9f034335f136f87ad84b625c8f1\' \\\\\\n-H \'Content-Type: application/json\' \\\\\\n-d \'{\\n    \\"inactive_timeout\\": 10,\\n    \\"level\\": \\"ERROR\\",\\n    \\"skywalking\\": {\\n        \\"endpoint_addr\\": \\"http://127.0.0.1:12800/v3/logs\\"\\n    }\\n}\'\\n```\\n\\n>\u6ce8\u610f\u8fd9\u91cc `endpoint_addr` \u662f SkyWalking OAP Server \u5730\u5740\uff0c\u9700\u8981\u5e26\u4e0a URI\uff08\u5373 `/v3/logs`)\u3002\\n\\n##### \u6b65\u9aa4\u4e8c\uff1aLAL \u5904\u7406\\n\\n\u4e0e Access Log \u5904\u7406\u65b9\u5f0f\u57fa\u672c\u4e00\u6837\uff0c\u65e5\u5fd7\u5728\u9001\u8fbe SkyWalking OAP Server \u65f6\uff0c\u540c\u6837\u4f1a\u7ecf\u8fc7 LAL \u5904\u7406\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528 SkyWalking LAL \u811a\u672c\u6765\u5206\u6790\u5904\u7406\u65e5\u5fd7\u4fe1\u606f\u3002\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cError Log \u65e5\u5fd7\u6d88\u606f\u4f53\u4f7f\u7528\u6587\u672c\u683c\u5f0f\u3002\u5982\u679c\u8fdb\u884c Tags \u63d0\u53d6\uff0c\u5219\u9700\u8981\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u5b8c\u6210\u3002\u4e0e Access Log \u5904\u7406\u6d88\u606f\u6b63\u6587\u7684\u65b9\u5f0f\u7565\u6709\u4e0d\u540c\uff0cAcces Log \u4f7f\u7528 JSON \u683c\u5f0f\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 JSON \u89e3\u6790\u540e\u5f15\u7528 JSON \u5bf9\u8c61\u7684\u5b57\u6bb5\uff0c\u5176\u4ed6\u5904\u7406\u6d41\u7a0b\u5219\u5927\u4f53\u4e00\u81f4\u3002\\n\\n\u540c\u65f6\u4e5f\u53ef\u4ee5\u5229\u7528 Tags \u6765\u4f18\u5316\u663e\u793a\u6548\u679c\u4e0e\u68c0\u7d22\uff0c\u65b9\u4fbf\u540e\u7eed\u4f7f\u7528 SkyWalking MAL \u8fdb\u884c Metrics \u8ba1\u7b97\u3002\\n\\n```json\\nrules:\\n  - name: apisix-errlog\\n    dsl: |\\n      filter {\\n        text {\\n          regexp \\"(?<datetime>\\\\\\\\d{4}/\\\\\\\\d{2}/\\\\\\\\d{2} \\\\\\\\d{2}:\\\\\\\\d{2}:\\\\\\\\d{2}) \\\\\\\\[(?<level>\\\\\\\\w+)\\\\\\\\] \\\\\\\\d+\\\\\\\\#\\\\\\\\d+:( \\\\\\\\*\\\\\\\\d+ \\\\\\\\[(?<module>\\\\\\\\w+)\\\\\\\\] (?<position>.*\\\\\\\\.lua:\\\\\\\\d+): (?<function>\\\\\\\\w+\\\\\\\\(\\\\\\\\)):)* (?<msg>.+)\\"\\n        }\\n        extractor {\\n          tag level: parsed.level\\n          if (parsed?.module) {\\n            tag module: parsed.module\\n            tag position: parsed.position\\n            tag function: parsed.function\\n          }\\n        }\\n        sink {\\n        }\\n      }\\n```\\n\\n\u5728 SkyWalking OAP Server \u4f7f\u7528\u7684 LAL \u811a\u672c\u4e4b\u540e\uff0c\u5c06\u4f1a\u5728\u65e5\u5fd7\u4e2d\u63d0\u53d6\u90e8\u5206 Tags\uff0c\u6548\u679c\u5982\u4e0b\u56fe\u3002\\n\\n![\u63d0\u53d6 Tags](https://static.apiseven.com/202108/1638781886771-b98c80de-4ea2-4cf3-ad1c-26250da231f7.png)\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u4e24\u6b3e Apache APISIX \u96c6\u6210 SkyWalking \u7684\u65e5\u5fd7\u63d2\u4ef6\uff0c\u4e3a\u4e4b\u540e\u5927\u5bb6\u5728 Apache APISIX \u4e2d\u8fdb\u884c\u65e5\u5fd7\u5904\u7406\u63d0\u4f9b\u66f4\u65b9\u4fbf\u7684\u64cd\u4f5c\u4e0e\u73af\u5883\u3002\u5e0c\u671b\u901a\u8fc7\u672c\u7bc7\u5185\u5bb9\uff0c\u5927\u5bb6\u53ef\u4ee5\u5bf9\u65b0\u529f\u80fd\u6709\u4e86\u66f4\u5145\u5206\u7684\u7406\u89e3\uff0c\u540e\u7eed\u53ef\u4ee5\u66f4\u65b9\u4fbf\u5730\u5229\u7528 Apache APISIX \u8fdb\u884c\u53ef\u89c2\u6d4b\u6570\u636e\u7684\u96c6\u4e2d\u7ba1\u7406\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff0811.15-11.30\uff09","metadata":{"permalink":"/zh/blog/2021/12/02/weekly-report-1130","source":"@site/blog/2021/12/02/weekly-report-1130.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff0811.15-11.30\uff09","description":"API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u4e86azure-functions\u3001google-cloud-logging \u548c openwhisk \u63d2\u4ef6\uff0c\u4ee5\u53ca kafka-logger \u63d2\u4ef6\u652f\u6301\u8bb0\u5f55\u8bf7\u6c42\u4f53\u548c\u54cd\u5e94\u4f53\u7b49\u4f17\u591a\u529f\u80fd\u3002","date":"2021-12-02T00:00:00.000Z","formattedDate":"2021\u5e7412\u67082\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":5.1,"truncated":true,"authors":[],"prevItem":{"title":"API \u7f51\u5173\u96c6\u6210 SkyWalking \u6253\u9020\u5168\u65b9\u4f4d\u65e5\u5fd7\u5904\u7406","permalink":"/zh/blog/2021/12/07/apisix-integrate-skywalking-plugin"},"nextItem":{"title":"API \u7f51\u5173 APISIX \u73b0\u5df2\u652f\u6301 Azure Functions","permalink":"/zh/blog/2021/12/01/apisix-supports-azure-functions"}},"content":"> \u4ece 11.15 \u5230 11.30, \u6709 37 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 87 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1638348155941-0e071c9b-1c4a-40ac-af10-187cad658590.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1638348155955-f711af06-2eba-4362-88fe-f1dc187f227d.png)\\n\\n## Good first issue\\n\\n### Issue #5451\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5451\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1aNginx\u81ea\u5e26\u7684\u54cd\u5e94\u5185\u5bb9\u66ff\u6362\u5e93\u53ef\u4ee5\u66ff\u6362\u5c40\u90e8\u5185\u5bb9\uff1ahttp://nginx.org/en/docs/http/ngx_http_sub_module.html\\n\\n```Nginx\\nsub_filter \'<a href=\\"http://127.0.0.1:8080/\'  \'<a href=\\"https://$host/\';\\n```\\n\\n\u6709\u4e2a\u652f\u6301\u6b63\u5219\u66ff\u6362\u7684\u5e93\uff08\u5370\u8c61\u4e2dOpenresty\u5df2\u9ed8\u8ba4\u652f\u6301\uff09\uff1angx_http_substitutions_filter_module\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u66ff\u6362\u5185\u5bb9\uff1a\\n\\n```Nginx\\nsubs_filter_types text/html text/css text/xml;\\nsubs_filter st(\\\\d*).example.com $1.example.com ir;\\nsubs_filter a.example.com s.example.com;\\nsubs_filter http://$host https://$host;\\n```\\n\\n\u4f46\u662f APISIX \u7684 response-rewrite \u63d2\u4ef6\u6587\u6863\uff0c\u597d\u50cf\u53ea\u80fd\u652f\u6301\u5b8c\u6574\u66ff\u6362\uff0c\u76f8\u5f53\u4e8e\u76f4\u63a5\u5c06\u6240\u6709\u54cd\u5e94\u90fd\u6362\u6210\u63d2\u4ef6\u8bbe\u7f6e\u7684\u8fd4\u56de\uff0c\u5e76\u4e0d\u652f\u6301\u90e8\u5206\u5185\u5bb9\u66ff\u6362\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1  -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/test/index.html\\",\\n    \\"plugins\\": {\\n        \\"response-rewrite\\": {\\n            \\"body\\": \\"{\\\\\\"code\\\\\\":\\\\\\"ok\\\\\\",\\\\\\"message\\\\\\":\\\\\\"new json body\\\\\\"}\\",\\n            \\"headers\\": {\\n                \\"X-Server-id\\": 3,\\n                \\"X-Server-status\\": \\"on\\",\\n                \\"X-Server-balancer_addr\\": \\"$balancer_ip:$balancer_port\\"\\n            },\\n            \\"vars\\":[\\n                [ \\"status\\",\\"==\\",\\"200\\" ]\\n            ]\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:80\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u8fd9\u4e2a\u63d2\u4ef6\u662f\u5426\u652f\u6301\u90e8\u5206\u66ff\u6362\u6216\u6b63\u5219\u66ff\u6362\uff1f\u5982\u679c\u4e0d\u652f\u6301\uff0cAPISIX \u6709\u6ca1\u6709\u5176\u4ed6\u89e3\u51b3\u65b9\u6848\u5462\uff1f\\n\\n### Issue #5647\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5647\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5f53\u524d\u6587\u6863\u63d0\u4f9b\u4e86\u5728 CentOS7 \u4e0a\u76f4\u63a5\u4f7f\u7528 RPM \u5b89\u88c5 APISIX \u7684\u65b9\u6cd5\uff0c\u4f46\u662f\u5f53\u524d APISIX \u5df2\u7ecf\u5c06\u4f9d\u8d56\u5207\u6362\u4e3a apisix-base \u7248\u672c\uff0c\u6ca1\u6709\u63d0\u4f9b RPM \u5b89\u88c5\u65b9\u6cd5\uff0c\u4f1a\u5bfc\u81f4\u5b89\u88c5\u5931\u8d25\u3002\\n\\n\u662f\u5426\u53ef\u4ee5\u6dfb\u52a0\u7528\u4e8e\u5b89\u88c5 apisix-base \u7684 RPM \u7684\u547d\u4ee4\u3002\\n\\n![\u95ee\u9898\u622a\u56fe](https://static.apiseven.com/202108/1638346839201-3efb9807-13a7-4106-968a-5198b22d1a67.png)\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [kafka-logger \u652f\u6301\u8bb0\u5f55\u8bf7\u6c42\u4f53](https://github.com/apache/apisix/pull/5501)\uff08\u8d21\u732e\u8005\uff1a[windyrjc](https://github.com/windyrjc)\uff09\\n\\n- [\u65b0\u589e azure-functions \u63d2\u4ef6\uff0c\u4e0e Azure Serverless Function \u65e0\u7f1d\u96c6\u6210](https://github.com/apache/apisix/pull/5479)\uff08\u8d21\u732e\u8005: [bisakhmondal](https://github.com/bisakhmondal)\uff09\\n\\n- [WASM \u63d2\u4ef6\u652f\u6301\u5728 header_filter \u9636\u6bb5\u8fd0\u884c](https://github.com/apache/apisix/pull/5544)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [\u65b0\u589e google-cloud-logging \u63d2\u4ef6\uff0c\u7528\u4e8e\u63a8\u9001\u65e5\u5fd7\u5230 Google Cloud logging Service](https://github.com/apache/apisix/pull/5538)\uff08\u8d21\u732e\u8005\uff1a[shuaijinchao](https://github.com/shuaijinchao)\uff09\\n\\n- [\u65b0\u589e openwhisk \u63d2\u4ef6\uff0c\u4e0e Apache OpenWhisk serverless \u5e73\u53f0\u96c6\u6210](https://github.com/apache/apisix/pull/5518)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [kafka-logger \u548c http \u652f\u6301\u8bb0\u5f55\u54cd\u5e94\u4f53](https://github.com/apache/apisix/pull/5550)\uff08\u8d21\u732e\u8005\uff1a[dmsolr](https://github.com/dmsolr)\uff09\\n\\n- [\u5728 APISIX Ingress \u4e2d\u5bf9\u4e8e HTTPS \u548c gRPCs \u7c7b\u578b\u7684 upstream \u4e30\u5bcc\u4e86 mTLS \u7684\u652f\u6301](https://github.com/apache/apisix-ingress-controller/pull/755)\uff08\u8d21\u732e\u8005: [nic-6443](https://github.com/nic-6443)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [\u5728 KubeSphere \u4e2d\u4f7f\u7528 Apache APISIX Ingress \u7f51\u5173\u63a5\u5165\u81ea\u5b9a\u4e49\u76d1\u63a7](https://apisix.apache.org/zh/blog/2021/11/30/use-apisix-ingress-in-kubesphere)\uff1a\\n\\n  \u672c\u6587\u5c06\u901a\u8fc7 Apache APISIX Ingress Controller \u4e3a\u8303\u4f8b\uff0c\u8be6\u7ec6\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 KubeSphere \u5feb\u901f\u4e3a Kubernetes \u96c6\u7fa4\u4f7f\u7528\u4e0d\u540c\u7c7b\u578b\u7684\u7f51\u5173\u5e76\u8fdb\u884c\u72b6\u6001\u76d1\u63a7\u3002\\n\\n- [\u5982\u4f55\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u4f7f\u7528 Nocalhost \u5f00\u53d1 Apache APISIX Ingress Controller](https://apisix.apache.org/zh/blog/2021/11/22/develop-apisix-ingress-with-nocalhost-in-kubernetes)\uff1a\\n\\n  \u672c\u6587\u5c06\u4e3a\u60a8\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Nocalhost \u5c06\u672c\u5730\u5f00\u53d1\u673a\u65e0\u7f1d\u8fde\u63a5\u5230\u4e00\u4e2a\u8fdc\u7a0b Kubernetes \u96c6\u7fa4\uff0c\u540c\u65f6\u914d\u5408 IDE \u6765\u5f00\u53d1\u548c\u8c03\u8bd5 Apache APISIX Ingress Controller\u3002\u5229\u7528\u73b0\u6709\u6280\u672f\u6808\u66f4\u987a\u7545\u5730\u5f00\u53d1\u548c\u8c03\u8bd5\u8fdc\u7a0b\u5e94\u7528\u3002\\n\\n- [\u91cd\u78c5\u529f\u80fd\uff01Apache APISIX \u62e5\u62b1 WASM \u751f\u6001](https://apisix.apache.org/zh/blog/2021/11/19/apisix-supports-wasm)\uff1a\\n\\n  \u5728\u5373\u5c06\u53d1\u5e03\u7684 Apache APISIX \u7248\u672c\uff082.11.0\uff09\u4e2d\u5c06\u4f1a\u65b0\u589e\u5bf9\u4e8e WASM \u7684\u652f\u6301\uff01\u901a\u8fc7\u9605\u8bfb\u672c\u6587\u4f60\u5c06\u4e86\u89e3\u5230 Apache APISIX \u5982\u4f55\u4ece 0 \u5230 1 \u90e8\u7f72\u8fd9\u9879\u529f\u80fd\u7684\u652f\u6301\u4e0e\u5f00\u53d1\u3002\\n\\n- [\u5982\u4f55\u4e0e Dapr \u96c6\u6210\u6253\u9020 Apache APISIX \u7f51\u5173\u63a7\u5236\u5668](https://apisix.apache.org/zh/blog/2021/11/17/dapr-with-apisix)\uff1a\\n\\n  \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u5c55\u793a\u5982\u4f55\u901a\u8fc7\u96c6\u6210 Dapr \u521b\u5efa\u4e00\u4e2a Apache APISIX \u63a7\u5236\u5668\u3002\u5305\u62ec\u9879\u76ee\u6982\u5ff5\u4ee5\u53ca\u5177\u4f53\u64cd\u4f5c\u6b65\u9aa4\u3002"},{"id":"API \u7f51\u5173 APISIX \u73b0\u5df2\u652f\u6301 Azure Functions","metadata":{"permalink":"/zh/blog/2021/12/01/apisix-supports-azure-functions","source":"@site/blog/2021/12/01/apisix-supports-azure-functions.md","title":"API \u7f51\u5173 APISIX \u73b0\u5df2\u652f\u6301 Azure Functions","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 API \u7f51\u5173 Apache APISIX \u65b0\u589e\u7684\u63d2\u4ef6 `azure-functions`\uff0c\u5e76\u5c55\u793a\u4e86\u5982\u4f55\u5c06 Azure Functions\uff08\u4e00\u79cd\u5e7f\u6cdb\u4f7f\u7528\u7684 serverless \u89e3\u51b3\u65b9\u6848\uff09\u96c6\u6210\u5230 APISIX \u4e2d\u3002","date":"2021-12-01T00:00:00.000Z","formattedDate":"2021\u5e7412\u67081\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":9.17,"truncated":true,"authors":[{"name":"Bisakh Mondal","url":"https://github.com/bisakhmondal","imageURL":"https://avatars.githubusercontent.com/u/41498427?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff0811.15-11.30\uff09","permalink":"/zh/blog/2021/12/02/weekly-report-1130"},"nextItem":{"title":"Apache APISIX 2.11.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/12/01/release-apache-apisix-2.11"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u6700\u8fd1\u65b0\u589e\u7684\u63d2\u4ef6 `azure-functions`\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u4e86\u5982\u4f55\u5c06 Azure Functions \u96c6\u6210\u5230 Apache APISIX \u4e2d\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n![Apache APISIX \u652f\u6301 Azure Functions \u96c6\u6210](https://static.apiseven.com/202108/1638431191799-e1202fc7-d3b5-48db-a222-0c70a8b70da0.png)\\n\\nApache APISIX \u4e3a Microsoft Azure Functions \u63d0\u4f9b\u4e86\u5bf9 serverless \u6846\u67b6\u7684\u652f\u6301\u3002Apache APISIX \u5efa\u8bae\u5b9a\u4e49\u4e00\u4e2a\u542f\u7528\u4e86\u65e0\u670d\u52a1\u5668\u63d2\u4ef6\u7684\u8def\u7531\uff0c\u800c\u4e0d\u662f\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u91c7\u7528\u786c\u7f16\u7801\u51fd\u6570 URL\u3002\u5b83\u4f7f\u5f00\u53d1\u8005\u80fd\u591f\u7075\u6d3b\u5730\u70ed\u66f4\u65b0\u51fd\u6570 URI\u3002\u6b64\u5916\uff0c\u56e0\u4e3a Apache APISIX \u6709\u975e\u5e38\u5f3a\u5927\u7684\u8ba4\u8bc1\u652f\u6301\uff0c\u8fd9\u79cd\u65b9\u6cd5\u8fd8\u53ef\u4ee5\u51cf\u8f7b\u5e94\u7528\u903b\u8f91\u4e2d\u7684\u6388\u6743\u548c\u8ba4\u8bc1\u95ee\u9898\uff0c\u53ef\u4ee5\u7528\u6765\u8bc6\u522b\u548c\u6388\u6743\u5ba2\u6237\u6d88\u8d39\u8005\u8bbf\u95ee\u5e26\u6709 FAAS \u7684\u7279\u5b9a\u8def\u7531\u3002\u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u6700\u8fd1\u65b0\u589e\u7684\u63d2\u4ef6 `azure-functions`\uff0c\u5e76\u8be6\u7ec6\u8bf4\u660e\u4e86\u5982\u4f55\u5c06 Azure Functions\uff08\u4e00\u79cd\u5e7f\u6cdb\u4f7f\u7528\u7684 serverless \u89e3\u51b3\u65b9\u6848\uff09\u96c6\u6210\u5230 Apache APISIX \u4e2d\u3002\\n\\n## azure-functions \u63d2\u4ef6\u5de5\u4f5c\u539f\u7406\\n\\n`azure-functions` \u63d2\u4ef6\u8ba9\u7528\u6237\u4e3a\u7f51\u5173 URI \u5b9a\u4e49\u4e00\u4e2a\u4e0a\u6e38\u7684 azure `HTTP Trigger` serverless \u529f\u80fd\u3002\u5982\u679c\u542f\u7528\uff0c\u8be5\u63d2\u4ef6\u5c06\u7ec8\u6b62\u6b63\u5728\u8fdb\u884c\u7684\u5bf9\u8be5 URI \u7684\u8bf7\u6c42\uff0c\u5e76\u4ee3\u8868\u5ba2\u6237\u5411 azure FAAS\uff08\u65b0\u7684\u4e0a\u6e38\uff09\u53d1\u8d77\u4e00\u4e2a\u65b0\u7684\u8bf7\u6c42\uff0c\u5176\u4e2d\u5305\u62ec\u7528\u6237\u8bbe\u7f6e\u7684\u5408\u9002\u7684\u6388\u6743\u7ec6\u8282\u3001\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u4f53\u3001\u53c2\u6570\uff08\u8fd9\u4e09\u4e2a\u90e8\u5206\u90fd\u662f\u4ece\u539f\u59cb\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684\uff09\uff0c\u5e76\u5c06\u54cd\u5e94\u4f53\u3001\u72b6\u6001\u7801\u548c\u5934\u8fd4\u56de\u7ed9\u5411 Apache APISIX \u4ee3\u7406\u53d1\u51fa\u8bf7\u6c42\u7684\u539f\u59cb\u5ba2\u6237\u3002\\n\\n\u8be5\u63d2\u4ef6\u652f\u6301\u901a\u8fc7 API \u5bc6\u94a5\u548c azure active directory \u5bf9 azure FAAS \u670d\u52a1\u8fdb\u884c\u6388\u6743\u3002\\n\\n## \u5982\u4f55\u5728 Apache APISIX \u4e2d\u4f7f\u7528 azure-functions \u63d2\u4ef6\\n\\n\u8be5\u63d2\u4ef6\u7684\u4e3b\u8981\u76ee\u6807\u662f\u5c06\u8def\u7531\u914d\u7f6e\u4e2d\u6307\u5b9a\u7684\u7f51\u5173\u8def\u7531\u4ee3\u7406\u5230 azure function URI \u4e0a\u3002\u672c\u8282\u4e3a\u60a8\u4ecb\u7ecd\u5982\u4f55\u5728 azure \u4e91\u4e0a\u914d\u7f6e\u548c\u521b\u5efa serverless HTTP Trigger\u3002\\n\\n1. \u9996\u5148\u8fdb\u5165 Azure \u5e76\u8bbe\u7f6e\u4e00\u4e2a\u8bd5\u7528\u8ba1\u5212\uff0c\u6700\u591a\u53ef\u514d\u8d39\u8c03\u7528 100 \u4e07\u6b21\u3002\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u5b9a\u4ef7\u7684\u60c5\u51b5\uff0c\u8bf7\u8bbf\u95ee[\u8fd9\u91cc](https://azure.microsoft.com/en-us/services/functions/#pricing)\u3002\\n\\n1. \u8bbf\u95ee[Azure Portal](https://portal.azure.com/#home)\u3002\\n    1. \u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2a\u8d44\u6e90\u7ec4\uff0c\u4e3a FAAS \u521b\u5efa\u903b\u8f91\u5206\u533a\u3002\\n    ![\u521b\u5efa\u8d44\u6e90\u7ec4](https://static.apiseven.com/202108/1638349069240-911b8640-2de6-4f82-b75b-fb937b0bad40.png)\\n    1. \u7528\u4f60\u9009\u62e9\u7684 URL \u521b\u5efa\u4e00\u4e2a function \u5e94\u7528\u3002\\n    ![\u521b\u5efa\u4e00\u4e2a function \u5e94\u7528](https://static.apiseven.com/202108/1638349121520-01abe8e6-bc09-4be7-b010-f7baec59f89a.png)\\n\\n1. \u5728 VSCode \u7f16\u8f91\u5668\u4e2d\u5b89\u88c5 [Azure Functions \u63d2\u4ef6](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions)\u3002\u5b89\u88c5\u540e\uff0c\u901a\u8fc7\u63d2\u4ef6\u8ba4\u8bc1\uff0c\u5e76\u5b89\u88c5 azure function core tool\uff0c\u7528\u4e8e\u672c\u5730\u5f00\u53d1\u3002\\n\\n    ```shell\\n    npm install -g azure-functions-core-tools@3 --unsafe-perm true\\n    ```\\n\\n1. \u5c06\u4e0b\u9762\u7684\u4ee3\u7801\u6bb5\u90e8\u7f72\u5230\u6211\u4eec\u521a\u624d\u901a\u8fc7 VSCode \u4e2d\u7684 Azure Functions \u6269\u5c55\u9762\u677f\u521b\u5efa\u7684\u540c\u4e00\u4e2afunction \u5e94\u7528\u4e2d\u3002\\n\\n    ```javascript\\n    module.exports = async function (context, req) {\\n    context.log(\'HTTP trigger invoked on Test-APISIX.\')\\n\\n    const name = req.query.name || (req.body && req.body.name)\\n    const responseMessage = name\\n        ? \'Hello, \' + name\\n        : \'This HTTP triggered function executed successfully. Pass a name in the query string or in the request body to generate a personalized response.\'\\n\\n    context.res = {\\n        // status: 200, /* Defaults to 200 */\\n        body: responseMessage,\\n    }\\n    }\\n    ```\\n\\n> \u8fd9\u4e2a\u4ee3\u7801\u6bb5\u4ece\u67e5\u8be2\u53c2\u6570\u4e2d\u83b7\u53d6\u7528\u6237\u540d\u5b57\uff08\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u4ece\u8bf7\u6c42\u4f53\u4e2d\u83b7\u53d6\uff09\u5e76\u5411\u7528\u6237\u95ee\u597d\u3002\\n\\n### \u542f\u7528 azure-functions \u63d2\u4ef6\\n\\n\u4e0b\u9762\u6211\u4eec\u5c06\u901a\u8fc7\u4e00\u4e2a\u793a\u4f8b\u4e3a\u5927\u5bb6\u8bf4\u660e\u5982\u4f55\u4e3a\u4e00\u4e2a\u7279\u5b9a\u7684\u8def\u7531\u542f\u7528 `azure-functions` \u63d2\u4ef6\u3002\u6211\u4eec\u5047\u8bbe\u4f60\u7684 HTTP Trigger \u5df2\u7ecf\u90e8\u7f72\u5e76\u51c6\u5907\u597d\u63d0\u4f9b\u670d\u52a1\u3002\\n\\n```shell\\n# enable plugin for a specific route\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"azure-functions\\": {\\n            \\"function_uri\\": \\"http://test-apisix.azurewebsites.net/api/HttpTrigger\\",\\n            \\"authorization\\": {\\n                \\"apikey\\": \\"<Generated API key to access the Azure-Function>\\"\\n            }\\n        }\\n    },\\n    \\"uri\\": \\"/azure\\"\\n}\'\\n```\\n\\n\u73b0\u5728\uff0c\u4efb\u4f55\u5bf9 Apache APISIX \u7f51\u5173\u4e0a\u7684 URI `/azure` \u7684\u8bf7\u6c42\uff08HTTP/1.1\u3001HTTPS\u3001HTTP2\uff09\u90fd\u5c06\u89e6\u53d1\u5bf9\u4e0a\u8ff0\u51fd\u6570 URI \u7684 HTTP \u8c03\u7528\uff0c\u54cd\u5e94\u4f53\u4e0e\u54cd\u5e94\u5934\u548c\u54cd\u5e94\u4ee3\u7801\u5c06\u88ab\u4ee3\u7406\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u4f8b\u5982\uff1a\\n\\n```shell\\ncurl -i -XGET http://localhost:9080/azure\\\\?name=Bisakh\\nHTTP/1.1 200 OK\\nContent-Type: text/plain; charset=utf-8\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\nRequest-Context: appId=cid-v1:38aae829-293b-43c2-82c6-fa94aec0a071\\nDate: Wed, 19 Nov 2021 18:46:55 GMT\\nServer: APISIX/2.10.2\\n\\nHello, Bisakh\\n```\\n\\n\u8003\u8651\u5230\uff0cApache APISIX \u4e5f\u662f\u5728[config-default.yaml](https://github.com/apache/apisix/blob/master/conf/config-default.yaml#L26)\u4e0a\u4ee5 `enable_http2: true` \u8fd0\u884c\uff0c\u7aef\u53e3\u4e3a 9081\uff0c\u5ba2\u6237\u7aef\u548c Apache APISIX \u4ee3\u7406\u4e4b\u95f4\u7684\u4efb\u4f55 `HTTP/2` \u901a\u4fe1\u5c06\u88ab\u4ee3\u7406\u5230 azure faas\uff0c\u7c7b\u4f3c\u4e8e HTTP/1.1\uff0c\u54cd\u5e94\u5c06\u88ab\u4ee3\u7406\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u5e76\u6709\u9002\u5f53\u7684\u6807\u9898\uff0c\u4f8b\u5982\uff1a\\n\\n```shell\\ncurl -i -XGET --http2 --http2-prior-knowledge http://localhost:9081/azure\\\\?name=Bisakh\\nHTTP/2 200\\ncontent-type: text/plain; charset=utf-8\\nrequest-context: appId=cid-v1:38aae829-293b-43c2-82c6-fa94aec0a071\\nDate: Wed, 19 Nov 2021 18:46:56 GMT\\nserver: APISIX/2.10.2\\n\\nHello, Bisakh\\n```\\n\\n### \u505c\u7528 azure-functions \u63d2\u4ef6\\n\\n\u5982\u679c\u9700\u8981\u505c\u7528 azure-functions \u8be5\u63d2\u4ef6\uff0c\u53ea\u9700\u5728\u63d2\u4ef6\u914d\u7f6e\u4e2d\u5220\u9664\u76f8\u5e94\u7684 JSON \u914d\u7f6e\uff0c\u7981\u7528`azure-functions`\u63d2\u4ef6\uff0c\u5e76\u6dfb\u52a0\u5408\u9002\u7684\u4e0a\u6e38\u914d\u7f6e\u3002Apache APISIX \u63d2\u4ef6\u662f\u70ed\u52a0\u8f7d\u7684\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u91cd\u65b0\u542f\u52a8 Apache APISIX\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/azure\\",\\n    \\"plugins\\": {},\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n## \u81ea\u5b9a\u4e49\u914d\u7f6e\\n\\n\u5728\u542f\u7528 `azure-functions` \u63d2\u4ef6\u521b\u5efa\u65b0\u8def\u7531\u65f6\uff0c\u5728\u6700\u5c0f\u7684\u914d\u7f6e\u4e2d\uff0c`function_uri` \u662f\u63d2\u4ef6\u914d\u7f6e\u7684\u5f3a\u5236\u6027\u5c5e\u6027\uff0c\u6307\u5411\u51fd\u6570\u7684 URL\u3002\u6709\u5f88\u591a\u989d\u5916\u7684\u9009\u9879\uff0c\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u53c2\u6570\u548c\u5143\u6570\u636e\u53c2\u6570\u8fdb\u884c\u8c03\u6574\u3002\\n\\n### \u63d2\u4ef6\u53c2\u6570\u89e3\u91ca\\n\\n|\u540d\u79f0|\u7c7b\u578b|\u5fc5\u586b|\u9ed8\u8ba4\u503c|\u6709\u6548\u503c|\u63cf\u8ff0|\\n|----|----|--------|-------|-----|-----------|\\n|function_uri|string|\u662f|n/a|n/a|\u89e6\u53d1 serverless functions \u4ee3\u7801\u7684 azure functions \u7aef\u70b9\uff08\u4f8b\u5982\uff1ahttp://test-apisix.azurewebsites.net/api/HttpTrigger\uff09\u3002|\\n|authorization|object|\u5426|n/a|n/a|\u8bbf\u95ee\u4e91 functions \u7684\u6388\u6743\u51ed\u8bc1\u3002|\\n|authorization.apikey|string|\u5426|n/a|n/a|\u6388\u6743\u5185\u7684\u5b57\u6bb5\u3002\u751f\u6210API\u5bc6\u94a5\u6765\u6388\u6743\u5bf9\u8be5\u7aef\u70b9\u7684\u8bf7\u6c42\u3002|\\n|authorization.clientid|string|\u5426|n/a|n/a|\u6388\u6743\u5185\u7684\u5b57\u6bb5\u3002\u5ba2\u6237\u7aefID\uff08azure active directory\uff09\uff0c\u7528\u4e8e\u6388\u6743\u5bf9\u8be5\u7aef\u70b9\u7684\u8bf7\u6c42\u3002|\\n|timeout|integer|\u5426|3000|[100,...]|\u4ee3\u7406\u8bf7\u6c42\u8d85\u65f6\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002|\\n|ssl_verify|boolean|\u5426|true|true/false|\u662f\u5426\u542f\u7528\u6267\u884c\u670d\u52a1\u5668\u7684SSL\u9a8c\u8bc1\u3002|\\n|keepalive|boolean|\u5426|true|true/false|\u662f\u5426\u91cd\u590d\u4f7f\u7528\u540c\u4e00\u4e2a\u4ee3\u7406\u8fde\u63a5\u3002\u8bbe\u7f6e\u4e3afalse\u5219\u7981\u7528keepalives\u5e76\u7acb\u5373\u5173\u95ed\u8fde\u63a5\u3002|\\n|keepalive_pool|integer|\u5426|5|[1,...]|\u6c60\u4e2d\u7684\u6700\u5927\u8fde\u63a5\u6570\u3002|\\n|keepalive_timeout|integer|\u5426|60000|[1000,...]|\u6700\u5927\u7684\u7a7a\u95f2\u8d85\u65f6\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002|\\n\\n\u8fd9\u4e3a\u4e25\u683c\u7ea6\u675f azure FAAS \u7684\u884c\u4e3a\u63d0\u4f9b\u4e86\u5f88\u5927\u7684\u7075\u6d3b\u6027--\u4ece\u914d\u7f6e\u8d85\u65f6\u5230 keepalive \u6c60\u4ee5\u53ca\u9a8c\u8bc1\u65e0\u670d\u52a1\u5668FAAS \u7684 SSL \u8bc1\u4e66\u3002\u8bf4\u5b9e\u8bdd\uff0c\u5f53\u6d89\u53ca\u5230\u65e0\u670d\u52a1\u5668\u65f6\uff0c\u8fd9\u5b9e\u9645\u4e0a\u610f\u5473\u7740\u5f88\u591a\uff0c\u56e0\u4e3a\u670d\u52a1\u662f\u4e8b\u4ef6\u9a71\u52a8\u7684\uff0c\u800c\u4e14\u8d44\u6e90\u662f\u7531\u4e91\u63d0\u4f9b\u5546\u5373\u65f6\u5206\u914d\u7684\u3002\\n\\n### Metadata \u53c2\u6570\u89e3\u91ca\\n\\n\u540c\u6837\uff0c\u6709\u4e00\u4e9b\u5c5e\u6027\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u5143\u6570\u636e\u8fdb\u884c\u8c03\u6574\u3002\\n\\n|\u540d\u79f0|\u7c7b\u578b|\u5fc5\u586b|\u9ed8\u8ba4\u503c|\u6709\u6548\u503c|\u63cf\u8ff0|\\n|----|----|--------|-------|-----|-----------|\\n|master_apikey|string|\u5426|\\"\\"|n/a|\u53ef\u7528\u4e8e\u8bbf\u95ee azure functions URI \u7684 API KEY\u3002|\\n|master_clientid|string|\u5426|\\"\\"|n/a|\u53ef\u7528\u4e8e\u6388\u6743 function URI\u7684\u5ba2\u6237ID\uff08active directory\uff09\u3002|\\n\\n`azure-functions` \u63d2\u4ef6\u7684\u5143\u6570\u636e\u63d0\u4f9b\u4e86\u6388\u6743\u56de\u9000\u7684\u529f\u80fd\u3002\u5b83\u5b9a\u4e49\u4e86 `master_apikey` \u548c `master_clientid` (azure active directory client id)\uff0c\u7528\u6237\u53ef\u4ee5\u4e3a\u5173\u952e\u4efb\u52a1\u7684\u5e94\u7528\u90e8\u7f72\u5b9a\u4e49\u4e3b API \u5bc6\u94a5\u6216\u5ba2\u6237\u7aef ID\u3002\u56e0\u6b64\uff0c\u5982\u679c\u5728\u63d2\u4ef6\u5c5e\u6027\u4e2d\u6ca1\u6709\u627e\u5230\u6388\u6743\u7ec6\u8282\uff0c\u5143\u6570\u636e\u4e2d\u7684\u6388\u6743\u7ec6\u8282\u5c31\u4f1a\u542f\u52a8\u3002\\n\\n\u4f18\u5148\u7ea7\u6392\u5e8f\u5982\u4e0b\\n\\n- \u9996\u5148\uff0c\u8be5\u63d2\u4ef6\u5728 Apache APISIX \u4ee3\u7406\u7684\u8bf7\u6c42\u5934\u4e2d\u5bfb\u627e `x-functions-key` \u6216 `x-functions-clientid` \u952e\u3002\\n\\n- \u5982\u679c\u6ca1\u6709\u627e\u5230\uff0cazure-functions \u63d2\u4ef6\u4f1a\u68c0\u67e5\u63d2\u4ef6\u5c5e\u6027\u4e2d\u7684\u6388\u6743\u7ec6\u8282\u3002\u5982\u679c\u5b58\u5728\uff0c\u5b83\u4f1a\u5c06\u76f8\u5e94\u7684\u6807\u5934\u6dfb\u52a0\u5230\u53d1\u9001\u5230 Azure cloud function \u7684\u8bf7\u6c42\u4e2d\u3002\\n\\n- \u5982\u679c\u5728\u63d2\u4ef6\u5c5e\u6027\u4e2d\u6ca1\u6709\u627e\u5230\u6388\u6743\u7ec6\u8282\uff0cApache APISIX \u5c06\u4e3a\u8be5\u63d2\u4ef6\u83b7\u53d6\u5143\u6570\u636e\u914d\u7f6e\u5e76\u4f7f\u7528\u4e3b\u5bc6\u94a5\u3002\\n\\n\u8981\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u4e3b APIKEY\uff0c\u8bf7\u7528\u66f4\u65b0\u7684\u5143\u6570\u636e\u5411 `/apisix/admin/plugin_metadata` \u7aef\u70b9\u63d0\u51fa\u8bf7\u6c42\uff0c\u5982\u4e0b\u6240\u793a\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/plugin_metadata/azure-functions \\\\\\n-H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"master_apikey\\" : \\"<Your azure master access key>\\"\\n}\'\\n```\\n\\n## \u603b\u7ed3\\n\\n`azure-functions` \u63d2\u4ef6\u662f Apache APISIX \u4e3a serverless \u8bbe\u8ba1\u7684\u7b2c\u4e8c\u4e2a\u63d2\u4ef6\u3002\u6211\u4eec\u6b63\u5728\u5f00\u53d1\u5176\u4ed6 serverless \u63d2\u4ef6\uff0c\u5e76\u4f1a\u5728\u5373\u5c06\u53d1\u5e03\u7684 Apache APISIX \u7248\u672c\u4e2d\u4ecb\u7ecd\u8fd9\u4e9b\u63d2\u4ef6\u3002\u5982\u679c\u5927\u5bb6\u611f\u5174\u8da3\uff0c\u8bf7[\u63d0\u4ea4 Issue](https://github.com/apache/apisix/issues/new/choose)\u6765\u5206\u4eab\u4f60\u7684\u610f\u89c1\uff0c\u4e5f\u53ef\u4ee5\u5728\u6211\u4eec\u7684[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/docs/general/join)\u4e2d\u5206\u4eab\u5f00\u53d1\u65b0\u63d2\u4ef6\u7684\u5efa\u8bae!"},{"id":"Apache APISIX 2.11.0 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2021/12/01/release-apache-apisix-2.11","source":"@site/blog/2021/12/01/release-apache-apisix-2.11.md","title":"Apache APISIX 2.11.0 \u6b63\u5f0f\u53d1\u5e03","description":"API \u7f51\u5173 Apache APISIX 2.11.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff0c\u8be5\u7248\u672c\u652f\u6301\u4e86 LDAP \u8ba4\u8bc1\u63d2\u4ef6\uff0cdatadog \u76d1\u63a7\u63d2\u4ef6\uff0c\u901a\u8fc7\u7f51\u5173\u66b4\u9732 Azure \u7684 FaaS \u51fd\u6570\u4ee5\u53ca\u63d0\u4f9b WASM \u76f8\u5173\u652f\u6301\u7b49\u529f\u80fd\u3002","date":"2021-12-01T00:00:00.000Z","formattedDate":"2021\u5e7412\u67081\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":5.17,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","title":"Author","url":"https://github.com/spacewander","image_url":"https://avatars.githubusercontent.com/u/4161644?v=4","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"},{"name":"\u82cf\u94b0","title":"Technical Writer","url":"https://github.com/SylviaBABY","image_url":"https://avatars.githubusercontent.com/u/39793568?v=4","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"API \u7f51\u5173 APISIX \u73b0\u5df2\u652f\u6301 Azure Functions","permalink":"/zh/blog/2021/12/01/apisix-supports-azure-functions"},"nextItem":{"title":"\u5728 KubeSphere \u4e2d\u4f7f\u7528 APISIX Ingress \u63a5\u5165\u81ea\u5b9a\u4e49\u76d1\u63a7","permalink":"/zh/blog/2021/11/30/use-apisix-ingress-in-kubesphere"}},"content":"> Apache APISIX 2.11.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff0c\u8fd9\u662f\u7ee7 2.10.0 LTS \u7248\u672c\u540e\u7b2c\u4e00\u7248\u5e26\u6709\u65b0\u529f\u80fd\u7684\u7248\u672c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX 2.11.0 \u7248\u672c\u662f\u7ee7\u4e0a\u6b21 2.10.0 LTS \u7248\u672c\u53d1\u5e03\u540e\uff0c\u7b2c\u4e00\u4e2a\u5e26\u6709\u65b0\u529f\u80fd\u7684\u7248\u672c\u3002\u4e0d\u4ec5\u4e30\u5bcc\u4e86\u63d2\u4ef6\u5e93\uff0c\u8fd8\u5e26\u6765\u4e86\u65b0\u9c9c\u7684\u751f\u6001\u652f\u6301\u3002\\n\\n## \u65b0\u529f\u80fd\uff1a\u65b0\u589e\u57fa\u4e8e LDAP \u7684\u8ba4\u8bc1\u63d2\u4ef6\\n\\nApache APISIX \u957f\u957f\u7684\u8ba4\u8bc1\u63d2\u4ef6\u540d\u5355\u4e0a\u53c8\u6dfb\u52a0\u4e86\u65b0\u6210\u5458\u2014\u2014\u57fa\u4e8e LDAP \u7684 `ldap-auth` \u63d2\u4ef6\u3002\u901a\u8fc7\u8be5\u63d2\u4ef6\u6211\u4eec\u53ef\u4ee5\u6253\u901a LDAP \u7684\u8d26\u6237\u4f53\u7cfb\u548c Apache APISIX \u7684 Consumer \u673a\u5236\u3002\\n\\n\u6211\u4eec\u901a\u8fc7\u4ee3\u7801\u7aef\u7b80\u5355\u8fdb\u884c\u793a\u4f8b\u5c55\u793a\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/consumers -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"username\\": \\"user01\\",\\n    \\"plugins\\": {\\n        \\"ldap-auth\\": {\\n            \\"user_dn\\": \\"cn=user01,ou=users,dc=example,dc=org\\"\\n        }\\n    }\\n}\'\\n```\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"methods\\": [\\"GET\\"],\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {\\n        \\"ldap-auth\\": {\\n            \\"base_dn\\": \\"ou=users,dc=example,dc=org\\",\\n            \\"ldap_uri\\": \\"localhost:1389\\",\\n            \\"uid\\": \\"cn\\"\\n        },\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n\u5728\u4e0a\u8ff0\u914d\u7f6e\u4e2d\uff0c\u6211\u4eec\u628a `user01` \u7ed1\u5b9a\u5230 `route 1` \u4e0a\u3002\u8fd9\u6837\u6211\u4eec\u5728\u8bbf\u95ee `route 1` \u65f6\u5c31\u5e26\u4e0a\u4e86 `user01` \u7684\u5bc6\u7801\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7 LDAP \u7684\u8eab\u4efd\u8ba4\u8bc1\u4e86\u3002\\n\\n\u8fd0\u884c\u7ed3\u679c\u5c31\u50cf\u8fd9\u6837\uff1a\\n\\n```shell\\ncurl -i -uuser01:password1 http://127.0.0.1:9080/hello\\nHTTP/1.1 200 OK\\n...\\nhello, world\\n```\\n\\n## \u65b0\u529f\u80fd\uff1a\u53ef\u89c2\u6d4b\u6027\u5c42\u9762\u5bf9\u63a5\u66f4\u591a\u76d1\u63a7\u4f53\u7cfb\\n\\n\u65b0\u7248\u672c\u7684 Apache APISIX \u4e30\u5bcc\u4e86\u5bf9\u5916\u90e8\u76d1\u63a7\u670d\u52a1\u7684\u652f\u6301\u3002\u5728\u8fd9\u65b9\u9762\uff0c\u6211\u4eec\u65b0\u589e\u4e86\u4e24\u4e2a\u63d2\u4ef6\uff1a\\n\\n* \u4e0a\u62a5\u6307\u6807\u5230 datadog \u7684 `datadog` \u63d2\u4ef6\\n* \u4e0a\u62a5\u8bbf\u95ee\u65e5\u5fd7\u5230 Apache Skywalking \u7684 `skywalking-logger` \u63d2\u4ef6\\n\\nDatadog \u662f\u6d77\u5916\u5e7f\u6cdb\u4f7f\u7528\u7684 SaaS \u76d1\u63a7\u670d\u52a1\uff0c\u800c Apache Skywalking \u662f\u4eab\u8a89\u5168\u7403\u7684\u5f00\u6e90\u76d1\u63a7\u8f6f\u4ef6\u3002\u5982\u4eca\u7528\u6237\u53ea\u9700\u5728\u8def\u7531\u4e0a\u7b80\u5355\u914d\u7f6e\u4e00\u4e0b\uff0c\u5c31\u80fd\u5b9e\u73b0\u4e0e\u5b83\u4eec\u7684\u5bf9\u63a5\u3002\\n\\nDatadog \u793a\u4f8b\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n      \\"plugins\\": {\\n            \\"datadog\\": {}\\n       },\\n      \\"upstream\\": {\\n           \\"type\\": \\"roundrobin\\",\\n           \\"nodes\\": {\\n               \\"127.0.0.1:1980\\": 1\\n           }\\n      },\\n      \\"uri\\": \\"/hello\\"\\n}\'\\n```\\n\\nApache SkyWalking \u793a\u4f8b\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\":{\\n        \\"skywalking-logger\\":{\\n            \\"endpoint_addr\\":\\"http://127.0.0.1:12800\\"\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"127.0.0.1:1980\\":1\\n        }\\n    },\\n    \\"uri\\":\\"/hello\\"\\n}\'\\n```\\n\\n## \u65b0\u529f\u80fd\uff1a\u901a\u8fc7\u7f51\u5173\u66b4\u9732 Azure \u7684 FaaS \u51fd\u6570\\n\\n\u7f51\u5173\u80fd\u505a\u7684\u4e0d\u4ec5\u4ec5\u662f\u4ee3\u7406\u5185\u90e8\u670d\u52a1\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528\u5b83\u6765\u8fde\u63a5\u5916\u90e8\u7684\u7cfb\u7edf\u3002\\n\\n\u73b0\u5728\u901a\u8fc7 `azure-functions` \u63d2\u4ef6\uff0c\u5c31\u53ef\u4ee5\u5229\u7528 HTTP \u8bf7\u6c42\u89e6\u53d1 Azure functions \u670d\u52a1\u4e0a\u7684\u51fd\u6570\u4e86\u3002\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u901a\u8fc7\u4e0b\u65b9\u793a\u4f8b\u6765\u5c55\u793a\u5982\u4f55\u628a Azure \u4e0a\u914d\u7f6e\u597d\u7684\u51fd\u6570\uff0c\u8ddf Apache APISIX \u4e0a `/azure_HttpTrigger` \u8def\u7531\u8fde\u63a5\u8d77\u6765\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\":{\\n        \\"azure-functions\\":{\\n            \\"function_uri\\":\\"http://test-apisix.azurewebsites.net/api/HttpTrigger\\",\\n            \\"authorization\\":{\\n                \\"apikey\\":\\"<Generated API key to access the Azure-Function>\\"\\n            }\\n        }\\n    },\\n    \\"uri\\":\\"/azure_HttpTrigger\\"\\n}\'\\n```\\n\\n\u5bf9\u8be5\u8def\u7531\u7684\u8bbf\u95ee\uff0c\u7b49\u4ef7\u4e8e\u5bf9 FaaS \u5e73\u53f0\u4e0a\u7684\u51fd\u6570\u8c03\u7528\u3002\u4e0e\u6b64\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6b64\u8fc7\u7a0b\u4e2d\u52a0\u5165\u9274\u6743\u3001\u9650\u6d41\u7b49\u5bf9\u5e94\u7684\u9650\u5236\u3002\\n\\n## \u65b0\u529f\u80fd\uff1a\u63d0\u4f9b WASM \u76f8\u5173\u652f\u6301\\n\\n\u76ee\u524d Apache APISIX \u5df2\u5f00\u59cb\u63d0\u4f9b\u5bf9 WASM \u7684\u521d\u6b65\u652f\u6301\u3002\u51ed\u501f Proxy WASM SDK\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528 Lua \u4ee5\u5916\u7684\u8bed\u8a00\uff0c\u7f16\u5199\u8fd0\u884c\u5728 Apache APISIX \u5185\u90e8\u7684\u63d2\u4ef6\u3002\\n\\n\u6709\u522b\u4e8e\u4e4b\u524d\u7684\u5916\u90e8\u63d2\u4ef6\u529f\u80fd\uff0c\u8fd9\u4e00\u673a\u5236\u662f\u8fd0\u884c\u5728 Apache APISIX \u5185\u90e8\u7684\uff0c\u6240\u4ee5\u5728\u6027\u80fd\u4e0a\u76f8\u6bd4\u4e4b\u524d\u4f1a\u66f4\u52a0\u51fa\u8272\u3002\\n\\n\u5728 Apache APISIX \u91cc\u4f7f\u7528 WASM \u63d2\u4ef6\uff0c\u5c31\u50cf\u91c7\u7528 Lua \u63d2\u4ef6\u4e00\u6837\uff0c\u4e24\u8005\u90fd\u652f\u6301\u5728\u8def\u7531\u548c\u5168\u5c40\u8303\u56f4\u4e0a\u751f\u6548\u3002\u6211\u4eec\u5728 Apache APISIX \u4ee3\u7801\u4ed3\u5e93\u91cc\u653e\u7f6e\u4e86\u4e00\u4e2a\u57fa\u4e8e WASM \u5b9e\u73b0\u7684 `fault-injection` \u63d2\u4ef6\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u770b\u4e00\u4e0b\u5b83\u8ddf Lua \u7248\u672c\u7684\u540c\u540d\u63d2\u4ef6\u7684\u533a\u522b\u3002\\n\\n\u66f4\u591a\u5173\u4e8e Apache APISIX \u652f\u6301 WASM \u7684\u6280\u672f\u7ec6\u8282\u53ef\u4ee5\u53c2\u8003[\u8fd9\u7bc7\u6587\u7ae0](https://apisix.apache.org/zh/blog/2021/11/19/apisix-supports-wasm)\u3002\\n\\n\u76ee\u524d Apache APISIX \u5bf9 WASM \u7684\u652f\u6301\u8fd8\u5904\u4e8e\u65e9\u671f\u9636\u6bb5\uff0c\u6211\u4eec\u4f1a\u5728\u63a5\u4e0b\u6765\u7684\u51e0\u4e2a\u7248\u672c\u4e2d\u9010\u6e10\u53bb\u5b8c\u5584\u4e0e\u4e30\u5bcc\u76f8\u5173\u7ec6\u8282\u3002\\n\\n## \u5b8c\u5584\uff1a\u73b0\u6709\u63d2\u4ef6\u529f\u80fd\u66f4\u4e3a\u4e30\u5bcc\\n\\n\u5f53\u7136\uff0c\u9664\u4e86\u4e0a\u8ff0\u65b0\u589e\u7684\u591a\u9879\u529f\u80fd\uff0c\u6211\u4eec\u8fd8\u5b8c\u5584\u4e86 Apache APISIX \u73b0\u6709\u63d2\u4ef6\u529f\u80fd\uff0c\u6bd4\u5982\uff1a\\n\\n* limit-req/conn/count \u7b49\u63d2\u4ef6\u73b0\u5df2\u652f\u6301\u91c7\u7528\u4e00\u7ec4\u53d8\u91cf\u4f5c\u4e3a\u9650\u5236\u65f6\u7684 key\\n* proxy-cache \u5f15\u5165\u57fa\u4e8e\u5185\u5b58\u7684\u540e\u7aef\\n\\n\u66f4\u591a\u63d2\u4ef6\u65b0\u529f\u80fd\u4e0e\u65b0\u589e\u7ec4\u4ef6\u7ec6\u8282\uff0c\u53ef\u53c2\u8003\u672c\u6b21\u53d1\u5e03\u5bf9\u5e94\u7684 [Change log](https://github.com/apache/apisix/blob/release/2.11/CHANGELOG.md#2110)\u3002\\n\\n## \u4e0b\u8f7d\\n\\n\u83b7\u53d6\u6700\u65b0\u7248\u672c\u7684 Apache APISIX 2.11.0\uff0c\u53ef\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u8fdb\u884c\u4e0b\u8f7d\u5b89\u88c5\uff1a\\n\\n* [\u6e90\u4ee3\u7801](https://apisix.apache.org/downloads/)\\n* [\u4e8c\u8fdb\u5236\u5b89\u88c5\u5305](https://apisix.apache.org/zh/docs/apisix/how-to-build/)"},{"id":"\u5728 KubeSphere \u4e2d\u4f7f\u7528 APISIX Ingress \u63a5\u5165\u81ea\u5b9a\u4e49\u76d1\u63a7","metadata":{"permalink":"/zh/blog/2021/11/30/use-apisix-ingress-in-kubesphere","source":"@site/blog/2021/11/30/use-apisix-ingress-in-kubesphere.md","title":"\u5728 KubeSphere \u4e2d\u4f7f\u7528 APISIX Ingress \u63a5\u5165\u81ea\u5b9a\u4e49\u76d1\u63a7","description":"\u672c\u6587\u5c06\u901a\u8fc7 Apache APISIX Ingress Controller \u4e3a\u8303\u4f8b\uff0c\u8be6\u7ec6\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 KubeSphere \u5feb\u901f\u4e3a Kubernetes \u96c6\u7fa4\u4f7f\u7528\u4e0d\u540c\u7c7b\u578b\u7684\u7f51\u5173\u5e76\u8fdb\u884c\u72b6\u6001\u76d1\u63a7\u3002","date":"2021-11-30T00:00:00.000Z","formattedDate":"2021\u5e7411\u670830\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":18.505,"truncated":true,"authors":[{"name":"\u5f20\u6d77\u7acb","url":"https://github.com/webup","imageURL":"https://avatars.githubusercontent.com/u/2936504?v=4"}],"prevItem":{"title":"Apache APISIX 2.11.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/12/01/release-apache-apisix-2.11"},"nextItem":{"title":"\u6210\u4e3a Apache APISIX Committer \u8ba9\u6211\u4f53\u4f1a\u5230\u4e86\u77e5\u8bc6\u8f6c\u6362\u4ef7\u503c\u7684\u610f\u4e49","permalink":"/zh/blog/2021/11/26/apache-apisix-committer-experience"}},"content":"> \u672c\u6587\u5c06\u901a\u8fc7 Apache APISIX Ingress Controller \u4e3a\u8303\u4f8b\uff0c\u8be6\u7ec6\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 KubeSphere \u5feb\u901f\u4e3a Kubernetes \u96c6\u7fa4\u4f7f\u7528\u4e0d\u540c\u7c7b\u578b\u7684\u7f51\u5173\u5e76\u8fdb\u884c\u72b6\u6001\u76d1\u63a7\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n11\u6708\u521d\uff0cKubeSphere \u53d1\u5e03\u4e86 3.2.0 \u7248\u672c\uff0c\u65b0\u7248\u672c\u4e3a\u9879\u76ee\u7f51\u5173\u589e\u914d\u4e86\u6574\u5957\u76d1\u63a7\u53ca\u7ba1\u7406\u9875\u9762\uff0c\u540c\u65f6\u5f15\u5165\u4e86\u96c6\u7fa4\u7f51\u5173\u6765\u63d0\u4f9b\u96c6\u7fa4\u5c42\u9762\u5168\u5c40\u7684 Ingress \u7f51\u5173\u80fd\u529b\u3002\\n\\n\u4e3a\u4e86\u8ba9\u7528\u6237\u66f4\u4e86\u89e3\u5982\u4f55\u5728\u65b0\u7248 KubeSphere \u4e2d\u90e8\u7f72\u4f7f\u7528\u7b2c\u4e09\u65b9 Ingress Controller\uff0c\u672c\u6587\u5c06\u4ee5 [Apache APISIX Ingress Controller](https://apisix.apache.org/docs/ingress-controller/getting-started/) \u4e3a\u4f8b\uff0c\u4e3a\u5927\u5bb6\u5c55\u793a\u901a\u8fc7 KubeSphere \u5feb\u901f\u4e3a Kubernetes \u96c6\u7fa4\u4f7f\u7528\u4e0d\u540c\u7c7b\u578b\u7684\u7f51\u5173\u5e76\u8fdb\u884c\u72b6\u6001\u76d1\u63a7\u3002\\n\\n## \u51c6\u5907\u5de5\u4f5c\\n\\n### \u5b89\u88c5 KubeSphere\\n\\n\u5b89\u88c5 KubeSphere \u6709\u4e24\u79cd\u65b9\u6cd5\uff1a\\n\\n1. [\u5728 Linux \u4e0a\u76f4\u63a5\u5b89\u88c5](https://kubesphere.com.cn/docs/quick-start/all-in-one-on-linux/)\\n2. [\u5728\u5df2\u6709 Kubernetes \u4e2d\u5b89\u88c5](https://kubesphere.com.cn/docs/quick-start/minimal-kubesphere-on-k8s/)\\n\\nKubeSphere \u6700\u5c0f\u5316\u5b89\u88c5\u7248\u672c\u5df2\u7ecf\u5305\u542b\u4e86\u76d1\u63a7\u6a21\u5757\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u989d\u5916\u542f\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7\u300c\u7cfb\u7edf\u7ec4\u4ef6\u300d\u9875\u9762\u4e2d\u7684\u300c\u76d1\u63a7\u300d\u6807\u7b7e\u9875\u786e\u8ba4\u5b89\u88c5\u72b6\u6001\u3002\\n\\n![\u786e\u8ba4\u5b89\u88c5\u72b6\u6001](https://static.apiseven.com/202108/1638255471644-e1327ffc-dbed-4890-a15c-819f28731fc9.png)\\n\\n### \u90e8\u7f72 httpbin \u6f14\u793a\u5e94\u7528\\n\\n\u7531\u4e8e\u9700\u8981\u6f14\u793a\u7f51\u5173\u7684\u8bbf\u95ee\u63a7\u5236\u80fd\u529b\uff0c\u6211\u4eec\u5fc5\u987b\u8981\u5148\u6709\u4e00\u4e2a\u53ef\u4ee5\u8bbf\u95ee\u7684\u5e94\u7528\u4f5c\u4e3a\u7f51\u5173\u7684\u540e\u53f0\u670d\u52a1\u3002\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 [httpbin.org](httpbin.org) \u63d0\u4f9b\u7684 [kennethreitz/httpbin](https://hub.docker.com/r/kennethreitz/httpbin/) \u5bb9\u5668\u5e94\u7528\u4f5c\u4e3a\u6f14\u793a\u5e94\u7528\u3002\\n\\n\u5728 KubeSphere \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u521b\u5efa\u65b0\u7684\u9879\u76ee\u6216\u4f7f\u7528\u5df2\u6709\u7684\u9879\u76ee\uff0c\u8fdb\u5165\u9879\u76ee\u9875\u9762\u540e\uff0c\u9009\u62e9\u300c\u5e94\u7528\u8d1f\u8f7d\u300d\u4e0b\u7684\u300c\u670d\u52a1\u300d\u76f4\u63a5\u521b\u5efa\u65e0\u72b6\u6001\u5de5\u4f5c\u8d1f\u8f7d\u5e76\u751f\u6210\u914d\u5957\u670d\u52a1\u3002\\n\\n![\u521b\u5efa\u670d\u52a1](https://static.apiseven.com/202108/1638255616585-b0f5a674-f06a-4b18-baf9-8d6006abeead.png)\\n\\n\u4f7f\u7528 [kennethreitz/httpbin](https://hub.docker.com/r/kennethreitz/httpbin/) \u5bb9\u5668\u9ed8\u8ba4\u7684 `80` \u7aef\u53e3\u4f5c\u4e3a\u670d\u52a1\u7aef\u53e3\uff0c\u521b\u5efa\u5b8c\u6210\u540e\u786e\u4fdd\u5728\u300c\u5de5\u4f5c\u8d1f\u8f7d\u300d\u548c\u300c\u670d\u52a1\u300d\u9875\u9762\u4e0b\u90fd\u53ef\u4ee5\u770b\u5230 `httpbin` \u7684\u5bf9\u5e94\u6761\u76ee\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![\u670d\u52a1](https://static.apiseven.com/202108/1638255786442-924bf704-9b9d-413f-9fc0-be6650a6ff4a.png)\\n\\n![\u5de5\u4f5c\u8d1f\u8f7d](https://static.apiseven.com/202108/1638255792974-7f354950-e34a-427a-9ff7-aa3af0a56dd6.png)\\n\\n### \u9879\u76ee\u7f51\u5173\u7ec6\u8282\u8865\u5145\\n\\n**\u9879\u76ee\u7f51\u5173**\u662f KubeSphere 3.0 \u4e4b\u540e\u4e0a\u7ebf\u7684\u529f\u80fd\u3002KubeSphere \u9879\u76ee\u4e2d\u7684\u7f51\u5173\u662f\u4e00\u4e2a NGINX Ingress \u63a7\u5236\u5668\u3002KubeSphere \u5185\u7f6e\u7528\u4e8e HTTP \u8d1f\u8f7d\u5747\u8861\u7684\u673a\u5236\u79f0\u4e3a**\u5e94\u7528\u8def\u7531**\uff0c\u5b83\u5b9a\u4e49\u4e86\u4ece\u5916\u90e8\u5230\u96c6\u7fa4\u670d\u52a1\u7684\u8fde\u63a5\u89c4\u5219\u3002\u5982\u9700\u5141\u8bb8\u4ece\u5916\u90e8\u8bbf\u95ee\u670d\u52a1\uff0c\u7528\u6237\u53ef\u521b\u5efa\u8def\u7531\u8d44\u6e90\u6765\u5b9a\u4e49 URI \u8def\u5f84\u3001\u540e\u7aef\u670d\u52a1\u540d\u79f0\u7b49\u4fe1\u606f\u3002\\n\\n\u627f\u63a5\u4e0a\u6587\u4e2d\u5df2\u90e8\u7f72\u7684 `httpbin` \u670d\u52a1\u9879\u76ee\uff0c\u5728\u300c\u9879\u76ee\u8bbe\u7f6e\u300d\u4e2d\u6253\u5f00\u300c\u7f51\u5173\u8bbe\u7f6e\u300d\u9875\u9762\uff0c\u7136\u540e\u6267\u884c\u300c\u5f00\u542f\u7f51\u5173\u300d\u64cd\u4f5c\u3002\u65b9\u4fbf\u8d77\u89c1\uff0c\u76f4\u63a5\u9009\u62e9 `NodePort` \u4f5c\u4e3a\u300c\u8bbf\u95ee\u65b9\u5f0f\u300d\u5373\u53ef\u3002\\n\\n![\u9879\u76ee\u8bbe\u7f6e](https://static.apiseven.com/202108/1638256005754-d1e8bf9a-0ecc-4c6e-8ceb-0c25b04fef20.png)\\n\\n\u786e\u5b9a\u540e\u56de\u5230\u7f51\u5173\u9875\u9762\uff0c\u7a0d\u7b49\u7247\u523b\u540e\u5237\u65b0\u9875\u9762\uff0c\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u56fe\u663e\u793a\u7684\u90e8\u7f72\u5b8c\u6210\u72b6\u6001\uff0c\u5728\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230 NodePort \u9ed8\u8ba4\u88ab\u8d4b\u4e88\u4e86\u4e24\u4e2a\u8282\u70b9\u7aef\u53e3\u3002\u63a5\u62db\u6211\u4eec\u901a\u8fc7\u53f3\u4e0a\u89d2\u7684\u300c\u7ba1\u7406\u300d\u6309\u94ae\u300c\u67e5\u770b\u8be6\u60c5\u300d\u3002\\n\\n![\u90e8\u7f72\u5b8c\u6210](https://static.apiseven.com/202108/1638256011357-960f6852-31b3-4702-8911-17d07ec19d7b.png)\\n\\n\u6b64\u65f6\u6211\u4eec\u770b\u5230\u7684\u4fbf\u662f 3.2.0 \u7248\u672c\u5173\u4e8e\u9879\u76ee/\u96c6\u7fa4\u7f51\u5173\u7684\u65b0\u76d1\u63a7\u9875\u9762\u3002\u4e0b\u9762\u6211\u4eec\u5c31\u9700\u8981\u4e3a httpbin \u670d\u52a1\u521b\u5efa\u5e94\u7528\u8def\u7531\u3002\\n\\n\u4ece\u300c\u5e94\u7528\u8d1f\u8f7d\u300d\u8fdb\u5165\u300c\u5e94\u7528\u8def\u7531\u300d\u9875\u9762\uff0c\u5f00\u59cb\u300c\u521b\u5efa\u300d\u8def\u7531\u3002\u4e3a\u8def\u7531\u53d6\u540d\u4e3a `httpbin` \u540e\uff0c\u6211\u4eec\u6307\u5b9a\u4e00\u4e2a\u65b9\u4fbf\u6d4b\u8bd5\u7684\u57df\u540d\uff0c\u5e76\u8bbe\u7f6e\u300c\u8def\u5f84\u300d\u4e3a `/`, \u9009\u62e9\u300c\u670d\u52a1\u300d`httpbin` \u548c\u300c\u7aef\u53e3\u300d`80`\u3002\\n\\n![\u5e94\u7528\u8def\u7531](https://static.apiseven.com/202108/1638241684770-ce94fe24-58a6-4b9b-9507-d802713b4c38.png)\\n\\n![\u521b\u5efa\u8def\u7531](https://static.apiseven.com/202108/1638241689985-149fc2f7-456b-423c-8cfc-00800dc24917.png)\\n\\n\u76f4\u63a5\u4e0b\u4e00\u6b65\u8df3\u8fc7\u9ad8\u7ea7\u8bbe\u7f6e\u540e\u5b8c\u6210\u8def\u7531\u521b\u5efa\uff0c\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u56fe\u6240\u793a\u7684 httpbin \u5e94\u7528\u8def\u7531\u9879\u3002\\n\\n![\u5e94\u7528\u8def\u7531\u9879\u7ec6\u8282](https://static.apiseven.com/202108/1638256382273-109728eb-4d19-4c2b-ab92-9a2909c3eff8.png)\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u9879\u76ee\u7f51\u5173\u7684 NodePort \u5730\u5740\u53ca\u6307\u5b9a\u57df\u540d\uff08\u5982\u8fd9\u91cc\u662f http://httpbin.ui:32516\uff09\u6765\u8bbf\u95ee httpbin \u5e94\u7528\u670d\u52a1\uff0c\u968f\u610f\u5237\u65b0\u6216\u64cd\u4f5c\u4e00\u4e0b\u9875\u9762\u7684\u8bf7\u6c42\u751f\u6210\u529f\u80fd\uff0c\u518d\u8fdb\u5165\u7f51\u5173\u7684\u8be6\u60c5\u9875\u9762\uff0c\u4fbf\u53ef\u4ee5\u770b\u5230\u5728\u300c\u76d1\u63a7\u300d\u9762\u677f\u4e0a\u5df2\u7ecf\u51fa\u73b0\u4e86\u7f51\u5173\u7684\u4e00\u4e9b\u5185\u7f6e\u7684\u76d1\u63a7\u6307\u6807\u5c55\u793a\u3002\\n\\n![\u76d1\u63a7\u6307\u6807\u5c55\u793a](https://static.apiseven.com/202108/1638256419345-48476f01-b293-401b-9e4f-8bf64a9fab90.png)\\n\\n#### \u6307\u5b9a NodePort \u8282\u70b9\u7aef\u53e3\\n\\n\u5bf9\u4e8e\u516c\u6709\u4e91\u73af\u5883\uff0c\u5982\u679c\u4f7f\u7528 NodePort \u65b9\u5f0f\u5411\u5916\u66b4\u9732\u8bbf\u95ee\u80fd\u529b\uff0c\u5f00\u653e\u7aef\u53e3\u901a\u5e38\u662f\u6709\u9650\u4e14\u53d7\u63a7\u7684\uff0c\u56e0\u6b64\u5bf9\u4e8e\u7f51\u5173\u6240\u4f7f\u7528\u7684 NodePort \u6211\u4eec\u9700\u8981\u5bf9\u5b83\u8fdb\u884c\u4fee\u6539\u3002\\n\\n\u7531\u4e8e\u7f51\u5173\u662f\u88ab KubeSphere \u7edf\u4e00\u7ba1\u7406\u7684\uff0c\u8981\u4fee\u6539\u7f51\u5173\u670d\u52a1\u7684 NodePort \u9700\u8981\u5177\u5907\u8bbf\u95ee `kubesphere-controls-system` \u7684\u9879\u76ee\u6743\u9650\u3002\u8fdb\u5165\u8be5\u9879\u76ee\u540e\uff0c\u901a\u8fc7\u300c\u5e94\u7528\u8d1f\u8f7d\u300d\u7684\u300c\u670d\u52a1\u300d\u9875\u9762\u5373\u53ef\u627e\u5230\u547d\u540d\u4e3a `kubesphere-router-<project-namespace>` \u5f62\u5f0f\u4e14\u5916\u90e8\u8bbf\u95ee\u5df2\u5f00\u653e NodePort \u7684\u7f51\u5173\u670d\u52a1\u3002NodePort \u670d\u52a1\u7aef\u53e3\u9700\u8981\u901a\u8fc7\u300c\u7f16\u8f91 YAML\u300d\u6765\u76f4\u63a5\u4fee\u6539\u3002\\n\\n![\u6307\u5b9a NodePort \u7aef\u53e3](https://static.apiseven.com/202108/1638256523468-408ee36f-aac7-4bb4-9cd3-2473a95a52f4.png)\\n\\n## \u5f00\u59cb\u4f7f\u7528\u96c6\u7fa4\u7f51\u5173\\n\\n>KubeSphere 3.2.0 \u5f00\u59cb\u652f\u6301\u96c6\u7fa4\u7ea7\u522b\u7684\u5168\u5c40\u7f51\u5173\uff0c\u6240\u6709\u9879\u76ee\u53ef\u5171\u7528\u540c\u4e00\u4e2a\u7f51\u5173\uff0c\u4e4b\u524d\u5df2\u521b\u5efa\u7684\u9879\u76ee\u7f51\u5173\u4e5f\u4e0d\u4f1a\u53d7\u5230\u96c6\u7fa4\u7f51\u5173\u7684\u5f71\u54cd\u3002\u4e5f\u53ef\u4ee5\u7edf\u4e00\u7eb3\u7ba1\u6240\u6709\u9879\u76ee\u7684\u7f51\u5173\uff0c\u5bf9\u5176\u8fdb\u884c\u96c6\u4e2d\u7ba1\u7406\u548c\u914d\u7f6e\uff0c\u7ba1\u7406\u5458\u7528\u6237\u518d\u4e5f\u4e0d\u9700\u8981\u5207\u6362\u5230\u4e0d\u540c\u7684\u4f01\u4e1a\u7a7a\u95f4\u4e2d\u53bb\u914d\u7f6e\u7f51\u5173\u4e86\u3002\\n\\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u662f KubeSphere 3.2.0 \u7248\u672c\uff0c\u6211\u4eec\u66f4\u63a8\u8350\u5927\u5bb6\u4f7f\u7528\u96c6\u7fa4\u7f51\u5173\u7684\u529f\u80fd\u6765\u7edf\u4e00\u6574\u4e2a\u96c6\u7fa4\u7684\u5e94\u7528\u8def\u7531\u3002\u8981\u542f\u7528\u96c6\u7fa4\u7f51\u5173\u4e5f\u975e\u5e38\u7b80\u5355\uff1a\u4f7f\u7528\u5177\u5907\u96c6\u7fa4\u7ba1\u7406\u6743\u9650\u7684\u8d26\u53f7\uff0c\u8fdb\u5165\u5176\u53ef\u7ba1\u7406\u7684\u67d0\u4e2a\u96c6\u7fa4\uff08\u5982\u6211\u4eec\u8fd9\u91cc\u4ee5 `default` \u96c6\u7fa4\u4e3a\u4f8b\uff09\uff0c\u5728\u300c\u96c6\u7fa4\u8bbe\u7f6e\u300d\u7684\u300c\u7f51\u5173\u8bbe\u7f6e\u300d\u4e2d\u5373\u53ef\u300c\u5f00\u542f\u7f51\u5173\u300d\uff0c\u540c\u65f6\u67e5\u770b\u300c\u9879\u76ee\u7f51\u5173\u300d\u3002\\n\\n![\u5f00\u542f\u7f51\u5173\u8bbe\u7f6e](https://static.apiseven.com/202108/1638256574546-920473f3-e8ac-4cf9-932b-4202888e7a54.png)\\n\\n\u96c6\u7fa4\u7f51\u5173\u5f00\u542f\u7684\u65b9\u5f0f\u4ee5\u53ca\u5bf9\u9f50 NodePort \u8bbf\u95ee\u7aef\u53e3\u7684\u4fee\u6539\u548c\u4e4b\u524d\u9879\u76ee\u7f51\u5173\u7684\u64cd\u4f5c\u57fa\u672c\u5b8c\u5168\u4e00\u81f4\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u8d58\u8ff0\u4e86\u3002\\n\\n\u4f46\u6709\u4e00\u70b9\u9700\u8981\u7279\u522b\u6ce8\u610f\uff1a\u96c6\u7fa4\u7f51\u5173\u5f00\u542f\u540e\uff0c\u5df2\u7ecf\u5f00\u542f\u7684\u9879\u76ee\u7f51\u5173\u8fd8\u4f1a\u4fdd\u7559\uff1b\u4f46\u5c1a\u672a\u521b\u5efa\u7f51\u5173\u7684\u9879\u76ee\u662f\u65e0\u6cd5\u518d\u521b\u5efa\u5355\u72ec\u7684\u7f51\u5173\u7684\uff0c\u4f1a\u76f4\u63a5\u4f7f\u7528\u96c6\u7fa4\u7f51\u5173\u3002\\n\\n\u4e0b\u56fe\u5c55\u793a\u4e86\u5df2\u521b\u5efa\u7f51\u5173\u7684\u9879\u76ee\uff0c\u5728\u540c\u65f6\u62e5\u6709\u9879\u76ee\u53ca\u96c6\u7fa4\u7f51\u5173\u540e\uff0c\u5728\u300c\u7f51\u5173\u8bbe\u7f6e\u300d\u9875\u9762\u6240\u5448\u73b0\u7684\u6240\u6709\u7f51\u5173\u6982\u89c8\u3002\\n\\n![\u7f51\u5173\u8bbe\u7f6e\u9875\u9762\u4e00\u89c8](https://static.apiseven.com/202108/1638256658706-ac5107fe-2fd7-4521-b830-9ae1fdf762e1.png)\\n\\n## \u5feb\u901f\u4f7f\u7528 Apache APISIX Ingress Controller\\n\\nApache APISIX \u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u9ad8\u6027\u80fd\u3001\u52a8\u6001\u4e91\u539f\u751f\u7f51\u5173\uff0c\u7531\u6df1\u5733[\u652f\u6d41\u79d1\u6280](https://api7.ai/)\u6709\u9650\u516c\u53f8\u4e8e 2019 \u5e74\u6350\u8d60\u7ed9 Apache \u57fa\u91d1\u4f1a\uff0c\u76ee\u524d\u5df2\u6210\u4e3a Apache \u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u662f GitHub \u4e0a\u6700\u6d3b\u8dc3\u7684\u7f51\u5173\u9879\u76ee\u3002Apache APISIX \u76ee\u524d\u5df2\u8986\u76d6 API \u7f51\u5173\u3001LB\u3001Kubernetes Ingress\u3001Service Mesh \u7b49\u591a\u79cd\u573a\u666f\u3002\\n\\n### \u5982\u4f55\u90e8\u7f72\\n\\n\u9996\u5148\u6dfb\u52a0 Apache APISIX Helm Chart \u4ed3\u5e93\u3002\u4e4b\u540e\u9009\u5b9a\u4e00\u4e2a\u4f01\u4e1a\u7a7a\u95f4\uff0c\u901a\u8fc7\u300c\u5e94\u7528\u7ba1\u7406\u300d\u4e0b\u7684\u300c\u5e94\u7528\u4ed3\u5e93\u300d\u6765\u6dfb\u52a0\u5982\u4e0b\u4e00\u4e2a [Apache APISIX \u7684\u4ed3\u5e93](https://charts.apiseven.com)\u3002\\n\\n![\u6dfb\u52a0\u4ed3\u5e93](https://static.apiseven.com/202108/1638256788584-dca2d21b-3ffc-4bb4-bd73-56dedb6d005a.png)\\n\\n\u63a5\u4e0b\u6765\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a `apisix-system` \u7684\u9879\u76ee\u3002\u8fdb\u5165\u9879\u76ee\u9875\u9762\u540e\uff0c\u9009\u62e9\u5728\u300c\u5e94\u7528\u8d1f\u8f7d\u300d\u4e2d\u521b\u5efa\u300c\u5e94\u7528\u300d\u7684\u65b9\u5f0f\u6765\u90e8\u7f72 Apache APISIX\uff0c\u5e76\u9009\u62e9 `apisix` \u5e94\u7528\u6a21\u7248\u5f00\u59cb\u8fdb\u884c\u90e8\u7f72\u3002\\n\\n![\u90e8\u7f72\u5e94\u7528\u8d1f\u8f7d](https://static.apiseven.com/202108/1638241691528-80090ab6-85de-401f-96d7-58118b3cbd88.png)\\n\\n>\u4e3a\u4f55\u662f\u76f4\u63a5\u90e8\u7f72 Apache APISIX \u5e94\u7528\u7684 Helm Chart\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u90e8\u7f72 Apache APISIX Ingress Controller?\\n\\n\u8fd9\u662f\u56e0\u4e3a Apache APISIX Ingress Controller \u76ee\u524d\u548c Apache APISIX \u7f51\u5173\u662f\u5f3a\u5173\u8054\u7684\uff08\u5982\u4e0b\u56fe\u6240\u793a\uff09\uff0c\u4e14\u76ee\u524d\u901a\u8fc7 Apache APISIX Helm Charts \u540c\u65f6\u90e8\u7f72 Apache APISIX Gateway + Dashboard + Ingress Controller \u662f\u6700\u65b9\u4fbf\u7684\uff0c\u56e0\u6b64\u672c\u6587\u63a8\u8350\u76f4\u63a5\u4f7f\u7528 Apache APISIX \u7684 Helm Chart \u8fdb\u884c\u6574\u5957\u7ec4\u4ef6\u7684\u90e8\u7f72\u3002\\n\\n![\u4e3a\u4ec0\u4e48\u76f4\u63a5\u90e8\u7f72 APISIX](https://static.apiseven.com/202108/1638241693072-9b3146f5-bcc6-4441-b002-f1a07603a8c4.png)\\n\\n\u5c06\u5e94\u7528\u547d\u540d\u4e3a `apisix` \u4ee5\u907f\u514d\u591a\u4e2a\u7ec4\u4ef6\uff08Gateway, Dashboard, Ingress Controller\uff09\u7684\u5de5\u4f5c\u8d1f\u8f7d\u53ca\u670d\u52a1\u540d\u79f0\u4ea7\u751f\u4e0d\u5339\u914d\u7684\u60c5\u51b5\uff1b\u5728\u5b89\u88c5\u6b65\u9aa4\u4e2d\u7f16\u8f91\u7684\u300c\u5e94\u7528\u8bbe\u7f6e\u300d\u7684\u90e8\u5206\uff0c\u8bf7\u53c2\u7167\u4ee5\u4e0b\u914d\u7f6e\u8fdb\u884c\u586b\u5199\uff08\u8bf7\u7279\u522b\u6ce8\u610f\u5e26\u6709\u3010\u6ce8\u610f\u3011\u6807\u8bb0\u7684\u6ce8\u91ca\u90e8\u5206\u7684\u8bf4\u660e\uff0c\u5176\u4f59\u53ef\u4ee5\u6309\u9700\u81ea\u884c\u7f16\u8f91\u4fee\u6539\uff09\u3002\\n\\n```yaml\\nglobal:\\n  imagePullSecrets: []\\n\\napisix:\\n  enabled: true\\n  customLuaSharedDicts: []\\n  image:\\n    repository: apache/apisix\\n    pullPolicy: IfNotPresent\\n    tag: 2.10.1-alpine\\n  replicaCount: 1\\n  podAnnotations: {}\\n  podSecurityContext: {}\\n  securityContext: {}\\n  resources: {}\\n  nodeSelector: {}\\n  tolerations: []\\n  affinity: {}\\n  podAntiAffinity:\\n    enabled: false\\n\\nnameOverride: \'\'\\nfullnameOverride: \'\'\\n\\ngateway:\\n  type: NodePort\\n  externalTrafficPolicy: Cluster\\n  http:\\n    enabled: true\\n    servicePort: 80\\n    containerPort: 9080\\n  tls:\\n    enabled: false\\n    servicePort: 443\\n    containerPort: 9443\\n    existingCASecret: \'\'\\n    certCAFilename: \'\'\\n    http2:\\n      enabled: true\\n  stream:\\n    enabled: false\\n    only: false\\n    tcp: []\\n    udp: []\\n  ingress:\\n    enabled: false\\n    annotations: {}\\n    hosts:\\n      - host: apisix.local\\n        paths: []\\n    tls: []\\n\\nadmin:\\n  enabled: true\\n  type: ClusterIP\\n  externalIPs: []\\n  port: 9180\\n  servicePort: 9180\\n  cors: true\\n  credentials:\\n    admin: edd1c9f034335f136f87ad84b625c8f1\\n    viewer: 4054f7cf07e344346cd3f287985e76a2\\n  allow:\\n    ipList:\\n      - 0.0.0.0/0\\n\\nplugins:\\n  - api-breaker\\n  - authz-keycloak\\n  - basic-auth\\n  - batch-requests\\n  - consumer-restriction\\n  - cors\\n  - echo\\n  - fault-injection\\n  - grpc-transcode\\n  - hmac-auth\\n  - http-logger\\n  - ip-restriction\\n  - ua-restriction\\n  - jwt-auth\\n  - kafka-logger\\n  - key-auth\\n  - limit-conn\\n  - limit-count\\n  - limit-req\\n  - node-status\\n  - openid-connect\\n  - authz-casbin\\n  - prometheus\\n  - proxy-cache\\n  - proxy-mirror\\n  - proxy-rewrite\\n  - redirect\\n  - referer-restriction\\n  - request-id\\n  - request-validation\\n  - response-rewrite\\n  - serverless-post-function\\n  - serverless-pre-function\\n  - sls-logger\\n  - syslog\\n  - tcp-logger\\n  - udp-logger\\n  - uri-blocker\\n  - wolf-rbac\\n  - zipkin\\n  - traffic-split\\n  - gzip\\n  - real-ip\\n  #\u3010\u6ce8\u610f\u3011\u6dfb\u52a0\u6b64\u63d2\u4ef6\u4ee5\u914d\u5408 Dashboard \u5c55\u793a\u670d\u52a1\u4fe1\u606f\\n  - server-info\\n\\nstream_plugins:\\n  - mqtt-proxy\\n  - ip-restriction\\n  - limit-conn\\n\\ncustomPlugins:\\n  enabled: true\\n  luaPath: /opts/custom_plugins/?.lua\\n  #\u3010\u6ce8\u610f\u3011\u5982\u4e0b\u914d\u7f6e\u4fdd\u969c Prometheus \u63d2\u4ef6\u53ef\u5bf9\u5916\u66b4\u9732\u6307\u6807\\n  plugins:\\n   - name: prometheus\\n     attrs:\\n       export_addr:\\n         ip: 0.0.0.0\\n          port: 9091\\n      configMap:\\n       name: prometheus\\n        mounts: []\\n\\ndns:\\n  resolvers:\\n    - 127.0.0.1\\n    - 172.20.0.10\\n    - 114.114.114.114\\n    - 223.5.5.5\\n    - 1.1.1.1\\n    - 8.8.8.8\\n  validity: 30\\n  timeout: 5\\n\\nautoscaling:\\n  enabled: false\\n  minReplicas: 1\\n  maxReplicas: 100\\n  targetCPUUtilizationPercentage: 80\\n  targetMemoryUtilizationPercentage: 80\\n\\nconfigurationSnippet:\\n  main: \'\'\\n  httpStart: \'\'\\n  httpEnd: \'\'\\n  httpSrv: \'\'\\n  httpAdmin: \'\'\\n  stream: \'\'\\n\\netcd:\\n  enabled: true\\n  host:\\n    - \'http://etcd.host:2379\'\\n  prefix: /apisix\\n  timeout: 30\\n  auth:\\n    rbac:\\n      enabled: false\\n      user: \'\'\\n      password: \'\'\\n    tls:\\n      enabled: false\\n      existingSecret: \'\'\\n      certFilename: \'\'\\n      certKeyFilename: \'\'\\n      verify: true\\n  service:\\n    port: 2379\\n  replicaCount: 3\\n\\ndashboard:\\n  enabled: true\\n  #\u3010\u6ce8\u610f\u3011\u4e3a Dashboard \u5f00\u542f NodePort \u65b9\u4fbf\u540e\u7eed\u4f7f\u7528\\n  service:\\n   type: NodePort\\n\\ningress-controller:\\n  enabled: true\\n  config:\\n    apisix:\\n     #\u3010\u6ce8\u610f\u3011\u4e00\u5b9a\u8981\u8bbe\u7f6e gateway \u6240\u5728\u7684 namespace\\n      serviceNamespace: apisix-system\\n  serviceMonitor:\\n    enabled: true\\n    namespace: \'apisix-system\'\\n    interval: 15s\\n```\\n\\n\u90e8\u7f72\u6210\u529f\u540e\uff0c\u70b9\u51fb\u5e94\u7528\u540d\u79f0\u8fdb\u5165\u8be6\u60c5\u9875\u9762\uff0c\u53ef\u4ee5\u5728\u300c\u8d44\u6e90\u72b6\u6001\u300d\u6807\u7b7e\u9875\u4e0b\u770b\u5230\u5982\u4e0b\u7684\u670d\u52a1\u90e8\u7f72\u548c\u5de5\u4f5c\u72b6\u6001\u8fd0\u884c\u72b6\u6001\u5c55\u793a\u3002\\n\\n![\u5de5\u4f5c\u72b6\u6001\u8fd0\u884c\u5c55\u793a](https://static.apiseven.com/202108/1638241694605-7d88f095-fef5-43f4-9752-8dc5a2f9abc4.png)\\n\\n:::note \u989d\u5916\u8865\u5145\\nApache APISIX \u9879\u76ee\u53e6\u6709\u7684\u4e24\u4e2a Helm Chart \u5bf9\u5e94\u7684\u9ed8\u8ba4\u914d\u7f6e\u53c2\u6570\u53ef\u4ee5\u5206\u522b\u53c2\u8003\uff1a[Dashboard](https://github.com/apache/apisix-helm-chart/blob/master/charts/apisix-dashboard/values.yaml) \u548c Ingress Controller \u7684 values.yaml\u3002\\n:::\\n\\n### Dashboard \u5999\u7528\\n\\nApache APISIX \u5e94\u7528\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u53ef\u901a\u8fc7 Apache APISIX Dashboard \u6765\u68c0\u9a8c\u4e00\u4e0b Apache APISIX \u7f51\u5173\u7684\u5f53\u524d\u72b6\u6001\u3002\\n\\n\u4ece\u5e94\u7528\u8d1f\u8f7d-\u670d\u52a1\u9875\u9762\u53ef\u4ee5\u627e\u5230 `apisix-dashboard` \u670d\u52a1\uff0c\u7531\u4e8e\u6211\u4eec\u5728\u5e94\u7528\u914d\u7f6e\u4e2d\u5df2\u4e3a Dashboard \u5f00\u542f\u4e86 NodePort\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 NodePort \u7aef\u53e3\u6765\u8bbf\u95ee Dashboard\u3002\\n\\n![Dashboard \u9875\u9762\u8bbe\u7f6e](https://static.apiseven.com/202108/1638241699353-8d54dfe9-8439-4085-8e7d-02583a1d0d9e.png)\\n\\n\u4f7f\u7528\u9ed8\u8ba4\u7528\u6237\u540d\u53ca\u5bc6\u7801 `admin` \u767b\u5f55 Apache APISIX Dashboard\uff0c\u53ef\u4ee5\u8fdb\u5165\u300c\u7cfb\u7edf\u4fe1\u606f\u300d\u9875\u9762\u67e5\u770b\u5230\u5f53\u524d\u8fde\u63a5\u7ba1\u7406\u7684\u300cApache APISIX \u8282\u70b9\u300d\u4fe1\u606f\u3002\\n\\n![\u767b\u9646 Dashboard](https://static.apiseven.com/202108/1638241703083-0915a427-9aab-41e6-8c76-be60d70fc135.png)\\n\\n### \u5982\u4f55\u4f7f\u7528\\n\\n\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u56de\u5230\u300c\u5e94\u7528\u8def\u7531\u300d\u9875\u9762\uff0c\u518d\u65b0\u5efa\u4e00\u4e2a\u8def\u7531\uff08\u5982 `apisix-httpbin`\uff09\uff0c\u8bbe\u7f6e\u8def\u5f84\u4e3a `/*` `httpbin` `80` \u5e76\u4e3a\u5176\u6dfb\u52a0 `kubernetes.io/ingress.class`: `apisix` \u7684\u952e\u503c\u3002\\n\\n![\u65b0\u5efa\u8def\u7531](https://static.apiseven.com/202108/1638241705123-6fe3ba11-bc08-4fb2-a8b1-73066ce73679.png)\\n\\n![\u8be6\u7ec6\u6570\u636e\u8bbe\u7f6e](https://static.apiseven.com/202108/1638241706790-3989c06d-c803-4c16-869a-6fa000b5744b.png)\\n\\n#### \u9a8c\u8bc1\u5e94\u7528\u8def\u7531\u751f\u6548\\n\\n\u56de\u5230 Apache APISIX Dashboard \u8fdb\u5165\u300c\u8def\u7531\u300d\u9875\u9762\uff0c\u53ef\u4ee5\u770b\u5230\u65b0\u5efa\u7684\u5e94\u7528\u8def\u7531\u5df2\u88ab Apache APISIX Ingress Controller \u8bc6\u522b\u540e\u81ea\u52a8\u6dfb\u52a0\u5230\u4e86 Apache APISIX \u7f51\u5173\u4e2d\uff0c\u5728\u300c\u4e0a\u6e38\u300d\u9875\u9762\u4e5f\u53ef\u4ee5\u770b\u5230\u81ea\u52a8\u521b\u5efa\u7684\u4e00\u4e2a\u4e0a\u6e38\u6761\u76ee\u3002\\n\\n![\u9a8c\u8bc1\u751f\u6548](https://static.apiseven.com/202108/1638241712811-db1f93dd-2963-4034-b461-26733d173bae.png)\\n\\n\u63a5\u4e0b\u6765\u56de\u5230 `apisix-system` \u9879\u76ee\u300c\u670d\u52a1\u300d\u9875\u9762\uff0c\u627e\u5230 `apisix-gateway` \u670d\u52a1\u5bf9\u5e94\u7684\u7aef\u53e3\uff0c\u7531\u6b64\u8bbf\u95ee `<apisix-httpbin \u5e94\u7528\u8def\u7531\u6307\u5b9a\u7684\u57df\u540d>:<apisix-gateway \u5916\u90e8\u8bbf\u95ee\u7aef\u53e3>`\uff08\u4f8b\u5982\u6b64\u5904\u4e3a `httpbin.ui:30408`\uff09\u5373\u53ef\u8bbf\u95ee\u5230 `apisix-httpbin` \u5e94\u7528\u8def\u7531\u6240\u5173\u8054\u7684\u540e\u53f0\u670d\u52a1\u3002\\n\\n![\u751f\u6548\u6210\u529f](https://static.apiseven.com/202108/1638241716159-134e6bd8-9e08-46de-8d46-39142c439b8f.png)\\n\\n## \u81ea\u5b9a\u4e49\u76d1\u63a7 Apache APISIX \u7f51\u5173\\n\\n\u4f7f\u7528 Apache APISIX \u7f51\u5173\u65f6\u53ef\u901a\u8fc7 Prometheus \u63d2\u4ef6\u4ee5\u53ca KubeSphere \u81ea\u5e26\u7684\u81ea\u5b9a\u4e49\u76d1\u63a7\u80fd\u529b\u6765\u8fdb\u884c\u76d1\u63a7\u80fd\u529b\u7684\u52a0\u6301\u3002\\n\\n### \u66b4\u9732\u76f8\u5173 Prometheus \u76d1\u63a7\u6307\u6807\\n\\n\u7531\u4e8e\u6211\u4eec\u5728\u524d\u8fb9\u90e8\u7f72 Apache APISIX \u5e94\u7528\u65f6\u5df2\u7ecf\u5f00\u542f\u4e86 [Prometheus \u63d2\u4ef6](https://apisix.apache.org/docs/apisix/plugins/prometheus)\uff0c\u6240\u4ee5\u63a5\u4e0b\u6765\u53ea\u9700\u8981\u628a Prometheus \u76d1\u63a7\u6307\u6807\u7684\u63a5\u53e3\u66b4\u9732\u51fa\u6765\u5373\u53ef\u3002\\n\\n\u8fdb\u5165 `apisix-system` \u9879\u76ee\uff0c\u5728\u300c\u5de5\u4f5c\u8d1f\u8f7d\u300d\u9875\u9762\u627e\u5230 apisix \u5e76\u8fdb\u5165\u90e8\u7f72\u8be6\u60c5\u9875\u9762\uff0c\u968f\u540e\u5728\u5de6\u4fa7\u64cd\u4f5c\u9762\u677f\u7684\u300c\u66f4\u591a\u64cd\u4f5c\u300d\u4e2d\u9009\u62e9\u300c\u7f16\u8f91\u8bbe\u7f6e\u300d\u3002\\n\\n![\u90e8\u7f72\u5de5\u4f5c\u8d1f\u8f7d](https://static.apiseven.com/202108/1638241718162-86d110b6-2c40-461c-9cf4-a13b73cf5768.png)\\n\\n\u5728\u5f39\u51fa\u7684\u9762\u677f\u4e2d\uff0c\u8fdb\u5165\u5230 `apisix` \u5bb9\u5668\u7f16\u8f91\u754c\u9762\uff0c\u627e\u5230\u300c\u7aef\u53e3\u8bbe\u7f6e\u300d\uff0c\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u540d\u4e3a `prom` \u7684\u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u7684 `9091` \u7aef\u53e3\uff0c\u4fdd\u5b58\u540e `apisix` \u5de5\u4f5c\u8d1f\u8f7d\u4f1a\u91cd\u542f\u3002\\n\\n![\u65b0\u5efa\u6620\u5c04\u7aef\u53e3](https://static.apiseven.com/202108/1638241721050-c3e9409c-4ec8-4ff1-bcf8-045ea57ec179.png)\\n\\n### \u4e3a\u76d1\u63a7\u6307\u6807\u521b\u5efa ServiceMonitor\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u5c06\u5df2\u66b4\u9732\u7684\u6307\u6807\u63a5\u53e3\u63a5\u5165\u5230 KubeSphere \u81ea\u5e26\u7684 Prometheus \u4e2d\u4f7f\u4e4b\u53ef\u88ab\u8bbf\u95ee\uff08\u88ab\u6293\u53d6\u6307\u6807\u6570\u636e\uff09\u3002\\n\\n\u7531\u4e8e KubeSphere \u662f\u901a\u8fc7 [Prometheus Operator](https://github.com/prometheus-operator/prometheus-operator) \u6765\u7ef4\u62a4\u5185\u90e8 Prometheus \u7cfb\u7edf\uff0c\u6240\u4ee5\u6700\u5feb\u6377\u7684\u65b9\u5f0f\u81ea\u7136\u662f\u76f4\u63a5\u521b\u5efa ServiceMonitor \u8d44\u6e90\u6765\u5b9e\u73b0\u6307\u6807\u63a5\u53e3\u7684\u63a5\u5165\u3002\\n\\n```yaml\\napiVersion: monitoring.coreos.com/v1\\nkind: ServiceMonitor\\nmetadata:\\n  name: apisix\\n  namespace: apisix-system\\nspec:\\n  endpoints:\\n    - scheme: http\\n     #\u3010\u6ce8\u610f\u3011\u4f7f\u7528\u4e0a\u4e00\u6b65\u4e2d\u5de5\u4f5c\u8d1f\u8f7d\u66b4\u9732\u7684\u5bb9\u5668\u7aef\u53e3\u540d\u79f0\\n     targetPort: prom\\n     #\u3010\u6ce8\u610f\u3011\u9700\u8981\u6b63\u786e\u7ed1\u5b9a apisix \u5bf9\u5e94\u7684\u6307\u6807\u63a5\u53e3\u8def\u5f84\\n     path: /apisix/prometheus/metrics\\n      interval: 15s\\n  namespaceSelector:\\n    matchNames:\\n      - apisix-system\\n  selector:\\n    matchLabels:\\n      app.kubernetes.io/name: apisix\\n      app.kubernetes.io/version: 2.10.0\\n      helm.sh/chart: apisix-0.7.2\\n```\\n\\n\u4f7f\u7528 `kubectl apply -f your_service_monitor.yaml` \u521b\u5efa ServiceMonitor \u8d44\u6e90\u3002\u521b\u5efa\u6210\u529f\u540e\uff0c\u5982\u679c\u6709\u96c6\u7fa4\u7ba1\u7406\u6743\u9650\uff0c\u4e5f\u53ef\u4ee5\u5728\u96c6\u7fa4\u7684 CRD \u7ba1\u7406\u9875\u9762\u4e2d\u641c\u7d22\u67e5\u770b ServiceMonitor \u8d44\u6e90\u5e76\u627e\u5230\u540d\u4e3a `apisix` \u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u4e5f\u53ef\u4ee5\u5728\u8fd9\u91cc\u505a\u540e\u7eed\u7684 YAML \u4fee\u6539\u3002\\n\\n![\u521b\u5efa ServiceMonitor \u8d44\u6e90](https://static.apiseven.com/202108/1638241723331-64cb363e-b6af-4af4-93f3-29a79c9a5e77.png)\\n\\n### \u6307\u6807\u63a5\u5165\u81ea\u5b9a\u4e49\u76d1\u63a7\u9762\u677f\\n\\n\u5728\u9879\u76ee\u5de6\u4fa7\u83dc\u5355\u5217\u8868\u4e2d\u627e\u5230\u300c\u76d1\u63a7\u544a\u8b66\u300d\u4e2d\u7684\u300c\u81ea\u5b9a\u4e49\u76d1\u63a7\u300d\uff0c\u5f00\u59cb\u300c\u521b\u5efa\u300d\u81ea\u5b9a\u4e49\u76d1\u63a7\u9762\u677f\u3002\\n\\n![\u521b\u5efa\u81ea\u5b9a\u4e49\u76d1\u63a7\u9762\u677f](https://static.apiseven.com/202108/1638241724906-d9531809-4682-49b3-b90b-d7f3a03e70e3.png)\\n\\n\u5728\u5f39\u51fa\u7a97\u53e3\u4e2d\u586b\u5165\u300c\u540d\u79f0\u300d\uff0c\u9009\u62e9\u300c\u81ea\u5b9a\u4e49\u300d\u76d1\u63a7\u6a21\u7248\uff0c\u5e76\u8fdb\u5165\u300c\u4e0b\u4e00\u6b65\u300d\u7684\u76d1\u63a7\u9762\u677f\u521b\u5efa\u3002\\n\\n![\u8bbe\u7f6e\u7ec6\u8282](https://static.apiseven.com/202108/1638241727938-cd3843f9-0e22-4316-91d2-84b56cd66f21.png)\\n\\n\u8fdb\u5165\u7f16\u8f91\u9875\u9762\u540e\u73b0\u5728\u5de6\u4fa7\u70b9\u51fb `+` \u533a\u57df\uff0c\u5728\u53f3\u4fa7\u7684\u300c\u6570\u636e\u300d\u533a\u57df\u8fdb\u884c Prometheus \u76d1\u63a7\u6307\u6807\u7684\u914d\u7f6e\u3002\u4f8b\u5982\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u7528 `sum(apisix_nginx_http_current_connections)` \u6765\u7edf\u8ba1 Apache APISIX \u7f51\u5173\u5b9e\u65f6\u7684\u8fde\u63a5\u603b\u6570\u3002\\n\\n![\u52a0\u5165\u76d1\u63a7\u6307\u6807\u914d\u7f6e](https://static.apiseven.com/202108/1638241729416-3d2024f1-9586-44ac-ad6c-7472c8924fc8.png)\\n\\n\u4fdd\u5b58\u540e\u5728\u9875\u9762\u53f3\u4e0b\u89d2\u627e\u5230\u300c+ \u6dfb\u52a0\u76d1\u63a7\u9879\u300d\uff0c\u5e76\u9009\u62e9\u300c\u6298\u7ebf\u56fe\u300d\u521b\u5efa `Nginx connection state` \u6307\u6807\uff1a\u4f7f\u7528 `sum(apisix_nginx_http_current_connections) by (state)` \u4f5c\u4e3a\u6307\u6807\u3001`{{state}}` \u7528\u4f5c\u56fe\u4f8b\u540d\u79f0\u3001\u300c\u56fe\u4f8b\u7c7b\u578b\u300d\u4e3a\u5806\u53e0\u56fe\uff0c\u5373\u53ef\u5f97\u5230\u7c7b\u4f3c\u4e0b\u56fe\u7684\u7ed3\u679c\u3002\u4fdd\u5b58\u6a21\u7248\u540e\u5373\u53ef\u5f97\u5230\u7b2c\u4e00\u4e2a\u81ea\u5b9a\u4e49\u76d1\u63a7\u9762\u677f\uff01\\n\\n![\u81ea\u5b9a\u4e49\u76d1\u63a7\u9762\u677f\u751f\u6210](https://static.apiseven.com/202108/1638241730747-298fe17e-fb34-4da6-ac9d-8b1efde4521c.png)\\n\\n>Apache APISIX \u7f51\u5173\u76ee\u524d\u63d0\u4f9b\u7684 Prometheus \u6307\u6807\u53ef\u4ee5\u53c2\u89c1\u5b98\u65b9\u6587\u6863\u7684[\u53ef\u6709\u7684\u6307\u6807](https://apisix.apache.org/zh/docs/apisix/plugins/prometheus/#%25E5%258F%25AF%25E6%259C%2589%25E7%259A%2584%25E6%258C%2587%25E6%25A0%2587)\u90e8\u5206\u3002\\n\\n\u7531\u4e8e\u6307\u6807\u914d\u7f6e\u8fc7\u7a0b\u6bd4\u8f83\u9ebb\u70e6\uff0c\u63a8\u8350\u5728\u96c6\u7fa4\u5c42\u9762\u7684\u300c\u81ea\u5b9a\u4e49\u76d1\u63a7\u300d\u4e2d\u76f4\u63a5\u5bfc\u5165 [Apache APISIX Grafana \u6a21\u7248](https://grafana.com/grafana/dashboards/11719)\uff08\u4e0b\u8f7d JSON \u5e76\u901a\u8fc7\u300c\u672c\u5730\u4e0a\u4f20\u300d\u8fdb\u884c\u5bfc\u5165\uff09\u3002\\n\\n![\u5bfc\u5165 Grafana \u6a21\u7248](https://static.apiseven.com/202108/1638241733535-168ce86b-6654-4278-941d-23fb44003c90.png)\\n\\n\u521b\u5efa\u5b8c\u6210\u540e\u53ef\u76f4\u63a5\u5448\u73b0\u51fa\u975e\u5e38\u4e30\u5bcc\u7684 Apache APISIX \u7f51\u5173\u76d1\u63a7\u9762\u677f\u3002KubeSphere \u4e5f\u540c\u65f6\u5728[\u79ef\u6781\u63a8\u8fdb](https://github.com/kubesphere/kubesphere/issues/4433)\u5c06 Grafana \u6a21\u7248\u5bfc\u5165\u7684\u529f\u80fd\u5f15\u5165\u5230\u9879\u76ee\u7684\u81ea\u5b9a\u4e49\u76d1\u63a7\u80fd\u529b\u4e2d\u53bb\uff0c\u656c\u8bf7\u671f\u5f85\uff01\\n\\n![\u5b8c\u7f8e\u7ed3\u675f](https://static.apiseven.com/202108/1638241735167-4c6d3a9a-8190-41b5-9e89-7f09384c7113.png)\\n\\n## \u603b\u7ed3\\n\\n\u901a\u8fc7\u672c\u6587\u975e\u5e38\u8be6\u7ec6\u7684\u6b65\u9aa4\u4ecb\u7ecd\uff0c\u5927\u5bb6\u53ef\u5145\u5206\u4e86\u89e3\u5e76\u8ddf\u968f\u4e0a\u624b\u4f53\u9a8c\u5230\u5982\u4f55\u300c\u5c06 Apache APISIX Ingress \u7f51\u5173\u4ecb\u5165 KubeSphere \u5e76\u8fdb\u884c\u81ea\u5b9a\u4e49\u76d1\u63a7\u300d\u3002\u5e0c\u671b\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u53ef\u4ee5\u52a0\u6df1\u5404\u4f4d\u5bf9 Apache APISIX Ingress Controller \u4e0e Apache APISIX \u5e94\u7528\u7406\u89e3\u3002\\n\\n\u4f5c\u8005\u5f20\u6d77\u7acb\uff0c\u9a6d\u52bf\u79d1\u6280\u4e91\u5e73\u53f0\u7814\u53d1\u603b\u76d1\u3002\u5f00\u6e90\u7231\u597d\u8005\uff0c\u4e91\u539f\u751f\u793e\u533a\u4e0a\u6d77\u7ad9 PMC \u6210\u5458\uff0cKubeSphere Ambassador\u3002"},{"id":"\u6210\u4e3a Apache APISIX Committer \u8ba9\u6211\u4f53\u4f1a\u5230\u4e86\u77e5\u8bc6\u8f6c\u6362\u4ef7\u503c\u7684\u610f\u4e49","metadata":{"permalink":"/zh/blog/2021/11/26/apache-apisix-committer-experience","source":"@site/blog/2021/11/26/apache-apisix-committer-experience.md","title":"\u6210\u4e3a Apache APISIX Committer \u8ba9\u6211\u4f53\u4f1a\u5230\u4e86\u77e5\u8bc6\u8f6c\u6362\u4ef7\u503c\u7684\u610f\u4e49","description":"\u672c\u6587\u4ece Shivam Singh \u4e2a\u4eba\u89d2\u5ea6\uff0c\u4ecb\u7ecd\u4e86\u4ed6\u662f\u5982\u4f55\u5728 Apache APISIX \u793e\u533a\u4e2d\u4ece\u8d21\u732e\u8005\u6210\u957f\u4e3a Apache Committer\u3002\u5e0c\u671b\u4ed6\u7684\u4e2a\u4eba\u7ecf\u5386\u53ef\u4ee5\u5e2e\u52a9\u4f60\u53c2\u4e0e\u5f00\u6e90\u793e\u533a\u8fdb\u884c\u9879\u76ee\u8d21\u732e\u3002","date":"2021-11-26T00:00:00.000Z","formattedDate":"2021\u5e7411\u670826\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":6.01,"truncated":true,"authors":[{"name":"Shivam Singh","url":"https://github.com/1502shivam-singh","imageURL":"https://avatars.githubusercontent.com/u/57267960?v=4"}],"prevItem":{"title":"\u5728 KubeSphere \u4e2d\u4f7f\u7528 APISIX Ingress \u63a5\u5165\u81ea\u5b9a\u4e49\u76d1\u63a7","permalink":"/zh/blog/2021/11/30/use-apisix-ingress-in-kubesphere"},"nextItem":{"title":"APISIX request_uri \u53d8\u91cf\u63a7\u5236\u4e0d\u5f53\uff0c\u5b58\u5728\u8def\u5f84\u7a7f\u900f\u98ce\u9669","permalink":"/zh/blog/2021/11/23/cve-2021-43557-research-report"}},"content":"> \u672c\u6587\u5c06\u4ece Shivam Singh\uff08[@1502shivam-singh](https://github.com/1502shivam-singh)\uff09\u4e2a\u4eba\u89d2\u5ea6\uff0c\u7b80\u8981\u63cf\u8ff0\u4e86\u4ed6\u662f\u5982\u4f55\u5728 Apache APISIX \u793e\u533a\u4e2d\u4ece\u8d21\u732e\u8005\u6210\u957f\u4e3a Apache Committer\u3002\u5e0c\u671b\u4ed6\u7684\u4e2a\u4eba\u53c2\u4e0e\u5386\u7a0b\u53ef\u4ee5\u5e2e\u52a9\u5230\u90a3\u4e9b\u5e0c\u671b\u5728 Apache APISIX \u793e\u533a\u6216\u5176\u4ed6\u5f00\u6e90\u793e\u533a\u8fdb\u884c\u9879\u76ee\u8d21\u732e\u7684\u670b\u53cb\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u6211\u662f [Shivam Singh](https://twitter.com/Shivam15_)\uff0cIndian Institute of Information Technology \u672c\u79d1\u751f\uff0c\u76ee\u524d\u4e5f\u662f\u4e00\u540d\u5168\u6808\u5de5\u7a0b\u5e08\u548c\u4ea7\u54c1\u8bbe\u8ba1\u5e08\u3002\u6211\u8ba4\u4e3a\u6bcf\u4e00\u4e2a\u4f1f\u5927\u7684\u4ea7\u54c1\u90fd\u662f\u5de5\u7a0b\u548c\u8bbe\u8ba1\u7684\u7ed3\u6676\uff0c\u4ea7\u54c1\u7684\u5448\u73b0\u4e0d\u4ec5\u9700\u8981\u878d\u5408\u6280\u672f\uff0c\u540c\u65f6\u4e5f\u8981\u5e26\u6765\u89c6\u89c9\u4e0a\u7684\u6109\u60a6\uff0c\u6700\u7ec8\u5728\u7ed3\u679c\u5bfc\u5411\u4e0b\u89e3\u51b3\u7ec8\u7aef\u7528\u6237\u7684\u5404\u79cd\u5173\u952e\u95ee\u9898\u3002\\n\\n\u6211\u4e2a\u4eba\u975e\u5e38\u559c\u6b22\u300c\u521b\u4f5c\u4e4b\u8def\u300d\u7684\u5386\u7a0b\u3002\u6bd4\u5982\u72ec\u7acb\u5f00\u53d1\u4e00\u4e2a\u4ea7\u54c1\u6216\u5e94\u7528\uff0c\u4ece\u6700\u521d\u7684\u6982\u5ff5\u5316\u5f00\u59cb\uff0c\u5230\u4ea7\u54c1\u6700\u7ec8\u5b8c\u6210\u548c\u4ea4\u4ed8\uff0c\u6211\u53ef\u4ee5\u975e\u5e38\u4eab\u53d7\u5730\u5b8c\u6210\u8fd9\u4e2d\u95f4\u6db5\u76d6\u7684\u6240\u6709\u5de5\u7a0b\u4e0e\u8bbe\u8ba1\u7ec6\u8282\u3002\\n\\n\u4e5f\u6b63\u662f\u5bf9\u4e8e\u7ec6\u8282\u4e0e\u521b\u4f5c\u7684\u5173\u6ce8\uff0c\u624d\u6709\u4e86\u73b0\u5728\u4e0e\u5f00\u6e90\u793e\u533a\u548c Apache APISIX \u7684\u78b0\u649e\u3002\\n\\n## \u4e0e Apache APISIX \u7684\u7f8e\u597d\u56de\u5fc6\\n\\n\u81ea\u4ece\u5f00\u59cb\u53c2\u4e0e Apache APISIX \u9879\u76ee\uff0c\u6211\u5728\u793e\u533a\u91cc\u7ed3\u8bc6\u4e86\u5f88\u591a\u53cb\u597d\u4e14\u4e50\u4e8e\u6c9f\u901a\u534f\u4f5c\u7684\u4f19\u4f34\u4eec\uff0c\u6216\u8bb8\u5927\u5bb6\u90fd\u6765\u81ea\u4e0d\u540c\u7684\u56fd\u5bb6\uff0c\u4f46\u8fd9\u79cd\u300c\u6280\u672f\u793e\u533a\u534f\u4f5c\u300d\u5374\u7ed9\u6211\u7559\u4e0b\u4e86\u4e00\u6bb5\u975e\u5e38\u7f8e\u597d\u7684\u5f00\u6e90\u65c5\u7a0b\u56de\u5fc6\u3002\\n\\n\u6211\u89c9\u5f97\u53c2\u4e0e Apache APISIX \u793e\u533a\u5bf9\u4e8e\u60f3\u8981\u63a5\u89e6\u5f00\u6e90\u9879\u76ee\u548c\u5f00\u6e90\u6587\u5316\u7684\u670b\u53cb\u800c\u8a00\uff0c\u90fd\u662f\u4e00\u4e2a\u4e0d\u53ef\u591a\u5f97\u7684\u4f53\u9a8c\u8d77\u70b9\u3002\\n\\n### \u76f8\u8bc6\\n\\n\u8fd9\u4e00\u5207\u7684\u5f00\u59cb\u8981\u4ece 2021 \u5e74 2 \u6708\u8bf4\u8d77\u3002\u90a3\u65f6\u7684\u6211\u4e3a\u4e86\u5c06\u81ea\u5df1\u6240\u5b66\u77e5\u8bc6\u771f\u6b63\u5730\u53d1\u6325\u51fa\u6765\uff0c\u60f3\u8981\u7ed9\u4eba\u4eec\u63d0\u4f9b\u4e00\u4e9b\u771f\u6b63\u6709\u4ef7\u503c\u7684\u4e1c\u897f\uff0c\u6240\u4ee5\u5f00\u59cb\u5728 GitHub \u4e0a\u5bfb\u627e\u53ef\u4ee5\u53c2\u4e0e\u8d21\u732e\u7684\u5f00\u6e90\u8f6f\u4ef6\u9879\u76ee\u3002\\n\\n\u5927\u5bb6\u5982\u679c\u8ddf\u6211\u4e00\u6837\u4e5f\u60f3\u641c\u5bfb\u4e00\u4e9b\u9002\u5408\u81ea\u5df1\u7684\u53ef\u8d21\u732e\u5f00\u6e90\u9879\u76ee\uff0c\u53ef\u4ee5\u67e5\u770b\u4e00\u4e0b [Google Summer of Code](https://summerofcode.withgoogle.com/archive/) \u7ec4\u7ec7\u9875\u9762\u6216\u8005\u641c\u7d22\u4e00\u4e9b\u5e26\u6709\u300cgood first issue\u300d\u7684\u7b80\u6613\u9879\u76ee issue \u8fdb\u884c\u76f8\u5173\u7684\u8d21\u732e\u3002\\n\\n\u5728\u56db\u5904\u5bfb\u627e\u548c\u6d4b\u8bd5\u4e86\u51e0\u4e2a\u9879\u76ee\u540e\uff0c\u6211\u9047\u5230\u4e86 Apache APISIX\u3002\u5728\u67e5\u9605\u4e86\u9879\u76ee\u7684\u4efb\u52a1 JIRA \u9762\u677f\u540e\uff0c\u4e0e\u793e\u533a\u76f8\u5173\u4eba\u5458\u53d6\u5f97\u4e86\u8054\u7cfb\u5e76\u6536\u5230\u4e86\u52a0\u5165\u793e\u533a Slack \u7684\u9080\u8bf7\uff0c\u4e4b\u540e\u7684\u6545\u4e8b\u5c31\u987a\u7406\u6210\u7ae0\u5730\u5f00\u59cb\u4e86\u3002\\n\\n### \u76f8\u77e5\\n\\n\u8003\u8651\u5230\u4e2a\u4eba\u7684\u4e13\u4e1a\u9886\u57df\uff0c\u6211\u9009\u62e9\u4e86 [apache/apisix-website](https://github.com/apache/apisix-website) \u8fd9\u4e2a\u9879\u76ee\u4e0b\u7684 issue \u5f00\u59cb\u771f\u6b63\u6b65\u5165\u300c\u5f00\u6e90\u65c5\u7a0b\u300d\u3002\\n\\n\u5f53\u6211\u5f00\u59cb\u63a5\u624b\u5c1d\u8bd5\u53bb\u505a Apache APISIX \u5b98\u7f51\u9875\u9762\u65f6\uff0c\u6211\u6ce8\u610f\u5230\u8fd9\u4e2a\u9879\u76ee\u5728\u5f88\u591a\u65b9\u9762\u90fd\u6709\u6240\u6b20\u7f3a\uff0c\u5c24\u5176\u662f\u5f53\u65f6\u7684\u5b98\u7f51\u9875\u9762\u6240\u5c55\u793a\u7684\u529f\u80fd\u4e0e Apache APISIX \u771f\u6b63\u6240\u80fd\u63d0\u4f9b\u7684\u7ec6\u8282\u4e0a\u5b58\u5728\u5f88\u5927\u7684\u5dee\u8ddd\u3002\u4e00\u4e2a\u4ea7\u54c1\u6709\u591a\u597d\uff0c\u4e0d\u80fd\u53ea\u662f\u4ea7\u54c1\u672c\u8eab\u505a\u5f97\u597d\u5c31\u591f\u4e86\uff0c\u4e5f\u9700\u8981\u901a\u8fc7\u4e00\u4e9b\u9014\u5f84\u5411\u5916\u754c\u5c55\u793a\u51fa\u6765\u300c\u5230\u5e95\u6709\u591a\u597d\u300d\u3002\\n\\n\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\u6211\u63d0\u51fa\u4e86\u76f8\u5173\u610f\u89c1\uff0c\u4e0e\u793e\u533a\u4f19\u4f34\u4eec\u63a2\u8ba8\u540e\uff0c\u521a\u597d\u501f\u7531 Google Summer of Code \u5f00\u59cb\u4e86\u9488\u5bf9 Apache APISIX \u5b98\u7f51\u9875\u9762\u7684\u6539\u9020\u3002\u8be5\u9879\u76ee\u4ece\u4eca\u5e74 5 \u6708\u5f00\u59cb\uff0c2021 \u5e74 9 \u6708\u65b0\u7248\u5b98\u7f51\u6210\u529f\u4e0a\u7ebf\u3002\u611f\u8c22\u53c2\u4e0e\u8fd9\u4e2a\u9879\u76ee\u4e2d\u6765\u81ea Apache APISIX \u793e\u533a\u591a\u4f4d Committer \u6210\u5458\uff08[\u6e29\u94ed](https://github.com/moonming)\u3001[\u741a\u81f4\u8fdc](https://github.com/juzhiyuan)\u548c[\u5434\u8212\u65f8](https://github.com/Yiyiyimu)\uff09\u7684\u5e2e\u52a9\u3002\\n\\n### \u611f\u6069\u6709\u4f60\\n\\n\u80fd\u591f\u901a\u8fc7\u63d0\u9ad8\u793e\u533a\u5f71\u54cd\u529b\u548c\u6539\u5584\u54c1\u724c\u5f62\u8c61\u7684\u76ee\u7684\u6765\u53c2\u4e0e\u793e\u533a\uff0c\u5bf9\u6211\u6765\u8bf4\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u7ecf\u5386\u3002\u8fd9\u4e5f\u4f7f\u6211\u5728 Apache APISIX \u7684\u6210\u957f\u8fdb\u5165\u5230\u4e00\u4e2a\u65b0\u9636\u6bb5\u3002\\n\\n![\u65b0\u65e7\u7f51\u9875\u5bf9\u6bd4](https://static.apiseven.com/202108/1638858994191-6d4fa022-b286-4695-932b-738f80674f85.png)\\n\\n\u6211\u5728\u7528\u6237\u4f53\u9a8c\uff08\u8bbe\u8ba1+\u524d\u7aef\uff09\u3001\u4ea7\u54c1\u548c\u589e\u957f\u65b9\u9762\u4e3a\u793e\u533a\u505a\u51fa\u4e86\u81ea\u5df1\u529b\u6240\u80fd\u53ca\u7684\u52aa\u529b\uff0c\u4e5f\u901a\u8fc7\u8fd9\u4e9b\u52aa\u529b\u6536\u83b7\u4e86\u6765\u81ea\u793e\u533a\u7684\u8ba4\u53ef\uff0c\u5e76\u88ab\u5927\u5bb6\u6295\u7968\u8bc4\u9009\u4e3a Apache APISIX Committer\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5bf9\u6211\u800c\u8a00\u662f\u975e\u5e38\u771f\u5b9e\u4e14\u5bcc\u6709\u6fc0\u52b1\u4f5c\u7528\u7684\uff0c\u8ba9\u6211\u6709\u4e86\u66f4\u591a\u7684\u70ed\u60c5\u548c\u4fe1\u5fc3\u5728\u672a\u6765\u53bb\u53c2\u4e0e\u66f4\u591a\u7684\u5f00\u6e90\u9879\u76ee\u8d21\u732e\u3002\\n\\n## \u8fd8\u5728\u89c2\u671b\u5f00\u6e90\u793e\u533a\uff1f\\n\\n\u6700\u540e\uff0c\u4ece\u6211\u7684\u4e2a\u4eba\u7ecf\u5386\u89d2\u5ea6\u7ed9\u5927\u5bb6\u63d0\u4f9b\u4e00\u4e9b\u53c2\u8003\u5efa\u8bae\u3002\\n\\n\u5bf9\u4e8e\u50cf\u6211\u4e00\u6837\u7684\u5927\u5b66\u751f\u6216\u521a\u5f00\u59cb\u4ece\u4e8b\u5f00\u6e90\u9879\u76ee\u7684\u670b\u53cb\u6765\u8bf4\uff0c\u5728\u53c2\u4e0e\u5f00\u6e90\u7684\u8fc7\u7a0b\u4e2d\u4e00\u5b9a\u8981\u70ed\u7231\u4f60\u6240\u505a\u7684\u4e8b\u60c5\uff0c\u591a\u4ece\u521b\u9020\u4ea7\u54c1\u7684\u89d2\u5ea6\u53bb\u601d\u8003\u3002\u56e0\u4e3a\u80fd\u591f\u521b\u9020\u51fa\u5bf9\u4ed6\u4eba\u6709\u7528\u5e76\u5e7f\u4e3a\u6d41\u4f20\u7684\u4ea7\u54c1\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4ece\u4e8b\u5f00\u6e90\u53c2\u4e0e\u8005\u6765\u8bf4\u90fd\u662f\u4e00\u4ef6\u5f88\u9a84\u50b2\u7684\u4e8b\u60c5\u3002\u6211\u76f8\u4fe1\u8fd9\u4e5f\u662f\u5f00\u6e90\u8f6f\u4ef6\u6240\u5b58\u5728\u7684\u610f\u4e49\u3002\\n\\n\u63a2\u7d22\u5e76\u627e\u5230\u4f60\u559c\u6b22\u7684\u4e1c\u897f\uff0c\u7136\u540e\u6c89\u8ff7\u4e8e\u6b64\uff0c\u662f\u4e00\u4ef6\u5f88\u5e78\u798f\u7684\u4e8b\u60c5\u3002"},{"id":"APISIX request_uri \u53d8\u91cf\u63a7\u5236\u4e0d\u5f53\uff0c\u5b58\u5728\u8def\u5f84\u7a7f\u900f\u98ce\u9669","metadata":{"permalink":"/zh/blog/2021/11/23/cve-2021-43557-research-report","source":"@site/blog/2021/11/23/cve-2021-43557-research-report.md","title":"APISIX request_uri \u53d8\u91cf\u63a7\u5236\u4e0d\u5f53\uff0c\u5b58\u5728\u8def\u5f84\u7a7f\u900f\u98ce\u9669","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4f5c\u8005\u5bf9 Apache APISIX Ingress Controller \u4e2d $request_uri \u53d8\u91cf\u4e0d\u5b89\u5168\u4f7f\u7528\u7684\u95ee\u9898\u7814\u7a76\u4ee5\u53ca\u5982\u4f55\u590d\u73b0\u8be5\u6f0f\u6d1e\u53ca\u540e\u7eed\u5904\u7406\u63aa\u65bd\u3002","date":"2021-11-23T00:00:00.000Z","formattedDate":"2021\u5e7411\u670823\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":6.7,"truncated":true,"authors":[{"name":"Marcin Niemiec","url":"https://github.com/xvnpw","imageURL":"https://avatars.githubusercontent.com/u/17719543?v=4"}],"prevItem":{"title":"\u6210\u4e3a Apache APISIX Committer \u8ba9\u6211\u4f53\u4f1a\u5230\u4e86\u77e5\u8bc6\u8f6c\u6362\u4ef7\u503c\u7684\u610f\u4e49","permalink":"/zh/blog/2021/11/26/apache-apisix-committer-experience"},"nextItem":{"title":"Apache APISIX request_uri \u53d8\u91cf\u63a7\u5236\u4e0d\u5f53\uff0c\u5b58\u5728\u8def\u5f84\u904d\u5386\u98ce\u9669\u516c\u544a(CVE-2021-43557)","permalink":"/zh/blog/2021/11/23/cve-2021-43557"}},"content":"> \u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u5c06\u4ecb\u7ecd\u6211\u5bf9 Apache APISIX Ingress Controller \u4e2d `$request_uri` \u53d8\u91cf\u4e0d\u5b89\u5168\u4f7f\u7528\u7684\u95ee\u9898\u7814\u7a76\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u672c\u6587\u63d0\u53ca\u7684 Ingress Controller \u4e2d `$request_uri` \u53d8\u91cf\u4e0d\u5b89\u5168\u4f7f\u7528\u7684\u95ee\u9898\uff0c\u76ee\u524d\u8be5\u6f0f\u6d1e\u5df2\u88ab\u786e\u8ba4\u4e3a CVE-2021-43557\u3002\u5728\u5411\u793e\u533a\u53ca\u65f6\u53cd\u9988\u540e\uff0c\u76ee\u524d\u8be5\u6f0f\u6d1e\u5df2\u7b2c\u4e00\u65f6\u95f4\u88ab\u4fee\u590d\u3002\u540c\u65f6\u5728\u6587\u7ae0\u6700\u540e\uff0c\u6211\u4e5f\u5c06\u7b80\u8981\u5730\u63d0\u5230\u6211\u4e3a\u540c\u4e00\u95ee\u9898\u6d4b\u8bd5\u7684[Skipper](https://github.com/zalando/skipper) \u9879\u76ee\u3002\\n\\n> Apache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u6d41\u91cf\u5904\u7406\u5e73\u53f0\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\uff0c\u5982\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u91d1\u4e1d\u96c0\u53d1\u5e03\u3001\u65ad\u8def\u5668\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u3002\\n\\n\u4e3a\u4ec0\u4e48\u662f `$request_uri`\uff1f\\n\\n[`$request_uri`](https://nginx.org/en/docs/http/ngx_http_core_module.html#var_request_uri)\u5728\u8ba4\u8bc1\u548c\u6388\u6743\u63d2\u4ef6\u4e2d\u88ab\u591a\u6b21\u4f7f\u7528\u3002\u56e0\u4e3a\u5b83\u662f**not normalized**\uff0c\u6240\u4ee5\u5c31\u589e\u52a0\u4e86\u7ed5\u8fc7\u4e00\u4e9b\u9650\u5236\u7684\u53ef\u80fd\u6027\u3002\\n\\nApache APISIX \u5185\u7f6e\u591a\u79cd\u8eab\u4efd\u8ba4\u8bc1\u63d2\u4ef6\uff0c\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7f16\u5199\u81ea\u5b9a\u4e49\u63d2\u4ef6\u3002\u4e3a\u4e86\u9a8c\u8bc1\u5b83\u53d7\u5230\u4e86\u8def\u5f84\u904d\u5386\u95ee\u9898\u7684\u5f71\u54cd\uff0c\u6211\u9009\u62e9\u4e86 `uri-blocker` \u63d2\u4ef6\u8fdb\u884c\u6f14\u793a\u3002\\n\\n## \u5f00\u59cb\u90e8\u7f72\\n\\n\u5728\u8fd9\u91cc\uff0c\u6211\u4f7f\u7528\u4e86 0.7.2 \u7248\u672c\u7684 Helm Chart \u6765\u5c06 Apache APISIX \u90e8\u7f72\u81f3 Kubernetes \u4e2d\uff1a\\n\\n```shell\\nhelm repo add bitnami https://charts.bitnami.com/bitnami\\nhelm repo update\\nkubectl create ns ingress-apisix\\nhelm install apisix apisix/apisix \\\\\\n  --set gateway.type=NodePort \\\\\\n  --set ingress-controller.enabled=true \\\\\\n  --namespace ingress-apisix \\\\\\n  --version 0.7.2\\nkubectl get service --namespace ingress-apisix\\n```\\n\\n> \u5982\u679c\u5b89\u88c5\u65f6\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u53c2\u8003[\u5b98\u65b9\u6307\u5357](https://github.com/apache/apisix-ingress-controller/blob/master/docs/en/latest/deployments/minikube.md)\u3002\\n\\n\u63a5\u7740\uff0c\u6211\u90e8\u7f72\u4e86\u4e00\u6761 `ApisixRoute` \u8d44\u6e90\u4ee5\u4fbf\u521b\u5efa Ingress \u8def\u7531\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v2beta1\\nkind: ApisixRoute\\nmetadata:\\n  name: public-service-route\\nspec:\\n  http:\\n  - name: public-service-rule\\n    match:\\n      hosts:\\n      - app.test\\n      paths:\\n      - /public-service/*\\n    backends:\\n        - serviceName: public-service\\n          servicePort: 8080\\n    plugins:\\n      - name: proxy-rewrite\\n        enable: true\\n        config:\\n          regex_uri: [\\"/public-service/(.*)\\", \\"/$1\\"]\\n  - name: protected-service-rule\\n    match:\\n      hosts:\\n      - app.test\\n      paths:\\n      - /protected-service/*\\n    backends:\\n        - serviceName: protected-service\\n          servicePort: 8080\\n    plugins:\\n      - name: uri-blocker\\n        enable: true\\n        config:\\n          block_rules: [\\"^/protected-service(/?).*\\"]\\n          case_insensitive: true\\n      - name: proxy-rewrite\\n        enable: true\\n        config:\\n          regex_uri: [\\"/protected-service/(.*)\\", \\"/$1\\"]\\n```\\n\\n`ApisixRoute` \u53ef\u4ee5\u505a\u5230\u4ee5\u4e0b\u5185\u5bb9\uff1a\\n\\n- \u4e3a `public-service` \u548c `private-service` \u521b\u5efa\u8def\u7531\uff1b\\n- \u5f00\u542f `proxy-rewrite` \u6765\u5220\u9664\u524d\u7f00\uff1b\\n- \u4e3a `protected-service` \u914d\u7f6e\u4e86 `uri-blocker` \u63d2\u4ef6\u3002\u8fd9\u4e2a\u63d2\u4ef6\u4f1a\u963b\u6b62\u4efb\u4f55\u4ee5 `/protected-service` \u5f00\u5934\u7684\u8bf7\u6c42\u3002\\n\\n## \u590d\u73b0\u6b65\u9aa4\\n\\n\u5728\u8fd9\u91cc\uff0c\u6211\u4f7f\u7528\u7684\u662f **2.10.0** \u7248\u672c\u7684 Apache APISIX\u3002\\n\\n\u9009\u62e9\u4f7f\u7528 minikube \u6765\u8bbf\u95ee Apache APISIX \u8def\u7531\u8d44\u6e90\uff1a\\n\\n```shell\\nkubectl exec -it -n ${Apache APISIX namespace} ${Apache APISIX Pod name} -- curl --path-as-is http://127.0.0.1:9080/public-service/public -H \'Host: app.test\'\\n```\\n\\n\u6b64\u5916\uff0c\u6211\u4e5f\u5199\u4e86\u4e00\u4e2a\u811a\u672c\u6765\u51cf\u5c11\u91cd\u590d\u6027\u64cd\u4f5c\uff1a\\n\\n```shell\\n#/bin/bash\\n\\nkubectl exec -it -n ingress-apisix apisix-dc9d99d76-vl5lh -- curl --path-as-is http://127.0.0.1:9080$1 -H \'Host: app.test\'\\n```\\n\\n> \u5728\u5c1d\u8bd5\u590d\u73b0\u95ee\u9898\u65f6\uff0c\u53ef\u5c06 `apisix-dc9d99d76-vl5lh`\u66ff\u6362\u4e3a\u5b9e\u9645\u7684 Apache APISIX Pod \u540d\u79f0\u3002\\n\\n\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u5f00\u59cb\u9a8c\u8bc1\u8def\u7531\u548c\u63d2\u4ef6\u662f\u5426\u6309\u9884\u671f\u6b63\u5e38\u5de5\u4f5c\uff1a\\n\\n```shell\\n$ ./apisix_request.sh \\"/public-service/public\\"\\nDefaulted container \\"apisix\\" out of: apisix, wait-etcd (init)\\n{\\"data\\":\\"public data\\"}\\n```\\n\\n```shell\\n$ ./apisix_request.sh \\"/protected-service/protected\\"\\nDefaulted container \\"apisix\\" out of: apisix, wait-etcd (init)\\n<html>\\n<head><title>403 Forbidden</title></head>\\n<body>\\n<center><h1>403 Forbidden</h1></center>\\n<hr><center>openresty</center>\\n</body>\\n</html>\\n```\\n\\n\u4ece\u4e0a\u8fb9\u6211\u4eec\u770b\u5230\uff0c`public-service` \u662f\u53ef\u7528\u7684\uff0c`protected-service` \u5219\u88ab\u63d2\u4ef6\u963b\u6b62\u4e86\u3002\\n\\n\u73b0\u5728\u8ba9\u6211\u4eec\u6d4b\u8bd5\u4e00\u4e0b Payload\uff1a\\n\\n- \u60c5\u51b5\u4e00\\n\\n```shell\\n$ ./apisix_request.sh \\"/public-service/../protected-service/protected\\"\\nDefaulted container \\"apisix\\" out of: apisix, wait-etcd (init)\\n{\\"data\\":\\"protected data\\"}\\n```\\n\\n- \u60c5\u51b5\u4e8c\\n\\n```shell\\n$ ./apisix_request.sh \\"/public-service/..%2Fprotected-service/protected\\"\\nDefaulted container \\"apisix\\" out of: apisix, wait-etcd (init)\\n{\\"data\\":\\"protected data\\"}\\n```\\n\\n\u6b63\u5982\u4f60\u6240\u770b\u5230\u7684\uff0c\u5728\u4e0a\u8ff0\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u90fd\u80fd\u591f\u7ed5\u8fc7 Uri \u7684\u9650\u5236\u3002\\n\\n### \u6f0f\u6d1e\u89e3\u6790\\n\\n\u51fa\u73b0\u4e0a\u8ff0\u60c5\u51b5\u7684\u6839\u672c\u539f\u56e0\u662f `uri-blocker` \u63d2\u4ef6\u5728\u5904\u7406\u7981\u6b62\u8bbf\u95ee\u7684\u903b\u8f91\u4e2d\u4f7f\u7528\u4e86 `ctx.var.require_uri` \u53d8\u91cf\u3002\u53ef\u4ee5\u70b9\u51fb[\u76f8\u5173\u4ee3\u7801](https://github.com/apache/apisix/blob/11e7824cee0e4ab0145ea7189d991464ade3682a/apisix/plugins/uri-blocker.lua#L98)\u8fdb\u884c\u67e5\u770b\u3002\\n\\n![Cause](https://static.apiseven.com/202108/1637634166887-e3805291-5b00-4b7b-9936-0490266f4ed8.png)\\n\\n### \u6f0f\u6d1e\u5f71\u54cd\\n\\n- \u653b\u51fb\u8005\u53ef\u4ee5\u7ed5\u8fc7\u8bbf\u95ee\u63a7\u5236\u9650\u5236\u903b\u8f91\uff0c\u8bbf\u95ee\u672c\u5e94\u8be5\u7981\u6b62\u7684 API\uff1b\\n- \u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684\u5f00\u53d1\u8005\u6216\u8bb8\u4e0d\u77e5\u9053 `ngx.var.request_uri` \u53d8\u91cf\u662f\u4e0d\u53ef\u4fe1\u4efb\u7684\u3002\\n\\n\u5728\u641c\u7d22 `var.request_uri` \u76f8\u5173\u7528\u6cd5\u65f6\uff0c\u6211\u731c\u6d4b\u4e0a\u8ff0\u6f0f\u6d1e\u6216\u8bb8\u5bf9 [authz-keycloak](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/authz-keycloak.md) \u63d2\u4ef6\u4e5f\u6709\u5f71\u54cd\u3002\\n\\n\u5177\u4f53\u7ec6\u8282\u8be6\u60c5\u53ef\u4ee5\u53c2\u8003[\u8fd9\u6bb5\u4ee3\u7801](https://github.com/apache/apisix/blob/a3d42e66f60673e408cab2e2ceedc58aee450776/apisix/plugins/authz-keycloak.lua#L578)\u3002\u5982\u679c keycloak \u65b9\u9762\u6ca1\u6709\u8fdb\u884c\u76f8\u5173\u89c4\u8303\u5316\uff0c\u90a3\u4e48\u51fa\u73b0\u6f0f\u6d1e\u7684\u53ef\u80fd\u6027\u5c31\u5f88\u5927\u3002\\n\\n### \u5904\u7406\u63aa\u65bd\\n\\n\u5173\u4e8e\u6b64\u6f0f\u6d1e\u7684\u89e3\u51b3\u65b9\u6cd5\uff0c\u6211\u4e2a\u4eba\u5efa\u8bae\u5982\u679c\u662f\u4f7f\u7528\u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684\u8bdd\uff0c\u53ef\u5728\u4f7f\u7528 `ngx.var.request_uri` \u53d8\u91cf\u524d\u8fdb\u884c\u8def\u5f84\u89c4\u8303\u5316\u7684\u76f8\u5173\u5904\u7406\u3002\u540c\u65f6\u53ef\u4ee5\u989d\u5916\u68c0\u67e5\u4e0b `ctx.var.upstream_uri` \u548c `ctx.var.uri` \u8fd9\u4e24\u4e2a\u53d8\u91cf\uff0c\u867d\u7136\u53ef\u80fd\u5df2\u7ecf\u88ab\u89c4\u8303\u5316\u4e86\uff0c\u4f46\u9632\u60a3\u4e8e\u672a\u7136\u3002\\n\\n## Skipper\\n\\nSkipper \u662f\u6211\u4e2a\u4eba\u5728\u8fdb\u884c\u4e0a\u8ff0\u5b89\u5168\u6f0f\u6d1e\u8c03\u67e5\u65f6\u63a5\u89e6\u5230\u7684\u53e6\u4e00\u4e2a Ingress Controller\u3002\u56e0\u5176\u5185\u5bb9\u4e45\u8fdc\u672a\u66f4\u65b0\uff0c\u5728 Kubernetes \u4e2d\u5b89\u88c5\u5b83\u5e76\u4e0d\u5bb9\u6613\u3002\u5e78\u8fd0\u7684\u662f\uff0c\u6211\u5728\u5f00\u53d1\u8005\u6587\u7ae0\u91cc\u627e\u5230\u4e86\u5982\u4f55\u5b89\u88c5\u5b83\u7684\u76f8\u5173\u5185\u5bb9\u3002\\n\\n\u8fd9\u9879 Ingress \u63d0\u4f9b\u4e86\u57fa\u4e8e [WebHook filter](https://opensource.zalando.com/skipper/reference/filters/#webhook) \u5b9e\u73b0\u7684\u5916\u90e8\u8ba4\u8bc1\u53ef\u80fd\u6027\u3002\\n\\n```yaml\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  name: my-ingress\\n  annotations:\\n    zalando.org/skipper-filter: |\\n            modPath(\\"^/.*/\\", \\"/\\") -> setRequestHeader(\\"X-Auth-Request-Redirect\\", \\"${request.path}\\") -> webhook(\\"http://auth-service.default.svc.cluster.local:8080/verify\\")\\n```\\n\\n\u901a\u8fc7\u6dfb\u52a0\u4e00\u4e9b headers \u53ef\u4ee5\u4f18\u5316\u8bbf\u95ee\u63a7\u5236\u51b3\u7b56\uff0c\u4f46\u9700\u8981\u7528 `setRequestHeader` \u8fc7\u6ee4\u5668\u624b\u52a8\u5b8c\u6210\u3002\\n\\n\u6709\u4e00\u4e2a\u6a21\u677f\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 `${}` \u6765\u6ce8\u5165\u53d8\u91cf\uff0c\u4f46\u9057\u61be\u7684\u662f\uff08\u5bf9\u653b\u51fb\u8005\u6765\u8bf4\uff09`${request.path}` \u6709\u6b63\u5e38\u5316\u7684\u8def\u5f84\u3002\u5728\u5b83\u7684\u5f00\u53d1\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5f00\u53d1\u4eba\u5458\u5e76\u6ca1\u6709\u8f7b\u6613\u4f7f\u7528 `RequestURI` \u548c`originalRequest`\u3002\\n\\n\u6211\u6ca1\u6709\u8fdb\u884c\u76f8\u5173\u7684\u8def\u5f84\u904d\u5386\u6d4b\u8bd5\uff0c\u6216\u8bb8 Skipper \u4e5f\u662f\u5b89\u5168\u53ef\u4fe1\u7684\u4e00\u4e2a Ingress Controller \u9009\u62e9\u3002\\n\\n## \u603b\u7ed3\\n\\n\u867d\u7136\u524d\u6587\u4e2d\u6211\u63d0\u5230\u4e86 Apache APISIX \u5b58\u5728\u8def\u5f84\u904d\u5386\u7684\u6f0f\u6d1e\uff0c\u4f46\u8be5\u6f0f\u6d1e\u5e76\u4e0d\u5f71\u54cd\u4efb\u4f55\u5916\u90e8\u8ba4\u8bc1\uff0c\u53ea\u662f\u5f71\u54cd\u4e86\u4f7f\u7528 `ctx.var.request_uri` \u53d8\u91cf\u7684\u63d2\u4ef6\u3002\u540c\u65f6\u8be5\u6f0f\u6d1e\u5df2\u88ab Apache APISIX \u8fdb\u884c\u4e86\u53ca\u65f6\u4fee\u590d\uff0c\u76ee\u524d\u5df2\u6ca1\u6709\u5b89\u5168\u6f0f\u6d1e\u95ee\u9898\uff0c\u5927\u5bb6\u53ef\u653e\u5fc3\u4f7f\u7528\u3002\\n\\n\u5173\u4e8e\u672c\u6587\u4e2d\u63d0\u5230\u7684\u5168\u90e8\u4ee3\u7801\u90fd\u53ef\u4ee5\u5728[\u8fd9\u91cc](https://github.com/xvnpw/k8s-CVE-2021-43557-poc)\u8fdb\u884c\u67e5\u9605\u53c2\u8003\u3002"},{"id":"Apache APISIX request_uri \u53d8\u91cf\u63a7\u5236\u4e0d\u5f53\uff0c\u5b58\u5728\u8def\u5f84\u904d\u5386\u98ce\u9669\u516c\u544a(CVE-2021-43557)","metadata":{"permalink":"/zh/blog/2021/11/23/cve-2021-43557","source":"@site/blog/2021/11/23/cve-2021-43557.md","title":"Apache APISIX request_uri \u53d8\u91cf\u63a7\u5236\u4e0d\u5f53\uff0c\u5b58\u5728\u8def\u5f84\u904d\u5386\u98ce\u9669\u516c\u544a(CVE-2021-43557)","description":"\u5728 Apache APISIX 2.10.2 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u4f7f\u7528 Apache APISIX Ingress Controller \u4e2d $request_uri \u53d8\u91cf\u5b58\u5728\u300c\u7ed5\u8fc7\u90e8\u5206\u9650\u5236\u300d\u5bfc\u81f4\u8def\u5f84\u7a7f\u900f\u98ce\u9669\u7684\u5904\u7406\u516c\u544a\u3002","date":"2021-11-23T00:00:00.000Z","formattedDate":"2021\u5e7411\u670823\u65e5","tags":[{"label":"Vulnerabilities","permalink":"/zh/blog/tags/vulnerabilities"}],"readingTime":2.155,"truncated":true,"authors":[{"name":"\u82cf\u94b0","url":"https://github.com/SylviaBABY","imageURL":"https://avatars.githubusercontent.com/u/39793568?v=4"}],"prevItem":{"title":"APISIX request_uri \u53d8\u91cf\u63a7\u5236\u4e0d\u5f53\uff0c\u5b58\u5728\u8def\u5f84\u7a7f\u900f\u98ce\u9669","permalink":"/zh/blog/2021/11/23/cve-2021-43557-research-report"},"nextItem":{"title":"\u5982\u4f55\u4f7f\u7528 Nocalhost \u5f00\u53d1 APISIX Ingress Controller","permalink":"/zh/blog/2021/11/22/develop-apisix-ingress-with-nocalhost-in-kubernetes"}},"content":"> \u5728 Apache APISIX 2.10.2 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u4f7f\u7528 Apache APISIX Ingress Controller \u4e2d$request_uri \u53d8\u91cf\u5b58\u5728\u300c\u7ed5\u8fc7\u90e8\u5206\u9650\u5236\u300d\u5bfc\u81f4\u8def\u5f84\u7a7f\u900f\u98ce\u9669\u7684\u5904\u7406\u516c\u544a\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u95ee\u9898\u63cf\u8ff0\\n\\n\u5728 Apache APISIX 2.10.2 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u4f7f\u7528 Apache APISIX Ingress Controller \u4e2d$request_uri \u53d8\u91cf\u5b58\u5728\u300c\u7ed5\u8fc7\u90e8\u5206\u9650\u5236\u300d\u5bfc\u81f4\u8def\u5f84\u7a7f\u900f\u98ce\u9669\u7684\u95ee\u9898\u3002\\n\\n\u5728\u4f7f\u7528 uri-blocker \u63d2\u4ef6\u8fdb\u884c\u6d4b\u8bd5\u573a\u666f\u65f6\u53d1\u73b0\uff1a\\n\\n```shell\\n$ ./apisix_request.sh \\"/public-service/public\\"\\nDefaulted container \\"apisix\\" out of: apisix, wait-etcd (init)\\n{\\"data\\":\\"public data\\"}\\n```\\n\\n```shell\\n$ ./apisix_request.sh \\"/protected-service/protected\\"\\nDefaulted container \\"apisix\\" out of: apisix, wait-etcd (init)\\n<html>\\n<head><title>403 Forbidden</title></head>\\n<body>\\n<center><h1>403 Forbidden</h1></center>\\n<hr><center>openresty</center>\\n</body>\\n</html>\\n```\\n\\n\u5728\u4e0a\u8ff0\u4e24\u79cd\u573a\u666f\u4e0b\uff0c`public-service` \u662f\u53ef\u7528\u7684\uff0c`protected-service` \u5219\u88ab\u63d2\u4ef6\u963b\u6b62\u4e86\u3002\u540e\u7eed\u5bf9\u4e0a\u8ff0\u573a\u666f\u8fdb\u884c\u9a8c\u8bc1\u6d4b\u8bd5\uff0c\u53d1\u73b0\u4e24\u79cd\u60c5\u51b5\u5747\u80fd\u7ed5\u8fc7 Uri \u7684\u9650\u5236\u3002\\n\\n\u7531\u4e8e `uri-blocker` \u63d2\u4ef6\u4f7f\u7528 `ctx.var.require_uri` \u53d8\u91cf\u4e0d\u5f53\uff0c\u5bfc\u81f4\uff1a\\n\\n- \u653b\u51fb\u8005\u53ef\u4ee5\u7ed5\u8fc7\u8bbf\u95ee\u63a7\u5236\u9650\u5236\u903b\u8f91\uff0c\u8bbf\u95ee\u672c\u5e94\u8be5\u7981\u6b62\u7684 API\uff1b\\n- \u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684\u5f00\u53d1\u8005\u6216\u8bb8\u4e0d\u77e5\u9053 `ngx.var.request_uri` \u53d8\u91cf\u662f\u4e0d\u53ef\u4fe1\u4efb\u7684\u3002\\n\\n## \u5f71\u54cd\u7248\u672c\\n\\nApache APISIX 2.10.2 \u4e4b\u524d\u7684\u6240\u6709\u7248\u672c\uff08\u4e0d\u5305\u542b 2.10.2\uff09\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u8be5\u95ee\u9898\u76ee\u524d\u5df2\u5728 [2.10.2](http://apisix.apache.org/downloads/)+ \u7248\u672c\u4e2d\u5f97\u5230\u89e3\u51b3\uff0c\u8bf7\u5c3d\u5feb\u66f4\u65b0\u81f3\u76f8\u5173\u7248\u672c\u3002\\n\\n\u64cd\u4f5c\u5efa\u8bae\uff1a\u5982\u679c\u5728\u4f7f\u7528\u81ea\u5b9a\u4e49\u63d2\u4ef6\u65f6\uff0c\u53ef\u5728\u4f7f\u7528 `ngx.var.request_uri` \u53d8\u91cf\u524d\u8fdb\u884c\u8def\u5f84\u89c4\u8303\u5316\u7684\u76f8\u5173\u5904\u7406\u3002\u540c\u65f6\u989d\u5916\u68c0\u67e5\u4e0b `ctx.var.upstream_uri` \u548c `ctx.var.uri` \u8fd9\u4e24\u4e2a\u53d8\u91cf\uff0c\u867d\u7136\u53ef\u80fd\u5df2\u7ecf\u88ab\u89c4\u8303\u5316\u4e86\uff0c\u4f46\u9632\u60a3\u4e8e\u672a\u7136\u3002\\n\\n## \u6f0f\u6d1e\u8be6\u60c5\\n\\n\u6f0f\u6d1e\u516c\u5f00\u65f6\u95f4\uff1a2021 \u5e74 11 \u6708 22 \u65e5\\nCVE \u8be6\u7ec6\u4fe1\u606f\uff1ahttps://nvd.nist.gov/vuln/detail/CVE-2021-43557\\n\\n## \u8d21\u732e\u8005\u7b80\u4ecb\\n\\n\u8be5\u6f0f\u6d1e\u7531\u793e\u533a\u7528\u6237 Marcin Niemiec\uff08GitHub[@xvnpw](https://github.com/xvnpw)\uff09\u53d1\u73b0\uff0c\u5e76\u53ca\u65f6\u5411 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0a\u62a5\u8be5\u6f0f\u6d1e\u3002\\n\\n\u611f\u8c22 Marcin Niemiec \u5bf9 Apache APISIX \u793e\u533a\u7684\u8d21\u732e\u3002"},{"id":"\u5982\u4f55\u4f7f\u7528 Nocalhost \u5f00\u53d1 APISIX Ingress Controller","metadata":{"permalink":"/zh/blog/2021/11/22/develop-apisix-ingress-with-nocalhost-in-kubernetes","source":"@site/blog/2021/11/22/develop-apisix-ingress-with-nocalhost-in-kubernetes.md","title":"\u5982\u4f55\u4f7f\u7528 Nocalhost \u5f00\u53d1 APISIX Ingress Controller","description":"\u672c\u6587\u5c06\u4e3a\u60a8\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Nocalhost \u5c06\u672c\u5730\u5f00\u53d1\u673a\u65e0\u7f1d\u8fde\u63a5\u5230\u4e00\u4e2a\u8fdc\u7a0b Kubernetes \u96c6\u7fa4\uff0c\u540c\u65f6\u914d\u5408 IDE \u6765\u5f00\u53d1\u548c\u8c03\u8bd5 Apache APISIX Ingress Controller\u3002","date":"2021-11-22T00:00:00.000Z","formattedDate":"2021\u5e7411\u670822\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":6.115,"truncated":true,"authors":[{"name":"Garry Chen","url":"https://github.com/neaped","imageURL":"https://avatars.githubusercontent.com/u/3713305?v=4"}],"prevItem":{"title":"Apache APISIX request_uri \u53d8\u91cf\u63a7\u5236\u4e0d\u5f53\uff0c\u5b58\u5728\u8def\u5f84\u904d\u5386\u98ce\u9669\u516c\u544a(CVE-2021-43557)","permalink":"/zh/blog/2021/11/23/cve-2021-43557"},"nextItem":{"title":"\u91cd\u78c5\u529f\u80fd\uff01Apache APISIX \u62e5\u62b1 WASM \u751f\u6001","permalink":"/zh/blog/2021/11/19/apisix-supports-wasm"}},"content":"> \u672c\u6587\u5c06\u4e3a\u60a8\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Nocalhost \u5c06\u672c\u5730\u5f00\u53d1\u673a\u65e0\u7f1d\u8fde\u63a5\u5230\u4e00\u4e2a\u8fdc\u7a0b Kubernetes \u96c6\u7fa4\uff0c\u540c\u65f6\u914d\u5408 IDE \u6765\u5f00\u53d1\u548c\u8c03\u8bd5 Apache APISIX Ingress Controller\u3002\u5229\u7528\u73b0\u6709\u6280\u672f\u6808\u66f4\u987a\u7545\u5730\u5f00\u53d1\u548c\u8c03\u8bd5\u8fdc\u7a0b\u5e94\u7528\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u73af\u5883\u51c6\u5907\\n\\n- \u51c6\u5907\u4e00\u4e2a\u53ef\u7528\u7684 Kubernetes \u96c6\u7fa4\u3002\u53ef\u4f7f\u7528\u4efb\u610f\u62e5\u6709\u547d\u540d\u7a7a\u95f4\u7ba1\u7406\u6743\u9650\u7684 Kubernetes \u96c6\u7fa4\\n- \u672c\u5730\u5df2\u5b89\u88c5\u597d [Helm v3.0+](https://helm.sh)\\n- \u96c6\u7fa4\u4e2d\u5df2\u5b89\u88c5\u597d Apache APISIX\\n- GoLand IDE 2020.03+ (\u672c\u6587\u5e94\u7528\u7684\u662f 2021.2 \u7248\u672c)\\n- \u5b89\u88c5 [Nocalhost JetBrains plugin](https://nocalhost.dev/zh-CN/docs/installation#install-jetbrains-plugin) \u63d2\u4ef6\\n- \u5b89\u88c5 [Go 1.13](https://golang.org/dl/) \u6216\u66f4\u9ad8\u7248\u672c\\n\\n## \u90e8\u7f72 Apache APISIX Ingress Controller\\n\\n\u5728 GoLand \u4e2d\u901a\u8fc7 Nocalhost \u90e8\u7f72 Apache APISIX Ingress Controller\uff0c\u64cd\u4f5c\u5982\u4e0b\uff1a\\n\\n1. \u5728 GoLand \u4e2d\u6253\u5f00 Nocalhost \u63d2\u4ef6\\n2. \u9009\u62e9\u5c06\u8981\u90e8\u7f72 APISIX Ingress Controller \u7684\u547d\u540d\u7a7a\u95f4\\n3. \u53f3\u952e\u70b9\u51fb\u9009\u5b9a\u7684\u547d\u540d\u7a7a\u95f4, \u9009\u62e9 **`Deploy Application`**, \u7136\u540e\u9009\u62e9 **`Helm Repo`** \u4f5c\u4e3a\u5b89\u88c5\u65b9\u6cd5\\n4. \u5728\u4e0b\u9762\u7684\u5bf9\u8bdd\u6846\u4e2d\uff1a\\n\\n    1. \u5728 `Name` \u4e2d\u8f93\u5165\uff1a`apisix-ingress-controller`\\n    2. \u5728 `Chart URL` \u4e2d\u8f93\u5165\uff1a`https://charts.apiseven.com`\\n\\n![\u90e8\u7f72 APISIX ingress controller](https://static.apiseven.com/202108/1637131316244-f1a58c88-8628-4918-a4c4-1ad287742fd0.gif)\\n\\n\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u901a\u8fc7\u5728 IDE \u5185\u542f\u7528\u7aef\u53e3\u8f6c\u53d1\u6765\u6d4b\u8bd5 `apisix-ingress-controller`:\\n\\n1. \u5728 Nocalhost \u63d2\u4ef6\u7684 Workloads \u4e2d\u627e\u5230 `apisix-ingress-controller`\uff0c\u53f3\u952e\u70b9\u51fb\u5e76\u9009\u62e9 **`Port Forward`**\\n2. \u6dfb\u52a0\u7aef\u53e3\u8f6c\u53d1 `8080:8080`\\n3. \u5728\u672c\u5730\u8bbf\u95ee [`http://127.0.0.1:8080/healthz`](http://127.0.0.1:8080/healthz) \u5e76\u68c0\u67e5\u7ed3\u679c\\n\\n![\u6d4b\u8bd5\u90e8\u7f72\u662f\u5426\u6210\u529f](https://static.apiseven.com/202108/1637131450462-842c3baf-b7a4-4598-be0b-27486bf1cf28.gif)\\n\\n## \u5f00\u53d1\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u8fdb\u5165\u5f00\u53d1\u6a21\u5f0f\\n\\n1. \u53f3\u952e\u70b9\u51fb `apisix-ingress-controller` \u5de5\u4f5c\u8d1f\u8f7d\uff0c\u9009\u62e9 **`Start DevMode`**\\n2. \u5982\u679c\u60a8\u5df2\u7ecf\u5c06\u6e90\u7801\u514b\u9686\u5230\u672c\u5730\uff0c\u8bf7\u9009\u62e9\u60a8\u7684\u6e90\u4ee3\u7801\u76ee\u5f55\u3002\u5426\u5219\u901a\u8fc7\u8f93\u5165\u4ed3\u5e93\u5730\u5740 https://github.com/apache/apisix-ingress-controller.git \u6765\u8ba9 Nocalhost \u514b\u9686\u4f60\u7684\u6e90\u4ee3\u7801\u5230\u672c\u5730\\n3. \u7b49\u5f85\u64cd\u4f5c\u5b8c\u6210\uff0cNocalhost \u5c06\u5728\u8fdb\u5165 DevMode \u540e\u5728 IDE \u5185\u6253\u5f00\u8fdc\u7a0b\u7ec8\u7aef\\n\\n\u73b0\u5728\u901a\u8fc7\u5728\u8fdc\u7a0b\u7ec8\u7aef\u4e2d\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u6765\u542f\u52a8 `apisix-ingress-controller` \u8fdb\u7a0b\uff1a\\n\\n```bash\\ngo run main.go ingress --config-path conf/config-default.yaml\\n```\\n\\n`apisix-ingress-controller` \u542f\u52a8\u540e\uff0c\u53ef\u901a\u8fc7 [`http://127.0.0.1:8080/healthz`](http://127.0.0.1:8080/healthz) \u8bbf\u95ee\u670d\u52a1\uff0c\u5e76\u68c0\u67e5\u7ed3\u679c.\\n\\n![\u8fdb\u5165\u5f00\u53d1\u6a21\u5f0f](https://static.apiseven.com/202108/1637131513751-b9184c10-4da3-4ab2-b403-56ae2360704a.gif)\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u4fee\u6539\u4ee3\u7801\u5e76\u68c0\u67e5\u7ed3\u679c\\n\\n\u73b0\u5728\u6211\u4eec\u6765\u4fee\u6539\u4e00\u4e0b\u4ee3\u7801\u5e76\u770b\u770b\u6548\u679c\uff1a\\n\\n1. \u505c\u6b62 `apisix-ingress-controller` \u8fdb\u7a0b\\n2. \u5728 Goland \u4e2d\u641c\u7d22 `healthz` \u5e76\u627e\u5230 `router.go` \u6587\u4ef6\u3002 \u5c06 `healthzResponse` \u7684\u72b6\u6001\u4ee3\u7801\u4ece `ok` \u66f4\u6539\u4e3a `Hello Nocalhost`\\n3. \u91cd\u65b0\u542f\u52a8\u8fdb\u7a0b\u5e76\u5728\u672c\u5730\u68c0\u67e5\u66f4\u6539\u7ed3\u679c\\n\\n![\u65e0\u9700\u91cd\u65b0\u6784\u5efa\u955c\u50cf\u6216\u91cd\u542f\u5bb9\u5668\uff0c\u51e0\u79d2\u540e\u4fbf\u53ef\u4ee5\u770b\u5230\u6539\u52a8\u7684\u7ed3\u679c](https://static.apiseven.com/202108/1637131699629-a0766f66-0faa-4bf8-9013-284e5f2bdd57.gif)\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u7ed3\u675f\u5f00\u53d1\u6a21\u5f0f\\n\\n\u73b0\u5728\u5173\u95ed\u5f00\u53d1\u7a97\u53e3\u5e76\u9000\u51fa\u5f00\u53d1\u6a21\u5f0f\uff1a\\n\\n1. \u53f3\u952e\u70b9\u51fb `apisix-ingress-controller`\\n2. \u9009\u62e9 **`End DevMode`**\\n\\nNocalhost \u5c06\u4f7f `apisix-ingress-controller` \u7ed3\u675f DevMode, \u5e76\u91cd\u7f6e `apisix-ingress-controller` \u5230\u5176\u539f\u59cb\u7248\u672c\u3002\u542f\u7528\u7aef\u53e3\u8f6c\u53d1\u6765\u770b\u770b\u9000\u51fa\u5f00\u53d1\u6a21\u5f0f\u540e\u7684\u7ed3\u679c\u3002\\n\\n![\u7ed3\u675f DevMode](https://static.apiseven.com/202108/1637131766524-dba7b756-ae0b-42d1-8ff0-6ac14059ce11.gif)\\n\\n\u6ce8\u610f\uff1a\u5728\u5f00\u53d1\u6a21\u5f0f\u4e0b\u4fee\u6539\u4ee3\u7801\u65f6\uff0c\u6240\u6709\u4ee3\u7801\u66f4\u6539\u90fd\u53ea\u5728**\u5f00\u53d1\u5bb9\u5668**\u4e2d\u751f\u6548\u3002\\n\\n\u9000\u51fa DevMode \u540e\uff0cNocalhost \u5c06\u4f1a\u5c06\u8fdc\u7a0b\u5bb9\u5668\u91cd\u7f6e\u4e3a\u539f\u59cb\u72b6\u6001(\u8fdb\u5165 DevMode \u4e4b\u524d\u7684\u7248\u672c)\u3002\u8fd9\u6837\uff0c\u5728\u9000\u51fa DevMode \u540e\uff0c\u5bf9\u4ee3\u7801\u8fdb\u884c\u4fee\u6539\u4e0d\u4f1a\u5bf9\u539f\u59cb\u73af\u5883\u9020\u6210\u4efb\u4f55\u66f4\u6539\u6216\u5f71\u54cd\u3002\\n\\n## \u8c03\u8bd5\\n\\n\u8c03\u8bd5\u5e94\u7528\u7a0b\u5e8f\u662f\u4e00\u4ef6\u9ebb\u70e6\u7684\u4e8b\uff0c\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u8c03\u8bd5\u5e94\u7528\u7a0b\u5e8f\u5219\u66f4\u52a0\u9ebb\u70e6\u3002\u4f46 Nocalhost \u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5728\u8c03\u8bd5 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u7a0b\u5e8f\u65f6\u83b7\u5f97\u548c\u5728 IDE \u4e2d\u76f4\u63a5\u8c03\u8bd5\u672c\u5730\u7a0b\u5e8f\u540c\u6837\u7684\u4f53\u9a8c\u3002\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u5f00\u542f\u8fdc\u7a0b\u8c03\u8bd5\\n\\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5f00\u542f\u8fdc\u7a0b\u8c03\u8bd5\\n\\n- \u53f3\u952e\u70b9\u51fb `apisix-ingress-controller` \u5e76\u9009\u62e9 **`Remote Debug`**\\n- Nocalhost \u5c06\u4f1a\u5148\u8ba9 `apisix-ingress-controller` \u8fdb\u5165 DevMode\uff0c\u5e76\u8fd0\u884c\u5728 [`dev config`](https://nocalhost.dev/zh-CN/docs/config/config-develop) \u5b9a\u4e49\u7684\u8c03\u8bd5\u547d\u4ee4\\n\\n![\u5f00\u59cb\u8fdc\u7a0b\u8c03\u8bd5](https://static.apiseven.com/202108/1637132327260-7bba1d81-cf70-4982-9a07-51cc379e6bea.gif)\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u8bbe\u7f6e\u65ad\u70b9\\n\\n\u5728 `healthz` \u51fd\u6570\u4e0a\u8bbe\u7f6e\u4e00\u4e2a\u65ad\u70b9\u3002\u60ac\u505c\u5728\u884c\u53f7\u5de6\u4fa7\uff0c\u7136\u540e\u70b9\u51fb\u7ea2\u70b9\u3002\u8bbe\u7f6e\u597d\u65ad\u70b9\u540e\uff0c\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95ee [`http://127.0.0.1:8080/healthz`](http://127.0.0.1:8080/healthz)\uff0c\u4f1a\u89e6\u53d1\u65ad\u70b9\uff0cGoLand \u4f1a\u8df3\u5230\u524d\u53f0\u3002\u70b9\u51fb\u8c03\u8bd5\u76f8\u5173\u6309\u94ae\u53ef\u5bf9\u7a0b\u5e8f\u8fdb\u884c\u8c03\u8bd5\u3002\\n\\n\u6b64\u5916\uff0c\u56e0\u4e3a\u6211\u4eec\u542f\u7528\u4e86 `dev.hotReload`\uff0c\u6240\u4ee5\u6bcf\u6b21\u66f4\u6539\u4ee3\u7801\u65f6\uff0cNocalhost \u5c06\u81ea\u52a8\u91cd\u65b0\u8fd0\u884c\u8c03\u8bd5\u547d\u4ee4\u3002\u8fd9\u53ef\u4ee5\u8ba9\u6211\u4eec\u9891\u7e41\u66f4\u6539\u548c\u8c03\u8bd5\u4ee3\u7801\u65f6\u53d8\u5f97\u65b9\u4fbf\u5f88\u591a\u3002\\n\\n![\u8bbe\u7f6e\u65ad\u70b9\u5e76\u8fd0\u884c\u670d\u52a1](https://static.apiseven.com/202108/1637132455552-86f44c0c-94d1-4ad9-a79d-0e2c6957d60b.gif)\\n\\n## \u8fdc\u7a0b\u8fd0\u884c\\n\\nNocalhost \u4e0d\u4ec5\u4ec5\u53ef\u4ee5\u8fdc\u7a0b\u8c03\u8bd5\uff0c\u8fd8\u4e3a\u6211\u4eec\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u8fd0\u884c\u670d\u52a1\u4ee5\u53ca\u70ed\u52a0\u8f7d\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u7b80\u5355\u7684\u65b9\u5f0f\u3002\\n\\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u4f7f\u7528 Remote Run \u529f\u80fd\uff1a\\n\\n- \u53f3\u952e\u70b9\u51fb `apisix-ingress-controller`\uff0c\u5e76\u9009\u62e9 **`Remote Run`**\\n- Nocalhost \u5c06\u4f1a\u5148\u8ba9 `apisix-ingress-controller` \u8fdb\u5165 DevMode\uff0c\u5e76\u8fd0\u884c\u5728 [`dev config`](https://nocalhost.dev/zh-CN/docs/config/config-develop) \u5b9a\u4e49\u7684\u8fd0\u884c\u547d\u4ee4\\n\\n\u6bcf\u6b21\u66f4\u6539\u4ee3\u7801\u5b8c\u4ee3\u7801\u540e\uff0cNocalhost \u90fd\u4f1a\u81ea\u52a8\u89e6\u53d1\u8fd0\u884c\u547d\u4ee4\uff0c\u5c06\u7a0b\u5e8f\u8fd0\u884c\u8d77\u6765\u3002\\n\\n![Remote run](https://static.apiseven.com/202108/1637133046432-84810667-c3ee-4d71-8a33-eb1833fd9ce2.gif)\\n\\n## \u603b\u7ed3\\n\\n\u901a\u8fc7\u672c\u6587\uff0c\u6211\u4eec\u4e3a\u5927\u5bb6\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Nocalhost \u6765\u5f00\u53d1\u548c\u8c03\u8bd5 Kubernetes \u96c6\u7fa4\u4e2d\u7684 Apache APISIX Ingress Controller\u3002\u501f\u52a9 Nocalhost \u7684\u80fd\u529b\uff0c\u6211\u4eec\u4e0d\u518d\u9700\u8981\u7b49\u5f85\u7f13\u6162\u7684\u672c\u5730\u5f00\u53d1\u8fc7\u7a0b\uff0c\u800c\u662f\u53ef\u4ee5\u901a\u8fc7\u5373\u65f6\u53cd\u9988\u548c\u9ad8\u6548\u7684\u4e91\u672c\u5730\u5f00\u53d1\u73af\u5883\u8fdb\u884c\u5feb\u901f\u90e8\u7f72\u4e0e\u8fed\u4ee3."},{"id":"\u91cd\u78c5\u529f\u80fd\uff01Apache APISIX \u62e5\u62b1 WASM \u751f\u6001","metadata":{"permalink":"/zh/blog/2021/11/19/apisix-supports-wasm","source":"@site/blog/2021/11/19/apisix-supports-wasm.md","title":"\u91cd\u78c5\u529f\u80fd\uff01Apache APISIX \u62e5\u62b1 WASM \u751f\u6001","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4e3a\u4ec0\u4e48\u9009\u62e9 Proxy Wasm \u6765\u5b9e\u73b0\u529f\u80fd\u4ee5\u53ca\u5982\u4f55\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Wasm \u5e76\u4e14\u901a\u8fc7\u5b9e\u9645\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u6d4b\u8bd5\u63d2\u4ef6\u3002","date":"2021-11-19T00:00:00.000Z","formattedDate":"2021\u5e7411\u670819\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.815,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"\u5982\u4f55\u4f7f\u7528 Nocalhost \u5f00\u53d1 APISIX Ingress Controller","permalink":"/zh/blog/2021/11/22/develop-apisix-ingress-with-nocalhost-in-kubernetes"},"nextItem":{"title":"\u5982\u4f55\u4e0e Dapr \u96c6\u6210\u6253\u9020 Apache APISIX \u7f51\u5173\u63a7\u5236\u5668","permalink":"/zh/blog/2021/11/17/dapr-with-apisix"}},"content":"> \u5728\u5373\u5c06\u53d1\u5e03\u7684 Apache APISIX \u7248\u672c\uff082.11.0\uff09\u4e2d\u5c06\u4f1a\u65b0\u589e\u5bf9\u4e8e WASM \u7684\u652f\u6301\uff01\u901a\u8fc7\u9605\u8bfb\u672c\u6587\u4f60\u5c06\u4e86\u89e3\u5230 Apache APISIX \u5982\u4f55\u4ece 0 \u5230 1 \u90e8\u7f72\u8fd9\u9879\u529f\u80fd\u7684\u652f\u6301\u4e0e\u5f00\u53d1\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u5728\u5373\u5c06\u53d1\u5e03\u7684 Apache APISIX \u7248\u672c\uff082.11.0\uff09\u4e2d\uff0c\u6211\u4eec\u65b0\u589e\u4e86\u5bf9\u4e8e WASM \u7684\u652f\u6301\uff01\u73b0\u5728\u5f00\u53d1\u8005\u9664\u4e86\u53ef\u4ee5\u4f7f\u7528 Lua\u3001Java\u3001Go\u3001Python\u3001JavaScript \u7b49\u591a\u79cd\u7f16\u7a0b\u8bed\u8a00\u5f00\u53d1 APISIX \u7684\u63d2\u4ef6\u4e4b\u5916\uff0c\u4e5f\u53ef\u4ee5\u7528 WASM \u6765\u5f00\u53d1\u63d2\u4ef6\u3002\\n\\n![\u62e5\u62b1 WASM \u751f\u6001](https://static.apiseven.com/202108/1637289637179-ab74d38f-acd4-4401-908f-e1d310a33583.png)\\n\\nWASM \u5168\u79f0 [WebAssembly](https://webassembly.org/)\uff0c\u4e0e\u4e0a\u8ff0\u5177\u4f53\u7f16\u7a0b\u8bed\u8a00\u8fd0\u884c\u65f6\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u5b83\u662f\u4e00\u5957\u5b57\u8282\u7801\u6807\u51c6\uff0c\u4e13\u95e8\u8bbe\u8ba1\u6210\u53ef\u4ee5\u5728\u5bbf\u4e3b\u73af\u5883\u4e2d\u5d4c\u5957\u4f7f\u7528\u3002\\n\\n\u5982\u679c\u67d0\u79cd\u7f16\u7a0b\u8bed\u8a00\u63d0\u4f9b\u7f16\u8bd1\u6210 WASM \u5b57\u8282\u7801\u7684\u529f\u80fd\uff0c\u5c31\u53ef\u4ee5\u628a\u8be5\u8bed\u8a00\u7684\u5e94\u7528\u7f16\u8bd1\u6210 WASM \u5b57\u8282\u7801\uff0c\u8fd0\u884c\u5728\u67d0\u4e2a\u652f\u6301 WASM \u7684\u5bbf\u4e3b\u73af\u5883\u4e2d\u3002\\n\\n\u542c\u8d77\u6765\uff0c\u662f\u4e0d\u662f\u53ea\u8981\u67d0\u4e2a\u5bbf\u4e3b\u73af\u5883\u652f\u6301 WASM\uff0c\u5c31\u80fd\u50cf\u64cd\u4f5c\u7cfb\u7edf\u4e00\u6837\u8fd0\u884c\u4efb\u610f\u5e94\u7528\u5462\uff1f\\n\\n\u4f46\u5176\u5b9e\u8fd9\u91cc\u6709\u4e2a\u9650\u5236\uff0c\u5c31\u50cf\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u5b9e\u73b0\u7279\u5b9a\u6807\u51c6\u7684 syscall \u4e00\u6837\uff0c\u8981\u60f3\u8fd0\u884c\u7279\u5b9a\u7684\u5e94\u7528\uff0c\u4e5f\u9700\u8981\u5b9e\u73b0\u8be5\u5e94\u7528\u6240\u9700\u7684 API\u3002\\n\\n\u4ee5 JavaScript \u4e3a\u4f8b\uff0c\u867d\u7136\u540c\u6837\u662f JavaScript \u4ee3\u7801\uff0c\u4f46\u662f\u9488\u5bf9\u6d4f\u89c8\u5668\u5199\u7684 JS \u6a21\u5757\u4e0d\u80fd\u76f4\u63a5\u7528\u5728 npm \u5305\u91cc\u9762\uff0c\u56e0\u4e3a\u4e24\u4e2a\u7684 API \u4e0d\u4e00\u6837\u3002\\n\\n\u6240\u4ee5\u4ec5\u4ec5\u628a WASM \u653e\u5230 Apache APISIX \u91cc\u9762\u5e76\u884c\u4e0d\u901a\uff0c\u8981\u60f3\u8ba9\u5f00\u53d1\u8005\u5728 Apache APISIX \u4e0a\u8fd0\u884c WASM\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u63d0\u4f9b\u4e00\u5957\u4e13\u95e8\u7684 API\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u9009\u62e9 Proxy WASM\\n\\n\u5bf9\u4e8e\u5982\u4f55\u63d0\u4f9b\u8fd9\u5957 API\uff0c\u6211\u4eec\u66fe\u7ecf\u6743\u8861\u8fc7\u4e24\u5957\u65b9\u6848\uff1a\\n\\n1. \u53c2\u8003 lua-nginx-module \u7684\u63a5\u53e3\uff0c\u5b9e\u73b0\u5bf9\u5e94\u7684 WASM \u7248 API\\n2. \u5b9e\u73b0 Proxy WASM \u8fd9\u4e00\u5957\u6807\u51c6\\n\\n[Proxy WASM](https://github.com/proxy-wasm/spec) \u662f Envoy \u7684 WASM API \u6807\u51c6\u3002\u6240\u4ee5\u4e0a\u8ff0\u95ee\u9898\u5176\u5b9e\u7b49\u4ef7\u4e8e\uff0c\u6211\u4eec\u662f\u81ea\u5df1\u641e\u4e00\u5957 API \u6807\u51c6\u8fd8\u662f\u590d\u7528 Envoy \u5df2\u6709\u6807\u51c6\u5462\uff1f\\n\\n> WASM API \u6807\u51c6\u53ef\u4ee5\u62c6\u6210\u4e24\u4e2a\u65b9\u9762\u6765\u770b\uff1a\\n    1. Host\uff0c\u8d1f\u8d23\u63d0\u4f9b API \u7684\u5b9e\u73b0\\n    2. SDK\uff0c\u8981\u60f3\u5728\u4e0d\u540c\u7684\u7f16\u7a0b\u8bed\u8a00\u91cc\u9762\u8c03\u7528\u63d0\u4f9b\u7684 API\uff0c\u9700\u8981\u4f7f\u7528\u8be5\u8bed\u8a00\u6765\u5b9e\u73b0\u4e00\u5957\u80f6\u6c34\u5c42\\n\\n\u5982\u679c\u6211\u4eec\u9075\u5faa Envoy \u7684\u6807\u51c6\uff0c\u4f18\u52bf\u5728\u4e8e\u53ef\u4ee5\u590d\u7528 Envoy \u73b0\u6709\u7684 WASM SDK\uff08Proxy WASM SDK\uff09\uff0c\u800c\u4e0d\u8db3\u4e4b\u5904\u5728\u4e8e\u8fd9\u5957\u6807\u51c6\u662f Envoy \u7ed3\u5408\u81ea\u5df1\u60c5\u51b5\u5236\u5b9a\u7684\uff0c\u5982\u679c\u6211\u4eec\u8ddf\u7740\u5b9e\u73b0\uff0c\u6ca1\u6709\u81ea\u5df1\u91cf\u8eab\u5b9a\u5236\u90a3\u4e48\u8f7b\u677e\u3002\\n\\n\u7ecf\u8fc7\u793e\u533a\u7684\u8ba8\u8bba\u540e\uff0c\u6211\u4eec\u6700\u7ec8\u51b3\u5b9a\u91c7\u7528 Proxy WASM \u6807\u51c6\u3002\u300c\u505a\u96be\u4e14\u6b63\u786e\u7684\u4e8b\u300d\uff0c\u5b9e\u73b0 Proxy WASM \u81ea\u7136\u662f\u96be\u7684\u4e8b\uff0c\u4f46\u6211\u4eec\u76f8\u4fe1\u8fd9\u662f\u6b63\u786e\u7684\u4e8b\uff0c\u901a\u8fc7\u793e\u533a\u7684\u5408\u4f5c\u548c\u5171\u5efa\uff0c\u53ef\u4ee5\u6784\u5efa\u66f4\u52a0\u7e41\u8363\u7684\u751f\u6001\u3002\\n\\n## \u5982\u4f55\u5728 Apache APISIX \u4e2d\u4f7f\u7528 WASM\\n\\nApache APISIX \u76ee\u524d\u5df2\u521d\u6b65\u652f\u6301 WASM\uff0c\u53ef\u4ee5\u4f7f\u7528 WASM \u6765\u7f16\u5199 fault-injection \u63d2\u4ef6\u7684\u90e8\u5206\u529f\u80fd\u3002\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u5728\u672c\u6708\u5e95\u7684 Apache APISIX 2.11.0 \u7248\u672c\u4e2d\u5c1d\u5c1d\u9c9c\uff0c\u656c\u8bf7\u671f\u5f85\uff01\\n\\n\u4e0b\u9762\u6211\u4eec\u5c06\u7ed3\u5408 [proxy-wasm-go-sdk](https://github.com/tetratelabs/proxy-wasm-go-sdk/) \u6765\u8bb2\u8bb2\u600e\u4e48\u7528 WASM \u5b9e\u73b0\u6ce8\u5165\u81ea\u5b9a\u4e49\u54cd\u5e94\u7684\u529f\u80fd\u3002\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u57fa\u4e8e proxy-wasm-go-sdk \u7f16\u5199\u4ee3\u7801\\n\\n\u5b9e\u73b0\u4ee3\u7801\uff08\u5305\u542b `go.mod` \u548c\u5176\u4ed6\uff09\u5177\u4f53\u7ec6\u8282\u53ef[\u70b9\u51fb\u6b64\u5904](https://github.com/apache/apisix/tree/master/t/wasm)\u67e5\u9605\u3002\\n\\n\u8fd9\u91cc\u9700\u8981\u89e3\u91ca\u4e0b\uff0c\u867d\u7136 proxy-wasm-go-sdk \u8fd9\u4e2a\u9879\u76ee\u5e26\u4e86 Go \u7684\u540d\u5b57\uff0c\u4f46\u5b83\u5176\u5b9e\u7528\u7684\u662f tinygo \u800c\u4e0d\u662f\u539f\u751f\u7684 Go\u3002\u56e0\u4e3a\u539f\u751f\u7684 Go \u5728\u652f\u6301 WASI\uff08\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u5b83\u662f\u975e\u6d4f\u89c8\u5668\u7684 WASM \u8fd0\u884c\u65f6\u63a5\u53e3\uff09\u65f6\u4f1a\u6709\u4e00\u4e9b\u95ee\u9898\uff0c\u8be6\u60c5\u53ef[\u70b9\u51fb\u6b64\u5904](https://github.com/tetratelabs/proxy-wasm-go-sdk/blob/main/doc/OVERVIEW.md#tinygo-vs-the-official-go-compiler)\u67e5\u9605\u3002\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u6784\u5efa\u5bf9\u5e94\u7684 WASM \u6587\u4ef6\\n\\n```shell\\ntinygo build -o ./fault-injection/main.go.wasm -scheduler=none -target=wasi ./fault-injection/main.go\\n```\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u5728 Apache APISIX \u7684 config.yaml \u5f15\u7528\u8be5\u6587\u4ef6\\n\\n```yaml\\napisix:\\n        ...\\nwasm:\\n    plugins:\\n        - name: wasm_fault_injection\\n          priority: 7997\\n          file: t/wasm/fault-injection/main.go.wasm\\n```\\n\\n\u901a\u8fc7\u4ee5\u4e0a\u64cd\u4f5c\uff0c\u4f60\u53ef\u4ee5\u50cf\u7528 Lua \u63d2\u4ef6\u4e00\u6837\u7528\u8fd9\u4e2a WASM \u63d2\u4ef6\uff0c\u6bd4\u5982\uff1a\\n\\n```yaml\\nuri: \\"/wasm\\"\\nplugins:\\n  wasm_fault_injection:\\n    conf: \'{\\"body\\":\\"hello world\\", \\"http_status\\":200}\'\\nupstream:\\n  type: roundrobin\\n  nodes:\\n    127.0.0.1:1980: 1\\n```\\n\\n\u6ce8\u610f WASM \u63d2\u4ef6\u7684\u914d\u7f6e\u90fd\u662f conf \u5b57\u6bb5\u4e0b\u9762\u7684\u4e00\u6761\u5b57\u7b26\u4e32\uff0c\u7531\u5bf9\u5e94\u7684\u63d2\u4ef6\u81ea\u5df1\u53bb\u505a\u89e3\u6790\u3002\\n\\n## \u6a2a\u5411\u6d4b\u8bc4\u2014\u2014\u6761\u6761\u5927\u9053\u901a\u7f57\u9a6c\\n\\nApache APISIX \u53d1\u5c55\u5230\u73b0\u5728\uff0c\u5df2\u7ecf\u6709\u4e09\u79cd\u7f16\u5199\u63d2\u4ef6\u7684\u65b9\u5f0f\uff1a\\n\\n1. \u539f\u751f\u7684 Lua way\uff0c\u8dd1\u5728 APISIX \u91cc\u9762\\n2. \u591a\u79cd\u8bed\u8a00\u7684\u5916\u90e8\u63d2\u4ef6 runner\uff0c\u63d2\u4ef6\u903b\u8f91\u8dd1\u5728 APISIX \u5916\u9762\\n3. \u628a\u591a\u79cd\u8bed\u8a00\u7f16\u8bd1\u6210 WASM\uff0c\u4f9d\u7136\u8dd1\u5728 APISIX \u91cc\u9762\\n\\n![APISIX \u751f\u6001\u652f\u6301](https://static.apiseven.com/202108/1637289637159-f2fd1f09-4be6-4cd4-88a0-9c3a23c4f405.png)\\n\\n\u8fd9\u4e09\u79cd\u65b9\u5f0f\u5728\u8bf8\u5982\u751f\u6001\u3001\u6210\u719f\u5ea6\u7b49\u5404\u4e2a\u65b9\u9762\u90fd\u5dee\u5f02\u5f88\u5927\u3002\u6b63\u5de7\u6211\u4eec\u90fd\u53ef\u4ee5\u7528\u5b83\u4eec\u6765\u5b9e\u73b0 fault-injection\uff0c\u6240\u4ee5\u53ef\u4ee5\u6bd4\u6bd4\u770b\u3002\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u914d\u7f6e\u8def\u7531\\n\\nLua way \u7684 fault-injection\uff0c\u81ea\u7136\u662f\u4f7f\u7528\u5185\u7f6e\u7684 fault-injection \u63d2\u4ef6\u3002Runner way \u7684 fault-injection \u5b9e\u73b0\u5177\u4f53\u53ef[\u70b9\u51fb\u6b64\u5904](https://github.com/apache/apisix-go-plugin-runner/blob/master/cmd/go-runner/plugins/fault_injection.go)\u67e5\u9605\u3002\\n\\n\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u5206\u522b\u7ed9\u5b83\u4eec\u914d\u7f6e\u4e0d\u540c\u7684\u8def\u7531\uff1a\\n\\n```yaml\\n---\\nuri: \\"/wasm\\"\\nplugins:\\n  wasm_fault_injection:\\n    conf: \'{\\"body\\":\\"hello world\\", \\"http_status\\":200}\'\\nupstream:\\n  type: roundrobin\\n  nodes:\\n    127.0.0.1:1980: 1\\n---\\nplugins:\\n  ext-plugin-pre-req:\\n    conf:\\n    - name: fault-injection\\n      value: \'{\\"body\\":\\"hello world\\", \\"http_status\\":200}\'\\nupstream:\\n  nodes:\\n    127.0.0.1:1980: 1\\n  type: roundrobin\\nuri: /ext-plugin\\n---\\nplugins:\\n  fault-injection:\\n    abort:\\n      body: hello world\\n      http_status: 200\\nupstream:\\n  nodes:\\n    127.0.0.1:1980: 1\\n  type: roundrobin\\nuri: /fault-injection\\n```\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u5b9e\u9645\u538b\u6d4b\\n\\n\u63a5\u4e0b\u6765\u8bd5\u7740\u7528 wrk \u8fdb\u884c\u538b\u6d4b\uff0c\u5177\u4f53\u6570\u636e\u5bf9\u6bd4\u5982\u4e0b\uff1a\\n\\n<table>\\n    <tr>\\n        <td colspan=\\"3\\">\uffe5 wrk -d 30 -t 5 -c 50 http://127.0.0.1:9080/wasm | Running 30s test @ http://127.0.0.1:9080/wasm | 5 threads and 50 connections</td>\\n    </tr>\\n    <tr>\\n        <td><b>Thread Stats</b></td>\\n        <td><b>Latency</b></td>\\n        <td><b>Req/Sec</b></td>\\n    </tr>\\n    <tr>\\n        <td><b>Avg</b></td>\\n        <td>66.17ms</td>\\n        <td>7.01k</td>\\n    </tr>\\n    <tr>\\n        <td><b>Sdev</b></td>\\n        <td>226.42ms</td>\\n        <td>3.09k</td>\\n    </tr>\\n    <tr>\\n        <td><b>Max</b></td>\\n        <td>1.99s</td>\\n        <td>33.97k</td>\\n    </tr>\\n    <tr>\\n        <td><b>+/- Stdev</b></td>\\n        <td>91.89%</td>\\n        <td>82.28%</td>\\n    </tr>\\n    <tr>\\n        <td><b>Request details</b></td>\\n        <td colspan=\\"2\\">650497 requests in 36.33s, 119.70MB read</td>\\n    </tr>\\n    <tr>\\n        <td><b>Socket errors</b></td>\\n        <td colspan=\\"2\\">connect 0, read 0, write 0, timeout 63</td>\\n    </tr>\\n    <tr>\\n        <td><b>Request/sec</b></td>\\n        <td colspan=\\"2\\">17903.17</td>\\n    </tr>\\n    <tr>\\n        <td><b>Transfer/sec</b></td>\\n        <td colspan=\\"2\\">3.29MB</td>\\n    </tr>\\n</table>\\n\\n<table>\\n    <tr>\\n        <td colspan=\\"3\\">\uffe5 wrk -d 30 -t 5 -c 50 http://127.0.0.1:9080/ext-plugin | Running 30s test @ http://127.0.0.1:9080/ext-plugin | 5 threads and 50 connections</td>\\n    </tr>\\n    <tr>\\n        <td><b>Thread Stats</b></td>\\n        <td><b>Latency</b></td>\\n        <td><b>Req/Sec</b></td>\\n    </tr>\\n    <tr>\\n        <td><b>Avg</b></td>\\n        <td>95.69ms</td>\\n        <td>3.23k</td>\\n    </tr>\\n    <tr>\\n        <td><b>Sdev</b></td>\\n        <td>229.09ms</td>\\n        <td>1.47k</td>\\n    </tr>\\n    <tr>\\n        <td><b>Max</b></td>\\n        <td>1.70s</td>\\n        <td>15.18k</td>\\n    </tr>\\n    <tr>\\n        <td><b>+/- Stdev</b></td>\\n        <td>87.37%</td>\\n        <td>83.89%</td>\\n    </tr>\\n    <tr>\\n        <td><b>Request details</b></td>\\n        <td colspan=\\"2\\">362151 requests in 30.50s, 66.64MB read</td>\\n    </tr>\\n    <tr>\\n        <td><b>Socket errors</b></td>\\n        <td colspan=\\"2\\">connect 0, read 0, write 0, timeout 17</td>\\n    </tr>\\n    <tr>\\n        <td><b>Request/sec</b></td>\\n        <td colspan=\\"2\\">11873.12</td>\\n    </tr>\\n    <tr>\\n        <td><b>Transfer/sec</b></td>\\n        <td colspan=\\"2\\">2.18MB</td>\\n    </tr>\\n</table>\\n\\n<table>\\n    <tr>\\n        <td colspan=\\"3\\">\uffe5 wrk -d 30 -t 5 -c 50 http://127.0.0.1:9080/fault-injection | Running 30s test @ http://127.0.0.1:9080/fault-injection | 5 threads and 50 connections</td>\\n    </tr>\\n    <tr>\\n        <td><b>Thread Stats</b></td>\\n        <td><b>Latency</b></td>\\n        <td><b>Req/Sec</b></td>\\n    </tr>\\n    <tr>\\n        <td><b>Avg</b></td>\\n        <td>86.91ms</td>\\n        <td>7.90k</td>\\n    </tr>\\n    <tr>\\n        <td><b>Sdev</b></td>\\n        <td>263.14ms</td>\\n        <td>2.04k</td>\\n    </tr>\\n    <tr>\\n        <td><b>Max</b></td>\\n        <td>1.91s</td>\\n        <td>15.60k</td>\\n    </tr>\\n    <tr>\\n        <td><b>+/- Stdev</b></td>\\n        <td>90.73%</td>\\n        <td>81.97%</td>\\n    </tr>\\n    <tr>\\n        <td><b>Request details</b></td>\\n        <td colspan=\\"2\\">974326 requests in 30.07s, 179.29MB read</td>\\n    </tr>\\n    <tr>\\n        <td><b>Socket errors</b></td>\\n        <td colspan=\\"2\\">connect 0, read 0, write 0, timeout 8</td>\\n    </tr>\\n    <tr>\\n        <td><b>Request/sec</b></td>\\n        <td colspan=\\"2\\">32405.28</td>\\n    </tr>\\n    <tr>\\n        <td><b>Transfer/sec</b></td>\\n        <td colspan=\\"2\\">5.96MB</td>\\n    </tr>\\n</table>\\n\\n\u4ece\u4e0a\u8ff0\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0cWASM \u7248\u672c\u7684\u6027\u80fd\u4ecb\u4e8e\u5916\u90e8\u63d2\u4ef6\u548c\u539f\u751f Lua \u4e4b\u95f4\u3002\\n\\nWASM \u7248\u672c\u7684\u6027\u80fd\u4e4b\u6240\u4ee5\u6bd4\u5916\u90e8\u63d2\u4ef6\u597d\u90a3\u4e48\u591a\uff0c\u662f\u56e0\u4e3a fault-injection \u529f\u80fd\u7b80\u5355\uff0c\u6240\u4ee5\u5916\u90e8\u63d2\u4ef6 RPC \u5e26\u6765\u7684\u6027\u80fd\u635f\u8017\u8fc7\u4e8e\u660e\u663e\u3002\u8003\u8651\u5230\u6211\u4eec\u8fd8\u6ca1\u6709\u5bf9 WASM \u5b9e\u73b0\u505a\u4efb\u4f55\u4f18\u5316\uff0c\u8fd9\u79cd\u60c5\u51b5\u5df2\u7ecf\u8ba9\u6211\u4eec\u611f\u5230\u6ee1\u610f\u4e86\u3002\\n\\n\u800c WASM \u7684\u53e6\u4e00\u4e2a\u597d\u5904\uff0c\u5c31\u662f\u8ba9\u6211\u4eec\u4e00\u4e0b\u5b50\u62e5\u6709\u591a\u8bed\u8a00\u7684\u652f\u6301\uff08\u8fd9\u4e5f\u6258\u4e86 Proxy WASM SDK \u7684\u798f\uff09\u3002\u5177\u4f53\u7ec6\u8282\u53ef\u53c2\u8003\u4e0b\u65b9\u6587\u6863\uff1a\\n\\n- [Rust \u7248\u672c fault-injection](https://gist.github.com/spacewander/0357198ea21e022003c407fd23155f79)\\n- [AssemblyScript \u7248\u672c fault-injection](https://gist.github.com/spacewander/64773a706f1dc758aecc7f28aff7555d)\\n\\n## \u9053\u8def\u66f2\u6298\uff0c\u4f46\u524d\u9014\u5149\u660e\\n\\n\u8bf4\u4e86\u8fd9\u4e48\u591a WASM \u7684\u597d\u5904\uff0c\u662f\u4e0d\u662f\u6709\u70b9\u5fc3\u52a8\u5462\uff1f\u4f46\u5b83\u76ee\u524d\u5e76\u975e\u662f\u4e00\u4e2a\u5b8c\u7f8e\u7684\u89e3\u51b3\u65b9\u6848\uff0c WASM/Proxy WASM \u8fd8\u662f\u6709\u4e00\u4e9b\u4e0d\u591f\u6210\u719f\u7684\u5730\u65b9\u3002\u6bd4\u5982\uff1a\\n\\n- **\u7f16\u7a0b\u8bed\u8a00\u652f\u6301\u5f85\u5b8c\u5584**\uff1a\u539f\u751f Go \u7684 WASM \u652f\u6301\uff0c\u4e3b\u8981\u662f\u57fa\u4e8e\u6d4f\u89c8\u5668\u73af\u5883\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u5f97\u4e0d\u7528 tinygo \u6765\u5b9e\u73b0\u3002\u4f46\u662f tinygo \u4f5c\u4e3a\u4e00\u4e2a\u5e74\u8f7b\u7684\u9879\u76ee\uff0c\u8fd8\u662f\u6709\u4e0d\u5c11\u5c40\u9650\u6027\u3002\\n- **Proxy WASM \u751f\u6001\u6709\u5f85\u6210\u719f**\uff1aAssemblyScript \u7248\u672c\u7684 fault injection \u5b9e\u73b0\uff0c\u5e76\u6ca1\u6709 JSON decode \u7684\u90e8\u5206\u3002\u8fd9\u662f\u56e0\u4e3a AssemblyScript SDK \u662f\u57fa\u4e8e AssemblyScript 0.14.x \u7248\u672c\u5b9e\u73b0\u7684\uff0c\u800c\u51e0\u4e2a\u5f00\u6e90\u7684 AssemblyScript JSON \u5e93\u90fd\u662f\u9488\u5bf9\u9ad8\u7248\u672c AssemblyScript \u5b9e\u73b0\u7684\uff0c\u6ca1\u529e\u6cd5\u7528\u5728\u8f83\u4e3a\u9648\u65e7\u7684 AssemblyScript 0.14 \u4e0a\u3002\\n- **WASM \u6ca1\u6709\u5185\u7f6e\u534f\u7a0b**\uff1aWASM \u76ee\u524d\u5c1a\u672a\u5185\u7f6e\u534f\u7a0b\uff0c\u6240\u4ee5\u6ca1\u529e\u6cd5\u5f88\u597d\u5730\u88ab\u5bbf\u4e3b\u7684\u8c03\u5ea6\u7cfb\u7edf\u7ed9\u8c03\u5ea6\u8d77\u6765\u3002\\n\\n\u867d\u7136\u4e0a\u9762\u5217\u4e3e\u4e86\u51e0\u70b9\u4e0d\u8db3\u4e4b\u5904\uff0c\u4f46\u662f\u6211\u4eec\u76f8\u4fe1\u8fd9\u4e2a\u6280\u672f\u6808\u7684\u524d\u666f\u662f\u5149\u660e\u7684\uff1a\\n\\n1. \u5305\u62ec Apache APISIX \u548c Envoy \u7b49\u5f00\u6e90\u9879\u76ee\u5bf9\u4e8e WASM \u90fd\u5f88\u770b\u91cd\uff0c\u6709\u8bb8\u591a\u521d\u521b\u516c\u53f8\u548c\u5927\u4f01\u4e1a\u4e3a WASM \u751f\u6001\u6dfb\u7816\u52a0\u74e6\uff0c\u8fd9\u610f\u5473\u7740\u8bf8\u5982 AssemblyScript SDK \u505c\u6ede\u4e0d\u524d\u8fd9\u6837\u7684\u56f0\u96be\uff0c\u53ea\u4f1a\u662f\u6682\u65f6\u3002\u957f\u4e45\u770b\uff0cProxy WASM \u7684\u751f\u6001\u4f1a\u679d\u7e41\u53f6\u8302\u3002\\n2. WASM \u4f5c\u4e3a serverless \u548c edge computing \u7684\u5ba0\u513f\uff0c\u6709\u7740\u5149\u660e\u7684\u672a\u6765\u3002\u5728\u4f17\u591a\u5b9e\u9645\u573a\u666f\u7684\u843d\u5730\u548c\u4f18\u5316\uff0c\u4f1a\u66f4\u5feb\u7684\u89e3\u51b3\u6280\u672f\u4e0a\u7684\u4e0d\u8db3\u3002\\n\\n## \u5199\u5728\u6700\u540e\\n\\nApache APISIX \u662f\u4e2a\u7d27\u8ddf\u6280\u672f\u6f6e\u6d41\u7684\u9879\u76ee\uff0c\u201c\u597d\u98ce\u51ed\u501f\u529b\uff0c\u9001\u6211\u4e0a\u9752\u5929\u201d\uff0cApache APISIX \u652f\u6301 WASM \u662f\u4e2a\u957f\u671f\u7684\u8fc7\u7a0b\u3002\\n\\n\u201c\u5343\u91cc\u4e4b\u884c\uff0c\u59cb\u4e8e\u8db3\u4e0b\u201d\uff0cApache APISIX \u4e3a\u4e86\u652f\u6301 WASM\uff0c\u5df2\u7ecf\u53d1\u8d77\u4e86 [wasm-nginx-module](https://github.com/api7/wasm-nginx-module) \u8fd9\u4e2a\u5f00\u6e90\u9879\u76ee\u3002\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u5173\u6ce8\u8be5\u9879\u76ee\u7684\u8fdb\u5c55\uff0c\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\uff0c\u671f\u5f85\u4f60\u7684\u52a0\u5165\uff0c\u4e00\u8d77\u521b\u9020\u4e16\u754c\u9876\u7ea7\u9879\u76ee\u3002"},{"id":"\u5982\u4f55\u4e0e Dapr \u96c6\u6210\u6253\u9020 Apache APISIX \u7f51\u5173\u63a7\u5236\u5668","metadata":{"permalink":"/zh/blog/2021/11/17/dapr-with-apisix","source":"@site/blog/2021/11/17/dapr-with-apisix.md","title":"\u5982\u4f55\u4e0e Dapr \u96c6\u6210\u6253\u9020 Apache APISIX \u7f51\u5173\u63a7\u5236\u5668","description":"\u672c\u6587\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86 Dapr \u548c Apache APISIX Ingress Controller \u7684\u76f8\u5173\u6982\u5ff5\uff0c\u5e76\u5c55\u793a\u4e86\u96c6\u6210 Dapr \u521b\u5efa\u4e00\u4e2a Apache APISIX \u63a7\u5236\u5668\u7684\u5177\u4f53\u6b65\u9aa4\u53ca\u6d4b\u8bd5\u793a\u4f8b\u9879\u76ee\u3002","date":"2021-11-17T00:00:00.000Z","formattedDate":"2021\u5e7411\u670817\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.145,"truncated":true,"authors":[{"name":"\u5f20\u5584\u53cb","url":"https://github.com/geffzhang","imageURL":"https://avatars.githubusercontent.com/u/439390?v=4"}],"prevItem":{"title":"\u91cd\u78c5\u529f\u80fd\uff01Apache APISIX \u62e5\u62b1 WASM \u751f\u6001","permalink":"/zh/blog/2021/11/19/apisix-supports-wasm"},"nextItem":{"title":"\u793e\u533a\u5468\u62a5\uff0811.1-11.14\uff09","permalink":"/zh/blog/2021/11/16/weekly-report-1114"}},"content":"> \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u5c55\u793a\u5982\u4f55\u901a\u8fc7\u96c6\u6210 Dapr \u521b\u5efa\u4e00\u4e2a Apache APISIX \u63a7\u5236\u5668\u3002\u5305\u62ec\u9879\u76ee\u6982\u5ff5\u4ee5\u53ca\u5177\u4f53\u64cd\u4f5c\u6b65\u9aa4\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n<head>\\n    <link rel=\\"canonical\\" href=\\"https://blog.dapr.io/posts/2022/01/13/enable-dapr-with-apache-apisix-ingress-controller/\\" />\\n</head>\\n\\n\u672c\u8d28\u4e0a\uff0cApache APISIX \u63a7\u5236\u5668\u5c06\u914d\u7f6e\u76f8\u540c\u6807\u51c6 Dapr annotations \u4ee5\u6ce8\u5165 daprd sidecar\u3002\u901a\u8fc7\u516c\u5f00\u8fd9\u4e2a sidecar\uff0c\u5c06\u5141\u8bb8\u5916\u90e8\u5e94\u7528\u7a0b\u5e8f\u4e0e\u96c6\u7fa4\u4e2d\u542f\u7528 Dapr \u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u901a\u4fe1\u3002\\n\\n\u4e0b\u56fe\u4e3a\u5b9e\u9645\u9879\u76ee\u4e2d\u7684\u67b6\u6784\u6d41\u7a0b\uff1a\\n\\n![\u603b\u4f53\u67b6\u6784\u6d41\u7a0b](https://static.apiseven.com/202108/1637119221118-75dab9f1-4092-4684-ad23-34932d8a7eac.png)\\n\\n## \u57fa\u672c\u9879\u76ee\u6982\u89c8\\n\\n### Apache APISIX Ingress\\n\\n\u5728 K8s \u751f\u6001\u4e2d\uff0cIngress \u4f5c\u4e3a\u8868\u793a K8s \u6d41\u91cf\u5165\u53e3\u7684\u4e00\u79cd\u8d44\u6e90\uff0c\u60f3\u8981\u8ba9\u5176\u751f\u6548\uff0c\u5c31\u9700\u8981\u6709\u4e00\u4e2a Ingress Controller \u53bb\u76d1\u542c K8s \u4e2d\u7684 Ingress \u8d44\u6e90\uff0c\u5e76\u5bf9\u8fd9\u4e9b\u8d44\u6e90\u8fdb\u884c\u76f8\u5e94\u89c4\u5219\u7684\u89e3\u6790\u548c\u5b9e\u9645\u627f\u8f7d\u6d41\u91cf\u3002\u5728\u5f53\u4e0b\u8d8b\u52bf\u4e2d\uff0c\u50cf Kubernetes Ingress Nginx \u5c31\u662f\u4f7f\u7528\u6700\u5e7f\u6cdb\u7684 Ingress Controller \u5b9e\u73b0\u3002\\n\\n\u800c APISIX Ingress \u5219\u662f\u53e6\u4e00\u79cd Ingress Controller \u7684\u5b9e\u73b0\u3002\u8ddf Kubernetes Ingress Nginx \u7684\u533a\u522b\u4e3b\u8981\u5728\u4e8e APISIX Ingress \u662f\u4ee5 Apache APISIX \u4f5c\u4e3a\u5b9e\u9645\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u7684\u6570\u636e\u9762\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5f53\u7528\u6237\u8bf7\u6c42\u5230\u5177\u4f53\u7684\u67d0\u4e00\u4e2a\u670d\u52a1/API/\u7f51\u9875\u65f6\uff0c\u901a\u8fc7\u5916\u90e8\u4ee3\u7406\u5c06\u6574\u4e2a\u4e1a\u52a1\u6d41\u91cf/\u7528\u6237\u8bf7\u6c42\u4f20\u8f93\u5230 K8s \u96c6\u7fa4\uff0c\u7136\u540e\u7ecf\u8fc7 APISIX Ingress \u8fdb\u884c\u540e\u7eed\u5904\u7406\u3002\\n\\n![APISIX Ingress](https://static.apiseven.com/2022/09/30/6336a25db849f.png)\\n\\n\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0cAPISIX Ingress \u5206\u6210\u4e86\u4e24\u90e8\u5206\u3002\u4e00\u90e8\u5206\u662f APISIX Ingress Controller\uff0c\u4f5c\u4e3a\u63a7\u5236\u9762\u5b83\u5c06\u5b8c\u6210\u914d\u7f6e\u7ba1\u7406\u4e0e\u5206\u53d1\u3002\u53e6\u4e00\u90e8\u5206 APISIX Proxy Pod \u8d1f\u8d23\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\uff0c\u5b83\u662f\u901a\u8fc7 CRD(Custom Resource Definitions) \u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\u3002Apache APISIX Ingress \u9664\u4e86\u652f\u6301\u81ea\u5b9a\u4e49\u8d44\u6e90\u5916\uff0c\u8fd8\u652f\u6301\u539f\u751f\u7684 K8s Ingress \u8d44\u6e90\u3002\\n\\n\u70b9\u51fb\u67e5\u770b[\u66f4\u591a\u8be6\u60c5](https://www.apiseven.com/zh/blog/apisix-ingress-details)\u3002\\n\\n### Dapr\\n\\nDapr \u662f\u4e00\u4e2a\u53ef\u79fb\u690d\u3001\u4e8b\u4ef6\u9a71\u52a8\u7684\u8fd0\u884c\u65f6\u3002\u5b83\u4f7f\u5f00\u53d1\u4eba\u5458\u7b80\u5355\u5730\u53bb\u6784\u5efa\u8fd0\u884c\u5728\u4e91\u548c edge \u4e0a\u5f39\u6027\u3001\u65e0\u72b6\u6001\u548c\u6709\u72b6\u6001\u7684\u5e94\u7528\uff0c\u5e76\u4e14\u5305\u542b\u591a\u79cd\u8bed\u8a00\u548c\u5f00\u53d1\u4eba\u5458\u6846\u67b6\u3002\\n\\n![Dapr \u751f\u6001\u56fe](https://static.apiseven.com/202108/1637119221120-15a5be20-17a2-4c18-a82e-91e1ff3709f0.png)\\n\\n\u4eca\u5929\uff0c\u6211\u4eec\u6b63\u7ecf\u5386\u4e00\u6ce2\u4e91\u5e94\u7528\u6d6a\u6f6e\u3002\u5f00\u53d1\u4eba\u5458\u719f\u6089 web+ \u6570\u636e\u5e93\u5e94\u7528\u7a0b\u5e8f\u67b6\u6784(\u4f8b\u5982\u7ecf\u5178\u76843\u5c42\u8bbe\u8ba1)\uff0c\u4f46\u4e0d\u719f\u6089\u672c\u8d28\u4e0a\u662f\u5206\u5e03\u5f0f\u7684\u5fae\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u67b6\u6784\u3002\u5f00\u53d1\u4eba\u5458\u5e0c\u671b\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\uff0c\u540c\u65f6\u4f9d\u9760\u5e73\u53f0\u4e3a\u4ed6\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u6ce8\u5165\u4f38\u7f29\u6027\u3001\u5f39\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u3001\u5f39\u6027\u548c\u5176\u4ed6\u672c\u5730\u4e91\u67b6\u6784\u7684\u5c5e\u6027\u3002\\n\\n\u8fd9\u5c31\u662f Dapr \u7684\u7528\u6b66\u4e4b\u5730\u3002\\n\\nDapr \u53ef\u4ee5\u5c06\u6784\u5efa\u5fae\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u7684\u6700\u4f73\u5b9e\u8df5\u7f16\u5165\u5f00\u653e\u3001\u72ec\u7acb\u7684\u6784\u5efa\u5757\u4e2d\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u4f7f\u7528\u81ea\u5df1\u9009\u62e9\u7684\u8bed\u8a00\u548c\u6846\u67b6\u6784\u5efa\u53ef\u79fb\u690d\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u6bcf\u4e2a\u6784\u5efa\u5757\u90fd\u662f\u5b8c\u5168\u72ec\u7acb\uff0c\u5e76\u53ef\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u5176\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u3002\\n\\n\u6b64\u5916\uff0cDapr \u4e0e\u5e73\u53f0\u65e0\u5173\uff0c\u8fd9\u610f\u5473\u7740\u7528\u6237\u53ef\u4ee5\u5728\u4efb\u4f55 Kubernetes \u96c6\u7fa4\u548c\u5176\u4ed6\u4e0e Dapr \u96c6\u6210\u7684\u6258\u7ba1\u73af\u5883\u672c\u5730\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u3002\\n\\n\u70b9\u51fb\u67e5\u770b[\u66f4\u591a\u8be6\u60c5](https://docs.dapr.io/zh-hans/concepts/overview/)\u3002\\n\\n## \u5b9e\u8df5\u5f00\u59cb\\n\\n### \u73af\u5883\u51c6\u5907\\n\\n- Kubernetes 1.19+ \u96c6\u7fa4\uff0c\u96c6\u7fa4\u4e0a\u5df2\u7ecf\u914d\u7f6e\u4e86 Dapr\\n- \u5b89\u88c5\u4e86 Helm CLI 3x\\n- Kubectl CLI \u5df2\u5b89\u88c5\u5e76\u914d\u7f6e\u4e3a\u8bbf\u95ee\u96c6\u7fa4\\n- \u53ef\u9009\uff1a\u7528\u4e8e\u521b\u5efa\u81ea\u7b7e\u540d\u8bc1\u4e66\u7684 OpenSSL\\n- Apache APISIX \u7684 Helm Chart \u7248\u672c\u4e3a 0.7.2+\\n\\n### \u6b65\u9aa4\u4e00\uff1aApache APISIX Helm \u914d\u7f6e\\n\\n\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e3a Apache APISIX \u63a7\u5236\u5668\u6dfb\u52a0\u6700\u65b0\u7684 helm chart repo\uff1a\\n\\n```shell\\nhelm repo add apisix https://charts.apiseven.com\\nhelm repo update\\n```\\n\\n### \u6b65\u9aa4\u4e8c\uff1a\u521b\u5efa Apache APISIX Ingerss \u547d\u540d\u7a7a\u95f4\\n\\n\u786e\u4fdd\u5f53\u524d kubectl \u4e0a\u4e0b\u6587\u6307\u5411\u6b63\u786e\u7684 Kubernetes \u96c6\u7fa4\uff0c\u7136\u540e\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\\n\\n```shell\\nkubectl create namespace ingress-apisix\\n```\\n\\n### \u6b65\u9aa4\u4e09\uff1a\u5b89\u88c5\u652f\u6301 Dapr \u7684 APISIX \u63a7\u5236\u5668\\n\\n\u4f7f\u7528\u4ee5\u4e0b\u5185\u5bb9\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a dapr-annotations.yaml \u7684\u6587\u4ef6\uff0c\u4ee5\u5728 Apache APISIX Proxy Pod \u4e0a\u8bbe\u7f6e\u6ce8\u91ca\u3002\\n\\n```yaml\\napisix:\\n  podAnnotations:\\n    dapr.io/enabled: \\"true\\"\\n    dapr.io/app-id: \\" apisix-gateway\\"\\ndapr.io/app-port: \\"9080\\"\\ndapr.io/enable-metrics: \\"true\\"\\ndapr.io/metrics-port: \\"9099\\"\\ndapr.io/sidecar-listen-addresses: 0.0.0.0\\ndapr.io/config: ingress-apisix-config\\n```\\n\\n> \u6ce8\u610f\uff1a\u4e0a\u9762\u7684 app-port \u662f\u544a\u8bc9 daprd sidecar Proxy \u5728\u76d1\u542c\u54ea\u4e2a\u7aef\u53e3\u3002\u6709\u5173\u53d7\u652f\u6301\u7684\u6ce8\u91ca\u5b8c\u6574\u5217\u8868\uff0c\u53ef\u53c2\u8003 [Dapr Kubernetes pod \u6ce8\u91ca\u89c4\u8303](https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-annotations/)\u3002\\n\\n\u4e0b\u9762\u4ee5\u6211\u4e2a\u4eba\u5728 AKS \u4e0a\u5b89\u88c5\u7684\u793a\u4f8b dapr-annotations.yaml \u8fdb\u884c\u5c55\u793a\u3002\\n\\n```yaml\\n apisix:\\n  podAnnotations:\\n    dapr.io/app-id: apisix-gateway\\n    dapr.io/app-port: \'9080\'\\n    dapr.io/enable-metrics: \'true\'\\n    dapr.io/enabled: \'true\'\\n    dapr.io/metrics-port: \'9099\'\\ndapr.io/sidecar-listen-addresses: 0.0.0.0\\ndapr.io/config: ingress-apisix-config\\n\\ngateway:\\n  type: LoadBalancer\\n\\ningress-controller:\\n  enabled: true\\n\\ndashboard:\\n  enabled: true\\n```\\n\\n\u63a5\u4e0b\u6765\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u5f15\u7528\u4e0a\u8ff0\u6587\u4ef6\uff09\uff1a\\n\\n```shell\\nhelm install apisix apisix/apisix -f dapr-annotations.yaml -n ingress-apisix\\n```\\n\\n\u5c06\u542f\u52a8\u7684 APISIX Dashboard Pod \u5411\u5916\u66b4\u9732\uff0c\u4fbf\u4e8e\u540e\u7eed\u4f7f\u7528\uff1a\\n\\n```shell\\n# \u53ef\u4ee5\u901a\u8fc7 kubectl get pods -n ingress-apisix \u83b7\u53d6 dashboard-pod-name\\nkubectl port-forward ${dashboard-pod-name} 9000:9000\\n```\\n\\n### \u6b65\u9aa4\u56db\uff1a\u521b\u5efa Apache APISIX \u7684 Dapr Sidecar \u8d44\u6e90\\n\\n\u9996\u5148\uff0c\u901a\u8fc7 `http://localhost:9000` \u8bbf\u95ee APISIX Dashboard \u914d\u7f6e Apache APISIX upstream-apisix-dapr\u3002\\n\\n![\u914d\u7f6e\u4e0a\u6e38\u4e1a\u52a1](https://static.apiseven.com/202108/1637119221106-e57ae8b8-38ed-46ea-b219-401619fadbe3.png)\\n\\n\u5728\u8fd9\u91cc\u4e3b\u673a\u540d\u586b\u5199\uff1aapisix-gateway-dapr\uff0c\u7aef\u53e3\u53f7\u586b\u5199 3500\u3002\\n\\n```json\\n{\\n  \\"nodes\\": [\\n    {\\n      \\"host\\": \\"apisix-gateway-dapr\\",\\n      \\"port\\": 3500,\\n      \\"weight\\": 1\\n    }\\n  ],\\n  \\"retries\\": 1,\\n  \\"timeout\\": {\\n    \\"connect\\": 6,\\n    \\"read\\": 6,\\n    \\"send\\": 6\\n  },\\n  \\"type\\": \\"roundrobin\\",\\n  \\"scheme\\": \\"http\\",\\n  \\"pass_host\\": \\"pass\\",\\n  \\"name\\": \\"apisix-dapr\\"\\n}\\n```\\n\\n\u7136\u540e\u914d\u7f6e Apache APISIX \u670d\u52a1 apisix-gateway-dapr\uff0c\u4e0a\u6e38\u670d\u52a1\u9009\u62e9 apisix-dapr\u3002\\n\\n![\u914d\u7f6e\u670d\u52a1](https://static.apiseven.com/202108/1637119221115-ae7c847a-99a3-4ee6-b36f-4269fd067198.png)\\n\\n```json\\n{\\n  \\"name\\": \\"apisix-gateway-dapr\\",\\n  \\"upstream_id\\": \\"376187148778341098\\"\\n}\\n```\\n\\n### \u6b65\u9aa4\u4e94\uff1a\u90e8\u7f72\u6d4b\u8bd5\u793a\u4f8b\u9879\u76ee\\n\\n[HTTPBin](https://httpbin.org/) \u662f\u4ee5 Python+Flask \u5199\u7684\u4e00\u6b3e\u5de5\u5177\uff0c\u8fd9\u6b3e\u5de5\u5177\u6db5\u76d6\u4e86\u5404\u7c7b HTTP \u573a\u666f\uff0c\u4e14\u6bcf\u4e2a\u63a5\u53e3\u90fd\u6709\u8fd4\u56de\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f7f\u7528 kennethreitz/httpbin \u4f5c\u4e3a\u793a\u4f8b\u9879\u76ee\u8fdb\u884c\u6f14\u793a\u3002\\n\\n```shell\\nkubectl apply -f 01.namespace.yaml\\nkubectl apply -f 02.deployment.yaml\\nkubectl apply -f 03.svc.yaml\\n```\\n\\n![\u9879\u76ee\u914d\u7f6e](https://static.apiseven.com/202108/1637119221110-9b901451-6ca6-4d15-b591-69f7c5d57ce1.png)\\n\\n\u4e0a\u56fe\u4e3a\u5047\u8bbe\u6709\u4e00\u4e2a\u4f7f\u7528 Dapr app-id kennethreitz-httpbin \u8fd0\u884c\u7684\u5fae\u670d\u52a1\u3002\\n\\n#### \u8def\u5f84\u5339\u914d\u6539\u5199\\n\\n\u8fd9\u91cc\u8865\u5145\u4e00\u4e0b\u5173\u4e8e\u8def\u5f84\u5339\u914d\u7684\u76f8\u5173\u8bbe\u7f6e\u3002\u6bd4\u5982\u8bf7\u6c42\u7f51\u5173\u662f /httpbin/*\uff0c\u540e\u7aef\u63a5\u6536\u8def\u5f84\u5e94\u8be5\u662f /*\uff0c\u4e2d\u95f4\u7684 httpbin \u53ea\u5145\u5f53\u670d\u52a1\u540d\u7684\u6807\u8bc6\u3002\\n\\n![\u586b\u5199\u91ca\u4e49](https://static.apiseven.com/202108/1637119221114-90c1ef58-6743-419c-be87-9cdc8503aa30.png)\\n\\n\u5728\u652f\u6301\u547d\u540d\u7a7a\u95f4\u7684\u6258\u7ba1\u5e73\u53f0\u4e0a\uff0cDapr \u5e94\u7528 ID \u662f\u7b26\u5408\u6709\u6548\u7684 FQDN \u683c\u5f0f\uff0c\u5176\u4e2d\u5305\u62ec\u76ee\u6807\u540d\u79f0\u7a7a\u95f4\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u5b57\u7b26\u4e32\u5305\u542b\u5e94\u7528 ID\uff08svc-kennethreitz-httpbin\uff09\u4ee5\u53ca\u5e94\u7528\u8fd0\u884c\u5728\u547d\u540d\u7a7a\u95f4\uff08kind-test\uff09\u3002\\n\\n\u6700\u540e\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\uff1ahttp://20.195.90.43/httpbin/get \u6765\u67e5\u770b\u4ee3\u7406\u662f\u5426\u6210\u529f\u3002\\n\\n![\u68c0\u67e5\u662f\u5426\u4ee3\u7406\u6210\u529f](https://static.apiseven.com/202108/1637119221100-13997340-dfb6-45fb-abba-4215e0318238.png)\\n\\n## \u989d\u5916\u8865\u5145\u8bf4\u660e\\n\\n\u5f53\u7136\uff0c\u5728\u8fdb\u884c\u90e8\u7f72\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5728 Kubernetes \u4e2d\u4f7f\u7528 Apache APISIX \u5b98\u65b9 Helm \u4ed3\u5e93\u76f4\u63a5\u90e8\u7f72 Apache APISIX \u548c APISIX Ingress Controller\u3002\u8fd9\u6837\u53ef\u4ee5\u76f4\u63a5\u5c06 Apache APISIX \u4f5c\u4e3a\u7f51\u5173\uff0c\u8fdb\u884c APISIX Ingress Controller \u7684\u6570\u636e\u9762\u6765\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u3002\\n\\n\u6700\u540e\u5c06 Dapr \u901a\u8fc7 Sidecar annotations \u6ce8\u5165\u5230 Apache APISIX Proxy Pod\uff0c\u901a\u8fc7\u670d\u52a1\u8c03\u7528\u6a21\u5757\u6765\u8c03\u7528\u96c6\u7fa4\u4e2d\u7684\u5fae\u670d\u52a1\uff0c\u5b9e\u73b0\u5b8c\u6574\u6d41\u7a0b\u90e8\u7f72\u3002\\n\\n### \u5220\u9664 Apache APISIX \u63a7\u5236\u5668\\n\\n\u5982\u9879\u76ee\u7ed3\u675f\uff0c\u60f3\u8981\u5220\u9664 Apache APISIX \u63a7\u5236\u5668\uff0c\u53ef\u6309\u4e0b\u65b9\u547d\u4ee4\u64cd\u4f5c\uff08\u8bb0\u5f97\u4e0d\u8981\u5fd8\u8bb0\u5220\u9664\u4e4b\u524d\u521b\u5efa\u7684\u547d\u540d\u7a7a\u95f4 ingress-apisix\uff09\u3002\\n\\n```shell\\nhelm delete apisix -n ingress-apisix\\n```"},{"id":"\u793e\u533a\u5468\u62a5\uff0811.1-11.14\uff09","metadata":{"permalink":"/zh/blog/2021/11/16/weekly-report-1114","source":"@site/blog/2021/11/16/weekly-report-1114.md","title":"\u793e\u533a\u5468\u62a5\uff0811.1-11.14\uff09","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fd1\u4e24\u5468\u65b0\u589e\u652f\u6301\u5728 Arch Linux \u4e0a\u5b89\u88c5 APISIX\uff0climit-conn \u548c limit-count \u63d2\u4ef6\u652f\u6301\u53d8\u91cf\u4f5c\u4e3a\u9650\u6d41 key \u4ee5\u53ca datadog \u63d2\u4ef6\u7b49\u529f\u80fd\u3002","date":"2021-11-16T00:00:00.000Z","formattedDate":"2021\u5e7411\u670816\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.39,"truncated":true,"authors":[],"prevItem":{"title":"\u5982\u4f55\u4e0e Dapr \u96c6\u6210\u6253\u9020 Apache APISIX \u7f51\u5173\u63a7\u5236\u5668","permalink":"/zh/blog/2021/11/17/dapr-with-apisix"},"nextItem":{"title":"API \u7f51\u5173 Datadog \u63d2\u4ef6\u53d1\u5e03\uff0c\u52a9\u529b\u63d0\u9ad8\u7cfb\u7edf\u53ef\u89c2\u6d4b\u6027","permalink":"/zh/blog/2021/11/12/apisix-datadog"}},"content":"> \u4ece 11.1 \u5230 11.14, \u6709 28 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 114 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1636942852485-0effd8be-552e-4871-ba3e-356772016a18.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1636940503842-fc52a349-443e-4f4b-9787-f743299870f3.png)\\n\\n## Good first issue\\n\\n### Issue #5400\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5400\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4e03\u5c42\u7684 HTTP \u65e5\u5fd7\u662f\u5b58\u50a8\u5728 acccess.log \u4e2d\u7684\uff0c\u90a3\u4e48\u56db\u5c42\u4ee3\u7406 stream route \u5982\u4f55\u542f\u7528\u65e5\u5fd7\u5e76\u81ea\u5b9a\u4e49\u65e5\u5fd7\u8def\u5f84\u5462\uff1f\u4f20\u7edf\u7684 OpenResty \u662f\u53ef\u4ee5\u5b9e\u73b0\u7684\u3002\\n\\n### Issue #5417\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5417\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u76ee\u524d\uff0c\u5982\u679c\u7528\u6237\u6ca1\u6709\u6307\u5b9a\u4e00\u4e2a ID\uff0cApache APISIX \u4f1a\u5728\u521d\u59cb\u5316\u65f6\u751f\u6210\u4e00\u4e2a ID\uff0c\u5b83\u4f9d\u8d56\u4e8e [lua-resty-jit-uuid](https://github.com/thibaultcha/lua-resty-jit-uuid) \u5e93\uff0c\u4f46\u6ca1\u6709\u4e00\u4e2a\u660e\u786e\u7684 seed\u3002[\u5982\u4e0b](https://github.com/apache/apisix/blob/4dafab5afa3293b3d72007517246e01da385f8ef/apisix/core/id.lua#L76-L78)\uff1a\\n\\n```Lua\\nuuid.seed()\\n apisix_uid = uuid.generate_v4()\\n log.notice(\\"not found apisix uid, generate a new one: \\", apisix_uid)\\n```\\n\\n\u800c jit-uuid \u5e93\u901a\u8fc7 ngx_lua \u73af\u5883\u4e2d\u7684\u8fdb\u7a0b ID \u548c\u65f6\u95f4\u521b\u5efa seed\uff0c[\u5982\u4e0b](https://github.com/thibaultcha/lua-resty-jit-uuid/blob/82538049040ae85ff880b79886f21d8593140c7d/lib/resty/jit-uuid.lua#L53-L54):\\n\\n```Lua\\n        if ngx then\\n            seed = ngx.time() + ngx.worker.pid()\\n```\\n\\n\u7136\u800c\uff0c\u5728\u5bb9\u5668\u5316\u73af\u5883\u4e2d\uff0c\u8fdb\u7a0b ID\uff08\u4e3b\u8fdb\u7a0b\uff09\u53ef\u80fd\u662f\u76f8\u540c\u7684\uff0c\u5373 1 \u53f7\u8fdb\u7a0b\uff0c\u53e6\u5916\uff0c\u5982\u679c\u7528\u6237\u8bd5\u56fe\u901a\u8fc7\u90e8\u7f72\u8d44\u6e90\u5728 Kubernetes \u4e0a\u90e8\u7f72 Apache APISIX \u96c6\u7fa4\uff0c\u51e0\u4e2a Pod \u7684\u65f6\u95f4\u53ef\u80fd\u662f\u76f8\u540c\u7684\uff0c\u56e0\u4e3a ngx.time \u6ca1\u6709\u8db3\u591f\u7684\u7cbe\u786e\u6027\uff08\u53ea\u6709\u6beb\u79d2\u7ea7\u522b\uff09\u3002\u6240\u4ee5\u751f\u6210\u7684 APISIX ID \u53ef\u80fd\u662f\u91cd\u590d\u7684\uff0c\u5982\u679c\u8fd9\u4e2a ID \u662f\u5173\u952e\u7684\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5728\u4e1a\u52a1\u573a\u666f\u4e2d\u9020\u6210\u4e25\u91cd\u7684\u540e\u679c\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [APISIX \u652f\u6301\u5728 Arch Linux \u4e0a\u5b89\u88c5](https://github.com/apache/apisix/pull/5350)\uff08\u8d21\u732e\u8005\uff1a[rapiz1](https://github.com/rapiz1)\uff09\\n\\n- [APISIX limit-conn \u63d2\u4ef6\u652f\u6301\u53d8\u91cf\u4f5c\u4e3a\u9650\u6d41 key](https://github.com/apache/apisix/pull/5354)\uff08\u8d21\u732e\u8005\uff1a[Xunzhuo](https://github.com/Xunzhuo)\uff09\\n\\n- [APISIX limit-count \u63d2\u4ef6\u652f\u6301\u53d8\u91cf\u4f5c\u4e3a\u9650\u6d41 key](https://github.com/apache/apisix/pull/5378)\uff08\u8d21\u732e\u8005\uff1a[Xunzhuo](https://github.com/Xunzhuo)\uff09\\n\\n- [APISIX \u652f\u6301\u901a\u8fc7 POST \u8868\u5355\u5c5e\u6027\u8fdb\u884c\u9ad8\u7ea7\u8def\u7531\u5339\u914d](https://github.com/apache/apisix/pull/5409)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [APISIX \u65b0\u589e\u7528\u4e8e\u6307\u6807\u6536\u96c6\u7684 datadog \u63d2\u4ef6](https://github.com/apache/apisix/pull/5372)\uff08\u8d21\u732e\u8005\uff1a[bisakhmondal](https://github.com/bisakhmondal)\uff09\\n\\n- [APISIX \u65b0\u589e skywalking-logger \u63d2\u4ef6\uff0c\u53ef\u5c06 Access Log \u6570\u636e\u63a8\u9001\u5230 SkyWalking OAP \u670d\u52a1\u5668](https://github.com/apache/apisix/pull/5478)\uff08\u8d21\u732e\u8005\uff1a[dmsolr](https://github.com/dmsolr)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [Apache APISIX \u5982\u4f55\u901a\u8fc7\u7f51\u5173\u5c42\u4e3a Airwallex \u6570\u636e\u4e3b\u6743\u4fdd\u9a7e\u62a4\u822a](https://apisix.apache.org/zh/blog/2021/11/03/airwallex-usercase)\uff1a\\n\\n  \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u5e26\u6765\u5173\u4e8e Airwallex \u7a7a\u4e2d\u4e91\u6c47\u662f\u5982\u4f55\u4f7f\u7528 Apache APISIX \u8fdb\u884c\u7f51\u5173\u5c42\u90e8\u7f72\u6765\u52a0\u56fa\u6570\u636e\u4e3b\u6743\u65b9\u9762\u7684\u5efa\u8bbe\u3002\\n\\n- [\u6d45\u8c08 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027](https://apisix.apache.org/zh/blog/2021/11/04/skywalking)\uff1a\\n\\n  \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u4ee5\u53ca\u5982\u4f55\u901a\u8fc7 Apache SkyWalking \u63d0\u5347Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u3002\\n\\n- [APISIX-Datadog \u63d2\u4ef6\u53d1\u5e03\uff0c\u52a9\u529b\u7528\u6237\u63d0\u9ad8\u7cfb\u7edf\u7684\u53ef\u89c2\u6d4b\u6027](https://apisix.apache.org/zh/blog/2021/11/12/apisix-datadog)\uff1a\\n\\n  Apache APISIX \u6700\u8fd1\u53d1\u5e03\u4e86\u4e00\u4e2a\u65b0\u7684\u63d2\u4ef6\uff1a[APISIX-Datadog](https://apisix.apache.org/docs/apisix/next/plugins/datadog/)\uff0c\u4ee5\u63d0\u4f9b\u4e0e Datadog \u76d1\u63a7\u5e73\u53f0\u7684\u96c6\u6210\u3002\u8fd9\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u4e86 APISIX-Datadog \u63d2\u4ef6\u7684\u5b9e\u73b0\u539f\u7406\u53ca\u529f\u80fd\u3002"},{"id":"API \u7f51\u5173 Datadog \u63d2\u4ef6\u53d1\u5e03\uff0c\u52a9\u529b\u63d0\u9ad8\u7cfb\u7edf\u53ef\u89c2\u6d4b\u6027","metadata":{"permalink":"/zh/blog/2021/11/12/apisix-datadog","source":"@site/blog/2021/11/12/apisix-datadog.md","title":"API \u7f51\u5173 Datadog \u63d2\u4ef6\u53d1\u5e03\uff0c\u52a9\u529b\u63d0\u9ad8\u7cfb\u7edf\u53ef\u89c2\u6d4b\u6027","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u5982\u4f55\u4f7f\u7528 datadog \u63d2\u4ef6\u4e0e Datadog \u76d1\u63a7\u5e73\u53f0\u7684\u8fdb\u884c\u96c6\u6210\uff0c\u5e76\u4e14\u4e5f\u4ecb\u7ecd\u4e86 datadog \u63d2\u4ef6\u7684\u5b9e\u73b0\u539f\u7406\u3001\u529f\u80fd\u4ee5\u53ca\u5177\u4f53\u53c2\u6570\u3002","date":"2021-11-12T00:00:00.000Z","formattedDate":"2021\u5e7411\u670812\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.765,"truncated":true,"authors":[{"name":"Bisakh Mondal","url":"https://github.com/bisakhmondal","imageURL":"https://avatars.githubusercontent.com/u/41498427?v=4"}],"prevItem":{"title":"\u793e\u533a\u5468\u62a5\uff0811.1-11.14\uff09","permalink":"/zh/blog/2021/11/16/weekly-report-1114"},"nextItem":{"title":"\u6d45\u8c08 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027","permalink":"/zh/blog/2021/11/04/skywalking"}},"content":"> Apache APISIX \u6700\u8fd1\u53d1\u5e03\u4e86\u4e00\u4e2a\u65b0\u7684\u63d2\u4ef6\uff1a[APISIX-Datadog](http://apisix.apache.org/docs/apisix/next/plugins/datadog)\uff0c\u4ee5\u63d0\u4f9b\u4e0e Datadog \u76d1\u63a7\u5e73\u53f0\u7684\u96c6\u6210\u3002\u8fd9\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u4e86 APISIX-Datadog \u63d2\u4ef6\u7684\u5b9e\u73b0\u539f\u7406\u53ca\u529f\u80fd\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n![APISIX-Datadog \u63d2\u4ef6\u5c01\u9762\u56fe](https://static.apiseven.com/202108/1636955062917-28911d71-0d56-48ec-85e5-a7908195da2f.png)\\n\\n\u968f\u7740\u5e94\u7528\u5f00\u53d1\u7684\u590d\u6742\u5ea6\u589e\u52a0\uff0c\u76d1\u63a7\u6210\u4e3a\u4e86\u5e94\u7528\u7684\u4e00\u4e2a\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002\u53ca\u65f6\u3001\u51c6\u786e\u7684\u76d1\u63a7\u65e2\u80fd\u6ee1\u8db3\u5feb\u901f\u8fed\u4ee3\u7684\u5468\u671f\u6027\u9700\u6c42\uff0c\u53c8\u80fd\u591f\u786e\u4fdd\u5e94\u7528\u7684\u7a33\u5b9a\u6027\u548c\u6d41\u7545\u6027\u3002\u5982\u4f55\u9009\u62e9\u4e00\u4e2a\u9002\u5408\u7684\u76d1\u63a7\uff0c\u4ee5\u63d0\u5347\u5e94\u7528\u7684\u53ef\u89c2\u6d4b\u6027\uff0c\u6210\u4e3a\u4e86\u6bcf\u4e2a\u5f00\u53d1\u8005\u90fd\u5fc5\u987b\u9762\u4e34\u7684\u4e00\u9053\u96be\u9898\u3002\\n\\n[Apache APISIX](http://apisix.apache.org/) \u5c06\u76d1\u63a7\u548c\u53ef\u89c2\u6d4b\u6027\u4ece\u5e94\u7528\u4e2d\u89e3\u8026\u4e86\u51fa\u6765\uff0c\u7ed9\u5f00\u53d1\u4eba\u5458\u5e26\u6765\u4e86\u4e00\u4e2a\u4f18\u52bf\uff1a\u5728\u6784\u5efa\u5e94\u7528\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5173\u6ce8\u4e1a\u52a1\u903b\u8f91\uff0c\u800c Apache APISIX \u53ef\u4ee5\u548c\u5f00\u53d1\u4eba\u5458\u9009\u5b9a\u7684\u76d1\u63a7\u5e73\u53f0\u5bf9\u63a5\uff0c\u5904\u7406\u53ef\u89c2\u6d4b\u6027\u7684\u95ee\u9898\u3002\\n\\nApache APISIX \u6700\u8fd1\u53d1\u5e03\u4e86\u4e00\u4e2a\u65b0\u7684\u63d2\u4ef6\uff1aAPISIX-Datadog\uff0c\u4ee5\u63d0\u4f9b\u4e0e Datadog \u76d1\u63a7\u5e73\u53f0\u7684\u96c6\u6210\u3002\u8fd9\u7bc7\u6587\u7ae0\u4ecb\u7ecd\u4e86 APISIX-Datadog \u63d2\u4ef6\u7684\u5b9e\u73b0\u539f\u7406\u53ca\u529f\u80fd\u3002\\n\\n## APISIX-Datadog plugin \u5de5\u4f5c\u539f\u7406\\n\\n![APISIX-Datadog \u63d2\u4ef6\u67b6\u6784\u56fe](https://static.apiseven.com/202108/1636685752757-d02d8305-2a68-4b3e-b2cc-9e5410c8bf11.png)\\n\\nAPISIX-Datadog \u63d2\u4ef6\u5c06\u5176\u81ea\u5b9a\u4e49\u6307\u6807\u63a8\u9001\u5230 DogStatsD server\u3002\u800c DogStatsD server \u901a\u8fc7 UDP \u8fde\u63a5\u4e0e Datadog agent \u6346\u7ed1\u5728\u4e00\u8d77\u3002DogStatsD \u662f StatsD \u534f\u8bae\u7684\u4e00\u4e2a\u5b9e\u73b0\u3002\u5b83\u4e3a Apache APISIX agent \u6536\u96c6\u81ea\u5b9a\u4e49\u6307\u6807\uff0c\u5c06\u5176\u805a\u5408\u6210\u4e00\u4e2a\u6570\u636e\u70b9\uff0c\u5e76\u5c06\u5176\u53d1\u9001\u5230\u914d\u7f6e\u7684 Datadog server\u3002\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8e DogStatsD \u7684\u4fe1\u606f\uff0c\u8bf7\u8bbf\u95ee DogStatsD \u6587\u6863\u3002\\n\\n\u5f53\u4f60\u542f\u7528 APISIX-Datadog \u63d2\u4ef6\u65f6\uff0cApache APISIX agent \u4f1a\u5728\u6bcf\u4e2a\u8bf7\u6c42\u54cd\u5e94\u5468\u671f\u5411 DogStatsD server \u8f93\u51fa\u4ee5\u4e0b\u6307\u6807\uff1a\\n\\n|\u53c2\u6570\u540d\u79f0|StatsD \u7c7b\u578b|\u63cf\u8ff0|\\n|-----------|-----------|-----------|\\n|Request Counter|Counter|\u6536\u5230\u7684\u8bf7\u6c42\u6570\u91cf\u3002|\\n|Request Latency|Histogram|\u5904\u7406\u8be5\u8bf7\u6c42\u6240\u9700\u7684\u65f6\u95f4\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002|\\n|Upstream latency|Histogram|\u4e0a\u6e38 server agent \u8bf7\u6c42\u5230\u6536\u5230\u54cd\u5e94\u6240\u9700\u7684\u65f6\u95f4\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002|\\n|APISIX Latency|Histogram|APISIX agent \u5904\u7406\u8be5\u8bf7\u6c42\u7684\u65f6\u95f4\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002|\\n|Ingress Size|Timer|\u8bf7\u6c42\u4f53\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u3002|\\n|Egress Size|Timer|\u54cd\u5e94\u4f53\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u3002|\\n\\n\u8fd9\u4e9b\u6307\u6807\u5c06\u88ab\u53d1\u9001\u5230 DogStatsD agent\uff0c\u5e76\u5e26\u6709\u4ee5\u4e0b\u6807\u7b7e\u3002\u5982\u679c\u4efb\u4f55\u7279\u5b9a\u7684\u6807\u7b7e\u6ca1\u6709\u5408\u9002\u7684\u503c\uff0c\u8be5\u6807\u7b7e\u5c06\u88ab\u76f4\u63a5\u7701\u7565\u3002\\n\\n|\u53c2\u6570\u540d\u79f0|\u63cf\u8ff0|\\n|-----------|-----------|\\n|route_name|\u8def\u7531\u7684\u540d\u79f0\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c06\u663e\u793a\u8def\u7531 ID\u3002|\\n|service_id|\u5982\u679c\u4e00\u4e2a\u8def\u7531\u662f\u7528\u670d\u52a1\u7684\u62bd\u8c61\u6982\u5ff5\u521b\u5efa\u7684\uff0c\u90a3\u4e48\u7279\u5b9a\u7684\u670d\u52a1 ID \u5c06\u88ab\u4f7f\u7528\u3002|\\n|consumer|\u5982\u679c\u8def\u7531\u6709\u4e00\u4e2a\u94fe\u63a5\u7684\u6d88\u8d39\u8005\uff0c\u6d88\u8d39\u8005\u7684\u7528\u6237\u540d\u5c06\u88ab\u6dfb\u52a0\u4e3a\u4e00\u4e2a\u6807\u7b7e\u3002|\\n|balancer_ip|\u5904\u7406\u4e86\u5f53\u524d\u8bf7\u6c42\u7684\u4e0a\u6e38\u590d\u5236\u5747\u8861\u5668\u7684\u7684 IP\u3002|\\n|response_status|HTTP \u54cd\u5e94\u72b6\u6001\u4ee3\u7801\u3002|\\n|scheme|\u5df2\u7528\u4e8e\u63d0\u51fa\u8bf7\u6c42\u7684\u534f\u8bae\uff0c\u5982 HTTP\u3001gRPC\u3001gRPCs \u7b49\u3002|\\n\\nAPISIX-Datadog \u63d2\u4ef6\u7ef4\u62a4\u4e86\u4e00\u4e2a\u5e26\u6709 timer \u7684 buffer\u3002\u5f53 timer \u5931\u6548\u65f6\uff0cAPISIX-Datadog \u63d2\u4ef6\u4f1a\u5c06 buffer \u7684\u6307\u6807\u4f5c\u4e3a\u4e00\u4e2a\u6279\u91cf\u5904\u7406\u7a0b\u5e8f\u4f20\u9001\u7ed9\u672c\u5730\u8fd0\u884c\u7684 DogStatsD server\u3002\u8fd9\u79cd\u65b9\u6cd5\u901a\u8fc7\u91cd\u590d\u4f7f\u7528\u76f8\u540c\u7684 UDP \u5957\u63a5\u5b57\uff0c\u5bf9\u8d44\u6e90\u7684\u5360\u7528\u8f83\u5c11\uff0c\u800c\u4e14\u7531\u4e8e\u53ef\u4ee5\u914d\u7f6e timer\uff0c\u6240\u4ee5\u4e0d\u4f1a\u4e00\u76f4\u8ba9\u7f51\u7edc\u8fc7\u8f7d\u3002\\n\\n## \u542f\u52a8 Datadog Agent\\n\\n1. \u5982\u679c\u4f60\u5df2\u7ecf\u5728\u4f7f\u7528 Datadog\uff0c\u4f60\u5fc5\u987b\u5728\u7cfb\u7edf\u4e2d\u5b89\u88c5\u4e00\u4e2a Datadog agent\u3002\u5b83\u53ef\u4ee5\u662f\u4e00\u4e2a docker \u5bb9\u5668\uff0c\u4e00\u4e2a pod \u6216\u4e8c\u8fdb\u5236\u7684\u5305\u7ba1\u7406\u5668\u3002\u4f60\u53ea\u9700\u8981\u786e\u4fddApache APISIX agent \u53ef\u4ee5\u5230\u8fbe Datadog agent \u7684 8125 \u7aef\u53e3\u3002\\n\\n> \u5982\u679c\u9700\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u5982\u4f55\u5b89\u88c5\u4e00\u4e2a\u5b8c\u6574\u7684 Datadog agent\uff0c\u8bf7\u8bbf\u95ee[\u8fd9\u91cc](https://docs.datadoghq.com/agent/)\u3002\\n\\n2. \u5982\u679c\u4f60\u4ece\u6ca1\u4f7f\u7528\u8fc7 Datadog\\n    1. \u9996\u5148\u8bbf\u95ee www.datadoghq.com \uff0c\u521b\u5efa\u4e00\u4e2a\u8d26\u6237\u3002\\n    2. \u7136\u540e\u6309\u7167\u4e0b\u56fe\u6807\u6ce8\u7684\u6b65\u9aa4\u751f\u6210 API \u5bc6\u94a5\u3002\\n    ![Generate an API Key](https://static.apiseven.com/202108/1636685007445-05f134fd-e80a-4173-b1d7-f0a118087998.png)\\n\\n3. APISIX-Datadog \u63d2\u4ef6\u53ea\u9700\u8981\u4f9d\u8d56 `datadog/agent` \u7684 dogstatsd \u7ec4\u4ef6\u5373\u53ef\u5b9e\u73b0\uff0c\u56e0\u4e3a\u8be5\u63d2\u4ef6\u6309\u7167 statsd \u534f\u8bae\u901a\u8fc7\u6807\u51c6\u7684 UDP \u5957\u63a5\u5b57\u5411 DogStatsD server \u5f02\u6b65\u53d1\u9001\u53c2\u6570\u3002\u6211\u4eec\u63a8\u8350\u4f7f\u7528\u72ec\u7acb\u7684 `datadog/dogstatsd` \u955c\u50cf\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u5b8c\u6574\u7684`datadog/agent` \uff0c\u56e0\u4e3a `datadog/dogstatsd` \u7684\u7ec4\u4ef6\u5927\u5c0f\u53ea\u6709\u5927\u7ea6 11 MB\uff0c\u66f4\u52a0\u8f7b\u91cf\u5316\u3002\u800c\u5b8c\u6574\u7684 `datadog/agent` \u955c\u50cf\u7684\u5927\u5c0f\u4e3a 2.8 GB\u3002\\n\\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c06\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u5bb9\u5668\u6765\u8fd0\u884c\uff1a\\n\\n```shell\\n# pull the latest image\\ndocker pull datadog/dogstatsd:latest\\n# run a detached container\\ndocker run -d --name dogstatsd-agent -e DD_API_KEY=<Your API Key from step 2> -p 8125:8125/udp datadog/dogstatsd\\n```\\n\\n\u5982\u679c\u4f60\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528 Kubernetes\uff0c\u4f60\u53ef\u4ee5\u5c06 `dogstatsd` \u4f5c\u4e3a\u4e00\u4e2a `Daemonset` \u6216 `Multi-Container Pod` \u4e0e Apache APISIX agent \u4e00\u8d77\u90e8\u7f72\u3002\\n\\n## \u5982\u4f55\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Datadog\\n\\n### \u542f\u7528 APISIX-Datadog \u63d2\u4ef6\\n\\n\u5982\u679c\u4f60\u5df2\u7ecf\u542f\u52a8\u4e86 `dogstatsd` agent\uff0c\u53ea\u9700\u6267\u884c\u4e00\u6761\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u4e3a\u6307\u5b9a\u8def\u7531\u542f\u7528 APISIX-Datadog \u63d2\u4ef6\u3002\\n\\n```shell\\n# enable plugin for a specific route\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"datadog\\": {}\\n    },\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    },\\n    \\"uri\\": \\"/hello\\"\\n}\'\\n```\\n\\n\u542f\u7528 APISIX-Datadog \u63d2\u4ef6\u540e\uff0c\u4efb\u4f55\u5bf9\u7aef\u70b9 URI `/hello` \u7684\u8bf7\u6c42\u90fd\u4f1a\u4ea7\u751f\u4e0a\u8ff0\u6307\u6807\uff0c\u5e76\u63a8\u9001\u5230 Datadog agent\u7684\u672c\u5730 DogStatsD server\u3002\\n\\n### \u81ea\u5b9a\u4e49\u914d\u7f6e\\n\\n\u5982\u679c\u542f\u7528 APISIX-Datadog \u63d2\u4ef6\u65f6\uff0c\u4f7f\u7528\u7684\u662f\u9ed8\u8ba4\u914d\u7f6e\uff0cdogstatsd \u670d\u52a1\u5728 `127.0.0.1:8125` \u53ef\u7528\u3002\u5982\u679c\u4f60\u60f3\u66f4\u65b0\u914d\u7f6e\uff0c\u8bf7\u66f4\u65b0\u63d2\u4ef6\u7684\u5143\u6570\u636e\u3002\\n\\n#### \u5143\u6570\u636e\u53c2\u6570\u89e3\u91ca\\n\\n|\u53c2\u6570\u540d\u79f0|\u7c7b\u578b|\u662f\u5426\u5fc5\u987b\u4fee\u6539|\u9ed8\u8ba4\u503c|\u63cf\u8ff0|\\n|----|----|---------------|-------|-----------|\\n|hosts|string|\u5426|\\"127.0.0.1\\"|DogStatsD server \u7684\u4e3b\u673a\u5730\u5740|\\n|port|integer|\u5426|8125|DogStatsD server\u7684\u4e3b\u673a\u7aef\u53e3|\\n|namespace|string|\u5426|\\"apisix\\"|\u7531 APISIX agent\u53d1\u9001\u7684\u6240\u6709\u81ea\u5b9a\u4e49\u53c2\u6570\u7684\u524d\u7f00\u3002\u5bf9\u5bfb\u627e\u6307\u6807\u56fe\u7684\u5b9e\u4f53\u5f88\u6709\u5e2e\u52a9\uff0c\u4f8b\u5982\uff1a(apisix.request.counter)\u3002|\\n|constant_tags|array|\u5426|[\\"source:apisix\\"]|\u9759\u6001\u6807\u7b7e\u5d4c\u5165\u5230\u751f\u6210\u7684\u6307\u6807\u4e2d\u3002\u5bf9\u67d0\u4e9b\u4fe1\u53f7\u7684 metrics \u8fdb\u884c\u5206\u7ec4\u5f88\u6709\u7528\u3002|\\n\\n\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u5982\u4f55\u6709\u6548\u5730\u7f16\u5199\u6807\u7b7e\uff0c\u8bf7\u8bbf\u95ee[\u8fd9\u91cc](https://docs.datadoghq.com/getting_started/tagging/#defining-tags)\u3002\\n\\n\u5411 /apisix/admin/plugin_metadata \u7aef\u70b9\u53d1\u51fa\u8bf7\u6c42\uff0c\u66f4\u65b0\u5143\u6570\u636e\uff0c\u5982\u4e0b\u6240\u793a\u3002\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/plugin_metadata/datadog -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"host\\": \\"127.0.0.1\\",\\n    \\"port\\": 8125,\\n    \\"constant_tags\\": [\\n        \\"source:apisix\\",\\n        \\"service:custom\\"\\n    ],\\n    \\"namespace\\": \\"apisix\\"\\n}\'\\n```\\n\\n#### \u63d2\u4ef6\u53c2\u6570\u89e3\u91ca\\n\\n\u4e0e\u5143\u6570\u636e\u7c7b\u4f3c\uff0c\u5728\u542f\u7528 APISIX-Datadog \u63d2\u4ef6\u65f6\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8c03\u6574\u5176\u4ed6\u53c2\u6570\u3002\\n\\n|\u53c2\u6570\u540d\u79f0|\u7c7b\u578b|\u662f\u5426\u5fc5\u987b\u4fee\u6539|\u9ed8\u8ba4\u503c|\u53d6\u503c\u8303\u56f4||\u63cf\u8ff0|\\n|----|----|--------|-------|-----|-----------|\\n|batch_max_size|integer|\u5426|5000|[1,...]|\u6bcf\u4e2a\u6279\u6b21\u7684 buffer \u6700\u5927\u503c|\\n|inactive_timeout|integer|\u5426|5|[1,...]|\u5982\u679c\u4e0d\u6d3b\u8dc3\uff0cbuffer \u5c06\u88ab\u5237\u65b0\u7684\u6700\u957f\u65f6\u95f4\uff08\u79d2\uff09\u3002|\\n|buffer_duration|integer|\u5426|60|[1,...]|\u5728\u5fc5\u987b\u5904\u7406\u4e00\u4e2a\u6279\u6b21\u4e4b\u524d\uff0c\u8be5\u6279\u6b21\u4e2d\u6700\u8001\u7684\u6761\u76ee\u7684\u6700\u957f\u5b58\u6d3b\u65f6\u95f4\uff08\u79d2\uff09\u3002|\\n|max_retry_count|integer|\u5426|1|[1,...]|\u5982\u679c\u4e00\u4e2a\u6761\u76ee\u672a\u80fd\u5230\u8fbe dogstatsd server\uff0c\u91cd\u8bd5\u7684\u6b21\u6570\u3002|\\n\\n\u7531\u4e8e\u6240\u6709\u7684\u5b57\u6bb5\u90fd\u662f\u53ef\u9009\u7684\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u624b\u52a8\u8bbe\u7f6e\u4efb\u4f55\u53c2\u6570\uff0cAPISIX-Datadog \u63d2\u4ef6\u5c06\u4f7f\u7528\u9ed8\u8ba4\u503c\u8bbe\u7f6e\u8fd9\u4e9b\u53c2\u6570\u3002\u5982\u679c\u4f60\u9700\u8981\u66f4\u65b0\u4efb\u4f55\u53c2\u6570\uff0c\u53ea\u9700\u7528\u66f4\u65b0\u7684\u53c2\u6570\u503c\u66f4\u65b0\u6240\u9700\u7684\u8def\u7531\u3001\u670d\u52a1\u6216\u6d88\u8d39\u8005\u3002\u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u4ee3\u7801\u5c06 `batch_max_size` \u4fee\u6539\u4e3a 10\u3002\\n\\n```shell\\n\'{\\n...\\n\\"plugins\\": {\\n    \\"datadog\\": {\\n        \\"batch_max_size\\": 10\\n    }\\n}\\n... }\'\\n```\\n\\n### \u505c\u7528 APISIX-Datadog \u63d2\u4ef6\\n\\n\u4f60\u53ea\u9700\u5728\u63d2\u4ef6\u914d\u7f6e\u4e2d\u5220\u9664\u76f8\u5e94\u7684 json \u914d\u7f6e\u5373\u53ef\u505c\u7528 APISIX-Datadog \u63d2\u4ef6\u3002\u5f97\u76ca\u4e8e Apache APISIX \u63d2\u4ef6\u7684\u70ed\u52a0\u8f7d\u673a\u5236\uff0c\u5220\u9664 json \u914d\u7f6e\u540e\uff0c\u4f1a\u7acb\u5373\u505c\u7528APISIX-Datadog \u63d2\u4ef6\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u3002\\n\\n```shell\\n# disable plugin for a route\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\": \\"/hello\\",\\n    \\"plugins\\": {},\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```"},{"id":"\u6d45\u8c08 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027","metadata":{"permalink":"/zh/blog/2021/11/04/skywalking","source":"@site/blog/2021/11/04/skywalking.md","title":"\u6d45\u8c08 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u4ee5\u53ca\u5982\u4f55\u901a\u8fc7 Apache SkyWalking \u63d0\u5347Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u53ca\u672a\u6765\u89c4\u5212\u3002","date":"2021-11-04T00:00:00.000Z","formattedDate":"2021\u5e7411\u67084\u65e5","tags":[{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.45,"truncated":true,"authors":[{"name":"\u5e84\u6d69\u6f6e","title":"Author","url":"https://github.com/dmsolr","image_url":"https://avatars.githubusercontent.com/u/29735230?v=4","imageURL":"https://avatars.githubusercontent.com/u/29735230?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://avatars.githubusercontent.com/u/36651058?v=4","imageURL":"https://avatars.githubusercontent.com/u/36651058?v=4"}],"prevItem":{"title":"API \u7f51\u5173 Datadog \u63d2\u4ef6\u53d1\u5e03\uff0c\u52a9\u529b\u63d0\u9ad8\u7cfb\u7edf\u53ef\u89c2\u6d4b\u6027","permalink":"/zh/blog/2021/11/12/apisix-datadog"},"nextItem":{"title":"Apache APISIX \u5982\u4f55\u901a\u8fc7\u7f51\u5173\u5c42\u4e3a Airwallex \u6570\u636e\u4e3b\u6743\u4fdd\u9a7e\u62a4\u822a","permalink":"/zh/blog/2021/11/03/airwallex-usercase"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u4ee5\u53ca\u5982\u4f55\u901a\u8fc7 Apache SkyWalking \u63d0\u5347Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u53ef\u89c2\u6d4b\u6027\u662f\u4ece\u7cfb\u7edf\u5916\u90e8\u53bb\u89c2\u5bdf\u7cfb\u7edf\u5185\u90e8\u7a0b\u5e8f\u7684\u7684\u8fd0\u884c\u65f6\u72b6\u6001\u548c\u8d44\u6e90\u4f7f\u7528\u60c5\u51b5\u3002\u8861\u91cf\u53ef\u89c2\u6d4b\u6027\u7684\u4e3b\u8981\u624b\u6bb5\u5305\u62ec\uff1aMetrics\u3001Logging \u548c Tracing\uff0c\u4e0b\u56fe\u662f Metrics\u3001Logging \u548c Tracing \u4e4b\u95f4\u7684\u5173\u7cfb\u3002\\n\\n![Metrics\u3001Logging \u548c Tracing \u5173\u7cfb\u56fe](https://static.apiseven.com/202108/1635993536337-f8ee034d-ef3b-40b6-9886-ebde62d8edc6.png)\\n\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0cTracing \u548c Logging \u91cd\u5408\u7684\u90e8\u5206\u4ee3\u8868\u7684\u662f Tracing \u5728 request \u7ea7\u522b\u4ea7\u751f\u7684\u65e5\u5fd7\uff0c\u5e76\u901a\u8fc7 Tracing ID \u5c06 Tracing \u548c Logging \u5173\u8054\u8d77\u6765\u3002\u5bf9\u8fd9\u4efd\u65e5\u5fd7\u8fdb\u884c\u4e00\u5b9a\u7684\u805a\u5408\u8fd0\u7b97\u4e4b\u540e\uff0c\u80fd\u591f\u5f97\u5230\u4e00\u4e9b Metrics\u3002Tracing \u81ea\u8eab\u4e5f\u4f1a\u4ea7\u751f\u4e00\u4e9b Metrics\uff0c\u4f8b\u5982\u8c03\u7528\u91cf\u4e4b\u95f4\u7684\u5173\u7cfb\u3002\\n\\n## Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\\n\\nApache APISIX \u62e5\u6709\u5b8c\u5584\u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\uff1a\u652f\u6301 Tracing \u548c Metrics\u3001\u62e5\u6709\u4e30\u5bcc\u7684 Logging \u63d2\u4ef6\u751f\u6001\u3001\u652f\u6301\u67e5\u8be2\u8282\u70b9\u72b6\u6001\u3002\\n\\n### Tracing\\n\\nApache APISIX \u652f\u6301\u591a\u79cd Tracing \u63d2\u4ef6\uff0c\u5305\u62ec\uff1aZipkin\u3001OpenTracing \u548c SkyWalking\u3002\u9700\u8981\u6ce8\u610f\u662f\uff1a Tracing \u63d2\u4ef6\u9ed8\u8ba4\u5904\u4e8e\u5173\u95ed\u72b6\u6001\uff0c\u4f7f\u7528\u524d\u9700\u8981\u624b\u52a8\u5f00\u542f Tracing \u63d2\u4ef6\uff1bTracing \u63d2\u4ef6\u9700\u8981\u4e0e\u8def\u7531\u6216\u5168\u5c40\u89c4\u5219\u7ed1\u5b9a\uff0c\u5982\u679c\u6ca1\u6709\u91c7\u6837\u7387\u7684\u8981\u6c42\uff0c\u5efa\u8bae\u4e0e\u5168\u5c40\u89c4\u5219\u7ed1\u5b9a\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u9057\u6f0f\u3002\\n\\n### Metrics\\n\\n\u5728 Apache APISIX \u4e2d\uff0c Metrics \u7684\u76f8\u5173\u4fe1\u606f\u901a\u8fc7 Prometheus Exporter\u4e0a\u62a5\uff0c\u517c\u5bb9 Prometheus \u7684\u6570\u636e\u683c\u5f0f\u3002\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Prometheus Plugin \u6709\u4e24\u4ef6\u4e8b\u60c5\u9700\u8981\u6ce8\u610f\u3002\\n\\n**\u7b2c\u4e00\uff0c\u8bf7\u5c3d\u91cf\u63d0\u9ad8\u8def\u7531\u3001\u670d\u52a1\u548c\u4e0a\u6e38\u8fd9\u4e09\u8005\u540d\u79f0\u7684\u53ef\u8bfb\u6027\u3002**\\n\\nPrometheus Plugin \u4e2d\u6709\u4e00\u4e2a\u540d\u4e3a `prefer_name` \u7684\u53c2\u6570\uff0c\u5c06\u8fd9\u4e2a\u53c2\u6570\u7684\u503c\u8bbe\u7f6e\u4e3a `true` \u65f6\uff0c\u5373\uff1a`prefer_name: true`\uff0c\u5982\u679c\u8def\u7531\u3001\u670d\u52a1\u548c\u4e0a\u6e38\u8fd9\u4e09\u8005\u7684\u540d\u79f0\u53ef\u8bfb\u6027\u6bd4\u8f83\u5f3a\uff0c\u8fd9\u4f1a\u5e26\u6765\u4e00\u4e9b\u597d\u5904\uff1a\u540e\u7eed\u901a\u8fc7 Grafana \u76d1\u63a7\u5927\u5c4f\u5c55\u793a\u53c2\u6570\u7684\u65f6\u5019\uff0c\u4e0d\u4ec5\u80fd\u591f\u6e05\u695a\u5730\u5c55\u793a\u51fa\u6240\u6709\u7684\u6570\u636e\uff0c\u8fd8\u80fd\u591f\u6e05\u6670\u5730\u77e5\u6653\u8fd9\u4e9b\u6570\u636e\u7684\u6765\u6e90\u3002\u5982\u679c `prefer_name` \u53c2\u6570\u7684\u503c\u4e3a `false`\uff0c\u5219\u53ea\u4f1a\u5c55\u793a\u8d44\u6e90\u7684 ID \u4f5c\u4e3a\u6570\u636e\u6765\u6e90\uff0c\u4f8b\u5982 \u8def\u7531 ID\u3001\u4e0a\u6e38 ID\uff0c\u8fdb\u800c\u9020\u6210\u76d1\u63a7\u5927\u5c4f\u7684\u53ef\u8bfb\u6027\u8f83\u4f4e\u7684\u95ee\u9898\u3002\\n\\n**\u7b2c\u4e8c\uff0cPrometheus Plugin \u5fc5\u987b\u4e0e\u8def\u7531\u6216\u8005\u5168\u5c40\u89c4\u5219\u7ed1\u5b9a\uff0c\u7136\u540e\u624d\u53ef\u4ee5\u67e5\u770b\u5230\u6307\u5b9a\u8d44\u6e90\u7684 Metrics\u3002**\\n\\n\u5b8c\u6210\u4e0a\u8ff0\u8bbe\u7f6e\u4ee5\u540e\uff0cMetrics \u7684\u6570\u636e\u4f1a\u5b58\u50a8\u5728 Prometheus \u91cc\u9762\u3002\u7531\u4e8e Prometheus \u7684\u5b58\u50a8\u6027\u80fd\u5f88\u597d\uff0c\u4f46\u5c55\u793a\u6027\u80fd\u6b20\u4f73\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u501f\u52a9 Grafana Dashboard \u5c55\u793a\u6570\u636e\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230 Nginx \u5b9e\u4f8b\u7684 Metrics\u3001\u7f51\u7edc\u5e26\u5bbd\u7684 Metrics\u3001\u8def\u7531\u548c\u4e0a\u6e38\u7684 Metrics \u7b49\uff0c\u8be6\u60c5\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![Grafana Dashboard](https://static.apiseven.com/202108/1635993660940-9c9bbb0b-d5f1-4add-b93d-1f076de9aebd.png)\\n\\n### Logging\\n\\nApache APISIX \u652f\u6301\u591a\u79cd\u65e5\u5fd7\u63d2\u4ef6\uff0c\u53ef\u4ee5\u4e0e\u5176\u4ed6\u5916\u90e8\u7684\u5e73\u53f0\u76f4\u63a5\u5206\u4eab\u65e5\u5fd7\u6570\u636e\u3002Error Log \u63d2\u4ef6\u652f\u6301 HTTP \u4e0e TCP \u534f\u8bae\uff0c\u5e76\u4e14\u517c\u5bb9 SkyWalking \u7684\u65e5\u5fd7\u683c\u5f0f\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7 FluentBit \u7b49\u65e5\u5fd7\u6536\u96c6\u7ec4\u4ef6\uff0c\u5c06\u65e5\u5fd7\u540c\u6b65\u5230\u65e5\u5fd7\u5e73\u53f0\u8fdb\u884c\u5904\u7406\u3002\\n\\nAccess Log \u63d2\u4ef6\u76ee\u524d\u8fd8\u4e0d\u652f\u6301\u5728\u65e5\u5fd7\u683c\u5f0f\u91cc\u9762\u8fdb\u884c\u5d4c\u5957\u3002\u56e0\u4e3a Access Log \u63d2\u4ef6\u662f\u8def\u7531\u7ea7\u522b\u7684\uff0c\u6240\u4ee5\u9700\u8981\u8ddf\u8def\u7531\u8fdb\u884c\u7ed1\u5b9a\uff0c\u624d\u53ef\u4ee5\u6536\u96c6\u5230\u8def\u7531\u7684\u8bbf\u95ee\u65e5\u5fd7\u3002\u4f46\u662f\u65e5\u5fd7\u7684\u683c\u5f0f\u662f\u5168\u5c40\u7684\uff0c\u800c\u5168\u5c40\u53ea\u80fd\u6709\u4e00\u4efd\u65e5\u5fd7\u683c\u5f0f\u3002\\n\\n### \u652f\u6301\u67e5\u8be2\u8282\u70b9\u72b6\u6001\\n\\nApache APISIX \u7684\u652f\u6301\u67e5\u8be2\u8282\u70b9\u72b6\u6001\uff0c\u542f\u7528\u4e4b\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 `/apisix/status` \u6536\u96c6\u5230\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u8282\u70b9\u6570\u3001\u7b49\u5f85\u94fe\u63a5\u6570\u3001\u5904\u7406\u8fde\u63a5\u6570\u7b49\u3002\\n\\n![\u8282\u70b9\u72b6\u6001](https://static.apiseven.com/202108/1635993774170-ca3bf15d-9f55-42ac-9a2f-2d8955f74c5c.png)\\n\\n### \u7f8e\u4e2d\u4e0d\u8db3\\n\\n\u4e0a\u6587\u8bb2\u5230\uff0cApache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u975e\u5e38\u5b8c\u5584\uff0c\u80fd\u591f\u6536\u96c6 Metrics\u3001Logging \u548c Tracing \u7b49\u4fe1\u606f\u3002\u867d\u7136\u501f\u52a9 Apache APISIX \u7684\u5185\u7f6e\u63d2\u4ef6\u914d\u5408 Grafana Dashboard\uff0c\u80fd\u591f\u89e3\u51b3\u76d1\u63a7\u6570\u636e\u6536\u96c6\u548c\u6307\u6807\u53ef\u89c6\u5316\u95ee\u9898\uff0c\u4f46\u662f\u5404\u79cd\u6570\u636e\u5206\u6563\u5728\u5404\u4e2a\u5e73\u53f0\u3002\u671f\u671b\u6709\u4e00\u4e2a\u53ef\u89c2\u6d4b\u6027\u5206\u6790\u5e73\u53f0\u80fd\u96c6\u6210 Metrics\u3001Logging\u3001Tracing \u4fe1\u606f\uff0c\u80fd\u591f\u5c06\u6240\u6709\u6570\u636e\u8054\u52a8\u8d77\u6765\u3002\\n\\n## \u4f7f\u7528 Apache SkyWalking \u589e\u5f3a Apache APISIX \u7684\u89c2\u6d4b\u80fd\u529b\\n\\nApache SkyWalking \u662f\u4e00\u4e2a\u9488\u5bf9\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5e94\u7528\u6027\u80fd\u76d1\u63a7\uff08APM\uff09\u548c\u53ef\u89c2\u6d4b\u6027\u5206\u6790\u5e73\u53f0\u3002\u5b83\u63d0\u4f9b\u4e86\u591a\u7ef4\u5ea6\u5e94\u7528\u6027\u80fd\u5206\u6790\u624b\u6bb5\uff0c\u4ece\u5206\u5e03\u5f0f\u62d3\u6251\u56fe\u5230\u5e94\u7528\u6027\u80fd\u6307\u6807\u3001Trace\u3001\u65e5\u5fd7\u7684\u5173\u8054\u5206\u6790\u4e0e\u544a\u8b66\u3002\\n\\n![Apache SkyWalking](https://static.apiseven.com/202108/1635993914263-b7511acd-9bcf-49ca-aa32-911fc85acfac.png)\\n\\n### \u4e00\u7ad9\u5f0f\u6570\u636e\u5904\u7406\\n\\nApache SkyWalking \u652f\u6301\u5bf9\u63a5 Metrics\u3001Logging\u3001Tracing \u7b49\u591a\u79cd\u76d1\u63a7\u6570\u636e\uff0c\u517c\u5bb9 Prometheus \u6570\u636e\u6a21\u578b\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 Log Analysis Language \u8fdb\u884c\u4e8c\u6b21\u805a\u5408\uff0c\u4ea7\u751f\u65b0\u7684 Metrics\u3002\\n\\n### \u66f4\u8be6\u7ec6\u7684\u6570\u636e\u5c55\u793a\\n\\nApache SkyWalking \u7684 Dashboard \u5206\u4e3a\u4e0a\u4e0b\u4e24\u4e2a\u533a\u57df\u3002\u4e0a\u90e8\u662f\u529f\u80fd\u9009\u62e9\u533a\u57df\uff0c\u4e0b\u90e8\u662f\u9762\u677f\u5185\u5bb9\u3002Dashboard \u63d0\u4f9b\u5168\u5c40\u3001\u670d\u52a1\u3001\u793a\u4f8b\u3001Endpoint \u7b49\u591a\u4e2a\u5b9e\u4f53\u7ef4\u5ea6\u7684 Metrics \u76f8\u5173\u4fe1\u606f\uff0c\u652f\u6301\u4ee5\u4e0d\u540c\u7684\u89c6\u56fe\u5c55\u793a\u53ef\u89c2\u6d4b\u6027\u3002\u4ee5\u5168\u5c40\u89c6\u56fe\u4e3a\u4f8b\uff0c\u5c55\u793a\u7684 Metrics \u5305\u62ec\uff1a\u670d\u52a1\u8d1f\u8f7d\u3001\u6162\u670d\u52a1\u6570\u91cf\u3001\u4e0d\u5065\u5eb7\u7684\u670d\u52a1\u6570\u91cf\u7b49\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![\u6570\u636e\u5c55\u793a](https://static.apiseven.com/202108/1635993968588-403c9219-ae66-4b97-9eee-dcb97067b789.png)\\n\\n\u53e6\u5916\u503c\u5f97\u4e00\u8bf4\u7684\u662f SkyWalking Dashboard \u7684 Trace \u89c6\u56fe\u3002SkyWalking \u63d0\u4f9b\u4e86 3 \u79cd\u5c55\u73b0\u5f62\u5f0f\uff1a\u5217\u8868\u3001\u6811\u72b6\u56fe\u548c\u8868\u683c\u3002Trace \u89c6\u56fe\u662f\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7684\u5178\u578b\u89c6\u56fe\uff0c\u8fd9\u4e9b\u89c6\u56fe\u5141\u8bb8\u7528\u6237\u4ece\u4e0d\u540c\u89d2\u5ea6\u67e5\u770b\u8ffd\u8e2a\u6570\u636e\uff0c\u7279\u522b\u662f Span \u95f4\u7684\u8017\u65f6\u5173\u7cfb\u3002\\n\\nSkyWalking Dashboard \u4e5f\u652f\u6301\u62d3\u6251\u56fe\u3002\u62d3\u6251\u56fe\u662f\u6839\u636e\u63a2\u9488\u4e0a\u884c\u6570\u636e\u5206\u6790\u51fa\u7684\u6574\u4f53\u62d3\u6251\u7ed3\u6784\u3002\u62d3\u6251\u56fe\u652f\u6301\u70b9\u51fb\u5c55\u73b0\u548c\u4e0b\u94bb\u5355\u4e2a\u670d\u52a1\u7684\u6027\u80fd\u7edf\u8ba1\u3001Tracing\u3001\u544a\u8b66\uff0c\u4e5f\u53ef\u4ee5\u70b9\u51fb\u62d3\u6251\u56fe\u4e2d\u7684\u5173\u7cfb\u7ebf\uff0c\u5c55\u793a\u670d\u52a1\u4e4b\u95f4\u3001\u670d\u52a1\u793a\u4f8b\u95f4\u7684\u6027\u80fd Metrics\u3002\\n\\n### \u652f\u6301\u5bb9\u5668\u5316\u90e8\u7f72\\n\\nKubernetes \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4e91\u539f\u751f\u5bb9\u5668\u5316\u96c6\u7fa4\u7ba1\u7406\u5e73\u53f0\uff0c\u76ee\u6807\u662f\u8ba9\u90e8\u7f72\u5bb9\u5668\u5316\u7684\u5e94\u7528\u7b80\u5355\u4e14\u9ad8\u6548\u3002Apache SkyWalking \u540e\u53f0\u53ef\u4ee5\u90e8\u7f72\u5728 Kubernetes \u4e4b\u4e2d\uff0c\u800c\u4e14\u5f97\u76ca\u4e8e Kubernetes \u7684\u9ad8\u6548\u7387\u7ba1\u7406\uff0c\u53ef\u4ee5\u4fdd\u8bc1 UI \u7ec4\u4ef6\u7684\u9ad8\u53ef\u7528\u6027\u3002\\n\\n\u5982\u679c\u5728\u96c6\u7fa4\u4e0a\u90e8\u7f72\u4e86 Apache APISIX\uff0cApache SkyWalking \u652f\u6301\u4ee5 sidecar \u6216\u670d\u52a1\u53d1\u73b0\u7684\u5f62\u5f0f\u90e8\u7f72 SkyWalking Satellite\uff0c\u76d1\u63a7\u96c6\u7fa4\u4e2d\u7684 Apache APISIX\u3002\\n\\n## \u672a\u6765\u8ba1\u5212\\n\\nApache APISIX \u5728\u672a\u6765\u4ecd\u4f1a\u7ee7\u7eed\u52a0\u5f3a\u53ef\u89c2\u6d4b\u6027\u76f8\u5173\u7684\u529f\u80fd\u652f\u6301\uff0c\u4f8b\u5982\uff1a\\n\\n1. \u89e3\u51b3 SkyWalking Nginx-Lua \u63d2\u4ef6\u7684 peer \u7f3a\u5931\u95ee\u9898\\n\\n2. \u652f\u6301\u5728\u65e5\u5fd7\u4e2d\u6253\u5370 trace id\\n\\n3. \u63a5\u5165\u8bbf\u95ee\u65e5\u5fd7\\n\\n4. \u652f\u6301\u7f51\u5173\u5143\u6570\u636e\\n\\n## \u7ed3\u8bed\\n\\n\u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u4ee5\u53ca\u5982\u4f55\u901a\u8fc7 Apache SkyWalking \u63d0\u5347Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u3002\u672a\u6765\u4e24\u4e2a\u793e\u533a\u8fd8\u4f1a\u7ee7\u7eed\u6df1\u5ea6\u5408\u4f5c\uff0c\u8fdb\u4e00\u6b65\u589e\u5f3a Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\u3002\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u591a\u591a\u5730\u53c2\u4e0e\u5230 Apache APISIX \u548c Apache SkyWalking \u9879\u76ee\u4e2d\u6765\u3002\u5982\u679c\u4f60\u5bf9\u8fd9\u4e24\u4e2a\u5f00\u6e90\u9879\u76ee\u5f88\u611f\u5174\u8da3\uff0c\u5374\u4e0d\u719f\u6089\u4ee3\u7801\uff0c\u5199\u6587\u7ae0\u3001\u505a\u89c6\u9891\u3001\u5bf9\u5916\u5206\u4eab\u3001\u79ef\u6781\u53c2\u4e0e\u793e\u533a\u548c\u90ae\u4ef6\u5217\u8868\u8ba8\u8bba\u90fd\u662f\u5f88\u4e0d\u9519\u65b9\u5f0f\u3002"},{"id":"Apache APISIX \u5982\u4f55\u901a\u8fc7\u7f51\u5173\u5c42\u4e3a Airwallex \u6570\u636e\u4e3b\u6743\u4fdd\u9a7e\u62a4\u822a","metadata":{"permalink":"/zh/blog/2021/11/03/airwallex-usercase","source":"@site/blog/2021/11/03/airwallex-usercase.md","title":"Apache APISIX \u5982\u4f55\u901a\u8fc7\u7f51\u5173\u5c42\u4e3a Airwallex \u6570\u636e\u4e3b\u6743\u4fdd\u9a7e\u62a4\u822a","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 Airwallex \u7a7a\u4e2d\u4e91\u6c47\u662f\u5982\u4f55\u4f7f\u7528\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fdb\u884c\u7f51\u5173\u5c42\u90e8\u7f72\u6765\u52a0\u56fa\u6570\u636e\u4e3b\u6743\u65b9\u9762\u7684\u5efa\u8bbe\u4ee5\u53ca\u767b\u5f55\u4e0e\u5bc6\u7801\u91cd\u7f6e\u3001\u590d\u6742\u573a\u666f\u4e0b\u7684\u4e1a\u52a1\u64cd\u4f5c\u7b49\u573a\u666f\u3002","date":"2021-11-03T00:00:00.000Z","formattedDate":"2021\u5e7411\u67083\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":14.725,"truncated":true,"authors":[{"name":"\u674e\u6768"}],"prevItem":{"title":"\u6d45\u8c08 Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027","permalink":"/zh/blog/2021/11/04/skywalking"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff0810.15-10.31\uff09","permalink":"/zh/blog/2021/11/02/weekly-report-1031"}},"content":"> \u672c\u6587\u5c06\u4e3a\u5927\u5bb6\u5e26\u6765\u5173\u4e8e Airwallex \u7a7a\u4e2d\u4e91\u6c47\u662f\u5982\u4f55\u4f7f\u7528 Apache APISIX \u8fdb\u884c\u7f51\u5173\u5c42\u90e8\u7f72\u6765\u52a0\u56fa\u6570\u636e\u4e3b\u6743\u65b9\u9762\u7684\u5efa\u8bbe\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4f5c\u8005\u674e\u6768\u535a\u58eb\uff0cApache APISIX Committer\uff0cAirwallex \u7a7a\u4e2d\u4e91\u6c47\u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\uff0c\u8d1f\u8d23\u516c\u53f8\u6280\u672f\u5e73\u53f0\u7684\u6f14\u8fdb\u3002\u66fe\u5c31\u804c\u4e8e\u4e07\u5411\u533a\u5757\u94fe\u9886\u5bfc\u8fd0\u94fe\u76df\u548c\u82b1\u65d7\u96c6\u56e2\u9886\u5bfc OTC \u884d\u751f\u54c1\u98ce\u63a7\u5e73\u53f0\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u8981\u5904\u7406\u6570\u636e\u4e3b\u6743\\n\\n[Airwallex \u7a7a\u4e2d\u4e91\u6c47](https://www.airwallex.com/cn)\u662f\u4e00\u5bb6\u5168\u7403\u91d1\u878d\u79d1\u6280\u516c\u53f8\uff0c\u5e2e\u52a9\u5168\u7403\u7528\u6237\u8fdb\u884c\u6536\u4ed8\u6b3e\u670d\u52a1\u4ee5\u53ca\u8de8\u5883\u652f\u4ed8\u7b49\u573a\u666f\u3002\u6784\u5efa\u4e86\u5168\u7403\u91d1\u878d\u57fa\u7840\u8bbe\u65bd\u5e73\u53f0\uff0c\u652f\u4ed8\u7f51\u7edc\u5df2\u8986\u76d6\u5168\u7403 130 \u591a\u4e2a\u56fd\u5bb6\u548c\u5730\u533a\u7684 50 \u4f59\u79cd\u8d27\u5e01\uff0c\u4e3a\u4f01\u4e1a\u63d0\u4f9b\u6570\u5b57\u5316\u7684\u91d1\u878d\u79d1\u6280\u4ea7\u54c1\u3002\\n\\n![\u7a7a\u4e2d\u4e91\u6c47\u4e1a\u52a1](https://static.apiseven.com/202108/1635907812263-929d9f89-2bee-403e-9641-2e18b077e1b3.png)\\n\\n\u5168\u7403\u5316\u670d\u52a1\u5185\u5bb9\u9700\u6c42\u4e0b\uff0c\u516c\u53f8\u4e1a\u52a1\u7684\u8fdb\u884c\u52bf\u5fc5\u8981\u8003\u8651\u6570\u636e\u4e3b\u6743\u7684\u98ce\u9669\u3002\\n\\n### \u4ec0\u4e48\u662f\u6570\u636e\u4e3b\u6743\\n\\n\u6570\u636e\u4e3b\u6743\u662f\u6307\u7f51\u7edc\u7a7a\u95f4\u4e2d\u7684\u56fd\u5bb6\u4e3b\u6743\uff0c\u4f53\u73b0\u4e86\u56fd\u5bb6\u4f5c\u4e3a\u63a7\u5236\u6570\u636e\u6743\u7684\u4e3b\u4f53\u5730\u4f4d\u3002\u5728\u63cf\u8ff0\u6570\u636e\u4e3b\u6743\u91cd\u8981\u6027\u4e4b\u524d\uff0c\u6211\u4eec\u7b80\u5355\u4e3e\u51e0\u4e2a\u4f8b\u5b50\u3002\\n\\nGDPR\uff08General Data Protection Regulation\uff0c\u300a\u901a\u7528\u6570\u636e\u4fdd\u62a4\u6761\u4f8b\u300b\uff09\u662f\u6b27\u76df\u5236\u5b9a\u7684\u76d1\u7ba1\u6587\u4ef6\uff0c\u662f\u9488\u5bf9\u4e2a\u4eba\u6570\u636e\u7684\u9690\u79c1\u548c\u4fdd\u62a4\u7684\u6761\u4f8b\u3002GDPR \u4e2d\u6709\u4e00\u6761\u6700\u57fa\u672c\u7684\u8981\u6c42\uff0c\u6240\u6709\u7684\u7528\u6237\u6570\u636e\u6536\u96c6\u884c\u4e3a\u90fd\u9700\u8981\u7ecf\u8fc7\u7528\u6237\u7684\u540c\u610f\uff0c\u540c\u65f6\u8fd8\u8981\u4fdd\u8bc1\u7528\u6237\u53ef\u4ee5\u81ea\u884c\u6e05\u9664\u4e2a\u4eba\u6570\u636e\u3002\\n\\n\u6240\u4ee5\u5982\u679c Airwallex \u7a7a\u4e2d\u4e91\u6c47\u8981\u628a\u6b27\u6d32\u7684\u6570\u636e\u8f6c\u79fb\u5230\u5176\u4ed6\u5730\u533a\u65f6\uff0c\u5c31\u5fc5\u987b\u8981\u4fdd\u8bc1\u7b2c\u4e09\u65b9\u56fd\u5bb6\u5bf9\u6570\u636e\u4e3b\u6743\u7684\u8981\u6c42\u7b26\u5408\u6b27\u76df\u5bf9\u6570\u636e\u4e3b\u6743\u7684\u8981\u6c42\u3002\\n\\n\u5173\u4e8e\u6570\u636e\u9700\u8981\u7b26\u5408\u5730\u65b9\u6cd5\u6848\u7684\u95ee\u9898\uff0c\u8de8\u56fd\u4e1a\u52a1\u4e0b\u786e\u5b9e\u9700\u8981\u987e\u8651\u5f88\u591a\u3002\\n\\n\u6bd4\u5982\u300a\u7f8e\u56fd\u7231\u56fd\u8005\u6cd5\u6848\u300b\u8981\u6c42\u6240\u6709\u5728\u7f8e\u56fd\u5883\u5185\u5b58\u50a8\u6570\u636e\uff0c\u6216\u8005\u7f8e\u56fd\u516c\u53f8\u5b58\u50a8\u7684\u6570\u636e\uff0c\u90fd\u5728\u7f8e\u56fd\u7684\u76d1\u7ba1\u8303\u56f4\uff0c\u7f8e\u56fd\u7684\u53f8\u6cd5\u90e8\u3001CIA \u53ef\u4ee5\u8981\u6c42\u516c\u53f8\u63d0\u4f9b\u6570\u636e\u3002\\n\\n\u5728 2013 \u5e74 911 \u4e8b\u4ef6\u4e4b\u540e\uff0c\u7f8e\u56fd\u53f8\u6cd5\u90e8\u8981\u6c42\u5fae\u8f6f\u63d0\u4f9b\u5176\u5728\u7231\u5c14\u5170\u670d\u52a1\u5668\u4e0a\u5b58\u50a8\u7684\u4e00\u4e9b\u90ae\u4ef6\u4fe1\u606f\uff0c\u5f53\u65f6\u5fae\u8f6f\u4ee5\u4f1a\u8fdd\u53cd\u6b27\u76df\u76d1\u7ba1\u8981\u6c42\u7684\u7406\u7531\u62d2\u7edd\u4e86\u7f8e\u56fd\u53f8\u6cd5\u90e8\u8bf7\u6c42\u3002\u7136\u540e\u7f8e\u56fd\u53f8\u6cd5\u90e8\u5c06\u5fae\u8f6f\u544a\u4e0a\u6cd5\u5ead\uff0c\u4f46\u662f\u6700\u540e\u5fae\u8f6f\u80dc\u8bc9\u3002\u540e\u6765\uff0c\u7f8e\u56fd\u5f88\u591a\u516c\u53f8\u4e3a\u4e86\u907f\u514d\u6570\u636e\u4e3b\u6743\u53cd\u9762\u7684\u98ce\u9669\uff0c\u628a\u6570\u636e\u4e2d\u5fc3\u76f4\u63a5\u653e\u5230\u4e86\u6b27\u6d32\uff0c\u8ba4\u4e3a\u8fd9\u6837\u5c31\u5b89\u5168\u4e86\u3002\u4f46\u662f\u6700\u8fd1\u5728\u4e00\u4e9b\u6848\u4f8b\u4e2d\u6cd5\u5b98\u5224\u5b9a\uff0c\u7f8e\u56fd\u4ecd\u7136\u662f\u6709\u6743\u9650\u53bb\u7d22\u8981\u7f8e\u56fd\u516c\u53f8\u5728\u6b27\u6d32\u7684\u6570\u636e\u3002\\n\\n\u4ece\u4ee5\u4e0a\u4e8b\u4ef6\u6765\u770b\uff0c\u6570\u636e\u4e3b\u6743\u786e\u5b9e\u4e3a Airwallex \u7a7a\u4e2d\u4e91\u6c47\u7684\u5168\u7403\u4e1a\u52a1\u5e26\u4e86\u5f88\u5927\u7684\u6311\u6218\uff0c\u5982\u4f55\u5728\u4e1a\u52a1\u4e2d\u5c06\u6570\u636e\u4e3b\u6743\u95ee\u9898\u5904\u7406\u5f97\u5f53\u4e5f\u53d8\u5f97\u5c24\u4e3a\u91cd\u8981\u3002\\n\\n### \u8de8\u56fd\u4e1a\u52a1\u6570\u636e\u4f20\u8f93\u73b0\u72b6\\n\\n\u7531\u4e8e\u4e1a\u52a1\u6d89\u53ca\u5230\u8de8\u56fd\u5c5e\u6027\uff0c\u6240\u4ee5\u5728\u6280\u672f\u5904\u7406\u4e2d\u4f1a\u9047\u5230\u4e00\u4e9b\u95ee\u9898\u3002\\n\\n![\u4e1a\u52a1\u6d41\u7a0b](https://static.apiseven.com/202108/1635907812252-3d427136-b986-4ac5-a853-d9bbbb4439d3.png)\\n\\n\u8de8\u56fd\u516c\u53f8\u7684\u6570\u636e\u6d41\u901a\u4f53\u73b0\u5728\u5404\u4e2a\u5730\u533a\u4e4b\u95f4\u7684\u591a\u79cd\u4ea4\u4e92\u3002\u5728\u6ca1\u6709\u6570\u636e\u4e3b\u6743\u8981\u6c42\u65f6\uff0c\u6570\u636e\u53ef\u4ee5\u5b58\u653e\u5728\u6b27\u6d32\uff0c\u7136\u540e\u540c\u6b65\u5230\u4e9a\u6d32\u6216\u8005\u5168\u7403\u4efb\u4f55\u4e00\u4e2a\u6570\u636e\u4e2d\u5fc3\u3002\u540e\u7eed\u8fdb\u884c\u6570\u636e\u4e1a\u52a1\u8bf7\u6c42\u65f6\uff0c\u53ea\u9700\u5c06\u4e1a\u52a1\u5c01\u88c5\u5230\u4e00\u4e2a\u670d\u52a1\u91cc\u5373\u53ef\u3002\\n\\n\u4f46\u5728\u5f53\u4e0b\u91cd\u89c6\u6570\u636e\u4e3b\u6743\u7684\u65f6\u4ee3\uff0c\u4e0a\u8ff0\u65b9\u6cd5\u5c31\u884c\u4e0d\u901a\u4e86\u3002\u56e0\u4e3a\u5f88\u591a\u6570\u636e\u7684\u6d41\u901a\u5f00\u59cb\u53d7\u7ba1\u63a7\uff0c\u65e0\u6cd5\u6cbf\u7528\u4e4b\u524d\u7684\u67b6\u6784\u3002\u672c\u56fd\u6570\u636e\u53ea\u5141\u8bb8\u672c\u56fd\u5f53\u5730\u5904\u7406\uff0c\u4e0d\u53ef\u8de8\u56fd\u8bf7\u6c42\u5904\u7406\u3002\u6240\u4ee5\u5f53\u6211\u4eec\u628a\u7528\u6237\u6570\u636e\u5b58\u50a8\u5728\u7528\u6237\u672c\u56fd\u8303\u56f4\uff08\u5373\u4e0b\u56fe\u300c\u72ec\u81ea\u5c01\u95ed\u300d\u67b6\u6784\uff09\u5185\u65f6\uff0c\u95ee\u9898\u5c31\u5f00\u59cb\u6d8c\u73b0\u4e86\u3002\\n\\n![\u5355\u72ec\u90e8\u7f72](https://static.apiseven.com/202108/1635907812255-73d11508-d9ec-4ac6-b0a0-5913a1acb2c8.png)\\n\\n\u9996\u5148\u8fd9\u79cd\u60c5\u51b5\u4e0b\u65e0\u6cd5\u8ba9\u670d\u52a1\u505a\u5230\u5b8c\u5168\u65e0\u72b6\u6001\u6a21\u5f0f\uff0c\u540c\u65f6\u5728\u5b9e\u9645\u4e1a\u52a1\u4e2d\u7edd\u5927\u90e8\u5206\u573a\u666f\u5e76\u4e0d\u4f1a\u8fd9\u4e48\u7b80\u5355\u3002\u56e0\u4e3a\u4e1a\u52a1\u7684\u5b8c\u6210\uff0c\u52bf\u5fc5\u4f1a\u6d89\u53ca\u5230\u591a\u96c6\u7fa4\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002\\n\\n![\u591a\u96c6\u7fa4\u4ea4\u4e92](https://static.apiseven.com/202108/1635907812257-962b1247-f5ca-448f-904d-fd47c3ea4586.png)\\n\\n\u6240\u4ee5\u5728\u6570\u636e\u5b58\u50a8\u65b9\u9762\uff0c\u9996\u5148\u8981\u89e3\u51b3\u7684\u95ee\u9898\u5c31\u662f\u5728\u6570\u636e\u5165\u53e3\u5904\u8fdb\u884c\u5730\u533a/\u533a\u57df\u8fa8\u522b\u914d\u7f6e\u3002\u5c31\u50cf\u4e9a\u9a6c\u900a\u4e00\u6837\uff0c\u7528\u6237\u5728\u7f8e\u533a\u8d2d\u4e70\u7684\u7535\u5b50\u4e66\uff0c\u662f\u65e0\u6cd5\u7528\u56fd\u533a\u8d26\u53f7\u4e0b\u8f7d\u5230\u81ea\u5df1 Kindle \u4e0a\u3002\u56e0\u4e3a\u5404\u4e2a\u56fd\u5bb6\uff08\u533a\u57df\uff09\u4e4b\u95f4\u7684\u6570\u636e\u662f\u5b8c\u5168\u9694\u79bb\u7684\u3002\u53ea\u8981\u7528\u6237\u70b9\u51fb\u4e86\u4e9a\u9a6c\u900a\u4e2d\u56fd\u7ad9\uff0c\u5c31\u610f\u5473\u7740\u4f60\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4e0d\u4f1a\u8de8\u51fa\u4e2d\u56fd\u6570\u636e\u4e2d\u5fc3\u3002\\n\\n\u4e9a\u9a6c\u900a\u7684\u8fd9\u79cd\u64cd\u4f5c\u6a21\u5f0f\u5176\u5b9e\u5c31\u662f\u8ba9\u7528\u6237\u81ea\u5df1\u51b3\u5b9a\u5c06\u4e2a\u4eba\u6570\u636e\u5b58\u50a8\u5728\u54ea\u4e2a\u5730\u533a\uff0c\u4f46\u662f\u968f\u4e4b\u5e26\u6765\u7684\u95ee\u9898\u5c31\u662f\u5355\u4eba\u591a\u5730\u533a\u8d26\u53f7\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u4e8e\u4e2a\u4eba\u7528\u6237\u800c\u8a00\u662f\u975e\u5e38\u4e0d\u65b9\u4fbf\u8fdb\u884c\u7ba1\u7406\u4e0e\u540c\u6b65\u7684\u3002\\n\\n\u6240\u4ee5\u5bf9\u4e8e\u591a\u5730\u533a\u591a\u573a\u666f\u4e0b\u7684\u4e1a\u52a1\u5904\u7406\uff0c\u5e94\u8be5\u8fd8\u9700\u8981\u4e00\u4e2a\u300c\u5229\u5668\u300d\u6765\u8fdb\u884c\u52a8\u6001\u5206\u914d\u51b3\u5b9a\u540e\u7eed\u6570\u636e\u8d70\u5411\u3002\\n\\n## \u6253\u9020 Apache APISIX \u667a\u80fd\u8def\u7531\u7f51\u5173\\n\\n\u6240\u4ee5\u57fa\u4e8e\u4e0a\u8ff0\u4e1a\u52a1\u573a\u666f\uff0c\u6211\u4eec\u51b3\u5b9a\u91c7\u53d6\u300c\u667a\u80fd\u8def\u7531\u300d\u6a21\u5f0f\uff0c\u901a\u8fc7\u7f51\u5173\u6765\u51b3\u5b9a\u4e0d\u540c\u7c7b\u578b\u6570\u636e\u8bf7\u6c42\u7684\u843d\u811a\u70b9\u4e0e\u8d70\u5411\u3002\\n\\n![\u667a\u80fd\u8def\u7531\u6a21\u5f0f](https://static.apiseven.com/202108/1635907812259-59637175-4beb-4e1e-a813-bb7c40a5acf9.png)\\n\\n\u5982\u4e0a\u56fe\u5c31\u662f\u300c\u667a\u80fd\u8def\u7531\u300d\u6a21\u5f0f\u4e0b\u7684\u67b6\u6784\u56fe\u3002\u7f51\u5173\u4e3b\u8981\u5206\u4e3a\u4e24\u5c42\uff0c\u7b2c\u4e00\u5c42\u8d1f\u8d23\u8def\u7531\u8bf7\u6c42\uff0c\u6839\u636e\u6761\u4ef6\u6765\u5224\u65ad\u8bf7\u6c42\u5e94\u5230\u8fbe\u54ea\u4e2a\u6570\u636e\u4e2d\u5fc3\uff1b\u7b2c\u4e8c\u5c42\u7f51\u5173\u5219\u662f\u8fdb\u884c\u6d41\u91cf\u8f6c\u53d1\u3002\u6240\u4ee5\u7f51\u5173\u5728\u8fd9\u4e2a\u6a21\u5f0f\u4e2d\u4e3b\u8981\u89e3\u51b3\u7684\u95ee\u9898\u5c31\u662f\u7ed9\u6bcf\u4e2a\u8bf7\u6c42\u5206\u914d\u597d\u300c\u5f52\u5bbf\u300d\uff0c\u7136\u540e\u8fdb\u884c\u540e\u7eed\u7684\u6d41\u91cf\u8f6c\u53d1\u4e0e\u4e1a\u52a1\u5904\u7406\u3002\\n\\n\u76ee\u524d\u6211\u4eec\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u6d41\u91cf\u4fe1\u606f\u4e3b\u8981\u5206\u4e3a\u4e24\u7c7b\uff1a\\n\\n- \u4e0d\u660e\u8eab\u4efd\u8bf7\u6c42\\n  - \u6ce8\u518c\uff1a\u7528\u6237\u7b2c\u4e00\u6b21\u6ce8\u518c\u65f6\u4fe1\u606f\u4e0d\u5168\uff0c\u4e0d\u77e5\u9053\u6b64\u7528\u6237\u7684\u6ce8\u518c\u6570\u636e\u653e\u5728\u54ea\u4e2a\u6570\u636e\u4e2d\u5fc3\\n  - \u9759\u6001\u8d44\u6e90\uff1a\u6bd4\u5982 HTML\u3001CSS\uff0c\u8fd9\u4e9b\u4e0d\u9700\u8981\u77e5\u9053\u7528\u6237\u8eab\u4efd\\n\\n- \u5df2\u77e5\u8eab\u4efd\u8bf7\u6c42\\n  - \u767b\u5f55\uff1a\u7528\u6237\u767b\u5f55\uff0c\u8bf4\u660e\u5df2\u5b8c\u6210\u6ce8\u518c\u6d41\u7a0b\uff0c\u6b64\u65f6\u5df2\u77e5\u6570\u636e\u4e2d\u5fc3\u5728\u54ea\\n  - \u5bc6\u7801\u91cd\u7f6e\uff1a\u53ef\u4ee5\u901a\u8fc7\u7528\u6237\u540d\u3001\u624b\u673a\u53f7\u3001\u90ae\u7bb1\u3001\u57ce\u5e02\u7b49\u4fe1\u606f\u53cd\u67e5\u6570\u636e\u5728\u54ea\uff0c\u518d\u8fdb\u884c\u540e\u7eed\u8bf7\u6c42\u7684\u5206\u53d1\\n  - \u590d\u6742\u573a\u666f\u4e0b\u7684\u4e1a\u52a1\u64cd\u4f5c\\n\\n\u5728\u7f51\u5173\u5c42\u9762\u7684\u90e8\u7f72\u4e0a\uff0c\u6211\u4eec\u91c7\u7528\u4e86 [Apache APISIX](https://github.com/apache/apisix)\u3002\u63a5\u4e0b\u6765\u5c31\u7b80\u5355\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e0b\uff0c\u6211\u4eec\u5982\u4f55\u57fa\u4e8e Apache APISIX \u7684 API \u7f51\u5173\u6765\u8fdb\u884c\u52a8\u6001\u3001\u591a\u6570\u636e\u4e2d\u5fc3\u7684\u8def\u7531\u573a\u666f\u5904\u7406\u3002\\n\\n### \u573a\u666f\u4e00\uff1a\u767b\u9646\u4e0e\u5bc6\u7801\u91cd\u7f6e\\n\\n\u7528\u6237\u767b\u5f55\u65f6\u6211\u4eec\u80fd\u62ff\u5230\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u4f46\u662f\u5bc6\u7801\u662f\u4e0d\u80fd\u4f5c\u4e3a\u8bc6\u522b\u4fe1\u606f\u7684\uff0c\u800c\u4e14\u4e5f\u4e0d\u5141\u8bb8\u968f\u4fbf\u4f20\u9012\u3002\u6240\u4ee5\u53ea\u80fd\u6839\u636e\u7528\u6237\u540d\u67e5\u8be2\uff0c\u5224\u65ad\u8fd9\u4e2a\u7528\u6237\u662f\u5c5e\u4e8e\u54ea\u4e2a\u5730\u533a\u7684\u3002\u4e1a\u52a1\u4e0a\u662f\u9700\u8981\u8bbe\u8ba1\u4e00\u4e2a\u5168\u7403\u80fd\u591f\u540c\u6b65\u7684\u6570\u636e\u5b58\u50a8\u3002\\n\\n![\u767b\u9646\u6a21\u5f0f](https://static.apiseven.com/202108/1635907812260-69fbda9e-56cc-443d-8ea7-a1f10dba041e.png)\\n\\n\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u5982\u4e0a\u6240\u793a\u7684\u6570\u636e\u5b58\u50a8\u67b6\u6784\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5168\u7403\u5316\u7684\u6570\u636e\u540c\u6b65\u3002\u6bd4\u5982\uff1a\u4e00\u4f4d\u7528\u6237\u5728\u4e2d\u56fd\u6ce8\u518c\u8d26\u53f7\uff0c\u6211\u4eec\u901a\u8fc7 CDC\uff08Change Data Capture\uff09\u628a\u76f8\u5173\u6570\u636e\u8f6c\u5316\u6210 Kafka message\uff0c\u901a\u8fc7\u4e13\u95e8\u7684 listener \u8fdb\u884c\u672c\u5730\u6d88\u606f\u7684\u63a5\u6536\uff0c\u7136\u540e\u505a\u8fdb\u4e00\u6b65\u7684\u8f6c\u5316\u3002\u5982\uff1a\u53bb\u9664\u7528\u6237\u540d\u3001Email \u7b49\u4e2a\u4eba\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u90fd\u662f\u4e0d\u80fd\u8de8\u5883\u5b58\u50a8\u7684\u3002\\n\\n\u5728\u8f6c\u5316\uff08Transformer\uff09\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u8fdb\u884c\u52a0\u76d0\u6216\u8005\u54c8\u5e0c\u52a0\u5bc6\u5904\u7406\uff0c\u6700\u540e\u5728\u7f51\u5173\u5c42\u8fdb\u884c\u76f8\u5173\u7684\u4e1a\u52a1\u8bf7\u6c42\u5904\u7406\uff0c\u5373\u6570\u636e\u533a\u57df\u5206\u914d\u53ca\u540e\u7eed\u7684\u6d41\u91cf\u8f6c\u53d1\u3002\u5b9e\u73b0\u57fa\u4e8e Apache APISIX \u7f51\u5173\u5c42\u9762\u7684\u4e1a\u52a1\u5904\u7406\u3002\\n\\n### \u573a\u666f\u4e8c\uff1a\u590d\u6742\u573a\u666f\u4e0b\u7684\u4e1a\u52a1\u64cd\u4f5c\\n\\n\u4e1a\u52a1\u64cd\u4f5c\u662f\u5f53\u64cd\u4f5c\u4e00\u7b14\u6570\u636e\u65f6\uff0c\u6211\u5e94\u8be5\u7528\u600e\u6837\u7684\u65b9\u5f0f\u51b3\u5b9a\u8fd9\u7b14\u6570\u636e\u53bb\u54ea\u91cc\u6267\u884c\u3002\u5e38\u89c4\u7684\u4e1a\u52a1\u64cd\u4f5c\u6bd4\u5982\u67d0\u7528\u6237\u67e5\u8be2\u81ea\u5df1\u7684\u8d26\u6237\u4fe1\u606f\u6216\u5386\u53f2\u8bb0\u5f55\u7b49\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e00\u822c\u5206\u4e3a\u4e24\u79cd\u6a21\u5f0f\u3002\\n\\n![\u4e1a\u52a1\u64cd\u4f5c\u6a21\u5f0f](https://static.apiseven.com/202108/1635907812247-123eca67-5039-487c-9d02-f3881e16c411.png)\\n\\n#### \u6709\u72b6\u6001\u6a21\u5f0f\\n\\n\u6709\u72b6\u6001\u6a21\u5f0f\u4e00\u822c\u4f1a\u5229\u7528 Session\uff08\u5982\u4e0a\u56fe\u5de6\u4fa7\uff09\uff0c\u5ba2\u6237\u7aef\u767b\u5f55\u5b8c\u6210\u540e Sever \u4f1a\u5c06\u9644\u5e26 Session ID \u7684 Cookie \u7ed9\u5230\u5ba2\u6237\u7aef\u3002\u5728\u8bf7\u6c42\u65f6\uff0c\u57fa\u4e8e Apache APISIX \u5b9e\u73b0\u7684\u7f51\u5173\u5c42\u4f1a\u4f7f\u7528 Cookie \u4e2d\u7684\u4fe1\u606f\u67e5\u8be2\u7528\u6237\u6240\u5904\u7684\u5730\u533a\u3002\u5373\u4fbf\u7528\u6237\u66f4\u6362\u4e86\u670d\u52a1\u5668\uff0c\u4f9d\u7136\u53ef\u4ee5\u4fdd\u6301\u767b\u5f55\u72b6\u6001\uff0c\u7cfb\u7edf\u4e5f\u53ef\u4ee5\u5224\u5b9a\u4ece\u54ea\u91cc\u83b7\u53d6\u6570\u636e\u3002\\n\u6bd4\u5982\u7528\u6237\u6b63\u5728\u8fdb\u884c\u8de8\u56fd\u65c5\u884c\uff0c\u6700\u521d\u5728\u6b27\u6d32\u767b\u5f55\u7cfb\u7edf\uff0c\u5750\u98de\u673a\u6765\u5230\u4e86\u4e9a\u6d32\u3002\u5728\u4e9a\u6d32\u767b\u5f55\u65f6\u7cfb\u7edf\u4f1a\u901a\u8fc7 Session \u5224\u65ad\u8be5\u7528\u6237\u4fe1\u606f\u5904\u4e8e\u54ea\u4e2a\u6570\u636e\u4e2d\u5fc3\uff0c\u5c31\u4f1a\u628a\u8bf7\u6c42\u5206\u53d1\u7ed9\u5bf9\u5e94\u6570\u636e\u4e2d\u5fc3\u8fdb\u884c\u540e\u7eed\u4e1a\u52a1\u64cd\u4f5c\u3002\\n\\n#### \u65e0\u72b6\u6001\u6a21\u5f0f\\n\\n\u901a\u5e38\u6211\u4eec\u4e0d\u4f1a\u4ec5\u63d0\u4f9b\u7f51\u9875\u8bbf\u95ee\u8fd9\u6837\u4e00\u4e2a\u529f\u80fd\uff0c\u8fd8\u4f1a\u6709\u4e00\u4e9b API \u8bbf\u95ee\u8fdb\u884c\u96c6\u6210\u3002\u6240\u4ee5\u5f53\u8fdb\u884c API \u8bbf\u95ee\u65f6\uff0c\u901a\u8fc7 Cookie \u4f20\u9012 Session ID \u7684\u65b9\u5f0f\u662f\u4e0d\u5408\u9002\u7684\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u91c7\u7528\u4e86\u4e00\u4e2a\u7279\u6b8a\u7684 Token\uff08\u5982\u4e0a\u56fe\u53f3\u4fa7\uff09\u3002Token \u5185\u4f1a\u5305\u542b\u6240\u5904\u6570\u636e\u4e2d\u5fc3\u7684\u5177\u4f53\u4fe1\u606f\uff0c\u8fd9\u6837 Apache APISIX \u5c31\u53ef\u4ee5\u6839\u636e Token \u51b3\u5b9a\u8bbf\u95ee\u54ea\u4e2a\u6570\u636e\u4e2d\u5fc3\u3002\\n\\n\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u5f53\u540e\u7eed\u8fdb\u884c\u4e1a\u52a1\u6269\u5c55\u65f6\uff0c\u80fd\u591f\u4fdd\u6301\u52a8\u6001\u6027\u3002\u5982\u679c\u6700\u521d\u662f\u9759\u6001\u8bbe\u8ba1\uff0c\u57fa\u4e8e\u6700\u5f00\u59cb\u6ce8\u518c\u65f6\u7684\u4fe1\u606f\u51b3\u5b9a\u6570\u636e\u4e2d\u5fc3\uff0c\u90a3\u4e48\u672a\u6765\u51fa\u73b0\u8de8\u6570\u636e\u4e2d\u5fc3\u573a\u666f\u65f6\u5c31\u4f1a\u975e\u5e38\u96be\u5904\u7406\u3002\\n\\n\u65e0\u72b6\u6001\u6a21\u5f0f\u4e0b\u8fd8\u6709\u4e00\u79cd\u573a\u666f\u4e5f\u662f\u6bd4\u8f83\u590d\u6742\u7684\uff0c\u5c31\u662f\u7528\u6237\u6ce8\u518c\u3002\u56e0\u4e3a\u6ce8\u518c\u65f6\u53ea\u80fd\u6839\u636e\u7528\u6237\u586b\u5199\u7684\u6ce8\u518c\u4fe1\u606f\uff0c\u51b3\u5b9a\u653e\u5230\u54ea\u4e2a\u6570\u636e\u4e2d\u5fc3\u3002\u4f46\u5047\u5982\u540e\u671f\u7528\u6237\u79fb\u6c11\u4e86\uff0c\u6216\u8005\u516c\u53f8\u8fc1\u79fb\u5230\u522b\u7684\u5730\u65b9\uff0c\u6211\u4eec\u5c31\u8981\u505a\u76f8\u5173\u7684\u6570\u636e\u6e05\u9664\uff0c\u628a\u7528\u6237\u7684\u4ea4\u6613\u6570\u636e\u3001\u7528\u6237\u540d\u3001\u5bc6\u7801\u7b49\u5168\u90e8\u8fc1\u79fb\u5230\u53e6\u5916\u4e00\u4e2a\u6570\u636e\u4e2d\u5fc3\u3002\u8fd9\u79cd\u6570\u636e\u5207\u6362\u6210\u672c\u5176\u5b9e\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u76ee\u524d\u6211\u4eec\u5185\u90e8\u4e5f\u662f\u652f\u6301\u7528\u6237\u5207\u6362\u6570\u636e\u4e2d\u5fc3\u8fd9\u6837\u590d\u6742\u7684\u573a\u666f\uff0c\u4f46\u540e\u9762\u4e5f\u4f1a\u5f00\u59cb\u8003\u8651\u600e\u6837\u51cf\u5c11\u5207\u6362\u6570\u636e\u4e2d\u5fc3\u5bf9\u6574\u4f53\u67b6\u6784\u7684\u5f71\u54cd\u3002\\n\\n## \u5173\u4e8e\u6570\u636e\u4e3b\u6743\u7684\u6001\u5ea6\\n\\n\u5176\u5b9e\u524d\u8fb9\u6211\u4eec\u63d0\u5230\u7684\u6240\u6709\u5185\u5bb9\uff0c\u90fd\u5728\u8bf4\u660e\u4e00\u4e2a\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u300c\u6570\u636e\u548c\u6240\u5c5e\u5730\u300d\u3002\u4f46\u662f\u5728\u8fdb\u884c\u6570\u636e\u6240\u5c5e\u5730\u5212\u5206\u4e4b\u524d\uff0c\u6709\u4e00\u4e2a\u524d\u63d0\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u90a3\u5c31\u662f\u4fe1\u606f\u5904\u7406\u5ea6\u3002\\n\\n\u6570\u636e\u662f\u654f\u611f\u7684\uff0c\u5f53\u6211\u4eec\u62ff\u5230\u7528\u6237\u6570\u636e\u8fdb\u884c\u6570\u636e\u5206\u6790/\u5546\u4e1a BI \u6216\u5176\u4ed6\u5927\u6570\u636e\u5206\u6790\u65f6\uff0c\u662f\u4e0d\u80fd\u76f4\u63a5\u62ff\u6765\u5c31\u7acb\u5373\u4f7f\u7528\u7684\u3002\u8981\u5148\u5728\u4e2a\u4eba\u5c42\u9762\u8fdb\u884c\u654f\u611f\u4fe1\u606f\u7684\u8fc7\u6ee4\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u8981\u5728\u6570\u636e\u805a\u5408\u5c42\u9762\uff0c\u5c06\u540c\u4e00\u5730\u533a\u6570\u636e\u6c47\u805a\u770b\u6574\u4f53\u6570\u636e\u65f6\uff0c\u518d\u5bf9\u7528\u6237\u4fe1\u606f\u8fdb\u884c\u518d\u6b21\u62bd\u8c61\u5904\u7406\uff0c\u8fbe\u5230\u65e0\u6cd5\u5b8c\u5168\u8bc6\u522b\u7528\u6237\u7684\u72b6\u6001\u3002\\n\\n\u8fd9\u6837\u624d\u7b26\u5408\u76d1\u7ba1\u7684\u8981\u6c42\uff0c\u624d\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u4fe1\u606f\u7528\u4e8e\u6570\u636e\u5206\u6790\u3002\u8fd9\u662f\u5173\u4e8e\u6570\u636e\u5904\u7406\u6700\u6839\u672c\u7684\u8981\u6c42\uff0c\u6211\u4eec\u5bf9\u6570\u636e\u76d1\u7ba1\u662f\u89c4\u8303\u5316\u7684\u540c\u65f6\uff0c\u4e5f\u8981\u4fdd\u8bc1\u7528\u6237\u4fe1\u606f\u7684\u300c\u5b89\u5168\u5316\u300d\u3002\\n\\n\u5f53\u7136\uff0c\u8fd9\u6b21\u6240\u5206\u4eab\u7684\u57fa\u4e8e Apache APISIX \u8fdb\u884c\u7f51\u5173\u5c42\u9762\u5904\u7406\u6570\u636e\u4e3b\u6743\u53ea\u662f\u5728\u300c\u5e94\u5bf9\u6570\u636e\u4e3b\u6743\u98ce\u9669\u300d\u8fc7\u7a0b\u4e2d\u6240\u505a\u7684\u4e00\u90e8\u5206\u3002\u6211\u4eec\u671f\u671b Apache APISIX \u7f51\u5173\u53ef\u4ee5\u5e2e\u52a9 Airwallex \u5728\u6570\u636e\u4e3b\u6743\u5c42\u9762\u505a\u7684\u66f4\u597d\u66f4\u5b8c\u5584\uff0c\u76ee\u524d\u6765\u770b\uff0cApache APISIX \u5df2\u7ecf\u505a\u5230\u4e86\u6211\u4eec\u671f\u671b\u7684\u90a3\u6837\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff0810.15-10.31\uff09","metadata":{"permalink":"/zh/blog/2021/11/02/weekly-report-1031","source":"@site/blog/2021/11/02/weekly-report-1031.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff0810.15-10.31\uff09","description":"\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002","date":"2021-11-02T00:00:00.000Z","formattedDate":"2021\u5e7411\u67082\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.935,"truncated":true,"authors":[],"prevItem":{"title":"Apache APISIX \u5982\u4f55\u901a\u8fc7\u7f51\u5173\u5c42\u4e3a Airwallex \u6570\u636e\u4e3b\u6743\u4fdd\u9a7e\u62a4\u822a","permalink":"/zh/blog/2021/11/03/airwallex-usercase"},"nextItem":{"title":"Apache APISIX \u6269\u5c55\u6307\u5357","permalink":"/zh/blog/2021/10/26/extension-guide"}},"content":"> \u4ece 10.15 \u5230 10.31, \u6709 31 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 93 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1635733917405-d05ace3d-614a-4e82-bc6b-6a941a2d2281.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1635733917418-d6571655-be42-4819-a9bd-1440d69f4877.31)\\n\\n## Good first issue\\n\\n### Issue #686\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix-website/issues/686\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4e3a\u4e86\u52a0\u5feb Apache APISIX \u5b98\u7f51\u56fe\u7247\u7684\u52a0\u8f7d\u901f\u5ea6\uff0c\u9700\u8981\u5c06\u6240\u6709\u56fe\u7247\u8fc1\u79fb\u5230 CDN\u3002\\n\\n### Issue #5305\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5305\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u6d4b\u8bd5 APISIX \u4e2d\u7684 proxy-mirror \u63d2\u4ef6\u65f6\uff0c\u53d1\u73b0\u8fd9\u4e2a\u63d2\u4ef6\u7684\u7279\u6027\u4e0e nginx \u4e2d\u7684 ngx_http_mirror_module \u4e0d\u540c\u3002 nginx \u7684\u955c\u50cf\u6a21\u5757\u53ef\u4ee5\u5728 \u201cproxy_pass\u201d \u6307\u4ee4\u4e2d\u6dfb\u52a0\u4e3b\u673a\u540e\u9762\u7684 uri\uff0c\u4f8b\u5982\uff1a\\n\\n```Groovy\\nlocation / {\\nmirror /mirror;\\nproxy_pass http://backend;\\n}\\n\\nlocation = /mirror {\\ninternal;\\nproxy_pass http://test_backend$request_uri;\\n}\\n```\\n\\n\u4f46\u662f\u5f53\u6211\u5728 APISIX Dashboard \u4e2d\u6d4b\u8bd5 proxy-mirror \u63d2\u4ef6\u65f6\uff0c\u63d0\u793a\u4e0d\u80fd\u7528 URI \u586b\u5145\u7a7a\u683c\u3002\u662f\u5426\u53ef\u4ee5\u4f18\u5316 proxy-mirror \u63d2\u4ef6\u4ee5\u652f\u6301 URI\uff1f\\n\\n![Issue Screenshot](https://static.apiseven.com/202108/1635734126653-8fe4c1e7-5b9a-4e78-b747-fb30cbae7f36.png)\\n\\n### Issue #5342\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5342\\n\\n**\u95ee\u9898\u63cf\u8ff0**: \u8def\u7531\u4e4b\u95f4\u7684\u9650\u5236\u8ba1\u6570\u5668\uff1a\u9700\u8981\u5728 lrucache \u4e2d\u6307\u5b9a\u8def\u7531\u5bf9\u5e94\u7684 limit-count \u7684 key\uff0c\u8fd9\u6837\u540c\u4e00\u4e2alimit\u5bf9\u8c61\u5c31\u53ef\u4ee5\u5728\u591a\u4e2a\u8def\u7531\u4e2d\u5171\u4eab\u3002lrucache \u7684key\uff08\u4ee5\u4e0b\u79f0\u4e3a group\uff0c\u4ee5\u533a\u522b\u4e8elimit key\uff09\u76ee\u524d\u662f\u81ea\u52a8\u751f\u6210\u7684\uff0c\u786e\u4fdd\u6bcf\u4e2a\u8def\u7531\u7684 group \u662f\u72ec\u7acb\u7684\u3002\u5bf9\u4e8e\u8fd9\u4e00\u53d8\u5316\uff0c\u6211\u4eec\u9700\u8981\u80fd\u591f\u5728 limit-count \u4e2d\u6307\u5b9a\u7ec4\uff1a\\n\\n```yaml\\n\\"limit-count\\": {\\n        \\"group\\": \\"group_id_blah\\"\\n        \\"count\\": 2,\\n        \\"time_window\\": 60,\\n        \\"rejected_code\\": 503,\\n        \\"key\\": \\"remote_addr\\"\\n}\\n```\\n\\n\u6ce8\u610f\uff0c\u540c\u4e00 group \u7684\u914d\u7f6e\u9700\u8981\u76f8\u540c\uff0c\u76ee\u524d\u9700\u8981\u8c03\u7528\u8005\u4fdd\u8bc1\uff0c\u5426\u5219 group \u83b7\u5f97\u7684\u9650\u5236\u5bf9\u8c61\u5c06\u4e0e\u914d\u7f6e\u4e0d\u540c\u3002\\n\\n### Issue #5343\\n\\n**\u94fe\u63a5**: https://github.com/apache/apisix/issues/5343\\n\\n**\u95ee\u9898\u63cf\u8ff0**: \u5728\u6a21\u5f0f\u4e2d\u6dfb\u52a0\u4e00\u4e2a request_body \u5f00\u5173\uff0c\u6bcf\u4e2a\u4e3b\u4f53\u53ef\u4ee5\u88ab expr \u7528\u6765\u51b3\u5b9a\u662f\u5426\u8bb0\u5f55\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u5f00\u5173\uff0c\u4e3b\u4f53\u5c31\u4e0d\u4f1a\u88ab\u8bb0\u5f55\u3002\\n\\n```json\\n\\"kafka-logger\\": {\\n   \\"broker_list\\":{\\n       \\"127.0.0.1\\":9092\\n    },\\n   \\"kafka_topic\\" : \\"test2\\",\\n   \\"request_body\\": {\\n       \\"expr\\": [\\n          [\\"request_length\\", \\"<\\", \\"1024\\"],\\n       ]\\n   },\\n   \\"key\\" : \\"key1\\",\\n   \\"batch_max_size\\": 1,\\n   \\"name\\": \\"kafka logger\\"\\n}\\n```\\n\\n`expr` \u53ef\u4ee5\u901a\u8fc7 lua-resty-expr \u8fdb\u884c\u8bc4\u4f30\u3002\u8bf7\u6c42\u4e3b\u4f53\u53ef\u4ee5\u901a\u8fc7 core.request.get_body \u83b7\u53d6\u3002\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [APISIX Ingress \u4e2d\u5f15\u5165 ApisixRoute v2beta2 \u7248\u672c\u7684\u81ea\u5b9a\u4e49\u8d44\u6e90, \u5e9f\u5f03 backend \u5b57\u6bb5](https://github.com/apache/apisix-ingress-controller/pull/698)\uff08\u8d21\u732e\u8005\uff1a[tao12345666333](https://github.com/tao12345666333)\uff09\\n\\n- [APISIX Ingress \u5347\u7ea7 CRD \u8d44\u6e90\u7248\u672c\u4e3a v1\uff0c\u4ee5\u4fbf\u66f4\u597d\u7684\u652f\u6301 K8s v1.22 \u53ca\u4ee5\u4e0a\u7248\u672c](https://github.com/apache/apisix-ingress-controller/pull/697)\uff08\u8d21\u732e\u8005\uff1a[tao12345666333](https://github.com/tao12345666333)\uff09\\n\\n- [APISIX Ingress \u6dfb\u52a0\u5982\u4f55\u4f7f\u7528 gRPC \u4ee3\u7406\u7684\u6587\u6863](https://github.com/apache/apisix-ingress-controller/pull/699)\uff08\u8d21\u732e\u8005\uff1a[gxthrj](https://github.com/gxthrj)\uff09\\n\\n- [APISIX Dashboard \u652f\u6301 proto \u7ba1\u7406 API](https://github.com/apache/apisix-dashboard/pull/2099)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [APISIX Dashboard \u652f\u6301\u4ee5 gzip \u4f20\u8f93 dashboard \u9759\u6001\u8d44\u6e90](https://github.com/apache/apisix-dashboard/pull/2178)\uff08\u8d21\u732e\u8005\uff1a[nic-6443](https://github.com/nic-6443)\uff09\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [Apache APISIX \u6269\u5c55\u6307\u5357](https://apisix.apache.org/zh/blog/2021/10/29/Extension-guide/)\uff1a\\n\\n  \u672c\u6587\u63d0\u4f9b\u4e86 Apache APISIX \u7684\u62d3\u5c55\u6307\u5357\uff0c\u65e8\u5728\u4e3a\u7528\u6237\u63d0\u4f9b\u62d3\u5c55 Apache APISIX \u7684\u4e00\u4e9b\u601d\u8def\u3002\\n\\n- [\u4ece 0 \u5230 1\uff0cAPISIX Ingress \u52a0\u5165\u793e\u533a\u540e\u7684\u53d1\u5c55\u4e0e\u6536\u83b7](https://apisix.apache.org/zh/blog/2021/10/26/APISIX-Ingress/)\uff1a\\n\\n  \u672c\u6587\u63cf\u8ff0\u4e86 APISIX Ingress \u7684\u6210\u957f\u5386\u7a0b\uff0c\u4ee5\u53ca APISIX Ingress \u52a0\u5165\u793e\u533a\u540e\u7684\u529f\u80fd\u63d0\u5347\u4e0e\u793e\u533a\u5e2e\u52a9\u7b49\u591a\u65b9\u9762\u7ec6\u8282\u6536\u83b7\u3002\\n\\n- [\u6559\u7a0b\u7bc7\uff1a\u5982\u4f55\u5728 Apache APISIX Ingress Controller \u4e2d\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66](https://apisix.apache.org/zh/blog/2021/10/22/cert-manager-in-ingress/)\uff1a\\n\\n  \u672c\u6587\u5c06\u901a\u8fc7\u8be6\u7ec6\u7684\u4ee3\u7801\u6b65\u9aa4\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 Cert Manager \u5728 Apache APISIX Ingress Controller \u91cc\u8fdb\u884c\u8bc1\u4e66\u7ba1\u7406\u3002"},{"id":"2021/10/26/extension-guide","metadata":{"permalink":"/zh/blog/2021/10/26/extension-guide","source":"@site/blog/2021/10/29/Extension-guide.md","title":"Apache APISIX \u6269\u5c55\u6307\u5357","description":"\u672c\u6587\u63d0\u4f9b\u4e86 Apache APISIX \u7684\u62d3\u5c55\u6307\u5357\uff0c\u5e76\u4e14\u4ecb\u7ecd\u4e86 Rewrite \u8fd8\u662f Access\u3001\u914d\u7f6e\u670d\u52a1\u53d1\u73b0\u3001\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861\u3001\u5904\u7406\u54cd\u5e94\u4ee5\u53ca\u4e0a\u62a5\u65e5\u5fd7\u548c\u76d1\u63a7\u53c2\u6570\u7b49\u516d\u4e2a\u62d3\u5c55\u65b9\u5411\u3002","date":"2021-10-29T00:00:00.000Z","formattedDate":"2021\u5e7410\u670829\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.25,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff0810.15-10.31\uff09","permalink":"/zh/blog/2021/11/02/weekly-report-1031"},"nextItem":{"title":"APISIX Ingress \u9879\u76ee\u4ece 0 \u5230 1 \u7684\u53d1\u5c55\u5386\u7a0b","permalink":"/zh/blog/2021/10/26/apisix-ingress"}},"content":"> \u672c\u6587\u63d0\u4f9b\u4e86 Apache APISIX \u7684\u62d3\u5c55\u6307\u5357\uff0c\u65e8\u5728\u4e3a\u7528\u6237\u63d0\u4f9b\u62d3\u5c55 Apache APISIX \u7684\u4e00\u4e9b\u601d\u8def\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX \u63d0\u4f9b\u4e86 50 \u591a\u4e2a\u63d2\u4ef6\u3001\u5e38\u7528\u7684\u51e0\u4e2a\u8d1f\u8f7d\u5747\u8861\u9009\u62e9\u5668\uff0c\u4ee5\u53ca\u5bf9\u4e3b\u6d41\u670d\u52a1\u53d1\u73b0\uff08\u5982 Nacos \u548c DNS\uff09\u7684\u652f\u6301\u3002API \u7f51\u5173\u548c\u4f01\u4e1a\u5185\u90e8\u7684\u4e1a\u52a1\u7d27\u5bc6\u76f8\u5173\uff0c\u4e3a\u4e86\u6ee1\u8db3\u4f01\u4e1a\u7684\u4e1a\u52a1\u9700\u6c42\uff0c\u7528\u6237\u901a\u5e38\u9700\u8981\u5728 Apache APISIX \u7684\u57fa\u7840\u4e0a\u6dfb\u52a0\u4e00\u4e9b\u4ee3\u7801\uff0c\u4ee5\u5b9e\u73b0\u4e1a\u52a1\u6240\u9700\u7684\u529f\u80fd\u3002\u5982\u4f55\u62d3\u5c55 Apache APISIX \u6210\u4e86\u8bb8\u591a\u7528\u6237\u7684\u5171\u540c\u75db\u70b9\uff1a\u5728\u4fdd\u8bc1 Apache APISIX \u5e73\u7a33\u8fd0\u884c\u7684\u524d\u63d0\u4e0b\uff0c\u5982\u4f55\u6dfb\u52a0\u4e1a\u52a1\u4ee3\u7801\uff0c\u6ee1\u8db3\u5b9e\u9645\u9700\u6c42\uff1f\\n\\n\u672c\u6587\u63d0\u4f9b\u4e86 Apache APISIX \u7684\u62d3\u5c55\u6307\u5357\uff0c\u65e8\u5728\u4e3a\u7528\u6237\u63d0\u4f9b\u62d3\u5c55 Apache APISIX \u7684\u4e00\u4e9b\u601d\u8def\u3002\u7531\u4e8e Apache APISIX \u5904\u4e8e\u9ad8\u901f\u53d1\u5c55\u9636\u6bb5\uff0c\u7248\u672c\u8fed\u4ee3\u7684\u9891\u7387\u6bd4\u8f83\u9ad8\uff0c\u6240\u4ee5\u672c\u6587\u4f1a\u4ee5 Apache APISIX \u7684\u9996\u4e2a LTS \u7248\u672c v2.10.0 \u4e3a\u57fa\u7840\u8fdb\u884c\u8bf4\u660e\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684 Apache APISIX \u7248\u672c\u4f4e\u4e8e 2.10.0\uff0c\u53ef\u80fd\u9700\u8981\u7ed3\u5408\u5b9e\u9645\u60c5\u51b5\u505a\u4e00\u4e9b\u53d8\u901a\u3002\u53e6\u5916\uff0c\u867d\u7136\u672c\u6587\u53ea\u8bb2\u89e3\u4e86 HTTP \u76f8\u5173\u7684\u903b\u8f91\uff0c\u4f46\u662f TCP \u76f8\u5173\u7684\u90e8\u5206\uff0c\u5927\u4f53\u4e0a\u4e5f\u8f83\u4e3a\u76f8\u4f3c\u3002\\n\\n## \u6269\u5c55\u65b9\u54111\uff1aRewrite \u8fd8\u662f Access\uff1f\\n\\n\u6211\u4eec\u4ece\u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\u8bf4\u8d77\uff1a\u5f53\u4e00\u4e2a\u8bf7\u6c42\u8fdb\u5165\u5230 Apache APISIX \u65f6\uff0c\u9996\u5148\u4f1a\u7531 `http_access_phase` \u8fd9\u4e2a\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\u3002\u719f\u6089 OpenResty phases \u6982\u5ff5\u7684\u8bfb\u8005\u53ef\u80fd\u4f1a\u6709\u4e9b\u7591\u60d1\uff1aOpenResty \u4e00\u5171\u6709 6 \u4e2a phases\uff0c\u6309\u7167\u6267\u884c\u7684\u5148\u540e\u987a\u5e8f\u6392\u5217\uff0c\u5206\u522b\u662f\uff1a `rewrite`\u3001 `access`\u3001 `before_proxy`\u3001 `header_filter`\u3001 `body_filter` \u548c `log`\uff0c\u4e3a\u4ec0\u4e48\u4e00\u4e0a\u6765\u5c31\u662f `access`\uff0c`rewrite` \u600e\u4e48\u4e0d\u89c1\u4e86\uff1f\\n\\nApache APISIX \u63d2\u4ef6\u7684 phases \u6982\u5ff5\u548c OpenResty \u7684 phases \u6982\u5ff5\u7565\u6709\u4e0d\u540c\u3002\u4e3a\u4e86\u63d0\u5347 Apache APISIX \u7684\u6027\u80fd\uff0cAPISIX \u63d2\u4ef6\u7684 rewrite \u65b9\u6cd5\u4f1a\u5728 OpenResty \u7684 access \u9636\u6bb5\u4e2d\u8fd0\u884c\u3002\u7528\u6237\u4f9d\u7136\u80fd\u591f\u5728\u63d2\u4ef6\u5c42\u9762\u81ea\u5b9a\u4e49 `rewrite` \u7684\u903b\u8f91\uff0c\u4f46\u662f\u5728\u4ee3\u7801\u5c42\u9762\uff0c`rewrite` \u5b9e\u9645\u4e0a\u4e5f\u662f\u5728 `access` \u91cc\u9762\u6267\u884c\u3002\\n\\n\u867d\u7136\u8bf4 `rewrite` \u7684\u903b\u8f91\u548c `access` \u7684\u903b\u8f91\u90fd\u5728 access phase \u91cc\u9762\u8fd0\u884c\uff0c\u4f46\u662f `rewrite` \u7684\u903b\u8f91\u8fd8\u662f\u4f1a\u6bd4 `access` \u7684\u903b\u8f91\u5148\u6267\u884c\u3002\u4e3a\u4e86\u907f\u514d\u540e\u7eed\u63d2\u4ef6\u6267\u884c `rewrite` \u5931\u8d25\u540e\uff0c\u6ca1\u6709\u7ee7\u7eed\u6267\u884c `access`\uff0c\u5bfc\u81f4 trace \u9057\u6f0f\u7684\u95ee\u9898\uff0c\u5fc5\u987b\u5728`rewrite`\u91cc\u9762\u6dfb\u52a0 trace \u7684\u903b\u8f91\u3002\\n\\n\u9664\u4e86\u6267\u884c\u7684\u5148\u540e\u987a\u5e8f\u5916\uff0c`rewrite` \u548c `access` \u4e4b\u95f4\u8fd8\u6709\u4e00\u4e2a\u5dee\u522b\uff0c\u5c31\u662f\u5b83\u4eec\u4e4b\u95f4\u6709\u4e00\u4e2a\u5904\u7406 `consumer` \u7684\u903b\u8f91\uff1a\\n\\n```\\n plugin.run_plugin(\\"rewrite\\", plugins, api_ctx)\\n        if api_ctx.consumer then\\n            ...\\n        end\\n        plugin.run_plugin(\\"access\\", plugins, api_ctx)\\n```\\n\\n`consumer` \u4ee3\u8868\u4e00\u79cd\u8eab\u4efd\u3002\u4f60\u53ef\u4ee5\u9488\u5bf9\u4e0d\u540c\u7684 `consumer` \u8fdb\u884c\u6743\u9650\u63a7\u5236\uff0c\u6bd4\u5982\u4f7f\u7528 `consumer-restriction` \u8fd9\u4e2a\u63d2\u4ef6\u5b9e\u73b0\u57fa\u4e8e\u89d2\u8272\u7684\u6743\u9650\u63a7\u5236\uff0c\u4e5f\u5c31\u662f\u5927\u5bb6\u6240\u8bf4\u7684 RBAC\u3002\u53e6\u5916\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7ed9\u4e0d\u540c\u7684 `consumer` \u8bbe\u7f6e\u5bf9\u5e94\u7684\u9650\u6d41\u7b56\u7565\u3002\\n\\nApache APISIX \u91cc\u9762\u7684\u9274\u6743\u63d2\u4ef6\uff08\u5728\u63d2\u4ef6\u5b9a\u4e49\u91cc\u9762\u6709 `type = \\"auth\\"`\uff09\uff0c\u9700\u8981\u5728 `rewrite` \u9636\u6bb5\u9009\u597d `consumer`\u3002\u8fd9\u91cc\u6211\u4eec\u7528 `key-auth` \u63d2\u4ef6\u4e3e\u4e2a\u4f8b\u5b50\uff1a\\n\\n```\\nlocal _M = {\\n    version = 0.1,\\n    priority = 2500,\\n    type = \'auth\',\\n    name = plugin_name,\\n    schema = schema,\\n    consumer_schema = consumer_schema,\\n}\\n\\n...\\nfunction _M.rewrite(conf, ctx)\\n    ...\\n    local consumer_conf = consumer_mod.plugin(plugin_name)\\n    if not consumer_conf then\\n        return 401, {message = \\"Missing related consumer\\"}\\n    end\\n\\n    local consumers = lrucache(\\"consumers_key\\", consumer_conf.conf_version,\\n        create_consume_cache, consumer_conf)\\n\\n    local consumer = consumers[key]\\n    if not consumer then\\n        return 401, {message = \\"Invalid API key in request\\"}\\n    end\\n\\n    consumer_mod.attach_consumer(ctx, consumer, consumer_conf)\\nend\\n```\\n\\n\u9274\u6743\u63d2\u4ef6\u7684\u6267\u884c\u903b\u8f91\u90fd\u662f\u76f8\u4f3c\u7684\uff1a\u9996\u5148\u4ece\u7528\u6237\u8f93\u5165\u4e2d\u83b7\u53d6\u67d0\u7ec4\u53c2\u6570\uff0c\u7136\u540e\u6839\u636e\u53c2\u6570\u67e5\u627e\u5bf9\u5e94\u7684 `consumer`\uff0c\u6700\u540e\u8fde\u540c\u8be5\u63d2\u4ef6\u5bf9\u5e94\u7684 `consumer_conf` \u9644\u52a0\u5230 `ctx` \u4e2d\u3002\\n\\n\u7efc\u4e0a\uff0c\u5bf9\u4e8e\u65e0\u9700\u5728\u8bf7\u6c42\u65e9\u671f\u9636\u6bb5\u6267\u884c\uff0c\u4e14\u4e0d\u9700\u8981\u67e5\u627e `consumer` \u7684\u63d2\u4ef6\uff0c\u5efa\u8bae\u628a\u903b\u8f91\u5199\u5230 `access` \u91cc\u9762\u3002\\n\\n## \u6269\u5c55\u65b9\u54112\uff1a\u914d\u7f6e\u670d\u52a1\u53d1\u73b0\\n\\n\u5728\u6267\u884c\u5b8c `access` \u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u8981\u8ddf\u4e0a\u6e38\uff08Upstream\uff09\u6253\u4ea4\u9053\u4e86\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e0a\u6e38\u8282\u70b9\u662f\u5199\u6b7b\u5728 Upstream \u914d\u7f6e\u4e0a\u7684\u3002\u4e0d\u8fc7\u4e5f\u53ef\u4ee5\u4ece\u670d\u52a1\u53d1\u73b0\u4e0a\u83b7\u53d6\u8282\u70b9\u6765\u5b9e\u73b0 discovery\u3002\\n\\n\u63a5\u4e0b\u6765\u6211\u4eec\u4f1a\u4ee5 Nacos \u4e3a\u4f8b\uff0c\u8bb2\u8bb2\u600e\u4e48\u5b9e\u73b0\u3002\\n\\n\u4e00\u4e2a\u52a8\u6001\u83b7\u53d6 Nacos \u7ba1\u7406\u7684\u8282\u70b9\u7684 Upstream \u914d\u7f6e\u5982\u4e0b\uff1a\\n\\n```\\n{\\n    \\"service_name\\": \\"APISIX-NACOS\\",\\n    \\"type\\": \\"roundrobin\\",\\n    \\"discovery_type\\": \\"nacos\\",\\n    \\"discovery_args\\": {\\n        \\"namespace_id\\": \\"test_ns\\",\\n        \\"group_name\\": \\"test_group\\"\\n    }\\n}\\n```\\n\\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5176\u4e2d\u4e09\u4e2a\u91cd\u8981\u7684\u53d8\u91cf\uff1a\\n\\n1. `discovery_type`: \u670d\u52a1\u53d1\u73b0\u7684\u7c7b\u578b\uff0c`\\"discovery_type\\": \\"nacos\\"`\u8868\u793a\u4f7f\u7528 Nacos \u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u3002\\n2. `service_name`: \u670d\u52a1\u540d\u79f0\u3002\\n3. `discovery_args`: \u4e0d\u540c\u7684 discovery \u7279\u5b9a\u7684\u53c2\u6570\uff0cNacos \u7684\u7279\u5b9a\u53c2\u6570\u5305\u62ec\uff1a`namespace_id` \u548c  `group_name`\u3002\\n\\nNacos discovery \u5bf9\u5e94\u7684 Lua \u4ee3\u7801\u4f4d\u4e8e `discovery/nacos.lua`\u3002\u6253\u5f00 `nacos.lua` \u8fd9\u4e2a\u6587\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5b83\u91cc\u9762\u5b9e\u73b0\u4e86\u51e0\u4e2a\u6240\u9700\u7684\u65b9\u6cd5\u3002\\n\\n\u4e00\u4e2a discovery \u9700\u8981\u5b9e\u73b0\u81f3\u5c11\u4e24\u4e2a\u65b9\u6cd5\uff1a`nodes` \u548c `init_worker` \u3002\\n\\n```\\nfunction _M.nodes(service_name, discovery_args)\\n    local namespace_id = discovery_args and\\n            discovery_args.namespace_id or default_namespace_id\\n    local group_name = discovery_args\\n            and discovery_args.group_name or default_group_name\\n\\n    ...\\nend\\n\\nfunction _M.init_worker()\\n    ...\\nend\\n```\\n\\n\u5176\u4e2d `nodes` \u7684\u51fd\u6570\u7b7e\u540d\u5df2\u7ecf\u660e\u4e86\u5730\u5c55\u793a\u83b7\u53d6\u65b0\u8282\u70b9\u6240\u7528\u7684\u67e5\u8be2\u53c2\u6570\uff1a`service_name` \u548c `discovery_args`\u3002\u6bcf\u6b21\u8bf7\u6c42\u65f6\uff0cApache APISIX \u90fd\u4f1a\u7528\u8fd9\u4e00\u7ec4\u67e5\u8be2\u6700\u65b0\u7684\u8282\u70b9\u3002\u8be5\u65b9\u6cd5\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u6570\u7ec4\uff1a\\n\\n```\\n{\\n    {host = \\"xxx\\", port = 12100, weight = 100, priority = 0, metadata = ...},\\n    # priority \u548c metadata \u662f\u53ef\u9009\u7684\\n    ...\\n}\\n```\\n\\n\u800c `init_worker` \u8d1f\u8d23\u5728\u540e\u53f0\u542f\u52a8\u4e00\u4e2a timer\uff0c\u786e\u4fdd\u672c\u5730\u7684\u8282\u70b9\u6570\u636e\u80fd\u8ddf\u670d\u52a1\u53d1\u73b0\u7684\u6570\u636e\u4fdd\u6301\u4e00\u81f4\u3002\\n\\n## \u6269\u5c55\u65b9\u54113\uff1a\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861\\n\\n\u83b7\u53d6\u5230\u4e00\u7ec4\u8282\u70b9\u540e\uff0c\u6211\u4eec\u8981\u6309\u7167\u8d1f\u8f7d\u5747\u8861\u7684\u89c4\u5219\u6765\u51b3\u5b9a\u63a5\u4e0b\u6765\u8981\u5148\u5c1d\u8bd5\u54ea\u4e2a\u8282\u70b9\u3002\u5982\u679c\u5e38\u7528\u7684\u51e0\u79cd\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u6ee1\u8db3\u4e0d\u4e86\u9700\u6c42\uff0c\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u3002\\n\\n\u8ba9\u6211\u4eec\u4ee5\u6700\u5c11\u8fde\u63a5\u6570\u8d1f\u8f7d\u5747\u8861\u4e3a\u4f8b\u3002\u5bf9\u5e94\u7684 Lua \u4ee3\u7801\u4f4d\u4e8e `balancer/least_conn.lua`\u3002\u6253\u5f00`least_conn.lua` \u8fd9\u4e2a\u6587\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5b83\u91cc\u9762\u5b9e\u73b0\u4e86\u51e0\u4e2a\u6240\u9700\u7684\u65b9\u6cd5\uff1a`new`\u3001`get`\u3001`after_balance` \u548c `before_retry_next_priority`\u3002\\n\\n- `new` \u8d1f\u8d23\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u5de5\u4f5c\u3002\\n\\n- `get` \u8d1f\u8d23\u6267\u884c\u9009\u4e2d\u8282\u70b9\u7684\u903b\u8f91\u3002\\n\\n- `after_balance` \u5728\u4e0b\u9762\u4e24\u79cd\u60c5\u51b5\u4e0b\u4f1a\u8fd0\u884c\uff1a\\n\\n  - \u6bcf\u6b21\u91cd\u8bd5\u4e4b\u524d\uff08\u6b64\u65f6 before_retry \u4e3a true\uff09\\n  - \u6700\u540e\u4e00\u6b21\u5c1d\u8bd5\u4e4b\u540e\\n\\n- `before_retry_next_priority` \u5219\u662f\u5728\u6bcf\u6b21\u5c1d\u8bd5\u5b8c\u5f53\u524d\u4e00\u7ec4\u540c priority \u7684\u8282\u70b9\uff0c\u51c6\u5907\u5c1d\u8bd5\u4e0b\u4e00\u7ec4\u4e4b\u524d\u8fd0\u884c\u3002\\n\\n```\\nfunction _M.new(up_nodes, upstream)\\n    ...\\n\\n    return {\\n        upstream = upstream,\\n        get = function (ctx)\\n            ...\\n        end,\\n        after_balance = function (ctx, before_retry)\\n            ...\\n            if not before_retry then\\n                if ctx.balancer_tried_servers then\\n                    core.tablepool.release(\\"balancer_tried_servers\\", ctx.balancer_tried_servers)\\n                    ctx.balancer_tried_servers = nil\\n                end\\n\\n                return nil\\n            end\\n\\n            if not ctx.balancer_tried_servers then\\n                ctx.balancer_tried_servers = core.tablepool.fetch(\\"balancer_tried_servers\\", 0, 2)\\n            end\\n\\n            ctx.balancer_tried_servers[server] = true\\n        end,\\n        before_retry_next_priority = function (ctx)\\n            if ctx.balancer_tried_servers then\\n                core.tablepool.release(\\"balancer_tried_servers\\", ctx.balancer_tried_servers)\\n                ctx.balancer_tried_servers = nil\\n            end\\n        end,\\n    }\\nend\\n```\\n\\n\u5982\u679c\u6ca1\u6709\u5185\u90e8\u72b6\u6001\u9700\u8981\u7ef4\u62a4\uff0c\u53ef\u4ee5\u76f4\u63a5\u501f\u7528\u56fa\u5b9a\u7684\u6a21\u677f\u4ee3\u7801\uff08\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u4f4d\u4e8e\u7701\u7565\u53f7\u4ee5\u5916\u7684\u5185\u5bb9\uff09\u6765\u586b\u5145 `after_balance` \u548c `before_retry_next_priority` \u8fd9\u4e24\u4e2a\u65b9\u6cd5\u3002\\n\\n\u9009\u4e2d\u8282\u70b9\u4e4b\u540e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u7684\u5f62\u5f0f\u6dfb\u52a0\u989d\u5916\u7684\u903b\u8f91\u3002\u63d2\u4ef6\u53ef\u4ee5\u5b9e\u73b0 `before_proxy` \u65b9\u6cd5\u3002\u8be5\u65b9\u6cd5\u4f1a\u5728\u9009\u4e2d\u8282\u70b9\u4e4b\u540e\u8c03\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8be5\u65b9\u6cd5\u91cc\u9762\u8bb0\u5f55\u5f53\u524d\u9009\u4e2d\u7684\u8282\u70b9\u4fe1\u606f\uff0c\u8fd9\u5728 trace \u91cc\u9762\u4f1a\u6709\u7528\u3002\\n\\n## \u6269\u5c55\u65b9\u54114\uff1a\u5904\u7406\u54cd\u5e94\\n\\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `response-rewrite` \u63d2\u4ef6\uff0c\u5728 `header_filter` \u548c `body_filter` \u5904\u7406\u4e0a\u6e38\u8fd4\u56de\u7684\u54cd\u5e94\u3002\u524d\u4e00\u4e2a\u65b9\u6cd5\u662f\u4fee\u6539\u54cd\u5e94\u5934\uff0c\u540e\u4e00\u4e2a\u65b9\u6cd5\u4fee\u6539\u54cd\u5e94\u4f53\u3002\u6ce8\u610f Apache APISIX \u7684\u54cd\u5e94\u5904\u7406\u662f\u6d41\u5f0f\u7684\uff0c\u5982\u679c`header_filter`\u91cc\u9762\u6ca1\u6709\u4fee\u6539\u54cd\u5e94\u5934\uff0c\u54cd\u5e94\u5934\u5c31\u4f1a\u88ab\u5148\u53d1\u9001\u51fa\u53bb\uff0c\u5230\u4e86`body_filter`\u5c31\u6ca1\u529e\u6cd5\u4fee\u6539\u54cd\u5e94\u4f53\u4e86\u3002\\n\\n\u8fd9\u610f\u5473\u7740\u5982\u679c\u4f60\u540e\u7eed\u60f3\u8981\u4fee\u6539body\uff0c\u4f46\u662f header \u91cc\u9762\u53c8\u6709 Content-Length \u4e4b\u7c7b\u8ddf body \u76f8\u5173\u7684\u54cd\u5e94\u5934\uff0c\u90a3\u4e48\u5c31\u8981\u63d0\u524d\u5728 `header_filter` \u91cc\u9762\u628a\u8fd9\u4e9b\u5934\u6539\u6389\u3002\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8f85\u52a9\u65b9\u6cd5\uff1a`core.response.clear_header_as_body_modified`\uff0c\u53ea\u9700\u8981\u5728 `header_filter` \u8c03\u7528\u5b83\u5c31\u884c\u3002\\n\\n`body_filter` \u4e5f\u662f\u6d41\u5f0f\u7684\uff0c\u800c\u4e14\u8fd8\u4f1a\u88ab\u591a\u6b21\u8c03\u7528\u3002\u6240\u4ee5\u5982\u679c\u4f60\u60f3\u8981\u83b7\u53d6\u5b8c\u6574\u7684\u54cd\u5e94\u4f53\uff0c\u4f60\u9700\u8981\u628a\u6bcf\u6b21 `body_filter` \u63d0\u4f9b\u7684\u90e8\u5206\u54cd\u5e94\u4f53\u7ed9\u62fc\u8d77\u6765\u3002\u5728 Apache APISIX master \u5206\u652f\u4e0a\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53eb\u505a `core.response.hold_body_chunk` \u7684\u65b9\u6cd5\u6765\u7b80\u5316\u64cd\u4f5c\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u770b\u770b\u4ee3\u7801\u3002\\n\\n## \u6269\u5c55\u65b9\u54115\uff1a\u4e0a\u62a5\u65e5\u5fd7\u548c\u76d1\u63a7\u53c2\u6570\\n\\n\u5728\u8bf7\u6c42\u7ed3\u675f\u4e4b\u540e\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7 `log` \u65b9\u6cd5\u6765\u505a\u4e00\u4e9b\u6e05\u573a\u5de5\u4f5c\u3002\u8fd9\u4e00\u7c7b\u5de5\u4f5c\u53ef\u4ee5\u5206\u6210\u4e24\u7c7b\uff1a\\n\\n1. \u8bb0\u5f55 metrics \u6307\u6807\uff0c\u6bd4\u5982 `prometheus` \u63d2\u4ef6\u3002\\n2. \u8bb0\u5f55 access log\uff0c\u7136\u540e\u5b9a\u671f\u4e0a\u62a5\uff0c\u6bd4\u5982 `http-logger` \u63d2\u4ef6\u3002\\n\\n\u5982\u679c\u4f60\u611f\u5174\u8da3\u7684\u8bdd\uff0c\u53ef\u4ee5\u770b\u770b\u8fd9\u4e24\u4e2a\u63d2\u4ef6\u7684 `log` \u65b9\u6cd5\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1a\\n\\n- [`prometheus` \u63d2\u4ef6\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/plugins/prometheus/)\\n- [`http-logger` \u63d2\u4ef6\u6587\u6863](https://apisix.apache.org/zh/docs/apisix/plugins/http-logger/)"},{"id":"2021/10/26/apisix-ingress","metadata":{"permalink":"/zh/blog/2021/10/26/apisix-ingress","source":"@site/blog/2021/10/26/APISIX-Ingress.md","title":"APISIX Ingress \u9879\u76ee\u4ece 0 \u5230 1 \u7684\u53d1\u5c55\u5386\u7a0b","description":"\u672c\u6587\u8be6\u7ec6\u63cf\u8ff0\u4e86 Apache APISIX Ingress Controller \u7684\u6210\u957f\u5386\u7a0b\uff0c\u4ee5\u53ca APISIX Ingress \u52a0\u5165\u793e\u533a\u540e\u7684\u529f\u80fd\u63d0\u5347\u4e0e\u793e\u533a\u5e2e\u52a9\u7b49\u591a\u65b9\u9762\u7ec6\u8282\u6536\u83b7\u3002","date":"2021-10-26T00:00:00.000Z","formattedDate":"2021\u5e7410\u670826\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"},{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":13.95,"truncated":true,"authors":[{"name":"\u91d1\u536b","url":"https://github.com/gxthrj","imageURL":"https://avatars.githubusercontent.com/u/4413028?v=4"}],"prevItem":{"title":"Apache APISIX \u6269\u5c55\u6307\u5357","permalink":"/zh/blog/2021/10/26/extension-guide"},"nextItem":{"title":"\u5982\u4f55\u5728 APISIX Ingress Controller \u4e2d\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66","permalink":"/zh/blog/2021/10/22/cert-manager-in-ingress"}},"content":"> \u672c\u6587\u63cf\u8ff0\u4e86 APISIX Ingress \u7684\u6210\u957f\u5386\u7a0b\uff0c\u4ee5\u53ca APISIX Ingress \u52a0\u5165\u793e\u533a\u540e\u7684\u529f\u80fd\u63d0\u5347\u4e0e\u793e\u533a\u5e2e\u52a9\u7b49\u591a\u65b9\u9762\u7ec6\u8282\u6536\u83b7\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u6982\u5ff5\u7bc7\\n\\n### APISIX Ingress \u6982\u8ff0\\n\\n\u5728 K8s \u751f\u6001\u4e2d\uff0cIngress \u4f5c\u4e3a\u8868\u793a K8s \u6d41\u91cf\u5165\u53e3\u7684\u4e00\u79cd\u8d44\u6e90\uff0c\u60f3\u8981\u8ba9\u5176\u751f\u6548\uff0c\u5c31\u9700\u8981\u6709\u4e00\u4e2a Ingress Controller \u53bb\u76d1\u542c K8s \u4e2d\u7684 Ingress \u8d44\u6e90\uff0c\u5e76\u5bf9\u8fd9\u4e9b\u8d44\u6e90\u8fdb\u884c\u76f8\u5e94\u89c4\u5219\u7684\u89e3\u6790\u548c\u5b9e\u9645\u627f\u8f7d\u6d41\u91cf\u3002\\n\\nAPISIX Ingress \u5219\u662f\u57fa\u4e8e Apache APISIX \u7684 Ingress Controller \u5b9e\u73b0\uff0c\u5b9e\u73b0\u4e86\u5bf9 Kubernetes \u7684\u6269\u5c55\uff0c\u540c\u65f6\u4e5f\u652f\u6301 Ingress resource \u7684\u539f\u751f\u8d44\u6e90\u5b9a\u4e49\u3002\\n\\n![APISIX Ingress \u67b6\u6784](https://static.apiseven.com/202108/1635304156040-50b7a2ae-ed0c-42ac-8517-edd0715e0082.png)\\n\\n\u901a\u8fc7\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0cAPISIX Ingress \u662f\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u90e8\u7f72\uff0c\u5e76\u4ee3\u7406 Kubernetes \u5916\u90e8\u96c6\u7fa4\u7684\u8bf7\u6c42\u3002\u7136\u540e\u5c06\u8fd9\u4e9b\u8bf7\u6c42\u53cd\u5411\u4ee3\u7406\u5230 Kubernetes \u96c6\u7fa4 Service\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u76f4\u63a5\u5c06\u670d\u52a1\u63a8\u9001\u5230 Service Pod\u3002\\n\\n### \u4ec0\u4e48\u662f Apache APISIX\\n\\n\u524d\u8fb9\u6211\u4eec\u63d0\u5230\u4e86 APISIX Ingress \u662f\u91c7\u7528 Apache APISIX \u4f5c\u4e3a\u5b9e\u9645\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u7684\u6570\u636e\u9762\uff0c\u90a3\u4e48 Apache APISIX \u9879\u76ee\u53c8\u662f\u505a\u4ec0\u4e48\u7684\u5462\uff1f\\n\\nApache APISIX \u662f Apache \u57fa\u91d1\u4f1a\u65d7\u4e0b\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u662f\u5f53\u524d\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\uff0c\u76ee\u524d\u4e5f\u901a\u8fc7\u4e2d\u56fd\u4fe1\u901a\u9662\u7684\u53ef\u4fe1\u5f00\u6e90\u9879\u76ee\u8ba4\u8bc1\u3002\u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0cApache APISIX \u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\n![Apache APISIX \u67b6\u6784](https://static.apiseven.com/202108/1635304156053-68751f2e-40e7-4932-99a4-5b9cc8f60628.png)\\n\\n\u4ece\u4e0a\u56fe\u6846\u67b6\u53ef\u4ee5\u770b\u5230\uff0cApache APISIX \u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u5de6\u4fa7\u6570\u636e\u9762\u7528\u6765\u5904\u7406\u6d41\u91cf\u7684\u53cd\u5411\u4ee3\u7406\uff0c\u53f3\u4fa7\u63a7\u5236\u9762\u8d1f\u8d23\u914d\u7f6e\u7684\u5206\u53d1\u3002\\n\\nApache APISIX Ingress Controller \u91c7\u7528\u58f0\u660e\u5f0f\u7684\u914d\u7f6e\uff0c\u7ecf\u8fc7\u5185\u90e8\u5904\u7406\u540e\uff0c\u6700\u7ec8\u4f1a\u901a\u8fc7\u63a7\u5236\u9762\u7684 Admin API \u5c06\u6570\u636e\u540c\u6b65\u5230 etcd \u4e2d\u5e76\u4f20\u8f93\u7ed9 Apache APISIX\uff0c\u5b9e\u73b0 Apache APISIX \u96c6\u7fa4\u7684\u914d\u7f6e\u540c\u6b65\u3002\\n\\n\u66f4\u591a\u5173\u4e8e Apache APISIX Ingress Controller \u7279\u6027\u8bb2\u89e3[\u70b9\u6b64\u67e5\u9605](https://github.com/apache/apisix-ingress-controller)\u3002\\n\\n## \u6210\u957f\u7bc7\\n\\n\u5173\u4e8e Apache APISIX Ingress \u7684\u4f7f\u7528\u573a\u666f\u6216\u8005\u4ea7\u54c1\u5bf9\u6bd4\u4f18\u52bf\u7b49\uff0c\u5728\u5f80\u671f\u7684\u5206\u4eab\u4e2d\u5927\u90fd\u63d0\u53ca\u4e86\u5f88\u591a\u3002\u8fd9\u6b21\u6211\u4eec\u6362\u4e2a\u89d2\u5ea6\uff0c\u4ece Apache APISIX Ingress \u7684\u8bde\u751f\u53ca\u53d1\u5c55\u89d2\u5ea6\u8fdb\u884c\u89e3\u6790\u3002\\n\\n### \u52a0\u5165 Apache \u793e\u533a\\n\\n![\u53d1\u5c55\u5386\u7a0b](https://static.apiseven.com/202108/1635304156115-9d5e41d0-a8e9-4a6e-8a1a-757f3107a49a.png)\\n\\n2019 \u5e74\u6211\u7ed9 APISIX Ingress Controller \u9879\u76ee\u63d0\u4f9b\u4e86\u7b2c\u4e00\u884c\u4ee3\u7801\uff0c2020 \u5e74 12 \u6708\u4efd\u8be5\u9879\u76ee\u88ab\u6b63\u5f0f\u52a0\u5165\u5230 Apache \u793e\u533a\u3002\u5728\u4ea7\u54c1\u66f4\u65b0\u4e0a\uff0c\u4eca\u5e74 6 \u6708\u4efd\u6211\u4eec\u53d1\u5e03\u4e86\u7b2c\u4e00\u4e2a GA \u7248\u672c\uff0c\u540c\u65f6\u5728\u521a\u521a\u8fc7\u53bb\u7684 10 \u6708\u4efd\u4e2d\u4e5f\u53d1\u5e03\u4e86 1.3 \u7248\u672c\uff0c\u9884\u8ba1\u5728\u4eca\u5e74 11 \u6708\u4efd\u5c06\u4f1a\u53d1\u5e03 1.4 \u7248\u672c\uff0c\u4fdd\u8bc1\u9879\u76ee\u7684\u6b63\u5e38\u66f4\u65b0\u8fed\u4ee3\u3002\\n\\n![\u8d21\u732e\u8005\u589e\u957f\u66f2\u7ebf\u56fe](https://static.apiseven.com/202108/1635304156111-d0b82a61-b304-42ce-8d3a-2b959d3cb271.png)\\n\\n\u4e0a\u56fe\u662f Apache APISIX Ingress Controller \u7684\u8d21\u732e\u8005\u589e\u957f\u66f2\u7ebf\u56fe\u3002\u7ed3\u5408\u65f6\u95f4\u8f74\u53ef\u4ee5\u770b\u5230\uff0c\u4ece 2020 \u5e74 12 \u6708\u52a0\u5165 Apache \u793e\u533a\u540e\uff0c\u8d21\u732e\u8005\u7684\u4eba\u6570\u589e\u52a0\u901f\u5ea6\u5448\u73b0\u51fa\u9ad8\u901f\u7a33\u5b9a\u589e\u957f\u7684\u6001\u52bf\u3002\u4fa7\u9762\u53cd\u6620\u51fa Apache APISIX Ingress \u5f97\u5230\u4e86\u8d8a\u6765\u8d8a\u591a\u5c0f\u4f19\u4f34\u7684\u5173\u6ce8\uff0c\u5e76\u5f00\u59cb\u9010\u6b65\u5e94\u7528\u5230\u4f01\u4e1a\u751f\u4ea7\u73af\u5883\u4e2d\u3002\\n\\n### \u5728\u793e\u533a\u4e2d\u6210\u957f\\n\\n\u4ece\u4e2a\u4eba\u9879\u76ee\u6216\u4f01\u4e1a\u5185\u90e8\u5b75\u5316\u51fa\u7684\u9879\u76ee\u5f00\u59cb\u5230\u52a0\u5165\u793e\u533a\uff0c\u524d\u540e\u73af\u5883\u7684\u8f6c\u6362\u5fc5\u7136\u4f1a\u5bfc\u81f4\u9879\u76ee\u5de5\u4f5c\u65b9\u5f0f\u7684\u53d8\u5316\u3002\u52a0\u5165\u793e\u533a\u540e\uff0cApache APISIX Ingress \u5728\u529f\u80fd\u548c\u9879\u76ee\u6574\u4f53\u5ea6\u4e0a\u5f97\u5230\u4e86\u66f4\u591a\u7684\u652f\u6301\u4e0e\u5e2e\u52a9\u3002\\n\\n#### \u5f00\u542f\u5f02\u6b65\u5316\u8ba8\u8bba\\n\\n\u6210\u4e3a Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u9879\u76ee\u540e\uff0cApache APISIX Ingress Controller \u9879\u76ee\u53d8\u5f97\u66f4\u52a0\u5f00\u653e\u3002\u6bd4\u5982\u5173\u4e8e\u4ea7\u54c1\u6bcf\u4e00\u4e2a\u7279\u6027\u7684\u65b0\u589e\u6216\u8005\u4fee\u6539\u90fd\u5fc5\u987b\u7ecf\u8fc7\u4e00\u4e9b\u516c\u5f00\u7684\u8ba8\u8bba\uff0c\u8ba8\u8bba\u7684\u65b9\u5f0f\u4e00\u822c\u5206\u4e3a\u90ae\u4ef6\u5217\u8868\u8ba8\u8bba\u548c GitHub Issue \u8ba8\u8bba\u3002\\n\\n![\u90ae\u4ef6\u5217\u8868](https://static.apiseven.com/202108/1635304156102-8877f3da-a43d-4b94-9a84-a95743546112.png)\\n![GitHub Issue](https://static.apiseven.com/202108/1635304156096-c0eeb189-54f8-4ebe-b019-f41001869186.png)\\n\\n\u76ee\u524d\u662f\u4e0a\u8ff0\u4e24\u79cd\u8ba8\u8bba\u540c\u65f6\u53d1\u8d77\uff0c\u5c3d\u53ef\u80fd\u591a\u5730\u8ba9\u5927\u5bb6\u7ad9\u5728\u5404\u81ea\u7684\u4f7f\u7528\u573a\u666f\u4ee5\u53ca\u4f7f\u7528\u89d2\u5ea6\u53bb\u8bc4\u5224\u7279\u6027\u7684\u5408\u7406\u6027\u3002\u56e0\u4e3a\u8fd9\u5df2\u4e0d\u518d\u662f\u4e00\u4e2a\u4e2a\u4eba\u9879\u76ee\uff0c\u800c\u662f\u4e00\u4e2a\u793e\u533a\u9879\u76ee\uff0c\u662f\u591a\u4eba\u53c2\u4e0e\u7684\u5408\u4f5c\u4ea7\u51fa\u3002\\n\\n\u540c\u65f6\uff0c\u901a\u8fc7\u90ae\u4ef6\u5217\u8868\u548c GitHub Issue \u7684\u5f02\u6b65\u5f0f\u8ba8\u8bba\uff0c\u53ef\u4ee5\u66f4\u5168\u9762\u5730\u6536\u96c6\u5230\u793e\u533a\u7684\u53cd\u9988\uff08\u4e0d\u7ba1\u662f\u63d0\u95ee\u8fd8\u662f\u56de\u7b54\uff09\uff0c\u5728\u516c\u5f00\u5316\u7684\u57fa\u7840\u4e0a\u4e3a\u540e\u7eed\u95ee\u9898\u7684\u641c\u7d22\u548c\u6574\u7406\u63d0\u4f9b\u4e86\u4fbf\u5229\u3002\\n\\n#### \u589e\u8bbe\u793e\u533a\u4f8b\u4f1a\\n\\n\u5728\u4e92\u52a8\u65b9\u9762\uff0cApache APISIX Ingress \u5438\u53d6\u4e86\u4e00\u4e9b\u5176\u4ed6\u793e\u533a\u7684\u7ecf\u9a8c\uff0c\u5f00\u653e\u4e86\u4e00\u4e2a\u6bcf\u4e24\u5468\u8fdb\u884c\u7684\u793e\u533a\u4f8b\u4f1a\u6d3b\u52a8\u3002\\n\\n\u8fd9\u662f\u4e00\u4e2a\u65b0\u7684\u6e20\u9053\uff0c\u6211\u4eec\u5e0c\u671b\u8ba9\u9879\u76ee\u900f\u660e\u5316\u7684\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u793e\u533a\u5c0f\u4f19\u4f34\u63d0\u4f9b\u4e00\u4e2a\u66f4\u751f\u6d3b\u5316\u7684\u6e20\u9053\u6765\u4e00\u8d77\u8ba8\u8bba\u95ee\u9898\u3002\\n\\n\u901a\u8fc7\u8fd9\u4e2a\u53cc\u5468\u4f8b\u4f1a\uff0c\u6211\u4eec\u4f1a\u7ed9\u5927\u5bb6\u8be6\u7ec6\u4ecb\u7ecd\u6700\u8fd1\u4e24\u5468\u9879\u76ee\u53d1\u751f\u4e86\u54ea\u4e9b\u53d8\u5316\uff0c\u6709\u54ea\u4e9b\u65b0\u7684 issue \u88ab\u63d0\u51fa\u4ee5\u53ca\u54ea\u4e9b PR \u6b63\u5728\u7b49\u5f85\u5408\u5e76\u3002\u5f53\u7136\u4e5f\u4f1a\u8ddf\u5927\u5bb6\u4e00\u8d77\u8ba8\u8bba\u5f53\u524d\u9879\u76ee\u7684\u4e00\u4e9b\u95ee\u9898\u6216\u5efa\u8bae\u3002\\n\\n\u6211\u4eec\u5e0c\u671b\u8fd9\u4e0d\u4ec5\u662f\u4e00\u4e2a\u5373\u65f6\u8ba8\u8bba\u7684\u8fc7\u7a0b\uff0c\u66f4\u662f\u4e00\u4e2a\u5206\u4eab\u548c\u4ea4\u6d41\u591a\u89d2\u5ea6\u4e8b\u7269\u89c2\u5bdf\u7684\u4e92\u52a8\u3002\\n\\n\u5177\u4f53\u5173\u4e8e\u53cc\u5468\u4f8b\u4f1a\u7684\u4f1a\u8bae\u5185\u5bb9[\u70b9\u6b64\u67e5\u9605](https://github.com/apache/apisix-ingress-controller/issues/614)\uff0c\u4e5f\u53ef\u4ee5\u70b9\u6b64\u67e5\u770b[\u5f80\u671f\u4f8b\u4f1a\u56de\u653e](https://space.bilibili.com/551921247)\u3002\\n\\n#### \u9879\u76ee\u7ec6\u8282\u66f4\u5408\u89c4\\n\\n\u8fdb\u5165 Apache \u793e\u533a\u540e\uff0c\u53e6\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u53d8\u5316\u662f\u9879\u76ee\u89c4\u5212\u4e0a\u53d8\u5f97\u66f4\u52a0\u89c4\u8303\uff0c\u4e0d\u7ba1\u662f\u4ee3\u7801\u3001\u6d4b\u8bd5\u8fd8\u662f\u7248\u672c\u53d1\u5e03\u3002\\n\\n\u5728\u4ee3\u7801\u5c42\u9762\uff0c\u76ee\u524d\u793e\u533a\u91c7\u7528\u7684\u662f [Golang \u4ee3\u7801\u89c4\u8303](https://github.com/uber-go/guide)\uff0c\u901a\u8fc7 Action CI \u8fdb\u884c\u4e00\u4e9b\u81ea\u52a8\u5316\u68c0\u67e5\u3002\\n\\n\u4e3a\u4e86\u4fdd\u8bc1\u9879\u76ee\u7279\u6027\u80fd\u591f\u5feb\u901f\u5408\u5e76\uff0c\u5e76\u4e14\u4e0d\u4f1a\u5f15\u5165\u65b0\u7684 bug\uff0c\u5728\u6d4b\u8bd5\u89c4\u8303\u4e0a\u6211\u4eec\u4e5f\u8fdb\u884c\u4e86\u76f8\u5173\u8981\u6c42\u3002\u6bd4\u5982\u5728\u7279\u6027\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u5b9a\u8981\u5305\u542b\u5355\u5143\u6d4b\u8bd5\u6216\u8005 e2e \u6d4b\u8bd5\uff0c\u5176\u4e2d e2e \u6d4b\u8bd5\u96c6\u6210\u4e86 gruntwork-io/terratest \u4ee5\u53ca kubernetes-sigs/kind\uff0c\u7528\u6765\u6784\u5efa Kubernetes \u6d4b\u8bd5\u73af\u5883\u3002\\n\\n\u540c\u65f6\u6d4b\u8bd5\u6846\u67b6\u91c7\u7528\u7684\u662f\u793e\u533a\u4e2d\u5e7f\u4e3a\u63a5\u7eb3\u7684 Ginkgo\uff0c\u6d4b\u8bd5\u7528\u4f8b\u7684\u5b8c\u5584\u6781\u5927\u5730\u4fdd\u8bc1\u4e86\u9879\u76ee\u7a33\u5b9a\u6027\uff0c\u540c\u65f6\u4e5f\u964d\u4f4e\u4e86\u9879\u76ee\u7684\u7ef4\u62a4\u6210\u672c\u3002\\n\\n\u5728\u7248\u672c\u53d1\u5e03\u65b9\u9762\uff0c\u76ee\u524d\u4e5f\u662f\u4e25\u683c\u9075\u5faa\u4e86 Apache \u793e\u533a\u7684\u53d1\u7248\u89c4\u8303\u3002\u540c\u65f6\u7531\u4e8e APISIX Ingress Controller \u4e5f\u662f\u5c5e\u4e8e Kubernetes \u7684\u4e00\u4e2a\u6269\u5c55\uff0c\u6240\u4ee5\u5728\u6d89\u53ca CRD \u7684\u8fed\u4ee3\u90e8\u5206\u4e5f\u662f\u6309\u7167 Kubernetes \u7684\u53d1\u7248\u89c4\u5219\u8fdb\u884c\u3002\\n\\n## \u6536\u83b7\u7bc7\\n\\n\u9664\u4e86\u4e0a\u8ff0\u63d0\u5230\u7684\u5173\u4e8e\u9879\u76ee\u5236\u5ea6\u4e0a\u7684\u4e00\u4e9b\u89c4\u8303\uff0c\u8d70\u5411\u793e\u533a\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u6536\u83b7\u4e86\u5f88\u591a\u5c0f\u4f19\u4f34\u4eec\u7684\u300c\u6280\u672f\u56de\u9988\u300d\u3002\\n\\n### \u5b8c\u5584\u4e86\u66f4\u591a\u7ec6\u8282\u529f\u80fd\\n\\n\u8fd9\u4e9b\u8d21\u732e\u5927\u90fd\u6765\u6e90\u4e8e\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u5e73\u65f6\u5728\u4f7f\u7528 APISIX Ingress \u5f53\u4e2d\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898\uff0c\u6216\u8005\u573a\u666f\u4e0a\u7684\u4e00\u4e9b\u5b8c\u5584\uff0c\u6bd4\u5982\uff1a\\n\\n- Admission Hook\\n- Ingress \u672c\u8eab\u7684 Prometheus Metrics\\n- mTLs\\n- \u7070\u5ea6\u529f\u80fd\u7684\u5b8c\u5584\\n- \u4ea7\u54c1\u4f7f\u7528\u6587\u6863\u7684\u8865\u5145\\n\\n\u66f4\u591a\u7279\u6027[\u70b9\u6b64\u67e5\u770b](https://github.com/apache/apisix-ingress-controller/#readme)\u3002\\n\\n\u540c\u65f6\u501f\u52a9\u793e\u533a\u7684\u53cd\u9988\uff0c\u6211\u4eec\u4e5f\u987a\u5e94\u5927\u5bb6\u7684\u9700\u6c42\u652f\u6301\u4e86[\u591a\u5e73\u53f0\u96c6\u6210\u529f\u80fd](https://github.com/apache/apisix-ingress-controller/blob/master/install.md#installation)\u3002\\n\\n![\u591a\u5e73\u53f0\u96c6\u6210](https://static.apiseven.com/202108/1635304156088-035cb0b0-8138-4e93-af5c-8e6ee8371f81.png)\\n\\n### \u4e30\u5bcc\u4e86\u4f7f\u7528\u573a\u666f\u5e93\\n\\n\u5728\u793e\u533a\u91cc\u5f97\u5230\u529f\u80fd\u52a0\u6301\u7684\u540c\u65f6\uff0c\u4e5f\u6536\u83b7\u4e86\u5173\u4e8e Apache APISIX Ingress \u7684\u4f7f\u7528\u573a\u666f\u4e0a\u7684\u4e30\u5bcc\u3002\\n\\n#### \u573a\u666f\u4e00\uff1aKubernetes \u96c6\u7fa4\u5185\u90e8\\n\\n\u6700\u5178\u578b\u7684\u4e00\u79cd\u65b9\u5f0f\u662f\u5728 Kubernetes \u96c6\u7fa4\u5185\u90e8\u8fdb\u884c\u90e8\u7f72\uff0c\u5982\u4e0b\u56fe\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684\u4f7f\u7528\u573a\u666f\u793a\u610f\u56fe\u3002\\n\\n![\u4f7f\u7528\u573a\u666f1](https://static.apiseven.com/202108/1635304156077-ced688eb-9dbf-4895-b7a2-acb2f4a288b2.png)\\n\\n\u5ba2\u6237\u7aef\u7ecf\u8fc7\u5916\u90e8 LB \u540e\uff0c\u7ecf\u8fc7 Apache APISIX \u8fdb\u884c\u627f\u63a5\u5904\u7406\u3002Apache APISIX \u4f5c\u4e3a\u7f51\u5173\u4e5f\u662f\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\uff0c\u540c\u65f6\u8fd8\u53ef\u4ee5\u90e8\u7f72\u5728 Kubernetes \u96c6\u7fa4\u5185\u5916\u3002\\n\\n\u4e0a\u56fe\u7684\u90e8\u7f72\u573a\u666f\u5c31\u662f\u5728 Kubernetes \u5185\u90e8\u96c6\u6210 APISIX Ingress Controller\uff0c\u901a\u8fc7 APISIX Ingress Controller \u5c06 Kubernetes \u7684\u58f0\u660e\u5f0f\u914d\u7f6e\u540c\u6b65\u5230 Apache APISIX\u3002\u8fd9\u6837\u5916\u90e8\u7684\u8bf7\u6c42\u5c31\u53ef\u4ee5\u901a\u8fc7 Apache APISIX \u96c6\u7fa4\u6570\u636e\u9762\u53bb\u76f4\u63a5\u4ee3\u7406\u540e\u7eed Upstream \u7684\u4e1a\u52a1\u670d\u52a1\u3002\\n\\n#### \u573a\u666f\u4e8c\uff1a\u8de8\u96c6\u7fa4\u90e8\u7f72\\n\\n\u82cf\u5dde\u601d\u5fc5\u9a70\u516c\u53f8\u7684\u7528\u6237\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5173\u4e8e\u8de8\u96c6\u7fa4\u4f7f\u7528\u573a\u666f\uff0c\u5927\u4f53\u6d41\u7a0b\u5982\u4e0b\u6240\u793a\u3002\\n\\n![\u8de8\u96c6\u7fa4\u90e8\u7f72](https://static.apiseven.com/202108/1635304156072-ae9a3943-e686-4629-a5b7-0b5c38301139.png)\\n\\n\u5728\u4e0a\u56fe\u67b6\u6784\u4e2d\u6709\u4e24\u4e2a\u96c6\u7fa4\uff0c\u5373\u4e91\u4e3b\u673a\u6b63\u5f0f\u96c6\u7fa4\u548c\u7269\u7406\u673a\u96c6\u7fa4\u3002Apache APISIX Ingress Controller \u5728\u6bcf\u4e00\u4e2a\u96c6\u7fa4\u5185\u90fd\u6709\u90e8\u7f72\uff0c\u5728\u4e0e Kubernetes API server \u4ea4\u4e92\u7684\u540c\u65f6\uff0c\u901a\u8fc7 Apache APISIX Admin API \u5c06\u914d\u7f6e\u540c\u6b65\u5230 Apache APISIX \u96c6\u7fa4\u3002\\n\\n\u5728\u8de8\u96c6\u7fa4\u573a\u666f\u65f6\uff0c\u4e3b\u8981\u662f\u901a\u8fc7 Apache APISIX \u6765\u6253\u901a\u96c6\u7fa4\u4e4b\u95f4\u7684\u4e92\u76f8\u8bbf\u95ee\u3002\u901a\u5e38\u96c6\u7fa4\u4e4b\u95f4\u7684\u8bbf\u95ee\u5206\u4e3a\u4e13\u7ebf\u548c\u516c\u7f51\uff0c\u501f\u52a9 Apache APISIX \u7684\u5065\u5eb7\u68c0\u67e5\u529f\u80fd\uff0c\u53ef\u4ee5\u505a\u5230\u5f53\u4e13\u7ebf\u6216\u516c\u7f51\u4f20\u8f93\u5931\u8d25\u65f6\u81ea\u52a8\u5c06\u6d41\u91cf\u5207\u6362\u5230\u5176\u4ed6\u6b63\u5e38\u901a\u9053\u4e0a\uff0c\u4fdd\u8bc1\u4e86\u4e1a\u52a1\u7684\u7a33\u5b9a\u4e0e\u9ad8\u53ef\u7528\u3002\\n\\n#### \u573a\u666f\u4e09\uff1a\u4e00\u4e2a Apache APISIX \u96c6\u7fa4\u7ba1\u7406\u591a\u4e2a Kubernetes \u96c6\u7fa4\\n\\n![\u591a Kubernetes \u96c6\u7fa4](https://static.apiseven.com/202108/1635304156063-c7d879c6-8dfb-4ead-a88d-b5bdc9e453d6.png)\\n\\n\u8be5\u4f7f\u7528\u573a\u666f\u662f\u5c06 APISIX Ingress Controller \u90e8\u7f72\u5728 Kubernetes \u96c6\u7fa4\u5185\u90e8\uff0c\u4e0e\u573a\u666f\u4e00\u4e0d\u540c\u7684\u662f\u8fd9\u91cc\u6709\u591a\u4e2a Kubernetes \u96c6\u7fa4\u3002\u4f46\u76f8\u5e94\u7684 Apache APISIX \u5b9e\u9645\u4e0a\u662f\u90e8\u7f72\u5728\u6240\u6709 Kubernetes \u96c6\u7fa4\u5916\u90e8\uff0c\u7136\u540e\u901a\u8fc7 Apache APISIX Ingress Controller \u5c06\u5404\u81ea\u96c6\u7fa4\u7684\u914d\u7f6e\u540c\u6b65\u5230\u603b\u7684 Apache APISIX \u96c6\u7fa4\u4e2d\u3002\\n\\n\u8fd9\u6837\u505a\u7684\u4f18\u52bf\u662f\u53ef\u4ee5\u901a\u8fc7\u4e00\u5957 SLB Cluster \u53bb\u5b8c\u5168\u63a7\u5236\u5404\u4e2a Kubernetes \u96c6\u7fa4\uff0c\u6ee1\u8db3\u4e00\u4e9b\u4f01\u4e1a\u67b6\u6784\u4e3a\u591a\u96c6\u7fa4\u6216\u8de8\u673a\u623f\u7684\u4f7f\u7528\u573a\u666f\uff0c\u51cf\u5c11\u4e1a\u52a1\u6d41\u91cf\u4e0a\u7684\u8f6c\u53d1\u6b21\u6570\u3002\\n\\n### \u603b\u7ed3\\n\\n\u5f97\u76ca\u4e8e\u4ee5\u4e0a\u6536\u83b7\u6210\u679c\uff0cApache APISIX Ingress \u4e5f\u5f97\u5230\u4e86\u8d8a\u6765\u8d8a\u591a\u7684\u5173\u6ce8\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u4f01\u4e1a\u4e5f\u5f00\u59cb\u5c06 APISIX Ingress Controller \u5e94\u7528\u5230\u81ea\u5bb6\u4ea7\u54c1\u4e2d\uff0c\u6bd4\u5982\u4e2d\u56fd\u79fb\u52a8\u3001\u53c8\u62cd\u4e91\u3001\u6709\u8d5e\u3001\u89c2\u4e3a\u667a\u6167\u7b49\u591a\u5bb6\u4f01\u4e1a\u3002\u672a\u6765\u671f\u5f85\u66f4\u591a\u4f01\u4e1a\u9009\u62e9 Apache APISIX Ingress\u3002\\n\\n## \u672a\u6765\u89c4\u5212\\n\\nApache APISIX Ingress \u5728\u4e0d\u65ad\u8fed\u4ee3\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u6536\u5230\u4e86\u5f88\u591a\u793e\u533a\u5c0f\u4f19\u4f34\u7684\u4e00\u4e9b\u5efa\u8bae\uff0c\u6bd4\u5982\u5bf9\u672a\u6765\u4ea7\u54c1\u7684\u4e00\u4e9b\u529f\u80fd\u89c4\u5212\uff1a\\n\\n### \u540e\u7eed\u652f\u6301 Kubernetes gateway API\\n\\n\u76ee\u524d Kubernetes \u793e\u533a\u91cc\u4e5f\u6709\u5f88\u591a\u4f01\u4e1a\u5728\u505a\u81ea\u5df1\u7684 Ingress \u9879\u76ee\u652f\u6301\uff0cKubernetes \u793e\u533a\u4e3a\u4e86\u80fd\u7edf\u4e00 Ingress \u7684\u8bbe\u8ba1\uff0c\u7ed9\u51fa\u4e86 gateway API \u7684\u5b9e\u73b0\u6807\u51c6\u3002\u4e00\u65e6\u5b9e\u73b0\u4e86\u8fd9\u79cd\u6807\u51c6\uff0c\u540e\u7eed\u7528\u6237\u518d\u4f7f\u7528 APISIX Ingress \u65f6\uff0c\u5c31\u53ef\u4ee5\u505a\u5230\u540c\u4e00\u4efd\u914d\u7f6e\u5728\u4e0d\u540c\u7684 Ingress \u91cc\u53bb\u4f7f\u7528\uff0c\u5b8c\u7f8e\u9002\u914d\u591a\u65b9\u90e8\u7f72\u3002\\n\\n### \u540e\u7eed\u652f\u6301 Ingress Controller \u5355\u4f53\u67b6\u6784\\n\\n\u76ee\u524d\u793e\u533a\u91cc\u6709\u4e00\u4e9b\u58f0\u97f3\u4f1a\u8ba4\u4e3a Apache APISIX \u6240\u4f9d\u8d56\u7684 etcd \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6709\u72b6\u6001\u7684\u670d\u52a1\uff0c\u4e00\u65e6\u6d89\u53ca\u5230\u6709\u72b6\u6001\u7684\u670d\u52a1\uff0c\u5c31\u9700\u8981\u989d\u5916\u53bb\u5173\u6ce8\u5b58\u50a8\u548c\u8fc1\u79fb\u76f8\u5173\u7684\u5de5\u4f5c\u3002\\n\\n\u5927\u5bb6\u5e0c\u671b\u5728\u5bb9\u5668\u5316\u7684\u4e91\u539f\u751f\u573a\u666f\u4e0b\uff0c\u8ba9 Apache APISIX \u53ef\u4ee5\u65e0\u7f1d\u6269\u5bb9\uff0c\u6240\u4ee5\u540e\u7eed\u4e5f\u4f1a\u53bb\u8fdb\u884c Ingress Controller \u5355\u4f53\u67b6\u6784\u7684\u90e8\u7f72\u89c4\u5212\u3002\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0cApache APISIX \u53ef\u4ee5\u8131\u79bb etcd \u5355\u72ec\u90e8\u7f72\uff0c\u58f0\u660e\u5f0f\u914d\u7f6e\u53ef\u4ee5\u88ab Apache APISIX Ingress Controller \u76d1\u542c\u5e76\u540c\u6b65\u5230 Apache APISIX\u3002\\n\\n\u66f4\u591a\u672a\u6765\u89c4\u5212\u4ee5\u53ca\u7279\u6027\u76f8\u5173\u5185\u5bb9[\u70b9\u6b64\u67e5\u9605](https://github.com/apache/apisix-ingress-controller/milestones)\u3002\\n\\n\u793e\u533a\u7684\u53d1\u5c55\u662f\u6c38\u65e0\u6b62\u5883\u7684\uff0c\u5f88\u611f\u8c22\u4e00\u8def\u4ee5\u6765\u5404\u4f4d\u7528\u6237\u5bf9 Apache APISIX Ingress Controller \u7684\u652f\u6301\u3002\u5e0c\u671b\u5927\u5bb6\u5728\u540e\u7eed\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u79ef\u6781\u5730\u53c2\u4e0e\u548c\u53cd\u9988\u5173\u4e8e Apache APISIX Ingress Controller \u9879\u76ee\u7684\u4efb\u4f55\u95ee\u9898\uff0c\u8ba9\u4ea7\u54c1\u53d8\u5f97\u66f4\u4f18\u79c0\u3002"},{"id":"\u5982\u4f55\u5728 APISIX Ingress Controller \u4e2d\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66","metadata":{"permalink":"/zh/blog/2021/10/22/cert-manager-in-ingress","source":"@site/blog/2021/10/22/cert-manager-in-ingress.md","title":"\u5982\u4f55\u5728 APISIX Ingress Controller \u4e2d\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66","description":"Apache APISIX Ingress Controller \u5df2\u7ecf\u5b9e\u73b0\u4e86\u8bc1\u4e66\u7ba1\u7406\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u91d1\u4e1d\u96c0\u53d1\u5e03\u7b49\u529f\u80fd\uff0c\u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u901a\u8fc7 Cert Manager \u5728 APISIX Ingress Controller \u91cc\u8fdb\u884c\u8bc1\u4e66\u7ba1\u7406\u3002","date":"2021-10-22T00:00:00.000Z","formattedDate":"2021\u5e7410\u670822\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":7.585,"truncated":true,"authors":[{"name":"\u5f20\u8d85","url":"https://github.com/tokers","imageURL":"https://avatars.githubusercontent.com/u/10428333?v=4"}],"prevItem":{"title":"APISIX Ingress \u9879\u76ee\u4ece 0 \u5230 1 \u7684\u53d1\u5c55\u5386\u7a0b","permalink":"/zh/blog/2021/10/26/apisix-ingress"},"nextItem":{"title":"\u76f4\u64ad\u9884\u544a | Apache APISIX \xd7 Apache SkyWalking \u7ebf\u4e0a\u5206\u4eab","permalink":"/zh/blog/2021/10/18/meetup"}},"content":"> \u672c\u6587\u5c06\u901a\u8fc7\u8be6\u7ec6\u7684\u4ee3\u7801\u6b65\u9aa4\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 Cert Manager \u5728 Apache APISIX Ingress Controller \u91cc\u8fdb\u884c\u8bc1\u4e66\u7ba1\u7406\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n[Apache APISIX Ingress Controller](https://github.com/apache/apisix-ingress-controller) \u662f\u4e00\u6b3e\u4ee5 [Apache APISIX](http://apisix.apache.org/) \u4f5c\u4e3a\u6570\u636e\u9762\u7684 [Kubernetes Ingress Controller](https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/) \u5f00\u6e90\u5de5\u5177\uff0c\u76ee\u524d\u5df2\u7ecf\u66f4\u65b0\u5230 [v1.3](https://github.com/apache/apisix-ingress-controller/blob/master/CHANGELOG.md#130) \u7248\u672c\uff0c\u5b9e\u73b0\u4e86\u5982\u8bc1\u4e66\u7ba1\u7406\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u91d1\u4e1d\u96c0\u53d1\u5e03\u7b49\u529f\u80fd\u3002\\n\\n\u957f\u4e45\u4ee5\u6765\uff0c\u8bc1\u4e66\u7ba1\u7406\u90fd\u4e0d\u662f\u4e00\u4ef6\u7b80\u5355\u7684\u4e8b\u60c5\uff0c\u867d\u7136 Apache APISIX Ingress Controller \u652f\u6301\u4ece Kubernetes Secrets \u8d44\u6e90\u4e2d\u63d0\u53d6\u8bc1\u4e66\u548c\u79c1\u94a5\uff0c\u5e76\u8f6c\u6362\u4e3a Apache APISIX \u53ef\u8bc6\u522b\u7684 SSL \u5bf9\u8c61\uff0c\u4f46\u8fd9\u53ea\u662f\u6574\u4e2a\u8bc1\u4e66\u7ba1\u7406\u94fe\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u8bc1\u4e66\u7684\u9881\u53d1\u3001\u8f6e\u8f6c\u3001\u540a\u9500\u903b\u8f91\u4f9d\u7136\u9700\u8981\u7ba1\u7406\u5458\u6267\u884c\uff0c\u5c24\u5176\u5f53\u8bc1\u4e66\u6570\u91cf\u6bd4\u8f83\u591a\u65f6\uff0c\u5de5\u4f5c\u91cf\u5f80\u5f80\u5e76\u4e0d\u5c0f\uff0c\u56e0\u800c\u4f1a\u5360\u7528\u7ba1\u7406\u5458\u4e0d\u5c11\u7684\u65f6\u95f4\u3002\\n\\n[Cert Manager](https://cert-manager.io/docs/) \u662f\u4e00\u6b3e\u81f4\u529b\u4e8e\u5728 Kubernetes \u5e73\u53f0\u4e0a\u7b80\u5316\u8bc1\u4e66\u7ba1\u7406\u7684\u8f6f\u4ef6\uff0c\u5b83\u652f\u6301\u5bf9\u63a5\u8bb8\u591a\u4e0d\u540c\u7684\u8bc1\u4e66\u6e90\uff0c\u5982 [Let\u2019s Encrypt](https://letsencrypt.org/) \u548c [HashiCorp Vault](https://www.vaultproject.io/)\u3002\\n\\n\u5982\u679c\u4f60\u5728\u4f7f\u7528 Apache APISIX Ingress Controller \u65f6\uff0c\u9047\u5230\u4e86\u8bc1\u4e66\u7ba1\u7406\u7684\u9ebb\u70e6\uff0c\u90a3\u4e48\u4f7f\u7528 Cert Manager \u5c06\u4f1a\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\uff0c\u672c\u6587\u5c06\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 Cert Manager \u6765\u521b\u5efa\u8bc1\u4e66\u5e76\u5bf9\u63a5\u5230 Apache APISIX Ingress Controller\u3002\\n\\n## \u6b65\u9aa4\u4e00\uff1a\u73af\u5883\u51c6\u5907\\n\\n\u5982\u679c\u4f60\u5e0c\u671b\u6309\u7167\u672c\u6587\u7684\u6307\u5bfc\u8fdb\u884c\u5b9e\u9645\u7684\u64cd\u4f5c\uff0c\u8bf7\u786e\u4fdd\u4ee5\u4e0b\u73af\u5883\u548c\u5de5\u5177\u5df2\u51c6\u5907\u5c31\u7eea\uff1a\\n\\n1. \u51c6\u5907\u4e00\u4e2a\u53ef\u7528\u7684 Kubernetes \u96c6\u7fa4\uff0c\u5f00\u53d1\u73af\u5883\u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 [Kind](https://kind.sigs.k8s.io/) \u548c [Minikube](https://kubernetes.io/docs/tutorials/hello-minikube/)\\n2. \u5b89\u88c5 [kubectl](https://kubernetes.io/docs/tutorials/hello-minikube/)\\n3. \u5b89\u88c5 [Helm v3](https://helm.sh/)\\n\\n> \u8bf7\u6ce8\u610f\uff0c\u4e0b\u6587\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u5c06\u5728 ingress-apisix \u547d\u540d\u7a7a\u95f4\u4e2d\u6267\u884c\uff0c\u56e0\u6b64\u9700\u8981\u5148\u521b\u5efa\u8be5\u547d\u540d\u7a7a\u95f4\uff1a`kubectl create namespace ingress-apisix`\\n\\n## \u6b65\u9aa4\u4e8c\uff1a\u5b89\u88c5 Apache APISIX Ingress Controller\\n\\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Helm \u6765\u5b89\u88c5 Apache APISIX Ingress Controller\uff0c\u5305\u62ec\u6570\u636e\u9762\u7684 Apache APISIX \u548c etcd \u96c6\u7fa4\u3002\\n\\n``` shell\\nhelm repo add apisix https://charts.apiseven.com\\nhelm repo update\\nhelm install apisix apisix/apisix --set gateway.tls.enabled=true --set ingress-controller.enabled=true --namespace ingress-apisix\\n```\\n\\n\u70b9\u51fb\u67e5\u770b[\u8be6\u7ec6\u5b89\u88c5\u4ecb\u7ecd](https://github.com/apache/apisix-helm-chart/blob/master/charts/apisix/README.md)\u3002\\n\\n## \u6b65\u9aa4\u4e09\uff1a\u5b89\u88c5 Cert Manager\\n\\n\u901a\u8fc7 Helm \u6765\u5b89\u88c5 Cert Manager\uff0c\u70b9\u51fb\u53ef\u67e5\u770b[\u8be6\u7ec6\u5b89\u88c5\u4ecb\u7ecd](https://cert-manager.io/docs/installation/)\u3002\\n\\n```shell\\nhelm install cert-manager jetstack/cert-manager --namespace ingress-apisix  --set prometheus.enabled=false --set installCRDs=true\\n```\\n\\n\u5b89\u88c5\u5b8c\u6bd5\u540e\u8bf7\u7b49\u5f85\u4e00\u4f1a\u540e\u67e5\u770b\u7ec4\u4ef6\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u786e\u4fdd\u6240\u6709\u7ec4\u4ef6\u90fd\u5df2\u6b63\u5e38\u8fd0\u884c\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u67e5\u770b\u3002\\n\\n```shell\\nkubectl get all -n ingress-apisix\\n```\\n\\n\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\u6240\u793a\uff0c\u8868\u793a\u6240\u6709\u7ec4\u4ef6\u90fd\u5df2\u6b63\u5e38\u8fd0\u884c\u3002\\n\\n```Apache\\nNAME                                             READY   STATUS        RESTARTS   AGE\\npod/apisix-5d99956d88-j68sj                      1/1     Running       0          63s\\npod/apisix-69459554d4-btnwn                      0/1     Terminating   0          57m\\npod/apisix-etcd-0                                1/1     Running       0          57m\\npod/apisix-etcd-1                                1/1     Running       0          57m\\npod/apisix-etcd-2                                0/1     Running       0          50s\\npod/apisix-ingress-controller-7b5c767cc7-j62hb   1/1     Running       0          55m\\npod/cert-manager-5ffd4f6c89-q9f7m                1/1     Running       0          45m\\npod/cert-manager-cainjector-748dc889c5-nrvkh     1/1     Running       0          45m\\npod/cert-manager-startupapicheck-kmgxf           0/1     Completed     0          45m\\npod/cert-manager-webhook-bc964d98b-mkjj7         1/1     Running       0          45m\\n\\nNAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\\nservice/apisix-admin                ClusterIP   10.96.16.25     <none>        9180/TCP                     57m\\nservice/apisix-etcd                 ClusterIP   10.96.232.251   <none>        2379/TCP,2380/TCP            57m\\nservice/apisix-etcd-headless        ClusterIP   None            <none>        2379/TCP,2380/TCP            57m\\nservice/apisix-gateway              NodePort    10.96.118.75    <none>        80:32039/TCP,443:30107/TCP   57m\\nservice/apisix-ingress-controller   ClusterIP   10.96.13.76     <none>        80/TCP                       57m\\nservice/cert-manager-webhook        ClusterIP   10.96.182.188   <none>        443/TCP                      45m\\n\\nNAME                                        READY   UP-TO-DATE   AVAILABLE   AGE\\ndeployment.apps/apisix                      1/1     1            1           57m\\ndeployment.apps/apisix-ingress-controller   1/1     1            1           57m\\ndeployment.apps/cert-manager                1/1     1            1           45m\\ndeployment.apps/cert-manager-cainjector     1/1     1            1           45m\\ndeployment.apps/cert-manager-webhook        1/1     1            1           45m\\n\\nNAME                                                   DESIRED   CURRENT   READY   AGE\\nreplicaset.apps/apisix-5d99956d88                      1         1         1       63s\\nreplicaset.apps/apisix-69459554d4                      0         0         0       57m\\nreplicaset.apps/apisix-ingress-controller-74c6b5fbdd   0         0         0       57m\\nreplicaset.apps/apisix-ingress-controller-7b5c767cc7   1         1         1       55m\\nreplicaset.apps/apisix-ingress-controller-7d58db957c   0         0         0       55m\\nreplicaset.apps/cert-manager-5ffd4f6c89                1         1         1       45m\\nreplicaset.apps/cert-manager-cainjector-748dc889c5     1         1         1       45m\\nreplicaset.apps/cert-manager-webhook-bc964d98b         1         1         1       45m\\n\\nNAME                           READY   AGE\\nstatefulset.apps/apisix-etcd   2/3     57m\\n\\nNAME                                     COMPLETIONS   DURATION   AGE\\njob.batch/cert-manager-startupapicheck   1/1           6m24s      45m\\n```\\n\\n> [Kubernetes Controller Manager](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-controller-manager/) \u7684\u673a\u5236\u51b3\u5b9a\u4e86 Pod \u540d\u79f0\u4f1a\u6709\u6240\u4e0d\u540c\u3002\\n\\n## \u6b65\u9aa4\u56db\uff1a\u7533\u8bf7\u8bc1\u4e66\u5e76\u6d4b\u8bd5\\n\\n\u9996\u5148\u6211\u4eec\u9700\u8981\u914d\u7f6e\u8bc1\u4e66\u9881\u53d1\u5bf9\u8c61\u3002\\n\\n```yaml\\n# issuer.yaml\\napiVersion: cert-manager.io/v1\\nkind: Issuer\\nmetadata:\\n  name: issuer\\n  namespace: ingress-apisix\\nspec:\\n  selfSigned: {}\\n```\\n\\n\u5e76\u521b\u5efa\u81ea\u7b7e\u540d\u8bc1\u4e66\u9881\u53d1\u8005\u3002\\n\\n```shell\\nkubectl apply -f issuer.yaml\\n```\\n\\n> \u8bf7\u6ce8\u610f\uff0c\u81ea\u7b7e\u540d\u9881\u53d1\u5bf9\u8c61\u4e0d\u63a8\u8350\u4f7f\u7528\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff01\u66f4\u591a\u8bc1\u4e66\u9881\u53d1\u5bf9\u8c61\u7684\u914d\u7f6e\u8bf7\u53c2\u8003[\u8fd9\u91cc](https://cert-manager.io/docs/configuration/)\u3002\\n\\n\u7136\u540e\u4e3a\u57df\u540d `httpbin.org` \u521b\u5efa\u4e00\u5f20\u8bc1\u4e66\u3002\\n\\n```yaml\\n# httpbin-cert.yaml\\napiVersion: cert-manager.io/v1\\nkind: Certificate\\nmetadata:\\n  name: httpbin\\n  namespace: ingress-apisix\\nspec:\\n  secretName: httpbin\\n  duration: 2160h # 90d\\n  renewBefore: 360h # 15d\\n  subject:\\n    organizations:\\n      - foo\\n  commonName: httpbin.org\\n  isCA: false\\n  privateKey:\\n    algorithm: RSA\\n    encoding: PKCS1\\n    size: 2048\\n  usages:\\n    - server auth\\n  dnsNames:\\n    - \\"httpbin.org\\"\\n    - \\"*.httpbin.org\\"\\n  issuerRef:\\n    name: issuer\\n    kind: Issuer\\n    group: cert-manager.io\\n```\\n\\n```shell\\nkubectl apply -f httpbin-cert.yaml\\n```\\n\\n\u6b64\u65f6\u9700\u8981\u67e5\u770b\u5bf9\u5e94 Secrets \u662f\u5426\u5df2\u7ecf\u88ab\u521b\u5efa\u3002\\n\\n```shell\\nkubectl get secrets -n ingress-apisix httpbin\\nNAME      TYPE                DATA   AGE\\nhttpbin   kubernetes.io/tls   3      2m5s\\n```\\n\\n\u901a\u8fc7\u4e0a\u8ff0\u9a8c\u8bc1\uff0c\u8be5 Secrets \u5bf9\u8c61\u7684\u521b\u5efa\u4e8b\u4ef6\u5df2\u7ecf\u88ab Apache APISIX Ingress Controller \u6355\u83b7\u5230\uff0c\u6211\u4eec\u5c1d\u8bd5\u8bbf\u95ee Apache APISIX Ingress Controller \u6765\u9a8c\u8bc1\u8bc1\u4e66\u662f\u5426\u751f\u6548\uff0c\u9996\u5148\u6211\u4eec\u9700\u8981\u521b\u5efa\u989d\u5916\u7684\u8def\u7531\u5bf9\u8c61\u3002\\n\\n```shell\\n# \u521b\u5efa\u540e\u7aef\\nkubectl run httpbin --image kennethreitz/httpbin --namespace ingress-apisix\\nkubectl expose pod httpbin -n ingress-apisix --port 80\\n```\\n\\n```yaml\\n# \u5b9a\u4e49 ApisixTls \u5bf9\u8c61\\napiVersion: apisix.apache.org/v1\\nkind: ApisixTls\\nmetadata:\\n  name: httpbin\\n  namespace: ingress-apisix\\nspec:\\n  hosts:\\n  - httpbin.org\\n  secret:\\n    name: httpbin\\n    namespace: ingress-apisix\\n---\\n# \u5b9a\u4e49\u8bbf\u95ee\u540e\u7aef\u7684\u8def\u7531\\napiVersion: apisix.apache.org/v2beta1\\nkind: ApisixRoute\\nmetadata:\\n  name: httpbin\\n  namespace: ingress-apisix\\nspec:\\n  http:\\n  - name: httpbin\\n    match:\\n      paths:\\n      - /*\\n      hosts:\\n      - httpbin.org\\n    backends:\\n    - serviceName: httpbin\\n      servicePort: 80\\n```\\n\\n\u63a5\u4e0b\u6765\u8bbf\u95ee\u670d\u52a1 `apisix-gateway`\u3002\u6ce8\u610f\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8be5\u670d\u52a1\u7684\u7c7b\u578b\u4e3a `NodePort`\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4fee\u6539\u5176\u7c7b\u578b\uff0c\u6bd4\u5982\u4f60\u7684 Kubernetes \u96c6\u7fa4\u662f\u4e91\u5382\u5546\u6258\u7ba1\u7684\uff0c\u5219\u53ef\u4ee5\u8003\u8651\u5c06\u5176\u4fee\u6539\u4e3a `LoadBalancer` \u7c7b\u578b\uff0c\u4ee5\u83b7\u53d6\u4e00\u4e2a\u5916\u90e8\u53ef\u8fbe\u7684 IP\u3002\\n\\n\u8fd9\u91cc\u6211\u4eec\u901a\u8fc7\u7aef\u53e3\u8f6c\u53d1\u7684\u65b9\u5f0f\u5c06\u670d\u52a1\u6620\u5c04\u5230\u672c\u5730\u3002\\n\\n```shell\\nkubectl port-forward -n ingress-apisix svc/apisix-gateway 8443:443\\n```\\n\\n\u7136\u540e\u5f00\u59cb\u914d\u7f6e\u8bbf\u95ee\u3002\\n\\n```shell\\ncurl https://httpbin.org:8443/json --resolve \'httpbin.org:8443:127.0.0.1\' -sk\\n{\\n  \\"slideshow\\": {\\n    \\"author\\": \\"Yours Truly\\",\\n    \\"date\\": \\"date of publication\\",\\n    \\"slides\\": [\\n      {\\n        \\"title\\": \\"Wake up to WonderWidgets!\\",\\n        \\"type\\": \\"all\\"\\n      },\\n      {\\n        \\"items\\": [\\n          \\"Why <em>WonderWidgets</em> are great\\",\\n          \\"Who <em>buys</em> WonderWidgets\\"\\n        ],\\n        \\"title\\": \\"Overview\\",\\n        \\"type\\": \\"all\\"\\n      }\\n    ],\\n    \\"title\\": \\"Sample Slide Show\\"\\n  }\\n}\\n```\\n\\n\u7ecf\u8fc7\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u53ef\u4ee5\u770b\u5230\u8bbf\u95ee\u6210\u529f\uff0c\u8bf4\u660e\u8bc1\u4e66\u5df2\u7ecf\u751f\u6548\u3002\u6ce8\u610f\uff0c\u7531\u4e8e\u8bc1\u4e66\u662f\u81ea\u7b7e\u540d\u7684\uff0c\u8fd9\u91cc\u9700\u8981\u52a0\u4e0a `-k` \u9009\u9879\u6765\u5ffd\u7565\u8bc1\u4e66\u7684\u6821\u9a8c\u3002\\n\\n\u6b64\u5916\uff0c\u5982\u679c\u4f60\u60f3\u8981\u8f6e\u8f6c\u8bc1\u4e66\uff0c\u5220\u9664 `httpbin` \u8fd9\u4e00 Secret \u5bf9\u8c61\u5373\u53ef\uff0cCert Manager \u4f1a\u7acb\u523b\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 httpbin  Secret \u5bf9\u8c61\uff0c\u5e76\u4e14\u5305\u542b\u65b0\u7684\u8bc1\u4e66\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4e3b\u8981\u8bb2\u89e3\u4e86\u5982\u4f55\u5229\u7528 Cert Manager \u5728 Apache APISIX Ingress Controller \u4e2d\u8fdb\u884c\u8bc1\u4e66\u7684\u521b\u5efa\u548c\u7ba1\u7406\u3002\u60f3\u4e86\u89e3\u66f4\u591a\u5173\u4e8e Apache APISIX Ingress \u7684\u4ecb\u7ecd\u4e0e\u5185\u5bb9\uff0c\u53ef\u53c2\u8003[\u672c\u7bc7\u6587\u7ae0](https://apisix.apache.org/zh/blog/2021/10/09/apisix-ingress-techblog/)\u3002\\n\\n\u6216\u8005\u53c2\u4e0e Apache APISIX  Ingress \u9879\u76ee\u6bcf\u4e24\u5468\u4e3e\u884c\u7684\u7ebf\u4e0a\u8ba8\u8bba\uff0c\u5206\u4eab\u5f53\u4e0b\u9879\u76ee\u8fdb\u5ea6\u3001\u6700\u4f73\u5b9e\u8df5\u53ca\u8bbe\u8ba1\u601d\u8def\u7b49\u591a\u4e2a\u8bdd\u9898\uff0c\u53ef\u67e5\u770b\u5177\u4f53 [issue](https://github.com/apache/apisix-ingress-controller/issues/614) \u4e86\u89e3\u66f4\u591a\u3002"},{"id":"\u76f4\u64ad\u9884\u544a | Apache APISIX \xd7 Apache SkyWalking \u7ebf\u4e0a\u5206\u4eab","metadata":{"permalink":"/zh/blog/2021/10/18/meetup","source":"@site/blog/2021/10/18/meetup.md","title":"\u76f4\u64ad\u9884\u544a | Apache APISIX \xd7 Apache SkyWalking \u7ebf\u4e0a\u5206\u4eab","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8054\u5408 Apache SkyWalking \u793e\u533a\u4e3a\u5927\u5bb6\u5e26\u6765\u7ebf\u4e0a\u5206\u4eab\uff0c\u5305\u542b\u4e86 Apache APISIX \u53ef\u89c2\u6d4b\u6027\u4ecb\u7ecd\u548cAPISIX Ingress Controller \u9879\u76ee\u76f8\u5173\u60c5\u51b5\u3002","date":"2021-10-18T00:00:00.000Z","formattedDate":"2021\u5e7410\u670818\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.135,"truncated":true,"authors":[],"prevItem":{"title":"\u5982\u4f55\u5728 APISIX Ingress Controller \u4e2d\u4f7f\u7528 Cert Manager \u7ba1\u7406\u8bc1\u4e66","permalink":"/zh/blog/2021/10/22/cert-manager-in-ingress"},"nextItem":{"title":"\u793e\u533a\u5468\u62a5\uff0810.1-10.14\uff09","permalink":"/zh/blog/2021/10/14/weekly-report-1014"}},"content":"> 10 \u6708 23 \u65e5\uff0cApache APISIX \u793e\u533a\u8054\u5408 Apache SkyWalking \u793e\u533a\u4e3a\u5927\u5bb6\u5e26\u6765\u7ebf\u4e0a\u5206\u4eab\uff0c\u5feb\u6765\u770b\u770b\u6709\u54ea\u4e9b\u7cbe\u5f69\u7684\u8bae\u9898\u5427\u3002\\n\x3c!--truncate--\x3e\\n\\n![Apache APISIX \xd7 Apache SkyWalking Meetup](https://static.apiseven.com/202108/1634607898296-26d3dbea-da8b-41cc-a50d-b4aa37f69f5f.jpeg)\\n\\n## \u5206\u4eab\u8bae\u9898\\n\\n### Apache APISIX \u53ef\u89c2\u6d4b\u6027\u4ecb\u7ecd\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u5e84\u6d69\u6f6e\uff0cApache APISIX Contributor\uff0cApache SkyWalking Committer & PMC \u6210\u5458\u3002\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\nApache APISIX \u76f8\u5bf9\u539f\u751f Nginx \u6709\u6bd4\u8f83\u5b8c\u5584\u53ef\u89c2\u6d4b\u6027\u80fd\u529b\uff0c\u5c06\u4ecb\u7ecd Apache APISIX \u5df2\u6709\u7684\u76d1\u63a7\u624b\u6bb5\u548c\u80fd\u529b\u3002\u4ee5\u53ca\u4e0e Apache SkyWalking \u96c6\u6210\u4e4b\u540e\uff0c\u6709\u54ea\u4e9b\u529f\u80fd\u7684\u589e\u5f3a\uff0c\u5c06\u6765\u8fd8\u4f1a\u5e26\u54ea\u4e9b\u65b0\u7279\u6027\u3002\u4e00\u8d77\u671f\u5f85\u7ea2\u84dd\uff08APISIX X SkyWalking\uff09\u7ec4\u5408\u80fd\u5e26\u6765\u54ea\u4e9b\u706b\u82b1\u3002\\n\\n### \u5229\u7528 Apache SkyWalking Infra E2E \u8fdb\u884c\u7aef\u5230\u7aef\u6d4b\u8bd5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u5218\u6657\uff0cApache SkyWalking Committer & PMC \u6210\u5458\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u73b0\u5728\u8d8a\u6765\u8d8a\u591a\u7684\u9879\u76ee\u5f00\u59cb\u5229\u7528\u7aef\u5230\u7aef\u6d4b\u8bd5\u6765\u5b8c\u6210\u81ea\u52a8\u5316\u529f\u80fd\u68c0\u6d4b\uff0c\u672c\u6b21\u5206\u4eab\u7740\u91cd\u8bb2\u89e3 SkyWalking-Infra-E2E \u6846\u67b6\u4e0e\u5176\u5728 Apache SkyWalking \u4e2d\u7684\u843d\u5730\u3002\\n\\n### Apache APISIX Ingress Controller \u5982\u4f55\u5728\u793e\u533a\u4e2d\u6210\u957f\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u91d1\u536b\uff0cApache APISIX PMC\uff0cApache SkyWalking Committer\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n1. \u4ecb\u7ecd Apache APISIX Ingress Controller \u9879\u76ee\\n2. \u52a0\u5165 Apache \u793e\u533a\u540e\u5e26\u6765\u65b0\u7684\u6d3b\u529b\\n3. Apache APISIX Ingress Controller \u5728\u793e\u533a\u4e2d\u7684\u8fd0\u4f5c\u65b9\u5f0f\\n4. \u6b22\u8fce\u52a0\u5165 Apache APISIX \u793e\u533a\\n\\n### License Eye - \u5f00\u6e90\u8f6f\u4ef6\u534f\u8bae\u5229\u5668\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u67ef\u632f\u65ed\uff0cApache SkyWalking PMC \u6210\u5458\uff0cApache \u5b75\u5316\u5668 PMC \u6210\u5458\u548c\u5bfc\u5e08\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u672c\u6b21\u5206\u4eab\u5c06\u4ee5 Apache SkyWalking \u4e3a\u4f8b\uff0c\u603b\u7ed3\u5f00\u6e90\u9879\u76ee\u8fd0\u8425\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u9047\u5230\u7684\u534f\u8bae\u95ee\u9898\uff0c\u5e76\u8be6\u7ec6\u4ecb\u7ecd\u5f00\u6e90\u534f\u8bae\u7684\u5904\u7406\u5de5\u5177 License Eye \u7684\u4f7f\u7528\u65b9\u5f0f\u3002\\n\\n## \u53c2\u4e0e\u65b9\u5f0f\\n\\n\ud83d\udc47\ud83d\udc47\ud83d\udc47 \u626b\u7801\u5173\u6ce8\u89c6\u9891\u53f7\uff0c\u9884\u7ea6\u672c\u6b21\u76f4\u64ad\u3002\\n![Apache APISIX wechat](https://apisix.apache.org/assets/images/2021-08-21-2-e9610756c89fec849caeb66361bce002.png)\\n\\n10 \u6708 23 \u65e5\uff08\u5468\u516d\uff0914:00\uff0c\u6211\u4eec\u76f4\u64ad\u89c1\uff01"},{"id":"\u793e\u533a\u5468\u62a5\uff0810.1-10.14\uff09","metadata":{"permalink":"/zh/blog/2021/10/14/weekly-report-1014","source":"@site/blog/2021/10/14/weekly-report-1014.md","title":"\u793e\u533a\u5468\u62a5\uff0810.1-10.14\uff09","description":"\u672c\u5468\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u793e\u533a\u65b0\u589e\u4e86 ldap-auth \u63d2\u4ef6\uff0c\u5e76\u652f\u6301\u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6\u4ee5\u53ca\u652f\u6301\u914d\u7f6e Service \u4e2d host \u5b57\u6bb5\u63d0\u4f9b\u8def\u7531\u9ed8\u8ba4\u503c\u7b49\u529f\u80fd\u3002","date":"2021-10-14T00:00:00.000Z","formattedDate":"2021\u5e7410\u670814\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.615,"truncated":true,"authors":[],"prevItem":{"title":"\u76f4\u64ad\u9884\u544a | Apache APISIX \xd7 Apache SkyWalking \u7ebf\u4e0a\u5206\u4eab","permalink":"/zh/blog/2021/10/18/meetup"},"nextItem":{"title":"Apache APISIX \u793e\u533a\u65b0\u91cc\u7a0b\u7891\u2014\u2014\u5168\u7403\u8d21\u732e\u8005\u7a81\u7834 300 \u4f4d\uff01","permalink":"/zh/blog/2021/10/13/celebrating-300-contributors-of-apisix"}},"content":"> \u4ece 10.1 \u5230 10.14, \u6709 27 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 67 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1634183939241-a87516e5-cb52-4532-87e2-306c09155a70.png)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1634183019951-bcf250cd-e5b5-443e-afc4-3cfdef0d6eab.jpg)\\n\\n## Good first issue\\n\\n### Issue #5165\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/5165\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\\n\\n- \u5f53\u6d4f\u89c8\u5668\u8de8\u57df\u53d1\u5e03\u7136\u540e\u663e\u793a CORS error \u65f6\uff0c`wolf-rbac` \u63d2\u4ef6\u7684\u767b\u5f55 `url/apisix/plugin/wolf-rbac/login` \u4f1a\u8fd4\u56de `json` \u683c\u5f0f\uff0c\u4f46\u662f `header` \u7ed9\u51fa\u7684\u5185\u5bb9\u7c7b\u578b\u662f `text/plain`\uff0c\u8bf7\u4fee\u6539\u63d2\u4ef6\u767b\u5f55\u540e\u7684\u5185\u5bb9\u7c7b\u578b\u4e3a `application/json`\u3002\\n\\n- `wolf-rabc` \u7684\u767b\u5f55 `uri/apisix/plugin/wolf-rbac/login` \u4f1a\u5931\u53bb\u6dfb\u52a0\u5934\u7684 CORS \u63d2\u4ef6\u3002\\n\\n### Issue #5192\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/5192\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5b89\u88c5 APISIX \u4f9d\u8d56\u7684\u65f6\u5019\uff0c\u4e0d\u540c\u7684 Linux \u53d1\u884c\u7248\u4f1a\u6709\u4e0d\u540c\u7684\u6267\u884c\u3002\u662f\u5426\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u4e0d\u540c\u7684\u6267\u884c\u5408\u5e76\u5230 \u201cinstall-dependencise.sh\u201d \u4e2d\uff0c\u8fd9\u6837\u7528\u6237\u5728\u5b89\u88c5\u4f9d\u8d56\u65f6\u4f1a\u66f4\u52a0\u65b9\u4fbf\u3002\\n\\n## \u672c\u5468\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [Dashboard \u652f\u6301\u914d\u7f6e Service \u4e2d host \u5b57\u6bb5\u63d0\u4f9b\u8def\u7531\u9ed8\u8ba4\u503c](https://github.com/apache/apisix-dashboard/pull/2149)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n- [APISIX \u652f\u6301\u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6](https://github.com/apache/apisix/pull/5171)\uff08\u8d21\u732e\u8005\uff1a[nic-chen](https://github.com/nic-chen)\uff09\\n\\n- [APISIX \u65b0\u589e ldap-auth \u63d2\u4ef6](https://github.com/apache/apisix/pull/3894)\uff08\u8d21\u732e\u8005\uff1a[jp-gouin](https://github.com/jp-gouin)\uff09\\n\\n## \u672c\u5468\u535a\u6587\u63a8\u8350\\n\\n- [Apache APISIX \u793e\u533a\u65b0\u91cc\u7a0b\u7891\u2014\u2014\u5168\u7403\u8d21\u732e\u8005\u7a81\u7834 300 \u4f4d\uff01](https://apisix.apache.org/zh/blog/2021/10/13/celebrating-300-contributors-of-apisix)\uff1a\\n\\n  Apache APISIX \u793e\u533a\u8fbe\u6210\u65b0\u7684\u91cc\u7a0b\u7891\uff0c\u4e0e Apache APISIX \u76f8\u5173\u7684\u9879\u76ee\u5168\u7403\u8d21\u732e\u8005\u7a81\u7834 300 \u4f4d\uff01 \u8ddd\u79bb Apache APISIX \u4e3b\u5e93\u8fbe\u5230 200 \u4f4d\u8d21\u732e\u8005\u91cc\u7a0b\u7891\uff0c\u4ec5\u4ec5\u95f4\u9694 3 \u4e2a\u6708\uff01\u611f\u8c22\u793e\u533a\u8d21\u732e\u8005\u4eec\u5728\u4ee3\u7801\u3001\u6587\u6863\u3001\u8fd0\u8425\u7b49\u65b9\u65b9\u9762\u9762\u505a\u51fa\u7684\u5353\u8d8a\u8d21\u732e\u3002\\n\\n- [Apache APISIX \u793e\u533a\u6210\u5458\u52a9\u529b openEuler \u53d1\u5e03\u7b2c\u4e00\u4e2a\u793e\u533a\u521b\u65b0\u7248](https://apisix.apache.org/zh/blog/2021/10/01/openEuler)\\n\\n  \u6765\u81ea Apache APISIX \u793e\u533a\u7684\u7f57\u6cfd\u8f69\u548c\u6e29\u94ed\u5728 openEuler 9 \u6708 30 \u65e5\u53d1\u5e03\u7684\u7b2c\u4e00\u4e2a\u793e\u533a\u521b\u65b0\u7248\uff08 openEuler 21.09 \uff09\u4e2d\uff0c\u4e3a OpenResty \u8fc1\u79fb\u5de5\u4f5c\u4e2d\u505a\u4e86\u975e\u5e38\u591a\u7684\u8d21\u732e\uff0c\u8ba9 OpenResty \u53ef\u4ee5\u5728\u6b27\u62c9\u5f00\u6e90\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5e73\u7a33\u9ad8\u6548\u7684\u8fd0\u884c\u3002OpenResty \u7684\u7a33\u5b9a\u8fd0\u884c\u4e5f\u610f\u5473\u7740 Apache APISIX \u53ef\u4ee5\u987a\u7545\u5730\u8fd0\u884c\u5728 openEuler \u7cfb\u7edf\u4e0a\uff0cApache APISIX \u5e95\u5c42\u57fa\u4e8e OpenResty \u505a\u4e86\u4e00\u5b9a\u5f00\u53d1\u3002\\n\\n- [Apache APISIX 2.10.0 \u6b63\u5f0f\u53d1\u5e03\uff0c\u5e26\u6765\u7b2c\u4e00\u4e2a LTS \u7248\u672c\uff01](https://apisix.apache.org/zh/blog/2021/09/29/release-apache-apisix-2.10)\\n\\n  Apache APISIX 2.10 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\ud83c\udf89 \u8fd9\u662f Apache APISIX \u9996\u4e2a LTS \u7248\u672c\uff0c\u540c\u65f6\u652f\u6301 10+ \u4e2a\u65b0\u529f\u80fd\u548c\u65b0\u63d2\u4ef6\u3002\u5feb\u901f\u9605\u8bfb\u4e86\u89e3 2.10 \u7248\u672c\u7684\u65b0\u7279\u6027\u5427\uff01"},{"id":"Apache APISIX \u793e\u533a\u65b0\u91cc\u7a0b\u7891\u2014\u2014\u5168\u7403\u8d21\u732e\u8005\u7a81\u7834 300 \u4f4d\uff01","metadata":{"permalink":"/zh/blog/2021/10/13/celebrating-300-contributors-of-apisix","source":"@site/blog/2021/10/13/celebrating-300-contributors-of-apisix.md","title":"Apache APISIX \u793e\u533a\u65b0\u91cc\u7a0b\u7891\u2014\u2014\u5168\u7403\u8d21\u732e\u8005\u7a81\u7834 300 \u4f4d\uff01","description":"API \u7f51\u5173 Apache APISIX \u793e\u533a\u8fbe\u6210\u65b0\u7684\u91cc\u7a0b\u7891\uff0c\u4e0e Apache APISIX \u76f8\u5173\u7684\u9879\u76ee\u5168\u7403\u8d21\u732e\u8005\u7a81\u7834 300 \u4f4d\uff01\u793e\u533a\u4f1a\u5b9a\u671f\u4e3e\u529e\u6d3b\u52a8\u53ca Meetup \u4ee5\u4fc3\u8fdb\u793e\u533a\u6210\u5458\u4e4b\u95f4\u7684\u4ea4\u6d41\u3002","date":"2021-10-13T00:00:00.000Z","formattedDate":"2021\u5e7410\u670813\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.46,"truncated":true,"authors":[{"name":"Apache APISIX \u793e\u533a"}],"prevItem":{"title":"\u793e\u533a\u5468\u62a5\uff0810.1-10.14\uff09","permalink":"/zh/blog/2021/10/14/weekly-report-1014"},"nextItem":{"title":"\u4ece\u6982\u5ff5\u5230\u5b9e\u8df5\u5e2e\u4f60\u5feb\u901f\u4e0a\u624b Apache APISIX Ingress","permalink":"/zh/blog/2021/10/09/apisix-ingress-techblog"}},"content":">Apache APISIX \u793e\u533a\u8fbe\u6210\u65b0\u7684\u91cc\u7a0b\u7891\uff0c\u4e0e Apache APISIX \u76f8\u5173\u7684\u9879\u76ee\u5168\u7403\u8d21\u732e\u8005\u7a81\u7834 300 \u4f4d\uff01 \u8ddd\u79bb Apache APISIX \u4e3b\u5e93\u8fbe\u5230 [200 \u4f4d\u8d21\u732e\u8005\u91cc\u7a0b\u7891](https://apisix.apache.org/blog/2021/07/06/celebrate-200-contributors/)\uff0c**\u4ec5\u4ec5\u95f4\u9694 3 \u4e2a\u6708**\uff01\u611f\u8c22\u793e\u533a\u8d21\u732e\u8005\u4eec\u5728\u4ee3\u7801\u3001\u6587\u6863\u3001\u8fd0\u8425\u7b49\u65b9\u65b9\u9762\u9762\u505a\u51fa\u7684\u5353\u8d8a\u8d21\u732e\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n![Apache APISIX contributor graph](https://static.apiseven.com/202108/1634110612788-576eb5ea-d574-4d8e-891c-8f9fc90d955a.png)\\n\\nps\uff1a\u63a8\u8350\u9605\u8bfb\u300a[\u8d21\u732e\u8005\uff0c\u662f\u8861\u91cf\u5f00\u6e90\u9879\u76ee\u7684\u91d1\u6307\u6807](https://apisix.apache.org/zh/blog/2021/08/14/contributors-the-golden-metric-of-openSource-projects-en)\u300b\uff0c[\u8d21\u732e\u8005\u8d8b\u52bf\u56fe](https://github.com/api7/contributor-graph)\\n\\n2020 \u5e74 1 \u6708 Apache APISIX \u53d1\u5e03\u4e86 1.0 \u7248\u672c\uff0c\u8fd9\u662f Apache APISIX \u7b2c\u4e00\u4e2a\u751f\u4ea7\u7248\u672c\u3002\u4e0a\u6708\u5e95 Apache APISIX \u53d1\u5e03\u4e86\u6700\u65b0\u7684\u7248\u672c [2.10.0](https://apisix.apache.org/zh/blog/2021/09/29/release-apache-apisix-2.10/)\uff0c\u8fd9\u662f Apache APISIX \u7b2c 24 \u4e2a\u7248\u672c\uff0cApache APISIX \u793e\u533a\u4fdd\u6301\u5feb\u901f\u4e14\u7a33\u5b9a\u7684\u8282\u594f\uff0c**\u6bcf\u6708\u90fd\u4f1a\u53d1\u5e03\u4e00\u4e2a\u65b0\u7248\u672c**\u3002Apache APISIX \u7684\u6bcf\u4e00\u6b21\u8ba8\u8bba\u3001\u6bcf\u4e00\u4e2a PR\u3001\u6bcf\u4e00\u4e2a\u91cc\u7a0b\u7891\u90fd\u79bb\u4e0d\u5f00\u5404\u4f4d\u8d21\u732e\u8005\u7684\u53c2\u4e0e\u3002\\n\\n\u6210\u4e3a Apache APISIX \u8d21\u732e\u8005\u6ca1\u6709\u95e8\u69db\uff0c\u5728 Apache APISIX \u793e\u533a\u4e0d\u53ea\u5305\u542b\u4ee3\u7801\u65b9\u9762\u7684\u8d21\u732e\uff0c\u8fd8\u6709\u6587\u6863\u3001\u6d4b\u8bd5\u3001\u8bbe\u8ba1\u3001\u5236\u4f5c\u89c6\u9891\u7b49\u3002\u5728 Github \u4e0a\u63d0 PR \u6216 Issue\uff0c\u53c2\u4e0e\u90ae\u4ef6\u5217\u8868\u7684\u8ba8\u8bba\uff0c\u901a\u8fc7\u76f4\u64ad\u5206\u4eab\u3001\u5728\u4ea4\u6d41\u7fa4\u5e2e\u52a9\u5927\u5bb6\u89e3\u51b3\u95ee\u9898\u3001\u53c2\u52a0 Meetup\uff0c\u90fd\u662f\u53c2\u4e0e\u5230\u793e\u533a\u7684\u9014\u5f84\u3002\u6b22\u8fce\u5927\u5bb6\u52a0\u5165\u5230 Apache APISIX \u793e\u533a\uff01\\n\\n![Apache APISIX contributors](https://static.apiseven.com/202108/1634110807125-883173f0-ddb2-4ad0-aafe-073a669bb7a0.jpg)\\n\\n## \u793e\u533a\u6d3b\u52a8\\n\\nApache APISIX \u793e\u533a\u975e\u5e38\u6d3b\u8dc3\uff0c\u8d21\u732e\u8005\u4eec\u6bcf\u6708\u90fd\u4f1a\u7ec4\u7ec7\u6d3b\u52a8\uff0c\u5e2e\u52a9\u5927\u5bb6\u66f4\u597d\u5730\u4e86\u89e3\u548c\u5e94\u7528 Apache APISIX\u3002\\n\\n### Apache APISIX Meetup\\n\\n2021 \u5e74 Apache APISIX \u4e3e\u529e\u4e86\u591a\u573a\u7ebf\u4e0a\u7ebf\u4e0b Meetup \uff0c\u7531 Apache APISIX PMC \u6210\u5458\u3001Committer\u3001Contributor \u548c\u4f01\u4e1a\u6280\u672f\u4e13\u5bb6\u5206\u4eab Apache APISIX \u7684\u6700\u4f73\u5b9e\u8df5\u3002\\n\u6b22\u8fce\u5927\u5bb6\u5173\u6ce8 [Apache APISIX bilibili](https://space.bilibili.com/551921247)\uff0c\u89c2\u770b\u5f80\u671f\u56de\u987e\u5185\u5bb9\u3002\\n\\n### Apache APISIX Ingress \u7ebf\u4e0a\u8ba8\u8bba\\n\\nApache APISIX Ingress \u9879\u76ee\u6bcf\u4e24\u5468\u4e3e\u529e\u4e00\u6b21\u7ebf\u4e0a\u8ba8\u8bba\uff0c\u5927\u5bb6\u4e00\u540c\u8ba8\u8bba\u5404\u4e2a PR\u3001issue\uff0c\u5206\u4eab\u6700\u4f73\u5b9e\u8df5\u3001\u5bf9 Ingress \u7684\u89c1\u89e3\u548c\u8bbe\u8ba1\u601d\u8def\uff0c\u53ef\u67e5\u770b [issue](https://github.com/apache/apisix-ingress-controller/issues/614) \u83b7\u53d6\u7ebf\u4e0a\u4f1a\u8bae\u5730\u5740\uff0c\u70b9\u51fb [bilibili \u89c6\u9891\u94fe\u63a5](https://space.bilibili.com/551921247)\u89c2\u770b\u5f80\u671f\u56de\u987e\u5185\u5bb9\u3002\\n\\n### Weekly Report\\n\\n\u6c47\u603b\u6bcf\u53cc\u5468 Apache APISIX \u9879\u76ee\u529f\u80fd\u5f00\u53d1\u3001Bug \u4fee\u590d\u3001\u793e\u533a\u6d3b\u52a8\u3001\u5b9e\u8df5\u6848\u4f8b\u7b49\u5185\u5bb9\uff0c\u5e2e\u52a9\u5927\u5bb6\u66f4\u5feb\u4e86\u89e3 Apache APISIX \u6700\u65b0\u8fdb\u5c55\u3002\\n\u5728 Apache APISIX \u5b98\u7f51\u70b9\u51fb Blog \u9009\u62e9 Community tag \u5373\u53ef\u67e5\u770b\u53cc\u5468 Weekly report\u3002\\n\\n\u5f80\u671f\u63a8\u8350\uff1a\\n\\n- [\u793e\u533a\u5468\u62a5\uff5c\u65b0\u664b committer \u4e24\u4f4d\uff0c\u529f\u80fd\u4eae\u70b9\u66f4\u65b0\u8fdb\u884c\u4e2d](https://apisix.apache.org/zh/blog/2021/09/15/weekly-report)\\n- [Apache APISIX \u793e\u533a\u5468\u62a5 \uff5c 2021 8.23-8.29](https://apisix.apache.org/zh/blog/2021/08/30/weekly-report)\\n- [Apache APISIX \u793e\u533a\u5468\u62a5 \uff5c 2021 8.16-8.22](https://apisix.apache.org/zh/blog/2021/08/23/weekly-report)\\n\\n\u4f60\u5e0c\u671b Apache APISIX \u793e\u533a\u4e3e\u529e\u4ec0\u4e48\u6d3b\u52a8\uff1f\u6216\u8005\u60f3\u6210\u4e3a\u67d0\u4e2a\u6d3b\u52a8\u7684\u7ec4\u7ec7\u8005/\u5fd7\u613f\u8005\uff0c\u6b22\u8fce\u5728[\u90ae\u4ef6\u5217\u8868](https://apisix.apache.org/zh/docs/general/join)\u8ba8\u8bba\uff01\\n\\n**\u793e\u533a\u5927\u4e8e\u4ee3\u7801**\u662f the Apache Way \u4e2d\u975e\u5e38\u91cd\u8981\u7684\u51c6\u5219\uff0c\u8ba9\u6211\u4eec\u4e00\u8d77\u79c9\u627f the Apache Way\uff0c\u5efa\u8bbe Apache APISIX \u4ee5\u53ca Apache APISIX \u5468\u8fb9\u751f\u6001\u3002Apache APISIX \u793e\u533a\uff0c\u611f\u6069\u6709\u4f60\uff1bApache APISIX \u793e\u533a\uff0c\u4e5f\u671f\u5f85\u66f4\u591a\u5c0f\u4f19\u4f34\u52a0\u5165\u3002"},{"id":"\u4ece\u6982\u5ff5\u5230\u5b9e\u8df5\u5e2e\u4f60\u5feb\u901f\u4e0a\u624b Apache APISIX Ingress","metadata":{"permalink":"/zh/blog/2021/10/09/apisix-ingress-techblog","source":"@site/blog/2021/10/09/apisix-ingress-techblog.md","title":"\u4ece\u6982\u5ff5\u5230\u5b9e\u8df5\u5e2e\u4f60\u5feb\u901f\u4e0a\u624b Apache APISIX Ingress","description":"\u672c\u6587\u8be6\u7ec6\u8bb2\u89e3\u4e86 API \u7f51\u5173 Apache APISIX Ingress \u7684\u5b9a\u4e49\u4ee5\u53ca\u8be5\u9879\u76ee\u4e0e K8s Ingress NGINX \u4e0d\u540c\u548c\u4f18\u52bf\uff0c\u4e5f\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e86\u6d41\u91cf\u5207\u5206\uff0c\u914d\u7f6e\u8ba4\u8bc1\u3001\u8d44\u6e90\u6269\u5c55\u7b49\u591a\u4e2a\u573a\u666f\u3002","date":"2021-10-09T00:00:00.000Z","formattedDate":"2021\u5e7410\u67089\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"},{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":14.34,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","url":"https://github.com/tao12345666333","imageURL":"https://avatars.githubusercontent.com/u/3264292?v=4"}],"prevItem":{"title":"Apache APISIX \u793e\u533a\u65b0\u91cc\u7a0b\u7891\u2014\u2014\u5168\u7403\u8d21\u732e\u8005\u7a81\u7834 300 \u4f4d\uff01","permalink":"/zh/blog/2021/10/13/celebrating-300-contributors-of-apisix"},"nextItem":{"title":"APISIX \u793e\u533a\u6210\u5458\u52a9\u529b openEuler \u53d1\u5e03\u7b2c\u4e00\u4e2a\u793e\u533a\u521b\u65b0\u7248","permalink":"/zh/blog/2021/10/01/openeuler"}},"content":">\u4f5c\u8005\u5f20\u664b\u6d9b\uff0cApache APISIX Committer\u3001Kubernetes Ingress Nginx Reviewer\uff0c\u591a\u4e2a\u4e91\u539f\u751f\u5f00\u6e90\u9879\u76ee\u7684\u8d21\u732e\u8005\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## Apache APISIX Ingress \u6982\u89c8\\n\\n### Apache APISIX Ingress \u5b9a\u4e49\\n\\n\u5728 K8s \u751f\u6001\u4e2d\uff0cIngress \u4f5c\u4e3a\u8868\u793a K8s \u6d41\u91cf\u5165\u53e3\u7684\u4e00\u79cd\u8d44\u6e90\uff0c\u60f3\u8981\u8ba9\u5176\u751f\u6548\uff0c\u5c31\u9700\u8981\u6709\u4e00\u4e2a Ingress Controller \u53bb\u76d1\u542c K8s \u4e2d\u7684 Ingress \u8d44\u6e90\uff0c\u5e76\u5bf9\u8fd9\u4e9b\u8d44\u6e90\u8fdb\u884c\u76f8\u5e94\u89c4\u5219\u7684\u89e3\u6790\u548c\u5b9e\u9645\u627f\u8f7d\u6d41\u91cf\u3002\u5728\u5f53\u4e0b\u8d8b\u52bf\u4e2d\uff0c\u50cf Kubernetes Ingress Nginx \u5c31\u662f\u4f7f\u7528\u6700\u5e7f\u6cdb\u7684 Ingress Controller \u5b9e\u73b0\u3002\\n\\n\u800c APISIX Ingress \u5219\u662f\u53e6\u4e00\u79cd Ingress Controller \u7684\u5b9e\u73b0\u3002\u8ddf Kubernetes Ingress Nginx \u7684\u533a\u522b\u4e3b\u8981\u5728\u4e8e APISIX Ingress \u662f\u4ee5 Apache APISIX \u4f5c\u4e3a\u5b9e\u9645\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u7684\u6570\u636e\u9762\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5f53\u7528\u6237\u8bf7\u6c42\u5230\u5177\u4f53\u7684\u67d0\u4e00\u4e2a\u670d\u52a1/API/\u7f51\u9875\u65f6\uff0c\u901a\u8fc7\u5916\u90e8\u4ee3\u7406\u5c06\u6574\u4e2a\u4e1a\u52a1\u6d41\u91cf/\u7528\u6237\u8bf7\u6c42\u4f20\u8f93\u5230 K8s \u96c6\u7fa4\uff0c\u7136\u540e\u7ecf\u8fc7 APISIX Ingress \u8fdb\u884c\u540e\u7eed\u5904\u7406\u3002\\n\\n![APISIX Ingress \u67b6\u6784](https://static.apiseven.com/202108/1633765366863-8964a75c-0c16-4683-ad9b-c8c83ac64ec6.png)\\n\\n\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0cAPISIX Ingress \u5206\u6210\u4e86\u4e24\u90e8\u5206\u3002\u4e00\u90e8\u5206\u662f APISIX Ingress Controller\uff0c\u4f5c\u4e3a\u63a7\u5236\u9762\u5b83\u5c06\u5b8c\u6210\u914d\u7f6e\u7ba1\u7406\u4e0e\u5206\u53d1\u3002\u53e6\u4e00\u90e8\u5206 APISIX Proxy Pod \u8d1f\u8d23\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\uff0c\u5b83\u662f\u901a\u8fc7 CRD\uff08Custom Resource Definitions\uff09\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\u3002Apache APISIX Ingress \u9664\u4e86\u652f\u6301\u81ea\u5b9a\u4e49\u8d44\u6e90\u5916\uff0c\u8fd8\u652f\u6301\u539f\u751f\u7684 K8s Ingress \u8d44\u6e90\u3002\\n\\n### Apache APISIX \u7b80\u8ff0\\n\\n\u524d\u8fb9\u6211\u4eec\u63d0\u5230\u4e86 APISIX Ingress \u662f\u91c7\u7528 Apache APISIX \u4f5c\u4e3a\u5b9e\u9645\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u7684\u6570\u636e\u9762\uff0c\u90a3\u4e48 Apache APISIX \u9879\u76ee\u53c8\u662f\u505a\u4ec0\u4e48\u7684\u5462\uff1f\\n\\n![Apache APISIX \u67b6\u6784](https://static.apiseven.com/202108/1633765402660-6b20dd1c-bef6-4dcb-974e-fa80334e0623.png)\\n\\nApache APISIX \u662f Apache \u57fa\u91d1\u4f1a\u65d7\u4e0b\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u662f\u5f53\u524d\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u3002\u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0cApache APISIX \u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\\n\\nApache APISIX \u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u5feb\u901f\u3001\u5b89\u5168\u5730\u5904\u7406 API \u548c\u5fae\u670d\u52a1\u6d41\u91cf\uff0c\u6bd4\u5982\u9650\u6d41\u8ba4\u8bc1\u3001\u65e5\u5fd7\u5b89\u5168\u529f\u80fd\uff0c\u4ee5\u53ca\u652f\u6301\u4e30\u5bcc\u7684\u81ea\u5b9a\u4e49\u63d2\u4ef6\u3002\u76ee\u524d\u4e5f\u4e0e\u5f88\u591a\u5f00\u6e90\u9879\u76ee\u5982 Apache SkyWalking\u3001Prometheus \u7b49\u4e4b\u7c7b\u7684\u7ec4\u4ef6\u8fdb\u884c\u4e86\u76f8\u5173\u96c6\u6210\u3002\\n\\n## APISIX Ingress vs K8s Ingress Nginx\\n\\n\u56e0\u4e3a\u672c\u4eba\u540c\u65f6\u53c2\u4e0e\u5230\u4e86 APISIX Ingress \u4e0e K8s Ingress Nginx \u4e24\u4e2a\u9879\u76ee\u7684\u5f00\u53d1\u548c\u7ef4\u62a4\uff0c\u6240\u4ee5\u5f88\u591a\u4eba\u4e5f\u4f1a\u95ee\u6211\uff0c\u8fd9\u4e24\u4e2a\u9879\u76ee\u505a\u6bd4\u8f83\u7684\u8bdd\uff0c\u5230\u5e95\u8be5\u5982\u4f55\u9009\u62e9\uff1f\u6216\u8005\u8bf4\u4e3a\u4ec0\u4e48\u6709\u4e86 K8s Ingress Nginx \u8fd8\u8981\u518d\u505a APISIX Ingress\u3002\\n\\n### \u914d\u7f6e\u5c42\u9762\\n\\n\u5728 APISIX Ingress \u4e2d\uff0c\u6211\u4eec\u589e\u52a0\u4e86\u4e00\u4e9b\u4e30\u5bcc\u4e14\u7075\u6d3b\u7684\u914d\u7f6e\uff0c\u6bd4\u5982\u901a\u8fc7\u5355\u4e2a\u914d\u7f6e\u6587\u4ef6\u53bb\u5b9e\u73b0\u7070\u5ea6\u90e8\u7f72\u3002\u4f46\u5728 K8s Ingress Nginx \u4e2d\u53bb\u5b9e\u73b0\u5982\u4e0a\u6548\u679c\u7684\u8bdd\uff0c\u6700\u5c11\u4e5f\u9700\u8981\u6709\u4e24\u4e2a Ingress \u8d44\u6e90\u6587\u4ef6\u624d\u53ef\u4ee5\u5b8c\u6210\u3002\\n\\n### \u4e30\u5bcc\u5ea6\\n\\n\u5728\u4e30\u5bcc\u5ea6\u4e0a\uff0c\u7531\u4e8e Apache APISIX \u672c\u8eab\u7684\u81ea\u5e26\u529f\u80fd\u4e30\u5bcc\u4e14\u5141\u8bb8\u591a\u79cd\u63d2\u4ef6\u6269\u5c55\u4f7f\u7528\uff0c\u6240\u4ee5\u4f7f\u7528 APISIX Ingress \u5c31\u53ef\u4ee5\u7701\u53bb\u81ea\u5df1\u989d\u5916\u914d\u7f6e\u529f\u80fd\u7684\u7e41\u7410\u6b65\u9aa4\uff0c\u53ef\u4ee5\u5c06\u66f4\u591a\u7684\u65f6\u95f4\u6295\u5165\u5230\u5b9e\u9645\u5f00\u53d1\u4e2d\u3002\\n\\n### \u67b6\u6784\u5206\u79bb\\n\\nAPISIX Ingress \u91c7\u7528\u4e86\u6570\u636e\u9762\u4e0e\u63a7\u5236\u9762\u7684\u5206\u79bb\u67b6\u6784\uff0c\u6240\u4ee5\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u5c06\u6570\u636e\u9762\u90e8\u7f72\u5728 K8s \u96c6\u7fa4\u5185\u90e8/\u5916\u90e8\u3002\u4f46 K8s Ingress Nginx \u662f\u5c06\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\u653e\u5728\u4e86\u540c\u4e00\u4e2a Pod \u4e2d\uff0c\u5982\u679c Pod \u6216\u63a7\u5236\u9762\u51fa\u73b0\u4e00\u70b9\u95ea\u5931\uff0c\u6574\u4e2a Pod \u5c31\u4f1a\u6302\u6389\uff0c\u8fdb\u800c\u5f71\u54cd\u5230\u4e1a\u52a1\u6d41\u91cf\u3002\\n\\n\u8fd9\u79cd\u67b6\u6784\u5206\u79bb\uff0c\u7ed9\u7528\u6237\u63d0\u4f9b\u4e86\u6bd4\u8f83\u65b9\u4fbf\u7684\u90e8\u7f72\u9009\u62e9\uff0c\u540c\u65f6\u5728\u4e1a\u52a1\u67b6\u6784\u8c03\u6574\u573a\u666f\u4e0b\uff0c\u4e5f\u65b9\u4fbf\u8fdb\u884c\u76f8\u5173\u6570\u636e\u7684\u8fc1\u79fb\u4e0e\u4f7f\u7528\u3002\\n\\n## APISIX Ingress \u7279\u6027\u8be6\u89e3\\n\\n\u7531\u4e8e Apache APISIX \u662f\u4e00\u4e2a\u5168\u52a8\u6001\u7684\u9ad8\u6027\u80fd\u7f51\u5173\uff0c\u6240\u4ee5\u5728 APISIX Ingress \u81ea\u8eab\u5c31\u652f\u6301\u4e86\u5168\u52a8\u6001\uff0c\u5305\u62ec\u8def\u7531\u3001SSL \u8bc1\u4e66\u3001\u4e0a\u6e38\u4ee5\u53ca\u63d2\u4ef6\u7b49\u7b49\u3002\\n\\n\u540c\u65f6 APISIX Ingress \u8fd8\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a\\n\\n* \u652f\u6301 CRD\uff0c\u66f4\u5bb9\u6613\u7406\u89e3\u58f0\u660e\u5f0f\u914d\u7f6e\uff1b\u540c\u65f6\u72b6\u6001\u68c0\u67e5\u53ef\u4fdd\u8bc1\u5feb\u901f\u638c\u63e1\u58f0\u660e\u914d\u7f6e\u7684\u540c\u6b65\u72b6\u6001\\n* \u652f\u6301\u9ad8\u7ea7\u8def\u7531\u5339\u914d\u89c4\u5219\u4ee5\u53ca\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u53ef\u4e0e Apache APISIX \u5b98\u65b9 50 \u591a\u4e2a\u63d2\u4ef6 & \u5ba2\u6237\u81ea\u5b9a\u4e49\u63d2\u4ef6\u8fdb\u884c\u6269\u5c55\u4f7f\u7528\\n* \u652f\u6301 K8s \u539f\u751f Ingress \u914d\u7f6e\\n* \u652f\u6301\u6d41\u91cf\u5207\u5206\\n* \u652f\u6301 gRPC plaintext \u4e0e TCP 4 \u5c42\u4ee3\u7406\\n* \u670d\u52a1\u81ea\u52a8\u6ce8\u518c\u53d1\u73b0\uff0c\u65e0\u60e7\u6269\u7f29\u5bb9\\n* \u66f4\u7075\u6d3b\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff0c\u81ea\u5e26\u5065\u5eb7\u68c0\u67e5\u529f\u80fd\\n\\n\u4ee5\u4e0b\u6211\u4eec\u5c06\u4ece CRD \u4e0e\u81ea\u5b9a\u4e49\u8d44\u6e90\u5c42\u9762\u8fdb\u884c\u8be6\u7ec6\u7684\u4ecb\u7ecd\u3002\\n\\n### CRD \u6269\u5c55\\n\\n\u5728\u524d\u9762\u7684\u4ecb\u7ecd\u4e2d\u6211\u4eec\u63d0\u5230\u4e86 CRD\uff0c\u90a3\u4e48 APISIX Ingress \u662f\u5982\u4f55\u4f7f\u7528 CRD \u6269\u5c55\u7684\uff1f\\n\\n![CRD \u6269\u5c55](https://static.apiseven.com/202108/1633765449155-0e25f1d0-e62a-4c4f-ab9a-019f609ed5fb.png)\\n\\n\u4ece\u7528\u6237\u5c42\u9762\u6765\u770b\uff0c\u5f53 Client \u53d1\u8d77\u8bf7\u6c42\uff0c\u5230\u8fbe Apache APISIX \u540e\uff0c\u4f1a\u76f4\u63a5\u628a\u76f8\u5e94\u7684\u4e1a\u52a1\u6d41\u91cf\u4f20\u8f93\u5230\u540e\u7aef\uff08\u5982 Service Pod\uff09\uff0c\u4ece\u800c\u5b8c\u6210\u8f6c\u53d1\u8fc7\u7a0b\u3002\u6b64\u8fc7\u7a0b\u4e0d\u9700\u8981\u7ecf\u8fc7 Ingress Controller\uff0c\u8fd9\u6837\u505a\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u65e6\u6709\u95ee\u9898\u51fa\u73b0\uff0c\u6216\u8005\u662f\u8fdb\u884c\u53d8\u66f4\u3001\u6269\u7f29\u5bb9\u6216\u8005\u8fc1\u79fb\u5904\u7406\u7b49\uff0c\u90fd\u4e0d\u4f1a\u5f71\u54cd\u5230\u7528\u6237\u548c\u4e1a\u52a1\u6d41\u91cf\u3002\\n\\n\u540c\u65f6\u5728\u914d\u7f6e\u7aef\uff0c\u7528\u6237\u901a\u8fc7 kubectl apply\uff0c\u53ef\u5c06\u81ea\u5b9a\u4e49 CRD \u914d\u7f6e\u5e94\u7528\u5230 K8s \u96c6\u7fa4\u3002Ingress Controller \u4f1a\u6301\u7eed watch \u8fd9\u4e9b\u8d44\u6e90\u53d8\u66f4\uff0c\u6765\u5c06\u76f8\u5e94\u914d\u7f6e\u5e94\u7528\u5230 Apache APISIX\u3002\\n\\n### \u81ea\u5b9a\u4e49\u8d44\u6e90\\n\\nAPISIX Ingress \u76ee\u524d\u5df2\u7ecf\u652f\u6301\u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\u4e3b\u8981\u662f\u4ee5\u4e0b 5 \u7c7b\uff0c\u6d89\u53ca\u5230\u8def\u7531\u3001\u4e0a\u6e38\u3001\u6d88\u8d39\u8005\u3001\u8bc1\u4e66\u76f8\u5173\u548c\u96c6\u7fa4\u516c\u5171\u914d\u7f6e\u7684\u76f8\u5173\u7c7b\u522b\u3002\\n\\n#### APISIX Route\uff08\u8def\u7531\uff09\\n\\n\u81ea\u5b9a\u4e49\u8d44\u6e90 APISIX Route \u4e2d `spec` \u5c5e\u6027\u7684\u9876\u7ea7\u914d\u7f6e\u662f `http`\u3002\u4f46\u5176\u5b9e `spec` \u662f\u540c\u65f6\u652f\u6301\u4e24\u79cd\u914d\u7f6e\u7684\uff0c\u4e00\u79cd\u662f\u4e0b\u56fe\u793a\u4f8b\u7684 `spec.http`\uff0c\u4e3b\u8981\u7528\u4e8e 7 \u5c42\u4ee3\u7406\uff1b\u53e6\u4e00\u79cd\u662f `spec.stream`\uff0c\u7528\u4e8e 4 \u5c42\u4ee3\u7406\u3002\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u4e3a\u5176\u81ea\u5b9a\u4e49\u4e86\u4e00\u9879\u89c4\u5219\uff0c\u5373 match \u4e0b\u7684\u76f8\u5173\u53c2\u6570\u3002\\n\\n![APISIX Route](https://static.apiseven.com/202108/1633765501091-e64ff6e5-5e3e-4b0f-adcc-7ff418edb52c.png)\\n\\n\u5982\u4e0a\u56fe\u540e\u7aef\u914d\u7f6e\u793a\u4f8b\u4f7f\u7528\u4e86\u540c\u4e00\u4e2a Service\uff0c\u5b9e\u9645\u4f7f\u7528\u4e2d\u5927\u5bb6\u6839\u636e\u573a\u666f\u8fdb\u884c\u8c03\u6574\u5373\u53ef\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c`weight` \u5c5e\u6027\u662f\u7528\u6765\u914d\u7f6e\u76f8\u5173 Service \u6743\u91cd\u3002\u901a\u8fc7\u4ee5\u4e0a\u914d\u7f6e\uff0c\u4ece\u800c\u5b9e\u73b0\u4e00\u5957\u5b8c\u6574\u7684\u8def\u7531\u81ea\u5b9a\u4e49\u8d44\u6e90\u3002\\n\\n#### APISIX Upstream\uff08\u4e0a\u6e38\uff09\\n\\n\u5728\u914d\u7f6e APISIX Upstream \u65f6\uff0c\u9700\u8981\u6ce8\u610f `name` \u7684\u5185\u5bb9\u8981\u4e0e K8s \u96c6\u7fa4\u7684 Service \u4fdd\u6301\u4e00\u81f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u540e\u7eed APISIX Ingress Controller \u51c6\u786e\u5339\u914d\u5176\u76f8\u5e94\u6d41\u91cf\u3002\\n\\n![APISIX Upstream](https://static.apiseven.com/202108/1633765534667-3ce978ae-2d85-4de7-8a57-3c5be5f57604.png)\\n\\n\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c`spec.loadbalancer` \u4e3b\u8981\u8d1f\u8d23\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u7684\u8bbe\u7f6e\uff0c\u6709\u591a\u79cd\u7b56\u7565\u6a21\u5f0f\u53ef\u4f9b\u9009\u62e9\u3002`spec.schem`e \u5219\u662f\u534f\u8bae\u7c7b\u578b\u7684\u914d\u7f6e\uff0c\u76ee\u524d\u53ea\u652f\u6301 HTTP \u548c gRPC \u534f\u8bae\u3002`spec.healthCheck` \u4e3b\u8981\u662f\u5bf9\u5065\u5eb7\u68c0\u67e5\u529f\u80fd\u8fdb\u884c\u8bbe\u7f6e\uff0c\u6bd4\u5982\u8bbe\u7f6e\u5176\u6d3b\u8dc3\u72b6\u6001\u3001\u751f\u6548\u534f\u8bae\u4e0e\u8def\u5f84\u548c\u6700\u7ec8\u53cd\u9988\u7b49\u53c2\u6570\u914d\u7f6e\u3002\\n\\n#### APISIX Consumer\uff08\u6d88\u8d39\u8005\uff09\\n\\n\u5728 APISIX Consumer \u914d\u7f6e\u4e2d\uff0c\u4e3b\u8981\u662f\u589e\u52a0\u4e86\u8ba4\u8bc1\u76f8\u5173\u7684\u529f\u80fd\uff0c\u6bd4\u5982 `spec.authParameter`\uff0c\u76ee\u524d\u8be5\u914d\u7f6e\u53c2\u6570\u652f\u6301 `BasicAuth` \u4e0e `KeyAuth` \u8fd9\u4e24\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u8ba4\u8bc1\u7c7b\u578b\u3002\\n\\n![APISIX Consumer](https://static.apiseven.com/202108/1633765580844-9d17d699-fa45-4b43-9ed9-f8ea9c9cab48.png)\\n\\n\u901a\u8fc7 `value` \u53ef\u76f4\u63a5\u53bb\u914d\u7f6e\u76f8\u5173\u7684 `username` \u548c `password`\uff0c\u6216\u8005\u76f4\u63a5\u4f7f\u7528 `secret` \u8fdb\u884c\u914d\u7f6e\uff0c\u76f8\u6bd4\u524d\u8005\u7684\u660e\u6587\u914d\u7f6e\u4f1a\u66f4\u5b89\u5168\u4e00\u4e9b\u3002\\n\\n#### APISIX TLS\uff08\u8bc1\u4e66\uff09\\n\\nAPISIX TLS \u4e3b\u8981\u662f\u4e3a\u4e86\u8fdb\u884c\u8bc1\u4e66\u7684\u7ba1\u7406\u3002\u5982\u793a\u4f8b\u6240\u793a\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7 `hosts` \u6765\u914d\u7f6e\u591a\u4e2a\u57df\u540d\uff0c`secret` \u4e0b\u7684\u53c2\u6570\u5c31\u662f\u5bf9\u5e94\u7684\u914d\u7f6e\u8bc1\u4e66\u3002\\n\\n![APISIX TLS](https://static.apiseven.com/202108/1633765614989-88b363c2-3805-4159-abfc-bac1b055559b.png)\\n\\n\u540c\u65f6 APISIX TLS \u8fd8\u914d\u6709 `spec.client`\uff0c\u7528\u4e8e\u8fdb\u884c mTLS \u53cc\u5411\u8ba4\u8bc1\u7684\u914d\u7f6e\u3002\\n\\n#### APISIX Config \u76f8\u5173\\n\\n\u5173\u4e8e\u81ea\u5b9a\u4e49\u8d44\u6e90\u652f\u6301\u7684 Config \u7c7b\u578b\u6211\u4eec\u4f1a\u4ece\u4e24\u4e2a\u65b9\u9762\u8fdb\u884c\u63cf\u8ff0\u3002\\n\\n![APISIX Cluster Config](https://static.apiseven.com/202108/1633765647605-6ad1ba44-06fd-475d-a6ae-925b3cc9c1ce.png)\\n\\n\u4e00\u79cd\u662f APISIX Cluster Config\uff0c\u5b83\u4e3b\u8981\u7528\u4e8e\u4e00\u4e9b\u901a\u7528\u914d\u7f6e\u3002\u76ee\u524d\u652f\u6301\u5728 K8s \u6216\u8005 Apache APISIX \u4e2d\u5168\u5c40\u4f7f\u7528 Prometheus \u63d2\u4ef6/\u5168\u5c40\u914d\u7f6e SkyWalking\uff0c\u540e\u7eed\u5f00\u53d1\u4e2d\u4e5f\u4f1a\u53bb\u589e\u52a0\u4e00\u4e9b\u5176\u4ed6\u7684\u901a\u7528\u914d\u7f6e\u3002\\n\\n\u53e6\u4e00\u79cd\u5c31\u662f\u6211\u4eec\u73b0\u5728\u6b63\u5728 PR \u4e2d\u7684 [APISIX Plugin Config](https://github.com/apache/apisix-ingress-controller/pull/689)\u3002\u5927\u5bb6\u5982\u679c\u611f\u5174\u8da3\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u70b9\u51fb\u94fe\u63a5\u6765\u4e00\u8d77\u53c2\u4e0e\u8ba8\u8bba\u3002Plugin Config \u4e3b\u8981\u662f\u5c06\u901a\u7528\u7684\u63d2\u4ef6\u914d\u7f6e\u7edf\u4e00\u96c6\u5408\u5728\u4e00\u8d77\uff0c\u6bd4\u5982\u4e00\u4e9b\u540c\u6837\u7684\u914d\u7f6e\uff0c\u7528\u6237\u5c31\u53ef\u4ee5\u901a\u8fc7 APISIX Plugin Config \u540c\u65f6\u5e94\u7528\u5728\u591a\u4e2a\u8def\u7531\u5f53\u4e2d\uff0c\u7701\u53bb\u4e86\u989d\u5916\u591a\u9879\u72ec\u7acb\u914d\u7f6e\u7684\u7e41\u7410\u6b65\u9aa4\u3002\\n\\n## APISIX Ingress \u4e0a\u624b\u5b9e\u8df5\\n\\n\u76ee\u524d\u5927\u5bb6\u53ef\u4ee5\u901a\u8fc7 [Helm Charts](https://github.com/apache/apisix-helm-chart) \u7684\u65b9\u5f0f\u6765\u8fdb\u884c APISIX Ingress \u7684\u90e8\u7f72\u3002\u901a\u8fc7\u4e00\u6761\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u540c\u65f6\u628a Apache APISIX \u4ee5\u53ca APISIX Ingress\uff0c\u5305\u62ec Apache APISIX \u6240\u9700\u8981\u7528\u5230\u7684 etcd \u5168\u90e8\u90e8\u7f72\u597d\uff0c\u6b65\u9aa4\u975e\u5e38\u7b80\u5355\u3002\\n\\n![\u5b89\u88c5\u6b65\u9aa4](https://static.apiseven.com/202108/1633765686788-156b0641-aa78-4de8-833d-a187772470a5.png)\\n\\n### \u5b9e\u8df5\u573a\u666f\u4e00\uff1a\u6d41\u91cf\u5207\u5206\\n\\n\u901a\u8fc7\u4f7f\u7528 APISIX Ingress \u53ef\u4ee5\u5b9e\u73b0\u6309\u6bd4\u4f8b\u8fdb\u884c\u6d41\u91cf\u5207\u5206\u7684\u6548\u679c\uff0c\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff1a\\n\\n#### \u6b65\u9aa4\u4e00\uff1a\u914d\u7f6e APISIX Upstream\\n\\n![\u914d\u7f6e APISIX Upstream](https://static.apiseven.com/uploads/2023/05/09/BpWGcRfs_au.png)\\n\\n#### \u6b65\u9aa4\u4e8c\uff1a\u914d\u7f6e APISIX Route\\n\\n\u901a\u8fc7\u5728 `backends` \u4e2d\u53bb\u914d\u7f6e `subset` \u548c `weight`\uff0c\u6765\u5b9e\u73b0\u7528\u6237\u8bf7\u6c42\u6d41\u91cf\u8fdb\u5165\u65f6\u7684\u5206\u6d41\u3002\u5982\u4e0b\u56fe\u793a\u4f8b\u5c31\u662f 90% \u7684\u6d41\u91cf\u4f1a\u8fdb\u5165\u5230 v1 \u4e2d\uff0c10% \u7684\u6d41\u91cf\u8fdb\u5165\u5230 v2 \u4e2d\u3002\\n\\n![\u914d\u7f6e APISIX Route](https://static.apiseven.com/uploads/2023/05/09/PoSvDlQJ_ar.png)\\n\\n\u901a\u8fc7\u4ee5\u4e0a\u4e24\u6b65\uff0c\u5c31\u53ef\u4ee5\u5341\u5206\u65b9\u4fbf\u5730\u6309\u6bd4\u4f8b\u8fdb\u884c\u6d41\u91cf\u5207\u5206\uff0c\u5b9e\u73b0\u7c7b\u4f3c\u7070\u5ea6\u53d1\u5e03\u7b49\u573a\u666f\u9700\u6c42\u3002\\n\u66f4\u591a\u5177\u4f53\u64cd\u4f5c\u7ec6\u8282\u4e5f\u53ef\u53c2\u8003\uff1a[Apache APISIX Ingress Controller \u4e2d\u7684\u6d41\u91cf\u5207\u5206](https://www.apiseven.com/zh/blog/traffic-split-in-apache-apisix-ingress-controller)\u3002\\n\\n### \u5b9e\u8df5\u573a\u666f\u4e8c\uff1a\u914d\u7f6e\u8ba4\u8bc1\\n\\n\u5982\u679c\u60f3\u5728 APISIX Ingress \u4e2d\u4e3a\u67d0\u4e9b\u8def\u7531\u914d\u7f6e Basic Auth\uff0c\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u64cd\u4f5c\uff1a\\n\\n#### \u6b65\u9aa4\u4e00\uff1a\u521b\u5efa APISIX Consumer \u8d44\u6e90\\n\\n\u5982\u524d\u6587\u6240\u63d0\u5230\u7684\uff0c\u53ef\u4ee5\u5728 APISIX Consumer \u914d\u7f6e\u4e2d\u589e\u52a0 `basicAuth`\uff0c\u5e76\u4e3a\u5176\u6307\u5b9a\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002\\n\\n![\u521b\u5efa\u8d44\u6e90](https://static.apiseven.com/202108/1633765803898-7a30c663-7ba8-4064-8772-a19c56cef191.png)\\n\\n#### \u6b65\u9aa4\u4e8c\uff1a\u914d\u7f6e APISIX Route\uff0c\u589e\u52a0\u8ba4\u8bc1\u76f8\u5173\u53c2\u6570\\n\\n\u5728\u81ea\u5b9a\u4e49\u8d44\u6e90 APISIX Route \u4e2d\uff0c\u901a\u8fc7\u5728\u540e\u7aef\u6dfb\u52a0 `authenticatio`n\uff0c\u5c06\u5176\u5f00\u542f\u5e76\u6307\u5b9a\u8ba4\u8bc1\u7c7b\u578b\u5373\u53ef\u3002\\n\\n![\u589e\u52a0\u8ba4\u8bc1\u53c2\u6570](https://static.apiseven.com/202108/1633765828596-9a0f0142-f201-4004-b85d-a34de4ee13dc.png)\\n\\n\u901a\u8fc7\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4f7f\u7528 Consumer \u53bb\u5b8c\u6210\u76f8\u5173\u914d\u7f6e\u8ba4\u8bc1\u3002\\n\\n### \u5b9e\u8df5\u573a\u666f\u4e09\uff1aK8s \u8d44\u6e90\u6269\u5c55\\n\\n\u6b63\u5982\u6211\u4eec\u5728\u5f00\u5934\u63d0\u5230\u8fc7\u7684\uff0cAPISIX Ingress \u4e0d\u4ec5\u652f\u6301\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u8fd8\u540c\u65f6\u652f\u6301 K8s \u539f\u751f\u7684 Ingress \u8d44\u6e90\u3002\\n\\n![K8s \u539f\u751f\u8d44\u6e90](https://static.apiseven.com/202108/1633765859904-bc48dcc5-cd7a-4875-b248-5c4c64a2d7c5.png)\\n\\n\u5982\u4e0a\u56fe\u662f K8s Ingress \u8d44\u6e90\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\u5982\u679c\u60f3\u8981\u5728\u8d44\u6e90\u4e0a\u505a rewrite\uff0c\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0 annotation \u914d\u7f6e\u5c5e\u6027\u3002\u8fd9\u6837\u5f53\u7528\u6237\u643a\u5e26 `httpbin.org` \u8bf7\u6c42\u65f6\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u8def\u5f84 /sample \u5c06\u5b83\u91cd\u5b9a\u5411\u5230 /ip\u3002\\n\\n\u5f53\u4e0a\u8ff0\u9700\u6c42\u4f7f\u7528 APISIX Ingress \u65f6\uff0c\u53ea\u9700\u5728 Ingress \u589e\u52a0\u4e00\u4e2a `kubernetes.io/ingress.class: apisix`\uff0c\u53bb\u6307\u5b9a APISIX Ingress Controller \u53bb\u76d1\u542c\u8fd9\u4e2a\u8d44\u6e90\uff0c\u540c\u65f6\u901a\u8fc7\u914d\u7f6e  `k8s.apisix.apache.org/rewrite-target: \\"/ip\\"`\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u91cd\u5b9a\u5411\u5230 /ip \u8def\u5f84\u3002\\n\\n![APISIX Ingress \u8d44\u6e90](https://static.apiseven.com/202108/1633765888876-d2d252ee-706c-49f3-b630-03a7e72a0620.png)\\n\\n\u4ee5\u4e0a\u793a\u4f8b\u53ea\u662f\u76ee\u524d APISIX Ingress \u5bf9\u4e8e\u539f\u751f K8s Ingress \u652f\u6301\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u66f4\u591a\u793a\u4f8b\u5927\u5bb6\u53ef\u4ee5\u67e5\u770b[\u5177\u4f53\u6587\u6863](https://apisix.apache.org/docs/ingress-controller/practices/proxy-the-httpbin-service-with-ingress)\u8fdb\u884c\u53c2\u8003\u4f7f\u7528\u3002\\n\\n## \u672a\u6765\u89c4\u5212\\n\\n\u4e4b\u540e APISIX Ingress \u5c06\u4f1a\u7ee7\u7eed\u5728\u529f\u80fd\u4e0e\u751f\u6001\u4e0a\u8fdb\u884c\u66f4\u65b0\uff0c\u76ee\u524d\u9636\u6bb5\u5df2\u7ecf\u5b8c\u6210\u4e86 [APISIX Ingress \u4e0e Cert-manager \u96c6\u6210](https://github.com/apache/apisix-ingress-controller/blob/master/docs/en/latest/practices/manage-certificates-with-cert-manager.md)\uff0c\u540e\u7eed\u5c06\u9010\u6b65\u5b9e\u73b0\u4ee5\u4e0b\u76ee\u6807\uff1a\\n\\n1. \u5b8c\u6210 Kubernetes V1.22+ \u4e0e CRD V1 \u7248\u672c\u7684\u9002\u914d\u652f\u6301\uff08\u5df2\u7ecf\u5b8c\u6210\uff0c\u5373\u5c06\u5728 APISIX Ingress V1.3 \u7248\u672c \u4e2d\u53d1\u5e03\uff09\\n2. \u652f\u6301 Gateway API\uff08\u9884\u8ba1\u5728 Q4 \u9636\u6bb5\u5b9e\u73b0\uff09\\n3. \u6269\u5c55\u65b0\u67b6\u6784\uff0c\u4ee5\u4fbf\u4e8e\u7528\u6237\u5728\u4e0d\u9700\u8981\u4f7f\u7528 etcd \u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528 APISIX Ingress\\n4. \u4e30\u5bcc\u4ea7\u54c1\u751f\u6001\uff0c\u6269\u5c55 APISIX Ingress \u793e\u533a\\n\\n\u6700\u540e\u4e5f\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u591a\u591a\u5730\u53c2\u4e0e\u5230\u9879\u76ee\u4e2d\u6765\uff0c\u6bd4\u5982\u6bcf\u4e24\u5468\u7684\u5468\u4e09\u4e0b\u5348 2 \u70b9\u90fd\u4f1a\u6709\u4e00\u6b21 APISIX Ingress \u793e\u533a\u4f1a\u8bae\uff0c\u4f1a\u8ddf\u5927\u5bb6\u540c\u6b65\u4e00\u4e0b\u5f53\u524d\u7684\u9879\u76ee\u8fdb\u5c55\u6216\u8005\u9047\u5230\u7684\u95ee\u9898\u3002\u5927\u5bb6\u53ef\u4ee5\u6301\u7eed\u5173\u6ce8 Apache APISIX \u89c6\u9891\u53f7\uff0c\u5c4a\u65f6\u53ef\u4ee5\u76f4\u63a5\u53c2\u4e0e\u793e\u533a\u4f1a\u8bae\u76f4\u64ad\u3002\\n\\n[\u70b9\u6b64\u67e5\u770b](https://github.com/apache/apisix-ingress-controller/issues/614)\u66f4\u591a\u5173\u4e8e APISIX Ingress \u793e\u533a\u4f1a\u8bae\u7ec6\u8282\u3002"},{"id":"2021/10/01/openeuler","metadata":{"permalink":"/zh/blog/2021/10/01/openeuler","source":"@site/blog/2021/10/01/openEuler.md","title":"APISIX \u793e\u533a\u6210\u5458\u52a9\u529b openEuler \u53d1\u5e03\u7b2c\u4e00\u4e2a\u793e\u533a\u521b\u65b0\u7248","description":"Apache APISIX \u793e\u533a\u7f57\u6cfd\u8f69\u548c\u6e29\u94ed\u5728 openEuler 9 \u6708 30 \u65e5\u53d1\u5e03\u7684\u7b2c\u4e00\u4e2a\u793e\u533a\u521b\u65b0\u7248\u4e2d\uff0c\u4e3a OpenResty \u8fc1\u79fb\u5de5\u4f5c\u505a\u4e86\u975e\u5e38\u591a\u7684\u8d21\u732e\uff0c\u8ba9 OpenResty \u5728\u6b27\u62c9\u5f00\u6e90\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5e73\u7a33\u9ad8\u6548\u7684\u8fd0\u884c\u3002","date":"2021-10-01T00:00:00.000Z","formattedDate":"2021\u5e7410\u67081\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.785,"truncated":true,"authors":[],"prevItem":{"title":"\u4ece\u6982\u5ff5\u5230\u5b9e\u8df5\u5e2e\u4f60\u5feb\u901f\u4e0a\u624b Apache APISIX Ingress","permalink":"/zh/blog/2021/10/09/apisix-ingress-techblog"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff089.13-9.30\uff09","permalink":"/zh/blog/2021/09/30/weekly-report"}},"content":"> \u6765\u81ea Apache APISIX \u793e\u533a\u7684[\u7f57\u6cfd\u8f69](https://github.com/spacewander)\u548c[\u6e29\u94ed](https://github.com/moonming)\u5728 openEuler 9 \u6708 30 \u65e5\u53d1\u5e03\u7684\u7b2c\u4e00\u4e2a\u793e\u533a\u521b\u65b0\u7248\uff08 [openEuler 21.09](https://openeuler.org/) \uff09\u4e2d\uff0c\u4e3a [OpenResty](https://github.com/openresty/openresty) \u8fc1\u79fb\u5de5\u4f5c\u4e2d\u505a\u4e86\u975e\u5e38\u591a\u7684\u8d21\u732e\uff0c\u8ba9 OpenResty \u53ef\u4ee5\u5728\u6b27\u62c9\u5f00\u6e90\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5e73\u7a33\u9ad8\u6548\u7684\u8fd0\u884c\u3002OpenResty \u7684\u7a33\u5b9a\u8fd0\u884c\u4e5f\u610f\u5473\u7740 [Apache APISIX](https://github.com/apache/apisix) \u53ef\u4ee5\u987a\u7545\u5730\u8fd0\u884c\u5728 openEuler \u7cfb\u7edf\u4e0a\uff0cApache APISIX \u5e95\u5c42\u57fa\u4e8e OpenResty \u505a\u4e86\u4e00\u5b9a\u5f00\u53d1\u3002\\n\x3c!--truncate--\x3e\\n\\n\u8ba9\u6211\u4eec\u4e00\u8d77\u6765\u8ba4\u8bc6\u4e0b\u8fd9\u4e24\u4f4d\u793e\u533a\u6210\u5458\u5427\uff01\\n\\n[\u7f57\u6cfd\u8f69](https://github.com/spacewander)\uff0cApache APISIX PMC\uff0cOpenResty \u7684\u6838\u5fc3\u5f00\u53d1\u8005\uff0cgit-extras \u9879\u76ee\u7684 Maintainer\uff0c\u64c5\u957f C\u3001Golang \u548c Lua\uff0c\u64b0\u5199\u8fc7\u591a\u7bc7\u6280\u672f\u5e72\u8d27\uff0c\u63a8\u8350\u9605\u8bfb\u300a [\u4e3a\u4ec0\u4e48 Apache APISIX \u9009\u62e9 Nginx + Lua \u8fd9\u4e2a\u6280\u672f\u6808\uff1f](https://apisix.apache.org/blog/2021/08/25/Why-Apache-APISIX-chose-Nginx-and-Lua)\u300b\u300a[\u5dee\u4e4b\u6beb\u5398\uff1aetcd 3 \u5b8c\u7f8e\u652f\u6301 HTTP \u8bbf\u95ee\uff1f](https://apisix.apache.org/blog/2021/06/30/etcd3-support-HTTP-access-perfectly)\u300b\u3002\\n\\n<img src=\\"https://static.apiseven.com/202108/1633068755509-66b85782-ecca-43cc-bbcc-5a7b11cee0f4.png\\" alt=\\"\u7f57\u6cfd\u8f69\\" style={{width: \\"200px\\"}} />\\n\\n[\u6e29\u94ed](https://github.com/moonming)\uff0cApache Member\uff0cApache APISIX PMC Chair\uff0cOpenResty \u7684\u6838\u5fc3\u5f00\u53d1\u8005\uff0c\u524d 360 \u5f00\u6e90\u6280\u672f\u59d4\u5458\u4f1a\u59d4\u5458\uff0c\u5341\u4f59\u5e74\u5f00\u53d1\u7ecf\u9a8c\u3002\u8457\u6709\u6781\u5ba2\u65f6\u95f4\u4e13\u680f\u300a[OpenResty \u4ece\u5165\u95e8\u5230\u5b9e\u6218](https://time.geekbang.org/column/intro/186)\u300b\u3002\\n\\n<img src=\\"https://static.apiseven.com/202108/1633068755501-b52403ee-c43a-4da7-9ca7-46bc457da6fa.png\\" alt=\\"\u6e29\u94ed\\" style={{width: \\"300px\\"}} />\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0cApache APISIX \u7684\u5c0f\u4f19\u4f34\u4e0d\u4ec5\u4ec5\u5728\u672c\u793e\u533a\u6d3b\u8dc3\uff0c\u8fd8\u79ef\u6781\u53c2\u4e0e\u5230\u5176\u4ed6\u793e\u533a\u7684\u5f00\u6e90\u9879\u76ee\u4e2d\uff0c\u8fd9\u6b63\u662f\u5f00\u6e90\u7cbe\u795e\u7684\u4f53\u73b0\uff0c\u5f00\u6e90\u4e0d\u4ec5\u4ec5\u662f\u5f00\u653e\u6e90\u4ee3\u7801\uff0c\u66f4\u662f\u5f00\u653e\u7684\u793e\u533a\u3001\u5f00\u653e\u7684\u5fc3\u6001\uff0c\u793e\u533a\u95f4\u5408\u4f5c\u4e92\u52a9\uff0c\u5927\u5bb6\u4e00\u8d77\u8d21\u732e\u66f4\u597d\u7528\u7684\u5f00\u6e90\u4ea7\u54c1\u3002\\n\\n\u9664\u4e86\u4e24\u4f4d\u793e\u533a\u6210\u5458\uff0c\u8fd8\u8981\u591a\u4ecb\u7ecd\u4e00\u4e0b Apache APISIX\u3002 openEuler \u7b2c\u4e00\u4e2a\u793e\u533a\u521b\u65b0\u7248\uff0821.09\uff09\u6781\u5927\u4e30\u5bcc\u4e86\u4e91\u539f\u751f\u76f8\u5173\u7684\u57fa\u7840\u8bbe\u65bd\uff0c[Apache APISIX](https://github.com/apache/apisix)\u5929\u7136\u62e5\u6709\u4e91\u539f\u751f\u7684\u4f18\u52bf\uff0c\u652f\u6301\u88f8\u91d1\u5c5e\u3001\u865a\u62df\u673a\u3001Kubernetes\u3001ARM64\u3001\u516c\u6709\u4e91\u3001\u6df7\u5408\u4e91\u7b49\u591a\u79cd\u90e8\u7f72\u6a21\u5f0f\uff0c\u671f\u5f85 Apache APISIX \u5728 openEuler \u4e0a\u5e94\u7528\u4e8e\u66f4\u591a\u4e1a\u52a1\u3001\u66f4\u591a\u573a\u666f\u3002\\n\\n![Apache APISIX \u751f\u6001](https://static.apiseven.com/202108/1633068859274-4db4d50e-2646-433b-94cf-b75727bf877e.png)\\n\\n## \u5173\u4e8e OpenEuler\\n\\n[openEuler](https://openeuler.org/) \u662f\u4e00\u4e2a\u5f00\u6e90\u3001\u514d\u8d39\u7684 Linux \u53d1\u884c\u7248\u5e73\u53f0\uff0c\u901a\u8fc7\u793e\u533a\u5f62\u5f0f\u4e0e\u5168\u7403\u5f00\u53d1\u8005\u5171\u540c\u6784\u5efa\u5f00\u653e\u3001\u591a\u5143\u548c\u67b6\u6784\u5305\u5bb9\u7684\u8f6f\u4ef6\u751f\u6001\u4f53\u7cfb\u3002openEuler 21.09 \u662f\u9762\u5411\u6570\u5b57\u57fa\u7840\u8bbe\u65bd\u7684\u5f00\u6e90\u64cd\u4f5c\u7cfb\u7edf\u7684\u7b2c\u4e00\u4e2a\u793e\u533a\u521b\u65b0\u7248\u672c\uff0c\u62d3\u5c55\u4e86\u4e91\u8ba1\u7b97\u3001\u8fb9\u7f18\u8ba1\u7b97\u3001\u5d4c\u5165\u5f0f\u7b49\u573a\u666f\u5316\u7684\u5e94\u7528\u3002"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff089.13-9.30\uff09","metadata":{"permalink":"/zh/blog/2021/09/30/weekly-report","source":"@site/blog/2021/09/30/weekly-report.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff089.13-9.30\uff09","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u6700\u8fd1\u4e24\u5468\u65b0\u589e\u4e86 stream_route \u652f\u6301\u5728 IP \u5339\u914d\u4e2d\u4f7f\u7528 CIDR\uff0cdebug \u6a21\u5f0f\u652f\u6301\u52a8\u6001\u8bf7\u6c42\u8fc7\u6ee4\uff0chmac-auth \u652f\u6301\u6821\u9a8c\u8bf7\u6c42\u4f53\u7b49\u65b0\u529f\u80fd\u3002","date":"2021-09-30T00:00:00.000Z","formattedDate":"2021\u5e749\u670830\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.67,"truncated":true,"authors":[],"prevItem":{"title":"APISIX \u793e\u533a\u6210\u5458\u52a9\u529b openEuler \u53d1\u5e03\u7b2c\u4e00\u4e2a\u793e\u533a\u521b\u65b0\u7248","permalink":"/zh/blog/2021/10/01/openeuler"},"nextItem":{"title":"Apache APISIX 2.10.0(LTS \u7248\u672c)\u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/09/29/release-apache-apisix-2.10"}},"content":"> \u4ece 9.13 \u5230 9.30, \u6709 32 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 93 \u4e2a commits\u3002\u611f\u8c22\u8fd9\u4e9b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue\uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u672c\u5468\u8d21\u732e\u8005\u540d\u5355](https://static.apiseven.com/202108/1632907894918-c455f40e-a175-4944-8fac-11c590d43786.jpg)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1632908362102-b0b665e2-f37f-4a82-b8a3-68914925b565.jpg)\\n\\n## Good first issue\\n\\n### Issue #5080\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/5080\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u4e4b\u524d\u4e0a\u6e38\u670d\u52a1\u4f7f\u7528 IP \u8ba4\u8bc1\uff0c\u5b9e\u9645\u7684\u5ba2\u6237\u7aef IP \u662f\u4ece x-forwarded-for \u8bf7\u6c42\u5934\u4e2d\u83b7\u53d6\u7684\u3002\u73b0\u5728\u9700\u8981\u6539\u6210\u7f51\u5173 HMAC \u8ba4\u8bc1\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7\u7f51\u5173\u5c4f\u853d\u4e0a\u6e38 IP \u8ba4\u8bc1\u3002\u5c1d\u8bd5\u901a\u8fc7\u4ee3\u7406\u91cd\u5199\u63d2\u4ef6\u4fee\u6539 x-forwarded-for\uff0c\u4f46\u662f\u6ca1\u6709\u751f\u6548\uff1a\\n\\n![\u95ee\u9898\u63cf\u8ff0\u622a\u56fe](https://static.apiseven.com/202108/1632799650125-14edb988-f2ad-434d-8d13-04ff3016eb5a.png)\\n\\n### Issue #5108\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/5108\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u5982\u4e0b\uff0c\u5f53\u5728\u8def\u7531\u4e0a\u542f\u7528\u8bf7\u6c42\u9a8c\u8bc1\u63d2\u4ef6:\\" delete \\"\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/35 -H \'X-API-KEY: xxxxxxxxxxxxxxxxxxx\' -X PUT -d \'\\n{\\n    \\"uri\\":\\"/products/create\\",\\n    \\"plugins\\":{\\n        \\"request-validation\\":{\\n            \\"body_schema\\":{\\n                \\"type\\":\\"object\\",\\n                \\"required\\":[\\n                    \\"productName\\",\\n                    \\"price\\"\\n                ],\\n                \\"properties\\":{\\n                    \\"productName\\":{\\n                        \\"type\\":\\"string\\"\\n                    },\\n                    \\"price\\":{\\n                        \\"type\\":\\"number\\"\\n                    }\\n                }\\n            }\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"service_name\\":\\"PRODUCTSSERVICE\\",\\n        \\"type\\":\\"roundrobin\\",\\n        \\"discovery_type\\":\\"eureka\\"\\n    }\\n}\'\\n```\\n\\n\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5bf9\u5176\u8fdb\u884c\u6d4b\u8bd5\u65f6\uff0c\\n\\n```shell\\ncurl http://127.0.0.1:9080/products/create -X POST -d \'{\\"product-Name\\":\\"Laptop\\",\\"pri-ce\\":12345.00}\'\\n```\\n\\n\u5f97\u5230\u4ee5\u4e0b\u9ed8\u8ba4\u4fe1\u606f\uff1a\\n\\n```shell\\nproperty \\"price\\" is required\\n```\\n\\n## \u672c\u5468\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [debug-mode \u652f\u6301\u52a8\u6001\u8bf7\u6c42\u8fc7\u6ee4](https://github.com/apache/apisix/pull/5012)\uff08\u8d21\u732e\u8005\uff1a[tzssangglass](https://github.com/tzssangglass)\uff09\\n\\n- [\u652f\u6301\u6ce8\u5165\u903b\u8f91\u5230 APISIX \u65b9\u6cd5\u4e2d](https://github.com/apache/apisix/pull/5068)\uff08\u8d21\u732e\u8005\uff1a[spacewander](https://github.com/spacewander)\uff09\\n\\n- [stream_route \u652f\u6301\u5728 IP \u5339\u914d\u4e2d\u4f7f\u7528 CIDR](https://github.com/apache/apisix/pull/4980)\uff08\u8d21\u732e\u8005\uff1a[Zheaoli](https://github.com/Zheaoli)\uff09\\n\\n- [hmac-auth \u652f\u6301\u6821\u9a8c\u8bf7\u6c42\u4f53](https://github.com/apache/apisix/pull/5038)\uff08\u8d21\u732e\u8005\uff1a[arthur-zhang](https://github.com/arthur-zhang)\uff09\\n\\n- [APISIX Ingress controller \u96c6\u6210\u4e86 cert-manager \uff0c\u7528\u6237\u53ef\u4ee5\u66f4\u65b9\u4fbf\u7684\u7ba1\u7406 TLS \u8bc1\u4e66\uff0c\u5e76\u4e0e APISIX Ingress \u914d\u5408\u4f7f\u7528](https://github.com/apache/apisix-ingress-controller/pull/685)\uff08\u8d21\u732e\u8005\uff1a[lingsamuel](https://github.com/lingsamuel)\uff09\\n\\n- [- APISIX Dashboard \u652f\u6301\u591a\u79cd\u914d\u7f6e\u6587\u4ef6](https://github.com/apache/apisix-dashboard/pull/1946)\uff08\u8d21\u732e\u8005\uff1a[bzp2010](https://github.com/bzp2010)\uff09\\n\\n## \u672c\u5468\u535a\u6587\u63a8\u8350\\n\\n- [Apache APISIX \u5728\u817e\u8baf\u4e91\u667a\u80fd\u949b\u5e73\u53f0\u4e2d\u7684\u843d\u5730\u5b9e\u8df5](http://apisix.apache.org/blog/2021/09/16/tencent-cloud)\uff1a\\n\\n  \u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u817e\u8baf\u4e91\u667a\u80fd\u949b\u5e73\u53f0\u4f7f\u7528 Apache APISIX \u7684\u4f01\u4e1a\u6848\u4f8b\uff0c\u4ee5\u53ca\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u4ea7\u54c1\u6d41\u91cf\u7f51\u5173\u7684\u5177\u4f53\u4f8b\u5b50\u3002\\n\\n- [\u4f7f\u7528 Apache APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u53ca\u8fdb\u9636\u73a9\u6cd5](http://apisix.apache.org/blog/2021/09/07/how-to-use-apisix-auth)\\n\\n  \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u7684\u8eab\u4efd\u8ba4\u8bc1\u529f\u80fd\uff0c\u4ece\u91cd\u8981\u6027\u548c\u73a9\u6cd5\u4f7f\u7528\u4e0a\u8fdb\u884c\u4e86\u8be6\u7ec6\u4ecb\u7ecd\u548c\u7ec6\u8282\u4f7f\u7528\u3002\\n\\n- [\u57fa\u4e8e Apache APISIX\uff0c\u7231\u5947\u827a API \u7f51\u5173\u7684\u66f4\u65b0\u4e0e\u843d\u5730\u5b9e\u8df5](http://apisix.apache.org/blog/2021/09/07/iQIYI-usercase)\\n\\n  \u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u60a8\u53ef\u4ee5\u4e86\u89e3\u5230\u57fa\u4e8e Apache APISIX \u7f51\u5173\uff0c\u7231\u5947\u827a\u6280\u672f\u56e2\u961f\u662f\u5982\u4f55\u8fdb\u884c\u516c\u53f8\u67b6\u6784\u7684\u66f4\u65b0\u4e0e\u878d\u5408\uff0c\u6253\u9020\u51fa\u5168\u65b0\u7684\u7f51\u5173\u670d\u52a1\u3002"},{"id":"Apache APISIX 2.10.0(LTS \u7248\u672c)\u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2021/09/29/release-apache-apisix-2.10","source":"@site/blog/2021/09/29/release-apache-apisix-2.10.md","title":"Apache APISIX 2.10.0(LTS \u7248\u672c)\u6b63\u5f0f\u53d1\u5e03","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX 2.10.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u8fd9\u662f Apache APISIX \u9996\u4e2a LTS \u7248\u672c\uff0c\u540c\u65f6\u652f\u6301\u4e86 service \u589e\u52a0 hosts \u5c5e\u6027\u3001\u652f\u6301\u8bbe\u7f6e\u955c\u50cf\u8bf7\u6c42\u7684\u6bd4\u4f8b\u7b49\u65b0\u529f\u80fd\u3002","date":"2021-09-29T00:00:00.000Z","formattedDate":"2021\u5e749\u670829\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.68,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff089.13-9.30\uff09","permalink":"/zh/blog/2021/09/30/weekly-report"},"nextItem":{"title":"\u767e\u4e07\u7ea7 QPS \u4e1a\u52a1\u65b0\u5ba0\uff0c\u91d1\u5c71\u529e\u516c\u643a\u624b Apache APISIX \u6253\u9020\u7f51\u5173\u5b9e\u8df5\u65b0\u4f53\u9a8c","permalink":"/zh/blog/2021/09/28/wps-usercase"}},"content":"> Apache APISIX 2.10.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX 2.10 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\ud83c\udf89 \u8fd9\u662f Apache APISIX \u9996\u4e2a LTS \u7248\u672c\uff0c\u540c\u65f6\u652f\u6301 10+ \u4e2a\u65b0\u529f\u80fd\u548c\u65b0\u63d2\u4ef6\u3002\u5feb\u901f\u9605\u8bfb\u4e86\u89e3 2.10 \u7248\u672c\u7684\u65b0\u7279\u6027\u5427\uff01\\n\\n## \u91cc\u7a0b\u7891\uff1a\u7b2c\u4e00\u4e2a LTS \u7248\u672c\\n\\n\u5bf9\u4e8e Apache APISIX \u6765\u8bf4\uff0c\u672c\u6b21\u53d1\u5e03\u7684 2.10.0 \u662f\u4e00\u4e2a\u5177\u6709\u91cc\u7a0b\u7891\u610f\u4e49\u7684\u7248\u672c\uff0c\u56e0\u4e3a Apache APISIX 2.10.0 \u662f\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a LTS\uff08Long Time Support\uff09\u7684\u7248\u672c\u3002\\n\\n\u6211\u4eec\u4f1a\u5728 Apache APISIX 2.10.0 \u7684\u57fa\u7840\u4e0a\u53d1\u5e03\u540e\u7eed\u7684 patch \u7248\u672c\uff0c\u4e5f\u5c31\u662f 2.10.1\u30012.10.2 \u7b49\u7248\u672c\u3002\u8fd9\u4e9b\u7248\u672c\u4f1a\u4ece\u4e3b\u5206\u652f\u4e0a backport bugfix\u3002\\n\\n\u6309\u8ba1\u5212\uff0c10 \u6708\u4efd\u6211\u4eec\u4f1a\u53d1\u5e03\u9996\u4e2a LTS \u7248\u672c\u7684\u9996\u4e2a patch \u7248\u672c\uff0c\u4e5f\u5c31\u662f Apache APISIX 2.10.1\u3002\\n\\n\u4e4b\u540e\u6211\u4eec\u4f1a\u4ea4\u66ff\u53d1\u5e03 2.10.x\uff08\u4f8b\u5982 2.10.2 \uff09\u548c 2.x\uff08\u4f8b\u5982 2.11.0\uff09\u4e24\u4e2a\u7248\u672c\u7ebf\uff0c\u4fdd\u6301\u529f\u80fd\u8fed\u4ee3\u7684\u540c\u65f6\uff0c\u786e\u4fdd LTS \u7248\u672c\u80fd\u591f\u5f97\u5230\u8f83\u65b0\u7684 bugfix\u3002\\n\\n## \u65b0\u529f\u80fd\uff1aservice \u589e\u52a0 hosts \u5c5e\u6027\\n\\n\u5728 Apache APISIX 2.10.0 \u7248\u672c\u91cc\u9762\uff0c\u6211\u4eec\u7ed9 `service` \u52a0\u4e0a\u4e86 `hosts` \u5c5e\u6027\u3002\u5c31\u50cf `service` \u91cc\u9762\u5176\u4ed6\u5b57\u6bb5\u4e00\u6837\uff0c`route` \u53ef\u4ee5\u4ece `service` \u4e2d\u7ee7\u627f `hosts` \u5c5e\u6027\u3002\\n\\n\u4e0b\u9762\u7684\u914d\u7f6e\uff1a\\n\\n```json\\n# services/1\\n{\\n    \\"hosts\\": [\\"bar.com\\"]\\n}\\n# routes/1\\n{\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"service_id\\": \\"1\\",\\n    \\"uri\\": \\"/hello\\"\\n}\\n```\\n\\n\u76f8\u5f53\u4e8e\uff1a\\n\\n```json\\n# routes/1\\n{\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"hosts\\": [\\"bar.com\\"],\\n    \\"uri\\": \\"/hello\\"\\n}\\n```\\n\\n\u8fd9\u4e48\u4fee\u6539\u4e4b\u540e\uff0cApache APISIX \u91cc\u9762\u7684 `route` \u548c `service` \u7684\u5173\u7cfb\u4e0e Nginx \u91cc\u9762\u7684 `location` \u548c `server` \u7684\u5173\u7cfb\u8d8a\u6765\u8d8a\u76f8\u4f3c\u3002 \u53ef\u4ee5\u8fd9\u4e48\u8bf4\uff0c\u672c\u6b21\u4fee\u6539\u8ba9 `service` \u4ece\u9e21\u808b\u53d8\u6210\u4e86\u9e21\u817f\uff0c\u628a `service` \u53c8\u62c9\u56de\u4e86 Apache APISIX \u914d\u7f6e\u6838\u5fc3\u4e09\u89d2\uff1a[Route](http://apisix.apache.org/zh/docs/apisix/terminology/route)\u3001 [Upstream](http://apisix.apache.org/zh/docs/apisix/terminology/upstream)\u3001[Service](http://apisix.apache.org/zh/docs/apisix/terminology/service) \u4e4b\u4e2d\u3002\\n\\n## \u65b0\u529f\u80fd\uff1a\u652f\u6301\u8bbe\u7f6e\u955c\u50cf\u8bf7\u6c42\u7684\u6bd4\u4f8b\\n\\nproxy-mirror \u63d2\u4ef6\u652f\u6301\u8bbe\u7f6e\u955c\u50cf\u8bf7\u6c42\u7684\u6bd4\u4f8b\uff0c\u662f\u7528\u6237\u4eec\u4e00\u76f4\u5728\u671f\u5f85\u7684\u529f\u80fd\uff0c\u6211\u4eec\u5728 Apache APISIX 2.10.0 \u4e0a\u652f\u6301\u4e86\u8fd9\u4e2a\u529f\u80fd\u3002\\n\\n\u901a\u8fc7\u8bbe\u7f6e `sample_ratio`\uff0c\u53ef\u4ee5\u63a7\u5236\u88ab\u955c\u50cf\u5230\u6d4b\u8bd5\u670d\u52a1\u7684\u8bf7\u6c42\u6570\u91cf\u3002\u6bd4\u5982\uff0c\u4e0b\u8ff0\u7684\u914d\u7f6e\u5c06 `sample_ratio` \u8bbe\u7f6e\u4e3a 0.5\uff0c\u4f1a\u5c06\u4e00\u534a\u7684\u8bf7\u6c42\u955c\u50cf\u5230\u6d4b\u8bd5\u670d\u52a1\u4e0a\uff1a\\n\\n```json\\n{\\n    \\"plugins\\": {\\n        \\"proxy-mirror\\": {\\n            \\"host\\": \\"http://127.0.0.1:1986\\",\\n            \\"sample_ratio\\": 0.5\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"uri\\": \\"/hello\\"\\n}\\n```\\n\\n## \u65b0\u7ec4\u4ef6\uff1aAPISIX Python Plugin Runner\\n\\n\u7ee7 [Java Plugin Runner](https://apisix.apache.org/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins/) \u548c [Go Plugin Runner](https://apisix.apache.org/blog/2021/08/19/go-makes-Apache-APISIX-better/) \u4e4b\u540e\uff0cApache APISIX \u53c8\u8fce\u6765\u4e86\u65b0\u7684 Plugin Runner\u3002\\n\\n[Apache APISIX Python Plugin Runner](https://github.com/apache/apisix-python-plugin-runner) \u5df2\u4e8e 9 \u6708 6 \u65e5\u53d1\u5e03\u4e86 0.1.0 \u7248\u672c\u3002\\n\\nPython \u662f\u4e00\u95e8\u6709\u7740\u6df1\u539a\u7fa4\u4f17\u57fa\u7840\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u4e00\u76f4\u4ee5\u5bb9\u6613\u4e0a\u624b\u548c\u7075\u6d3b\u591a\u53d8\u800c\u8457\u79f0\u3002\u5982\u4eca\u4f60\u6211\u4e5f\u80fd\u7528\u8fd9\u95e8\u8bed\u8a00\uff0c\u7ed9 Apache APISIX \u7f16\u5199\u63d2\u4ef6\u4e86\u3002\\n\\n\u9664\u4e86 Python Plugin Runner \u4e4b\u5916\uff0c\u793e\u533a\u7684\u4f19\u4f34\u4e5f\u5728\u5f00\u53d1\u5176\u4ed6\u7f16\u7a0b\u8bed\u8a00\u7684 Plugin Runner\uff0c\u6bd4\u5982 [JavaScript Plugin Runner](https://github.com/zenozeng/apisix-javascript-plugin-runner)\uff0c\u6b22\u8fce\u5927\u5bb6\u53c2\u4e0e\u5f00\u53d1\u3002\\n\\n## \u4e0b\u8f7d\\n\\n\u9664\u4e86\u4e0a\u8ff0\u65b0\u529f\u80fd\u548c\u7ec4\u4ef6\u5916\uff0cApache APISIX 2.10.0 \u7248\u672c\u8fd8\u5f15\u5165\u4e86\u5341\u4f59\u4e2a\u65b0\u529f\u80fd\u548c\u63d2\u4ef6\uff0c\u8be6\u60c5\u8bf7\u67e5\u770b\u672c\u6b21\u53d1\u5e03\u5bf9\u5e94\u7684 [Change log](https://github.com/apache/apisix/blob/release/2.10/CHANGELOG.md#2100)\u3002\\n\\n\u4e0b\u8f7d Apache APISIX 2.10.0\\n\\n- \u6e90\u4ee3\u7801\uff1a\u8bf7\u8bbf\u95ee[\u4e0b\u8f7d\u9875\u9762](https://apisix.apache.org/downloads/)\\n- \u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\uff1a\u8bf7\u8bbf\u95ee[\u5b89\u88c5\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/how-to-build/)"},{"id":"2021/09/28/wps-usercase","metadata":{"permalink":"/zh/blog/2021/09/28/wps-usercase","source":"@site/blog/2021/09/28/WPS-usercase.md","title":"\u767e\u4e07\u7ea7 QPS \u4e1a\u52a1\u65b0\u5ba0\uff0c\u91d1\u5c71\u529e\u516c\u643a\u624b Apache APISIX \u6253\u9020\u7f51\u5173\u5b9e\u8df5\u65b0\u4f53\u9a8c","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u91d1\u5c71\u529e\u516c\u5982\u4f55\u4f7f\u7528\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u5e94\u5bf9\u767e\u4e07\u7ea7 QPS \u4e1a\u52a1\uff0c\u540c\u65f6\u57fa\u4e8e Apache APISIX \u66f4\u65b0\u4e0e\u6539\u8fdb\u7f51\u5173\u5b9e\u8df5\u5c42\u9762\u7684\u5185\u5bb9\u3002","date":"2021-09-28T00:00:00.000Z","formattedDate":"2021\u5e749\u670828\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":11.645,"truncated":true,"authors":[{"name":"\u5f20\u5f3a"}],"prevItem":{"title":"Apache APISIX 2.10.0(LTS \u7248\u672c)\u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/09/29/release-apache-apisix-2.10"},"nextItem":{"title":"Apache APISIX Ingress \u4e3a\u4f55\u6210\u4e3a\u53c8\u62cd\u4e91\u6253\u9020\u5bb9\u5668\u7f51\u5173\u7684\u65b0\u9009\u62e9\uff1f","permalink":"/zh/blog/2021/09/24/youpaicloud-usercase"}},"content":"> \u672c\u6587\u7531\u91d1\u5c71\u529e\u516c\u4e2d\u53f0\u90e8\u95e8 SRE \u7f51\u7edc\u8d1f\u8d23\u4eba\u5f20\u5f3a\u4ecb\u7ecd\u4e86\u91d1\u5c71\u529e\u516c\u5982\u4f55\u4f7f\u7528 Apache APISIX \u5e94\u5bf9\u767e\u4e07\u7ea7 QPS \u4e1a\u52a1\uff0c\u540c\u65f6\u57fa\u4e8e Apache APISIX \u66f4\u65b0\u4e0e\u6539\u8fdb\u7f51\u5173\u5b9e\u8df5\u5c42\u9762\u7684\u5185\u5bb9\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4ecb\u7ecd\\n\\n\u91d1\u5c71\u529e\u516c\u662f\u76ee\u524d\u56fd\u5185\u6700\u5927\u7684\u529e\u516c\u8f6f\u4ef6\u5382\u5546\uff0c\u65d7\u4e0b\u4ea7\u54c1\u6d89\u53ca WPS\u3001\u91d1\u5c71\u6587\u6863\u3001\u7a3b\u58f3\u7b49\u3002\u5728\u4e1a\u52a1\u5c42\u9762\u4e0a\u7531\u6570\u5343\u4e2a\u4e1a\u52a1\u4ee5\u5bb9\u5668\u5316\u90e8\u7f72\u5728\u5185\u90e8\u4e91\u539f\u751f\u5e73\u53f0\uff0c\u76ee\u524d [Apache APISIX](https://apisix.apache.org/) \u5728\u91d1\u5c71\u529e\u516c\u4e3b\u8981\u8d1f\u8d23\u4e3a\u4e2d\u53f0\u90e8\u95e8\u4e1a\u52a1\uff08\u767e\u4e07\u7ea7 QPS \uff09\u63d0\u4f9b\u76f8\u5173\u7f51\u5173\u670d\u52a1\u3002\\n\\n## \u91d1\u5c71\u529e\u516c\u7684\u7f51\u5173\u6f14\u8fdb\\n\\n\u5728 1.0 \u9636\u6bb5\u65f6\uff0c\u6211\u4eec\u5bf9\u4e8e API Gateway \u7684\u7279\u6027\u6ca1\u6709\u4ec0\u4e48\u5f3a\u9700\u6c42\uff0c\u53ea\u662f\u60f3\u89e3\u51b3\u8fd0\u7ef4\u95ee\u9898\uff0c\u6240\u4ee5\u57fa\u4e8e OpenResty \u4e0e Lua \u8fdb\u884c\u4e86\u81ea\u7814\uff0c\u5b9e\u73b0\u4e86\u52a8\u6001 Upstream\u3001\u9ed1\u540d\u5355\u3001waf \u7b49\u529f\u80fd\u3002\\n\u867d\u7136\u81ea\u7814\u6210\u529f\uff0c\u4f46\u5728\u529f\u80fd\u4e0a\u5374\u9057\u7559\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u6bd4\u5982\uff1a\\n\\n- \u52a8\u6001\u5316\u53ea\u505a\u5230\u5230 Upstream \u7ef4\u5ea6\\n- \u9700\u8981 Reload \u624d\u80fd\u5e26\u51fa\u65b0\u57df\u540d\\n- \u5e95\u5c42\u8bbe\u8ba1\u7b80\u5355\uff0c\u529f\u80fd\u6269\u5c55\u80fd\u529b\u4e0d\u5f3a\\n\\n\u540e\u7eed\u6211\u4eec\u5bf9 API Gateway \u529f\u80fd\u6709\u4e86\u5f3a\u9700\u6c42\u540e\uff0c\u5f00\u59cb\u53bb\u8c03\u7814\u76f8\u5173\u7684\u5f00\u6e90\u7f51\u5173\u4ea7\u54c1\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u9009\u62e9\u4e86 Apache APISIX\\n\\n\u5b9e\u9645\u4e0a 2019 \u5e74\u5e74\u5e95\u5f00\u59cb\u8c03\u7814\u7f51\u5173\u4ea7\u54c1\u65f6\uff0cKong \u7b97\u662f\u4e00\u4e2a\u6bd4\u8f83\u6d41\u884c\u7684\u9009\u62e9\u3002\\n\\n\u4f46\u540e\u7eed\u7ecf\u8fc7\u6d4b\u8bd5\u53d1\u73b0\uff0cKong \u7684\u6027\u80fd\u4e0d\u592a\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\uff0c\u540c\u65f6\u6211\u4eec\u8ba4\u4e3a Kong \u7684\u67b6\u6784\u4e0d\u662f\u5f88\u4f18\u79c0\uff1a\u56e0\u4e3a\u5176\u914d\u7f6e\u4e2d\u5fc3\u9009\u7528 PostgreSQL\uff0c\u6240\u4ee5 Kong \u53ea\u80fd\u5229\u7528\u975e\u4e8b\u4ef6\u9a71\u52a8\u53bb\u66f4\u65b0\u8def\u7531\uff0c\u4f9d\u8d56\u6bcf\u4e2a\u8282\u70b9\u53bb\u5237\u65b0\u8def\u7531\u3002\\n\\n\u8fdb\u4e00\u6b65\u8c03\u7814\u65f6\uff0c\u6211\u4eec\u53d1\u73b0\u4e86 [Apache APISIX](https://github.com/apache/apisix)\u3002\u9996\u5148 Apache APISIX \u7684\u6027\u80fd\u6bd4 Kong \u5f3a\uff0c\u5728 Apache APISIX \u7684 GitHub Readme \u4e2d\u6709\u4e2a\u975e\u5e38\u8be6\u7ec6\u7684\u5bf9\u6bd4\u56fe\uff0c\u5217\u51fa\u4e86\u4e24\u8005\u7684[\u6027\u80fd\u6d4b\u8bd5\u5dee\u8ddd](https://gist.github.com/membphis/137db97a4bf64d3653aa42f3e016bd01)\uff0c\u8fd9\u4e0e\u6211\u4eec\u81ea\u5df1\u6d4b\u8bd5\u4e0b\u6765\u7684\u6570\u636e\u57fa\u672c\u4e00\u81f4\u3002\\n\\n![Apache APISIX \u4e0e Kong \u6027\u80fd\u5bf9\u6bd4\u56fe](https://static.apiseven.com/202108/1632796929580-a6d7847c-bba6-4417-a7f0-9c127313264e.png)\\n\\n\u5728\u67b6\u6784\u65b9\u9762\uff0cApache APISIX \u7684 etcd \u914d\u7f6e\u5bf9\u6211\u4eec\u800c\u8a00\u662f\u4e00\u9879\u66f4\u4f18\u7684\u9009\u62e9\u3002\\n\\n![Apache APISIX \u67b6\u6784](https://static.apiseven.com/202108/1632796952262-b814e37d-cbc5-43f5-b504-ab1751a9aa83.png)\\n\\n\u5f53\u7136\uff0c\u6700\u4e3b\u8981\u7684\u539f\u56e0\u662f\u6211\u4eec\u89c9\u5f97\u793e\u533a\u4e5f\u5f88\u91cd\u8981\u3002\u793e\u533a\u5982\u679c\u6d3b\u8dc3\uff0c\u5728\u7248\u672c\u66f4\u65b0\u8fed\u4ee3\u3001\u95ee\u9898\u89e3\u51b3\u548c\u529f\u80fd\u4f18\u5316\u4e0a\u7684\u901f\u5ea6\u5c31\u4f1a\u5f88\u5feb\u3002\u4ece GitHub \u548c\u5e73\u65f6\u7684\u90ae\u4ef6\u53cd\u9988\u4e2d\u6211\u4eec\u770b\u5230\u4e86 Apache APISIX \u793e\u533a\u7684\u6d3b\u8dc3\uff0c\u4e3a\u4ea7\u54c1\u529f\u80fd\u548c\u7a33\u5b9a\u6027\u63d0\u4f9b\u4e86\u5f3a\u6709\u529b\u7684\u4fdd\u8bc1\u3002\\n\\n## \u7f51\u5173\u5e73\u6ed1\u8fc1\u79fb\u7ecf\u9a8c\u5206\u4eab\\n\\n\u5927\u90e8\u5206\u670b\u53cb\u5728\u5f00\u59cb\u63a5\u89e6 Apache APISIX \u65f6\uff0c\u90fd\u4f1a\u7528 CLI \u53bb\u751f\u6210\u914d\u7f6e\u5e76\u8d77\u5b9e\u4f8b\u3002\u4f46\u5728\u6211\u4eec\u505a\u5e73\u6ed1\u8fc1\u79fb\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5e76\u6ca1\u6709\u4f7f\u7528 CLI \u53bb\u751f\u6210\u914d\u7f6e\u3002\\n\\n\u4e3b\u8981\u539f\u56e0\u662f Apache APISIX \u5728 OpenResty \u4e2d\u4f1a\u751f\u6548\u4e00\u4e9b Phase\uff0c\u6bd4\u5982\u521d\u59cb\u5316 init\u3001init_worker\u3001HTTP \u548c Upstream \u76f8\u5173 Phase \u7b49\u3002\u5bf9\u5e94\u5230 Apache APISIX \u7684\u914d\u7f6e\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u8131\u79bb CLI \u800c\u5b58\u5728\u3002\\n\\n\u6240\u4ee5\u57fa\u4e8e\u4e0a\u8ff0\u539f\u56e0\uff0c\u6211\u4eec\u6700\u7ec8\u91c7\u53d6\u4e86\u5982\u4e0b\u884c\u52a8\u8fdb\u884c\u5e73\u6ed1\u8fc1\u79fb\uff1a\\n\\n- \u4e0d\u4f7f\u7528 Apache APISIX \u7684 CLI \u751f\u6210\u914d\u7f6e\\n- \u5f15\u5165 Apache APISIX \u7684 Package Path \u5e76\u5c06 Apache APISIX \u4f5c\u4e3a Default Server\\n- \u4fdd\u7559\u5176\u5b83\u9759\u6001\u914d\u7f6e\u4e2d\u7684\u57df\u540d\uff0c\u7531\u4e8e\u65b0\u57df\u540d\u672a\u5728\u9759\u6001\u914d\u7f6e\u4e2d\uff0c\u5c06 Fallback \u5230 Apache APISIX\\n- \u6700\u7ec8\u5c06\u9759\u6001\u914d\u7f6e\u9010\u6e10\u8fc1\u79fb\u5230 Apache APISIX \u4e2d\\n\\n\u5f53\u7136\uff0c\u9664\u4e86\u4e0a\u8ff0\u65b9\u6cd5\uff0c\u6211\u4eec\u4e5f\u7ed9\u5927\u5bb6\u63a8\u8350\u4e00\u79cd\u300c\u8f7b\u6df7\u6a21\u5f0f\u300d\uff0c\u5373\u4f7f\u7528\u9759\u6001\u914d\u7f6e\u914d\u5408 Apache APISIX \u4f5c\u4e3a Location\uff0c\u5f15\u5165\u524d\u8fb9\u63d0\u5230\u7684\u4e00\u4e9b Phase \u6216 Lua \u4ee3\u7801\u8fdb\u884c\u914d\u7f6e\u5373\u53ef\u3002\u8fd9\u6837\u505a\u53ef\u4ee5\u5728\u9759\u6001\u914d\u7f6e\u4e2d\u5f15\u5165\u4e00\u4e9b\u7279\u6b8a\u914d\u7f6e\uff0c\u5b9e\u73b0\u52a8\u6001\u5316\u7b49\u6548\u679c\u3002\\n\\n## \u57fa\u4e8e Apache APISIX \u7684 Shared State \u6539\u8fdb\\n\\n\u9996\u5148\u5728\u6211\u4e2a\u4eba\u770b\u6765\uff0c\u300c\u8f6c\u53d1\u6548\u7387\u4e00\u5b9a\u4e0d\u662f\u95ee\u9898\uff0c\u800c Shared State \u662f\u5f71\u54cd\u7a33\u5b9a\u6027\u7684\u6700\u5927\u56e0\u7d20\u300d\uff0c\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u8bf4\uff1f\\n\\n\u56e0\u4e3a\u8f6c\u53d1\u6548\u7387\u53ef\u4ee5\u901a\u8fc7\u6a2a\u5411\u6269\u5bb9\u53bb\u89e3\u51b3\uff0c\u4f46 Shared State \u662f\u6240\u6709\u7684\u8282\u70b9\u5171\u4eab\u7684\uff0c\u6240\u4ee5\u662f\u81f3\u5173\u91cd\u8981\u7684\u6a21\u5757\u3002\\n\\n\u6240\u4ee5\u5728\u4f7f\u7528 Apache APISIX \u540e\uff0c\u6211\u4eec\u4e3b\u8981\u9488\u5bf9 Shared State \u5c42\u9762\u8fdb\u884c\u4e86\u4e00\u4e9b\u8c03\u6574\u4e0e\u4f18\u5316\u3002\\n\\n### \u4f18\u5316\u4e00\uff1a\u591a\u53f0\u673a\u5668\u76d1\u542c\u4e0b\u7684 etcd \u67b6\u6784\u4f18\u5316\\n\\n\u4e00\u822c\u516c\u53f8\u7f51\u5173\u67b6\u6784\u4e2d\uff0c\u90fd\u4f1a\u6d89\u53ca\u591a\u53f0\u673a\u5668\uff0c\u6709\u7684\u53ef\u80fd\u591a\u81f3\u51e0\u767e\u53f0\uff0c\u540c\u65f6\u6bcf\u53f0\u673a\u5668\u8fd8\u8981\u987e\u53ca worker \u6570\u91cf\u3002\u6240\u4ee5\u5f53\u591a\u53f0\u673a\u5668\u76d1\u63a7\u76f8\u540c Key \u65f6\uff0cetcd \u7684\u538b\u529b\u5c31\u4f1a\u6bd4\u8f83\u5927\uff0c\u56e0\u4e3a etcd \u7684\u5176\u4e2d\u4e00\u4e2a\u673a\u5236\u662f\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\uff0c\u9700\u8981\u6240\u6709\u4e8b\u4ef6\u8fd4\u56de\u7ed9\u76d1\u542c\u8bf7\u6c42\u540e\u624d\u80fd\u5904\u7406\u65b0\u8bf7\u6c42\uff0c\u5f53\u53d1\u9001\u7f13\u51b2\u6ee1\u4e86\u540e\u5c31\u4f1a\u4e22\u5f03\u8bf7\u6c42\u3002\u6240\u4ee5\u5f53\u591a\u53f0\u673a\u5668\u540c\u65f6\u76d1\u542c\u65f6\u5c31\u4f1a\u5bfc\u81f4 etcd \u8d85\u65f6\u8fd0\u884c\uff0c\u63d0\u793a Overload \u62a5\u9519\u7b49\u72b6\u51b5\u3002\\n\\n\u9488\u5bf9\u4e0a\u8ff0\u95ee\u9898\uff0c\u6211\u4eec\u4f7f\u7528\u4e86\u81ea\u7814\u7684 etcd Proxy\u3002\u4e4b\u524d Apache APISIX \u4e0e etcd \u7684\u8fde\u63a5\u5173\u7cfb\u5982\u4e0b\u56fe\u5de6\u4fa7\u6240\u793a\uff0c\u6bcf\u4e2a\u8282\u70b9\u5747\u4e0e etcd \u8fde\u63a5\u3002\u6240\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u5927\u89c4\u6a21\u5165\u53e3\u65f6\uff0c\u8fde\u63a5\u6570\u91cf\u4f1a\u7279\u522b\u5927\uff0c\u5bf9 etcd \u9020\u6210\u538b\u529b\u3002\\n\\n![etcd Proxy](https://static.apiseven.com/202108/1632796985052-c2453a37-edc1-4102-bbb7-8e03627765d5.png)\\n\\n\u65e2\u7136\u662f\u76d1\u542c\u76f8\u540c\u7684 Key\uff0c\u6211\u4eec\u505a\u4e86\u4e00\u4e2a\u4ee3\u7406\u6765\u8fdb\u884c\u7edf\u4e00\u76d1\u542c\uff0c\u5f53\u6709\u7ed3\u679c\u53cd\u9988\u65f6\uff0c\u518d\u8fd4\u56de\u7ed9 Apache APISIX\u3002\u5177\u4f53\u67b6\u6784\u5982\u4e0a\u56fe\u53f3\u4fa7\u6240\u793a\uff0c\u5728 Apache APISIX \u548c etcd \u4e2d\u95f4\u653e\u7f6e\u4e86 etcd Proxy \u7ec4\u4ef6\u6765\u76d1\u63a7 Key \u503c\u7684\u53d8\u5316\u3002\\n\\n### \u4f18\u5316\u4e8c\uff1a\u89e3\u51b3\u8def\u7531\u751f\u6548\u8fc7\u7a0b\u4e2d\u7684\u6027\u80fd\u95ee\u9898\\n\\n\u968f\u7740\u516c\u53f8\u89c4\u6a21\u63d0\u5347\uff0c\u8def\u7531\u6570\u91cf\u7684\u589e\u957f\u4e5f\u4f1a\u968f\u4e4b\u800c\u6765\u3002\u6211\u4eec\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u5728\u6bcf\u6b21\u8def\u7531\u66f4\u65b0\u65f6\uff0cApache APISIX \u90fd\u4f1a\u91cd\u5efa\u7528\u6765\u5339\u914d\u8def\u7531\u7684\u524d\u7f00\u6811\u3002\u8fd9\u4e2a\u4e3b\u8981\u662f\u7531\u4e8e `table.sort` \u6027\u80fd\u4e0d\u8db3\u6240\u5bfc\u81f4\u7684\u3002\\n\\n\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u89c2\u5bdf\u5230\u8def\u7531\u9891\u7e41\u66f4\u65b0\u65f6\uff0c\u7f51\u5173 CPU \u5347\u9ad8\u3001\u4e22\u5305\u7387\u5347\u9ad8\uff0c\u8fdb\u4e00\u6b65\u6392\u67e5\u540e\u53d1\u73b0\u4e22\u5305\u7387\u5347\u9ad8\u7684\u4e3b\u8981\u539f\u56e0\u4e3a Listen overflow \u6240\u9020\u6210\u3002\\n\\n![CPU \u706b\u7130\u56fe](https://static.apiseven.com/202108/1632797671795-141a410b-0dd5-4873-b3dc-56f892aa2f07.png)\\n\\n\u5728 CPU \u5347\u9ad8\u73b0\u8c61\u4e0a\uff0c\u901a\u8fc7\u706b\u7130\u56fe\u53ef\u4ee5\u660e\u663e\u770b\u5230\u5927\u90e8\u5206 CPU \u7684\u65f6\u95f4\u90fd\u662f\u5212\u5728 `auxsort` \u4e0a\uff0c\u5b83\u662f\u7531 FUNCC \u89e6\u53d1\u3002\u800c FUNCC \u7684\u89e6\u53d1\u4e5f\u6307\u660e\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u8bc1\u660e\u76f8\u5173\u6570\u636e\u6ca1\u6709\u7ecf\u8fc7 LuaJIT\uff0c\u53ea\u6709\u56fe\u4e2d\u6700\u53f3\u4fa7\u7684\u4e00\u5c0f\u90e8\u5206\u5904\u7406\u4e86\u6b63\u5e38\u8bf7\u6c42\u3002\\n\\n\u51fa\u73b0\u8fd9\u79cd\u73b0\u8c61\u7684\u539f\u56e0\u4e3b\u8981\u662f LuaJIT \u7684 `table.sort` \u4e0d\u662f\u5b8c\u5168\u4f9d\u9760 JIT \u6a21\u5f0f\uff0c\u8fd9\u70b9\u53ef\u4ee5\u5728 [LuaJIT \u5b98\u7f51 wiki](http://wiki.luajit.org/NYI) \u4e2d\u770b\u5230\u76f8\u5173\u8bf4\u660e\uff0c\u6240\u4ee5\u5728 Lua \u4ee3\u7801\u73af\u5883\u4e2d\u4f7f\u7528 `table.sort` \u6548\u7387\u662f\u6bd4\u8f83\u4f4e\u7684\u3002\\n\\n![LuaJIT Wiki](https://static.apiseven.com/202108/1632797702785-9afdc28d-6c7a-4643-8cac-72b41fee8e2b.png)\\n\\n\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u81ea\u5df1\u4f7f\u7528\u7eaf Lua \u4ee3\u7801\u5b9e\u73b0\u4e86\u9488\u5bf9\u4e0a\u8ff0\u573a\u666f\u7684 sort \u914d\u7f6e\u8fdb\u884c\u4e86\u89e3\u51b3\uff0c\u4f46\u5176\u5b9e Apache APISIX \u5728\u4e4b\u540e\u7684\u7248\u672c\u66f4\u65b0\u4e2d\u5df2\u7ecf\u4fee\u590d\u4e86\u8fd9\u9879\u95ee\u9898\uff0c\u5177\u4f53\u601d\u8def\u4e5f\u8ddf\u6211\u4eec\u7406\u89e3\u7684\u7c7b\u4f3c\u3002\\n\\n### \u66f4\u591a Shared State \u4f7f\u7528\u7ecf\u9a8c\\n\\n1. \u5728\u4fee\u6539 Apache APISIX \u6216\u8005\u81ea\u5df1\u8fdb\u884c\u63d2\u4ef6\u5f00\u53d1\u65f6\uff0c\u786e\u4fdd\u505a\u597d Schema \u6821\u9a8c\uff0c\u5305\u542b\u5224\u7a7a\uff0c\u5c24\u5176\u662f\u5728\u5339\u914d\u90e8\u5206\u3002\u56e0\u4e3a\u5728\u5339\u914d\u90e8\u5206\u51fa\u95ee\u9898\u7684\u8bdd\uff0c\u4f1a\u9020\u6210\u6574\u4f53\u6027\u7684\u5f71\u54cd\u3002\\n2. \u505a\u597d\u4e1a\u52a1\u62c6\u5206\u89c4\u5212\u3002\u6839\u636e\u4e1a\u52a1\u91cf\u53bb\u89c4\u5212\u597d\u76f8\u5173 etcd Prefix \u548c IP \u6570\u91cf\uff0c\u90e8\u7f72\u66f4\u7a33\u56fa\u7684\u96c6\u7fa4\uff0c\u628a\u7cfb\u7edf\u6027\u98ce\u9669\u964d\u5230\u6700\u4f4e\\n\\n## \u5f00\u6e90\u8bdd\u9898\u8ba8\u8bba\\n\\n### \u7a33\u5b9a\u6027\u4e0e\u529f\u80fd\u5c42\u9762\u7684\u53d6\u820d\\n\\n\u76ee\u524d\u91d1\u5c71\u529e\u516c\u4f7f\u7528 Apache APISIX \u5df2\u7ecf\u5feb\u4e24\u5e74\u4e86\uff0c\u4f5c\u4e3a\u4ea7\u54c1\u7528\u6237\uff0c\u6211\u8ba4\u4e3a Apache APISIX \u786e\u5b9e\u662f\u4e00\u6b3e\u7a33\u5b9a\u53ef\u4fe1\u7684\u5f00\u6e90\u4ea7\u54c1\uff0c\u5728\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u90fd\u4f1a\u53ca\u65f6\u5730\u4e0e\u793e\u533a\u6700\u65b0\u7248\u672c\u4fdd\u6301\u4e00\u81f4\u3002\\n\\n\u4f46\u662f\u4e00\u822c\u63a5\u89e6\u5e76\u5e94\u7528\u8fc7\u5f00\u6e90\u4ea7\u54c1\u7684\u516c\u53f8\u5e94\u8be5\u90fd\u6709\u4f53\u4f1a\uff0c\u5347\u7ea7\u7248\u672c\u4f1a\u6709\u4e00\u4e9b\u65b0\u529f\u80fd\u7684\u51fa\u73b0\uff0c\u4f46\u540c\u65f6\u4e5f\u4f1a\u5e26\u6765\u4e00\u4e9b\u7a33\u5b9a\u6027\u4e0a\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u5728\u5347\u7ea7\u7248\u672c\u548c\u7a33\u5b9a\u6027\u4e2d\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u53d6\u820d\u3002\\n\\n\u8fd9\u4e2a\u95ee\u9898\u80af\u5b9a\u6ca1\u6709\u7edf\u4e00\u7684\u7b54\u6848\uff0c\u4f46\u662f\u6211\u4e2a\u4eba\u89c9\u5f97\u9488\u5bf9 Apache APISIX \u8fd9\u9879\u4ea7\u54c1\uff0c\u5c3d\u91cf\u4e0e\u5b98\u7f51\u7248\u672c\u4fdd\u6301\u4e00\u81f4\u3002\\n\\n\u5c31\u91d1\u5c71\u529e\u516c\u800c\u8a00\uff0c\u6211\u4eec\u76ee\u524d\u56e0\u4e3a\u5927\u89c4\u6a21\u4f7f\u7528\u5230 Apache APISIX\uff0c\u6240\u4ee5\u5bf9\u7a33\u5b9a\u6027\u6709\u6781\u81f4\u8ffd\u6c42\u3002\u4e4b\u524d\u8ddf\u4e0d\u4e0a\u5b98\u65b9\u66f4\u65b0\u8fdb\u5ea6\u65f6\u4e5f\u5bf9\u6211\u4eec\u7684\u4f7f\u7528\u9020\u6210\u4e86\u4e00\u5b9a\u7a0b\u5ea6\u7684\u5f71\u54cd\uff0c\u6240\u4ee5\u63a8\u8350\u5927\u5bb6\u5c3d\u91cf\u4e0e\u5b98\u65b9\u7248\u672c\u4fdd\u6301\u4e00\u81f4\u3002\\n\\n\u5982\u679c\u8bf4\u4f60\u50cf\u6211\u4eec\u4e00\u6837\uff0c\u6709\u65f6\u5019\u53ef\u80fd\u8ddf\u4e0d\u4e0a\u5b98\u65b9\u7248\u672c\uff0c\u81f3\u5c11\u4e5f\u5e94\u8be5\u505a\u5230\u6bcf\u5468\u67e5\u9605 [GitHub](https://github.com/apache/apisix) \u7684 Master Change Log \u7b49\u76f8\u5173\u6587\u6863\uff0c\u65f6\u523b\u5173\u6ce8\u4ea7\u54c1\u53d8\u5316\u3002\\n\\n### \u57fa\u4e8e Apache APISIX \u4ea7\u54c1\u5316\u7ecf\u9a8c\\n\\n\u6211\u4eec\u57fa\u4e8e Apache APISIX \u5305\u88c5\u4e86\u5f88\u591a\u4ea7\u54c1\u5316\u529f\u80fd\uff0c\u6bd4\u5982\u591a\u673a\u623f\u5e94\u7528\u6bd4\u4f8b\u5207\u91cf\u3001\u4e00\u952e\u5c01\u7981\u8def\u7531\u7b49\u3002\u5728\u5b9e\u8df5\u5e94\u7528\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u8ba4\u8bc6\u5230 Apache APISIX \u662f\u4e00\u4e2a\u6781\u5176\u7075\u6d3b\u5f3a\u5927\u7684\u4ea7\u54c1\uff0c\u6240\u4ee5\u5728\u8fdb\u884c\u4ea7\u54c1\u5316\u6539\u9020\u65f6\u6211\u4eec\u5c31\u5e94\u8be5\u660e\u767d\u4e00\u4e2a\u70b9\uff1a\u5f3a\u5927 = \u907f\u514d\u4e0d\u4e86\u7684\u590d\u6742\u548c\u5371\u9669\u3002\\n\\n\u8fd9\u70b9\u5728 Apache APISIX \u672c\u8eab\u7684\u4ee3\u7801\u8bbe\u8ba1\u4e0a\u4e5f\u6709\u5f88\u591a\u7684\u4f53\u73b0\uff0c\u6bd4\u5982\u4e00\u4e9b\u63d2\u4ef6\u7684\u6539\u9020\u53ef\u80fd\u5c31\u9700\u8981\u81ea\u5df1\u53bb\u7f16\u8bd1\uff0c\u56e0\u4e3a\u6bd5\u7adf\u5404\u81ea\u5e94\u7528\u8d77\u6765\u65f6\u573a\u666f\u6ca1\u6709\u529e\u6cd5\u505a\u5230\u7edf\u4e00\u3002\\n\\n\u6700\u540e\uff0c\u57fa\u4e8e\u6211\u4eec\u524d\u8fb9\u63d0\u5230\u7684\u5b9e\u8df5\u7ecf\u9a8c\uff0c\u4e5f\u5efa\u8bae\u5927\u5bb6\u5728\u8fdb\u884c Apache APISIX \u9879\u76ee\u4ea7\u54c1\u5316\u65f6\uff0c\u63d0\u524d\u89c4\u5212\u597d\u7f51\u5173\u5171\u4eab\u7684\u9897\u7c92\u5ea6\uff0c\u51cf\u5c11\u540e\u7eed\u4f7f\u7528\u95ee\u9898\u3002"},{"id":"Apache APISIX Ingress \u4e3a\u4f55\u6210\u4e3a\u53c8\u62cd\u4e91\u6253\u9020\u5bb9\u5668\u7f51\u5173\u7684\u65b0\u9009\u62e9\uff1f","metadata":{"permalink":"/zh/blog/2021/09/24/youpaicloud-usercase","source":"@site/blog/2021/09/24/youpaicloud-usercase.md","title":"Apache APISIX Ingress \u4e3a\u4f55\u6210\u4e3a\u53c8\u62cd\u4e91\u6253\u9020\u5bb9\u5668\u7f51\u5173\u7684\u65b0\u9009\u62e9\uff1f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u53c8\u62cd\u4e91\u9009\u62e9\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX Ingress \u540e\u6240\u5e26\u6765\u516c\u53f8\u5185\u90e8\u7f51\u5173\u67b6\u6784\u7684\u66f4\u65b0\u4e0e\u8c03\u6574\uff0c\u540c\u65f6\u5206\u4eab\u4e86\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u5b9e\u8df5\u573a\u666f\u4ecb\u7ecd\u3002","date":"2021-09-24T00:00:00.000Z","formattedDate":"2021\u5e749\u670824\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":13.445,"truncated":true,"authors":[{"name":"\u9648\u5353"}],"prevItem":{"title":"\u767e\u4e07\u7ea7 QPS \u4e1a\u52a1\u65b0\u5ba0\uff0c\u91d1\u5c71\u529e\u516c\u643a\u624b Apache APISIX \u6253\u9020\u7f51\u5173\u5b9e\u8df5\u65b0\u4f53\u9a8c","permalink":"/zh/blog/2021/09/28/wps-usercase"},"nextItem":{"title":"Apache APISIX \u52a9\u529b\u4fbf\u5229\u5145\u7535\u521b\u9886\u8005\u5c0f\u7535\uff0c\u5b9e\u73b0\u4e91\u539f\u751f\u65b9\u6848","permalink":"/zh/blog/2021/09/18/xiaodian-usercase"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u53c8\u62cd\u4e91\u9009\u62e9 Apache APISIX Ingress \u540e\u6240\u5e26\u6765\u516c\u53f8\u5185\u90e8\u7f51\u5173\u67b6\u6784\u7684\u66f4\u65b0\u4e0e\u8c03\u6574\uff0c\u540c\u65f6\u5206\u4eab\u4e86\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u5b9e\u8df5\u573a\u666f\u4ecb\u7ecd\u3002\\n> \u4f5c\u8005\u9648\u5353\uff0c\u53c8\u62cd\u4e91\u5f00\u53d1\u5de5\u7a0b\u5e08\uff0c\u8d1f\u8d23\u4e91\u5b58\u50a8\u3001\u4e91\u5904\u7406\u548c\u7f51\u5173\u5e94\u7528\u5f00\u53d1\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u9879\u76ee\u80cc\u666f\u4ecb\u7ecd\\n\\n\u76ee\u524d\u5e02\u9762\u4e0a\u53ef\u6267\u884c Ingress \u7684\u4ea7\u54c1\u9879\u76ee\u9010\u6e10\u4e30\u5bcc\u4e86\u8d77\u6765\uff0c\u53ef\u9009\u62e9\u7684\u8303\u56f4\u4e5f\u6269\u5927\u4e86\u5f88\u591a\u3002\u8fd9\u4e9b\u4ea7\u54c1\u6309\u7167\u67b6\u6784\u5927\u6982\u53ef\u5206\u4e3a\u4e24\u7c7b\uff0c\u4e00\u7c7b\u50cf k8s Ingress\u3001Apache APISIX Ingress\uff0c\u4ed6\u4eec\u662f\u57fa\u4e8e Nginx\u3001OpenResty \u7b49\u4f20\u7edf\u4ee3\u7406\u5668\uff0c\u4f7f\u7528 k8s-Client \u548c Golang \u53bb\u505a Controller\u3002\u8fd8\u6709\u4e00\u7c7b\u65b0\u5174\u7684\u7528 Golang \u8bed\u8a00\u53bb\u5b9e\u73b0\u4ee3\u7406\u548c\u63a7\u5236\u5668\u529f\u80fd\uff0c\u6bd4\u5982 Traefik\u3002\\n\\n\u53c8\u62cd\u4e91\u6700\u5f00\u59cb\u5305\u62ec\u73b0\u5728\u7684\u5927\u90e8\u5206\u4e1a\u52a1\u4ecd\u5728\u4f7f\u7528 Ingress-Nginx\uff0c\u6574\u4f53\u67b6\u6784\u5982\u4e0b\u3002\\n\\n![Ingress-Nginx \u67b6\u6784](https://static.apiseven.com/202108/1632469775377-8303128c-e8a6-4594-a87b-ac6942f4895e.png)\\n\\n\u4e0b\u5c42\u4e3a\u6570\u636e\u9762 OpenResty\u3002\u4e0a\u5c42 Controller \u4e3b\u8981\u662f\u76d1\u542c APIServer \u7684\u8d44\u6e90\u53d8\u5316\uff0c\u5e76\u751f\u6210 nginx.conf \u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e Reload OpenResty\u3002\u5982\u679c POD IP \u53d1\u751f\u53d8\u5316\uff0c\u53ef\u76f4\u63a5\u901a\u8fc7 HTTP \u63a5\u53e3\u4f20\u8f93\u7ed9 OpenResty Lua \u4ee3\u7801\u53bb\u5b9e\u73b0\u4e0a\u6e38 Upstream node \u66ff\u6362\u3002\\n\\nIngress-Nginx \u7684\u6269\u5c55\u80fd\u529b\u4e3b\u8981\u901a\u8fc7 Annotations \u53bb\u5b9e\u73b0\uff0c\u914d\u7f6e\u6587\u4ef6\u672c\u8eab\u7684\u8bed\u6cd5\u548c\u8def\u7531\u89c4\u5219\u90fd\u6bd4\u8f83\u7b80\u5355\u3002\u53ef\u4ee5\u6309\u7167\u9700\u6c42\u8fdb\u884c\u76f8\u5173\u6307\u4ee4\u914d\u7f6e\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u53ef\u62d3\u5c55 Lua \u63d2\u4ef6\uff0c\u63d0\u9ad8\u4e86\u5b9a\u5236\u5316\u529f\u80fd\u7684\u53ef\u64cd\u4f5c\u6027\u3002\\n\\n![Ingress-Nginx \u6269\u5c55\u80fd\u529b\u5b9e\u73b0](https://static.apiseven.com/202108/1632469835090-20c409f6-0416-4b2f-9ad7-4c836638f892.png)\\n\\n\u4f46 Ingress-Nginx \u5b83\u4e5f\u6709\u4e00\u4e9b\u7f3a\u70b9\uff0c\u6bd4\u5982\uff1a\\n\\n- \u5f00\u53d1\u63d2\u4ef6\u65f6\u7ec4\u4ef6\u4f9d\u8d56\u590d\u6742\uff0c\u79fb\u690d\u6027\u5dee\\n- \u8bed\u4e49\u80fd\u529b\u5f31\\n- \u4efb\u4f55\u4e00\u6761 Ingress \u7684\u4fee\u6539\u90fd\u9700\u8981 Reload\uff0c\u5bf9\u957f\u94fe\u63a5\u4e0d\u53cb\u597d\\n\\n\u5728\u7ef4\u62a4\u73b0\u6709\u903b\u8f91\u65f6\uff0c\u4e0a\u8ff0\u95ee\u9898\u9020\u6210\u4e86\u4e00\u5b9a\u7a0b\u5ea6\u7684\u56f0\u6270\uff0c\u6240\u4ee5\u6211\u4eec\u5f00\u59cb\u5bfb\u627e\u76f8\u5173\u5bb9\u5668\u7f51\u5173\u66ff\u4ee3\u54c1\u3002\\n\\n## \u8c03\u7814\u9636\u6bb5\\n\\n\u5728\u66ff\u4ee3 Ingress-Nginx \u7684\u9009\u62e9\u4e2d\uff0c\u6211\u4eec\u4e3b\u8981\u8003\u91cf\u4e86 Traefik \u548c Apache APISIX Ingress\u3002\\n\\n![Traefik](https://static.apiseven.com/202108/1632469875567-61dd6fbd-757f-419f-a769-99e6aaf46f0c.png)\\n\\nTraefik \u662f\u4e91\u539f\u751f\u6a21\u5f0f\uff0c\u914d\u7f6e\u6587\u4ef6\u6781\u5176\u7b80\u5355\uff0c\u91c7\u7528\u5206\u5e03\u5f0f\u914d\u7f6e\uff0c\u540c\u65f6\u652f\u6301\u591a\u79cd\u81ea\u52a8\u914d\u7f6e\u53d1\u73b0\u3002\u4e0d\u4ec5\u652f\u6301 k8s\u3001etcd\uff0cGolang \u7684\u751f\u6001\u8bed\u8a00\u652f\u6301\u6bd4\u8f83\u597d\uff0c\u4e14\u5f00\u53d1\u6210\u672c\u8f83\u4f4e\uff0c\u8fed\u4ee3\u548c\u6d4b\u8bd5\u80fd\u529b\u8f83\u597d\u3002\u4f46\u662f\u5728\u5176\u4ed6\u5c42\u9762\u7565\u663e\u4e0d\u8db3\uff0c\u6bd4\u5982\uff1a\\n\\n- \u6269\u5c55\u80fd\u529b\u5f31\\n- \u4e0d\u652f\u6301 Reload\\n- \u6027\u80fd\u548c\u529f\u80fd\u4e0a\u4e0d\u5982 Nginx\uff08\u867d\u7136\u6d88\u8017\u4e5f\u8f83\u4f4e\uff09\\n\\n\u5b83\u4e0d\u50cf Nginx \u6709\u4e30\u5bcc\u7684\u63d2\u4ef6\u548c\u6307\u4ee4\uff0c\u901a\u8fc7\u589e\u52a0\u4e00\u6761\u6307\u4ee4\u5373\u53ef\u89e3\u51b3\u4e00\u4e2a\u95ee\u9898\uff0c\u5728\u7ebf\u4e0a\u90e8\u7f72\u65f6\uff0c\u53ef\u80fd\u8fd8\u9700\u5728 Traefik \u524d\u642d\u914d\u4e00\u4e2a Nginx\u3002\\n\\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u867d\u7136\u5728\u64cd\u4f5c\u6027\u4e0a Traefik \u4f18\u52bf\u5c3d\u663e\uff0c\u4f46\u5728\u6269\u5c55\u80fd\u529b\u548c\u8fd0\u7ef4\u6548\u7387\u4e0a\u6709\u6240\u987e\u8651\uff0c\u6700\u7ec8\u6ca1\u6709\u9009\u62e9 Traefik\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX Ingress\\n\\n### \u5185\u90e8\u539f\u56e0\\n\\n\u5728\u516c\u53f8\u5185\u90e8\u7684\u591a\u4e2a\u6570\u636e\u4e2d\u5fc3\u4e0a\u76ee\u524d\u90fd\u5b58\u6709 Apache APISIX \u7684\u7f51\u5173\u96c6\u7fa4\uff0c\u8fd9\u4e9b\u662f\u4e4b\u524d\u4ece Kong \u4e0a\u66ff\u6362\u8fc7\u6765\u7684\u3002\u540e\u6765\u57fa\u4e8e Apache APISIX \u7684\u63d2\u4ef6\u7cfb\u7edf\u6211\u4eec\u5f00\u53d1\u4e86\u4e00\u4e9b\u5185\u90e8\u63d2\u4ef6\uff0c\u6bd4\u5982\u5185\u90e8\u6743\u9650\u7cfb\u7edf\u6821\u9a8c\u3001\u7cbe\u51c6\u901f\u7387\u9650\u5236\u7b49\u3002\\n\\n### \u6548\u7387\u7ef4\u62a4\u5c42\u9762\\n\\n\u540c\u65f6\u6211\u4eec\u4e5f\u6709\u4e00\u4e9b k8s \u96c6\u7fa4\uff0c\u8fd9\u4e9b\u5bb9\u5668\u5185\u7684\u96c6\u7fa4\u7f51\u5173\u4f7f\u7528\u7684\u662f Ingress Nginx\u3002\u5728\u4e4b\u524d\u4e0d\u652f\u6301\u63d2\u4ef6\u7cfb\u7edf\u65f6\uff0c\u6211\u4eec\u5c31\u5728 Ingress Nginx \u4e0a\u5b9a\u5236\u4e86\u4e00\u4e9b\u63d2\u4ef6\u3002\u6240\u4ee5\u5728\u5185\u90e8\u6570\u636e\u4e2d\u5fc3\u548c\u5bb9\u5668\u7684\u7f51\u5173\u4e0a\uff0cApache APISIX \u548c Nginx \u7684\u529f\u80fd\u5176\u5b9e\u6709\u4e00\u5927\u90e8\u5206\u90fd\u662f\u91cd\u5408\u7684\u3002\\n\\n\u4e3a\u4e86\u907f\u514d\u540e\u7eed\u7684\u91cd\u590d\u5f00\u53d1\u548c\u8fd0\u7ef4\uff0c\u6211\u4eec\u60f3\u628a\u4e4b\u524d\u4f7f\u7528\u7684 Ingress Nginx \u5bb9\u5668\u5185\u7f51\u5173\u5168\u90e8\u66ff\u6362\u4e3a Apache APISIX Ingress\uff0c\u5b9e\u73b0\u7f51\u5173\u5c42\u9762\u7684\u7ec4\u4ef6\u7edf\u4e00\u3002\\n\\n## \u57fa\u4e8e Apache APISIX Ingress \u7684\u8c03\u6574\u66f4\u65b0\\n\\n\u76ee\u524d Apache APISIX Ingress \u5728\u53c8\u62cd\u4e91\u662f\u5904\u4e8e\u521d\u671f\uff08\u7ebf\u4e0a\u6d4b\u8bd5\uff09\u9636\u6bb5\u3002\u56e0\u4e3a Apache APISIX Ingress \u7684\u5feb\u901f\u8fed\u4ee3\uff0c\u6211\u4eec\u76ee\u524d\u8fd8\u6ca1\u6709\u5c06\u5176\u8fd0\u7528\u5230\u4e00\u4e9b\u91cd\u8981\u4e1a\u52a1\u4e0a\uff0c\u53ea\u662f\u5728\u65b0\u96c6\u7fa4\u4e2d\u5c1d\u8bd5\u4f7f\u7528\u3002\\n\\n### \u67b6\u6784\u8c03\u6574\\n\\n\u4f7f\u7528 Apache APISIX Ingress \u4e4b\u540e\uff0c\u5185\u90e8\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![\u5e94\u7528 APISIX Ingress \u67b6\u6784](https://static.apiseven.com/202108/1632469909488-3685d104-e458-4145-8ccb-6cecbd383161.png)\\n\\n\u8ddf\u524d\u9762\u63d0\u5230\u7684 Ingress-Nginx \u67b6\u6784\u4e0d\u4e00\u6837\uff0c\u5e95\u5c42\u6570\u636e\u9762\u66ff\u6362\u6210\u4e86 Apache APISIX \u96c6\u7fa4\u3002\u4e0a\u5c42 Controller \u76d1\u542c APIServer \u53d8\u5316\uff0c\u7136\u540e\u518d\u901a\u8fc7 etcd \u5c06\u914d\u7f6e\u8d44\u6e90\u5206\u53d1\u5230\u6574\u4e2a Apache APISIX \u96c6\u7fa4\u7684\u6240\u6709\u8282\u70b9\u3002\\n\\n![\u914d\u7f6e\u6587\u4ef6\u5bf9\u6bd4](https://static.apiseven.com/202108/1632469956257-b9cb6a91-a082-437c-9395-d62ffb75280f.png)\\n\\n\u7531\u4e8e Apache APISIX \u662f\u652f\u6301\u52a8\u6001\u8def\u7531\u4fee\u6539\uff0c\u4e0e\u53f3\u8fb9\u7684 Ingress-Nginx \u4e0d\u540c\u3002\u5728 Apache APISIX \u4e2d\uff0c\u5f53\u6709\u4e1a\u52a1\u6d41\u91cf\u8fdb\u5165\u65f6\u8d70\u7684\u90fd\u662f\u540c\u4e00\u4e2a Location\uff0c\u7136\u540e\u5728 Lua \u4ee3\u7801\u4e2d\u5b9e\u73b0\u8def\u7531\u9009\u62e9\uff0c\u4ee3\u7801\u90e8\u7f72\u7b80\u6d01\u6613\u64cd\u4f5c\u3002\u800c\u53f3\u4fa7 Ingress-Nginx \u76f8\u6bd4\uff0c\u5176 nginx.conf \u914d\u7f6e\u6587\u4ef6\u590d\u6742\uff0c\u6bcf\u6b21 Ingress \u53d8\u66f4\u90fd\u9700\u8981 Reload\u3002\\n\\n### Apache APISIX Ingress Controller\\n\\nApache APISIX Ingress Controller \u4f9d\u8d56\u4e8e Apache APISIX \u7684\u52a8\u6001\u8def\u7531\u80fd\u529b\u8fdb\u884c\u529f\u80fd\u5b9e\u73b0\u3002\u5b83\u4e3b\u8981\u76d1\u63a7 APIServer \u7684\u8d44\u6e90\u53d8\u5316\uff0c\u8fdb\u884c\u6570\u636e\u7ed3\u6784\u8f6c\u6362\u3001\u6570\u636e\u6821\u9a8c\u548c\u8ba1\u7b97 DIFF\uff0c\u6700\u540e\u5e94\u7528\u5230 Apache APISIX Admin API \u4e2d\u3002\\n\\n\u540c\u65f6 Apache APISIX Ingress Controller \u4e5f\u6709\u9ad8\u53ef\u7528\u65b9\u6848\uff0c\u76f4\u63a5\u901a\u8fc7 k8s \u7684 leader-election \u673a\u5236\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u518d\u5f15\u5165\u5916\u90e8\u5176\u4ed6\u7ec4\u4ef6\u3002\\n\\n#### \u58f0\u660e\u5f0f\u914d\u7f6e\\n\\n\u76ee\u524d Apache APISIX Ingress Controller \u652f\u6301\u4e24\u79cd\u58f0\u660e\u5f0f\u914d\u7f6e\uff0cIngress Resource \u548c CRD Resource\u3002\u524d\u8005\u6bd4\u8f83\u9002\u5408\u4ece Ingress-Nginx \u66ff\u6362\u8fc7\u6765\u7684\u7f51\u5173\u63a7\u4ef6\uff0c\u5728\u8f6c\u6362\u6210\u672c\u4e0a\u662f\u6700\u5177\u6027\u4ef7\u6bd4\u7684\u3002\u4f46\u662f\u5b83\u7684\u7f3a\u70b9\u4e5f\u6bd4\u8f83\u660e\u663e\uff0c\u6bd4\u5982\u8bed\u4e49\u5316\u80fd\u529b\u592a\u5f31\u3001\u6ca1\u6709\u7279\u522b\u7ec6\u81f4\u7684\u89c4\u8303\u7b49\uff0c\u540c\u65f6\u80fd\u529b\u62d3\u5c55\u4e5f\u53ea\u80fd\u901a\u8fc7 Annotation \u53bb\u5b9e\u73b0\u3002\\n\\n![Ingress Resource](https://static.apiseven.com/202108/1632469994485-209d3a21-d761-4b2c-a974-c913b443b0d2.png)\\n\\n\u53c8\u62cd\u4e91\u5185\u90e8\u9009\u62e9\u7684\u662f\u7b2c\u4e8c\u79cd\u58f0\u660e\u914d\u7f6e\u2014\u2014\u8bed\u4e49\u5316\u66f4\u5f3a\u7684 CRD Resource\u3002\u7ed3\u6784\u5316\u6570\u636e\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u914d\u7f6e\u7684\u8bdd\uff0c\u53ea\u8981 Apache APISIX \u652f\u6301\u7684\u80fd\u529b\uff0c\u90fd\u53ef\u4ee5\u8fdb\u884c\u5b9e\u73b0\u3002\\n\\n![CRD Resource](https://static.apiseven.com/202108/1632470033850-b619da2f-5926-44ca-95bb-69ee1cdaf209.png)\\n\\n\u5982\u679c\u4f60\u60f3\u4e86\u89e3\u66f4\u591a\u5173\u4e8e Apache APISIX Ingress Controller \u7684\u7ec6\u8282\u5e72\u8d27\uff0c\u53ef\u4ee5\u53c2\u8003 Apache APISIX PMC \u5f20\u8d85\u5728 Meetup \u4e0a\u7684[\u5206\u4eab\u89c6\u9891](https://www.bilibili.com/video/BV1eB4y1u7i1?spm_id_from=333.999.0.0)\u3002\\n\\n### \u529f\u80fd\u63d0\u5347\\n\\n#### \u6548\u679c\u4e00\uff1a\u65e5\u5fd7\u5c42\u9762\u6548\u7387\u63d0\u9ad8\\n\\n\u76ee\u524d\u6211\u4eec\u5185\u90e8\u6709\u591a\u4e2a Apache APISIX \u96c6\u7fa4\uff0c\u5305\u62ec\u6570\u636e\u4e2d\u5fc3\u7f51\u5173\u548c\u5bb9\u5668\u7f51\u5173\u90fd\u7edf\u4e00\u5f00\u59cb\u4f7f\u7528\u4e86 Apache APISIX\uff0c\u8fd9\u6837\u5728\u540e\u7eed\u76f8\u5173\u65e5\u5fd7\u7684\u5904\u7406/\u6d88\u8d39\u7a0b\u5e8f\u65f6\u53ef\u4ee5\u7edf\u4e00\u5230\u4e00\u5957\u903b\u8f91\u3002\\n\\n![\u65e5\u5fd7\u5c42\u9762](https://static.apiseven.com/202108/1632470075980-46d13ac7-babb-40a5-b105-73f1105d16e7.png)\\n\\n\u5f53\u7136 Apache APISIX \u7684\u65e5\u5fd7\u63d2\u4ef6\u652f\u6301\u529f\u80fd\u4e5f\u975e\u5e38\u4e30\u5bcc\u3002\u6211\u4eec\u5185\u90e8\u4f7f\u7528\u7684\u662f Kafka-Logger\uff0c\u5b83\u53ef\u4ee5\u8fdb\u884c\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f\u3002\u50cf\u4e0b\u56fe\u4e2d\u5176\u4ed6\u7684\u65e5\u5fd7\u63d2\u4ef6\u53ef\u80fd\u6709\u4e9b\u56e0\u4e3a\u4f7f\u7528\u4eba\u6570\u7684\u539f\u56e0\uff0c\u8fd8\u5c1a\u672a\u652f\u6301\u81ea\u5b9a\u4e49\u5316\u683c\u5f0f\uff0c\u6b22\u8fce\u6709\u76f8\u5173\u9700\u6c42\u7684\u5c0f\u4f19\u4f34\u8fdb\u884c\u4f7f\u7528\u5e76\u63d0\u4ea4 PR \u6765\u6269\u5c55\u5f53\u524d\u7684\u65e5\u5fd7\u63d2\u4ef6\u529f\u80fd\u3002\\n\\n![\u63d2\u4ef6\u4e00\u89c8](https://static.apiseven.com/202108/1632470099306-ffc74dfb-384b-4014-a0b4-14267dcf7bce.png)\\n\\n#### \u6548\u679c\u4e8c\uff1a\u5b8c\u5584\u76d1\u63a7\u4e0e\u5065\u5eb7\u68c0\u67e5\\n\\n\u5728\u76d1\u63a7\u5c42\u9762\uff0cApache APISIX \u4e5f\u652f\u6301 Prometheus\u3001SkyWalking \u7b49\uff0c\u6211\u4eec\u5185\u90e8\u4f7f\u7528\u7684\u662f Prometheus\u3002\\n\\nApache APISIX \u4f5c\u4e3a\u4e00\u4e2a\u57fa\u672c\u4ee3\u7406\u5668\uff0c\u53ef\u4ee5\u5b9e\u73b0 APP \u72b6\u6001\u7801\u7684\u76d1\u63a7\u548c\u8bf7\u6c42\u7b49\u9700\u6c42\u3002\u4f46 Apache APISIX \u7684\u81ea\u8eab\u5065\u5eb7\u68c0\u67e5\u529b\u5ea6\u4e0d\u662f\u5f88\u597d\u63a7\u5236\u3002\u76ee\u524d\u6211\u4eec\u91c7\u7528\u7684\u662f\u5728 k8s \u91cc\u9762\u90e8\u7f72\u4e00\u4e2a\u670d\u52a1\u5e76\u751f\u6210\u591a\u4e2a POD\uff0c\u5c06\u8fd9\u4e2a\u670d\u52a1\u540c\u65f6\u5e94\u7528\u4e8e Apache APISIX Ingress\uff0c\u7136\u540e\u901a\u8fc7\u68c0\u67e5\u6574\u4e2a\u94fe\u8def\u6765\u786e\u5b9a Apache APISIX \u662f\u5426\u5065\u5eb7\u3002\\n\\n![\u5065\u5eb7\u68c0\u67e5](https://static.apiseven.com/202108/1632470120106-3e577e2e-ea43-4f50-8e3c-066b5f1e7238.png)\\n\\n## \u4f7f\u7528 Apache APISIX Ingress \u5b9e\u8df5\u89e3\u51b3\u65b9\u6848\\n\\n### \u573a\u666f\u4e00\uff1ak8s \u5e94\u7528\u53d8\u66f4\\n\\n\u5728\u4f7f\u7528 k8s \u642d\u914d Apache APISIX Ingress \u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u505a\u5230\u4ee5\u4e0b\u51e0\u70b9\uff1a\\n\\n- \u66f4\u65b0\u7b56\u7565\u7684\u9009\u7528\u5efa\u8bae\u4f7f\u7528\u6eda\u52a8\u66f4\u65b0\uff0c\u4fdd\u8bc1\u5927\u90e8\u5206 POD \u53ef\u7528\uff0c\u540c\u65f6\u8fd8\u9700\u8981\u8003\u8651\u7a33\u5b9a\u8d1f\u8f7d\u7684\u95ee\u9898\\n- \u5e94\u5bf9 POD \u542f\u52a8 k8s \u5185\u90e8\u5065\u5eb7\u68c0\u67e5\uff0c\u4fdd\u8bc1 POD \u7684\u4e1a\u52a1\u53ef\u7528\u6027\uff0c\u907f\u514d\u8bf7\u6c42\u8fc7\u6765\u540e POD \u4ecd\u5904\u4e8e\u4e0d\u80fd\u63d0\u4f9b\u6b63\u5e38\u670d\u52a1\u7684\u72b6\u6001\\n- \u4fdd\u8bc1 Apache APISIX Upstream \u91cc\u7684\u5927\u90e8\u5206 Endpoint \u53ef\u7528\\n\\n\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u9047\u5230\u4e86\u4f20\u8f93\u5ef6\u65f6\u7684\u95ee\u9898\u3002POD \u66f4\u65b0\u8def\u5f84\u5982\u4e0b\u6240\u793a\uff0cPOD Ready \u540e\u901a\u8fc7\u5c42\u5c42\u6b65\u9aa4\u4f9d\u6b21\u8fdb\u884c\u4fe1\u606f\u4f20\u9012\uff0c\u4e2d\u95f4\u67d0\u4e9b\u94fe\u8def\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u5ef6\u65f6\u95ee\u9898\u3002\u6b63\u5e38\u60c5\u51b5\u4e0b\u4e00\u822c\u662f 1 \u79d2\u5185\u540c\u6b65\u5b8c\u6210\uff0c\u67d0\u4e9b\u6781\u7aef\u60c5\u51b5\u4e0b\u90e8\u5206\u94fe\u8def\u65f6\u95f4\u53ef\u80fd\u4f1a\u589e\u52a0\u51e0\u79d2\u8fdb\u800c\u51fa\u73b0 Endpoint \u66f4\u65b0\u4e0d\u53ca\u65f6\u7684\u95ee\u9898\u3002\\n\\n![\u94fe\u8def\u95ee\u9898](https://static.apiseven.com/202108/1632470165257-cb16e489-b546-4451-917a-6c72648769d8.png)\\n\\n\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u5f53\u66f4\u65b0\u65f6\u524d\u4e00\u6279 POD \u53d8\u6210 Ready \u72b6\u6001\u540e\uff0c\u7b49\u5f85\u51e0\u79d2\u949f\u518d\u7ee7\u7eed\u66f4\u65b0\u4e0b\u4e00\u6279\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u4fdd\u8bc1 Apache APISIX Upstream \u91cc\u7684\u5927\u90e8\u5206 Endpoint \u662f\u53ef\u7528\u7684\u3002\\n\\n### \u573a\u666f\u4e8c\uff1a\u4e0a\u6e38\u5065\u5eb7\u68c0\u67e5\u95ee\u9898\\n\\n\u7531\u4e8e APIServer \u9762\u5411\u72b6\u6001\u7684\u8bbe\u8ba1\uff0c\u5728\u4e0e Apache APISIX \u8fdb\u884c\u540c\u6b65\u65f6\u4e5f\u4f1a\u51fa\u73b0\u5ef6\u65f6\u95ee\u9898\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u300c502 \u9519\u8bef\u72b6\u6001\u8b66\u544a\u300d\u3002\u50cf\u8fd9\u7c7b\u95ee\u9898\uff0c\u5c31\u9700\u8981\u5728\u7f51\u5173\u5c42\u9762\u5bf9 Upstream Endpoint \u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\u6765\u89e3\u51b3\u3002\\n\\n\u9996\u5148 Upstream Endpoint \u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u4e0d\u592a\u73b0\u5b9e\uff0c\u56e0\u4e3a Endpoint \u592a\u8017\u65f6\u8d39\u529b\u3002\u800c HTTP \u5c42\u7684\u76d1\u63a7\u68c0\u67e5\u7531\u4e8e\u4e0d\u80fd\u786e\u5b9a\u72b6\u6001\u7801\u6240\u4ee5\u4e5f\u4e0d\u9002\u5408\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\u3002\\n\\n\u6700\u5408\u9002\u7684\u65b9\u6cd5\u5c31\u662f\u5728\u7f51\u5173\u5c42\u9762\u57fa\u4e8e TCP \u505a\u88ab\u52a8\u5065\u5eb7\u68c0\u67e5\uff0c\u6bd4\u5982\u4f60\u7684\u7f51\u7edc\u8fde\u63a5\u8d85\u65f6\u4e0d\u53ef\u8fbe\uff0c\u5c31\u53ef\u4ee5\u8ba4\u4e3a POD \u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u9700\u8981\u505a\u964d\u7ea7\u5904\u7406\u3002\u8fd9\u6837\u53ea\u9700\u5728 TCP \u5c42\u9762\u8fdb\u884c\u68c0\u67e5\uff0c\u4e0d\u9700\u8981\u89e6\u53ca\u5176\u4ed6\u4e1a\u52a1\u90e8\u5206\uff0c\u53ef\u8fbe\u5230\u72ec\u7acb\u64cd\u63a7\u3002\\n\\n### \u573a\u666f\u4e09\uff1amTLS \u8fde\u63a5 etcd\\n\\n\u7531\u4e8e Apache APISIX \u96c6\u7fa4\u9ed8\u8ba4\u4f7f\u7528\u5355\u5411\u9a8c\u8bc1\u7684\u673a\u5236\uff0c\u4f5c\u4e3a\u5bb9\u5668\u7f51\u5173\u4f7f\u7528 Apache APISIX \u65f6\uff0c\u53ef\u80fd\u4f1a\u5728\u4e0e k8s \u8fde\u63a5\u540c\u4e00\u4e2a etcd \u96c6\u7fa4\uff08k8s etcd \u4e2d\u4f7f\u7528\u53cc\u5411\u9a8c\u8bc1\uff09\u65f6\u9ed8\u8ba4\u5f00\u542f\u53cc\u5411\u8ba4\u8bc1\uff0c\u8fdb\u800c\u5bfc\u81f4\u51fa\u73b0\u5982\u4e0b\u8bc1\u4e66\u95ee\u9898\uff1a\\n\\n![\u8bc1\u4e66\u95ee\u9898](https://static.apiseven.com/202108/1632470191228-5c2a3666-8d21-4b19-a5be-e09e7db4d488.png)\\n\\nApache APISIX \u4e0d\u662f\u901a\u8fc7 gRPC \u76f4\u63a5\u8fde\u63a5 etcd\uff0c\u800c\u662f\u901a\u8fc7 HTTP \u534f\u8bae\u5148\u8fde\u63a5\u5230 etcd \u5185\u90e8\u7684 gRPC-gateway\uff0c\u518d\u53bb\u8fde\u63a5\u771f\u6b63\u7684 gRPC Server\u3002\u8fd9\u4e2d\u95f4\u591a\u4e86\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u6240\u4ee5\u5c31\u4f1a\u591a\u4e00\u6b21\u53cc\u5411\u9a8c\u8bc1\u3002\\n\\ngRPC-gateway \u53bb\u8fde\u63a5 gRPC Server \u7684\u65f6\u5019\u9700\u8981\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0cetcd \u6ca1\u6709\u63d0\u4f9b\u8fd9\u4e2a\u8bc1\u4e66\u7684\u914d\u7f6e\u9879\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528 gRPC server \u7684\u670d\u52a1\u7aef\u8bc1\u4e66\u3002\u76f8\u5f53\u4e8e\u4e00\u4e2a\u8bc1\u4e66\u540c\u65f6\u4f5c\u4e3a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u6821\u9a8c\u3002\u5982\u679c\u4f60\u7684 gRPC server \u670d\u52a1\u7aef\u8bc1\u4e66\u5f00\u542f\u4e86\u6269\u5c55\uff08\u8868\u660e\u8fd9\u4e2a\u8bc1\u4e66\u53ea\u80fd\u7528\u4e8e\u670d\u52a1\u7aef\u6821\u9a8c\uff09\uff0c\u90a3\u4e48\u9700\u8981\u53bb\u6389\u8fd9\u4e2a\u6269\u5c55\uff0c\u6216\u8005\u518d\u52a0\u4e0a\u4e5f\u53ef\u7528\u4e8e\u5ba2\u6237\u7aef\u6821\u9a8c\u7684\u6269\u5c55\u3002\\n\\n\u540c\u65f6 OpenResty \u5e95\u5c42\u662f\u4e0d\u652f\u6301 mTLS \u7684\uff0c\u5f53\u4f60\u9700\u8981\u901a\u8fc7 mTLS \u8fde\u63a5\u4e0a\u6e38\u670d\u52a1\u6216 etcd \u65f6\uff0c\u9700\u8981\u4f7f\u7528\u57fa\u4e8e apisix-nginx-module \u53bb\u6784\u5efa\u6253\u8fc7 patch \u7684 Openresty\u3002apisix-build-tools \u53ef\u4ee5\u627e\u5230\u76f8\u5173\u6784\u5efa\u811a\u672c\u3002\\n\\n## \u672a\u6765\u671f\u671b\\n\\n\u867d\u7136\u76ee\u524d\u6211\u4eec\u8fd8\u53ea\u662f\u5728\u6d4b\u8bd5\u9636\u6bb5\u5e94\u7528 Apache APISIX Ingress\uff0c\u4f46\u76f8\u4fe1\u5728\u4e0d\u4e45\u4e4b\u540e\uff0c\u7ecf\u8fc7\u5e94\u7528\u7684\u8fed\u4ee3\u529f\u80fd\u66f4\u65b0\u548c\u5185\u90e8\u67b6\u6784\u8fc1\u79fb\u8c03\u6574\uff0cApache APISIX Ingress \u4f1a\u7edf\u4e00\u5e94\u7528\u5230\u53c8\u62cd\u4e91\u7684\u6240\u6709\u5bb9\u5668\u7f51\u5173\u5185\u3002"},{"id":"Apache APISIX \u52a9\u529b\u4fbf\u5229\u5145\u7535\u521b\u9886\u8005\u5c0f\u7535\uff0c\u5b9e\u73b0\u4e91\u539f\u751f\u65b9\u6848","metadata":{"permalink":"/zh/blog/2021/09/18/xiaodian-usercase","source":"@site/blog/2021/09/18/xiaodian-usercase.md","title":"Apache APISIX \u52a9\u529b\u4fbf\u5229\u5145\u7535\u521b\u9886\u8005\u5c0f\u7535\uff0c\u5b9e\u73b0\u4e91\u539f\u751f\u65b9\u6848","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u56fd\u5185\u4fbf\u5229\u5145\u7535\u521b\u9886\u8005\u2014\u2014\u5c0f\u7535\u901a\u8fc7\u5e94\u7528\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX\uff0c\u8fdb\u884c\u516c\u53f8\u4ea7\u54c1\u67b6\u6784\u7684\u4e91\u539f\u751f\u9879\u76ee\u642d\u5efa\u7684\u76f8\u5173\u80cc\u666f\u548c\u5b9e\u8df5\u4ecb\u7ecd\u4ee5\u53ca\u5bf9\u516c\u53f8\u7f51\u5173\u672a\u6765\u7684\u89c4\u5212\u3002","date":"2021-09-18T00:00:00.000Z","formattedDate":"2021\u5e749\u670818\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":11.195,"truncated":true,"authors":[{"name":"\u5b59\u5189"}],"prevItem":{"title":"Apache APISIX Ingress \u4e3a\u4f55\u6210\u4e3a\u53c8\u62cd\u4e91\u6253\u9020\u5bb9\u5668\u7f51\u5173\u7684\u65b0\u9009\u62e9\uff1f","permalink":"/zh/blog/2021/09/24/youpaicloud-usercase"},"nextItem":{"title":"APISIX \u5728\u817e\u8baf\u4e91\u667a\u80fd\u949b\u5e73\u53f0\u7684\u843d\u5730\u5b9e\u8df5","permalink":"/zh/blog/2021/09/16/tencent-cloud"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u56fd\u5185\u4fbf\u5229\u5145\u7535\u521b\u9886\u8005\u2014\u2014\u5c0f\u7535\u901a\u8fc7\u5e94\u7528 Apache APISIX\uff0c\u8fdb\u884c\u516c\u53f8\u4ea7\u54c1\u67b6\u6784\u7684\u4e91\u539f\u751f\u9879\u76ee\u642d\u5efa\u7684\u76f8\u5173\u80cc\u666f\u548c\u5b9e\u8df5\u4ecb\u7ecd\\n> \u4f5c\u8005\u5b59\u5189\uff0c\u8fd0\u7ef4\u4e13\u5bb6\u3002\u76ee\u524d\u5c31\u804c\u4e8e\u5c0f\u7535\u5e73\u53f0\u67b6\u6784\u90e8\uff0c\u4e3b\u8981\u8d1f\u8d23 K8s \u96c6\u7fa4\u548c API \u7f51\u5173\u7684\u76f8\u5173\u90e8\u7f72\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u4e1a\u52a1\u80cc\u666f\\n\\n\u5c0f\u7535\u4f5c\u4e3a\u56fd\u5185\u5171\u4eab\u5145\u7535\u5b9d\u670d\u52a1\u5e73\u53f0\uff0c\u76ee\u524d\u8fd8\u5904\u4e8e\u521d\u521b\u9636\u6bb5\u3002\u4ece\u8fd0\u7ef4\u4f53\u7cfb\u3001\u6d4b\u8bd5\u73af\u5883\u7b49\u65b9\u9762\u6765\u8bb2\uff0c\u5f53\u4e0b\u4ea7\u54c1\u7684\u4e1a\u52a1\u4e3b\u8981\u9762\u4e34\u4e86\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a\\n\\n- VM \u4f20\u7edf\u6a21\u5f0f\u90e8\u7f72\uff0c\u5229\u7528\u7387\u4f4e\u4e14\u4e0d\u6613\u6269\u5c55\\n- \u5f00\u53d1\u6d4b\u8bd5\u8d44\u6e90\u62a2\u5360\\n- \u591a\u5957\u72ec\u7acb\u7684\u6d4b\u8bd5\u73af\u5883\uff08k8s\uff09\uff0c\u6bcf\u6b21\u90e8\u7f72\u7ef4\u62a4\u6b65\u9aa4\u91cd\u590d\u6548\u7387\u4f4e\\n- \u4f7f\u7528 Nginx \u914d\u7f6e\u7ba1\u7406\uff0c\u8fd0\u7ef4\u6210\u672c\u6781\u9ad8\\n\\n\u5728 2020 \u5e74\u521d\uff0c\u6211\u4eec\u51b3\u5b9a\u542f\u52a8\u5bb9\u5668\u5316\u9879\u76ee\uff0c\u6253\u7b97\u5bfb\u627e\u4e00\u4e2a\u73b0\u6709\u65b9\u6848\u6765\u8fdb\u884c\u4e0a\u8ff0\u95ee\u9898\u7684\u89e3\u51b3\u3002\\n\\n\u76ee\u524d\u516c\u53f8\u662f\u4ee5\u300c\u62e5\u62b1\u4e91\u539f\u751f\u300d\u7684\u6001\u5ea6\u6765\u8fdb\u884c\u540e\u7eed\u4e1a\u52a1\u7684\u65b9\u6848\u9009\u62e9\uff0c\u4e3b\u8981\u770b\u91cd\u4e91\u539f\u751f\u6a21\u5f0f\u4e0b\u7684\u5fae\u670d\u52a1\u6539\u9020\u3001DevOps\u3001\u6301\u7eed\u4ea4\u4ed8\u4ee5\u53ca\u6700\u91cd\u8981\u7684\u5bb9\u5668\u5316\u7279\u6027\u3002\\n\\n![\u4e3a\u4ec0\u4e48\u9009\u62e9\u4e91\u539f\u751f](https://static.apiseven.com/202108/1631946996654-5cb0668b-bd15-42f8-9446-06ba11449367.png)\\n\\n## \u4e3a\u4ec0\u4e48\u9700\u8981 Apache APISIX\\n\\n\u57fa\u4e8e\u4e0a\u8ff0\u4e91\u539f\u751f\u6a21\u5f0f\u7684\u9009\u62e9\uff0c\u6211\u4eec\u5f00\u542f\u4e86\u5bb9\u5668\u5316\u65b9\u6848\u642d\u5efa\u3002\u65b9\u6848\u4e3b\u8981\u6709\u4e09\u90e8\u5206\u7ec4\u6210\uff1a\\n\\n1. **\u81ea\u7814 Devops \u5e73\u53f0 - DNA**\uff1a\u8fd9\u4e2a\u5e73\u53f0\u4e3b\u8981\u662f\u7528\u4e8e\u9879\u76ee\u7ba1\u7406\u3001\u53d8\u66f4\u7ba1\u7406\uff08\u9884\u53d1\u3001\u751f\u4ea7\u73af\u5883\uff09\u3001\u5e94\u7528\u751f\u547d\u5468\u671f\u7ba1\u7406\uff08DNA Operator\uff09\u548c CI/CD \u76f8\u5173\u529f\u80fd\u7684\u5d4c\u5165\u3002\\n2. **\u57fa\u4e8e k8s Namespace \u7684\u9694\u79bb**\uff1a\u4e4b\u524d\u6211\u4eec\u6240\u6709\u7684\u5f00\u53d1\u9879\u76ee\u73af\u5883\uff0c\u5305\u62ec\u53d8\u66f4\u73af\u5883\u7b49\u90fd\u5168\u90e8\u6ce8\u518c\u5728\u4e00\u8d77\uff0c\u6240\u4ee5\u73af\u5883\u4e0e\u73af\u5883\u4e4b\u95f4\u7684\u76f8\u4e92\u9694\u79bb\u6210\u4e3a\u6211\u4eec\u5fc5\u8981\u7684\u5904\u7406\u8fc7\u7a0b\u3002\\n3. **\u52a8\u6001\u7ba1\u7406\u8def\u7531\u7684\u7f51\u5173\u63a5\u5165\u5c42**\uff1a\u8003\u8651\u5230\u5185\u90e8\u7684\u591a\u5e94\u7528\u548c\u591a\u73af\u5883\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u52a8\u6001\u7ba1\u7406\u7684\u7f51\u5173\u63a5\u5165\u5c42\u6765\u8fdb\u884c\u76f8\u5173\u7684\u64cd\u4f5c\u5904\u7406\u3002\\n\\n### \u7f51\u5173\u9009\u62e9\\n\\n\u5728\u7f51\u5173\u9009\u62e9\u4e0a\uff0c\u6211\u4eec\u5bf9\u6bd4\u4e86\u4ee5\u4e0b\u51e0\u4e2a\u4ea7\u54c1\uff1aOpenShift Route\u3001Nginx Ingress \u548c Apache APISIX\u3002\\n\\nOpenShift 3.0 \u5f00\u59cb\u5f15\u5165 OpenShift Route \uff0c\u4f5c\u7528\u662f\u901a\u8fc7 Ingress Operator \u4e3a Kubernetes \u63d0\u4f9b Ingress Controller\uff0c\u4ee5\u6b64\u6765\u5b9e\u73b0\u5916\u90e8\u5165\u6808\u8bf7\u6c42\u7684\u6d41\u91cf\u8def\u7531\u3002\u4f46\u662f\u5728\u540e\u7eed\u6d4b\u8bd5\u4e2d\uff0c\u529f\u80fd\u652f\u6301\u65b9\u9762\u4e0d\u5b8c\u5584\u4e14\u7ef4\u62a4\u6210\u672c\u5f88\u9ad8\u3002\u540c\u65f6 Nginx Ingres \u4e5f\u5b58\u5728\u7c7b\u4f3c\u7684\u95ee\u9898\uff0c\u4f7f\u7528\u6210\u672c\u548c\u8fd0\u7ef4\u6210\u672c\u504f\u9ad8\u3002\\n\\n\u5728\u53c2\u4e0e Apache APISIX \u7684\u8c03\u7814\u8fc7\u7a0b\u4e2d\u6211\u4eec\u53d1\u73b0\uff0cApache APISIX \u7684\u6838\u5fc3\u5c31\u662f\u63d0\u4f9b\u8def\u7531\u548c\u8d1f\u8f7d\u5747\u8861\u76f8\u5173\u529f\u80fd\uff0c\u540c\u65f6\u8fd8\u652f\u6301\uff1a\\n\\n- \u52a8\u6001\u8def\u7531\u52a0\u8f7d\u3001\u5b9e\u65f6\u66f4\u65b0\\n- etcd \u5b58\u50a8\u4e0b\u7684\u65e0\u72b6\u6001\u9ad8\u53ef\u7528\u6a21\u5f0f\\n- \u6a2a\u5411\u6269\u5c55\\n- \u8de8\u6e90\u8d44\u6e90\u5171\u4eab\uff08CORS\uff09\u3001Proxy Rewrite \u63d2\u4ef6\\n- API \u8c03\u7528\u548c\u81ea\u52a8\u5316\u8bbe\u7f6e\\n- Dashboard \u6e05\u6670\u6613\u7528\\n\\n\u5f53\u7136\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0cApache APISIX \u6709\u7740\u975e\u5e38\u9ad8\u7684\u793e\u533a\u6d3b\u8dc3\u5ea6\uff0c\u4e5f\u7b26\u5408\u6211\u4eec\u8ffd\u6c42\u4e91\u539f\u751f\u7684\u8d8b\u52bf\uff0c\u7efc\u5408\u8003\u8651\u6211\u4eec\u7684\u5e94\u7528\u573a\u666f\u548c Apache APISIX \u7684\u4ea7\u54c1\u4f18\u52bf\uff0c\u6700\u7ec8\u5c06\u9879\u76ee\u73af\u5883\u4e2d\u6240\u6709\u8def\u7531\u90fd\u66ff\u6362\u4e3a Apache APISIX\u3002\\n\\n## \u5e94\u7528 Apache APISIX \u540e\u7684\u53d8\u5316\\n\\n### \u6574\u4f53\u67b6\u6784\\n\\n\u6211\u4eec\u76ee\u524d\u7684\u4ea7\u54c1\u67b6\u6784\u4e0e\u5728 K8s \u4e2d\u4f7f\u7528 Apache APISIX \u5927\u4f53\u7c7b\u4f3c\u3002\u4e3b\u8981\u662f\u5c06 Apache APISIX \u7684 Service \u4ee5 LoadBalancer \u7c7b\u578b\u66b4\u9732\u5230\u5916\u90e8\u3002\u7136\u540e\u7528\u6237\u901a\u8fc7\u8bf7\u6c42\u8bbf\u95ee\u4f20\u8f93\u5230 Apache APISIX\uff0c\u518d\u5c06\u8def\u7531\u8f6c\u53d1\u5230\u4e0a\u6e38\u7684\u76f8\u5173\u670d\u52a1\u4e2d\u3002\\n\\n![\u6574\u4f53\u67b6\u6784](https://static.apiseven.com/2021/0918/20220816-171733.jpg)\\n\\n\u989d\u5916\u8981\u63d0\u7684\u4e00\u70b9\u662f\uff0c\u4e3a\u4ec0\u4e48\u6211\u4eec\u628a etcd \u653e\u5728\u4e86\u6280\u672f\u6808\u5916\u3002\u4e00\u662f\u56e0\u4e3a\u65e9\u4e9b\u7248\u672c\u89e3\u6790\u57df\u540d\u65f6\u4f1a\u51fa\u73b0\u504f\u5dee\uff0c\u4e8c\u662f\u56e0\u4e3a\u5728\u5185\u90e8\u6211\u4eec\u8fdb\u884c\u7ef4\u62a4\u548c\u5907\u4efd\u7684\u8fc7\u7a0b\u6bd4\u8f83\u7e41\u7410\uff0c\u6240\u4ee5\u5c31\u628a etcd \u5355\u72ec\u62ff\u4e86\u51fa\u6765\u3002\\n\\n### \u4e1a\u52a1\u6a21\u578b\\n\\n![\u4e1a\u52a1\u6a21\u578b](https://static.apiseven.com/2021/0918/20220816-172217.jpg)\\n\\n\u4e0a\u56fe\u662f\u63a5\u5165 Apache APISIX \u540e\u7684\u4e1a\u52a1\u73af\u5883\u6539\u9020\u6a21\u578b\u3002\u6bcf\u4e2a\u5f00\u53d1\u6216\u9879\u76ee\u8fdb\u884c\u53d8\u66f4\u65f6\uff0cDNA \u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u53d8\u66f4\uff0c\u540c\u65f6\u8f6c\u5316\u4e3a k8s Namespace \u8d44\u6e90\u3002\\n\\n\u56e0\u4e3a k8s Namespace \u672c\u8eab\u5c31\u5177\u5907\u8d44\u6e90\u9694\u79bb\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u5728\u90e8\u7f72\u65f6\u6211\u4eec\u57fa\u4e8e Namespace \u63d0\u4f9b\u4e86\u591a\u5957\u9879\u76ee\u53d8\u66f4\u73af\u5883\uff0c\u540c\u65f6\u5305\u542b\u6240\u6709\u5e94\u7528\u526f\u672c\u5e76\u6ce8\u518c\u5230\u540c\u4e00\u4e2a Eureka\u3002\u6211\u4eec\u6539\u9020\u4e86 Eureka \u4f7f\u5f97\u5b83\u53ef\u4ee5\u652f\u6301\u4e0d\u540c Namespace \u7684\u5e94\u7528\u526f\u672c\u9694\u79bb\uff0c\u4fdd\u8bc1\u4e92\u76f8\u4e0d\u88ab\u8c03\u7528\u3002\\n\\n### \u529f\u80fd\u52a0\u6301\\n\\n\u5c06\u4e0a\u8ff0\u67b6\u6784\u548c\u4e1a\u52a1\u6a21\u578b\u5b9e\u8df5\u8d77\u6765\u540e\uff0c\u6bcf\u4e2a\u9879\u76ee\u53d8\u66f4\u90fd\u4f1a\u4ea7\u751f\u5bf9\u5e94\u7684 Namespace \u8d44\u6e90\uff0c\u540c\u65f6 DNA Operator \u5c31\u4f1a\u53bb\u521b\u5efa\u5bf9\u5e94\u7684 APP \u8d44\u6e90\uff0c\u6700\u540e\u53bb\u751f\u6210\u76f8\u5e94\u7684 Apache APISIX \u8def\u7531\u89c4\u5219\u3002\\n\\n#### \u529f\u80fd\u4e00\uff1a\u9879\u76ee\u53d8\u66f4\u591a\u73af\u5883\\n\\n\u5728\u53d8\u66f4\u73af\u5883\u4e2d\u6211\u4eec\u6709\u4e24\u79cd\u573a\u666f\uff0c\u4e00\u4e2a\u662f\u70b9\u5bf9\u70b9\u6a21\u5f0f\uff0c\u5373\u4e00\u4e2a\u57df\u540d\u5bf9\u5e94\u4e00\u4e2a\u5e94\u7528\u3002\u5f00\u53d1\u53ea\u9700\u8981\u542f\u7528\u57df\u540d\uff0cDNA \u91cc\u5c31\u4f1a\u5229\u7528 Apache APISIX \u53bb\u751f\u6210\u5bf9\u5e94\u8def\u7531\uff0c\u8fd9\u79cd\u5c31\u662f\u5355\u4e00\u8def\u5f84\u7684\u8def\u7531\u89c4\u5219\u3002\\n\\n![\u5355\u4e00\u8def\u5f84](https://static.apiseven.com/2021/0918/20220816-172249.jpg)\\n\\n\u53e6\u4e00\u79cd\u573a\u666f\u5c31\u662f\u591a\u7ea7\u8def\u5f84\u8def\u7531\u3002\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\u6211\u4eec\u57fa\u4e8e Apache APISIX \u5c06\u9879\u76ee\u53d8\u66f4\u4e2d\u9700\u8981\u7684\u591a\u4e2a APP \u8def\u7531\u6307\u5411\u5230\u5f53\u524d Namespace \u73af\u5883\uff0c\u5176\u5173\u8054 APP \u8def\u7531\u5219\u6307\u5411\u5230\u4e00\u5957\u7a33\u5b9a\u7684 Namespace \u73af\u5883\u4e2d\uff08\u901a\u5e38\u4e3a Stable \u73af\u5883\uff09\u3002\\n\\n![\u591a\u7ea7\u8def\u5f84](https://static.apiseven.com/2021/0918/20220816-172458.jpg)\\n\\n#### \u529f\u80fd\u4e8c\uff1a\u81ea\u52a8\u5316\u6d41\u7a0b\\n\\n\u57fa\u4e8e\u4e0a\u8ff0\u9879\u76ee\u73af\u5883\u7684\u4e00\u4e9b\u8def\u7531\u89c4\u5219\uff0c\u642d\u914d Apache APISIX \u7684 API \u8c03\u7528\u529f\u80fd\u505a\u4e86\u4e00\u4e2a\u63a7\u5236\u4e2d\u5fc3\uff0c\u96c6\u5408\u4e86\u4e00\u4e9b\u5305\u62ec\u57df\u540d\u524d\u7f00\u548c\u5bf9\u5e94\u7684\u5e94\u7528\u5b9e\u4f8b\u7b49\u529f\u80fd\u3002\\n\\n\u6bd4\u5982\u67d0\u4e2a\u65b0\u5e94\u7528\u4e0a\u7ebf\u65f6\uff0c\u53ef\u4ee5\u7533\u8bf7\u4e00\u6761\u76f8\u5e94\u7684\u8def\u7531\u89c4\u5219\uff0c\u7136\u540e\u628a\u89c4\u5219\u52a0\u5230\u63a7\u5236\u4e2d\u5fc3\u4e2d\u3002\u9700\u8981\u8bf7\u6c42\u8def\u7531\u65f6\uff0c\u5c31\u53ef\u4ee5\u4e00\u952e\u542f\u7528\u8fd9\u6761\u8def\u7531\u89c4\u5219\u5e76\u81ea\u52a8\u540c\u6b65\u5230 Apache APISIX\u3002\\n\\n![\u81ea\u52a8\u5316\u6d41\u7a0b](https://static.apiseven.com/2021/0918/20220816-172538.jpg)\\n\\n\u53e6\u5916\u6211\u4eec\u4e5f\u63d0\u4f9b\u4e86\u5355\u4e00\u666e\u901a\u8def\u7531\u7533\u8bf7\uff0c\u5305\u62ec\u7ebf\u4e0a\u73af\u5883\u548c\u6d4b\u8bd5\u73af\u5883\uff0c\u6216\u8005\u4e00\u4e9b\u5bf9\u5916\u516c\u7f51\u7684\u66b4\u9732\u4e0e\u6d4b\u8bd5\u9700\u6c42\u7b49\uff0c\u4e5f\u53ef\u4ee5\u8c03\u7528 Apache APISIX \u63a5\u53e3\u3002\\n\\n![\u666e\u901a\u8def\u7531](https://static.apiseven.com//2021/0918/20220816-172610.jpg)\\n\\n## \u57fa\u4e8e Apache APISIX \u7684\u5177\u4f53\u5b9e\u8df5\\n\\n### \u57fa\u4e8e OpenShift \u90e8\u7f72\\n\\nOpenShift \u5177\u6709\u975e\u5e38\u4e25\u683c\u7684 SCC \u673a\u5236\uff0c\u5728\u5229\u7528 OpenShift \u53bb\u90e8\u7f72 Apache APISIX \u65f6\u9047\u5230\u4e86\u5f88\u591a\u95ee\u9898\uff0c\u6240\u4ee5\u6bcf\u6b21\u53d1\u7248\u90fd\u8981\u91cd\u65b0\u53bb\u505a\u7f16\u8bd1\u3002\\n\\n\u53e6\u5916\u57fa\u4e8e Apache APISIX \u63d0\u4f9b\u7684 Docker \u955c\u50cf\u529f\u80fd\uff0c\u6211\u4eec\u5c06\u65e5\u5e38\u7684\u4e00\u4e9b\u57fa\u7840\u8f6f\u4ef6\u8fdb\u884c\u4e86\u66f4\u65b0\uff0c\u6bd4\u5982\u8c03\u4f18\u548c\u95ee\u9898\u67e5\u770b\uff0c\u901a\u8fc7 Image Rebuild \u529f\u80fd\u4e0a\u4f20\u5230\u5185\u90e8\u955c\u50cf\u4ed3\u5e93\u3002\\n\\n### \u8de8\u7248\u672c\u5e73\u6ed1\u5904\u7406\\n\\n\u6211\u4eec\u4e00\u5f00\u59cb\u4f7f\u7528\u7684 Apache APISIX \u4e3a 1.5 \u7248\u672c\uff0c\u5728\u66f4\u65b0\u5230\u6700\u65b0\u7248\u672c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u7ecf\u5386\u4e86\u7c7b\u4f3c etcd v2 \u7248\u672c\u6027\u80fd\u4e0b\u964d\u3001\u589e\u52a0\u4e86 CORS \u63d2\u4ef6\u5f3a\u6821\u9a8c\u7b49\u60c5\u51b5\u3002\\n\\n![\u5e73\u6ed1\u5904\u7406](https://static.apiseven.com/202108/1632294589632-e113850d-57a6-4a82-be21-63ec8e78f842.png)\\n\\n\u57fa\u4e8e\u6b64\uff0c\u6211\u4eec\u91c7\u53d6\u4e86\u7248\u672c\u5207\u6d41\u7684\u65b9\u6848\uff0c\u65b0\u7248\u672c\u542f\u7528\u5e76\u521b\u5efa\u65b0\u7684 Service \u4ee5\u53ca\u66b4\u9732\u76f8\u5173 SLB \u4fe1\u606f\u3002\u901a\u8fc7 Service \u7684 Selector \u5c5e\u6027\uff0c\u5c06 Gateway \u5207\u6362\u5230\u65b0\u7248\u672c\u7684 Apache APISIX \u4e2d\u3002\u53e6\u4e00\u65b9\u9762\u6211\u4eec\u4e5f\u4f1a\u5c06\u6d41\u91cf\u8fdb\u884c\u5207\u5206\u5904\u7406\uff0c\u5c06\u90e8\u5206\u6d41\u91cf\u901a\u8fc7 DNS \u89e3\u6790\u5230\u65b0\u7248\u672c Apache APISIX SLB \u5730\u5740\uff0c\u6765\u5b9e\u73b0\u7248\u672c\u66f4\u8fed\u7684\u5e73\u6ed1\u5904\u7406\u3002\\n\\n### \u89e3\u51b3 etcd \u538b\u7f29\u95ee\u9898\\n\\n\u5728\u4f7f\u7528\u671f\u95f4\u6211\u4eec\u4e5f\u89c2\u5bdf\u5230 Load \u4e00\u76f4\u7a81\u9ad8\u4e0d\u4e0b\u7684\u60c5\u51b5\uff0c\u7ecf\u68c0\u67e5\u53d1\u73b0 etcd \u5185\u7684\u6570\u636e\u91cf\u5df2\u8fbe\u5230 600 \u591a\u5146\uff0c\u6240\u4ee5\u6211\u4eec\u91c7\u53d6\u4e86\u5b9a\u671f\u538b\u7f29 etcd \u7684\u63aa\u65bd\uff0c\u5c06\u5386\u53f2\u4e8b\u7269\u6570\u636e\u5168\u90e8\u6e05\u9664\u3002\u5177\u4f53\u4ee3\u7801\u53ef\u53c2\u8003\uff1a\\n\\n```sh\\n$ ETCDCTL_API=3 etcdctl --endpoints=http://etcd-1:2379 compact 1693729\\n$ ETCDCTL_API=3 etcdctl --endpoints=http://etcd-1:2379 defrag\\n```\\n\\n### \u83b7\u53d6 Client-IP\\n\\n\u5728\u7ebf\u4e0a\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u83b7\u53d6\u5230\u6e90 IP \u53bb\u505a\u76f8\u5173\u7684\u4e1a\u52a1\u5904\u7406\u3002\u521a\u597d Apache APISIX \u63d0\u4f9b\u4e86\u300cX-Real-IP\u300d\u7684\u529f\u80fd\uff0c\u901a\u8fc7\u914d\u7f6e real_ip_header \u548c\u5f00\u542f externalTrafficPolicy \u7684 Local \u6a21\u5f0f\u8fdb\u884c\u76f8\u5173\u83b7\u53d6\u64cd\u4f5c\u3002\\n\\n## \u672a\u6765\u671f\u671b\\n\\n\u4f17\u6240\u5468\u77e5\uff0c\u5c0f\u7535\u73b0\u5728\u662f\u4e3b\u505a\u5171\u4eab\u5145\u7535\u5b9d\u4e1a\u52a1\u573a\u666f\uff0c\u6240\u4ee5\u5728\u5c5e\u6027\u4e0a\u4e5f\u662f\u504f\u7269\u8054\u7f51\u65b9\u5411\u3002\\n\\n\u4ece\u4e1a\u52a1\u5c42\u9762\u51fa\u53d1\uff0c\u6211\u4eec\u4e5f\u8fd8\u6709\u4e00\u4e9b\u91cd\u8981\u4e1a\u52a1\u6bd4\u5982 MQTT \u7c7b\u578b\u7684\u5e94\u7528\u3002\u76ee\u524d\u5b83\u4eec\u5728\u5bb9\u5668\u5185\u8fd8\u662f\u4ee5 SLB \u6a21\u5f0f\u53bb\u66b4\u9732\u7684\uff0c\u5e0c\u671b\u540e\u7eed\u4e5f\u53ef\u4ee5\u63a5\u5165\u5230\u6574\u4e2a Apache APISIX \u96c6\u7fa4\u91cc\u3002\\n\\n\u4ece\u524d\u7aef\u5c42\u9762\u6765\u8bb2\uff0c\u76ee\u524d\u7684\u524d\u7aef\u5e94\u7528\u8fd8\u662f\u90e8\u7f72\u5728\u5bb9\u5668\u91cc\uff0c\u540e\u7eed\u6211\u4eec\u4e5f\u6253\u7b97\u5c06\u524d\u7aef\u5e94\u7528\u76f4\u63a5\u63a5\u5165 Apache APISIX\uff0c\u901a\u8fc7 Proxy Rewrite \u63d2\u4ef6\u529f\u80fd\u76f4\u63a5\u6307\u5411\u6211\u4eec\u7684\u963f\u91cc\u4e91 OSS \u57df\u540d\u3002\u8fd9\u6837\u53ef\u4ee5\u8282\u7701\u5bb9\u5668\u90e8\u7f72\u7684\u8d44\u6e90\uff0c\u8fdb\u884c\u66f4\u65b9\u4fbf\u5730\u7ba1\u7406\u3002\\n\\n\u5728\u5bf9 Apache APISIX \u9879\u76ee\u4e0a\uff0c\u6211\u4eec\u7ecf\u8fc7\u5b9e\u8df5\u90e8\u7f72\u4e5f\u4ea7\u751f\u4e86\u4e00\u4e9b\u6539\u8fdb\u9700\u6c42\uff0c\u5e0c\u671b\u540e\u7eed Apache APISIX \u7684\u7248\u672c\u66f4\u8fed\u4e2d\u53ef\u4ee5\u8fdb\u884c\u76f8\u5173\u529f\u80fd\u7684\u652f\u6301\u6216\u5b8c\u5584\u3002\u6bd4\u5982\uff1a\\n\\n1. \u6280\u672f\u7ba1\u7406\u5c42\u9762\u8fdb\u884c\u591a\u96c6\u7fa4\u529f\u80fd\u7684\u6dfb\u52a0\\n2. \u5f00\u53d1\u5c42\u9762\u8fdb\u884c\u66f4\u7ec6\u7c92\u5ea6\u7684\u7528\u6237\u6743\u9650\u7ba1\u7406\\n3. \u529f\u80fd\u5c42\u9762\u652f\u6301 SSL \u8bc1\u4e66\u6eda\u52a8\u66f4\u65b0\\n4. Apache APISIX-Ingress-Controller \u76f8\u5173\u4e1a\u52a1\u63a5\u5165"},{"id":"APISIX \u5728\u817e\u8baf\u4e91\u667a\u80fd\u949b\u5e73\u53f0\u7684\u843d\u5730\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2021/09/16/tencent-cloud","source":"@site/blog/2021/09/16/tencent-cloud.md","title":"APISIX \u5728\u817e\u8baf\u4e91\u667a\u80fd\u949b\u5e73\u53f0\u7684\u843d\u5730\u5b9e\u8df5","description":"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u817e\u8baf\u4e91\u667a\u80fd\u949b\u5e73\u53f0\u4f7f\u7528\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684\u4f01\u4e1a\u6848\u4f8b\uff0c\u4ee5\u53ca\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u4ea7\u54c1\u6d41\u91cf\u7f51\u5173\u7684\u5177\u4f53\u793a\u4f8b\u3002","date":"2021-09-16T00:00:00.000Z","formattedDate":"2021\u5e749\u670816\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":9.085,"truncated":true,"authors":[{"name":"\u5201\u5bff\u94a7"}],"prevItem":{"title":"Apache APISIX \u52a9\u529b\u4fbf\u5229\u5145\u7535\u521b\u9886\u8005\u5c0f\u7535\uff0c\u5b9e\u73b0\u4e91\u539f\u751f\u65b9\u6848","permalink":"/zh/blog/2021/09/18/xiaodian-usercase"},"nextItem":{"title":"\u793e\u533a\u5468\u62a5\uff5c\u793e\u533a\u6301\u7eed\u6d3b\u8dc3\uff0c\u529f\u80fd\u4eae\u70b9\u66f4\u65b0\u8fdb\u884c\u4e2d","permalink":"/zh/blog/2021/09/15/weekly-report"}},"content":"> \u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u817e\u8baf\u4e91\u667a\u80fd\u949b\u5e73\u53f0\u4f7f\u7528 Apache APISIX \u7684\u4f01\u4e1a\u6848\u4f8b\uff0c\u4ee5\u53ca\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u4ea7\u54c1\u6d41\u91cf\u7f51\u5173\u7684\u5177\u4f53\u4f8b\u5b50\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u4ecb\u7ecd\\n\\n\u817e\u8baf\u4e91\u667a\u80fd\u949b\u673a\u5668\u5b66\u4e60\u5e73\u53f0\uff08TI-ONE\uff09\u662f\u4e3a AI \u5de5\u7a0b\u5e08\u6253\u9020\u7684\u4e00\u7ad9\u5f0f\u673a\u5668\u5b66\u4e60\u670d\u52a1\u5e73\u53f0\uff0c\u4e3a\u7528\u6237\u63d0\u4f9b\u4ece\u6570\u636e\u9884\u5904\u7406\u3001\u6a21\u578b\u6784\u5efa\u3001\u6a21\u578b\u8bad\u7ec3\u5230\u6a21\u578b\u8bc4\u4f30\u7684\u5168\u6d41\u7a0b\u5f00\u53d1\u652f\u6301\u3002\u667a\u80fd\u949b\u673a\u5668\u5b66\u4e60\u5e73\u53f0\u5185\u7f6e\u4e30\u5bcc\u7684\u7b97\u6cd5\u7ec4\u4ef6\uff0c\u652f\u6301\u591a\u79cd\u7b97\u6cd5\u6846\u67b6\uff0c\u6ee1\u8db3\u591a\u79cd AI \u5e94\u7528\u573a\u666f\u7684\u9700\u6c42\u3002\\n\\n![\u817e\u8baf\u4e91\u667a\u80fd\u949b\u673a\u5668\u5b66\u4e60\u5e73\u53f0\u67b6\u6784\u56fe](https://static.apiseven.com/202108/1631781110822-39c59a83-aa18-4934-a2ef-43cd58866878.jpg)\\n\\n## \u4ea7\u54c1\u9700\u6c42\\n\\n\u6211\u4eec\u5c06\u9700\u6c42\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a\u6280\u672f\u9700\u6c42\uff0c\u5373\u7814\u53d1\u56e2\u961f\u5bf9\u4e8e API \u7f51\u5173\u7684\u9700\u6c42\uff1b\u4e1a\u52a1\u9700\u6c42\uff0c\u5373\u667a\u80fd\u949b\u673a\u5668\u5b66\u4e60\u5e73\u53f0\u4f7f\u7528\u8005\u5bf9\u4e8e API \u7f51\u5173\u7684\u9700\u6c42\u3002\\n\\n\u6280\u672f\u5c42\u9762\u4e3b\u8981\u9700\u6c42\u4e3a\u5177\u5907\u8de8\u6a2a\u5207\u9762\u529f\u80fd\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u662f\u5c06\u9274\u6743\u3001\u9650\u6d41\u3001\u65e5\u5fd7\u3001\u76d1\u63a7\u7b49\u8de8\u6a2a\u5207\u9762\u7684\u529f\u80fd\u5185\u805a\u5230 API \u7f51\u5173\uff0c\u5bf9\u540e\u7aef\u670d\u52a1\u8fdb\u884c\u89e3\u8026\uff0c\u4f7f\u7814\u53d1\u805a\u7126\u529f\u80fd\u5f00\u53d1\uff0c\u5e76\u4e14\u964d\u4f4e\u7ef4\u62a4\u6210\u672c\u3002\\n\\n\u8003\u8651\u5230\u540e\u7eed\u4e1a\u52a1\u5bf9\u63a5\u817e\u8baf\u4e91\u7684\u9700\u6c42\uff0cAPI \u7f51\u5173\u5fc5\u987b\u652f\u6301\u817e\u8baf\u5b9a\u5236\u7684\u9274\u6743\u548c\u767b\u5f55\u673a\u5236\u4ee5\u53ca\u9075\u5b88\u817e\u8baf\u4e91 API 3.0 \u7684\u683c\u5f0f\u3002\\n\\n![\u817e\u8baf\u4e91\u7f51\u5173\u6280\u672f\u9700\u6c42](https://static.apiseven.com//2021/0916/20210916-200723.jpg)\\n\\n\u4e1a\u52a1\u5c42\u9762\u5219\u4e3b\u8981\u8003\u8651\u4f7f\u7528\u8005\u611f\u53d7\u3002\u5e73\u53f0\u8fdb\u884c\u5f00\u53d1\u65f6\uff0cAI \u548c\u7b97\u6cd5\u540c\u4e8b\u9700\u8981\u4ea4\u4e92\u5f0f\u7f16\u7a0b\u73af\u5883\uff0c\u90a3\u4e48\u5c31\u9700\u8981 API \u7f51\u5173\u652f\u6301 Notebook\u3002\u5b8c\u6210\u90e8\u7f72\u540e\uff0cAPI \u7f51\u5173\u9700\u8981\u5177\u6709\u6d41\u91cf\u5206\u914d\u529f\u80fd\u548c\u8db3\u591f\u9ad8\u7684\u6027\u80fd\uff0c\u6ee1\u8db3\u591a\u7528\u6237\u76f4\u63a5\u8c03\u7528\u63a5\u53e3\u7684\u573a\u666f\u3002\u8fd8\u9700\u652f\u6301\u8bf7\u6c42\u7ea7\u522b\u7684\u76d1\u63a7\uff0c\u5305\u62ec\u65e5\u5fd7\uff08Logging\uff09\u76d1\u63a7\u548c\u6307\u6807\uff08Metrics\uff09\u76d1\u63a7\u3002\\n\\n\u7efc\u5408\u4ee5\u4e0a\u9700\u6c42\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u76f8\u5173\u7f51\u5173\u4ea7\u54c1\u7684\u8c03\u7814\u3002\\n\\n![\u817e\u8baf\u4e91\u7f51\u5173\u9009\u578b\u8003\u91cf](https://static.apiseven.com/202108/1631781748143-8e30a89c-99b8-45ed-b6e6-1dddaa838342.jpg)\\n\\n## \u8c03\u7814\u5bf9\u6bd4\\n\\n\u8fdb\u5165\u6211\u4eec\u8003\u5bdf\u540d\u5355\u7684\u6709\uff1aEnvoy\u3001Kong \u4ee5\u53ca Apache APISIX\u3002\u6211\u4eec\u4ece\u591a\u7ef4\u5ea6\u5bf9\u4e0a\u8ff0\u4e09\u4e2a\u4ea7\u54c1\u8fdb\u884c\u4e86\u5bf9\u6bd4\uff0c\u7ed3\u679c\u5982\u4e0b\u3002\\n\\n![\u7ade\u54c1\u5206\u6790\u4e0e\u5bf9\u6bd4](https://static.apiseven.com/202108/1631781764958-a2cadf83-80b4-4b50-ba42-76b21d0d211a.jpg)\\n\\n\u56e0\u4e3a Envoy \u7684\u6280\u672f\u6808\u662f C++\uff0c\u9700\u8981\u5b9a\u4f4d\u95ee\u9898\u65f6\uff0c\u5f88\u53ef\u80fd\u8981\u53bb\u770b C++ \u7684\u6e90\u4ee3\u7801\u3002\u8fd9\u79cd\u5b9a\u4f4d\u95ee\u9898\u53ef\u80fd\u4f1a\u5bf9\u6211\u4eec\u9020\u6210\u4e00\u5b9a\u7684\u5f71\u54cd\uff0c\u6240\u4ee5 Envoy \u8fd9\u4e2a\u65b9\u6848\u5426\u51b3\u5f97\u6bd4\u8f83\u65e9\u3002\\n\\nKong \u548c Apache APISIX \u6240\u4f7f\u7528\u7684\u6280\u672f\u6808\u76f8\u540c\uff0c\u90fd\u662f OpenResty\u3002\u4f46\u662f\u5728\u5b58\u50a8\u4f9d\u8d56\u8fd9\u4e00\u680f\uff0cKong \u4f9d\u8d56\u7684\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93 PostgreSQL\u3002\u5728\u8f6f\u4ef6\u884c\u4e1a\uff0c\u6570\u636e\u5e93\u7684\u9ad8\u53ef\u7528\u914d\u7f6e\u662f\u975e\u5e38\u590d\u6742\u7684\u3002\u4e0d\u4ec5\u9700\u8981\u914d\u5907\u4e13\u95e8\u7684 DBA\uff0c\u800c\u4e14\u5b9e\u65bd\u96be\u5ea6\u4e5f\u975e\u5e38\u5927\u3002\u5173\u7cfb\u578b\u6570\u636e\u5e93\u592a\u91cd\u4e86\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u4f7f\u7528\u5173\u7cfb\u578b\u6570\u636e\u5e93\u6765\u4fdd\u8bc1 ACID \u548c MVCC\u3002\\n\\n### \u4e3a\u4ec0\u4e48\u9009\u62e9\u4e86 Apache APISIX\\n\\nApache APISIX \u5728\u5b58\u50a8\u4f9d\u8d56\u548c\u8def\u7531\u89c4\u5219\u8fd9\u4e24\u65b9\u9762\u505a\u7684\u975e\u5e38\u597d\uff0c\u5f88\u9002\u5408\u6211\u4eec\u7684\u4e1a\u52a1\u573a\u666f\u3002\u6211\u4eec\u7684\u4e1a\u52a1\u6bd4\u8f83\u770b\u91cd\u8def\u7531\u7075\u6d3b\u5ea6\u548c\u8def\u7531\u5339\u914d\u7b97\u6cd5\u3002\u76ee\u524d\u5df2\u63a5\u5165 50 \u591a\u4e2a\u4e0a\u6e38\u548c\u6570\u767e\u6761\u8def\u7531\u89c4\u5219\uff0c\u6240\u4ee5\u6211\u4eec\u5e0c\u671b\u8def\u7531\u5339\u914d\u7684\u6027\u80fd\u8d8a\u9ad8\u8d8a\u597d\u3002Apache APISIX \u8def\u7531\u5339\u914d\u7b97\u6cd5\u590d\u6742\u5ea6\u660e\u663e\u4f18\u4e8e Kong\uff0c\u4e14\u914d\u7f6e\u751f\u6548\u65f6\u95f4\u5c0f\u4e8e 1ms\uff0c\u5355\u6838 QPS \u8fdc\u9ad8\u4e8e Kong\u3002\u7efc\u5408\u4ee5\u4e0a\u6280\u672f\u548c\u64cd\u4f5c\u5c42\u9762\uff0c\u6211\u4eec\u6700\u7ec8\u9009\u62e9\u4e86 Apache APISIX\u3002\\n\\n## \u57fa\u4e8e Apache APISIX \u7684\u67b6\u6784\u8c03\u6574\\n\\n\u63a5\u5165 Apache APISIX \u540e\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u667a\u80fd\u949b\u673a\u5668\u5b66\u4e60\u5e73\u53f0\u7f51\u5173\u65b9\u9762\u7684\u529f\u80fd\uff0c\u89e3\u51b3\u4e86\u4e4b\u524d\u5173\u4e8e\u6280\u672f\u548c\u4e1a\u52a1\u5c42\u9762\u7684\u9700\u6c42\u3002\\n\\n\u4ece\u8fd9\u5f20\u56fe\u53ef\u4ee5\u770b\u5230\uff0c Apache APISIX \u652f\u6301 http+pb\u3001http+json\u3001gRPC\u3001WebSocket \u7b49\u6d41\u91cf\u3002\u8fd9\u4e9b\u6d41\u91cf\u7ecf\u8fc7\u4e86 Apache APISIX \u4e4b\u540e\uff0c\u4f1a\u8d70\u5411\u667a\u80fd\u949b\u673a\u5668\u5b66\u4e60\u5e73\u53f0\u5b9a\u5236\u5f00\u53d1\u7684\u4e00\u4e9b\u7ec4\u4ef6\u3002\\n\\n![\u7f51\u5173\u67b6\u6784](https://static.apiseven.com/202108/1631781850656-4235a4e8-2792-48ae-9c98-b4d75628a476.jpg)\\n\\n\u667a\u80fd\u949b\u673a\u5668\u5b66\u4e60\u5e73\u53f0\u7684\u4e1a\u52a1\u90e8\u7f72\u5728\u817e\u8baf\u4e91 TKE \u5e73\u53f0\u4e0a\u3002\u4e3a\u4e86\u63d0\u9ad8\u5b83\u7684\u53ef\u7528\u6027\uff0c\u7f51\u5173\u3001 etcd \u7b49\u90fd\u662f\u96c6\u7fa4\u5316\u7684\u90e8\u7f72\u3002\u667a\u80fd\u949b\u673a\u5668\u5b66\u4e60\u5e73\u53f0\u6ca1\u6709\u4f7f\u7528 Apache APISIX \u7684 dashboard\uff0c\u800c\u662f\u76f4\u63a5\u901a\u8fc7 Admin API \u8fdb\u884c\u4ea4\u4e92\uff0c\u76f4\u63a5\u5199\u5230 etcd \u91cc\u9762\u3002\\n\\n![\u589e\u52a0\u63d2\u4ef6\u5904\u7406](https://static.apiseven.com/202108/1631781876752-faf1b7d0-abbb-4313-879c-e00d2b28334a.jpg)\\n\\n## \u5b9e\u4f8b\u5206\u4eab\\n\\n\u5728\u5b9e\u6218\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u603b\u7ed3\u4e86\u4e00\u4e9b\u4f7f\u7528 Nginx \u7684\u5751\uff0c\u4e5f\u53d1\u73b0\u4e86\u4e00\u4e9b APISIX \u7684\u4f18\u70b9\uff0c\u5728\u6b64\u7b80\u5355\u5206\u4eab\u4e00\u4e0b\u3002\\n\\n### \u53cd\u76f4\u89c9\u7684 Nginx \u914d\u7f6e\\n\\n\u4ee5\u524d\u4f7f\u7528 Nginx \u7684\u65f6\u5019\uff0c\u611f\u89c9 Nginx \u662f\u4e00\u4e2a\u914d\u7f6e\u9a71\u52a8\u7684\u4ea7\u54c1\u3002\u53ef\u80fd\u4f1a\u9020\u6210\u7ba1\u7406\u56f0\u96be\u3001\u7ef4\u62a4\u6210\u672c\u9ad8\u7b49\u56f0\u6270\u3002Nginx \u5728\u914d\u7f6e\u7ba1\u7406\u7684\u65f6\u5019\uff0c\u5e38\u5e38\u4f1a\u6709\u4e00\u4e9b\u53cd\u76f4\u89c9\u7684\u4e8b\u60c5\u3002\u5728\u8fd9\u6b21\u5b9e\u6218\u8fc7\u7a0b\u4e2d\uff0c\u6211\u7684\u540c\u4e8b\u5c31\u9047\u5230\u8fd9\u4e48\u4e00\u4e2a\u53cd\u76f4\u89c9\u7684\u5751\uff1a\\n\\n![Nginx \u914d\u7f6e\u9519\u8bef](https://static.apiseven.com/202108/1631781909354-0fada4fa-1154-4974-ae3d-292ab46e5889.jpg)\\n\\n\u5bf9\u4e8e\u63a5\u89e6 Nginx \u6bd4\u8f83\u5c11\u7684\u4eba\u6765\u8bf4\uff0c\u8fd9\u4e24\u884c\u547d\u4ee4\u52a0\u5728 `if` \u524d\u9762\uff0c\u4e14 `if` \u91cc\u9762\u5e76\u6ca1\u6709\u5176\u4ed6\u547d\u4ee4\u8986\u76d6\u8fd9\u4e24\u884c\u547d\u4ee4\uff0c\u90a3\u4e48\u5b83\u4eec\u662f\u5fc5\u7136\u4f1a\u88ab\u6267\u884c\u7684\u3002\u719f\u6089 Nginx \u7684\u4eba\u90fd\u77e5\u9053\uff0c`if` \u91cc\u9762\u7684\u547d\u4ee4\u4f1a\u8986\u76d6\u6389\u5916\u9762\u7684\u547d\u4ee4\uff0c\u4f46\u8fd9\u975e\u5e38\u53cd\u76f4\u89c9\u3002\\n\\n### \u6d4b\u8bd5\u7528\u4f8b\u5373\u6587\u6863\\n\\n\u5728\u5b9e\u8df5\u4f7f\u7528 Apache APISIX \u5b9e\u8df5\u7684\u8fc7\u7a0b\u4e2d\uff0cApache APISIX \u9879\u76ee\u7684\u6d4b\u8bd5\u7528\u4f8b\u5199\u7684\u975e\u5e38\u8be6\u7ec6\u3002\u5373\u4f7f\u6ca1\u6709\u6df1\u5165\u4e86\u89e3\u8fc7\u5982\u4f55\u5728 Apache APISIX \u4e2d\u8c03\u7528\u67d0\u4e9b\u51fd\u6570\uff0c\u4e5f\u5f80\u5f80\u80fd\u5728\u6d4b\u8bd5\u7528\u4f8b\u4e2d\u627e\u5230\u7b54\u6848\u3002\u540e\u6765\u518d\u9047\u5230\u4e00\u4e9b OpenResty \u7684\u95ee\u9898\u7684\u65f6\u5019\uff0c\u6211\u5c31\u4f1a\u5230\u8fd9\u4e9b\u6d4b\u8bd5\u7528\u4f8b\u91cc\u9762\u627e\u4e00\u627e\u6709\u6ca1\u6709\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u6bcf\u6b21\u90fd\u80fd\u89e3\u51b3\u95ee\u9898\u3002\\n\\n![\u8be6\u7ec6\u7684\u6d4b\u8bd5\u7528\u4f8b](https://static.apiseven.com/202108/1631781920390-a504ce7c-1ccd-4fb8-99a2-09d74be6bb7e.jpg)\\n\\n## \u601d\u8003\u4e0e\u5c55\u671b\\n\\n\u5728\u6280\u672f\u9009\u578b\u7684\u521d\u671f\uff0c\u9664\u4e86 Envoy\u3001Kong \u548c Apache APISIX \u5916\uff0c\u4e5f\u6709\u540c\u4e8b\u63d0\u5230\u4e86 Service Mesh\u3002\u6709\u4e86 Service Mesh\uff0c\u4e3a\u4ec0\u4e48\u6211\u4eec\u8fd8\u8981\u9009\u62e9 Apache APISIX\uff0c\u8fd9\u96be\u9053\u4e0d\u662f\u5728\u6280\u672f\u4e0a\u5012\u9000\u5417\uff1f\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u7684\u89c2\u70b9\u662f\u8fd9\u6837\u7684\uff1a\\n\\n1. API \u7f51\u5173\u5728\u7cfb\u7edf\u8fb9\u754c\uff0c\u8d1f\u8d23\u5904\u7406\u5357\u5317\u5411\u6d41\u91cf\uff1bService Mesh \u5728\u96c6\u7fa4\u5185\u90e8\uff0c\u8d1f\u8d23\u5904\u7406\u4e1c\u897f\u5411\u6d41\u91cf\u3002\u4e24\u8005\u7684\u529f\u80fd\u4e0d\u540c\uff0c\u65e0\u6cd5\u76f4\u63a5\u6bd4\u8f83\u3002\\n2. \u5b9e\u8df5\u8bc1\u660e Service Mesh \u5b58\u5728\u4e00\u4e9b\u6027\u80fd\u635f\u8017\u3002\u4f46\u662f\u4e5f\u6709\u4e00\u79cd\u58f0\u97f3\u8bf4\uff0c\u4e0a\u4e91\u4e86\uff0c\u8fd9\u70b9\u635f\u8017\u53ef\u80fd\u5e76\u4e0d\u662f\u4e1a\u52a1\u7684\u6027\u80fd\u74f6\u9888\uff0c\u6240\u4ee5\u8fd9\u70b9\u662f\u89c1\u4ec1\u89c1\u667a\u7684\u3002\\n3. \u5f97\u76ca\u4e8e OpenResty \u548c Lua \u7b80\u5355\u6613\u4e0a\u624b\u7684\u7279\u6027\uff0cApache APISIX \u7684\u5b9a\u5236\u7814\u53d1\u6548\u7387\u66f4\u9ad8\u3002 \u5373\u4f7f\u5f00\u53d1\u56e2\u961f\u5148\u524d\u6ca1\u6709\u4f7f\u7528 OpenResty \u6216\u8005 Lua \u7684\u5f00\u53d1\u7ecf\u9a8c\uff0c\u4ecd\u7136\u80fd\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u5185\u5b8c\u6210\u4e86\u4e1a\u52a1\u7684\u5b9a\u5236\u5f00\u53d1\u9700\u6c42\u3002\\n4. Apache APISIX \u7684\u4ea4\u4ed8\u6210\u672c\u8981\u4f4e\u4e8e Service Mesh\u3002\u56e0\u4e3a Istio \u793e\u533a\u975e\u5e38\u6d3b\u8dc3\uff0c\u7248\u672c\u8fed\u4ee3\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u5bfc\u81f4 Istio \u7684\u5404\u4e2a\u7248\u672c\u548c Kubernetes \u7684\u5404\u4e2a\u7248\u672c\u4e4b\u95f4\u6709\u4e0d\u517c\u5bb9\u7684\u95ee\u9898\u3002\u5728\u5ba2\u6237\u7684\u751f\u4ea7\u73af\u5883\u4e2d\uff0c \u4e00\u4e9b Kubernetes \u96c6\u7fa4\u53ef\u80fd\u6709\u7248\u672c\u5dee\u5f02\uff0c\u800c\u8fd9\u4e9b Kubernetes \u96c6\u7fa4\u65e0\u6cd5\u5171\u7528\u4e00\u4e2a\u7248\u672c\u7684 Istio\uff0c\u8fd9\u5728\u5b9e\u9645\u4ea4\u4ed8\u7684\u8fc7\u7a0b\u4e2d\u662f\u4f1a\u9020\u6210\u4e00\u4e9b\u56f0\u6270\u3002\\n\\n## \u4e2a\u4eba\u671f\u671b\\n\\n\u611f\u8c22 Apache APISIX \u521b\u9020\u4e86\u4e00\u6b3e\u6027\u80fd\u6781\u81f4\u800c\u4e14\u6613\u4e8e\u4e0a\u624b\u7684\u5f00\u6e90 API \u7f51\u5173\u4ea7\u54c1\u3002\u5728\u667a\u80fd\u949b\u673a\u5668\u5b66\u4e60\u5e73\u53f0\u7f51\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u5e0c\u671b\u540e\u7eed\u53ef\u4ee5\u5728\u5b9e\u8df5\u4e2d\u603b\u7ed3\u51fa\u66f4\u591a\u7684\u4f7f\u7528\u5fc3\u5f97\uff0c\u53cd\u9988\u7ed9 Apache APISIX \u793e\u533a\u3002"},{"id":"\u793e\u533a\u5468\u62a5\uff5c\u793e\u533a\u6301\u7eed\u6d3b\u8dc3\uff0c\u529f\u80fd\u4eae\u70b9\u66f4\u65b0\u8fdb\u884c\u4e2d","metadata":{"permalink":"/zh/blog/2021/09/15/weekly-report","source":"@site/blog/2021/09/15/weekly-report.md","title":"\u793e\u533a\u5468\u62a5\uff5c\u793e\u533a\u6301\u7eed\u6d3b\u8dc3\uff0c\u529f\u80fd\u4eae\u70b9\u66f4\u65b0\u8fdb\u884c\u4e2d","description":"Apache APISIX \u793e\u533a\u6700\u8fd1\u4e24\u5468\u65b0\u589e\u4e86 proxy-mirror \u652f\u6301\u6309\u6bd4\u4f8b\u955c\u50cf\u8bf7\u6c42\u3001Admin API \u652f\u6301\u8fd4\u56de stream \u7c7b\u578b\u7684\u63d2\u4ef6\u4fe1\u606f\u3001dashboard \u652f\u6301 Service Discovery \u914d\u7f6e\u7b49\u529f\u80fd\u3002","date":"2021-09-15T00:00:00.000Z","formattedDate":"2021\u5e749\u670815\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":6.365,"truncated":true,"authors":[],"prevItem":{"title":"APISIX \u5728\u817e\u8baf\u4e91\u667a\u80fd\u949b\u5e73\u53f0\u7684\u843d\u5730\u5b9e\u8df5","permalink":"/zh/blog/2021/09/16/tencent-cloud"},"nextItem":{"title":"APISIX \u5728\u6709\u8d5e\u4e91\u539f\u751f PaaS \u5e73\u53f0\u7684\u5e94\u7528\u5b9e\u8df5","permalink":"/zh/blog/2021/09/14/youzan"}},"content":"> \u4ece 8.30 \u5f00\u59cb\u8fd9\u4e24\u5468\u6709 33 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 130 \u4e2a commits\u3002\u611f\u8c22\u4ee5\u4e0b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff08\u6392\u540d\u4e0d\u5206\u5148\u540e\uff09\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue \uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n\u4ece 8.30-9.12 \u8fd9\u4e24\u5468\u6709 33 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 130 \u4e2a commits\u3002\u611f\u8c22\u4ee5\u4e0b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff08\u6392\u540d\u4e0d\u5206\u5148\u540e\uff09\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u9879\u76ee\u53d8\u5f97\u66f4\u597d\uff01\\n\\n![contributor](https://static.apiseven.com/202108/1631754498946-7d655f8e-3881-4594-b029-a67189a63ffa.jpg)\\n\\n![committer](https://static.apiseven.com/202108/1631676136968-13216876-e9f6-4852-95b4-6f73db5cb405.30-9)\\n\\n## Good first issue\\n\\n### Issue [#4906](https://github.com/apache/apisix/issues/4906)\\n\\n\u95ee\u9898\u63cf\u8ff0\uff1a\u5728\u542f\u7528\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u529f\u80fd\u65f6\uff0c\u7528\u4e24\u4e2a\u5185\u90e8\u57df\u540d\u5e76\u589e\u52a0 pass_host\uff1anode \u8fdb\u884c\u6d4b\u8bd5 Apache APISIX \u7684\u8d1f\u8f7d\u5747\u8861\u65f6\uff0c\u53d1\u73b0\u4ecd\u4f1a\u8def\u7531\u5230\u6545\u969c\u4e3b\u673a\u3002\\n\\n```Shell\\nfor i in $(seq 1 1000); do curl  -H \\"Host: httpbin.org\\" ${APISIX_GATEWAY_URL}  ; done\\napple\\napple\\n<html>\\n<head><title>503 Service Temporarily Unavailable</title></head>\\n<body>\\n<center><h1>503 Service Temporarily Unavailable</h1></center>\\n<hr><center>nginx/1.17.7</center>\\n</body>\\n</html>\\napple\\napple\\napple\\n<html>\\n<head><title>503 Service Temporarily Unavailable</title></head>\\n<body>\\n<center><h1>503 Service Temporarily Unavailable</h1></center>\\n<hr><center>nginx/1.17.7</center>\\n</body>\\n</html>\\napple\\napple\\napple\\napple\\napple\\n```\\n\\n### Issue [#4945](https://github.com/apache/apisix/issues/4945)\\n\\n\u95ee\u9898\u63cf\u8ff0\uff1a\u6839\u636e\u76f8\u5173\u6307\u5bfc\u6587\u7ae0\uff0c\u5c1d\u8bd5\u5728 M1 \u7cfb\u7edf\u7684 Macbook \u4e0a\u4e0b\u8f7d Apache APISIX 2.9 \u7248\u672c\u65f6\u9047\u5230\u95ee\u9898\u3002\u63d0\u793a\u5982\u4e0b\uff1a\\n\\n```Apache\\nlualogging 1.5.2-1 depends on luasocket (3.0rc1-2 installed)\\nlualogging 1.5.2-1 is now installed in /Users/juzhiyuan/workspace/apisix-2.9/apache-apisix-2.9-src/deps (license: MIT/X11)\\n\\ncasbin 1.26.0-1 depends on lrexlib-pcre >= 2.9.1 (not installed)\\nInstalling https://luarocks.org/lrexlib-pcre-2.9.1-1.src.rock\\n\\nError: Failed installing dependency: https://luarocks.org/casbin-1.26.0-1.rockspec - Failed installing dependency: https://luarocks.org/lrexlib-pcre-2.9.1-1.src.rock - Could not find header file for PCRE\\n  No file pcre.h in /usr/local/include\\n  No file pcre.h in /usr/include\\n  No file pcre.h in /include\\nYou may have to install PCRE in your system and/or pass PCRE_DIR or PCRE_INCDIR to the luarocks command.\\nExample: luarocks install lrexlib-pcre PCRE_DIR=/usr/local\\nmake: *** [deps] Error 1\\n```\\n\\n## \u8fd1\u671f\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- [referer-restriction \u652f\u6301\u914d\u7f6e blacklist \u548c message](https://github.com/apache/apisix/pull/4916)(\u8d21\u732e\u8005\uff1aokaybase)\\n- [node_listen \u548c admin_listen \u652f\u6301\u66f4\u4e30\u5bcc\u7684\u914d\u7f6e\u5f62\u5f0f](https://github.com/apache/apisix/pull/4856)(\u8d21\u732e\u8005\uff1awayne-cheng)\uff0c[\u8865\u5145\u53c2\u8003](https://github.com/apache/apisix/pull/4967)\\n- [admin-api \u652f\u6301\u8fd4\u56de stream \u7c7b\u578b\u7684\u63d2\u4ef6\u4fe1\u606f](https://github.com/apache/apisix/pull/4947)(\u8d21\u732e\u8005\uff1aspacewander)\\n- [\u652f\u6301\u914d\u7f6e\u540e\u9000 SNI](https://github.com/apache/apisix/pull/5000)(\u8d21\u732e\u8005\uff1aspacewander)\\n- [proxy-mirror \u652f\u6301\u6309\u6bd4\u4f8b\u955c\u50cf\u8bf7\u6c42](https://github.com/apache/apisix/pull/4965)(\u8d21\u732e\u8005\uff1aokaybase)\\n- [Control API \u65b0\u589e dump \u8def\u7531\u914d\u7f6e](https://github.com/apache/apisix/pull/5011)(\u8d21\u732e\u8005\uff1aZheaoli)\\n- [dashboard \u652f\u6301 Service Discovery \u914d\u7f6e](https://github.com/apache/apisix-dashboard/pull/2081)(\u8d21\u732e\u8005\uff1abzp2010)\\n- [dashboard Route \u9ad8\u7ea7\u914d\u7f6e\u6761\u4ef6\u4e2d\u652f\u6301\u5185\u7f6e\u53c2\u6570\u914d\u7f6e](https://github.com/apache/apisix-dashboard/pull/1984)(\u8d21\u732e\u8005\uff1alookbrook)\\n- [dashboard Upstream \u652f\u6301 Keepalive Pool \u914d\u7f6e](https://github.com/apache/apisix-dashboard/pull/2117)(\u8d21\u732e\u8005\uff1abzp2010)\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u548c Github \u4e0a\u7684 issue \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u8fd1\u671f\u535a\u6587\u63a8\u8350\\n\\n- [Apache APISIX \u793e\u533a\u5468\u62a5 \uff5c 2021 8.23-8.29](https://mp.weixin.qq.com/s?__biz=MzI1MDU3NjQ5OA==&mid=2247486808&idx=1&sn=16ff09d4172dc61e0aa864f7a4fd40fd&chksm=e9816645def6ef53c5e41d84e70e16256a1953c177c52d960331c7ecd836cf8eeedf83bee5e4&token=733405538&lang=zh_CN%23rd)\\n\\n  \u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n- [Apache APISIX \u4e3a KubeSphere \u63d0\u4f9b\u66f4\u597d\u7528\u7684\u7f51\u5173\u53ca K8S Ingress Controller](https://mp.weixin.qq.com/s?__biz=MzI1MDU3NjQ5OA==&mid=2247487079&idx=1&sn=136417f538c1d2d96150cfd3de66b93b&chksm=e981657adef6ec6c31ea990ec3f8887b22530dc44e6cf011c990449aea492cc3d8379668e1d6&token=733405538&lang=zh_CN%23rd)\\n\\n  \u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 KubeSphere \u4e2d\u76f4\u63a5\u90e8\u7f72 APISIX \u548c APISIX Ingress Controller \u3002APISIX \u53ef\u901a\u8fc7\u4f5c\u4e3a\u7f51\u5173\uff0c\u6216 APISIX Ingress Controller \u7684\u6570\u636e\u9762\u6765\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u3002\\n\\n- [\u542c\u8bf4\u4f60\u5bf9 Apache APISIX \u6709\u8bdd\u8bf4\uff1f\u73b0\u5728\u673a\u4f1a\u6765\u4e86](https://mp.weixin.qq.com/s?__biz=MzI1MDU3NjQ5OA==&mid=2247487094&idx=1&sn=c86ff723205b6073811a4d9016e81bca&chksm=e981656bdef6ec7dffb2d11639af944f0a4ebc9db051c0dd940d8e7f1b8b6ae42fb8690859c0&token=733405538&lang=zh_CN%23rd)\\n\\n  \u8bda\u9080\u60a8\u53c2\u4e0e Apache APISIX \u7528\u6237\u8c03\u7814\uff0c\u60a8\u7684\u53cd\u9988\u4f1a\u76f4\u63a5\u5f71\u54cd\u6211\u4eec\u7684\u672a\u6765\u53d1\u5c55\u3002\u6211\u4eec\u4f1a\u968f\u673a\u62bd\u53d6 \u591a\u4f4d \u5e78\u8fd0\u661f\uff0c\u5c06\u6709\u673a\u4f1a\u83b7\u5f97 Apache APISIX \u793e\u533a\u7cbe\u7f8e\u5c0f\u793c\u7269\u54e6\uff5e\\n\\n- [\u4f7f\u7528 Apache APISIX \u548c Okta \u6765\u5b9e\u73b0\u8eab\u4efd\u8ba4\u8bc1](https://mp.weixin.qq.com/s?__biz=MzI1MDU3NjQ5OA==&mid=2247487572&idx=1&sn=4aebd05282442a7e067496e1ff4be7bd&chksm=e9817b49def6f25fee8a1308666c56878697c5ec02bb8a63d1a6ce0ba749d29a4135cdf927f0&token=733405538&lang=zh_CN%23rd)\\n\\n  \u6587\u7ae0\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Apache APISIX \u914d\u7f6e Okta \u8ba4\u8bc1\uff0c\u4ece\u4f20\u7edf\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u5207\u6362\u5230\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\uff0c\u6446\u8131\u591a\u8d26\u6237\u3001\u591a\u5bc6\u7801\u3001\u91cd\u590d\u9a8c\u8bc1\u7b49\u4f17\u591a\u5f00\u53d1\u8005\u6240\u9762\u4e34\u7684\u75db\u70b9\u3002\\n\\n## \u5173\u4e8e Apache APISIX\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u53ef\u4ee5\u5e2e\u5fd9\u4f01\u4e1a\u5feb\u901f\u3001\u5b89\u5168\u7684\u5904\u7406 API \u548c\u5fae\u670d\u52a1\u6d41\u91cf\uff0c\u5305\u62ec\u7f51\u5173\u3001Kubernetes Ingress \u548c\u670d\u52a1\u7f51\u683c\u7b49\u3002\\n\\n\u5168\u7403\u5df2\u6709\u6570\u767e\u5bb6\u4f01\u4e1a\u4f7f\u7528 Apache APISIX \u5904\u7406\u5173\u952e\u4e1a\u52a1\u6d41\u91cf\uff0c\u6db5\u76d6\u91d1\u878d\u3001\u4e92\u8054\u7f51\u3001\u5236\u9020\u3001\u96f6\u552e\u3001\u8fd0\u8425\u5546\u7b49\u7b49\uff0c\u6bd4\u5982\u7f8e\u56fd\u822a\u7a7a\u822a\u5929\u5c40\uff08NASA\uff09\u3001\u6b27\u76df\u7684\u6570\u5b57\u5de5\u5382\u3001\u4e2d\u56fd\u822a\u4fe1\u3001\u4e2d\u56fd\u79fb\u52a8\u3001\u817e\u8baf\u3001\u534e\u4e3a\u3001\u5fae\u535a\u3001\u7f51\u6613\u3001\u8d1d\u58f3\u627e\u623f\u3001360\u3001\u6cf0\u5eb7\u3001\u5948\u96ea\u7684\u8336\u7b49\u3002\\n\\n200 \u4f59\u4f4d\u8d21\u732e\u8005\uff0c\u4e00\u540c\u7f14\u9020\u4e86 Apache APISIX \u8fd9\u4e2a\u4e16\u754c\u4e0a\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u3002\u806a\u660e\u7684\u5f00\u53d1\u8005\u4eec\uff01\u5feb\u6765\u52a0\u5165\u8fd9\u4e2a\u6d3b\u8dc3\u800c\u591a\u6837\u5316\u7684\u793e\u533a\uff0c\u4e00\u8d77\u6765\u7ed9\u8fd9\u4e2a\u4e16\u754c\u5e26\u6765\u66f4\u591a\u7f8e\u597d\u7684\u4e1c\u897f\u5427\uff01\\n\\n- [Apache APISIX GitHub](https://github.com/apache/apisix)\\n- [Apache APISIX \u5b98\u7f51](https://apisix.apache.org/)\\n- [Apache APISIX \u6587\u6863](https://apisix.apache.org/zh/docs/apisix/getting-started)"},{"id":"APISIX \u5728\u6709\u8d5e\u4e91\u539f\u751f PaaS \u5e73\u53f0\u7684\u5e94\u7528\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2021/09/14/youzan","source":"@site/blog/2021/09/14/youzan.md","title":"APISIX \u5728\u6709\u8d5e\u4e91\u539f\u751f PaaS \u5e73\u53f0\u7684\u5e94\u7528\u5b9e\u8df5","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u6709\u8d5e\u4e91\u539f\u751f PaaS \u5e73\u53f0\u5982\u4f55\u4f7f\u7528\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4f5c\u4e3a\u4ea7\u54c1\u6d41\u91cf\u7f51\u5173\u7684\u5177\u4f53\u793a\u4f8b\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX\u4f5c\u4e3a\u4e1a\u52a1\u7f51\u5173\u53ca\u5176\u5e26\u6765\u7684\u597d\u5904\u3002","date":"2021-09-14T00:00:00.000Z","formattedDate":"2021\u5e749\u670814\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":11.855,"truncated":true,"authors":[{"name":"\u6234\u8bfa\u749f"}],"prevItem":{"title":"\u793e\u533a\u5468\u62a5\uff5c\u793e\u533a\u6301\u7eed\u6d3b\u8dc3\uff0c\u529f\u80fd\u4eae\u70b9\u66f4\u65b0\u8fdb\u884c\u4e2d","permalink":"/zh/blog/2021/09/15/weekly-report"},"nextItem":{"title":"APISIX \u5728\u79fb\u52a8\u4e91\u516c\u53f8\u7684\u5e94\u7528\u5b9e\u8df5","permalink":"/zh/blog/2021/09/13/china-mobile-cloud-usercase"}},"content":"> \u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u6709\u8d5e\u4e91\u539f\u751f PaaS \u5e73\u53f0\u4f7f\u7528 Apache APISIX \u7684\u4f01\u4e1a\u6848\u4f8b\uff0c\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u4ea7\u54c1\u6d41\u91cf\u7f51\u5173\u7684\u5177\u4f53\u5b9e\u4f8b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4f5c\u8005\u6234\u8bfa\u749f\uff0c\u6765\u81ea\u6709\u8d5e\u6280\u672f\u4e2d\u53f0\uff0c\u8fd0\u7ef4\u5e73\u53f0\u5f00\u53d1\u5de5\u7a0b\u5e08\\n\\n\u6709\u8d5e\u662f\u4e00\u5bb6\u4e3b\u8981\u4ece\u4e8b\u96f6\u552e\u79d1\u6280 SaaS \u670d\u52a1\u7684\u4f01\u4e1a\uff0c\u5e2e\u52a9\u5546\u5bb6\u8fdb\u884c\u7f51\u4e0a\u5f00\u5e97\u3001\u793e\u4ea4\u8425\u9500\u3001\u63d0\u9ad8\u7559\u5b58\u590d\u8d2d\uff0c\u62d3\u5c55\u5168\u6e20\u9053\u65b0\u96f6\u552e\u4e1a\u52a1\u3002\u5728\u4eca\u5e74\uff0c\u6709\u8d5e\u6280\u672f\u4e2d\u53f0\u5f00\u59cb\u8bbe\u8ba1\u5b9e\u73b0\u65b0\u7684\u4e91\u539f\u751f PaaS \u5e73\u53f0\uff0c\u5e0c\u671b\u901a\u8fc7\u4e00\u5957\u901a\u7528\u6a21\u578b\u6765\u8fdb\u884c\u5404\u79cd\u5e94\u7528\u7684\u53d1\u5e03\u7ba1\u7406\u548c\u5fae\u670d\u52a1\u76f8\u5173\u6cbb\u7406\u3002\u800c Apache APISIX \u5728\u5176\u4e2d\u8d77\u5230\u4e86\u975e\u5e38\u5173\u952e\u7684\u4f5c\u7528\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u9700\u8981\u6d41\u91cf\u7f51\u5173\\n\\n### \u6709\u8d5e OPS \u5e73\u53f0\\n\\n\u6709\u8d5e OPS \u5e73\u53f0\u662f\u524d\u671f\u57fa\u4e8e FLASK \u7684\u5355\u4f53\u5e94\u7528\uff0c\u4e3b\u8981\u4ee5\u652f\u6301\u4e1a\u52a1\u4e3a\u4e3b\u3002\u540e\u6765\u9010\u6e10\u4e0a\u7ebf\u4e86\u5f88\u591a\u4e1a\u52a1\uff0c\u90e8\u7f72\u4e86\u5f88\u591a\u4e1a\u52a1\u7aef\u4ee3\u7801\uff0c\u8fdb\u5165\u5bb9\u5668\u5316\u9636\u6bb5\u3002\u7f51\u5173\u5728\u5f53\u65f6\u53ea\u662f\u5185\u90e8 FLASK \u5e94\u7528\u7684\u4e00\u90e8\u5206\u529f\u80fd\uff0c\u4e14\u6ca1\u6709\u4e00\u4e2a\u660e\u786e\u7684\u7f51\u5173\u6982\u5ff5\uff0c\u4ec5\u4f5c\u4e3a\u4e1a\u52a1\u5e94\u7528\u7684\u6d41\u91cf\u8f6c\u53d1\u529f\u80fd\u4f7f\u7528\u3002\u4e0b\u56fe\u5c55\u793a\u7684\u5c31\u662f\u5f53\u65f6\u7684\u7f51\u5173 1.0 \u4e1a\u52a1\u7ed3\u6784\u3002\\n\\n![1.0 \u4e1a\u52a1\u7ed3\u6784](https://static.apiseven.com/202108/1631607246260-65fa3794-befc-4e84-beee-e5526085c719.png)\\n\\n\u7531\u4e8e\u524d\u671f\u6574\u4e2a\u4f53\u7cfb\u4e3b\u8981\u7740\u91cd\u4e8e\u4e1a\u52a1\u65b9\u5411\uff0c\u6240\u4ee5\u6ca1\u6709\u4ea7\u751f\u592a\u591a\u7684\u52a8\u529b\u53bb\u8fdb\u884c\u6539\u9020\u3002\u4ece 2018 \u5e74\u5f00\u59cb\uff0c\u901a\u8fc7\u5185\u90e8\u4ea4\u6d41\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u6ca1\u6709\u4e00\u4e2a\u5f88\u597d\u7684\u7f51\u5173\u5c42\u6cbb\u7406\uff0c\u5bf9\u540e\u7eed\u4ea7\u54c1\u529f\u80fd\u7684\u5b9e\u73b0\u548c\u4e1a\u52a1\u63a5\u5165\u5ea6\u4e0a\u4f1a\u5e26\u6765\u8d8a\u6765\u8d8a\u660e\u663e\u7684\u74f6\u9888\u3002\\n\\n### \u6ca1\u6709\u7f51\u5173\u5c42\u6cbb\u7406\u51fa\u73b0\u7684\u95ee\u9898\\n\\n#### \u95ee\u9898\u4e00\uff1a\u6027\u80fd\u65b9\u9762\\n\\n1. \u6bcf\u6b21\u65b0\u589e\u540e\u7aef\u670d\u52a1\uff0c\u90fd\u9700\u8981\u8fdb\u884c\u7f16\u7801\u53d8\u66f4\\n2. \u6d41\u91cf\u8f6c\u53d1\u7684\u4ee3\u7801\u7528 Python \u7b80\u5355\u5b9e\u73b0\uff0c\u672a\u6309\u201c\u7f51\u5173\u201d\u8981\u6c42\u8fdb\u884c\u8bbe\u8ba1\\n3. Flask \u6846\u67b6\u7684\u6027\u80fd\u9650\u5236\uff0c\u5355\u673a QPS \u8303\u56f4\u5c40\u9650\u5728 120-150\\n4. \u91cd\u590d\u9020\u8f6e\u5b50\uff1a\u4e0d\u540c\u7684\u4e1a\u52a1\u9700\u6c42\u90fd\u751f\u4ea7\u4e00\u5957\u5bf9\u5e94\u5165\u53e3\\n5. \u7ba1\u7406\u9ebb\u70e6\uff0c\u8fd0\u7ef4\u590d\u6742\\n\\n\u57fa\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u7684\u884c\u52a8\u65b9\u5411\u662f\uff1a\u4e13\u4e1a\u7684\u5de5\u4f5c\u4ea4\u7ed9\u4e13\u4e1a\u7684\u7cfb\u7edf\u53bb\u505a\u3002\\n\\n#### \u95ee\u9898\u4e8c\uff1a\u5185\u90e8\u4e1a\u52a1\u65b9\u9762\\n\\n![\u5185\u90e8\u4e1a\u52a1\u95ee\u9898](https://static.apiseven.com/202108/1631607280492-f3e9abbe-5017-497a-a8b8-80dd079f5a98.png)\\n\\n1. \u9700\u8981\u7ba1\u7406\u7684\u5185\u90e8\u670d\u52a1\u6570\u91cf\u975e\u5e38\u591a\uff08\u4e0a\u767e\uff09\\n2. \u90e8\u5206\u670d\u52a1\u672a\u5bf9\u63a5 CAS \u5b9e\u73b0\u9274\u6743\\n3. \u65b0\u7684\u670d\u52a1\u5bf9\u63a5 CAS \u5b58\u5728\u5bf9\u63a5\u6210\u672c\uff0c\u91cd\u590d\u5f00\u53d1\u8017\u65f6\u8017\u529b\\n4. \u6240\u6709\u670d\u52a1\u76f4\u63a5\u914d\u7f6e\u5728\u63a5\u5165\u5c42\uff0c\u6ca1\u6709\u5185\u90e8\u670d\u52a1\u7684\u89c4\u8303\u53ca\u6700\u4f73\u5b9e\u8df5\\n\\n\u5e26\u7740\u4ee5\u4e0a\u8fd9\u4e24\u65b9\u9762\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u5f00\u59cb\u5bf9\u7f51\u5173\u7c7b\u4ea7\u54c1\u8fdb\u884c\u4e86\u76f8\u5173\u7684\u8c03\u7814\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u9009\u62e9\u4e86 Apache APISIX\\n\\n\u6700\u65e9\u6211\u4eec\u4e5f\u8c03\u7814\u4e86\u5f88\u591a\u7684\u7f51\u5173\u7cfb\u7edf\uff0c\u6bd4\u5982 Apache APISIX\u3001Kong\u3001traefik \u548c MOSN\uff0c\u8fd8\u6709\u6211\u4eec\u516c\u53f8\u5185\u90e8\u7684\u4e24\u4e2a\u76f8\u5173\u9879\u76ee YZ7 \u548c Tether\u3002\\n\\n![\u7f51\u5173\u7cfb\u7edf\u9884\u9009](https://static.apiseven.com/202108/1631607308093-b2135819-6d17-41d4-b2fb-10cbefa3c27b.png)\\n\\n\u8003\u8651\u5230\u4ea7\u54c1\u6210\u719f\u5ea6\u548c\u53ef\u62d3\u5c55\u6027\uff0c\u6700\u7ec8\u6211\u4eec\u5728 Kong \u548c Apache APISIX \u4e2d\u8fdb\u884c\u5bf9\u6bd4\u9009\u62e9\u3002\\n\\n![\u591a\u7ef4\u5ea6\u5bf9\u6bd4](https://static.apiseven.com/202108/1631607325400-45aba773-ef63-4168-8c01-5cfa69bb4021.png)\\n\\n\u4ece\u4e0a\u56fe\u5bf9\u6bd4\u4e2d\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e24\u8005\u5728\u5f88\u591a\u65b9\u9762\u57fa\u672c\u4e0d\u76f8\u4e0a\u4e0b\uff0c\u6240\u4ee5\u5b58\u50a8\u7aef\u6210\u4e3a\u6211\u4eec\u91cd\u70b9\u8003\u8651\u7684\u4e00\u70b9\u3002\u56e0\u4e3a etcd \u5728\u6211\u4eec\u516c\u53f8\u5185\u90e8\u7684\u8fd0\u7ef4\u4f53\u7cfb\u4e0a\u5df2\u7ecf\u6bd4\u8f83\u6210\u719f\uff0c\u6240\u4ee5 Apache APISIX \u76f8\u8f83 Kong \u5219\u7565\u80dc\u4e00\u7b79\u3002\\n\\n\u540c\u65f6\u8003\u8651\u5230\u5728\u5f00\u6e90\u9879\u76ee\u5c42\u9762\uff0cApache APISIX \u7684\u56fd\u5185\u4ea4\u6d41\u4e0e\u8ddf\u8fdb\u5904\u7406\u901f\u5ea6\u4e0a\u90fd\u975e\u5e38\u4f18\u79c0\uff0c\u9879\u76ee\u7684\u63d2\u4ef6\u4f53\u7cfb\u6bd4\u8f83\u4e30\u5bcc\u5168\u9762\uff0c\u5bf9\u5404\u4e2a\u9636\u6bb5\u7684\u4f7f\u7528\u7c7b\u578b\u90fd\u6bd4\u8f83\u5951\u5408\u3002\\n\\n\u6240\u4ee5\u5728 2020 \u5e74\u8c03\u7814\u4e4b\u540e\uff0c\u6700\u7ec8\u9009\u62e9\u4e86 [Apache APISIX](https://github.com/apache/apisix) \u4f5c\u4e3a\u6709\u8d5e\u5373\u5c06\u63a8\u51fa\u4e91\u539f\u751f PaaS \u5e73\u53f0\u7684\u6d41\u91cf\u7f51\u5173\u3002\\n\\n## \u4f7f\u7528 Apache APISIX \u540e\u7684\u4ea7\u54c1\u65b0\u8c8c\\n\\n\u5f53\u6211\u4eec\u5f00\u59cb\u63a5\u5165 Apache APISIX \u540e\uff0c\u524d\u6587\u63d0\u5230\u7684\u4e24\u65b9\u9762\u95ee\u9898\u9010\u4e00\u5f97\u5230\u4e86\u89e3\u51b3\u3002\\n\\n### \u6548\u679c\u4e00\uff1a\u4f18\u5316\u4e86\u67b6\u6784\u6027\u80fd\\n\\nApache APISIX \u4f5c\u4e3a\u5165\u53e3\u7f51\u5173\u90e8\u7f72\u5728\u5185\u90e8\u670d\u52a1\u533a\u57df\u8fb9\u7f18\uff0c\u524d\u7aef\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u7ecf\u8fc7\u5b83\u3002\u540c\u65f6\u6211\u4eec\u901a\u8fc7 Apache APISIX \u7684\u63d2\u4ef6\u529f\u80fd\u5b9e\u73b0\u4e86\u4e0e\u516c\u53f8\u5185\u90e8 CAS \u5355\u70b9\u767b\u5f55\u7cfb\u7edf\u7684\u5bf9\u63a5\uff0c\u4e4b\u524d\u8d1f\u8d23\u6d41\u91cf\u8f6c\u53d1\u7684\u8d26\u53f7\u53d8\u4e3a\u7eaf\u4e1a\u52a1\u7cfb\u7edf\u3002\u540c\u65f6\u5728\u524d\u7aef\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8d1f\u8d23\u9274\u6743\u7684 SDK \u4e0e Apache APISIX \u9274\u6743\u63a5\u53e3\u8fdb\u884c\u5bf9\u63a5\uff0c\u8fbe\u6210\u4e00\u5957\u5b8c\u6574\u53c8\u81ea\u52a8\u5316\u7684\u6d41\u7a0b\u4f53\u7cfb\u3002\\n\\n![\u4f18\u5316\u67b6\u6784](https://static.apiseven.com/202108/1631607354934-f951c4f5-8d45-458e-83a6-de20fd206540.png)\\n\\n\u4e8e\u662f\u95ee\u9898\u5f97\u5230\u4e86\u89e3\u51b3\uff1a\\n\\n1. \u6bcf\u6b21\u589e\u52a0\u65b0\u7684\u540e\u7aef\u670d\u52a1\uff0c\u53ea\u9700\u8c03\u7528 Apache APISIX \u63a5\u53e3\uff0c\u5c06\u65b0\u7684\u670d\u52a1\u914d\u7f6e\u5199\u5165\\n2. \u6d41\u91cf\u8f6c\u53d1\u901a\u8fc7 Apache APISIX \u5b8c\u6210\uff0c\u5728\u7f51\u5173\u8be5\u505a\u7684\u4e8b\u60c5\u4e0a\uff0c\u5b83\u5b8c\u6210\u5f97\u5341\u5206\u4f18\u79c0\\n3. \u7f51\u5173\u4e0d\u518d\u662f\u67b6\u6784\u4e2d\u7684\u6027\u80fd\u74f6\u9888\\n4. \u5bf9\u4e0d\u540c\u7684\u4e1a\u52a1\u9700\u6c42\uff0c\u53ef\u4ee5\u7edf\u4e00\u4f7f\u7528\u540c\u4e00\u4e2a\u7f51\u5173\u6765\u5b9e\u73b0\uff1b\u4e1a\u52a1\u7ec6\u8282\u6709\u5dee\u5f02\uff0c\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u5b9e\u73b0\\n\\n### \u6548\u679c\u4e8c\uff1a\u5185\u90e8\u670d\u52a1\u63a5\u5165\u6807\u51c6\u5316\\n\\n\u63a5\u5165 Apache APISIX \u540e\uff0c\u516c\u53f8\u65b0\u7684\u5185\u90e8\u670d\u52a1\u63a5\u5165\u65f6\u5c06\u81ea\u5e26\u9274\u6743\u529f\u80fd\uff0c\u63a5\u5165\u6210\u672c\u6781\u4f4e\uff0c\u4e1a\u52a1\u65b9\u53ef\u4ee5\u76f4\u63a5\u5f00\u59cb\u5f00\u53d1\u4e1a\u52a1\u4ee3\u7801\u3002\u540c\u65f6\u5728\u65b0\u670d\u52a1\u63a5\u5165\u65f6\uff0c\u6309\u5185\u90e8\u670d\u52a1\u7684\u89c4\u8303\u8fdb\u884c\u76f8\u5173\u8def\u7531\u914d\u7f6e\uff0c\u540e\u7aef\u670d\u52a1\u53ef\u4ee5\u7edf\u4e00\u62ff\u5230\u9274\u6743\u540e\u7684\u7528\u6237\u8eab\u4efd\uff0c\u7701\u65f6\u7701\u529b\u3002\\n\\n\u5177\u4f53\u5173\u4e8e\u5185\u90e8\u670d\u52a1\u7684\u4e00\u4e9b\u8c03\u6574\u7ec6\u8282\u8fd9\u91cc\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u3002\\n\\n#### \u9274\u6743\u63d2\u4ef6 OPS-JWT-Auth\\n\\n\u9274\u6743\u63d2\u4ef6\u662f\u57fa\u4e8e JWT-Auth \u534f\u8bae\u53bb\u5f00\u53d1\u7684\uff0c\u7528\u6237\u8bbf\u95ee\u524d\u7aef\u65f6\uff0c\u524d\u7aef\u4f1a\u5148\u53bb\u8c03\u7528 SDK\uff0c\u53bb\u524d\u7aef\u672c\u5730\u83b7\u53d6\u53ef\u7528\u7684 JWT-Token\u3002\u7136\u540e\u901a\u8fc7\u4e0b\u56fe\u7684\u8def\u5f84\u83b7\u5f97\u7528\u6237\u6709\u6548\u4fe1\u606f\uff0c\u653e\u5728\u524d\u7aef\u7684\u67d0\u4e2a\u5b58\u50a8\u91cc\uff0c\u5b8c\u6210\u767b\u5f55\u9274\u6743\u3002\\n\\n![\u767b\u5f55\u9274\u6743](https://static.apiseven.com/202108/1631607385027-4cf6381d-d0ea-4e5e-a8c9-ffc599e6e69c.png)\\n\\n#### \u90e8\u7f72\u914d\u7f6e\u5347\u7ea7\\n\\n\u5728\u90e8\u7f72\u5c42\u9762\uff0c\u6211\u4eec\u4ece\u7b80\u5355\u7248\u672c\u7ecf\u5386\u4e09\u6b21\u8fed\u4ee3\u540e\u5b9e\u73b0\u4e86\u76ee\u524d\u7684\u591a\u96c6\u7fa4\u914d\u7f6e\u90e8\u7f72\u3002\\n\\n* \u7248\u672c\u4e00\uff1a\u53cc\u673a\u623f 4 \u4e2a\u72ec\u7acb\u8282\u70b9\uff0c\u7ba1\u7406\u7a0b\u5e8f\u5206\u522b\u5199\u5165\u6bcf\u4e2a\u8282\u70b9\u7684 etcd\\n* \u7248\u672c\u4e8c: \u53cc\u673a\u623f 4 \u4e2a\u72ec\u7acb\u8282\u70b9\uff0c\u4e3b\u673a\u623f\u4e09\u8282\u70b9 etcd \u96c6\u7fa4\\n* \u7248\u672c\u4e09: \u4e09\u673a\u623f 6 \u4e2a\u72ec\u7acb\u8282\u70b9\uff0c\u4e09\u673a\u623f etcd \u96c6\u7fa4\\n\\n\u76ee\u524d\u6211\u4eec\u8fd8\u662f\u8ba1\u7b97\u4e0e\u5b58\u50a8\u6df7\u5408\u90e8\u7f72\u5728\u4e00\u8d77\uff0c\u540e\u7eed\u6211\u4eec\u4f1a\u53bb\u90e8\u7f72\u4e00\u4e2a\u771f\u6b63\u9ad8\u53ef\u7528\u7684 etcd \u96c6\u7fa4\uff0c\u8fd9\u6837\u5728\u7ba1\u63a7\u5e73\u9762 Apache APISIX \u8fd0\u884c\u65f6\u5c31\u53ef\u4ee5\u5206\u79bb\u51fa\u6765\uff0c\u4ee5\u65e0\u72b6\u6001\u6a21\u5f0f\u90e8\u7f72\u3002\\n\\n#### \u65b0\u589e\u9274\u6743\u63d2\u4ef6 PAT-Auth\\n\\n\u5728\u4eca\u5e74\u6211\u4eec\u53c8\u65b0\u589e\u4e86 Person Access Token\uff08PAT\uff09\u7684\u9274\u6743\u63d2\u4ef6\uff0c\u8fd9\u4e2a\u529f\u80fd\u7c7b\u4f3c\u4e8e\u5728 GitHub \u4e0a\u53bb\u8c03\u7528 Open API \u4e00\u6837\uff0c\u4f1a\u751f\u6210\u4e00\u4e2a\u4e2a\u4eba Token\uff0c\u53ef\u4ee5\u4ee5\u4e2a\u4eba\u8eab\u4efd\u53bb\u8c03\u7528 Open API\u3002\\n\\n\u56e0\u4e3a\u6211\u4eec\u81ea\u5df1\u7684\u8fd0\u7ef4\u5e73\u53f0\u4e5f\u6709\u4e00\u4e9b\u8fd9\u6837\u7684\u9700\u6c42\uff0c\u6bd4\u5982\u672c\u5730\u7684\u4e00\u4e9b\u5f00\u53d1\u63d2\u4ef6\u9700\u8981\u4ee5\u4e2a\u4eba\u8eab\u4efd\u53bb\u8bbf\u95ee\u4e91\u5e73\u53f0\u4e0a\u7684\u63a5\u53e3\u65f6\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e2a\u4eba Token \u65b9\u5f0f\u5c31\u6bd4\u8f83\u65b9\u4fbf\uff0c\u5141\u8bb8\u5f00\u53d1\u81ea\u5df1\u7ed9\u81ea\u5df1\u6388\u6743\u3002\\n\\n\u76ee\u524d Apache APISIX 2.2 \u7248\u672c\u540e\u5df2\u652f\u6301\u591a\u4e2a Auth \u63d2\u4ef6\u4f7f\u7528\uff0c\u73b0\u5728\u53ef\u4ee5\u652f\u6301\u4e00\u4e2a Consumer \u8fd0\u884c\u591a\u4e2a Auth \u63d2\u4ef6\u7684\u573a\u666f\u5b9e\u73b0\u3002\\n\\n## \u66f4\u591a\u73a9\u6cd5\u5f85\u5f00\u53d1\\n\\n### \u5347\u7ea7\u8fd0\u7ef4\u81ea\u52a8\u5316\\n\\n\u5728\u4f7f\u7528 Apache APISIX \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u7ecf\u5386\u4e86\u51e0\u6b21\u7248\u672c\u53d8\u52a8\u3002\u4f46\u6bcf\u6b21\u5347\u7ea7\uff0c\u90fd\u6216\u591a\u6216\u5c11\u51fa\u73b0\u56e0\u4e3a\u517c\u5bb9\u6027\u800c\u5bfc\u81f4\u6539\u9020\u5f00\u53d1\uff0c\u5b8c\u6210\u540e\u8fdb\u884c\u7ebf\u4e0a\u53d8\u66f4\uff0c\u8fd0\u7ef4\u6548\u7387\u8f83\u4f4e\u3002\u6240\u4ee5\u540e\u7eed\u6211\u4eec\u4f1a\u5c1d\u8bd5\u5728\u5b58\u50a8\u9762\u90e8\u7f72\u4e09\u673a\u623f etcd \u96c6\u7fa4\u7684\u540c\u65f6\uff0c\u5c06 Apache APISIX \u8fd0\u884c\u9762\u5bb9\u5668\u5316\u5b9e\u73b0\u81ea\u52a8\u53d1\u5e03\u3002\\n\\n### traffic split \u63d2\u4ef6\u4f7f\u7528\\n\\n[traffic split](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/traffic-split.md) \u662f Apache APISIX \u5728\u6700\u8fd1\u51e0\u4e2a\u7248\u672c\u4e2d\u5f15\u5165\u7684\u63d2\u4ef6\uff0c\u4e3b\u8981\u529f\u80fd\u662f\u8fdb\u884c\u6d41\u91cf\u5206\u79bb\u3002\u6709\u4e86\u8fd9\u4e2a\u63d2\u4ef6\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u4e00\u4e9b\u6d41\u91cf\u5934\u4e0a\u7684\u7279\u5f81\uff0c\u5229\u7528\u5b83\u53bb\u81ea\u52a8\u5b8c\u6210\u76f8\u5173\u64cd\u4f5c\u3002\\n\\n![traffic split](https://static.apiseven.com/202108/1631607412159-bc84d447-ef28-4726-8ee1-b960415ac5ce.png)\\n\\n\u5982\u4e0a\u56fe\u5728\u8def\u7531\u914d\u7f6e\u4e0a\u5f15\u5165 traffic split \u63d2\u4ef6\uff0c\u5982\u679c\u5f53\u6709 Region=Region1 \u7684\u60c5\u51b5\uff0c\u4fbf\u5c06\u5176\u8def\u7531\u5230 Upstream1\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u89c4\u5219\u914d\u7f6e\uff0c\u5b8c\u6210\u6d41\u91cf\u7ba1\u63a7\u7684\u64cd\u4f5c\u3002\\n\\n### \u4e1c\u897f\u5411\u6d41\u91cf\u7ba1\u7406\\n\\n\u6211\u4eec\u7684\u4f7f\u7528\u573a\u666f\u4e2d\u66f4\u591a\u662f\u6d89\u53ca\u5230\u5728\u5185\u7f51\u591a\u4e2a\u670d\u52a1\u4e4b\u95f4\u53bb\u505a\u670d\u52a1\uff0c\u8c03\u7528\u9274\u6743\u65f6\u53ef\u4ee5\u4f9d\u9760 Apache APISIX \u505a\u6d41\u91cf\u7ba1\u7406\u3002\u670d\u52a1 A\u3001\u670d\u52a1 B \u90fd\u53ef\u4ee5\u901a\u8fc7\u5b83\u53bb\u8c03\u7528\u670d\u52a1 C\uff0c\u4e2d\u95f4\u8fd8\u53ef\u4ee5\u52a0\u5165\u9274\u6743\u7684\u63d2\u4ef6\uff0c\u8bbe\u5b9a\u5176\u8c03\u7528\u5bf9\u8c61\u8303\u56f4\u3001\u73af\u5883\u8303\u56f4\u6216\u8005\u901f\u7387\u548c\u7194\u65ad\u9650\u6d41\u7b49\uff0c\u505a\u51fa\u7c7b\u4f3c\u8fd9\u6837\u7684\u6d41\u91cf\u7ba1\u63a7\u3002\\n\\n![\u6d41\u91cf\u7ba1\u7406](https://static.apiseven.com/202108/1631607435661-c22c61c4-396b-4412-9643-b6ccb16cfb1c.png)\\n\\n### \u5185\u90e8\u6743\u9650\u7cfb\u7edf\u5bf9\u63a5\\n\\n\u4e4b\u540e\u6211\u4eec\u4e5f\u6253\u7b97\u5c06\u516c\u53f8\u7684\u6743\u9650\u7cfb\u7edf\u4e0e Apache APISIX \u8fdb\u884c\u5bf9\u63a5\uff0c\u9274\u6743\u901a\u8fc7\u540e\uff0c\u5224\u5b9a\u7528\u6237\u662f\u5426\u6709\u6743\u9650\u53bb\u8bbf\u95ee\u540e\u7aef\u7684\u67d0\u4e2a\u8d44\u6e90\uff0c\u6743\u9650\u7684\u7ba1\u7406\u5458\u53ea\u9700\u5728\u7ba1\u63a7\u5e73\u9762\u4e0a\u505a\u7edf\u4e00\u914d\u7f6e\u5373\u53ef\u3002\\n\\n![\u7cfb\u7edf\u5bf9\u63a5](https://static.apiseven.com/202108/1631607457290-e1f379c5-a23e-46a6-9cea-93cb6f5916ba.png)\\n\\n\u8fd9\u6837\u5e26\u6765\u7684\u4e00\u4e2a\u597d\u5904\u5c31\u662f\u540e\u7aef\u7684\u6240\u6709\u670d\u52a1\u4e0d\u9700\u8981\u5404\u81ea\u53bb\u5b9e\u73b0\u6743\u9650\u7ba1\u63a7\uff0c\u56e0\u4e3a\u5f53\u4e0b\u6240\u6709\u6d41\u91cf\u90fd\u662f\u7ecf\u8fc7\u7f51\u5173\u5c42\u5904\u7406\u3002\\n\\n### Go Plugin \u5f00\u53d1\\n\\n\u76ee\u524d Apache APISIX \u5728\u8ba1\u7b97\u8bed\u8a00\u5c42\u9762\u5df2\u652f\u6301\u591a\u8ba1\u7b97\u8bed\u8a00\uff0c\u6bd4\u5982 Java\u3001Go \u4ee5\u53ca Python\u3002\u521a\u597d\u6211\u4eec\u6700\u8fd1\u5b9e\u73b0\u7684\u4e91\u539f\u751f PaaS \u5e73\u53f0\uff0c\u4e5f\u5f00\u59cb\u628a\u6280\u672f\u6808\u4ece Python \u5f80 Go \u4e0a\u8f6c\u79fb\u3002\\n\\n\u5e0c\u671b\u540e\u7eed\u5728\u4f7f\u7528 Apache APISIX \u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u7528 Go \u53bb\u66f4\u65b0\u4e00\u4e9b\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86\u7684\u63d2\u4ef6\uff0c\u671f\u5f85\u5728\u540e\u7eed\u7684\u8fed\u4ee3\u4e2d\u7ed9\u6709\u8d5e\u4ea7\u54c1\u5e26\u6765\u66f4\u591a\u7684\u597d\u5904\u3002"},{"id":"APISIX \u5728\u79fb\u52a8\u4e91\u516c\u53f8\u7684\u5e94\u7528\u5b9e\u8df5","metadata":{"permalink":"/zh/blog/2021/09/13/china-mobile-cloud-usercase","source":"@site/blog/2021/09/13/china-mobile-cloud-usercase.md","title":"APISIX \u5728\u79fb\u52a8\u4e91\u516c\u53f8\u7684\u5e94\u7528\u5b9e\u8df5","description":"\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u60a8\u53ef\u4ee5\u4e86\u89e3\u5230\u4e2d\u56fd\u79fb\u52a8\u4e91\u662f\u5982\u4f55\u57fa\u4e8e\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fdb\u884c\u5bf9\u8c61\u5b58\u50a8\u4ea7\u54c1\u7684\u5f00\u53d1\u548c\u529f\u80fd\u6539\u8fdb\u4e0e\u66f4\u65b0\uff0c\u6253\u9020\u51fa\u66f4\u5b8c\u5584\u7684\u79fb\u52a8\u4e91\u5bf9\u8c61\u5b58\u50a8\u3002","date":"2021-09-13T00:00:00.000Z","formattedDate":"2021\u5e749\u670813\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":11.935,"truncated":true,"authors":[{"name":"\u9648\u7131\u5c71"}],"prevItem":{"title":"APISIX \u5728\u6709\u8d5e\u4e91\u539f\u751f PaaS \u5e73\u53f0\u7684\u5e94\u7528\u5b9e\u8df5","permalink":"/zh/blog/2021/09/14/youzan"},"nextItem":{"title":"\u4e0d\u5199\u4ee3\u7801\uff0c\u5982\u4f55\u4e3a\u5f00\u6e90\u9879\u76ee\u505a\u8d21\u732e\uff1f","permalink":"/zh/blog/2021/09/09/how-to-contribute-to-an-openSource-without-coding"}},"content":"> \u672c\u6587\u6574\u7406\u81ea\u4e2d\u56fd\u79fb\u52a8\u4e91\u80fd\u529b\u4e2d\u5fc3\u9648\u7131\u5c71\u5728 ApacheCon 2021 \u4e9a\u6d32\u7ad9\u7684\u6f14\u8bb2\uff0c\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u60a8\u53ef\u4ee5\u4e86\u89e3\u5230\u4e2d\u56fd\u79fb\u52a8\u4e91\u662f\u5982\u4f55\u57fa\u4e8e Apache APISIX \u8fdb\u884c\u4ea7\u54c1\u7684\u5f00\u53d1\u548c\u529f\u80fd\u6539\u8fdb\u4e0e\u66f4\u65b0\uff0c\u6253\u9020\u51fa\u66f4\u5b8c\u5584\u7684\u79fb\u52a8\u4e91\u5bf9\u8c61\u5b58\u50a8\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4f5c\u8005\u9648\u7131\u5c71\uff0c\u6765\u81ea\u4e2d\u56fd\u79fb\u52a8\u4e91\u80fd\u529b\u4e2d\u5fc3\u3002\u4ece\u4e8b\u5206\u5e03\u5f0f\u5b58\u50a8\u8f6f\u4ef6\u5f00\u53d1\u53ca\u67b6\u6784\u65b9\u6848\u8bbe\u8ba1\u5de5\u4f5c\uff0c\u6df1\u5ea6\u53c2\u4e0e\u79fb\u52a8\u4e91\u7684\u5efa\u8bbe\uff0c\u5728\u5206\u5e03\u5f0f\u5bf9\u8c61\u5b58\u50a8\u9886\u57df\u6709\u4e30\u5bcc\u7684\u5b9e\u6218\u7ecf\u9a8c\u3002\\n\\n## \u80cc\u666f\u8bf4\u660e\\n\\n\u4e2d\u56fd\u79fb\u52a8\u4e91\u80fd\u529b\u4e2d\u5fc3\u4f5c\u4e3a\u4e2d\u56fd\u79fb\u52a8\u4e91\u8bbe\u65bd\u6784\u5efa\u8005\u3001\u4e91\u670d\u52a1\u63d0\u4f9b\u8005\u4ee5\u53ca\u4e91\u751f\u6001\u6c47\u805a\u8005\uff0c\u627f\u62c5\u4e86\u79fb\u52a8\u4e91\u7684\u6280\u672f\u7814\u53d1\u3001\u89c4\u5212\u5efa\u8bbe\u3001\u8fd0\u8425\u7ef4\u62a4\u3001\u5408\u4f5c\u5f15\u5165\u3001\u9500\u552e\u652f\u6491\u3001\u652f\u6301\u4e0a\u4e91\u516d\u5927\u5de5\u4f5c\u804c\u8d23\u3002\\n\\n\u622a\u81f3 2020 \u5e74 10 \u6708\uff0c\u5168\u56fd\u5171\u8ba1\u5efa\u6210 25 \u4e2a\u516c\u6709\u4e91\u8282\u70b9\uff0c\u7701\u4efd\u8986\u76d6\u7387\u8d85\u8fc7 80%\u3002\u5176\u4e2d\u5bf9\u8c61\u5b58\u50a8 EOS \u4f5c\u4e3a\u5e95\u5c42\u57fa\u7840\u8bbe\u65bd\u80fd\u529b\u4e4b\u4e00\uff0c\u5df2\u5728\u6240\u6709\u8d44\u6e90\u6c60\u4e2d\u8fdb\u884c\u4e86\u90e8\u7f72\u5efa\u8bbe\uff0c\u6574\u4f53\u53ef\u7528\u89c4\u6a21\u8fbe\u5230 EB \u7ea7\u3002\\n\\n\u79fb\u52a8\u4e91\u5bf9\u8c61\u5b58\u50a8\u81f3\u4eca\u5df2\u7ecf\u5386\u4e86\u56db\u4ee3\u53d1\u5c55\u5386\u7a0b\u53d8\u8fc1\u3002\u4ece\u81ea\u7814\u5f00\u53d1\u8d77\u624b\uff0c\u901a\u8fc7\u529f\u80fd\u6269\u5c55\u3001\u6df1\u5ea6\u5b9a\u5236\u3001\u6027\u80fd\u63d0\u5347\u5230\u6700\u65b0\u4e00\u4ee3\u62e5\u6709\u8de8\u533a\u57df\u5168\u5c40\u7ea0\u5220\u67b6\u6784\uff0c\u5b9e\u73b0\u4e86\u5f02\u5730\u591a\u6d3b\u5bb9\u707e\u6548\u679c\u3002\u7eb5\u89c2\u4e0b\u6765\uff0c\u53ef\u8c13\u662f\u8fdb\u6b65\u98de\u901f\u3002\\n\\n\u5728\u4e91\u5bf9\u8c61\u5b58\u50a8\u6280\u672f\u9009\u578b\u521d\u671f\uff0c\u6211\u4eec\u8c03\u7814\u8fc7\u5f88\u591a\u7684 API \u7f51\u5173\uff0c\u5305\u62ec Nginx\u3001Apache APISIX \u7b49\uff0c\u6700\u7ec8\u8fd8\u662f\u9009\u62e9\u4e86 Apache APISIX\u3002Apache APISIX \u4e0d\u4ec5\u80fd\u591f\u6ee1\u8db3\u5f53\u524d\u7684\u4e1a\u52a1\u8981\u6c42\uff0c\u540c\u65f6\u8fd8\u80fd\u5728\u7cfb\u7edf\u53ef\u7528\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u4e0a\u4e3a\u6211\u4eec\u4ea7\u54c1\u63d0\u4f9b\u6bd4\u8f83\u591a\u7684\u601d\u8def\u548c\u9009\u62e9\uff0c\u4e0e\u540e\u7eed\u6574\u4f53\u4ea7\u54c1\u6f14\u8fdb\u89c4\u5212\u548c\u6280\u672f\u6808\u6bd4\u8f83\u543b\u5408\u3002\\n\\n## \u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX \u4f5c\u4e3a\u7f51\u5173\\n\\n### \u4e3a\u4ec0\u4e48\u629b\u5f03 Nginx\\n\\n#### \u7406\u7531\u4e00\uff1a\u7efc\u5408\u80fd\u529b\u6b20\u7f3a\\n\\nApache APISIX \u4f5c\u4e3a\u4e00\u4e2a\u5fae\u670d\u52a1\u7f51\u5173\uff0c\u4e0e\u5176\u4ed6 API \u7f51\u5173\u76f8\u6bd4\uff0c\u5b83\u7684\u4e0a\u6e38\u8def\u7531\u63d2\u4ef6\u662f\u5168\u52a8\u6001\u7684\uff0c\u4fee\u6539\u914d\u7f6e\u4e0d\u9700\u8981\u91cd\u542f\u3002\u540c\u65f6\u63d2\u4ef6\u652f\u6301\u70ed\u52a0\u8f7d\uff0c\u53ef\u4ee5\u968f\u65f6\u63d2\u62d4\u3001\u4fee\u6539\u63d2\u4ef6\u3002\u5c24\u5176\u662f\u4e1a\u52a1\u8fde\u7eed\u6027\u8981\u6c42\u975e\u5e38\u9ad8\u7684\u573a\u666f\uff0c\u8fd9\u4e9b\u80fd\u529b\u90fd\u662f Nginx \u4e0d\u5177\u5907\u7684\u3002\\n\\n#### \u7406\u7531\u4e8c\uff1a\u914d\u7f6e\u4e0d\u7075\u6d3b\\n\\n\u4f17\u6240\u5468\u77e5\uff0c\u50cf Nginx \u6240\u6709\u7684\u529f\u80fd\u90fd\u662f\u57fa\u4e8e\u914d\u7f6e\u6587\u4ef6\u6765\u5b9e\u73b0\u7684\uff0c\u56e0\u800c\u50cf Proxy \u5b58\u5728\u8def\u7531\u4e0a\u6e38\u7684\u8bc1\u4e66\u4e0d\u80fd\u52a8\u6001\u52a0\u8f7d\u3002Apache APISIX \u652f\u6301\u5168\u5e73\u53f0\u3001\u591a\u534f\u8bae\u3001\u5168\u52a8\u6001\u3001\u7cbe\u7ec6\u5316\u8def\u7531\u3001\u5b89\u5168\u9632\u62a4\uff0c\u800c\u4e14\u8fd0\u7ef4\u53cb\u597d\uff0c\u53ef\u4ee5\u5bf9\u63a5 Prometheus\u3001SkyWalking \u7b49\uff0c\u6709\u9ad8\u5ea6\u6269\u5c55\u80fd\u529b\uff0c\u8fd9\u4e9b\u90fd\u662f\u5b9e\u9645\u751f\u4ea7\u4e2d\u9700\u8981\u7684\u80fd\u529b\u3002\\n\\n### \u5728\u6280\u672f\u9009\u578b\u65f6\uff0c\u4e3a\u4ec0\u4e48\u6211\u4eec\u6700\u7ec8\u9009\u62e9 Apache APISIX\\n\\n#### \u7406\u7531\u4e00\uff1a\u57fa\u4e8e\u4ea7\u54c1\u67b6\u6784\u7684\u9700\u8981\\n\\n\u524d\u8fb9\u63d0\u5230\u8fc7\u76ee\u524d\u5bf9\u8c61\u5b58\u50a8\u5df2\u7ecf\u7ecf\u5386\u4e86\u56db\u4ee3\u53d1\u5c55\u5386\u7a0b\u3002\u968f\u7740\u4ea7\u54c1\u529f\u80fd\u7684\u4e30\u5bcc\u3001\u6574\u4e2a\u67b6\u6784\u96c6\u7fa4\u89c4\u6a21\u53d8\u5927\uff0c\u5c31\u9700\u8981\u6709\u66f4\u591a\u63a7\u5236\u9762\u7b56\u7565\uff0c\u5305\u62ec\u6d41\u91cf\u6cbb\u7406\u3001\u670d\u52a1\u6cbb\u7406\u7b49\u7b56\u7565\u6765\u4fdd\u8bc1\u6574\u4e2a\u7cfb\u7edf\u7684\u7a33\u5b9a\u8fd0\u884c\u3002\\n\\n#### \u7406\u7531\u4e8c\uff1a\u7ec6\u7c92\u5ea6\u4e1a\u52a1\u529f\u80fd\u7684\u5b9e\u73b0\\n\\nApache APISIX \u7684\u7279\u6027\u3001\u529f\u80fd\u63d2\u4ef6\u3001\u81ea\u5b9a\u4e49\u5f00\u53d1\u529f\u80fd\uff0c\u90fd\u53ef\u4ee5\u5728\u540e\u7eed\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u6ee1\u8db3\u6211\u4eec\u7684\u4e1a\u52a1\u9700\u6c42\u3002\\n\\n#### \u7406\u7531\u4e09\uff1aSLA \u670d\u52a1\u7b49\u7ea7\u4fdd\u969c\\n\\n\u4e00\u822c SLA \u670d\u52a1\u7b49\u7ea7\u7684\u53ef\u7528\u6027\u5f3a\u8c03\u4e24\u4e2a\u6307\u6807\uff1a\u7cfb\u7edf\u5e73\u5747\u65e0\u6545\u969c\u65f6\u95f4\u548c\u7cfb\u7edf\u5e73\u5747\u6545\u969c\u4fee\u590d\u65f6\u95f4\u3002\u5982\u4f55\u6709\u6548\u62c9\u957f\u7cfb\u7edf\u5e73\u5747\u65e0\u6545\u969c\u65f6\u95f4\uff1f\u5982\u4f55\u6709\u6548\u7f29\u5c0f\u7cfb\u7edf\u5e73\u5747\u6545\u969c\u4fee\u590d\u65f6\u95f4\uff1f\u8fd9\u4e24\u4e2a\u95ee\u9898\u662f\u6211\u4eec\u91cd\u70b9\u8003\u8651\u7684\u3002\u800c Apache APISIX \u5728\u6545\u969c\u9694\u79bb\u548c\u81ea\u6108\u65b9\u9762\u90fd\u6709\u7740\u4e0d\u9519\u7684\u6d41\u91cf\u6cbb\u7406\u548c\u670d\u52a1\u6cbb\u7406\u76f8\u5173\u80fd\u529b\u3002\\n\\n![SLA \u670d\u52a1\u7b49\u7ea7](https://static.apiseven.com/202108/1631500451210-60ba58d6-1fc4-4db6-b658-5e0066bb1c9b.png)\\n\\n## \u5728 Apache APISIX \u7684\u6570\u636e\u9762\uff0c\u6211\u4eec\u6539\u4e86\u4e9b\u4ec0\u4e48\\n\\n### \u6539\u8fdb\u4e00\uff1a\u5185\u5916\u7f51\u8bf7\u6c42\u5206\u79bb\u8bbf\u95ee\\n\\n\u76ee\u524d\u6211\u4eec\u7684\u4e1a\u52a1\u6a21\u578b\u6709\u4e24\u4e2a\u57df\u540d\uff0c\u5185\u7f51\u57df\u540d\u548c\u5916\u7f51\u57df\u540d\u3002\u5185\u7f51\u57df\u540d\u7684\u8bbf\u95ee\u662f\u8d44\u6e90\u6c60\u4e1c\u897f\u5411\u7684\u8bbf\u95ee\uff0c\u5982\u8d44\u6e90\u6c60\u5185\u90e8\u865a\u62df\u673a\u3001\u5e94\u7528\u5e73\u53f0\u7c7b\u7684\u4ea7\u54c1\u7b49\u3002\u5916\u7f51\u57df\u540d\uff0c\u76f8\u5f53\u4e8e\u662f\u7eaf\u516c\u7f51\u7684\u8bbf\u95ee\uff0c\u6bd4\u5982\uff1a\u516c\u7f51\u7684\u516c\u6709\u4e91\u3001toC \u548c toB \u7684\u5ba2\u6237\uff0c\u901a\u8fc7 satellite \u6216\u8005\u7269\u7406\u4e13\u7ebf\u8bbf\u95ee\u5bf9\u8c61\u5b58\u50a8\u3002\\n\u6211\u4eec\u901a\u8fc7\u63a5\u5165 Apache APISIX \u5b9e\u73b0\u4e86\u5185\u5916\u7f51\u57df\u540d\u7684\u591a\u57df\u540d\u8bc1\u4e66\u914d\u7f6e\uff0c\u5e76\u63d0\u4f9b\u4e86\u52a0\u5bc6\u8bbf\u95ee\u529f\u80fd\uff0c\u540c\u65f6\u5b9e\u73b0\u4e86 SSL \u8bc1\u4e66\u52a8\u6001\u52a0\u8f7d\u7684\u529f\u80fd\u5b9e\u73b0\u3002\u5bf9\u4e8e 24 \u5c0f\u65f6\u4e0d\u95f4\u65ad\u7684\u4e1a\u52a1\uff0c\u80fd\u591f\u52a8\u6001\u66f4\u65b0 SSL \u8bc1\u4e66\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\\n\\n### \u6539\u8fdb\u4e8c\uff1a\u8bf7\u6c42\u7194\u65ad\u4fdd\u62a4\\n\\n\u5728\u8fd9\u91cc\u9996\u5148\u7ed9\u5927\u5bb6\u7b80\u5355\u63cf\u8ff0\u4e00\u4e0b\u76ee\u524d\u63a5\u5165 Apache APISIX \u540e\u7684\u5bf9\u8c61\u5b58\u50a8 EOS \u8282\u70b9\u7ba1\u7406\u3002\u6574\u4e2a\u5bf9\u8c61\u5b58\u50a8\u5206\u4e3a\u6570\u636e\u5e73\u9762\u548c\u63a7\u5236\u5e73\u9762\u3002\u6570\u636e\u5e73\u9762\u4e3b\u8981\u627f\u8f7d\u6574\u4e2a\u4e1a\u52a1\u7684 I/O \u6d41\u3002\u4e1a\u52a1\u6570\u636e\u662f\u4ece Apache APISIX \u7684 7 \u5c42\u6d41\u91cf\u6cbb\u7406\u6a21\u5757\u4f5c\u4e3a\u5165\u53e3\uff0c\u901a\u8fc7 APISIX \u540e\u7aef\u4e0a\u6e38\u7684 Accesser\uff0c\u5b9e\u73b0\u4e1a\u52a1\u63a5\u53e3\u5904\u7406\u7684\u4e3b\u8981\u6a21\u5757\u3002\\n\\n![\u7194\u65ad\u4fdd\u62a4](https://static.apiseven.com/202108/1631500499020-4297de78-f9e3-45a5-8f57-2a55280bf7b0.png)\\n\\n\u63a7\u5236\u5e73\u9762\u4e3b\u8981\u6709\u51e0\u5927\u670d\u52a1\uff0c\u5305\u62ec\u81ea\u52a8\u9a7e\u9a76\u670d\u52a1 Manager\u3001\u53ef\u89c2\u6d4b\u7cfb\u7edf Observer \u548c\u6df7\u6c8c\u5de5\u7a0b\u6545\u969c\u6ce8\u5165\u6a21\u5757 Checker\u3002\u8fd8\u6709\u989d\u5916\u7684\u6574\u4f53\u4ea4\u4e92\u7f16\u6392\u7cfb\u7edf Orchestrator \u548c\u7070\u5ea6\u53d1\u5e03\u5e73\u53f0 Publisher\u3002\\n\\n![\u63a7\u5236\u5e73\u9762\u670d\u52a1](https://static.apiseven.com/202108/1631500520579-1e40b538-377b-4356-b0f2-1038c0a798e4.png)\\n\\n\u4e3a\u4e86\u5b9e\u73b0\u8bf7\u6c42\u7194\u65ad\u4fdd\u62a4\uff0c\u6570\u636e\u9762\u5728\u63a5\u5165 Apache APISIX \u540e\u5c31\u5b9e\u73b0\u4e86\u8bf7\u6c42\u4ecb\u5165\u7684\u5904\u7406\u80fd\u529b\u3002\u800c\u63a7\u5236\u9762\u7aef\u7684\u53ef\u89c2\u6d4b\u7cfb\u7edf\u4e3b\u8981\u662f\u57fa\u4e8e Prometheus \u642d\u5efa\u7684\uff0c\u8fdb\u884c\u6307\u6807\u6536\u96c6\u4e0e\u544a\u8b66\uff0c\u6700\u7ec8\u5b9e\u73b0\u540e\u7aef\u6574\u4f53\u7684\u7194\u65ad\u4fdd\u62a4\u3002\\n\\n### \u6539\u8fdb\u4e09\uff1a\u81ea\u5b9a\u4e49 constant key \u5b9e\u73b0\u5168\u5c40\u9650\u6d41\\n\\nlimit-conn key \u8fd9\u4e2a\u63d2\u4ef6\u4e3b\u8981\u662f\u652f\u6301 remote_addr\u3001server_addr\u3001X-Forwarded-For\u3001X-Real-IP \uff0c\u4f46\u4e0d\u80fd\u5bf9\u5357\u5317\u5411\u7f51\u5173\u7684\u6d41\u91cf\u505a\u5168\u5c40\u9650\u6d41\u3002\\n\\n\u4e3a\u4e86\u5339\u914d\u6211\u4eec\u7684\u4e1a\u52a1\u9700\u6c42\uff0c\u901a\u8fc7\u81ea\u5b9a\u4e49\u4e00\u4e2a constant \u5e38\u91cf\u4f5c\u4e3a limit-conn key \u8303\u56f4\uff0c\u4e0a\u56fe\u53f3\u4fa7\u5373\u662f\u63a5\u5165 Apache APISIX \u540e\u4fee\u6539\u8fc7\u7684\u914d\u7f6e\uff0c\u901a\u8fc7 constant \u5e38\u91cf key \u5b9e\u73b0\u5168\u5c40\u9650\u6d41\u7684\u529f\u80fd\u3002\\n\\n![\u5168\u5c40\u9650\u6d41](https://static.apiseven.com/202108/1631500546238-9fd5ebcf-d205-4d99-a34d-236d5589a7e6.png)\\n\\n### \u6539\u8fdb\u56db\uff1a\u65b0\u589e\u529f\u80fd\u7279\u6027\u5f00\u5173\\n\\n#### \u5f00\u5173 1\uff1a\u4e34\u65f6\u5173\u95ed\u67d0\u4e2a\u5bf9\u8c61\u5b58\u50a8\u529f\u80fd\\n\\n\u5728\u7f51\u5173\u5c42\u901a\u8fc7\u63a5\u5165 Apache APISIX\uff0c\u517c\u5bb9\u4e86 S3 \u63a5\u53e3\u89c4\u8303\uff0c\u907f\u514d\u5bf9\u540e\u7aef\u670d\u52a1\u7684\u63a5\u5165\u5c42\u3001\u6301\u4e45\u5316\u5c42\u7684\u8d44\u6e90\u6d6a\u8d39\u3002\\n\\n#### \u5f00\u5173 2\uff1a\u652f\u6301 GET \u8bf7\u6c42\u4f18\u5148\u7ea7\u6700\u9ad8\\n\\n\u5b9e\u73b0\u4e86\u5728\u652f\u6301 GET \u8bf7\u6c42\u4f18\u5148\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u53d6\u56de\u7528\u6237\u6570\u636e\u65f6 GET \u8bf7\u6c42\u4f18\u5148\u7ea7\u6700\u9ad8\uff0c\u9ad8\u4e8e PUT \u3001DELETE \u7b49\u8bf7\u6c42\u3002\\n\\n#### \u5f00\u5173 3\uff1a\u5bf9 Ordered List \u8bf7\u6c42\u8fd4\u56de 501 Not Implemented\\n\\n\u5728\u5bf9\u8c61\u5b58\u50a8\u4e2d\u4e00\u822c\u4f1a\u6709\u5bf9\u6876\u7684 Ordered List \u7684\u529f\u80fd\u9700\u6c42\u3002\u7b2c\u4e09\u3001\u56db\u4ee3\u79fb\u52a8\u4e91\u5bf9\u8c61\u5b58\u50a8\u9762\u5411\u7684\u90fd\u662f\u767e\u4ebf\u6587\u4ef6\u5bf9\u8c61\uff0c\u5982\u679c\u4f9d\u65e7\u4f7f\u7528 Ordered List\uff0c\u4e00\u65b9\u9762\u8bf7\u6c42\u8bbf\u95ee\u540e\u7aef\u54cd\u5e94\u7684\u65f6\u95f4\u4f1a\u7279\u522b\u957f\uff0c\u53e6\u4e00\u65b9\u9762\u4f1a\u5360\u7528\u8f83\u591a\u8d44\u6e90\uff0c\u5bf9\u540e\u7aef\u7684\u7a33\u5b9a\u6027\u63d0\u51fa\u8f83\u5927\u7684\u6311\u6218\u3002\\n\\n\u6240\u4ee5\u63a5\u5165 Apache APISIX \u540e\u5c06\u76f4\u63a5\u5728\u7f51\u5173\u5c42\u9762\u8fdb\u884c\u62d2\u7edd\u8bf7\u6c42\uff0c\u5e76\u8fd4\u56de 501 Not Implemented \u7684\u72b6\u6001\u7801\u3002\\n\\n### \u6539\u8fdb\u4e94\uff1a\u5b9e\u73b0\u900f\u660e\u5347\u7ea7/\u6269\u5bb9/\u914d\u7f6e\u53d8\u66f4\\n\\n\u7ed3\u5408 Apache APISIX 7 \u5c42\u6cbb\u7406\u80fd\u529b\uff0c\u6211\u4eec\u5bf9\u4e0a\u6e38\u7ec4\u4ef6\u548c\u6574\u4e2a I/O \u8def\u5f84\u4e0a\u5173\u952e\u7ec4\u4ef6\u8fdb\u884c\u4e86\u5347\u7ea7\u3001\u6269\u5bb9\u548c\u914d\u7f6e\u53d8\u66f4\uff0c\u901a\u8fc7\u52a8\u6001\u6269\u5bb9\u3001\u52a8\u6001\u5347\u7ea7\u7b49\u64cd\u4f5c\u6765\u63a7\u5236\u540e\u7aef\u6743\u91cd\uff0c\u8fdb\u884c\u540e\u7eed\u8bf7\u6c42\u5904\u7406\u3002\\n\\n### \u6539\u8fdb\u516d\uff1a\u57fa\u4e8e request-id \u5b9e\u73b0\u8bf7\u6c42\u65e5\u5fd7\u8ddf\u8e2a\u5206\u6790\\n\\n\u57fa\u4e8e access.log \u5b9e\u73b0\u4e86\u65e5\u5fd7\u96c6\u4e2d\u6536\u96c6\u7684\u7ba1\u7406\u65b9\u5f0f\uff0c\u628a APISIX \u7684 log \u548c\u5176\u4ed6\u8fdb\u7a0b\u7684 log \u90fd\u6536\u96c6\u8d77\u6765\uff0c\u7136\u540e\u8fdb\u884c\u7efc\u5408\u7684\u5206\u6790\u3002\\n\\n![\u65e5\u5fd7\u8ddf\u8e2a](https://static.apiseven.com/202108/1631500588620-9200d098-b4ac-4b9d-99f4-509f9fada70f.png)\\n\\n\u4e0a\u56fe\u53f3\u4fa7\u7684\u914d\u7f6e\u9879\u662f\u4f7f\u7528\u4e86 Apache APISIX \u7684 request-id \u63d2\u4ef6\u3002\u6bcf\u4e2a\u8bf7\u6c42\u5728\u7ecf\u8fc7 APISIX \u65f6\u90fd\u4f1a\u88ab\u5206\u914d\u4e00\u4e2a request-id\uff0c\u88ab\u7528\u4e8e\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u5c42\uff08Accesser\uff09\u548c\u6570\u636e\u6301\u4e45\u5316\u5c42\uff0c\u8fdb\u800c\u5728 Loki \u5b98\u65b9\u9762\u677f\u4e0a\u8fc7\u6ee4\u51fa\u4e0d\u540c\u7ec4\u4ef6\u7684\u65e5\u5fd7\u65f6\u95f4\u6233\uff0c\u6709\u52a9\u4e8e\u540e\u7eed\u4f7f\u7528 AI \u5b9e\u73b0\u4e00\u4e9b\u81ea\u52a8\u5316\u7684\u5206\u6790\u3002\\n\\n### \u6539\u8fdb\u4e03\uff1a\u8de8 AZ \u8bf7\u6c42\u8c03\u5ea6\u529f\u80fd\\n\\n\u76ee\u524d\u8d1f\u8f7d\u5747\u8861\u7684\u540e\u7aef\u662f\u57fa\u4e8e APISIX \u5b9e\u73b0\u7684\u4e03\u5c42\u6d41\u91cf\u6cbb\u7406\u5c42\uff0c\u901a\u8fc7\u7b49 ECMP + BGP \u8def\u7531\u5b9e\u73b0\u591a\u6d3b\u7684\u80fd\u529b\u3002\u6211\u4eec\u5b9a\u4e49\u4e86\u4e09\u79cd\u6d41\u91cf\u7c7b\u578b\uff0c\u6bcf\u4e2a APISIX \u8282\u70b9\u6536\u5230\u4e1a\u52a1\u6d41\u91cf\u65f6\u53ea\u6253\u5230\u672c\u8282\u70b9\u7684\u4e0a\u6e38\u670d\u52a1\u53bb\u5904\u7406\uff08level0\uff0c\u7d2b\u7ebf\uff09\uff0c\u7c7b\u4f3c SideCar \u6a21\u5f0f\u3002\\n\\n![AZ \u8c03\u5ea6](https://static.apiseven.com/202108/1631500626933-473fdd62-dcee-42cc-93c2-93d83acd796c.png)\\n\\n\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u7684\u4e0a\u6e38\u51fa\u73b0\u95ee\u9898\uff0c\u5c31\u4f1a\u88ab\u8f6c\u53d1\u5230\u540c AZ \u7684\u5176\u4ed6\u4e0a\u6e38\u8282\u70b9\u8fdb\u884c\u5904\u7406\uff08\u7eff\u7ebf\uff09\u3002\u5982\u679c\u6240\u6709\u4e0a\u6e38\u8282\u70b9\u5168\u90e8\u6302\u6389\uff0c\u5219\u4f1a\u57fa\u4e8e Apache APISIX \u5b9e\u73b0\u8bf7\u6c42\u8de8 AZ \u7684\u8c03\u7528\u80fd\u529b\uff08level2\uff0c\u7ea2\u7ebf\uff09\uff0c\u628a\u8bf7\u6c42\u5199\u5165\u5230\u5176\u4ed6 AZ \u4e2d\uff0c\u6700\u7ec8\u5b9e\u73b0\u8de8 AZ \u7684\u8bf7\u6c42\u8c03\u5ea6\u3002\\n\\n## \u672a\u6765\u89c4\u5212\\n\\n\u672a\u6765\u79fb\u52a8\u4e91\u5bf9\u8c61\u5b58\u50a8\u5c06\u4f1a\u5168\u9762\u62e5\u62b1\u4e91\u539f\u751f\uff0c\u5e76\u9010\u6b65\u5b9e\u73b0\u4ee5\u4e0b\u8ba1\u5212\uff1a\\n\\n1. \u6574\u5408\u6570\u636e\u9762\u529f\u80fd\uff0c\u6700\u7ec8\u5b9e\u73b0\u5168\u9762\u7684\u5bb9\u5668\u5316\u90e8\u7f72\u7f16\u6392\\n2. \u9646\u7eed\u63a5\u5165\u57fa\u4e8e APISIX \u7684 Ingress Controller\uff0c\u901a\u8fc7 APISIX \u6765\u7edf\u4e00\u8bbf\u95ee\u5165\u53e3\\n3. \u52a0\u5f3a\u4e0e\u81ea\u52a8\u9a7e\u9a76 Manager\u3001\u53ef\u89c2\u6d4b\u6027\u7cfb\u7edf Observer \u5b50\u7cfb\u7edf\u7684\u878d\u5408\u80fd\u529b\uff0c\u8fdb\u4e00\u6b65\u5b9e\u73b0\u6545\u969c\u7684\u9694\u79bb\u4e0e\u81ea\u6108\\n4. \u5c06\u5bf9\u8c61\u5b58\u50a8 S3 \u65b9\u9762\u7684\u8ba4\u8bc1\u80fd\u529b\u79fb\u5165\u5230\u63a5\u53e3\u5c42\u3002\u66f4\u597d\u5730\u5b9e\u73b0\u7edf\u4e00\u9274\u6743\u8ba4\u8bc1\u4ee5\u53ca\u5b89\u5168\u8bbf\u95ee\uff0c\u8fbe\u5230\u4fdd\u62a4\u540e\u7aef\u7684\u6548\u679c"},{"id":"2021/09/09/how-to-contribute-to-an-openSource-without-coding","metadata":{"permalink":"/zh/blog/2021/09/09/how-to-contribute-to-an-openSource-without-coding","source":"@site/blog/2021/09/09/how-to-contribute-to-an-OpenSource-without-coding.md","title":"\u4e0d\u5199\u4ee3\u7801\uff0c\u5982\u4f55\u4e3a\u5f00\u6e90\u9879\u76ee\u505a\u8d21\u732e\uff1f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u5f88\u591a\u4e0d\u5199\u4ee3\u7801\u4e3a\u5f00\u6e90\u9879\u76ee\u8d21\u732e\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u5199\u6587\u7ae0\u3001\u505a\u89c6\u9891\u3001\u5bf9\u5916\u5206\u4eab\u3001\u5efa\u7acb\u672c\u5730\u793e\u533a\u3001\u79ef\u6781\u53c2\u4e0e\u793e\u533a\u8ba8\u8bba\u7b49\u65b9\u5f0f\u53c2\u4e0e\u5230\u5f00\u6e90\u9879\u76ee\u4e2d\u3002","date":"2021-09-09T00:00:00.000Z","formattedDate":"2021\u5e749\u67089\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":9.53,"truncated":true,"authors":[{"name":"\u8d75\u82e5\u5983","url":"https://github.com/Serendipity96","imageURL":"https://avatars.githubusercontent.com/u/23514812?v=4"}],"prevItem":{"title":"APISIX \u5728\u79fb\u52a8\u4e91\u516c\u53f8\u7684\u5e94\u7528\u5b9e\u8df5","permalink":"/zh/blog/2021/09/13/china-mobile-cloud-usercase"},"nextItem":{"title":"\u5982\u4f55\u4f7f\u7528 APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1","permalink":"/zh/blog/2021/09/07/how-to-use-apisix-auth"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u5f88\u591a\u4e0d\u5199\u4ee3\u7801\u4e3a\u5f00\u6e90\u9879\u76ee\u8d21\u732e\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u5199\u6587\u7ae0\u3001\u505a\u89c6\u9891\u3001\u5bf9\u5916\u5206\u4eab\u3001\u5efa\u7acb\u672c\u5730\u793e\u533a\u3001\u79ef\u6781\u53c2\u4e0e\u793e\u533a\u8ba8\u8bba\u7b49\u65b9\u5f0f\u53c2\u4e0e\u5230\u5f00\u6e90\u9879\u76ee\u4e2d\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u7b14\u8005\u4e3a\u5f00\u6e90\u9879\u76ee\u8d21\u732e\u8fc7\u51e0\u4e2a PR\uff0c\u63d0\u4ea4\u8fc7\u51e0\u4e2a issue\uff0c\u76f4\u5230\u73b0\u5728\u8fd8\u6e05\u6670\u8bb0\u5f97\u51e0\u5e74\u524d\u7b2c\u4e00\u4e2a PR \u88ab merge \u65f6\u7684\u5174\u594b\uff0c\u4f53\u9a8c\u5230\u4e86\u53c2\u4e0e\u5f00\u6e90\u7684\u4e50\u8da3\u3002\u4f46\u662f\u53ea\u505c\u7559\u5728\u4e86 contributor \u9636\u6bb5\uff0c\u6ca1\u6709\u4e0b\u6587\u4e86\uff0c\u56e0\u4e3a\u7b14\u8005\u540e\u6765\u4e0d\u505a\u7814\u53d1\u4e86\uff0c**\u8ba4\u4e3a\u4e0d\u719f\u6089\u4ee3\u7801\u3001\u4e0d\u80fd\u4fee bug \u5c31\u6ca1\u6709\u8d21\u732e\u7684\u673a\u4f1a\u4e86\u3002**\\n\\n\u8fd9\u91cc\u662f\u6709\u4e00\u4e2a\u8bef\u533a\u7684\uff0c\u5e76\u975e\u53ea\u6709\u8d21\u732e\u4ee3\u7801\u3001\u4fee\u590d bug \u624d\u662f\u4e3a\u9879\u76ee\u505a\u8d21\u732e\u3002\u6210\u4e3a\u8d21\u732e\u8005\u53ea\u80fd\u901a\u8fc7\u8d21\u732e\u4ee3\u7801\u7684\u65b9\u5f0f\u5417\uff1f**\u5982\u679c\u6211\u4e0d\u4f1a\u5199\u4ee3\u7801\uff0c\u5e76\u975e\u5f00\u53d1\u8005\uff0c\u600e\u6837\u624d\u80fd\u6210\u4e3a\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u7684\u8d21\u732e\u8005\uff0c\u751a\u81f3\u664b\u5347\u4e3a committer \u5462\uff1f**\\n\\n\u7b14\u8005\u68b3\u7406\u4e4b\u540e\uff0c\u53d1\u73b0\u6709\u975e\u5e38\u591a\u7684\u65b9\u5f0f\uff0c\u5728\u8fd9\u91cc\u5206\u4eab\u7ed9\u5927\u5bb6\uff0c\u65e0\u8bba\u662f\u4e0d\u662f\u5f00\u53d1\u8005\uff0c\u90fd\u53ef\u4ee5\u5b9e\u8df5\u3002\uff08\u7b14\u8005\u4e5f\u5728\u5b9e\u8df5\u7684\u8def\u4e0a\uff09\\n\\n## \u975e\u4ee3\u7801\u65b9\u5f0f\\n\\n### \u5199\u6587\u7ae0\\n\\n\u5199\u6587\u7ae0\u662f\u4e00\u4e2a\u5f88\u5bb9\u6613\u88ab\u5ffd\u7565\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6587\u7ae0\u6765\u5ba3\u4f20\u3001\u5e03\u9053\u67d0\u4e2a\u6280\u672f\u3002\u6bd4\u5982\u64b0\u5199\u67d0\u4e2a\u9879\u76ee\u7684\u4e0a\u624b\u6307\u5357\u3001\u8e29\u5751\u8bb0\u5f55\u3001\u67b6\u6784\u8bbe\u8ba1\u5206\u6790\u3001\u5b9e\u73b0\u539f\u7406\u7b49\u7b49\u3002\\n\\n\u5982\u679c\u5f00\u59cb\u5199\u6587\u7ae0\u6bd4\u8f83\u56f0\u96be\uff0c\u53ef\u4ee5\u5148\u4ece\u7ffb\u8bd1\u505a\u8d77\uff0c\u65e0\u8bba\u662f\u4e2d\u8bd1\u82f1\u8fd8\u662f\u82f1\u8bd1\u4e2d\uff0c\u53ea\u8981\u662f\u5bf9\u8fd9\u4e2a\u9879\u76ee\u6709\u610f\u4e49\u7684\u5185\u5bb9\uff0c\u90fd\u662f\u5728\u4e3a\u5b83\u505a\u8d21\u732e\u3002\\n\\n\u4ea6\u6216\u662f\u4f60\u89c2\u770b\u4e86\u522b\u4eba\u7684\u6280\u672f\u5b9e\u6218\u5206\u4eab\uff0c\u628a\u522b\u4eba\u7684\u5206\u4eab\u6574\u7406\u6210\u6587\u5b57\u7248\uff0c\u5206\u4eab\u5230\u793e\u533a\u4e2d\uff0c\u5e2e\u52a9\u66f4\u591a\u4eba\u4e86\u89e3\u9879\u76ee\u3002\\n\\n\u7b14\u8005\u8fd8\u6ce8\u610f\u5230\uff0c\u6709\u4e9b\u8d21\u732e\u8005\u628a\u6587\u7ae0\u6574\u7406\u6210\u4e00\u672c\u5f00\u53d1\u5c0f\u518c\u3001\u6216\u8005\u4e00\u672c\u4e13\u4e1a\u4e66\u7c4d\uff0c\u7cfb\u7edf\u5730\u5411\u5176\u4ed6\u4eba\u4ecb\u7ecd\u67d0\u9879\u6280\u672f\u3002\\n\\n### \u5236\u4f5c\u89c6\u9891\\n\\n\u5236\u4f5c\u89c6\u9891\u4e5f\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u65b9\u5f0f\u3002\u6211\u4eec\u53ef\u4ee5\u628a\u6587\u5b57\u7684\u65b9\u5f0f\u8f6c\u6362\u6210\u89c6\u9891\uff0c\u7528\u89c6\u9891\u7684\u65b9\u5f0f\u4ecb\u7ecd\u67d0\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u5f55\u5236\u4e0a\u624b\u6307\u5357\u3001\u8e29\u5751\u8bb0\u5f55\u3001\u67b6\u6784\u8bbe\u8ba1\u5206\u6790\u3001\u5b9e\u73b0\u539f\u7406\u7b49\u7b49\u3002\u7b14\u8005\u4e5f\u770b\u5230\u4e86\u5f88\u591a\u9879\u76ee\u91c7\u7528\u89c6\u9891\u7684\u65b9\u5f0f\u4ecb\u7ecd\uff0c\u89c6\u9891\u53ef\u80fd\u662f\u52a8\u753b\u7684\u5f62\u5f0f\uff0c\u4e5f\u53ef\u80fd\u662f\u771f\u4eba\u8bb2\u89e3\uff0c\u65e0\u8bba\u54ea\u4e00\u79cd\uff0c\u89c6\u9891\u5728\u5448\u73b0\u4e0a\u4f1a\u6bd4\u6587\u5b57\u66f4\u751f\u52a8\u6709\u8da3\u4e00\u4e9b\u3002\\n\\n\u4e0d\u8fc7\u524d\u671f\u526a\u8f91\u89c6\u9891\u5bf9\u4e8e\u65b0\u624b\u6765\u8bf4\u5de5\u4f5c\u91cf\u53ef\u80fd\u6bd4\u8f83\u5927\u3002\\n\\n### \u5927\u4f1a\u5206\u4eab\\n\\n\u5982\u679c\u4f60\u4e0d\u5bb3\u7f9e\u3001\u559c\u6b22\u5916\u5206\u4eab\uff0c\u90a3\u4e48\u53bb\u6280\u672f\u5927\u4f1a\u4e0a\u5206\u4eab\u3001\u5e03\u9053\u5f00\u6e90\u9879\u76ee\u4e5f\u662f\u4e00\u4e2a\u5f88\u4e0d\u9519\u7684\u9009\u62e9\u3002\u8fd9\u5bf9\u4e86\u89e3\u9879\u76ee\u7684\u65b0\u624b\u53ef\u80fd\u6709\u96be\u5ea6\uff0c\u5047\u4ee5\u65f6\u65e5\uff0c\u5f53\u6211\u4eec\u4ece\u5c0f\u767d\u8fdb\u9636\u6210\u719f\u6089\u8005\u65f6\uff0c\u53bb\u5206\u4eab\u5c31\u6bd4\u8f83\u5bb9\u6613\u8fbe\u6210\u4e86\u3002\u5206\u4eab\u53ef\u4ee5\u953b\u70bc\u81ea\u5df1\u7684\u8868\u8fbe\u80fd\u529b\u3001\u903b\u8f91\u601d\u7ef4\u80fd\u529b\uff0c\u8fd8\u53ef\u4ee5\u953b\u70bc\u81ea\u5df1\u7684\u80c6\u91cf~\uff08\u4e5f\u53ef\u80fd\u6536\u83b7\u5230\u6a44\u6984\u679d\uff09\\n\\n### \u5b8c\u5584\u6587\u6863\\n\\n\u5927\u591a\u6570\u5f00\u53d1\u8005\u5e76\u4e0d\u559c\u6b22\u5199\u6587\u6863\uff0c\u4f46\u662f\u6587\u6863\u662f\u5176\u4ed6\u4eba\u4e86\u89e3\u9879\u76ee\u3001\u4e0a\u624b\u9879\u76ee\u7684\u91cd\u8981\u9014\u5f84\u3002\u7b14\u8005\u66fe\u7ecf\u7684\u5f00\u53d1\u7ecf\u5386\u4e2d\uff0c\u5982\u679c\u9047\u5230\u4e00\u4efd\u6e05\u6670\u8be6\u7ec6\u7684\u6587\u6863\uff0c\u611f\u89c9\u662f\u975e\u5e38\u5e78\u8fd0\u7684\u4e8b\u60c5\uff0c\u4e0a\u624b\u9879\u76ee\u4f1a\u5feb\u5f88\u591a\u3002\u6587\u6863\u5185\u5bb9\u4e0d\u9650\u4e8e\u542f\u52a8\u8bf4\u660e\uff0c\u5982\u679c\u6709\u67b6\u6784\u8bbe\u8ba1\u3001\u539f\u7406\u4ecb\u7ecd\u518d\u597d\u4e0d\u8fc7\u4e86\u3002\\n\\n\u6211\u4eec\u53ef\u4ee5\u4e3a\u611f\u5174\u8da3\u7684\u5f00\u6e90\u9879\u76ee\u63d0\u4ea4\u6587\u6863\uff0c\u751a\u81f3\u662f\u4fee\u590d\u6587\u6863\uff0c\u6bd4\u5982\uff1a\\n\\n- \u4ee3\u7801\u66f4\u65b0\uff0c\u6587\u6863\u6ca1\u6709\u540c\u6b65\u66f4\u65b0\\n- \u4fee\u590d\u9519\u8bef\u7684\u4e0b\u8f7d\u94fe\u63a5\u3001\u6587\u6863\u94fe\u63a5\\n- \u4f18\u5316\u6587\u6863\uff0c\u4fee\u6539\u6587\u6863\u63cf\u8ff0\uff0c\u4f7f\u5176\u66f4\u6613\u7406\u89e3\\n- \u63d0\u4ea4\u67b6\u6784\u8bbe\u8ba1\u3001\u539f\u7406\u4ecb\u7ecd\u6587\u6863\\n\\n### \u5efa\u8bbe\u672c\u5730\u793e\u533a\uff0c\u7ec4\u7ec7/\u53c2\u4e0e\u6d3b\u52a8\\n\\n\u5982\u679c\u4f60\u5bf9\u4e00\u4e2a\u9879\u76ee\u5f88\u611f\u5174\u8da3\uff0c\u53c2\u4e0e\u5230\u672c\u5730\u7684\u793e\u533a\u4e2d\uff0c\u548c\u5fd7\u540c\u9053\u5408\u7684\u4eba\u4ea4\u6d41\u3001\u7ec4\u7ec7\u5f53\u5730\u7684\u6d3b\u52a8\uff0c\u4e3a\u9879\u76ee\u53d1\u5c55\u505a\u8d21\u732e\u3002\\n\\n\u5982\u679c\u6ca1\u6709\u672c\u5730\u793e\u533a\uff0c\u4f60\u53ef\u4ee5\u4f5c\u4e3a\u53d1\u8d77\u4eba\u5efa\u8bbe\u672c\u5730\u793e\u533a\u3002\u7b14\u8005\u4e86\u89e3\u5230 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u9f13\u52b1\u5927\u5bb6\u5efa\u8bbe Local Community\uff0c\u6bd4\u5982 ALC Beijing\u3002\u50cf\u5176\u4ed6\u7684\u6280\u672f\u793e\u533a\uff0c\u5982\uff1aKubeSphere\u3001\u4e91\u539f\u751f\u793e\u533a\u90fd\u5728\u79ef\u6781\u53d1\u5c55\u672c\u5730\u793e\u533a\u3002\\n\\n### \u79ef\u6781\u53c2\u4e0e\u793e\u533a\u8ba8\u8bba\\n\\n#### \u6d3b\u8dc3\u5728 Apache mail list\\n\\nApache \u6587\u5316\u9f13\u52b1\u5927\u5bb6\u901a\u8fc7\u90ae\u4ef6\u5217\u8868\u7684\u5f62\u5f0f\u8ba8\u8bba\u95ee\u9898\u3001\u505a\u51b3\u7b56\uff0c\u6240\u6709\u7684\u4e8b\u9879\u90fd\u8981\u6709\u6240\u8bb0\u5f55\u3002\u6bcf\u4e00\u4e2a Apache \u9879\u76ee\u90fd\u6709\u81ea\u5df1\u4e13\u5c5e\u7684\u90ae\u4ef6\u5217\u8868\uff0c\u5982\u679c\u5bf9\u9879\u76ee\u6709\u4ec0\u4e48\u60f3\u6cd5\uff0c\u793e\u533a\u975e\u5e38\u9f13\u52b1\u5927\u5bb6\u5230\u90ae\u4ef6\u5217\u8868\u8ba8\u8bba\u3002\\n\\n\u6211\u4eec\u53ef\u4ee5\uff1a\\n\\n- \u4e3a\u9879\u76ee\u53d1\u7248\u6295\u7968\\n- \u56de\u590d\u5176\u4ed6\u4eba\u53d1\u8d77\u7684\u8ba8\u8bba\uff0c\u8868\u8fbe\u81ea\u5df1\u7684\u89c2\u70b9\\n- \u53d1\u8d77\u4e00\u6b21\u8ba8\u8bba\\n\\n\u4e3a\u4ec0\u4e48\u662f\u90ae\u4ef6\u5217\u8868\uff1f\\n\\n\u90ae\u4ef6\u5217\u8868\u7ed9\u6211\u7684\u611f\u89c9\u5f88\u53e4\u8001\uff0c\u7b14\u8005\u53bb\u4e86\u89e3\u4e86 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u53d1\u5c55\u5386\u53f2\uff0c\u6700\u521d\u57fa\u91d1\u4f1a\u7684\u521b\u59cb\u4eba\u662f\u901a\u8fc7\u90ae\u4ef6\u5217\u8868\u7684\u65b9\u5f0f\u8ba8\u8bba\u95ee\u9898\uff0c\u96be\u9053\u662f\u53e4\u8001\u6587\u5316\u7684\u4fdd\u7559\uff1f\\n\\n\u867d\u7136\u4e92\u8054\u7f51\u53d1\u5c55\u8fc5\u901f\uff0c\u4f46\u662f\u4e16\u754c\u4e0a\u4ecd\u6709\u63a5\u6536\u56fe\u7247\u56f0\u96be\u3001\u4f7f\u7528\u5176\u4ed6\u8f6f\u4ef6\u7684\u56f0\u96be\uff0c\u5c3d\u7ba1\u662f\u6211\u4eec\u719f\u77e5\u7684 wechat\u3001Twitter \u4f7f\u7528\u8005\u4e5f\u6ca1\u6709\u8986\u76d6\u5168\u7403\uff0c\u4f46\u662f\u4f7f\u7528\u90ae\u4ef6\u80fd\u591f\u4ee5\u6700\u5c0f\u95e8\u69db\u7684\u65b9\u5f0f\u4e0e\u4ed6\u4eba\u5efa\u7acb\u8054\u7cfb\uff0c\u4fdd\u969c\u5168\u4e16\u754c\u5404\u5730\u7684\u4eba\u90fd\u80fd\u53c2\u52a0\u5230\u793e\u533a\u8ba8\u8bba\u4e2d\uff0c\u8fd9\u5c31\u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4fdd\u7559\u90ae\u4ef6\u5217\u8868\u65b9\u5f0f\u7684\u521d\u8877\u3002\\n\\n#### \u6d3b\u8dc3\u5728 Github\\n\\nGithub \u662f\u5f00\u53d1\u8005\u6700\u5e38\u901b\u7684\u7f51\u7ad9\u4e86\uff0c\u5927\u591a\u6570\u7684\u5f00\u6e90\u9879\u76ee\u90fd\u6258\u7ba1\u5728 Github \u4e0a\u3002\u6211\u53ef\u4ee5\u5728\u611f\u5174\u8da3\u7684\u9879\u76ee\u4e0b\\n\\n- \u63d0 issue \u8bf4\u51fa\u6211\u7684\u60f3\u6cd5\uff0c\u9879\u76ee\u7684\u6539\u8fdb\u65b9\u5411\\n- \u63d0\u4ea4\u4e00\u4e2a bug report\\n- review \u5176\u4ed6\u5c0f\u4f19\u4f34\u63d0\u4ea4\u7684 pr\\n\\n\u8fd9\u4e9b\u90fd\u662f\u4e3a\u5f00\u6e90\u9879\u76ee\u505a\u8d21\u732e\u7684\u65b9\u5f0f\u3002\\n\\n#### Apache mail list vs Github\\n\\n\u6709 Github \u4e3a\u4ec0\u4e48\u8fd8\u8981\u4f7f\u7528\u90ae\u4ef6\u5217\u8868\uff1f\u4ee3\u7801\u6258\u7ba1\u5728 Github \uff0c\u770b\u8d77\u6765\u793e\u533a\u7684\u534f\u4f5c\u5de5\u4f5c\u597d\u50cf\u90fd\u662f\u5728 Github \u4e0a\u5b8c\u6210\u7684\u5440\uff1f\\n\\n\u5728\u90ae\u4ef6\u5217\u8868\u91cc\u8ba8\u8bba\u95ee\u9898\uff0c\u5982\u679c\u5927\u5bb6\u6ca1\u6709\u63d0\u51fa\u53cd\u5bf9\u610f\u89c1\uff0c\u53ef\u4ee5\u9ed8\u8bb8\u4e3a\u5927\u5bb6\u901a\u8fc7\u63d0\u8bae\u3002\u5982\u679c\u6709\u53cd\u5bf9\u610f\u89c1\uff0c\u5927\u5bb6\u4f1a\u5145\u5206\u8ba8\u8bba\uff0c\u6700\u7ec8\u8fbe\u6210\u4e00\u81f4\u6216\u6401\u7f6e\u3002\\n\\n\u4f7f\u7528\u90ae\u4ef6\u5217\u8868\u7684\u65b9\u5f0f\u8ba8\u8bba\uff0c\u4e5f\u662f\u5bf9 Apache \u6587\u5316\u7684\u8ba4\u540c\u3002\u9075\u5faa Apache \u89c4\u5219\u7684\u9879\u76ee\uff0c\u90ae\u4ef6\u5217\u8868\u662f\u662f\u793e\u533a\u7684\u9996\u8981\u9635\u5730\uff0cGithub \u662f\u4e00\u4e2a\u65b9\u4fbf\u7684\u534f\u540c\u5de5\u5177\u3002\\n\\n## \u4ee3\u7801\u65b9\u5f0f\\n\\n### \u8d21\u732e\u529f\u80fd\u3001\u4fee\u590d bug\\n\\n\u5f53\u7136\u4e86\uff0c\u5f00\u6e90\u9879\u76ee\u80af\u5b9a\u662f\u79bb\u4e0d\u5f00\u4ee3\u7801\u7684\u3002\u5982\u679c\u5f00\u6e90\u9879\u76ee\u7684\u6280\u672f\u6808\u4f60\u5f88\u719f\u6089\uff0c\u5f88\u5feb\u5c31\u80fd\u4e0a\u624b\u8d21\u732e\u4ee3\u7801\uff0c\u548c\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u4e00\u8d77\u5b8c\u5584\u76f8\u5173\u529f\u80fd\u3001\u4fee\u590d bug\uff0c\u6301\u7eed\u8d21\u732e\uff0c\u6210\u4e3a\u9879\u76ee contributor\uff0c\u8fdb\u4e00\u6b65\u63d0\u540d\u6210\u4e3a committer\u3001PMC \u662f\u5f88\u5bb9\u6613\u7684\u4e8b\u60c5\u3002\u5927\u591a\u6570\u7684\u8d21\u732e\u8005\u90fd\u662f\u901a\u8fc7\u63d0\u4ea4\u4ee3\u7801\u7684\u65b9\u5f0f\u6210\u4e3a committer \u7684\uff0c\u4f46\u662f\u4f5c\u4e3a\u50cf\u7b14\u8005\u8fd9\u6837\u4e0d\u719f\u6089\u4ee3\u7801\u7684\u5c0f\u4f19\u4f34\uff0c\u8fd9\u4e00\u6761\u5c31\u4e0d\u9002\u5408\u4e86\u3002\\n\\n\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff0ccommitter \u662f\u5bf9\u8d21\u732e\u8005\u8fc7\u5f80\u8d21\u732e\u7684\u80af\u5b9a\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u672a\u6765\u4e0d\u518d\u8d21\u732e\u800c\u53bb\u9664 committer \u8eab\u4efd\uff0c\u4e5f\u4e0d\u4f1a\u56e0\u4e3a\u662f committer \u800c\u6709\u66f4\u5927\u7684\u6743\u5229\uff0c\u793e\u533a\u4e2d\u4eba\u4eba\u5e73\u7b49\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u4ecb\u7ecd\u4e86\u5f88\u591a\u6210\u4e3a\u5f00\u6e90\u9879\u8d21\u732e\u7684\u9014\u5f84\uff0c\u5982\u679c\u4f60\u6709\u5f88\u611f\u5174\u8da3\u7684\u5f00\u6e90\u9879\u76ee\u5374\u4e0d\u719f\u6089\u4ee3\u7801\uff0c\u53c8\u60f3\u53c2\u4e0e\u5230\u5f00\u6e90\u793e\u533a\u4e2d\uff0c\u5199\u6587\u7ae0\u3001\u505a\u89c6\u9891\u3001\u5bf9\u5916\u5206\u4eab\u3001\u5efa\u7acb\u672c\u5730\u793e\u533a\u3001\u79ef\u6781\u53c2\u4e0e\u793e\u533a\u8ba8\u8bba\u90fd\u662f\u5f88\u4e0d\u9519\u65b9\u5f0f\u54e6\uff0c\u6b22\u8fce\u5b9e\u8df5\u3002"},{"id":"\u5982\u4f55\u4f7f\u7528 APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1","metadata":{"permalink":"/zh/blog/2021/09/07/how-to-use-apisix-auth","source":"@site/blog/2021/09/07/how-to-use-apisix-auth.md","title":"\u5982\u4f55\u4f7f\u7528 APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u8eab\u4efd\u8ba4\u8bc1\u7684\u76f8\u5173\u6982\u5ff5\u548c\u8eab\u4efd\u8ba4\u8bc1\u7684\u610f\u4e49\u4ee5\u53ca\u4f7f\u7528\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u4f18\u70b9\uff0c\u5e76\u7528\u5b9e\u9645\u793a\u4f8b\u5c55\u793a\u4e86 APISIX \u4e2d\u8eab\u4efd\u8ba4\u8bc1\u7684\u73a9\u6cd5\u3002","date":"2021-09-07T00:00:00.000Z","formattedDate":"2021\u5e749\u67087\u65e5","tags":[{"label":"Authentication","permalink":"/zh/blog/tags/authentication"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":12.14,"truncated":true,"authors":[{"name":"\u6731\u6b23\u6b23","url":"https://github.com/starsz","imageURL":"https://avatars.githubusercontent.com/u/25628854?v=4"}],"prevItem":{"title":"\u4e0d\u5199\u4ee3\u7801\uff0c\u5982\u4f55\u4e3a\u5f00\u6e90\u9879\u76ee\u505a\u8d21\u732e\uff1f","permalink":"/zh/blog/2021/09/09/how-to-contribute-to-an-openSource-without-coding"},"nextItem":{"title":"\u57fa\u4e8e Apache APISIX\uff0c\u7231\u5947\u827a API \u7f51\u5173\u7684\u66f4\u65b0\u4e0e\u843d\u5730\u5b9e\u8df5","permalink":"/zh/blog/2021/09/07/iqiyi-usercase"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u7684\u8eab\u4efd\u8ba4\u8bc1\u529f\u80fd\uff0c\u4ece\u91cd\u8981\u6027\u548c\u73a9\u6cd5\u4f7f\u7528\u4e0a\u8fdb\u884c\u4e86\u8be6\u7ec6\u4ecb\u7ecd\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u8eab\u4efd\u8ba4\u8bc1\u5728\u65e5\u5e38\u751f\u6d3b\u5f53\u4e2d\u662f\u975e\u5e38\u5e38\u89c1\u7684\u4e00\u9879\u529f\u80fd\uff0c\u5927\u5bb6\u5e73\u65f6\u57fa\u672c\u90fd\u4f1a\u63a5\u89e6\u5230\u3002\u6bd4\u5982\u7528\u652f\u4ed8\u5b9d\u6d88\u8d39\u65f6\u7684\u4eba\u8138\u8bc6\u522b\u786e\u8ba4\u3001\u516c\u53f8\u4e0a\u73ed\u4e0b\u73ed\u65f6\u7684\u6307\u7eb9/\u9762\u90e8\u6253\u5361\u4ee5\u53ca\u7f51\u7ad9\u4e0a\u8fdb\u884c\u8d26\u53f7\u5bc6\u7801\u767b\u5f55\u64cd\u4f5c\u7b49\uff0c\u5176\u5b9e\u90fd\u662f\u8eab\u4efd\u8ba4\u8bc1\u7684\u573a\u666f\u4f53\u73b0\u3002\\n\\n![\u6982\u5ff5\u7406\u89e3](https://static.apiseven.com/202108/1631004418593-0a46f949-72aa-4cd4-8f38-1988327c92d6.png)\\n\\n\u5982\u4e0a\u56fe\uff0cJack \u901a\u8fc7\u8d26\u53f7\u5bc6\u7801\u8bf7\u6c42\u670d\u52a1\u7aef\u5e94\u7528\uff0c\u670d\u52a1\u7aef\u5e94\u7528\u4e2d\u9700\u8981\u6709\u4e00\u4e2a\u4e13\u95e8\u7528\u505a\u8eab\u4efd\u8ba4\u8bc1\u7684\u6a21\u5757\u6765\u5904\u7406\u8fd9\u90e8\u5206\u7684\u903b\u8f91\u3002\u8bf7\u6c42\u5904\u7406\u5b8c\u6bd5\u4e4b\u540e\uff0c\u5982\u679c\u4f7f\u7528 JWT Token \u8ba4\u8bc1\u65b9\u5f0f\uff0c\u670d\u52a1\u5668\u4f1a\u53cd\u9988\u4e00\u4e2a Token \u53bb\u6807\u8bc6\u8fd9\u4e2a\u7528\u6237\u4e3a Jack\u3002\u5982\u679c\u767b\u5f55\u8fc7\u7a0b\u4e2d\u8d26\u53f7\u5bc6\u7801\u8f93\u5165\u9519\u8bef\uff0c\u5c31\u4f1a\u5bfc\u81f4\u8eab\u4efd\u8ba4\u8bc1\u5931\u8d25\u3002\u8fd9\u4e2a\u573a\u666f\u5927\u5bb6\u80af\u5b9a\u90fd\u975e\u5e38\u719f\u6089\uff0c\u8fd9\u91cc\u5c31\u4e0d\u505a\u5c55\u5f00\u4e3e\u4f8b\u4e86\u3002\\n\\n## \u7f51\u7edc\u8eab\u4efd\u8ba4\u8bc1\u7684\u610f\u4e49\u5728\u54ea\u91cc\\n\\n### \u5b89\u5168\u6027\\n\\n\u8eab\u4efd\u8ba4\u8bc1\u786e\u4fdd\u4e86\u540e\u7aef\u670d\u52a1\u7684\u5b89\u5168\u6027\uff0c\u907f\u514d\u4e86\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\uff0c\u4ece\u800c\u786e\u4fdd\u6570\u636e\u7684\u5b89\u5168\u6027\u3002\u6bd4\u5982\u9632\u6b62\u67d0\u4e9b\u9ed1\u5ba2\u653b\u51fb\uff0c\u4ee5\u53ca\u4e00\u4e9b\u6076\u610f\u8c03\u7528\uff0c\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u901a\u8fc7\u8eab\u4efd\u8ba4\u8bc1\u8fdb\u884c\u963b\u62e6\u3002\\n\\n### \u5b9e\u7528\u6027\\n\\n\u4ece\u5b9e\u7528\u6027\u7684\u89d2\u5ea6\u8003\u8651\uff0c\u5b83\u53ef\u4ee5\u66f4\u65b9\u4fbf\u5730\u8bb0\u5f55\u64cd\u4f5c\u8005\u6216\u8c03\u7528\u65b9\u3002\u6bd4\u5982\u4e0a\u73ed\u6253\u5361\u5176\u5b9e\u5c31\u662f\u901a\u8fc7\u8bb0\u5f55\u300c\u8c01\u8fdb\u884c\u4e86\u8fd9\u9879\u64cd\u4f5c\u300d\u6765\u7edf\u8ba1\u5458\u5de5\u4e0a\u73ed\u4fe1\u606f\u3002\\n\\n\u5176\u6b21\u5b83\u53ef\u4ee5\u8bb0\u5f55\u8bbf\u95ee\u9891\u7387\u53ca\u8bbf\u95ee\u9891\u6b21\u3002\u4f8b\u5982\u8bb0\u5f55\u67d0\u7528\u6237\u5728\u6700\u8fd1\u51e0\u5206\u949f\u4e2d\u53d1\u8d77\u8bf7\u6c42\u7684\u9891\u7387\u548c\u9891\u6b21\uff0c\u53ef\u4ee5\u5224\u65ad\u8fd9\u4e2a\u7528\u6237\u6d3b\u8dc3\u7a0b\u5ea6\uff0c\u4e5f\u53ef\u4ee5\u5224\u65ad\u662f\u5426\u4e3a\u6076\u610f\u653b\u51fb\u7b49\u3002\\n\\n### \u529f\u80fd\u6027\\n\\n\u5728\u529f\u80fd\u5c42\u9762\uff0c\u5b83\u901a\u8fc7\u8bc6\u522b\u8eab\u4efd\u53ef\u4ee5\u5bf9\u4e0d\u540c\u7684\u8eab\u4efd\u8fdb\u884c\u4e0d\u540c\u6743\u9650\u7684\u64cd\u4f5c\u5904\u7406\u3002\u6bd4\u5982\u5728\u516c\u53f8\u91cc\uff0c\u4f60\u7684\u8eab\u4efd\u6743\u9650\u65e0\u6cd5\u4f7f\u7528\u67d0\u4e9b\u9875\u9762\u6216\u670d\u52a1\u3002\u518d\u7ec6\u81f4\u4e00\u70b9\uff0c\u5bf9\u4e0d\u540c\u8eab\u4efd\u6216\u8005\u4e0d\u540c\u7684 API \u63a5\u53e3\u8c03\u7528\u65b9\u505a\u4e00\u4e9b\u76f8\u5173\u6280\u672f\u4e0a\u7684\u9650\u5236\u7b56\u7565\uff0c\u5982\u9650\u6d41\u9650\u901f\u7b49\uff0c\u4ee5\u6b64\u6765\u8fbe\u5230\u6839\u636e\u4e0d\u540c\u7684\u7528\u6237\uff08\u8c03\u7528\u65b9\uff09\u91c7\u53d6\u4e0d\u540c\u7684\u529f\u80fd\u9650\u5236\u3002\\n\\n## \u4f7f\u7528 Apache APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u4f18\u70b9\\n\\n### \u4ece\u4f20\u7edf\u5230\u65b0\u6a21\u5f0f\\n\\n\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5de6\u4fa7\u7684\u56fe\u4e3a\u6211\u4eec\u5c55\u793a\u4e86\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u4f20\u7edf\u8eab\u4efd\u8ba4\u8bc1\u65b9\u6cd5\u3002\u6bcf\u4e00\u4e2a\u5e94\u7528\u670d\u52a1\u6a21\u5757\u53bb\u5f00\u53d1\u4e00\u4e2a\u5355\u72ec\u7684\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5757\uff0c\u7528\u6765\u652f\u6301\u8eab\u4efd\u8ba4\u8bc1\u7684\u4e00\u5957\u6d41\u7a0b\u5904\u7406\u3002\u4f46\u5f53\u670d\u52a1\u91cf\u591a\u4e86\u4e4b\u540e\uff0c\u5c31\u4f1a\u53d1\u73b0\u8fd9\u4e9b\u6a21\u5757\u7684\u5f00\u53d1\u5de5\u4f5c\u91cf\u90fd\u662f\u975e\u5e38\u5de8\u5927\u4e14\u91cd\u590d\u7684\u3002\\n\\n![Apache APISIX \u8eab\u4efd\u8ba4\u8bc1](https://static.apiseven.com/202108/1631004492221-0721d933-705d-4875-b956-e94a11a45135.png)\\n\\n\u8fd9\u79cd\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u628a\u8fd9\u90e8\u5206\u7684\u5f00\u53d1\u903b\u8f91\u653e\u7f6e\u5230 Apache APISIX \u7684\u7f51\u5173\u6765\u5b9e\u73b0\u7edf\u4e00\uff0c\u51cf\u5c11\u5f00\u53d1\u91cf\u3002\\n\\n\u56fe\u53f3\u6240\u793a\uff0c\u7528\u6237\u6216\u5e94\u7528\u65b9\u76f4\u63a5\u53bb\u8bf7\u6c42 Apache APISIX\uff0c\u7136\u540e Apache APISIX \u901a\u8fc7\u8bc6\u522b\u5e76\u8ba4\u8bc1\u901a\u8fc7\u540e\uff0c\u4f1a\u5c06\u9274\u522b\u7684\u8eab\u4efd\u4fe1\u606f\u4f20\u9012\u5230\u4e0a\u6e38\u5e94\u7528\u670d\u52a1\u3002\u4e4b\u540e\u4e0a\u6e38\u5e94\u7528\u670d\u52a1\u5c31\u53ef\u4ee5\u4ece\u8bf7\u6c42\u5934\u4e2d\u8bfb\u5230\u8fd9\u90e8\u5206\u4fe1\u606f\uff0c\u7136\u540e\u8fdb\u884c\u540e\u7eed\u76f8\u5173\u5de5\u4f5c\u7684\u5904\u7406\u3002\\n\\n\u8bb2\u5b8c\u4e86\u5927\u6982\u6d41\u7a0b\uff0c\u6211\u4eec\u6765\u8be6\u7ec6\u7f57\u5217\u4e0b\u3002\\n\\n### \u4f18\u70b9\u4e00\uff1a\u914d\u7f6e\u6536\u655b\uff0c\u7edf\u4e00\u7ba1\u7406\\n\\n![Dashboard](https://static.apiseven.com/202108/1631004574541-87b607eb-2971-4c1d-a1d6-74cf4a5fdd42.png)\\n\\n\u5982\u4e0a\u56fe\u662f\u4e00\u5f20 APISIX-Dashboard \u7684\u754c\u9762\u622a\u56fe\uff0c\u53ef\u4ee5\u770b\u5230\u8def\u7531\u3001Consumer \u7b49\u6570\u636e\u4fe1\u606f\u3002\u8fd9\u91cc\u7684 Consumer \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u5e94\u7528\u65b9\uff0c\u6bd4\u5982\u53ef\u4ee5\u4e3a\u5e94\u7528\u4e13\u95e8\u53bb\u521b\u5efa\u4e00\u4e2a Consumer \u5e76\u914d\u7f6e\u76f8\u5173\u7684\u8ba4\u8bc1\u63d2\u4ef6\uff0c\u4f8b\u5982 JWT\u3001Basic-Auth \u7b49\u63d2\u4ef6\u3002\u5f53\u6709\u65b0\u7684\u670d\u52a1\u51fa\u73b0\u65f6\uff0c\u6211\u4eec\u9700\u8981\u518d\u521b\u5efa\u4e00\u4e2a Consumer\uff0c\u7136\u540e\u5c06\u8fd9\u90e8\u5206\u914d\u7f6e\u4fe1\u606f\u7ed9\u914d\u7f6e\u5230\u7b2c\u4e8c\u4e2a\u5e94\u7528\u670d\u52a1\u4e0a\u3002\\n\\n\u901a\u8fc7\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\uff0c\u53ef\u4ee5\u5c06\u5ba2\u6237\u914d\u7f6e\u8fdb\u884c\u6536\u655b\u5e76\u7edf\u4e00\u7ba1\u7406\uff0c\u8fbe\u5230\u964d\u4f4e\u8fd0\u7ef4\u6210\u672c\u7684\u6548\u679c\u3002\\n\\n### \u4f18\u70b9\u4e8c\uff1a\u63d2\u4ef6\u4e30\u5bcc\uff0c\u51cf\u5c11\u5f00\u53d1\\n\\nApache APISIX \u4f5c\u4e3a\u4e00\u4e2a API \u7f51\u5173\uff0c\u76ee\u524d\u5df2\u5f00\u542f\u4e0e\u5404\u79cd\u63d2\u4ef6\u529f\u80fd\u7684\u9002\u914d\u5408\u4f5c\uff0c\u63d2\u4ef6\u5e93\u4e5f\u6bd4\u8f83\u4e30\u5bcc\u3002\u76ee\u524d\u5df2\u7ecf\u53ef\u4e0e\u5927\u91cf\u8eab\u4efd\u8ba4\u8bc1\u76f8\u5173\u7684\u63d2\u4ef6\u8fdb\u884c\u642d\u914d\u5904\u7406\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n![API \u7f51\u5173\u8ba4\u8bc1\u63d2\u4ef6](https://static.apiseven.com/202108/1631004738218-586e84af-a5ab-4714-845d-4d71b7ba79e3.png)\\n\\n\u57fa\u7840\u8ba4\u8bc1\u63d2\u4ef6\u6bd4\u5982 Key-Auth\u3001Basic-Auth\uff0c\u4ed6\u4eec\u662f\u901a\u8fc7\u8d26\u53f7\u5bc6\u7801\u7684\u65b9\u5f0f\u8fdb\u884c\u8ba4\u8bc1\u3002\\n\\n\u590d\u6742\u4e00\u4e9b\u7684\u8ba4\u8bc1\u63d2\u4ef6\u5982 Hmac-Auth\u3001JWT-Auth\u3002\u5982 Hmac-Auth \u901a\u8fc7\u5bf9\u8bf7\u6c42\u4fe1\u606f\u505a\u4e00\u4e9b\u52a0\u5bc6\uff0c\u751f\u6210\u4e00\u4e2a\u7b7e\u540d\u3002\u5f53 API \u8c03\u7528\u65b9\u5c06\u8fd9\u4e2a\u7b7e\u540d\u643a\u5e26\u5230 Apache APISIX \u7684\u7f51\u5173 Apache APISIX \u4f1a\u4ee5\u76f8\u540c\u7684\u7b97\u6cd5\u8ba1\u7b97\u7b7e\u540d\uff0c\u53ea\u6709\u5f53\u7b7e\u540d\u65b9\u548c\u5e94\u7528\u8c03\u7528\u65b9\u8ba4\u8bc1\u76f8\u540c\u65f6\u624d\u4e88\u4ee5\u901a\u8fc7\u3002\\n\\nAuthz-casbin \u63d2\u4ef6\u662f\u76ee\u524d Apche APISIX \u4e0e Casbin \u793e\u533a\u6b63\u5728\u8fdb\u884c\u5408\u4f5c\u5f00\u53d1\u7684\u4e00\u4e2a\u9879\u76ee\uff0c\u5b83\u7684\u5e94\u7528\u539f\u7406\u662f\u6309\u7167 Casbin \u7684\u89c4\u5219\uff0c\u53bb\u5904\u7406\u4e00\u4e9b\u57fa\u4e8e\u89d2\u8272\u7684\u6743\u9650\u7ba1\u63a7 (RBAC)\uff0c\u8fdb\u884c ACL \u76f8\u5173\u64cd\u4f5c\u3002\\n\\n\u5176\u4ed6\u5219\u662f\u4e00\u4e9b\u901a\u7528\u8ba4\u8bc1\u534f\u8bae\u548c\u8054\u5408\u7b2c\u4e09\u65b9\u7ec4\u4ef6\u8fdb\u884c\u5408\u4f5c\u7684\u8ba4\u8bc1\u534f\u8bae\uff0c\u4f8b\u5982 OpenID-Connect \u8eab\u4efd\u8ba4\u8bc1\u673a\u5236\uff0c\u4ee5\u53ca LDAP \u8ba4\u8bc1\u7b49\u3002\\n\\n### \u4f18\u70b9\u4e09\uff1a\u914d\u7f6e\u7075\u6d3b\uff0c\u529f\u80fd\u5f3a\u5927\\n\\n\u529f\u80fd\u5f3a\u5927\u8be5\u5982\u4f55\u7406\u89e3\uff0c\u5c31\u662f Apache APISIX \u4e2d\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e00\u4e2a Consumer\uff08\u5373\u8c03\u7528\u65b9\u5e94\u7528\uff09\u53bb\u505a\u4e0d\u540c\u7ea7\u522b\u7684\u63d2\u4ef6\u914d\u7f6e\u3002\\n\\n![\u914d\u7f6e\u7075\u6d3b](https://static.apiseven.com/202108/1631004783828-3dd0056c-a6aa-4ab9-b902-7bd2ca545ffe.png)\\n\\n\u5982\u4e0a\u56fe\uff0c\u6211\u4eec\u521b\u5efa\u4e86\u4e24\u4e2a\u6d88\u8d39\u8005 Consumer A\uff0cConsumer B\u3002\u6211\u4eec\u5c06 Consumer A \u5e94\u7528\u5230`\u5e94\u75281`\uff0c\u5219\u540e\u7eed`\u5e94\u75281`\u7684\u8bbf\u95ee\u5c06\u4f1a\u5f00\u542f Consumer A \u7684\u8fd9\u90e8\u5206\u63d2\u4ef6\uff0c\u4f8b\u5982 IP \u9ed1\u767d\u540d\u5355\uff0c\u9650\u5236\u5e76\u53d1\u6570\u91cf\u7b49\u3002\u5c06 Consumer B \u5e94\u7528\u5230`\u5e94\u75282` \uff0c\u7531\u4e8e\u5f00\u542f\u4e86 http-log \u63d2\u4ef6\uff0c\u5219`\u5e94\u75282`\u7684\u8bbf\u95ee\u65e5\u5fd7\u5c06\u4f1a\u901a\u8fc7 HTTP \u7684\u65b9\u5f0f\u53d1\u9001\u5230\u65e5\u5fd7\u7cfb\u7edf\u8fdb\u884c\u6536\u96c6\u3002\\n\\n## Apache APISIX \u4e2d\u8eab\u4efd\u8ba4\u8bc1\u7684\u73a9\u6cd5\\n\\n\u5173\u4e8e Apache APISIX \u8eab\u4efd\u8ba4\u8bc1\u7684\u73a9\u6cd5\uff0c\u8fd9\u91cc\u4e3a\u5927\u5bb6\u63d0\u4f9b\u4e09\u4e2a\u9636\u6bb5\u7684\u73a9\u6cd5\u63a8\u8350\uff0c\u5927\u5bb6\u4ec5\u4f5c\u53c2\u8003\uff0c\u4e5f\u53ef\u4ee5\u5728\u8fd9\u4e9b\u57fa\u7840\u4e0a\uff0c\u8fdb\u884c\u66f4\u6df1\u5ea6\u7684\u4f7f\u7528\u548c\u5e94\u7528\u3002\\n\\n### \u521d\u7ea7\uff1a\u666e\u901a\u73a9\u6cd5\\n\\n\u666e\u901a\u73a9\u6cd5\u63a8\u8350\u5927\u5bb6\u57fa\u4e8e Key-Auth\u3001Basic-Auth\u3001JWT- Auth \u548c Hmac-Auth \u8fdb\u884c\uff0c\u8fd9\u4e9b\u63d2\u4ef6\u7684\u4f7f\u7528\u9700\u8981\u4e0e Consumer \u8fdb\u884c\u5173\u8054\u4f7f\u7528\u3002\\n\\n#### \u6b65\u9aa4\u4e00\uff1a\u521b\u5efa\u8def\u7531\uff0c\u914d\u7f6e\u8eab\u4efd\u8ba4\u8bc1\u63d2\u4ef6\\n\\n\u521b\u5efa\u8def\u7531\uff0c\u914d\u7f6e\u4e0a\u6e38\u4e3a `httpbin.org`\uff0c\u540c\u65f6\u5f00\u542f `basic-auth` \u63d2\u4ef6\u3002\\n\\n![\u521b\u5efa\u8def\u7531](https://static.apiseven.com/202108/1631004892467-71c93f8f-dc0e-47fe-a88f-943adb9edbff.png)\\n\\n#### \u6b65\u9aa4\u4e8c\uff1a\u521b\u5efa\u6d88\u8d39\u8005\uff0c\u914d\u7f6e\u8eab\u4efd\u4fe1\u606f\\n\\n\u521b\u5efa\u6d88\u8d39\u8005 foo\u3002\u5728\u6d88\u8d39\u8005\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u914d\u7f6e\u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u4f8b\u5982 `username` \u4e3a foo\uff0c`password` \u4e3a `bar`\u3002\\n\\n![\u521b\u5efa\u6d88\u8d39\u8005](https://static.apiseven.com/202108/1631004937828-15ac5d8f-0e45-4c3d-94e8-2b180266b379.png)\\n\\n#### \u6b65\u9aa4\u4e09\uff1a\u5e94\u7528\u670d\u52a1\u643a\u5e26\u8ba4\u8bc1\u4fe1\u606f\u8fdb\u884c\u8bbf\u95ee\\n\\n\u5e94\u7528\u643a\u5e26 `username:foo` ,`password: bar` \u8bbf\u95ee Apache APISIX\u3002Apache APISIX \u901a\u8fc7\u8ba4\u8bc1\uff0c\u5e76\u5c06\u8bf7\u6c42 Authorization \u8bf7\u6c42\u5934\u643a\u5e26\u81f3\u4e0a\u6e38 `httpbin.org` \u3002\u7531\u4e8e `httpbin.org` \u4e2d get \u63a5\u53e3\u4f1a\u5c06\u8bf7\u6c42\u4fe1\u606f\u8fd4\u56de\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5728\u5176\u4e2d\u89c2\u5bdf\u5230\u8bf7\u6c42\u5934 `Authorization`\u3002\\n\\n![\u8bf7\u6c42\u643a\u5e26](https://static.apiseven.com/202108/1631004973305-4b209f79-f7de-41a2-994e-8877a6624d99.png)\\n\\n### \u4e2d\u7ea7\uff1a\u8fdb\u9636\u73a9\u6cd5\\n\\n\u8fdb\u9636\u6a21\u5f0f\u4e0b\uff0c\u662f\u4f7f\u7528 Apache APISIX \u4e0e OpenID-Connect \u63d2\u4ef6\u8fdb\u884c\u5bf9\u63a5\u7b2c\u4e09\u65b9\u8ba4\u8bc1\u670d\u52a1\u3002OpenID-Connect \u662f\u4e00\u79cd\u8ba4\u8bc1\u673a\u5236\uff0c\u53ef\u4ee5\u91c7\u7528\u8be5\u8ba4\u8bc1\u673a\u5236\u5bf9\u63a5\u7528\u6237\u7684\u7528\u6237\u7ba1\u7406\u7cfb\u7edf\u6216\u8005\u7528\u6237\u7ba1\u7406\u670d\u52a1\uff0c\u4f8b\u5982\u56fd\u5185\u7684 Authing \u548c\u817e\u8baf\u4e91\uff0c\u56fd\u5916\u7684 Okta \u548c Auth0 \u7b49\u3002\\n\\n![\u7b2c\u4e09\u65b9\u8ba4\u8bc1\u6a21\u5f0f](https://static.apiseven.com/202108/1631005002268-7393b40e-1733-4e66-bc09-742be221efae.png)\\n\\n\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff0c\u8fd9\u91cc\u4f7f\u7528 Okta \u4e91\u670d\u52a1\u4e3e\u4f8b\uff1a\\n\\n#### \u6b65\u9aa4\u4e00\uff1a\u521b\u5efa OpenID-Connect \u5e94\u7528\\n\\n\u5728 Okta \u63a7\u5236\u53f0\u9875\u9762\u521b\u5efa\u4e00\u4e2a\u652f\u6301 OpenID-Connect \u7684\u5e94\u7528\u3002\\n\\n![\u521b\u5efa](https://static.apiseven.com/202108/1631005022640-1e931b14-8175-47f3-bfb8-46e09cec616b.png)\\n\\n#### \u6b65\u9aa4\u4e8c\uff1a\u521b\u5efa\u8def\u7531\uff0c\u914d\u7f6e OpenID-Connect \u63d2\u4ef6\\n\\n\u521b\u5efa\u8def\u7531\uff0c\u914d\u7f6e\u8bbf\u95ee\u7684\u4e0a\u6e38\u5730\u5740\u4e3a httpbin.org\uff0c\u540c\u65f6\u5f00\u542f openid-connect \u63d2\u4ef6\uff0c\u5c06 Okta \u5e94\u7528\u7684\u914d\u7f6e\u586b\u5199\u5230 openid-connect \u63d2\u4ef6\u4e2d\u3002\\n\\n![\u914d\u7f6e\u63d2\u4ef6](https://static.apiseven.com/202108/1631005045489-b637ef9a-c71c-440f-ae58-a93398a4c9dd.png)\\n\\n#### \u6b65\u9aa4\u4e09\uff1a\u7528\u6237\u8bbf\u95ee\u65f6\uff0c\u4f1a\u8df3\u8f6c\u81f3\u767b\u5f55\u9875\u9762\u3002\u767b\u5f55\u5b8c\u6210\u540e\uff0c\u4e0a\u6e38\u5e94\u7528\u83b7\u53d6\u7528\u6237\u4fe1\u606f\\n\\n\u6b64\u65f6\uff0c\u5f53\u7528\u6237\u8bbf\u95ee Apache APISIX \u65f6\uff0c\u4f1a\u5148\u91cd\u5b9a\u5411\u5230 Okta \u767b\u5f55\u9875\u9762\u3002\u6b64\u65f6\u9700\u8981\u5728\u8be5\u9875\u9762\u586b\u5199 Okta \u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u7528\u6237\u7684\u8d26\u53f7\u5bc6\u7801\u3002\u767b\u9646\u5b8c\u6210\u4e4b\u540e\uff0cApache APISIX \u4f1a\u5c06\u672c\u6b21\u8ba4\u8bc1\u7684 Access-Token\uff0cID-Token \u643a\u5e26\u81f3\u4e0a\u6e38\uff0c\u540c\u65f6\u5c06\u672c\u6b21\u8ba4\u8bc1\u7684\u7528\u6237\u4fe1\u606f\u4ee5 base64 \u7684\u65b9\u5f0f\u7f16\u7801\u81f3 Userinfo \u8bf7\u6c42\u5934\uff0c\u4f20\u9012\u81f3\u4e0a\u6e38\u3002\\n\\n![APISIX \u9875\u9762](https://static.apiseven.com/202108/1631005077846-0f877a03-ddcd-46f6-a38d-f046b4700058.png)\\n\\n## \u9ad8\u7ea7\uff1aDIY \u73a9\u6cd5\\n\\n\u8fd9\u91cc\u63d0\u4f9b\u7684 DIY \u73a9\u6cd5\u662f\u5229\u7528\u4e86 Serverless \u63d2\u4ef6\uff0c\u8fd9\u6b3e\u63d2\u4ef6\u529f\u80fd\u4e30\u5bcc\uff0c\u73a9\u6cd5\u4e5f\u975e\u5e38\u591a\u3002\u5927\u5bb6\u5982\u679c\u6709\u81ea\u5df1\u7684\u4f7f\u7528\u73a9\u6cd5\uff0c\u4e5f\u6b22\u8fce\u5728\u793e\u533a\u5185\u8fdb\u884c\u4ea4\u6d41\u3002\\n\\n\u5177\u4f53\u64cd\u4f5c\u6d41\u7a0b\u5c31\u662f\u5c06\u81ea\u5df1\u7684\u4ee3\u7801\u7247\u6bb5\u901a\u8fc7 Serverless \u63d2\u4ef6\u4e0a\u4f20\u5230 Apache APISIX\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d Serverless \u63d2\u4ef6\u652f\u6301\u52a8\u6001\u914d\u7f6e\u548c\u70ed\u66f4\u65b0\u3002\\n\\n### \u65b9\u5f0f\u4e00\uff1a\u81ea\u5b9a\u4e49\u5224\u65ad\u903b\u8f91\\n\\n![\u5224\u65ad\u903b\u8f91](https://static.apiseven.com/202108/1631005112469-c04868b8-388e-4b81-abcc-d37b6a8951f5.png)\\n\\n\u901a\u8fc7\u8bf7\u6c42\u5934\u3001\u53c2\u6570\u7b49\u76f8\u5173\u4fe1\u606f\uff0c\u6765\u8fdb\u884c\u4e00\u4e9b\u5224\u65ad\u3002\u901a\u8fc7\u8fd9\u79cd\u505a\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u53bb\u5b9e\u73b0\u81ea\u5df1\u7684\u4e00\u4e9b\u89c4\u5219\uff0c\u6bd4\u5982\u8bf4\u7ed3\u5408\u4f01\u4e1a\u5185\u90e8\u7684\u4e00\u4e9b\u8ba4\u8bc1\uff0c\u6216\u8005\u53bb\u5199\u4e00\u4e9b\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91\u3002\\n\\n### \u65b9\u5f0f\u4e8c\uff1a\u53d1\u8d77\u8ba4\u8bc1\u9274\u6743\u8bf7\u6c42\\n\\n![\u9274\u6743\u8bf7\u6c42](https://static.apiseven.com/202108/1631005141578-f90cf948-4913-45cd-a28e-9e697ad197fe.png)\\n\\n\u901a\u8fc7 HTTP \u5e93\u53d1\u8d77\u4e00\u4e2a HTTP \u8bf7\u6c42\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u7b2c\u4e09\u65b9\u670d\u52a1\u505a\u4e00\u4e9b\u8ba4\u8bc1\u3001\u9274\u6743\u76f8\u5173\u4e8b\u60c5\uff0c\u7136\u540e\u89e3\u6790\u8fd4\u56de\u7ed3\u679c\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u7684\u4e8b\u60c5\u5c31\u53ef\u4ee5\u6269\u5c55\u5f88\u591a\u3002\u6bd4\u5982\u5bf9\u63a5 Redis \u6216\u6570\u636e\u5e93\uff0c\u53ea\u8981\u662f\u901a\u8fc7 TCP \u6216 UDP \u8fd9\u79cd\u5f62\u5f0f\u7684\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7 Serverless \u63d2\u4ef6\u8fdb\u884c\u5c1d\u8bd5\u3002\\n\\n### \u914d\u7f6e\u4e0a\u4f20\\n\\n\u5b8c\u6210\u81ea\u5b9a\u4e49\u4ee3\u7801\u7247\u4e4b\u540e\uff0c\u6211\u4eec\u521b\u5efa\u8def\u7531\uff0c\u5e76\u5c06\u4ee3\u7801\u7247\u914d\u7f6e\u5230 Serverless \u63d2\u4ef6\u3002\u540e\u9762\u518d\u901a\u8fc7\u8bbf\u95ee Apache APISIX \u83b7\u53d6\u76f8\u5e94\u7684\u4fe1\u606f\u53cd\u9988\uff0c\u6d4b\u8bd5\u63d2\u4ef6\u662f\u5426\u751f\u6548\u3002\\n\\n![\u914d\u7f6e\u4e0a\u4f20](https://static.apiseven.com/202108/1631005184917-bc620c0b-d4c6-43f5-8450-4f5b2b9549e1.png)"},{"id":"2021/09/07/iqiyi-usercase","metadata":{"permalink":"/zh/blog/2021/09/07/iqiyi-usercase","source":"@site/blog/2021/09/07/iQIYI-usercase.md","title":"\u57fa\u4e8e Apache APISIX\uff0c\u7231\u5947\u827a API \u7f51\u5173\u7684\u66f4\u65b0\u4e0e\u843d\u5730\u5b9e\u8df5","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u7231\u5947\u827a\u4e3a\u4f55\u653e\u5f03 Kong \u800c\u9009\u62e9\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4f5c\u4e3a\u516c\u53f8\u7f51\u5173\u4ee5\u53ca APISIX \u5728\u7231\u5947\u827a\u516c\u53f8\u5185\u90e8\u7684\u5e94\u7528\u573a\u666f\u3002","date":"2021-09-07T00:00:00.000Z","formattedDate":"2021\u5e749\u67087\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":12.585,"truncated":true,"authors":[{"name":"\u4f55\u806a"}],"prevItem":{"title":"\u5982\u4f55\u4f7f\u7528 APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1","permalink":"/zh/blog/2021/09/07/how-to-use-apisix-auth"},"nextItem":{"title":"Python \u52a9\u4f60\u5feb\u901f\u4e0a\u624b Apache APISIX \u63d2\u4ef6\u5f00\u53d1","permalink":"/zh/blog/2021/09/06/python-helps-you-quickly-with-apache-apisix-development"}},"content":"> \u7231\u5947\u827a\u5728\u4e4b\u524d\u6709\u5f00\u53d1\u4e86\u4e00\u6b3e\u7f51\u5173\u2014\u2014Skywalker\uff0c\u5b83\u662f\u57fa\u4e8e Kong \u505a\u7684\u4e8c\u6b21\u5f00\u53d1\uff0c\u76ee\u524d\u6d41\u91cf\u4f7f\u7528\u4e5f\u662f\u6bd4\u8f83\u5927\u7684\uff0c\u7f51\u5173\u5b58\u91cf\u4e1a\u52a1\u65e5\u5e38\u5cf0\u503c\u4e3a\u767e\u4e07\u7ea7\u522b QPS\uff0cAPI \u8def\u7531\u6570\u91cf\u4e0a\u4e07\u3002\u4f46\u8fd9\u6b3e\u4ea7\u54c1\u7684\u4e0d\u8db3\u968f\u7740\u4f7f\u7528\u4e5f\u5f00\u59cb\u9010\u6b65\u4f53\u73b0\u3002\u4eca\u5e74\u5728\u4ea4\u63a5\u5230\u6b64\u9879\u76ee\u540e\uff0c\u6211\u4eec\u6839\u636e\u4e0a\u8ff0\u95ee\u9898\u548c\u56f0\u5883\uff0c\u5f00\u59cb\u5bf9\u76f8\u5173\u7f51\u5173\u7c7b\u4ea7\u54c1\u505a\u4e86\u4e00\u4e9b\u8c03\u7814\uff0c\u7136\u540e\u53d1\u73b0\u4e86 Apache APISIX\u3002\u5728\u9009\u62e9 Apache APISIX \u4e4b\u524d\uff0c\u7231\u5947\u827a\u5e73\u53f0\u5df2\u7ecf\u5728\u4f7f\u7528 Kong \u4e86\uff0c\u4f46\u662f\u540e\u6765 Kong \u88ab\u653e\u5f03\u4e86\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u80cc\u666f\u63cf\u8ff0\\n\\n\u7231\u5947\u827a\u5728\u4e4b\u524d\u6709\u5f00\u53d1\u4e86\u4e00\u6b3e\u7f51\u5173\u2014\u2014Skywalker\uff0c\u5b83\u662f\u57fa\u4e8e Kong \u505a\u7684\u4e8c\u6b21\u5f00\u53d1\uff0c\u76ee\u524d\u6d41\u91cf\u4f7f\u7528\u4e5f\u662f\u6bd4\u8f83\u5927\u7684\uff0c\u7f51\u5173\u5b58\u91cf\u4e1a\u52a1**\u65e5\u5e38\u5cf0\u503c\u4e3a\u767e\u4e07\u7ea7\u522b QPS\uff0cAPI \u8def\u7531\u6570\u91cf\u4e0a\u4e07**\u3002\u4f46\u8fd9\u6b3e\u4ea7\u54c1\u7684\u4e0d\u8db3\u968f\u7740\u4f7f\u7528\u4e5f\u5f00\u59cb\u9010\u6b65\u4f53\u73b0\u3002\\n\\n1. \u6027\u80fd\u5dee\u5f3a\u4eba\u610f\uff0c\u56e0\u4e3a\u4e1a\u52a1\u91cf\u5927\uff0c\u6bcf\u5929\u6536\u5230\u5f88\u591a CPU IDLE \u8fc7\u4f4e\u7684\u544a\u8b66\\n\\n2. \u7cfb\u7edf\u67b6\u6784\u7684\u7ec4\u4ef6\u4f9d\u8d56\u591a\\n\\n3. \u8fd0\u7ef4\u5f00\u53d1\u6210\u672c\u8f83\u9ad8\\n\\n\u4eca\u5e74\u5728\u4ea4\u63a5\u5230\u6b64\u9879\u76ee\u540e\uff0c\u6211\u4eec\u6839\u636e\u4e0a\u8ff0\u95ee\u9898\u548c\u56f0\u5883\uff0c\u5f00\u59cb\u5bf9\u76f8\u5173\u7f51\u5173\u7c7b\u4ea7\u54c1\u505a\u4e86\u4e00\u4e9b\u8c03\u7814\uff0c\u7136\u540e\u53d1\u73b0\u4e86 Apache APISIX\u3002\\n\\n## Apache APISIX \u4f18\u52bf\\n\\n\u5728\u9009\u62e9 Apache APISIX \u4e4b\u524d\uff0c\u7231\u5947\u827a\u5e73\u53f0\u5df2\u7ecf\u5728\u4f7f\u7528 Kong \u4e86\uff0c\u4f46\u662f\u540e\u6765 Kong \u88ab\u653e\u5f03\u4e86\u3002\\n\\n### \u4e3a\u4ec0\u4e48\u653e\u5f03 Kong\\n\\n![Kong \u7684\u7f3a\u70b9](https://static.apiseven.com/202108/1630995514489-6f7b382a-ed2d-46ad-8ded-4dda42ed3bc8.png)\\n\\nKong \u4f7f\u7528 PostgreSQL \u6765\u5b58\u50a8\u5b83\u7684\u4fe1\u606f\uff0c\u8fd9\u663e\u7136\u4e0d\u662f\u4e00\u4e2a\u597d\u65b9\u5f0f\u3002 \u540c\u65f6\u5728\u8c03\u7814\u8fc7\u7a0b\u4e2d\u6211\u4eec\u67e5\u770b\u4e86 Apache APISIX \u4e0e Kong \u7684\u6027\u80fd\u7684\u5bf9\u6bd4\uff0c\u5728\u6027\u80fd\u4f18\u5316\u65b9\u9762 Apache APISIX \u6bd4 Kong \u63d0\u5347\u4e86 10 \u500d\uff0c\u8fd9\u4e2a\u6307\u6807\u662f\u975e\u5e38\u8ba9\u4eba\u60ca\u559c\u7684\u3002 \u540c\u65f6\u6211\u4eec\u4e5f\u6bd4\u8f83\u4e86\u4e00\u4e9b\u4e3b\u8981\u7684\u7f51\u5173\u4ea7\u54c1\uff0cApache APISIX \u7684\u54cd\u5e94\u5ef6\u8fdf\u6bd4\u5176\u5b83\u7f51\u5173\u4f4e 50% \u4ee5\u4e0a\uff0c\u5728 CPU \u8fbe\u5230 70% \u4ee5\u4e0a\u65f6 Apache APISIX \u4ecd\u80fd\u7a33\u5b9a\u8fd0\u8f6c\u3002\\n\\n\u6211\u4eec\u4e5f\u53d1\u73b0 Apache APISIX \u5176\u5b9e\u548c Kong \u4e00\u6837\uff0c\u90fd\u662f\u57fa\u4e8e OpenResty \u6280\u672f\u5c42\u9762\u505a\u7684\u5f00\u53d1\uff0c\u6240\u4ee5\u5728\u6280\u672f\u5c42\u9762\u7684\u8fc1\u79fb\u6210\u672c\u5c31\u6bd4\u8f83\u4f4e\u3002\u800c\u4e14 Apache APISIX \u5177\u6709\u826f\u597d\u7684\u73af\u5883\u9002\u5e94\u6027\uff0c\u80fd\u591f\u88ab\u8f7b\u6613\u5730\u90e8\u7f72\u5728\u5305\u62ec\u4e91\u8ba1\u7b97\u5e73\u53f0\u5728\u5185\u7684\u5404\u79cd\u73af\u5883\u4e0a\u3002\\n\\n\u540c\u65f6\u4e5f\u770b\u5230 Apache APISIX \u6574\u4e2a\u5f00\u6e90\u9879\u76ee\u7684\u6d3b\u8dc3\u5ea6\u975e\u5e38\u9ad8\uff0c\u5bf9\u95ee\u9898\u7684\u5904\u7406\u975e\u5e38\u8fc5\u901f\uff0c\u5e76\u4e14\u9879\u76ee\u7684\u4e91\u539f\u751f\u67b6\u6784\u4e5f\u7b26\u5408\u6211\u53f8\u540e\u7eed\u89c4\u5212\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u62e9\u4e86 Apache APISIX\u3002\\n\\n## \u57fa\u4e8e Apache APISIX \u4e0b\u7684\u7231\u5947\u827a\u7f51\u5173\u67b6\u6784\\n\\n\u7231\u5947\u827a\u7f51\u5173\u7684\u603b\u4f53\u67b6\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5305\u542b\u57df\u540d\u3001\u7f51\u5173\u5230\u670d\u52a1\u5b9e\u4f8b\u548c\u76d1\u63a7\u544a\u8b66\u3002DPVS \u662f\u516c\u53f8\u5185\u90e8\u57fa\u4e8e LVS \u505a\u7684\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0cHubble \u76d1\u63a7\u544a\u8b66\u4e5f\u662f\u57fa\u4e8e\u5f00\u6e90\u9879\u76ee\u505a\u7684\u6df1\u5ea6\u4e8c\u6b21\u5f00\u53d1\uff0cConsul \u8fd9\u5757\u505a\u4e86\u4e9b\u6027\u80fd\u548c\u9ad8\u53ef\u7528\u6027\u65b9\u9762\u7684\u4f18\u5316\u3002\\n\\n![\u7231\u5947\u827a\u7f51\u5173\u67b6\u6784\u56fe](https://static.apiseven.com/202108/1630995637366-b42e408b-53ea-47fb-b282-e68042f13090.png)\\n\\n### \u5e94\u7528\u573a\u666f\u4e00\uff1a\u5fae\u670d\u52a1\u7f51\u5173\\n\\n\u5173\u4e8e\u7f51\u5173\u8fd9\u5757\uff0c\u7b80\u5355\u4ece\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\u4ecb\u7ecd\u4e00\u4e0b\u3002\\n\\n![\u7f51\u5173\u7ec6\u8282\u56fe](https://static.apiseven.com/202108/1630995699492-bdc1c560-2c0a-4db0-82c9-2a5391941863.png)\\n\\n\u6570\u636e\u9762\u4e3b\u8981\u9762\u5411\u524d\u7aef\u7528\u6237\uff0c\u4ece LB \u5230\u7f51\u5173\u6574\u4e2a\u67b6\u6784\u90fd\u662f\u591a\u5730\u591a\u94fe\u8def\u707e\u5907\u90e8\u7f72\uff0c\u4ee5\u7528\u6237\u5c31\u8fd1\u63a5\u5165\u539f\u5219\u8fdb\u884c\u5e03\u70b9\u3002\\n\\n\u4ece\u63a7\u5236\u9762\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u56e0\u4e3a\u591a\u96c6\u7fa4\u6784\u6210\uff0c\u4f1a\u5b58\u5728\u4e00\u4e2a\u5fae\u670d\u52a1\u5e73\u53f0\uff0c\u53bb\u505a\u96c6\u7fa4\u7ba1\u7406\u548c\u670d\u52a1\u7ba1\u7406\u3002\u5fae\u670d\u52a1\u5e73\u53f0\u53ef\u4ee5\u8ba9\u7528\u6237\u4f53\u9a8c\u670d\u52a1\u66b4\u9732\u7684\u4e00\u7ad9\u5f0f\u670d\u52a1\uff0c\u7acb\u5373\u4f7f\u7528\uff0c\u65e0\u9700\u63d0\u4ea4\u5de5\u5355\u3002\u63a7\u5236\u9762\u540e\u7aef\u4f1a\u6709 Gateway Controller \u548c Service Controller\uff0c\u524d\u8005\u4e3b\u8981\u63a7\u5236\u6240\u6709\u7684 API \u7684\u521b\u5efa\u3001\u63d2\u4ef6\u7b49\u76f8\u5173\u914d\u7f6e\uff0c\u540e\u8005\u5219\u662f\u63a7\u5236\u670d\u52a1\u6ce8\u518c\u6ce8\u9500\u548c\u5065\u5eb7\u68c0\u67e5\u3002\\n\\n### \u5e94\u7528\u573a\u666f\u4e8c\uff1a\u57fa\u7840\u529f\u80fd\\n\\n\u76ee\u524d\u9636\u6bb5\uff0c\u57fa\u4e8e Apache APISIX \u8c03\u6574\u540e\u7684 API \u67b6\u6784\u5b9e\u73b0\u4e86\u4e00\u4e9b\u57fa\u7840\u529f\u80fd\uff0c\u5982\u9650\u6d41\u3001\u8ba4\u8bc1\u3001\u62a5\u8b66\u3001\u76d1\u63a7\u7b49\u3002\\n\\n![\u5fae\u670d\u52a1\u5e73\u53f0\u529f\u80fd](https://static.apiseven.com/202108/1630995732178-1717dd1a-3cdf-4f34-aea2-9a26df1c37c1.png)\\n\\n\u9996\u5148\u662f HTTPS \u90e8\u5206\uff0c\u7231\u5947\u827a\u65b9\u9762\u51fa\u4e8e\u5bf9\u5b89\u5168\u6027\u7684\u8003\u8651\uff0c\u8bc1\u4e66\u548c\u5bc6\u94a5\u662f\u4e0d\u4f1a\u5b58\u653e\u5728\u7f51\u5173\u673a\u5668\u4e0a\uff0c\u4f1a\u653e\u5728\u4e00\u4e2a\u4e13\u95e8\u7684\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u3002\u4e4b\u524d\u4f7f\u7528 Kong \u65f6\u6211\u4eec\u6ca1\u6709\u5728\u8fd9\u65b9\u9762\u505a\u76f8\u5173\u652f\u6301\uff0c\u91c7\u7528\u524d\u7f6e Nginx \u505a HTTPS Offload\uff0c\u6b64\u6b21\u8fc1\u79fb\u5230 Apache APISIX \u540e\uff0c\u6211\u4eec\u5728 Apache APISIX \u4e0a\u5b9e\u73b0\u4e86\u8be5\u529f\u80fd\uff0c\u4ece\u94fe\u8def\u4e0a\u6765\u8bf4\u5c31\u5c11\u4e86\u4e00\u5c42\u8f6c\u53d1\u3002\\n\\n\u5728\u9650\u6d41\u529f\u80fd\u4e0a\uff0c\u9664\u4e86\u57fa\u7840\u7684\u9650\u6d41\uff0c\u8fd8\u6dfb\u52a0\u4e86\u7cbe\u51c6\u9650\u6d41\u4ee5\u53ca\u9488\u5bf9\u7528\u6237\u7c92\u5ea6\u7684\u9650\u6d41\u3002\u8ba4\u8bc1\u529f\u80fd\u4e0a\uff0c\u9664\u4e86\u57fa\u672c\u7684 API Key \u7b49\u8ba4\u8bc1\uff0c\u9488\u5bf9\u4e13\u95e8\u4e1a\u52a1\u4e5f\u63d0\u4f9b\u4e86\u76f8\u5173\u7684 Passport \u8ba4\u8bc1\u3002\u5bf9\u4e8e\u9ed1\u4ea7\u7684\u8fc7\u6ee4\uff0c\u5219\u63a5\u5165\u4e86\u516c\u53f8\u7684 WAF \u5b89\u5168\u4e91\u3002\\n\\n\u76d1\u63a7\u529f\u80fd\u7684\u5b9e\u73b0\u76ee\u524d\u662f\u4f7f\u7528\u4e86 Apache APISIX \u81ea\u5e26\u63d2\u4ef6\u2014\u2014Prometheus\uff0c\u6307\u6807\u6570\u636e\u4f1a\u76f4\u63a5\u5bf9\u63a5\u516c\u53f8\u7684\u76d1\u63a7\u7cfb\u7edf\u3002\u65e5\u5fd7\u548c\u8c03\u7528\u94fe\u5206\u6790\u4e5f\u901a\u8fc7 Apache APISIX \u5f97\u5230\u4e86\u76f8\u5173\u529f\u80fd\u652f\u6301\u3002\\n\\n### \u5e94\u7528\u573a\u666f\u4e09\uff1a\u670d\u52a1\u53d1\u73b0\\n\\n\u5173\u4e8e\u524d\u9762\u63d0\u5230\u7684\u670d\u52a1\u53d1\u73b0\uff0c\u4e3b\u8981\u662f\u901a\u8fc7\u670d\u52a1\u4e2d\u5fc3\u628a\u670d\u52a1\u6ce8\u518c\u5230 Consul \u96c6\u7fa4\uff0c\u7136\u540e\u901a\u8fc7 DNS \u670d\u52a1\u53d1\u73b0\u7684\u65b9\u5f0f\u53bb\u505a\u52a8\u6001\u66f4\u65b0\uff0c\u5176\u4e2d QAE \u662f\u6211\u4eec\u516c\u53f8\u5185\u90e8\u7684\u4e00\u4e2a\u5fae\u670d\u52a1\u5e73\u53f0\u3002\u7b80\u5355\u4e3e\u4f8b\u8bf4\u660e\u4e00\u4e0b\u66f4\u65b0\u540e\u7aef\u5e94\u7528\u5b9e\u4f8b\u65f6\u7684\u5927\u4f53\u6d41\u7a0b\u3002\\n\\n![\u670d\u52a1\u53d1\u73b0\u6d41\u7a0b](https://static.apiseven.com/202108/1630995762178-b807f5fe-8851-4f10-acdc-fbf1c372b12f.png)\\n\\n\u5b9e\u4f8b\u53d8\u66f4\u65f6\uff0c\u9996\u5148\u4f1a\u4ece Consul \u4e2d\u6ce8\u9500\u5bf9\u5e94\u8282\u70b9\uff0c\u5e76\u901a\u8fc7 API \u7f51\u5173 Controller \u5411\u7f51\u5173\u53d1\u9001\u66f4\u65b0 DNS \u7f13\u5b58\u7684\u8bf7\u6c42\u3002\u7f13\u5b58\u66f4\u65b0\u6210\u529f\u540e\uff0cController \u518d\u53cd\u9988 QAE \u5e73\u53f0\u53ef\u4ee5\u505c\u6b62\u76f8\u5173\u540e\u7aef\u5e94\u7528\u8282\u70b9\uff0c\u907f\u514d\u4e1a\u52a1\u6d41\u91cf\u518d\u8f6c\u53d1\u5230\u5df2\u4e0b\u7ebf\u8282\u70b9\u3002\\n\\n### \u5e94\u7528\u573a\u666f\u56db\uff1a\u5b9a\u5411\u8def\u7531\\n\\n![\u5b9a\u5411\u8def\u7531\u64cd\u4f5c](https://static.apiseven.com/202108/1630995803596-e8d73d5d-29e0-4f66-b3bd-976d650bafcb.png)\\n\\n\u7f51\u5173\u662f\u591a\u5730\u90e8\u7f72\u7684\uff0c\u4e8b\u5148\u642d\u5efa\u597d\u4e00\u6574\u5957\u591a\u5730\u4e92\u5907\u94fe\u8def\uff0c\u540c\u65f6\u5efa\u8bae\u7528\u6237\u540e\u7aef\u670d\u52a1\u4e5f\u662f\u591a\u5730\u5c31\u8fd1\u90e8\u7f72\u3002\u968f\u540e\u7528\u6237\u5728 Skywalker \u7f51\u5173\u5e73\u53f0\u4e0a\u521b\u5efa\u4e00\u4e2a API \u670d\u52a1\uff0cController \u4f1a\u5728\u5168 DC \u7f51\u5173\u96c6\u7fa4\u4e0a\u90fd\u90e8\u7f72\u597d API \u8def\u7531\uff0c\u540c\u65f6\u4e1a\u52a1\u57df\u540d\u9ed8\u8ba4 CNAME \u5230\u7edf\u4e00\u7684\u7f51\u5173\u57df\u540d\u4e0a\u3002\\n\\n\u76f4\u63a5\u4e3a\u4e1a\u52a1\u63d0\u4f9b\u591a\u5730\u5c31\u8fd1\u63a5\u5165\u3001\u6545\u969c\u707e\u5907\u5207\u6362\u80fd\u529b\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49\u89e3\u6790\u8def\u7531\u3002\u9488\u5bf9\u7528\u6237\u81ea\u8eab\u7684\u6545\u969c\u5207\u6d41\u3001\u84dd\u7eff\u90e8\u7f72\u3001\u7070\u5ea6\u53d1\u5e03\u7b49\u9700\u6c42\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u91c7\u7528 uuid \u57df\u540d\u6765\u81ea\u5b9a\u4e49\u89e3\u6790\u8def\u7531\u914d\u7f6e\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u540e\u7aef\u670d\u52a1\u53d1\u73b0\u7684\u81ea\u5b9a\u4e49\u8c03\u5ea6\u3002\\n\\n### \u5e94\u7528\u573a\u666f\u4e94\uff1a\u591a\u5730\u591a\u7ea7\u5bb9\u707e\\n\\n\u524d\u8fb9\u6211\u4eec\u4e5f\u63d0\u5230\u8fc7\uff0c\u9488\u5bf9\u4e1a\u52a1\u91cf\u5927\u3001\u96c6\u7fa4\u591a\uff0c\u8fd8\u6709\u5ba2\u6237\u7aef\u53d7\u4f17\u5e7f\u7684\u60c5\u51b5\uff0c\u5728\u4e1a\u52a1\u5c42\u9762\u6211\u4eec\u4f1a\u6709\u4e1a\u52a1\u5c31\u8fd1\u63a5\u5165\u548c\u707e\u5907\u7684\u9700\u6c42\u3002\\n\\n\u9488\u5bf9\u707e\u5907\uff0c\u9664\u4e86\u8981\u591a\u5730\u591a\u94fe\u8def\u4e92\u5907\uff0c\u8fd8\u8981\u8003\u8651\u591a\u7ea7\u591a\u8282\u70b9\u95ee\u9898\uff0c\u6545\u969c\u8282\u70b9\u8d8a\u5411\u5ba2\u6237\u7aef\u9760\u8fd1\uff0c\u53d7\u5f71\u54cd\u7684\u4e1a\u52a1\u548c\u6d41\u91cf\u8d8a\u5927\u3002\\n\\n1. \u5982\u679c\u662f\u6700\u8fdc\u7684\u540e\u7aef\u670d\u52a1\u8282\u70b9\u6545\u969c\uff0c\u4f9d\u9760\u7f51\u5173\u548c\u670d\u52a1\u4e2d\u5fc3\u7684\u5065\u5eb7\u68c0\u67e5\u673a\u5236\uff0c\u53ef\u4ee5\u5b9e\u73b0\u6545\u969c\u5355\u8282\u70b9\u7684\u7194\u65ad\u6216\u8005\u6545\u969c DC \u7684\u5207\u6362\uff0c\u5f71\u54cd\u8303\u56f4\u9650\u5236\u5728\u6307\u5b9a\u4e1a\u52a1\u4e0a\uff0c\u7528\u6237\u65e0\u611f\u77e5\u3002\\n2. \u5982\u679c\u662f\u7f51\u5173\u7ea7\u522b\u6545\u969c\uff0c\u9700\u8981\u4f9d\u9760 L4 DPVS \u7684\u5065\u5eb7\u68c0\u67e5\u673a\u5236\uff0c\u7194\u65ad\u6545\u969c\u7f51\u5173\u8282\u70b9\uff0c\u5f71\u54cd\u8303\u56f4\u5c0f\uff0c\u7528\u6237\u65e0\u611f\u77e5\u3002\\n3. \u5982\u679c\u6545\u969c\u70b9\u5e76\u975e\u4e0a\u8ff0\u8ff0\u7194\u65ad\u63aa\u65bd\u6240\u80fd\u4fee\u590d\uff0c\u5c31\u9700\u8981\u4f9d\u9760\u57df\u540d\u7c92\u5ea6\u7684\u5916\u7f51\u591a\u70b9\u53ef\u7528\u6027\u62e8\u6d4b\uff0c\u5b9e\u73b0\u57df\u540d\u89e3\u6790\u7ea7\u522b\u7684\u6545\u969c\u81ea\u52a8\u5207\u6362\uff0c\u8fd9\u79cd\u65b9\u5f0f\u6545\u969c\u4fee\u590d\u901f\u5ea6\u76f8\u5bf9\u8f83\u6162\uff0c\u5f71\u54cd\u4e1a\u52a1\u591a\uff0c\u7528\u6237\u53ef\u611f\u77e5\u3002\\n\\n## \u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u95ee\u9898\\n\\n\u5728\u6211\u4eec\u4ece Kong \u5230 Apache APISIX \u7684\u8fc1\u79fb\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u89e3\u51b3\u3001\u4f18\u5316\u4e86\u4e00\u4e9b\u67b6\u6784\u5b58\u5728\u7684\u5df2\u77e5\u95ee\u9898\uff0c\u4f46\u540c\u65f6\u4e5f\u9047\u5230\u4e86\u4e00\u4e9b\u65b0\u7684\u95ee\u9898\u3002\\n\\n### \u6210\u679c\u4e00\uff1a\u89e3\u51b3\u4e86\u524d\u7aef\u4e0d\u652f\u6301 SNI \u7684\u517c\u5bb9\u95ee\u9898\\n\\n\u73b0\u5728\u5927\u90e8\u5206\u524d\u7aef\u90fd\u662f\u652f\u6301 SNI \u7684\uff0c\u4f46\u4e5f\u4f1a\u78b0\u5230\u6709\u4e00\u4e9b\u524d\u7aef\u5728 SSL \u8fc7\u7a0b\u4e2d\u65e0\u6cd5\u4f20\u9012 hostname\u3002\u76ee\u524d\u6211\u4eec\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\u505a\u4e86\u4e00\u4e2a\u517c\u5bb9\uff0c\u91c7\u53d6\u7aef\u53e3\u5339\u914d\u7684\u65b9\u5f0f\u8fdb\u884c\u76f8\u5173\u8bc1\u4e66\u83b7\u53d6\u3002\\n\\n### \u6210\u679c\u4e8c\uff1a\u4f18\u5316\u4e86\u5927\u91cf API \u8def\u7531\u5339\u914d\u95ee\u9898\\n\\n\u524d\u8fb9\u4e5f\u8bf4\u8fc7\uff0c\u76ee\u524d\u6211\u4eec\u7ebf\u4e0a\u76f4\u63a5\u8fd0\u884c\u7684 API \u4e1a\u52a1\u6570\u91cf\u5c31\u6709 9000 \u591a\u4e2a\uff0c\u540e\u7eed\u53ef\u80fd\u8fd8\u4f1a\u589e\u52a0\u3002\u9488\u5bf9\u8fd9\u4e00\u95ee\u9898\u6211\u4eec\u8fdb\u884c\u4e86\u76f8\u5173\u6027\u80fd\u4e0a\u7684\u4f18\u5316\uff0c\u6839\u636e API \u6765\u51b3\u5b9a\u4f18\u5148\u5339\u914d\u57df\u540d\u8fd8\u662f\u8def\u5f84\u3002\\n\\n### \u6210\u679c\u4e09\uff1a\u89e3\u51b3\u4e86 ETCD \u63a5\u53e3\u9650\u5236\u95ee\u9898\\n\\n\u5728\u63a5\u5165 Apache APISIX \u540e\uff0cETCD \u63a5\u53e3\u7684\u9650\u5236\u95ee\u9898\u4e5f\u5df2\u7ecf\u89e3\u51b3\uff0c\u76ee\u524d\u5df2\u7ecf\u89e3\u9664\u4e86 4M \u7684\u9650\u5236\u3002\\n\\n### \u6210\u679c\u56db\uff1a\u4f18\u5316\u4e86 ETCD \u8fde\u63a5\u6570\u91cf\u7684\u6027\u80fd\u95ee\u9898\\n\\n\u76ee\u524d\u662f Apache APISIX \u7684\u6bcf\u4e2a worker \u90fd\u4f1a\u8ddf ETCD \u8fde\u63a5\uff0c\u6bcf\u4e00\u4e2a\u76d1\u542c\u76ee\u5f55\u90fd\u4f1a\u53bb\u5efa\u4e00\u4e2a\u8fde\u63a5\u3002\u6bd4\u5982\u4e00\u53f0\u7269\u7406\u673a\u662f 80 core\uff0c\u76d1\u542c\u76ee\u5f55\u6709 10 \u4e2a\uff0c\u5355\u53f0\u7f51\u5173\u670d\u52a1\u5668\u5c31\u6709 800 \u4e2a\u8fde\u63a5\u3002\u4e00\u4e2a\u7f51\u5173\u96c6\u7fa4 10 \u53f0\u7684\u8bdd\uff0c8000 \u4e2a\u8fde\u63a5\u5bf9 ETCD \u538b\u529b\u86ee\u5927\u7684\u3002\u6211\u4eec\u505a\u7684\u4f18\u5316\u662f\u53ea\u62ff\u4e00\u4e2a worker \u53bb\u76d1\u542c\u6709\u9650\u7684\u5fc5\u8981\u76ee\u5f55\uff0c\u548c\u5176\u4f59 worker \u4e4b\u95f4\u5171\u4eab\u4fe1\u606f\u3002\\n\\n### \u5f85\u4f18\u5316\\n\\n\u9664\u4e86\u4e0a\u8ff0\u95ee\u9898\uff0c\u8fd8\u6709\u4e00\u4e9b\u95ee\u9898\u4e5f\u6b63\u5728\u52aa\u529b\u4f18\u5316\u4e2d\u3002\\n\\n1. \u5927\u91cf API \u7684\u95ee\u9898\uff0c\u5373\u4f7f APISIX \u80fd\u591f\u652f\u6301\uff0c\u6211\u4eec\u4e5f\u8981\u8003\u8651\u5176\u4ed6\u4f9d\u8d56\u7ec4\u4ef6\u7684\u74f6\u9888\u3002\u6bd4\u5982\u4e0a\u8ff0\u7684 ETCD\u3001Prometheus \u76d1\u63a7\u548c\u65e5\u5fd7\u670d\u52a1\u3002\u6240\u4ee5\u540e\u7eed\u6211\u4eec\u53ef\u80fd\u4f1a\u91c7\u53d6\u5927\u96c6\u7fa4\u5171\u4eab\u548c\u5c0f\u96c6\u7fa4\u72ec\u7acb\u8fd9\u4e24\u79cd\u65b9\u5f0f\u6765\u6df7\u5408\u90e8\u7f72\u4e1a\u52a1\uff0c\u6bd4\u5982\u4e00\u4e9b\u91cd\u8981\u4e1a\u52a1\u6211\u4eec\u4f1a\u4ee5\u5c0f\u96c6\u7fa4\u65b9\u5f0f\u8fdb\u884c\u90e8\u7f72\u3002\\n2. \u5173\u4e8e Prometheus \u76d1\u63a7\u6307\u6807\uff0c\u540e\u7eed\u6211\u4eec\u4e5f\u4f1a\u8fdb\u884c\u76f8\u5e94\u7684\u7f29\u51cf\u548c\u4f18\u5316\uff0c\u5bf9 DNS \u670d\u52a1\u53d1\u73b0\u8fd9\u5757\u505a\u66f4\u591a\u7684\u4f18\u5316\u3002\\n\\n## \u5bf9 Apache APISIX \u7684\u671f\u671b\\n\\n\u6211\u4eec\u5e0c\u671b Apache APISIX \u80fd\u5728\u540e\u7eed\u7684\u5f00\u53d1\u66f4\u65b0\u4e2d\uff0c\u9664\u4e86\u652f\u6301\u66f4\u591a\u7684\u529f\u80fd\uff0c\u4e5f\u53ef\u4ee5\u4e00\u76f4\u4fdd\u6301\u6027\u80fd\u7684\u9ad8\u6548\u548c\u7a33\u5b9a\u3002"},{"id":"2021/09/06/python-helps-you-quickly-with-apache-apisix-development","metadata":{"permalink":"/zh/blog/2021/09/06/python-helps-you-quickly-with-apache-apisix-development","source":"@site/blog/2021/09/06/python-helps-you-quickly-with-Apache-APISIX-development.md","title":"Python \u52a9\u4f60\u5feb\u901f\u4e0a\u624b Apache APISIX \u63d2\u4ef6\u5f00\u53d1","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u76ee\u524d\u5df2\u7ecf\u652f\u6301\u4e86 Java\u3001Go \u4ee5\u53ca Python \u7b49\u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\u3002\u672c\u6587\u5c06\u4e3a\u4f60\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Python \u5728 APISIX \u4e0a\u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6\u3002","date":"2021-09-06T00:00:00.000Z","formattedDate":"2021\u5e749\u67086\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.675,"truncated":true,"authors":[{"name":"\u5e05\u8fdb\u8d85","url":"https://github.com/shuaijinchao","imageURL":"https://avatars.githubusercontent.com/u/8529452?v=4"}],"prevItem":{"title":"\u57fa\u4e8e Apache APISIX\uff0c\u7231\u5947\u827a API \u7f51\u5173\u7684\u66f4\u65b0\u4e0e\u843d\u5730\u5b9e\u8df5","permalink":"/zh/blog/2021/09/07/iqiyi-usercase"},"nextItem":{"title":"\u501f\u52a9 KubeSphere \u63d0\u4f9b\u66f4\u597d\u7528\u7684\u7f51\u5173\u53ca K8s Ingress \u63a7\u5236\u5668","permalink":"/zh/blog/2021/08/31/apache-apisix-kubeSphere-a-better-gateway-and-k8s-ingress-controller"}},"content":"> \u5728 Apache APISIX Python Runner \u4e4b\u524d\u793e\u533a\u4e2d\u5df2\u7ecf\u652f\u6301\u4e86 [Java](https://github.com/apache/apisix-java-plugin-runner) \u548c [Go](https://github.com/apache/apisix-go-plugin-runner) \u8bed\u8a00\u7684 Runner\uff0c\u4eca\u5929 Python Runner \u4e5f\u6765\u4e86\uff0c\u793e\u533a\u4e2d\u7684\u5c0f\u4f19\u4f34\u4eec\u5728\u5f00\u53d1 Apache APISIX \u7684\u63d2\u4ef6\u65f6\u53c8\u591a\u4e86\u4e00\u79cd\u65b0\u9009\u62e9\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u7b80\u4ecb\\n\\n### Apache APISIX\\n\\n`Apache APISIX` \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u4e91\u539f\u751f\u5f00\u6e90 API \u7f51\u5173\uff0c\u5b83\u53ef\u4ee5\u5bf9\u8bf7\u6c42\u8fdb\u884c\u7edf\u4e00\u7684\u62e6\u622a\u548c\u6cbb\u7406\uff08\u5982\uff1a\u9274\u6743\u3001\u8ba4\u8bc1\u3001\u7f13\u5b58\u3001\u7248\u672c\u3001\u7194\u65ad\u3001\u5ba1\u8ba1 \u7b49\u7b49\uff09\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u8f7b\u677e\u7684\u5bf9\u5916\u63d0\u4f9b\u5b89\u5168\u53ef\u9760\u7684\u670d\u52a1\uff0c\u800c\u5f00\u53d1\u4eba\u5458\u901a\u8fc7 `Apache APISIX`\\n\u7684\u52a0\u6301\u53ea\u9700\u8981\u5173\u6ce8\u4e1a\u52a1\u5b9e\u73b0\u5373\u53ef\uff0c\u7701\u53bb\u4e86\u5927\u91cf\u82b1\u8d39\u5728\u901a\u7528\u80fd\u529b\u4e0a\u7684\u5f00\u53d1\u4e0e\u7ef4\u62a4\u4e0a\u7684\u65f6\u95f4\u5e76\u4e14\u4e5f\u964d\u4f4e\u4e86\u6574\u4f53\u4e1a\u52a1\u67b6\u6784\u7684\u590d\u6742\u5ea6\u3002\\n\\n### Python\\n\\n`Python` \u8bed\u8a00\u4f5c\u4e3a\u4e00\u4e2a\u89e3\u91ca\u578b\u7684\u9ad8\u7ea7\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b83 `\u8bed\u6cd5\u7b80\u6d01\u6613\u4e0a\u624b`\u3001`\u4ee3\u7801\u53ef\u8bfb\u6027\u597d` \uff0c\u5728 `\u8de8\u5e73\u53f0` \u3001`\u53ef\u79fb\u690d\u6027` \u3001`\u5f00\u53d1\u6548\u7387`\\n\u4e0a\u90fd\u6709\u5f88\u597d\u7684\u8868\u73b0\uff0c\u540c\u65f6\u4f5c\u4e3a\u4e00\u4e2a\u9ad8\u7ea7\u7f16\u7a0b\u8bed\u8a00\u5b83\u7684\u5c01\u88c5\u62bd\u8c61\u7a0b\u5ea6\u6bd4\u8f83\u9ad8\u5c4f\u853d\u4e86\u5f88\u591a\u5e95\u5c42\u7ec6\u8282\uff08\u4f8b\u5982\uff1a`GC`\\n\uff09\u8ba9\u6211\u4eec\u5728\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u66f4\u4e13\u6ce8\u5e94\u7528\u903b\u8f91\u7684\u5f00\u53d1\u3002`Python` \u4f5c\u4e3a\u4e00\u4e2a\u6709 30 \u5e74\u5386\u53f2\u7684\u8001\u724c\u5f00\u53d1\u8bed\u8a00\uff0c\u5b83\u7684\u751f\u6001\u4ee5\u53ca\u5404\u79cd\u6a21\u5757\u5df2\u7ecf\u975e\u5e38\u5b8c\u5584\uff0c\u6211\u4eec\u5927\u90e8\u5206\u7684\u5f00\u53d1\u548c\u5e94\u7528\u573a\u666f\u90fd\u53ef\u4ee5\u4ece\u793e\u533a\u4e2d\u627e\u5230\u5f88\u6210\u719f\u7684\u6a21\u5757\u6216\u89e3\u51b3\u65b9\u6848\u3002`Python`\\n\u5176\u4ed6\u7684\u4f18\u70b9\u5c31\u4e0d\u518d\u4e00\u4e00\u8d58\u8ff0\u3002`Python` \u7684\u7f3a\u70b9\u4e5f\u6bd4\u8f83\u660e\u663e\uff1a`Python` \u4f5c\u4e3a\u4e00\u95e8\u89e3\u91ca\u6027\u8bed\u8a00\uff0c\u76f8\u8f83\u4e8e `C++` \u548c `Go` \u8fd9\u6837\u7684\u7f16\u8bd1\u578b\u8bed\u8a00\uff0c\u5728\u6027\u80fd\u4e0a\u7684\u5dee\u8ddd\u8fd8\u662f\u6bd4\u8f83\u5927\u7684\u3002\\n\\n### Apache APISIX Python Runner\\n\\n[apache-apisix-python-runner](https://github.com/apache/apisix-python-plugin-runner) \u8fd9\u4e2a\u9879\u76ee\u53ef\u4ee5\u7406\u89e3\u4e3a `Apache APISIX` \u548c `Python`\u4e4b\u95f4\u7684\u4e00\u9053\u6865\u6881\uff0c\u901a\u8fc7 `Python Runner` \u53ef\u4ee5\u628a `Python` \u76f4\u63a5\u5e94\u7528\u5230 `APISIX` \u7684\u63d2\u4ef6\u5f00\u53d1\u4e2d\uff0c\u6700\u91cd\u8981\u7684\u8fd8\u662f\u5e0c\u671b\u8ba9\u66f4\u591a\u5bf9 `Apache APISIX` \u548c `API \u7f51\u5173` \u611f\u5174\u8da3\u7684 `Python \u5f00\u53d1\u8005`\u901a\u8fc7\u8fd9\u4e2a\u9879\u76ee\u66f4\u591a\u7684\u4e86\u89e3\u4f7f\u7528 `Apache APISIX`\uff0c\u4ee5\u4e0b\u4e3a `Apache APISIX` \u591a\u8bed\u8a00\u652f\u6301\u7684\u67b6\u6784\u56fe\u3002\\n\\n![Apache APISIX work flow](https://static.apiseven.com/202108/1639468460315-bb51d913-be72-4329-a47b-7e987dff21ba.png)\\n\\n\u4e0a\u56fe\u5de6\u8fb9\u662f `Apache APISIX` \u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u53f3\u8fb9\u7684 `Plugin Runner` \u662f\u5404\u8bed\u8a00\u7684\u63d2\u4ef6\u8fd0\u884c\u5668\uff0c\u672c\u6587\u4ecb\u7ecd\u7684 `apisix-python-plugin-runner` \u5c31\u662f\u652f\u6301 `Python`\u8bed\u8a00\u7684 `Plugin Runner`\u3002\\n\\n\u5f53\u4f60\u5728 `Apache APISIX` \u4e2d\u914d\u7f6e\u4e00\u4e2a `Plugin Runner` \u65f6\uff0c`Apache APISIX` \u4f1a\u542f\u52a8\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u8fd0\u884c `Plugin Runner`\uff0c\u8be5\u5b50\u8fdb\u7a0b\u4e0e `Apache APISIX`\\n\u8fdb\u7a0b\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7528\u6237\uff0c\u5f53\u6211\u4eec\u91cd\u542f\u6216\u91cd\u65b0\u52a0\u8f7d `Apache APISIX` \u65f6\uff0c`Plugin Runner` \u4e5f\u5c06\u88ab\u91cd\u542f\u3002\\n\\n\u5982\u679c\u4f60\u4e3a\u4e00\u4e2a\u7ed9\u5b9a\u7684\u8def\u7531\u914d\u7f6e\u4e86 `ext-plugin-*` \u63d2\u4ef6\uff0c\u8bf7\u6c42\u547d\u4e2d\u8be5\u8def\u7531\u65f6\u5c06\u89e6\u53d1 `Apache APISIX` \u901a\u8fc7 `Unix Socket` \u5411 `Plugin Runner` \u53d1\u8d77 `RPC` \u8c03\u7528\u3002\u8c03\u7528\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a\\n\\n- [ext-plugin-pre-req](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/ext-plugin-pre-req.md)\\n  \uff1a\u5728\u6267\u884c `Apache APISIX` \u5185\u7f6e\u63d2\u4ef6\uff08Lua \u8bed\u8a00\u63d2\u4ef6\uff09\u4e4b\u524d\\n- [ext-plugin-post-req](https://github.com/apache/apisix/blob/master/docs/en/latest/plugins/ext-plugin-post-req.md)\\n  \uff1a\u5728\u6267\u884c `Apache APISIX` \u5185\u7f6e\u63d2\u4ef6\uff08Lua \u8bed\u8a00\u63d2\u4ef6\uff09\u4e4b\u540e\\n\\n\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9009\u62e9\u5e76\u914d\u7f6e `Plugin Runner` \u7684\u6267\u884c\u65f6\u673a\u3002\\n\\n`Plugin Runner` \u4f1a\u5904\u7406 `RPC` \u8c03\u7528\uff0c\u5728\u5176\u5185\u90e8\u521b\u5efa\u4e00\u4e2a\u6a21\u62df\u8bf7\u6c42\uff0c\u7136\u540e\u8fd0\u884c\u591a\u8bed\u8a00\u7f16\u5199\u7684\u63d2\u4ef6\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9 Apache APISIX\u3002\\n\\n\u591a\u8bed\u8a00\u63d2\u4ef6\u7684\u6267\u884c\u987a\u5e8f\u662f\u5728 `ext-plugin-*` \u63d2\u4ef6\u914d\u7f6e\u9879\u4e2d\u5b9a\u4e49\u7684\uff0c\u50cf\u5176\u4ed6\u63d2\u4ef6\u4e00\u6837\uff0c\u5b83\u4eec\u53ef\u4ee5\u88ab\u542f\u7528\u5e76\u5728\u8fd0\u884c\u4e2d\u91cd\u65b0\u5b9a\u4e49\u3002\\n\\n## \u90e8\u7f72\u6d4b\u8bd5\\n\\n### \u57fa\u7840\u8fd0\u884c\u73af\u5883\\n\\n- Apache APISIX 2.7\\n- Python 3.6+\\n\\n`Apache APISIX` \u7684\u5b89\u88c5\u90e8\u7f72\u672c\u6587\u4e0d\u5728\u8fc7\u591a\u8d58\u8ff0\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003 [Apache APISIX \u5b98\u65b9\u6587\u6863\uff1a\u5982\u4f55\u6784\u5efa Apache APISIX](https://github.com/apache/apisix/blob/master/docs/en/latest/how-to-build.md)\\n\u8fdb\u884c\u90e8\u7f72\u3002\\n\\n### \u4e0b\u8f7d\u5b89\u88c5 Python Runner\\n\\n```bash\\n$ git clone https://github.com/apache/apisix-python-plugin-runner.git\\n$ cd apisix-python-plugin-runner\\n$ make install\\n```\\n\\n### \u914d\u7f6e Python Runner\\n\\n#### \u5f00\u53d1\u6a21\u5f0f\\n\\n##### \u8fd0\u884c Python Runner\\n\\n```bash\\n$ cd /path/to/apisix-python-plugin-runner\\n$ APISIX_LISTEN_ADDRESS=unix:/tmp/runner.sock python3 apisix/main.py start\\n```\\n\\n##### \u4fee\u6539 APISIX \u914d\u7f6e\u6587\u4ef6\\n\\n```bash\\n$ vim /path/to/apisix/conf/config.yaml\\napisix:\\n  admin_key:\\n    - name: \\"admin\\"\\n      key: edd1c9f034335f136f87ad84b625c8f1\\n      role: admin\\next-plugin:\\n  path_for_test: /tmp/runner.sock\\n```\\n\\n#### \u751f\u4ea7\u6a21\u5f0f\\n\\n##### \u4fee\u6539 APISIX \u914d\u7f6e\u6587\u4ef6\\n\\n```bash\\n$ vim /path/to/apisix/conf/config.yaml\\napisix:\\n  admin_key:\\n    - name: \\"admin\\"\\n      key: edd1c9f034335f136f87ad84b625c8f1\\n      role: admin\\next-plugin:\\n  cmd: [ \\"python3\\", \\"/path/to/apisix-python-plugin-runner/apisix/main.py\\", \\"start\\" ]\\n```\\n\\n#### Python Runner \u914d\u7f6e\uff08\u53ef\u9009\uff09\\n\\n\u5982\u679c\u9700\u8981\u5bf9 `Log Level` \u6216 `Unix Domain Socket` \u73af\u5883\u53d8\u91cf\u8c03\u6574\u53ef\u4ee5\u4fee\u6539 `Runner` \u7684\u914d\u7f6e\u6587\u4ef6\\n\\n```bash\\n$ vim /path/to/apisix-python-plugin-runner/apisix/config.yaml\\nsocket:\\n  file: $env.APISIX_LISTEN_ADDRESS # Environment variable or absolute path\\n\\nlogging:\\n  level: debug # error warn info debug\\n```\\n\\n### \u542f\u52a8 Python Runner\\n\\n```bash\\n$ cd /path/to/apisix\\n# Start or Restart\\n$ ./bin/apisix [ start | restart ]\\n```\\n\\n\u542f\u52a8\u6216\u91cd\u542f `APISIX` \u5373\u53ef\uff0c\u6b64\u65f6 `APISIX` \u548c `Python Runner` \u5df2\u7ecf\u5b8c\u6210\u914d\u7f6e\u5e76\u542f\u52a8\u3002\\n\\n### \u6d4b\u8bd5 Python Runner\\n\\n#### \u914d\u7f6e Apache APISIX \u8def\u7531\u53ca\u63d2\u4ef6\u4fe1\u606f\\n\\n```bash\\n# \u4f7f\u7528\u9ed8\u8ba4demo\u63d2\u4ef6\u8fdb\u884c\u6d4b\u8bd5\\n$ curl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n  \\"uri\\": \\"/get\\",\\n  \\"plugins\\": {\\n    \\"ext-plugin-pre-req\\": {\\n      \\"conf\\": [\\n        { \\"name\\": \\"stop\\", \\"value\\":\\"{\\\\\\"body\\\\\\":\\\\\\"hello\\\\\\"}\\"}\\n      ]\\n    }\\n  },\\n  \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\'\\n```\\n\\n- `plugins.ext-plugin-pre-req.conf` \u4e3a `Runner` \u63d2\u4ef6\u914d\u7f6e\uff0c`conf` \u4e3a\u6570\u7ec4\u683c\u5f0f\u53ef\u4ee5\u540c\u65f6\u8bbe\u7f6e\u591a\u4e2a\u63d2\u4ef6\u3002\\n- \u63d2\u4ef6\u914d\u7f6e\u5bf9\u8c61\u4e2d `name` \u4e3a\u63d2\u4ef6\u540d\u79f0\uff0c\u8be5\u540d\u79f0\u9700\u8981\u4e0e\u63d2\u4ef6\u4ee3\u7801\u6587\u4ef6\u548c\u5bf9\u8c61\u540d\u79f0\u4e00\u76f4\u3002\\n- \u63d2\u4ef6\u914d\u7f6e\u5bf9\u8c61\u4e2d `value` \u4e3a\u63d2\u4ef6\u914d\u7f6e\uff0c\u53ef\u4ee5\u4e3a `JSON` \u5b57\u7b26\u4e32\u3002\\n\\n#### \u8bbf\u95ee\u9a8c\u8bc1\\n\\n```bash\\n$ curl http://127.0.0.1:9080/get -i\\nHTTP/1.1 200 OK\\nDate: Fri, 13 Aug 2021 13:39:18 GMT\\nContent-Type: text/plain; charset=utf-8\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\nhost: 127.0.0.1:9080\\naccept: */*\\nuser-agent: curl/7.64.1\\nX-Resp-A6-Runner: Python\\nServer: APISIX/2.7\\n\\nHello, Python Runner of APISIX\\n```\\n\\n## \u63d2\u4ef6\u5f00\u53d1\\n\\n### \u63d2\u4ef6\u76ee\u5f55\\n\\n```bash\\n/path/to/apisix-python-plugin-runner/apisix/plugins\\n```\\n\\n\u6b64\u76ee\u5f55\u4e2d\u7684 `.py` \u6587\u4ef6\u5c06\u4f1a\u88ab\u81ea\u52a8\u52a0\u8f7d\u3002\\n\\n### \u63d2\u4ef6\u793a\u4f8b\\n\\n```bash\\n/path/to/apisix-python-plugin-runner/apisix/plugins/stop.py\\n/path/to/apisix-python-plugin-runner/apisix/plugins/rewrite.py\\n```\\n\\n### \u63d2\u4ef6\u683c\u5f0f\\n\\n```python\\nfrom apisix.runner.plugin.base import Base\\nfrom apisix.runner.http.request import Request\\nfrom apisix.runner.http.response import Response\\n\\n\\nclass Stop(Base):\\n    def __init__(self):\\n        \\"\\"\\"\\n        Example of `stop` type plugin, features:\\n            This type of plugin can customize response `body`, `header`, `http_code`\\n            This type of plugin will interrupt the request\\n        \\"\\"\\"\\n        super(Stop, self).__init__(self.__class__.__name__)\\n\\n    def filter(self, request: Request, response: Response):\\n        \\"\\"\\"\\n        The plugin executes the main function\\n        :param request:\\n            request parameters and information\\n        :param response:\\n            response parameters and information\\n        :return:\\n        \\"\\"\\"\\n        # \u5728\u63d2\u4ef6\u4e2d\u53ef\u4ee5\u901a\u8fc7 `self.config` \u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\uff0c\u5982\u679c\u63d2\u4ef6\u914d\u7f6e\u4e3aJSON\u5c06\u81ea\u52a8\u8f6c\u6362\u4e3a\u5b57\u5178\u7ed3\u6784\\n        # print(self.config)\\n\\n        # \u8bbe\u7f6e\u54cd\u5e94\u5934\u4fe1\u606f\\n        headers = request.headers\\n        headers[\\"X-Resp-A6-Runner\\"] = \\"Python\\"\\n        response.headers = headers\\n\\n        # \u8bbe\u7f6e\u54cd\u5e94\u4f53\u4fe1\u606f\\n        response.body = \\"Hello, Python Runner of APISIX\\"\\n\\n        # \u8bbe\u7f6e\u54cd\u5e94\u72b6\u6001\u7801\\n        response.status_code = 201\\n\\n        # \u901a\u8fc7\u8c03\u7528 `self.stop()` \u4e2d\u65ad\u8bf7\u6c42\u6d41\u7a0b\uff0c\u6b64\u65f6\u5c06\u7acb\u5373\u54cd\u5e94\u8bf7\u6c42\u7ed9\u5ba2\u6237\u7aef\\n        # \u5982\u679c\u672a\u663e\u793a\u8c03\u7528 `self.stop()` \u6216 \u663e\u793a\u8c03\u7528 `self.rewrite()`\u5c06\u7ee7\u7eed\u5c06\u8bf7\u6c42\\n        # \u9ed8\u8ba4\u4e3a `self.rewrite()`\\n        self.stop()\\n```\\n\\n### \u63d2\u4ef6\u89c4\u8303\u53ca\u6ce8\u610f\u4e8b\u9879\\n\\n- \u5b9e\u73b0\u63d2\u4ef6\u5bf9\u8c61\u5fc5\u987b\u7ee7\u627f `Base` \u7c7b\\n- \u63d2\u4ef6\u5fc5\u987b\u5b9e\u73b0 `filter` \u51fd\u6570\\n- `filter` \u51fd\u6570\u53c2\u6570\u53ea\u80fd\u5305\u542b `Request` \u548c `Response` \u7c7b\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\\n- `Request` \u5bf9\u8c61\u53c2\u6570\u53ef\u4ee5\u83b7\u53d6\u8bf7\u6c42\u4fe1\u606f\\n- `Response` \u5bf9\u8c61\u53c2\u6570\u53ef\u4ee5\u8bbe\u7f6e\u54cd\u5e94\u4fe1\u606f\\n- `self.config` \u53ef\u4ee5\u83b7\u53d6\u63d2\u4ef6\u914d\u7f6e\u4fe1\u606f\\n- `filter` \u51fd\u6570\u4e2d\u8c03\u7528 `self.stop()` \u65f6\u5c06\u9a6c\u4e0a\u4e2d\u65ad\u8bf7\u6c42\uff0c\u54cd\u5e94\u6570\u636e\u3002\\n- `filter` \u51fd\u6570\u4e2d\u8c03\u7528 `self.rewrite()` \u65f6\uff0c\u5c06\u4f1a\u7ee7\u7eed\u8bf7\u6c42\u3002\\n\\n## \u6b22\u8fce\u53c2\u4e0e\\n\\n\u76ee\u524d `Apache APISIX` \u5404\u8bed\u8a00\u7684 `Runner` \u8fd8\u5904\u4e8e\u65e9\u671f\u5f00\u53d1\u9636\u6bb5\uff0c\u6211\u4eec\u4f1a\u9646\u7eed\u5b8c\u5584\u5176\u529f\u80fd\u3002\u6210\u529f\u7684\u5f00\u6e90\u9879\u76ee\u79bb\u4e0d\u5f00\u5927\u5bb6\u7684\u53c2\u4e0e\u548c\u8d21\u732e\uff0c\u6b22\u8fce\u5404\u4f4d\u53c2\u4e0e `Apache APISIX Runner`\\n\u7684\u5f00\u53d1\uff0c\u8ba9\u6211\u4eec\u4e00\u8d77\u5171\u5efa `Apache APISIX` \u4e0e\u5404\u8bed\u8a00\u7684\u6865\u6881\u3002\\n\\n- [apisix-python-plugin-runner](https://github.com/apache/apisix-python-plugin-runner)\\n- [apisix-go-plugin-runner](https://github.com/apache/apisix-go-plugin-runner)\\n- [apisix-java-plugin-runner](https://github.com/apache/apisix-java-plugin-runner)\\n\\n## \u76f8\u5173\u9605\u8bfb\\n\\n- [Go \u8ba9 Apache APISIX \u5982\u864e\u6dfb\u7ffc](http://apisix.apache.org/blog/2021/08/19/go-makes-Apache-APISIX-better)\\n- [\u5982\u4f55\u7528 Java \u7f16\u5199 Apache APISIX \u63d2\u4ef6](https://apisix.apache.org/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins)"},{"id":"2021/08/31/apache-apisix-kubeSphere-a-better-gateway-and-k8s-ingress-controller","metadata":{"permalink":"/zh/blog/2021/08/31/apache-apisix-kubeSphere-a-better-gateway-and-k8s-ingress-controller","source":"@site/blog/2021/08/31/Apache APISIX \xd7 KubeSphere-a-better-gateway-and-K8S-Ingress-Controller.md","title":"\u501f\u52a9 KubeSphere \u63d0\u4f9b\u66f4\u597d\u7528\u7684\u7f51\u5173\u53ca K8s Ingress \u63a7\u5236\u5668","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u5728 KubeSphere \u4e2d\u4f7f\u7528\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684\u5b98\u65b9 Helm \u4ed3\u5e93\u76f4\u63a5\u90e8\u7f72 Apache APISIX \u548c APISIX Ingress Controller\u3002","date":"2021-08-31T00:00:00.000Z","formattedDate":"2021\u5e748\u670831\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":7.62,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","url":"https://github.com/tao12345666333","imageURL":"https://avatars.githubusercontent.com/u/3264292?v=4"}],"prevItem":{"title":"Python \u52a9\u4f60\u5feb\u901f\u4e0a\u624b Apache APISIX \u63d2\u4ef6\u5f00\u53d1","permalink":"/zh/blog/2021/09/06/python-helps-you-quickly-with-apache-apisix-development"},"nextItem":{"title":"\u793e\u533a\u4f1a\u8bae\uff5cAPISIX Ingress \u4f1a\u8bae\u4e0e\u4f60\u4e0d\u89c1\u4e0d\u6563","permalink":"/zh/blog/2021/08/30/ingress-meeting"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u5728 KubeSphere \u4e2d\u4f7f\u7528 Apache APISIX \u7684\u5b98\u65b9 Helm \u4ed3\u5e93\u76f4\u63a5\u90e8\u7f72 Apache APISIX \u548c APISIX Ingress Controller \u3002\u5e76\u4e14 Apache APISIX \u53ef\u901a\u8fc7\u4f5c\u4e3a\u7f51\u5173\uff0c\u6216\u8005 APISIX Ingress Controller \u7684\u6570\u636e\u9762\u6765\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## KubeSphere \u4ecb\u7ecd\\n\\n[KubeSphere](https://kubesphere.io/) \u662f\u5728 Kubernetes \u4e4b\u4e0a\u6784\u5efa\u7684\u9762\u5411\u4e91\u539f\u751f\u5e94\u7528\u7684\u7cfb\u7edf\uff0c\u5b8c\u5168\u5f00\u6e90\uff0c\u652f\u6301\u591a\u4e91\u4e0e\u591a\u96c6\u7fa4\u7ba1\u7406\uff0c\u63d0\u4f9b\u5168\u6808\u7684 IT \u81ea\u52a8\u5316\u8fd0\u7ef4\u80fd\u529b\uff0c\u7b80\u5316\u4f01\u4e1a\u7684 DevOps \u5de5\u4f5c\u6d41\u3002\u5b83\u7684\u67b6\u6784\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u4f7f\u7b2c\u4e09\u65b9\u5e94\u7528\u4e0e\u4e91\u539f\u751f\u751f\u6001\u7ec4\u4ef6\u8fdb\u884c\u5373\u63d2\u5373\u7528 (plug-and-play) \u7684\u96c6\u6210\u3002\\n\\n\u4f5c\u4e3a\u5168\u6808\u7684\u591a\u79df\u6237\u5bb9\u5668\u5e73\u53f0\uff0cKubeSphere \u63d0\u4f9b\u4e86\u8fd0\u7ef4\u53cb\u597d\u7684\u5411\u5bfc\u5f0f\u64cd\u4f5c\u754c\u9762\uff0c\u5e2e\u52a9\u4f01\u4e1a\u5feb\u901f\u6784\u5efa\u4e00\u4e2a\u5f3a\u5927\u548c\u529f\u80fd\u4e30\u5bcc\u7684\u5bb9\u5668\u4e91\u5e73\u53f0\u3002KubeSphere \u4e3a\u7528\u6237\u63d0\u4f9b\u6784\u5efa\u4f01\u4e1a\u7ea7 Kubernetes \u73af\u5883\u6240\u9700\u7684\u591a\u9879\u529f\u80fd\uff0c\u4f8b\u5982\u591a\u4e91\u4e0e\u591a\u96c6\u7fa4\u7ba1\u7406\u3001Kubernetes \u8d44\u6e90\u7ba1\u7406\u3001DevOps\u3001\u5e94\u7528\u751f\u547d\u5468\u671f\u7ba1\u7406\u3001\u5fae\u670d\u52a1\u6cbb\u7406\uff08\u670d\u52a1\u7f51\u683c\uff09\u3001\u65e5\u5fd7\u67e5\u8be2\u4e0e\u6536\u96c6\u3001\u670d\u52a1\u4e0e\u7f51\u7edc\u3001\u591a\u79df\u6237\u7ba1\u7406\u3001\u76d1\u63a7\u544a\u8b66\u3001\u4e8b\u4ef6\u4e0e\u5ba1\u8ba1\u67e5\u8be2\u3001\u5b58\u50a8\u7ba1\u7406\u3001\u8bbf\u95ee\u6743\u9650\u63a7\u5236\u3001GPU \u652f\u6301\u3001\u7f51\u7edc\u7b56\u7565\u3001\u955c\u50cf\u4ed3\u5e93\u7ba1\u7406\u4ee5\u53ca\u5b89\u5168\u7ba1\u7406\u7b49\u3002\\n\\n## Apache APISIX \u4ecb\u7ecd\\n\\n[Apache APISIX](https://github.com/apache/apisix) \u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u9ad8\u6027\u80fd\u3001\u52a8\u6001\u4e91\u539f\u751f\u7f51\u5173\uff0c\u7531\u6df1\u5733\u652f\u6d41\u79d1\u6280\u6709\u9650\u516c\u53f8\u4e8e 2019 \u5e74\u6350\u8d60\u7ed9 Apache \u57fa\u91d1\u4f1a\uff0c\u5f53\u524d\u5df2\u7ecf\u6210\u4e3a Apache \u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u662f GitHub \u4e0a\u6700\u6d3b\u8dc3\u7684\u7f51\u5173\u9879\u76ee\u3002Apache APISIX \u5f53\u524d\u5df2\u7ecf\u8986\u76d6\u4e86 API \u7f51\u5173\uff0cLB\uff0cKubernetes Ingress\uff0cService Mesh \u7b49\u591a\u79cd\u573a\u666f\u3002\\n\\n## \u524d\u7f6e\u6761\u4ef6\\n\\n\u5c06\u73b0\u6709 Kubernetes \u96c6\u7fa4\u5df2\u7eb3\u5165 KubeSphere \u7ba1\u7406\u3002\\n\\n## \u90e8\u7f72 Apache APISIX \u548c Apache APISIX Ingress Controller\\n\\n\u6211\u4eec\u53ef\u4ee5\u53c2\u8003 KubeSphere \u7684\u6587\u6863\u542f\u7528 KubeSphere \u7684 [AppStore](https://kubesphere.io/docs/pluggable-components/app-store/)\uff0c\u6216\u8005\u4f7f\u7528\u4f7f\u7528 Apache APISIX \u7684 [Helm \u4ed3\u5e93](https://charts.apiseven.com)\u6765\u8fdb\u884c\u90e8\u7f72\u3002\u8fd9\u91cc\uff0c\u6211\u4eec\u76f4\u63a5\u4f7f\u7528 Apache APISIX \u7684 Helm \u4ed3\u5e93\u8fdb\u884c\u90e8\u7f72\u3002\\n\\n\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5373\u53ef\u6dfb\u52a0 Apache APISIX \u7684 Helm repo\uff0c\u5e76\u5b8c\u6210\u90e8\u7f72\u3002\\n\\n```shell\\n\u279c  ~ helm repo add apisix https://charts.apiseven.com\\n\\"apisix\\" has been added to your repositories\\n\u279c  ~ helm repo add bitnami https://charts.bitnami.com/bitnami\\n\\"bitnami\\" has been added to your repositories\\n\u279c  ~ helm repo update\\n\u279c  ~ kubectl create ns apisix\\nnamespace/apisix created\\n\u279c  ~ helm install apisix apisix/apisix --set gateway.type=NodePort --set ingress-controller.enabled=true --namespace apisix\\nW0827 18:19:58.504653  294386 warnings.go:70] apiextensions.k8s.io/v1beta1 CustomResourceDefinition is deprecated in v1.16+, unavailable in v1.22+; use apiextensions.k8s.io/v1 CustomResourceDefinition\\nNAME: apisix\\nLAST DEPLOYED: Fri Aug 27 18:20:00 2021\\nNAMESPACE: apisix\\nSTATUS: deployed\\nREVISION: 1\\nTEST SUITE: None\\nNOTES:\\n1. Get the application URL by running these commands:\\n  export NODE_PORT=$(kubectl get --namespace apisix -o jsonpath=\\"{.spec.ports[0].nodePort}\\" services apisix-gateway)\\n  export NODE_IP=$(kubectl get nodes --namespace apisix -o jsonpath=\\"{.items[0].status.addresses[0].address}\\")\\n  echo http://$NODE_IP:$NODE_PORT\\n```\\n\\n\u9a8c\u8bc1\u662f\u5426\u5df2\u7ecf\u6210\u529f\u90e8\u7f72\u4e14\u8fd0\u884c\uff1a\\n\\n```shell\\n\u279c  ~ kubectl -n apisix get pods\\nNAME                                         READY   STATUS    RESTARTS   AGE\\napisix-77d7545d4d-cvdhs                      1/1     Running   0          4m7s\\napisix-etcd-0                                1/1     Running   0          4m7s\\napisix-etcd-1                                1/1     Running   0          4m7s\\napisix-etcd-2                                1/1     Running   0          4m7s\\napisix-ingress-controller-74c6b5fbdd-94ngk   1/1     Running   0          4m7s\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u76f8\u5173\u7684 Pod \u5747\u5df2\u6b63\u5e38\u8fd0\u884c\u3002\\n\\n## \u90e8\u7f72\u793a\u4f8b\u9879\u76ee\\n\\n\u6211\u4eec\u4f7f\u7528 `kennethreitz/httpbin` \u4f5c\u4e3a\u793a\u4f8b\u9879\u76ee\u8fdb\u884c\u6f14\u793a\u3002\u8fd9\u91cc\u4e5f\u76f4\u63a5\u5728 KubeSphere \u4e2d\u5b8c\u6210\u90e8\u7f72\u3002\\n\\n\u9009\u62e9\u670d\u52a1 -- \u65e0\u72b6\u6001\u670d\u52a1\uff0c\u521b\u5efa\u5373\u53ef\u3002\\n\\n![KubeSphere APISIX Ingress Controller demo](https://static.apiseven.com/202108/1630404138226-5475c163-d372-414e-af74-5c5a86f19629.png)\\n\\n![KubeSphere APISIX Ingress Controller demo](https://static.apiseven.com/202108/1630404173444-9bb73e0d-5bee-428e-a257-4685500344ef.png)\\n\\n\u5728 KubeSphere \u7684\u670d\u52a1\u548c\u8d1f\u8f7d\u754c\u9762\u5373\u53ef\u770b\u5230\u90e8\u7f72\u6210\u529f\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u7ec8\u7aef\u4e0b\u67e5\u770b\u662f\u5426\u5df2\u7ecf\u90e8\u7f72\u6210\u529f\u3002\\n\\n```shell\\n\u279c  ~ kubectl get pods,svc -l app=httpbin\\nNAME                             READY   STATUS    RESTARTS   AGE\\npod/httpbin-v1-7d6dc7d5f-5lcmg   1/1     Running   0          48s\\n\\nNAME              TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE\\nservice/httpbin   ClusterIP   10.96.0.5    <none>        80/TCP    48s\\n```\\n\\n## \u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u7f51\u5173\u4ee3\u7406\\n\\n\u6211\u4eec\u5148\u6f14\u793a\u5982\u4f55\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u7f51\u5173\u4ee3\u7406 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u3002\\n\\n```shell\\nroot@apisix:~$ kubectl -n apisix exec -it `kubectl -n apisix get pods -l app.kubernetes.io/name=apisix -o name` -- bash\\nbash-5.1# curl httpbin.default/get\\n{\\n  \\"args\\": {},\\n  \\"headers\\": {\\n    \\"Accept\\": \\"*/*\\",\\n    \\"Host\\": \\"httpbin.default\\",\\n    \\"User-Agent\\": \\"curl/7.77.0\\"\\n  },\\n  \\"origin\\": \\"10.244.2.9\\",\\n  \\"url\\": \\"http://httpbin.default/get\\"\\n}\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u5728 Apache APISIX \u7684 Pod \u5185\u53ef\u6b63\u5e38\u8bbf\u95ee\u793a\u4f8b\u9879\u76ee\u3002\u63a5\u4e0b\u6765\u4f7f\u7528 Apache APISIX \u5bf9\u8be5\u793a\u4f8b\u9879\u76ee\u8fdb\u884c\u4ee3\u7406\u3002\\n\\n\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 `curl` \u8c03\u7528 Apache APISIX \u7684 admin \u63a5\u53e3\uff0c\u521b\u5efa\u4e00\u6761\u8def\u7531\u3002\u5c06\u6240\u6709 host \u5934\u4e3a `httpbin.org` \u7684\u8bf7\u6c42\u8f6c\u53d1\u7ed9 `httpbin.default:80` \u8fd9\u4e2a\u5b9e\u9645\u7684\u5e94\u7528\u670d\u52a1\u4e0a\u3002\\n\\n```shell\\nbash-5.1# curl \\"http://127.0.0.1:9180/apisix/admin/routes/1\\" -H \\"X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\\" -X PUT -d \'\\n{\\n  \\"uri\\": \\"/get\\",\\n  \\"host\\": \\"httpbin.org\\",\\n  \\"upstream\\": {\\n    \\"type\\": \\"roundrobin\\",\\n    \\"nodes\\": {\\n      \\"httpbin.default:80\\": 1\\n    }\\n  }\\n}\'\\n{\\"node\\":{\\"key\\":\\"\\\\/apisix\\\\/routes\\\\/1\\",\\"value\\":{\\"host\\":\\"httpbin.org\\",\\"update_time\\":1630060883,\\"uri\\":\\"\\\\/*\\",\\"create_time\\":1630060883,\\"priority\\":0,\\"upstream\\":{\\"type\\":\\"roundrobin\\",\\"pass_host\\":\\"pass\\",\\"nodes\\":{\\"httpbin.default:80\\":1},\\"hash_on\\":\\"vars\\",\\"scheme\\":\\"http\\"},\\"id\\":\\"1\\",\\"status\\":1}},\\"action\\":\\"set\\"}\\n```\\n\\n\u4f60\u4f1a\u5f97\u5230\u7c7b\u4f3c\u4e0a\u9762\u7684\u8f93\u51fa\uff0c\u63a5\u4e0b\u6765\u9a8c\u8bc1\u662f\u5426\u4ee3\u7406\u6210\u529f\uff1a\\n\\n```shell\\nbash-5.1# curl http://127.0.0.1:9080/get -H \\"HOST: httpbin.org\\"\\n{\\n  \\"args\\": {},\\n  \\"headers\\": {\\n    \\"Accept\\": \\"*/*\\",\\n    \\"Host\\": \\"httpbin.org\\",\\n    \\"User-Agent\\": \\"curl/7.77.0\\",\\n    \\"X-Forwarded-Host\\": \\"httpbin.org\\"\\n  },\\n  \\"origin\\": \\"127.0.0.1\\",\\n  \\"url\\": \\"http://httpbin.org/get\\"\\n}\\n```\\n\\n\u5f97\u5230\u4e0a\u9762\u7684\u8f93\u51fa\uff0c\u8bf4\u660e\u5df2\u7ecf\u901a\u8fc7 Apache APISIX \u4ee3\u7406\u4e86\u793a\u4f8b\u9879\u76ee\u7684\u6d41\u91cf\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8bd5\u8bd5\u5728\u96c6\u7fa4\u5916\u901a\u8fc7 Apache APISIX \u8bbf\u95ee\u793a\u4f8b\u9879\u76ee\u3002\\n\\n```shell\\nroot@apisix:~$ kubectl  -n apisix get svc -l app.kubernetes.io/name=apisix\\nNAME             TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE\\napisix-admin     ClusterIP   10.96.33.97    <none>        9180/TCP       22m\\napisix-gateway   NodePort    10.96.126.83   <none>        80:31441/TCP   22m\\n```\\n\\n\u5728\u4f7f\u7528 Helm chart \u90e8\u7f72\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u4f1a\u5c06 Apache APISIX \u7684\u7aef\u53e3\u901a\u8fc7 NodePort \u7684\u5f62\u5f0f\u66b4\u9732\u51fa\u53bb\u3002\u6211\u4eec\u4f7f\u7528 Node IP + NodePort \u7684\u7aef\u53e3\u8fdb\u884c\u8bbf\u95ee\u6d4b\u8bd5\u3002\\n\\n```shell\\nroot@apisix:~$ curl http://172.18.0.5:31441/get -H \\"HOST: httpbin.org\\"\\n{\\n  \\"args\\": {},\\n  \\"headers\\": {\\n    \\"Accept\\": \\"*/*\\",\\n    \\"Host\\": \\"httpbin.org\\",\\n    \\"User-Agent\\": \\"curl/7.76.1\\",\\n    \\"X-Forwarded-Host\\": \\"httpbin.org\\"\\n  },\\n  \\"origin\\": \\"10.244.2.1\\",\\n  \\"url\\": \\"http://httpbin.org/get\\"\\n}\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\uff0c**\u5728\u96c6\u7fa4\u5916\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7 Apache APISIX \u4f5c\u4e3a\u7f51\u5173\u4ee3\u7406 Kubernetes \u96c6\u7fa4\u5185\u7684\u670d\u52a1\u4e86\u3002**\\n\\n## \u4f7f\u7528 APISIX Ingress Controller \u4ee3\u7406\u670d\u52a1\\n\\n\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728 KubeSphere \u4e2d\u6dfb\u52a0\u5e94\u7528\u8def\u7531\uff08Ingress\uff09\uff0cApache APISIX Ingress Controller \u4f1a\u81ea\u52a8\u5c06\u8def\u7531\u89c4\u5219\u540c\u6b65\u81f3 Apache APISIX \u4e2d\uff0c\u5b8c\u6210\u670d\u52a1\u7684\u4ee3\u7406\u3002\\n\\n![KubeSphere APISIX Ingress Controller demo](https://static.apiseven.com/202108/1630404265190-585b9b09-72d5-4320-b0fe-9cf8a73c55ea.png)\\n\\n![KubeSphere APISIX Ingress Controller demo](https://static.apiseven.com/202108/1630404325747-b92928dc-2c6b-4574-a49d-32b6bcb187f9.png)\\n\\n**\u6ce8\u610f**\u6211\u4eec\u6dfb\u52a0\u4e86 `kubernetes.io/ingress.class: apisix` \u7684 annotation \u914d\u7f6e\uff0c\u7528\u4e8e\u652f\u6301\u96c6\u7fa4\u5185\u591a ingress-controller \u7684\u573a\u666f\u3002\\n\\n\u4fdd\u5b58\u540e\uff0c\u53ef\u770b\u5230\u5982\u4e0b\u754c\u9762\uff1a\\n\\n![KubeSphere APISIX Ingress Controller demo](https://static.apiseven.com/202108/1630404366474-dfe8ae08-f16d-417f-8ef3-3495ebda0f7d.png)\\n\\n\u5728\u7ec8\u7aef\u4e0b\u6d4b\u8bd5\u662f\u5426\u4ee3\u7406\u6210\u529f\uff1a\\n\\n```shell\\nroot@apisix:~$ curl http://172.18.0.5:31441/get -H \\"HOST: http-ing.org\\"  {  \\"args\\": {},   \\"headers\\": {    \\"Accept\\": \\"*/*\\",     \\"Host\\": \\"http-ing.org\\",     \\"User-Agent\\": \\"curl/7.76.1\\",     \\"X-Forwarded-Host\\": \\"http-ing.org\\"  },   \\"origin\\": \\"10.244.2.1\\",   \\"url\\": \\"http://http-ing.org/get\\"}\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u4e5f\u6b63\u5e38\u4ee3\u7406\u4e86\u3002\\n\\n\u9664\u4e86\u4ee5\u4e0a\u65b9\u5f0f\u5916\uff0cApache APISIX Ingress Controller \u901a\u8fc7 CRD \u7684\u65b9\u5f0f\u5bf9 Kubernetes \u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u53d1\u5e03 `ApisixRoute` \u7b49\u8fd9\u79cd\u81ea\u5b9a\u4e49\u8d44\u6e90\u6765\u5b8c\u6210 Kubernetes \u4e2d\u670d\u52a1\u7684\u5bf9\u5916\u66b4\u9732\u3002\\n\\n## \u603b\u7ed3\\n\\n\u4f60\u53ef\u4ee5\u5728 KubeSphere \u4e2d\u4f7f\u7528 Apache APISIX \u7684\u5b98\u65b9 Helm \u4ed3\u5e93\u76f4\u63a5\u90e8\u7f72 Apache APISIX \u548c APISIX Ingress Controller \u3002\u5e76\u4e14 Apache APISIX \u53ef\u901a\u8fc7\u4f5c\u4e3a\u7f51\u5173\uff0c\u6216\u8005 APISIX Ingress Controller \u7684\u6570\u636e\u9762\u6765\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u3002\\n\\n## \u672a\u6765\u5c55\u671b\\n\\nApache APISIX \u5df2\u7ecf\u4e0e KubeSphere \u793e\u533a\u8fbe\u6210\u5408\u4f5c\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728 KubeSphere \u81ea\u5e26\u7684\u5e94\u7528\u4ed3\u5e93\u4e2d\u627e\u5230 Apache APISIX \uff0c\u4e0d\u9700\u8981\u624b\u52a8\u6dfb\u52a0 Helm \u4ed3\u5e93\u3002"},{"id":"2021/08/30/ingress-meeting","metadata":{"permalink":"/zh/blog/2021/08/30/ingress-meeting","source":"@site/blog/2021/08/30/Ingress-Meeting.md","title":"\u793e\u533a\u4f1a\u8bae\uff5cAPISIX Ingress \u4f1a\u8bae\u4e0e\u4f60\u4e0d\u89c1\u4e0d\u6563","description":"Apache APISIX Ingress \u793e\u533a\u4f1a\u8bae\uff0c\u5efa\u7acb\u4e0e\u793e\u533a\u7528\u6237\u548c\u5f00\u53d1\u8005\u4eec\u7684\u6c9f\u901a\u6e20\u9053\uff0c\u5e2e\u52a9\u5927\u5bb6\u4e86\u89e3 Apache APISIX Ingress \u7684\u53d1\u5c55\u65b9\u5411\u548c\u5f00\u53d1\u8ba1\u5212\u3002","date":"2021-08-30T00:00:00.000Z","formattedDate":"2021\u5e748\u670830\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.53,"truncated":true,"authors":[{"name":"Apache APISIX \u793e\u533a"}],"prevItem":{"title":"\u501f\u52a9 KubeSphere \u63d0\u4f9b\u66f4\u597d\u7528\u7684\u7f51\u5173\u53ca K8s Ingress \u63a7\u5236\u5668","permalink":"/zh/blog/2021/08/31/apache-apisix-kubeSphere-a-better-gateway-and-k8s-ingress-controller"},"nextItem":{"title":"\u793e\u533a\u5468\u62a5\uff088.23-8.29\uff09","permalink":"/zh/blog/2021/08/30/weekly-report"}},"content":"> \u968f\u7740 [Apache APISIX Ingress Controller 1.0 \u7248\u672c](https://apisix.apache.org/blog/2021/06/18/first-GA-version-v1.0-of-Apache-APISIX-Ingress-Controller-released) \u53d1\u5e03\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u5f00\u53d1\u8005\u5f00\u59cb\u5173\u6ce8 Apache APISIX Ingress \u65b9\u6848\uff0cApache APISIX \u793e\u533a\u5e0c\u671b\u80fd\u591f\u5efa\u7acb\u4e0e\u793e\u533a\u7528\u6237\u548c\u5f00\u53d1\u8005\u4eec\u66f4\u76f4\u63a5\u7684\u6c9f\u901a\u6e20\u9053\uff0c\u5e2e\u52a9\u5927\u5bb6\u4e86\u89e3 Apache APISIX Ingress \u7684\u53d1\u5c55\u65b9\u5411\u548c\u5f00\u53d1\u8ba1\u5212\uff0c\u5e0c\u671b\u6bcf\u4e00\u4f4d\u7528\u6237\u3001\u6bcf\u4e00\u4f4d\u5f00\u53d1\u8005\u7684\u58f0\u97f3\u90fd\u53ef\u4ee5\u88ab\u542c\u89c1\u3002 \u56e0\u6b64\uff0cApache APISIX \u793e\u533a\u5f00\u59cb\u7ec4\u7ec7\u6bcf\u4e24\u5468\u7ebf\u4e0a\u793e\u533a\u4f1a\u8bae\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u4f1a\u8bae\u65f6\u95f4\\n\\n\u6bcf\u4e24\u5468 (\u5468\u4e09)\u4e0b\u5348 2 \u70b9\uff0c\u6bcf\u6b21\u4f1a\u8bae\u7ea6 1 \u5c0f\u65f6\u3002\\n\\n## \u4f1a\u8bae\u5730\u5740\\n\\n[\u817e\u8baf\u4f1a\u8bae](https://meeting.tencent.com/s/eTvhm052verD) ID\uff1a377 1555 2043\\n\\n## \u4f1a\u8bae\u5468\u62a5\\n\\n\u53ef\u4ee5[\u6b64\u6587\u6863](https://docs.qq.com/doc/DSEhMeGJ0UXdydFJy)\u63d0\u524d\u7559\u4e0b\u4f60\u60f3\u8ba8\u8bba\u7684\u8bae\u9898\\n\\n## \u6bcf\u671f\u4f1a\u8bae\u7684\u8bae\u9898\u53ef\u80fd\u662f\\n\\n- \u67d0\u4e9b\u65b0\u529f\u80fd\u9700\u6c42\u7684\u8ba8\u8bba\\n- \u6280\u672f\u67b6\u6784\u8bbe\u8ba1\u7684\u5206\u4eab\\n- Bug \u7684\u53cd\u9988\\n- \u81ea\u5df1\u6216\u6240\u5728\u56e2\u961f\u4f7f\u7528 Apache APISIX Ingress Controller \u8fc7\u7a0b\u4e2d\u7684\u7ecf\u9a8c\u5206\u4eab\u548c\u8e29\u5751\\n- \u5bf9 Apache APISIX Ingress Controller \u7684\u80af\u5b9a\u6216\u5410\u69fd\\n\\n\u5f53\u7136\u4e5f\u5341\u5206\u6b22\u8fce\u5927\u5bb6\u5bf9 Apache APISIX \u793e\u533a\u7684\u5efa\u8bbe\u63d0\u51fa\u4e2d\u80af\u610f\u89c1\u6216\u8d21\u732e\u5404\u79cd\u5947\u601d\u5999\u60f3\uff0c\u5982\u679c\u5927\u5bb6\u5bf9\u4f1a\u8bae\u6709\u5efa\u8bae\u3001\u6709\u60f3\u6cd5\uff0c\u6b22\u8fce\u5230\u6b64 [issue](https://github.com/apache/apisix-ingress-controller/issues/614) \u4e0b\u56de\u590d\u54e6~\\n\\n\u6b22\u8fce\u5927\u5bb6\u53c2\u4e0e\u4f1a\u8bae\uff0c\u4e00\u540c\u63a2\u8ba8 Apache APISIX Ingress \u65b9\u6848\uff0c\u66f4\u6b22\u8fce\u5c0f\u4f19\u4f34\u4eec\u52a0\u5165\u793e\u533a\u5f00\u53d1\u8005\u7684\u961f\u4f0d\u4e2d\uff0c\u4e00\u8d77\u6253\u9020\u4e00\u6b3e\u66f4\u597d\u7528\u7684 Apache APISIX Ingress Controller\u3002\\n\\n\u5982\u679c\u4f60\u5bf9 Apache APISIX \u7684\u6280\u672f\u65b9\u5411\u611f\u5174\u8da3\uff0c\u5e0c\u671b\u4e00\u540c\u5f00\u53d1\uff0c\u6216\u8005\u6709\u5176\u4ed6\u5efa\u8bae\u6216\u610f\u89c1\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6e20\u9053\u53c2\u4e0e\uff1a\\n\\n1. \u8ba2\u9605\u5e76\u53d1\u9001\u90ae\u4ef6\u81f3 dev@apisix.apache.org\u200d\\n\u4ee5 Apache Way \u7684\u65b9\u5f0f\u53c2\u4e0e\u793e\u533a\uff0c\u8ba2\u9605\u65b9\u5f0f\u89c1\u5b98\u7f51[\u8ba2\u9605\u6307\u5357](https://apisix.apache.org/docs/general/join)\u3002\u90ae\u4ef6\u5217\u8868\u662f Apache \u793e\u533a\u6700\u5e38\u7528\u7684\u6c9f\u901a\u65b9\u5f0f\uff0c\u793e\u533a\u4f1a\u79ef\u6781\u56de\u590d\u90ae\u4ef6\u5217\u8868\u4e2d\u7684\u95ee\u9898\u3002\\n\\n2. \u5728 Apache APISIX Github discussion \u53d1\u8d77\u8ba8\u8bba\\n\u6b22\u8fce\u5927\u5bb6\u5728 GitHub discussion \u8ba8\u8bba\uff0c[discussion](https://github.com/apache/apisix/discussions) \u533a\u975e\u5e38\u6d3b\u8dc3\u54e6\u3002\u6211\u4eec\u4e5f\u4f1a\u4e0d\u5b9a\u671f\u7684\u5c06\u4e00\u4e9b\u5e38\u89c1\u95ee\u9898\u5728 discussion \u4e2d\u8fdb\u884c\u6c47\u603b\u548c\u7b54\u590d\uff0c\u65b9\u4fbf\u5927\u5bb6\u67e5\u627e\u3002"},{"id":"\u793e\u533a\u5468\u62a5\uff088.23-8.29\uff09","metadata":{"permalink":"/zh/blog/2021/08/30/weekly-report","source":"@site/blog/2021/08/30/weekly-report.md","title":"\u793e\u533a\u5468\u62a5\uff088.23-8.29\uff09","description":"\u672c\u5468 Apache APISIX \u65b0\u589e\u4e86 uri-blocker \u652f\u6301\u5339\u914d\u8bf7\u6c42 URI \u65f6\u5ffd\u7565\u5927\u5c0f\u5199\uff0ckafka-logger \u652f\u6301\u914d\u7f6e kafka \u751f\u4ea7\u8005\u7684 acks \u548c cluster name \u53c2\u6570\u7b49\u529f\u80fd\u3002","date":"2021-08-30T00:00:00.000Z","formattedDate":"2021\u5e748\u670830\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.815,"truncated":true,"authors":[],"prevItem":{"title":"\u793e\u533a\u4f1a\u8bae\uff5cAPISIX Ingress \u4f1a\u8bae\u4e0e\u4f60\u4e0d\u89c1\u4e0d\u6563","permalink":"/zh/blog/2021/08/30/ingress-meeting"},"nextItem":{"title":"Apache APISIX 2.9 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/08/27/release-apache-apisix-2.9"}},"content":"\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue \uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![\u65b0\u589e\u8d21\u732e\u8005\u6570\u91cf](https://static.apiseven.com/202108/1630393952402-4965d35c-6b05-4f71-9966-2fea7f7939d3.JPG)\\n\\n![\u672c\u5468\u65b0\u664b\u8d21\u732e\u8005](https://static.apiseven.com/202108/1630393952406-9f61c39b-ea9e-4451-bd26-ab845a32a222.JPG)\\n\\n## Good first issue\\n\\n### Issue #4241\\n\\n**\u94fe\u63a5**\uff1ahttps://github.com/apache/apisix/issues/4241\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u73b0\u5728\u5728\u5c06 jwt-auth \u63d2\u4ef6\u6dfb\u52a0\u5230\u4e00\u4e2a service/route \u65f6\uff0cjwt \u4ee4\u724c\u672a\u5305\u542b\u201ckey\u201d\u58f0\u660e\u3002\\n\\n```shell\\n{\\n  \\"iss\\":\\"http://127.0.0.1\\",\\n  \\"client_id\\":\\"application1\\",\\n  \\"sub\\": \\"1234567890\\",\\n  \\"iat\\": 1516239022\\n}\\n```\\n\\n![\u95ee\u9898\u63cf\u8ff0\u622a\u56fe](https://static.apiseven.com/202108/1630393952407-b6a26364-6c36-47f6-82c2-81514c31f20b.PNG)\\n\\n### Issue #4441\\n\\n**\u94fe\u63a5**\uff1a[Issue #4441](https://github.com/apache/apisix/issues/4441)\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u73b0\u5728 APISIX stream_routes \u7684\u53c2\u6570 \\"remote_addr\\"\u53ea\u652f\u6301\u5355\u4e2a ip\uff0c\u9700\u8981\u652f\u6301\u591a\u4e2a ip \u6216\u8005\u50cf \\"192.168.0.0/16 \\"\u8fd9\u6837\u7684\u5339\u914d\u89c4\u5219\uff0c\u5c31\u50cf http \u8def\u7531\u53c2\u6570 \\"remote_addr\\"\u4e00\u6837\u3002\\n\\n### Issue #3601\\n\\n**\u94fe\u63a5**\uff1a[Issue #3601](https://github.com/apache/apisix/issues/3601)\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u76ee\u524d APISIX \u53ea\u6709\u8bf7\u6c42-\u54cd\u5e94 gRPC \u4ee3\u7406\u7684\u5355\u5143\u6d4b\u8bd5\uff0c\u6ca1\u6709\u6d41\u5f0f gRPC \u7684\u76f8\u5173\u6d4b\u8bd5\u3002\u9700\u8981\u4e3a\u5176\u6dfb\u52a0\u6d41\u5f0f gRPC \u7684\u6d4b\u8bd5\u7528\u4f8b\u3002\\n\\n### Issue #3931\\n\\n**\u94fe\u63a5**\uff1a[Issue #3931](https://github.com/apache/apisix/issues/3931)\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u91cd\u5b9a\u5411\u63d2\u4ef6\u4e2d\u7684 http_to_https \u7f3a\u4e4f curl \u6d4b\u8bd5\uff0c\u9700\u8981\u4e3a\u91cd\u5b9a\u5411\u63d2\u4ef6\u4e2d\u7684 http_to_https \u6dfb\u52a0 curl \u6d4b\u8bd5\uff0c\u5e76\u66f4\u65b0\u6587\u6863 [Apache APISIX \u91cd\u5b9a\u5411\u63d2\u4ef6](http://apisix.apache.org/docs/apisix/plugins/redirect)\u3002\\n\\n## \u672c\u5468\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- uri-blocker \u652f\u6301\u5339\u914d\u8bf7\u6c42 URI \u65f6\u5ffd\u7565\u5927\u5c0f\u5199\\n  - **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4868\\n  - **\u8d21\u732e\u8005**\uff1a[okaybase](https://github.com/okaybase)\\n\\n- kafka-logger \u652f\u6301\u914d\u7f6e kafka \u751f\u4ea7\u8005\u7684 acks \u53c2\u6570\\n  - **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4878\\n  - **\u8d21\u732e\u8005**\uff1a[okaybase](https://github.com/okaybase)\\n\\n- kafka-logger \u652f\u6301\u914d\u7f6e cluster name \u53c2\u6570\\n  - **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4876\\n  - **\u8d21\u732e\u8005**\uff1a[tzssangglass](https://github.com/tzssangglass)\\n\\n- referer-restriction \u652f\u6301\u914d\u7f6e blacklist\\n  - **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4916\\n  - **\u8d21\u732e\u8005**\uff1a[okaybase](https://github.com/okaybase)\\n\\n## \u672c\u5468\u535a\u6587\u63a8\u8350\\n\\n- [\u4f7f\u7528 Apache APISIX \u7684 OpenID Connect \u63d2\u4ef6\u8fdb\u884c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1](https://apisix.apache.org/blog/2021/08/25/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication/)\uff1aApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u4e0d\u4ec5\u652f\u6301\u63d2\u4ef6\u52a8\u6001\u53d8\u66f4\u548c\u70ed\u63d2\u62d4\uff0c\u800c\u4e14\u62e5\u6709\u4f17\u591a\u5b9e\u7528\u7684\u63d2\u4ef6\u3002Apache APISIX \u7684 OpenID Connect \u63d2\u4ef6\u652f\u6301 OpenID\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u8be5\u63d2\u4ef6\u5c06\u8eab\u4efd\u8ba4\u8bc1\u4ece\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u66ff\u6362\u4e3a\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\u3002\\n\\n- [\u4e3a\u4ec0\u4e48 APISIX \u9009\u62e9 Nginx + Lua \u8fd9\u4e2a\u6280\u672f\u6808\uff1f](https://apisix.apache.org/blog/2021/08/25/Why-Apache-APISIX-chose-Nginx-and-Lua)\uff1a\u4ecb\u7ecd APISIX \u9009\u7528 Nginx + Lua \u8fd9\u4e2a\u6280\u672f\u6808\u7684\u5386\u53f2\u80cc\u666f\u548c\u4f18\u52bf\uff0c\u6307\u51fa\u201c\u9ad8\u6027\u80fd + \u7075\u6d3b\u201d\u662f APISIX \u80fd\u591f\u4ece\u4f17\u591a\u7f51\u5173\u4e2d\u8131\u9896\u800c\u51fa\u7684\u91cd\u8981\u539f\u56e0\u3002\\n\\n- [Apache APISIX 2.9 \u6b63\u5f0f\u53d1\u5e03\uff0c\u5e26\u6765\u66f4\u591a\u65b0\u529f\u80fd\uff01](https://apisix.apache.org/blog/2021/08/27/release-apache-apisix-2.9/)\uff1aApache APISIX 2.9 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u8be5\u7248\u672c\u6709 30+ \u5f00\u53d1\u8005\u53c2\u4e0e\uff0c\u5171\u63d0\u4ea4\u4e86 100+ PR\uff0c\u65b0\u589e\u4e86 2 \u4e2a\u65b0\u529f\u80fd\uff0c\u8fdb\u4e00\u6b65\u5b8c\u5584\u4e86\u5bf9\u63d2\u4ef6\u7684\u652f\u6301\uff0c\u5feb\u6765\u4e86\u89e3 Apache APISIX 2.9 \u7248\u672c\u7684\u65b0\u7279\u6027\u5427\uff01"},{"id":"Apache APISIX 2.9 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2021/08/27/release-apache-apisix-2.9","source":"@site/blog/2021/08/27/release-apache-apisix-2.9.md","title":"Apache APISIX 2.9 \u6b63\u5f0f\u53d1\u5e03","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX 2.9 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u8be5\u7248\u672c\u65b0\u589e\u4e86 authz-casbin \u63d2\u4ef6\u3001\u8def\u7531\u7ea7\u522b\u4e0a real-ip \u7684\u52a8\u6001\u914d\u7f6e\u4ee5\u53ca\u5b8c\u5584\u5916\u90e8\u63d2\u4ef6\u673a\u5236\u3002","date":"2021-08-27T00:00:00.000Z","formattedDate":"2021\u5e748\u670827\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.955,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"\u793e\u533a\u5468\u62a5\uff088.23-8.29\uff09","permalink":"/zh/blog/2021/08/30/weekly-report"},"nextItem":{"title":"\u4f7f\u7528 APISIX openid-connect \u63d2\u4ef6\u8fdb\u884c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1","permalink":"/zh/blog/2021/08/25/using-the-apache-apisix-openid-connect-plugin-for-centralized-authentication"}},"content":"> Apache APISIX 2.9 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX 2.9 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\ud83c\udf89 \u8be5\u7248\u672c\u6709 30+ \u5f00\u53d1\u8005\u53c2\u4e0e\uff0c\u5171\u63d0\u4ea4\u4e86 100+ PR\uff0c\u65b0\u589e\u4e86 2 \u4e2a\u65b0\u529f\u80fd\uff0c\u8fdb\u4e00\u6b65\u5b8c\u5584\u4e86\u5bf9\u63d2\u4ef6\u7684\u652f\u6301\uff0c\u5feb\u6765\u4e86\u89e3 Apache APISIX 2.9 \u7248\u672c\u7684\u65b0\u7279\u6027\u5427\uff01\\n\\n\ud83d\udc47\ud83d\udc47\ud83d\udc47\\n\\n## \u65b0\u529f\u80fd\uff1a\u65b0\u589e authz-casbin \u63d2\u4ef6\\n\\nCasbin \u793e\u533a\u5411 APISIX \u8d21\u732e\u4e86 [authz-casbin](https://github.com/apache/apisix/blob/d9b928321fcdd12eef024df8c7c410424c1e0c8b/docs/en/latest/plugins/authz-casbin.md) \u63d2\u4ef6\uff0c\u5728 APISIX 2.9 \u65b0\u7248\u672c\u4e2d\uff0cAPISIX \u53ef\u4ee5\u7ed3\u5408 Casbin \u505a\u8def\u7531\u7ea7\u522b\u4e0a\u7684\u7cbe\u7ec6\u5316\u6743\u9650\u7ba1\u7406\u3002\\n\\nCasbin \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u8bbf\u95ee\u63a7\u5236\u6846\u67b6\uff0c\u652f\u6301\u901a\u8fc7\u914d\u7f6e\u6765\u51b3\u5b9a\u662f\u5426\u5141\u8bb8\u67d0\u4e2a\u8bbf\u95ee\u64cd\u4f5c\u3002\u901a\u8fc7 authz-casbin \u63d2\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e00\u4e2a\u8def\u7531\u91cc\u540c\u65f6\u505a\u591a\u79cd\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\u3002\\n\\n\u8fd9\u4e00\u63a7\u5236\u65e2\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 APISIX Control Plane \u914d\u7f6e\uff1b\u65e2\u53ef\u4ee5\u9488\u5bf9\u7ed9\u5b9a\u8def\u7531\u751f\u6548\uff0c\u53c8\u53ef\u4ee5\u8bbe\u7f6e\u5168\u5c40\u7684\u9ed8\u8ba4\u503c\u3002\u53ef\u4ee5\u8bf4\u975e\u5e38\u5730\u7075\u6d3b\u3002\\n\\n\u5982\u679c\u60a8\u5bf9\u8fd9\u4e00\u63d2\u4ef6\u611f\u5174\u8da3\uff0c\u6b22\u8fce\u60a8\u79fb\u6b65\u9605\u8bfb [\u5728 Apache APISIX \u4e2d\u4f7f\u7528 Casbin \u8fdb\u884c\u6388\u6743](https://apisix.apache.org/blog/2021/08/18/Auth-with-Casbin-in-Apache-APISIX) \u3002\\n\\n## \u65b0\u529f\u80fd\uff1a \u8def\u7531\u7ea7\u522b\u4e0a real-ip \u7684\u52a8\u6001\u914d\u7f6e\\n\\nAPISIX 2.9 \u7248\u672c\u73b0\u5728\u652f\u6301\u5728\u8def\u7531\u7ea7\u522b\u4e0a\u52a8\u6001\u914d\u7f6e real-ip \u4e86\uff01\\n\\n\u65b0\u7248\u672c\u65b0\u589e\u4e86 [real-ip](https://apisix.apache.org/zh/docs/apisix/plugins/real-ip/) \u63d2\u4ef6\uff0creal-ip \u63d2\u4ef6\u53ef\u4ee5\u52a8\u6001\u5730\u6539\u53d8 APISIX \u770b\u5230\u7684\u5ba2\u6237\u7aef\u7684 IP \u548c\u7aef\u53e3\u3002\\n\\n\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u63d2\u4ef6\u52a8\u6001\u8bbe\u7f6e real-ip \u53c2\u6570.\\n\\n```JSON\\n{\\n    \\"plugins\\": {\\n        \\"real-ip\\": {\\n            \\"source\\": \\"http_x_forwarded_for\\",\\n            \\"trusted_addresses\\": [\\"127.0.0.0/24\\"]\\n        }\\n    }\\n}\\n```\\n\\n## \u5b8c\u5584\uff1a\u5916\u90e8\u63d2\u4ef6\u673a\u5236\\n\\nAPISIX 2.9 \u7248\u672c\u8fdb\u4e00\u6b65\u5b8c\u5584\u4e86\u5bf9\u5916\u90e8\u63d2\u4ef6\u7684\u652f\u6301\uff0c\u505a\u51fa\u4e86\u4e24\u4e2a\u8f83\u5927\u7684\u6539\u52a8\uff1a\\n\\n1. \u5411 Plugin Runner \u53d1\u9001\u63d2\u4ef6\u914d\u7f6e\u65f6\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2a\u552f\u4e00 key\u3002\u7531\u4e8e APISIX \u662f\u591a\u8fdb\u7a0b\u67b6\u6784\uff0c\u8fc7\u53bb\u53d1\u9001\u63d2\u4ef6\u914d\u7f6e\u65f6\u4f1a\u51fa\u73b0\u4e00\u4e2a\u914d\u7f6e\u88ab\u53d1\u9001\u51e0\u6b21\u7684\u60c5\u51b5\uff0c\u5bfc\u81f4 Plugin Runner \u91cd\u590d\u66f4\u65b0\u63d2\u4ef6\u914d\u7f6e\u3002\u5982\u4eca\uff0c\u51ed\u501f\u8fd9\u4e2a\u552f\u4e00 key\uff0cPlugin Runner \u53ef\u4ee5\u8bc6\u522b\u91cd\u590d\u7684\u914d\u7f6e\u3002\u8fd9\u4f7f\u5f97\u5728 Plugin Runner \u91cc\u9762\u5b9e\u73b0\u9650\u6d41\u4e00\u7c7b\u7684\u63d2\u4ef6\u53d8\u5f97\u53ef\u80fd\uff01\\n\\n2. \u589e\u52a0\u4ece Plugin Runner \u53cd\u5411\u83b7\u53d6 APISIX \u4fe1\u606f\u7684\u673a\u5236\u3002\u9664\u4e86 APISIX \u5411 Plugin Runner \u53d1\u9001\u7684\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u8def\u5f84\u7b49\u4fe1\u606f\u5916\uff0cPlugin Runner \u4e5f\u53ef\u4ee5\u53cd\u5411\u4ece APISIX \u67e5\u8be2\u4fe1\u606f\u3002\u76ee\u524d\u5df2\u7ecf\u5728 Go Plugin Runner \u7684\u5b9e\u73b0\u4e2d\uff0c\u501f\u52a9\u8fd9\u4e00\u673a\u5236\u5b9e\u73b0\u4e86 Var API\uff0c\u53ef\u4ee5\u5f97\u5230\u8bf7\u6c42\u7684 request_time \u7b49\u8ddf Nginx \u53d8\u91cf\u76f8\u5173\u7684\u4fe1\u606f\u3002\\n\\n\u5305\u542b\u4e86\u8fd9\u4e00\u6539\u52a8\u7684 [Go Plugin Runner](https://github.com/apache/apisix-go-plugin-runner/tree/6f249010b83a124bc30e940635db7fa0838e2c4a) \u5c06\u4f1a\u5728\u4e0b\u5468\u53d1\u5e03 0.2.0 \u7248\u672c\uff0c\u656c\u8bf7\u671f\u5f85\uff01\\n\\n## \u5b8c\u5584\uff1a\u73b0\u6709\u63d2\u4ef6\u529f\u80fd\u66f4\u4e3a\u4e30\u5bcc\\n\\nAPISIX 2.9 \u7248\u672c\u5b8c\u5584\u4e86\u73b0\u6709\u63d2\u4ef6\u7684\u529f\u80fd\uff0c\u505a\u51fa\u4e86\u4e24\u4e2a\u8f83\u5927\u7684\u6539\u52a8\uff1a\\n\\n1. [request-id](https://apisix.apache.org/zh/docs/apisix/plugins/request-id/) \u63d2\u4ef6\u652f\u6301\u901a\u8fc7 snowflake \u7b97\u6cd5\u751f\u6210 ID\u3002snowflake ID \u751f\u6210\u7b97\u6cd5\u662f\u4e00\u5957\u5206\u5e03\u5f0f\u7684 ID \u751f\u6210\u673a\u5236\uff0c\u5176\u751f\u6210\u7684 ID \u7ed3\u5408\u4e86 machine ID\u3001\u65f6\u95f4\u6233\u548c\u751f\u6210\u5e8f\u5217\u3002\u6211\u4eec\u901a\u8fc7 etcd \u6765\u4fdd\u8bc1\u6bcf\u4e2a worker \u90fd\u80fd\u5206\u914d\u5230\u4e00\u4e2a\u552f\u4e00\u7684 machine ID\u3002\\n\\n2. [error-log-logger](https://apisix.apache.org/zh/docs/apisix/plugins/error-log-logger/) \u63d2\u4ef6\u652f\u6301\u4e0a\u62a5 error log \u7ed9 skywalking\uff0c\u8ba9 APISIX \u7684\u53ef\u89c2\u6d4b\u6027\u9526\u4e0a\u6dfb\u82b1\u3002\\n\\n## \u4e0b\u8f7d\\n\\n\u60a8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u9875\u9762\u4e0b\u8f7d Apache APISIX 2.9\uff1a\\n\\n- \u6e90\u4ee3\u7801\uff1a\u8bf7\u8bbf\u95ee[\u4e0b\u8f7d\u9875\u9762](https://apisix.apache.org/downloads/)\\n- \u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\uff1a\u8bf7\u8bbf\u95ee[\u5b89\u88c5\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/how-to-build/)"},{"id":"2021/08/25/using-the-apache-apisix-openid-connect-plugin-for-centralized-authentication","metadata":{"permalink":"/zh/blog/2021/08/25/using-the-apache-apisix-openid-connect-plugin-for-centralized-authentication","source":"@site/blog/2021/08/25/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication.md","title":"\u4f7f\u7528 APISIX openid-connect \u63d2\u4ef6\u8fdb\u884c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1","description":"\u901a\u8fc7\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684 openid-connect \u63d2\u4ef6\uff0c\u4f60\u53ef\u4ee5\u5feb\u901f\u5bf9\u63a5\u96c6\u4e2d\u5f0f\u8ba4\u8bc1\u8f6f\u4ef6 OKat\uff0c\u4ee5\u7b80\u5316\u5e94\u7528\u5f00\u53d1\u6d41\u7a0b\u53ca\u63d0\u9ad8\u4e1a\u52a1\u7684\u5b89\u5168\u6027\uff0c\u4fdd\u62a4\u540e\u7aef\u7684\u5e94\u7528\u3002","date":"2021-08-25T00:00:00.000Z","formattedDate":"2021\u5e748\u670825\u65e5","tags":[{"label":"Authentication","permalink":"/zh/blog/tags/authentication"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"},{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":14.44,"truncated":true,"authors":[{"name":"\u6731\u6b23\u6b23","title":"Author","url":"https://github.com/starsz","image_url":"https://avatars.githubusercontent.com/u/25628854?v=4","imageURL":"https://avatars.githubusercontent.com/u/25628854?v=4"},{"name":"\u66fe\u5955\u9716","title":"Technical Writer","url":"https://github.com/yzeng25","image_url":"https://avatars.githubusercontent.com/u/36651058?v=4","imageURL":"https://avatars.githubusercontent.com/u/36651058?v=4"}],"prevItem":{"title":"Apache APISIX 2.9 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/08/27/release-apache-apisix-2.9"},"nextItem":{"title":"\u4e3a\u4ec0\u4e48 Apache APISIX \u9009\u62e9 NGINX+Lua \u6280\u672f\u6808\uff1f","permalink":"/zh/blog/2021/08/25/why-apache-apisix-chose-nginx-and-lua"}},"content":"> \u76f8\u6bd4\u8f83\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\uff0c\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\u4e0b\u6709\u5982\u4e0b\u4f18\u70b9\uff1a\u7b2c\u4e00\uff0c\u7b80\u5316\u5e94\u7528\u5f00\u53d1\u6d41\u7a0b\uff0c\u964d\u4f4e\u5f00\u53d1\u5e94\u7528\u5de5\u4f5c\u91cf\u548c\u7ef4\u62a4\u6210\u672c\uff0c\u907f\u514d\u5404\u4e2a\u5e94\u7528\u91cd\u590d\u5f00\u53d1\u8eab\u4efd\u8ba4\u8bc1\u4ee3\u7801\uff1b\u7b2c\u4e8c\uff0c\u63d0\u9ad8\u4e1a\u52a1\u7684\u5b89\u5168\u6027\uff0c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u5728\u7f51\u5173\u5c42\u9762\u80fd\u591f\u53ca\u65f6\u62e6\u622a\u672a\u7ecf\u8eab\u4efd\u8ba4\u8bc1\u7684\u8bf7\u6c42\uff0c\u4fdd\u62a4\u540e\u7aef\u7684\u5e94\u7528\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u4ec0\u4e48\u662f Apache APISIX\\n\\n[Apache APISIX](https://apisix.apache.org/) \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u4e0d\u4ec5\u652f\u6301\u63d2\u4ef6\u52a8\u6001\u53d8\u66f4\u548c\u70ed\u63d2\u62d4\uff0c\u800c\u4e14\u62e5\u6709\u4f17\u591a\u5b9e\u7528\u7684\u63d2\u4ef6\u3002Apache APISIX \u7684 OpenID Connect \u63d2\u4ef6\u652f\u6301 OpenID\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u8be5\u63d2\u4ef6\u5c06\u8eab\u4efd\u8ba4\u8bc1\u4ece\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u66ff\u6362\u4e3a\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\u3002\\n\\n## \u4ec0\u4e48\u662f\u8eab\u4efd\u8ba4\u8bc1\\n\\n\u8eab\u4efd\u8ba4\u8bc1\u662f\u6307\u901a\u8fc7\u4e00\u5b9a\u7684\u624b\u6bb5\uff0c\u5bf9\u7528\u6237\u7684\u8eab\u4efd\u8fdb\u884c\u9a8c\u8bc1\u3002\u5e94\u7528\u901a\u8fc7\u8eab\u4efd\u8ba4\u8bc1\u8bc6\u522b\u7528\u6237\u8eab\u4efd\uff0c\u5e76\u6839\u636e\u7528\u6237\u8eab\u4efd ID \u4ece\u8eab\u4efd\u63d0\u4f9b\u65b9\uff08Identity Provider\uff09\u83b7\u53d6\u8be6\u7ec6\u7684\u7528\u6237\u5143\u6570\u636e\uff0c\u5e76\u4ee5\u6b64\u5224\u65ad\u7528\u6237\u662f\u5426\u62e5\u6709\u8bbf\u95ee\u6307\u5b9a\u8d44\u6e90\u7684\u6743\u9650\u3002\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a**\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f**\u548c**\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f**\u3002\\n\\n### \u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\\n\\n\u5728\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u4e0b\uff0c\u5404\u4e2a\u5e94\u7528\u670d\u52a1\u9700\u8981\u5355\u72ec\u652f\u6301\u8eab\u4efd\u8ba4\u8bc1\uff0c\u4f8b\u5982\u5f53\u7528\u6237\u672a\u767b\u5f55\u65f6\u8bbf\u95ee\u767b\u5f55\u63a5\u53e3\uff0c\u63a5\u53e3\u8fd4\u56de 301 \u8df3\u8f6c\u9875\u9762\u3002\u5e94\u7528\u9700\u8981\u5f00\u53d1\u7ef4\u62a4 Session \u4ee5\u53ca\u548c\u8eab\u4efd\u63d0\u4f9b\u5546\u7684\u8ba4\u8bc1\u4ea4\u4e92\u7b49\u903b\u8f91\u3002\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u7684\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a\u9996\u5148\u7531\u7528\u6237\u53d1\u8d77\u8bf7\u6c42\uff08request\uff09\uff0c\u7136\u540e\u7531\u7f51\u5173\u63a5\u6536\u8bf7\u6c42\u5e76\u5c06\u5176\u8f6c\u53d1\u81f3\u5bf9\u5e94\u7684\u5e94\u7528\u670d\u52a1\uff0c\u6700\u540e\u7531\u5e94\u7528\u670d\u52a1\u4e0e\u8eab\u4efd\u63d0\u4f9b\u65b9\u5bf9\u63a5\uff0c\u5b8c\u6210\u8eab\u4efd\u8ba4\u8bc1\uff08authorization\uff09\u3002\\n\\n![\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u6d41\u7a0b\u56fe](https://static.apiseven.com/202108/1639467045776-715e1805-540b-4cef-87c5-6166e2af43a8.png)\\n\\n### \u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\\n\\n\u4e0e\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u4e0d\u540c\uff0c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u628a\u7528\u6237\u8ba4\u8bc1\u4ece\u5e94\u7528\u670d\u52a1\u4e2d\u62bd\u79bb\u4e86\u51fa\u6765\uff0c\u4ee5 Apache APISIX \u4e3a\u4f8b\uff0c\u96c6\u4e2d\u8ba4\u8bc1\u7684\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a\u9996\u5148\u7531\u7528\u6237\u53d1\u8d77\u8bf7\u6c42\uff08request\uff09\uff0c\u7136\u540e\u7531\u524d\u7f6e\u7684\u7f51\u5173\u8d1f\u8d23\u7528\u6237\u8ba4\u8bc1\u6d41\u7a0b\uff0c\u4e0e\u8eab\u4efd\u63d0\u4f9b\u65b9\u5bf9\u63a5\uff0c\u5411\u8eab\u4efd\u63d0\u4f9b\u65b9\u53d1\u9001\u8eab\u4efd\u8ba4\u8bc1\uff08authorization\uff09\u8bf7\u6c42\u3002\u8eab\u4efd\u63d0\u4f9b\u65b9\u8fd4\u56de\u7528\u6237\u8eab\u4efd\u4fe1\u606f\uff08user info\uff09\u3002\u7f51\u5173\u5b8c\u6210\u7528\u6237\u8eab\u4efd\u8bc6\u522b\u540e\uff0c\u5c06\u7528\u6237\u8eab\u4efd\u4fe1\u606f\u901a\u8fc7\u8bf7\u6c42\u5934\u7684\u5f62\u5f0f\u8f6c\u53d1\u81f3\u540e\u7aef\u5e94\u7528\u3002\\n\\n![\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\u6d41\u7a0b\u56fe](https://static.apiseven.com/202108/1639467122244-d4292436-c5ce-48f6-b1d5-67645f24fbc9.png)\\n\\n\u76f8\u6bd4\u8f83\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\uff0c\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\u4e0b\u6709\u5982\u4e0b\u4f18\u70b9\uff1a\\n\\n1. \u7b80\u5316\u5e94\u7528\u5f00\u53d1\u6d41\u7a0b\uff0c\u964d\u4f4e\u5f00\u53d1\u5e94\u7528\u5de5\u4f5c\u91cf\u548c\u7ef4\u62a4\u6210\u672c\uff0c\u907f\u514d\u5404\u4e2a\u5e94\u7528\u91cd\u590d\u5f00\u53d1\u8eab\u4efd\u8ba4\u8bc1\u4ee3\u7801\u3002\\n2. \u63d0\u9ad8\u4e1a\u52a1\u7684\u5b89\u5168\u6027\uff0c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u5728\u7f51\u5173\u5c42\u9762\u80fd\u591f\u53ca\u65f6\u62e6\u622a\u672a\u7ecf\u8eab\u4efd\u8ba4\u8bc1\u7684\u8bf7\u6c42\uff0c\u4fdd\u62a4\u540e\u7aef\u7684\u5e94\u7528\u3002\\n\\n## \u4ec0\u4e48\u662f OpenID\\n\\nOpenID \u662f\u4e00\u79cd\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\uff0c\u5b83\u662f\u4e00\u4e2a\u53bb\u4e2d\u5fc3\u5316\u7684\u8eab\u4efd\u8ba4\u8bc1\u7cfb\u7edf\u3002\u4f7f\u7528 OpenID \u7684\u597d\u5904\u662f\uff0c\u7528\u6237\u53ea\u9700\u8981\u5728\u4e00\u4e2a OpenID \u8eab\u4efd\u63d0\u4f9b\u65b9\u7684\u7f51\u7ad9\u4e0a\u6ce8\u518c\u548c\u767b\u5f55\uff0c\u4f7f\u7528\u4e00\u4efd\u8d26\u6237\u5bc6\u7801\u4fe1\u606f\u5373\u53ef\u8bbf\u95ee\u4e0d\u540c\u5e94\u7528\u3002Okta \u662f\u4e00\u4e2a\u5e38\u89c1\u7684 OpenID \u8eab\u4efd\u63d0\u4f9b\u65b9\uff0cApache APISIX OpenID Connect \u63d2\u4ef6\u652f\u6301 OpenID\uff0c\u6240\u4ee5\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u8be5\u63d2\u4ef6\u5c06\u4f20\u7edf\u8ba4\u8bc1\u6a21\u5f0f\u66ff\u6362\u4e3a\u96c6\u4e2d\u8ba4\u8bc1\u6a21\u5f0f\u3002\\n\\n### OpenID \u8ba4\u8bc1\u8fc7\u7a0b\\n\\nOpenID \u8ba4\u8bc1\u8fc7\u7a0b\u6709\u4ee5\u4e0b 7 \u4e2a\u6b65\u9aa4\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\\n\\n1. APISIX \u5411 Identity Provider \u53d1\u8d77\u8ba4\u8bc1\u8bf7\u6c42\u3002\\n2. \u7528\u6237\u5728 Identity Provider \u4e0a\u767b\u5f55\u5e76\u8ba4\u8bc1\u8eab\u4efd\u3002\\n3. Identity Provider \u643a\u5e26 Authorization Code \u8fd4\u56de APISIX\u3002\\n4. APISIX \u4f7f\u7528\u4ece\u8bf7\u6c42\u53c2\u6570\u4e2d\u63d0\u53d6\u5230\u7684 Code \u8bf7\u6c42 Identity Provider\u3002\\n5. Identity Provider \u5411 APISIX \u53d1\u9001\u5e94\u7b54\u6d88\u606f\uff0c\u91cc\u9762\u5305\u542b\u4e86 ID Token \u548c Access Token\u3002\\n6. APISIX \u5c06 Access Token \u53d1\u9001\u5230 Identity Provider \u7684 User Endpoint\uff0c\u4ee5\u8fdb\u884c\u83b7\u53d6\u7528\u6237\u8eab\u4efd\u3002\\n7. \u901a\u8fc7\u8ba4\u8bc1\u540e\uff0cUser Endpoint \u5c06 User info \u53d1\u9001\u5230 APISIX\uff0c\u5b8c\u6210\u8eab\u4efd\u9a8c\u8bc1\u3002\\n\\n![OpenID \u8ba4\u8bc1\u6d41\u7a0b\u56fe](https://static.apiseven.com/202108/1639467187923-71854ddb-65fd-4a90-8bd0-242b47a8624b.png)\\n\\n## \u5982\u4f55\u4f7f\u7528 Apache APISIX \u7684 OpenID Connect \u63d2\u4ef6\u914d\u7f6e Okta \u8ba4\u8bc1\\n\\n\u4f7f\u7528 Apache APISIX OpenID Connect \u63d2\u4ef6\u914d\u7f6e Okta \u8ba4\u8bc1\u7684\u8fc7\u7a0b\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u4e09\u6b65\u5373\u53ef\u5b8c\u6210 Okta \u914d\u7f6e \uff0c\u4ece\u4f20\u7edf\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u5207\u6362\u5230\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u6a21\u5f0f\u3002\u4e0b\u6587\u8bb2\u8ff0\u4e86\u4f7f\u7528 Apache APISIX \u7684 OpenID Connect \u63d2\u4ef6\u914d\u7f6e Okta \u8ba4\u8bc1\u7684\u64cd\u4f5c\u6b65\u9aa4\u3002\\n\\n### \u524d\u63d0\u6761\u4ef6\\n\\n\u5df2\u6709 Okta \u8d26\u53f7\u3002\\n\\n### \u6b65\u9aa4\u4e00\uff1a\u914d\u7f6e Okta\\n\\n1. \u767b\u5f55\u4f60\u7684 Okta \u8d26\u53f7\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a Okta \u5e94\u7528\uff0c\u9009\u62e9 OIDC \u767b\u5f55\u6a21\u5f0f\u4ee5\u53ca Web Application \u5e94\u7528\u7c7b\u578b\u3002\\n    ![\u521b\u5efa\u4e00\u4e2a Okta \u5e94\u7528](https://static.apiseven.com/202108/1639467243454-ac16645a-4a8a-426f-93a2-e840cae3c502.png)\\n    ![\u9009\u62e9 OIDC \u767b\u5f55\u6a21\u5f0f\u4ee5\u53ca Web Application \u5e94\u7528\u7c7b\u578b](https://static.apiseven.com/202108/1639467299429-0ea741a7-95fd-43b5-a0c4-25a7026e62d2.png)\\n2. \u8bbe\u7f6e\u767b\u5f55\u548c\u767b\u51fa\u7684\u8df3\u8f6c URL\u3002\\n\u5176\u4e2d \u201cSign-in redirect URIs\u201d \u4e3a\u767b\u5f55\u6210\u529f\u5141\u8bb8\u8df3\u8f6c\u7684\u94fe\u63a5\u5730\u5740\uff0c\u201cSign-out redirect URIs\u201d \u8868\u793a\u767b\u51fa\u4e4b\u540e\u8df3\u8f6c\u7684\u94fe\u63a5\u5730\u5740\u3002\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c06\u767b\u5f55\u6210\u529f\u8df3\u8f6c\u548c\u767b\u51fa\u4e4b\u540e\u8df3\u8f6c\u7684\u94fe\u63a5\u5730\u5740\u90fd\u8bbe\u7f6e\u4e3a `http://127.0.0.1:9080/`\u3002\\n    ![\u8bbe\u7f6e\u767b\u5f55\u548c\u767b\u51fa\u7684\u8df3\u8f6c URL](https://static.apiseven.com/202108/1639467390099-e9594a05-7e78-4f20-a902-7c4ca2c302fb.png)\\n3. \u5b8c\u6210\u8bbe\u7f6e\u4ee5\u540e\uff0c\u5355\u51fb\u201cSave\u201d\u4fdd\u5b58\u4fee\u6539\u3002\\n    ![\u4fdd\u5b58\u4fee\u6539](https://static.apiseven.com/202108/1639467449049-628d7796-0d8e-4ed9-8334-5ba7f0fb32f4.png)\\n4. \u8bbf\u95ee\u5e94\u7528\u7684 General \u9875\u9762\uff0c\u83b7\u53d6\u4ee5\u4e0b\u914d\u7f6e\uff0c\u914d\u7f6e Apache APISIX OpenID Connect \u65f6\u9700\u8981\u63d0\u4f9b\u8fd9\u4e9b\u4fe1\u606f\uff1a\\n\\n- Client ID\uff1aOAuth client ID\uff0c\u5373\u5e94\u7528\u7684 ID\uff0c\u4e0e\u4e0b\u6587\u7684 `client_id`  \u548c `{YOUR_CLIENT_ID}` \u5bf9\u5e94\u3002\\n- Client secret\uff1aOAuth client secret\uff0c\u5373\u5e94\u7528\u5bc6\u94a5\uff0c\u4e0e\u4e0b\u6587\u7684 `client_secret`  \u548c `{YOUR_CLIENT_SECRET}` \u5bf9\u5e94\u3002\\n- Okta domain\uff1a\u5e94\u7528\u4f7f\u7528\u7684\u57df\u540d\uff0c\u4e0e\u4e0b\u6587\u7684 discovery  \u4e2d\u7684 `{YOUR_ISSUER}` \u5bf9\u5e94\u3002\\n\\n![\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f](https://static.apiseven.com/202108/1639467501106-d95bf8ad-db47-4918-ac70-424b12488e5b.png)\\n\\n### \u5b89\u88c5 Apache APISIX\\n\\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u6e90\u7801\u5305\u3001Docker\u3001Helm Chart \u7b49\u591a\u79cd\u65b9\u5f0f\u6765\u5b89\u88c5 Apache APISIX\u3002\\n\\n#### \u5b89\u88c5\u4f9d\u8d56\\n\\nApache APISIX \u7684\u8fd0\u884c\u73af\u5883\u9700\u8981\u4f9d\u8d56 NGINX \u548c etcd\uff0c\u6240\u4ee5\u5728\u5b89\u88c5 Apache APISIX \u524d\uff0c\u8bf7\u6839\u636e\u60a8\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u3002\u6211\u4eec\u63d0\u4f9b\u4e86 CentOS7\u3001Fedora 31 & 32 \u3001Ubuntu 16.04 & 18.04\u3001 Debian 9 & 10 \u548c MacOS \u4e0a\u7684\u4f9d\u8d56\u5b89\u88c5\u64cd\u4f5c\u6b65\u9aa4\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003[\u5b89\u88c5\u4f9d\u8d56](https://apisix.apache.org/zh/docs/apisix/install-dependencies/)\u3002\\n\\n\u901a\u8fc7 Docker \u6216 Helm Chart \u5b89\u88c5 Apache APISIX \u65f6\uff0c\u5df2\u7ecf\u5305\u542b\u4e86\u6240\u9700\u7684 NGINX \u548c etcd\uff0c\u8bf7\u53c2\u7167\u5404\u81ea\u5bf9\u5e94\u7684\u6587\u6863\u3002\\n\\n#### \u901a\u8fc7 RPM \u5305\u5b89\u88c5\uff08CentOS 7\uff09\\n\\n\u8fd9\u79cd\u5b89\u88c5\u65b9\u5f0f\u9002\u7528\u4e8e CentOS 7 \u64cd\u4f5c\u7cfb\u7edf\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5 Apache APISIX\u3002\\n\\n```shell\\nsudo yum install -y https://github.com/apache/apisix/releases/download/2.7/apisix-2.7-0.x86_64.rpm\\n```\\n\\n#### \u901a\u8fc7 Docker \u5b89\u88c5\\n\\n\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[\u4f7f\u7528 Docker \u5b89\u88c5 Apache APISIX](https://hub.docker.com/r/apache/apisix)\u3002\\n\\n#### \u901a\u8fc7 Helm Chart \u5b89\u88c5\\n\\n\u8be6\u60c5\u8bf7\u53c2\u8003\uff1a[\u4f7f\u7528 Helm Chart \u5b89\u88c5 Apache APISIX](https://github.com/apache/apisix-helm-chart)\u3002\\n\\n#### \u901a\u8fc7\u6e90\u7801\u5305\u5b89\u88c5\\n\\n1. \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a `apisix-2.7` \u7684\u76ee\u5f55\uff1a\\n  \\n  ```shell\\n  mkdir apisix-2.7\\n  ```\\n\\n2. \u4e0b\u8f7d Apache APISIX Release \u6e90\u7801\u5305\uff1a\\n  \\n  ```shell\\n  wget https://downloads.apache.org/apisix/2.7/apache-apisix-2.7-src.tgz\\n  ```\\n\\n  \u60a8\u4e5f\u53ef\u4ee5\u901a\u8fc7 Apache APISIX \u5b98\u7f51\u4e0b\u8f7d Apache APISIX Release \u6e90\u7801\u5305\u3002 Apache APISIX \u5b98\u7f51\u4e5f\u63d0\u4f9b\u4e86 Apache APISIX\u3001APISIX Dashboard \u548c APISIX Ingress Controller \u7684\u6e90\u7801\u5305\uff0c\u8be6\u60c5\u8bf7\u53c2\u8003 [Apache APISIX \u5b98\u7f51-\u4e0b\u8f7d\u9875](https://apisix.apache.org/zh/downloads)\u3002\\n\\n3. \u89e3\u538b Apache APISIX Release \u6e90\u7801\u5305\uff1a\\n  \\n  ```shell\\n  tar zxvf apache-apisix-2.7-src.tgz -C apisix-2.7\\n  ```\\n\\n4. \u5b89\u88c5\u8fd0\u884c\u65f6\u4f9d\u8d56\u7684 Lua \u5e93\uff1a\\n\\n  ```shell\\n  # \u5207\u6362\u5230 apisix-2.7 \u76ee\u5f55\\n  cd apisix-2.7\\n  # \u521b\u5efa\u4f9d\u8d56\\n  make deps\\n  ```\\n\\n#### \u521d\u59cb\u5316\u4f9d\u8d56\\n\\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u521d\u59cb\u5316 NGINX \u914d\u7f6e\u6587\u4ef6\u548c etcd\u3002\\n\\n```shell\\n# initialize NGINX config file and etcd\\nmake init\\n```\\n\\n### \u542f\u52a8 Apache APISIX \u5e76\u914d\u7f6e\u5bf9\u5e94\u7684\u8def\u7531\\n\\n1. \u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u542f\u52a8 Apache APISIX\u3002\\n\\n2. \u521b\u5efa\u8def\u7531\u5e76\u914d\u7f6e OpenID Connect \u63d2\u4ef6\u3002\\n\\nOpenID Connect \u914d\u7f6e\u5217\u8868\u5982\u4e0b\uff1a\\n\\n|\u5b57\u6bb5|\u9ed8\u8ba4\u503c|\u63cf\u8ff0|\\n| :------| :------------ | :------- |\\n|client_id|\\"\\"|OAuth \u5ba2\u6237\u7aef ID|\\n|client_secret|\\"\\"|OAuth \u5ba2\u6237\u7aef\u5bc6\u94a5|\\n|discovery|\\"\\"|\u8eab\u4efd\u63d0\u4f9b\u5546\u7684\u670d\u52a1\u53d1\u73b0\u7aef\u70b9|\\n|scope|openid|\u9700\u8981\u8bbf\u95ee\u8d44\u6e90\u8303\u56f4|\\n|relm|apisix|\u6307\u5b9a WWW-Authenticate \u54cd\u5e94\u5934\u9a8c\u8bc1\u4fe1\u606f|\\n|bearer_only|false|\u662f\u5426\u68c0\u67e5\u8bf7\u6c42\u5934\u4e2d\u7684 token|\\n|logout_path|/logout|\u767b\u51fa\u7684 URI|\\n|redirect_uri|request_uri|\u8eab\u4efd\u63d0\u4f9b\u5546\u8df3\u8f6c\u56de\u6765\u7684 URI\uff0c\u9ed8\u8ba4\u4e3a\u8bf7\u6c42\u5730\u5740|\\n|timeout|3|\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2|\\n|ssl_verify|false|\u662f\u5426\u8eab\u4efd\u63d0\u4f9b\u5546\u7684\u6821\u9a8c ssl \u8bc1\u4e66|\\n|introspection_endpoint|\\"\\"|\u8eab\u4efd\u63d0\u4f9b\u5546\u7684\u4ee4\u724c\u9a8c\u8bc1\u7aef\u70b9\u7684 URL\uff0c\u4e0d\u586b\u5219\u5c06\u4ece discovery \u54cd\u5e94\u4e2d\u63d0\u53d6|\\n|introspection_endpoint_auth_method|client_secret_basic|\u4ee4\u724c\u81ea\u7701\u7684\u8ba4\u8bc1\u65b9\u6cd5\u540d\u79f0|\\n|public_key|\\"\\"|\u9a8c\u8bc1\u4ee4\u724c\u7684\u516c\u94a5|\\n|token_signing_alg_values_expected|\\"\\"|\u9a8c\u8bc1\u4ee4\u724c\u7684\u7b97\u6cd5|\\n|set_access_token_header|true|\u662f\u5426\u5728\u8bf7\u6c42\u5934\u4e2d\u643a\u5e26 access token|\\n|access_token_in_authorization_header|false|true \u65f6\u5c06 access token \u653e\u7f6e\u5728 Authorization \u5934\u4e2d\uff0cfalse \u65f6\u5c06 access token \u653e\u7f6e\u5728 X-Access-Token \u5934\u4e2d|\\n|set_id_token_header|true|\u662f\u5426\u5c06 ID token \u643a\u5e26\u81f3 X-ID-Token \u8bf7\u6c42\u5934|\\n|set_userinfo_header|true|\u662f\u5426\u5c06\u7528\u6237\u4fe1\u606f\u643a\u5e26\u81f3 X-Userinfo \u8bf7\u6c42\u5934|\\n\\n\u4ee5\u4e0b\u4ee3\u7801\u793a\u4f8b\u901a\u8fc7 Apache APISIX Admin API \u8fdb\u884c\u521b\u5efa\u8def\u7531\uff0c\u8bbe\u7f6e\u8def\u7531\u7684\u4e0a\u6e38\u4e3a httpbin.org\u3002httpbin.org \u662f\u4e00\u4e2a\u7b80\u5355\u7684\u7528\u4e8e\u63a5\u6536\u8bf7\u6c42\u548c\u54cd\u5e94\u8bf7\u6c42\u7684\u540e\u7aef\u670d\u52a1\uff0c\u4e0b\u6587\u5c06\u4f7f\u7528 httpbin.org \u7684 get \u9875\u9762\uff0c\u53c2\u8003 [http bin get](http://httpbin.org/#/HTTP_Methods/get_get)\u3002\\n\\n\u5177\u4f53\u914d\u7f6e\u9879\u8bf7\u53c2\u8003 [Apache APISIX OpenID Connect Plugin](https://apisix.apache.org/zh/docs/apisix/plugins/openid-connect/)\u3002\\n\\n```shell\\ncurl  -XPOST 127.0.0.1:9080/apisix/admin/routes -H \\"X-Api-Key: edd1c9f034335f136f87ad84b625c8f1\\" -d \'{\\n    \\"uri\\":\\"/*\\",\\n    \\"plugins\\":{\\n        \\"openid-connect\\":{\\n            \\"client_id\\":\\"{YOUR_CLIENT_ID}\\",\\n            \\"client_secret\\":\\"{YOUR_CLIENT_SECRET}\\",\\n            \\"discovery\\":\\"https://{YOUR_ISSUER}/.well-known/openid-configuration\\",\\n            \\"scope\\":\\"openid profile\\",\\n            \\"bearer_only\\":false,\\n            \\"realm\\":\\"master\\",\\n            \\"introspection_endpoint_auth_method\\":\\"client_secret_post\\",\\n            \\"redirect_uri\\":\\"http://127.0.0.1:9080/\\"\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"type\\":\\"roundrobin\\",\\n        \\"nodes\\":{\\n            \\"httpbin.org:80\\":1\\n        }\\n    }\\n}\'\\n```\\n\\n### \u6b65\u9aa4\u56db\uff1a\u8bbf\u95ee Apache APISIX\\n\\n1. \u8bbf\u95ee http://127.0.0.1:9080/get \uff0c\u56e0\u4e3a\u5f00\u542f\u4e86 OpenID Connect \u63d2\u4ef6\uff0c\u6240\u4ee5\u9875\u9762\u88ab\u91cd\u5b9a\u5411\u5230 Okta \u767b\u5f55\u9875\u9762\u3002\\n  \\n![visit Okta login page](https://static.apiseven.com/202108/1639467566395-2a049b96-3b1f-4e74-93f0-d6ea2f52a72e.png)\\n  \\n2. \u8f93\u5165\u7528\u6237\u5728 Okta \u6ce8\u518c\u7684\u8d26\u53f7\u5bc6\u7801\uff0c\u5355\u51fb\u201cSign in\u201d\uff0c\u767b\u5f55 Okta \u8d26\u6237\u3002\\n\\n3. \u767b\u5f55\u6210\u529f\u4e4b\u540e\uff0c\u80fd\u6210\u529f\u8bbf\u95ee\u5230 httpbin.org \u4e2d\u7684 get \u9875\u9762\u3002\u8be5 httpbin.org/get \u9875\u9762\u5c06\u8fd4\u56de\u8bf7\u6c42\u7684\u6570\u636e\u5982\u4e0b\uff1a\\n\\n  ```sh\\n  \\"X-Access-Token\\": \\"******Y0RPcXRtc0FtWWVuX2JQaFo1ZVBvSlBNdlFHejN1dXY5elV3IiwiYWxnIjoiUlMyNTYifQ.***TVER3QUlPbWZYSVRzWHRxRWh2QUtQMWRzVDVGZHZnZzAiLCJpc3MiOiJodHRwczovL3FxdGVzdG1hbi5va3RhLmNvbSIsImF1ZCI6Imh0dHBzOi8vcXF0ZXN0bWFuLm9rdGEuY29tIiwic3ViIjoiMjgzMDE4Nzk5QHFxLmNvbSIsImlhdCI6MTYyODEyNjIyNSwiZXhwIjoxNjI4MTI5ODI1LCJjaWQiOiIwb2ExMWc4ZDg3TzBGQ0dYZzY5NiIsInVpZCI6IjAwdWEwNWVjZEZmV0tMS3VvNjk1Iiwic2NwIjpbIm9wZW5pZCIsInByb2Zpb***.****iBshIcJhy8QNvzAFD0fV4gh7OAdTXFMu5k0hk0JeIU6Tfg_Mh-josfap38nxRN5hSWAvWSk8VNxokWTf1qlaRbypJrKI4ntadl1PrvG-HgUSFD0JpyqSQcv10TzVeSgBfOVD-czprG2Azhck-SvcjCNDV-qc3P9KoPQz0SRFX0wuAHWUbj1FRBq79YnoJfjkJKUHz3uu7qpTK89mxco8iyuIwB8fAxPMoXjIuU6-6Bw8kfZ4S2FFg3GeFtN-vE9bE5vFbP-JFQuwFLZNgqI0XO2S7l7Moa4mWm51r2fmV7p7rdpoNXYNerXOeZIYysQwe2_L****\\",\\n  \\"X-Id-Token\\": \\"******aTdDRDJnczF5RnlXMUtPZUtuSUpQdyIsImFtciI6WyJwd2QiXSwic3ViIjoiMDB1YTA1ZWNkRmZXS0xLdW82OTUiLCJpc3MiOiJodHRwczpcL1wvcXF0ZXN0bWFuLm9rdGEuY29tIiwiYXVkIjoiMG9hMTFnOGQ4N08wRkNHWGc2OTYiLCJuYW1lIjoiUGV0ZXIgWmh1IiwianRpIjoiSUQuNGdvZWo4OGUyX2RuWUI1VmFMeUt2djNTdVJTQWhGNS0tM2l3Z0p5TTcxTSIsInZlciI6MSwicHJlZmVycmVkX3VzZXJuYW1lIjoiMjgzMDE4Nzk5QHFxLmNvbSIsImV4cCI6MTYyODEyOTgyNSwiaWRwIjoiMDBvYTA1OTFndHAzMDhFbm02OTUiLCJub25jZSI6ImY3MjhkZDMxMWRjNGY3MTI4YzlmNjViOGYzYjJkMDgyIiwiaWF0IjoxNjI4MTI2MjI1LCJhdXRoX3RpbWUi*****\\",\\n  \\"X-Userinfo\\": \\"*****lfbmFtZSI6IlpodSIsImxvY2FsZSI6ImVuLVVTIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiMjgzMDE4Nzk5QHFxLmNvbSIsInVwZGF0ZWRfYXQiOjE2MjgwNzA1ODEsInpvbmVpbmZvIjoiQW1lcmljYVwvTG9zX0FuZ2VsZXMiLCJzdWIiOiIwMHVhMDVlY2RGZldLTEt1bzY5NSIsImdpdmVuX25hbWUiOiJQZXRlciIsIm5hbWUiOiJQZXRl****\\"\\n  ```\\n\\n\u5176\u4e2d\uff1a\\n\\n**X-Access-Token**\uff1aApache APISIX \u5c06\u4ece\u7528\u6237\u63d0\u4f9b\u5546\u83b7\u53d6\u5230\u7684 access token \u653e\u5165 X-Access-Token \u8bf7\u6c42\u5934\uff0c\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 access_token_in_authorization_header \u6765\u9009\u62e9\u662f\u5426\u653e\u5165 Authorization \u8bf7\u6c42\u5934\u4e2d\u3002\\n\\n![X-Access-Token](https://static.apiseven.com/202108/1639467626264-980605e2-0b21-4512-9e2c-af71950fcf99.png)\\n\\n**X-Id-Token**\uff1aApache APISIX \u5c06\u4ece\u7528\u6237\u63d0\u4f9b\u5546\u83b7\u53d6\u5230\u7684 ID token \u901a\u8fc7 base64 \u7f16\u7801\u4e4b\u540e\u653e\u5165 X-Id-Token \u8bf7\u6c42\u5934\uff0c\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 set_id_token_header \u6765\u9009\u62e9\u662f\u5426\u5f00\u542f\u8be5\u529f\u80fd\uff0c\u9ed8\u8ba4\u4e3a\u4e3a\u5f00\u542f\u72b6\u6001\u3002\\n\\n![X-Id-Token](https://static.apiseven.com/202108/1639467682902-ada726b8-b46b-460d-8313-ef47b38d13ab.png)\\n\\n**X-Userinfo**\uff1a  Apache APISIX \u5c06\u4ece\u7528\u6237\u63d0\u4f9b\u5546\u83b7\u53d6\u5230\u7684\u7528\u6237\u4fe1\u606f\uff0c\u901a\u8fc7 base64 \u7f16\u7801\u4e4b\u540e\u653e\u5165 X-Userinfo\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u914d\u7f6e\u4e2d\u7684 set_userinfo_header \u6765\u9009\u62e9\u662f\u5426\u5f00\u542f\u8be5\u529f\u80fd\uff0c\u9ed8\u8ba4\u4e3a\u5f00\u542f\u72b6\u6001\u3002\\n\\n![X-Userinfo](https://static.apiseven.com/202108/1639467730566-fc8a8a76-a3aa-4b8e-bb13-505b50839877.png)\\n\\n\u7531\u6b64\u53ef\u4ee5\u770b\u5230\uff0cApache APISIX \u5c06\u4f1a\u643a\u5e26 X-Access-Token,X-Id-Token,X-Userinfo \u4e09\u4e2a\u8bf7\u6c42\u5934\u4f20\u9012\u81f3\u4e0a\u6e38\u3002\u4e0a\u6e38\u53ef\u4ee5\u901a\u8fc7\u89e3\u6790\u8fd9\u51e0\u4e2a\u5934\u90e8\uff0c\u4ece\u800c\u83b7\u53d6\u5230\u7528\u6237 ID \u4fe1\u606f\u548c\u7528\u6237\u7684\u5143\u6570\u636e\u3002\\n\\n\u6211\u4eec\u5c55\u793a\u4e86\u5728 Apache APISIX \u4e2d\u76f4\u63a5\u5efa\u7acb\u6765\u81ea Okta \u7684\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7684\u8fc7\u7a0b\u3002\u53ea\u8981\u6ce8\u518c\u4e00\u4e2a\u514d\u8d39\u7684 Okta \u5f00\u53d1\u8005\u8d26\u6237\u5c31\u53ef\u4ee5\u8f7b\u677e\u5f00\u59cb\u4e86\u3002\u8fd9\u79cd\u96c6\u4e2d\u8ba4\u8bc1\u7684\u65b9\u6cd5\u51cf\u5c11\u4e86\u5f00\u53d1\u8005\u7684\u5b66\u4e60\u548c\u7ef4\u62a4\u6210\u672c\uff0c\u63d0\u4f9b\u4e86\u5b89\u5168\u548c\u7cbe\u7b80\u7684\u7528\u6237\u4f53\u9a8c\u3002\\n\\n## \u5173\u4e8e Okta\\n\\nOkta \u662f\u4e00\u4e2a\u53ef\u5b9a\u5236\u7684\u3001\u5b89\u5168\u7684\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u89e3\u51b3\u65b9\u6848\u3002Okta \u53ef\u4ee5\u4e3a\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u6dfb\u52a0\u8ba4\u8bc1\u548c\u6388\u6743\u3002\u4e0d\u9700\u8981\u81ea\u5df1\u7f16\u5199\u4ee3\u7801\uff0c\u5373\u53ef\u5728\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u76f4\u63a5\u83b7\u5f97\u53ef\u6269\u5c55\u7684\u8ba4\u8bc1\u3002\u60a8\u53ef\u4ee5\u5c06\u5e94\u7528\u7a0b\u5e8f\u8fde\u63a5\u5230 Okta\uff0c\u5e76\u5b9a\u4e49\u7528\u6237\u7684\u767b\u5f55\u65b9\u5f0f\u3002\u6bcf\u6b21\u7528\u6237\u5c1d\u8bd5\u8ba4\u8bc1\u65f6\uff0cOkta \u90fd\u4f1a\u9a8c\u8bc1\u4ed6\u4eec\u7684\u8eab\u4efd\uff0c\u5e76\u5c06\u6240\u9700\u4fe1\u606f\u53d1\u56de\u7ed9\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\\n\\n## \u5173\u4e8e Apache APISIX\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4ee5\u53ca\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5f53\u505a [Kubernetes Ingress Controller](https://github.com/apache/apisix-ingress-controller) \u6765\u4f7f\u7528\u3002\\n\\n\u5168\u7403\u5df2\u6709\u6570\u767e\u5bb6\u4f01\u4e1a\u4f7f\u7528 Apache APISIX \u5904\u7406\u5173\u952e\u4e1a\u52a1\u6d41\u91cf\uff0c\u6db5\u76d6\u91d1\u878d\u3001\u4e92\u8054\u7f51\u3001\u5236\u9020\u3001\u96f6\u552e\u3001\u8fd0\u8425\u5546\u7b49\u7b49\uff0c\u6bd4\u5982\u7f8e\u56fd\u822a\u7a7a\u822a\u5929\u5c40\uff08NASA\uff09\u3001\u6b27\u76df\u7684\u6570\u5b57\u5de5\u5382\u3001\u4e2d\u56fd\u822a\u4fe1\u3001\u4e2d\u56fd\u79fb\u52a8\u3001\u817e\u8baf\u3001\u534e\u4e3a\u3001\u5fae\u535a\u3001\u7f51\u6613\u3001\u8d1d\u58f3\u627e\u623f\u3001360\u3001\u6cf0\u5eb7\u3001\u5948\u96ea\u7684\u8336\u7b49\u7b49\u3002\\n\\nGithub\uff1ahttps://github.com/apache/apisix\\n\\n\u5b98\u7f51\uff1ahttps://apisix.apache.org"},{"id":"2021/08/25/why-apache-apisix-chose-nginx-and-lua","metadata":{"permalink":"/zh/blog/2021/08/25/why-apache-apisix-chose-nginx-and-lua","source":"@site/blog/2021/08/25/Why-Apache-APISIX-chose-Nginx-and-Lua.md","title":"\u4e3a\u4ec0\u4e48 Apache APISIX \u9009\u62e9 NGINX+Lua \u6280\u672f\u6808\uff1f","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u9009\u7528 Nginx + Lua \u6280\u672f\u6808\u7684\u5386\u53f2\u80cc\u666f\u548c\u8be5\u6280\u672f\u6808\u4e3a APISIX \u5e26\u6765\u7684\u4f18\u52bf\uff0c\u4ee5\u53ca LuaJIT \u548c Go \u7684\u5bf9\u6bd4\u3002","date":"2021-08-25T00:00:00.000Z","formattedDate":"2021\u5e748\u670825\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":12.845,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"\u4f7f\u7528 APISIX openid-connect \u63d2\u4ef6\u8fdb\u884c\u96c6\u4e2d\u8eab\u4efd\u8ba4\u8bc1","permalink":"/zh/blog/2021/08/25/using-the-apache-apisix-openid-connect-plugin-for-centralized-authentication"},"nextItem":{"title":"Apache APISIX Meetup \u4e0a\u6d77\u7ad9\u5168\u7a0b\u56de\u987e","permalink":"/zh/blog/2021/08/24/shanghai-meetup-recap"}},"content":"> \u672c\u6587\u7531\u6df1\u5733[\u652f\u6d41\u79d1\u6280](https://api7.ai/)\u5de5\u7a0b\u5e08\u7f57\u6cfd\u8f69\u64b0\u5199\uff0c\u4ecb\u7ecd\u4e86 Apache APISIX \u9009\u7528 Nginx + Lua \u8fd9\u4e2a\u6280\u672f\u6808\u7684\u5386\u53f2\u80cc\u666f\u548c\u8fd9\u4e2a\u6280\u672f\u6808\u4e3a Apache APISIX \u5e26\u6765\u7684\u4f18\u52bf\u3002\u7f57\u6cfd\u8f69\u662f OpenResty \u5f00\u53d1\u8005\u4ee5\u53ca Apache APISIX PMC\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u7b14\u8005\u5728\u4eca\u5e74\u7684 COSCUP \u5927\u4f1a\u505a\u5206\u4eab\u65f6\uff0c\u66fe\u6709\u89c2\u4f17\u95ee\u8fd9\u6837\u7684\u95ee\u9898\uff0c\u4e3a\u4ec0\u4e48 Apache APISIX\u3001Kong \u548c 3scale \u8fd9\u4e9b\u7f51\u5173\u90fd\u91c7\u7528 Lua \u6765\u7f16\u5199\u903b\u8f91\uff1f\\n\\n\u662f\u554a\uff0cLua \u5e76\u4e0d\u662f\u4e00\u95e8\u5e7f\u4e3a\u4eba\u77e5\u7684\u8bed\u8a00\uff0c\u79bb\u201c\u4e3b\u6d41\u7f16\u7a0b\u8bed\u8a00\u201d\u7684\u5708\u5b50\u5927\u6982\u8fd8\u5dee\u4e2a\u5341\u4e07\u516b\u5343\u91cc\u5427\u3002\u751a\u81f3\u6709\u4e00\u6b21\uff0c\u6211\u5728\u8ddf\u522b\u4eba\u4ea4\u6d41\u7684\u65f6\u5019\uff0c\u5bf9\u65b9\u5728\u8bf4\u5230 Lua \u4e4b\u524d\uff0c\u5148\u505c\u987f\u4e86\u7247\u523b\uff0c\u968f\u540e\u7ec8\u4e8e\u6253\u5b9a\u4e3b\u610f\uff0c\u4ee5\\"L U A\\"\u9010\u4e2a\u5b57\u6bcd\u53d1\u97f3\u7684\u65b9\u5f0f\u8868\u8fbe\u4e86\u5bf9\u8fd9\u4e00\u7f55\u89c1\u4e4b\u7269\u7684\u79f0\u547c\u3002\\n\\n\u6240\u4ee5\uff0c\u4e3a\u4ec0\u4e48 Apache APISIX \u548c\u5176\u4ed6\u77e5\u540d\u7684\u7f51\u5173\u4f1a\u9009\u62e9\u7528 Lua \u5462\uff1f\\n\\n\u4e8b\u5b9e\u4e0a\uff0cApache APISIX \u91c7\u7528\u7684\u6280\u672f\u6808\u5e76\u4e0d\u662f\u7eaf\u7cb9\u7684 Lua\uff0c\u51c6\u786e\u6765\u8bf4\uff0c\u5e94\u8be5\u662f Nginx + Lua\u3002Apache APISIX \u4ee5\u5e95\u4e0b\u7684 Nginx \u4e3a\u6839\u57fa\uff0c\u4ee5\u4e0a\u5c42\u7684 Lua \u4ee3\u7801\u4e3a\u679d\u53f6\u3002\\n\\n## LuaJIT VS Go\\n\\n\u4e25\u8c28\u8ba4\u771f\u7684\u8bfb\u8005\u5fc5\u7136\u4f1a\u6307\u51fa\uff0cApache APISIX \u5e76\u975e\u57fa\u4e8e Nginx + Lua \u7684\u6280\u672f\u6808\uff0c\u800c\u662f Nginx + LuaJIT\uff08\u53c8\u79f0 OpenResty\uff0c\u4ee5\u4e0b\u4e3a\u4e86\u907f\u514d\u6df7\u4e71\uff0c\u4f1a\u4ec5\u4ec5\u91c7\u7528 Nginx + Lua \u8fd9\u6837\u7684\u79f0\u547c\uff09\u3002\\n\\nLuaJIT \u662f Lua \u7684\u4e00\u4e2a JIT \u5b9e\u73b0\uff0c\u6027\u80fd\u6bd4 Lua \u597d\u5f88\u591a\uff0c\u800c\u4e14\u989d\u5916\u6dfb\u52a0\u4e86 FFI \u7684\u529f\u80fd\uff0c\u80fd\u65b9\u4fbf\u9ad8\u6548\u5730\u8c03\u7528 C \u4ee3\u7801\u3002\\n\u7531\u4e8e\u73b0\u884c\u7684\u4e3b\u6d41 API \u7f51\u5173\uff0c\u5982\u679c\u4e0d\u662f\u57fa\u4e8e OpenResty \u5b9e\u73b0\uff0c\u5c31\u662f\u4f7f\u7528 Go \u7f16\u5199\uff0c\u6240\u4ee5\u65f6\u4e0d\u65f6\u4f1a\u770b\u5230\u5404\u79cd Go \u548c Lua \u8c01\u7684\u6027\u80fd\u66f4\u597d\u7684\u6bd4\u8f83\u3002\\n\\n**\u5c31\u6211\u4e2a\u4eba\u89c2\u70b9\u770b\uff0c\u8131\u79bb\u573a\u666f\u6bd4\u8f83\u8bed\u8a00\u7684\u6027\u80fd\uff0c\u662f\u6ca1\u6709\u610f\u4e49\u7684\u3002**\\n\\n\u9996\u5148\u660e\u786e\u4e00\u70b9\uff0cApache APISIX \u662f\u57fa\u4e8e Nginx + Lua \u7684\u6280\u672f\u6808\uff0c\u53ea\u662f\u5916\u5c42\u4ee3\u7801\u7528\u7684\u662f Lua\u3002\u6240\u4ee5\u5982\u679c\u8981\u8bba\u8bc1\u54ea\u79cd\u7f51\u5173\u6027\u80fd\u66f4\u597d\uff0c\u6b63\u786e\u7684\u6bd4\u8f83\u5bf9\u8c61\u662f C + LuaJIT \u8ddf Go \u7684\u6bd4\u8f83\u3002\u7f51\u5173\u7684\u6027\u80fd\u7684\u5927\u5934\uff0c\u5728\u4e8e\u4ee3\u7406 HTTP \u8bf7\u6c42\u548c\u54cd\u5e94\uff0c\u8fd9\u4e00\u5757\u7684\u5de5\u4f5c\u4e3b\u8981\u662f Nginx \u5728\u505a\u3002\\n\\n**\u6240\u4ee5\u5018\u82e5\u8981\u6bd4\u8bd5\u6bd4\u8bd5\u6027\u80fd\uff0c\u4e0d\u59a8\u6bd4\u8f83 Nginx \u548c Go \u6807\u51c6\u5e93\u7684 HTTP \u5b9e\u73b0\u3002**\\n\\n\u4f17\u6240\u5468\u77e5\uff0cNginx \u662f\u4e00\u4e2a bytes matter \u7684\u9ad8\u6027\u80fd\u670d\u52a1\u5668\u5b9e\u73b0\uff0c\u5bf9\u5185\u5b58\u4f7f\u7528\u975e\u5e38\u62a0\u95e8\u3002\u4e3e\u4e24\u4e2a\u4f8b\u5b50\uff1a\\n\\n1. Nginx \u91cc\u9762\u7684 request header \u5728\u5927\u591a\u6570\u65f6\u5019\u90fd\u53ea\u662f\u6307\u5411\u539f\u59cb\u7684 HTTP \u8bf7\u6c42\u6570\u636e\u7684\u4e00\u4e2a\u6307\u9488\uff0c\u53ea\u6709\u5728\u4fee\u6539\u7684\u65f6\u5019\u624d\u4f1a\u521b\u5efa\u526f\u672c\u3002\\n2. Nginx \u4ee3\u7406\u4e0a\u6e38\u54cd\u5e94\u65f6\u5bf9 buffer \u7684\u590d\u7528\u903b\u8f91\u975e\u5e38\u590d\u6742\uff0c\u662f\u6211\u8bfb\u8fc7\u7684\u6700\u4e3a\u70e7\u8111\u7684\u4ee3\u7801\u4e4b\u4e00\u3002\\n\\n\u51ed\u501f\u8fd9\u79cd\u62a0\u95e8\uff0cNginx \u5f97\u4ee5\u5c79\u7acb\u5728\u9ad8\u6027\u80fd\u670d\u52a1\u5668\u4e4b\u5dc5\u3002\\n\\n\u76f8\u53cd\u7684\uff0cGo \u6807\u51c6\u5e93\u7684 HTTP \u5b9e\u73b0\uff0c\u662f\u4e00\u4e2a\u6ee5\u7528\u5185\u5b58\u7684\u5178\u578b\u53cd\u4f8b\u3002\\n\\n\u8fd9\u53ef\u4e0d\u662f\u6211\u7684\u4e00\u9762\u4e4b\u8f9e\uff0cFasthttp\uff0c\u4e00\u4e2a\u91cd\u65b0\u5b9e\u73b0 Go \u6807\u51c6\u5e93\u91cc\u9762\u7684 HTTP \u5305\u7684\u9879\u76ee\uff0c\u5c31\u4e3e\u4e86\u4e24\u4e2a\u4f8b\u5b50\uff1a\\n\\n1. \u6807\u51c6\u5e93\u7684 HTTP Request \u7ed3\u6784\u4f53\u6ca1\u6cd5\u590d\u7528\\n2. headers \u603b\u662f\u88ab\u63d0\u524d\u89e3\u6790\u597d\uff0c\u5b58\u50a8\u6210 map[string][]string\uff0c\u5373\u4f7f\u6ca1\u6709\u7528\u5230\uff08\u539f\u6587\u89c1\uff1ahttps://github.com/valyala/fasthttp#faq \uff09\\n\\nFasthttp \u6587\u6863\u91cc\u9762\u8fd8\u63d0\u5230\u4e00\u4e9b bytes matter \u7684\u4f18\u5316\u6280\u5de7\uff0c\u5efa\u8bae\u5927\u5bb6\u53ef\u4ee5\u9605\u8bfb\u4e0b\u3002\\n\\n\u4e8b\u5b9e\u4e0a\uff0c\u5373\u4f7f\u4e0d\u53bb\u6bd4\u8f83\u4f5c\u4e3a\u7f51\u5173\u6838\u5fc3\u7684\u4ee3\u7406\u529f\u80fd\uff0c\u7528 LuaJIT \u5199\u7684\u4ee3\u7801\u4e0d\u4e00\u5b9a\u6bd4 Go \u5dee\u591a\u5c11\u3002\u539f\u56e0\u6709\u4e8c\u3002\\n\\n**\u5176\u4e00\uff0c\u62dc Lua \u8ddf C \u826f\u597d\u7684\u4eb2\u548c\u529b\u6240\u8d50\uff0c\u8bb8\u591a Lua \u7684\u5e93\u6838\u5fc3\u5176\u5b9e\u662f\u7528 C \u5199\u7684\u3002**\\n\\n\u6bd4\u5982 lua-cjson \u7684 json \u7f16\u89e3\u7801\uff0clua-resty-core \u7684 base64 \u7f16\u89e3\u7801\uff0c\u5b9e\u9645\u4e0a\u5927\u5934\u662f\u7528 C \u5b9e\u73b0\u7684\u3002\\n\u800c Go \u7684\u5e93\uff0c\u5f53\u7136\u662f\u5927\u90e8\u5206\u7528 Go \u5b9e\u73b0\u7684\u3002\u867d\u7136\u6709 CGO \u8fd9\u79cd\u4e1c\u897f\uff0c\u4f46\u662f\u53d7\u9650\u4e8e Go \u7684\u534f\u7a0b\u8c03\u5ea6\u548c\u5de5\u5177\u94fe\u7684\u9650\u5236\uff0c\u5b83\u5728 Go \u7684\u751f\u6001\u5708\u91cc\u9762\u53ea\u80fd\u5904\u4e8e\u4ece\u5c5e\u7684\u5730\u4f4d\u3002\\n\\n\u5173\u4e8e LuaJIT \u548c Go \u5bf9\u4e8e C \u7684\u4eb2\u548c\u529b\u7684\u6bd4\u8f83\uff0c\u63a8\u8350 Hacker News \u4e0a\u7684\u8fd9\u7bc7\u6587\u7ae0\uff1a\u300aComparing the C FFI overhead in various programming languages\u300b\uff08\u94fe\u63a5 https://news.ycombinator.com/item?id=17161168 \uff09\\n\\n\u4e8e\u662f\u6211\u4eec\u6bd4\u8f83 Lua \u7684\u67d0\u4e9b\u529f\u80fd\uff0c\u5176\u5b9e\u8fd8\u662f\u4f1a\u56de\u5230 C \u548c Go \u7684\u6bd4\u8f83\u4e2d\u3002\\n\\n**\u5176\u4e8c\uff0cLuaJIT \u7684 JIT \u4f18\u5316\u65e0\u51fa\u5176\u53f3\u3002**\\n\\n\u8ba8\u8bba\u52a8\u6001\u8bed\u8a00\u7684\u6027\u80fd\uff0c\u53ef\u4ee5\u628a\u52a8\u6001\u8bed\u8a00\u5206\u6210\u4e24\u7c7b\uff0c\u5e26 JIT \u548c\u4e0d\u5e26 JIT \u7684\u3002JIT \u4f18\u5316\u80fd\u591f\u628a\u52a8\u6001\u8bed\u8a00\u7684\u4ee3\u7801\u5728\u8fd0\u884c\u65f6\u7f16\u8bd1\u6210\u673a\u5668\u7801\uff0c\u8fdb\u800c\u628a\u539f\u6765\u7684\u4ee3\u7801\u7684\u6027\u80fd\u63d0\u5347\u4e00\u4e2a\u6570\u91cf\u7ea7\u3002\\n\\n\u5e26 JIT \u7684\u8bed\u8a00\u8fd8\u53ef\u4ee5\u5206\u6210\u4e24\u7c7b\uff0c\u80fd\u5145\u5206 JIT \u7684\u548c\u53ea\u652f\u6301\u90e8\u5206 JIT \u7684\u3002\u800c LuaJIT \u5c5e\u4e8e\u524d\u8005\u3002\\n\\n**\u4eba\u6240\u7686\u77e5\uff0cLua \u662f\u4e00\u95e8\u975e\u5e38\u7b80\u5355\u7684\u8bed\u8a00\u3002\u76f8\u5bf9\u9c9c\u4e3a\u4eba\u77e5\u7684\u662f\uff0cLuaJIT \u7684\u4f5c\u8005 Mike Pall \u662f\u4e00\u4e2a\u975e\u5e38\u5389\u5bb3\u7684\u7a0b\u5e8f\u5458\u3002\u8fd9\u4e24\u8005\u7684\u7ed3\u5408\uff0c\u8bde\u751f\u4e86 LuaJIT \u8fd9\u79cd\u80fd\u8ddf V8 \u6bd4\u80a9\u7684\u4f5c\u54c1\u3002**\\n\\n\u5173\u4e8e LuaJIT \u548c V8 \u5230\u5e95\u8c01\u66f4\u5feb\uff0c\u4e00\u76f4\u662f\u957f\u76db\u4e0d\u8870\u7684\u4e89\u8bba\u8bdd\u9898\u3002\u5c55\u5f00\u8bb2 LuaJIT \u7684 JIT \u5df2\u7ecf\u8d85\u8fc7\u4e86\u672c\u6587\u60f3\u8981\u8ba8\u8bba\u7684\u8303\u7574\u3002\u7b80\u5355\u6765\u8bf4\uff0cJIT \u52a0\u6301\u7684 LuaJIT \u8ddf\u9884\u5148\u7f16\u8bd1\u597d\u7684 Go \u6027\u80fd\u5dee\u522b\u5e76\u4e0d\u5927\u3002\\n\\n\u81f3\u4e8e\u8c01\u6bd4\u8c01\u6162\uff0c\u6162\u591a\u5c11\uff0c\u90a3\u5c31\u662f\u4e2a\u89c1\u4ec1\u89c1\u667a\u7684\u95ee\u9898\u4e86\u3002\u8fd9\u91cc\u6211\u4e3e\u4e2a\u4f8b\u5b50\uff1a\\n\\n```Lua\\nlocal text = {\\"The\\", \\"quick\\", \\"brown\\", \\"fox\\", \\"jumped\\", \\"over\\", \\"the\\", \\"lazy\\", \\"dog\\", \\"at\\", \\"a\\", \\"restaurant\\", \\"near\\", \\"the\\", \\"lake\\", \\"of\\", \\"a\\", \\"new\\", \\"era\\"}\\nlocal map = {}\\nlocal times = 1e8\\nlocal n = #text\\nfor i = 1, n do\\n    map[text[i]] = 0\\n    for _ = 1, times do\\n        map[text[i]] = map[text[i]] + 1\\n    end\\nend\\n\\nfor i = 1, n do\\n    io.write(text[i], \\" \\", map[text[i]], \\"\\\\n\\")\\nend\\n```\\n\\n```Go\\npackage main\\nimport \\"fmt\\"\\nfunc main() {\\n    text := []string{\\"The\\", \\"quick\\", \\"brown\\", \\"fox\\", \\"jumped\\", \\"over\\", \\"the\\", \\"lazy\\", \\"dog\\", \\"at\\", \\"a\\", \\"restaurant\\", \\"near\\", \\"the\\", \\"lake\\", \\"of\\", \\"a\\", \\"new\\", \\"era\\"}\\n    m := map[string]int{}\\n    times := int(1e8)\\n    for _, t := range text {\\n        m[t] = 0\\n        for i := 0; i < times; i++ {\\n            m[t]++\\n        }\\n    }\\n    for _, t := range text {\\n        fmt.Println(t, \\" \\", m[t])\\n    }\\n}\\n```\\n\\n\u4e0a\u9762\u4e24\u6bb5\u4ee3\u7801\u662f\u7b49\u4ef7\u7684\u3002\u4f60\u731c\u662f\u7b2c\u4e00\u4e2a Lua \u7248\u672c\u7684\u5feb\uff0c\u8fd8\u662f\u7b2c\u4e8c\u4e2a Go \u7248\u672c\u7684\u5feb\uff1f\\n\\n\u5728\u6211\u7684\u673a\u5668\u4e0a\uff0c\u7b2c\u4e00\u4e2a\u7528\u65f6\u4e0d\u5230 1 \u79d2\uff0c\u7b2c\u4e8c\u4e2a\u82b1\u4e86 23 \u79d2\u591a\u3002\\n\\n\u4e3e\u8fd9\u4e2a\u4f8b\u5b50\u5e76\u4e0d\u662f\u60f3\u8bc1\u660e LuaJIT \u6bd4 Go \u5feb 20 \u500d\u3002\u6211\u53ea\u60f3\u8bf4\u660e\u7528 micro benchmark \u8bc1\u660e\u67d0\u4e2a\u8bed\u8a00\u6bd4\u53e6\u4e00\u4e2a\u8bed\u8a00\u5feb\u7684\u610f\u4e49\u4e0d\u5927\uff0c\u56e0\u4e3a\u5f71\u54cd\u6027\u80fd\u7684\u56e0\u7d20\u5f88\u591a\u3002\u4e00\u4e2a\u7b80\u5355\u7684 micro benchmark \u5f88\u6709\u53ef\u80fd\u8fc7\u5206\u5f3a\u8c03\u67d0\u4e00\u4e2a\u56e0\u7d20\uff0c\u5bfc\u81f4\u51fa\u4e4e\u610f\u6599\u7684\u7ed3\u679c\u3002\\n\\n## Nginx + Lua \uff1a\u9ad8\u6027\u80fd + \u7075\u6d3b\\n\\n\u8ba9\u6211\u4eec\u8f6c\u56de Apache APISIX \u7684 Nginx + Lua \u7684\u6280\u672f\u6808\u3002Nginx + Lua \u7684\u6280\u672f\u6808\u7ed9\u6211\u4eec\u5e26\u6765\u7684\uff0c\u4e0d\u4ec5\u4ec5\u662f\u9ad8\u6027\u80fd\u3002\\n\\n\u7ecf\u5e38\u6709\u4eba\u95ee\u6211\u4eec\uff0c\u65e2\u7136\u4f60\u4eec\u662f\u57fa\u4e8e Nginx \u5f00\u6e90\u7248\u672c\uff0c\u800c Nginx \u5e76\u4e0d\u652f\u6301\u52a8\u6001\u914d\u7f6e\uff0c\u4e3a\u4ec0\u4e48 Apache APISIX \u58f0\u79f0\u81ea\u5df1\u53ef\u4ee5\u5b9e\u73b0\u52a8\u6001\u914d\u7f6e\uff1f\u4f60\u4eec\u662f\u4e0d\u662f\u6539\u4e86\u70b9\u4e1c\u897f\uff1f\\n\\n\u662f\u7684\uff0c\u6211\u4eec\u786e\u5b9e\u6709\u5728\u7ef4\u62a4\u81ea\u5df1\u7684 Nginx \u53d1\u884c\u7248\uff0c\u4e0d\u8fc7 Apache APISIX \u7684\u5927\u90e8\u5206\u529f\u80fd\u5728\u5b98\u65b9\u7684 Nginx \u4e0a\u5c31\u80fd\u4f7f\u7528\u3002\u6211\u4eec\u4e4b\u6240\u4ee5\u80fd\u505a\u5230\u52a8\u6001\u914d\u7f6e\uff0c\u5168\u9760\u628a\u914d\u7f6e\u653e\u5230 Lua \u4ee3\u7801\u91cc\u9762\u6765\u5b9e\u73b0\u3002\\n\\n\u4e3e\u8def\u7531\u7cfb\u7edf\u4f5c\u4e3a\u4e00\u4e2a\u4f8b\u5b50\uff0cNginx \u7684\u8def\u7531\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u8fdb\u884c\u914d\u7f6e\uff0c\u6bcf\u6b21\u66f4\u6539\u8def\u7531\uff0c\u90fd\u9700\u8981 reload \u4e4b\u540e\u624d\u80fd\u751f\u6548\u3002\u8fd9\u662f\u56e0\u4e3a Nginx \u7684\u8def\u7531\u5206\u53d1\u53ea\u652f\u6301\u9759\u6001\u914d\u7f6e\uff0c\u4e0d\u80fd\u52a8\u6001\u589e\u51cf\u8def\u7531\u3002\\n\\n**\u4e3a\u4e86\u5b9e\u73b0\u8def\u7531\u52a8\u6001\u914d\u7f6e\uff0cApache APISIX \u505a\u4e86\u4e24\u4ef6\u4e8b\uff1a**\\n\\n1. \u5728 Nginx \u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u914d\u7f6e\u5355\u4e2a server\uff0c\u8fd9\u4e2a server \u91cc\u9762\u53ea\u6709\u4e00\u4e2a location\u3002\u6211\u4eec\u628a\u8fd9\u4e2a location \u4f5c\u4e3a\u4e3b\u5165\u53e3\uff0c\u8fd9\u6837\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u4f1a\u8d70\u5230\u8fd9\u4e2a\u5730\u65b9\u4e0a\u6765\u3002\\n2. \u6211\u4eec\u7528 Lua \u5b8c\u6210\u8def\u7531\u5206\u53d1\u7684\u5de5\u4f5c\u3002Apache APISIX \u7684\u8def\u7531\u5206\u53d1\u6a21\u5757\uff0c\u652f\u6301\u5728\u8fd0\u884c\u65f6\u589e\u51cf\u8def\u7531\uff0c\u8fd9\u6837\u5c31\u80fd\u52a8\u6001\u914d\u7f6e\u8def\u7531\u4e86\u3002\\n\\n\u4f60\u53ef\u80fd\u4f1a\u95ee\uff0c\u5728 Lua \u91cc\u9762\u505a\u8def\u7531\u5206\u53d1\uff0c\u4f1a\u6bd4 Nginx \u7684\u5b9e\u73b0\u6162\u5417\uff1f\\n\\n\u5c31\u50cf\u524d\u9762\u63d0\u5230\u8fc7\u7684\u4e00\u6837\uff0c\u51e1\u662f\u5bf9\u6027\u80fd\u8981\u6c42\u6bd4\u8f83\u9ad8\u7684\uff0c\u6211\u4eec\u4f1a\u628a\u6838\u5fc3\u4ee3\u7801\u7528 C \u6539\u5199\u3002\u6211\u4eec\u7684\u8def\u7531\u5206\u53d1\u6a21\u5757\u5c31\u662f\u8fd9\u4e48\u5e72\u7684\u3002\u8def\u7531\u5206\u53d1\u6a21\u5757\u5728\u5339\u914d\u8def\u7531\u65f6\uff0c\u4f1a\u91c7\u7528\u4e00\u4e2a\u524d\u7f00\u6811\u6765\u5339\u914d\u3002\u800c\u8fd9\u4e2a\u524d\u7f00\u6811\u662f\u7528 C \u5b9e\u73b0\u7684\u3002\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u770b\u4e0b\u4ee3\u7801\uff1ahttps://github.com/api7/lua-resty-radixtree/ \u3002\\n\\n\u5b8c\u6210\u4e86 C \u5c42\u9762\u4e0a\u7684\u524d\u7f00\u6811\u5339\u914d\uff0c\u63a5\u4e0b\u6765\u5c31\u8be5 Lua \u53d1\u6325\u7075\u6d3b\u6027\u7684\u65f6\u523b\u4e86\u3002\u5bf9\u4e8e\u5339\u914d\u540c\u4e00\u524d\u7f00\u7684\u5404\u4e2a\u8def\u7531\uff0c\u6211\u4eec\u652f\u6301\u901a\u8fc7\u8bb8\u591a\u522b\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u4e0b\u4e00\u7ea7\u7684\u5339\u914d\uff0c\u5176\u4e2d\u5c31\u5305\u542b\u901a\u8fc7\u4e00\u4e2a\u7279\u5b9a\u7684\u8868\u8fbe\u5f0f\u6765\u5339\u914d\u3002\u5c3d\u7ba1\u786c\u7740\u5934\u76ae\uff0c\u4e5f\u80fd\u5728 C \u5c42\u9762\u4e0a\u63a5\u5165\u4e00\u4e2a\u8868\u8fbe\u5f0f\u5f15\u64ce\uff0c\u4f46\u662f\u7eaf C \u5b9e\u73b0\u505a\u4e0d\u4e86\u975e\u5e38\u7075\u6d3b\u5730\u81ea\u5b9a\u4e49\u8868\u8fbe\u5f0f\u91cc\u9762\u7684\u53d8\u91cf\u3002\\n\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u662f Apache APISIX \u7528\u6765\u5339\u914d GraphQL \u8bf7\u6c42\u7684 route \u914d\u7f6e\uff1a\\n\\n```json\\n{\\n        \\"methods\\": [\\"POST\\"],\\n        \\"upstream\\": {\\n            \\"nodes\\": {\\n                \\"127.0.0.1:1980\\": 1\\n            },\\n            \\"type\\": \\"roundrobin\\"\\n        },\\n        \\"uri\\": \\"/hello\\",\\n        \\"vars\\": [[\\"graphql_name\\", \\"==\\", \\"repo\\"]]\\n}\\n```\\n\\n\u5b83\u4f1a\u5339\u914d\u8fd9\u6837\u7684 GraphQL \u8bf7\u6c42\uff1a\\n\\n```Nginx\\nquery repo {\\n    owner {\\n        name\\n    }\\n}\\n```\\n\\n\u8fd9\u91cc\u7684 graphql_name \u5e76\u975e Nginx \u5185\u7f6e\u53d8\u91cf\uff0c\u800c\u662f\u901a\u8fc7 Lua \u4ee3\u7801\u5b9a\u4e49\u7684\u3002Apache APISIX \u4e00\u5171\u5b9a\u4e49\u4e86\u4e09\u4e2a GraphQL \u76f8\u5173\u7684\u53d8\u91cf\uff0c\u8fde\u540c\u89e3\u6790 GraphQL body \u5728\u5185\u4e0d\u8fc7 62 \u884c Lua \u4ee3\u7801\u3002\u5982\u679c\u8981\u901a\u8fc7 Nginx C \u6a21\u5757\u6765\u5b9a\u4e49\u53d8\u91cf\uff0c62 \u884c\u53ef\u80fd\u53ea\u4e0d\u8fc7\u662f\u628a\u76f8\u5173\u65b9\u6cd5\u7684\u6837\u677f\u4ee3\u7801\u642d\u5efa\u8d77\u6765\uff0c\u90fd\u8fd8\u6ca1\u6709\u5230\u771f\u6b63\u7684\u89e3\u6790 GraphQL \u7684\u903b\u8f91\u5462\u3002\\n\\n**\u91c7\u7528 Lua \u4ee3\u7801\u6765\u505a\u8def\u7531\u8fd8\u6709\u4e00\u4e2a\u597d\u5904\uff1a\u5b83\u51cf\u4f4e\u4e86\u4e8c\u6b21\u5f00\u53d1\u7684\u95e8\u69db\u3002**\\n\\n\u5982\u679c\u5728\u8def\u7531\u8fc7\u7a0b\u4e2d\u9700\u8981\u6709\u7279\u6b8a\u7684\u903b\u8f91\uff0c\u7528\u6237\u53ef\u4ee5\u5b9e\u73b0\u6210\u81ea\u5b9a\u4e49\u7684\u53d8\u91cf\u548c\u8fd0\u7b97\u7b26\uff0c\u6bd4\u5982\u901a\u8fc7 IP \u5e93\u5339\u914d\u5230\u7684\u5730\u7406\u4f4d\u7f6e\u6765\u51b3\u5b9a\u91c7\u7528\u54ea\u6761\u8def\u7531\u3002\u7528\u6237\u53ea\u9700\u8981\u5199\u4e00\u4e9b Lua \u4ee3\u7801\uff0c\u8fd9\u8981\u6bd4\u4fee\u6539 Nginx C module \u7684\u96be\u5ea6\u5c0f\u591a\u4e86\u3002\\n\\n\u5728 Apache APISIX \u91cc\u9762\uff0c\u4e0d\u4ec5\u4ec5\u8def\u7531\u662f\u52a8\u6001\u7684\uff0c\u6211\u4eec\u7684 TLS \u670d\u52a1\u7aef\u8bc1\u4e66\u548c\u4e0a\u6e38\u8282\u70b9\u914d\u7f6e\u90fd\u662f\u52a8\u6001\u7684\uff0c\u800c\u4e14\u65e0\u9700\u4fee\u6539 Nginx \u2014\u2014 \u4e0a\u8ff0\u529f\u80fd\u53ef\u4ee5\u8dd1\u5728\u5b98\u65b9\u7684 Nginx + Lua \u6280\u672f\u6808\u4e0a\u3002\u5f53\u7136\u901a\u8fc7\u4fee\u6539 Nginx\uff0c\u6211\u4eec\u8fd8\u5b9e\u73b0\u4e86\u66f4\u591a\u7684\u9ad8\u7ea7\u529f\u80fd\uff0c\u6bd4\u5982\u52a8\u6001\u7684 gzip \u914d\u7f6e\u548c\u52a8\u6001\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u5927\u5c0f\u9650\u5236\u3002\u540e\u7eed\u6211\u4eec\u5c06\u63a8\u884c\u81ea\u5df1\u7684 Nginx \u53d1\u884c\u7248\uff0c\u8fd9\u6837\u5f00\u6e90\u7528\u6237\u4e5f\u80fd\u8f7b\u677e\u7528\u4e0a\u8fd9\u4e9b\u9ad8\u7ea7\u529f\u80fd\u3002"},{"id":"Apache APISIX Meetup \u4e0a\u6d77\u7ad9\u5168\u7a0b\u56de\u987e","metadata":{"permalink":"/zh/blog/2021/08/24/shanghai-meetup-recap","source":"@site/blog/2021/08/24/shanghai-meetup-recap.md","title":"Apache APISIX Meetup \u4e0a\u6d77\u7ad9\u5168\u7a0b\u56de\u987e","description":"\u672c\u6b21 Apache APISIX meetup \u4e0a\u6d77\u5206\u4eab\u4e86\u5173\u4e8e\u7231\u5947\u827a API \u7f51\u5173\u7684\u843d\u5730\u5b9e\u8df5\uff0c\u4f7f\u7528 Apache APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u4ee5\u53ca\u6570\u636e\u4e3b\u6743\u4e0e APISIX \u7f51\u5173\u843d\u5730\u5b9e\u8df5\u7b49\u76f8\u5173\u8bdd\u9898\u3002","date":"2021-08-24T00:00:00.000Z","formattedDate":"2021\u5e748\u670824\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.455,"truncated":true,"authors":[{"name":"Apache APISIX \u793e\u533a"}],"prevItem":{"title":"\u4e3a\u4ec0\u4e48 Apache APISIX \u9009\u62e9 NGINX+Lua \u6280\u672f\u6808\uff1f","permalink":"/zh/blog/2021/08/25/why-apache-apisix-chose-nginx-and-lua"},"nextItem":{"title":"ApacheCon Asia 2021","permalink":"/zh/blog/2021/08/23/apachecon-asia-2021"}},"content":"> \u6d3b\u52a8\u56de\u987e\uff1aApache APISIX Meetup \u4e0a\u6d77\u7ad9\u8bae\u9898\u5206\u4eab\u53ca\u89c6\u9891\u56de\u987e\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX Meetup \u4e0a\u6d77\u7ad9\u5df2\u4e8e\u4e0a\u5468\u516d\uff088 \u6708 21 \u65e5\uff09\u987a\u5229\u4e3e\u529e\ud83c\udf89\ud83c\udf89\ud83c\udf89\\n\\n\u672c\u6b21 Meetup \u7531 [API7.AI](https://www.apiseven.com/zh) \u53d1\u8d77\uff0c\u9080\u8bf7\u4e86\u7231\u5947\u827a\u3001AirWallex \u7a7a\u4e2d\u4e91\u6c47\u7b49\u5408\u4f5c\u4f19\u4f34\uff0c\u4e0e Apache APISIX \u6280\u672f\u5927\u5496\u3001Apache APISIX PMC \u6210\u5458\u3001\u793e\u533a\u6280\u672f\u4e13\u5bb6\u6c47\u805a\u4e00\u5802\uff0c\u5171\u540c\u63a2\u8ba8\u4e86\u5173\u4e8e Apache APISIX \u793e\u533a\u53d1\u5c55\u3001\u884c\u4e1a\u5b9e\u8df5\u7b49\u8bdd\u9898\u3002\\n\\n\u4e00\u8d77\u6765\u56de\u987e\u4e0b\u5927\u4f1a\u4e2d\u4ee4\u4eba\u96be\u5fd8\u7684\u7cbe\u5f69\u6f14\u8bb2\u5427\uff01\\n\\n## \u57fa\u4e8e Apache APISIX\uff0c\u7231\u5947\u827a API \u7f51\u5173\u7684\u843d\u5730\u5b9e\u8df5\\n\\n**\u8bb2\u5e08**\uff1a\u4f55\u806a\\n\\n**\u4e2a\u4eba\u4ecb\u7ecd**\uff1a\u9ad8\u7ea7\u7814\u53d1\u5de5\u7a0b\u5e08\uff0cIIG \u57fa\u7840\u67b6\u6784\u90e8-\u8ba1\u7b97\u4e91\uff0c\u4e3b\u8981\u8d1f\u8d23\u7231\u5947\u827a\u7f51\u5173\u5f00\u53d1\u548c\u8fd0\u7ef4\u5de5\u4f5c\u3002\\n\\n**\u8bae\u9898\u8be6\u60c5**\uff1aAPI \u7f51\u5173\u5df2\u7ecf\u6210\u4e3a\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u4e00\u73af\u3002\u5b83\u65e2\u627f\u62c5\u7740\u670d\u52a1\u5bf9\u5916\u7684\u552f\u4e00\u95e8\u6237\uff0c\u53c8\u9700\u8981\u6ee1\u8db3\u8bb8\u591a\u5e94\u7528\u7684\u5171\u6027\u529f\u80fd\u3002\u7231\u5947\u827a\u4f5c\u4e3a\u4e00\u5bb6\u5728\u7ebf\u89c6\u9891\u516c\u53f8\uff0c\u6bcf\u5929\u9700\u8981\u627f\u8f7d\u5343\u4e07\u7ea7\u7684\u8c03\u7528\u91cf\uff0c\u5e76\u4e14\u5bf9\u6570\u636e\u7684\u5b89\u5168\u3001\u7528\u6237\u8bf7\u6c42\u54cd\u5e94\u65f6\u6548\u3001\u7cfb\u7edf\u7684\u7a33\u5b9a\u90fd\u6709\u7740\u6781\u5176\u4e25\u683c\u7684\u8981\u6c42\uff0c\u56e0\u6b64\u516c\u53f8\u9700\u8981\u6253\u9020\u4e00\u4e2a\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u7528\u7684 API \u7f51\u5173\u3002\u672c\u6b21\u5206\u4eab\u7b80\u5355\u4ecb\u7ecd\u7231\u5947\u827a API \u7f51\u5173\u7684\u67b6\u6784\u4ee5\u53ca\u5b9e\u73b0\u7684\u529f\u80fd\uff0c\u5305\u62ec\u8bf7\u6c42\u5206\u53d1\u3001\u6761\u4ef6\u8def\u7531\u3001Api \u7ba1\u7406\u3001\u9650\u6d41\u7194\u65ad\u3001\u5b89\u5168\u4e09\u9632\u3001\u76d1\u63a7\u62a5\u8b66\u4ee5\u53ca\u5168\u94fe\u8def\u8ffd\u8e2a\u7b49\u3002\\n\\n**\u89c6\u9891\u56de\u987e**\uff1a[\u7231\u5947\u827a\u57fa\u4e8e Apache APISIX \u7684 API \u7f51\u5173\u843d\u5730\u5b9e\u8df5](https://www.bilibili.com/video/BV1Qq4y1M7bK)\\n\\n## \u5982\u4f55\u4f7f\u7528 Apache APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\\n\\n**\u8bb2\u5e08**\uff1a\u6731\u6b23\u6b23\\n\\n**\u4e2a\u4eba\u4ecb\u7ecd**\uff1aAPI7 \u5de5\u7a0b\u5e08\uff0cApache APISIX Committer\\n\\n**\u8bae\u9898\u8be6\u60c5**\uff1a\u8eab\u4efd\u8ba4\u8bc1\u662f\u96f6\u4fe1\u4efb\u67b6\u6784\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u73af\u3002\u901a\u8fc7\u8eab\u4efd\u8ba4\u8bc1\u53ef\u4ee5\u6709\u6548\u4fdd\u62a4\u670d\u52a1\uff0c\u907f\u514d\u672a\u7ecf\u6388\u6743\u7684\u6076\u610f\u8bbf\u95ee\uff0c\u6570\u636e\u6cc4\u6f0f\u4ee5\u53ca\u9ed1\u5ba2\u653b\u51fb\u3002APISIX \u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u652f\u6301\u4e30\u5bcc\u7684\u8eab\u4efd\u8ba4\u8bc1\u63d2\u4ef6\uff0c\u672c\u6b21\u5206\u4eab\u5c06\u4ecb\u7ecd\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7684\u4f18\u70b9\u548c\u5982\u4f55\u5728 APISIX \u4e0a\u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u3002\\n\\n**\u89c6\u9891\u56de\u987e**\uff1a[\u4f7f\u7528 API \u7f51\u5173 APISIX \u6765\u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1](https://www.bilibili.com/video/BV1WA411c7pa)\\n\\n## \u6570\u636e\u4e3b\u6743\u4e0e Apache APISIX \u7f51\u5173\u843d\u5730\u5b9e\u8df5\\n\\n**\u8bb2\u5e08**\uff1a\u674e\u6768\\n\\n**\u4e2a\u4eba\u4ecb\u7ecd**\uff1aAirWallex \u7a7a\u4e2d\u4e91\u6c47\u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\\n\\n**\u8bae\u9898\u8be6\u60c5**\uff1a\u6570\u636e\u65e0\u5904\u4e0d\u5728\uff0c\u6bcf\u65f6\u6bcf\u523b\u90fd\u6709\u6d77\u91cf\u6570\u636e\u5728\u4e16\u754c\u5404\u5730\u88ab\u5904\u7406\u3001\u4f20\u8f93\u3001\u5b58\u50a8\u3002\u7136\u800c\u6570\u636e\u4e16\u754c\u4e0d\u662f\u6cd5\u5916\u4e4b\u5730\uff0c\u6570\u636e\u7684\u6536\u96c6\u4e0e\u5904\u7406\u5fc5\u987b\u9075\u7167\u5404\u56fd\u6cd5\u5f8b\u6267\u884c\u3002\u8fd9\u4e3a\u4f01\u4e1a\u7684\u6280\u672f\u67b6\u6784\u63d0\u51fa\u4e86\u5de8\u5927\u7684\u6311\u6218\uff0c\u5982\u4f55\u517c\u987e\u7528\u6237\u4f53\u9a8c\u3001\u6574\u6d01\u67b6\u6784\u4e0e\u6570\u636e\u4e3b\u6743\uff1fAPI \u7f51\u5173\u5728\u4f01\u4e1a\u67b6\u6784\u4e2d\u5177\u6709\u7279\u6b8a\u5730\u4f4d\uff0c\u4e5f\u56e0\u6b64\u80fd\u5728\u6570\u636e\u4e3b\u6743\u573a\u666f\u4e0b\u8d77\u5230\u7279\u6b8a\u91cd\u8981\u7684\u4f5c\u7528\u3002\\n\\n**\u89c6\u9891\u56de\u987e**\uff1a[Apache APISIX \u4e0e\u6570\u636e\u4e3b\u6743\u7684\u843d\u5730\u5b9e\u8df5](https://www.bilibili.com/video/BV1GL4y1Y7sR)\\n\\n## \u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\uff0cApache APISIX \u611f\u6069\u6709\u4f60\\n\\n**\u8bb2\u5e08**\uff1a\u738b\u9662\u751f\\n\\n**\u4e2a\u4eba\u4ecb\u7ecd**\uff1aAPI7.AI \u8054\u5408\u521b\u59cb\u4eba & CTO\\n\\n**\u8bae\u9898\u8be6\u60c5**\uff1aApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u77ed\u77ed\u4e24\u5e74\u65f6\u95f4\u4ea7\u54c1\u591a\u9879\u6280\u672f\u6307\u6807\u5305\u63fd\u7b2c\u4e00\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3 API \u7f51\u5173\u9879\u76ee\uff0c\u5e76\u786e\u5b9a\u4e86\u4e13\u5c5e\u4e8e Apache APISIX \u7684\u9053\u8def\uff1a\u7edf\u4e00 7 \u5c42\u6d41\u91cf\u5904\u7406\u3002\u4e00\u4e2a\u4eba\u53ef\u80fd\u8d70\u7684\u5f88\u5feb\uff0c\u4e00\u7fa4\u4eba\u624d\u80fd\u8d70\u7684\u66f4\u8fdc\uff0cApache APISIX \u6210\u957f\u4e4b\u8def\u611f\u6069\u6709\u4f60\u3002\\n\\n**\u89c6\u9891\u56de\u987e**\uff1a[\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\uff0cApache APISIX \u611f\u6069\u6709\u4f60](https://www.bilibili.com/video/BV1Hh411q7eB)"},{"id":"2021/08/23/apachecon-asia-2021","metadata":{"permalink":"/zh/blog/2021/08/23/apachecon-asia-2021","source":"@site/blog/2021/08/23/ApacheCon-Asia-2021.md","title":"ApacheCon Asia 2021","description":"ApacheCon Asia 2021 \u4e8e 2021 \u5e74 8 \u6708 6-8 \u65e5\u5728\u7ebf\u4e3e\u529e\u3002Apache APISIX \u793e\u533a\u63d0\u4ea4\u4e86\u9650\u901f\uff0c\u8ba4\u8bc1\u9274\u6743\uff0c\u670d\u52a1\u7f51\u683c\u3001APISIX Ingress Controller \u548c\u5f00\u6e90\u5546\u4e1a\u5316\u7b49\u76f8\u5173\u8bae\u9898\u3002","date":"2021-08-23T00:00:00.000Z","formattedDate":"2021\u5e748\u670823\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":8.305,"truncated":true,"authors":[],"prevItem":{"title":"Apache APISIX Meetup \u4e0a\u6d77\u7ad9\u5168\u7a0b\u56de\u987e","permalink":"/zh/blog/2021/08/24/shanghai-meetup-recap"},"nextItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff088.16-8.22\uff09","permalink":"/zh/blog/2021/08/23/weekly-report"}},"content":"> ApacheCon \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u5b98\u65b9\u5168\u7403\u7cfb\u5217\u4f1a\u8bae\u3002\u81ea 1998 \u5e74\u4ee5\u6765\uff0cApacheCon \u4e00\u76f4\u5438\u5f15\u7740\u5404\u4e2a\u5c42\u6b21\u7684\u53c2\u4e0e\u8005\uff0c\u5728 350 \u591a\u4e2a Apache \u9879\u76ee\u53ca\u5176\u4e0d\u540c\u7684\u793e\u533a\u4e2d\u63a2\u7d22 \u201c\u660e\u65e5\u7684\u6280\u672f\u201d\u3002ApacheCon Asia \u662f ApacheCon \u7ec4\u59d4\u4f1a\u9488\u5bf9\u4e9a\u592a\u5730\u533a\u4e3e\u529e\u7684 ApacheCon \u5728\u7ebf\u4f1a\u8bae\uff0c\u4e3b\u8981\u76ee\u6807\u5728\u4e8e\u66f4\u597d\u5730\u670d\u52a1\u4e9a\u592a\u5730\u533a\u5feb\u901f\u589e\u957f\u7684 Apache \u7528\u6237\u548c\u8d21\u732e\u8005\u3002ApacheCon Asia 2021 \u4e8e 2021 \u5e74 8 \u6708 6-8 \u65e5\u5728\u7ebf\u4e3e\u529e\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX \u793e\u533a\u79ef\u6781\u53c2\u4e0e\u672c\u6b21\u5e74\u5ea6\u5f00\u6e90\u76db\u4f1a\uff0c\u5171\u63d0\u62a5\u4e86 8 \u4e2a API/\u5fae\u670d\u52a1\u6280\u672f\u76f8\u5173\u7684\u8bae\u9898\uff0c\u5185\u5bb9\u4e30\u5bcc\u3002\\n\\n## \u4f7f\u7528 Apache APISIX \u5b9e\u73b0\u9650\u6d41\u9650\u901f\\n\\n\u5206\u4eab\u8005\uff1a\u9648\u519b\u65ed\\n\\n\u8c08\u5230\u9650\u6d41\u9650\u901f\uff0c\u4eba\u4eec\u5f80\u5f80\u6700\u5148\u60f3\u5230\u7684\u662f Nginx \u3002\u7136\u800c Nginx \u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u5f0f\u5b9e\u73b0\uff0c\u6bcf\u6b21\u53d8\u66f4\u90fd\u9700\u8981 reload \uff0c\u8fd9\u8ba9\u8fd0\u7ef4\u5de5\u4f5c\u6781\u5176\u7e41\u6742\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u9650\u901f\u7684\u6761\u4ef6\u88ab\u9650\u5236\u5728 Nginx \u7684\u53d8\u91cf\u8303\u56f4\u5185\uff0c\u4f7f\u5f97 Nginx \u96be\u4ee5\u5b9e\u73b0\u4e1a\u52a1\u4e0a\u7cbe\u7ec6\u5316\u7684\u9650\u6d41\u9650\u901f\u9700\u6c42\u3002\u672c\u6b21\u5206\u4eab\u5c06\u5e26\u6765\u5982\u4f55\u4f7f\u7528 Apache APISIX \u6765\u5b9e\u73b0\u52a8\u6001\u3001\u7cbe\u7ec6\u5316\u3001\u5206\u5e03\u5f0f\u7684\u9650\u6d41\u9650\u901f\uff0c\u4ee5\u53ca\u5982\u4f55\u901a\u8fc7\u63d2\u4ef6\u7f16\u6392\u6765\u5b9e\u73b0\u66f4\u7b26\u5408\u4e1a\u52a1\u9700\u6c42\u7684\u9650\u6d41\u9650\u901f\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Speed-Limiting-With-Apache-APISIX)\\n\\n## \u7528 Chaos Mesh \u6d4b\u8bd5 Apache APISIX \u7684\u6062\u590d\u80fd\u529b\\n\\n\u5206\u4eab\u8005\uff1a\u5434\u8212\u65f8\\n\\nApache APISIX \u662f\u9886\u5148\u7684 API \u7f51\u5173 OSS \u4e4b\u4e00\u3002\u4e3a\u4e86\u786e\u4fdd\u4e00\u5207\u6309\u8ba1\u5212\u8fdb\u884c\uff0cAPISIX \u4f7f\u7528\u4e86\u4e0d\u540c\u79cd\u7c7b\u7684\u6d4b\u8bd5\uff0c\u5305\u62ec\u5355\u5143\u3001e2e \u548c\u6a21\u7cca\u6d4b\u8bd5\u3002\u7136\u800c\uff0c\u6211\u4eec\u4ecd\u7136\u4e0d\u786e\u5b9a\uff0c\u5f53\u4e00\u4e9b\u4e0d\u6b63\u5e38\u4f46\u4e0d\u53ef\u907f\u514d\u7684\u60c5\u51b5\u53d1\u751f\u65f6\uff0c\u4f8b\u5982\u7f51\u7edc\u6545\u969c\u3001IO \u538b\u529b\u6216 Pods \u6545\u969c\uff0cAPISIX \u4f1a\u5982\u4f55\u8868\u73b0\u3002\u56e0\u6b64\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 Chaos Mesh\uff0c\u4e00\u4e2a\u57fa\u4e8e Kubernetes \u7684\u6df7\u6c8c\u5de5\u7a0b\u5e73\u53f0\uff0c\u53ef\u4ee5\u987a\u5229\u5730\u6ce8\u5165\u4e0d\u540c\u79cd\u7c7b\u7684\u6df7\u6c8c\uff0c\u5e76\u5c06\u5176\u6574\u5408\u5230\u6211\u4eec\u7684 CI \u7ba1\u9053\u4e2d\u3002\u5728\u8fd9\u4e2a\u8bb2\u5ea7\u7684\u6700\u540e\uff0c\u542c\u4f17\u4f1a\u4e86\u89e3\u5230\u6df7\u6c8c\u5de5\u7a0b\u4f1a\u5728\u54ea\u4e9b\u65b9\u9762\u7ed9 API \u7f51\u5173\u5e26\u6765\u597d\u5904\uff0c\u4ee5\u53ca\u5982\u4f55\u5c06\u6df7\u6c8c\u7f51\u6574\u5408\u5230\u4f60\u81ea\u5df1\u7684\u6d4b\u8bd5\u7ba1\u9053\u4e2d\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Test-Apache-APISIX-Resilience-With-Chaos-Mesh)\\n\\n## \u4f7f\u7528 Apache APISIX \u8fdb\u884c\u8ba4\u8bc1\u548c\u6388\u6743\\n\\n\u5206\u4eab\u8005\uff1a\u6731\u6b23\u6b23\\n\\n\u8ba4\u8bc1\u548c\u6388\u6743\u662f API \u7f51\u5173\u4e2d\u975e\u5e38\u5fc5\u8981\u7684\u529f\u80fd\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4f4d\u4e8e\u7f51\u5173\u540e\u9762\u7684\u670d\u52a1\u5c31\u53ef\u4ee5\u5f97\u5230\u4fdd\u62a4\uff0c\u907f\u514d\u672a\u7ecf\u6388\u6743\u6216\u6076\u610f\u7684\u8bbf\u95ee\u3001\u6570\u636e\u6cc4\u9732\u548c\u9ed1\u5ba2\u653b\u51fb\u3002Apache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\u3002\u800c\u4e14\u5b83\u63d0\u4f9b\u4e86\u8bb8\u591a\u63d2\u4ef6\uff0c\u5305\u62ec\u50cf key-auth\u3001Open-ID\u3001wolf-RBAC \u7b49\u8ba4\u8bc1\u548c\u6388\u6743\u3002\u672c\u63d0\u6848\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 APISIX \u6765\u8fdb\u884c\u8ba4\u8bc1\u548c\u6388\u6743\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Using-Apache-APISIX-To-Do-Authentication-and-Authorization)\\n\\n## \u4f9d\u6258\u793e\u533a\u8ba9 Apache APISIX \u9ad8\u901f\u53d1\u5c55\\n\\n\u5206\u4eab\u8005\uff1a\u738b\u9662\u751f\\n\\n\u5728\u8fc7\u53bb\u7684\u4e00\u5e74\u91cc\uff0cAPISIX \u5df2\u7ecf\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684 API \u7f51\u5173\u9879\u76ee\uff0c\u9664\u4e86\u81ea\u8eab\u6280\u672f\u5148\u8fdb\u5916\uff0c\u66f4\u5f97\u610f\u4e8e\u793e\u533a\u7684\u9ad8\u5ea6\u6d3b\u8dc3\u3002\u622a\u6b62\u76ee\u524d\uff0c\u5df2\u7ecf\u6709\u6765\u81ea\u4e16\u754c\u5404\u5730 225 \u4f4d\u8d21\u732e\u8005\u53c2\u4e0e\u8d21\u732e\uff0c\u5e76\u4e14\u8fd8\u5728\u4fdd\u6301\u9ad8\u901f\u589e\u957f\u3002 \u672c\u6b21\u5206\u4eab\u4f1a\u4ecb\u7ecd APISIX \u5728\u8df5\u884c\u201c\u793e\u533a\u91cd\u4e8e\u4ee3\u7801\u201d\u8fc7\u7a0b\u7684\u4e00\u4e9b\u5fc3\u5f97\u3002\u4f5c\u4e3a\u4e00\u4e2a\u7406\u60f3\u4e3b\u4e49\u521b\u4e1a\u8005\uff0c\u53c8\u662f\u5982\u4f55\u4e0e Apache \u6587\u5316\u7ed3\u5408\uff0c\u8ba9\u521b\u4e1a\u516c\u53f8\u4e5f\u80fd\u9ad8\u901f\u53d1\u5c55\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Relying-On-The-Community-To-Get-Apache-APISIX-Up-Speed)\\n\\n## Apache APISIX \u4ece\u5f00\u6e90\u9879\u76ee\u5230\u5546\u4e1a\u5316\u4e4b\u8def\\n\\n\u5206\u4eab\u8005\uff1a\u6e29\u94ed\\n\\n\u6e29\u94ed\uff0c[api7.ai](api7.ai) \u521b\u59cb\u4eba\uff0cApache APISIX PMC \u4e3b\u5e2d\uff0cApache \u57fa\u91d1\u4f1a member\uff0c\u4ed6\u6f14\u8bb2\u7684\u9898\u76ee\u662f\u201cApache APISIX \u4ece\u5f00\u6e90\u9879\u76ee\u5230\u5546\u4e1a\u5316\u4e4b\u8def\u201d\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Apache-APISIX-From-OpenSource-Commercialization)\\n\\n## \u4f7f\u7528 Echarts \u5448\u73b0\u793e\u533a\u6d3b\u52a8\u7684\u6e32\u67d3\u56fe\\n\\n\u5206\u4eab\u8005\uff1a\u5b59\u6bc5\\n\\n\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5206\u6790\u4e86\u5f00\u6e90\u8d44\u6e90\u5e93\u7684\u60c5\u51b5\uff1a1.\u8d21\u732e\u8005\u589e\u957f\u66f2\u7ebf\uff1b2.\u6bcf\u6708\u7684\u8d21\u732e\u8005\u6d3b\u52a8\uff1b3.\u6765\u53cd\u6620\u5f00\u6e90\u9879\u76ee\u7684\u5065\u5eb7\u72b6\u51b5\uff0c\u8fd9\u91cc\u6211\u4eec\u5206\u4eab\u4e00\u4e9b\u5173\u4e8e\u5982\u4f55\u5236\u4f5c\u8fd9\u4e24\u5f20\u56fe\u7684\u7ecf\u9a8c\u548c\u4e00\u4e9b\u6709\u8da3\u7684\u4e8b\u60c5\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Rendering-Community-Events-Using-ECharts)\\n\\n## \u6309\u7167 Apache Way \u8fd0\u4f5c\u5f00\u6e90\u5546\u4e1a\u5316\u516c\u53f8\uff0c\u8fd9\u884c\u5f97\u901a\u5417\\n\\n\u5206\u4eab\u8005\uff1a\u6e29\u94ed\\n\\nApache Way \u662f\u88ab\u65e0\u6570\u5f00\u6e90\u9879\u76ee\u8bc1\u5b9e\u7684\u793e\u533a\u6210\u529f\u4e4b\u9053\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5f00\u6e90\u5546\u4e1a\u516c\u53f8\u800c\u8a00\uff0cApache Way \u662f\u5426\u53ef\u884c\u5462\uff1f\u5b83\u5728\u5546\u4e1a\u793e\u4f1a\u662f\u5426\u884c\u5f97\u901a\uff1f \u901a\u8fc7 2 \u5e74\u5f00\u6e90\u5546\u4e1a\u516c\u53f8\u7684\u7ecf\u8425\uff0c[\u652f\u6d41\u79d1\u6280](https://api7.ai/)\u5e0c\u671b\u7528\u516c\u53f8\u7684\u5207\u8eab\u7ecf\u5386\u6765\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Apache-APISIX-From-OpenSource-Commercialization-by-Apache-Way)\\n\\n## \u5f00\u6e90\u7684\u9b45\u529b\\n\\n\u5206\u4eab\u8005\uff1a\u741a\u81f4\u8fdc\\n\\nApache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u9876\u7ea7\u9879\u76ee Apache APISIX \u4ee5\u53ca\u5b50\u9879\u76ee\uff0c\u5728\u8fc7\u53bb 30 \u5929\u4e2d\u5171\u5408\u5e76\u4e86 250+ PRs\uff0c\u8d21\u732e\u8005\u8d8b\u52bf\u4e5f\u5341\u5206\u4e50\u89c2\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u9ad8\u8d28\u91cf\u7684\u90ae\u4ef6\u5217\u8868\u3001\u6d3b\u8dc3\u7684\u3001QQ \u7fa4 \u4e0e GitHub \u4e5f\u5438\u5f15\u4f17\u591a\u793e\u533a\u7684\u5173\u6ce8\u3002\u4f5c\u4e3a Apache APISIX PMC\uff0c\u4ece\u6211\u7684\u89c6\u89d2\u6765\u5206\u4eab Apache APISIX \u505a\u4e86\u54ea\u4e9b\u4e8b\u60c5\uff0c\u50ac\u5316\u51fa\u6d3b\u8dc3\u7684\u793e\u533a\uff1f\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/The-Appeal-of-OpenSource)\\n\\n## Apache APISIX \u5728\u79fb\u52a8\u4e91\u5bf9\u8c61\u5b58\u50a8 EOS \u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\\n\\n\u5206\u4eab\u8005\uff1a\u9648\u7131\u5c71\\n\\n\u8be5\u6f14\u8bb2\u4e3b\u9898\u4e3b\u8981\u662f\u8bb2\u8ff0 Apache APISIX \u5728\u4e2d\u56fd\u79fb\u52a8\u516c\u6709\u4e91\u5bf9\u8c61\u5b58\u50a8 EOS \u4e2d\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\u7ecf\u9a8c\u5206\u4eab\u3002\u9996\u5148\u4ecb\u7ecd\u4e86\u4e2d\u56fd\u79fb\u52a8\u516c\u6709\u4e91\u5efa\u8bbe\u89c4\u5212\u53ca\u5bf9\u8c61\u5b58\u50a8\u4ea7\u54c1\u53d1\u5c55\u6f14\u8fdb\u5386\u7a0b\uff0c\u7136\u540e\u9610\u8ff0\u4e86\u6211\u4eec\u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX \u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\u7f51\u5173\uff0c\u5e76\u5bf9 EOS \u6d41\u91cf\u6cbb\u7406\u67b6\u6784\u6f14\u8fdb\u4e09\u4e2a\u9636\u6bb5\u8fdb\u884c\u8fdb\u884c\u4e86\u8be6\u7ec6\u4ecb\u7ecd\u3002\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u5206\u4eab\u4e86\u57fa\u4e8e Apache APISIX \u6211\u4eec\u89e3\u51b3\u4e86\u54ea\u4e9b\u5b9e\u9645\u751f\u4ea7\u95ee\u9898\uff0c\u505a\u4e86\u54ea\u4e9b\u65b9\u6848\u53ca\u5f00\u53d1\u5de5\u4f5c\uff0c\u6700\u540e\u5bf9\u6211\u4eec\u672a\u6765\u7684\u6f14\u8fdb\u505a\u4e86\u4e00\u4e9b\u89c4\u5212\u8bf4\u660e\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Apache-APISIX-in-China-Mobile-Cloud)\\n\\n## \u5982\u4f55\u5c06 Apache APISIX \u6269\u5c55\u4e3a\u4e00\u4e2a\u670d\u52a1\u7f51\u683c\u7684\u8fb9\u8f66\\n\\n\u5206\u4eab\u8005\uff1a\u5f20\u8d85\\n\\n\u5728\u8fd9\u4e2a\u4e3b\u9898\u4e2d\uff0c\u6211\u5c06\u4ecb\u7ecd apisix-mesh-agent \u9879\u76ee\uff0c\u5b83\u6709\u4e00\u4e9b\u80fd\u529b\u5c06 Apache APISIX \u6269\u5c55\u4e3a\u670d\u52a1\u7f51\u683c\u573a\u666f\u4e2d\u7684\u8fb9\u8f66\u7a0b\u5e8f\uff0c\u66f4\u91cd\u8981\u7684\u662f\uff0c\u5b83\u4f7f\u7528 xDS \u534f\u8bae\u4ece Istio\u3001Kuma \u7b49\u63a7\u5236\u5e73\u9762\u83b7\u53d6\u914d\u7f6e\u3002\u4e4b\u540e\uff0c\u6211\u5c06\u4ecb\u7ecd\u5173\u4e8e\u5728\u670d\u52a1\u7f51\u4e2d\u4f7f\u7528 Apache APISIX \u7684\u672a\u6765\u8ba1\u5212\u548c\u671f\u671b\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/How-To-Extend-Apache-APISIX-into-a-Service-Mesh-Sidecar)\\n\\n## Apache APISIX \u7684\u6f14\u53d8\\n\\n\u5206\u4eab\u8005\uff1a\u7f57\u6cfd\u8f69\\n\\n\u5728\u8fd9\u4e2a\u4e3b\u9898\u4e2d\uff0c\u6211\u5c06\u4ecb\u7ecd\u4e00\u4e0b Apache APISIX \u7684\u53d1\u5c55\uff0c\u5305\u62ec\uff1a1.\u6211\u4eec\u6240\u505a\u7684\u597d\u51b3\u5b9a\uff1b2.\u6211\u4eec\u6240\u505a\u7684\u4e0d\u597d\u7684\u51b3\u5b9a\uff1b3.\u6211\u4eec\u7684\u672a\u6765\u8ba1\u5212\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/The-Evolution-of-Apache-APISIX)\\n\\n## \u57fa\u4e8e Apache APISIX \u7684 Kubernetes Ingress \u7684\u5b9e\u73b0\\n\\n\u5206\u4eab\u8005\uff1a\u91d1\u536b\\n\\n\u4ecb\u7ecd\u57fa\u4e8e Apache APISIX \u7684 Kubernetes Ingress \u7684\u4f18\u52bf\u4ee5\u53ca Apache APISIX Ingress \u7684\u7279\u70b9\u3002\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Apache-APISIX-Kubernetes-Ingress)\\n\\n## Apache APISIX \u7684\u5b75\u5316\u5668\u4e4b\u65c5\\n\\n\u5206\u4eab\u8005\uff1a\u6e29\u94ed\\n\\nApache APISIX \u7684\u5b75\u5316\u5668\u4e4b\u65c5\\n\\n[**\u67e5\u770b\u5206\u4eab**](/articles/Apache-APISIX-Incubator-Journey)"},{"id":"\u793e\u533a\u53cc\u5468\u62a5\uff088.16-8.22\uff09","metadata":{"permalink":"/zh/blog/2021/08/23/weekly-report","source":"@site/blog/2021/08/23/weekly-report.md","title":"\u793e\u533a\u53cc\u5468\u62a5\uff088.16-8.22\uff09","description":"\u672c\u5468 Apache APISIX \u65b0\u589e\u4e86 gzip \u63d2\u4ef6\u652f\u6301\u7279\u6b8a\u7684 * \u6765\u5339\u914d\u4efb\u4f55\u7c7b\u578b\uff0cext-plugin \u63d2\u4ef6\u652f\u6301 ExtraInfo\uff0curi-blocker \u63d2\u4ef6\u652f\u6301\u81ea\u5b9a\u4e49\u5931\u8d25\u54cd\u5e94\u7b49\u529f\u80fd\u3002","date":"2021-08-23T00:00:00.000Z","formattedDate":"2021\u5e748\u670823\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.72,"truncated":true,"authors":[],"prevItem":{"title":"ApacheCon Asia 2021","permalink":"/zh/blog/2021/08/23/apachecon-asia-2021"},"nextItem":{"title":"8.21 Apache APISIX Meetup \u4e0a\u6d77\u7ad9\u62a5\u540d\u5f00\u542f\uff01","permalink":"/zh/blog/2021/08/21/shanghai-meetup"}},"content":"> \u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue \uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\n[Apache APISIX](https://github.com/apache/apisix) \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue \uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n![weekly_contributor_static_20210823](https://static.apiseven.com/202108/1629726394722-84d86d5a-1b62-4bbd-b681-c42b371c53ec.png)\\n\\n## Good first issue\\n\\n### Issue #4441\\n\\n\u94fe\u63a5\uff1ahttps://github.com/apache/apisix/issues/4441\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u73b0\u5728 APISIX stream_routes \u7684\u53c2\u6570 \\"remote_addr\\"\u53ea\u652f\u6301\u5355\u4e2a ip\uff0c\u9700\u8981\u652f\u6301\u591a\u4e2a ip \u6216\u8005\u50cf \\"192.168.0.0/16 \\"\u8fd9\u6837\u7684\u5339\u914d\u89c4\u5219\uff0c\u5c31\u50cf http \u8def\u7531\u53c2\u6570 \\"remote_addr\\"\u4e00\u6837\u3002\\n\\n**\u89e3\u51b3\u65b9\u6848**\uff1a\u4e3a APISIX stream_routes \u7684 \\"remote_addr\\"\u53c2\u6570\u652f\u6301\u591a\u4e2a ip \u5730\u5740\u6216\u5339\u914d\u89c4\u5219\uff0c\u5982 \\"192.168.0.0/16\\"\\n\\n\u76f8\u5173\u7cfb\u7edf\u53c2\u6570\uff1a\\n\\n- apisix version (cmd: `apisix version`): 2.6\\n- OS (cmd: `uname -a`): CentOS7\\n\\n### Issue #3931\\n\\n\u94fe\u63a5\uff1ahttps://github.com/apache/apisix/issues/3931\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a \u91cd\u5b9a\u5411\u63d2\u4ef6\u4e2d\u7684 http_to_https \u7f3a\u4e4f curl \u6d4b\u8bd5\\n\\n**\u89e3\u51b3\u65b9\u6848**\uff1a\u4e3a\u91cd\u5b9a\u5411\u63d2\u4ef6\u4e2d\u7684 http_to_https \u6dfb\u52a0 curl \u6d4b\u8bd5\\n\\n\u66f4\u65b0\u6587\u6863 http://apisix.apache.org/docs/apisix/plugins/redirect\\n\\n## \u672c\u5468\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- **gzip \u63d2\u4ef6\u652f\u6301\u7279\u6b8a\u7684 * \u6765\u5339\u914d\u4efb\u4f55\u7c7b\u578b**  \\n  **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4817  \\n  **\u8d21\u732e\u8005**\uff1a[RocFang](https://github.com/RocFang)  \\n\\n- **ext-plugin \u63d2\u4ef6\u652f\u6301 ExtraInfo**  \\n  **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4835  \\n  **\u8d21\u732e\u8005**\uff1a[spacewander](https://github.com/spacewander)  \\n\\n- **real-ip \u63d2\u4ef6\u4e3a `X-Forwarded-For` \u6dfb\u52a0\u7279\u6b8a\u5904\u7406**  \\n  **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4852  \\n  **\u8d21\u732e\u8005**\uff1a[spacewander](https://github.com/spacewander)  \\n\\n- **uri-blocker \u63d2\u4ef6\u652f\u6301\u81ea\u5b9a\u4e49\u5931\u8d25\u54cd\u5e94**\\n  **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4849  \\n  **\u8d21\u732e\u8005**\uff1a[okaybase](https://github.com/okaybase)  \\n\\nApache APISIX \u7684[\u9879\u76ee\u5b98\u7f51](https://apisix.apache.org/)\u548c Github \u4e0a\u7684 [issue](https://github.com/apache/apisix/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc) \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u672c\u5468\u535a\u6587\u63a8\u8350\\n\\n- [Go \u8ba9 Apache APISIX \u5982\u864e\u6dfb\u7ffc](https://mp.weixin.qq.com/s?__biz=MzI1MDU3NjQ5OA==&mid=2247486454&idx=1&sn=905ab375e0f33a173ba90a0f541995b7&chksm=e98160ebdef6e9fd58079446c1543c7d6f8fabac966acb4e4165d80bf42f6c64a8183583ff1a&token=1586118041&lang=zh_CN#rd)  \\n\u8fd9\u7bc7\u6587\u7ae0\u5c06\u8be6\u7ec6\u8bb2\u89e3\u5982\u4f55\u7528 Go \u6765\u5f00\u53d1 Apache APISIX \u63d2\u4ef6\u3002\u901a\u8fc7\u62e5\u62b1 Go \u7684\u751f\u6001\u5708\uff0c\u4e3a Apache APISIX \u5f00\u521b\u4e00\u7247\u65b0\u5929\u5730\uff0c\u5e0c\u671b Go \u80fd\u8ba9 Apache APISIX \u5982\u864e\u6dfb\u7ffc\uff01\\n\\n- [Apache APISIX \u5728 Airwallex \u7684\u5e94\u7528 | \u4e13\u8bbf Airwallex \u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\u674e\u6768](https://mp.weixin.qq.com/s?__biz=MzI1MDU3NjQ5OA==&mid=2247486406&idx=1&sn=5d04353f3d8128f17fca138572667ddb&chksm=e98160dbdef6e9cd19ddeed4267554a15bcd1a10decfa2c16f2989575bd9a1c9c95349b0c0cc&token=1586118041&lang=zh_CN#rd)  \\nAirwallex \u7a7a\u4e2d\u4e91\u6c47\u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\u674e\u6768\u7684\u4e13\u8bbf\uff0c\u4e00\u8d77\u6765\u542c\u542c\u7a7a\u4e2d\u4e91\u6c47\u4e0e Apache APISIX \u4e4b\u95f4\u7684\u6545\u4e8b\u3002\\n\\n- [Apache APISIX \u793e\u533a\u5468\u62a5 \uff5c 2021 8.9-8.15](https://mp.weixin.qq.com/s?__biz=MzI1MDU3NjQ5OA==&mid=2247486382&idx=1&sn=f041eb8c38dd528450e5bf4280b60b0f&chksm=e98160b3def6e9a5331f9485d8a478f9546475f949a31f8142c4188d9c104d39eec9a281bbf2&token=1586118041&lang=zh_CN#rd)  \\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002"},{"id":"8.21 Apache APISIX Meetup \u4e0a\u6d77\u7ad9\u62a5\u540d\u5f00\u542f\uff01","metadata":{"permalink":"/zh/blog/2021/08/21/shanghai-meetup","source":"@site/blog/2021/08/21/shanghai-meetup.md","title":"8.21 Apache APISIX Meetup \u4e0a\u6d77\u7ad9\u62a5\u540d\u5f00\u542f\uff01","description":"\u672c\u6b21 Meetup \u5c06\u4e3a\u5927\u5bb6\u5206\u4eab\u5173\u4e8e API \u7f51\u5173 Apache APISIX \u793e\u533a\u7684\u7531\u6765\uff0c\u7231\u5947\u827a\u4f7f\u7528 APISIX \u7684\u7528\u6237\u6848\u4f8b\uff0c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7684\u4f18\u70b9\u4ee5\u53ca\u5982\u4f55\u5728 APISIX \u4e0a\u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u3002","date":"2021-08-21T00:00:00.000Z","formattedDate":"2021\u5e748\u670821\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":5.27,"truncated":true,"authors":[],"prevItem":{"title":"\u793e\u533a\u53cc\u5468\u62a5\uff088.16-8.22\uff09","permalink":"/zh/blog/2021/08/23/weekly-report"},"nextItem":{"title":"Go \u8ba9 Apache APISIX \u5982\u864e\u6dfb\u7ffc","permalink":"/zh/blog/2021/08/19/go-makes-apache-apisix-better"}},"content":"> \u672c\u6b21 Meetup \u7531 [api7.ai](https://www.apiseven.com/) \u53d1\u8d77\uff0c\u5e76\u9080\u8bf7\u7231\u5947\u827a\u3001\u7a7a\u4e2d\u4e91\u6c47\u7b49\u5408\u4f5c\u4f19\u4f34\u5171\u540c\u4e3a\u5927\u5bb6\u5448\u73b0\u3002Apache APISIX PMC \u6210\u5458\u3001\u8d21\u732e\u8005\u3001\u793e\u533a\u6280\u672f\u4e13\u5bb6\u6c47\u805a\u4e00\u5802\uff0c\u5171\u540c\u63a2\u8ba8 Apache APISIX \u793e\u533a\u53d1\u5c55\u3001\u884c\u4e1a\u5b9e\u8df5\u7b49\u8bdd\u9898\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n#### \u65f6\u95f4\uff1a2021 \u5e74 8 \u6708 21 \u65e5 13:30\\n\\n#### \u5730\u70b9\uff1a\u4e0a\u6d77\u5e02\u9ec4\u6d66\u533a\u4e2d\u533a\u5e7f\u573a 6 \u697c\u9759\u548c\u5c9b\u4e8c\u671f\\n\\n#### \u53c2\u52a0\u672c\u6b21 Meetup\uff0c\u4f60\u53ef\u4ee5\\n\\n- \u5171\u540c\u63a2\u8ba8 Apache APISIX \u793e\u533a\u7684\u524d\u4e16\u4eca\u751f\\n- \u542c\u7231\u5947\u827a\u79d1\u5b66\u5bb6\u8bb2\u8ff0\uff0c\u7231\u5947\u827a\u662f\u5982\u4f55\u4f7f\u7528 Apache APISIX \u652f\u6491\u8d77\u5343\u4e07\u7ea7\u8c03\u7528\u91cf\u7684\u670d\u52a1\\n- \u7a7a\u4e2d\u4e91\u6c47\u662f\u5982\u4f55\u5728\u4f7f\u7528 Apache APISIX \u65f6\u517c\u987e\u7528\u6237\u4f53\u9a8c\u3001\u6574\u6d01\u67b6\u6784\u4e0e\u6570\u636e\u4e3b\u6743\\n- \u4e86\u89e3\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7684\u4f18\u70b9\u4ee5\u53ca\u5982\u4f55\u5728 APISIX \u4e0a\u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\\n\\n\u5982\u679c\u4f60\u611f\u5174\u8da3\u7684\u8bdd\uff0c\u5343\u4e07\u4e0d\u8981\u9519\u8fc7\uff0c**\u626b\u63cf\u6d3b\u52a8\u6d77\u62a5\u4e8c\u7ef4\u7801\u62a5\u540d\u5427\uff01**\\n\\ntips\uff1a\u75ab\u60c5\u9632\u63a7\u4e0d\u653e\u677e\uff0c\u6211\u4eec\u5c06\u4f1a\u63a7\u5236\u73b0\u573a\u6d3b\u52a8\u89c4\u6a21\uff0c\u540d\u989d\u6709\u9650\uff0c\u62a5\u540d\u4ece\u901f\uff01\\n\\n## \u6d3b\u52a8\u5b89\u6392\\n\\n![Apache APISIX Meetup](https://static.apiseven.com/202108/1639467909853-fd9caa2e-8b45-459c-8bb7-8acb4a20692e.jpg)\\n\\n## \u8bae\u9898\u4ecb\u7ecd\\n\\n### \u57fa\u4e8e Apache APISIX\uff0c\u7231\u5947\u827a API \u7f51\u5173\u7684\u843d\u5730\u5b9e\u8df5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u848b\u6587\u6770 / \u7231\u5947\u827a\u79d1\u5b66\u5bb6\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\nAPI \u7f51\u5173\u5df2\u7ecf\u6210\u4e3a\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u4e00\u73af\u3002\u5b83\u65e2\u627f\u62c5\u7740\u670d\u52a1\u5bf9\u5916\u7684\u552f\u4e00\u95e8\u6237\uff0c\u53c8\u9700\u8981\u6ee1\u8db3\u8bb8\u591a\u5e94\u7528\u7684\u5171\u6027\u529f\u80fd\u3002\u7231\u5947\u827a\u4f5c\u4e3a\u4e00\u5bb6\u5728\u7ebf\u89c6\u9891\u516c\u53f8\uff0c\u6bcf\u5929\u9700\u8981\u627f\u8f7d\u5343\u4e07\u7ea7\u7684\u8c03\u7528\u91cf\uff0c\u5e76\u4e14\u5bf9\u6570\u636e\u7684\u5b89\u5168\u3001\u7528\u6237\u8bf7\u6c42\u54cd\u5e94\u65f6\u6548\u3001\u7cfb\u7edf\u7684\u7a33\u5b9a\u90fd\u6709\u7740\u6781\u5176\u4e25\u683c\u7684\u8981\u6c42\uff0c\u56e0\u6b64\u516c\u53f8\u9700\u8981\u6253\u9020\u4e00\u4e2a\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u7528\u7684 API \u7f51\u5173\u3002\u672c\u6587\u7b80\u5355\u4ecb\u7ecd\u7231\u5947\u827a API \u7f51\u5173\u7684\u67b6\u6784\u4ee5\u53ca\u5b9e\u73b0\u7684\u529f\u80fd\uff0c\u5305\u62ec\u8bf7\u6c42\u5206\u53d1\u3001\u6761\u4ef6\u8def\u7531\u3001API \u7ba1\u7406\u3001\u9650\u6d41\u7194\u65ad\u3001\u5b89\u5168\u4e09\u9632\u3001\u76d1\u63a7\u62a5\u8b66\u4ee5\u53ca\u5168\u94fe\u8def\u8ffd\u8e2a\u7b49\u3002\\n\\n### \u5982\u4f55\u4f7f\u7528 Apache APISIX \u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u6731\u6b23\u6b23 / api7.ai \u5de5\u7a0b\u5e08\uff0cApache APISIX Committer\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u8eab\u4efd\u8ba4\u8bc1\u662f\u96f6\u4fe1\u4efb\u67b6\u6784\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u73af\u3002\u901a\u8fc7\u8eab\u4efd\u8ba4\u8bc1\u53ef\u4ee5\u6709\u6548\u4fdd\u62a4\u670d\u52a1\uff0c\u907f\u514d\u672a\u7ecf\u6388\u6743\u7684\u6076\u610f\u8bbf\u95ee\uff0c\u6570\u636e\u6cc4\u6f0f\u4ee5\u53ca\u9ed1\u5ba2\u653b\u51fb\u3002APISIX \u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u652f\u6301\u4e30\u5bcc\u7684\u8eab\u4efd\u8ba4\u8bc1\u63d2\u4ef6\uff0c\u672c\u6b21\u5206\u4eab\u5c06\u4ecb\u7ecd\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u7684\u4f18\u70b9\u548c\u5982\u4f55\u5728 APISIX \u4e0a\u8fdb\u884c\u96c6\u4e2d\u5f0f\u8eab\u4efd\u8ba4\u8bc1\u3002\\n\\n### \u6570\u636e\u4e3b\u6743\u4e0e Apache APISIX \u7f51\u5173\u843d\u5730\u5b9e\u8df5\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u674e\u6768 / \u7a7a\u4e2d\u4e91\u6c47\u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\n\u6570\u636e\u65e0\u5904\u4e0d\u5728\uff0c\u6bcf\u65f6\u6bcf\u523b\u90fd\u6709\u6d77\u91cf\u6570\u636e\u5728\u4e16\u754c\u5404\u5730\u88ab\u5904\u7406\u3001\u4f20\u8f93\u3001\u5b58\u50a8\u3002\u7136\u800c\u6570\u636e\u4e16\u754c\u4e0d\u662f\u6cd5\u5916\u4e4b\u5730\uff0c\u6570\u636e\u7684\u6536\u96c6\u4e0e\u5904\u7406\u5fc5\u987b\u9075\u7167\u5404\u56fd\u6cd5\u5f8b\u6267\u884c\u3002\u8fd9\u4e3a\u4f01\u4e1a\u7684\u6280\u672f\u67b6\u6784\u63d0\u51fa\u4e86\u5de8\u5927\u7684\u6311\u6218\uff0c\u5982\u4f55\u517c\u987e\u7528\u6237\u4f53\u9a8c\u3001\u6574\u6d01\u67b6\u6784\u4e0e\u6570\u636e\u4e3b\u6743\uff1fAPI \u7f51\u5173\u5728\u4f01\u4e1a\u67b6\u6784\u4e2d\u5177\u6709\u7279\u6b8a\u5730\u4f4d\uff0c\u4e5f\u56e0\u6b64\u80fd\u5728\u6570\u636e\u4e3b\u6743\u573a\u666f\u4e0b\u8d77\u5230\u7279\u6b8a\u91cd\u8981\u7684\u4f5c\u7528\u3002\\n\\n### \u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\uff0cApache APISIX \u611f\u6069\u6709\u4f60\\n\\n#### \u5206\u4eab\u5609\u5bbe\\n\\n\u738b\u9662\u751f / api7.ai \u8054\u5408\u521b\u59cb\u4eba & CTO\\n\\n#### \u8bae\u9898\u8be6\u60c5\\n\\nApache APISIX \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u77ed\u77ed\u4e24\u5e74\u65f6\u95f4\u4ea7\u54c1\u591a\u9879\u6280\u672f\u6307\u6807\u5305\u63fd\u7b2c\u4e00\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3 API \u7f51\u5173\u9879\u76ee\uff0c\u5e76\u786e\u5b9a\u4e86\u4e13\u5c5e\u4e8e Apache APISIX \u7684\u9053\u8def\uff1a\u7edf\u4e00 7 \u5c42\u6d41\u91cf\u5904\u7406\u3002\u4e00\u4e2a\u4eba\u53ef\u80fd\u8d70\u7684\u5f88\u5feb\uff0c\u4e00\u7fa4\u4eba\u624d\u80fd\u8d70\u7684\u66f4\u8fdc\uff0cApache APISIX \u6210\u957f\u4e4b\u8def\u611f\u6069\u6709\u4f60\u3002\\n\\n## \u5468\u8fb9\u798f\u5229\\n\\n\u53c2\u52a0 Meetup\uff0c\u4e0e\u8bb2\u5e08\u4e92\u52a8\uff0c\u6709\u673a\u4f1a\u83b7\u5f97 Apache APISIX \u6700\u65b0\u5468\u8fb9\uff1a\u8d85\u5927\u9f20\u6807\u57ab\u3001\u7cbe\u81f4\u9a6c\u514b\u676f\u3001Apache APISIX \u5fbd\u7ae0\u3001\u5b9a\u5236\u96e8\u4f1e\u3002\\n\\n![Apache APISIX Gift](https://static.apiseven.com/202108/1639468073361-021ba09a-69bb-47ac-a852-e879c3109a9a.jpg)\\n\\n## \u53c2\u4e0e\u65b9\u5f0f\\n\\n### \u73b0\u573a\u62a5\u540d\\n\\n\u626b\u63cf\u4e0a\u65b9\u6d3b\u52a8\u6d77\u62a5\u4e8c\u7ef4\u7801\u5373\u53ef\u62a5\u540d\uff01\\n\\n### \u7ebf\u4e0a\u76f4\u64ad\\n\\n\u5982\u679c\u4e0d\u80fd\u5230\u73b0\u573a\u53c2\u52a0 Meetup\uff0c\u5173\u6ce8 Apache APISIX \u89c6\u9891\u53f7\u89c2\u770b\u76f4\u64ad\u3002\\n\\n![Apache APISIX Live](https://static.apiseven.com/202108/1639467967121-2fff2f38-7949-4ea5-be55-7a3bf47b2bd5.png)\\n\\n## \u5165\u7fa4\u4ea4\u6d41\\n\\n\u6b22\u8fce\u5173\u6ce8 Apache APISIX \u516c\u4f17\u53f7\uff0c\u5728\u540e\u53f0\u56de\u590d\u5173\u952e\u5b57\u201c\u4e0a\u6d77\u201d\uff0c\u52a0\u5165 Apache APISIX \u4e0a\u6d77\u4ea4\u6d41\u7fa4\u3002\\n\\n![Apache APISIX wechat](https://static.apiseven.com/202108/1639468019348-d2d555ab-e860-41a4-9efa-f383eb0c0069.png)"},{"id":"2021/08/19/go-makes-apache-apisix-better","metadata":{"permalink":"/zh/blog/2021/08/19/go-makes-apache-apisix-better","source":"@site/blog/2021/08/19/go-makes-Apache-APISIX-better.md","title":"Go \u8ba9 Apache APISIX \u5982\u864e\u6dfb\u7ffc","description":"\u672c\u6587\u8be6\u7ec6\u8bb2\u89e3\u5982\u4f55\u7528 Go \u6765\u5f00\u53d1\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684\u63d2\u4ef6\u3002\u901a\u8fc7\u62e5\u62b1 Go \u7684\u751f\u6001\u5708\uff0c\u4e3a APISIX \u5f00\u521b\u4e00\u7247\u65b0\u5929\u5730\uff0c\u5e0c\u671b Go \u80fd\u8ba9 APISIX \u5982\u864e\u6dfb\u7ffc\uff01","date":"2021-08-19T00:00:00.000Z","formattedDate":"2021\u5e748\u670819\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":7.4,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"8.21 Apache APISIX Meetup \u4e0a\u6d77\u7ad9\u62a5\u540d\u5f00\u542f\uff01","permalink":"/zh/blog/2021/08/21/shanghai-meetup"},"nextItem":{"title":"Apache APISIX \u793e\u533a\u5468\u62a5\uff088.9-8.15\uff09","permalink":"/zh/blog/2021/08/19/weekly-report"}},"content":"> \u8fd9\u7bc7\u6587\u7ae0\u5c06\u8be6\u7ec6\u8bb2\u89e3\u5982\u4f55\u7528 Go \u6765\u5f00\u53d1 Apache APISIX \u63d2\u4ef6\u3002\u901a\u8fc7\u62e5\u62b1 Go \u7684\u751f\u6001\u5708\uff0c\u4e3a Apache APISIX \u5f00\u521b\u4e00\u7247\u65b0\u5929\u5730\uff0c\u5e0c\u671b Go \u80fd\u8ba9 Apache APISIX \u5982\u864e\u6dfb\u7ffc\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u4e3a\u4ec0\u4e48\u662f Go\\n\\n[Apache APISIX](https://github.com/apache/apisix) \u5141\u8bb8\u7528\u6237\u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u6765\u62d3\u5c55\u529f\u80fd\uff0c\u5982\u9274\u6743\u3001\u9650\u6d41\u3001\u8bf7\u6c42\u6539\u5199\u7b49\u6838\u5fc3\u529f\u80fd\u90fd\u662f\u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\u3002\u867d\u7136 Apache APISIX \u6838\u5fc3\u4ee3\u7801\u662f\u4f7f\u7528 Lua \u7f16\u5199\u7684\uff0c\u4f46\u662f Apache APISIX \u652f\u6301\u591a\u8bed\u8a00\u5f00\u53d1\u63d2\u4ef6\uff0c\u6bd4\u5982 Go \u3001Java\u3002\\n\\n\u8fd9\u7bc7\u6587\u7ae0\u5c06\u8be6\u7ec6\u8bb2\u89e3\u5982\u4f55\u7528 Go \u6765\u5f00\u53d1 Apache APISIX \u63d2\u4ef6\u3002\u901a\u8fc7\u62e5\u62b1 Go \u7684\u751f\u6001\u5708\uff0c\u4e3a Apache APISIX \u5f00\u521b\u4e00\u7247\u65b0\u5929\u5730\uff0c\u5e0c\u671b Go \u80fd\u8ba9 Apache APISIX \u5982\u864e\u6dfb\u7ffc\uff01\\n\\n## \u5b89\u88c5\\n\\n\u91c7\u7528\u5e93\u7684\u65b9\u5f0f\u6765\u4f7f\u7528 Go Runner\uff0c[apisix-go-plugin-runner](https://github.com/apache/apisix-go-plugin-runner) \u4e2d\u7684 `cmd/go-runner` \u5b98\u65b9\u7ed9\u51fa\u7684\u4f8b\u5b50\uff0c\u5c55\u793a\u8be5\u5982\u4f55\u4f7f\u7528 Go Runner SDK\u3002\u672a\u6765\u4e5f\u4f1a\u652f\u6301\u901a\u8fc7 Go Plugin \u7684\u673a\u5236\u52a0\u8f7d\u9884\u5148\u7f16\u8bd1\u597d\u7684\u63d2\u4ef6\u3002\\n\\n## \u5f00\u53d1\\n\\n### \u4f7f\u7528 Go Runner SDK \u8fdb\u884c\u5f00\u53d1\\n\\n```bash\\n$ tree cmd/go-runner\\ncmd/go-runner\\n\u251c\u2500\u2500 main.go\\n\u251c\u2500\u2500 main_test.go\\n\u251c\u2500\u2500 plugins\\n\u2502   \u251c\u2500\u2500 say.go\\n\u2502   \u2514\u2500\u2500 say_test.go\\n\u2514\u2500\u2500 version.go\\n```\\n\\n\u4e0a\u9762\u662f\u5b98\u65b9\u793a\u4f8b\u7684\u76ee\u5f55\u7ed3\u6784\u3002`main.go` \u662f\u5165\u53e3\uff0c\u5176\u4e2d\u6700\u5173\u952e\u7684\u90e8\u5206\u5728\u4e8e\uff1a\\n\\n```go\\ncfg := runner.RunnerConfig{}\\n...\\nrunner.Run(cfg)\\n```\\n\\n`RunnerConfig` \u53ef\u4ee5\u7528\u6765\u63a7\u5236\u65e5\u5fd7\u7b49\u7ea7\u548c\u65e5\u5fd7\u8f93\u51fa\u4f4d\u7f6e\u3002\\n\\n`runner.Run` \u4f1a\u8ba9\u5e94\u7528\u76d1\u542c\u76ee\u6807\u4f4d\u7f6e\uff0c\u63a5\u6536\u8bf7\u6c42\u5e76\u6267\u884c\u6ce8\u518c\u597d\u7684\u63d2\u4ef6\u3002\u5e94\u7528\u4f1a\u4e00\u76f4\u5904\u4e8e\u8fd9\u4e00\u72b6\u6001\u76f4\u5230\u9000\u51fa\u3002\\n\\n\u6253\u5f00 `plugins/say.go`\uff1a\\n\\n```go\\nfunc init() {\\n  err := plugin.RegisterPlugin(&Say{})\\n  if err != nil {\\n    log.Fatalf(\\"failed to register plugin say: %s\\", err)\\n  }\\n}\\n```\\n\\n\u7531\u4e8e `main.go` \u5bfc\u5165\u4e86 plugins \u5305\uff0c\\n\\n```go\\nimport (\\n  ...\\n  _ \\"github.com/apache/apisix-go-plugin-runner/cmd/go-runner/plugins\\"\\n  ...\\n)\\n```\\n\\n\u8fd9\u6837\u5c31\u5728\u6267\u884c `runner.Run` \u4e4b\u524d\u901a\u8fc7 `plugin.RegisterPlugin` \u6ce8\u518c\u4e86 `Say`\u3002\\n\\n`Say` \u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u65b9\u6cd5\uff1a\\n\\n`Name` \u65b9\u6cd5\u8fd4\u56de\u63d2\u4ef6\u540d\u3002\\n\\n```go\\nfunc (p *Say) Name() string {\\n  return \\"say\\"\\n}\\n```\\n\\n`ParseConf` \u4f1a\u5728\u63d2\u4ef6\u914d\u7f6e\u53d8\u5316\u7684\u65f6\u5019\u8c03\u7528\uff0c\u89e3\u6790\u914d\u7f6e\u5e76\u8fd4\u56de\u63d2\u4ef6\u7279\u5b9a\u7684\u914d\u7f6e\u4e0a\u4e0b\u6587\u3002\\n\\n```go\\nfunc (p *Say) ParseConf(in []byte) (interface{}, error) {\\n  conf := SayConf{}\\n  err := json.Unmarshal(in, &conf)\\n  return conf, err\\n}\\n```\\n\\n\u8be5\u63d2\u4ef6\u7684\u4e0a\u4e0b\u6587\u662f\u8fd9\u6837\u7684\uff1a\\n\\n```go\\ntype SayConf struct {\\n  Body string `json:\\"body\\"`\\n}\\n```\\n\\n`Filter` \u4f1a\u5728\u6bcf\u4e2a\u914d\u7f6e\u4e86 say \u63d2\u4ef6\u7684\u8bf7\u6c42\u4e2d\u6267\u884c\u3002\\n\\n```go\\nfunc (p *Say) Filter(conf interface{}, w http.ResponseWriter, r pkgHTTP.Request) {\\n  body := conf.(SayConf).Body\\n  if len(body) == 0 {\\n    return\\n  }\\n\\n  w.Header().Add(\\"X-Resp-A6-Runner\\", \\"Go\\")\\n  _, err := w.Write([]byte(body))\\n  if err != nil {\\n    log.Errorf(\\"failed to write: %s\\", err)\\n  }\\n}\\n```\\n\\n\u53ef\u4ee5\u770b\u5230 Filter \u628a\u914d\u7f6e\u91cc\u9762\u7684 body \u7684\u503c\u4f5c\u4e3a\u54cd\u5e94\u4f53\u3002\u5982\u679c\u5728\u63d2\u4ef6\u4e2d\u76f4\u63a5\u8fdb\u884c\u54cd\u5e94\uff0c\u5c31\u4f1a\u4e2d\u65ad\u8bf7\u6c42\u3002\\n\\nGo Runner SDK  API \u6587\u6863\uff1ahttps://pkg.go.dev/github.com/apache/apisix-go-plugin-runner\\n\\n\u628a\u5e94\u7528\u6784\u5efa\u8d77\u6765\u540e\uff08\u5728\u793a\u4f8b\u91cc\u9762\u662f `make build`\uff09\uff0c\u5728\u8fd0\u884c\u65f6\u9700\u8981\u8bbe\u7f6e\u4e24\u4e2a\u73af\u5883\u53d8\u91cf\uff1a\\n\\n1. `APISIX_LISTEN_ADDRESS=unix:/tmp/runner.sock`\\n2. `APISIX_CONF_EXPIRE_TIME=3600`\\n\\n\u50cf\u8fd9\u6837\uff1a\\n\\n```go\\nAPISIX_LISTEN_ADDRESS=unix:/tmp/runner.sock APISIX_CONF_EXPIRE_TIME=3600 ./go-runner run\\n```\\n\\n\u5e94\u7528\u8fd0\u884c\u65f6\u4f1a\u53bb\u76d1\u542c `/tmp/runner.sock`\u3002\\n\\n### \u8bbe\u7f6e Apache APISIX\uff08\u5f00\u53d1\uff09\\n\\n\u9996\u5148\u8981\u5b89\u88c5 Apache APISIX\uff0c\u9700\u8981\u548c Go Runner \u4f4d\u4e8e\u540c\u4e00\u5b9e\u4f8b\u4e0a\u3002\\n\\n![Apache APISIX work flow](https://static.apiseven.com/202108/1639467846997-8be8195d-98ac-457d-8b7f-a7b78e55fef1.png)\\n\\n\u4e0a\u56fe\u5de6\u8fb9\u662f Apache APISIX \u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u53f3\u8fb9\u7684 plugin runner \u8d1f\u8d23\u8fd0\u884c\u4e0d\u540c\u8bed\u8a00\u7f16\u5199\u7684\u5916\u90e8\u63d2\u4ef6\u3002apisix-go-plugin-runner \u5c31\u662f\u8fd9\u6837\u652f\u6301 Go \u8bed\u8a00\u7684 runner\u3002\\n\\n\u5f53\u4f60\u5728 Apache  APISIX \u4e2d\u914d\u7f6e\u4e00\u4e2a plugin runner \u65f6\uff0cApache  APISIX \u4f1a\u628a plugin runner \u4f5c\u4e3a\u81ea\u5df1\u7684\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u8be5\u5b50\u8fdb\u7a0b\u4e0e Apache  APISIX \u8fdb\u7a0b\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7528\u6237\uff0c\u5f53\u6211\u4eec\u91cd\u542f\u6216\u91cd\u65b0\u52a0\u8f7d Apache APISIX \u65f6\uff0cplugin runner \u4e5f\u5c06\u88ab\u91cd\u542f\u3002\\n\\n\u5982\u679c\u4e3a\u4e00\u4e2a\u7ed9\u5b9a\u7684\u8def\u7531\u914d\u7f6e\u4e86 ext-plugin-* \u63d2\u4ef6\uff0c\u51fb\u4e2d\u8be5\u8def\u7531\u7684\u8bf7\u6c42\u5c06\u89e6\u53d1 Apache APISIX \u901a\u8fc7 unix socket \u5411 plugin runner \u6267\u884c RPC \u8c03\u7528\u3002\u8c03\u7528\u7ec6\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a\\n\\n- ext-plugin-pre-req: \u5728\u6267\u884c\u7edd\u5927\u90e8\u5206 Apache APISIX \u5185\u7f6e\u63d2\u4ef6(Lua \u8bed\u8a00\u63d2\u4ef6)\u4e4b\u524d\\n- ext-plugin-post-req: \u5728\u6267\u884c Apache APISIX \u5185\u7f6e\u63d2\u4ef6(Lua \u8bed\u8a00\u63d2\u4ef6)\u4e4b\u540e\\n\\n\u6839\u636e\u9700\u8981\u914d\u7f6e plugin runner \u7684\u6267\u884c\u65f6\u673a\u3002\\n\\nplugin runner \u4f1a\u5904\u7406 RPC \u8c03\u7528\uff0c\u5728\u5176\u5185\u90e8\u521b\u5efa\u4e00\u4e2a\u6a21\u62df\u8bf7\u6c42\uff0c\u7136\u540e\u8fd0\u884c\u5176\u4ed6\u8bed\u8a00\u7f16\u5199\u7684\u63d2\u4ef6\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9 Apache APISIX\u3002\\n\\n\u8fd9\u4e9b\u63d2\u4ef6\u7684\u6267\u884c\u987a\u5e8f\u662f\u5728 ext-plugin-* \u63d2\u4ef6\u914d\u7f6e\u9879\u4e2d\u5b9a\u4e49\u7684\u3002\u50cf\u5176\u4ed6\u63d2\u4ef6\u4e00\u6837\uff0c\u5b83\u4eec\u53ef\u4ee5\u88ab\u542f\u7528\u5e76\u5728\u8fd0\u884c\u4e2d\u91cd\u65b0\u5b9a\u4e49\u3002\\n\\n\u4e3a\u4e86\u5c55\u793a\u5982\u4f55\u5f00\u53d1 Go \u63d2\u4ef6\uff0c\u6211\u4eec\u5148\u8bbe\u7f6e Apache  APISIX \u8fdb\u5165\u5f00\u53d1\u6a21\u5f0f\u3002\u5728 config.yaml \u4e2d\u589e\u52a0\u4ee5\u4e0b\u914d\u7f6e\uff1a\\n\\n```shell\\next-plugin:\\n  path_for_test: /tmp/runner.sock\\n```\\n\\n\u8fd9\u4e2a\u914d\u7f6e\u7684\u610f\u601d\u662f\uff0c\u547d\u4e2d\u8def\u7531\u89c4\u5219\u540e\uff0cApache APISIX \u4f1a\u5411 /tmp/runner.sock \u53d1\u8d77 RPC \u8bf7\u6c42\u3002\\n\\n\u63a5\u4e0b\u6765\u8bbe\u7f6e\u8def\u7531\u89c4\u5219\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n  \\"uri\\": \\"/get\\",\\n  \\"plugins\\": {\\n    \\"ext-plugin-pre-req\\": {\\n      \\"conf\\": [\\n        {\\"name\\":\\"say\\", \\"value\\":\\"{\\\\\\"body\\\\\\":\\\\\\"hello\\\\\\"}\\"}\\n      ]\\n    }\\n  },\\n  \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }\\n}\\n\'\\n```\\n\\n\u6ce8\u610f\u63d2\u4ef6\u540d\u79f0\u914d\u7f6e\u5728 `name` \u91cc\u9762\uff0c\u63d2\u4ef6\u914d\u7f6e\uff08\u7ecf JSON \u5e8f\u5217\u5316\u540e\uff09\u653e\u5728 `value` \u91cc\u9762\u3002\\n\\n\u5982\u679c\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u770b\u5230 Apache  APISIX \u7aef\u6709 `refresh cache and try again` \u7684 warning \u548c Runner \u7aef\u6709 `key not found` \u7684 warning\uff0c\u8fd9\u662f\u56e0\u4e3a\u914d\u7f6e\u7f13\u5b58\u4e0d\u4e00\u81f4\u5bfc\u81f4\u7684\u3002\u56e0\u4e3a\u5f00\u53d1\u72b6\u6001\u4e0b\uff0cRunner \u4e0d\u662f\u7531 Apache  APISIX \u7ba1\u7406\u7684\uff0c\u6240\u4ee5\u5185\u90e8\u72b6\u6001\u4f1a\u6709\u53ef\u80fd\u4e0d\u4e00\u81f4\u3002\u4e0d\u7528\u62c5\u5fc3\uff0cApache  APISIX \u4f1a\u91cd\u8bd5\u3002\\n\\n\u7136\u540e\u6211\u4eec\u8bf7\u6c42\u4e00\u4e0b\uff1acurl 127.0.0.1:9080/get\\n\\n```shell\\n$ curl http://127.0.0.1:9080/get\\nHTTP/1.1 200 OK\\nDate: Mon, 26 Jul 2021 11:16:11 GMT\\nContent-Type: text/plain; charset=utf-8\\nTransfer-Encoding: chunked\\nConnection: keep-alive\\nX-Resp-A6-Runner: Go\\nServer: APISIX/2.7\\n\\nhello\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u63a5\u53e3\u8fd4\u56de hello \u800c\u4e14\u6ca1\u6709\u8bbf\u95ee\u5230\u4efb\u4f55\u4e0a\u6e38\u3002\\n\\n### \u8bbe\u7f6e Apache APISIX\uff08\u8fd0\u884c\uff09\\n\\n\u8fd9\u91cc\u4ee5 go-runner \u4e3a\u4f8b\uff0c\u53ea\u9700\u628a\u8fd0\u884c\u547d\u4ee4\u884c\u914d\u7f6e\u5728 ext-plugin \u91cc\u5c31\u53ef\u4ee5\u8fd0\u884c\u4e86\uff1a\\n\\n```shell\\next-plugin:\\n  # path_for_test: /tmp/runner.sock\\n  cmd: [\\"/path/to/apisix-go-plugin-runner/go-runner\\", \\"run\\"]\\n```\\n\\nApache APISIX \u4f1a\u628a plugin runner \u4f5c\u4e3a\u81ea\u5df1\u7684\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u7ba1\u7406\u5b83\u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u3002\\n\\n\u6ce8\u610f\uff1a\u8fd9\u65f6\u5c31\u4e0d\u8981\u914d\u7f6e path_for_test \u4e86\u3002Apache APISIX \u5728\u542f\u52a8 runner \u65f6\u4f1a\u81ea\u52a8\u5206\u914d\u4e00\u4e2a unix socket \u5730\u5740\u4f9b runner \u76d1\u542c\u3002APISIX_LISTEN_ADDRESS \u548c APISIX_CONF_EXPIRE_TIME \u8fd9\u4e24\u4e2a\u73af\u5883\u53d8\u91cf\u4e5f\u4e0d\u7528\u624b\u52a8\u8bbe\u7f6e\u3002\\n\\n## \u603b\u7ed3\\n\\n\u76ee\u524d Go Plugin Runner \u8fd8\u5904\u4e8e\u65e9\u671f\u5f00\u53d1\u9636\u6bb5\uff0c\u6211\u4eec\u4f1a\u9646\u7eed\u5b8c\u5584\u5176\u529f\u80fd\u3002\u6210\u529f\u7684\u5f00\u6e90\u9879\u76ee\u79bb\u4e0d\u5f00\u5927\u5bb6\u7684\u8d21\u732e\uff0c\u6b22\u8fce\u5404\u4f4d\u53c2\u4e0e\u5230 apisix-go-plugin-runner \u7684\u5f00\u53d1\u4e2d\u6765\uff0c\u8ba9\u6211\u4eec\u4e00\u8d77\u5171\u5efa Apache  APISIX \u548c Go \u7684\u6865\u6881\uff01\\n\u70b9\u51fb\u8bbf\u95ee [apisix-go-plugin-runner](https://github.com/apache/apisix-go-plugin-runner).\\n\\n## \u76f8\u5173\u9605\u8bfb\\n\\n[\u5982\u4f55\u7528 Java \u7f16\u5199 Apache APISIX \u63d2\u4ef6](https://apisix.apache.org/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins)"},{"id":"Apache APISIX \u793e\u533a\u5468\u62a5\uff088.9-8.15\uff09","metadata":{"permalink":"/zh/blog/2021/08/19/weekly-report","source":"@site/blog/2021/08/19/weekly-report.md","title":"Apache APISIX \u793e\u533a\u5468\u62a5\uff088.9-8.15\uff09","description":"\u672c\u5468 Apache APISIX \u65b0\u589e\u4e86\u6d41\u91cf\u63a7\u5236\u7c7b\u63d2\u4ef6\u589e\u52a0\u964d\u7ea7\u5904\u7406\u3001log-rotate \u63d2\u4ef6\u652f\u6301\u538b\u7f29\u5df2\u5207\u5272\u7684\u65e5\u5fd7\u6587\u4ef6\u3001real-ip \u63d2\u4ef6\u53ca consumer-restriction \u652f\u6301\u6839\u636e Route \u5bf9\u8c61\u505a\u9650\u5236\u3002","date":"2021-08-19T00:00:00.000Z","formattedDate":"2021\u5e748\u670819\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":5.115,"truncated":true,"authors":[],"prevItem":{"title":"Go \u8ba9 Apache APISIX \u5982\u864e\u6dfb\u7ffc","permalink":"/zh/blog/2021/08/19/go-makes-apache-apisix-better"},"nextItem":{"title":"\u5728 APISIX \u4e2d\u4f7f\u7528 Casbin \u6388\u6743","permalink":"/zh/blog/2021/08/18/auth-with-casbin-in-apache-apisix"}},"content":"> \u672c\u5468\uff0c\u6709 26 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 96 \u4e2a commit \u3002\u611f\u8c22\u672c\u5468\u4ee5\u4e0b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff08\u6392\u540d\u4e0d\u5206\u5148\u540e\uff09\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u53d8\u5f97\u66f4\u597d\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5bfc\u8bed\\n\\n[Apache APISIX](https://github.com/apache/apisix) \u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4ee5\u793e\u533a\u65b9\u5f0f\u6210\u957f\uff0c\u8fc5\u901f\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\u3002\u8fd9\u4e9b\u6210\u5c31\uff0c\u79bb\u4e0d\u5f00\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u7684\u5171\u540c\u594b\u6597\u3002\\n\\n\u201c\u72ec\u884c\u8005\u901f\uff0c\u4f17\u884c\u8005\u8fdc\u201d\u3002Apache APISIX \u793e\u533a\u5468\u62a5\u5e0c\u671b\u53ef\u4ee5\u5e2e\u52a9\u793e\u533a\u5c0f\u4f19\u4f34\u4eec\u66f4\u597d\u5730\u638c\u63e1 Apache APISIX \u793e\u533a\u7684\u6bcf\u5468\u8fdb\u5c55\uff0c\u65b9\u4fbf\u5927\u5bb6\u53c2\u4e0e\u5230 Apache APISIX \u793e\u533a\u4e2d\u6765\u3002\\n\\n\u6211\u4eec\u8fd8\u6574\u7406\u4e86\u4e00\u4e9b\u9002\u5408\u65b0\u6765\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u53c2\u52a0\u7684 issue \uff01\u611f\u5174\u8da3\u7684\u540c\u5b66\u4eec\uff0c\u8d70\u8fc7\u8def\u8fc7\u4e0d\u8981\u9519\u8fc7\uff01\\n\\n## \u8d21\u732e\u8005\u7edf\u8ba1\\n\\n\u672c\u5468\uff0c\u6709 26 \u4f4d\u5f00\u53d1\u8005\u4e3a Apache APISIX \u63d0\u4ea4\u4e86 96 \u4e2a commit \u3002\u611f\u8c22\u672c\u5468\u4ee5\u4e0b\u5c0f\u4f19\u4f34\u4e3a Apache APISIX \u6dfb\u7816\u52a0\u74e6\uff08\u6392\u540d\u4e0d\u5206\u5148\u540e\uff09\uff0c\u662f\u4f60\u4eec\u7684\u65e0\u79c1\u4ed8\u51fa\uff0c\u8ba9 Apache APISIX \u53d8\u5f97\u66f4\u597d\uff01\\n\\n> juzhiyuan, Baoyuantop, spacewander, okaybase, liuxiran, Serendipity96, nic-chen, tao12345666333, shuaijinchao, Yiyiyimu, jbampton, tzssangglass, foolwc, dickens7, Xunzhuo, jagerzhang, tong3jie, sunhao-java, gxthrj, chzhuo, qsliu2017, bisakhmondal, LiteSun, wmdmomo, Ylikj, bzp2010\\n\\n## Good first issue\\n\\n### Issue #4800\\n\\n\u94fe\u63a5\uff1ahttps://github.com/apache/apisix/issues/4800  \\n**\u95ee\u9898\u63cf\u8ff0**\uff1aAdmin API \u4e2d\u5173\u4e8e\u521b\u5efa Route \u5165\u53c2 (vars) \u7684\u63cf\u8ff0\u6709\u9519\u8bef.\\n![issue](/img/event_img/issue_photo.png)\\n**\u89e3\u51b3\u65b9\u6848**\uff1a\u5728 json \u4e2d\uff0c\u65b9\u62ec\u53f7\u8868\u793a\u6570\u7ec4\uff0c\u800c\u82b1\u62ec\u53f7\u8868\u793a\u5bf9\u8c61\u3002\u8fd9\u91cc\u660e\u663e\u662f\u60f3\u8868\u8ff0\u662f\u6570\u7ec4\u5d4c\u5957\u6570\u7ec4\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u7528\u4e24\u4e2a\u82b1\u62ec\u53f7\u5728 json \u91cc\u9762\u662f\u9519\u8bef\u7684\u4e66\u5199\u65b9\u5f0f\u3002\u6240\u4ee5\u8fd9\u91cc\u5e94\u8be5\u662f\u65b9\u62ec\u53f7\u3002\\n\\n```json\\n[\\n  [\\"arg_name\\", \\"==\\", \\"json\\"],\\n  [\\"arg_age\\", \\">\\", 18]\\n]\\n```\\n\\n#### Issue #4441\\n\\n\u94fe\u63a5\uff1ahttps://github.com/apache/apisix/issues/4441\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a\u73b0\u5728 APISIX stream_routes \u7684\u53c2\u6570 \\"remote_addr\\"\u53ea\u652f\u6301\u5355\u4e2a ip\uff0c\u9700\u8981\u652f\u6301\u591a\u4e2a ip \u6216\u8005\u50cf \\"192.168.0.0/16 \\"\u8fd9\u6837\u7684\u5339\u914d\u89c4\u5219\uff0c\u5c31\u50cf http \u8def\u7531\u53c2\u6570 \\"remote_addr\\"\u4e00\u6837\u3002\\n\\n**\u89e3\u51b3\u65b9\u6848**\uff1a\u4e3a APISIX stream_routes \u7684 \\"remote_addr\\"\u53c2\u6570\u652f\u6301\u591a\u4e2a ip \u5730\u5740\u6216\u5339\u914d\u89c4\u5219\uff0c\u5982 \\"192.168.0.0/16\\"\\n\\n\u76f8\u5173\u7cfb\u7edf\u53c2\u6570\uff1a\\n\\n- apisix version (cmd: `apisix version`): 2.6\\n- OS (cmd: `uname -a`): CentOS7\\n\\n#### Issue #3931\\n\\n\u94fe\u63a5\uff1ahttps://github.com/apache/apisix/issues/3931\\n\\n**\u95ee\u9898\u63cf\u8ff0**\uff1a \u91cd\u5b9a\u5411\u63d2\u4ef6\u4e2d\u7684 http_to_https \u7f3a\u4e4f curl \u6d4b\u8bd5\\n\\n**\u89e3\u51b3\u65b9\u6848**\uff1a\u4e3a\u91cd\u5b9a\u5411\u63d2\u4ef6\u4e2d\u7684 http_to_https \u6dfb\u52a0 curl \u6d4b\u8bd5\\n\\n\u66f4\u65b0\u6587\u6863 http://apisix.apache.org/docs/apisix/plugins/redirect\\n\\n## \u672c\u5468\u529f\u80fd\u7279\u6027\u4eae\u70b9\\n\\n- **request-id \u63d2\u4ef6\u652f\u6301\u96ea\u82b1\u7b97\u6cd5\u751f\u6210 ID**  \\n  **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4559  \\n  **\u8d21\u732e\u8005**\uff1a[dickens7](https://github.com/dickens7)\\n\\n- **\u6d41\u91cf\u63a7\u5236\u7c7b\u63d2\u4ef6\u589e\u52a0\u964d\u7ea7\u5904\u7406**  \\n  **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4774  \\n  **\u8d21\u732e\u8005**\uff1a[okaybase](https://github.com/okaybase)\\n\\n- **log-rotate \u63d2\u4ef6\u652f\u6301\u538b\u7f29\u5df2\u5207\u5272\u7684\u65e5\u5fd7\u6587\u4ef6**  \\n  **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4795  \\n  **\u8d21\u732e\u8005**\uff1a[okaybase](https://github.com/okaybase)\\n\\n- **real-ip \u63d2\u4ef6\u5b9e\u73b0\u7b2c\u4e00\u4e2a\u7248\u672c**  \\n  **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4813  \\n  **\u8d21\u732e\u8005**\uff1a[spacewander](https://github.com/spacewander)\\n\\n- **consumer-restriction \u652f\u6301\u6839\u636e Route \u5bf9\u8c61\u505a\u9650\u5236**  \\n  **\u76f8\u5173 PR**\uff1ahttps://github.com/apache/apisix/pull/4759  \\n  **\u8d21\u732e\u8005**\uff1a[jagerzhang](https://github.com/jagerzhang)\\n\\nApache APISIX \u7684[\u9879\u76ee\u5b98\u7f51](https://apisix.apache.org/)\u548c Github \u4e0a\u7684 [issue](https://github.com/apache/apisix/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc) \u4e0a\u5df2\u7ecf\u79ef\u7d2f\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u6587\u6863\u6559\u7a0b\u548c\u4f7f\u7528\u7ecf\u9a8c\uff0c\u5982\u679c\u60a8\u9047\u5230\u95ee\u9898\u53ef\u4ee5\u7ffb\u9605\u6587\u6863\uff0c\u7528\u5173\u952e\u8bcd\u5728 issue \u4e2d\u641c\u7d22\uff0c\u4e5f\u53ef\u4ee5\u53c2\u4e0e issue \u4e0a\u7684\u8ba8\u8bba\uff0c\u63d0\u51fa\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u8df5\u7ecf\u9a8c\u3002\\n\\n## \u672c\u5468\u535a\u6587\u63a8\u8350\\n\\n- [8 \u6708 21 \u65e5 Apache APISIX Meetup \u4e0a\u6d77\u7ad9\uff0c\u6b22\u8fce\u62a5\u540d\u53c2\u52a0\uff01](https://mp.weixin.qq.com/s/YIoc7XlgZIq0V-CyTDD2VA)  \\n  \u672c\u6b21 Meetup \u7531 API7.AI \u53d1\u8d77\uff0c\u5e76\u9080\u8bf7\u7231\u5947\u827a\u3001\u7a7a\u4e2d\u4e91\u6c47\u7b49\u5408\u4f5c\u4f19\u4f34\u5171\u540c\u4e3a\u5927\u5bb6\u5448\u73b0\u3002Apache APISIX PMC \u6210\u5458\u3001\u8d21\u732e\u8005\u3001\u793e\u533a\u6280\u672f\u4e13\u5bb6\u6c47\u805a\u4e00\u5802\uff0c\u5171\u540c\u63a2\u8ba8 Apache APISIX \u793e\u533a\u53d1\u5c55\u3001\u884c\u4e1a\u5b9e\u8df5\u7b49\u8bdd\u9898\u3002\\n\\n- [\u4ece\u65b0\u624b\u6751\u51fa\u6765\uff0c\u6211\u5728 Apache APISIX \u793e\u533a\u53d1\u51fa\u4e86\u7b2c\u4e00\u4e2a PR](https://mp.weixin.qq.com/s/pyfBAHONGjkKJhwsjyhdUA)  \\n  \u5c60\u6b63\u677e\u540c\u5b66\u7684\u91c7\u8bbf\u6587\u7ae0\uff0c\u4e0b\u56de\u6211\u4eec\u4f1a\u91c7\u8bbf\u54ea\u4f4d\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u5462\uff1f\u5feb\u6765 Apache APISIX \u793e\u533a\u77a7\u4e00\u77a7\u5427\uff01\u6ca1\u51c6\uff0c\u4e0b\u4e00\u4f4d committer \u5c31\u662f\u4f60\uff01\\n\\n- [\u820d\u5f03 Kong \u548c Nginx\uff0cApache APISIX \u5728\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u7684\u843d\u5730\u5b9e\u8df5](https://mp.weixin.qq.com/s/oARDFf_48X99MXBwoXcSHw)  \\n  \u4ecb\u7ecd\u4e86 Apache APISIX \u5728\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u4e2d\u7684\u843d\u5730\u5b9e\u8df5\u60c5\u51b5\uff0c\u4ee5\u53ca\u8da3\u94fe\u79d1\u6280\u5728\u4f17\u591a\u7f51\u5173\u5e94\u7528\u4e2d\u9009\u62e9 Apache APISIX \u7684\u539f\u56e0\u3002\\n\\n- [\u8d21\u732e\u8005\uff0c\u662f\u8861\u91cf\u5f00\u6e90\u9879\u76ee\u7684\u91d1\u6307\u6807](https://mp.weixin.qq.com/s/G1lQUdZ05_HlZLNcY9tflw)  \\n  \u79c9\u627f The Apache Way\uff0c\u6211\u4eec\u76f8\u4fe1\uff0c\u53ea\u6709\u6d3b\u8dc3\u7684\u793e\u533a\u624d\u80fd\u4fdd\u8bc1\u5f00\u6e90\u9879\u76ee\u7684\u672a\u6765\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u5e0c\u671b\u53ef\u4ee5\u901a\u8fc7\u66f4\u52a0\u76f4\u89c2\u7684\u56fe\u8868\u6765\u5c55\u793a\u793e\u533a\u6d3b\u8dc3\u5ea6\u3002"},{"id":"2021/08/18/auth-with-casbin-in-apache-apisix","metadata":{"permalink":"/zh/blog/2021/08/18/auth-with-casbin-in-apache-apisix","source":"@site/blog/2021/08/18/Auth-with-Casbin-in-Apache-APISIX.md","title":"\u5728 APISIX \u4e2d\u4f7f\u7528 Casbin \u6388\u6743","description":"\u5f53\u4f60\u5728\u4f7f\u7528 API \u7f51\u5173 Apache APISIX \u65f6\uff0c\u53ef\u80fd\u9700\u8981\u6dfb\u52a0\u590d\u6742\u7684\u6388\u6743\u903b\u8f91\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 APISIX \u7684\u5185\u7f6e Casbin \u63d2\u4ef6\uff08authz-casbin\uff09\u6765\u5b9e\u73b0\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff08RBAC\uff09\u6a21\u578b\u3002","date":"2021-08-18T00:00:00.000Z","formattedDate":"2021\u5e748\u670818\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"},{"label":"Plugins","permalink":"/zh/blog/tags/plugins"}],"readingTime":7.29,"truncated":true,"authors":[{"name":"Casbin \u793e\u533a & Apache APISIX \u793e\u533a"}],"prevItem":{"title":"Apache APISIX \u793e\u533a\u5468\u62a5\uff088.9-8.15\uff09","permalink":"/zh/blog/2021/08/19/weekly-report"},"nextItem":{"title":"Apache APISIX \u5728 Airwallex \u7684\u5e94\u7528 | \u4e13\u8bbf Airwallex \u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\u674e\u6768","permalink":"/zh/blog/2021/08/17/interview-airwallex"}},"content":"> \u5f53\u6211\u4eec\u5728\u4f7f\u7528 Apache APISIX \u65f6\uff0c\u53ef\u80fd\u60f3\u8981\u5728\u5e94\u7528\u91cc\u6dfb\u52a0\u590d\u6742\u7684\u6388\u6743\u903b\u8f91\u3002\u5728\u6b64\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 Apache APISIX \u7684\u5185\u7f6e Casbin \u63d2\u4ef6\uff08authz-casbin\uff09\u6765\u5b9e\u73b0\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff08RBAC\uff09\u6a21\u578b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u4ecb\u7ecd\\n\\n### Apache APISIX\\n\\n[Apache APISIX](https://github.com/apache/apisix) \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c \u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u7cbe\u7ec6\u5316\u8def\u7531\u3001\u9650\u6d41\u9650\u901f\u3001\u670d\u52a1\u964d\u7ea7\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u6570\u767e\u9879\u529f\u80fd\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 Apache APISIX \u6765\u5904\u7406\u4f20\u7edf\u7684\u5357\u5317\u5411\u6d41\u91cf\uff0c\u4ee5\u53ca\u670d\u52a1\u95f4\u7684\u4e1c\u897f\u5411\u6d41\u91cf\uff0c \u4e5f\u53ef\u4ee5\u5f53\u505a [k8s ingress controller](https://github.com/apache/apisix-ingress-controller) \u6765\u4f7f\u7528\u3002\\n\\n### Casbin\\n\\n[Casbin](https://casbin.org/zh-CN/) \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u3001\u9ad8\u6548\u7684\u5f00\u6e90\u8bbf\u95ee\u63a7\u5236\u6846\u67b6\uff0c\u5176\u6743\u9650\u7ba1\u7406\u673a\u5236\u652f\u6301\u591a\u79cd\u8bbf\u95ee\u63a7\u5236\u6a21\u578b\u3002\\n\\n### authz-casbin \u63d2\u4ef6\u4ecb\u7ecd\\n\\n\u5728 Apache APISIX \u7684\u4f7f\u7528\u4e2d\uff0c\u8def\u7531\u5339\u914d\u548c\u8bf7\u6c42\u6388\u6743\u4e4b\u95f4\u6709\u4e2a\u9690\u542b\u7684\u77db\u76fe\u70b9\uff1a\u4e3a\u4e86\u66f4\u9ad8\u7ec6\u7c92\u5ea6\u7684\u6743\u9650\u63a7\u5236\uff0c\u9700\u8981\u914d\u7f6e\u66f4\u9ad8\u7ec6\u7c92\u5ea6\u7684\u8def\u7531\uff0c\u6765\u7cbe\u51c6\u8bc6\u522b\u8bf7\u6c42\u5e76\u5bf9\u8bf7\u6c42\u8fdb\u884c\u6388\u6743\u3002\u5728\u590d\u6742\u7684\u6388\u6743\u6a21\u578b\u573a\u666f\u4e0b\uff0c\u8fd9\u5c06\u5bfc\u81f4\u8def\u7531\u6570\u91cf\u6210\u500d\u589e\u52a0\uff0c\u52a0\u5267\u4e86\u8fd0\u7ef4\u590d\u6742\u5ea6\u3002\\n[authz-casbin](https://github.com/apache/apisix/blob/d9b928321fcdd12eef024df8c7c410424c1e0c8b/docs/en/latest/plugins/authz-casbin.md) \u662f\u4e00\u4e2a\u57fa\u4e8e lua-casbin \u7684 Apache APISIX \u63d2\u4ef6\uff0c\u652f\u6301\u57fa\u4e8e\u5404\u79cd\u8bbf\u95ee\u6a21\u578b\u7684\u5f3a\u5927\u6388\u6743\u3002Casbin \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u3001\u9ad8\u6548\u7684\u5f00\u6e90\u8bbf\u95ee\u63a7\u5236\u6846\u67b6\uff0c\u652f\u6301 ACL\u3001RBAC\u3001ABAC \u7b49\u8bbf\u95ee\u63a7\u5236\u6a21\u578b\uff0clua-casbin \u662f Casbin \u8bbf\u95ee\u63a7\u5236\u6846\u67b6\u7684 Lua \u7248\u672c\u5b9e\u73b0\u3002\\nauthz-casbin \u63d2\u4ef6\u53ef\u4ee5\u628a\u8def\u7531\u5339\u914d\u548c\u8bf7\u6c42\u6388\u6743\u8fd9\u4e24\u4e2a\u529f\u80fd\u5f88\u597d\u5730\u8fdb\u884c\u89e3\u8026\uff0c\u4f60\u53ef\u4ee5\u5c06\u5404\u79cd\u6388\u6743\u8bbf\u95ee\u6a21\u578b\u52a0\u8f7d\u5230 Apache APISIX \u4e2d\uff0c\u501f\u52a9 lua-casbin \u5b9e\u73b0\u9ad8\u6548\u590d\u6742\u7684\u6388\u6743\u6a21\u5f0f\u3002\\n\\n**\u6ce8\u610f**\uff1a\u5982\u679c\u4f60\u60f3\u8981\u5b9e\u73b0\u8eab\u4efd\u9a8c\u8bc1\uff08authentication\uff09\uff0c\u4f60\u9700\u8981\u4f7f\u7528\u5176\u4ed6\u63d2\u4ef6\u6216\u8005\u81ea\u5df1\u6765\u914d\u7f6e\u5b8c\u6210\u9a8c\u8bc1\u7528\u6237\u8eab\u4efd\uff0c\u6bd4\u5982 [jwt-auth](https://github.com/apache/apisix/blob/master/docs/zh/latest/plugins/jwt-auth.md) \u63d2\u4ef6\u3002\\n\\n## authz-casbin \u4f7f\u7528\u6307\u5357\\n\\n### \u521b\u5efa\u4e00\u4e2a\u6a21\u578b\\n\\nauthz-casbin \u63d2\u4ef6\u4f7f\u7528\u4e09\u4e2a\u53c2\u6570\u6765\u8fdb\u884c\u6388\u6743\uff1asubject\u3001object \u548c action\u3002subject \u662f\u7528\u6237\u540d\uff0c\u4ee3\u6307\u8bf7\u6c42\u4e2d\u7684\u7528\u6237\uff1bobject \u662f\u5c06\u8981\u88ab\u8bbf\u95ee\u7684 URL \u94fe\u63a5\u4e5f\u5c31\u662f\u5c06\u88ab\u8bbf\u95ee\u7684\u8d44\u6e90\uff1baction \u662f\u8bf7\u6c42\u6388\u6743\u7684\u884c\u4e3a\uff0c\u6bd4\u5982\u8bfb\u64cd\u4f5c\uff08read\uff09\u6216\u8005\u662f\u5199\u64cd\u4f5c\uff08write\uff09\u3002\\n\u5047\u5982\uff0c\u6211\u4eec\u60f3\u8981\u521b\u5efa\u4e00\u4e2a\u6a21\u578b\u6765\u8bbf\u95ee\u4e09\u4e2a\u8d44\u6e90\uff1a/\uff0c/res1\uff0c/res2\uff0c\u6211\u4eec\u60f3\u8981\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u8fd9\u6837\u7684\u6a21\u578b\uff1a\\n\\n![authz-casbin example](https://static.apiseven.com/202108/1639467795044-8676c5cb-00e0-48e1-b7b1-929e37c87b75.png)\\n\\n\u5728\u8fd9\u4e2a\u6a21\u578b\u4e2d\uff0c\u6240\u6709\u7684\u7528\u6237\uff0c\u4f8b\u5982 Jack\uff0c\u53ef\u4ee5\u8bbf\u95ee\u4e3b\u9875\u9762\uff08/\uff09\u3002\u800c\u50cf Alice \u548c Bob \u5177\u6709\u7ba1\u7406\u5458\u6743\u9650\u7684\u7528\u6237\u5219\u53ef\u4ee5\u8bbf\u95ee\u6240\u6709\u7684\u9875\u9762\u548c\u8d44\u6e90\uff08/res1\uff0c/res2\uff0c/\uff09\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u9700\u8981\u6765\u9650\u5236\u6ca1\u6709\u7ba1\u7406\u5458\u6743\u9650\u7684\u7528\u6237\u53ea\u80fd\u4f7f\u7528 GET \u8bf7\u6c42\u65b9\u6cd5\u8bbf\u95ee\u7279\u5b9a\u7684\u8d44\u6e90\u3002\u6240\u9700\u8981\u7684\u6a21\u578b\u5982\u4e0b\uff1a\\n\\n```shell\\n[request_definition]\\nr = sub, obj, act\\n\\n[policy_definition]\\np = sub, obj, act\\n\\n[role_definition]\\ng = _, _\\n\\n[policy_effect]\\ne = some(where (p.eft == allow))\\n\\n[matchers]\\nm = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) && keyMatch(r.obj, p.obj) && keyMatch(r.act, p.act)\\n```\\n\\n### \u521b\u5efa\u4e00\u6761\u7b56\u7565\\n\\n\u4ece\u4e0a\u8ff0\u7684\u4f8b\u5b50\u6765\u770b\uff0c\u7b56\u7565\u5e94\u8be5\u50cf\u662f\u8fd9\u6837\u7684\uff1a\\n\\n```shell\\np, *, /, GET\\np, admin, *, *\\ng, alice, admin\\ng, bob,admin\\n```\\n\\n\u6a21\u578b\u91cc\u7684 matcher \u8868\u660e\uff1a\\n\\n1. `(g(r.sub, p.sub) || keyMatch(r.sub, p.sub))`\uff1a\u8bf7\u6c42\u91cc\u7684 subject \u548c\u7b56\u7565\u91cc\u7684 subject \u6709\u7740\u76f8\u540c\u7684\u89d2\u8272\u6216\u8005\u8bf7\u6c42\u91cc\u7684 subject \u548c\u7b56\u7565\u91cc\u7684 subject \u53ef\u4ee5\u901a\u8fc7\u5185\u7f6e\u7684\u65b9\u6cd5 `keyMatch` \u5339\u914d\u3002`keyMatch` \u4f5c\u4e3a Lua Casbin \u7684\u5185\u7f6e\u51fd\u6570\uff0c\u76f8\u5173\u7684\u63cf\u8ff0\u4ee5\u53ca\u66f4\u591a\u7684\u51fd\u6570\u53ef\u8df3\u8f6c [lua-casbin](https://github.com/casbin/lua-casbin/blob/master/src/util/BuiltInFunctions.lua)\u3002\\n2. `keyMatch(r.obj, p.obj)`\uff1a\u8bf7\u6c42\u91cc\u7684 object \u548c\u7b56\u7565\u91cc\u7684 object \u53ef\u76f8\u4e92\u5339\u914d\uff08\u4ee3\u6307 URL \u94fe\u63a5\uff09\u3002\\n3. `keyMatch(r.act, p.act)`\uff1a\u8bf7\u6c42\u91cc\u7684 action \u548c\u7b56\u7565\u91cc\u7684 action \u53ef\u76f8\u4e92\u5339\u914d\uff08\u4ee3\u6307 HTTP \u8bf7\u6c42\u65b9\u6cd5\uff09\u3002\\n\\n### \u5728\u8def\u7531\u4e0a\u4f7f\u7528\u63d2\u4ef6\\n\\n\u4e00\u65e6\u4f60\u521b\u5efa\u4e86\u6a21\u578b\u548c\u7b56\u7565\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 APISIX Admin API \u5728\u8def\u7531\u4e0a\u4f7f\u7528\u3002\u82e5\u60f3\u4f7f\u7528\uff0c\u4f60\u53ef\u4ee5\u6a21\u578b\u548c\u7b56\u7565\u7684\u6587\u4ef6\u8def\u5f84\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"authz-casbin\\": {\\n            \\"model_path\\": \\"/path/to/model.conf\\",\\n            \\"policy_path\\": \\"/path/to/policy.csv\\",\\n            \\"username\\": \\"user\\"\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"uri\\": \\"/*\\"\\n}\'\\n```\\n\\n\u5728\u8fd9\u91cc\uff0cusername \u662f\u4f20\u9012\u5230 subject \u91cc\u7684\u7528\u6237\u540d\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u8bbe\u7f6e`\\"username\\":\\"user\\"`\u6765\u628a\u4f60\u5b9a\u4e49\u7684`\\"user\\":\\"alice\\"`\u4f20\u9012\u5230 username \uff0c\u8ba9 username \u6210\u4e3a Alice\u3002\\n\u540c\u6837\uff0c\u4f60\u53ef\u4ee5\u5c06\u6a21\u578b\u548c\u7b56\u7565\u76f4\u63a5\u653e\u5230\u91cc\u9762\uff1a\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"authz-casbin\\": {\\n            \\"model\\": \\"[request_definition]\\n            r = sub, obj, act\\n\\n            [policy_definition]\\n            p = sub, obj, act\\n\\n            [role_definition]\\n            g = _, _\\n\\n            [policy_effect]\\n            e = some(where (p.eft == allow))\\n\\n            [matchers]\\n            m = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) && keyMatch(r.obj, p.obj) && keyMatch(r.act, p.act)\\",\\n\\n            \\"policy\\": \\"p, *, /, GET\\n            p, admin, *, *\\n            g, alice, admin\\",\\n\\n            \\"username\\": \\"user\\"\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"uri\\": \\"/*\\"\\n}\'\\n```\\n\\n### \u5229\u7528\u5168\u5c40\u6a21\u578b/\u7b56\u7565\u4f7f\u7528\u63d2\u4ef6\\n\\n\u5728\u4e00\u4e9b\u60c5\u5f62\u4e2d\uff0c\u4f60\u53ef\u80fd\u60f3\u8981\u5728\u591a\u4e2a\u8def\u7531\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u6a21\u578b\u548c\u7b56\u7565\uff0c\u4f60\u53ef\u4ee5\u9996\u5148\u53d1\u9001\u4e00\u4e2a PUT \u8bf7\u6c42\u5c06\u6a21\u578b\u548c\u7b56\u7565\u7684\u914d\u7f6e\u53d1\u9001\u5230\u63d2\u4ef6\u7684\u5143\u6570\u636e\uff1a\\n\\n```shell\\ncurl <http://127.0.0.1:9080/apisix/admin/plugin_metadata/authz-casbin> -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -i -X PUT -d \'\\n{\\n\\"model\\": \\"[request_definition]\\nr = sub, obj, act\\n[policy_definition]\\np = sub, obj, act\\n[role_definition]\\ng = _, _\\n[policy_effect]\\ne = some(where (p.eft == allow))\\n[matchers]\\nm = (g(r.sub, p.sub) || keyMatch(r.sub, p.sub)) && keyMatch(r.obj, p.obj) && keyMatch(r.act, p.act)\\",\\n\\"policy\\": \\"p, *, /, GET\\np, admin, *, *\\ng, alice, admin\\ng, bob, admin\\"\\n}\'\\n```\\n\\n\u7136\u540e\uff0c\u4f60\u9700\u8981\u4f7f\u7528 Admin API \u6765\u53d1\u9001\u8bf7\u6c42\u4f7f\u5f97\u591a\u4e2a\u8def\u7531\u4f7f\u7528\u76f8\u540c\u7684\u6a21\u578b/\u7b56\u7565\u914d\u7f6e\uff1b\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"plugins\\": {\\n        \\"authz-casbin\\": {\\n            \\"username\\": \\"user\\"\\n        }\\n    },\\n    \\"upstream\\": {\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        },\\n        \\"type\\": \\"roundrobin\\"\\n    },\\n    \\"uri\\": \\"/*\\"\\n}\'\\n```\\n\\n\u8fd9\u5c06\u4f1a\u5c06\u63d2\u4ef6\u7684\u914d\u7f6e\u52a8\u6001\u5730\u6dfb\u52a0\u5230\u8def\u7531\u4e2d\u3002\u901a\u8fc7\u5411\u63d2\u4ef6\u7684\u914d\u7f6e\u6570\u636e\u4e2d\u53d1\u9001\u66f4\u65b0\u6a21\u578b\u548c\u7b56\u7565\u7684\u8bf7\u6c42\uff0c\u4f60\u53ef\u4ee5\u8f7b\u677e\u5730\u66f4\u65b0\u63d2\u4ef6\u7684\u914d\u7f6e\u3002\\n\\n## \u6700\u540e\\n\\n\u611f\u8c22 Casbin \u548c Apache APISIX \u793e\u533a\u7684\u5f00\u53d1\u8005\u4eec\uff0c\u4ece Casbin \u793e\u533a\u7684\u5f00\u53d1\u8005 rushitote \u63d0\u51fa issue\uff0c\u63d0\u4ea4 PR\uff0c\u5230 Apache APISIX \u793e\u533a\u7684\u5f00\u53d1\u8005\u4eec\u79ef\u6781\u5730 review PR\uff0c\u8fd9\u4e2a\u8de8\u793e\u533a\u7684\u5408\u4f5c\u53cb\u597d\u800c\u6709\u5e8f\u5730\u5411\u524d\u63a8\u8fdb\uff0c\u54cd\u5e94 open source makes world better\u3002\\n\\n\u6765\u6e90\uff1a[authorization-in-apisix-using-casbin](https://medium.com/@rushitote/authorization-in-apisix-using-casbin-59b693669d6d)"},{"id":"Apache APISIX \u5728 Airwallex \u7684\u5e94\u7528 | \u4e13\u8bbf Airwallex \u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\u674e\u6768","metadata":{"permalink":"/zh/blog/2021/08/17/interview-airwallex","source":"@site/blog/2021/08/17/interview-airwallex.md","title":"Apache APISIX \u5728 Airwallex \u7684\u5e94\u7528 | \u4e13\u8bbf Airwallex \u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\u674e\u6768","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 Airwallex \u7a7a\u4e2d\u4e91\u6c47\u5728\u505a\u6280\u672f\u9009\u578b\u65f6\u4e3a\u4ec0\u4e48\u9009\u62e9\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX\u4ee5\u53ca APISIX \u5728 Airwallex \u7a7a\u4e2d\u4e91\u6c47\u7684\u4f7f\u7528\u573a\u666f\u548c\u751f\u4ea7\u73af\u5883\u7684\u8868\u73b0\u7b49\u5185\u5bb9\u3002","date":"2021-08-17T00:00:00.000Z","formattedDate":"2021\u5e748\u670817\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":11.45,"truncated":true,"authors":[{"name":"Apache APISIX \u793e\u533a"}],"prevItem":{"title":"\u5728 APISIX \u4e2d\u4f7f\u7528 Casbin \u6388\u6743","permalink":"/zh/blog/2021/08/18/auth-with-casbin-in-apache-apisix"},"nextItem":{"title":"\u8d21\u732e\u8005\uff0c\u662f\u8861\u91cf\u5f00\u6e90\u9879\u76ee\u7684\u91d1\u6307\u6807","permalink":"/zh/blog/2021/08/14/contributors-the-golden-metric-of-opensource-projects"}},"content":"> \u672c\u6587\u91c7\u8bbf\u4e86 Airwallex \u7a7a\u4e2d\u4e91\u6c47 Technical Platform Lead \u674e\u6768\uff0c\u674e\u6768\u8d1f\u8d23\u516c\u53f8\u6280\u672f\u5e73\u53f0\u7684\u6f14\u8fdb\u3002\u91c7\u8bbf\u4e2d\u8be6\u7ec6\u4ecb\u7ecd\u4e86 Airwallex \u7a7a\u4e2d\u4e91\u6c47\u5728\u505a\u6280\u672f\u9009\u578b\u65f6\u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX\u3001Apache APISIX \u5728 Airwallex \u7a7a\u4e2d\u4e91\u6c47\u7684\u4f7f\u7528\u573a\u666f\u3001Apache APISIX \u5728\u751f\u4ea7\u73af\u5883\u7684\u8868\u73b0\u7b49\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u6211\u4eec\u6709\u5e78\u91c7\u8bbf\u5230\u4e86 Airwallex \u7684\u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\u674e\u6768\uff0c\u5728\u91c7\u8bbf\u4e2d\uff0c\u674e\u6768\u8c08\u5230\u4e86\u4e3a\u4ec0\u4e48\u5728\u6280\u672f\u9009\u578b\u65f6\u9009\u62e9 Apache APISIX\uff0c\u4ee5\u53ca Apache APISIX \u5728 Airwallex \u7684\u5e94\u7528\u3002\\n\\n**Q\uff1a\u674e\u535a\u58eb\uff0c\u60a8\u597d\uff0c\u8bf7\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1\u548c\u76ee\u524d\u4ece\u4e8b\u7684\u5de5\u4f5c\u3002**\\n\\n**\u674e\u6768\uff1a** \u4f60\u597d\uff0c\u6211\u53eb\u674e\u6768\uff08Jan Li\uff09\uff0c\u54f2\u5b66\u535a\u58eb\uff0cApache APISIX Committer\uff0cAirwallex \u7a7a\u4e2d\u4e91\u6c47 Technical Platform Lead\uff0c\u8d1f\u8d23\u516c\u53f8\u6280\u672f\u5e73\u53f0\u7684\u6f14\u8fdb\u3002\u5728\u52a0\u5165 Airwallex \u4e4b\u524d\uff0c\u66fe\u5728\u4e07\u5411\u533a\u5757\u94fe\u9886\u5bfc\u8fd0\u94fe\u76df\u3002\u5728\u4e07\u5411\u533a\u5757\u94fe\u4e4b\u524d\uff0c\u66fe\u5728\u82b1\u65d7\u96c6\u56e2\u9886\u5bfc OTC \u884d\u751f\u54c1\u98ce\u63a7\u5e73\u53f0\u3002\\n\\nAirwallex \u7a7a\u4e2d\u4e91\u6c47\u662f\u4e00\u5bb6\u5168\u7403\u91d1\u878d\u79d1\u6280\u516c\u53f8\uff0c\u8d4b\u80fd\u5404\u7c7b\u89c4\u6a21\u7684\u4f01\u4e1a\u8de8\u5883\u8fd0\u8425\uff0c\u4ee5\u6b64\u52a9\u529b\u5168\u7403\u7ecf\u6d4e\u53d1\u5c55\u3002\u4ee5\u6280\u672f\u4e3a\u6838\u5fc3\uff0cAirwallex\uff08\u7a7a\u4e2d\u4e91\u6c47\uff09\u6784\u5efa\u4e86\u4e13\u6709\u7684\u5168\u7403\u91d1\u878d\u57fa\u7840\u8bbe\u65bd\u5e73\u53f0\uff0c\u5168\u7403\u652f\u4ed8\u7f51\u7edc\u5df2\u8986\u76d6 130 \u591a\u4e2a\u56fd\u5bb6\u548c\u5730\u533a\u7684 50 \u4f59\u79cd\u8d27\u5e01\uff0c\u4e3a\u5404\u7c7b\u89c4\u6a21\u7684\u4f01\u4e1a\u63d0\u4f9b\u6570\u5b57\u5316\u7684\u91d1\u878d\u79d1\u6280\u4ea7\u54c1\uff0c\u5728\u5168\u7403\u4e92\u8054\u7684\u4fe1\u606f\u5316\u65f6\u4ee3\uff0c\u4ee5\u66f4\u9ad8\u6548\u3001\u5b89\u5168\u7684\u65b9\u5f0f\u5e2e\u52a9\u4f01\u4e1a\u5728\u5168\u4e16\u754c\u9ad8\u901f\u53d1\u5c55\u3002\u81ea 2015 \u5e74\u6210\u7acb\u4ee5\u6765\uff0cAirwallex \u7a7a\u4e2d\u4e91\u6c47\u5df2\u83b7\u5f97\u6765\u81ea\u9876\u7ea7\u6295\u8d44\u673a\u6784\u8d85 5 \u4ebf\u7f8e\u5143\u878d\u8d44\uff0c\u76ee\u524d\u5728\u5168\u7403\u5171\u6709 12 \u4e2a\u529e\u516c\u5ba4\u53ca\u8d85\u8fc7 900 \u540d\u5458\u5de5\u3002\\n\\n![Airwallex LiYang](https://static.apiseven.com/202108/20210816001.png)\\n\\n**Q\uff1a\u5728\u505a\u6280\u672f\u9009\u578b\u7684\u65f6\u5019\uff0c\u662f\u4ec0\u4e48\u539f\u56e0\u8ba9\u60a8/\u60a8\u7684\u6280\u672f\u56e2\u961f\u9009\u62e9\u4f7f\u7528 Apache APISIX\uff1f**\\n\\n**\u674e\u6768**\uff1aAPI \u7f51\u5173\u662f\u6781\u5176\u91cd\u8981\u7684\u57fa\u7840\u6280\u672f\u7ec4\u4ef6\uff0c\u5728\u6280\u672f\u9009\u578b\u65f6\u6211\u4eec\u4e3b\u8981\u4ece 6 \u4e2a\u7ef4\u5ea6\u6bd4\u8f83\u4e86\u4e3b\u8981\u7684\u7f51\u5173\u4ea7\u54c1\uff1a\\n\\n- **\u7a33\u5b9a\u6027**\uff1aAPI \u7f51\u5173\u7684\u7a33\u5b9a\u6027\u81f3\u5173\u91cd\u8981\uff0c\u5728\u4e16\u754c\u6392\u540d\u524d 1000 \u7684\u7f51\u7ad9\u4e2d\uff0c\u6709 62.1% \u662f Nginx \u7cfb\u7684\uff0c\u8fd9\u8bf4\u660e Nginx \u7cfb web server \u662f\u7ecf\u8fc7\u4e86\u751f\u4ea7\u73af\u5883\u590d\u6742\u591a\u6837\u573a\u666f\u8003\u9a8c\u7684\uff1bApache APISIX \u5168\u52a8\u6001\u7684\u8bbe\u8ba1\u4e5f\u4f7f\u5f97\u5b83\u80fd\u591f\u5728\u4fee\u6539\u8def\u7531\u65f6\u4e0d\u5fc5 reload\uff0cclient \u7684\u957f\u94fe\u63a5\u4e5f\u5f97\u4ee5\u4fdd\u6301\uff1b\u6211\u4eec\u4e5f\u5bf9 Apache APISIX \u8fdb\u884c\u4e86\u538b\u529b\u6d4b\u8bd5\uff0c\u5728 CPU \u8fbe\u5230 70% \u4ee5\u4e0a\u65f6 Apache APISIX \u4ecd\u80fd\u7a33\u5b9a\u8fd0\u8f6c\u3002\\n\\n- **\u6027\u80fd**\uff1a\u6bcf\u4e2a API \u8bf7\u6c42\u90fd\u4f1a\u7ecf\u8fc7 API \u7f51\u5173\uff0c\u51cf\u5c0f\u7f51\u5173\u6027\u80fd\u635f\u8017\u80fd\u5927\u5927\u964d\u4f4e\u516c\u53f8 API \u6574\u4f53\u54cd\u5e94\u65f6\u95f4\u3002\u5728 PoC \u4e2d\u6211\u4eec\u6bd4\u8f83\u4e86\u4e3b\u8981\u7684\u7f51\u5173\u4ea7\u54c1\uff0cApache APISIX \u7684\u54cd\u5e94\u5ef6\u8fdf\u6bd4\u5176\u5b83\u7f51\u5173\u4f4e 50% \u4ee5\u4e0a\uff1bApache APISIX \u6570\u636e\u9762\u7684\u8bbe\u8ba1\u4e5f\u4f7f\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u90fd\u76f8\u4e92\u72ec\u7acb\uff0c\u8fd9\u4e5f\u4f7f\u5f97\u5b83\u5929\u751f\u652f\u6301\u6c34\u5e73\u6269\u5c55\u3002\\n\\n- **\u53ef\u6269\u5c55\u6027**\uff1a API \u7f51\u5173\u6a21\u5f0f\u662f\u975e\u5e38\u91cd\u8981\u7684\u5fae\u670d\u52a1\u67b6\u6784\u6a21\u5f0f\uff0c\u7b26\u5408 API \u7f51\u5173\u6a21\u5f0f\u7684 API \u7f51\u5173\u5fc5\u987b\u652f\u6301\u4f01\u4e1a\u590d\u6742\u7684\u9274\u6743\u3001\u6743\u9650\u63a7\u5236\u3001\u670d\u52a1\u53d1\u73b0\u3001\u9650\u6d41\u3001\u964d\u7ea7\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u767d\u540d\u5355\u3001\u52a8\u6001\u8def\u7531\u7b49\u529f\u80fd\uff0c\u6240\u4ee5\u652f\u6301\u600e\u6837\u7684\u5b9a\u5236\u662f\u9009\u62e9 API \u7f51\u5173\u65f6\u975e\u5e38\u5173\u952e\u7684\u8003\u91cf\u3002\\n\\n- **\u793e\u533a\u6d3b\u8dc3\u5ea6**\uff1a\u65b0\u7684\u6280\u672f\u4e0e\u9700\u6c42\u5c42\u51fa\u4e0d\u7a77\uff0c\u4e00\u4e2a\u6d3b\u8dc3\u7684\u793e\u533a\u662f API \u7f51\u5173\u8ddf\u4e0a\u6280\u672f\u6f14\u8fdb\u6b65\u4f10\u7684\u5173\u952e\u3002\u65e9\u5728 Apache APISIX \u8fd8\u662f Apache \u5b75\u5316\u9879\u76ee\u65f6\uff0c\u5176\u793e\u533a\u5c31\u5df2\u7ecf\u975e\u5e38\u6d3b\u8dc3\uff0c\u4ece contributor \u6570\u91cf\u3001issue \u54cd\u5e94\u65f6\u95f4\u3001Pull Request \u6570\u91cf\u4e09\u4e2a\u6307\u6807\u6765\u770b\u90fd\u662f\u975e\u5e38\u6d3b\u8dc3\u7684\u793e\u533a\u3002\\n\\n- **\u79c1\u6709\u90e8\u7f72**\uff1aAPI \u7f51\u5173\u4f5c\u4e3a\u4f01\u4e1a\u6838\u5fc3\u6280\u672f\u67b6\u6784\u7ec4\u4ef6\uff0c\u4f01\u4e1a\u5e94\u8be5\u628a\u5b83\u90e8\u7f72\u5728\u81ea\u5df1\u7684\u79c1\u6709\u7f51\u7edc\u8fb9\u7f18\u3002Apache APISIX \u5177\u6709\u826f\u597d\u7684\u73af\u5883\u9002\u5e94\u6027\uff0c\u80fd\u591f\u88ab\u8f7b\u6613\u5730\u90e8\u7f72\u5728\u5305\u62ec\u4e91\u8ba1\u7b97\u5e73\u53f0\u5728\u5185\u7684\u5404\u79cd\u73af\u5883\u4e0a\u3002\\n\\n- **\u5f00\u6e90\u534f\u8bae**\uff1aApache 2.0 \u8d4b\u4e88\u4e86\u5b9a\u5236 APISIX \u7684\u4f01\u4e1a\u76f8\u5f53\u5927\u7684\u6280\u672f\u81ea\u7531\u5ea6\u3002\\n\\n**Q\uff1aApache APISIX \u7528\u5728\u4e86\u54ea\u4e9b\u573a\u666f\uff1f\u89e3\u51b3\u4e86\u54ea\u4e9b\u95ee\u9898\uff1f**\\n\\n**\u674e\u6768**\uff1a\u6211\u4eec\u628a Apache APISIX \u7528\u4f5c\u5fae\u670d\u52a1\u7f51\u5173\u6a21\u5f0f\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5b83\u88ab\u90e8\u7f72\u5728\u7f51\u7edc\u8fb9\u7f18\uff0c\u4e3a\u6240\u6709\u8fdb\u5165 Airwallex \u7684\u6d41\u91cf\u63d0\u4f9b\u901a\u7528\u7f51\u5173\u529f\u80fd\uff0c\u89e3\u51b3\u7684\u95ee\u9898\u5305\u62ec\uff1a\\n\\n- \u6570\u636e\u4e3b\u6743\u95ee\u9898\uff1a\u5bf9\u4e8e\u8de8\u56fd\u8fd0\u8425\u7684\u91d1\u878d\u57fa\u7840\u8bbe\u65bd\uff0c\u6570\u636e\u4e3b\u6743\u662f\u975e\u5e38\u5173\u952e\u7684\u76d1\u7ba1\u8981\u6c42\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u5229\u7528 Apache APISIX \u52a8\u6001\u4e0a\u6e38\u9009\u62e9\u7684\u529f\u80fd\u5f00\u53d1\u4e86\u7b26\u5408\u76d1\u7ba1\u7684\u52a8\u6001\u8def\u7531\u63d2\u4ef6\u3002\u52a8\u6001\u8def\u7531\u80fd\u591f\u6839\u636e\u7528\u6237\u8bf7\u6c42\u7684\u7279\u5f81\u667a\u80fd\u9009\u62e9\u4e0a\u6e38\u6765\u8fdb\u884c\u8bf7\u6c42\u5206\u53d1\uff0c\u5c06\u590d\u6742\u7684\u591a\u6570\u636e\u4e2d\u5fc3\u534f\u540c\u95ee\u9898\u4ece\u670d\u52a1\u5c42\u62bd\u8c61\u5230\u7f51\u5173\u5c42\u3002\u52a8\u6001\u8def\u7531\u5b9e\u8d28\u662f\u8981\u56de\u7b54\u4e24\u4e2a\u95ee\u9898\uff1a\u5982\u4f55\u5bf9\u4e0a\u6e38\u8fdb\u884c\u5206\u7ec4\uff1f\u5982\u4f55\u5339\u914d\u8bf7\u6c42\u4e0e\u5206\u7ec4\u3002\\n\\n- \u5fae\u670d\u52a1\u9694\u79bb\uff1aAirwallex \u5e0c\u671b\u5404\u5fae\u670d\u52a1\u7684\u5de5\u7a0b\u56e2\u961f\u80fd\u591f\u81ea\u4e3b\u63a7\u5236\u81ea\u5df1\u7684\u670d\u52a1\uff0c\u6709\u6548\u964d\u4f4e\u6c9f\u901a\u534f\u8c03\u7684\u6210\u672c\uff0c\u63d0\u9ad8\u5de5\u7a0b\u6548\u80fd\u3002\u8fd9\u4e00\u67b6\u6784\u7406\u5ff5\u8981\u6c42\u88ab\u5404\u56e2\u961f\u5171\u4eab\u7684\u57fa\u7840\u67b6\u6784\u7ec4\u4ef6\uff0c\u6bd4\u5982\uff1a API Gateway \u90fd\u80fd\u652f\u6301\u591a\u79df\u6237\u9694\u79bb\u3002\u5728\u4fdd\u8bc1\u6574\u4e2a\u7cfb\u7edf\u7684\u5f3a\u58ee\u6027\u548c\u6210\u672c\u53ef\u63a7\u7684\u540c\u65f6\uff0c\u5141\u8bb8\u4e1a\u52a1\u56e2\u961f\u6839\u636e\u81ea\u8eab\u7684\u9700\u8981\u5bf9\u7f51\u5173\u529f\u80fd\u8fdb\u884c\u914d\u7f6e\u548c\u6269\u5c55\uff0c\u4fdd\u6301\u5fae\u670d\u52a1\u56e2\u961f\u4e0e\u670d\u52a1\u7684\u72ec\u7acb\u6027\u3002\\n\\n- \u79df\u6237\u7ea7\u9650\u6d41\uff1a\u5728\u591a\u79df\u6237\u73af\u5883\u4e2d\uff0c\u6bcf\u4e2a\u79df\u6237\u7684\u6d41\u91cf\u7279\u5f81\u662f\u4e0d\u540c\u7684\u3002\u5bf9\u4e0d\u540c\u7684\u79df\u6237\u8fdb\u884c\u540c\u6837\u7684\u9650\u6d41\u65e0\u6cd5\u6ee1\u8db3\u5546\u4e1a\u4e0a\u7684\u9700\u6c42\uff0c\u79df\u6237\u7ea7\u9650\u6d41\u80fd\u591f\u6839\u636e\u7528\u6237\u7279\u5f81\u505a\u66f4\u6070\u5f53\u7684\u9650\u6d41\u3002\\n\\n- \u79df\u6237\u7ea7\u767d\u540d\u5355\uff1a\u5728\u591a\u79df\u6237\u73af\u5883\u4e2d\uff0c\u6bcf\u4e2a\u79df\u6237\u7684\u8bbf\u95ee IP \u662f\u4e0d\u540c\u7684\u3002\u5355\u4e00\u7684\u767d\u540d\u5355\u63a7\u5236\u65e0\u6cd5\u6ee1\u8db3\u79df\u6237\u7ea7\u5b89\u5168\u7ba1\u7406\u7684\u9700\u8981\uff0c\u79df\u6237\u7ea7\u767d\u540d\u5355\u4f7f\u5f97\u6bcf\u4e2a\u79df\u6237\u53ef\u4ee5\u63a7\u5236\u81ea\u5df1\u7684\u767d\u540d\u5355\uff0c\u4e5f\u4e0d\u7528\u62c5\u5fc3\u767d\u540d\u5355\u4e2d\u7684\u5176\u5b83\u7528\u6237\u8bbf\u95ee\u81ea\u5df1\u7684\u8d44\u6e90\u3002\\n\\n- Authentication\uff1aAPI \u7f51\u5173\u4e0d\u4ec5\u8981\u652f\u6301\u8bf7\u6c42 authentication\uff0c\u8fd8\u9700\u8981\u652f\u6301\u52a8\u6001\u66f4\u65b0\u5bc6\u94a5\uff0c\u7ecf\u5e38\u66f4\u65b0\u5bc6\u94a5\u662f\u4fdd\u8bc1\u7528\u6237\u8d44\u6e90\u5b89\u5168\u7684\u5173\u952e\u4e00\u73af\u3002\\n\\n- Authorization\uff1a\u4f01\u4e1a\u7ea7\u5e94\u7528\u7684\u6743\u9650\u7ba1\u7406\u662f\u975e\u5e38\u590d\u6742\u7684\uff0c\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\u6709\u7740\u622a\u7136\u4e0d\u540c\u7684\u6743\u9650\u7ba1\u7406\u6a21\u578b\u3002API \u7f51\u5173\u53ef\u4ee5\u6839\u636e\u8def\u7531\u914d\u7f6e\u9a8c\u8bc1\u8bf7\u6c42\u7528\u6237\u662f\u5426\u6709\u8db3\u591f\u7684\u6743\u9650\u8bbf\u95ee\u63a5\u53e3\uff0c\u7b2c\u4e00\u65f6\u95f4\u62e6\u622a\u975e\u6cd5\u7684\u6d41\u91cf\u3002\\n\\n![Airwallex arch](https://static.apiseven.com/202108/20210816002.png)\\n\\n\u5185\u5bb9\u6bd4\u8f83\u591a\u7b80\u5316\u4e00\u4e0b\uff0c\u53ef\u4ee5\u66f4\u6e05\u695a\uff1a\\n\\n![Airwallex arch](https://static.apiseven.com/202108/20210816003.png)\\n\\n**Q:\u5728 Apache APISIX \u5347\u7ea7\u8fc7\u7a0b\u4e2d\u662f\u5426\u987a\u5229\uff1f\u5206\u4eab\u4e00\u4e0b\u5347\u7ea7\u8fc7\u7a0b\u4e2d\u7684\u611f\u53d7\u6216\u8005\u6545\u4e8b\u3002**\\n\\n\u4e3a\u4e86\u80fd\u591f\u968f\u65f6\u5347\u7ea7\u5230\u65b0\u7248\u672c\u7684 Apache APISIX\uff0c\u6211\u4eec\u628a\u4e3b\u8981\u7684\u529f\u80fd\u90fd\u5b9e\u73b0\u4e3a\u5b9a\u5236\u5316\u63d2\u4ef6\u3002\u8fd9\u610f\u5473\u7740\u6211\u4eec\u7684\u4ee3\u7801\u5e93\u4e0d\u53ef\u80fd\u4e0e Apache APISIX \u4e3b Repo \u6838\u5fc3\u4ee3\u7801\u4ea7\u751f\u51b2\u7a81\uff0c\u8fd9\u5e2e\u52a9\u6211\u4eec\u907f\u514d\u4e86\u53ef\u80fd\u9047\u5230\u7684\u4ee3\u7801\u51b2\u7a81\u3002\u4f46\u6709\u65f6\u6211\u4eec\u4e5f\u9700\u8981\u4fee\u6539\u6838\u5fc3\u4ee3\u7801\uff0c\u6b64\u65f6\u6211\u4eec\u4f1a\u5c3d\u91cf\u5728\u5f00\u6e90\u793e\u533a\u5b9e\u73b0\u8fd9\u4e9b\u529f\u80fd\u3002\u5728\u5f00\u6e90\u793e\u533a\u8ba8\u8bba\u8fd9\u4e9b\u529f\u80fd\u7684\u65f6\u5019\uff0c\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u4eec\u975e\u5e38\u70ed\u5fc3\u53c2\u4e0e\u8ba8\u8bba\uff0c\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u90fd\u80fd\u5f88\u5feb\u89e3\u51b3\u6211\u4eec\u7684\u95ee\u9898\u3002\\n\\n**Q:Apache APISIX \u5728\u751f\u4ea7\u73af\u5883\u8fd0\u884c\u591a\u4e45\u4e86\uff1f\u5728\u7ebf\u4e0a\u8868\u73b0\u5982\u4f55\uff1f**\\n\\n**\u674e\u6768**\uff1a\u751f\u4ea7\u73af\u5883\u8fd0\u884c\u4e86 15 \u4e2a\u6708\u4e86\uff0c\u5728\u5f00\u542f\u52a8\u6001\u8def\u7531\u3001\u79df\u6237\u7ea7\u9650\u6d41\u3001\u79df\u6237\u7ea7\u767d\u540d\u5355\u3001Authentication\u3001Authorization \u7b49\u529f\u80fd\u7684\u60c5\u51b5\u4e0b 99% \u54cd\u5e94\u5ef6\u8fdf\u5728 23ms \u4ee5\u5185\uff0c\u6574\u4f53\u8868\u73b0\u975e\u5e38\u7a33\u5b9a\u3002\u5f97\u76ca\u4e8e Apache APISIX \u4f18\u79c0\u7684\u63d2\u4ef6\u673a\u5236\uff0c\u53ef\u4ee5\u4fdd\u969c\u6211\u4eec\u5728\u51e0\u4e4e\u4e0d\u4fee\u6539\u5b83\u6838\u5fc3\u4ee3\u7801\u60c5\u51b5\u4e0b\uff0c\u589e\u52a0\u7b26\u5408\u4e1a\u52a1\u9700\u6c42\u7684\u79c1\u6709\u63d2\u4ef6\u3002\u5b8c\u5907\u7684\u6d4b\u8bd5\u4f53\u7cfb\u4e5f\u8fdb\u4e00\u6b65\u4fdd\u969c\u4e86\u8f6f\u4ef6\u8d28\u91cf\uff0c\u53ef\u4ee5\u653e\u5fc3\u589e\u52a0\u63d2\u4ef6\u4e2a\u6027\u5316\u8981\u6c42\u7684\u540c\u65f6\uff0c\u4fdd\u8bc1\u4e0d\u7834\u574f\u539f\u6709\u6838\u5fc3\u903b\u8f91\u3002\\n\\n**Q\uff1aApache APISIX \u6709\u54ea\u4e9b\u4e0d\u8db3\uff0c\u5e0c\u671b\u793e\u533a\u4e00\u8d77\u5efa\u8bbe\u5b8c\u5584\uff1f**\\n\\n**\u674e\u6768**\uff1aApache APISIX \u7684\u6570\u636e\u9762\u8bbe\u8ba1\u4e3a\u5b83\u5e26\u6765\u4e86\u65e0\u635f\u7684\u6c34\u5e73\u6269\u5c55\u548c\u6781\u81f4\u7684\u6027\u80fd\uff0c\u4f46\u8fd9\u4e5f\u4f7f\u5f97\u8def\u7531\u914d\u7f6e\u5f88\u96be\u505a\u5230\u5411\u524d\u517c\u5bb9\uff0c\u4e3a\u65b0\u7248\u672c\u7684\u53d1\u5e03\u5e26\u6765\u4e86\u4e00\u4e9b\u534f\u8c03\u4e0a\u7684\u56f0\u96be\u3002\\n\\n**Q\uff1a\u540e\u7eed\u6709\u4ec0\u4e48\u8ba1\u5212\uff1f**\\n\\n**\u674e\u6768**\uff1a\u540e\u7eed\u8ba1\u5212\u4e3b\u8981\u5305\u62ec\u4e09\u4e2a\u65b9\u9762\uff1a\\n\\n1. \u7528\u591a\u5c42\u7f51\u7edc\u5c06\u4e0d\u540c\u7684\u7f51\u5173\u903b\u8f91\u62c6\u5206\u5230\u4e0d\u540c\u7684\u5206\u5c42\u4e2d\uff0c\u6bd4\u5982\u6839\u636e\u6570\u636e\u4e3b\u6743\u5206\u53d1\u6d41\u91cf\u4e0e\u5176\u5b83\u7f51\u5173\u903b\u8f91\u5c5e\u4e8e\u4e0d\u540c\u7684\u7f51\u7edc\u5206\u5c42\uff1b\\n2. \u6613\u8bfb\u6613\u7528\u7684\u8def\u7531\u7ba1\u7406\u5bf9 API \u7f51\u5173\u7684\u6210\u8d25\u975e\u5e38\u5173\u952e\uff0c\u867d\u7136\u7f51\u5173\u7684\u529f\u80fd\u4f1a\u4e0d\u65ad\u8fed\u4ee3\u4e0e\u589e\u52a0\uff0c\u4f46\u8def\u7531\u7ba1\u7406\u9700\u8981\u5bf9\u5f00\u53d1\u8005\u53cb\u597d\uff0c\u8ba9\u5f00\u53d1\u8005\u80fd\u591f\u8f7b\u6613\u7406\u89e3\u7f51\u5173\u80fd\u4e3a\u4ed6\u505a\u4ec0\u4e48\u3001\u8be5\u600e\u4e48\u914d\u7f6e\u3001\u600e\u4e48\u53d1\u5e03\u3002\\n3. \u7528\u8bf7\u6c42\u67d3\u8272\u5e2e\u52a9\u5b9e\u73b0\u751f\u4ea7\u73af\u5883\u6d4b\u8bd5\u3002\u7528 API \u7f51\u5173\u8bf7\u6c42\u67d3\u8272\u5b9e\u73b0\u751f\u4ea7\u73af\u5883\u6d4b\u8bd5\u80fd\u4e3a\u6211\u4eec\u5e26\u6765\u7075\u6d3b\u6027\u4e0e\u6613\u7528\u6027\u3002\\n\\n**Q\uff1a\u611f\u8c22\u674e\u535a\u58eb\uff0c\u671f\u5f85 Apache APISIX \u5728 Airwallex \u6709\u66f4\u591a\u7684\u4f7f\u7528\u573a\u666f\uff0c\u53d1\u6325\u7684\u66f4\u591a\u4f5c\u7528\u3002**"},{"id":"2021/08/14/contributors-the-golden-metric-of-opensource-projects","metadata":{"permalink":"/zh/blog/2021/08/14/contributors-the-golden-metric-of-opensource-projects","source":"@site/blog/2021/08/14/contributors-the-golden-metric-of-openSource-projects.md","title":"\u8d21\u732e\u8005\uff0c\u662f\u8861\u91cf\u5f00\u6e90\u9879\u76ee\u7684\u91d1\u6307\u6807","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e3a\u4ec0\u4e48\u8d21\u732e\u8005\u6570\u91cf\u53d8\u5316\u662f\u8861\u91cf\u5f00\u6e90\u9879\u76ee\u7684\u91d1\u6307\u6807\uff0c\u5e76\u4e14\u4f7f\u7528\u8d21\u732e\u8005\u8d8b\u52bf\u56fe\u5206\u6790\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684\u8d21\u732e\u8005\u8d8b\u52bf\u4ee5\u53ca\u4e0e\u5176\u4ed6\u5f00\u6e90\u9879\u76ee\u7684\u5bf9\u6bd4\u3002","date":"2021-08-14T00:00:00.000Z","formattedDate":"2021\u5e748\u670814\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":6.875,"truncated":true,"authors":[{"name":"\u5434\u8212\u65f8","url":"https://github.com/Yiyiyimu","imageURL":"https://avatars.githubusercontent.com/u/34589752?v=4"}],"prevItem":{"title":"Apache APISIX \u5728 Airwallex \u7684\u5e94\u7528 | \u4e13\u8bbf Airwallex \u6280\u672f\u5e73\u53f0\u8d1f\u8d23\u4eba\u674e\u6768","permalink":"/zh/blog/2021/08/17/interview-airwallex"},"nextItem":{"title":"\u4ece\u65b0\u624b\u6751\u51fa\u6765\uff0c\u6211\u5728 Apache APISIX \u793e\u533a\u53d1\u51fa\u4e86\u7b2c\u4e00\u4e2a PR","permalink":"/zh/blog/2021/08/11/interview-tuzhengsong"}},"content":"> \u6839\u636e GitHub 2020 \u5e74\u7684\u7edf\u8ba1\u663e\u793a\uff0c\u8fd9\u4e00\u5e74\u65b0\u589e\u4e86 6000 \u4e07\u4e2a\u4ee3\u7801\u4ed3\u5e93\uff0c\u8d85\u8fc7 5600 \u4e07\u7684\u5f00\u53d1\u8005\u53c2\u4e0e\u5230\u5f00\u6e90\u9879\u76ee\u4e2d\u3002\u9884\u8ba1\u5230 2025 \u5e74\uff0c\u5728 GitHub \u53c2\u4e0e\u5f00\u6e90\u9879\u76ee\u7684\u5f00\u53d1\u8005\u4eba\u6570\u5c06\u4f1a\u8d85\u8fc7 1 \u4ebf\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> Source:\\n> https://github.com/api7/contributor-graph\\n\\n\u5728\u8fd9\u4e9b\u5feb\u901f\u589e\u957f\u7684\u6570\u5b57\u80cc\u540e\uff0c\u9690\u85cf\u7684\u662f\u5f00\u6e90\u9879\u76ee\u4e3a\u4e86\u8d62\u5f97\u5f00\u53d1\u8005\u800c\u505a\u51fa\u7684\u5404\u79cd\u5ba3\u4f20\uff1a\u786c\u6838\u6280\u672f\u6587\u7ae0\u3001\u793e\u4ea4\u6d3b\u52a8\u3001\u65b0\u5a92\u4f53\u3001\u5468\u8fb9\u793c\u7269\u7b49\uff0c\u53ef\u4ee5\u8bf4\u662f\u4e71\u82b1\u6e10\u6b32\u8ff7\u4eba\u773c\u3002\u90a3\u4e48\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u5982\u4f55\u80fd\u591f\u5728\u767e\u82b1\u9f50\u653e\u7684\u9879\u76ee\u4e2d\uff0c\u627e\u51fa\u6700\u9002\u5408\u81ea\u5df1\u516c\u53f8\u7684\u90a3\u4e00\u4e2a\u5462\uff1f\\n\\n\u8fd9\u5c31\u4f1a\u6d89\u53ca\u5230\u5f00\u6e90\u9879\u76ee\u7684\u5404\u79cd\u6307\u6807\uff1a\\n\\n- Star \u6570\uff1a\u8fd9\u662f\u6700\u76f4\u63a5\u7684\u6307\u6807\uff0c\u5b83\u4ee3\u8868\u7684\u662f\u8fd9\u4e2a\u9879\u76ee\u5438\u5f15\u4e86\u591a\u5c11\u5f00\u53d1\u8005\u7684\u5173\u6ce8\uff0c\u53ef\u4ee5\u4f53\u73b0\u8fd9\u4e2a\u9879\u76ee\u7684 marketing \u6c34\u5e73\u3002\u5982\u679c\u8fd9\u4e2a\u9879\u76ee\u6709\u5546\u4e1a\u516c\u53f8\u8d44\u91d1\u7684\u652f\u6301\u3001\u5f3a\u529b\u7684 PR \u56e2\u961f\uff0c\u6216\u8005\u662f\u6c34\u519b\u5237 Star\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6307\u6807\u5c31\u5f88\u5bb9\u6613\u5931\u771f\uff1b\\n\\n- Issue \u548c PR \u6570\uff1aGitHub \u63d0\u4f9b\u4e86 Insights \u529f\u80fd\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![Apache APISIX GitHub Insights](https://static.apiseven.com/202108/1639549315114-8bcc2d6d-a67b-48a2-be1e-0831c2441921.png)\\n\\n\u53ef\u4ee5\u9009\u62e9\u6700\u8fd1\u4e00\u5468\u3001\u6700\u8fd1\u4e00\u4e2a\u6708\u7684\u65f6\u95f4\u5185\uff0c\u8fd9\u4e2a\u5f00\u6e90\u9879\u76ee\u7684 Issue \u548c PR \u7684\u65b0\u5efa\u548c\u5173\u95ed\u6570\u3002\u4e0a\u56fe\u662f Apache APISIX \u6700\u8fd1\u4e00\u4e2a\u6708\u7684\u6570\u636e\u3002\\n\\nGitHub insights \u63d0\u4f9b\u4e86\u4e00\u4e2a\u975e\u5e38\u68d2\u7684\u5f00\u53d1\u8005\u89c6\u89d2\uff0c\u4f46\u8fd8\u4e0d\u591f\u5b8c\u7f8e\uff1aIssue \u548c PR \u7684\u8d28\u91cf\u5982\u4f55\uff1f\u8fd9\u4e9b\u662f\u6ca1\u6709\u529e\u6cd5\u91cf\u5316\u7684\uff1b\\n\\n- Commit \u9891\u7387\u548c\u6570\u636e\uff1a\u4e0b\u56fe\u662f Apache APISIX \u4ece\u9879\u76ee\u521b\u5efa\u5230\u73b0\u5728\u7684 Commit \u9891\u7387\u7edf\u8ba1\uff0c\u53ef\u4ee5\u770b\u51fa Apache APISIX \u4fdd\u6301\u4e86\u975e\u5e38\u7a33\u5b9a\u548c\u6301\u7eed\u7684\u5f00\u53d1\uff0c\u4f46\u8fd9\u4e2a\u6307\u6807\u4e5f\u7565\u663e\u5355\u8584\uff1a\u770b\u4e0d\u5230\u63d0\u4ea4\u8fd9\u4e9b Commit \u7684\u5f00\u53d1\u8005\u7684\u6570\u636e\uff1b\\n\\n![Apache APISIX commits](https://static.apiseven.com/202108/1639549239894-1406e1d6-ae84-4364-89cd-1b63f6f4cd4b.png)\\n\\n\u770b\u5230\u8fd9\u91cc\uff0c\u4f60\u662f\u4e0d\u662f\u89c9\u5f97\u9009\u62e9\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u597d\u590d\u6742\uff0c\u770b\u4e86\u8fd9\u4e48\u591a\u6307\u6807\u90fd\u5f97\u4e0d\u51fa\u7b54\u6848\u3002\u6709\u6ca1\u6709\u4e00\u4e2a\u201c\u91d1\u6307\u6807\u201d\uff0c\u4e00\u4e2a\u901a\u8fc7 marketing \u7838\u4e0d\u51fa\u6765\u7684\u6307\u6807\uff1f\u4e00\u4e2a\u80fd\u591f\u4f53\u73b0\u201c\u5f00\u53d1\u8005\u4e3a\u6838\u5fc3\u201d\u7684\u6307\u6807\uff1f\\n\\n\u4f5c\u4e3a\u5f00\u6e90\u9879\u76ee\u7684\u7ef4\u62a4\u8005\u548c\u5f00\u53d1\u8005\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u8fd9\u6837\u7684\u91d1\u6307\u6807\u6765\u6307\u5f15\u6211\u4eec\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u63d0\u51fa\u4e86 \u201c\u8d21\u732e\u8005\u589e\u957f\u201d \u548c \u201c\u6d3b\u8dc3\u8d21\u732e\u8005\u201d\u8fd9\u4e24\u4e2a\u7ef4\u5ea6\uff0c\u5e76\u5c06\u7edf\u8ba1\u548c\u5206\u6790\u7684\u8fc7\u7a0b\u5f00\u6e90\u51fa\u6765\uff1ahttps://github.com/api7/contributor-graph\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7 https://www.apiseven.com/zh/contributor-graph \u76f4\u63a5\u8fdb\u884c\u68c0\u7d22\u3002\u4e0b\u9762\u662f Apache APISIX \u7684\u793a\u4f8b\uff1a\\n\\n## \u8d21\u732e\u8005\u589e\u957f\\n\\n![Apache APISIX contributor growth](https://static.apiseven.com/202108/1639549136527-e477c670-42d3-4764-9432-209c34dd222b.png)\\n\\n## \u6708\u5ea6\u6d3b\u8dc3\u8d21\u732e\u8005\\n\\n![Apache APISIX Monthly Active Contributors](https://static.apiseven.com/202108/1639548976021-ed0946ae-eeb2-4dfc-8e15-c3db13f527e0.png)\\n\\n\u901a\u8fc7\u4e0a\u9762\u4e24\u4e2a\u8868\u683c\uff0c\u4f60\u53ef\u4ee5\u6e05\u6670\u7684\u770b\u5230 Apache APISIX \u4ece\u521b\u529e\u81f3\u4eca\uff0c\u8d21\u732e\u8005\u90fd\u4fdd\u6301\u7740\u7a33\u5b9a\u7684\u589e\u957f\uff0c\u6bcf\u4e2a\u6708\u90fd\u6709 25 \u4e2a\u5de6\u53f3\u7684\u4ee3\u7801\u8d21\u732e\u8005\u53c2\u4e0e\u5176\u4e2d\u3002\\n\\n## \u591a\u4ed3\u5e93\u5bf9\u6bd4\\n\\n\u201c\u8d21\u732e\u8005\u589e\u957f\u201d \u548c \u201c\u6d3b\u8dc3\u8d21\u732e\u8005\u201d\u56fe\u8868\u90fd\u652f\u6301\u5728\u591a\u4ed3\u5e93\u4e4b\u95f4\u6bd4\u8f83\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0c\u6211\u4eec\u4f1a\u62c9\u53d6 Github API \u6bcf\u65e5/\u6bcf\u6708\u5b9a\u65f6\u66f4\u65b0\u56fe\u8868\uff0c\u53ea\u8981\u4e00\u6b21\u6027\u7684\u590d\u5236\u4f7f\u7528\u6211\u4eec\u63d0\u4f9b\u7684\u94fe\u63a5\uff0c\u60a8\u7684\u4ed3\u5e93\u5c31\u53ef\u4ee5\u59cb\u7ec8\u663e\u793a\u5b9e\u65f6\u7684\u8d21\u732e\u8005\u6570\u636e\u3002\\n\\n\u8d21\u732e\u8005\u589e\u957f\u66f2\u7ebf\u7684\u6570\u636e\u6765\u6e90\u662f\u9879\u76ee\u6bcf\u4e2a contributor \u9996\u6b21\u63d0\u4ea4 commit \u7684\u65e5\u671f\u3002\u901a\u8fc7\u8d21\u732e\u8005\u589e\u957f\u66f2\u7ebf\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 Github \u9996\u9875\u663e\u793a\u7684\u8d21\u732e\u8005\u603b\u4eba\u6570\u57fa\u7840\u4e0a\u89c2\u5bdf\u8d21\u732e\u8005\u589e\u957f\u60c5\u51b5\uff0c\u4ece\u800c\u5bf9\u793e\u533a\u7684\u53d1\u5c55\u60c5\u51b5\u4f5c\u51fa\u76f4\u89c2\u5224\u65ad\u3002\\n\\n\u901a\u8fc7\u540c\u65f6\u5c55\u793a\u540c\u4e00\u9886\u57df\u4e2d\u7684\u591a\u4e2a\u4ed3\u5e93\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u89c2\u6bd4\u8f83\u4e0d\u540c\u793e\u533a\u7684\u53d1\u5c55\u60c5\u51b5\u3002\\n\\n![Apache APISIX compare the development of different communities](https://static.apiseven.com/202108/1639548845735-43efcae0-3221-4739-b10f-0d9aaafad3fd.png)\\n\\n\u5728\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 Apache APISIX \u7684\u8d21\u732e\u8005\u4eba\u6570\u4ee5\u975e\u5e38\u5feb\u7684\u901f\u5ea6\u589e\u957f\uff0c\u4ec5\u4ec5\u7528\u4e86\u4e24\u5e74\u65f6\u95f4\uff0c\u8d21\u732e\u8005\u4eba\u6570\u5c31\u57fa\u672c\u8d76\u4e0a\u751a\u81f3\u8d85\u8d8a\u4e86\u5176\u4ed6\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u3002\\n\\n\u6708\u5ea6\u8d21\u732e\u8005\u66f2\u7ebf\u6570\u636e\u5219\u6765\u81ea\u4e8e\u6bcf\u6708\u63d0\u4ea4 commit \u7684\u8d21\u732e\u8005\u6570\u91cf\u3002\\n\\n\u76f8\u6bd4\u8d21\u732e\u8005\u589e\u957f\u66f2\u7ebf\uff0c\u6708\u5ea6\u8d21\u732e\u8005\u53ef\u4ee5\u66f4\u597d\u8861\u91cf\u77ed\u65f6\u95f4\u5185\u7684\u793e\u533a\u53d1\u5c55\u60c5\u51b5\u3002\\n\\n![Apache APISIX monthly contributors compare](https://static.apiseven.com/202108/1639548683512-d7c7a72b-7ac3-4535-bd1a-f056d05d196b.png)\\n\\n\u4f8b\u5982\u5728\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5982\u4eca Apache APISIX \u662f\u591a\u4e2a\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u4e2d\u7684\u6708\u5ea6\u8d21\u732e\u8005\u4eba\u6570\u6700\u591a\u3001\u6700\u7a33\u5b9a\u7684\u3002\\n\\n\u8fd9\u4e5f\u89e3\u91ca\u4e86\u4e3a\u4f55 Apache APISIX \u53ef\u4ee5\u5728\u5f00\u6e90\u540e\u5982\u6b64\u77ed\u7684\u65f6\u95f4\u5185\u5728\u603b\u8d21\u732e\u8005\u4eba\u6570\u4e0a\u8d76\u4e0a\u53cb\u5546\u4eec\u3002\\n\\n![Apache APISIX monthly contributors](https://static.apiseven.com/202108/1639548241386-6ba96e66-5ab7-468e-9072-6144fb902909.png)\\n\\n\u4e0a\u9762\u8fd9\u5f20\u6bd4\u8f83\u5f00\u6e90\u6d88\u606f\u4e2d\u95f4\u4ef6\u793e\u533a\u7684\u6708\u5ea6\u8d21\u732e\u8005\u7684\u56fe\uff0c\u66fe\u5728\u63a8\u7279\u5f15\u53d1\u70ed\u8bae\u3002\\n\\n\u901a\u8fc7\u8fd9\u5f20\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 Apache Pulsar \u5728\u6708\u5ea6\u8d21\u732e\u8005\u4e0a\u8fce\u5934\u8d76\u4e0a\u4e86 Apache Kafka\u3002\\n\\n## \u603b\u7ed3\\n\\n\u76ee\u524d\u8d21\u732e\u8005\u56fe\u8868\u5df2\u7ecf\u5728 Apache APISIX \u3001Apache Skywalking\u3001Apache DolphinScheduler\u3001Apache Openwhisk\u3001Apache ShardingSphere\u3001awesome-docker\u3001TiDB docs-dm \u7b49\u591a\u4e2a\u5f00\u6e90\u9879\u76ee\u4e2d\u4f7f\u7528\u3002\\n\\n\u5728\u7528\u6237\u4f7f\u7528\u5e76\u53cd\u9988\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u5b9e\u73b0\u4e86\u66f4\u591a\u7684\u9700\u6c42\uff0c\u6bd4\u5982\u6dfb\u52a0\u201c\u533f\u540d\u201d\u8d21\u732e\u8005\uff0c\u6216\u662f\u9879\u76ee\u7531 SVN \u8fc1\u81f3 GitHub \u540e\u6dfb\u52a0 SVN \u4fa7\u7684\u8d21\u732e\u8005\u7b49\u3002\\n\\n\u597d\u7a0b\u5e8f\u90fd\u662f\u8d77\u6e90\u4e8e\u7a0b\u5e8f\u5458\u8981\u89e3\u51b3\u7684\u5207\u8eab\u4e4b\u75db\u3002\u5f53\u6211\u4eec\u804a Contributor Graph \u65f6\uff0c\u6211\u4eec\u4e0d\u4ec5\u5e0c\u671b\u501f\u52a9\u8fd9\u4e2a\u5de5\u5177\u751f\u4ea7\u66f4\u52a0\u76f4\u89c2\u7684\u5c55\u793a Apache APISIX \u793e\u533a\u6d3b\u8dc3\u5ea6\u7684\u56fe\u8868\uff0c\u6211\u4eec\u540c\u65f6\u5f00\u6e90\u4e86\u8fd9\u4e2a\u5c0f\u5de5\u5177\uff0c\u5e0c\u671b\u8fd9\u4e2a\u5de5\u5177\u53ef\u4ee5\u5e2e\u52a9\u5230\u5176\u4ed6\u7684\u5f00\u6e90\u9879\u76ee\u3002\\n\\n\u6b22\u8fce\u5927\u5bb6\u4f7f\u7528\u8d21\u732e\u8005\u8d8b\u52bf\u56fe\u8868\u6765\u8ddf\u8e2a\u60a8\u7684\u793e\u533a\u6d3b\u8dc3\u5ea6\uff0c\u4efb\u4f55\u9700\u6c42\u548c\u95ee\u9898\u90fd\u6b22\u8fce\u5230 Contributor Graph \u7684 GitHub \u4ed3\u5e93\u4e2d\u53cd\u9988\u3002\\n\\n\u8bbf\u95ee Contributor Graph [repository](https://github.com/api7/contributor-graph)\u3002"},{"id":"2021/08/11/interview-tuzhengsong","metadata":{"permalink":"/zh/blog/2021/08/11/interview-tuzhengsong","source":"@site/blog/2021/08/11/interview-TuZhengsong.md","title":"\u4ece\u65b0\u624b\u6751\u51fa\u6765\uff0c\u6211\u5728 Apache APISIX \u793e\u533a\u53d1\u51fa\u4e86\u7b2c\u4e00\u4e2a PR","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u793e\u533a\u5c60\u6b63\u677e\u6210\u4e3a Apache APISIX committer \u7684\u6210\u957f\u7ecf\u5386\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u8981\u53c2\u4e0e Apache APISIX \u793e\u533a\u4ee5\u53ca\u4ed6\u4e3a\u793e\u533a\u505a\u7684\u8d21\u732e\u3002","date":"2021-08-11T00:00:00.000Z","formattedDate":"2021\u5e748\u670811\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":14.405,"truncated":true,"authors":[{"name":"Apache APISIX \u793e\u533a","url":"https://github.com/Yangxiamao","imageURL":"https://avatars.githubusercontent.com/u/47442074?v=4"}],"prevItem":{"title":"\u8d21\u732e\u8005\uff0c\u662f\u8861\u91cf\u5f00\u6e90\u9879\u76ee\u7684\u91d1\u6307\u6807","permalink":"/zh/blog/2021/08/14/contributors-the-golden-metric-of-opensource-projects"},"nextItem":{"title":"Apache APISIX \u67b6\u6784\u5206\u6790\uff1a\u5982\u4f55\u52a8\u6001\u7ba1\u7406 Nginx \u96c6\u7fa4\uff1f","permalink":"/zh/blog/2021/08/10/apisix-nginx"}},"content":"> \u8fd9\u7bc7\u91c7\u8bbf\u7a3f\u8bb2\u8ff0\u4e86\u5c60\u6b63\u677e\u4ece\u5f00\u6e90\u793e\u533a\u5c0f\u767d\u6210\u957f\u4e3a Apache \u9876\u7ea7\u5f00\u6e90\u9879\u76ee APISIX committer \u7684\u5386\u7a0b\u3002\u5c60\u6b63\u677e\uff08GitHub ID\uff1atzssangglass\uff09\u56e0\u6df1\u5ea6\u53c2\u4e0e Apache APISIX \u7684\u5f00\u53d1\uff0c\u5728\u793e\u533a\u4e2d\u8d21\u732e\u5f88\u591a\uff0c2021 \u5e74 7 \u6708 22 \u65e5\u88ab\u63a8\u9009\u4e3a Apache APISIX committer\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> \u5f53\u6211\u770b\u5230\u90a3\u4e2a issue \u540e\uff0c\u5c31\u6709\u79cd\u5f3a\u70c8\u7684\u60f3\u8981\u53c2\u4e0e\u5230\u793e\u533a\u7684\u51b2\u52a8\u3002\u770b\u4e86\u793e\u533a\u7684\u65b0\u624b\u6307\u5357\u540e\uff0c\u6211\u50cf\u4ece\u65b0\u624b\u6751\u51fa\u6765\u7684\u52c7\u8005\uff0c\u51c6\u5907\u6253\u602a\u3002\\n>\\n> \u2014\u2014 Apache APISIX committer \u5c60\u6b63\u677e\\n\\n\u5386\u65f6 282 \u5929\uff0c\u5c60\u6b63\u677e\uff08GitHub ID\uff1atzssangglass\uff09\u4ece\u5f00\u6e90\u793e\u533a\u7684\u5c0f\u767d\u6210\u957f\u4e3a\u4e86 Apache APISIX \u7684 committer\u3002\\n\\n![Apache APISIX committer tzssangglass github](https://static.apiseven.com/202108/1639549454040-de5d7598-83b7-483f-a5da-55fedeb5fa90.png)\\n\\n\u5c60\u6b63\u677e\u56e0\u6df1\u5ea6\u53c2\u4e0e Apache APISIX \u7684\u5f00\u53d1\uff0c\u5728\u793e\u533a\u4e2d\u8d21\u732e\u5f88\u591a\uff0c2021 \u5e74 7 \u6708 22 \u65e5\u88ab\u63a8\u9009\u4e3a Apache APISIX committer\u3002\\n\\n\u5728\u4e00\u4e2a\u5e73\u6de1\u7684\u4e0b\u5348\uff0c\u6211\u4eec\u548c\u6b63\u677e\u8fde\u7ebf\u804a\u4e86\u804a\u3002\u56e0\u4e3a\u75ab\u60c5\u5173\u7cfb\uff0c\u5c45\u4f4f\u5728\u5357\u4eac\u7684\u4ed6\u5df2\u7ecf\u591a\u65e5\u672a\u5916\u51fa\u3002\u5728\u6ca1\u6709\u548c\u4ed6\u804a\u5929\u4e4b\u524d\uff0c\u6211\u6ca1\u6709\u60f3\u5230\uff0c\u80e1\u5b50\u62c9\u78b4\u7684\u4ed6\uff0c\u7adf\u7136\u8d70\u8fc7\u4e86\u8fd9\u4e48\u66f2\u6298\u7684\u8def\u3002\\n\\n## \u5927\u5b66\uff0c\u6211\u7684\u5927\u5b66\\n\\n> \u6211\u5927\u5b66\u7684\u65f6\u5019\u5b66\u7684\u662f\u901a\u4fe1\u5de5\u7a0b\uff0c\u6bcf\u5929\u6700\u5f00\u5fc3\u7684\u4e8b\u5c31\u662f\u8e22\u7403\u3002\u73b0\u5728\u6709\u65f6\u5019\u4f1a\u60f3\uff0c\u5982\u679c\u80fd\u5e26\u7740\u73b0\u5728\u7684\u8bb0\u5fc6\u56de\u5230\u5927\u5b66\u65f6\u5149\u5c31\u597d\u4e86\u3002\\n\\n\u6b63\u677e\u5728\u5927\u5b66\u671f\u95f4\u91cc\u9762\u5176\u5b9e\u6ca1\u600e\u4e48\u63a5\u89e6\u8fc7\u7f16\u7a0b\uff0c\u4ed6\u5f53\u5e74\u5176\u5b9e\u6709 C \u8bed\u8a00\u7684\u7f16\u7a0b\u8bfe\uff0c\u4f46\u662f\u56e0\u4e3a\u5fd9\u7740\u8e22\u7403\uff0c\u6302\u79d1\u4e86\u3002\u53ef\u662f\uff0c\u4ed6\u6302\u79d1\u4e4b\u540e\u7684\u8865\u8003\u4e5f\u6ca1\u8fc7\uff0c\u5bfc\u81f4\u91cd\u4fee\u3002\u6700\u5c34\u5c2c\u7684\u662f\uff0c\u4ed6\u91cd\u4fee\u4e5f\u6ca1\u8fc7\uff0c\u540e\u6765\u600e\u4e48\u529e\u5462\uff1f\u6bd5\u4e1a\u4e4b\u524d\u8fd8\u6709\u6bd5\u4e1a\u6e05\u8003\u3002\u8fd9\u53ef\u4e0d\u80fd\u518d\u6302\u4e86\uff0c\u4e8e\u662f\u6b63\u677e\u5c31\u53bb\u56fe\u4e66\u9986\u53bb\u501f\u4e86\u4e00\u672c C \u8bed\u8a00\u7684\u4e66\u6765\u770b\u3002\\n\\n\u201c\u6211\u5f53\u65f6\u5fc3\u60f3\uff0cC \u8bed\u8a00\u771f\u7684\u8fd9\u4e48\u96be\u5417\uff1f\u201d\u6b63\u677e\u8bf4\u3002\\n\\n\u7136\u540e\u4ed6\u5c31\u4e00\u76f4\u770b\u4e00\u76f4\u770b\uff0c\u770b\u7740\u770b\u7740\u5c31\u7a81\u7136\u53d1\u73b0\u7f16\u7a0b\u597d\u50cf\u6709\u90a3\u4e48\u70b9\u610f\u601d\uff0c\u4ed6\u770b\u61c2\u4e86\uff01\u6700\u540e\u4ed6\u5728\u6bd5\u4e1a\u524d\u987a\u5229\u901a\u8fc7\u4e86\u8003\u8bd5\u3002\u5728\u6bd5\u4e1a\u4e4b\u540e\uff0c\u627e\u5230\u4e86\u4e00\u4efd\u505a\u7a0b\u5e8f\u5458\u7684\u5de5\u4f5c\u3002\\n\\n\u201c\u6211\u672c\u6765\u90fd\u51c6\u5907\u6bd5\u4e1a\u56de\u5bb6\u627e\u4e2a\u5382\u4e0a\u73ed\u4e86\u3002\u201d\uff0c\u4ed6\u534a\u5f00\u73a9\u7b11\u5730\u8bf4\u3002\\n\\n\u5f7c\u65f6\uff0c\u4ed6\u53ef\u80fd\u4e0d\u4f1a\u60f3\u5230\u5982\u4eca\u7684\u4ed6\u4f1a\u6210\u4e3a\u6570\u4e2a\u77e5\u540d\u5f00\u6e90\u9879\u76ee\u7684 developer\uff0c\u53c2\u4e0e\u4e00\u4e9b\u652f\u6491\u7740\u5343\u4e07\u7ea7\u5e76\u53d1\u6d41\u91cf\u7684\u57fa\u7840\u8bbe\u65bd\u7684\u5f00\u53d1\u3002\\n\\n## \u51fa\u8c61\u7259\u5854\u8bb0\\n\\n> \u5728\u5de5\u4e1a\u754c\uff0c\u771f\u5b9e\u7684\u4e1a\u52a1\u573a\u666f\u548c\u5b66\u6821\u91cc\u5b66\u7684\u5f88\u4e0d\u4e00\u6837\u7684\\n\\n\u6b63\u677e\u7684\u7b2c\u4e00\u4efd\u5de5\u4f5c\u5c31\u804c\u4e8e\u4e00\u5bb6\u505a\u7a7f\u6234\u8bbe\u5907\u7684\u521b\u4e1a\u516c\u53f8\uff0c\u4ece\u4e8b\u667a\u80fd\u624b\u73af\u7684\u7814\u53d1\u5de5\u4f5c\u3002\u6b63\u677e\u548c\u4ed6\u7684\u524d\u540c\u4e8b\u4eec\u9700\u8981\u901a\u8fc7\u5904\u7406\u4ece\u667a\u80fd\u624b\u73af\u4e0a\u7684\u83b7\u53d6\u7684\u5404\u79cd\u4f20\u611f\u5668\u6570\u636e\uff0c\u6765\u5b8c\u6210\u5bf9\u7528\u6237\u7684\u5fc3\u7387\u3001\u8fd0\u52a8\u91cf\u3001\u8840\u538b\u7b49\u7684\u76d1\u6d4b\u3002\\n\\n\u201c\u5de5\u4f5c\u86ee\u597d\u73a9\u7684\uff0c\u56e0\u4e3a\u5728\u5de5\u4e1a\u754c\uff0c\u771f\u5b9e\u7684\u4e1a\u52a1\u573a\u666f\u548c\u5b66\u6821\u91cc\u5b66\u7684\u5f88\u4e0d\u4e00\u6837\u7684\uff0c\u5f88\u591a\u4e1c\u897f\u90fd\u5f97\u4ece\u5934\u5f00\u59cb\u5b66\u201d\uff0c\u6b63\u677e\u8bf4\u3002\\n\\n\u6709\u4e00\u5929\u4e0b\u73ed\u4e4b\u540e\uff0c\u8fd9\u5bb6\u516c\u53f8\u7684\u8001\u677f\u5a18\u7a81\u7136\u53d1\u4e86\u4e00\u6761\u4fe1\u606f\uff0c\u8bf4\u516c\u53f8\u7684\u5458\u5de5\u6682\u65f6\u4f11\u5047\uff0c\u4ec0\u4e48\u65f6\u5019\u4e0a\u73ed\u7b49\u901a\u77e5\u3002\\n\\n\u6b63\u677e\u5f53\u65f6\u5c31\u89c9\u5f97\u4e0d\u5bf9\u52b2\uff0c\u600e\u4e48\u597d\u597d\u7684\u4e0a\u7740\u73ed\uff0c\u7a81\u7136\u5c31\u4f11\u5047\u4e86\uff1f\u7136\u540e\u4ed6\u7acb\u9a6c\u6253\u5f00\u62db\u8058\u8f6f\u4ef6\uff0c\u5f00\u59cb\u627e\u65b0\u7684\u5de5\u4f5c\u3002\u540e\u6765\u624d\u77e5\u9053\uff0c\u516c\u53f8\u7684\u8001\u677f\u8ddf\u4f9b\u5e94\u5546\u6709\u5408\u540c\u7ea0\u7eb7\uff0c\u516c\u53f8\u77ed\u6682\u505c\u6446\u4e86\u3002\\n\\n\u7136\u540e\uff0c\u6b63\u677e\u4fbf\u5230\u53e6\u5916\u4e00\u5bb6\u516c\u53f8\u4ece\u4e8b\u540e\u7aef\u4e1a\u52a1\u5f00\u53d1\u7684\u5de5\u4f5c\uff0c\u5b66\u4e60\u4e1a\u754c\u89c4\u8303\u3001\u8fdb\u4e00\u6b65\u589e\u8fdb\u6280\u672f\u3002\u8fc7\u4e86\u5feb\u4e00\u5e74\uff0c\u56e0\u4e3a\u6b63\u677e\u6bd4\u8f83\u559c\u6b22 Nginx\u3001OpenResty\u3001Netty \u8fd9\u7c7b\u7b80\u6d01\u548c\u9ad8\u6027\u80fd\u7684\u6280\u672f\uff0c\u4ed6\u8fdb\u5165\u4e00\u5bb6\u5927\u516c\u53f8\u7684\u5f00\u53d1\u56e2\u961f\uff0c\u4ece\u4e8b\u4e2d\u95f4\u4ef6\u76f8\u5173\u5f00\u53d1\u5de5\u4f5c\u3002\\n\\n\u201c\u5728\u8fd9\u5bb6\u5927\u516c\u53f8\uff0c\u6211\u505a\u7684\u79bb\u4e1a\u52a1\u7a0d\u5fae\u8fdc\u90a3\u4e48\u4e00\u70b9\u70b9\uff0c\u66f4\u504f\u5411\u6280\u672f\u4e00\u4e9b\u3002\u201c\u6b63\u677e\u8bf4\u3002\\n\\n\u6b63\u677e\u63a5\u89e6 Apache APISIX \u7684\u65f6\u95f4\u662f 2020 \u5e74 9 \u6708\u4efd\uff0c\u90a3\u65f6\u5019\uff0c\u4ed6\u6240\u5728\u7684\u56e2\u961f\u4f7f\u7528\u7684\u662f Kong\uff0c\u4f46\u662f\u5f53\u65f6 Kong \u65e0\u6cd5\u5b8c\u5168\u6ee1\u8db3\u4ed6\u4eec\u7684\u9700\u6c42\uff0c\u4e8e\u662f\u4ed6\u4eec\u4fbf\u91cd\u65b0\u505a\u7f51\u5173\u7684\u6280\u672f\u9009\u578b\uff0c\u8bd5\u56fe\u5bfb\u627e\u66f4\u597d\u7684\u65b9\u6848\u3002\u6b63\u677e\u62c5\u4efb\u672c\u6b21\u6280\u672f\u9009\u578b\u7684\u8d1f\u8d23\u4eba\uff0c\u4e8e\u662f\u4ed6\u5173\u6ce8\u5230\u4e86 Apache \u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u9879\u76ee Apache APISIX\uff0c\u8fdb\u800c\u63a5\u89e6\u4e86 Apache APISIX \u7684\u793e\u533a\u3002\\n\\n\u5f7c\u65f6\u7684\u4ed6\uff0c\u5df2\u7ecf\u6bd5\u4e1a\u4e09\u5e74\u591a\u4e86\u3002\\n\\n## \u51fa\u65b0\u624b\u6751\\n\\n> \u6211\u53ef\u4ee5\u7ed9 Apache \u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u9879\u76ee\u63d0\u4ea4\u4ee3\u7801\u4e86\uff01\u4f5c\u4e3a\u4e00\u4e2a\u6280\u672f\u5de5\u4f5c\u8005\uff0c\u8fd9\u662f\u4e00\u79cd\u6280\u672f\u4e0a\u7684\u81ea\u4fe1\u3002\\n\\n\u6b63\u677e\u5728\u5f00\u6e90\u793e\u533a\u7684\u7b2c\u4e00\u4e2a PR \u662f\u4e00\u4e2a enhancement\uff08\u529f\u80fd\u589e\u5f3a\uff09\u7c7b\u578b\u7684 PR\uff0c\u8fd9\u4e2a PR \u8ba9 Apache APISIX \u652f\u6301\u4e86\u591a\u7aef\u53e3\u76d1\u542c\u3002\\n\\n- issue\uff1ahttps://github.com/apache/apisix/issues/1195\\n- PR\uff1ahttps://github.com/apache/apisix/pull/2409\\n\\n\u8fd9\u4e2a\u529f\u80fd\u662f\u6b63\u677e\u516c\u53f8\u9700\u8981\u7684\uff0c\u5728 issue \u533a\u4e5f\u65e9\u6709\u4eba\u63d0\u5230\uff0c\u4f46\u662f\u4e0d\u77e5\u4e3a\u4f55\u4e00\u76f4\u65e0\u4eba\u8ba4\u9886\u3002\u4e4b\u524d\uff0c\u6b63\u677e\u6b63\u597d\u5bf9\u8fd9\u65b9\u9762\u7684\u77e5\u8bc6\u6709\u6240\u4e86\u89e3\uff0c\u4e8e\u662f\u4ed6\u60f3\uff1a\u201d\u6211\u53ef\u4ee5\u7ed9 Apache APISIX \u63d0\u4e2a PR \u6765 fix \u8fd9\u4e2a\u95ee\u9898\u3002\u201c\u6240\u4ee5\u4ed6\u5728 issue \u91cc\u4e3b\u52a8\u8981\u6c42\u628a\u8fd9\u4e2a\u95ee\u9898\u6307\u6d3e\u7ed9\u4ed6\u3002\\n\\n\u4ed6\u8bf4\uff1a\u201c\u5f53\u65f6\u6211\u6709\u4e00\u79cd\u5f3a\u70c8\u7684\u53c2\u4e0e\u793e\u533a\u7684\u51b2\u52a8\uff0c\u7136\u540e\u6211\u770b\u4e86\u4e00\u4e0b Apache APISIX \u793e\u533a\u7684\u65b0\u624b\u6307\u5357\uff0c\u7136\u540e\u5c31\u50cf\u62ff\u7740\u6b66\u5668\u4ece\u65b0\u624b\u6751\u51fa\u6765\u4e00\u6837\uff0c\u5174\u81f4\u51b2\u51b2\u7684\u51c6\u5907\u53c2\u4e0e\u3002\u201d\\n\\n\u9009\u62e9\u4e86\u8fd9\u4e2a issue \u4e4b\u540e\uff0c\u6b63\u677e\u5f00\u59cb\u5728 GitHub \u4e0a\u9762\u5f00\u59cb\u8ddf\u793e\u533a\u7684\u4f19\u4f34\u8ba8\u8bba\u7ec6\u8282\u4e0a\u7684\u95ee\u9898\uff0c\u50cf\u662f\u914d\u7f6e\u7aef\u53e3\u7684 style\u3001\u5b9e\u73b0\u7684\u601d\u8def\u7b49\u3002\u5728\u8ba8\u8bba\u5b8c\u4e4b\u540e\uff0c\u4ed6\u5f00\u59cb\u52a8\u624b\u5b9e\u73b0\u3002\u6bcf\u5929\u665a\u4e0a\u4e0b\u73ed\u4e4b\u540e\u53bb\u7ffb\u770b Apache APISIX \u7684\u4ee3\u7801\uff0c\u6d4b\u8bd5\u76f8\u5173\u7528\u4f8b\u3002\u5728\u7ecf\u5386\u4e86\u4e09\u56db\u4e2a\u665a\u4e0a\u7684\u594b\u6597\u540e\uff0c\u6d4b\u8bd5\u7b2c\u4e00\u6b21\u8dd1\u901a\u4e86\uff01\\n\\n\u5f53\u65f6\u6b63\u677e\u5185\u5fc3\u975e\u5e38\u7684\u5174\u594b\uff0c\u9a6c\u4e0a\u6309\u7167\u90a3\u4e2a\u65b0\u624b\u6307\u5357\u7684\u5f15\u5bfc\u628a PR \u63d0\u4e0a\u53bb\u4e86\u3002\u7136\u540e\u63a5\u53d7 Code Review \u7684\u610f\u89c1\uff0c\u8fdb\u4e00\u6b65\u4fee\u6539\u4ee3\u7801\u3002\u7ec8\u4e8e\uff0c\u5728 10 \u6708 18 \u53f7\uff0cPR \u987a\u5229\u5730 merge \u8fdb\u4e86\u4ed3\u5e93\u3002\\n\\n![Apache APISIX committer tzssangglass pr](https://static.apiseven.com/202108/1639549390155-6b6cb167-8c9a-43fb-8859-f58cd6b1aae7.png)\\n\\n\u201c\u5f53\u65f6\u6211\u975e\u5e38\u7684\u6fc0\u52a8\uff0c\u611f\u89c9\u81ea\u5df1\u7ec8\u4e8e\u5b9e\u8d28\u6027\u5730\u53c2\u4e0e\u5230\u5f00\u6e90\u793e\u533a\u91cc\u9762\u53bb\u4e86\u3002\u6211\u53ef\u4ee5\u7ed9 Apache \u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u9879\u76ee\u63d0\u4ea4\u4ee3\u7801\u4e86\uff01\u4f5c\u4e3a\u4e00\u4e2a\u6280\u672f\u5de5\u4f5c\u8005\uff0c\u8fd9\u662f\u4e00\u79cd\u6280\u672f\u4e0a\u7684\u81ea\u4fe1\u3002\u201d\\n\\n**\u8fd9\u662f\u6b63\u677e\u5728\u5f00\u6e90\u4e16\u754c\u7684\u7b2c\u4e00\u4e2a PR\u3002**\\n\\n## \u5728\u793e\u533a\u5370\u8c61\u6df1\u523b\u7684\u4e8b\\n\\n> \u56e0\u4e3a etcd \u6709 MaxCallRecvMsgSize \u7684\u9650\u5236\uff0c\u5c31\u4ece etcd \u7684\u6e90\u5934\u53bb\u89e3\u51b3\uff0c\u8fd9\u662f\u6700\u4f18\u96c5\uff0c\u4e5f\u662f\u6700\u9002\u5408\u7684\u3002\\n\\n\u5f53\u6211\u4eec\u95ee\u5230\uff0c\u6b63\u677e\u5728\u793e\u533a\u5370\u8c61\u6700\u6df1\u523b\u7684\u4e8b\u60c5\u662f\u4ec0\u4e48\u7684\u65f6\u5019\uff0c\u6b63\u677e\u60f3\u4e86\u60f3\u8bf4\uff0c\u53ef\u80fd\u662f\u4e00\u4e2a\u548c bug \u6709\u5173\u7684\u95ee\u9898\uff1aetcd \u7684 MaxCallRecvMsgSize \u9650\u5236\u3002\\n\\n\u6b63\u677e\u66fe\u7ecf\u88ab etcd \u9650\u5236\u8fd4\u56de\u4f53\u5927\u5c0f\u7684\u95ee\u9898\u6298\u78e8\u8fc7\uff0c\u793e\u533a\u5185\u4e5f\u591a\u6b21\u53cd\u6620\u3001\u8ba8\u8bba\u8fc7\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u5728 Apache APISIX \u4e0a\u65e0\u8bba\u600e\u4e48\u5904\u7406\u90fd\u4e0d\u662f\u5f88\u4f18\u96c5\u3002\\n\\n\u76f4\u5230\u4eca\u5e74 4 \u6708\u4efd\uff0c[\u652f\u6d41\u79d1\u6280](https://api7.ai/)\u7684\u4e00\u4f4d\u5c0f\u4f19\u4f34\u7ed9 etcd \u63d0\u4ea4\u4e86 PR\uff0c\u6700\u7ec8\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u6b63\u677e\u542c\u8bf4\u8fd9\u4e2a\u6d88\u606f\u65f6\uff0c\u611f\u5230\u975e\u5e38\u7684\u9707\u64bc\uff0c\u5f53\u65f6\u4ed6\u6ca1\u6709\u60f3\u8fc7\u8fd9\u4e2a\u4e8b\u60c5\u4f1a\u4ee5\u8fd9\u6837\u7684\u65b9\u5f0f\u53bb\u89e3\u51b3\u3002\u4f46\u662f\u73b0\u5728\u6765\u770b\u7684\u8bdd\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u786e\u5b9e\u662f\u6700\u9002\u5408\u7684\u3002\\n\\n\u201c\u56e0\u4e3a etcd \u6709 MaxCallRecvMsgSize \u7684\u9650\u5236\uff0c\u5c31\u4ece etcd \u7684\u6e90\u5934\u53bb\u89e3\u51b3\uff0c\u8fd9\u662f\u6700\u4f18\u96c5\uff0c\u4e5f\u662f\u6700\u9002\u5408\u7684\u3002\u8fd9\u662f\u5f88\u68d2\u7684\u8de8\u793e\u533a\u5408\u4f5c\u7684\u793a\u4f8b\u201d\uff0c\u6b63\u677e\u8bf4\u3002\\n\\n## Sir, this way\\n\\n> \u5927\u5bb6\u5206\u5de5\u5408\u4f5c\u4e0d\u540c\uff0c\u4f46\u662f\u90fd\u662f\u5728\u4e3a\u5f00\u6e90\u505a\u8d21\u732e\u3002\\n\\n\u6b63\u677e\u8bf4\uff0c\u4ed6\u521a\u5f00\u59cb\u53c2\u4e0e\u793e\u533a\u7684\u65f6\u5019\uff0c\u628a\u5f53\u65f6\u80fd\u770b\u5230\u7684 APISIX \u6587\u6863\u5927\u90e8\u5206\u90fd\u8fc7\u4e86\u4e00\u904d\u3002\u6240\u4ee5\u5f53\u65f6\u5728\u6240\u5728\u516c\u53f8\u5de5\u4f5c\u7684\u65f6\u5019\uff0c\u540c\u4e8b\u95ee\u4ed6\u95ee\u9898\uff0c\u4ed6\u867d\u7136\u5e76\u4e0d\u662f\u5f88\u6e05\u695a\uff0c\u4f46\u662f\u4ed6\u6e05\u695a\u9879\u76ee\u7684\u6587\u6863\u5206\u5e03\u60c5\u51b5\uff0c\u76f4\u63a5\u628a\u6587\u6863\u627e\u51fa\u6765\u770b\u4e00\u4e0b\uff0c\u5c31\u5927\u6982\u77e5\u9053\u662f\u4ec0\u4e48\u95ee\u9898\u4e86\u3002\u4ed6\u8ba4\u4e3a\u770b\u6587\u6863\u662f\u719f\u6089\u9879\u76ee\u7684\u4e00\u4e2a\u5408\u9002\u7684\u65b9\u5f0f\u3002\\n\\nApache APISIX \u7684\u9879\u76ee\u5b98\u7f51\u4e0a\uff0c\u6709\u5b8c\u5584\u7684\u5305\u62ec\u5982\u4f55\u63d0 PR \u7684\u65b0\u624b\u6307\u5357\u3002\u5982\u679c\u60f3\u53c2\u4e0e\u793e\u533a\u7684\u8bdd\uff0c\u53ef\u4ee5\u5148\u628a\u5b98\u7f51\u548c Github \u4e0a\u7684\u4e3b\u8981\u7684\u6587\u6863\u90fd\u770b\u4e00\u4e0b\uff0c\u5bf9\u9879\u76ee\u6709\u57fa\u672c\u7684\u4e86\u89e3\uff0c\u4e5f\u6e05\u695a\u9879\u76ee\u7684\u6587\u6863\u5206\u5e03\u60c5\u51b5\uff0c\u540e\u9762\u518d\u6309\u9700\u7d22\u5f15\u6587\u6863\u3002\\n\\n\u5982\u679c\u60f3\u5728\u4ee3\u7801\u65b9\u9762\u505a\u8d21\u732e\uff0c\u6216\u8005\u53c2\u4e0e\u8bbe\u8ba1\u7684\u8bdd\uff0c\u4e00\u4e9b Nginx \u6216\u8005 OpenResty \u65b9\u9762\u7684\u77e5\u8bc6\u7684\u50a8\u5907\u662f\u5fc5\u8981\u7684\u3002\u5305\u62ec\u770b\u4ed6\u4eec\u5b98\u65b9\u7684\u6587\u6863\u53ca\u548c\u4ee3\u7801\uff0c\u5b66\u4e60\u4ed6\u4eec\u5bf9\u4e8e\u76f8\u5173 feature \u7684\u5b9e\u73b0\u7b49\u3002\\n\\n\u6b63\u677e\u8bf4\uff1a\u201c\u6211\u89c9\u5f97\u8fd9\u4e00\u6b65\u662f\u65e0\u6cd5\u8df3\u8fc7\u7684\u3002\u201d\\n\\n\u5f53\u7136\uff0c\u4f60\u53ef\u4ee5\u4ee5\u4f7f\u7528\u8005\u7684\u8eab\u4efd\uff0c\u53bb\u53c2\u4e0e\u5230\u793e\u533a\u91cc\u3002\u6bd4\u5982\u8bf4\u4f60\u89c9\u5f97\u6587\u6863\u6709\u95ee\u9898\uff0c\u6216\u8005\u8bf4\u4f60\u6309\u7167\u6587\u6863\u53bb\u5b9e\u8df5\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u5e76\u4e0d\u662f\u90a3\u6837\uff0c\u4f60\u4e5f\u53ef\u4ee5\u53bb\u63d0\u4e00\u4e9b issue \u6307\u51fa\u8fd9\u4e9b\u95ee\u9898\u3002\\n\\n\u5927\u5bb6\u5206\u5de5\u5408\u4f5c\u4e0d\u540c\uff0c\u4f46\u662f\u90fd\u662f\u5728\u4e3a\u5f00\u6e90\u505a\u8d21\u732e\u3002\\n\\n## \u793e\u533a\u6b22\u8fce\u6240\u6709\u4eba\\n\\n> \u4f46\u8fd9\u6837\u505a\u66f4\u597d\\n\\n\u6b63\u677e\u8bf4\uff0c\u5927\u5bb6\u90fd\u5728\u5f00\u6e90\u793e\u533a\uff0c\u9996\u5148\u8981\u6ce8\u610f\u7684\u5c31\u662f\u8981\u9075\u5b88\u793e\u533a\u7684\u4e00\u4e9b\u89c4\u77e9\uff0c\u548c\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u5e73\u7b49\u4ea4\u6d41\u3002\\n\\n\u4ea4\u6d41\u65f6\u8981\u6ce8\u610f\u7684\u70b9\u53ef\u4ee5\u5206\u6210\u4e24\u79cd\u3002\\n\\n\u7b2c\u4e00\u79cd\u662f\uff0c\u5047\u5982\u4f60\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u90a3\u4f60\u5e94\u8be5\u5c3d\u91cf\u51c6\u786e\u5730\u63cf\u8ff0\u95ee\u9898\uff0c\u63d0\u4f9b\u53ef\u590d\u73b0\u7684\u7528\u4f8b\u3002\u8fd9\u4e2a\u5176\u5b9e\u662f\u6700\u53d7\u6b22\u8fce\u7684\uff0c\u6216\u8005\u8bf4\u6700\u80fd\u63d0\u9ad8\u6c9f\u901a\u6548\u7387\u7684\u4e00\u4e2a\u65b9\u5f0f\u3002\u5982\u679c\u4f60\u80fd\u628a\u4e00\u4e2a\u95ee\u9898\u63cf\u8ff0\u7684\u5f88\u6e05\u6670\uff0c\u90a3\u5927\u5bb6\u56de\u7b54\u95ee\u9898\u7684\u6548\u7387\u81ea\u7136\u4f1a\u975e\u5e38\u9ad8\u3002\\n\\n\u7b2c\u4e8c\u79cd\u662f\uff0c\u5982\u679c\u662f\u63d0\u51fa\u60f3\u6cd5\uff0c\u89e3\u51b3\u95ee\u9898\u7b49\uff0c\u5728\u52a8\u624b\u505a\u4e4b\u524d\uff0c\u5bf9\u4e8e\u6709\u6b67\u4e49\u7684\u70b9\uff0c\u9700\u8981\u5728\u516c\u5f00\u7684\u573a\u5408\uff0c\u6bd4\u5982 issue \uff0c\u90ae\u4ef6\u5217\u8868\u7b49\u4e0a\u9762\u8ba8\u8bba\uff0c\u5728\u793e\u533a\u5185\u8fbe\u6210\u4e00\u81f4\uff0c\u53d6\u5f97\u5171\u8bc6\u4e4b\u540e\uff0c\u518d\u5f00\u59cb\u505a\u3002\\n\\n## \u5173\u4e8e Apache Way\\n\\n> \u5171\u8bc6\u4e5f\u4f1a\u66f4\u65b0\uff0c\u5b83\u662f\u793e\u533a\u63a8\u52a8\u9879\u76ee\u524d\u8fdb\u7684\u4e00\u79cd\u529b\u91cf\u3002\\n\\n\u6b63\u677e\u7406\u89e3\u7684 Apache Way\uff0c\u662f\u793e\u533a\u5927\u4e8e\u4ee3\u7801\u3002\\n\\n\u4ed6\u8ba4\u4e3a\uff0c\u793e\u533a\u672c\u8d28\u4e0a\u662f\u4eba\u4e0e\u4eba\u4e4b\u95f4\u7684\u5408\u4f5c\uff0c\u5927\u5bb6\u5206\u5de5\u5408\u4f5c\uff0c\u5404\u53f8\u5176\u804c\u3002\u4f46\u662f\u5728\u5408\u4f5c\u548c\u5404\u53f8\u5176\u804c\u4e4b\u524d\uff0c\u5927\u5bb6\u662f\u9700\u8981\u5f62\u6210\u4e00\u4e9b\u5171\u8bc6\u3002\\n\\n\u5171\u8bc6\u662f\u4e00\u70b9\u70b9\u79ef\u7d2f\u8d77\u6765\u7684\u3002\u793e\u533a\u53c2\u4e0e\u8005\u4eec\u629b\u51fa\u4e00\u4e2a\u4e2a\u95ee\u9898\uff0c\u793e\u533a\u5185\u4f1a\u8ba8\u8bba\uff0c\u8fa9\u9a73\uff0c\u9a8c\u8bc1\uff0c\u76f4\u81f3\u6700\u540e\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5171\u8bc6\u5728\u793e\u533a\u5185\u6162\u6162\u5f62\u6210\uff0c\u5171\u8bc6\u53ef\u80fd\u662f\u89c4\u8303\uff0c\u4e5f\u53ef\u80fd\u662f\u8fb9\u754c\uff0c\u6216\u8005\u5176\u4ed6\u7684\u5f62\u5f0f\u3002\u5171\u8bc6\u4e5f\u4f1a\u66f4\u65b0\uff0c\u5b83\u662f\u793e\u533a\u63a8\u52a8\u9879\u76ee\u524d\u8fdb\u7684\u4e00\u79cd\u529b\u91cf\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5e26\u6709\u4e00\u4e9b\u7406\u60f3\u4e3b\u4e49\u8272\u5f69\u3002\\n\\n\u793e\u533a\u7684\u5171\u8bc6\u5176\u5b9e\u6bd4\u4f60\u505a\u4ee3\u7801\u8d21\u732e\u66f4\u91cd\u8981\uff0c\u56e0\u4e3a\u6709\u4e86\u5171\u8bc6\u4e4b\u540e\uff0c\u540e\u9762\u53bb\u56de\u6eaf\u67d0\u4e00\u4e2a\u6539\u52a8\u7684\u70b9\u7684\u65f6\u5019\uff0c\u4f1a\u66f4\u52a0\u6e05\u6670\uff0c\u77e5\u9053\u8fd9\u4e2a\u6539\u52a8\u7684\u8d77\u6e90\u548c\u5f53\u65f6\u7684\u89c6\u89d2\u3002\\n\\n## \u6700\u540e\\n\\n\u6700\u540e\u5728\u5173\u9ea6\u4e4b\u524d\uff0c\u6211\u4eec\u8bf7\u6b63\u677e\u7ed9\u6211\u4eec\u63a8\u8350\u4e00\u4e9b\u4e1c\u897f\u3002\u6b63\u677e\u60f3\u4e86\u60f3\uff0c\u8bf4\uff1a\u201c\u6211\u63a8\u8350\u4e86\u4e00\u90e8\u5fb7\u56fd\u7535\u5f71\uff0c\u8ddf\u793e\u4f1a\u5de5\u7a0b\u5b66\u76f8\u5173\u7684\u300a\u6211\u662f\u8c01\uff1a\u6ca1\u6709\u7edd\u5bf9\u5b89\u5168\u7684\u7cfb\u7edf\u300b\uff0c\u548c\u4e00\u672c\u4e66\uff0c\u5b54\u98de\u529b\u8001\u5e08\u7684\u300a\u53eb\u9b42\uff1a1768 \u5e74\u4e2d\u56fd\u5996\u672f\u5927\u6050\u614c\u300b\u3002\u5e0c\u671b\u5927\u5bb6\u5728\u5fd9\u788c\u7684\u5de5\u4f5c\u4e2d\uff0c\u4e5f\u4e0d\u8981\u5fd8\u4e86\u5145\u5b9e\u81ea\u5df1\u7684\u7cbe\u795e\u751f\u6d3b\u3002\u201c\\n\\n\u8fd9\u5c31\u662f\u8fd9\u6b21\u7684\u91c7\u8bbf\u5566\uff01\u4e0b\u56de\uff0c\u6211\u4eec\u4f1a\u91c7\u8bbf\u54ea\u4f4d\u793e\u533a\u7684\u5c0f\u4f19\u4f34\u5462\uff1f\u5feb\u6765 Apache APISIX \u793e\u533a\u77a7\u4e00\u77a7\u5427\uff01\u6ca1\u51c6\uff0c\u4e0b\u4e00\u4f4d committer \u5c31\u662f\u4f60\uff01"},{"id":"Apache APISIX \u67b6\u6784\u5206\u6790\uff1a\u5982\u4f55\u52a8\u6001\u7ba1\u7406 Nginx \u96c6\u7fa4\uff1f","metadata":{"permalink":"/zh/blog/2021/08/10/apisix-nginx","source":"@site/blog/2021/08/10/apisix-nginx.md","title":"Apache APISIX \u67b6\u6784\u5206\u6790\uff1a\u5982\u4f55\u52a8\u6001\u7ba1\u7406 Nginx \u96c6\u7fa4\uff1f","description":"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4e86\u57fa\u4e8e APISIX 2.8 \u7248\u672c\u3001OpenResty 1.19.3.2 \u7248\u672c\u4ee5\u53ca Nginx 1.19.3 \u7248\u672c\u8fdb\u884c Apache APISIX \u5b9e\u73b0 REST API \u8fdc\u7a0b\u63a7\u5236 Nginx \u96c6\u7fa4\u7684\u539f\u7406\u8bb2\u89e3\u3002","date":"2021-08-10T00:00:00.000Z","formattedDate":"2021\u5e748\u670810\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":22.245,"truncated":true,"authors":[{"name":"\u9676\u8f89"}],"prevItem":{"title":"\u4ece\u65b0\u624b\u6751\u51fa\u6765\uff0c\u6211\u5728 Apache APISIX \u793e\u533a\u53d1\u51fa\u4e86\u7b2c\u4e00\u4e2a PR","permalink":"/zh/blog/2021/08/11/interview-tuzhengsong"},"nextItem":{"title":"Apache APISIX \u5728\u79fb\u52a8\u4e91\u7684\u5e94\u7528","permalink":"/zh/blog/2021/08/09/apache-apisix-in-china-mobile-cloud"}},"content":"> \u672c\u6587\u8f6c\u53d1\u81ea\u9676\u8f89\u4e2a\u4eba\u535a\u5ba2\uff0c\u4e3b\u8981\u4ecb\u7ecd\u4e86\u57fa\u4e8e APISIX 2.8 \u7248\u672c\u3001OpenResty 1.19.3.2 \u7248\u672c\u4ee5\u53ca Nginx 1.19.3 \u7248\u672c\u8fdb\u884c Apache APISIX \u5b9e\u73b0 REST API \u8fdc\u7a0b\u63a7\u5236 Nginx \u96c6\u7fa4\u7684\u539f\u7406\u8bb2\u89e3\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u5f00\u6e90\u7248 Nginx \u6700\u4e3a\u4eba\u8bdf\u75c5\u7684\u5c31\u662f\u4e0d\u5177\u5907\u52a8\u6001\u914d\u7f6e\u3001\u8fdc\u7a0b API \u53ca\u96c6\u7fa4\u7ba1\u7406\u7684\u80fd\u529b\uff0c\u800c Apache APISIX \u4f5c\u4e3a Apache \u57fa\u91d1\u4f1a\u6bd5\u4e1a\u7684\u5f00\u6e90\u4e03\u5c42\u7f51\u5173\uff0c\u57fa\u4e8e etcd \u548c Lua \u5b9e\u73b0\u4e86\u5bf9 Nginx \u96c6\u7fa4\u7684\u52a8\u6001\u7ba1\u7406\u3002\\n\\n![APISIX \u67b6\u6784\u56fe](https://static.apiseven.com/202108/1631170283612-ba5e27ff-726b-47a6-aa51-84731b067c44.png)\\n\\n\u8ba9 Nginx \u5177\u5907\u52a8\u6001\u3001\u96c6\u7fa4\u7ba1\u7406\u80fd\u529b\u5e76\u4e0d\u5bb9\u6613\uff0c\u56e0\u4e3a\u8fd9\u5c06\u9762\u4e34\u4ee5\u4e0b\u95ee\u9898\uff1a\\n\\n* \u5fae\u670d\u52a1\u67b6\u6784\u4f7f\u5f97\u4e0a\u6e38\u670d\u52a1\u79cd\u7c7b\u591a\u3001\u6570\u91cf\u5927\uff0c\u8fd9\u5bfc\u81f4\u8def\u7531\u89c4\u5219\u3001\u4e0a\u6e38 Server \u7684\u53d8\u66f4\u6781\u4e3a\u9891\u7387\u3002\u800c Nginx \u7684\u8def\u7531\u5339\u914d\u662f\u57fa\u4e8e\u9759\u6001\u7684 Trie \u524d\u7f00\u6811\u3001\u54c8\u5e0c\u8868\u3001\u6b63\u5219\u6570\u7ec4\u5b9e\u73b0\u7684\uff0c\u4e00\u65e6`server_name`\u3001`location` \u53d8\u52a8\uff0c\u4e0d\u6267\u884c reload \u5c31\u65e0\u6cd5\u5b9e\u73b0\u914d\u7f6e\u7684\u52a8\u6001\u53d8\u66f4\\n* Nginx \u5c06\u81ea\u5df1\u5b9a\u4f4d\u4e8e ADC \u8fb9\u7f18\u8d1f\u8f7d\u5747\u8861\uff0c\u56e0\u6b64\u5b83\u5bf9\u4e0a\u6e38\u5e76\u4e0d\u652f\u6301 HTTP2 \u534f\u8bae\u3002\u8fd9\u589e\u5927\u4e86 OpenResty \u751f\u6001\u5b9e\u73b0 etcd gRPC \u63a5\u53e3\u7684\u96be\u5ea6\uff0c\u56e0\u6b64\u901a\u8fc7 watch \u673a\u5236\u63a5\u6536\u914d\u7f6e\u53d8\u66f4\u5fc5\u7136\u6548\u7387\u4f4e\u4e0b\\n* \u591a\u8fdb\u7a0b\u67b6\u6784\u589e\u5927\u4e86 Worker \u8fdb\u7a0b\u95f4\u7684\u6570\u636e\u540c\u6b65\u96be\u5ea6\uff0c\u5fc5\u987b\u9009\u62e9 1 \u4e2a\u4f4e\u6210\u672c\u7684\u5b9e\u73b0\u673a\u5236\uff0c\u4fdd\u8bc1\u6bcf\u4e2a Nginx \u8282\u70b9\u3001Worker \u8fdb\u7a0b\u90fd\u6301\u6709\u6700\u65b0\u7684\u914d\u7f6e\\n\\nApache APISIX \u57fa\u4e8e Lua \u5b9a\u65f6\u5668\u53ca lua-resty-etcd \u6a21\u5757\u5b9e\u73b0\u4e86\u914d\u7f6e\u7684\u52a8\u6001\u7ba1\u7406\uff0c\u672c\u6587\u5c06\u57fa\u4e8e APISIX 2.8 \u7248\u672c\u3001OpenResty 1.19.3.2 \u7248\u672c\u4ee5\u53ca Nginx 1.19.3 \u7248\u672c\u8fdb\u884c Apache APISIX \u5b9e\u73b0 REST API \u8fdc\u7a0b\u63a7\u5236 Nginx \u96c6\u7fa4\u7684\u539f\u7406\u3002\\n\\n## \u57fa\u4e8e etcd watch \u673a\u5236\u7684\u914d\u7f6e\u540c\u6b65\u65b9\u6848\\n\\n\u7ba1\u7406\u96c6\u7fa4\u5fc5\u987b\u4f9d\u8d56\u4e2d\u5fc3\u5316\u7684\u914d\u7f6e\uff0cetcd \u5c31\u662f\u8fd9\u6837\u4e00\u4e2a\u6570\u636e\u5e93\u3002Apache APISIX \u6ca1\u6709\u9009\u62e9\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4f5c\u4e3a\u914d\u7f6e\u4e2d\u5fc3\uff0c\u662f\u56e0\u4e3a etcd \u5177\u6709\u4ee5\u4e0b 2 \u4e2a\u4f18\u70b9\uff1a\\n\\n* etcd \u91c7\u7528\u7c7b Paxos \u7684 Raft \u534f\u8bae\u4fdd\u969c\u4e86\u6570\u636e\u4e00\u81f4\u6027\uff0c\u5b83\u662f\u53bb\u4e2d\u5fc3\u5316\u7684\u5206\u5e03\u5f0f\u6570\u636e\u5e93\uff0c\u53ef\u9760\u6027\u9ad8\u4e8e\u5173\u7cfb\u6570\u636e\u5e93\\n* etcd \u7684 watch \u673a\u5236\u5141\u8bb8\u5ba2\u6237\u7aef\u76d1\u63a7\u67d0\u4e2a key \u7684\u53d8\u52a8\uff0c\u5373\uff0c\u82e5\u7c7b\u4f3c /nginx/http/upstream \u8fd9\u79cd key \u7684 value \u503c\u53d1\u751f\u53d8\u52a8\uff0cwatch \u5ba2\u6237\u7aef\u4f1a\u7acb\u523b\u6536\u5230\u901a\u77e5\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![\u57fa\u4e8e etcd \u540c\u6b65 nginx \u914d\u7f6e](https://static.apiseven.com/202108/1631170345853-f020a64d-3e97-49c0-8395-c9e4e9cf4233.jpeg)\\n\\n\u56e0\u6b64\uff0c\u4e0d\u540c\u4e8e Orange \u548c Kong\uff0cApache APISIX \u91c7\u7528\u4e86 etcd \u4f5c\u4e3a\u4e2d\u5fc3\u5316\u7684\u914d\u7f6e\u7ec4\u4ef6\u3002\u4f60\u53ef\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u7684 Apache APISIX \u4e2d\u901a\u8fc7 etcdctl \u770b\u5230\u5982\u4e0b\u7c7b\u4f3c\u914d\u7f6e\uff1a\\n\\n```yaml\\n# etcdctl get  \\"/apisix/upstreams/1\\"\\n/apisix/upstreams/1\\n{\\"hash_on\\":\\"vars\\",\\"nodes\\":{\\"httpbin.org:80\\":1},\\"create_time\\":1627982128,\\"update_time\\":1627982128,\\"scheme\\":\\"http\\",\\"type\\":\\"roundrobin\\",\\"pass_host\\":\\"pass\\",\\"id\\":\\"1\\"}\\n```\\n\\n\u5176\u4e2d\uff0c/apisix \u8fd9\u4e2a\u524d\u7f00\u53ef\u4ee5\u5728 conf/config.yaml \u4e2d\u4fee\u6539\uff0c\u6bd4\u5982\uff1a\\n\\n```yaml\\netcd:\\n  host:  \\n    - \\"http://127.0.0.1:2379\\"\\n  prefix: /apisix                 # apisix configurations prefix\\n```\\n\\n\u800c upstreams/1 \u5c31\u7b49\u4ef7\u4e8e nginx.conf \u4e2d\u7684 http { upstream 1 {} } \u914d\u7f6e\u3002\u7c7b\u4f3c\u5173\u952e\u5b57\u8fd8\u6709 /apisix/services/\u3001/apisix/routes/ \u7b49\u3002\\n\\n\u90a3\u4e48\uff0cNginx \u662f\u600e\u6837\u901a\u8fc7 watch \u673a\u5236\u83b7\u53d6\u5230 etcd \u914d\u7f6e\u6570\u636e\u53d8\u5316\u7684\u5462\uff1f\u6709\u6ca1\u6709\u65b0\u542f\u52a8\u4e00\u4e2a agent \u8fdb\u7a0b\uff1f\u5b83\u901a\u8fc7 HTTP/1.1 \u8fd8\u662f gRPC \u4e0e etcd \u901a\u8baf\u7684\uff1f\\n\\n## ngx.timer.at \u5b9a\u65f6\u5668\\n\\nApache APISIX \u5e76\u6ca1\u6709\u542f\u52a8 Nginx \u4ee5\u5916\u7684\u8fdb\u7a0b\u4e0e etcd \u901a\u8baf\u3002\u5b9e\u9645\u4e0a\u5b83\u662f\u901a\u8fc7 `ngx.timer.at` \u8fd9\u4e2a\u5b9a\u65f6\u5668\u5b9e\u73b0\u4e86 watch \u673a\u5236\u3002\u4e3a\u4e86\u65b9\u4fbf\u5bf9 OpenResty \u4e0d\u592a\u4e86\u89e3\u7684\u540c\u5b66\u7406\u89e3\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b Nginx \u4e2d\u7684\u5b9a\u65f6\u5668\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff0c\u5b83\u662f watch \u673a\u5236\u5b9e\u73b0\u7684\u57fa\u7840\u3002\\n\\n### Nginx \u7684\u7ea2\u9ed1\u6811\u5b9a\u65f6\u5668\\n\\nNginx \u91c7\u7528\u4e86 epoll + nonblock socket \u8fd9\u79cd\u591a\u8def\u590d\u7528\u673a\u5236\u5b9e\u73b0\u4e8b\u4ef6\u5904\u7406\u6a21\u578b\uff0c\u5176\u4e2d\u6bcf\u4e2a worker \u8fdb\u7a0b\u4f1a\u5faa\u73af\u5904\u7406\u7f51\u7edc IO \u53ca\u5b9a\u65f6\u5668\u4e8b\u4ef6\uff1a\\n\\n```c\\n//\u53c2\u89c1 Nginx \u7684 src/os/unix/ngx_process_cycle.c \u6587\u4ef6\\nstatic void\\nngx_worker_process_cycle(ngx_cycle_t *cycle, void *data)\\n{\\n    for ( ;; ) {\\n        ngx_process_events_and_timers(cycle);\\n    }\\n}\\n\\n// \u53c2\u89c1 ngx_proc.c \u6587\u4ef6\\nvoid\\nngx_process_events_and_timers(ngx_cycle_t *cycle)\\n{\\n    timer = ngx_event_find_timer();\\n    (void) ngx_process_events(cycle, timer, flags);\\n    ngx_event_process_posted(cycle, &ngx_posted_accept_events);\\n    ngx_event_expire_timers();\\n    ngx_event_process_posted(cycle, &ngx_posted_events);\\n}\\n```\\n\\n`ngx_event_expire_timers` \u51fd\u6570\u4f1a\u8c03\u7528\u6240\u6709\u8d85\u65f6\u4e8b\u4ef6\u7684 handler \u65b9\u6cd5\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5b9a\u65f6\u5668\u662f\u7531[\u7ea2\u9ed1\u6811](https://zh.wikipedia.org/zh-hans/%E7%BA%A2%E9%BB%91%E6%A0%91)\uff08\u4e00\u79cd\u5e73\u8861\u6709\u5e8f\u4e8c\u53c9\u6811\uff09\u5b9e\u73b0\u7684\uff0c\u5176\u4e2d key \u662f\u6bcf\u4e2a\u4e8b\u4ef6\u7684\u7edd\u5bf9\u8fc7\u671f\u65f6\u95f4\u3002\u8fd9\u6837\uff0c\u53ea\u8981\u5c06\u6700\u5c0f\u8282\u70b9\u4e0e\u5f53\u524d\u65f6\u95f4\u505a\u6bd4\u8f83\uff0c\u5c31\u80fd\u5feb\u901f\u627e\u5230\u8fc7\u671f\u4e8b\u4ef6\u3002\\n\\n### OpenResty \u7684 Lua \u5b9a\u65f6\u5668\\n\\n\u5f53\u7136\uff0c\u4ee5\u4e0a C \u51fd\u6570\u5f00\u53d1\u6548\u7387\u5f88\u4f4e\u3002\u56e0\u6b64\uff0cOpenResty \u5c01\u88c5\u4e86 Lua \u63a5\u53e3\uff0c\u901a\u8fc7 [ngx.timer.at](https://github.com/openresty/lua-nginx-module#ngxtimerat) \u5c06 `ngx_timer_add` \u8fd9\u4e2a C \u51fd\u6570\u66b4\u9732\u7ed9\u4e86 Lua \u8bed\u8a00\uff1a\\n\\n```c\\n//\u53c2\u89c1 OpenResty /ngx_lua-0.10.19/src/ngx_http_lua_timer.c \u6587\u4ef6\\nvoid\\nngx_http_lua_inject_timer_api(lua_State *L)\\n{\\n    lua_createtable(L, 0 /* narr */, 4 /* nrec */);    /* ngx.timer. */\\n\\n    lua_pushcfunction(L, ngx_http_lua_ngx_timer_at);\\n    lua_setfield(L, -2, \\"at\\");\\n\\n    lua_setfield(L, -2, \\"timer\\");\\n}\\nstatic int\\nngx_http_lua_ngx_timer_at(lua_State *L)\\n{\\n    return ngx_http_lua_ngx_timer_helper(L, 0);\\n}\\nstatic int\\nngx_http_lua_ngx_timer_helper(lua_State *L, int every)\\n{\\n    ngx_event_t             *ev = NULL;\\n    ev->handler = ngx_http_lua_timer_handler;\\n    ngx_add_timer(ev, delay);\\n}\\n```\\n\\n\u56e0\u6b64\uff0c\u5f53\u6211\u4eec\u8c03\u7528 `ngx.timer.at`  Lua \u5b9a\u65f6\u5668\u65f6\uff0c\u5c31\u662f\u5728 Nginx \u7684\u7ea2\u9ed1\u6811\u5b9a\u65f6\u5668\u91cc\u52a0\u5165\u4e86 `ngx_http_lua_timer_handler` \u56de\u8c03\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u4e0d\u4f1a\u963b\u585e Nginx\u3002\\n\\n\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b Apache APISIX \u662f\u600e\u6837\u4f7f\u7528 `ngx.timer.at` \u7684\u3002\\n\\n### Apache APISIX \u57fa\u4e8e\u5b9a\u65f6\u5668\u5b9e\u73b0\u7684 watch \u673a\u5236\\n\\nNginx \u6846\u67b6\u4e3a C \u6a21\u5757\u5f00\u53d1\u63d0\u4f9b\u4e86\u8bb8\u591a\u94a9\u5b50\uff0c\u800c OpenResty \u5c06\u90e8\u5206\u94a9\u5b50\u4ee5 Lua \u8bed\u8a00\u5f62\u5f0f\u66b4\u9732\u4e86\u51fa\u6765\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![openresty \u94a9\u5b50](https://static.apiseven.com/202108/1631170424663-53f56c99-aefc-4546-ac0b-76a25a6f0071.png)\\n\\nApache APISIX \u4ec5\u4f7f\u7528\u4e86\u5176\u4e2d 8 \u4e2a\u94a9\u5b50\uff08\u6ce8\u610f\uff0cAPISIX \u6ca1\u6709\u4f7f\u7528 `set_by_lua` \u548c `rewrite_by_lua`\uff0crewrite \u9636\u6bb5\u7684\u63d2\u4ef6\u5176\u5b9e\u662f Apache APISIX \u81ea\u5b9a\u4e49\u7684\uff0c\u4e0e Nginx \u65e0\u5173\uff09\uff0c\u5305\u62ec\uff1a\\n\\n* init_by_lua\uff1aMaster \u8fdb\u7a0b\u542f\u52a8\u65f6\u7684\u521d\u59cb\u5316\\n* init_worker_by_lua\uff1a\u6bcf\u4e2a Worker \u8fdb\u7a0b\u542f\u52a8\u65f6\u7684\u521d\u59cb\u5316\uff08\u5305\u62ec privileged agent \u8fdb\u7a0b\u7684\u521d\u59cb\u5316\uff0c\u8fd9\u662f\u5b9e\u73b0 Java \u7b49\u591a\u8bed\u8a00\u63d2\u4ef6\u8fdc\u7a0b RPC \u8c03\u7528\u7684\u5173\u952e\uff09\\n* ssl_certificate_by_lua\uff1a\u5728\u5904\u7406 TLS \u63e1\u624b\u65f6\uff0copenssl \u63d0\u4f9b\u4e86\u4e00\u4e2a\u94a9\u5b50\uff0cOpenResty \u901a\u8fc7\u4fee\u6539 Nginx \u6e90\u7801\u4ee5 Lua \u65b9\u5f0f\u66b4\u9732\u4e86\u8be5\u94a9\u5b50\\n* access_by_lua\uff1a\u63a5\u6536\u5230\u4e0b\u6e38\u7684 HTTP \u8bf7\u6c42\u5934\u90e8\u540e\uff0c\u5728\u6b64\u5339\u914d Host \u57df\u540d\u3001URI\u3001Method \u7b49\u8def\u7531\u89c4\u5219\uff0c\u5e76\u9009\u62e9 Service\u3001Upstream \u4e2d\u7684\u63d2\u4ef6\u53ca\u4e0a\u6e38 Server\\n* balancer_by_lua\uff1a\u5728 content \u9636\u6bb5\u6267\u884c\u7684\u6240\u6709\u53cd\u5411\u4ee3\u7406\u6a21\u5757\uff0c\u5728\u9009\u62e9\u4e0a\u6e38 Server \u65f6\u90fd\u4f1a\u56de\u8c03 `init_upstream` \u94a9\u5b50\u51fd\u6570\uff0cOpenResty \u5c06\u5176\u547d\u540d\u4e3a `balancer_by_lua`\\n* header_filter_by_lua\uff1a\u5c06 HTTP \u54cd\u5e94\u5934\u90e8\u53d1\u9001\u7ed9\u4e0b\u6e38\u524d\u6267\u884c\u7684\u94a9\u5b50\\n* body_filter_by_lua\uff1a\u5c06 HTTP \u54cd\u5e94\u5305\u4f53\u53d1\u9001\u7ed9\u4e0b\u6e38\u524d\u6267\u884c\u7684\u94a9\u5b50\\n* log_by_lua\uff1a\u8bb0\u5f55 access \u65e5\u5fd7\u65f6\u7684\u94a9\u5b50\\n\\n\u51c6\u5907\u597d\u4e0a\u8ff0\u77e5\u8bc6\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u56de\u7b54 Apache APISIX \u662f\u600e\u6837\u63a5\u6536 etcd \u6570\u636e\u7684\u66f4\u65b0\u4e86\u3002\\n\\n#### nginx.conf \u7684\u751f\u6210\u65b9\u5f0f\\n\\n\u6bcf\u4e2a Nginx Worker \u8fdb\u7a0b\u90fd\u4f1a\u5728 `init_worker_by_lua` \u9636\u6bb5\u901a\u8fc7 `http_init_worker` \u51fd\u6570\u542f\u52a8\u5b9a\u65f6\u5668\uff1a\\n\\n```lua\\ninit_worker_by_lua_block {\\n    apisix.http_init_worker()\\n}\\n```\\n\\n\u4f60\u53ef\u80fd\u5f88\u597d\u5947\uff0c\u4e0b\u8f7d Apache APISIX \u6e90\u7801\u540e\u6ca1\u6709\u770b\u5230 nginx.conf\uff0c\u8fd9\u6bb5\u914d\u7f6e\u662f\u54ea\u6765\u7684\uff1f\\n\\n\u8fd9\u91cc\u7684 nginx.conf \u5b9e\u9645\u662f\u7531 Apache APISIX \u7684\u542f\u52a8\u547d\u4ee4\u5b9e\u65f6\u751f\u6210\u7684\u3002\u5f53\u4f60\u6267\u884c make run \u65f6\uff0c\u5b83\u4f1a\u57fa\u4e8e Lua \u6a21\u677f apisix/cli/ngx_tpl.lua \u6587\u4ef6\u751f\u6210 nginx.conf\u3002\u8bf7\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u6a21\u677f\u89c4\u5219\u662f OpenResty \u81ea\u5b9e\u73b0\u7684\uff0c\u8bed\u6cd5\u7ec6\u8282\u53c2\u89c1 [lua-resty-template](https://github.com/bungle/lua-resty-template)\u3002\u751f\u6210 nginx.conf \u7684\u5177\u4f53\u4ee3\u7801\u53c2\u89c1 apisix/cli/ops.lua \u6587\u4ef6\uff1a\\n\\n```lua\\nlocal template = require(\\"resty.template\\")\\nlocal ngx_tpl = require(\\"apisix.cli.ngx_tpl\\")\\nlocal function init(env)\\n    local yaml_conf, err = file.read_yaml_conf(env.apisix_home)\\n    local conf_render = template.compile(ngx_tpl)\\n    local ngxconf = conf_render(sys_conf)\\n\\n    local ok, err = util.write_file(env.apisix_home .. \\"/conf/nginx.conf\\",\\n                                    ngxconf)\\n```\\n\\n\u5f53\u7136\uff0cApache APISIX \u5141\u8bb8\u7528\u6237\u4fee\u6539 nginx.conf \u6a21\u677f\u4e2d\u7684\u90e8\u5206\u6570\u636e\uff0c\u5177\u4f53\u65b9\u6cd5\u662f\u6a21\u4eff conf/config-default.yaml \u7684\u8bed\u6cd5\u4fee\u6539 conf/config.yaml \u914d\u7f6e\u3002\u5176\u5b9e\u73b0\u539f\u7406\u53c2\u89c1 `read_yaml_conf` \u51fd\u6570\uff1a\\n\\n```lua\\nfunction _M.read_yaml_conf(apisix_home)\\n    local local_conf_path = profile:yaml_path(\\"config-default\\")\\n    local default_conf_yaml, err = util.read_file(local_conf_path)\\n\\n    local_conf_path = profile:yaml_path(\\"config\\")\\n    local user_conf_yaml, err = util.read_file(local_conf_path)\\n    ok, err = merge_conf(default_conf, user_conf)\\nend\\n```\\n\\n\u53ef\u89c1\uff0cngx_tpl.lua \u6a21\u677f\u4e2d\u4ec5\u90e8\u5206\u6570\u636e\u53ef\u7531 yaml \u914d\u7f6e\u4e2d\u66ff\u6362\uff0c\u5176\u4e2d conf/config-default.yaml \u662f\u5b98\u65b9\u63d0\u4f9b\u7684\u9ed8\u8ba4\u914d\u7f6e\uff0c\u800c conf/config.yaml \u5219\u662f\u7531\u7528\u6237\u81ea\u884c\u8986\u76d6\u7684\u81ea\u5b9a\u4e49\u914d\u7f6e\u3002\u5982\u679c\u4f60\u89c9\u5f97\u4ec5\u66ff\u6362\u6a21\u677f\u6570\u636e\u8fd8\u4e0d\u591f\uff0c\u5927\u53ef\u76f4\u63a5\u4fee\u6539 ngx_tpl \u6a21\u677f\u3002\\n\\n#### Apache APISIX \u83b7\u53d6 etcd \u901a\u77e5\u7684\u65b9\u5f0f\\n\\nApache APISIX \u5c06\u9700\u8981\u76d1\u63a7\u7684\u914d\u7f6e\u4ee5\u4e0d\u540c\u7684\u524d\u7f00\u5b58\u5165\u4e86 etcd\uff0c\u76ee\u524d\u5305\u62ec\u4ee5\u4e0b 11 \u79cd\uff1a\\n\\n* /apisix/consumers/\uff1aApache APISIX \u652f\u6301\u4ee5 consumer \u62bd\u8c61\u4e0a\u6e38\u79cd\u7c7b\\n* /apisix/global_rules/\uff1a\u5168\u5c40\u901a\u7528\u7684\u89c4\u5219\\n* /apisix/plugin_configs/\uff1a\u53ef\u4ee5\u5728\u4e0d\u540c Router \u95f4\u590d\u7528\u7684 Plugin\\n* /apisix/plugin_metadata/\uff1a\u90e8\u5206\u63d2\u4ef6\u7684\u5143\u6570\u636e\\n* /apisix/plugins/\uff1a\u6240\u6709 Plugin \u63d2\u4ef6\u7684\u5217\u8868\\n* /apisix/proto/\uff1a\u5f53\u900f\u4f20 gRPC \u534f\u8bae\u65f6\uff0c\u90e8\u5206\u63d2\u4ef6\u9700\u8981\u8f6c\u6362\u534f\u8bae\u5185\u5bb9\uff0c\u8be5\u914d\u7f6e\u5b58\u50a8 protobuf \u6d88\u606f\u5b9a\u4e49\\n* /apisix/routes/\uff1a\u8def\u7531\u4fe1\u606f\uff0c\u662f HTTP \u8bf7\u6c42\u5339\u914d\u7684\u5165\u53e3\uff0c\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a\u4e0a\u6e38 Server\uff0c\u4e5f\u53ef\u4ee5\u6302\u8f7d services \u6216\u8005 upstream\\n* /apisix/services/\uff1a\u53ef\u4ee5\u5c06\u76f8\u4f3c\u7684 router \u4e2d\u7684\u5171\u6027\u90e8\u5206\u62bd\u8c61\u4e3a services\uff0c\u518d\u6302\u8f7d plugin\\n* /apisix/ssl/\uff1aSSL \u8bc1\u4e66\u516c\u3001\u79c1\u94a5\u53ca\u76f8\u5173\u5339\u914d\u89c4\u5219\\n* /apisix/stream_routes/\uff1aOSI \u56db\u5c42\u7f51\u5173\u7684\u8def\u7531\u5339\u914d\u89c4\u5219\\n* /apisix/upstreams/\uff1a\u5bf9\u4e00\u7ec4\u4e0a\u6e38 Server \u4e3b\u673a\u7684\u62bd\u8c61\\n\\n\u8fd9\u91cc\u6bcf\u7c7b\u914d\u7f6e\u5bf9\u5e94\u7684\u5904\u7406\u903b\u8f91\u90fd\u4e0d\u76f8\u540c\uff0c\u56e0\u6b64 Apache APISIX \u62bd\u8c61\u51fa apisix/core/config_etcd.lua \u6587\u4ef6\uff0c\u4e13\u6ce8 etcd \u4e0a\u5404\u7c7b\u914d\u7f6e\u7684\u66f4\u65b0\u7ef4\u62a4\u3002\u5728 `http_init_worker` \u51fd\u6570\u4e2d\u6bcf\u7c7b\u914d\u7f6e\u90fd\u4f1a\u751f\u6210 1 \u4e2a config_etcd \u5bf9\u8c61\uff1a\\n\\n```lua\\nfunction _M.init_worker()\\n    local err\\n    plugin_configs, err = core.config.new(\\"/plugin_configs\\", {\\n        automatic = true,\\n        item_schema = core.schema.plugin_config,\\n        checker = plugin_checker,\\n    })\\nend\\n```\\n\\n\u800c\u5728 `config_etcd` \u7684 new \u51fd\u6570\u4e2d\uff0c\u5219\u4f1a\u5faa\u73af\u6ce8\u518c `_automatic_fetch` \u5b9a\u65f6\u5668:\\n\\n```lua\\nfunction _M.new(key, opts)\\n    ngx_timer_at(0, _automatic_fetch, obj)\\nend\\n```\\n\\n`_automatic_fetch` \u51fd\u6570\u4f1a\u53cd\u590d\u6267\u884c `sync_data` \u51fd\u6570\uff08\u5305\u88c5\u5230 xpcall \u4e4b\u4e0b\u662f\u4e3a\u4e86\u6355\u83b7\u5f02\u5e38\uff09\uff1a\\n\\n```lua\\nlocal function _automatic_fetch(premature, self)\\n    local ok, err = xpcall(function()\\n        local ok, err = sync_data(self)\\n    end, debug.traceback)\\n    ngx_timer_at(0, _automatic_fetch, self)\\nend\\n```\\n\\n`sync_data` \u51fd\u6570\u5c06\u901a\u8fc7 etcd \u7684 watch \u673a\u5236\u83b7\u53d6\u66f4\u65b0\uff0c\u5b83\u7684\u5b9e\u73b0\u673a\u5236\u6211\u4eec\u63a5\u4e0b\u6765\u4f1a\u8be6\u7ec6\u5206\u6790\u3002\\n\\n\u6240\u4ee5\u603b\u7ed3\u6765\u770b\uff0cApache APISIX \u5728\u6bcf\u4e2a Nginx Worker \u8fdb\u7a0b\u7684\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u901a\u8fc7 `ngx.timer.at` \u51fd\u6570\u5c06 `_automatic_fetch` \u63d2\u5165\u5b9a\u65f6\u5668\u3002`_automatic_fetch` \u51fd\u6570\u6267\u884c\u65f6\u4f1a\u901a\u8fc7 `sync_data` \u51fd\u6570\uff0c\u57fa\u4e8e watch \u673a\u5236\u63a5\u6536 etcd \u4e2d\u7684\u914d\u7f6e\u53d8\u66f4\u901a\u77e5\uff0c\u8fd9\u6837\uff0c\u6bcf\u4e2a Nginx \u8282\u70b9\u3001Worker \u8fdb\u7a0b\u90fd\u5c06\u4fdd\u6301\u6700\u65b0\u7684\u914d\u7f6e\u3002\u5982\u6b64\u8bbe\u8ba1\u8fd8\u6709 1 \u4e2a\u660e\u663e\u7684\u4f18\u70b9\uff1aetcd \u4e2d\u7684\u914d\u7f6e\u76f4\u63a5\u5199\u5165 Nginx Worker \u8fdb\u7a0b\u4e2d\uff0c\u8fd9\u6837\u5904\u7406\u8bf7\u6c42\u65f6\u5c31\u80fd\u76f4\u63a5\u4f7f\u7528\u65b0\u914d\u7f6e\uff0c\u65e0\u987b\u5728\u8fdb\u7a0b\u95f4\u540c\u6b65\u914d\u7f6e\uff0c\u8fd9\u8981\u6bd4\u542f\u52a8 1 \u4e2a agent \u8fdb\u7a0b\u66f4\u7b80\u5355\uff01\\n\\n### lua-resty-etcd \u5e93\u7684 HTTP/1.1 \u534f\u8bae\\n\\n`sync_data` \u51fd\u6570\u5230\u5e95\u662f\u600e\u6837\u83b7\u53d6 etcd \u7684\u914d\u7f6e\u53d8\u66f4\u6d88\u606f\u7684\u5462\uff1f\u5148\u770b\u4e0b `sync_data` \u6e90\u7801\uff1a\\n\\n```lua\\nlocal etcd         = require(\\"resty.etcd\\")\\netcd_cli, err = etcd.new(etcd_conf)\\n\\nlocal function sync_data(self)\\n    local dir_res, err = waitdir(self.etcd_cli, self.key, self.prev_index + 1, self.timeout)\\nend\\n\\nlocal function waitdir(etcd_cli, key, modified_index, timeout)\\n    local res_func, func_err, http_cli = etcd_cli:watchdir(key, opts)\\n    if http_cli then\\n        local res_cancel, err_cancel = etcd_cli:watchcancel(http_cli)\\n    end\\nend\\n```\\n\\n\u8fd9\u91cc\u5b9e\u9645\u4e0e etcd \u901a\u8baf\u7684\u662f [lua-resty-etcd](https://github.com/api7/lua-resty-etcd) \u5e93\u3002\u5b83\u63d0\u4f9b\u7684 watchdir \u51fd\u6570\u7528\u4e8e\u63a5\u6536 etcd \u53d1\u73b0 key \u76ee\u5f55\u5bf9\u5e94 value \u53d8\u66f4\u540e\u53d1\u51fa\u7684\u901a\u77e5\u3002\\n\\nwatchcancel \u51fd\u6570\u53c8\u662f\u505a\u4ec0\u4e48\u7684\u5462\uff1f\u8fd9\u5176\u5b9e\u662f OpenResty \u751f\u6001\u7684\u7f3a\u61be\u5bfc\u81f4\u7684\u3002etcd v3 \u5df2\u7ecf\u652f\u6301\u9ad8\u6548\u7684 gRPC \u534f\u8bae\uff08\u5e95\u5c42\u4e3a HTTP2 \u534f\u8bae\uff09\u3002\u4f60\u53ef\u80fd\u542c\u8bf4\u8fc7\uff0cHTTP2 \u4e0d\u4f46\u5177\u5907\u591a\u8def\u590d\u7528\u7684\u80fd\u529b\uff0c\u8fd8\u652f\u6301\u670d\u52a1\u5668\u76f4\u63a5\u63a8\u9001\u6d88\u606f\uff0c\u4ece HTTP3 \u534f\u8bae\u5bf9\u7167\u7406\u89e3 HTTP2 \uff1a\\n\\n![http2_stream_frame_conn](https://static.apiseven.com/202108/1631170499370-57a7c452-e97e-4ac0-b7bf-073e13946a21.png)\\n\\n\u7136\u800c\uff0cLua \u751f\u6001\u76ee\u524d\u5e76\u4e0d\u652f\u6301 HTTP2 \u534f\u8bae\uff0c\u6240\u4ee5 lua-resty-etcd \u5e93\u5b9e\u9645\u662f\u901a\u8fc7\u4f4e\u6548\u7684 HTTP/1.1 \u534f\u8bae\u4e0e etcd \u901a\u8baf\u7684\uff0c\u56e0\u6b64\u63a5\u6536 /watch \u901a\u77e5\u4e5f\u662f\u901a\u8fc7\u5e26\u6709\u8d85\u65f6\u7684 /v3/watch \u8bf7\u6c42\u5b8c\u6210\u7684\u3002\u8fd9\u4e2a\u73b0\u8c61\u5176\u5b9e\u662f\u7531 2 \u4e2a\u539f\u56e0\u9020\u6210\u7684\uff1a\\n\\n1. Nginx \u5c06\u81ea\u5df1\u5b9a\u4f4d\u4e3a\u8fb9\u7f18\u8d1f\u8f7d\u5747\u8861\uff0c\u56e0\u6b64\u4e0a\u6e38\u5fc5\u7136\u662f\u4f01\u4e1a\u5185\u7f51\uff0c\u65f6\u5ef6\u4f4e\u3001\u5e26\u5bbd\u5927\uff0c\u6240\u4ee5\u5bf9\u4e0a\u6e38\u534f\u8bae\u4e0d\u5fc5\u652f\u6301 HTTP2 \u534f\u8bae\\n2. \u5f53 Nginx \u7684 upstream \u4e0d\u80fd\u63d0\u4f9b HTTP2 \u673a\u5236\u7ed9 Lua \u65f6\uff0cLua \u53ea\u80fd\u57fa\u4e8e cosocket \u81ea\u5df1\u5b9e\u73b0\u4e86\u3002HTTP2 \u534f\u8bae\u975e\u5e38\u590d\u6742\uff0c\u76ee\u524d\u8fd8\u6ca1\u6709\u751f\u4ea7\u73af\u5883\u53ef\u7528\u7684 HTTP2 cosocket \u5e93\u3002\\n\\n\u4f7f\u7528 HTTP/1.1 \u7684 lua-resty-etcd \u5e93\u5176\u5b9e\u5f88\u4f4e\u6548\uff0c\u5982\u679c\u4f60\u5728 APISIX \u4e0a\u6293\u5305\uff0c\u4f1a\u770b\u5230\u9891\u7e41\u7684 POST \u62a5\u6587\uff0c\u5176\u4e2d URI \u4e3a /v3/watch\uff0c\u800c Body \u662f Base64 \u7f16\u7801\u7684 watch \u76ee\u5f55\uff1a\\n\\n![APISIX \u4e0e etcd \u901a\u8fc7 HTTP1 \u901a\u8baf](https://static.apiseven.com/202108/1631170602368-d105d014-efe4-48c7-93b8-be5447c76a70.jpeg)\\n\\n\u6211\u4eec\u53ef\u4ee5\u9a8c\u8bc1\u4e0b `watchdir` \u51fd\u6570\u7684\u5b9e\u73b0\u7ec6\u8282\uff1a\\n\\n```lua\\n-- lib/resty/etcd/v3.lua \u6587\u4ef6\\nfunction _M.watchdir(self, key, opts)\\n    return watch(self, key, attr)\\nend\\n\\nlocal function watch(self, key, attr)\\n    callback_fun, err, http_cli = request_chunk(self, \'POST\', \'/watch\',\\n                                                opts, attr.timeout or self.timeout)\\n    return callback_fun\\nend\\n\\nlocal function request_chunk(self, method, path, opts, timeout)\\n    http_cli, err = utils.http.new()\\n    -- \u53d1\u8d77 TCP \u8fde\u63a5\\n    endpoint, err = http_request_chunk(self, http_cli)\\n    -- \u53d1\u9001 HTTP \u8bf7\u6c42\\n    res, err = http_cli:request({\\n        method  = method,\\n        path    = endpoint.api_prefix .. path,\\n        body    = body,\\n        query   = query,\\n        headers = headers,\\n    })\\nend\\n\\nlocal function http_request_chunk(self, http_cli)\\n    local endpoint, err = choose_endpoint(self)\\n    ok, err = http_cli:connect({\\n        scheme = endpoint.scheme,\\n        host = endpoint.host,\\n        port = endpoint.port,\\n        ssl_verify = self.ssl_verify,\\n        ssl_cert_path = self.ssl_cert_path,\\n        ssl_key_path = self.ssl_key_path,\\n    })\\n\\n    return endpoint, err\\nend\\n```\\n\\n\u53ef\u89c1\uff0cApache APISIX \u5728\u6bcf\u4e2a worker \u8fdb\u7a0b\u4e2d\uff0c**\u901a\u8fc7 `ngx.timer.at` \u548c lua-resty-etcd \u5e93\u53cd\u590d\u8bf7\u6c42 etcd\uff0c\u4ee5\u6b64\u4fdd\u8bc1\u6bcf\u4e2a Worker \u8fdb\u7a0b\u4e2d\u90fd\u542b\u6709\u6700\u65b0\u7684\u914d\u7f6e\u3002**\\n\\n## APISIX \u914d\u7f6e\u4e0e\u63d2\u4ef6\u7684\u8fdc\u7a0b\u53d8\u66f4\\n\\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u770b\u600e\u6837\u8fdc\u7a0b\u4fee\u6539 etcd \u4e2d\u7684\u914d\u7f6e\u3002\\n\\n\u6211\u4eec\u5f53\u7136\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 gRPC \u63a5\u53e3\u4fee\u6539 etcd \u4e2d\u76f8\u5e94 key \u7684\u5185\u5bb9\uff0c\u518d\u57fa\u4e8e\u4e0a\u8ff0\u7684 watch \u673a\u5236\u4f7f\u5f97 Nginx \u96c6\u7fa4\u81ea\u52a8\u66f4\u65b0\u914d\u7f6e\u3002\u7136\u800c\uff0c\u8fd9\u6837\u505a\u7684\u98ce\u9669\u5f88\u5927\uff0c\u56e0\u4e3a\u914d\u7f6e\u8bf7\u6c42\u6ca1\u6709\u7ecf\u8fc7\u6821\u9a8c\uff0c\u8fdb\u9762\u5bfc\u81f4\u914d\u7f6e\u6570\u636e\u4e0e Nginx \u96c6\u7fa4\u4e0d\u5339\u914d\u3002\\n\\n### \u901a\u8fc7 Nginx \u7684 /apisix/admin/ \u63a5\u53e3\u4fee\u6539\u914d\u7f6e\\n\\nApache APISIX \u63d0\u4f9b\u4e86\u8fd9\u4e48\u4e00\u79cd\u673a\u5236\uff1a\u8bbf\u95ee\u4efb\u610f 1 \u4e2a Nginx \u8282\u70b9\uff0c\u901a\u8fc7\u5176 Worker \u8fdb\u7a0b\u4e2d\u7684 Lua \u4ee3\u7801\u6821\u9a8c\u8bf7\u6c42\u6210\u529f\u540e\uff0c\u518d\u7531 /v3/dv/put \u63a5\u53e3\u5199\u5165 etcd \u4e2d\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b Apache APISIX \u662f\u600e\u4e48\u5b9e\u73b0\u7684\u3002\\n\\n\u9996\u5148\uff0cmake run \u751f\u6210\u7684 nginx.conf \u4f1a\u81ea\u52a8\u76d1\u542c 9080 \u7aef\u53e3\uff08\u53ef\u901a\u8fc7 config.yaml \u4e2d apisix.node_listen \u914d\u7f6e\u4fee\u6539\uff09\uff0c\u5f53 `apisix.enable_admin` \u8bbe\u7f6e\u4e3a true \u65f6\uff0cnginx.conf \u5c31\u4f1a\u751f\u6210\u4ee5\u4e0b\u914d\u7f6e\uff1a\\n\\n```yaml\\nserver {\\n    listen 9080 default_server reuseport;\\n\\n    location/apisix/admin {\\n        content_by_lua_block {\\n            apisix.http_admin()\\n        }\\n    }\\n}\\n\\n```\\n\\n\u8fd9\u6837\uff0cNginx \u63a5\u6536\u5230\u7684 /apisix/admin \u8bf7\u6c42\u5c06\u88ab `http_admin` \u51fd\u6570\u5904\u7406\uff1a\\n\\n```lua\\n-- /apisix/init.lua \u6587\u4ef6\\nfunction _M.http_admin()\\n    local ok = router:dispatch(get_var(\\"uri\\"), {method = get_method()})\\nend\\n```\\n\\nadmin \u63a5\u53e3\u80fd\u591f\u5904\u7406\u7684 API \u53c2\u89c1 [GitHub](https://github.com/apache/apisix/blob/release/2.8/docs/zh/latest/admin-api.md) \u6587\u6863\uff0c\u5176\u4e2d\uff0c\u5f53 method \u65b9\u6cd5\u4e0e URI \u4e0d\u540c\u65f6\uff0cdispatch \u4f1a\u6267\u884c\u4e0d\u540c\u7684\u5904\u7406\u51fd\u6570\uff0c\u5176\u4f9d\u636e\u5982\u4e0b\uff1a\\n\\n```lua\\n-- /apisix/admin/init.lua \u6587\u4ef6\\nlocal uri_route = {\\n    {\\n        paths = [[/apisix/admin/*]],\\n        methods = {\\"GET\\", \\"PUT\\", \\"POST\\", \\"DELETE\\", \\"PATCH\\"},\\n        handler = run,\\n    },\\n    {\\n        paths = [[/apisix/admin/stream_routes/*]],\\n        methods = {\\"GET\\", \\"PUT\\", \\"POST\\", \\"DELETE\\", \\"PATCH\\"},\\n        handler = run_stream,\\n    },\\n    {\\n        paths = [[/apisix/admin/plugins/list]],\\n        methods = {\\"GET\\"},\\n        handler = get_plugins_list,\\n    },\\n    {\\n        paths = reload_event,\\n        methods = {\\"PUT\\"},\\n        handler = post_reload_plugins,\\n    },\\n}\\n```\\n\\n\u6bd4\u5982\uff0c\u5f53\u901a\u8fc7 /apisix/admin/upstreams/1 \u548c PUT \u65b9\u6cd5\u521b\u5efa 1 \u4e2a Upstream \u4e0a\u6e38\u65f6\uff1a\\n\\n```shell\\ncurl \\"http://127.0.0.1:9080/apisix/admin/upstreams/1\\" -H \\"X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\\" -X PUT -d \'\\n> {\\n>   \\"type\\": \\"roundrobin\\",\\n>   \\"nodes\\": {\\n>     \\"httpbin.org:80\\": 1\\n>   }\\n> }\\n{\\"action\\":\\"set\\",\\"node\\":{\\"key\\":\\"\\\\/apisix\\\\/upstreams\\\\/1\\",\\"value\\":{\\"hash_on\\":\\"vars\\",\\"nodes\\":{\\"httpbin.org:80\\":1},\\"create_time\\":1627982128,\\"update_time\\":1627982128,\\"scheme\\":\\"http\\",\\"type\\":\\"roundrobin\\",\\"pass_host\\":\\"pass\\",\\"id\\":\\"1\\"}}}\'\\n```\\n\\n\u4f60\u4f1a\u5728 error.log \u4e2d\u4f1a\u770b\u5230\u5982\u4e0b\u65e5\u5fd7\uff08\u60f3\u770b\u5230\u8fd9\u884c\u65e5\u5fd7\uff0c\u5fc5\u987b\u5c06 config.yaml \u4e2d\u7684 nginx_config.error_log_level \u8bbe\u4e3a INFO\uff09\uff1a\\n\\n```yaml\\n2021/08/03 17:15:28 [info] 16437#16437: *23572 [lua] init.lua:130: handler(): uri: [\\"\\",\\"apisix\\",\\"admin\\",\\"upstreams\\",\\"1\\"], client: 127.0.0.1, server: _, request: \\"PUT /apisix/admin/upstreams/1 HTTP/1.1\\", host: \\"127.0.0.1:9080\\"\\n```\\n\\n\u8fd9\u884c\u65e5\u5fd7\u5b9e\u9645\u662f\u7531 /apisix/admin/init.lua \u4e2d\u7684 `run` \u51fd\u6570\u6253\u5370\u7684\uff0c\u5b83\u7684\u6267\u884c\u4f9d\u636e\u662f\u4e0a\u9762\u7684 uri_route \u5b57\u5178\u3002\u6211\u4eec\u770b\u4e0b run \u51fd\u6570\u7684\u5185\u5bb9\uff1a\\n\\n```lua\\n-- /apisix/admin/init.lua\u6587\u4ef6\\nlocal function run()\\n    local uri_segs = core.utils.split_uri(ngx.var.uri)\\n    core.log.info(\\"uri: \\", core.json.delay_encode(uri_segs))\\n\\n    local seg_res, seg_id = uri_segs[4], uri_segs[5]\\n    local seg_sub_path = core.table.concat(uri_segs, \\"/\\", 6)\\n\\n    local resource = resources[seg_res]\\n    local code, data = resource[method](seg_id, req_body, seg_sub_path,\\n                                        uri_args)\\nend\\n```\\n\\n\u8fd9\u91cc `resource[method]` \u51fd\u6570\u53c8\u88ab\u505a\u4e86 1 \u6b21\u62bd\u8c61\uff0c\u5b83\u662f\u7531 resources \u5b57\u5178\u51b3\u5b9a\u7684\uff1a\\n\\n```lua\\n-- /apisix/admin/init.lua\u6587\u4ef6\\nlocal resources = {\\n    routes          = require(\\"apisix.admin.routes\\"),\\n    services        = require(\\"apisix.admin.services\\"),\\n    upstreams       = require(\\"apisix.admin.upstreams\\"),\\n    consumers       = require(\\"apisix.admin.consumers\\"),\\n    schema          = require(\\"apisix.admin.schema\\"),\\n    ssl             = require(\\"apisix.admin.ssl\\"),\\n    plugins         = require(\\"apisix.admin.plugins\\"),\\n    proto           = require(\\"apisix.admin.proto\\"),\\n    global_rules    = require(\\"apisix.admin.global_rules\\"),\\n    stream_routes   = require(\\"apisix.admin.stream_routes\\"),\\n    plugin_metadata = require(\\"apisix.admin.plugin_metadata\\"),\\n    plugin_configs  = require(\\"apisix.admin.plugin_config\\"),\\n}\\n```\\n\\n\u56e0\u6b64\uff0c\u4e0a\u9762\u7684 curl \u8bf7\u6c42\u5c06\u88ab /apisix/admin/upstreams.lua \u6587\u4ef6\u7684 `put` \u51fd\u6570\u5904\u7406\uff0c\u770b\u4e0b `put` \u51fd\u6570\u7684\u5b9e\u73b0\uff1a\\n\\n```lua\\n-- /apisix/admin/upstreams.lua\u6587\u4ef6\\nfunction _M.put(id, conf)\\n    -- \u6821\u9a8c\u8bf7\u6c42\u6570\u636e\u7684\u5408\u6cd5\u6027\\n    local id, err = check_conf(id, conf, true)\\n    local key = \\"/upstreams/\\" .. id\\n    core.log.info(\\"key: \\", key)\\n    -- \u751f\u6210etcd\u4e2d\u7684\u914d\u7f6e\u6570\u636e\\n    local ok, err = utils.inject_conf_with_prev_conf(\\"upstream\\", key, conf)\\n    -- \u5199\u5165etcd\\n    local res, err = core.etcd.set(key, conf)\\nend\\n\\n-- /apisix/core/etcd.lua\\nlocal function set(key, value, ttl)\\n    local res, err = etcd_cli:set(prefix .. key, value, {prev_kv = true, lease = data.body.ID})\\nend\\n```\\n\\n\u6700\u7ec8\u65b0\u914d\u7f6e\u88ab\u5199\u5165 etcd \u4e2d\u3002\u53ef\u89c1\uff0cNginx \u4f1a\u6821\u9a8c\u6570\u636e\u518d\u5199\u5165 etcd\uff0c\u8fd9\u6837\u5176\u4ed6 Worker \u8fdb\u7a0b\u3001Nginx \u8282\u70b9\u90fd\u5c06\u901a\u8fc7 watch \u673a\u5236\u63a5\u6536\u5230\u6b63\u786e\u7684\u914d\u7f6e\u3002\u4e0a\u8ff0\u6d41\u7a0b\u4f60\u53ef\u4ee5\u901a\u8fc7 error.log \u4e2d\u7684\u65e5\u5fd7\u9a8c\u8bc1\uff1a\\n\\n```yaml\\n2021/08/03 17:15:28 [info] 16437#16437: *23572 [lua] upstreams.lua:72: key: /upstreams/1, client: 127.0.0.1, server: _, request: \\"PUT /apisix/admin/upstreams/1 HTTP/1.1\\", host: \\"127.0.0.1:9080\\"\\n```\\n\\n### \u4e3a\u4ec0\u4e48\u65b0\u914d\u7f6e\u4e0d reload \u5c31\u53ef\u4ee5\u751f\u6548\\n\\n\u6211\u4eec\u518d\u6765\u770b admin \u8bf7\u6c42\u6267\u884c\u5b8c Nginx Worker \u8fdb\u7a0b\u53ef\u4ee5\u7acb\u523b\u751f\u6548\u7684\u539f\u7406\u3002\\n\\n\u5f00\u6e90\u7248 Nginx \u7684\u8bf7\u6c42\u5339\u914d\u662f\u57fa\u4e8e 3 \u79cd\u4e0d\u540c\u7684\u5bb9\u5668\u8fdb\u884c\u7684\uff1a\\n\\n1. \u5c06\u9759\u6001\u54c8\u5e0c\u8868\u4e2d\u7684 `server_name` \u914d\u7f6e\u4e0e\u8bf7\u6c42\u7684 `Host` \u57df\u540d\u5339\u914d\\n2. \u5176\u6b21\u5c06\u9759\u6001 Trie \u524d\u7f00\u6811\u4e2d\u7684 location \u914d\u7f6e\u4e0e\u8bf7\u6c42\u7684 URI \u5339\u914d\\n\\n    ![location \u524d\u7f00\u6811\u7684\u5339\u914d\u6d41\u7a0b 2](https://static.apiseven.com/202108/1631170657240-31bb3ff3-ee3b-4831-99ff-77cab1d6e298.png)\\n\\n3. \u5728\u4e0a\u8ff0\u4e24\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u542b\u6709\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5219\u57fa\u4e8e\u6570\u7ec4\u987a\u5e8f\uff08\u5728 nginx.conf \u4e2d\u51fa\u73b0\u7684\u6b21\u5e8f\uff09\u4f9d\u6b21\u5339\u914d\u3002\\n\\n\u4e0a\u8ff0\u8fc7\u7a0b\u867d\u7136\u6267\u884c\u6548\u7387\u6781\u9ad8\uff0c\u5374\u662f\u5199\u6b7b\u5728 find_config \u9636\u6bb5\u53ca Nginx HTTP \u6846\u67b6\u4e2d\u7684\uff0c\u4e00\u65e6\u53d8\u66f4\u5fc5\u987b\u5728 nginx -s reload \u540e\u624d\u80fd\u751f\u6548\u3002\u56e0\u6b64\uff0cApache APISIX \u7d22\u6027\u5b8c\u5168\u629b\u5f03\u4e86\u4e0a\u8ff0\u6d41\u7a0b\u3002\\n\\n\u4ece nginx.conf \u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u8bbf\u95ee\u4efb\u610f\u57df\u540d\u3001URI \u7684\u8bf7\u6c42\u90fd\u4f1a\u5339\u914d\u5230 `http_access_phase` \u8fd9\u4e2a lua \u51fd\u6570\uff1a\\n\\n```lua\\nserver {\\n    server_name _;\\n    location / {\\n        access_by_lua_block {\\n            apisix.http_access_phase()\\n        }\\n        proxy_pass      $upstream_scheme://apisix_backend$upstream_uri;\\n    }\\n}\\n```\\n\\n\u800c\u5728 `http_access_phase` \u51fd\u6570\u4e2d\uff0c\u5c06\u4f1a\u57fa\u4e8e 1 \u4e2a\u7528 C \u8bed\u8a00\u5b9e\u73b0\u7684\u57fa\u6570\u524d\u7f00\u6811\u5339\u914d Method\u3001\u57df\u540d\u548c URI\uff08\u4ec5\u652f\u6301\u901a\u914d\u7b26\uff0c\u4e0d\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\uff0c\u8fd9\u4e2a\u5e93\u5c31\u662f [lua-resty-radixtree](https://github.com/api7/lua-resty-radixtree)\u3002\u6bcf\u5f53\u8def\u7531\u89c4\u5219\u53d1\u751f\u53d8\u5316\uff0cLua \u4ee3\u7801\u5c31\u4f1a\u91cd\u5efa\u8fd9\u68f5\u57fa\u6570\u6811\uff1a\\n\\n```lua\\nfunction _M.match(api_ctx)\\n    if not cached_version or cached_version ~= user_routes.conf_version then\\n        uri_router = base_router.create_radixtree_uri_router(user_routes.values,\\n                                                             uri_routes, false)\\n        cached_version = user_routes.conf_version\\n    end\\nend\\n```\\n\\n\u8fd9\u6837\uff0c\u8def\u7531\u53d8\u5316\u540e\u5c31\u53ef\u4ee5\u4e0d reload \u800c\u4f7f\u5176\u751f\u6548\u3002Plugin \u542f\u7528\u3001\u53c2\u6570\u53ca\u987a\u5e8f\u8c03\u6574\u7684\u89c4\u5219\u4e0e\u6b64\u7c7b\u4f3c\u3002\\n\\n\u6700\u540e\u518d\u63d0\u4e0b Script\uff0c\u5b83\u4e0e Plugin \u662f\u4e92\u65a5\u7684\u3002\u4e4b\u524d\u7684\u52a8\u6001\u8c03\u6574\u6539\u7684\u53ea\u662f\u914d\u7f6e\uff0c\u4e8b\u5b9e\u4e0a Lua JIT \u7684\u53ca\u65f6\u7f16\u8bd1\u8fd8\u63d0\u4f9b\u4e86\u53e6\u5916\u4e00\u4e2a\u6740\u624b\u950f loadstring\uff0c\u5b83\u53ef\u4ee5\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a Lua \u4ee3\u7801\u3002\u56e0\u6b64\uff0c\u5728 etcd \u4e2d\u5b58\u50a8 Lua \u4ee3\u7801\u5e76\u8bbe\u7f6e\u4e3a Script \u540e\uff0c\u5c31\u53ef\u4ee5\u5c06\u5176\u4f20\u9001\u5230 Nginx \u4e0a\u5904\u7406\u8bf7\u6c42\u4e86\u3002\\n\\n## \u603b\u7ed3\\n\\nNginx \u96c6\u7fa4\u7684\u7ba1\u7406\u5fc5\u987b\u4f9d\u8d56\u4e2d\u5fc3\u5316\u914d\u7f6e\u7ec4\u4ef6\uff0c\u800c\u9ad8\u53ef\u9760\u53c8\u5177\u5907 watch \u63a8\u9001\u673a\u5236\u7684 etcd \u65e0\u7591\u662f\u6700\u5408\u9002\u7684\u9009\u62e9\uff01\u867d\u7136\u5f53\u4e0b Resty \u751f\u6001\u6ca1\u6709 gRPC \u5ba2\u6237\u7aef\uff0c\u4f46\u6bcf\u4e2a Worker \u8fdb\u7a0b\u76f4\u63a5\u901a\u8fc7 HTTP/1.1 \u534f\u8bae\u540c\u6b65 etcd \u914d\u7f6e\u4ecd\u4e0d\u5931\u4e3a\u4e00\u4e2a\u597d\u7684\u65b9\u6848\u3002\\n\\n\u52a8\u6001\u4fee\u6539 Nginx \u914d\u7f6e\u7684\u5173\u952e\u5728\u4e8e 2 \u70b9\uff1aLua \u8bed\u8a00\u7684\u7075\u6d3b\u5ea6\u8fdc\u9ad8\u4e8e nginx.conf \u8bed\u6cd5\uff0c\u800c\u4e14 Lua \u4ee3\u7801\u53ef\u4ee5\u901a\u8fc7 loadstring \u4ece\u5916\u90e8\u6570\u636e\u4e2d\u5bfc\u5165\u3002\u5f53\u7136\uff0c\u4e3a\u4e86\u4fdd\u969c\u8def\u7531\u5339\u914d\u7684\u6267\u884c\u6548\u7387\uff0cApache APISIX \u901a\u8fc7 C \u8bed\u8a00\u5b9e\u73b0\u4e86\u524d\u7f00\u57fa\u6570\u6811\uff0c\u57fa\u4e8e Host\u3001Method\u3001URI \u8fdb\u884c\u8bf7\u6c42\u5339\u914d\uff0c\u5728\u4fdd\u969c\u52a8\u6001\u6027\u7684\u57fa\u7840\u4e0a\u63d0\u5347\u4e86\u6027\u80fd\u3002\\n\\nApache APISIX \u62e5\u6709\u8bb8\u591a\u4f18\u79c0\u7684\u8bbe\u8ba1\uff0c\u672c\u6587\u4ec5\u8ba8\u8bba\u4e86 Nginx \u96c6\u7fa4\u7684\u52a8\u6001\u7ba1\u7406\u3002\\n\\n[\u70b9\u6b64\u67e5\u770b\u539f\u6587\u94fe\u63a5](https://www.taohui.tech/2021/08/10/%E5%BC%80%E6%BA%90%E7%BD%91%E5%85%B3APISIX%E6%9E%B6%E6%9E%84%E5%88%86%E6%9E%90/#more)"},{"id":"2021/08/09/apache-apisix-in-china-mobile-cloud","metadata":{"permalink":"/zh/blog/2021/08/09/apache-apisix-in-china-mobile-cloud","source":"@site/blog/2021/08/09/Apache-APISIX-in-China-Mobile-Cloud.md","title":"Apache APISIX \u5728\u79fb\u52a8\u4e91\u7684\u5e94\u7528","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u79fb\u52a8\u4e91\u4e3a\u4ec0\u4e48\u9009\u62e9\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\u7f51\u5173\uff0c\u4ee5\u53ca\u4f7f\u7528 Apache APISIX \u6240\u89e3\u51b3\u7684\u573a\u666f\uff0c\u5e76\u4e14\u4ecb\u7ecd\u4e86\u79fb\u52a8\u4e91\u540e\u7eed\u7684\u53d1\u5c55\u89c4\u5212\u3002","date":"2021-08-09T00:00:00.000Z","formattedDate":"2021\u5e748\u67089\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":16.995,"truncated":true,"authors":[{"name":"APISIX \u793e\u533a"}],"prevItem":{"title":"Apache APISIX \u67b6\u6784\u5206\u6790\uff1a\u5982\u4f55\u52a8\u6001\u7ba1\u7406 Nginx \u96c6\u7fa4\uff1f","permalink":"/zh/blog/2021/08/10/apisix-nginx"},"nextItem":{"title":"\u820d\u5f03 Kong \u548c NGINX\uff0cAPISIX \u5728\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u7684\u843d\u5730\u5b9e\u8df5","permalink":"/zh/blog/2021/08/09/apache-apisix-in-quliankeji"}},"content":"> \u6211\u4eec\u6709\u5e78\u91c7\u8bbf\u4e86\u4e2d\u56fd\u79fb\u52a8\u4e91\u80fd\u529b\u4e2d\u5fc3\u7684\u9648\u7131\u5c71\uff0c\u5728\u91c7\u8bbf\u4e2d\u6211\u4eec\u4e86\u89e3\u5230\u4e2d\u56fd\u79fb\u52a8\u516c\u6709\u4e91\u5efa\u8bbe\u53d1\u5c55\u6f14\u8fdb\u5386\u7a0b\uff0c\u4e86\u89e3\u4e86\u4e2d\u56fd\u79fb\u52a8\u4e91\u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX \u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\u7f51\u5173\uff0c\u5e76\u4e14\u77e5\u6653\u79fb\u52a8\u4e91\u540e\u7eed\u7684\u53d1\u5c55\u89c4\u5212\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4e2d\u56fd\u79fb\u52a8\u4e91\u80fd\u529b\u4e2d\u5fc3\uff0c\u5bf9\u5916\u4e5f\u79f0\u201c\u4e2d\u79fb\uff08\u82cf\u5dde\uff09\u8f6f\u4ef6\u6280\u672f\u6709\u9650\u516c\u53f8\u201d\uff0c\u662f\u4e2d\u56fd\u79fb\u52a8\u901a\u4fe1\u96c6\u56e2 2014 \u5e74\u6ce8\u8d44\u6210\u7acb\u7684\u5168\u8d44\u5b50\u516c\u53f8\uff0c\u516c\u53f8\u5b9a\u4f4d\u4e3a\u4e91\u8bbe\u65bd\u6784\u5efa\u8005\u3001\u4e91\u670d\u52a1\u63d0\u4f9b\u8005\u3001\u4e91\u751f\u6001\u6c47\u805a\u8005\uff0c\u4e09\u5e74\u5185\u63a8\u52a8\u4e2d\u56fd\u79fb\u52a8\u4e91\u4e1a\u52a1\u5e02\u573a\u4efd\u989d\u8fdb\u5165\u56fd\u5185\u4e91\u670d\u52a1\u5546\u7b2c\u4e00\u9635\u8425\u3002\u81ea 2019 \u5e74\u4e2d\u56fd\u79fb\u52a8\u542f\u52a8\u201c\u4e91\u6539\u201d\u6218\u7565\u4ee5\u6765\uff0c\u4f5c\u4e3a\u52a9\u529b\u4e2d\u56fd\u79fb\u52a8 5G+AICDE \u6218\u7565\u843d\u5730\u7684\u57fa\u77f3\uff0c\u79fb\u52a8\u4e91\u7ecf\u8fc7\u957f\u8db3\u53d1\u5c55\uff0c\u5df2\u5b8c\u6210\u8986\u76d6\u5168\u56fd\u7684\u201cN+31+X\u201d\u6574\u4f53\u8d44\u6e90\u5e03\u5c40\u3002\u540c\u65f6\uff0c\u79fb\u52a8\u4e91\u79ef\u6781\u6253\u9020\u201c\u4e91\u7f51\u3001\u4e91\u6570\u3001\u4e91\u8fb9\u3001\u4e91\u667a\u201d \u5dee\u5f02\u5316\u7279\u8272\u4f18\u52bf\uff0c\u5728\u4e1a\u52a1\u4f53\u91cf\u3001\u4ea7\u54c1\u79cd\u7c7b\u3001\u53ef\u552e\u8d44\u6e90\u7b49\u65b9\u9762\u5747\u5b9e\u73b0\u98de\u8dc3\u5f0f\u63d0\u5347\u3002\u201c\u79fb\u52a8\u4e91\u201d\u54c1\u724c\u4e5f\u5145\u5206\u53d1\u6325\u4e86\u4e91\u7f51\u4e00\u4f53\u3001\u8d34\u8eab\u670d\u52a1\u3001\u968f\u5fc3\u5b9a\u5236\u3001\u5b89\u5168\u53ef\u63a7\u7684\u4f18\u52bf\uff0c\u6253\u9020 5G \u65f6\u4ee3\u201c\u4f60\u8eab\u8fb9\u7684\u667a\u6167\u4e91\u201d\uff0c\u4e3a\u884c\u4e1a\u6570\u5b57\u5316\u8f6c\u578b\u53d1\u5c55\u63d0\u4f9b\u201c\u5f3a\u5f15\u64ce\u201d\u3002\\n\\n**Q\uff1a\u975e\u5e38\u9ad8\u5174\u4eca\u5929\u80fd\u8ddf\u9648\u7131\u5c71\u8001\u5e08\u8fdb\u884c\u4ea4\u6d41\uff0c\u53ef\u4ee5\u9ebb\u70e6\u60a8\u505a\u4e0b\u81ea\u6211\u4ecb\u7ecd\uff0c\u7b80\u5355\u9648\u8ff0\u4e0b\u60a8\u73b0\u5728\u7684\u5de5\u4f5c\u5185\u5bb9\u5417\uff1f**\\n\\n\u5927\u5bb6\u597d\uff0c\u6211\u53eb\u9648\u7131\u5c71\uff0c\u76ee\u524d\u5c31\u804c\u4e8e\u4e2d\u56fd\u79fb\u52a8\u4e91\u80fd\u529b\u4e2d\u5fc3 IaaS \u4ea7\u54c1\u90e8\uff0c\u4e3b\u8981\u8d1f\u8d23\u5206\u5e03\u5f0f\u5bf9\u8c61\u5b58\u50a8\u8f6f\u4ef6\u7684\u6574\u4f53\u67b6\u6784\u8bbe\u8ba1\u4e0e\u5f00\u53d1\u5de5\u4f5c\uff0c\u8d1f\u8d23\u5bf9\u8c61\u5b58\u50a8\u3001API \u7f51\u5173\u7684\u6280\u672f\u9009\u578b\u4e0e\u65b9\u6848\u843d\u5730\u5b9e\u8df5\u5de5\u4f5c\u3002\u5728\u5206\u5e03\u5f0f\u5b58\u50a8\u9886\u57df\u8fd9\u5757\u8fd8\u662f\u6709\u6bd4\u8f83\u4e30\u5bcc\u7684\u7ecf\u9a8c\u7684\uff0c\u6df1\u5ea6\u53c2\u4e0e\u4e86\u79fb\u52a8\u4e91\u7684\u5efa\u8bbe\u53d1\u5c55\u5386\u7a0b\u3002\\n\\n\u5f53\u524d\uff0c\u6211\u4e3b\u8981\u5173\u6ce8\u4e8e\u5bf9\u8c61\u5b58\u50a8\u5728\u4ea4\u4e92\u7f16\u6392\u3001\u6d41\u91cf\u6cbb\u7406\u7b49\u65b9\u9762\u7684\u80fd\u529b\uff0c\u4fc3\u8fdb\u6211\u4eec\u7b2c\u56db\u4ee3\u5bf9\u8c61\u5b58\u50a8\u4ea7\u54c1\u8fdb\u4e00\u6b65\u5b9e\u73b0\u67b6\u6784\u5347\u7ea7\u3002\u540c\u65f6\uff0c\u6211\u4eec\u4e5f\u5e0c\u671b\u80fd\u591f\u57fa\u4e8e Ingress Controller \u7684\u80fd\u529b\uff0c\u6765\u5b9e\u73b0\u7edf\u4e00\u6d41\u91cf\u8bbf\u95ee\u5165\u53e3\uff0c\u5e76\u5305\u62ec\u7070\u5ea6\u53d1\u5e03\u3001\u6d41\u91cf\u7ba1\u63a7\u7b49\u529f\u80fd\u3002\u8fd9\u4e9b\u662f\u6211\u4eec\u5f53\u524d\u6b63\u5728\u505a\u7684\u4e00\u4e9b\u5de5\u4f5c\u3002\\n\\n![China-Mobile-ChenYanshan](https://static.apiseven.com/202108/1639466964888-a7ee803d-16d2-4042-b538-326e90e36712.png)\\n\\n**Q\uff1a\u60a8\u8bf4\u7684\u8fd9\u4e9b\u5185\u5bb9\u591a\u5c11\u90fd\u4e0e Apache APISIX \u6709\u5173\u8054\uff0c\u60a8\u5728\u4eca\u5e74 ApacheCon \u4e9a\u6d32\u5927\u4f1a\u4e0a\u4e5f\u6709\u4e00\u573a\u5206\u4eab\uff0c\u60f3\u95ee\u4e0b\u60a8\u4f1a\u5e26\u6765\u54ea\u4e9b\u7cbe\u5f69\u5206\u4eab?**\\n\\n\u9996\u5148\uff0c\u6211\u4f1a\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e00\u4e0b\u6211\u4eec\u79fb\u52a8\u4e91\u5bf9\u8c61\u5b58\u50a8\u4ea7\u54c1 EOS \u7684\u6574\u4f53\u53d1\u5c55\u548c\u6f14\u8fdb\u8fc7\u7a0b\uff0c\u540c\u65f6\u91cd\u70b9\u4ecb\u7ecd\u6211\u4eec\u662f\u5982\u4f55\u57fa\u4e8e Apache APISIX \u5b9e\u73b0\u5bf9\u8c61\u5b58\u50a8\u6d41\u91cf\u6cbb\u7406\u7684\uff0c\u505a\u4e86\u54ea\u4e9b\u5de5\u4f5c\uff0c\u53c8\u662f\u5982\u4f55\u8fdb\u884c\u5b9e\u8df5\u3002\u6700\u540e\u5bf9\u6211\u4eec\u672a\u6765\u7684\u67b6\u6784\u6f14\u8fdb\u505a\u4e86\u4e00\u4e9b\u89c4\u5212\u8bf4\u660e\u3002\u6211\u4eec\u5bf9\u8c61\u5b58\u50a8\u7684\u6574\u4f53\u6f14\u8fdb\u8fc7\u7a0b\u4e3b\u8981\u7ecf\u5386\u4e86\u5982\u4e0b\u56db\u4e2a\u9636\u6bb5\uff0c\u5bf9\u4e8e Apache APISIX \u5f15\u5165\u4e3b\u8981\u662f\u4ece\u7b2c\u4e09\u4ee3\u5f00\u59cb\u5f15\u5165\u7684\uff0c\u786e\u5b9e\u7ed9\u6211\u4eec\u4ea7\u54c1\u5728\u67b6\u6784\u4e0a\u5e26\u6765\u5f88\u591a\u4fbf\u5229\u3002\\n\\n- \u7b2c\u4e00\u4ee3\uff1a\u4ece 2008 \u5e74\u5f00\u59cb\u6295\u5165\u81ea\u7814\uff0c\u540c\u5e74\u53d1\u5e03\u4e86\u6211\u4eec\u7684\u7b2c\u4e00\u4ee3\u5bf9\u8c61\u5bf9\u8c61\u5b58\u50a8\u4ea7\u54c1\uff1b\\n- \u7b2c\u4e8c\u4ee3\uff1a\u4e3b\u8981\u57fa\u4e8e\u5f00\u6e90 Ceph \u5b9e\u73b0\u6df1\u5ea6\u5b9a\u5236\uff0c\u5b9e\u73b0\u4e86\u63a5\u53e3\u7684\u6807\u51c6\u5316\uff0c\u652f\u6301 AWS \u7684 S3 \u6807\u51c6\u63a5\u53e3\u548c Openstack \u7684 Swift \u63a5\u53e3\u534f\u8bae\uff0c\u540c\u65f6\u4e30\u5bcc\u4e86\u5927\u91cf\u7684\u529f\u80fd\u7279\u6027\uff1b\\n- \u7b2c\u4e09\u4ee3\uff1a\u4e3b\u8981\u89e3\u51b3\u5185\u90e8\u4e00\u4e9b\u4e13\u4e1a\u516c\u53f8\u6d77\u91cf\u6570\u636e\u4e0a\u4e91\u9700\u6c42\u3002\u5728\u7b2c\u4e09\u4ee3\u4ea7\u54c1\u4e2d\uff0c\u6211\u4eec\u5728\u6027\u80fd\u4e0a\u5b9e\u73b0\u4e86\u4e00\u4e2a\u65b0\u7684\u8de8\u8d8a\uff0c\u5355\u4e00\u5b58\u50a8\u6876\u540c\u65f6\u652f\u6301\u767e PB \u5bb9\u91cf\u548c\u767e\u4ebf\u5bf9\u8c61\u89c4\u6a21\uff0c\u5165\u53e3\u5e26\u5bbd\u8fbe\u5230 Tb/s \u7ea7\u3002\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u5f15\u5165\u4e86\u5f88\u591a\u5b50\u6a21\u5757\uff0c\u5305\u62ec\u4e03\u5c42\u6d41\u91cf\u6cbb\u7406\u4ee5\u53ca\u53ef\u89c2\u6d4b\u7cfb\u7edf\u3002\u4e03\u5c42\u6d41\u91cf\u6cbb\u7406\u6a21\u5757\u662f\u57fa\u4e8e Apache APISIX \u5b9e\u73b0\u7684\uff0c\u4e3b\u8981\u7528\u4e8e\u5b9e\u73b0\u4e1a\u52a1\u6d41\u91cf\u7684\u5206\u79bb\u6cbb\u7406\uff1b\u53ef\u89c2\u6d4b\u7cfb\u7edf\u5219\u4e3b\u8981\u662f\u5b9e\u73b0\u4e86\u6570\u636e\u7684\u91c7\u96c6\u3001\u544a\u8b66\u4ee5\u53ca\u65e5\u5fd7\u5206\u6790\u529f\u80fd\u3002\\n- \u7b2c\u56db\u4ee3\uff1a\u4e5f\u662f\u5168\u65b0\u4e00\u4ee3\u67b6\u6784\uff0c\u652f\u6301\u8de8\u533a\u57df\u5168\u5c40\u7ea0\u5220\u529f\u80fd\uff0c\u652f\u6301 AZ/Region \u7ea7\u5bb9\u707e\u3002\u5728\u6d41\u91cf\u6cbb\u7406\u65b9\u9762\uff0c\u652f\u6301\u57fa\u4e8e Apache APISIX \u5b9e\u73b0\u7684\u8de8\u5730\u57df\u8bf7\u6c42\u8c03\u5ea6\u80fd\u529b\uff0c\u652f\u6491\u6781\u81f4\u7684\u4e1a\u52a1\u8fde\u7eed\u6027\uff1b\u540c\u65f6\u7cfb\u7edf\u53ef\u89c2\u6d4b\u6027\u8fdb\u4e00\u6b65\u63d0\u5347\uff0c\u843d\u5730\u4e86\u96c6\u4e2d\u5316\u65e5\u5fd7\u5206\u6790\u7cfb\u7edf\u3002\u5728\u53ef\u7ef4\u62a4\u6027\u4e0a\u9996\u6b21\u5f15\u5165\u4e86\u81ea\u52a8\u9a7e\u9a76\u670d\u52a1\u548c\u4ea4\u4ed8\u7f16\u6392\u670d\u52a1\uff0c\u80fd\u591f\u81ea\u52a8\u6709\u6548\u6536\u655b\u6545\u969c\u8303\u56f4\uff0c\u51cf\u8f7b\u8fd0\u7ef4\u538b\u529b\uff0c\u5b9e\u73b0\u6545\u969c\u9694\u79bb\u548c\u81ea\u6108\u80fd\u529b\u3002\\n\\n**Q\uff1a\u4ece\u60a8\u7684\u8bb2\u8ff0\u4e2d\u53ef\u4ee5\u611f\u53d7\u5230\uff0c\u8fd9\u4e2a\u7cfb\u7edf\u4e0d\u4ec5\u975e\u5e38\u5e9e\u5927\uff0c\u800c\u4e14\u8fd8\u975e\u5e38\u91cd\u8981\u3002\u5bf9\u4e8e\u8fd9\u6837\u91cd\u8981\u7684\u7cfb\u7edf\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u9009\u62e9 Apache APISIX\uff1f\u4e3b\u8981\u51fa\u4e8e\u54ea\u4e9b\u65b9\u9762\u7684\u8003\u8651\u5462\uff1f**\\n\\n\u662f\u7684\uff0c\u5728\u6280\u672f\u9009\u578b\u521d\u671f\u6211\u4eec\u4e5f\u8c03\u7814\u8fc7\u5f88\u591a\u7684 API \u7f51\u5173\uff0c\u5305\u62ec Nginx \u7b49\uff0c\u4e0d\u8fc7\u6211\u4eec\u6700\u7ec8\u8fd8\u662f\u9009\u62e9\u4e86 Apache APISIX\u3002Apache APISIX \u4e0d\u4ec5\u80fd\u591f\u6ee1\u8db3\u5f53\u524d\u7684\u4e1a\u52a1\u8981\u6c42\uff0c\u540c\u65f6\u8fd8\u80fd\u5728\u7cfb\u7edf\u53ef\u7528\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u4e0a\u4e3a\u6211\u4eec\u63d0\u4f9b\u6bd4\u8f83\u591a\u7684\u601d\u8def\u548c\u9009\u62e9\uff0c\u8ddf\u6211\u4eec\u7684\u6574\u4f53\u4ea7\u54c1\u6f14\u8fdb\u89c4\u5212\u548c\u6280\u672f\u6808\u6bd4\u8f83\u543b\u5408\u3002\u5f52\u7ed3\u8d77\u6765\u9009\u62e9 Apache APISIX \u4e3b\u8981\u57fa\u4e8e\u4ee5\u4e0b\u51e0\u70b9\uff1a\\n\\n#### \u7b2c\u4e00\uff0c\u5185\u90e8\u9a71\u52a8\u4ea7\u54c1\u67b6\u6784\u4f18\u5316\u9700\u8981\uff0c\u4fc3\u4f7f\u6211\u4eec\u5f00\u59cb\u5728\u4e00\u4e9b\u6280\u672f\u67b6\u6784\u4e0a\u5bfb\u627e\u66f4\u9ad8\u7684\u7a81\u7834\u70b9\\n\\n\u5728 2019 \u5e74\u7684\u65f6\u5019\uff0c\u4e2d\u56fd\u79fb\u52a8\u4ece\u96c6\u56e2\u5c42\u9762\u63d0\u51fa\u4e86\u201c\u4e91\u6539\u201d\u6218\u7565\u8f6c\u578b\uff0c\u968f\u540e\u6211\u4eec\u4e91\u80fd\u4e5f\u5c31\u6210\u4e86\u6574\u4e2a\u79fb\u52a8\u5728\u4e91\u6539\u8f6c\u578b\u4e0a\u7684\u6218\u7565\u652f\u6491\u70b9\u3002\u8fd9\u4e5f\u4fc3\u4f7f\u6211\u4eec\u8981\u5728\u4ea7\u54c1\u7cfb\u7edf\u67b6\u6784\u4e0a\u505a\u8fdb\u4e00\u6b65\u7684\u4f18\u5316\uff0c\u80fd\u591f\u6ee1\u8db3\u672a\u6765 3~5 \u5e74\u4ee5\u4e0a\u7684\u53d1\u5c55\u9700\u8981\u3002\u4e0d\u4ec5\u9700\u8981\u5728\u529f\u80fd\u548c\u6027\u80fd\u4e0a\u8fdb\u884c\u63d0\u5347\uff0c\u800c\u4e14\u9700\u8981\u5728\u53ef\u7ef4\u62a4\u6027\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u65b9\u9762\u4e0a\u6765\u5f15\u5165\u66f4\u591a\u7684\u7ec4\u4ef6\uff0c\u6765\u4fdd\u8bc1\u6211\u4eec\u7cfb\u7edf\u7684\u7a33\u5b9a\u8fd0\u884c\uff0c\u63d0\u4f9b\u53ef\u6301\u7eed\u7684\u3001\u6709\u4fdd\u8bc1\u7684 SLA \u670d\u52a1\u7b49\u7ea7\u3002\\n\\n#### \u7b2c\u4e8c\uff0c\u57fa\u4e8e\u81ea\u8eab\u4e1a\u52a1\u5b9e\u73b0\u9700\u8981\uff0c\u540c\u65f6 Apache APISIX \u529f\u80fd\u63d2\u4ef6\u5168\u9762\uff0c\u4e1a\u52a1\u573a\u666f\u5339\u914d\u5ea6\u9ad8\\n\\n\u56e0\u4e3a\u81ea\u8eab\u4e1a\u52a1\u5bf9\u7f51\u5173\u80fd\u529b\u7684\u9700\u8981\uff0c\u6211\u4eec\u901a\u8fc7\u5bf9\u81ea\u6709\u4e1a\u52a1\u9700\u6c42\u8fdb\u884c\u8be6\u7ec6\u68b3\u7406\u5206\u6790\uff0c\u8fd9\u5176\u4e2d\u5c31\u5305\u62ec\u7cbe\u7ec6\u5316\u8def\u7531\u3001\u5185/\u5916\u7f51\u9694\u79bb\u4ee5\u53ca\u8bbf\u95ee\u63a7\u5236\uff0c\u81ea\u52a8\u7194\u65ad\u4fdd\u62a4\uff0c\u8de8 AZ \u8bf7\u6c42\u8c03\u5ea6\u7b49\u573a\u666f\u3002\u540c\u65f6\uff0c\u201c\u8fd0\u7ef4\u53cb\u597d\u201d\uff0c\u8fd9\u65b9\u9762 Apache APISIX \u505a\u5f97\u975e\u5e38\u597d\u3002\\n\\n\u5927\u5bb6\u90fd\u77e5\u9053\uff0cApache APISIX \u80fd\u591f\u53cb\u597d\u5bf9\u63a5 Prometheus\uff0c\u524d\u9762\u6211\u63d0\u5230\u7684\u53ef\u89c2\u6d4b\u7cfb\u7edf\uff0c\u5b83\u5c31\u662f\u57fa\u4e8e Prometheus + Grafana + Loki \u6765\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u4e4b\u6240\u4ee5\u9009\u62e9 Apache APISIX\uff0c\u5f88\u91cd\u8981\u7684\u4e00\u70b9\u662f\u5b83\u80fd\u4e0e\u6211\u4eec\u73b0\u6709\u7684\u6280\u672f\u6808\u5b8c\u7f8e\u7ed3\u5408\uff0c\u8fd9\u4e9b\u90fd\u662f\u6211\u4eec\u6bd4\u8f83\u770b\u91cd\u7684\u3002\\n\\n\u6b64\u5916\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u5173\u952e\u70b9\uff0c\u8fd9\u4e5f\u662f Apache APISIX \u4e0e\u5176\u4ed6\u7f51\u5173\u4ea7\u54c1\u7684\u91cd\u8981\u533a\u522b \u2014\u2014 \u5168\u52a8\u6001\u52a0\u8f7d\uff0c\u56e0\u4e3a\u6211\u4eec\u66f4\u5e0c\u671b\u6240\u6709\u7684\u63d2\u4ef6\u3001\u8def\u7531\u90fd\u80fd\u591f\u52a8\u6001\u7684\u6269\u5c55\uff0c\u8fd9\u4e9b\u662f Nginx \u8fd9\u6837\u7684\u4ea7\u54c1\u6240\u4e0d\u5177\u5907\u7684\u3002\u4e3e\u4e00\u4e2a\u7b80\u5355\u7684\u5e94\u7528\u573a\u666f\u7684\u4f8b\u5b50\uff1a\u524d\u9762\u6211\u6709\u63d0\u5230\u8fc7\u6211\u4eec\u6709\u4e00\u4e2a\u5b50\u7cfb\u7edf\u53eb\u81ea\u52a8\u9a7e\u9a76 Manager\uff0c\u5f53\u6211\u540e\u7aef\u7684\u7d22\u5f15\u5b58\u50a8\u7a7a\u95f4\u4e0d\u8db3\u65f6\uff0c\u6211\u4eec\u5c31\u662f\u901a\u8fc7 Manager \u81ea\u52a8\u4f7f\u80fd\u4e00\u6761\u9ed8\u8ba4\u9ad8\u4f18\u5148\u7ea7\u7684\u8def\u7531\uff0c\u7981\u7528 PUT \u548c POST \u7b49\u529f\u80fd\uff0c\u4ece\u800c\u5b9e\u73b0\u81ea\u52a8\u540e\u7aef\u4fdd\u62a4\u3002\\n\\n#### \u7b2c\u4e09\uff0c\u5bf9\u793e\u533a\u5f00\u6e90\u6587\u5316\u7684\u8ba4\u540c\u611f\\n\\n\u548c\u5176\u4ed6\u7f51\u5173\u4ea7\u54c1\u4e0d\u540c\uff0cApache APISIX \u662f Apache \u5f00\u6e90\u9876\u7ea7\u9879\u76ee\uff0c\u5b75\u5316\u65f6\u95f4\u4e5f\u662f\u6700\u77ed\u7684\uff0c\u8db3\u89c1\u9879\u76ee\u7684\u6210\u529f\uff0c\u4ea7\u54c1\u5df2\u7ecf\u88ab\u5f88\u591a\u4f01\u4e1a\u5e94\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u4e0b\u3002\u6b64\u5916\u4e0d\u5f97\u4e0d\u8bf4\u793e\u533a\u4e5f\u662f\u5341\u5206\u6d3b\u8dc3\u7684\uff0c\u4ee3\u7801\u8d21\u732e\u8005\u548c\u4f7f\u7528\u8005\u90fd\u975e\u5e38\u591a\uff0c\u4e0e\u793e\u533a\u7684\u6c9f\u901a\u4ea4\u6d41\u65b9\u5f0f\u4e5f\u5f88\u591a\u6837\u5316\uff0c\u6bd4\u5982 maillist\uff0cissues\uff0cQQ \u7fa4\uff0c\u5fae\u4fe1\u7fa4\uff0c\u7ebf\u4e0a\u7ebf\u4e0b\u7684 Meetup\uff0c\u6c9f\u901a\u8d77\u6765\u5341\u5206\u4fbf\u6377\u4e14\u8fc5\u901f\u6709\u6548\u3002\u793e\u533a\u5927\u4f6c\u4e5f\u5341\u5206\u53cb\u597d\uff0c\u4e50\u4e8e\u56de\u590d\u5927\u5bb6\u7684\u63d0\u95ee\u3002\u6240\u4ee5\u6211\u4eec\u5bf9 Apache APISIX \u793e\u533a\u7684\u672a\u6765\u4e5f\u662f\u975e\u5e38\u770b\u597d\u7684\u3002\\n\\n\u53e6\u5916\uff0cApache APISIX \u7684\u5168\u4ea7\u54c1\u7ebf\u505a\u5f97\u4e5f\u975e\u5e38\u597d\uff0c\u5305\u62ec K8s Ingress Controller\uff0c\u4ee5\u53ca Service Mesh \u7b49\uff0c\u867d\u7136\u8fd9\u4e9b\u6280\u672f\u6808\u6211\u4eec\u5f53\u524d\u8fd8\u7528\u4e0d\u5230\uff0c\u4f46\u6211\u89c9\u5f97\u793e\u533a\u5728\u4ea7\u54c1\u5b9a\u4f4d\u3001\u53d1\u5c55\u65b9\u5411\u4e0a\u90fd\u662f\u975e\u5e38\u6e05\u6670\u7684\uff0c\u8fd9\u4e5f\u7ed9\u4e86\u6211\u4eec\u66f4\u5145\u5206\u7684\u4fe1\u5fc3\u3002\\n\\n**Q\uff1a\u5c31\u50cf\u60a8\u8bf4\u7684\uff0c\u5176\u5b9e Apache APISIX \u4e0d\u4ec5\u662f\u5e0c\u671b\u80fd\u591f\u6ee1\u8db3\u7528\u6237\u5f53\u524d\u7684\u9700\u6c42\u548c\u67b6\u6784\u7684\u8bbe\u8ba1\uff0c\u6211\u4eec\u66f4\u5e0c\u671b\u80fd\u591f\u6ee1\u8db3\u5927\u5bb6 3~5 \u5e74\uff0c\u751a\u81f3\u66f4\u957f\u65f6\u671f\u7684\u67b6\u6784\u53d8\u8fc1\u3002\u73b0\u5728 Apache APISIX \u6709\u8dd1\u5728\u4e2d\u56fd\u79fb\u52a8\u7684\u4e00\u4e9b\u4e1a\u52a1\u7cfb\u7edf\u4e0a\u5417\uff1f**\\n\\n\u6709\u7684\u3002\u4ece\u6211\u4eec\u7684\u7b2c\u4e09\u4ee3\u5bf9\u8c61\u5b58\u50a8\u4ea7\u54c1\u5f00\u59cb\uff0c\u6211\u4eec\u9664\u4e86\u89e3\u51b3\u5bb9\u91cf\u3001\u6027\u80fd\u4ee5\u53ca\u6269\u5bb9\u6027\u7684\u95ee\u9898\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u5229\u7528 Apache APISIX \u6765\u89e3\u51b3\u6211\u4eec\u4e03\u5c42\u6d41\u91cf\u6cbb\u7406\u7684\u9700\u6c42\u3002\u7b2c\u4e09\u4ee3\u5bf9\u8c61\u5b58\u50a8\u4ece\u5b83\u7684\u7814\u53d1\u5386\u7a0b\u6765\u770b\uff0c\u524d\u540e\u52a0\u8d77\u6765\u8fd8\u4e0d\u5230\u534a\u5e74\u7684\u65f6\u95f4\uff0c\u5e76\u80fd\u591f\u5728 2020 \u5e74 7 \u6708\u7684\u65f6\u5019\u5728\u79fb\u52a8\u4e91\u5341\u671f\u4e2d\u5b8c\u6210\u4e0a\u7ebf\u8fd0\u884c\uff0c\u4e3b\u8981\u670d\u52a1\u4e8e\u5185\u90e8\u7684\u4e00\u4e9b\u4e13\u4e1a\u516c\u53f8\u6570\u636e\u4e0a\u4e91\u7684\u9700\u6c42\u3002\u4e3b\u8981\u662f\u5b58\u50a8\u7528\u6237\u7684\u4e00\u4e9b\u6444\u50cf\u76d1\u63a7\u6570\u636e\uff0c\u6240\u4ee5\u5bf9\u5e26\u5bbd\u7684\u8981\u6c42\u8fd8\u662f\u6bd4\u8f83\u9ad8\u7684\u3002\u76ee\u524d\u6574\u4f53\u6295\u5165\u751f\u4ea7\u8fd0\u884c\u5df2\u7ecf\u6709\u4e00\u5e74\u591a\u4e86\uff0c\u4ece\u63a5\u5165\u5c42\u5230\u540e\u7aef\u670d\u52a1\u7684\u8fd0\u884c\u60c5\u51b5\u8fd8\u662f\u975e\u5e38\u5e73\u7a33\u7684\uff0c\u51e0\u4e4e\u6ca1\u6709\u51fa\u8fc7\u4ec0\u4e48\u95ee\u9898\u3002\\n\\n**Q\uff1a\u5728\u4f7f\u7528 Apache APISIX \u7684\u65f6\u5019\u4f1a\u505a\u4e00\u4e9b\u4e8c\u6b21\u5f00\u53d1\u5417\uff1f\u53e6\u5916\uff0c\u8fd9\u4e9b\u4e8c\u6b21\u5f00\u53d1\u7684\u6210\u679c\u662f\u5426\u6709\u8ba1\u5212\u56de\u5f52\u5230\u793e\u533a\u5462\uff1f**\\n\\n\u4e8c\u6b21\u5f00\u53d1\u662f\u6709\u7684\uff0c\u800c\u4e14\u8fd8\u6709\u4e0d\u5c11\u3002\\n\\n\u9488\u5bf9\u4e00\u4e9b\u901a\u7528\u7684\u529f\u80fd\uff0c\u6211\u4eec\u4e5f\u4f1a\u628a\u4ed6\u4eec\u8d21\u732e\u7ed9\u793e\u533a\u3002\u4f46\u6211\u4eec\u7684\u4e00\u4e9b\u5f00\u53d1\u5185\u5bb9\u90fd\u662f\u4e3a\u4e86\u6ee1\u8db3\u4e00\u4e9b\u7279\u5b9a\u4e1a\u52a1\u573a\u666f\uff0c\u6bd4\u5982\u8de8 AZ \u8bf7\u6c42\u8c03\u5ea6\u3002\u8be5\u529f\u80fd\u4e3b\u8981\u662f\u9762\u5411\u6211\u4eec\u7b2c\u56db\u4ee3\u5bf9\u8c61\u5b58\u50a8\uff0c\u5b83\u662f\u4e00\u4e2a\u5168\u5c40\u8de8\u57df\u7684\u7248\u672c\uff0c\u652f\u6301 AZ \u7ea7\u5bb9\u707e\uff0c\u6240\u4ee5\u5bf9\u4e1a\u52a1\u7684\u8fde\u7eed\u6027\u8981\u6c42\u975e\u5e38\u9ad8\u3002\u4e3a\u4e86\u89e3\u51b3\u8bf7\u6c42\u8c03\u5ea6\u7684\u4e00\u4e9b\u9700\u6c42\uff0c\u6211\u4eec\u5728 Apache APISIX \u4e0a\u5199\u4e86\u4e00\u4e2a Plugin\uff0c\u7136\u540e\u53bb\u8fd0\u884c\u3002\\n\\n\u901a\u8fc7\u8fd9\u4e2a Plugin \u7684\u8bf7\u6c42\uff0c\u9996\u5148\u4f1a\u9009\u62e9\u672c\u8282\u70b9\u4e0a\u6e38\u53bb\u5904\u7406\uff1b\u5982\u679c\u672c\u8282\u70b9\u4e0a\u6e38\u51fa\u73b0\u95ee\u9898\uff0c\u5c31\u4f1a\u8f6c\u5411\u5230\u672c AZ \u5185\u7684\u5176\u4ed6\u4e00\u4e9b\u4e0a\u6e38\u53bb\u8fdb\u884c\u5904\u7406\u3002\u5982\u679c\u672c AZ \u6240\u6709\u4e0a\u6e38\u90fd\u51fa\u73b0\u6545\u969c\u7684\u65f6\u5019\uff0c\u90a3\u5c31\u76f4\u63a5\u91c7\u7528\u8de8 AZ \u7684\u8bf7\u6c42\u8c03\u5ea6\u5904\u7406\u673a\u5236\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u6574\u4e2a\u4e1a\u52a1\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5373\u4f7f\u51fa\u73b0 AZ \u7ea7\u7684\u6545\u969c\uff0c\u8bf7\u6c42\u8fd8\u662f\u80fd\u591f\u88ab\u6b63\u5e38\u5904\u7406\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u5229\u7528 Apache APISIX \u505a\u4e86\u4e00\u90e8\u5206 \u201c\u591a\u6d3b\u201d \u67b6\u6784\u7684\u5b9e\u73b0\u3002\\n\\n**Q\uff1a\u9664\u4e86 Apache APISIX \u73b0\u6709\u7684\u529f\u80fd\u4e4b\u5916\uff0c\u4f60\u4eec\u540e\u7eed\u8fd8\u4f1a\u6709\u4e00\u4e9b\u4ec0\u4e48\u6837\u7684\u8ba1\u5212\u5417\uff1f**\\n\\n\u6211\u89c9\u5f97\u540e\u7eed\u7684\u8bdd\uff0c\u6211\u4eec\u5e94\u8be5\u4e3b\u8981\u4f1a\u56f4\u7ed5\u8fd9\u51e0\u4e2a\u65b9\u9762\u5f00\u5c55\u3002\\n\\n#### \u7b2c\u4e00\uff0c\u5bb9\u5668\u5316\u7f16\u6392\u548c\u7edf\u4e00\u5165\u53e3\\n\\n\u56e0\u4e3a\u6211\u4eec\u73b0\u5728\u4e3b\u8981\u5728\u5f00\u53d1\u7b2c\u56db\u4ee3\u5bf9\u8c61\u5b58\u50a8\uff0c\u6211\u4eec\u6b63\u5728\u505a\u7684\u4e8b\u60c5\u5c31\u662f\u5b9e\u73b0\u6240\u6709\u7ec4\u4ef6\u7684\u5bb9\u5668\u5316\u90e8\u7f72\u7f16\u6392\u3002\u8fd9\u4e2d\u95f4\u65e2\u6709\u6570\u636e\u9762\u4e5f\u6709\u63a7\u5236\u9762\uff0c\u63a7\u5236\u9762\u6211\u4eec\u5df2\u7ecf\u662f K8s \u5316\u4e86\uff0c\u5f53\u524d\u6b63\u5728\u505a\u6570\u636e\u9762\u7ec4\u4ef6\u7684\u5bb9\u5668\u5316\u90e8\u7f72\u7f16\u6392\u5de5\u4f5c\u3002\u5bf9\u4e8e\u5916\u90e8\u8bbf\u95ee\u9700\u6c42\uff0c\u6211\u4eec\u4e5f\u5728\u91c7\u7528 Ingress Controller \u6765\u7edf\u4e00\u8bbf\u95ee\u5165\u53e3\u3002\\n\\n#### \u7b2c\u4e8c\uff0c\u5c06\u66f4\u591a\u7684\u529f\u80fd\u524d\u7f6e\u5230\u7f51\u5173\u5c42\u9762\u6765\u5904\u7406\\n\\n\u524d\u9762\u6211\u6709\u63d0\u5230\uff0c\u5728\u6211\u4eec\u7684\u63a7\u5236\u9762\u6709\u591a\u4e2a\u5b50\u7cfb\u7edf\uff0c\u540e\u7eed\u6211\u4eec\u5e0c\u671b\u628a\u6d41\u91cf\u6cbb\u7406\u4e0e\u4e00\u4e9b\u81ea\u52a8\u9a7e\u9a76\u3001\u53ef\u89c2\u6d4b\u5b50\u7cfb\u7edf\u80fd\u591f\u66f4\u591a\u7684\u53bb\u878d\u5408\u8d77\u6765\uff0c\u901a\u8fc7\u5b9e\u73b0\u6545\u969c\u81ea\u6108\u3001\u6545\u969c\u9694\u79bb\u7b49\u529f\u80fd\uff0c\u4ece\u800c\u4fdd\u8bc1\u4ea7\u54c1\u5bf9\u5916\u7684\u8bbf\u95ee\u80fd\u529b\uff0c\u8fd9\u4e5f\u5c31\u8981\u6c42\u6211\u4eec\u5339\u914d\u66f4\u591a\u7684\u4e1a\u52a1\u573a\u666f\u80fd\u529b\u3002\\n\\n\u53e6\u5916\uff0c\u6211\u4eec\u73b0\u5728\u7684\u7f51\u5173\u63a5\u5165\u5c42\u4e3b\u8981\u662f\u5b9e\u73b0\u4e86\u6d41\u91cf\u8f6c\u53d1\u63a7\u5236\u529f\u80fd\uff0c\u800c\u539f\u6765\u540e\u7aef\u7684\u8ba4\u8bc1\u3001\u9274\u6743\u7684\u90a3\u5957\u903b\u8f91\u662f\u7531\u4e1a\u52a1\u903b\u8f91\u5c42\u5904\u7406\u7684\uff0c\u540e\u7eed\u4f1a\u8003\u8651\u628a\u8fd9\u4e00\u90e8\u5206\u5185\u5bb9\u7edf\u4e00\u524d\u7f6e\u5230\u7f51\u5173\u5c42\u9762\u6765\u5904\u7406\u3002\u5728\u6570\u636e\u8fc1\u79fb\u8fd9\u5757\uff0c\u7531\u4e8e\u5386\u53f2\u9057\u7559\u95ee\u9898\u6bd4\u8f83\u591a\uff0c\u8fc1\u79fb\u8fc7\u7a0b\u8fd8\u4e0d\u80fd\u5f71\u54cd\u4e1a\u52a1\u7684\u8fde\u7eed\u6027\uff0c\u4e0d\u8fc7\u6211\u4eec\u4e5f\u5df2\u7ecf\u6709\u4e86\u57fa\u4e8e Apache APISIX \u7684\u53ef\u884c\u65b9\u6848\u3002\\n\\n#### \u7b2c\u4e09\uff0c\u793e\u533a\u4ee3\u7801\u8d21\u732e\u4e0a\u8981\u52a0\u5927\\n\\n\u6211\u4eec\u4e5f\u4f1a\u5728\u8fd9\u5757\u52a0\u5927\u4eba\u5458\u6295\u5165\uff0c\u4e0e\u793e\u533a\u6709\u7740\u66f4\u79ef\u6781\u7684\u4e92\u52a8\uff0c\u53c2\u4e0e\u5230\u793e\u533a\u7684\u5f00\u53d1\u5f53\u4e2d\uff0c\u4e3a\u793e\u533a\u7684\u53d1\u5c55\u505a\u4e00\u4e9b\u56de\u9988\uff0c\u8fd9\u4e5f\u6709\u5229\u4e8e\u6253\u78e8\u6211\u4eec\u7684\u4ea7\u54c1\u3002\\n\\n#### \u7b2c\u56db\uff0c\u63a8\u52a8\u5185\u90e8\u6280\u672f\u6808\u7684\u7edf\u4e00\\n\\n\u76ee\u524d\u5728\u6211\u4eec\u5185\u90e8\u8fd8\u5b58\u5728\u591a\u79cd\u6280\u672f\u6808\u5e76\u884c\u7684\u60c5\u51b5\uff0c\u540c\u65f6\u4e5f\u6709\u591a\u4e2a\u56e2\u961f\u5728\u4f7f\u7528 Apache APISIX \u7f51\u5173\uff0c\u540e\u671f\u6211\u4eec\u4e5f\u5c06\u901a\u8fc7\u6c9f\u901a\uff0c\u68b3\u7406\u4e1a\u52a1\u6a21\u578b\uff0c\u5b9e\u73b0\u6280\u672f\u6808\u7684\u7edf\u4e00\uff0c\u907f\u514d\u91cd\u590d\u9020\u8f6e\u5b50\u7684\u60c5\u51b5\u53d1\u751f\uff0c\u6700\u7ec8\u5b9e\u73b0\u6280\u672f\u6808\u7684\u7edf\u4e00\uff0c\u5f62\u6210\u7edf\u4e00\u57fa\u5ea7\u80fd\u529b\u3002\\n\\n**Q\uff1a\u611f\u8c22\u9648\u8001\u5e08\uff0c\u770b\u6765 Apache APISIX \u5728\u4e2d\u56fd\u79fb\u52a8\u540e\u9762\u5e94\u8be5\u53ef\u4ee5\u9002\u7528\u66f4\u591a\u7684\u573a\u666f\uff0c\u53d1\u6325\u7684\u66f4\u591a\u4f5c\u7528\u4e86\u3002**"},{"id":"2021/08/09/apache-apisix-in-quliankeji","metadata":{"permalink":"/zh/blog/2021/08/09/apache-apisix-in-quliankeji","source":"@site/blog/2021/08/09/Apache-APISIX-in-Quliankeji.md","title":"\u820d\u5f03 Kong \u548c NGINX\uff0cAPISIX \u5728\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u7684\u843d\u5730\u5b9e\u8df5","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u5728\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u4e2d\u7684\u843d\u5730\u5b9e\u8df5\u60c5\u51b5\uff0c\u4ee5\u53ca\u8da3\u94fe\u79d1\u6280\u5728\u4f17\u591a\u7f51\u5173\u5e94\u7528\u4e2d\u9009\u62e9 Apache APISIX \u7684\u539f\u56e0\u3002","date":"2021-08-09T00:00:00.000Z","formattedDate":"2021\u5e748\u67089\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":15.535,"truncated":true,"authors":[{"name":"\u76db\u5a01\u950b"}],"prevItem":{"title":"Apache APISIX \u5728\u79fb\u52a8\u4e91\u7684\u5e94\u7528","permalink":"/zh/blog/2021/08/09/apache-apisix-in-china-mobile-cloud"},"nextItem":{"title":"\u5982\u4f55\u5229\u7528 Apache APISX \u63d0\u5347 NGINX \u7684\u53ef\u89c2\u6d4b\u6027","permalink":"/zh/blog/2021/08/06/using-apache-apisix-to-improve-the-observability-of-nginx"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Apache APISIX \u5728\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u4e2d\u7684\u843d\u5730\u5b9e\u8df5\u60c5\u51b5\uff0c\u4ee5\u53ca\u8da3\u94fe\u79d1\u6280\u5728\u4f17\u591a\u7f51\u5173\u5e94\u7528\u4e2d\u9009\u62e9 Apache APISIX \u7684\u539f\u56e0\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u4e1a\u52a1\u80cc\u666f\\n\\nBaaS\uff08Blockchain as a Service\uff09\uff0c\u4e2d\u6587\u4e3a\u201c\u533a\u5757\u94fe\u5373\u670d\u52a1\u201d\uff0c\u662f\u6307\u5c06\u533a\u5757\u94fe\u6846\u67b6\u5d4c\u5165\u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u5229\u7528\u4e91\u670d\u52a1\u57fa\u7840\u8bbe\u65bd\u7684\u90e8\u7f72\u548c\u7ba1\u7406\u4f18\u52bf\uff0c\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u4fbf\u6377\u3001\u9ad8\u6027\u80fd\u7684\u533a\u5757\u94fe\u751f\u6001\u73af\u5883\u548c\u751f\u6001\u914d\u5957\u670d\u52a1\uff0c\u652f\u6301\u5f00\u53d1\u8005\u7684\u4e1a\u52a1\u62d3\u5c55\u53ca\u8fd0\u8425\u652f\u6301\u7684\u533a\u5757\u94fe\u5f00\u653e\u5e73\u53f0\u3002\\n\\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e00\u5957\u5b8c\u6574\u7684 BaaS \u89e3\u51b3\u65b9\u6848\u5305\u62ec\u8bbe\u5907\u63a5\u5165\u3001\u8bbf\u95ee\u63a7\u5236\u3001\u670d\u52a1\u76d1\u63a7\u548c\u533a\u5757\u94fe\u5e73\u53f0\u56db\u4e2a\u4e3b\u8981\u73af\u8282\u3002\\n\\n![BaaS introduction](https://static.apiseven.com/202108/1630647228757-9e5f730c-dde0-46b6-b5f3-81a15ff40e39.png)\\n\\n**\u901a\u8fc7 BaaS \u53ef\u4ee5\u5feb\u901f\u7075\u6d3b\u5730\u642d\u5efa\u533a\u5757\u94fe\u7f51\u7edc\uff0c\u5bf9\u4e8e\u4f01\u4e1a\u6765\u8bf4\uff0c\u6709\u4e86 BaaS \u5e73\u53f0\u5c31\u80fd\u591f\u5bf9\u533a\u5757\u94fe\u4e1a\u52a1\u8fdb\u884c\u7edf\u4e00\u7684\u7ba1\u7406\u3002**\\n\\n\u76f8\u4fe1\u6709\u4e0d\u5c11\u670b\u53cb\u63a5\u89e6\u8fc7\u4ee5\u592a\u574a\u4e0a\u9762\u7684\u5408\u7ea6\u4ee3\u7801\uff0c\u901a\u8fc7 BaaS \u5e73\u53f0\uff0c\u6211\u4eec\u80fd\u591f\u5f88\u8f7b\u677e\u5730\u5728 IDE \u4e0a\u7f16\u5199\u667a\u80fd\u5408\u7ea6\uff0c\u7136\u540e\u628a\u5b83\u90e8\u7f72\u5230\u6211\u4eec\u7684\u521b\u5efa\u51fa\u6765\u7684\u533a\u5757\u94fe\u7f51\u7edc\u4e0a\uff0c\u6700\u540e\u4f9b\u4e0a\u5c42\u7684\u670d\u52a1\u8c03\u7528\u533a\u5757\u94fe\u76f8\u5173\u7684\u5408\u7ea6\u6765\u8fdb\u884c\u4e1a\u52a1\u7684\u6d41\u8f6c\u3002\\n\\n\u56e0\u4e3a\u94fe\u7684\u8282\u70b9\u975e\u5e38\u591a\uff0c\u5c11\u5219\u51e0\u5341\u4e2a\uff0c\u591a\u5219\u4e0a\u5343\u4e2a\uff0c\u5982\u679c\u6ca1\u6709 BaaS \u5e73\u53f0\u7684\u652f\u6301\uff0c\u6211\u4eec\u5f88\u96be\u76d1\u63a7\u548c\u7ef4\u62a4\u94fe\u7684\u8fd0\u884c\u3002\u901a\u8fc7\u4f7f\u7528 BaaS \u5e73\u53f0\uff0c\u7528\u6237\u4e0d\u4ec5\u80fd\u591f\u8282\u7ea6\u6210\u672c\uff0c\u800c\u4e14\u53ef\u4ee5\u66f4\u52a0\u4fbf\u6377\u5730\u7ba1\u7406\u533a\u5757\u94fe\uff0c\u63d0\u5347\u6574\u4e2a\u7cfb\u7edf\u7684\u5b89\u5168\u7cfb\u6570\u3002\\n\\n\u8da3\u94fe\u79d1\u6280 BaaS \u4ea7\u54c1\u7684\u67b6\u6784\u603b\u5171\u5206\u4e3a\u56db\u5c42\uff0c\u5206\u522b\u4e3a\u8d44\u6e90\u5c42\u3001\u533a\u5757\u94fe\u5e95\u5c42\u3001\u533a\u5757\u94fe\u670d\u52a1\u5c42\u548c\u5e94\u7528\u5c42\u3002\\n\\n![\u8da3\u94fe\u79d1\u6280 BaaS \u4ea7\u54c1\u7684\u67b6\u6784](https://static.apiseven.com/202108/1630647274805-f2b960c4-57af-4257-99b4-9185dd5db255.png)\\n\\n\u73b0\u5728\u6211\u4eec\u5bf9 Baas \u5e73\u53f0\u6709\u4e86\u521d\u6b65\u7684\u4e86\u89e3\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b Apache APISIX \u5728 BaaS \u7cfb\u7edf\u4e0a\u7684\u4f7f\u7528\u573a\u666f\u4e0e\u6536\u83b7\u3002\\n\\n## Apache APISIX \u7684\u4f7f\u7528\u573a\u666f\\n\\n### \u573a\u666f 1\uff1a\u5728 BaaS \u7cfb\u7edf\u4e0a\u7684\u843d\u5730\u5b9e\u8df5\\n\\n![Apache APISIX \u5728 BaaS \u7cfb\u7edf\u4e0a\u7684\u5e94\u7528](https://static.apiseven.com/202108/1637027614625-f3ca4571-19d1-4aab-95e8-e524db104968.png)\\n\\n\u4ece\u8fd9\u5f20\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u7684\u67b6\u6784\u4e0d\u4ec5\u662f\u5fae\u670d\u52a1\u5316\u7684\uff0c\u800c\u4e14\u5206\u4e3a\u4e24\u5c42\uff0c\u5206\u522b\u662f\u4e1a\u52a1\u63a5\u5165\u5c42\u548c\u6838\u5fc3\u670d\u52a1\u5c42\u3002\\n\\nBFF\uff08Backend For Frontend\uff09\u4e00\u822c\u5bf9\u7740\u524d\u7aef\uff0c\u901a\u8fc7 HTTP \u63a5\u5165\u3002\u6838\u5fc3\u670d\u52a1\u4e00\u822c\u662f\u901a\u8fc7\u7c7b\u4f3c Dubbo\u3001ETCD \u7b49\u670d\u52a1\u6ce8\u518c\uff0c\u6700\u540e\u4f7f\u7528 gRPC \u6765\u8bbf\u95ee\u3002\\n\\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u8da3\u94fe\u79d1\u6280\u7684 BaaS \u5e73\u53f0\u524d\u7aef\u8fde\u63a5\u7684\u90fd\u662f BFF \u6a21\u5757\uff0c\u7136\u540e BFF \u6a21\u5757\u518d\u53bb\u8fde\u63a5\u540e\u9762\u7684\u5fae\u670d\u52a1\u6a21\u5757\u3002BFF \u7684\u4f5c\u7528\u4e3b\u8981\u5c31\u662f\u505a\u4e1a\u52a1\u805a\u5408\u3001\u683c\u5f0f\u9002\u914d\uff0c\u5e76\u628a\u6700\u7ec8\u7684\u7ed3\u679c\u6570\u636e\u7ed9\u5230\u524d\u7aef\u3002\\n\\n\u8fd9\u4e9b\u4e1a\u52a1\u6a21\u5757\u9700\u8981\u628a\u76f8\u5173\u4fe1\u606f\u5b58\u5230\u6ce8\u518c\u4e2d\u5fc3\uff08ETCD\uff09\uff0c\u5f53\u8981\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u518d\u901a\u8fc7\u7f51\u5173\u6a21\u5757\u628a\u4fe1\u606f\u8bfb\u53d6\u51fa\u6765\u3002\\n\\n![\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u4e1a\u52a1\u6d41\u7a0b](https://static.apiseven.com/202108/1630647395095-39602805-0d56-4838-add1-b8b0f6a5d716.png)\\n\\n\u5728\u6574\u4e2a\u6d41\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e3b\u8981\u7528\u5230\u4e86 Apache APISIX \u7684\u56db\u4e2a\u7279\u6027\uff1a\\n\\n- \u8def\u7531\u8f6c\u53d1\\n- \u6d41\u91cf\u63a7\u5236\\n- \u5b89\u5168\u63a7\u5236\\n- \u52a8\u6001\u52a0\u8f7d\\n\\n\u6211\u4eec\u4e0b\u9762\u518d\u6765\u4e86\u89e3\u4e0b\u8fd9\u4e9b\u7279\u6027\u5728\u8da3\u94fe BaaS \u7cfb\u7edf\u4e0a\u662f\u5982\u4f55\u4f7f\u7528\u7684\u3002\\n\\n#### \u8def\u7531\u8f6c\u53d1\\n\\n![Apache APISIX Proxy-rewrite \u8def\u7531\u8f6c\u53d1](https://static.apiseven.com/202108/1630647494816-d78b6ea1-b291-446c-be36-fc2aae57ca7e.png)\\n\\n\u8da3\u94fe\u79d1\u6280\u4f7f\u7528 Apache APISIX \u5b98\u65b9\u63d0\u4f9b\u7684 Proxy-rewrite \u63d2\u4ef6\u6267\u884c\u8def\u7531\u8f6c\u53d1\u670d\u52a1\u3002\\n\\n\u5f53\u4e00\u4e2a\u8bf7\u6c42\u8bbf\u95ee 8080 \u7aef\u53e3\uff0c\u901a\u8fc7 Proxy-rewrite \u63d2\u4ef6\uff0c\u8bf7\u6c42\u4f1a\u88ab\u8f6c\u53d1\u5230\u5bf9\u5e94\u670d\u52a1\u7684 API \u4e0a\u53bb\u3002\\n\\n![Apache APISIX Proxy-rewrite \u8def\u7531\u8f6c\u53d1](https://static.apiseven.com/202108/1630647560207-1f931523-c9e7-4e58-95e1-c1c56cb1af3a.png)\\n\\n\u4e0a\u56fe\u4e3a Proxy-rewrite \u7684\u64cd\u4f5c\u754c\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u53ef\u4ee5\u901a\u8fc7\u6b63\u5219\u5339\u914d\u6765\u5339\u914d\u81ea\u5df1\u7684\u8f6c\u53d1\u89c4\u5219\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5199 HOST \u6216\u8005\u901a\u8fc7 URL \u6765\u5339\u914d\u3002\\n\\n#### \u9650\u6d41\u7ba1\u7406\\n\\n![Apache APISIX \u9650\u6d41\u7ba1\u7406](https://static.apiseven.com/202108/1630647608569-086d3303-027b-4e11-ac09-3a9cca9405bd.png)\\n\\n\u5728\u8da3\u94fe BaaS \u5e73\u53f0\u4e2d\uff0c\u5ba2\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u6784\u5efa\u4efb\u4f55\u94fe\u3002\u6b64\u65f6\uff0cBaaS \u5e73\u53f0\u9700\u8981\u5feb\u901f\u5730\u652f\u6301\u521b\u5efa\u8fd9\u4e9b\u94fe\uff0c\u5e76\u5bf9\u5b83\u4eec\u8fdb\u884c\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002\\n\\n\u8fd9\u4e9b\u8054\u76df\u94fe\u7684\u521b\u5efa\uff0c\u5e76\u4e0d\u662f\u901a\u8fc7\u786c\u4ee3\u7801\u76f4\u63a5\u5199\u5728\u4ee3\u7801\u4e0a\uff0c\u800c\u662f\u901a\u8fc7\u9a71\u52a8\u7ec4\u4ef6\u6765\u89e3\u51b3\u7684\u3002\u5728\u79c1\u6709\u5316\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u6709\u8fd9\u6837\u9a71\u52a8\u7ec4\u4ef6\u6765\u5feb\u901f\u5730\u63d0\u4f9b\u652f\u6301\uff0c\u5e76\u9700\u8981\u63a7\u5236\u9a71\u52a8\u8fdb\u7a0b\u7684\u8bbf\u95ee\u9891\u7387\u3002\\n\\n![Apache APISIX \u9650\u6d41\u7ba1\u7406](https://static.apiseven.com/202108/1630647661769-3e026b06-35c6-4b1f-9de9-054c69415e2c.png)\\n\\n\u5728\u6ca1\u6709 Apache APISIX \u4e4b\u524d\uff0c\u5e73\u53f0\u9700\u8981\u81ea\u5df1\u5199\u903b\u8f91\u4ee3\u7801\uff0c\u6709 Apache APISIX \u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5b98\u65b9\u63d0\u4f9b\u7684 Limit-req \u63d2\u4ef6\u6765\u9650\u5236\u8f93\u5165\u8f93\u51fa\uff0c\u4ee5\u8fbe\u5230\u4fdd\u62a4\u7cfb\u7edf\u7684\u76ee\u7684\u3002\u901a\u8fc7 Limit-req \u63d2\u4ef6\u7684\u64cd\u4f5c\u754c\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u914d\u7f6e\u901f\u5ea6\u3001\u6876\u9ad8\u7b49\u53c2\u6570\u3002\\n\\n![Apache APISIX \u9650\u6d41\u7ba1\u7406](https://static.apiseven.com/202108/1630647699093-f071ccc1-c122-4463-928e-0eb46d5aa1aa.png)\\n\\n#### \u5b89\u5168\u63a7\u5236\u3001\u6743\u9650\u7ba1\u7406\\n\\n![Apache APISIX \u5b89\u5168\u63a7\u5236](https://static.apiseven.com/202108/1630647753459-a693194d-369a-47fb-b9c3-a01fb97853b7.png)\\n\\n\u5728\u8da3\u94fe\u79d1\u6280\u7684\u79c1\u6709\u5316\u573a\u666f\uff0c\u6709\u4e0d\u5c11\u7528\u6237\u4e0d\u559c\u6b22\u7528\u5e73\u53f0\u6240\u63d0\u4f9b\u7684\u8d26\u53f7\u4f53\u7cfb\uff0c\u8981\u6c42\u5e73\u53f0\u5bf9\u63a5\u4ed6\u4eec\u73b0\u6709\u7684\u8d26\u6237\u7cfb\u7edf\uff0c\u6240\u4ee5\u8da3\u94fe\u79d1\u6280\u4f7f\u7528\u4e86 Apache APISIX \u7684 Access-Auth \u63d2\u4ef6\u6765\u9002\u914d\u7b2c\u4e09\u65b9\u7684\u9274\u6743\u670d\u52a1\u5730\u5740\u3002\\n\\n![Apache APISIX \u5b89\u5168\u63a7\u5236](https://static.apiseven.com/202108/1630648022609-85bbfa93-ab67-4c58-9cbf-8d360115ea4f.png)\\n\\n\u5728\u8da3\u94fe\u79d1\u6280\u7684 Baas \u5e73\u53f0\u4e2d\uff0c\u6240\u6709\u7684 Web \u8bf7\u6c42\u90fd\u4f1a\u7ecf\u8fc7 Apache APISIX \u7684 Access-Auth \u63d2\u4ef6\uff0c\u5b8c\u6210 cookie \u89e3\u6790\u548c\u9274\u6743\uff0c\u7136\u540e\u5728 HEAD \u5934\u4e2d\u643a\u5e26\u7528\u6237\u4fe1\u606f\uff0c\u4f20\u7ed9\u540e\u7aef\u7684\u5fae\u670d\u52a1\u6765\u5904\u7406\u4e1a\u52a1\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u5fae\u670d\u52a1\u7684\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u53bb\u89e3\u6790 Cookie\uff0c\u800c\u662f\u53ef\u4ee5\u76f4\u63a5\u628a\u7528\u6237\u4fe1\u606f\u53d1\u9001\u5230\u5fae\u670d\u52a1\u6a21\u5757\uff0c\u975e\u5e38\u65b9\u4fbf\u3002\\n\\n#### \u52a8\u6001\u52a0\u8f7d\\n\\n![Apache APISIX \u52a8\u6001\u52a0\u8f7d](https://static.apiseven.com/202108/1630648314372-43fcba14-2822-46ca-bc97-916a89871715.png)\\n\\n\u4e0a\u56fe\u5de6\u8fb9\u662f\u8da3\u94fe\u79d1\u6280 Baas \u5e73\u53f0\u7684\u5ba2\u6237\u7aef\u754c\u9762\uff0c\u4e0a\u9762\u6ca1\u6709 \u201c\u5546\u5e97\u201d \u7684\u6309\u94ae\uff1b\u4f46\u5728\u4e0a\u56fe\u7684\u53f3\u8fb9\uff0c\u8da3\u94fe\u79d1\u6280\u7684 Baas \u516c\u5171\u5e73\u53f0\u4e0a\u5374\u6709\u4e00\u4e2a \u201c\u5546\u5e97\u201d \u7684\u6309\u94ae\u3002\u5728\u67d0\u4e9b\u79c1\u6709\u5316\u573a\u666f\u4e2d\u4e0d\u9700\u8981 \u201c\u5546\u5e97\u201d \u6309\u94ae\uff0c\u4f46\u4e8c\u8005\u7684\u540e\u53f0\u670d\u52a1\u662f\u5171\u4eab\u7684\uff0c\u53ea\u8981\u540e\u7aef\u670d\u52a1\u4e00\u542f\u52a8\uff0c\u5e73\u53f0\u754c\u9762\u5c31\u4f1a\u6839\u636e\u9700\u6c42\u8fdb\u884c\u4e0d\u540c\u7684\u663e\u793a\u3002\\n\\n\u8da3\u94fe\u79d1\u6280\u5229\u7528 Apache APISIX \u4e0e\u670d\u52a1\u4e2d\u5fc3\u534f\u540c\u8fd0\u4f5c\uff0c\u4fdd\u8bc1\u524d\u7aef\u5fae\u670d\u52a1\u4e1a\u52a1\u6a21\u5757\u7684\u65b0\u589e\u548c\u8c03\u6574\uff0c\u8fd9\u8ba9\u8da3\u94fe\u79d1\u6280 Baas \u5e73\u53f0\u7684\u7ebf\u4e0a\u53d1\u5e03\u6d41\u7a0b\u53d8\u5f97\u975e\u5e38\u7b80\u5355\u3002\\n\\n### \u573a\u666f 2\uff1a\u5728\u533a\u5757\u94fe\u8282\u70b9\u4e0a\u7684\u843d\u5730\u5b9e\u8df5\\n\\n![\u533a\u5757\u94fe\u8282\u70b9](https://static.apiseven.com/202108/1630648472228-b61451ca-4e4d-4410-877c-395c8770c85e.png)\\n\\n\u901a\u8fc7\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\u6709 A\u3001B\u3001C \u4e09\u6761\u94fe\uff0c\u8fd9\u4e09\u6761\u94fe\u662f\u600e\u4e48\u521b\u5efa\u51fa\u6765\u7684\u5462\uff1f\\n\\n\u5f53\u7528\u6237\u901a\u8fc7 BaaS \u5e73\u53f0\u8d2d\u4e70\u4e86\u4e00\u6761\u94fe\uff0c\u5b83\u7684\u4e0a\u5c42\u4e1a\u52a1\u6216\u5f00\u53d1\u8005\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u76f4\u8fde\u8282\u70b9\uff0c\u6bd4\u5982\u67d0\u94f6\u884c\u8fde\u5de6\u4e09\u4e2a\uff0c\u67d0\u4fdd\u9669\u8fde\u53f3\u4e09\u4e2a\uff0c\u6216\u8005\u6709\u7684\u7528\u6237\u5c31\u8bbf\u95ee\u4e00\u6574\u6761\u94fe\u3002\u8fd9\u6837\u4f1a\u5e26\u6765\u4e00\u4e2a\u5f88\u5927\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u57fa\u672c\u4e0a\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u88ab\u8bbf\u95ee\u5230\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728\u516c\u7f51\u73af\u5883\u4e0a\u628a\u6240\u6709\u7684\u533a\u5757\u94fe\u4e0a\u7684\u8282\u70b9\u5168\u90e8\u90fd\u66b4\u9732\u51fa\u6765\u3002\\n\\n#### \u8282\u7ea6\u516c\u7f51\u7aef\u53e3\\n\\n![\u516c\u7f51\u7aef\u53e3](https://static.apiseven.com/202108/1630648545755-fd385832-3375-4ac9-89f6-4c2bb10780be.png)\\n\\n\u4ee5\u8fd9\u5f20\u56fe\u4e3a\u4f8b\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 6 \u4e2a\u8282\u70b9\uff0c\u90a3\u8fd9\u6761\u94fe\u5c31\u81f3\u5c11\u9700\u8981\u6709 6 \u4e2a\u516c\u7f51 IP \u548c 6 \u4e2a\u7aef\u53e3\u3002\\n\\n\u8fd9\u79cd\u60c5\u51b5\u5bf9\u79c1\u6709\u5316\u7684\u7528\u6237\u6765\u8bf4\u53ef\u80fd\u8fd8\u53ef\u4ee5\u63a5\u53d7\uff0c\u4f46\u662f\u5bf9\u4e8e\u50cf\u8da3\u94fe\u8fd9\u6837\u5168\u90e8\u5bf9\u4e92\u8054\u7f51\u7528\u6237\u5f00\u653e\u7684 BaaS \u5e73\u53f0\uff0c\u5c11\u5219\u9700\u8981\u51e0\u5341\u4e2a\uff0c\u591a\u5219\u9700\u8981\u4e0a\u767e\u4e2a\u3001\u4e0a\u5343\u4e2a\u516c\u7f51 IP\u3002\u8fd9\u6837\u4e0d\u4ec5\u6210\u672c\u975e\u5e38\u9ad8\uff0c\u4e5f\u5bf9\u516c\u7f51 IP \u8d44\u6e90\u9020\u6210\u4e86\u6d6a\u8d39\u3002\\n\\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u8da3\u94fe\u79d1\u6280\u7684 Baas \u5e73\u53f0\u4f7f\u7528\u4e86 Apache APISIX \u7edf\u4e00\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u65e0\u9700\u8054\u76df\u94fe\u5168\u91cf\u8282\u70b9\u66b4\u9732\u5916\u7f51\u8bbf\u95ee\u7aef\u53e3\uff0c\u53ef\u4ee5\u6709\u6548\u8282\u7ea6\u6210\u672c\u3002\\n\\n#### \u8bbf\u95ee\u6743\u9650\u63a7\u5236\\n\\n![\u8bbf\u95ee\u6743\u9650\u63a7\u5236](https://static.apiseven.com/202108/1630648599393-f4e6a152-f6d6-47a4-b42a-a9a644be37f8.png)\\n\\n\u5bf9\u4e8e\u4f20\u7edf\u8f6f\u4ef6\u6765\u8bf4\uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u5f02\u6784\u94fe\u8bbf\u95ee\u90fd\u6709\u81ea\u5df1\u975e\u5e38\u590d\u6742\u7684 RBAC \u6743\u9650\u63a7\u5236\uff0c\u6240\u4ee5\u7528\u6237\u9700\u8981\u5728\u5ba2\u6237\u7aef\u52a0\u5f88\u591a\u8bc1\u4e66\uff0c\u975e\u5e38\u4ee4\u4eba\u5934\u75bc\u3002\\n\\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u75db\u70b9\uff0c\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u901a\u8fc7 Apache APISIX \u7684 Key-auth \u63d2\u4ef6\u8ba9\u6709\u6743\u9650\u7684\u7528\u6237\u76f4\u63a5\u80fd\u591f\u8bbf\u95ee\uff0c\u5e76\u4e14\u7edf\u4e00\u6240\u6709\u94fe\u7684\u6743\u9650\u63a7\u5236\u3002\\n\\n#### \u96c6\u7fa4\u5316\u63d0\u5347\u8282\u70b9\u7a33\u5b9a\u6027\\n\\n![\u533a\u5757\u94fe\u8282\u70b9](https://static.apiseven.com/202108/1630648704337-6e02ca0e-3e51-4251-8455-5b3bb7668912.png)\\n\\n\u533a\u5757\u94fe\u7684\u4e00\u4e2a\u7279\u6027\u662f\uff1a\u672c\u8d28\u4e0a\uff0c\u8bbf\u95ee\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u6837\u7684\u3002\u5c31\u50cf\u6bd4\u7279\u5e01\u4e00\u6837\uff0c\u6211\u4eec\u8bbf\u95ee\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u90fd\u80fd\u62ff\u5230\u6570\u636e\uff0c\u6240\u4ee5\u5f88\u591a\u7528\u6237\u76f4\u63a5\u5bf9\u7740\u67d0\u4e2a\u8282\u70b9\u8fdb\u884c\u64cd\u4f5c\u3002\\n\\n![\u63d0\u5347\u8282\u70b9\u7a33\u5b9a\u6027](https://static.apiseven.com/202108/1630648773610-b56cb8aa-f690-4b30-9933-78f429fd20bc.png)\\n\\n\u4f46\u662f\uff0c\u76f4\u63a5\u8bbf\u95ee\u5355\u8282\u70b9\u7684\u6a21\u5f0f\u5f88\u5bb9\u6613\u53d7\u5230\u653b\u51fb\u3002\u6bd4\u5982\u8bf4\uff0c\u94f6\u884c\u7684\u5e76\u53d1\u91cf\u975e\u5e38\u9ad8\uff0cTPS \u53ef\u4ee5\u8fbe\u5230 4-5W/\u79d2\uff0c\u6bcf\u4e00\u6b21\u4ea4\u6613\u90fd\u4f1a\u51b2\u51fb\u8fd9\u4e2a\u8282\u70b9\u3002\\n\\n\u4e3a\u4e86\u80fd\u591f\u8fbe\u5230\u5feb\u901f\u52a8\u6001\u6269\u5bb9\u7684\u6548\u679c\uff0c\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u5229\u7528 Apache APISIX \u5728 Kubernetes \u4e0a\u7684 HPA \u90e8\u7f72\u6a21\u5f0f\uff0c\u6839\u636e\u6d41\u91cf\u52a8\u6001\u5730\u6269\u5c55\uff0c\u6709\u6548\u89e3\u51b3\u4e86\u5355\u70b9\u6d41\u91cf\u51b2\u51fb\u95ee\u9898\u3002\\n\\n#### \u591a\u534f\u8bae\u652f\u6301\\n\\n![\u591a\u534f\u8bae](https://static.apiseven.com/202108/1630648817779-0c1ae8f9-0b40-403a-a759-e55f4423a6cf.png)\\n\\n\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u4f7f\u7528\u4e86\u5f88\u591a\u7684\u5f02\u6784\u94fe\uff0c\u8fd9\u5bfc\u81f4\u4f7f\u7528\u5230\u7684\u534f\u8bae\u975e\u5e38\u591a\u6837\uff0c\u5982 HTTP\u3001RPC\u3001WebSocket \u7b49\u3002\u800c Apache APISIX \u80fd\u5f88\u597d\u5730\u652f\u6301\u591a\u534f\u8bae\uff0c\u5b8c\u5168\u80fd\u6ee1\u8db3\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u5728\u76f8\u5173\u573a\u666f\u4e2d\u7684\u4f7f\u7528\uff0c\u80fd\u663e\u8457\u51cf\u5c11\u5f00\u53d1\u7684\u6210\u672c\u3002\\n\\n![\u591a\u534f\u8bae](https://static.apiseven.com/202108/1630648857753-05f65dc5-0ea6-4e9d-b9d4-b97089f97d59.png)\\nng)\\n\\n## \u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX\\n\\n\u5728 Apache APISIX \u4e4b\u524d\uff0c\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u5df2\u7ecf\u5728\u4f7f\u7528 Kong \u4e86\uff0c\u4f46\u662f\u540e\u6765 Kong \u88ab\u653e\u5f03\u4e86\u3002\\n\\n**\u4e3a\u4ec0\u4e48\u653e\u5f03 Kong\uff1f**\\n\\nKong \u4f7f\u7528 PostgreSQL \u6765\u5b58\u50a8\u5b83\u7684\u4fe1\u606f\uff0c\u8fd9\u663e\u7136\u4e0d\u662f\u4e00\u4e2a\u597d\u65b9\u5f0f\u3002\\n\\n![Kong](https://static.apiseven.com/202108/1630648907559-71716f82-6740-468c-afe0-49daa426d93a.png)\\n\\n\u5728\u8f6f\u4ef6\u884c\u4e1a\uff0c\u6570\u636e\u5e93\u7684\u9ad8\u53ef\u7528\u914d\u7f6e\u975e\u5e38\u590d\u6742\u3002\u4e0d\u4ec5\u9700\u8981\u914d\u5907\u4e13\u95e8\u7684 DBA\uff0c\u5b9e\u65bd\u96be\u5ea6\u4e5f\u975e\u5e38\u5927\u3002\\n\\n\u8da3\u94fe\u79d1\u6280 BaaS \u7cfb\u7edf\u672c\u8eab\u5df2\u7ecf\u5728\u4f7f\u7528 MySQL\uff0c\u5982\u679c\u8fd9\u91cc\u8fd8\u9700\u8981\u642d\u5efa\u4e00\u4e2a PostgreSQL \u6570\u636e\u5e93\u7684\u8bdd\uff0c\u610f\u5473\u7740\u8da3\u94fe\u79d1\u6280\u7684 BaaS \u7cfb\u7edf\u9700\u8981\u6709\u4e24\u5957\u5173\u7cfb\u578b\u6570\u636e\u5e93\u3002\u8fd9\u4f1a\u7ed9\u5b9e\u65bd\u96be\u5ea6\u3001\u8fd0\u7ef4\u6210\u672c\u5e26\u6765\u66f4\u591a\u9ebb\u70e6\uff0c\u5f15\u5165\u66f4\u591a\u98ce\u9669\u3002\\n\\n\u540c\u65f6\uff0c\u56e0\u4e3a\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u4e5f\u6709\u4e0d\u5c11\u5730\u65b9\u7528\u5230\u4e86 etcd\uff0c\u6240\u4ee5\u6700\u540e\u8da3\u94fe\u79d1\u6280\u9009\u62e9\u653e\u5f03 Kong\uff0c\u5168\u9762\u6295\u5411\u4e86\u57fa\u4e8e etcd \u7684 Apache APISIX\u3002\\n\\n**\u4e3a\u4ec0\u4e48\u4e0d\u4f7f\u7528 Nginx\uff1f**\\n\\n\u53ef\u80fd\u4f1a\u6709\u670b\u53cb\u4f1a\u60f3\uff0c\u90a3\u4e3a\u4ec0\u4e48\u4e0d\u4f7f\u7528 Nginx\uff1f\\n\\n\u5176\u5b9e\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u4ee5\u524d\u7528\u7684\u5c31\u662f Nginx\uff0c\u4f46\u662f\u540e\u6765\u53d1\u73b0\uff0cNginx \u4e0e Apache APISIX \u76f8\u6bd4\u8fd8\u662f\u6709\u5f88\u591a\u4e0d\u5b8c\u5584\u7684\u5730\u65b9\u3002\\n\\n![Nginx](https://static.apiseven.com/202108/1630648946732-532ee7ac-478e-4f6c-aaa6-1f7f6be60693.png)\\n\\n- **\u70ed\u542f\u52a8\u3001\u70ed\u63d2\u4ef6\u95ee\u9898**\\n\\n\u5728\u8da3\u94fe BaaS \u5e73\u53f0\u4e2d\uff0c\u6211\u4eec\u4e0d\u4ec5\u9700\u8981\u5bf9\u8054\u76df\u94fe\u8fdb\u884c\u7ba1\u7406\uff0c\u800c\u4e14\u8981\u80fd\u591f\u968f\u65f6\u5bf9\u8282\u70b9\u8fdb\u884c\u65b0\u589e\u3001\u5220\u9664\u3002\u5982\u679c\u4f7f\u7528 Nginx\uff0c\u4e0d\u4ec5\u5b58\u5728\u6269\u5c55\u6027\u95ee\u9898\uff0c\u8c03\u6574\u914d\u7f6e\u540e\u8fd8\u9700\u8981\u91cd\u542f\u3002\u800c\u4e14\u5728\u63d2\u4ef6\u7684\u7f16\u5199\u4e0a\uff0cNginx \u4e0a\u9700\u8981\u914d\u7f6e\u975e\u5e38\u590d\u6742\u7684\u89c4\u5219\u4ee3\u7801\u3002\\n\\n- **\u96c6\u7fa4\u5316\u56f0\u96be**\\n\\nNginx \u7684\u96c6\u7fa4\u5316\u975e\u5e38\u56f0\u96be\uff0c\u800c Apache APISIX \u53ef\u4ee5\u901a\u8fc7 etcd \u96c6\u7fa4\u7684\u589e\u5f3a\u529f\u80fd\u6765\u5b9e\u73b0\u3002\\n\\n- **\u65e0\u6cd5\u76f4\u63a5\u4ee3\u7406 TCP\u3001UDP**\\n\\nNginx \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ea\u80fd\u5b9e\u73b0\u4e03\u5c42\u7f51\u7edc\u7684\u4ee3\u7406\uff0c\u5982\u679c\u8981\u652f\u6301\u56db\u5c42\u7f51\u7edc\uff0c\u9700\u8981\u628a Stream \u6a21\u5757\u91cd\u65b0\u7f16\u8bd1\uff0c\u800c Apache APISIX \u80fd\u540c\u65f6\u652f\u6301\u56db / \u4e03\u5c42\u7684\u4ee3\u7406\u3002\\n\\n- **\u6ca1\u6709\u826f\u597d\u7684 Dashboard**\\n\\nNginx \u6ca1\u6709 Dashboard\uff0c\u800c Apache APISIX Dashboard \u80fd\u8ba9\u5f00\u53d1\u3001\u8fd0\u7ef4\u4eba\u5458\u5bf9\u4e8e\u7ba1\u7406\u8282\u70b9\u7684\u96be\u5ea6\u53d8\u5c0f\u3002\\n\\n## \u672a\u6765\u89c4\u5212\\n\\n![\u672a\u6765\u89c4\u5212](https://static.apiseven.com/202108/1630648997393-b5e6dd0e-3a2f-4dc7-94c1-cc892054ad09.png)\\n\\n### 1.\u8fd0\u7528 Apache APISIX \u63d0\u4f9b\u6216\u81ea\u7814\u7684\u65e5\u5fd7\u63d2\u4ef6\\n\\nApache APISIX \u5b98\u7f51\u5df2\u63d0\u4f9b\u4e86\u4e0d\u5c11\u65e5\u5fd7\u63d2\u4ef6\uff0c\u6bd4\u5982\u5bf9 HTTP\u3001UDP \u7684\u652f\u6301\uff0c\u5305\u62ec Kafka \u7b49\uff0c\u4f46\u50cf\u8da3\u94fe BaaS \u8fd9\u6837\u9700\u8981\u7ba1\u63a7\u6210\u5343\u4e0a\u4e07\u533a\u5757\u94fe\u7f51\u7edc\u7684\u5e73\u53f0\uff0c\u5f53\u6bcf\u6b21\u95ee\u9898\u53d1\u751f\u7684\u65f6\u5019\uff0c\u5728\u65e5\u5fd7\u4e2d\u7ffb\u627e\u6545\u969c\u75d5\u8ff9\u90fd\u662f\u4e00\u4ef6\u975e\u5e38\u5934\u75db\u7684\u4e8b\u60c5\u3002\\n\\n\u5728\u4e0d\u4e45\u7684\u5c06\u6765\uff0c\u8da3\u94fe\u79d1\u6280\u4f1a\u5728 BaaS \u7cfb\u7edf\u548c\u533a\u5757\u94fe\u7cfb\u7edf\u4e4b\u95f4\uff0c\u57fa\u4e8e Apache APISIX \u589e\u52a0\u4e00\u4e9b APM \u529f\u80fd\uff0c\u63d0\u5347\u591a\u94fe\u573a\u666f\u4e0b\u7684\u8fd0\u7ef4\u7ba1\u7406\u6548\u7387\u3002\\n\\n### 2.\u5f00\u53d1\u76d1\u7ba1\u63d2\u4ef6\uff0c\u5b9e\u73b0\u64cd\u4f5c\u7559\u75d5\u53ca\u6eaf\u6e90\\n\\n\u56fd\u5185\u5bf9\u4e8e\u533a\u5757\u94fe\u7684\u76d1\u7ba1\u975e\u5e38\u4e25\u683c\uff0c\u4e00\u5207\u64cd\u4f5c\u90fd\u9700\u8981\u7559\u75d5\u548c\u6eaf\u6e90\u3002\u672a\u6765\uff0c\u8da3\u94fe\u79d1\u6280\u4f1a\u57fa\u4e8e Apache APISIX \u5f00\u53d1\u76d1\u7ba1\u63d2\u4ef6\u6765\u63d0\u5347\u76d1\u7ba1\u80fd\u529b\uff0c\u589e\u52a0 VIP\u3001\u767d\u540d\u5355\u3001\u56de\u653e\u7b49\u529f\u80fd\u3002\\n\\n### 3.\u4f7f\u7528 APISIX Ingress Controller\uff0c\u4ee3\u66ff Kubernetes \u9ed8\u8ba4\u7684 Nginx-Ingress\\n\\n\u5728\u90e8\u7f72 Kubernetes \u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e00\u822c\u90fd\u4f1a\u9009\u62e9 Nginx-Ingress \u6765\u5904\u7406\u5916\u7f51\u8bf7\u6c42\uff0c\u4f46\u56e0\u4e3a\u4e0a\u9762\u63d0\u5230\u7684\u4e00\u4e9b Nginx \u7684\u95ee\u9898\uff0c\u8da3\u94fe\u79d1\u6280\u6b63\u5728\u8c03\u7814\u4f7f\u7528 APISIX Ingress Controller\u3002\\n\\n### 4.\u63a2\u7d22 Service Mesh\\n\\n\u8da3\u94fe\u79d1\u6280\u4e4b\u524d\u5c1d\u8bd5\u8fc7 traffic-mesh\uff0c\u672a\u6765\u4f1a\u5c1d\u8bd5\u4f7f\u7528 APISIX Mesh\u3002"},{"id":"\u5982\u4f55\u5229\u7528 Apache APISX \u63d0\u5347 NGINX \u7684\u53ef\u89c2\u6d4b\u6027","metadata":{"permalink":"/zh/blog/2021/08/06/using-apache-apisix-to-improve-the-observability-of-nginx","source":"@site/blog/2021/08/06/using-apache-apisix-to-improve-the-observability-of-nginx.md","title":"\u5982\u4f55\u5229\u7528 Apache APISX \u63d0\u5347 NGINX \u7684\u53ef\u89c2\u6d4b\u6027","description":"\u672c\u6587\u5c06\u4ece Nginx \u53ef\u89c2\u6d4b\u6027\u3001Apache APISIX \u4e0e Nginx \u7684\u5173\u7cfb\u3001Apache APISIX \u53ef\u89c2\u6d4b\u6027\uff0c\u4ee5\u53ca\u7ed3\u5408 Apache SkyWalking \u8fdb\u4e00\u6b65\u63d0\u5347\u53ef\u89c2\u6d4b\u6027\u7b49\u65b9\u9762\u5206\u4eab\u5173\u4e8e\u53ef\u89c2\u6d4b\u6027\u7684\u65b9\u6848\u4e0e\u5b9e\u8df5\u3002","date":"2021-08-06T00:00:00.000Z","formattedDate":"2021\u5e748\u67086\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":19.22,"truncated":true,"authors":[{"name":"\u91d1\u536b","url":"https://github.com/gxthrj","imageURL":"https://avatars.githubusercontent.com/u/4413028?v=4"}],"prevItem":{"title":"\u820d\u5f03 Kong \u548c NGINX\uff0cAPISIX \u5728\u8da3\u94fe\u79d1\u6280 BaaS \u5e73\u53f0\u7684\u843d\u5730\u5b9e\u8df5","permalink":"/zh/blog/2021/08/09/apache-apisix-in-quliankeji"},"nextItem":{"title":"Kong-To-APISIX \u8fc1\u79fb\u5de5\u5177","permalink":"/zh/blog/2021/08/05/kong-to-apisix"}},"content":"> \u672c\u6587\u5c06\u4ece Nginx \u53ef\u89c2\u6d4b\u6027\u3001Apache APISIX \u4e0e Nginx \u7684\u5173\u7cfb\u3001Apache APISIX \u53ef\u89c2\u6d4b\u6027\uff0c\u4ee5\u53ca\u7ed3\u5408 Apache SkyWalking \u8fdb\u4e00\u6b65\u63d0\u5347\u53ef\u89c2\u6d4b\u6027\u8fd9\u4e9b\u65b9\u9762\u5206\u4eab\u5173\u4e8e\u53ef\u89c2\u6d4b\u6027\u7684\u65b9\u6848\u4e0e\u5b9e\u8df5\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u6982\u8ff0\\n\\n\u201c\u53ef\u89c2\u6d4b\u6027\u201c\u662f\u4e00\u79cd\u5ea6\u91cf\u624b\u6bb5\uff0c\u65b9\u4fbf\u638c\u63e1\u57fa\u7840\u8bbe\u65bd\u3001\u7cfb\u7edf\u5e73\u53f0\u6216\u8005\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u72b6\u51b5\u3002\u5e38\u89c1\u7684\u624b\u6bb5\u662f\u6536\u96c6 metrics\u3001logging \u548c tracing \u53ca events \u6570\u636e\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u548c\u8fd0\u7ef4\u4eba\u5458\u68c0\u6d4b\u3001\u8c03\u67e5\u3001\u9884\u8b66\u548c\u7ea0\u6b63\u7cfb\u7edf\u95ee\u9898\u3002\\n\\n\u672c\u6587\u5c06\u4ece Nginx \u53ef\u89c2\u6d4b\u6027\u3001Apache APISIX \u4e0e Nginx \u7684\u5173\u7cfb\u3001Apache APISIX \u53ef\u89c2\u6d4b\u6027\uff0c\u4ee5\u53ca\u7ed3\u5408 Apache SkyWalking \u8fdb\u4e00\u6b65\u63d0\u5347\u53ef\u89c2\u6d4b\u6027\u8fd9\u4e9b\u65b9\u9762\u5206\u4eab\u5173\u4e8e\u53ef\u89c2\u6d4b\u6027\u7684\u65b9\u6848\u4e0e\u5b9e\u8df5\u3002\\n\\n## Nginx \u7684\u53ef\u89c2\u6d4b\u6027\\n\\n### Nginx \u5e38\u89c1\u76d1\u63a7\u65b9\u5f0f\\n\\nNginx \u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u80fd\u591f\u505a\u5230\u53ef\u89c2\u6d4b\uff0c\u4ee5\u4e0b\u7f57\u5217\u51fa Nginx \u7684\u5e38\u89c1\u76d1\u63a7\u65b9\u5f0f\uff1a\\n\\n1. ngx_http_stub_status_module\\n2. VTS module + exporter + prometheus + grafana\uff08\u5982\u679c Nginx \u7248\u672c\u6bd4\u8f83\u4f4e\uff0c\u9700\u8981\u5f15\u5165 exporter \uff09\\n3. Nginx Amplify SaaS\\n\\n#### ngx_http_stub_status_module\\n\\nngx_http_stub_status_module \u4e3b\u8981\u6536\u96c6\u5b9e\u4f8b\u7ea7\u522b\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\\n\\n#### VTS module\\n\\nVTS module \u6709 3 \u4e2a\u6bd4\u8f83\u660e\u663e\u7684\u7f3a\u70b9\uff1a\\n\\n1. **\u5b89\u88c5\u590d\u6742**\uff1a\u867d\u7136 VTS module \u80fd\u591f\u91c7\u96c6\u6307\u6807\uff0c\u91c7\u96c6\u7684\u6307\u6807\u7c7b\u578b\u4e5f\u6bd4\u8f83\u591a\uff0c\u4f46\u662f\u5b83\u7684\u5b89\u88c5\u6bd4\u8f83\u590d\u6742\u3002\u5982\u679c\u60f3\u8981\u91c7\u7528 VTS module\uff0c\u9700\u8981\u91cd\u65b0\u7f16\u8bd1 Nginx\uff0c\u5728\u7f16\u8bd1 Nginx \u4e4b\u524d\u52a0\u5165 VTS moudle\uff0c\u5b8c\u6210\u7f16\u8bd1\u540e\u91cd\u65b0\u5b89\u88c5 Nginx \u624d\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528 VTS\u3002\\n\\n2. **\u6269\u5c55\u80fd\u529b\u5f31**\uff1aVTS \u6269\u5c55\u80fd\u529b\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u4e00\u662f\u5728\u7f16\u8bd1\u4e4b\u524d\u7ed9 VTS \u589e\u52a0\u6269\u5c55\uff1b\u4e8c\u662f\u5728\u7f16\u8bd1\u4e4b\u540e\u589e\u52a0\u6269\u5c55 \u2014\u2014 \u4fee\u6539 nginx.conf \u914d\u7f6e\u6587\u4ef6\u3002\u901a\u8fc7\u4fee\u6539 nginx.conf \u6587\u4ef6\u6765\u589e\u52a0\u6269\u5c55\u4f1a\u4f7f Nginx reload\uff0c\u751f\u4ea7\u73af\u5883\u76f4\u63a5 reload \u6216\u591a\u6216\u5c11\u4f1a\u5bf9\u4e1a\u52a1\u4ea7\u751f\u4e00\u4e9b\u5f71\u54cd\u3002\\n\\n3. **\u793e\u533a\u66f4\u65b0\u7f13\u6162**\uff1aVTS module \u6700\u65b0\u7684\u4e00\u6b21\u66f4\u65b0\u662f\u5728 2018 \u5e74\uff0c\u5df2\u7ecf\u505c\u6446 3 \u5e74\u4e86\u3002\\n\\n#### Nginx Amplify SaaS\\n\\nNginx Amplify \u662f\u4e00\u4e2a SaaS \u670d\u52a1\uff0cNginx Amplify \u5728\u8fdc\u7aef\u63d0\u4f9b\u670d\u52a1\uff0c\u5728 Nginx \u670d\u52a1\u4e4b\u5916\u5b89\u88c5 Agent\u3002\\n\u5728 Nginx \u4e4b\u5916\u5b89\u88c5\u91c7\u96c6\u6a21\u5757\uff0c\u90a3\u4e48\u5728\u91c7\u96c6\u6307\u6807\u4e0a\u5c31\u4f1a\u6709\u9650\u5236\uff0c\u53ea\u80fd\u62ff\u5230 Nginx \u66b4\u9732\u51fa\u6765\u7684\u4fe1\u606f\uff0c\u6ca1\u6709\u66b4\u9732\u7684\u5185\u90e8\u4fe1\u606f\u662f\u62ff\u4e0d\u5230\u7684\u3002\\n\\n\u53e6\u5916\uff0c\u7531\u4e8e Nginx Amplify SaaS \u662f\u4e00\u4e2a SaaS \u670d\u52a1\uff0c\u9700\u8981\u901a\u8fc7\u516c\u7f51\u5c06\u91c7\u96c6\u5230\u7684\u6570\u636e\u4f20\u5230\u670d\u52a1\u7aef\uff0c\u8fd9\u4f1a\u5e26\u6765\u4e00\u4e9b\u5b89\u5168\u9690\u60a3\uff0c\u540c\u65f6\u628a\u4e00\u4e9b\u4f01\u4e1a\u7528\u6237\u963b\u6321\u5728\u5916\u9762\u3002\u6216\u8bb8 Nginx Amplify \u7684\u76ee\u6807\u7fa4\u4f53\u662f Nginx plus \u8fd9\u6837\u7684\u4f01\u4e1a\u7528\u6237\uff0c\u4e0d\u662f\u5f00\u6e90\u7528\u6237\u3002\\n\\n\u53e6\u5916\uff0cNginx Amplify SaaS \u793e\u533a\u4e5f\u4e0d\u6d3b\u8dc3\uff0c\u5df2\u7ecf\u505c\u6446 2 \u5e74\u3002\\n\\n### Nginx \u7684\u7f3a\u9677\\n\\nNginx \u5728 Events \u6536\u96c6\u4e0a\u81ea\u8eab\u6709\u7f3a\u9677\uff0c\u8fd9\u91cc\u5217\u4e3e\u51fa\u4e24\u4e2a\u95ee\u9898\uff1a\\n\\n1. Nginx \u57fa\u4e8e nginx.conf \u8fdb\u884c\u914d\u7f6e\uff0c\u4fee\u6539\u540e\u901a\u8fc7 reload nginx.conf \u6587\u4ef6\u4f7f\u914d\u7f6e\u751f\u6548\u3002\u9664 reload \u4e8b\u4ef6\u5916\uff0c\u6ca1\u6709\u5176\u4ed6 Events \u53ef\u7528\uff0c\u6211\u4eec\u65e0\u6cd5\u5f97\u77e5\u6bcf\u6b21\u4fee\u6539\u6587\u4ef6\u7684\u53d8\u5316\uff0c\u5982\uff1a\u8d77\u521d\u53ea\u914d\u7f6e 1 \u4e2a\u8def\u7531\uff0c\u4fee\u6539\u6587\u4ef6\u589e\u52a0 10 \u4e2a\u8def\u7531\uff0c\u53ea\u6709 reload \u4e8b\u4ef6\u65e0\u6cd5\u5f97\u77e5\u589e\u52a0\u7684\u5230\u4f4e\u662f\u54ea 10 \u4e2a\u8def\u7531\u3002\\n\\n2. Nginx \u5f00\u6e90\u4ea7\u54c1\u7f3a\u5c11\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u3002Nginx \u662f\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\uff0c\u771f\u6b63\u7684\u540e\u7aef\u670d\u52a1\u53ef\u80fd\u4f1a\u51fa\u73b0\u91cd\u542f\u3001\u5347\u7ea7\u6216\u8005\u5f02\u5e38\u7684\u60c5\u51b5\uff0c\u5982\u679c\u6ca1\u6709\u4e3b\u52a8\u7684\u5065\u5eb7\u68c0\u67e5\uff0c\u4f9d\u9760\u88ab\u52a8\u68c0\u67e5\uff0c\u53ea\u80fd\u5728\u6d41\u91cf\u51fa\u73b0\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u624d\u77e5\u9053\u670d\u52a1\u51fa\u4e86\u95ee\u9898\uff0c\u8fd9\u4f1a\u4e22\u6389\u5f88\u591a Events\uff0c\u5bfc\u81f4\u4e0a\u6e38 Events \u4e8b\u4ef6\u4fe1\u606f\u4e0d\u5b8c\u6574\u3002\\n\\n### Nginx \u53ef\u89c2\u6d4b\u6027\u603b\u7ed3\\n\\nNginx \u7684\u5f00\u6e90\u7248\u672c\u6ca1\u6709\u63d0\u4f9b\u975e\u5e38\u597d\u7528\u7684\u76d1\u63a7\u3002\u867d\u7136 Nginx \u63d0\u4f9b\u4e86\u4e00\u4e9b\u76d1\u63a7\u5de5\u5177\uff0c\u4f46\u8fd9\u4e9b\u5de5\u5177\u7684\u5b89\u88c5\u548c\u914d\u7f6e\u975e\u5e38\u590d\u6742\uff0c\u51e0\u4e4e\u6ca1\u6709\u6269\u5c55\u6027\u3002\u53ef\u80fd\u8fd9\u4e9b\u5de5\u5177\u7684\u8bbe\u8ba1\u5e76\u4e0d\u662f\u4e3a\u4e86\u53ef\u89c2\u6d4b\u6027\uff0c\u53ea\u662f\u4e3a\u4e86\u80fd\u770b\u5230\u6307\u6807\u6216\u7edf\u8ba1\u6570\u636e\uff0c\u65b9\u4fbf\u5b9a\u4f4d\u95ee\u9898\u3002\u73b0\u5728\u6709\u5404\u79cd\u53ef\u89c2\u6d4b\u6027\u8bbe\u7f6e\u7c7b\u7684\u4ea7\u54c1\uff0c\u4f46\u662f\u5f88\u96be\u96c6\u6210\u5230 Nginx \u4e0a\u3002\\n\\n\u53e6\u5916\uff0cNginx \u793e\u533a\u505c\u6ede\u4e0d\u524d\uff0c\u5bfc\u81f4 Nginx \u8fed\u4ee3\u901f\u5ea6\u6162\u3002\\n\\n## Apache APISIX \u6982\u8ff0\\n\\n### Apache APISIX \u4e0e Nginx \u7684\u5173\u7cfb\\n\\n![Apache APISIX \u4e0e Nginx \u7684\u5173\u7cfb](https://static.apiseven.com/202108/1630651158638-aba4e627-d2d6-4bf5-b431-61eb3913a296.png)\\n\\nApache APISIX \u57fa\u4e8e Nginx \u5b9e\u73b0\uff0c\u4f46\u53ea\u4f9d\u8d56 Nginx \u7684\u7f51\u7edc\u5e93\uff0c\u5728 Nginx \u57fa\u7840\u4e0a\uff0cApache APISIX \u5b9e\u73b0\u4e86\u81ea\u5df1\u7684\u6838\u5fc3\u7684\u4ee3\u7801\uff0c\u5e76\u9884\u7559\u4e86\u6269\u5c55\u673a\u5236\u3002\\n\\n\u5728\u8868\u683c\u4e2d\u5217\u51fa\u4e86 Apache APISIX \u548c Nginx \u7684\u529f\u80fd\u5bf9\u6bd4\uff0cApache APISIX \u65e2\u53ef\u4ee5\u505a\u53cd\u5411\u4ee3\u7406\uff0c\u53c8\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e9b Nginx \u4e0d\u652f\u6301\u7684\u529f\u80fd\uff0c\u5982\uff1a\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\u3001\u6d41\u91cf\u7ba1\u7406\u3001\u6a2a\u5411\u6269\u7f29\u5bb9\u7b49\uff0c\u800c\u4e14\u8fd9\u4e9b\u529f\u80fd\u90fd\u662f\u5f00\u6e90\u7684\u3002\\n\\n- **API \u8bbe\u8ba1**\uff1a\u5728 API \u8bbe\u8ba1\u65b9\u9762\u4f7f\u7528 Apache APISIX \u66f4\u52a0\u7b80\u5355\u3002\\n- **\u5f00\u6e90 Dashboard**\uff1a\u5728\u754c\u9762\u4e0a\u5c31\u80fd\u628a\u53cd\u5411\u4ee3\u7406\u5168\u90e8\u914d\u7f6e\u5b8c\u3002\\n- **\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5**\uff1aApache APISIX \u652f\u6301\u4e3b\u52a8\u5065\u5eb7\u68c0\u67e5\uff0c\u53ef\u4ee5\u7ed3\u5408 Events \u5b8c\u5584\u53ef\u89c2\u6d4b\u6027\u3002\\n- **\u6d41\u91cf\u7ba1\u7406**\uff1a\u9002\u5408\u76d1\u6d4b\u6570\u636e\uff0c\u6216\u8005\u5728\u4e1a\u52a1\u53d1\u5e03\u4e0a\u7ebf\u65f6\u4f7f\u7528\u3002\\n- **\u6a2a\u5411\u6269\u7f29\u5bb9**\uff1aApache APISIX \u652f\u6301\u6a2a\u5411\u6269\u7f29\u5bb9\uff0c\u8fd9\u4e2a\u7279\u6027\u5f97\u76ca\u4e8e Apache APISIX \u7684\u67b6\u6784\uff08\u89c1\u4e0b\u56fe\uff09\u3002\\n- **\u63d2\u4ef6\u6269\u5c55\u673a\u5236**\uff1aApache APISIX \u7684\u63d2\u4ef6\u6269\u5c55\u673a\u5236\u4f7f\u5176\u5177\u6709\u6781\u4e3a\u5f3a\u5927\u7684\u6269\u5c55\u80fd\u529b\u3002\\n- **\u63d2\u4ef6\u7f16\u6392**\uff1a\u6309\u7167\u4e1a\u52a1\u9700\u6c42\uff0c\u5c06\u591a\u4e2a\u63d2\u4ef6\u6309\u7167\u903b\u8f91\u7f16\u6392\uff0c\u7ec4\u5408\u8d77\u6765\u4f7f\u7528\u3002\\n- **\u8bc1\u4e66\u7ba1\u7406**\uff1aApache APISIX \u652f\u6301\u52a8\u6001\u7684\u8bc1\u4e66\u7ba1\u7406\u3002\\n\\n![Apache APISIX \u67b6\u6784\u56fe](https://static.apiseven.com/202108/1630651158643-ecc67e12-2076-41e5-88d8-baa14144f35d.png)\\n\\n### Apache APISIX \u7b80\u4ecb\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u4e5f\u662f\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90 API \u7f51\u5173\u9879\u76ee\uff0c\u662f\u751f\u4ea7\u53ef\u7528\u7684\u9ad8\u6027\u80fd\u7f51\u5173\u3002\u5168\u7403\u5df2\u6709\u6570\u767e\u5bb6\u4f01\u4e1a\u4f7f\u7528 Apache APISIX \u5904\u7406\u5173\u952e\u4e1a\u52a1\u6d41\u91cf\uff0c\u6db5\u76d6\u91d1\u878d\u3001\u4e92\u8054\u7f51\u3001\u5236\u9020\u3001\u96f6\u552e\u3001\u8fd0\u8425\u5546\u7b49\u7b49\uff0c\u6bd4\u5982\u7f8e\u56fd\u822a\u7a7a\u822a\u5929\u5c40\uff08NASA\uff09\u3001\u6b27\u76df\u7684\u6570\u5b57\u5de5\u5382\u3001\u4e2d\u56fd\u822a\u4fe1\u3001\u4e2d\u56fd\u79fb\u52a8\u3001\u817e\u8baf\u3001\u534e\u4e3a\u3001\u5fae\u535a\u3001\u7f51\u6613\u3001\u8d1d\u58f3\u627e\u623f\u3001360\u3001\u6cf0\u5eb7\u7b49\u3002\\n\\n### Apache APISIX \u89e3\u51b3\u65b9\u6848\\n\\n![Apache APISIX \u5168\u6d41\u91cf\u89e3\u51b3\u65b9\u6848](https://static.apiseven.com/202108/1630651158645-83c22975-ebf1-4861-8b61-38639a28875a.png)\\n\\n\u4e0a\u56fe\u5de6\u8fb9\uff0c\u4ece\u4e0a\u5f80\u4e0b\u662f\u4ece\u5355\u4f53\u670d\u52a1\u5230 SOA\uff08\u9762\u5411\u670d\u52a1\u7684\u67b6\u6784\uff09\u5230\u5fae\u670d\u52a1\u7684\u6f14\u8fdb\u8fc7\u7a0b\u3002\\n\\n\u5728 SOA \u4e0b\uff0c\u7f51\u5173\u4e00\u822c\u91c7\u7528 Nginx \u6216\u8005 HAProxy\uff1b\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\uff0c\u7f51\u5173\u4f7f\u7528 Nginx \u505a\u8d1f\u8f7d\u5747\u8861\u3002\u5fae\u670d\u52a1\u67b6\u6784\u6709\u4e24\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\uff1a\u4e00\u4e2a\u662f\u57fa\u4e8e Java \u6280\u672f\u6808\u5b9e\u73b0\uff0c\u5982 Spring Cloud \u7cfb\u5217\uff1b\u53e6\u4e00\u4e2a\u662f Service Mesh\u3002\\n\\n\u5728\u8fd9\u4e2a\u6f14\u8fdb\u8fc7\u7a0b\u4e2d\uff0cApache APISIX \u5904\u4e8e\u4ec0\u4e48\u4f4d\u7f6e\uff0c\u80fd\u505a\u4ec0\u4e48\u5462\uff1f\\n\\n\u7b80\u5355\u7684\u8bf4\uff0c\u5de6\u56fe\u4e2d\u7ea2\u8272\u7684\u90e8\u5206\uff08Nginx / HAProxy / Kong / Spring Cloud Zuul / Spring Cloud Gateway / Traefik / Envoy / Ingress Nginx\uff09\u90fd\u53ef\u4ee5\u66ff\u6362\u4e3a Apache APISIX \u7684\u89e3\u51b3\u65b9\u6848\u3002\\n\\n**\u5728 SOA \u4e0b\u6709 Apache APISIX SLB \u89e3\u51b3\u65b9\u6848\uff0c\u5728\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\u6709 Apache APISIX Gateway\uff0c\u5728 Kubernetes \u90e8\u7f72\u6709 Apache APISIX Ingress\uff0c\u5728 Service Mesh \u91cc\u90e8\u7f72\u6709 Apache APISIX mesh**\u3002\\n\\n![Apache APISIX \u5168\u6d41\u91cf\u6570\u636e\u9762](https://static.apiseven.com/202108/1630651158648-dffd59dd-15c2-4f76-832e-5ed3763b18e5.png)\\n\\n\u4ece\u4e1a\u52a1\u8bf7\u6c42\u7684\u6d41\u91cf\u65b9\u9762\u770b\uff0c\u5f53\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\u65f6\u4f1a\u7ecf\u8fc7 LB\uff0c\u7ecf\u8fc7 Gateway\uff0c\u8bf7\u6c42\u88ab\u5206\u53d1\u5230\u540e\u7aef\u4e1a\u52a1\u670d\u52a1\u3002\u7ea2\u8272\u7684\u90e8\u5206\uff08LB / Gateway / Spring Cloud Gateway / K8s Ingress / Sidecar\uff09\u90fd\u53ef\u4ee5\u9009\u62e9 Apache APISIX \u4f5c\u4e3a\u89e3\u51b3\u65b9\u6848\u3002Apache APISIX \u652f\u6301\u591a\u8bed\u8a00\u5f00\u53d1\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5728 Java \u4f53\u7cfb\u4e0b\u4f7f\u7528 Java \u7f16\u5199\u63d2\u4ef6\u3002\\n\\nApache APISIX \u662f\u5168\u6d41\u91cf\u7684\u6570\u636e\u9762\uff0c\u5728 LB\u3001Gateway\u3001Ingress\u3001sidecar \u65b9\u9762 Apache APISIX \u90fd\u6709\u76f8\u5e94\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4ed6\u4eec\u662f\u7edf\u4e00\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5728\u53ef\u89c2\u6d4b\u6027\u65b9\u9762\u4e5f\u662f\u7edf\u4e00\u7684\u65b9\u6848\u3002\u5f53\u89e3\u51b3\u65b9\u6848\u7edf\u4e00\u65f6\uff0c\u7ba1\u7406\u63a7\u5236\u94fe\u4e5f\u662f\u5f88\u5bb9\u6613\u5b9e\u73b0\u51fa\u6765\u7684\u3002\\n\\n## Apache APISIX \u7684\u53ef\u89c2\u6d4b\u6027\\n\\n\u7b80\u5355\u4e86\u89e3\u5b8c Nginx \u548c Apache APISIX \u4e4b\u540e\uff0c\u73b0\u5728\u6709\u4e24\u4e2a\u95ee\u9898\uff1aApache APISIX \u5728\u53ef\u89c2\u6d4b\u6027\u4e0a\u53ef\u4ee5\u505a\u54ea\u4e9b\u4e8b\u60c5\uff1fApache APISIX \u53ef\u89c2\u6d4b\u6027\u4e0a\u7684\u4f18\u52bf\u5728\u54ea\u91cc\uff1f\\n\\n### Apache APISIX \u652f\u6301\u91c7\u96c6\u7684\u6570\u636e\u7c7b\u578b\\n\\nApache APISIX \u652f\u6301\u91c7\u96c6\u7684\u6570\u636e\u7c7b\u578b\uff1a\\n\\n1. Tracing - \u96c6\u6210 SkyWalking\\n2. Metrics - \u96c6\u6210 SkyWalking / Prometheus\\n3. Logging - \u96c6\u6210 SkyWalking / \u5176\u4ed6\u65e5\u5fd7\u5e73\u53f0\\n\\nApache APISIX \u662f\u4e00\u4e2a\u7f51\u5173\u7c7b\u7684\u4ea7\u54c1\uff0c\u53ef\u4ee5\u66ff\u4ee3 Nginx \u6216\u8005\u5176\u4ed6\u7684\u7f51\u5173\uff1b\u5728\u53ef\u89c2\u6d4b\u6027\u4e0a Apache APISIX \u53ef\u4ee5\u96c6\u6210\u591a\u4e2a APM \u6216\u53ef\u89c2\u6d4b\u6027\u7cfb\u7edf\uff0c\u5982\uff1aTracing \u90e8\u5206\u53ef\u4ee5\u96c6\u6210 SkyWalking\uff0cMetrics \u6307\u6807\u4e0a\u53ef\u4ee5\u96c6\u6210 SkyWalking \u6216 Prometheus\uff0cLogging \u53ef\u4ee5\u96c6\u6210 SkyWalking \u4ee5\u53ca\u5176\u4ed6\u4e00\u4e9b\u65e5\u5fd7\u7cfb\u7edf\u3002\\n\\n### Apache APISIX \u5728\u53ef\u89c2\u6d4b\u6027\u4e0a\u7684\u4f18\u52bf\\n\\n#### \u9ad8\u5ea6\u6269\u5c55\u80fd\u529b\\n\\n\u4e3a\u4ec0\u4e48 Apache APISIX \u62e5\u6709\u5f3a\u5927\u7684\u6269\u5c55\u80fd\u529b\uff1f\u56e0\u4e3a Apache APISIX \u652f\u6301\u591a\u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528 Lua\u3001Java\u3001Golang \u7b49\u7f16\u7a0b\u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\u3002Apache APISIX \u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u6269\u5c55\u81ea\u8eab\u7684\u80fd\u529b\u3002\u4e0a\u6587\u63d0\u5230\u7684\u4e09\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u90fd\u662f\u901a\u8fc7\u63d2\u4ef6\u673a\u5236\u6765\u5b9e\u73b0\u7684\u3002\\n\\n#### \u7075\u6d3b\u7684\u914d\u7f6e\u80fd\u529b\\n\\n\u4e3e\u4e09\u4e2a\u4f8b\u5b50\u6765\u4ecb\u7ecd\u4e00\u4e0b Apache APISIX \u7075\u6d3b\u7684\u914d\u7f6e\u80fd\u529b\u3002\\n\\n\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u662f **Apache APISIX \u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u4fee\u6539 logging \u7684\u914d\u7f6e**\uff0c\u5982\uff1a\u589e\u52a0\u6216\u4fee\u6539\u65e5\u5fd7\u5b57\u6bb5\u3002\u4fee\u6539\u65e5\u5fd7\u5b57\u6bb5\u662f\u4e00\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684\u9700\u6c42\uff0c\u6bd4\u5982\uff1a\u4e1a\u52a1\u521a\u5f00\u59cb\u4e0a\u7ebf\u65f6\uff0c\u914d\u7f6e\u597d\u4e86\u65e5\u5fd7\u5b57\u6bb5\uff0c\u7cfb\u7edf\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u9700\u8981\u4fee\u6539\u6216\u8005\u589e\u52a0\u51e0\u4e2a\u65e5\u5fd7\u5b57\u6bb5\u3002\u5982\u679c\u4f7f\u7528 Nginx\uff0c\u901a\u8fc7\u4fee\u6539 nginx.conf \u6587\u4ef6\u5b9e\u73b0\u9700\u6c42\uff0creload \u4f7f\u914d\u7f6e\u751f\u6548\u3002 **Apache APISIX \u53ea\u9700\u8981\u901a\u8fc7\u811a\u672c\u628a\u5b57\u6bb5\u914d\u7f6e\u597d\uff0c\u5c31\u4f1a\u52a8\u6001\u751f\u6548**\u3002\\n\\n\u7b2c\u4e8c\u4e2a\u7075\u6d3b\u914d\u7f6e\u80fd\u529b\u7684\u4f8b\u5b50\u662f Prometheus \u7684\u4f7f\u7528\u3002\u5728 Apache APISIX \u91cc\uff0c\u60f3\u8981\u521b\u5efa / \u5220\u9664\u67d0\u4e00\u4e2a metric \u6216\u8005\u6269\u5c55 metrics labels\uff0c\u53ea\u9700\u8981\u5728 Prometheus \u63d2\u4ef6\u91cc\u65b0\u589e\u4e00\u4e2a metircs \u6216\u8005\u586b\u5199\u76f8\u5173\u4fe1\u606f\uff0cApache APISIX \u6709 hot reload \u673a\u5236\u53ef\u4ee5\u76f4\u63a5\u751f\u6548\uff0c\u4e0d\u9700\u8981\u91cd\u542f\u3002\\n\\n\u7b2c\u4e09\u4e2a\u7075\u6d3b\u7684\u914d\u7f6e\u80fd\u529b\u4f53\u73b0\u5728 Apache APISIX \u7684\u5b9e\u73b0\u3002Apache APISIX \u628a\u8def\u7531\u5bf9\u8c61\u5168\u90e8\u7ba1\u7406\u8d77\u6765\uff0c\u5728\u5185\u5b58\u91cc\u6709\u4e00\u5957\u5bf9\u8c61\u7ba1\u7406\u673a\u5236\u3002\u5728 Apache APISIX \u91cc\u7ed9\u67d0\u4e2a API \u52a0\u63d2\u4ef6\uff0c\u751f\u6548\u7684\u7ea7\u522b\u53ef\u4ee5\u7ec6\u5316\u5230 API\uff0c\u6bcf\u4e00\u4e2a API \u90fd\u53ef\u4ee5\u7ed1\u5b9a\u63d2\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u4ece API \u4e0a\u628a\u63d2\u4ef6\u53bb\u6389\u3002 Apache APISIX \u53ef\u4ee5\u7cbe\u7ec6\u5316\u63a7\u5236\u5230\u6bcf\u4e00\u4e2a\u670d\u52a1\u91cc\u9762\u6bcf\u4e00\u4e2a API \u7684\u53ef\u89c2\u6d4b\u6027\u6570\u636e\u91c7\u96c6\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u4f60\u53ef\u4ee5\u53ea\u91c7\u96c6\u6700\u5173\u5fc3\u7684\u6570\u636e\uff0c\u800c\u4e14\u8fd9\u4e9b\u914d\u7f6e\u90fd\u662f\u52a8\u6001\u751f\u6548\u7684\uff0c\u53ef\u4ee5\u968f\u65f6\u8c03\u6574\u3002\\n\\n#### \u6d3b\u8dc3\u7684\u793e\u533a\\n\\nApache APISIX \u6700\u91cd\u8981\u7684\u4e00\u4e2a\u4f18\u52bf\u662f\u6709\u4e00\u4e2a\u6d3b\u8dc3\u7684\u793e\u533a\uff0c\u4e00\u4e2a\u6d3b\u8dc3\u7684\u793e\u533a\u53ef\u4ee5\u8ba9\u4ea7\u54c1\u5feb\u901f\u8fed\u4ee3\u3001\u53d8\u5f97\u8d8a\u6765\u8d8a\u5b8c\u5584\uff0c\u8ba9\u5927\u5bb6\u7684\u9700\u6c42\u5f97\u5230\u6ee1\u8db3\u3002\\n\\n![Apache APISIX \u793e\u533a\u6d3b\u8dc3\u5ea6\u5bf9\u6bd4\u56fe](https://static.apiseven.com/202108/1630651158650-2c4a287f-45a3-4c49-94d1-5be3914e5f69.png)\\n\\n\u4e0a\u56fe\u5c55\u793a\u7684\u662f Apache APISIX\uff08\u7eff\u8272\uff09\u3001Kong\uff08\u6d45\u84dd\uff09\u3001mosn\uff08\u9ec4\u8272\uff09\u3001bfe\uff08\u6df1\u84dd\uff09\u8d21\u732e\u8005\u589e\u957f\u66f2\u7ebf\uff0cApache APISX \u589e\u957f\u8d8b\u52bf\u6700\u5feb\uff0c\u66f2\u7ebf\u6700\u4e3a\u9661\u5ced\u3002 Apache APISIX \u793e\u533a\u6d3b\u8dc3\u5ea6\u5728\u540c\u7c7b\u578b\u9879\u76ee\u91cc\u9762\u662f\u6700\u6d3b\u8dc3\u7684\u3002\\n\\n## \u7ed3\u5408 Apache SkyWalking\uff0c\u5728\u53ef\u89c2\u6d4b\u6027\u4e0a\u505a\u8fdb\u4e00\u6b65\u63d0\u5347\\n\\nApache APISIX \u4e0e Apache SkyWalking \u7ed3\u5408\u53ef\u4ee5\u505a\u54ea\u4e9b\u63d0\u5347\uff1f\u9664\u4e86 SkyWalking tracing \u63d2\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u5c06 tracing\u3001metrics\u3001logging\u3001events \u6c47\u805a\u5230 SkyWalking\uff0c\u501f\u52a9 SkyWalking \u7684\u805a\u5408\u80fd\u529b\u8ba9\u6570\u636e\u5b9e\u73b0\u8054\u52a8\u3002\\n\\n### SkyWalking Satellite\\n\\nSkyWalking Satellite \u7531 Apache APISIX \u793e\u533a\u3001Apache SkyWalking \u793e\u533a\u3001\u767e\u5ea6\u6df1\u5ea6\u5408\u4f5c\u5f00\u53d1\u3002\\n\\n![Apache APISIX SkyWalking Satellite](https://static.apiseven.com/202108/1630651158652-130e62e1-32dd-4705-9f24-ceffd039560a.png)\\n\\nSkyWalking Satellite \u6309\u7167\u4e0a\u56fe\u6b65\u9aa4\u91c7\u96c6\u6570\u636e\uff0cSkyWalking Satellite \u53ef\u4ee5\u90e8\u7f72\u5230\u66f4\u9760\u8fd1\u4ea7\u751f\u6570\u636e\u7684\u524d\u7aef\uff0c\u4ee5 sidecar \u7684\u5f62\u5f0f\u5b58\u5728\u3002\\n\\n\u56fe\u4e2d\u4ece\u4e0a\u5f80\u4e0b\u4e1a\u52a1\u8bf7\u6c42\u7ecf\u8fc7 Apache APISIX \u4ee3\u7406\u5230 Upstream\uff0cSatellite \u5728 Apache APISIX \u7684\u65c1\u8fb9\uff0c\u4ee5 sidecar \u7684\u5f62\u5f0f\u90e8\u7f72\uff0c\u6536\u96c6 Apache  APISIX \u7684 tracing\u3001metrics\u3001logging \u8fd9\u4e09\u79cd\u6570\u636e\u7c7b\u578b\u7684\u6570\u636e\uff0c\u901a\u8fc7 GRPC \u534f\u8bae\u53d1\u9001\u7ed9 SkyWalking\u3002\\n\\n\u6700\u91cd\u8981\u7684\u4e00\u70b9\u662f\uff1a**\u5728\u8fd9\u79cd\u90e8\u7f72\u65b9\u5f0f\u4e0b\uff0cApache  APISIX \u4e0d\u9700\u8981\u505a\u4efb\u4f55\u6539\u52a8\u5c31\u53ef\u4ee5\u76f4\u63a5\u5c06\u4e09\u79cd\u6570\u636e\u7c7b\u578b\u96c6\u6210\u5230 SkyWalking**\u3002\\n\\n### ALS \u65b9\u6848\\n\\nALS\uff08Access Log Service\uff09\u5c06\u7ecf\u8fc7 Apache  APISIX \u7684\u8bbf\u95ee\u65e5\u5fd7\u53d1\u9001\u51fa\u6765\uff0c\u5728\u666e\u901a\u7684 access log \u4e0a\u589e\u52a0\u7279\u6b8a\u7684\u5b57\u6bb5\uff0c\u5982\uff1a\u589e\u52a0\u5173\u952e\u5b57\u6bb5\u4fbf\u4e8e\u751f\u6210\u62d3\u6251\u56fe\uff0c\u540c\u65f6\u805a\u5408\u51fa metrics\u3002\\n\\nALS \u65b9\u6848\u6700\u5927\u7684\u597d\u5904\u662f\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 access log \u65b9\u5f0f\u5206\u6790\u548c\u805a\u5408\u51fa\u62d3\u6251\u56fe\u3001metrics \u3001logging \u8fd9\u4e09\u79cd\u7c7b\u578b\u7684\u6570\u636e\u3002\\n\u5728\u4f7f\u7528 Prometheus \u65f6\uff0c\u5982\u679c\u914d\u7f6e\u4e86 URI \u7ea7\u522b\u7684 metrics \u6307\u6807\u7684\u7edf\u8ba1\uff0c\u4f1a\u5bfc\u81f4\u6574\u4e2a metrics \u6025\u5267\u81a8\u80c0\u3002\u56e0\u4e3a URI \u7ea7\u522b\u7684\u670d\u52a1\u53ef\u80fd\u6709\u51e0\u5341\u4e2a\uff0c\u6bcf\u4e2a metrics \u540e\u9762\u53ef\u80fd\u6709\u8bb8\u591a labels\uff0c\u8fd9\u4f1a\u964d\u4f4e\u7f51\u5173\u6027\u80fd\uff0c\u589e\u52a0 metrics \u83b7\u53d6\u96be\u5ea6\u3002**\u4f7f\u7528 ALS \u65b9\u6848\uff0c\u901a\u8fc7\u6d41\u7684\u65b9\u5f0f\u5c06\u6570\u636e\u53d1\u9001\u7ed9 SkyWalking\uff0c\u628a\u8ba1\u7b97\u7684\u4e8b\u60c5\u4ea4\u7ed9 SkyWalking\uff0c\u540e\u7eed\u4e5f\u65b9\u4fbf\u67e5\u8be2**\uff0c\u4e0d\u4f1a\u51fa\u73b0\u6bcf\u9694\u51e0\u79d2\u949f\u62c9\u53d6\u4e00\u6b21\u975e\u5e38\u5e9e\u5927\u7684\u6570\u636e\u7684\u60c5\u51b5\u3002\\n\\n### \u5c06 Events \u6574\u5408\u5230 SkyWalking\\n\\n\u5e38\u7528\u7684 Events \u5305\u62ec\uff1a\u914d\u7f6e\u5206\u53d1\u3001\u96c6\u7fa4\u53d8\u5316\u3001\u5065\u5eb7\u68c0\u67e5\u3002\\n\\n**\u914d\u7f6e\u5206\u53d1**\uff1a\u5728\u914d\u7f6e API \u5206\u53d1\u65f6\uff0c\u53ef\u80fd\u4f1a\u65b0\u589e\u8def\u7531\u3001\u4fee\u6539\u8def\u7531\u3001\u5220\u9664\u8def\u7531\u6216\u589e\u52a0\u63d2\u4ef6\u3002\\n\\n**\u96c6\u7fa4\u53d8\u5316**\uff1a\u96c6\u7fa4\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u9700\u8981\u77e5\u9053\u96c6\u7fa4\u91cc\u7684\u670d\u52a1\u6570\u3002\u5982\uff1a\u6269\u5bb9\u65f6 IP \u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u53d8\u5316\u4f53\u73b0\u5728\u7f51\u5173\u6536\u5230\u6d88\u606f\u7684\u65f6\u5019\u3002\u6bcf\u4e2a\u8fc7\u7a0b\u90fd\u662f\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u8fd9\u4e9b\u4e8b\u4ef6\u90fd\u9700\u8981\u88ab\u66b4\u9732\u51fa\u6765\u3002\\n\\n**\u5065\u5eb7\u68c0\u67e5**\uff1a\u4e3b\u52a8\u63a2\u6d4b\u662f\u5426\u5065\u5eb7\uff0c\u4f8b\u5982\uff1a\u4e1a\u52a1\u8bf7\u6c42\u5931\u8d25\u7387\u7a81\u7136\u53d8\u9ad8\uff0c\u4e8b\u4ef6\u63a2\u6d4b\u5230\u4e1a\u52a1\u670d\u52a1\u4e0d\u5065\u5eb7\uff0c\u6b64\u65f6\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u5230\u95ee\u9898\u3002\\n\\n## \u5ef6\u4f38\u9605\u8bfb\\n\\n### Apache APISIX \u7684\u6269\u5c55\u673a\u5236\u7684\u5b9e\u73b0\u539f\u7406\u53ca\u5176\u5bf9\u7a33\u5b9a\u6027\u7684\u5f71\u54cd\\n\\n\u95ee\u9898\uff1aApache APISIX \u7684\u6269\u5c55\u673a\u5236\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f\u6269\u5c55\u8fd9\u4e2a\u529f\u80fd\u662f\u5426\u5bf9 Apache APISIX \u672c\u8eab\u7a33\u5b9a\u6027\u6709\u5f71\u54cd\uff1f\\n\\n\u7b54\uff1aApache APISIX \u6269\u5c55\u673a\u5236\u5f97\u76ca\u4e8e\u5b83\u7684\u67b6\u6784\uff0c\u53ef\u4ee5\u5728\u5404\u4e2a phases\uff08rewrite / access / header_filter / body_filter / preread_filter / log\uff09\u589e\u52a0\u4e1a\u52a1\u903b\u8f91\u3002\\n\\n\u81f3\u4e8e\u7a33\u5b9a\u6027\u65b9\u9762\uff0c Apache  APISIX \u5df2\u7ecf\u5f00\u6e90\u4e86\u8fd1 50 \u4e2a\u63d2\u4ef6\uff0c\u6bcf\u4e00\u4e2a\u63d2\u4ef6\u90fd\u4f1a\u6709\u7aef\u5230\u7aef\u7684\u6d4b\u8bd5\uff0c\u8fd9\u4e9b\u63d2\u4ef6\u90fd\u662f\u7ecf\u8fc7\u9a8c\u8bc1\u7684\u3001\u662f\u7a33\u5b9a\u53ef\u7528\u7684\u3002\u4f46\u662f\u81ea\u5b9a\u4e49\u63d2\u4ef6\u8981\u9075\u5faa\u4e00\u5b9a\u7684\u89c4\u8303\uff0c\u867d\u7136\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u5927\u5bb6\u4e5f\u4e0d\u80fd\u592a\u968f\u610f\u3002\u81ea\u5b9a\u4e49\u63d2\u4ef6\u7684\u7a33\u5b9a\u6027\u4fdd\u8bc1\uff0c\u9700\u8981\u7531\u4e1a\u52a1\u65b9\u81ea\u5df1\u6765\u4fdd\u8bc1\u3002\\n\\n### \u5982\u4f55\u786e\u8ba4\u89c4\u5219\u5df2\u751f\u6548\\n\\n\u95ee\uff1aNginx \u7684 nginx.conf \u6587\u4ef6\u91cc\u9762\u53ef\u80fd\u914d\u7f6e\u4e86\u5f88\u591a\u89c4\u5219\uff0c\u540e\u9762\u7684\u89c4\u5219\u53ef\u80fd\u88ab\u524d\u9762\u7684\u89c4\u5219\u62e6\u622a\uff0c\u4e0d\u6e05\u695a\u540e\u9762\u7684\u89c4\u5219\u662f\u5426\u751f\u6548\uff0cApache APISIX \u662f\u5426\u6709\u4ec0\u4e48\u65b9\u6cd5\u77e5\u9053\u54ea\u4e9b\u89c4\u5219\u5df2\u751f\u6548\uff1f\\n\\n\u7b54\uff1aNginx \u7684 nginx.conf \u6587\u4ef6\u914d\u7f6e\u8d8a\u591a\uff0c\u914d\u7f6e\u670d\u52a1\u8d8a\u590d\u6742\uff0c\u8fd9\u4e2a\u6587\u4ef6\u8d8a\u96be\u4ee5\u7ef4\u62a4\u3002\u4f46\u662f\u5728 Apache APISIX \u91cc\u914d\u7f6e\u6587\u4ef6\u662f\u56fa\u5b9a\u7684\uff0cApache APISIX \u5b98\u65b9\u63d0\u4f9b\u7684\u914d\u7f6e\u5c31\u662f\u5728\u5927\u591a\u6570\u573a\u666f\u4e0b\u7684\u6700\u4f18\u914d\u7f6e\uff0c\u5176\u4ed6\u8def\u7531\u7684\u914d\u7f6e\u662f\u901a\u8fc7 API \u7684\u65b9\u5f0f\u914d\u7f6e\u8fdb\u53bb\u7684\uff0c\u8def\u7531\u914d\u7f6e\u90fd\u662f\u5728\u5185\u5b58\u91cc\u9762\u7684\u3002\\n\\n\u5728\u7ba1\u7406\u65b9\u5f0f\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u7ec4\u7ec7\u65b9\u5f0f\u7ba1\u7406\u4f60\u7684\u8def\u7531\uff0c\u4f8b\u5982\uff0c\u53ef\u4ee5\u901a\u8fc7 Dashboard \u6765\u7ba1\u7406\u3002\\n\\n\u4e3e\u4f8b\u8bf4\u660e\uff0c\u6bd4\u5982\u6709\u4e00\u4e2a\u670d\u52a1\u53eb ABC\uff0c\u5728\u8fd9\u4e2a\u670d\u52a1\u4e0b\u9762\u53ef\u4f1a\u6709\u5404\u79cd\u8def\u7531\u5b9a\u4e49\uff0c\u8def\u7531\u5b9a\u4e49\u901a\u8fc7\u5217\u8868\u7684\u65b9\u5f0f\u8fdb\u884c\u67e5\u770b\uff0c\u8def\u7531\u91cc\u6709\u4e00\u4e2a\u5b57\u6bb5\u53eb\u4f18\u5148\u7ea7\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u8def\u7531\u7684\u4f18\u5148\u7ea7\u5b57\u6bb5\uff0c\u8ba9\u76f8\u4f3c\u7684\u8def\u7531\u89c4\u5219\u6309\u7167\u4f18\u5148\u7ea7\u4f9d\u6b21\u5339\u914d\u3002\u53e6\u5916\u4e00\u79cd\u8def\u7531\u67e5\u770b\u65b9\u5f0f\u662f\u5728 dashboard \u4e2d\u7ed9 API \u6253\u4e0a\u6807\u7b7e\uff0c\u53ef\u4ee5\u8ba9\u8def\u7531\u7684\u7ba1\u7406\u53d8\u5f97\u66f4\u52a0\u4eba\u6027\u5316\uff0c\u4fbf\u4e8e\u6309\u7167\u6807\u7b7e\u8fc7\u6ee4\u67e5\u8be2\u8def\u7531\u5217\u8868\u3002\\n\\n## \u5173\u4e8e\u4f5c\u8005\\n\\n\u91d1\u536b\uff0cApache APISIX PMC \u548c Apache SkyWalking committer\u3002\\n\\n![\u91d1\u536b\u4e2a\u4eba\u4ecb\u7ecd](https://static.apiseven.com/202108/1630651158654-2e028970-9e09-4d52-bf72-ab53aa98706b.png)"},{"id":"2021/08/05/kong-to-apisix","metadata":{"permalink":"/zh/blog/2021/08/05/kong-to-apisix","source":"@site/blog/2021/08/05/Kong-to-APISIX.md","title":"Kong-To-APISIX \u8fc1\u79fb\u5de5\u5177","description":"\u4f60\u53ef\u4ee5\u4f7f\u7528 Kong-To-APISIX \u8fc1\u79fb\u5de5\u5177\uff0c\u4e00\u952e\u5c06 Kong \u7684\u914d\u7f6e\u8fc1\u79fb\u5230\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4e2d\uff0c\u5b9e\u73b0\u670d\u52a1\u7684\u65e0\u7f1d\u5207\u6362\u3002\u672c\u6587\u4ecb\u7ecd\u4e86\u8be6\u7ec6\u7684\u4f7f\u7528\u65b9\u6cd5\u4ee5\u53ca\u6d4b\u8bd5\u793a\u4f8b\u3002","date":"2021-08-05T00:00:00.000Z","formattedDate":"2021\u5e748\u67085\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":4.25,"truncated":true,"authors":[{"name":"\u5434\u8212\u65f8","url":"https://github.com/Yiyiyimu","imageURL":"https://avatars.githubusercontent.com/u/34589752?v=4"}],"prevItem":{"title":"\u5982\u4f55\u5229\u7528 Apache APISX \u63d0\u5347 NGINX \u7684\u53ef\u89c2\u6d4b\u6027","permalink":"/zh/blog/2021/08/06/using-apache-apisix-to-improve-the-observability-of-nginx"},"nextItem":{"title":"Apache APISIX 2.8 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/07/28/release-apache-apisix-2.8"}},"content":"> Apache APISIX \u662f\u4e00\u4e2a\u751f\u4ea7\u53ef\u7528\u7684\u5f00\u6e90\u4e03\u5c42\u5168\u6d41\u91cf\u5904\u7406\u5e73\u53f0\uff0c\u53ef\u4f5c\u4e3a API \u7f51\u5173\u5904\u7406\u4e1a\u52a1\u5165\u53e3\u6d41\u91cf\uff0c\u5177\u6709\u6781\u9ad8\u6027\u80fd\u3001\u8d85\u4f4e\u5ef6\u8fdf\uff0c\u5b98\u65b9\u652f\u6301 dashboard \u4ee5\u53ca\u8d85\u8fc7\u4e94\u5341\u79cd\u63d2\u4ef6\u3002\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528 Kong\uff0c\u5bf9 APISIX \u611f\u5174\u8da3\u53c8\u82e6\u4e8e\u96be\u4ee5\u4e0a\u624b\uff0c\u4e0d\u59a8\u8bd5\u8bd5\u6211\u4eec\u521a\u5f00\u6e90\u7684\u8fc1\u79fb\u5de5\u5177 Kong-To-APISIX\uff0c\u52a9\u4f60\u4e00\u952e\u5e73\u6ed1\u8fc1\u79fb\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX \u662f\u4e00\u4e2a\u751f\u4ea7\u53ef\u7528\u7684\u5f00\u6e90\u4e03\u5c42\u5168\u6d41\u91cf\u5904\u7406\u5e73\u53f0\uff0c\u53ef\u4f5c\u4e3a API \u7f51\u5173\u5904\u7406\u4e1a\u52a1\u5165\u53e3\u6d41\u91cf\uff0c\u5177\u6709\u6781\u9ad8\u6027\u80fd\u3001\u8d85\u4f4e\u5ef6\u8fdf\uff0c\u5b98\u65b9\u652f\u6301 dashboard \u4ee5\u53ca\u8d85\u8fc7\u4e94\u5341\u79cd\u63d2\u4ef6\u3002\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528 Kong\uff0c\u5bf9 APISIX \u611f\u5174\u8da3\u53c8\u82e6\u4e8e\u96be\u4ee5\u4e0a\u624b\uff0c\u4e0d\u59a8\u8bd5\u8bd5\u6211\u4eec\u521a\u5f00\u6e90\u7684\u8fc1\u79fb\u5de5\u5177 Kong-To-APISIX\uff0c\u52a9\u4f60\u4e00\u952e\u5e73\u6ed1\u8fc1\u79fb\u3002\\n\\n## \u5de5\u5177\u80fd\u529b\\n\\nKong-To-APISIX \u5229\u7528 Kong \u548c APISIX \u7684\u58f0\u660e\u5f0f\u914d\u7f6e\u6587\u4ef6\u5b9e\u73b0\u4e86\u914d\u7f6e\u6570\u636e\u7684\u8fc1\u79fb\uff0c\u5e76\u6839\u636e\u4e24\u4fa7\u67b6\u6784\u548c\u529f\u80fd\u7684\u4e0d\u540c\u505a\u51fa\u76f8\u5e94\u9002\u914d\u3002\u76ee\u524d\u6211\u4eec\u652f\u6301\u4e86 Kong \u4e00\u4fa7 Route\u3001Service\u3001Upstream\u3001Target\uff0cConsumer \u4ee5\u53ca\u4e09\u4e2a\u63d2\u4ef6 Rate Limiting\u3001Proxy Caching \u4ee5\u53ca Key Authentication \u7684\u914d\u7f6e\u8fc1\u79fb\uff0c\u5e76\u4ee5 Kong \u7684 [Getting Started Guide](https://docs.konghq.com/getting-started-guide/2.4.x/overview/) \u4e3a\u4f8b\uff0c\u5b8c\u6210\u4e86\u4e00\u4e2a\u6700\u5c0f\u7684 demo\u3002\\n\\n## \u4f7f\u7528\u65b9\u6cd5\\n\\n1. \u4f7f\u7528 Deck \u5bfc\u51fa Kong \u58f0\u660e\u5f0f\u914d\u7f6e\u6587\u4ef6\uff0c\u70b9\u51fb\u67e5\u770b[\u5177\u4f53\u6b65\u9aa4](https://docs.konghq.com/deck/1.7.x/guides/backup-restore/)\\n\\n2. \u4e0b\u8f7d\u4ed3\u5e93\u5e76\u8fd0\u884c\u8fc1\u79fb\u5de5\u5177\uff0c\u8fc1\u79fb\u5de5\u5177\u4f1a\u751f\u6210\u58f0\u660e\u5f0f\u914d\u7f6e\u6587\u4ef6 `apisix.yaml` \u5f85\u4f7f\u7528\\n\\n```shell\\ngit clone https://github.com/api7/kong-to-apisix\\n\\ncd kong-to-apisix\\n\\nmake build\\n\\n./bin/kong-to-apisix migrate --input kong.yaml --output apisix.yaml\\n\\n# migrate succeed\\n```\\n\\n3. \u4f7f\u7528 `apisix.yaml`\u914d\u7f6e APISIX\uff0c \u70b9\u51fb\u67e5\u770b[\u5177\u4f53\u6b65\u9aa4](https://apisix.apache.org/docs/apisix/deployment-modes/#standalone)\u3002\\n\\n## Demo \u6d4b\u8bd5\\n\\n1. \u786e\u4fdd docker \u6b63\u5e38\u8fd0\u884c\uff0c\u90e8\u7f72\u6d4b\u8bd5\u73af\u5883\uff0c\u4f7f\u7528 docker-compose \u62c9\u8d77 APISIX\u3001Kong\\n\\n```shell\\ngit clone https://github.com/apache/apisix-docker\\n\\ncd kong-to-apisix\\n\\n./tools/setup.sh\\n```\\n\\n2. \u6839\u636e Kong \u7684 Getting Started Guide\uff0c\u4e3a Kong \u6dfb\u52a0\u914d\u7f6e\u5e76\u8fdb\u884c\u6d4b\u8bd5\uff1a\\n\\n   a. \u901a\u8fc7 Service \u548c Route \u66b4\u9732\u670d\u52a1\uff0c\u8fdb\u884c\u8def\u7531\u8f6c\u53d1\\n\\n   b. \u8bbe\u7f6e Rate Limiting \u548c Proxy Caching \u63d2\u4ef6\u505a\u9650\u6d41\u7f13\u5b58\\n\\n   c. \u8bbe\u7f6e Key Authentication \u63d2\u4ef6\u505a\u8ba4\u8bc1\\n\\n   d. \u901a\u8fc7 Upstream \u548c Target \u8bbe\u7f6e\u8d1f\u8f7d\u5747\u8861\\n\\n```shell\\n./examples/kong-example.sh\\n```\\n\\n3. \u5bfc\u51fa Kong \u7684\u58f0\u660e\u5f0f\u914d\u7f6e\u6587\u4ef6\u5230 `kong.yaml`\\n\\n```shell\\ngo run ./cmd/dumpkong/main.go\\n```\\n\\n4. \u8fd0\u884c\u8fc1\u79fb\u5de5\u5177\uff0c\u5bfc\u5165 `kong.yaml` \u5e76\u751f\u6210 APISIX \u914d\u7f6e\u6587\u4ef6 `apisix.yaml` \u81f3 docker volumes\\n\\n```shell\\nexport EXPORT_PATH=./repos/apisix-docker/example/apisix_conf\\n\\ngo run ./cmd/kong-to-apisix/main.go\\n```\\n\\n5. \u5728 APISIX \u4e00\u4fa7\u6d4b\u8bd5\u8fc1\u79fb\u8fc7\u540e\u7684\u8def\u7531\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u63d2\u4ef6\u7b49\u662f\u5426\u6b63\u5e38\u8fd0\u884c\\n\\na. \u6d4b\u8bd5 key auth \u63d2\u4ef6\\n\\n```shell\\ncurl -k -i -m 20 -o /dev/null -s -w %{http_code} http://127.0.0.1:9080/mock\\n# output: 401\\n```\\n\\n\u200bb. \u6d4b\u8bd5 proxy cache \u63d2\u4ef6\\n\\n```shell\\n# access for the first time\\ncurl -k -I -s  -o /dev/null http://127.0.0.1:9080/mock -H \\"apikey: apikey\\" -H \\"Host: mockbin.org\\"\\n# see if got cached\\ncurl -I -s -X GET http://127.0.0.1:9080/mock -H \\"apikey: apikey\\" -H \\"Host: mockbin.org\\"\\n# output:\\n#   HTTP/1.1 200 OK\\n#   ...\\n#   Apisix-Cache-Status: HIT\\n```\\n\\n\u200bc. \u6d4b\u8bd5 limit count \u63d2\u4ef6\\n\\n```shell\\nfor i in {1..5}; do\\n    curl -s -o /dev/null -X GET http://127.0.0.1:9080/mock -H \\"apikey: apikey\\" -H \\"Host: mockbin.org\\"\\ndone\\ncurl -k -i -m 20 -o /dev/null -s -w %{http_code} http://127.0.0.1:9080/mock -H \\"apikey: apikey\\" -H \\"Host: mockbin.org\\"\\n# output: 429\\n```\\n\\n\u200bd. \u6d4b\u8bd5\u8d1f\u8f7d\u5747\u8861\\n\\n```shell\\nhttpbin_num=0\\nmockbin_num=0for i in {1..8}; do\\n   body=$(curl -k -i -s http://127.0.0.1:9080/mock -H \\"apikey: apikey\\" -H \\"Host: mockbin.org\\")\\n   if [[ $body == *\\"httpbin\\"* ]]; then\\n      httpbin_num=$((httpbin_num+1))\\n   elif [[ $body == *\\"mockbin\\"* ]]; then\\n      mockbin_num=$((mockbin_num+1))\\n   fi\\n   sleep 1.5done\\necho \\"httpbin number: \\"${httpbin_num}\\", mockbin number: \\"${mockbin_num}\\n# output:\\n#   httpbin number: 6, mockbin number: 2\\n```\\n\\n## \u603b\u7ed3\\n\\n\u8fc1\u79fb\u5de5\u5177\u7684\u540e\u7eed\u5f00\u53d1\u8ba1\u5212\u5df2\u5728 Kong-To-APISIX \u7684 GitHub \u4ed3\u5e93\u7684 Roadmap \u4e2d\u5448\u73b0\uff0c\u6b22\u8fce\u5927\u5bb6\u8bbf\u95ee Kong-To-APISIX \u7684 [GitHub \u4ed3\u5e93\u5730\u5740](https://github.com/api7/kong-to-apisix) \uff0c\u6d4b\u8bd5\u4e0e\u4f7f\u7528 Kong-To-APISIX\u3002\\n\u6b22\u8fce\u4efb\u4f55\u5bf9\u8fd9\u4e2a\u9879\u76ee\u611f\u5174\u8da3\u7684\u4eba\u4e00\u540c\u6765\u4e3a\u8fd9\u4e2a\u9879\u76ee\u4f5c\u8d21\u732e\uff01\u6709\u4efb\u4f55\u95ee\u9898\u90fd\u53ef\u4ee5\u5728\u4ed3\u5e93\u7684 Issues \u533a\u8ba8\u8bba\u3002"},{"id":"Apache APISIX 2.8 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2021/07/28/release-apache-apisix-2.8","source":"@site/blog/2021/07/28/release-apache-apisix-2.8.md","title":"Apache APISIX 2.8 \u6b63\u5f0f\u53d1\u5e03","description":"Apache APISIX 2.8 \u7248\u672c\u53d1\u5e03\u4e86\u4ee5\u4e0b\u529f\u80fd\uff1a\u72ec\u7acb\u7684 Keepalive \u8fde\u63a5\u6c60\u3001stream \u4ee3\u7406\u529f\u80fd\u589e\u5f3a\u3001gzip \u63d2\u4ef6\u3001\u652f\u6301\u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u6267\u884c\u7279\u5b9a\u903b\u8f91\u3001\u652f\u6301\u81ea\u5b9a\u4e49 balancer\u3002","date":"2021-07-28T00:00:00.000Z","formattedDate":"2021\u5e747\u670828\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.73,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"Kong-To-APISIX \u8fc1\u79fb\u5de5\u5177","permalink":"/zh/blog/2021/08/05/kong-to-apisix"},"nextItem":{"title":"\u63d2\u4ef6\u7f16\u6392\u5728 Apache APISIX \u4e2d\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5","permalink":"/zh/blog/2021/07/27/use-of-plugin-orchestration-in-apache-apisix"}},"content":"> Apache APISIX 2.8 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX 2.8 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\ud83c\udf89 \u8fd9\u4e2a\u7248\u672c\u6709 30+ \u5f00\u53d1\u8005\u53c2\u4e0e\uff0c\u5171\u63d0\u4ea4\u4e86 100+ PR\uff0c\u652f\u6301\u4e86 **1 \u4e2a\u65b0\u529f\u80fd\u30011 \u4e2a\u65b0\u4f53\u9a8c\u30012 \u4e2a\u65b0\u63d2\u4ef6\u30012 \u4e2a\u65b0\u73a9\u6cd5**\uff0c\u5feb\u53bb\u9605\u8bfb\u4e86\u89e3 2.8 \u7248\u672c\u7684\u65b0\u7279\u6027\u5427\uff01\\n\\n\ud83d\udc47\ud83d\udc47\ud83d\udc47\\n\\n## Release Notes\\n\\n### \u65b0\u529f\u80fd\uff1a\u72ec\u7acb\u7684 Keepalive \u8fde\u63a5\u6c60\\n\\n\u4ece[2.7 \u7248\u672c](https://apisix.apache.org/blog/2021/06/29/release-apache-apisix-2.7)\u5f00\u59cb\u6dfb\u52a0 Apache APISIX \u81ea\u5df1\u7684\u8865\u4e01\u548c Nginx C \u6a21\u5757\uff0c\u589e\u5f3a\u539f\u751f Nginx \u7684\u529f\u80fd\uff0c\u5e0c\u671b\u80fd\u591f\u52a8\u6001\u8bbe\u7f6e\u8d8a\u6765\u8d8a\u591a\u7684 Nginx \u914d\u7f6e\u3002\u5728\u53d1\u5e03\u7684\u6700\u65b0\u7248\u672c\u4e2d\uff0cApache APISIX \u5df2\u7ecf\u652f\u6301\u5728 Upstream \u7ea7\u522b\u4e0a\u914d\u7f6e\u72ec\u7acb\u7684 Keepalive \u8fde\u63a5\u6c60\u3002\\n\\n\u76ee\u524d\u5305\u542b\u4e86\u4ee5\u4e0b\u529f\u80fd\uff1a\\n\\n- \u52a8\u6001\u8bbe\u7f6e mTLS\\n- \u52a8\u6001\u8bbe\u7f6e client_max_body_size\\n- Upstream \u7684 keepalive\uff082.8 \u65b0\u529f\u80fd\uff09\\n- gzip (2.8 \u65b0\u63d2\u4ef6)\\n\\n\u5728 Apache APISIX \u540e\u7eed\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u4e5f\u4f1a\u9646\u7eed\u5141\u8bb8\u4e0b\u9762\u7684 Nginx \u914d\u7f6e\u80fd\u591f\u88ab\u52a8\u6001\u8bbe\u7f6e\uff1a\\n\\n- real_ip\\n- proxy_max_temp_file_size\\n- \u2026\u2026\\n\\nUpstream \u7684\u914d\u7f6e\u4e3e\u4f8b\uff1a\\n\\n```JSON\\n{\\n    \\"id\\": \\"backend\\",\\n    \\"nodes\\": {\\"host:80\\": 100},\\n    \\"type\\":\\"roundrobin\\",\\n    \\"keepalive_pool\\": {\\n        \\"size\\": 4,\\n        \\"idle_timeout\\": 8,\\n        \\"requests\\": 16\\n    }\\n}\\n```\\n\\n### \u65b0\u4f53\u9a8c\uff1astream \u4ee3\u7406\u529f\u80fd\u589e\u5f3a\\n\\n\u5728 2.8 \u7248\u672c\u4e2d\uff0c\u628a [ip-restriction](http://apisix.apache.org/docs/apisix/plugins/ip-restriction/) \u548c [limit-conn](http://apisix.apache.org/docs/apisix/plugins/limit-conn/) \u4e24\u4e2a\u63d2\u4ef6\u4ece HTTP \u90e8\u5206\u7684\u79fb\u690d\u5230\u4e86 stream \u90e8\u5206\uff0c\u8fd9\u4e48\u505a\u7684\u597d\u5904\u662f\u4e30\u5bcc\u7f51\u5173\u5728 stream \u4ee3\u7406\u7684\u529f\u80fd\uff0c\u589e\u52a0\u5bf9\u4e0a\u6e38\u670d\u52a1\u7684\u5b89\u5168\u6027\u4fdd\u969c\u3002\\n\\nip-restriction \u53ef\u4ee5\u7528\u6765\u505a IP \u9ed1\u767d\u540d\u5355\u8fc7\u6ee4\uff0c\u4fdd\u8bc1\u53ea\u6709\u6765\u81ea\u7279\u5b9a IP \u7684\u8bf7\u6c42\u624d\u80fd\u8bbf\u95ee\u5230\u540e\u7aef\u670d\u52a1\u3002\\n\\nlimit-conn \u53ef\u4ee5\u7528\u6765\u9650\u5236\u7279\u5b9a\u8def\u7531\u4e0a\u540c\u65f6\u5b58\u5728\u7684\u8fde\u63a5\u4e2a\u6570\uff0c\u9650\u5236\u5ba2\u6237\u7aef\u7684\u5e76\u53d1\u8bbf\u95ee\u91cf\u3002\\n\\n### \u65b0\u63d2\u4ef6\uff1agzip \u63d2\u4ef6\\n\\n2.8 \u7248\u672c\u4e2d\u65b0\u589e\u4e86 gzip \u63d2\u4ef6\uff0c\u4f7f\u7528 gzip \u63d2\u4ef6\u53ef\u4ee5**\u52a8\u6001\u8bbe\u7f6e\u8def\u7531\u7ea7\u522b\u7684 gzip \u53c2\u6570**\u3002\\n\\ngzip \u914d\u7f6e\u4e3e\u4f8b\uff1a\\n\\n```JSON\\n{\\n    \\"plugins\\": {\\n        \\"gzip\\": {\\n            \\"min_length\\": 20,\\n            \\"http_version\\": 1.1,\\n            \\"buffers\\": {\\n                \\"number\\": 32,\\n                \\"size\\": 4096\\n            },\\n            \\"types\\": [\\n                \\"text/html\\"\\n            ],\\n            \\"comp_level\\": 1,\\n            \\"vary\\": false\\n        }\\n    }\\n}\\n```\\n\\n### \u65b0\u63d2\u4ef6\uff1aua-restriction\\n\\n`ua-restriction` \u63d2\u4ef6\u7528\u4e8e\u6821\u9a8c User-Agent \u662f\u5426\u5904\u4e8e\u9ed1\u767d\u540d\u5355\u4e2d\uff0c\u9ed1\u767d\u540d\u5355\u662f\u4e00\u4e2a\u975e\u5e38\u5e38\u89c1\u7684\u9700\u6c42\uff0c\u73b0\u5728\u53ef\u4ee5\u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u542f\u7528\u4e86\u3002\\n\\n`ua-restriction` \u914d\u7f6e\u4e3e\u4f8b\uff1a\\n\\n```JSON\\n{\\n    \\"plugins\\": {\\n        \\"ua-restriction\\": {\\n            \\"denylist\\": [\\n                \\"my-bot1\\",\\n                \\"(Baiduspider)/(\\\\\\\\d+)\\\\\\\\.(\\\\\\\\d+)\\"\\n            ]\\n        }\\n    }\\n}\\n```\\n\\n### \u65b0\u73a9\u6cd5\uff1a\u652f\u6301\u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u6267\u884c\u7279\u5b9a\u903b\u8f91\\n\\n\u5f97\u76ca\u4e8e Apache APISIX \u67b6\u6784\uff0c\u8bb8\u591a\u529f\u80fd\u90fd\u662f\u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\u3002\u4ece 2.8 \u7248\u672c\u5f00\u59cb\uff0c\u63d2\u4ef6\u53c8\u6dfb\u52a0\u4e86\u65b0\u73a9\u6cd5\u3002**\u73b0\u5728 Apache APISIX \u652f\u6301\u5728\u9009\u62e9\u4e0a\u6e38\u8282\u70b9\u4e4b\u540e\uff0c\u901a\u8fc7\u63d2\u4ef6\u7684\u65b9\u5f0f\u6267\u884c\u7279\u5b9a\u903b\u8f91\u3002**  \\n\\n\u53ea\u9700\u8981\u5728\u63d2\u4ef6\u91cc\u5b9a\u4e49\u4e0b\u9762\u7684\u65b9\u6cd5\uff1a\\n\\n```Lua\\nfunction _M.balancer(conf, ctx)\\n    core.log.notice(\\"IP: \\", ctx.balancer_ip, \\", Port: \\", ctx.balancer_port)\\nend\\n```\\n\\n\u5728\u8fd9\u4e2a\u793a\u4f8b\u91cc\uff0c\u65e5\u5fd7\u4f1a\u8f93\u51fa\u4e0a\u6e38\u7684 IP \u548c Port\u3002\\n\\n**\u4ec0\u4e48\u573a\u666f\u4e0b\u4f1a\u8fd0\u884c\u4e0a\u8ff0\u65b9\u6cd5\uff1f**\\n\\n1. \u9009\u62e9\u4e0a\u6e38\u8282\u70b9\u4e4b\u540e\uff0c\u8bbf\u95ee\u4e0a\u6e38\u4e4b\u524d\\n2. \u6bcf\u6b21\u91cd\u8bd5\u4e4b\u524d\\n\\n\u51fa\u4e8e\u6027\u80fd\u8003\u8651\uff0c\u4e0a\u8ff0\u65b9\u6cd5\u9996\u6b21\u8fd0\u884c\u5728 OpenResty \u7684 access \u9636\u6bb5\uff08\u5b9e\u9645\u4e0a APISIX \u5728 access \u9636\u6bb5\u5c31\u9009\u597d\u4e86\u4e0a\u6e38\u8282\u70b9\uff09\uff0c\u8be5\u65b9\u6cd5\u5e76\u4e0d\u4e0e OpenResty \u7684\u540c\u540d\u9636\u6bb5\u91cd\u5408\u3002\\n\\n### \u65b0\u73a9\u6cd5\uff1a\u652f\u6301\u81ea\u5b9a\u4e49 balancer\\n\\n\u4ece 2.8 \u7248\u672c\u5f00\u59cb\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49 balancer\u3002**\u8fd9\u91cc\u7684 balancer\uff0c\u662f\u6307\u6700\u5c11\u8fde\u63a5\u6570\u3001\u8f6e\u8be2\u3001\u4e00\u81f4\u6027\u54c8\u5e0c\u7b49\u8d1f\u8f7d\u5747\u8861\u5668\u3002**\\n\\n\u867d\u7136 Apache APISIX \u5df2\u7ecf\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684 balancer\uff0c\u4f46\u662f\u7528\u6237\u53ef\u80fd\u9700\u8981\u7528\u7684 balancer \u662f\u548c\u4e1a\u52a1\u7d27\u5bc6\u76f8\u5173\u7684 balancer\uff0c\u6bd4\u5982\uff1a\u9700\u8981\u8003\u8651\u673a\u623f\u3001\u53ef\u7528\u533a\u7b49\u7b49\u3002\u652f\u6301\u81ea\u5b9a\u4e49 balancer\uff0c\u7528\u6237\u53ef\u4ee5\u7f16\u5199\u81ea\u5df1\u7684 balancer\uff0c\u5e76\u901a\u8fc7 `require(\\"apisix.balancer.your_balancer\\")`  \u52a0\u8f7d\u5230\u7a0b\u5e8f\u4e2d\u3002\\n\\n\u901a\u5e38\u81ea\u5b9a\u4e49\u7684 balancer \u9700\u8981 node \u63d0\u4f9b host/port \u4ee5\u5916\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u628a\u6570\u636e\u653e\u5230 metadata \u91cc\u9762\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff1a\\n\\n```JSON\\n{\\n    \\"nodes\\": [\\n        { \\"host\\": \\"0.0.0.0\\", \\"port\\": 1980, \\"weight\\": 1, \\"metadata\\": {\\"b\\": 1} }\\n    ]\\n}\\n```\\n\\n## \u4e0b\u8f7d\\n\\n\u4e0b\u8f7d Apache APISIX 2.8\\n\\n- \u6e90\u4ee3\u7801\uff1a\u8bf7\u8bbf\u95ee[\u4e0b\u8f7d\u9875\u9762](https://apisix.apache.org/downloads/)\\n- \u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\uff1a\u8bf7\u8bbf\u95ee[\u5b89\u88c5\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/how-to-build/)"},{"id":"2021/07/27/use-of-plugin-orchestration-in-apache-apisix","metadata":{"permalink":"/zh/blog/2021/07/27/use-of-plugin-orchestration-in-apache-apisix","source":"@site/blog/2021/07/27/use-of-plugin-orchestration-in-Apache-APISIX.md","title":"\u63d2\u4ef6\u7f16\u6392\u5728 Apache APISIX \u4e2d\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5","description":"\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u4f60\u53ef\u4ee5\u4e86\u89e3\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u53ca\u5176\u57fa\u672c\u4f7f\u7528\u573a\u666f\uff0c\u4ee5\u53ca\u5728\u4f4e\u4ee3\u7801\u6f6e\u6d41\u4e0b\uff0cApache APISIX \u662f\u5982\u4f55\u96c6\u6210\u201c\u62d6\u62fd\u201d\u7684\u63d2\u4ef6\u7f16\u6392\u80fd\u529b\u7684\u3002","date":"2021-07-27T00:00:00.000Z","formattedDate":"2021\u5e747\u670827\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.24,"truncated":true,"authors":[{"name":"\u741a\u81f4\u8fdc","url":"https://github.com/juzhiyuan","imageURL":"https://avatars.githubusercontent.com/u/2106987?v=4"}],"prevItem":{"title":"Apache APISIX 2.8 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/07/28/release-apache-apisix-2.8"},"nextItem":{"title":"ApacheCon Asia 2021\uff1aApache APISIX \u6280\u672f\u8bae\u9898\u4e00\u89c8","permalink":"/zh/blog/2021/07/25/apachecon-asia"}},"content":"> \u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u60a8\u53ef\u4ee5\u4e86\u89e3 Apache APISIX \u4e0e\u57fa\u672c\u4f7f\u7528\u573a\u666f\uff0c\u4ee5\u53ca\u5728\u4f4e\u4ee3\u7801\u6f6e\u6d41\u4e0b\uff0cApache APISIX \u662f\u5982\u4f55\u96c6\u6210\u201c\u62d6\u62fd\u201d\u7684\u63d2\u4ef6\u7f16\u6392\u80fd\u529b\u7684\u3002\u672c\u6587\u4f5c\u8005\u741a\u81f4\u8fdc\uff0cApache APISIX PMC\uff0c\u5728[\u652f\u6d41\u79d1\u6280](https://api7.ai/)\u8d1f\u8d23\u4f01\u4e1a\u4ea7\u54c1\u4e0e\u5927\u524d\u7aef\u6280\u672f\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u4ec0\u4e48\u662f Apache APISIX\\n\\nApache APISIX \u662f\u4e00\u4e2a\u751f\u4ea7\u53ef\u7528\u7684\u4e03\u5c42\u5168\u6d41\u91cf\u5904\u7406\u5e73\u53f0\uff0c\u53ef\u4f5c\u4e3a API \u7f51\u5173\u5904\u7406\u4e1a\u52a1\u6d41\u91cf\u5165\u53e3\uff0c\u5177\u6709\u6781\u9ad8\u6027\u80fd\u3001\u8d85\u4f4e\u5ef6\u8fdf\u7684\u663e\u8457\u7279\u6027\u3002\u5b83\u5185\u7f6e\u4e86 50 \u591a\u79cd\u63d2\u4ef6\uff0c\u8986\u76d6\u8eab\u4efd\u9a8c\u8bc1\u3001\u5b89\u5168\u9632\u62a4\u3001\u6d41\u91cf\u63a7\u5236\u3001Serverless\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u591a\u4e2a\u65b9\u9762\uff0c\u53ef\u6ee1\u8db3\u4f01\u4e1a\u5ba2\u6237\u5e38\u89c1\u7684\u4f7f\u7528\u573a\u666f\u3002\\n\\n\u5982\u4e0b\u65b9\u67b6\u6784\u56fe\u6240\u793a\uff0cApache APISIX \u5206\u4e3a\u6570\u636e\u9762\uff08\u5de6\u4fa7\uff09\u4e0e\u63a7\u5236\u9762\uff08\u53f3\u4fa7\uff09\u4e24\u90e8\u5206\uff1a\u901a\u8fc7\u63a7\u5236\u9762\u4e0b\u53d1\u914d\u7f6e\u5230 ETCD\uff0c\u6570\u636e\u9762\u501f\u52a9\u4e30\u5bcc\u7684\u63d2\u4ef6\u5904\u7406\u5185\u5916\u6d41\u91cf\u3002\\n\\n![Apache APISIX architecture](https://static.apiseven.com/202108/1639466553989-ecae1a31-8121-4390-a830-f386b9b12322.png)\\n\\nApache APISIX \u66b4\u9732\u4e86\u4e00\u7ec4\u63a5\u53e3\uff0c\u65b9\u4fbf\u6211\u4eec\u4e3a API \u7ed1\u5b9a\u63d2\u4ef6\u3002\u5982\u679c\u6211\u4eec\u5e0c\u671b\u4e3a API \u589e\u52a0\u9650\u901f\u80fd\u529b\uff0c\u53ea\u9700\u4e3a API \u7ed1\u5b9a `limit-req` \u63d2\u4ef6\uff1a\\n\\n``` shell\\ncurl -X PUT http://127.0.0.1:9080/apisix/admin/routes/1 -d \'\\n\\n {\\n   \\"uri\\": \\"/get\\",\\n   \\"methods\\": [\\"GET\\"],\\n   \\"upstream\\": {\\n     \\"type\\": \\"roundrobin\\",\\n     \\"nodes\\": {\\n       \\"httpbin.org:80\\": 1\\n     }\\n   },\\n   \\"plugins\\": {\\n     \\"limit-req\\": {\\n       \\"rate\\": 1,\\n       \\"burst\\": 2,\\n       \\"rejected_code\\": 503,\\n       \\"key\\": \\"remote_addr\\"\\n     }\\n   }\\n }\'\\n```\\n\\n\u8c03\u7528\u6210\u529f\u540e\uff0c\u5f53\u8bf7\u6c42\u5230\u8fbe\u8be5 API \u65f6\u5c06\u8fdb\u884c\u9650\u901f\u7ba1\u63a7\u3002\\n\\n\u8be5\u793a\u4f8b\u4f7f\u7528 `limit-req` \u5b9e\u73b0 API \u9650\u901f\uff08\u7279\u5b9a\u529f\u80fd\uff09\uff0c\u82e5\u9488\u5bf9\u201c\u6839\u636e\u67d0\u4e2a\u63d2\u4ef6\u7684\u5904\u7406\u7ed3\u679c\uff0c\u51b3\u5b9a\u540e\u7eed\u7684\u8bf7\u6c42\u5904\u7406\u903b\u8f91\u201d\u8fd9\u79cd\u573a\u666f\u5316\u9700\u6c42\uff0c\u8be5\u600e\u4e48\u505a\u5462\uff1f\u5f53\u524d\uff0c\u73b0\u6709\u7684\u63d2\u4ef6\u673a\u5236\u65e0\u6cd5\u6ee1\u8db3\u8fd9\u79cd\u9700\u6c42\uff0c\u8fd9\u65f6\u4fbf\u5f15\u7533\u51fa\u63d2\u4ef6\u7f16\u6392\u7684\u80fd\u529b\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\\n\\n## \u4ec0\u4e48\u662f\u63d2\u4ef6\u7f16\u6392\\n\\n\u63d2\u4ef6\u7f16\u6392\u662f\u4f4e\u4ee3\u7801\u7684\u4e00\u79cd\u8868\u73b0\u5f62\u5f0f\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u4f01\u4e1a\u964d\u4f4e\u4f7f\u7528\u6210\u672c\u3001\u589e\u52a0\u8fd0\u7ef4\u6548\u7387\uff0c\u662f\u4f01\u4e1a\u6570\u5b57\u5316\u8f6c\u578b\u8fc7\u7a0b\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u80fd\u529b\u3002\u501f\u52a9\u4f4e\u4ee3\u7801 API \u7f51\u5173 Apache APISIX \u4e2d\u63d2\u4ef6\u7f16\u6392\u80fd\u529b\uff0c\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u5730\u5c06 50+ \u63d2\u4ef6\u901a\u8fc7\u201c\u62d6\u62fd\u201d\u7684\u65b9\u5f0f\u8fdb\u884c\u7ec4\u5408\u7f16\u6392\uff0c\u88ab\u7f16\u6392\u7684\u63d2\u4ef6\u4e5f\u80fd\u591f\u5171\u4eab\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u6700\u7ec8\u5b9e\u73b0\u573a\u666f\u5316\u9700\u6c42\u3002\\n\\n\u6269\u5c55\u4e0a\u8ff0 API \u9650\u901f\u7684\u573a\u666f\uff1a\u8bf7\u6c42\u4f7f\u7528 `key-auth`\u63d2\u4ef6\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\uff0c\u82e5\u8ba4\u8bc1\u901a\u8fc7\uff0c\u5c06\u7531`kafka-logger` \u63d2\u4ef6\u63a5\u7ba1\u5e76\u8fdb\u884c\u65e5\u5fd7\u8bb0\u5f55\uff1b\u82e5\u8ba4\u8bc1\u5931\u8d25\uff08\u63d2\u4ef6\u8fd4\u56de 401 \u72b6\u6001\u7801\uff09\uff0c\u5c06\u4f7f\u7528`limit-req` \u63d2\u4ef6\u8fdb\u884c\u9650\u901f\u3002\\n\\n\u89c1\u5982\u4e0b\u64cd\u4f5c\u89c6\u9891\uff1a\\n\\n<iframe\\n    height=\\"350\\"\\n    width=\\"100%\\"\\n    src=\\"https://api7-website-1301662268.file.myqcloud.com/202107/%E6%8F%92%E4%BB%B6%E7%BC%96%E6%8E%92.mp4\\"\\n    frameborder=\\"0\\">\\n</iframe>\\n\\n\u8be5\u89c6\u9891\u4e2d\uff0cWeb \u754c\u9762\u5217\u51fa\u4e86\u76ee\u524d\u5df2\u6709\u7684\u63d2\u4ef6\u4e0e\u753b\u677f\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u63d2\u4ef6\u62d6\u62fd\u5230\u753b\u677f\u4e0a\u8fdb\u884c\u7f16\u6392\uff0c\u5e76\u586b\u5199\u63d2\u4ef6\u7ed1\u5b9a\u7684\u6570\u636e\uff0c\u7136\u540e\u4fbf\u5b8c\u6210\u4e86\u6574\u4e2a\u6d41\u7a0b\u3002\u5728\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff1a\\n\\n1. \u64cd\u4f5c\u53ef\u89c6\u5316\uff1a\u6211\u4eec\u9664\u4e86\u53ef\u4ee5\u4f7f\u7528\u754c\u9762\u53ef\u89c6\u5316\u521b\u5efa API \u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u7f16\u6392\u80fd\u529b\u76f4\u89c2\u3001\u6e05\u6670\u5730\u8fdb\u884c\u573a\u666f\u5316\u8bbe\u8ba1\uff1b\\n2. \u6d41\u7a0b\u53ef\u590d\u7528\uff1a\u901a\u8fc7\u5bfc\u5165\u3001\u5bfc\u51fa\u753b\u677f\u7684 JSON \u6570\u636e\uff0c\u53ef\u4ee5\u4fbf\u6377\u5730\u590d\u7528\u7f16\u6392\u751f\u6210\u7684\u5de5\u7a0b\u6570\u636e\u3002\\n3. \u7ec4\u5408\u65b0\u201c\u63d2\u4ef6\u201d\uff1a\u5c06\u6bcf\u4e00\u4e2a\u573a\u666f\u89c6\u4f5c\u4e00\u4e2a\u63d2\u4ef6\uff0c\u901a\u8fc7\u4f7f\u7528\u6761\u4ef6\u5143\u4ef6\u7ec4\u5408\u4e0d\u540c\u7684\u63d2\u4ef6\uff0c\u6765\u5b9e\u73b0\u63d2\u4ef6\u521b\u9020\u201c\u63d2\u4ef6\u201d\u3002\\n\\n## \u5b9e\u73b0\u539f\u7406\\n\\n\u90a3\u4e48 Apache APISIX \u662f\u5982\u4f55\u4e0e\u4f4e\u4ee3\u7801\u80fd\u529b\u7ed3\u5408\u7684\u5462\uff1f\u8fd9\u9700\u8981\u6570\u636e\u9762 Apache APISIX \u4e0e\u63a7\u5236\u9762 Apache APISIX Dashboard \u5171\u540c\u914d\u5408\u5b8c\u6210\u3002\u6574\u4f53\u6d41\u7a0b\u5982\u4e0b\uff1a\\n\\n![Apache APISIX plugin orchestration flow](https://static.apiseven.com/202108/1639466624894-039f4e63-fd21-403a-94c5-6efc8425eb0f.png)\\n\\n### Apache APISIX\\n\\n\u5728 Apache APISIX \u4e2d\uff0c\u6211\u4eec\u5728 Route \u5b9e\u4f53\u4e2d\u65b0\u589e\u4e86 `script` \u6267\u884c\u903b\u8f91 [PR](https://github.com/apache/apisix/pull/1982)\uff0c\u53ef\u7528\u4e8e\u63a5\u6536 Dashboard \u751f\u6210\u7684 Lua \u51fd\u6570\u5e76\u6267\u884c\uff0c\u5b83\u652f\u6301\u8c03\u7528\u5df2\u6709\u63d2\u4ef6\u4ee5\u590d\u7528\u4ee3\u7801\u3002\u53e6\u5916\uff0c\u5b83\u4e5f\u4f5c\u7528\u4e8e HTTP \u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\u4e2d\u7684\u5404\u4e2a\u9636\u6bb5\uff0c\u5982 `access`\u3001`header_filer`\u3001`body_filter` \u7b49\uff0c\u7cfb\u7edf\u4f1a\u5728\u76f8\u5e94\u9636\u6bb5\u81ea\u52a8\u6267\u884c `script` \u51fd\u6570\u5bf9\u5e94\u9636\u6bb5\u4ee3\u7801\uff0c\u89c1\u5982\u4e0b `script` \u793a\u4f8b\uff1a\\n\\n```shell\\n{\\n\\n  \\"script\\": \\"local _M = {} \\\\n function _M.access(api_ctx) \\\\n ngx.log(ngx.INFO,\\\\\\"hit access phase\\\\\\") \\\\n end \\\\nreturn _M\\"\\n\\n}\\n```\\n\\n### Apache APISIX Dashboard\\n\\n\u5728 Dashboard \u4e2d\uff0c\u5b83\u5305\u542b\u4e86 Web \u4e0e ManagerAPI \u5171\u4e24\u4e2a\u5b50\u7ec4\u4ef6\uff1aWeb \u7528\u4e8e\u63d0\u4f9b\u53ef\u89c6\u5316\u754c\u9762\uff0c\u65b9\u4fbf\u6211\u4eec\u914d\u7f6e API \u7f51\u5173\uff1bManagerAPI \u7528\u4e8e\u63d0\u4f9b RESTful API\uff0c\u4f9b Web \u6216\u5176\u5b83\u5ba2\u6237\u7aef\u8c03\u7528\u4ee5\u4fbf\u64cd\u4f5c\u914d\u7f6e\u4e2d\u5fc3\uff08\u9ed8\u8ba4\u4e3a ETCD\uff09\uff0c\u8fdb\u800c\u95f4\u63a5\u5730\u63a7\u5236 Apache APISIX\u3002\\n\\n\u4e3a\u4e86\u751f\u6210\u5408\u6cd5\u3001\u6709\u6548\u7684 script \u51fd\u6570\uff0cManagerAPI \u9009\u62e9\u4e86 DAG \u6709\u5411\u65e0\u73af\u56fe\u7684\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u5e95\u5c42\u8bbe\u8ba1\uff0c\u5e76\u81ea\u4e3b\u7814\u53d1\u4e86 `dag-to-lua` [\u9879\u76ee](https://github.com/api7/dag-to-lua)\uff1a\u5b83\u5c06\u6839\u8282\u70b9\u4f5c\u4e3a\u5f00\u59cb\u8282\u70b9\uff0c\u6839\u636e\u5224\u65ad\u6761\u4ef6\u51b3\u5b9a\u4e0b\u4e00\u4e2a\u6d41\u8f6c\u63d2\u4ef6\uff0c\u8fd9\u5c06\u6709\u6548\u907f\u514d\u903b\u8f91\u6b7b\u5faa\u73af\u3002\u5982\u4e0b\u4e3a DAG \u6570\u636e\u7ed3\u6784\u7684\u793a\u610f\u56fe\uff1a\\n\\n![Apache APISIX plugin orchestration DAG data structure](https://static.apiseven.com/202108/1639466682723-dcfd5c1b-9ae7-42b4-b3c2-c00aaf7a5996.png)\\n\\n\u5bf9\u5e94\u5230 ManagerAPI \u63a5\u6536\u7684 `script` \u53c2\u6570\u4e0a\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```shell\\n{\\n  \\"conf\\": {\\n    \\"1-2-3\\": {\\n      \\"name\\": \\"plugin-a\\",\\n      \\"conf\\": {\\n        ...\\n\\n      }\\n    },\\n\\n    \\"4-5-6\\": {\\n      \\"name\\": \\"plugin-b\\",\\n      \\"conf\\": {\\n        ...\\n      }\\n    },\\n    \\"7-8-9\\": {\\n      \\"name\\": \\"plugin-c\\",\\n      \\"conf\\": {\\n        ...\\n      }\\n    }\\n  },\\n\\n  \\"rule\\": {\\n    \\"root\\": \\"1-2-3\\", // \u8d77\u59cb\u8282\u70b9 ID\\n    \\"1-2-3\\": [\\n      [\\n        \\"code == 200\\",\\n        \\"4-5-6\\"\\n      ], [\\n        \\"\\",\\n        \\"7-8-9\\"\\n      ]\\n    ]\\n  }\\n}\\n```\\n\\n\u5373\u5ba2\u6237\u7aef\u5c06\u6700\u7ec8\u7f16\u6392\u540e\u7684\u6570\u636e\u8f6c\u6362\u4e3a\u4e0a\u8ff0\u683c\u5f0f\u540e\uff0cManagerAPI \u4f1a\u501f\u52a9 `dag-to-lua` \u9879\u76ee\u751f\u6210 Lua \u51fd\u6570\uff0c\u5e76\u4ea4\u7ed9 Apache APISIX \u6267\u884c\u3002\\n\\n\u5728 Web \u4fa7\uff0c\u7ecf\u8fc7\u6311\u9009\u3001\u5bf9\u6bd4\u4e0e\u9879\u76ee\u9a8c\u8bc1\uff0c\u6211\u4eec\u9009\u62e9\u4e86\u8682\u8681\u91d1\u670d\u5f00\u6e90\u7684 X6 \u56fe\u7f16\u8f91\u5f15\u64ce\u4f5c\u4e3a\u63d2\u4ef6\u7f16\u6392 Web \u90e8\u5206\u7684\u5e95\u5c42\u6846\u67b6\uff0c\u9664\u4e86\u5b8c\u5584\u3001\u6e05\u6670\u7684\u6587\u6863\u5916\uff0c\u4e00\u7cfb\u5217\u5f00\u7bb1\u5373\u7528\u7684\u4ea4\u4e92\u7ec4\u4ef6\u4ee5\u53ca\u8282\u70b9\u53ef\u5b9a\u5236\u5316\u80fd\u529b\u4e5f\u662f\u6211\u4eec\u9009\u62e9\u5b83\u7684\u539f\u56e0\u3002\\n\\n![X6 introduction](https://static.apiseven.com/202108/1639466742487-269ebd5a-4f6c-47c3-a941-1275a4b3d178.png)\\n\\n\u5728\u7f16\u6392\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u62bd\u8c61\u51fa\u4e86\u901a\u7528\u5143\u4ef6\u4e0e\u63d2\u4ef6\u5143\u4ef6\u7684\u6982\u5ff5\uff1a\u901a\u7528\u5143\u4ef6\u662f\u6307\u5f00\u59cb\u8282\u70b9\u3001\u7ed3\u675f\u8282\u70b9\u4e0e\u6761\u4ef6\u5224\u65ad\u8282\u70b9\uff0c\u63d2\u4ef6\u5143\u4ef6\u5219\u662f\u6bcf\u4e00\u4e2a\u53ef\u7528\u7684 Apache APISIX \u63d2\u4ef6\uff0c\u901a\u8fc7\u5c06\u8fd9\u4e9b\u5143\u4ef6\u62d6\u62fd\u5230\u753b\u677f\u4e2d\u6765\u5b8c\u6210\u63d2\u4ef6\u7f16\u6392\u7684\u6d41\u7a0b\u3002\u5982\u56fe\u6240\u793a\uff1a\\n\\n![Apache APISIX dashboard plugin orchestration demo1](https://static.apiseven.com/202108/1639466805116-0e1c9a83-e5d0-40c1-8a76-8cb1402a491c.png)\\n\\n\u5728\u62d6\u62fd\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u9650\u5236\u4e00\u7cfb\u5217\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u8fd9\u91cc\u6709\u51e0\u4e2a\u4f8b\u5b50\uff1a\\n\\n\u5f53\u63d2\u4ef6\u672a\u914d\u7f6e\u65f6\uff0c\u7cfb\u7edf\u5c06\u51fa\u73b0\u300c\u5b58\u5728\u672a\u914d\u7f6e\u7684\u5143\u4ef6\u300d\u7684\u9519\u8bef\u63d0\u793a\uff0c\u53ef\u4ee5\u76f4\u89c2\u5730\u770b\u5230\u54ea\u4e2a\u63d2\u4ef6\u6ca1\u6709\u914d\u7f6e\u6570\u636e\uff1a\\n\\n![Apache APISIX dashboard plugin orchestration demo2](https://static.apiseven.com/202108/1639466853301-a67de136-633d-4b5d-9062-ac17bf625063.png)\\n\\n\u5f53\u7f16\u8f91\u67d0\u6761 API \u65f6\uff0c\u82e5\u8be5 API \u5df2\u7ecf\u7ed1\u5b9a\u4e86\u63d2\u4ef6\u6570\u636e\uff0c\u5f53\u4f7f\u7528\u63d2\u4ef6\u7f16\u6392\u6a21\u5f0f\u65f6\uff0c\u7cfb\u7edf\u5728\u68c0\u6d4b\u540e\u5c06\u51fa\u73b0\u8b66\u544a\u4fe1\u606f\uff0c\u53ea\u6709\u7528\u6237\u660e\u786e\u786e\u8ba4\u5e0c\u671b\u4f7f\u7528\u7f16\u6392\u6a21\u5f0f\u65f6\uff0c\u7cfb\u7edf\u624d\u80fd\u7ee7\u7eed\u8fdb\u884c\u3002\u8fd9\u53ef\u4ee5\u6709\u6548\u907f\u514d API \u6570\u636e\u88ab\u8bef\u64cd\u4f5c\u7684\u60c5\u51b5\u3002\\n\\n![Apache APISIX dashboard plugin orchestration demo3](https://static.apiseven.com/202108/1639466907551-07ec82f9-8988-4a66-a5f2-d3944d4f239c.png)\\n\\n\u6b64\u5916\uff0c\u8fd8\u5b58\u5728\u8bf8\u5982\u5f00\u59cb\u5143\u4ef6\u53ea\u80fd\u6709\u4e00\u4e2a\u8f93\u51fa\u3001\u6761\u4ef6\u5224\u65ad\u5143\u4ef6\u53ea\u80fd\u6709\u4e00\u4e2a\u8f93\u5165\u7b49\u60c5\u51b5\u3002\u8bd5\u60f3\uff1a\u5982\u679c\u7cfb\u7edf\u4e0d\u52a0\u9650\u5236\u5730\u8ba9\u7528\u6237\u64cd\u4f5c\uff0c\u4e0d\u5408\u7406\u7684\u63d2\u4ef6\u7ec4\u5408\u65e2\u65e0\u610f\u4e49\uff0c\u53c8\u4f1a\u4ea7\u751f\u65e0\u6cd5\u9884\u6599\u7684\u9519\u8bef\uff0c\u56e0\u6b64\u4e0d\u65ad\u4e30\u5bcc\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u662f\u5728\u8bbe\u8ba1\u63d2\u4ef6\u7f16\u6392\u65f6\u9700\u8981\u7740\u91cd\u8003\u8651\u7684\u95ee\u9898\u3002\\n\\n\u5f53\u6211\u4eec\u5b8c\u6210\u7f16\u6392\u540e\uff0c\u5c06\u4f7f\u7528 X6 \u66b4\u9732\u7684 API \u751f\u6210\u6d41\u7a0b\u56fe\u7684 JSON \u6570\u636e\uff0c\u7136\u540e\u8f6c\u6362\u4e3a\u7cfb\u7edf\u9700\u8981\u7684 DAG \u6570\u636e\uff0c\u6700\u7ec8\u751f\u6210 Lua \u51fd\u6570\u3002\\n\\n## \u672a\u6765\u5c55\u671b\\n\\n\u901a\u8fc7\u62d6\u62fd\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u5f97\u4f7f\u7528\u4eba\u5458\u66f4\u65b9\u4fbf\u5730\u7ec4\u5408\u63d2\u4ef6\u6765\u6ee1\u8db3\u4e0d\u540c\u7684\u573a\u666f\uff0c\u4ee5\u63d0\u5347 API \u7f51\u5173\u53ef\u6269\u5c55\u80fd\u529b\u4e0e\u8fd0\u7ef4\u4f53\u9a8c\u3002\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u5b58\u5728\u5982\u4e0b\u53ef\u4ee5\u7ee7\u7eed\u4f18\u5316\u7684\u95ee\u9898\uff1a\\n\\n1. \u76ee\u524d\u5143\u4ef6\u7684\u8fb9\u754c\u5224\u65ad\u6761\u4ef6\u8fd8\u4e0d\u591f\u4e30\u5bcc\uff0c\u901a\u8fc7\u7ee7\u7eed\u5b8c\u5584\u8fd9\u4e9b\u6761\u4ef6\uff0c\u4ee5\u51cf\u5c11\u4e0d\u5408\u7406\u7684\u7f16\u6392\u7ec4\u5408\uff1b\\n2. \u5f53\u524d\u7f16\u6392\u793a\u4f8b\u4e0d\u591a\uff0c\u63d0\u4f9b\u66f4\u591a\u7684\u53c2\u8003\u793a\u4f8b\u53ef\u65b9\u4fbf\u5f00\u53d1\u8005\u5b66\u4e60\u3001\u4f9b\u7528\u6237\u4f7f\u7528\uff1b\\n3. \u5f53\u524d Apache APISIX \u4f7f\u7528\u4e86\u63d2\u4ef6\u5b9a\u4e49\u7684 code \u8fdb\u884c\u72b6\u6001\u8fd4\u56de\uff08\u5f02\u5e38\u5219\u8fd4\u56de\u72b6\u6001\u7801\uff0c\u8bf7\u6c42\u7ec8\u6b62\uff09\uff0c\u53ef\u4ee5\u652f\u6301\u66f4\u591a HTTP Response \u5b57\u6bb5\u751a\u81f3\u4fee\u6539\u63d2\u4ef6\u5b9a\u4e49\u6765\u6269\u5c55\u63d2\u4ef6\u7f16\u6392\u80fd\u529b\uff0c\u5982\u4e0b\u8ff0\u63d2\u4ef6\u5b9a\u4e49\uff1a\\n\\n```shell\\nlocal _M = {\\n  version = 0.1,\\n  priority = 2500,\\n  type = \'auth\',\\n  name = plugin_name,\\n  schema = schema,\\n  # \u65b0\u589e\u7684 result \u5b57\u6bb5\uff0c\u53ef\u5b58\u50a8\u63d2\u4ef6\u8fd0\u884c\u7ed3\u679c\uff0c\u5e76\u4f20\u9012\u5230\u4e0b\u4e2a\u63d2\u4ef6\u3002\\n  result = {\\n    code = {\\n      type = \\"int\\"\\n    }\\n  }\\n}\\n```"},{"id":"ApacheCon Asia 2021\uff1aApache APISIX \u6280\u672f\u8bae\u9898\u4e00\u89c8","metadata":{"permalink":"/zh/blog/2021/07/25/apachecon-asia","source":"@site/blog/2021/07/25/apachecon-asia.md","title":"ApacheCon Asia 2021\uff1aApache APISIX \u6280\u672f\u8bae\u9898\u4e00\u89c8","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u5728 ApacheCon Asia \u4e2d\u76f8\u5173\u7684\u4e3b\u9898\uff0c\u5305\u62ec\u5728\u79fb\u52a8\u4e91\u4f7f\u7528 APISIX\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u9650\u6d41\u9650\u901f\u3001\u670d\u52a1\u7f51\u683c\u3001Kubernetes Ingress \u7b49\u3002","date":"2021-07-25T00:00:00.000Z","formattedDate":"2021\u5e747\u670825\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":9.72,"truncated":true,"authors":[{"name":"Apache APISIX \u793e\u533a"}],"prevItem":{"title":"\u63d2\u4ef6\u7f16\u6392\u5728 Apache APISIX \u4e2d\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5","permalink":"/zh/blog/2021/07/27/use-of-plugin-orchestration-in-apache-apisix"},"nextItem":{"title":"\u76f4\u64ad\u9884\u544a\uff5cApache APISIX x Kubernetes","permalink":"/zh/blog/2021/07/21/apache-apisix-kubernetes"}},"content":"> ApacheCon \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u5b98\u65b9\u5168\u7403\u7cfb\u5217\u4f1a\u8bae\u3002\u81ea 1998 \u5e74\u4ee5\u6765\uff0cApacheCon \u4e00\u76f4\u5438\u5f15\u7740\u5404\u4e2a\u5c42\u6b21\u7684\u53c2\u4e0e\u8005\uff0c\u5728 350 \u591a\u4e2a Apache \u9879\u76ee\u53ca\u5176\u4e0d\u540c\u7684\u793e\u533a\u4e2d\u63a2\u7d22 \u201c\u660e\u65e5\u7684\u6280\u672f\u201d\u3002ApacheCon Asia \u662f ApacheCon \u7ec4\u59d4\u4f1a\u9488\u5bf9\u4e9a\u592a\u5730\u533a\u4e3e\u529e\u7684 ApacheCon \u5728\u7ebf\u4f1a\u8bae\uff0c\u4e3b\u8981\u76ee\u6807\u5728\u4e8e\u66f4\u597d\u5730\u670d\u52a1\u4e9a\u592a\u5730\u533a\u5feb\u901f\u589e\u957f\u7684 Apache \u7528\u6237\u548c\u8d21\u732e\u8005\u3002ApacheCon Asia 2021 \u5c06\u4e8e\u4eca\u5e74 8 \u6708 6-8 \u65e5\u5728\u7ebf\u4e3e\u529e\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5173\u4e8e ApacheCon Asia 2021\\n\\nApacheCon \u662f Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u5b98\u65b9\u5168\u7403\u7cfb\u5217\u4f1a\u8bae\u3002\u81ea 1998 \u5e74\u4ee5\u6765\uff0cApacheCon \u4e00\u76f4\u5438\u5f15\u7740\u5404\u4e2a\u5c42\u6b21\u7684\u53c2\u4e0e\u8005\uff0c\u5728 350 \u591a\u4e2a Apache \u9879\u76ee\u53ca\u5176\u4e0d\u540c\u7684\u793e\u533a\u4e2d\u63a2\u7d22 \u201c\u660e\u65e5\u7684\u6280\u672f\u201d\u3002\\n\\nApacheCon Asia \u662f ApacheCon \u7ec4\u59d4\u4f1a\u9488\u5bf9\u4e9a\u592a\u5730\u533a\u4e3e\u529e\u7684 ApacheCon \u5728\u7ebf\u4f1a\u8bae\uff0c\u4e3b\u8981\u76ee\u6807\u5728\u4e8e\u66f4\u597d\u5730\u670d\u52a1\u4e9a\u592a\u5730\u533a\u5feb\u901f\u589e\u957f\u7684 Apache \u7528\u6237\u548c\u8d21\u732e\u8005\u3002ApacheCon Asia 2021 \u5c06\u4e8e\u4eca\u5e74 8 \u6708 6-8 \u65e5\u5728\u7ebf\u4e3e\u529e\u3002\\n\\n![ApacheCon Asia 2021](https://static.apiseven.com/202108/1635750552467-1d0013df-9caa-43a3-bed2-b914d856c413.png)\\n\\n\u8fd1\u671f ApacheCon Asia 2021 \u56e2\u961f\u6b63\u5f0f\u516c\u5e03\u4e86\u5927\u4f1a\u65e5\u7a0b\uff0cApache APISIX \u793e\u533a\u79ef\u6781\u53c2\u4e0e\u672c\u6b21\u5e74\u5ea6\u5f00\u6e90\u76db\u4f1a\uff0c\u5171\u63d0\u62a5\u4e86 8 \u4e2a API/\u5fae\u670d\u52a1\u6280\u672f\u76f8\u5173\u7684\u8bae\u9898\uff0c\u5185\u5bb9\u4e30\u5bcc\uff0c\u6b22\u8fce\u5173\u6ce8\u3002\u540c\u65f6\uff0cApacheCon Asia 2021 \u4e5f\u4e3a\u65e0\u6cd5\u53c2\u52a0\u5728\u7ebf\u4f1a\u8bae\u7684\u5404\u4f4d\u5f00\u6e90\u7231\u597d\u8005\u63d0\u4f9b\u4e86\u6bcf\u4e2a\u8bae\u9898\u7684\u56de\u653e\u548c\u5f55\u64ad\u89c6\u9891\uff0c\u8be6\u60c5\u8bf7\u79fb\u6b65 [Apache Local Community \u5317\u4eac\u672c\u5730\u793e\u533a](https://space.bilibili.com/609014805)\u3002\\n\\n## \u5173\u4e8e API / \u5fae\u670d\u52a1\u6280\u672f\u8bae\u9898\\n\\nAPI \u662f\u670d\u52a1\u8fde\u63a5\u7684\u57fa\u77f3\uff0c\u901a\u8fc7 API \u6211\u4eec\u53ef\u4ee5\u5c06\u5404\u79cd\u670d\u52a1\u8fdb\u884c\u642d\u5efa\uff0c\u5e76\u63d0\u4f9b\u7ed9\u7528\u6237\u4f7f\u7528\uff1b\u968f\u7740\u5e94\u7528\u7684\u590d\u6742\u5ea6\u8d8a\u6765\u8d8a\u9ad8\uff0c\u5355\u4f53\u5e94\u7528\u9010\u6e10\u88ab\u62c6\u5206\u4e3a\u5fae\u670d\u52a1\uff0c\u4ea7\u54c1\u53ef\u4ee5\u5feb\u901f\u8fed\u4ee3\u7684\u540c\u65f6\u4e5f\u5e26\u6765\u5b89\u5168\u3001\u7ef4\u62a4\u548c\u53ef\u89c2\u6d4b\u6027\u65b9\u9762\u7684\u6280\u672f\u6311\u6218\u3002\\n\\nApache APISIX \u662f Apache \u9876\u7ea7\u9879\u76ee\uff0c\u4e5f\u662f\u5168\u7403\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u3002\u5728\u8fd9\u4e2a\u4e13\u9898\u4e2d\uff0c\u5927\u5bb6\u4e0d\u4ec5\u53ef\u4ee5\u4e86\u89e3 Apache APISIX \u8bbe\u8ba1\u7406\u5ff5\uff0c\u4e5f\u4f1a\u5b66\u4e60\u5230 Apache APISIX \u9879\u76ee\u7684\u6700\u4f73\u5b9e\u8df5\u3002\\n\\n## Apache APISIX \u5728\u79fb\u52a8\u4e91\u5bf9\u8c61\u5b58\u50a8 EOS \u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\\n\\n### \u8bae\u9898\u7b80\u4ecb\\n\\n\u8be5\u6f14\u8bb2\u4e3b\u9898\u4e3b\u8981\u662f\u8bb2\u8ff0 Apache APISIX \u5728\u4e2d\u56fd\u79fb\u52a8\u516c\u6709\u4e91\u5bf9\u8c61\u5b58\u50a8 EOS \u4e2d\u7684\u5e94\u7528\u4e0e\u5b9e\u8df5\u7ecf\u9a8c\u5206\u4eab\u3002\u9996\u5148\u4ecb\u7ecd\u4e86\u4e2d\u56fd\u79fb\u52a8\u516c\u6709\u4e91\u5efa\u8bbe\u89c4\u5212\u53ca\u5bf9\u8c61\u5b58\u50a8\u4ea7\u54c1\u53d1\u5c55\u6f14\u8fdb\u5386\u7a0b\uff0c\u7136\u540e\u9610\u8ff0\u4e86\u6211\u4eec\u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX \u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\u7f51\u5173\uff0c\u5e76\u5bf9 EOS \u6d41\u91cf\u6cbb\u7406\u67b6\u6784\u6f14\u8fdb\u4e09\u4e2a\u9636\u6bb5\u8fdb\u884c\u8fdb\u884c\u4e86\u8be6\u7ec6\u4ecb\u7ecd\u3002\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u5206\u4eab\u4e86\u57fa\u4e8e Apache APISIX \u6211\u4eec\u89e3\u51b3\u4e86\u54ea\u4e9b\u5b9e\u9645\u751f\u4ea7\u95ee\u9898\uff0c\u505a\u4e86\u54ea\u4e9b\u65b9\u6848\u53ca\u5f00\u53d1\u5de5\u4f5c\uff0c\u6700\u540e\u5bf9\u6211\u4eec\u672a\u6765\u7684\u6f14\u8fdb\u505a\u4e86\u4e00\u4e9b\u89c4\u5212\u8bf4\u660e\u3002\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n![\u9648\u7131\u5c71](https://static.apiseven.com/202108/1639465900639-ce850138-e0f5-4264-a902-be8ca94b93c0.png)\\n\\n\u9648\u7131\u5c71 \u2014  \u6bd5\u4e1a\u540e\u4e00\u76f4\u4ece\u4e8b\u5206\u5e03\u5f0f\u5b58\u50a8\u8f6f\u4ef6\u5f00\u53d1\u53ca\u67b6\u6784\u65b9\u6848\u8bbe\u8ba1\u5de5\u4f5c\uff0c\u6df1\u5ea6\u53c2\u4e0e\u4e86\u79fb\u52a8\u4e91\u5efa\u8bbe\u8fc7\u7a0b\uff0c\u91cd\u70b9\u5b8c\u6210\u4e86\u5bf9\u8c61\u5b58\u50a8\u76f8\u5173\u7684\u4e3b\u8981\u6280\u672f\u65b9\u6848\u9009\u578b\u53ca\u843d\u5730\u5f00\u53d1\u5efa\u8bbe\u5de5\u4f5c\u3002\u540c\u65f6\uff0c\u5728\u5206\u5e03\u5f0f\u5bf9\u8c61\u5b58\u50a8\u9886\u57df\u62e5\u6709\u4e30\u5bcc\u7684\u5b9e\u6218\u7ecf\u9a8c\uff0c\u76ee\u524d\u6b63\u5728\u601d\u8003\u57fa\u4e8e APISIX \u4e03\u5c42\u7f51\u5173\u5b9e\u73b0\u5bf9\u8c61\u5b58\u50a8\u6d41\u91cf\u6cbb\u7406\u5de5\u4f5c\uff0c\u5b9e\u73b0\u67b6\u6784\u8fdb\u4e00\u6b65\u5347\u7ea7\u3002\\n\\n### \u5206\u4eab\u65f6\u95f4\\n\\n2021-08-07 15:30 GMT+8\\n\\n## \u4f7f\u7528 Apache APISIX \u5b9e\u73b0\u9650\u6d41\u9650\u901f\\n\\n### \u8bae\u9898\u7b80\u4ecb\\n\\n\u8c08\u5230\u9650\u6d41\u9650\u901f\uff0c\u4eba\u4eec\u5f80\u5f80\u6700\u5148\u60f3\u5230\u7684\u662f Nginx\u3002\u7136\u800c Nginx \u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u5f0f\u5b9e\u73b0\uff0c\u6bcf\u6b21\u53d8\u66f4\u90fd\u9700\u8981 reload\uff0c\u8fd9\u8ba9\u8fd0\u7ef4\u5de5\u4f5c\u6781\u5176\u7e41\u6742\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u9650\u901f\u7684\u6761\u4ef6\u88ab\u9650\u5236\u5728 Nginx \u7684\u53d8\u91cf\u8303\u56f4\u5185\uff0c\u4f7f\u5f97 Nginx \u96be\u4ee5\u5b9e\u73b0\u4e1a\u52a1\u4e0a\u7cbe\u7ec6\u5316\u7684\u9650\u6d41\u9650\u901f\u9700\u6c42\u3002\\n\\n\u672c\u6b21\u5206\u4eab\u5c06\u5e26\u6765\u5982\u4f55\u4f7f\u7528 Apache APISIX \u6765\u5b9e\u73b0\u52a8\u6001\u3001\u7cbe\u7ec6\u5316\u3001\u5206\u5e03\u5f0f\u7684\u9650\u6d41\u9650\u901f\uff0c\u4ee5\u53ca\u5982\u4f55\u901a\u8fc7\u63d2\u4ef6\u7f16\u6392\u6765\u5b9e\u73b0\u66f4\u7b26\u5408\u4e1a\u52a1\u9700\u6c42\u7684\u9650\u6d41\u9650\u901f\u3002\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n![\u9648\u519b\u65ed](https://static.apiseven.com/202108/1639465952917-9089d8e8-4509-4d14-91d9-84b587cb5e7d.png)\\n\\n\u9648\u519b\u65ed \u2014  \u4e92\u8054\u7f51\u8001\u5175\uff0c\u66fe\u4efb\u804c\u4e8e\u65b0\u6d6a\u3001\u8fc5\u96f7\u3001360 \u7b49\u77e5\u540d\u4e92\u8054\u7f51\u516c\u53f8\uff0cApache APISIX Committer\u3002\\n\\n### \u5206\u4eab\u65f6\u95f4\\n\\n2021-08-06 13:30 GMT+8\\n\\n## \u7528\u6df7\u6c8c\u7f51\u6d4b\u8bd5 Apache APISIX \u7684\u6062\u590d\u80fd\u529b\\n\\n### \u8bae\u9898\u7b80\u4ecb\\n\\nApache APISIX \u662f\u9886\u5148\u7684 API \u7f51\u5173 OSS \u4e4b\u4e00\u3002\u4e3a\u4e86\u786e\u4fdd\u4e00\u5207\u6309\u8ba1\u5212\u8fdb\u884c\uff0cAPISIX \u4f7f\u7528\u4e86\u4e0d\u540c\u79cd\u7c7b\u7684\u6d4b\u8bd5\uff0c\u5305\u62ec\u5355\u5143\u3001e2e \u548c\u6a21\u7cca\u6d4b\u8bd5\u3002\u7136\u800c\uff0c\u6211\u4eec\u4ecd\u7136\u4e0d\u786e\u5b9a\uff0c\u5f53\u4e00\u4e9b\u4e0d\u6b63\u5e38\u4f46\u4e0d\u53ef\u907f\u514d\u7684\u60c5\u51b5\u53d1\u751f\u65f6\uff0c\u4f8b\u5982\u7f51\u7edc\u6545\u969c\u3001IO \u538b\u529b\u6216 pod \u6545\u969c\uff0cAPISIX \u4f1a\u5982\u4f55\u8868\u73b0\u3002\\n\\n\u56e0\u6b64\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 Chaos Mesh\uff0c\u4e00\u4e2a\u57fa\u4e8e Kubernetes \u7684\u6df7\u6c8c\u5de5\u7a0b\u5e73\u53f0\uff0c\u53ef\u4ee5\u987a\u5229\u5730\u6ce8\u5165\u4e0d\u540c\u79cd\u7c7b\u7684\u6df7\u6c8c\uff0c\u5e76\u5c06\u5176\u6574\u5408\u5230\u6211\u4eec\u7684 CI \u7ba1\u9053\u4e2d\u3002\u5728\u8fd9\u4e2a\u8bb2\u5ea7\u7684\u6700\u540e\uff0c\u542c\u4f17\u4f1a\u4e86\u89e3\u5230\u6df7\u6c8c\u5de5\u7a0b\u4f1a\u5728\u54ea\u4e9b\u65b9\u9762\u7ed9 API \u7f51\u5173\u5e26\u6765\u597d\u5904\uff0c\u4ee5\u53ca\u5982\u4f55\u5c06\u6df7\u6c8c\u7f51\u6574\u5408\u5230\u4f60\u81ea\u5df1\u7684\u6d4b\u8bd5\u7ba1\u9053\u4e2d\u3002\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n![\u5434\u8212\u65f8](https://static.apiseven.com/202108/1639466011014-75736153-f109-4318-a693-38e3bb59cbdd.png)\\n\\n\u5434\u8212\u65f8 \u2014 Apache APISIX \u548c Chaos Mesh \u7684 Committer\uff0c\u4ed6\u9886\u5bfc\u4e86 Chaos Mesh \u4e0e Apache APISIX CI \u7684\u6574\u5408\u5de5\u4f5c\u3002\\n\\n### \u5206\u4eab\u65f6\u95f4\\n\\n2021-08-06 14:50 GMT+8\\n\\n## \u4f7f\u7528 Apache APISIX \u8fdb\u884c\u8ba4\u8bc1\u548c\u6388\u6743\\n\\n### \u8bae\u9898\u7b80\u4ecb\\n\\n\u8ba4\u8bc1\u548c\u6388\u6743\u662f API \u7f51\u5173\u4e2d\u975e\u5e38\u5fc5\u8981\u7684\u529f\u80fd\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4f4d\u4e8e\u7f51\u5173\u540e\u9762\u7684\u670d\u52a1\u5c31\u53ef\u4ee5\u5f97\u5230\u4fdd\u62a4\uff0c\u907f\u514d\u672a\u7ecf\u6388\u6743\u6216\u6076\u610f\u7684\u8bbf\u95ee\u3001\u6570\u636e\u6cc4\u9732\u548c\u9ed1\u5ba2\u653b\u51fb\u3002Apache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684 API \u7f51\u5173\u3002\u800c\u4e14\u5b83\u63d0\u4f9b\u4e86\u8bb8\u591a\u63d2\u4ef6\uff0c\u5305\u62ec\u50cf key-auth\u3001Open-ID\u3001wolf-RBAC \u7b49\u8ba4\u8bc1\u548c\u6388\u6743\u3002\u672c\u63d0\u6848\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 Apache APISIX \u6765\u8fdb\u884c\u8ba4\u8bc1\u548c\u6388\u6743\u3002\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n![\u6731\u6b23\u6b23](https://static.apiseven.com/202108/1639466066729-9b4d07e2-47f3-4725-99d5-5266864e1c73.png)\\n\\n\u6731\u6b23\u6b23 \u2014 Apache APISIX Committer\uff0c\u6709\u591a\u5e74 CDN \u5de5\u4f5c\u7ecf\u9a8c\uff0c\u719f\u6089\u7f51\u5173\u3002\\n\\n### \u5206\u4eab\u65f6\u95f4\\n\\n2021-08-06 15:30 GMT+8\\n\\n## \u4f9d\u6258\u793e\u533a\u8ba9 Apache APISIX \u9ad8\u901f\u53d1\u5c55\\n\\n### \u8bae\u9898\u7b80\u4ecb\\n\\n\u5728\u8fc7\u53bb\u7684\u4e00\u5e74\u91cc\uff0cApache APISIX \u5df2\u7ecf\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684 API \u7f51\u5173\u9879\u76ee\uff0c\u9664\u4e86\u81ea\u8eab\u6280\u672f\u5148\u8fdb\u5916\uff0c\u66f4\u5f97\u76ca\u4e8e\u793e\u533a\u7684\u9ad8\u5ea6\u6d3b\u8dc3\u3002\u622a\u6b62\u76ee\u524d\uff0c\u5df2\u7ecf\u6709\u6765\u81ea\u4e16\u754c\u5404\u5730 225 \u4f4d\u8d21\u732e\u8005\u53c2\u4e0e\u8d21\u732e\uff0c\u5e76\u4e14\u8fd8\u5728\u4fdd\u6301\u9ad8\u901f\u589e\u957f\u3002\u672c\u6b21\u5206\u4eab\u4f1a\u4ecb\u7ecd APISIX \u5728\u8df5\u884c\u201c\u793e\u533a\u91cd\u4e8e\u4ee3\u7801\u201d\u8fc7\u7a0b\u7684\u4e00\u4e9b\u5fc3\u5f97\u3002\u4f5c\u4e3a\u4e00\u4e2a\u7406\u60f3\u4e3b\u4e49\u521b\u4e1a\u8005\uff0c\u53c8\u662f\u5982\u4f55\u4e0e Apache \u6587\u5316\u7ed3\u5408\uff0c\u8ba9\u521b\u4e1a\u516c\u53f8\u4e5f\u80fd\u9ad8\u901f\u53d1\u5c55\u3002\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n![\u738b\u9662\u751f](https://static.apiseven.com/202108/1639466127487-bc14552c-5326-43f6-8753-c0df363c3922.png)\\n\\n\u738b\u9662\u751f \u2014 \u5f00\u6e90\u7231\u597d\u8005 Apache APISIX \u521b\u59cb\u4eba\u548c PMC \u6210\u5458\u3002\\n\\n### \u5206\u4eab\u65f6\u95f4\\n\\n2021-08-06 16:10 GMT+8\\n\\n## \u5982\u4f55\u5c06 Apache APISIX \u6269\u5c55\u4e3a\u4e00\u4e2a\u670d\u52a1\u7f51\u683c\u7684\u8fb9\u8f66\\n\\n### \u8bae\u9898\u7b80\u4ecb\\n\\n\u5728\u8fd9\u4e2a\u8bae\u9898\u4e2d\u5c06\u4ecb\u7ecd apisix-mesh-agent \u9879\u76ee\uff0c\u5b83\u6709\u4e00\u4e9b\u80fd\u529b\u5c06 Apache APISIX \u6269\u5c55\u4e3a\u670d\u52a1\u7f51\u683c\u573a\u666f\u4e2d\u7684\u8fb9\u8f66\u7a0b\u5e8f\uff0c\u66f4\u91cd\u8981\u7684\u662f\uff0c\u5b83\u4f7f\u7528 xDS \u534f\u8bae\u4ece Istio\u3001Kuma \u7b49\u63a7\u5236\u5e73\u9762\u83b7\u53d6\u914d\u7f6e\u3002\u4e4b\u540e\uff0c\u6211\u5c06\u4ecb\u7ecd\u5173\u4e8e\u5728\u670d\u52a1\u7f51\u4e2d\u4f7f\u7528 Apache APISIX \u7684\u672a\u6765\u8ba1\u5212\u548c\u671f\u671b\u3002\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n![\u5f20\u8d85](https://static.apiseven.com/202108/1639466178896-23fb5c6e-ccb1-46e0-ac02-55fef1b3bedf.png)\\n\\n\u5f20\u8d85 \u2014 Apache APISIX PMC\uff0cOpenResty \u8d21\u732e\u8005\uff0c\u5f00\u6e90\u7231\u597d\u8005\uff0c\u73b0\u5728\u6b63\u5728\u7814\u7a76 Service Mesh\u3001Kubernetes \u548c API Gateway\u3002\\n\\n### \u5206\u4eab\u65f6\u95f4\\n\\n2021-08-07 13:30 GMT+8\\n\\n## Apache APISIX \u7684\u6f14\u53d8\\n\\n### \u8bae\u9898\u7b80\u4ecb\\n\\nApache APISIX \u662f\u6700\u53d7\u6b22\u8fce\u7684 API \u7f51\u5173\u4e4b\u4e00\uff1ahttps://github.com/apache/apisix\uff0c\u6211\u5c06\u4ecb\u7ecd\u4e00\u4e0b Apache APISIX \u7684\u53d1\u5c55\uff0c\u5305\u62ec\uff1a\\n\\n1. \u6211\u4eec\u6240\u505a\u7684\u597d\u51b3\u5b9a\\n2. \u6211\u4eec\u6240\u505a\u7684\u4e0d\u597d\u7684\u51b3\u5b9a\\n3. \u6211\u4eec\u7684\u672a\u6765\u8ba1\u5212\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n![\u7f57\u6cfd\u8f69](https://static.apiseven.com/202108/1639466430768-b416eea2-e8e3-4a50-91b9-2d6b05aead10.png)\\n\\n\u7f57\u6cfd\u8f69 \u2014  Apache APISIX PMC\uff0cOpenResty \u5f00\u53d1\u8005\u3002\\n\\n### \u5206\u4eab\u65f6\u95f4\\n\\n2021-08-07 14:10 GMT+8\\n\\n## \u57fa\u4e8e Apache APISIX \u7684 KUBERNETES INGRESS \u7684\u5b9e\u73b0\\n\\n### \u8bae\u9898\u7b80\u4ecb\\n\\n\u4ecb\u7ecd\u57fa\u4e8e Apache APISIX \u7684 Kubernetes Ingress \u7684\u4f18\u52bf\u4ee5\u53ca Apache APISIX Ingress \u7684\u7279\u70b9\u3002\\n\\n### \u5206\u4eab\u5609\u5bbe\\n\\n![\u91d1\u536b](https://static.apiseven.com/202108/1639466497596-7e4b91a9-2367-457a-ad33-0c5db7b87c24.png)\\n\\n\u91d1\u536b  \u2014 Apache APISIX PMC\uff0cApache apisix-ingress-controller Founder\uff0cApache Skywalking Committer\u3002\\n\\n### \u5206\u4eab\u65f6\u95f4\\n\\n2021-08-07 14:50 GMT+8"},{"id":"2021/07/21/apache-apisix-kubernetes","metadata":{"permalink":"/zh/blog/2021/07/21/apache-apisix-kubernetes","source":"@site/blog/2021/07/21/Apache-APISIX-Kubernetes.md","title":"\u76f4\u64ad\u9884\u544a\uff5cApache APISIX x Kubernetes","description":"\u5317\u4eac\u65f6\u95f4 2021 \u5e74 7 \u6708 23 \u65e5\u661f\u671f\u4e94 00:00\uff0cApache APISIX committer \u5f20\u664b\u6d9b\u5c06\u5728 Data on Kubernetes Community \u7684 Meetup \u4e0a\uff0c\u9762\u5411\u5168\u7403\u5f00\u53d1\u8005\u5206\u4eab\u300aRun Apache APISIX in Kubernetes\u300b\u3002","date":"2021-07-21T00:00:00.000Z","formattedDate":"2021\u5e747\u670821\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.97,"truncated":true,"authors":[{"name":"Apache APISIX \u793e\u533a"}],"prevItem":{"title":"ApacheCon Asia 2021\uff1aApache APISIX \u6280\u672f\u8bae\u9898\u4e00\u89c8","permalink":"/zh/blog/2021/07/25/apachecon-asia"},"nextItem":{"title":"\u57fa\u4e8e Apache APISIX\uff0c\u65b0\u6d6a\u5fae\u535a API \u7f51\u5173\u7684\u5b9a\u5236\u5316\u5f00\u53d1\u4e4b\u8def","permalink":"/zh/blog/2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix"}},"content":"> \u5317\u4eac\u65f6\u95f4 2021 \u5e74 7 \u6708 23 \u65e5\u661f\u671f\u4e94 00:00\uff0c Apache APISIX committer \u5f20\u664b\u6d9b\u5c06\u5728 Data on Kubernetes Community \u7684 Meetup \u4e0a\uff0c\u9762\u5411\u5168\u7403\u5f00\u53d1\u8005\u505a\u4e3b\u9898\u4e3a\u300aRun Apache APISIX in Kubernetes\u300b\u7684\u5206\u4eab\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u5f20\u664b\u6d9b\u5c06\u5728\u672c\u6b21\u6f14\u8bb2\u4e2d\u5206\u4eab\u5728 Kubernetes \u4e0a\u8fd0\u884c Apache APISIX\uff0c\u4ee5\u53ca\u5982\u4f55\u5c06 Apache APISIX \u4f5c\u4e3a Ingress Controller \u6765\u4f7f\u7528\u7684\u7ecf\u9a8c\u3002\u611f\u5174\u8da3\u7684\u5c0f\u4f19\u4f34\u4e0d\u8981\u9519\u8fc7\uff0c\u8d76\u7d27\u62a5\u540d\u7ea6\u8d77\u6765~\\n\\n## \u53c2\u4e0e\u65b9\u5f0f\\n\\n- \u65b9\u5f0f\u4e00\uff1a\u70b9\u51fb [\u6b64\u5904](https://www.meetup.com/Data-on-Kubernetes-community/events/278922486/) \u8df3\u8f6c\u62a5\u540d\u7f51\u9875\uff0c\u6ce8\u518c\u62a5\u540d\u3002\\n\\n- \u65b9\u5f0f\u4e8c\uff1a\u5728\u76f4\u64ad\u5f00\u59cb\u65f6\u901a\u8fc7 Zoom \u94fe\u63a5\u8fdb\u5165\u4f1a\u8bae\u5ba4\u8046\u542c\u5206\u4eab\uff1a[\u4f1a\u8bae\u5ba4\u76f4\u64ad\u95f4](https://zoom.us/webinar/tJYofuChrzktGtI3wr8SZHACRnNkxr5cWgny)\u3002\\n\\n## \u6765\u4e0d\u53ca\u770b\u76f4\u64ad\u600e\u4e48\u529e\\n\\nMeetup \u7ed3\u675f\u540e\uff0c\u6211\u4eec\u4f1a\u5728 Apache APISIX \u7684 bilibili \u8d26\u53f7\u4e0a\u4f20 Meetup \u5f55\u64ad\u3002\u6b22\u8fce\u5927\u5bb6\u5173\u6ce8 Apache APISIX bilibili \u8d26\u53f7 [Apache-APISIX](https://space.bilibili.com/551921247)\u3002\\n\\n## \u8bb2\u5e08\u4ecb\u7ecd\\n\\n\u5f20\u664b\u6d9b\uff0c[\u652f\u6d41\u79d1\u6280](https://api7.ai/)\u4e91\u539f\u751f\u6280\u672f\u4e13\u5bb6\u3001Apache APISIX committer\u3001Kubernetes ingress-nginx reviewer\u3002\u4ed6\u540c\u65f6\u4f5c\u4e3a containerd/Docker/Helm/Kubernetes/KIND \u7b49\u4f17\u591a\u5f00\u6e90\u9879\u76ee contributor \u5728\u5f00\u6e90\u793e\u533a\u6d3b\u8dc3\uff0c\u662f \u300eK8S \u751f\u6001\u5468\u62a5\u300f\u7684\u7ef4\u62a4\u8005\u4e4b\u4e00\u3002\\n\u4ece\u4e1a 7 \u5e74\uff0c\u5f20\u664b\u6d9b\u5bf9 Docker \u548c Kubernetes \u7b49\u5bb9\u5668\u5316\u6280\u672f\u6709\u5927\u91cf\u5b9e\u8df5\u548c\u6df1\u5165\u6e90\u7801\u7684\u7814\u7a76\uff0c\u662f\u4e1a\u5185\u591a\u4e2a\u77e5\u540d\u5927\u4f1a\u8bb2\u5e08\uff0cPyCon China \u6838\u5fc3\u7ec4\u7ec7\u8005\u4e4b\u4e00\u3002\u540c\u65f6\u8457\u6709 \u300aKubernetes \u4e0a\u624b\u5b9e\u8df5\u300b\u548c \u300aDocker \u6838\u5fc3\u77e5\u8bc6\u5fc5\u77e5\u5fc5\u4f1a\u300b\u7b49\u4e13\u680f\u3002\u8fd0\u8425\u6709\u516c\u4f17\u53f7\uff1aMoeLove\u3002\\n\\n![\u8bb2\u5e08\u4ecb\u7ecd-\u5f20\u664b\u6d9b](https://static.apiseven.com/202108/1630382172445-cf20986b-c939-497e-86a4-92da7064ae97.PNG)\\n\\n## \u5173\u4e8e Apache APISIX\\n\\nApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u5f00\u6e90 API \u7f51\u5173\uff0c\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u53ef\u89c2\u6d4b\u6027\u7b49\u4e30\u5bcc\u7684\u6d41\u91cf\u7ba1\u7406\u529f\u80fd\u3002Apache APISIX \u53ef\u4ee5\u5e2e\u5fd9\u4f01\u4e1a\u5feb\u901f\u3001\u5b89\u5168\u7684\u5904\u7406 API \u548c\u5fae\u670d\u52a1\u6d41\u91cf\uff0c\u5305\u62ec\u7f51\u5173\u3001Kubernetes Ingress \u548c\u670d\u52a1\u7f51\u683c\u7b49\u3002\\n\\n\u5168\u7403\u5df2\u6709\u6570\u767e\u5bb6\u4f01\u4e1a\u4f7f\u7528 Apache APISIX \u5904\u7406\u5173\u952e\u4e1a\u52a1\u6d41\u91cf\uff0c\u6db5\u76d6\u91d1\u878d\u3001\u4e92\u8054\u7f51\u3001\u5236\u9020\u3001\u96f6\u552e\u3001\u8fd0\u8425\u5546\u7b49\u7b49\uff0c\u6bd4\u5982\u7f8e\u56fd\u822a\u7a7a\u822a\u5929\u5c40\uff08NASA\uff09\u3001\u6b27\u76df\u7684\u6570\u5b57\u5de5\u5382\u3001\u4e2d\u56fd\u822a\u4fe1\u3001\u4e2d\u56fd\u79fb\u52a8\u3001\u817e\u8baf\u3001\u534e\u4e3a\u3001\u5fae\u535a\u3001\u7f51\u6613\u3001\u8d1d\u58f3\u627e\u623f\u3001360\u3001\u6cf0\u5eb7\u3001\u5948\u96ea\u7684\u8336\u7b49\u3002\\n\\n200 \u4f59\u4f4d\u8d21\u732e\u8005\uff0c\u4e00\u540c\u7f14\u9020\u4e86 Apache APISIX \u8fd9\u4e2a\u4e16\u754c\u4e0a\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u3002\u806a\u660e\u7684\u5f00\u53d1\u8005\u4eec\uff01\u5feb\u6765\u52a0\u5165\u8fd9\u4e2a\u6d3b\u8dc3\u800c\u591a\u6837\u5316\u7684\u793e\u533a\uff0c\u4e00\u8d77\u6765\u7ed9\u8fd9\u4e2a\u4e16\u754c\u5e26\u6765\u66f4\u591a\u7f8e\u597d\u7684\u4e1c\u897f\u5427\uff01\\n\\n[Apache APISIX GitHub \u9879\u76ee\u5730\u5740](https://github.com/apache/apisix)"},{"id":"2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix","metadata":{"permalink":"/zh/blog/2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix","source":"@site/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX.md","title":"\u57fa\u4e8e Apache APISIX\uff0c\u65b0\u6d6a\u5fae\u535a API \u7f51\u5173\u7684\u5b9a\u5236\u5316\u5f00\u53d1\u4e4b\u8def","description":"\u672c\u6587\u5206\u6790\u4e86 NGINX \u65b0\u6d6a\u5fae\u535a\u4f7f\u7528 NGINX \u65f6\u7684\u75db\u70b9\u548c\u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX \u4f5c\u4e3a\u516c\u53f8\u7684 API \u7f51\u5173\uff0c\u4ee5\u53ca\u5bf9 Apache APISIX \u8fdb\u884c\u4e86\u54ea\u4e9b\u4e8c\u6b21\u5f00\u53d1\u3002","date":"2021-07-14T00:00:00.000Z","formattedDate":"2021\u5e747\u670814\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":18.43,"truncated":true,"authors":[{"name":"\u8042\u6c38"}],"prevItem":{"title":"\u76f4\u64ad\u9884\u544a\uff5cApache APISIX x Kubernetes","permalink":"/zh/blog/2021/07/21/apache-apisix-kubernetes"},"nextItem":{"title":"\u5dee\u4e4b\u6beb\u5398\uff1aetcd 3 \u5b8c\u7f8e\u652f\u6301 HTTP \u8bbf\u95ee\uff1f","permalink":"/zh/blog/2021/06/30/etcd3-support-http-access-perfectly"}},"content":"> \u65b0\u6d6a\u5fae\u535a\u4e4b\u524d\u7684 HTTP API \u7f51\u5173\u57fa\u4e8e NGINX \u642d\u5efa\uff0c\u6240\u6709\u8def\u7531\u89c4\u5219\u5b58\u653e\u5728 NGINX conf \u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5e26\u6765\u4e00\u7cfb\u5217\u95ee\u9898\uff1a\u5347\u7ea7\u6b65\u9aa4\u957f\uff0c\u5bf9\u670d\u52a1\u589e\u3001\u5220\u3001\u6539\u6216\u8ddf\u8e2a\u95ee\u9898\u65f6\uff0c\u4e0d\u591f\u7075\u6d3b\u4e14\u96be\u4ee5\u6392\u67e5\u95ee\u9898\u3002\u7ecf\u8fc7\u4e00\u756a\u8c03\u7814\u4e4b\u540e\uff0c\u6211\u4eec\u9009\u62e9\u4e86\u6700\u63a5\u8fd1\u9884\u671f\u3001\u57fa\u4e8e\u4e91\u539f\u751f\u7684\u5fae\u670d\u52a1 API \u7f51\u5173\uff1aApache APISIX\uff0c\u501f\u52a9\u5176\u52a8\u6001\u3001\u9ad8\u6548\u3001\u7a33\u5b9a\u7b49\u7279\u6027\u4ee5\u6ee1\u8db3\u4e1a\u52a1\u7684\u5feb\u901f\u54cd\u5e94\u8981\u6c42\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u5fae\u535a\u4e4b\u524d\u7684 HTTP API \u7f51\u5173\u57fa\u4e8e NGINX \u642d\u5efa\uff0c\u6240\u6709\u8def\u7531\u89c4\u5219\u5b58\u653e\u5728 NGINX conf \u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5e26\u6765\u4e00\u7cfb\u5217\u95ee\u9898\uff1a\u5347\u7ea7\u6b65\u9aa4\u957f\uff0c\u5bf9\u670d\u52a1\u589e\u3001\u5220\u3001\u6539\u6216\u8ddf\u8e2a\u95ee\u9898\u65f6\uff0c\u4e0d\u591f\u7075\u6d3b\u4e14\u96be\u4ee5\u6392\u67e5\u95ee\u9898\u3002\u7ecf\u8fc7\u4e00\u756a\u8c03\u7814\u4e4b\u540e\uff0c\u6211\u4eec\u9009\u62e9\u4e86\u6700\u63a5\u8fd1\u9884\u671f\u3001\u57fa\u4e8e\u4e91\u539f\u751f\u7684\u5fae\u670d\u52a1 API \u7f51\u5173\uff1aApache APISIX\uff0c\u501f\u52a9\u5176\u52a8\u6001\u3001\u9ad8\u6548\u3001\u7a33\u5b9a\u7b49\u7279\u6027\u4ee5\u6ee1\u8db3\u4e1a\u52a1\u7684\u5feb\u901f\u54cd\u5e94\u8981\u6c42\u3002\\n\\n## 1 \u80cc\u666f\u8bf4\u660e\\n\\n\u5728\u5fae\u535a\uff0c\u8fd0\u7ef4\u540c\u5b66\u8981\u521b\u5efa\u4e00\u4e2a API \u670d\u52a1\uff0c\u4ed6\u9700\u8981\u5148\u5728 nginx conf \u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5199\u597d\uff0c\u63d0\u4ea4\u5230 git \u4ee3\u7801\u4ed3\u5e93\u91cc\u9762\u53bb\uff0c\u7b49\u5176\u5b83\u8d1f\u8d23\u4e0a\u7ebf\u7684\u8fd0\u7ef4\u540c\u5b66 CheckOut \u4e4b\u540e\uff0c\u786e\u8ba4\u5ba1\u6838\u6210\u529f\uff0c\u624d\u80fd\u5b83\u4eec\u63a8\u9001\u90e8\u7f72\u5230\u7ebf\u4e0a\u53bb\uff0c\u7ee7\u800c\u7c97\u66b4\u901a\u77e5 NGINX \u91cd\u65b0\u52a0\u8f7d\uff0c\u8fd9\u624d\u7b97\u670d\u52a1\u53d8\u66f4\u6210\u529f\u3002\\n\\n\u6574\u4e2a\u5904\u7406\u6d41\u7a0b\u8f83\u957f\uff0c\u6548\u7387\u8f83\u4f4e\uff0c\u65e0\u6cd5\u6ee1\u8db3\u4f4e\u4ee3\u7801\u5316\u7684 DevOps \u8fd0\u7ef4\u8d8b\u52bf\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u671f\u5f85\u6709\u4e00\u4e2a\u7ba1\u7406\u540e\u53f0\u5165\u53e3\uff0c\u8fd0\u7ef4\u540c\u5b66\u5728 UI \u754c\u9762\u4e0a\u5c31\u53ef\u4ee5\u64cd\u4f5c\u6240\u6709\u7684 http api \u8def\u7531\u7b49\u914d\u7f6e\u3002\\n\\n![xinlang1](https://user-images.githubusercontent.com/23514812/125594900-d4c01fb7-3af4-4e8c-8779-f3f16b7f0bca.png)\\n\\n\u7ecf\u8fc7\u4e00\u756a\u8c03\u7814\u4e4b\u540e\uff0c\u6211\u4eec\u9009\u62e9\u4e86\u6700\u63a5\u8fd1\u671f\u76fc\u7684\u57fa\u4e8e\u4e91\u539f\u751f\u7684\u5fae\u670d\u52a1 API \u7f51\u5173\uff1aApache APISIX\u3002\u6bd4\u8f83\u770b\u91cd\u7684\u70b9\uff0c\u6709\u8fd9\u4e48\u51e0\u4e2a\uff1a\\n\\n1. \u57fa\u4e8e NGINX \uff0c\u6280\u672f\u6808\u524d\u540e\u7edf\u4e00\uff0c\u540e\u671f\u7070\u5ea6\u5347\u7ea7\u3001\u5b89\u5168\u3001\u7a33\u5b9a\u6027\u7b49\u6709\u4fdd\u969c\uff1b\\n2. \u5185\u7f6e\u7edf\u4e00\u63a7\u5236\u9762\uff0c\u591a\u53f0\u4ee3\u7406\u670d\u52a1\u7edf\u4e00\u7ba1\u7406\uff1b\\n3. \u52a8\u6001 API \u8c03\u7528\uff0c\u5373\u53ef\u5b8c\u6210\u5e38\u89c1\u8d44\u6e90\u7684\u4fee\u6539\u5b9e\u65f6\u751f\u6548\uff0c\u76f8\u6bd4\u4f20\u7edf NGINX \u914d\u7f6e + reload \u65b9\u5f0f\u8fdb\u6b65\u660e\u663e\uff1b\\n4. \u8def\u7531\u9009\u9879\u4e30\u5bcc\uff0c\u6ee1\u8db3\u5fae\u535a\u8def\u7531\u9700\u6c42\uff1b\\n5. \u8f83\u597d\u6269\u5c55\u6027\uff0c\u652f\u6301 Consul kv \u96be\u5ea6\u4e0d\u5927\uff1b\\n6. \u6027\u80fd\u8868\u73b0\u4e5f\u4e0d\u9519\u3002\\n\\n![xinlang2](https://user-images.githubusercontent.com/23514812/125596483-aee21ac7-a902-4e44-abc4-8bfda4f51f82.png)\\n\\n## 2 \u4e3a\u4ec0\u4e48\u9009\u62e9\u5b9a\u5236\u5316\u5f00\u53d1\\n\\n\u5b9e\u9645\u4e1a\u52a1\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u662f\u6ca1\u529e\u6cd5\u76f4\u63a5\u4f7f\u7528 Apache APISIX \u7684\uff0c\u539f\u56e0\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a\\n\\n1. Apache APISIX \u4e0d\u652f\u6301 SaaS \u591a\u79df\u6237\uff0c\u5b9e\u9645\u9700\u8981\u8fd0\u7ef4\u7684\u4e1a\u52a1\u7ebf\u4e0a\u5c42\u5e94\u7528\u6709\u5f88\u591a\uff0c\u6bcf\u4e2a\u4e1a\u52a1\u7ebf\u7684\u5f00\u53d1\u6216\u8fd0\u7ef4\u540c\u5b66\u53ea\u9700\u8981\u7ba1\u7406\u7ef4\u62a4\u81ea\u5df1\u7684\u5404\u79cd rules\u3001upstreams \u7b49\u89c4\u5219\uff0c\u5f7c\u6b64\u4e4b\u95f4\u4e0d\u76f8\u5173\u8054\uff1b\\n2. \u5f53\u628a\u8def\u7531\u89c4\u5219\u53d1\u5e03\u5230\u7ebf\u4e0a\u540e\uff0c\u5982\u679c\u51fa\u73b0\u95ee\u9898\u5219\u9700\u8981\u5feb\u901f\u7684\u56de\u6eda\u652f\u6301\uff1b\\n3. \u5f53\u65b0\u5efa\u6216\u8005\u7f16\u8f91\u73b0\u6709\u7684\u8def\u7531\u89c4\u5219\u65f6\uff0c\u6211\u4eec\u4e0d\u592a\u653e\u5fc3\u76f4\u63a5\u53d1\u5e03\u5230\u7ebf\u4e0a\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u5b83\u80fd\u591f\u652f\u6301\u7070\u5ea6\u53d1\u5e03\u5230\u6307\u5b9a\u7f51\u5173\u5b9e\u4f8b\u4e0a\uff0c\u7528\u4e8e\u4eff\u771f\u6216\u5c40\u90e8\u6d4b\u8bd5\uff1b\\n4. \u9700\u8981 API \u7f51\u5173\u80fd\u591f\u652f\u6301 Consul KV \u65b9\u5f0f\u7684\u670d\u52a1\u6ce8\u518c\u548c\u53d1\u73b0\u673a\u5236\uff1b\\n\\n\u4e0a\u8ff0\u8fd9\u4e9b\u9700\u6c42\u76ee\u524d Apache APISIX \u90fd\u6ca1\u6709\u5185\u7f6e\u652f\u6301\uff0c\u6240\u4ee5\u53ea\u80fd\u901a\u8fc7\u5b9a\u5236\u5f00\u53d1\u624d\u80fd\u8ba9 Apache APISIX \u771f\u6b63\u5728\u5fae\u535a\u5185\u90e8\u4f7f\u7528\u8d77\u6765\u3002\\n\\n## 3 \u5728 Apache APISIX \u7684\u63a7\u5236\u9762\uff0c\u6211\u4eec\u6539\u4e86\u4e9b\u4ec0\u4e48\\n\\n\u6211\u4eec\u5b9a\u5236\u5f00\u53d1\u65f6\uff0c\u4f7f\u7528\u7684 Apache APISIX 1.5 \u7248\u672c\uff0cDashboard \u4e5f\u662f\u548c 1.5 \u76f8\u5339\u914d\u7684\u3002\\n\\n\u5b9a\u5236\u5f00\u53d1\u7684\u76ee\u6807\u7b80\u5355\u6e05\u6670\uff0c\u5373\u5b8c\u5168\u96f6\u4ee3\u7801\u3001UI \u5316\uff0c\u6240\u6709\u4e03\u5c42 HTTP API \u670d\u52a1\u7684\u521b\u5efa\u3001\u7f16\u8f91\u3001\u66f4\u65b0\u3001\u4e0a\u4e0b\u7ebf\u7b49\u6240\u6709\u884c\u4e3a\u90fd\u5fc5\u987b\u5728 Dashboard \u4e0a\u9762\u5b8c\u6210\u3002\u56e0\u6b64\u5b9e\u9645\u73af\u5883\u4e0b\uff0c\u6211\u4eec\u7981\u6b62\u5f00\u53d1\u548c\u8fd0\u7ef4\u540c\u5b66\u76f4\u63a5\u8c03\u7528 APISIX Admin API\uff0c\u5047\u5982\u7565\u8fc7 Dashboard \u76f4\u63a5\u8c03\u7528 APISIX Admin API\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7f51\u5173\u64cd\u4f5c\u6ca1\u529e\u6cd5\u5728 UI \u5c42\u9762\u4e0a\u5ba1\u8ba1\uff0c\u65e0\u6cd5\u8d70\u5de5\u4f5c\u6d41\uff0c\u81ea\u7136\u4e5f\u5c31\u6ca1\u6709\u591a\u5c11\u5b89\u5168\u6027\u53ef\u8a00\u3002\\n\\n\u6709\u4e00\u79cd\u60c5\u51b5\u7a0d\u5fae\u7279\u6b8a\uff0c\u8fd0\u7ef4\u9700\u8981\u8c03\u7528 API \u5b8c\u6210\u670d\u52a1\u7684\u6279\u91cf\u5bfc\u5165\u7b49\uff0c\u53ef\u4ee5\u8c03\u7528 H5 Dashboard \u7684 API \u6765\u5b8c\u6210\uff0c\u4ece\u800c\u9075\u5b88\u7edf\u4e00\u7684\u5de5\u4f5c\u6d41\u3002\\n\\n### 3.1 \u652f\u6301 SaaS \u5316\u670d\u52a1\\n\\n\u4f01\u4e1a\u5c42\u9762\u6709\u5b8c\u6574\u7684\u4ea7\u54c1\u7ebf\u3001\u4e1a\u52a1\u7ebf\u6570\u636e\u5e93\uff0c\u6bcf\u4e00\u4e2a\u5177\u4f53\u4ea7\u54c1\u7ebf\u3001\u4e1a\u52a1\u7ebf\u53ef\u4f7f\u7528\u4e00\u4e2a saas_id \u503c\u8868\u793a\u3002\u7136\u540e\u5728\u521b\u5efa\u7f51\u5173\u914d\u7f6e\u6570\u636e\u63d2\u5165 ETCD \u4e4b\u524d\uff0c\u585e\u5165\u4e00\u4e2a saas_id \u503c\uff0c\u5728\u903b\u8f91\u5c5e\u6027\u4e0a\u6240\u6709\u7684\u6570\u636e\u4fbf\u6709\u4e86 SaaS \u5f52\u5c5e\u3002\\n\\n\u7528\u6237\u3001\u89d2\u8272\u548c\u5b9e\u9645\u64cd\u4f5c\u7684\u4ea7\u54c1\u7ebf\u5c31\u6709\u4e86\u5982\u4e0b\u5bf9\u5e94\u5173\u8054\uff1a\\n\\n![xinlang3](https://user-images.githubusercontent.com/23514812/125596630-15444f25-0bcb-4f2f-8fd2-7bef6faf6f4e.png)\\n\\n\u4e00\u4e2a\u7528\u6237\u53ef\u4ee5\u88ab\u5206\u6d3e\u627f\u62c5\u4e0d\u540c\u8fd0\u7ef4\u89d2\u8272\u53bb\u7ba1\u7406\u7ef4\u62a4\u4e0d\u540c\u7684\u4ea7\u54c1\u7ebf\u670d\u52a1\u3002\\n\\n\u7ba1\u7406\u5458\u89d2\u8272\u5f88\u597d\u7406\u89e3\uff0c\u64cd\u4f5c\u7ef4\u62a4\u670d\u52a1\u6838\u5fc3\u89d2\u8272\uff0c\u9488\u5bf9\u670d\u52a1\u589e / \u5220 / \u6539 / \u67e5\u7b49\uff1b\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u6709\u53ea\u8bfb\u7528\u6237\u7684\u6982\u5ff5\uff0c\u53ea\u8bfb\u7528\u6237\u4e00\u822c\u662f\u7528\u4e8e\u67e5\u770b\u670d\u52a1\u914d\u7f6e\u3001\u67e5\u770b\u5de5\u4f5c\u6d41\u3001\u8c03\u8bd5\u7b49\u7b49\u3002\\n\\n### 3.2 \u65b0\u589e\u8def\u7531\u53d1\u5e03\u5ba1\u6838\u5de5\u4f5c\u6d41\\n\\n![xinlang4](https://user-images.githubusercontent.com/23514812/125596773-6ebbb1f2-1287-418b-a5f0-1fc85c9e8e9f.png)\\n\\n\u5728\u5f00\u6e90\u7248\u672c\u4e2d\uff0c\u521b\u5efa\u6216\u4fee\u6539\u5b8c\u4e00\u4e2a\u8def\u7531\u4e4b\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u53d1\u5e03\u3002\\n\\n\u800c\u5728\u6211\u4eec\u7684\u5b9a\u5236\u7248\u672c\u4e2d\uff0c\u8def\u7531\u521b\u5efa\u6216\u4fee\u6539\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u7ecf\u8fc7\u5ba1\u6838\u5de5\u4f5c\u6d41\u5904\u7406\u4e4b\u540e\u624d\u80fd\u53d1\u5e03\uff0c\u5904\u7406\u6d41\u7a0b\u867d\u7136\u6709\u6240\u62c9\u957f\uff0c\u4f46\u6211\u4eec\u8ba4\u4e3a\u5728\u4f01\u4e1a\u5c42\u9762\u5ba1\u6838\u6388\u6743\u540e\u7684\u53d1\u5e03\u884c\u4e3a\u624d\u66f4\u53ef\u4fe1\u3002\\n\\n![xinlang5](https://user-images.githubusercontent.com/23514812/125596844-7e3f057e-1dc4-4c3e-8d91-2b2c3d8e780f.png)\\n\\n\u5728\u521b\u5efa\u8def\u7531\u89c4\u5219\u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5fc5\u987b\u8981\u7ecf\u8fc7\u5ba1\u6838\u3002\u4e3a\u4e86\u517c\u987e\u6548\u7387\uff0c\u65b0\u670d\u52a1\u5f55\u5165\u7684\u65f6\u5019\uff0c\u53ef\u9009\u62e9\u514d\u5ba1\u3001\u5feb\u901f\u53d1\u5e03\u901a\u9053\uff0c\u76f4\u63a5\u70b9\u51fb\u53d1\u5e03\u6309\u94ae\u3002\\n\\n![xinlang6](https://user-images.githubusercontent.com/23514812/125596916-e3a7c3e6-7201-4b37-89b5-bacbbb6f4a9d.png)\\n\\n\u5f53\u4e00\u4e2a\u91cd\u8981 API \u8def\u7531\u67d0\u6b21\u8c03\u6574\u89c4\u5219\u53d1\u5e03\u4e0a\u7ebf\u540e\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u8be5\u8def\u7531\u89c4\u5219\u4e0a\u4e00\u4e2a\u7248\u672c\u8fdb\u884c\u5feb\u901f\u56de\u6eda\uff0c\u7c92\u5ea6\u4e3a\u5355\u4e2a\u8def\u7531\u7684\u56de\u6eda\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u5176\u5b83\u8def\u7531\u89c4\u5219\u3002\\n\\n\u5355\u6761\u8def\u7531\u56de\u6eda\u5185\u90e8\u5904\u7406\u6d41\u7a0b\u5982\u4e0b\u56fe\u793a\u3002\\n\\n![xinlang7](https://user-images.githubusercontent.com/23514812/125596979-74aa252c-3a84-44e5-a62a-6d9e254de859.png)\\n\\n\u6211\u4eec\u9700\u8981\u4e3a\u5355\u4e2a\u8def\u7531\u7684\u6bcf\u6b21\u53d1\u5e03\u5efa\u7acb\u7248\u672c\u6570\u636e\u5e93\u5b58\u50a8\u3002\u8fd9\u6837\u6211\u4eec\u5728\u5ba1\u6838\u4e4b\u540e\u8fdb\u884c\u5168\u91cf\u53d1\u5e03\uff0c\u6bcf\u53d1\u5e03\u4e00\u6b21\u4f1a\u5c31\u4f1a\u4ea7\u751f\u4e00\u4e2a\u7248\u672c\u53f7\uff0c\u4ee5\u53ca\u5bf9\u5e94\u7684\u5b8c\u6574\u914d\u7f6e\u6570\u636e\uff1b\u7136\u540e\u7248\u672c\u5217\u8868\u8d8a\u79ef\u8d8a\u591a\u3002\u5f53\u6211\u4eec\u9700\u8981\u56de\u6eda\u7684\u65f6\u5019\u53bb\u7248\u672c\u5217\u8868\u91cc\u9762\u9009\u62e9\u4e00\u4e2a\u5bf9\u5e94\u7248\u672c\u56de\u6eda\u5373\u53ef\uff1b\u67d0\u79cd\u610f\u4e49\u4e0a\u6765\u8bb2\uff0c\u56de\u6eda\u5176\u5b9e\u662f\u4e00\u4e2a\u7279\u6b8a\u5f62\u5f0f\u7684\u5168\u91cf\u53d1\u5e03\u3002\\n\\n### 3.3 \u652f\u6301\u7070\u5ea6\u53d1\u5e03\\n\\n\u6211\u4eec\u5b9a\u5236\u5f00\u53d1\u7684\u7070\u5ea6\u53d1\u5e03\u529f\u80fd\u548c\u4e00\u822c\u793e\u533a\u7406\u89e3\u7684\u7070\u5ea6\u53d1\u5e03\u6709\u6240\u4e0d\u540c\uff0c\u76f8\u6bd4\u5168\u91cf\u90e8\u7f72\u7684\u98ce\u9669\u6709\u6240\u964d\u4f4e\u3002\u5f53\u67d0\u4e00\u4e2a\u8def\u7531\u89c4\u5219\u7684\u53d8\u66f4\u8f83\u5927\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u53ea\u5728\u7279\u5b9a\u6709\u9650\u6570\u91cf\u7684\u7f51\u5173\u5b9e\u4f8b\u4e0a\u53d1\u5e03\u5e76\u751f\u6548\uff0c\u800c\u4e0d\u662f\u5728\u6240\u6709\u7f51\u5173\u5b9e\u4f8b\u4e0a\u53d1\u5e03\u751f\u6548\uff0c\u4ece\u800c\u7f29\u5c0f\u53d1\u5e03\u8303\u56f4\uff0c\u964d\u4f4e\u98ce\u9669\uff0c\u5feb\u901f\u8bd5\u9519\u3002\\n\\n\u867d\u7136\u7070\u5ea6\u53d1\u5e03\u662f\u4e00\u4e2a\u4f4e\u9891\u7684\u884c\u4e3a\uff0c\u4f46\u548c\u5168\u91cf\u53d1\u5e03\u4e4b\u95f4\u4f9d\u7136\u5b58\u5728\u72b6\u6001\u7684\u8f6c\u6362\u3002\\n\\n![xinlang8](https://user-images.githubusercontent.com/23514812/125597330-b3dde9ba-28f3-4899-9f4f-53b89131e653.png)\\n\\n\u5f53\u7070\u5ea6\u53d1\u5e03\u7684\u5360\u6bd4\u51cf\u5c11\u5230 0% \u7684\u65f6\u5019\uff0c\u5c31\u662f\u5168\u91cf\u53d1\u5e03\u7684\u72b6\u6001\uff1b\u7070\u5ea6\u53d1\u5e03\u4e0a\u5347\u5230 100% \u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u662f\u4e0b\u4e00\u6b21\u7684\u5168\u91cf\u53d1\u5e03\uff0c\u8fd9\u5c31\u662f\u5b83\u7684\u72b6\u6001\u8f6c\u6362\u3002\\n\\n![xinlang9](https://user-images.githubusercontent.com/23514812/125598577-bcf2b13d-031a-440c-9480-c68d41d5ca9c.png)\\n\\n\u4e0a\u56fe\u4e3a\u5728\u64cd\u4f5c\u7070\u5ea6\u53d1\u5e03\u9009\u62e9\u5177\u4f53\u7684\u7f51\u5173\u5b9e\u4f8b\u65f6\u7684\u622a\u56fe\u3002\\n\\n\u7070\u5ea6\u53d1\u5e03\u5b8c\u6574\u529f\u80fd\u9664\u4e86\u7ba1\u7406\u540e\u53f0\u652f\u6301\uff0c\u8fd8\u9700\u8981\u5728\u7f51\u5173\u5b9e\u4f8b\u4e0a\u66b4\u9732\u51fa\u4e00\u4e9b API \u652f\u6301\u3002\\n\\n![xinlang10](https://user-images.githubusercontent.com/23514812/125597285-cf3c9145-adc6-4fa4-979e-124ea8f376b5.png)\\n\\n\u7070\u5ea6\u53d1\u5e03 API \u56fa\u5b9a URI, \u7edf\u4e00\u8def\u5f84\u4e3a /admin/services/gray/{SAAS_ID}/routes\u3002\u4e0d\u540c HTTP Method \u5448\u73b0\u4e0d\u540c\u4e1a\u52a1\u542b\u4e49\uff0cPOST \u8868\u793a\u521b\u5efa\uff0c\u505c\u6b62\u7070\u5ea6\u662f DELETE\uff0c\u67e5\u770b\u5c31\u662f GET\u3002\\n\\n#### 3.3.1 \u542f\u52a8\u6d41\u7a0b\\n\\n![xinlang11](https://user-images.githubusercontent.com/23514812/125597454-e4ad004e-9f04-495d-bb93-33c4b9942d4d.png)\\n\\n\u4ece\u7f51\u5173\u5c42\u9762\u53d1\u5e03\u4e00\u4e2a API\uff0c\u63a5\u6536\u6570\u636e\u540e worker \u8fdb\u7a0b\u6821\u9a8c\u53d1\u9001\u6765\u7684\u6570\u636e\u7684\u5408\u6cd5\u6027\uff0c\u5408\u6cd5\u6570\u636e\u4f1a\u901a\u8fc7\u4e8b\u4ef6\u5e7f\u64ad\u7ed9\u6240\u6709\u7684 worker \u8fdb\u7a0b\u3002\u968f\u540e\u8c03\u7528\u7070\u5ea6\u53d1\u5e03 API \uff0c\u6dfb\u52a0\u5b8c\u7070\u5ea6\u89c4\u5219\uff0c\u5728\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u88ab\u5904\u7406\u65f6\u751f\u6548\u3002\\n\\n#### 3.3.2 \u505c\u7528\u6d41\u7a0b\\n\\n![xinlang12](https://user-images.githubusercontent.com/23514812/125597537-99270698-992a-4f58-91b4-06067f4d44d2.png)\\n\\n\u505c\u7528\u6d41\u7a0b\u548c\u7070\u5ea6\u5206\u5e03\u6d41\u7a0b\u57fa\u672c\u4e00\u81f4\uff0c\u901a\u8fc7 DELETE \u7684\u65b9\u6cd5\u8c03\u7528\u7070\u5ea6\u53d1\u5e03\u7684 API\uff0c\u5e7f\u64ad\u7ed9\u6240\u6709\u7684 work \u8fdb\u7a0b\uff0c\u6bcf\u4e2a work \u63a5\u6536\u5230\u9700\u8981\u505c\u7528\u7684\u7070\u5ea6\u7684 ID \u503c\u540e\u5728 route \u8868\u91cc\u8fdb\u884c\u68c0\u6d4b\u3002\u82e5 route \u8868\u91cc\u5b58\u5728\u5c31\u5220\u9664\uff0c\u7136\u540e\u5c1d\u8bd5\u4ece ETCD \u91cc\u9762\u8fd8\u539f\u51fa\u6765\u3002\u5982\u679c\u7070\u5ea6\u505c\u7528\u4e86\uff0c\u8981\u4fdd\u8bc1\u539f\u5148\u5b58\u5728 ETCD \u80fd\u591f\u8fd8\u539f\u51fa\u6765\uff0c\u4e0d\u80fd\u5f71\u54cd\u5230\u6b63\u5e38\u670d\u52a1\u3002\\n\\n### 3.4 \u652f\u6301\u5feb\u901f\u5bfc\u5165\\n\\n\u9664\u4e86\u5728\u7ba1\u7406\u9875\u9762\u652f\u6301\u521b\u5efa\u8def\u7531\u4e4b\u5916\uff0c\u5f88\u591a\u8fd0\u7ef4\u540c\u5b66\u8fd8\u662f\u6bd4\u8f83\u4e60\u60ef\u4f7f\u7528\u811a\u672c\u5bfc\u5165\u3002\u6211\u4eec\u6709\u5927\u91cf\u7684 HTTP API \u670d\u52a1\uff0c\u8fd9\u4e9b\u670d\u52a1\u8981\u662f\u4e00\u4e2a\u4e00\u4e2a\u624b\u52a8\u5f55\u5165\uff0c\u4f1a\u975e\u5e38\u8017\u65f6\u3002\u5982\u679c\u901a\u8fc7\u811a\u672c\u5bfc\u5165\uff0c\u5219\u80fd\u591f\u964d\u4f4e\u5f88\u591a\u670d\u52a1\u8fc1\u79fb\u963b\u529b\u3002\\n\\n\u901a\u8fc7\u4e3a\u7ba1\u7406\u540e\u53f0\u66b4\u9732\u51fa Go Import HTTP API\uff0c\u8fd0\u7ef4\u540c\u5b66\u53ef\u4ee5\u5728\u73b0\u6210\u7684 Bash Script \u811a\u672c\u6587\u4ef6\u4e2d\u586b\u5199\u5206\u914d\u7684 token\u3001SaaS ID \u4ee5\u53ca\u76f8\u5173\u7684 UID \u7b49\uff0c\u4ece\u800c\u8f83\u4e3a\u5feb\u901f\u5730\u5bfc\u5165\u670d\u52a1\u5230\u7ba1\u7406\u540e\u53f0\u4e2d\u3002\u5bfc\u5165\u670d\u52a1\u540e\u7eed\u64cd\u4f5c\u4f9d\u7136\u8fd8\u662f\u9700\u8981\u5728\u7ba1\u7406\u540e\u53f0 H5 \u754c\u9762\u4e0a\u5b8c\u6210\u3002\\n\\n![xinlang13](https://user-images.githubusercontent.com/23514812/125597641-54bf1649-0238-4973-8501-48c1cead328e.png)\\n\\n## 4 \u5728 Apache APISIX \u7684\u6570\u636e\u9762\uff0c\u6211\u4eec\u6539\u4e86\u4e9b\u4ec0\u4e48\\n\\n\u57fa\u4e8e Apache APISIX \u6570\u636e\u9762\u5b9a\u5236\u5f00\u53d1\u9700\u8981\u9075\u5faa\u4e00\u4e9b\u4ee3\u7801\u8def\u5f84\u89c4\u5219\u3002\u5176\u4e2d\uff0cApache APISIX \u7f51\u5173\u7684\u4ee3\u7801\u548c\u5b9a\u5236\u4ee3\u7801\u5206\u5f00\u5b58\u653e\u4e0d\u540c\u8def\u5f84\uff0c\u4e24\u8005\u534f\u540c\u5de5\u4f5c\uff0c\u5404\u81ea\u53ef\u72ec\u7acb\u8fed\u4ee3\u3002\\n\\n![xinlang14](https://user-images.githubusercontent.com/23514812/125597706-33f97c9a-1e82-43c5-9ed7-e13b051ad9a0.png)\\n\\n### 4.1 \u5b89\u88c5\u5305\u7684\u4fee\u6539\\n\\n\u56e0\u6b64\u6253\u5305\u65f6\uff0c\u4e0d\u4f46\u6709\u5b9a\u5236\u4ee3\u7801\uff0c\u8fd8\u9700\u8981\u628a\u4f9d\u8d56\u3001\u914d\u7f6e\u7b49\u5168\u90e8\u6253\u5305\u5230\u4e00\u8d77\u8fdb\u884c\u5206\u53d1\u3002\u81f3\u4e8e\u8f93\u51fa\u7684\u683c\u5f0f\uff0c\u8981\u4e48\u9009\u62e9 Docker\uff0c\u8981\u4e48\u6253\u5230\u4e00\u4e2a tar \u5305\u4e2d\uff0c\u6309\u9700\u9009\u62e9\u3002\\n\\n![xinlang15](https://user-images.githubusercontent.com/23514812/125597788-24829253-d6f2-4f65-9799-3fc840a7c970.png)\\n\\n### 4.2 \u4ee3\u7801\u7684\u5b9a\u5236\u5f00\u53d1\\n\\n\u6709\u4e9b\u5b9a\u5236\u6a21\u5757\u9700\u8981\u5728\u88ab\u521d\u59cb\u5316\u65f6\u4f18\u5148\u52a0\u8f7d\uff0c\u8fd9\u6837\u5bf9 Apache APISIX \u7684\u4ee3\u7801\u5165\u4fb5\u5c31\u53d8\u5f97\u5f88\u5c0f\uff0c\u53ea\u9700\u8981\u4fee\u6539 NGINX.conf \u6587\u4ef6\u3002\\n\\n![xinlang16](https://user-images.githubusercontent.com/23514812/125597856-6020f223-dfeb-44a1-8a80-896a24a3d8fb.png)\\n\\n\u6bd4\u5982\uff0c\u9700\u8981\u4e3a upstream \u5bf9\u8c61\u585e\u5165\u4e00\u4e2a saas_id \u5c5e\u6027\u5b57\u6bb5\uff0c\u53ef\u4ee5\u5728\u521d\u59cb\u5316\u65f6\u8c03\u7528\u5982\u4e0b\u65b9\u6cd5\u3002\\n\\n![xinlang17](https://user-images.githubusercontent.com/23514812/125598009-75d4aaf7-10b7-476b-af22-97a0630d878c.png)\\n\\n\u7c7b\u4f3c\u4fee\u6539\u7b49\uff0c\u9700\u8981\u5728 init_worker_by_lua_* \u9636\u6bb5\u5b8c\u6210\u8c03\u7528\uff0c\u5b8c\u6210\u521d\u59cb\u5316\u3002\\n\\n\u53e6\u5916\u4e00\u79cd\u60c5\u51b5\uff1a\u5982\u4f55\u76f4\u63a5\u91cd\u5199\u5f53\u524d\u5df2\u6709\u6a21\u5757\u7684\u5b9e\u73b0\u3002\u6bd4\u5982\u6709\u4e00\u4e2a debug \u6a21\u5757\uff0c\u73b0\u5728\u9700\u8981\u5bf9\u5b83\u7684\u521d\u59cb\u5316\u903b\u8f91\u8fdb\u884c\u91cd\u6784\uff0c\u5373\u5bf9 init_worker \u51fd\u6570\u8fdb\u884c\u91cd\u5199\u3002\\n\\n![xinlang18](https://user-images.githubusercontent.com/23514812/125598066-fd0da722-7fb0-44a2-99cd-15bf07fd1ad6.png)\\n\\n\u8fd9\u79cd\u65b9\u5f0f\u7684\u597d\u5904\u5728\u4e8e\uff0c\u65e2\u80fd\u4fdd\u8bc1 API \u539f\u59cb\u7684\u7269\u7406\u6587\u4ef6\u4e0d\u52a8\uff0c\u53c8\u80fd\u52a0\u5165\u81ea\u5b9a\u4e49\u7684 API \u5177\u4f53\u903b\u8f91\u7684\u91cd\u5199\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u540e\u671f\u4ee3\u7801\u7ba1\u7406\u7684\u6210\u672c\uff0c\u4e5f\u4e3a\u540e\u7eed\u5347\u7ea7\u5e26\u6765\u5f88\u5927\u7684\u4fbf\u5229\u3002\\n\\n\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u82e5\u6709\u7c7b\u4f3c\u9700\u6c42\uff0c\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0a\u505a\u6cd5\u3002\\n\\n### 4.3 \u652f\u6301 Consul KV \u65b9\u5f0f\u670d\u52a1\u53d1\u73b0\\n\\n\u5f53\u524d\u5fae\u535a\u5f88\u591a\u670d\u52a1\u91c7\u7528 Consul KV \u7684\u65b9\u5f0f\u4f5c\u4e3a\u670d\u52a1\u6ce8\u518c\u548c\u53d1\u73b0\u673a\u5236\u3002\u4ee5\u524d Apache APISIX \u662f\u4e0d\u652f\u6301 Consul KV \u65b9\u5f0f\u670d\u52a1\u53d1\u73b0\u673a\u5236\u7684\uff0c\u5c31\u9700\u8981\u5728\u7f51\u5173\u5c42\u6dfb\u52a0\u4e00\u4e2a consul_kv.lua \u6a21\u5757\uff0c\u540c\u65f6\u4e5f\u9700\u8981\u5728\u7ba1\u7406\u540e\u53f0\u63d0\u4f9b UI \u754c\u9762\u652f\u6301\uff0c\u5982\u4e0b\uff1a\\n\\n![xinlang19](https://user-images.githubusercontent.com/23514812/125598115-d72321e4-b886-4e0d-965f-50c06f0f3104.png)\\n\\n\u5728\u63a7\u5236\u53f0\u4e2d\u7684 upstream \u5217\u8868\u4e2d\uff0c\u586b\u5199\u7684\u6240\u6709\u4e1c\u897f\u4e00\u76ee\u4e86\u7136\uff0c\u9f20\u6807\u79fb\u52a8\u5230\u6ce8\u518c\u670d\u52a1\u5730\u5740\u4e0a\uff0c\u5c31\u4f1a\u81ea\u52a8\u5448\u73b0\u6240\u6709\u6ce8\u518c\u8282\u70b9\u7684\u5143\u6570\u636e\uff0c\u6781\u5927\u65b9\u4fbf\u4e86\u8fd0\u7ef4\u540c\u5b66\u65e5\u5e38\u64cd\u4f5c\u3002\\n\\n![xinlang20](https://user-images.githubusercontent.com/23514812/125598173-0b456929-5c41-4ddc-9675-a80f5129621f.png)\\n\\nconsul_kv.lua \u6a21\u5757\u5728\u7f51\u5173\u5c42\u7684\u914d\u7f6e\u65b9\u5f0f\u8f83\u4e3a\u7b80\u5355\uff0c\u540c\u65f6\u652f\u6301\u591a\u4e2a\u4e0d\u540c Consul \u96c6\u7fa4\u8fde\u63a5\uff0c\u5f53\u7136\u8fd9\u4e5f\u662f\u5b9e\u9645\u73af\u5883\u8981\u6c42\u4f7f\u7136\u3002\\n\\n![xinlang21](https://user-images.githubusercontent.com/23514812/125598228-bd02e3ab-3c70-4f2c-8860-3ddee4bb9dcc.png)\\n\\n\u76ee\u524d\u8fd9\u90e8\u5206\u4ee3\u7801\u5df2\u88ab\u5408\u5e76\u5230 APISIX master \u5206\u652f\u4e2d\uff0c2.4 \u7248\u672c\u5df2\u5305\u542b\u3002\\n\\n\u8be5\u6a21\u5757\u7684\u8fdb\u7a0b\u6a21\u578b\u91c7\u7528\u8ba2\u9605\u53d1\u5e03\u6a21\u5f0f\uff0c\u6bcf\u4e00\u4e2a\u7f51\u5173\u5b9e\u4f8b\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u8fdb\u7a0b\u53bb\u957f\u8fde\u63a5\u8f6e\u8be2\u591a\u4e2a\u7684 Consul \u670d\u52a1\u96c6\u7fa4\uff0c\u4e00\u65e6\u6709\u4e86\u65b0\u6570\u636e\u5c31\u4f1a\u4e00\u4e00\u5e7f\u64ad\u5206\u53d1\u5230\u6240\u6709\u4e1a\u52a1\u5b50\u8fdb\u7a0b\u3002\\n\\n## 5 \u5b9a\u5236\u5316\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u601d\u8003\\n\\n### 5.1 \u8fc1\u79fb\u6210\u672c\u9ad8\\n\\n\u5728\u8fd0\u7ef4\u5c42\u9762\u5176\u5b9e\u9762\u4e34\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u8fc1\u79fb\u6210\u672c\u7684\u95ee\u9898\u3002\\n\\n\u4efb\u4f55\u4e00\u4e2a\u65b0\u4e8b\u7269\u51fa\u73b0\uff0c\u7528\u4e8e\u66ff\u6362\u73b0\u6709\u7684\u57fa\u7840\uff0c\u90fd\u4e0d\u4f1a\u4e00\u9a6c\u5e73\u5ddd\uff0c\u800c\u662f\u9700\u8981\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u6162\u6162\u719f\u6089\u3001\u589e\u8fdb\u8ba4\u77e5\uff0c\u7136\u540e\u4e0d\u505c\u8bd5\u9519\uff0c\u6162\u6162\u5411\u524d\u63a8\u8fdb\uff0c\u9010\u6e10\u6d88\u9664\u5927\u5bb6\u5fc3\u4e2d\u7684\u5404\u79cd\u7591\u60d1\u3002\u53ea\u6709\u5728\u7a33\u5b9a\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\uff0c\u5404\u79cd\u95ee\u9898\u90fd\u5f97\u5230\u89e3\u51b3\u4e4b\u540e\uff0c\u624d\u4f1a\u8fdb\u5165\u4e0b\u4e00\u6b65\u8f83\u4e3a\u5feb\u901f\u7684\u66ff\u6362\u9636\u6bb5\u3002\u6beb\u65e0\u7591\u95ee\uff0c\u5f53\u524d APISIX \u5728\u5fae\u535a\u7684\u4f7f\u7528\u8fd8\u5904\u4e8e\u9010\u6b65\u63a8\u8fdb\u7684\u9636\u6bb5\uff0c\u6211\u4eec\u8fd8\u5728\u4e0d\u65ad\u719f\u6089\u3001\u5b66\u4e60\u5e76\u6df1\u5165\u4e86\u89e3\uff0c\u540c\u65f6\u89e3\u51b3\u5404\u79cd\u5404\u6837\u7684\u8fc1\u79fb\u95ee\u9898\uff0c\u4ee5\u671f\u627e\u5230\u6700\u4f73\u5b9e\u8df5\u8def\u5f84\u3002\\n\\n\u4e3e\u4e00\u4e2a\u4f8b\u5b50\uff0c\u5728\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u4e00\u4e00\u5c06 nginx.conf \u6587\u4ef6\u4e2d\u7684\u5404\u79cd\u4e0a\u6e38\u4ee5\u53ca\u8def\u7531\u7b49\u89c4\u5219\u5bfc\u5165\u5230\u7f51\u5173\u7cfb\u7edf\u7ba1\u7406\u540e\u53f0\u4e2d\uff0c\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u67af\u71e5\u7684\u624b\u52a8\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u56e0\u6b64\u6211\u4eec\u5f00\u53d1\u4e86\u5feb\u901f\u5bfc\u5165\u63a5\u53e3\uff0c\u63d0\u4f9b bash script \u811a\u672c\u4e00\u952e\u5f55\u5165\u7b49\u529f\u80fd\u6765\u7b80\u5316\u8fd9\u4e2a\u8fc7\u7a0b\u3002\\n\\n![xinlang22](https://user-images.githubusercontent.com/23514812/125598279-1fa93710-e5a0-4dc4-b42b-46b02f66f6a8.png)\\n\\n\u540c\u65f6\u6211\u4eec\u4e5f\u4f1a\u9047\u5230 NGINX \u5404\u79cd\u590d\u6742\u53d8\u91cf\u5224\u65ad\u8bed\u53e5\uff0c\u76ee\u524d\u4e3b\u8981\u662f\u53d1\u73b0\u4e00\u4e2a\u89e3\u51b3\u4e00\u4e2a\uff0c\u4e0d\u65ad\u79ef\u7d2f\u7ecf\u9a8c\u3002\\n\\n### 5.2 \u5b9a\u5236\u5316\u7a0b\u5ea6\u9ad8\uff0c\u5bfc\u81f4\u540e\u7eed\u5347\u7ea7\u6210\u672c\u8f83\u9ad8\\n\\n\u65e0\u8bba\u662f Apache APISIX \u8fd8\u662f Apache APISIX Dashboard\uff0c\u6211\u4eec\u90fd\u505a\u4e86\u5f88\u591a\u5b9a\u5236\u5316\u5f00\u53d1\u3002\u8fd9\u5bfc\u81f4\u5347\u7ea7\u6700\u65b0\u7248 Dashboard \u8f83\u4e3a\u56f0\u96be\u3002\u4e0d\u8fc7\uff0c\u6211\u4eec\u5b9a\u5236\u5f00\u53d1\u6240\u9009\u62e9\u7684 Dashboard \u7248\u672c\u57fa\u672c\u529f\u80fd\u90fd\u5df2\u5177\u5907\uff0c\u6ee1\u8db3\u65e5\u5e38\u7528\u9014\u5012\u4e5f\u8db3\u591f\u4e86\u3002\\n\\n\u9488\u5bf9 Apache APISIX \u7684\u5b9a\u5236\u5f00\u53d1\uff0c\u5219\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u5347\u7ea7\uff0c\u76ee\u524d\u5df2\u7ecf\u5b8c\u6210\u4e86\u82e5\u5e72\u4e2a\u5c0f\u7248\u672c\u7684\u5347\u7ea7\u3002\\n\\n### 5.3 \u53cd\u54fa\u793e\u533a\\n\\n\u6700\u540e\u6211\u4eec\u804a\u804a\u793e\u533a\uff0c\u6211\u4eec\u4e5f\u5728\u60f3\u600e\u4e48\u628a\u793e\u533a\u611f\u5174\u8da3\u7684\u529f\u80fd\u53cd\u54fa\u7ed9 Apache APISIX \u793e\u533a\uff0c\u8ba9\u5927\u5bb6\u4e00\u8d77\u4f7f\u7528\u548c\u4fee\u6539\u3002\\n\\n\u6211\u4eec\u8fdb\u884c\u5b9a\u5236\u5f00\u53d1\u7684\u9a71\u52a8\u529b\u4e3b\u8981\u6765\u81ea\u5fae\u535a\u5185\u90e8\u7684\u5b9e\u9645\u9700\u6c42\uff0c\u4e0e Apache APISIX \u793e\u533a\u63a8\u52a8\u7684\u6f14\u8fdb\u6709\u4e00\u4e9b\u51fa\u5165\uff0c\u8fd9\u662f\u5ba2\u89c2\u5b58\u5728\u7684\u4e8b\u5b9e\u3002\u4f46\u9664\u53bb\u4e00\u4e9b\u5305\u542b\u654f\u611f\u6570\u636e\u7684\u4ee3\u7801\uff0c\u4f01\u4e1a\u548c\u793e\u533a\u603b\u4f1a\u5728\u4e00\u4e9b\u6bd4\u8f83\u901a\u7528\u7684\u529f\u80fd\u4ee3\u7801\u5c42\u9762\u5b58\u5728\u5171\u540c\u9700\u6c42\uff0c\u4f01\u4e1a\u548c\u5f00\u6e90\u793e\u533a\u53ef\u4ee5\u4e00\u8d77\u63a8\u52a8\u4f7f\u4e4b\u8fdb\u5316\u5f97\u66f4\u4e3a\u7a33\u5b9a\u6210\u719f\u3002\u6bd4\u5982\u901a\u7528\u7684 Consul KV \u670d\u52a1\u53d1\u73b0\u6a21\u5757\u3001\u4e00\u4e9b\u9ad8\u53ef\u7528\u914d\u7f6e\u6587\u4ef6\u7684\u5904\u7406\uff0c\u4ee5\u53ca\u5176\u5b83\u95ee\u9898\u7684\u4fee\u590d\u7b49\u3002\\n\\n\u8fd9\u4e9b\u5171\u540c\u9700\u6c42\u4e00\u822c\u4f1a\u5728\u4f01\u4e1a\u5185\u90e8\u6253\u78e8\u4e00\u6bb5\u65f6\u95f4\uff0c\u76f4\u5230\u5b8c\u5168\u6ee1\u8db3\u5185\u90e8\u9700\u6c42\u4e4b\u540e\uff0c\u518d\u9010\u6b65\u63d0\u4ea4\u5230\u793e\u533a\u5f00\u6e90\u4ee3\u7801\u5206\u652f\u91cc\uff0c\u4f46\u8fd9\u4e5f\u9700\u8981\u4e00\u4e2a\u8fc7\u7a0b\u3002"},{"id":"2021/06/30/etcd3-support-http-access-perfectly","metadata":{"permalink":"/zh/blog/2021/06/30/etcd3-support-http-access-perfectly","source":"@site/blog/2021/06/30/etcd3-support-HTTP-access-perfectly.md","title":"\u5dee\u4e4b\u6beb\u5398\uff1aetcd 3 \u5b8c\u7f8e\u652f\u6301 HTTP \u8bbf\u95ee\uff1f","description":"\u4ece\u53bb\u5e74 10 \u6708\u53d1\u5e03 Apache APISIX 2.0 \u7248\u672c\u4ee5\u6765\uff0c\u73b0\u5728\u5df2\u7ecf\u8fc7\u53bb\u4e86 8 \u4e2a\u6708\u3002\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u53d1\u73b0\u4e86 etcd \u7684 HTTP API \u7684\u4e00\u4e9b\u8ddf gRPC API \u4ea4\u4e92\u7684\u95ee\u9898\u3002\u4e8b\u5b9e\u4e0a\uff0c\u62e5\u6709 gRPC-gateway \u5e76\u4e0d\u610f\u5473\u7740\u80fd\u591f\u5b8c\u7f8e\u652f\u6301 HTTP \u8bbf\u95ee\uff0c\u8fd9\u91cc\u8fd8\u662f\u6709\u4e9b\u7ec6\u5fae\u7684\u5dee\u522b\u3002","date":"2021-06-30T00:00:00.000Z","formattedDate":"2021\u5e746\u670830\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":6.855,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"\u57fa\u4e8e Apache APISIX\uff0c\u65b0\u6d6a\u5fae\u535a API \u7f51\u5173\u7684\u5b9a\u5236\u5316\u5f00\u53d1\u4e4b\u8def","permalink":"/zh/blog/2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix"},"nextItem":{"title":"Apache APISIX 2.7.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/06/29/release-apache-apisix-2.7"}},"content":"> \u4ece\u53bb\u5e74 10 \u6708\u53d1\u5e03 Apache APISIX 2.0 \u7248\u672c\u4ee5\u6765\uff0c\u73b0\u5728\u5df2\u7ecf\u8fc7\u53bb\u4e86 8 \u4e2a\u6708\u3002\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u53d1\u73b0\u4e86 etcd \u7684 HTTP API \u7684\u4e00\u4e9b\u8ddf gRPC API \u4ea4\u4e92\u7684\u95ee\u9898\u3002\u4e8b\u5b9e\u4e0a\uff0c\u62e5\u6709 gRPC-gateway \u5e76\u4e0d\u610f\u5473\u7740\u80fd\u591f\u5b8c\u7f8e\u652f\u6301 HTTP \u8bbf\u95ee\uff0c\u8fd9\u91cc\u8fd8\u662f\u6709\u4e9b\u7ec6\u5fae\u7684\u5dee\u522b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\netcd \u5347\u7ea7\u5230 3.x \u7248\u672c\u540e\uff0c\u5176\u5bf9\u5916 API \u7684\u534f\u8bae\u4ece\u666e\u901a\u7684 HTTP1 \u5207\u6362\u5230\u4e86 gRPC\u3002\u4e3a\u4e86\u517c\u987e\u90a3\u4e9b\u4e0d\u80fd\u4f7f\u7528 gRPC \u7684\u7279\u6b8a\u7fa4\u4f53\uff0cetcd \u901a\u8fc7 gRPC-gateway \u7684\u65b9\u5f0f\u4ee3\u7406 HTTP1 \u8bf7\u6c42\uff0c\u4ee5 gRPC \u5f62\u5f0f\u53bb\u8bbf\u95ee\u65b0\u7684 gRPC API\u3002\uff08\u7531\u4e8e HTTP1 \u5ff5\u8d77\u6765\u592a\u8fc7\u62d7\u53e3\uff0c\u4ee5\u4e0b\u5c06\u4e4b\u7b80\u5316\u6210 HTTP\uff0c\u6b63\u597d\u548c gRPC \u80fd\u591f\u5bf9\u5e94\u3002\u8bf7\u4e0d\u8981\u7ea0\u7ed3 gRPC \u4e5f\u662f HTTP \u8bf7\u6c42\u7684\u8fd9\u79cd\u95ee\u9898\u3002\uff09\\n\\nApache APISIX \u5f00\u59cb\u7528 etcd \u7684\u65f6\u5019\uff0c\u7528\u7684\u662f etcd v2 \u7684 API\u3002\u4ece Apache APISIX 2.0 \u7248\u672c\u8d77\uff0c\u6211\u4eec\u628a\u4f9d\u8d56\u7684 etcd \u7248\u672c\u5347\u7ea7\u5230 3.x\u3002\u7531\u4e8e Lua \u751f\u6001\u5708\u91cc\u9762\u6ca1\u6709 gRPC \u5e93\uff0c\u6240\u4ee5 etcd \u5bf9 HTTP \u7684\u517c\u5bb9\u5e2e\u4e86\u6211\u4eec\u5f88\u5927\u7684\u5fd9\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u82b1\u5f88\u5927\u5fc3\u601d\u53bb\u8865\u8fd9\u4e2a\u77ed\u677f\u4e86\u3002\\n\\n\u4ece\u53bb\u5e74 10 \u6708\u53d1\u5e03 Apache APISIX 2.0 \u7248\u672c\u4ee5\u6765\uff0c\u73b0\u5728\u5df2\u7ecf\u8fc7\u53bb\u4e86 8 \u4e2a\u6708\u3002\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u53d1\u73b0\u4e86 etcd \u7684 HTTP API \u7684\u4e00\u4e9b\u8ddf gRPC API \u4ea4\u4e92\u7684\u95ee\u9898\u3002\u4e8b\u5b9e\u4e0a\uff0c\u62e5\u6709 gRPC-gateway \u5e76\u4e0d\u610f\u5473\u7740\u80fd\u591f\u5b8c\u7f8e\u652f\u6301 HTTP \u8bbf\u95ee\uff0c\u8fd9\u91cc\u8fd8\u662f\u6709\u4e9b\u7ec6\u5fae\u7684\u5dee\u522b\u3002\\n\\n### \u6253\u7834 gRPC \u7684\u9ed8\u8ba4\u9650\u5236\\n\\n\u5c31\u5728\u51e0\u5929\u524d\uff0cetcd \u53d1\u5e03\u4e86 v3.5.0 \u7248\u672c\u3002\u8fd9\u4e2a\u7248\u672c\u7684\u53d1\u5e03\uff0c\u4e86\u5374\u56f0\u6270\u6211\u4eec\u5f88\u957f\u65f6\u95f4\u7684\u4e00\u4e2a\u95ee\u9898\u3002\\n\\n\u8ddf HTTP \u4e0d\u540c\u7684\u662f\uff0cgRPC \u9ed8\u8ba4\u9650\u5236\u4e86\u4e00\u6b21\u8bf7\u6c42\u53ef\u4ee5\u8bfb\u53d6\u7684\u6570\u636e\u5927\u5c0f\u3002\u8fd9\u4e2a\u9650\u5236\u53eb\u505a \u201cMaxCallRecvMsgSize\u201d\uff0c\u9ed8\u8ba4\u662f 4MiB\u3002\u5f53 Apache APISIX \u5168\u91cf\u540c\u6b65 etcd \u6570\u636e\u65f6\uff0c\u5047\u5982\u914d\u7f6e\u591f\u591a\uff0c\u5c31\u4f1a\u89e6\u53d1\u8fd9\u4e00\u4e0a\u9650\uff0c\u62a5\u9519 \u201cgrpc: received message larger than max\u201d\u3002\\n\\n\u795e\u5947\u7684\u662f\uff0c\u5982\u679c\u4f60\u7528 etcdctl \u53bb\u8bbf\u95ee\uff0c\u8fd9\u65f6\u5019\u5374\u4e0d\u4f1a\u6709\u4efb\u4f55\u95ee\u9898\u3002\u8fd9\u662f\u56e0\u4e3a\u8fd9\u4e2a\u9650\u5236\u662f\u53ef\u4ee5\u5728\u8ddf gRPC server \u5efa\u7acb\u8fde\u63a5\u65f6\u52a8\u6001\u8bbe\u7f6e\u7684\uff0cetcdctl \u7ed9\u8fd9\u4e2a\u9650\u5236\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u5f88\u5927\u7684\u6574\u6570\uff0c\u76f8\u5f53\u4e8e\u53bb\u6389\u4e86\u8fd9\u4e00\u9650\u5236\u3002\\n\\n\u7531\u4e8e\u4e0d\u5c11\u7528\u6237\u78b0\u5230\u8fc7\u540c\u6837\u7684\u95ee\u9898\uff0c\u6211\u4eec\u66fe\u7ecf\u8ba8\u8bba\u8fc7\u5bf9\u7b56\u3002\\n\\n\u4e00\u4e2a\u60f3\u6cd5\u662f\u7528\u589e\u91cf\u540c\u6b65\u6a21\u62df\u5168\u91cf\u540c\u6b65\uff0c\u8fd9\u4e48\u505a\u6709\u4e24\u4e2a\u5f0a\u7aef\uff1a\\n\\n1. \u5b9e\u73b0\u8d77\u6765\u590d\u6742\uff0c\u8981\u6539\u4e0d\u5c11\u4ee3\u7801\\n2. \u4f1a\u5ef6\u957f\u540c\u6b65\u6240\u9700\u7684\u65f6\u95f4\\n\\n\u53e6\u4e00\u4e2a\u60f3\u6cd5\u662f\u4fee\u6539 etcd\u3002\u65e2\u7136\u80fd\u591f\u5728 etcdctl \u91cc\u9762\u53bb\u9664\u9650\u5236\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u5bf9 gRPC-gateway \u4e00\u89c6\u540c\u4ec1\u5462\uff1f\u540c\u6837\u7684\u6539\u52a8\u53ef\u4ee5\u4f5c\u7528\u5728 gRPC-gateway \u4e0a\u3002\\n\\n\u6211\u4eec\u91c7\u7528\u4e86\u7b2c\u4e8c\u79cd\u65b9\u6848\uff0c\u7ed9 etcd \u63d0\u4e86\u4e2a PR\uff1ahttps://github.com/etcd-io/etcd/pull/13077\\n\\n![2021-06-30-1](https://static.apiseven.com/202108/1639465584634-26435c89-3e1c-4fb9-b094-057fce0f769d.png)\\n\\n\u6700\u65b0\u53d1\u5e03\u7684 v3.5.0 \u7248\u672c\u5c31\u5305\u542b\u4e86\u6211\u4eec\u8d21\u732e\u7684\u8fd9\u4e2a\u6539\u52a8\u3002\u5982\u679c\u4f60\u9047\u5230 \u201cgrpc: received message larger than max\u201d\uff0c\u4e0d\u59a8\u8bd5\u4e00\u4e0b\u8fd9\u4e2a\u7248\u672c\u3002\u8fd9\u4e00\u6539\u52a8\u4e5f\u88ab etcd \u5f00\u53d1\u8005 backport \u5230 3.4 \u5206\u652f\u4e0a\u4e86\u30023.4 \u5206\u652f\u7684\u4e0b\u4e00\u4e2a\u53d1\u5e03\uff0c\u4e5f\u4f1a\u5e26\u4e0a\u8fd9\u4e2a\u6539\u52a8\u3002\\n\\n\u8fd9\u4ef6\u4e8b\u4e5f\u8bf4\u660e gRPC-gateway \u5e76\u975e\u767e\u8bd5\u767e\u7075\u3002\u5373\u4f7f\u7528\u4e86\u5b83\uff0c\u4e5f\u4e0d\u80fd\u4fdd\u8bc1 HTTP \u8bbf\u95ee\u80fd\u591f\u8ddf gRPC \u8bbf\u95ee\u6709\u4e00\u6837\u7684\u4f53\u9a8c\u3002\\n\\n### \u5bf9\u670d\u52a1\u7aef\u8bc1\u4e66\u7684\u6709\u8da3\u7528\u6cd5\\n\\nApache APISIX \u589e\u52a0\u4e86\u5bf9 etcd mTLS \u7684\u652f\u6301\u540e\uff0c\u6709\u7528\u6237\u53cd\u9988\u4e00\u76f4\u6ca1\u6cd5\u5b8c\u6210\u6821\u9a8c\uff0c\u800c\u7528 etcdctl \u8bbf\u95ee\u5219\u662f\u6210\u529f\u7684\u3002\u5728\u8ddf\u7528\u6237\u4ea4\u6d41\u540e\uff0c\u6211\u51b3\u5b9a\u62ff\u4ed6\u7684\u8bc1\u4e66\u6765\u590d\u73b0\u4e0b\u3002\\n\\n\u5728\u590d\u73b0\u8fc7\u7a0b\u4e2d\uff0c\u6211\u6ce8\u610f\u5230 etcd \u65e5\u5fd7\u91cc\u9762\u6709\u8fd9\u6837\u7684\u62a5\u9519\uff1a\\n\\n``` text\\n2021-06-09 11:10:13.022735 I | embed: rejected connection from \\"127.0.0.1:50898\\" (error \\"tls: failed to verify client\'s certificate: x509: certificate specifies an incompatible key usage\\", ServerName \\"\\")\\nWARNING: 2021/06/09 11:10:13 grpc: addrConn.createTransport failed to connect to {127.0.0.1:12379 0 }. Err :connection error: desc = \\"transport: authentication handshake failed: remote error: tls: bad certificate\\". Reconnecting...\\n```\\n\\n\u201cbad certificate\u201d \u9519\u8bef\u4fe1\u606f\uff0c\u521d\u770b\u50cf\u662f\u56e0\u4e3a\u6211\u4eec\u53d1\u7ed9 etcd \u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u4e0d\u5bf9\u3002\u4f46\u4ed4\u7ec6\u77a7\u77a7\uff0c\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u62a5\u9519\u662f\u5728 gRPC server \u91cc\u9762\u62a5\u7684\u3002\\n\\ngRPC-gateway \u5728 etcd \u91cc\u9762\u8d77\u5230\u4e00\u4e2a\u4ee3\u7406\u7684\u4f5c\u7528\uff0c\u628a\u5916\u9762\u7684 HTTP \u8bf7\u6c42\u53d8\u6210 gRPC server \u80fd\u5904\u7406\u7684 gRPC \u8bf7\u6c42\u3002\\n\\n\u5927\u4f53\u67b6\u6784\u5982\u4e0b\uff1a\\n\\n```text\\netcdctl ----\x3e gRPC server\\nApache APISIX ---\x3e gRPC-gateway ---\x3e gRPC server\\n```\\n\\n\u4e3a\u4ec0\u4e48 etcdctl \u76f4\u8fde gRPC server \u80fd\u901a\uff0c\u800c\u4e2d\u95f4\u52a0\u4e00\u5c42 gRPC-gateway \u5c31\u4e0d\u884c\uff1f\\n\\n\u539f\u6765\u5f53 etcd \u542f\u7528\u4e86\u5ba2\u6237\u7aef\u8bc1\u4e66\u6821\u9a8c\u4e4b\u540e\uff0c\u7528 gRPC-gateway \u8fde\u63a5 gRPC server \u5c31\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002\u731c\u731c\u8fd9\u4e2a\u8bc1\u4e66\u4ece\u54ea\u6765\uff1f\\n\\netcd \u628a\u914d\u7f6e\u7684\u670d\u52a1\u7aef\u8bc1\u4e66\u76f4\u63a5\u4f5c\u4e3a\u8fd9\u91cc\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u7528\u4e86\u3002\\n\\n\u4e00\u4e2a\u8bc1\u4e66\u65e2\u5728\u670d\u52a1\u7aef\u4e0a\u63d0\u4f9b\u9a8c\u8bc1\uff0c\u53c8\u5728\u5ba2\u6237\u7aef\u4e0a\u8868\u660e\u8eab\u4efd\uff0c\u770b\u4e0a\u53bb\u4e5f\u6ca1\u4ec0\u4e48\u95ee\u9898\u3002\u9664\u975e\u2026\u2026\\n\\n\u9664\u975e\u8bc1\u4e66\u4e0a\u542f\u7528\u4e86 server auth \u7684\u62d3\u5c55\uff0c\u4f46\u662f\u6ca1\u6709\u542f\u7528 client auth\u3002\\n\\n\u5bf9\u6709\u95ee\u9898\u7684\u8bc1\u4e66\u6267\u884c`openssl x509 -text -noout -in /tmp/bad.crt`\\n\\n\u4f1a\u770b\u5230\u8fd9\u6837\u7684\u8f93\u51fa\uff1a\\n\\n```text\\nX509v3 extensions:\\nX509v3 Key Usage: critical\\nDigital Signature, Key Encipherment\\nX509v3 Extended Key Usage:\\nTLS Web Server Authentication\\n```\\n\\n\u6ce8\u610f\u8fd9\u91cc\u7684 \u201cTLS Web Server Authentication\u201d\uff0c\u5982\u679c\u6211\u4eec\u628a\u5b83\u6539\u6210 \u201cTLS Web Server Authentication, TLS Web Client Authentication\u201d\uff0c\u6291\u6216\u4e0d\u52a0\u8fd9\u4e2a\u62d3\u5c55\uff0c\u5c31\u6ca1\u6709\u95ee\u9898\u4e86\u3002\\n\\netcd \u4e0a\u4e5f\u6709\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\u7684 issue\uff1ahttps://github.com/etcd-io/etcd/issues/9785\\n\\n![2021-06-30-2](https://static.apiseven.com/202108/1639465662863-30bc4fa9-8b7c-47d9-a73e-810bd690a588.png)\\n\\n### \u7ed3\u8bed\\n\\n\u867d\u7136\u6211\u4eec\u5728\u4e0a\u6587\u5217\u51fa\u4e86\u51e0\u70b9\u5c0f\u95ee\u9898\uff0c\u4f46\u662f\u7455\u4e0d\u63a9\u745c\uff0cetcd \u5bf9 HTTP \u8bbf\u95ee\u7684\u652f\u6301\u8fd8\u662f\u4e00\u4e2a\u975e\u5e38\u6709\u7528\u7684\u7279\u6027\u3002\\n\\n\u611f\u8c22 Apache APISIX \u7684\u7528\u6237\u4eec\uff0c\u6b63\u662f\u56e0\u4e3a\u6211\u4eec\u6709\u7740\u5e7f\u9614\u7684\u7528\u6237\u7fa4\uff0c\u624d\u80fd\u53d1\u73b0 etcd \u7684\u8fd9\u4e9b\u7ec6\u8282\u4e0a\u7684\u95ee\u9898\u3002\u6211\u4eec\u4f5c\u4e3a etcd \u7684\u4e00\u5927\u7528\u6237\uff0c\u5728\u4e4b\u540e\u7684\u65e5\u5b50\u91cc\u4e5f\u5c06\u4e00\u5982\u65e2\u5f80\u5730\u8ddf etcd \u7684\u5f00\u53d1\u8005\u591a\u591a\u4ea4\u6d41\u3002"},{"id":"Apache APISIX 2.7.0 \u6b63\u5f0f\u53d1\u5e03","metadata":{"permalink":"/zh/blog/2021/06/29/release-apache-apisix-2.7","source":"@site/blog/2021/06/29/release-apache-apisix-2.7.md","title":"Apache APISIX 2.7.0 \u6b63\u5f0f\u53d1\u5e03","description":"Apache APISIX 2.7.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b22\u8fce\u5927\u5bb6\u4e0b\u8f7d\u4f7f\u7528\u3002","date":"2021-06-29T00:00:00.000Z","formattedDate":"2021\u5e746\u670829\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":2.13,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"\u5dee\u4e4b\u6beb\u5398\uff1aetcd 3 \u5b8c\u7f8e\u652f\u6301 HTTP \u8bbf\u95ee\uff1f","permalink":"/zh/blog/2021/06/30/etcd3-support-http-access-perfectly"},"nextItem":{"title":"\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX","permalink":"/zh/blog/2021/06/28/why-we-need-apache-apisix"}},"content":"> Apache APISIX 2.7.0 \u7248\u672c\u6b63\u5f0f\u53d1\u5e03\uff01\u6b22\u8fce\u5927\u5bb6\u4e0b\u8f7d\u4f7f\u7528\u3002\\n\x3c!--truncate--\x3e\\n\\n\u8fd9\u4e2a\u7248\u672c\u652f\u6301\u4e86\u591a\u8bed\u8a00\u63d2\u4ef6\u3001\u589e\u5f3a\u4e86\u56db\u5c42 TCP \u4ee3\u7406\u3001\u589e\u5f3a\u4e86 Nginx \u529f\u80fd\uff0c\u6709 20+ \u5f00\u53d1\u8005\u53c2\u4e0e\uff0c\u5171\u63d0\u4ea4\u4e86 70+ PR\uff0c\u4e0b\u9762\u662f\u91cd\u70b9\u529f\u80fd\u7684\u4ecb\u7ecd\u3002\\n\\n## Release Notes\\n\\n### \u591a\u8bed\u8a00\u63d2\u4ef6\\n\\n\u968f\u7740 apisix-java-plugin-runner \u53d1\u5e03\u7b2c\u4e00\u4e2a\u7248\u672c\uff0c\u5916\u52a0 apisix-go-plugin-runner \u5b8c\u6210\u4e3b\u4f53\u529f\u80fd\uff0cAPISIX \u7684\u591a\u8bed\u8a00\u63d2\u4ef6\u529f\u80fd\u5df2\u7ecf\u652f\u6301\u4e24\u5927\u6700\u5e7f\u6cdb\u4f7f\u7528\u7684\u540e\u7aef\u7f16\u7a0b\u8bed\u8a00\u3002\u5982\u679c\u4f60\u8fd8\u62c5\u5fe7 APISIX \u7684\u63d2\u4ef6\u5f00\u53d1\u4f1a\u53d7\u9650\u4e8e Lua \u751f\u6001\uff0c\u4e0d\u59a8\u8bd5\u8bd5\u4f7f\u7528\u6211\u4eec\u7684\u591a\u8bed\u8a00 plugin runner \u6765\u5f00\u53d1 Java / Go \u63d2\u4ef6\u3002\\n\\n### \u589e\u5f3a\u56db\u5c42 TCP \u4ee3\u7406\\n\\n2.7 \u7248\u672c\u4e2d\uff0c\u6211\u4eec\u5f00\u53d1\u4e86 TCP \u4ee3\u7406\u65b0\u529f\u80fd\uff0c\u5305\u62ec\uff1a\\n\\n* \u5141\u8bb8 upstream \u4e2d\u914d\u7f6e\u57df\u540d\\n* \u5141\u8bb8 mqtt-proxy \u63d2\u4ef6\u914d\u7f6e\u57df\u540d\\n* \u652f\u6301\u63a5\u6536 TLS over TCP \u8fde\u63a5\uff0c\u8fd9\u4e00\u5757\u7684\u8bc1\u4e66\u81ea\u7136\u662f\u53ef\u4ee5\u50cf HTTPS \u7684\u8bc1\u4e66\u4e00\u6837\u52a8\u6001\u914d\u7f6e\u7684\\n* \u57fa\u4e8e SNI \u7684\u8def\u7531\u89c4\u5219\\n* \u52a8\u6001\u6821\u9a8c\u5ba2\u6237\u7aef\u8bc1\u4e66\\n\\n\u5728\u540e\u7eed\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u4e5f\u4f1a\u7ee7\u7eed\u5206\u914d\u90e8\u5206\u8d44\u6e90\u6765\u5b8c\u5584\u73b0\u6709\u7684 TCP \u4ee3\u7406\u529f\u80fd\uff0c\u656c\u8bf7\u671f\u5f85\uff01\\n\\n### \u589e\u5f3a Nginx \u529f\u80fd\\n\\n\u6211\u4eec\u5e0c\u671b\u80fd\u591f\u52a8\u6001\u8bbe\u7f6e\u8d8a\u6765\u8d8a\u591a\u7684 Nginx \u914d\u7f6e\uff0c\u6240\u4ee5\u6211\u4eec\u6dfb\u52a0\u81ea\u5df1\u7684\u8865\u4e01\u548c Nginx C \u6a21\u5757\uff0c\u589e\u5f3a\u539f\u751f Nginx \u7684\u529f\u80fd\u3002\\n\\n\u76ee\u524d\u5305\u542b\u4e86\u4ee5\u4e0b\u65b0\u529f\u80fd\uff1a\\n\\n* \u52a8\u6001\u8bbe\u7f6e mTLS\\n* \u52a8\u6001\u8bbe\u7f6e client_max_body_size\\n\\n\u5728 APISIX \u540e\u7eed\u7248\u672c\u4e2d\uff0c\u6211\u4eec\u4e5f\u4f1a\u9646\u7eed\u5141\u8bb8\u4e0b\u9762\u7684 Nginx \u914d\u7f6e\u80fd\u591f\u88ab\u52a8\u6001\u8bbe\u7f6e\uff1a\\n\\n* upstream \u7684 keepalive\\n* gzip\\n* real_ip\\n* proxy_max_temp_file_size\\n\\n## \u4e0b\u8f7d\\n\\n\u4e0b\u8f7d Apache APISIX 2.7.0-Release\\n\\n* \u6e90\u4ee3\u7801\uff1a\u8bf7\u8bbf\u95ee[\u4e0b\u8f7d\u9875\u9762](https://apisix.apache.org/downloads/)\\n* \u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\uff1a\u8bf7\u8bbf\u95ee[\u5b89\u88c5\u6307\u5357](https://apisix.apache.org/zh/docs/apisix/how-to-build/)"},{"id":"2021/06/28/why-we-need-apache-apisix","metadata":{"permalink":"/zh/blog/2021/06/28/why-we-need-apache-apisix","source":"@site/blog/2021/06/28/why-we-need-Apache-APISIX.md","title":"\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u67b6\u6784\u6f14\u8fdb\u5386\u53f2\uff0c\u5bf9\u6bd4 Nginx \u548c Kong \u8fd9\u4e24\u4e2a\u6846\u67b6 Apache APISIX \u7684\u4f18\u52bf\u662f\u4ec0\u4e48\uff0c\u5e76\u4e14\u4ecb\u7ecd APISIX \u672a\u6765\u7684\u8d8b\u52bf\u3002","date":"2021-06-28T00:00:00.000Z","formattedDate":"2021\u5e746\u670828\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":10.055,"truncated":true,"authors":[{"name":"\u738b\u9662\u751f","url":"https://github.com/membphis","imageURL":"https://avatars.githubusercontent.com/u/6814606?v=4"}],"prevItem":{"title":"Apache APISIX 2.7.0 \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/06/29/release-apache-apisix-2.7"},"nextItem":{"title":"\u4f7f\u7528 Rancher \u6781\u901f\u90e8\u7f72\u66f4\u597d\u7528\u7684\u5f00\u6e90\u7f51\u5173\u548c Ingress \u63a7\u5236\u5668","permalink":"/zh/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86 Kong \u548c NGINX \u7684\u75db\u70b9\uff0c\u4ee5\u53ca Apache APISIX \u5982\u4f55\u89e3\u51b3\u5b83\u4eec\u7684\u75db\u70b9\uff0c\u5e76\u4e14\u4e3a\u4f60\u4ecb\u7ecd\u4e86 Apache APISIX \u7684\u5e94\u7528\u573a\u666f\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u4e91\u539f\u751f\u65f6\u4ee3\uff0c\u52a8\u6001\u548c\u53ef\u89c2\u6d4b\u6027\u6210\u4e3a\u8861\u91cf API \u7f51\u5173\u7684\u6807\u51c6\u4e4b\u4e00\u3002Apache APISIX \u81ea\u8bde\u751f\u4e4b\u521d\u5c31\u4e00\u76f4\u8ddf\u968f\u7740\u4e91\u539f\u751f\u7684\u811a\u6b65\u524d\u884c\u3002\u7136\u800c Apache APISIX \u4f5c\u4e3a\u4e00\u4e2a\u8bde\u751f\u521a\u521a\u4e09\u5e74\u7684\u65b0\u4e00\u4ee3\u7f51\u5173\uff0c\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u4ece\u8bde\u751f 20 \u591a\u5e74\u7684 NGINX \u4e0e\u5f00\u6e90 8 \u5e74\u7684 Kong \u4e2d\u7a81\u51fa\u91cd\u56f4\uff0c\u6210\u4e3a\u4e91\u539f\u751f\u65f6\u4ee3\u6700\u6d41\u884c\u4ee5\u53ca\u6700\u6d3b\u8dc3\u7684\u7f51\u5173\uff1f\u6211\u8ba4\u4e3a\u5176\u4e2d\u6700\u91cd\u8981\u7684\u539f\u56e0\u662f\u89e3\u51b3\u4e86\u5f00\u53d1\u8005\u548c\u4f01\u4e1a\u5728\u4f7f\u7528 NGINX \u548c Kong \u4e2d\u7684\u75db\u70b9\u3002\\n\\n## NGINX \u4e0e Kong \u7684\u75db\u70b9\\n\\n\u5728\u5355\u4f53\u670d\u52a1\u65f6\u4ee3\uff0c\u4f7f\u7528 NGINX \u53ef\u4ee5\u5e94\u5bf9\u5927\u591a\u6570\u7684\u573a\u666f\uff0c\u800c\u5230\u4e86\u4e91\u539f\u751f\u65f6\u4ee3\uff0cNGINX \u56e0\u4e3a\u5176\u81ea\u8eab\u67b6\u6784\u7684\u539f\u56e0\u5219\u4f1a\u51fa\u73b0\u4e24\u4e2a\u95ee\u9898\uff1a\\n\\n- \u9996\u5148\u662f NGINX \u4e0d\u652f\u6301\u96c6\u7fa4\u7ba1\u7406\u3002\u51e0\u4e4e\u6bcf\u5bb6\u4e92\u8054\u7f51\u5382\u5546\u90fd\u6709\u81ea\u5df1\u7684 NGINX \u914d\u7f6e\u7ba1\u7406\u7cfb\u7edf\uff0c\u7cfb\u7edf\u867d\u7136\u5927\u540c\u5c0f\u5f02\u4f46\u662f\u4e00\u76f4\u6ca1\u6709\u7edf\u4e00\u7684\u65b9\u6848\u3002\\n- \u5176\u6b21\u662f NGINX \u4e0d\u652f\u6301\u914d\u7f6e\u7684\u70ed\u52a0\u8f7d\u3002\u5f88\u591a\u516c\u53f8\u4e00\u65e6\u4fee\u6539\u4e86\u914d\u7f6e\uff0c\u91cd\u65b0\u52a0\u8f7d NGINX \u7684\u65f6\u95f4\u53ef\u80fd\u9700\u8981\u534a\u4e2a\u5c0f\u65f6\u4ee5\u4e0a\u3002\u5e76\u4e14\u5728 Kubernetes \u4f53\u7cfb\u4e0b\uff0c\u4e0a\u6e38\u4f1a\u7ecf\u5e38\u53d1\u751f\u53d8\u5316\uff0c\u5982\u679c\u4f7f\u7528 NGINX \u6765\u5904\u7406\u5c31\u9700\u8981\u9891\u7e41\u91cd\u542f\u670d\u52a1\uff0c\u8fd9\u5bf9\u4e8e\u4f01\u4e1a\u662f\u4e0d\u53ef\u63a5\u53d7\u7684\u3002\\n\\n\u800c Kong \u7684\u51fa\u73b0\u5219\u89e3\u51b3\u4e86 NGINX \u7684\u75db\u70b9\uff0c\u4f46\u662f\u53c8\u5e26\u6765\u4e86\u65b0\u7684\u95ee\u9898\uff1a\\n\\n- Kong \u9700\u8981\u4f9d\u8d56\u4e8e PostgreSQL \u6216 Cassandra \u6570\u636e\u5e93\uff0c\u8fd9\u4f7f Kong \u7684\u6574\u4e2a\u67b6\u6784\u975e\u5e38\u81c3\u80bf\uff0c\u5e76\u4e14\u4f1a\u7ed9\u4f01\u4e1a\u5e26\u6765\u9ad8\u53ef\u7528\u7684\u95ee\u9898\u3002\u5982\u679c\u6570\u636e\u5e93\u6545\u969c\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a API \u7f51\u5173\u90fd\u4f1a\u51fa\u73b0\u6545\u969c\u3002\\n- Kong \u7684\u8def\u7531\u4f7f\u7528\u7684\u662f\u904d\u5386\u67e5\u627e\uff0c\u5f53\u7f51\u5173\u5185\u6709\u8d85\u8fc7\u4e0a\u5343\u4e2a\u8def\u7531\u65f6\uff0c\u5b83\u7684\u6027\u80fd\u5c31\u4f1a\u51fa\u73b0\u6bd4\u8f83\u6025\u5267\u7684\u4e0b\u964d\u3002\\n\\n\u800c APISIX \u7684\u51fa\u73b0\u5219\u89e3\u51b3\u4e86\u4e0a\u8ff0\u6240\u6709\u95ee\u9898\uff0c\u6210\u4e3a\u4e86\u4e91\u539f\u751f\u65f6\u4ee3\u6700\u5b8c\u7f8e\u7684 API \u7f51\u5173\u3002\u90a3\u4e48 Apache APISIX \u7684\u4f18\u52bf\u5230\u5e95\u662f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u5728\u77ed\u77ed\u4e09\u5e74\u7684\u65f6\u95f4\u91cc\u6210\u4e3a\u5168\u4e16\u754c\u6700\u6d3b\u8dc3\u7684\u7f51\u5173\uff1f\\n\\n## APISIX \u7684\u4f18\u52bf\\n\\n### \u4f18\u5f02\u7684\u67b6\u6784\\n\\n\u9996\u5148 Apache APISIX \u62e5\u6709\u4f18\u5f02\u7684\u67b6\u6784\uff0c\u73b0\u5728\u5f88\u591a\u5e94\u7528\u90fd\u5728\u5411\u5fae\u670d\u52a1\u3001\u5bb9\u5668\u5316\u8fc1\u79fb\uff0c\u5f62\u6210\u65b0\u7684\u4e91\u539f\u751f\u65f6\u4ee3\u3002\u4e91\u539f\u751f\u4f5c\u4e3a\u5f53\u4e0b\u7684\u6280\u672f\u6f6e\u6d41\uff0c\u5c06\u91cd\u5199\u4f20\u7edf\u4f01\u4e1a\u7684\u6280\u672f\u67b6\u6784\u3002\u800c APISIX \u81ea\u8bde\u751f\u4e4b\u521d\u5c31\u8ddf\u968f\u6280\u672f\u6f6e\u6d41\uff0c\u5e76\u5c06\u5176\u8bbe\u8ba1\u4e3a\u4e91\u539f\u751f\u67b6\u6784\uff1a\\n\\n![APISIX](https://static.apiseven.com/2022/blog/0729/1.png)\\n\\n\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5de6\u53f3\u5206\u522b\u662f APISIX \u7684\u6570\u636e\u9762\uff08Data Plane\uff09\u548c\u63a7\u5236\u9762\uff08Control Plane\uff09\uff1a\\n\\n- \u6570\u636e\u9762\uff1a\u4ee5 NGINX \u7684\u7f51\u7edc\u5e93\u4e3a\u57fa\u7840\uff08\u672a\u4f7f\u7528 NGINX \u7684\u8def\u7531\u5339\u914d\u3001\u9759\u6001\u914d\u7f6e\u548c C \u6a21\u5757\uff09\uff0c\u4f7f\u7528Lua \u548c NGINX \u52a8\u6001\u63a7\u5236\u8bf7\u6c42\u6d41\u91cf\uff1b\\n- \u63a7\u5236\u9762\uff1a\u4f7f\u7528 etcd \u6765\u5b58\u50a8\u548c\u540c\u6b65\u7f51\u5173\u7684\u914d\u7f6e\u6570\u636e\uff0c\u7ba1\u7406\u5458\u901a\u8fc7 Admin API \u6216\u8005 Dashboard \u53ef\u4ee5\u5728\u6beb\u79d2\u7ea7\u522b\u5185\u901a\u77e5\u5230\u6240\u6709\u6570\u636e\u9762\u8282\u70b9\u3002\\n\\n\u5728\u66f4\u65b0\u6570\u636e\u4e0a\uff0cKong \u91c7\u7528\u8f6e\u8be2\u6570\u636e\u5e93\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u53ef\u80fd\u9700\u8981 5-10 \u79d2\u624d\u80fd\u83b7\u53d6\u5230\u6700\u65b0\u7684\u914d\u7f6e\uff1b\u800c APISIX \u5219\u91c7\u7528\u76d1\u542c etcd \u7684\u914d\u7f6e\u53d8\u66f4\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5c06\u65f6\u95f4\u63a7\u5236\u5728\u6beb\u79d2\u7ea7\uff0c\u8fbe\u5230\u5b9e\u65f6\u751f\u6548\u7684\u6548\u679c\u3002\\n\u800c\u4e14\u7531\u4e8e APISIX \u548c etcd \u5747\u652f\u6301\u591a\u70b9\u90e8\u7f72\uff0c\u56e0\u6b64\u5728 APISIX \u5f53\u524d\u67b6\u6784\u4e2d\uff0c\u4efb\u4f55\u4e00\u4e2a\u670d\u52a1\u51fa\u73b0\u5f02\u5e38\u5b95\u673a\u7b49\u4e8b\u6545\uff0c\u90fd\u4e0d\u4f1a\u5f71\u54cd APISIX \u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\u80fd\u529b\u3002\\n\\n### \u5b8c\u5584\u7684\u751f\u6001\\n\\n\u4e0b\u56fe\u4e3a APISIX \u7684\u751f\u6001\u56fe\uff0c\u4ece\u8be5\u56fe\u53ef\u4ee5\u51c6\u786e\u770b\u5230 APISIX \u5df2\u7ecf\u652f\u6301\u7684 7 \u5c42\u534f\u8bae\u6709 HTTP(S)\u3001HTTP2\u3001Dubbo \u548c\u7269\u8054\u7f51\u534f\u8bae MQTT \u7b49\u7b49\uff0c4 \u5c42\u534f\u8bae\u6709 TCP/UDP\u3002\\n\u53f3\u4fa7\u90e8\u5206\u5219\u662f\u4e00\u4e9b\u5f00\u6e90\u6216\u8005 SaaS \u670d\u52a1\uff0c\u6bd4\u5982 SkyWalking\u3001Prometheus \u3001Vault \u7b49\u7b49\u3002\u800c\u6700\u4e0b\u9762\u5219\u662f\u6bd4\u8f83\u5e38\u89c1\u7684\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u3001\u4e91\u5382\u5546\u548c\u786c\u4ef6\u73af\u5883\u3002\u800c\u4f5c\u4e3a\u4e00\u4e2a\u5f00\u6e90\u8f6f\u4ef6\uff0cAPISIX \u4e5f\u652f\u6301\u5728 ARM64 \u7684\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u3002\\n\\n![APISIX\'s Ecosystem](https://static.apiseven.com/2022/blog/0729/2.PNG)\\n\\nAPISIX \u4e0d\u4ec5\u652f\u6301\u4f17\u591a\u534f\u8bae\u4e0e\u64cd\u4f5c\u7cfb\u7edf\uff0c\u800c\u4e14\u4e5f\u652f\u6301\u591a\u8bed\u8a00\u7f16\u7a0b\u63d2\u4ef6\u3002APISIX \u8bde\u751f\u4e4b\u521d\u4ec5\u652f\u6301\u4f7f\u7528 Lua \u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u9700\u8981\u5f00\u53d1\u8005\u638c\u63e1 Lua \u548c NGINX \u76f8\u5173\u7684\u6280\u672f\u6808\u3002\u7136\u800c Lua \u548c NGINX \u5c5e\u4e8e\u76f8\u5bf9\u5c0f\u4f17\u7684\u6280\u672f\uff0c\u5f00\u53d1\u8005\u5f88\u5c11\u3002\u56e0\u6b64\u6211\u4eec\u5728 APISIX \u4e0a\u652f\u6301\u4e86\u591a\u8bed\u8a00\u5f00\u53d1\u63d2\u4ef6\uff0c\u76ee\u524d\u5df2\u7ecf\u6b63\u5f0f\u652f\u6301\u4e86 Java\u3001Golang\u3001Node.js\u3001Python \u7b49\u8bed\u8a00\u3002\\n\\n![programming language](https://static.apiseven.com/2022/blog/0729/3.png)\\n\\n### \u6d3b\u8dc3\u7684\u793e\u533a\\n\\n\u4e0b\u56fe\u662f\u8d21\u732e\u8005\u589e\u957f\u66f2\u7ebf\uff0c\u5176\u4e2d\u6a2a\u5750\u6807\u4ee3\u8868\u65f6\u95f4\u7ebf\uff0c\u7eb5\u5750\u6807\u4ee3\u8868\u8d21\u732e\u8005\u603b\u6570\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230 APISIX \u548c Kong \u8fd9\u4e24\u4e2a\u9879\u76ee\u76f8\u5bf9\u66f4\u6d3b\u8dc3\uff0cAPISIX \u7684\u589e\u957f\u901f\u5ea6\u4ece\u5f00\u6e90\u7b2c\u4e00\u5929\u5c31\u4fdd\u6301\u7740\u975e\u5e38\u4e0d\u9519\u7684\u589e\u957f\u7387\uff0c\u5728\u4ee5\u63a5\u8fd1 Kong \u4e24\u500d\u7684\u901f\u5ea6\u5feb\u901f\u6210\u957f\uff0c\u5e76\u4e14\u8d21\u732e\u8005\u6570\u91cf\u5df2\u7ecf\u8fdc\u8fdc\u8d85\u8fc7\u4e86 Kong\uff0c\u7531\u6b64\u53ef\u89c1 APISIX \u53d7\u6b22\u8fce\u7a0b\u5ea6\u3002\u5f53\u7136\u8bc4\u4ef7\u4e00\u4e2a\u9879\u76ee\u6d3b\u8dc3\u5ea6\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u65b9\u6cd5\uff0c\u6bd4\u5982\u67e5\u770b\u6bcf\u6708\u6d3b\u8dc3 Issue\u3001PR \u603b\u6570\u7b49\u65b9\u5f0f\uff0c\u503c\u5f97\u9ad8\u5174\u7684\u662f APISIX \u5728\u8fd9\u4e9b\u65b9\u9762\u4e5f\u662f\u4e00\u9a91\u7edd\u5c18\u3002\\n\\n![Contributor graph](https://static.apiseven.com/2022/blog/0729/4.png)\\n\\n## APISIX \u7684\u5e94\u7528\u573a\u666f\\n\\n\u4ece\u4e0b\u56fe\u4e2d\uff0c\u76f8\u4fe1\u4f60\u5df2\u7ecf\u770b\u51fa APISIX \u7684\u76ee\u6807\uff1a**\u7edf\u4e00\u4ee3\u7406\u57fa\u7840\u8bbe\u65bd**\u3002\\n\\n![APISIX Application scenarios](https://static.apiseven.com/2022/blog/0729/5.png)\\n\\n\u4e5f\u8bb8\u4f60\u4f1a\u6709\u7591\u95ee\uff1aAPISIX \u8981\u652f\u6301\u8fd9\u4e48\u591a\u573a\u666f\uff0c\u662f\u5426\u4f1a\u8ba9 APISIX \u53d8\u5f97\u56db\u4e0d\u50cf\uff1f\\n\\n\u56e0\u4e3a APISIX \u7684\u6838\u5fc3\u662f\u9ad8\u6027\u80fd\u4ee3\u7406\u670d\u52a1\uff0c\u81ea\u8eab\u4e0d\u7ed1\u5b9a\u4efb\u4f55\u73af\u5883\u5c5e\u6027\u3002\u5f53\u5b83\u6f14\u53d8\u4e3a Ingress\u3001\u670d\u52a1\u7f51\u683c\u7b49\u4ea7\u54c1\u65f6\uff0c\u90fd\u662f\u5916\u90e8\u670d\u52a1\u4e0e APISIX \u914d\u5408\uff0c\u53d8\u5316\u7684\u662f\u5916\u90e8\u7a0b\u5e8f\u800c\u4e0d\u662f APISIX \u81ea\u8eab\uff0c\u4e0b\u9762\u5c06\u9010\u6b65\u4e3a\u5927\u5bb6\u4ecb\u7ecd APISIX \u662f\u5982\u4f55\u652f\u6301\u8fd9\u4e9b\u573a\u666f\u7684\u3002\\n\\n### Load Balancer \u548c API \u7f51\u5173\\n\\n\u9996\u5148\u662f\u9488\u5bf9\u4f20\u7edf\u7684 LB \u548c API \u7f51\u5173\u573a\u666f\uff0c\u56e0\u4e3a APISIX \u57fa\u4e8e NGINX + LuaJIT \u5b9e\u73b0\uff0c\u6240\u4ee5\u5929\u7136\u5177\u5907\u9ad8\u6027\u80fd\u3001\u5b89\u5168\u7b49\u7279\u6027\uff0c\u5e76\u4e14\u539f\u751f\u652f\u6301\u4e86\u52a8\u6001 SSL \u8bc1\u4e66\u5378\u8f7d\u3001SSL \u63e1\u624b\u4f18\u5316\u7b49\u529f\u80fd\uff0c\u5728\u8d1f\u8f7d\u5747\u8861\u7684\u670d\u52a1\u80fd\u529b\u4e0a\u4e5f\u66f4\u4f18\u79c0\u3002\u4ece NGINX \u5207\u6362\u5230 APISIX \u4e0d\u4ec5\u6027\u80fd\u4e0d\u4f1a\u4e0b\u964d\uff0c\u800c\u4e14\u53ef\u4ee5\u4eab\u53d7\u5230\u52a8\u6001\u3001\u7edf\u4e00\u7ba1\u7406\u7b49\u7279\u6027\u5e26\u6765\u7684\u7ba1\u7406\u6548\u7387\u7684\u63d0\u5347\u3002\\n\\n### \u5fae\u670d\u52a1\u7f51\u5173\\n\\nAPISIX \u76ee\u524d\u652f\u6301\u591a\u79cd\u8bed\u8a00\u7f16\u5199\u6269\u5c55\u63d2\u4ef6\uff0c\u53ef\u4ee5\u89e3\u51b3\u4e1c\u897f\u5411\u5fae\u670d\u52a1 API \u7f51\u5173\u9762\u4e34\u7684\u4e3b\u8981\u95ee\u9898\u2014\u2014\u5f02\u6784\u591a\u8bed\u8a00\u548c\u901a\u7528\u95ee\u9898\u3002\u5185\u7f6e\u652f\u6301\u7684\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3\u6709 Nacos\u3001etcd\u3001Eureka \u7b49\uff0c\u8fd8\u6709\u6807\u51c6\u7684 DNS \u65b9\u5f0f\uff0c\u53ef\u4ee5\u5e73\u6ed1\u66ff\u4ee3 Zuul\u3001Spring Cloud Gateway\u3001Dubbo \u7b49\u5fae\u670d\u52a1 API \u7f51\u5173\u3002\\n\\n### Kubernetes Ingress\\n\\n\u76ee\u524d K8s \u5b98\u65b9 Kubernetes Ingress Controller \u9879\u76ee\u4e3b\u8981\u57fa\u4e8e NGINX \u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u5f0f\uff0c\u6240\u4ee5\u5728\u8def\u7531\u80fd\u529b\u548c\u52a0\u8f7d\u6a21\u5f0f\u4e0a\u7a0d\u663e\u4e0d\u8db3\uff0c\u5e76\u4e14\u5b58\u5728\u4e00\u4e9b\u660e\u663e\u52a3\u52bf\u3002\u6bd4\u5982\u6dfb\u52a0\u3001\u4fee\u6539\u4efb\u4f55 API \u65f6\uff0c\u9700\u8981\u91cd\u542f\u670d\u52a1\u624d\u80fd\u5b8c\u6210\u65b0 NGINX \u914d\u7f6e\u7684\u66f4\u65b0\uff0c\u4f46\u91cd\u542f\u670d\u52a1\uff0c\u5bf9\u7ebf\u4e0a\u6d41\u91cf\u7684\u5f71\u54cd\u662f\u975e\u5e38\u5927\u7684\u3002\\n\\n\u800c [APISIX Ingress Controller](https://apisix.apache.org/zh/docs/ingress-controller/getting-started/) \u5219\u5b8c\u7f8e\u89e3\u51b3\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u6240\u6709\u95ee\u9898\uff1a\u652f\u6301\u5168\u52a8\u6001\uff0c\u65e0\u9700\u91cd\u542f\u52a0\u8f7d\u3002\u540c\u65f6\u7ee7\u627f\u4e86 APISIX \u7684\u6240\u6709\u4f18\u52bf\uff0c\u8fd8\u652f\u6301\u539f\u751f Kubernetes CRD\uff0c\u65b9\u4fbf\u7528\u6237\u8fc1\u79fb\u3002\\n\\n![APISIX Kubernetes Ingress](https://static.apiseven.com/2022/blog/0729/6.png)\\n\\n### \u670d\u52a1\u7f51\u683c\\n\\n\u672a\u6765\u4e94\u5230\u5341\u5e74\uff0c\u57fa\u4e8e\u4e91\u539f\u751f\u6a21\u5f0f\u67b6\u6784\u4e0b\u7684\u670d\u52a1\u7f51\u683c\u67b6\u6784\u5f00\u59cb\u5d2d\u9732\u5934\u89d2\u3002APISIX \u4e5f\u63d0\u524d\u5f00\u59cb\u9501\u5b9a\u8d5b\u9053\uff0c\u901a\u8fc7\u8c03\u7814\u548c\u6280\u672f\u5206\u6790\u540e\uff0cAPISIX \u5df2\u7ecf\u652f\u6301\u4e86 xDS \u534f\u8bae\uff0cAPISIX Mesh \u5c31\u6b64\u8bde\u751f\uff0c\u5728\u670d\u52a1\u7f51\u683c\u9886\u57df  APISIX \u4e5f\u62e5\u6709\u4e86\u4e00\u5e2d\u4e4b\u5730\u3002\\n\\n![APISXI Mesh](https://static.apiseven.com/2022/blog/0729/7.png)\\n\\n## \u603b\u7ed3\\n\\nApache APISIX \u81ea\u5f00\u6e90\u7b2c\u4e00\u5929\uff0c\u8fc4\u4eca\u4e3a\u6b62\u5df2\u7ecf\u6709\u4e09\u5e74\u7684\u65f6\u95f4\u4e86\uff0c\u9ad8\u6d3b\u8dc3\u5ea6\u7684\u793e\u533a\u4ee5\u53ca\u5b9e\u9645\u7684[\u7528\u6237\u6848\u4f8b](https://apisix.apache.org/zh/blog/tags/case-studies/)\u8bc1\u660e\u4e86 APISIX \u662f\u4e91\u539f\u751f\u65f6\u4ee3\u6700\u5b8c\u7f8e\u7684 API \u7f51\u5173\u3002\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u76f8\u4fe1\u4f60\u5df2\u7ecf\u5bf9 APISIX \u6709\u4e86\u66f4\u5168\u9762\u7684\u8ba4\u8bc6\uff0c\u671f\u5f85\u4f60\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528 APISIX \u4f5c\u4e3a\u4f60\u7684 API \u7f51\u5173\u3002\\n\\n\u66f4\u591a\u4fe1\u606f\u8bf7\u89c2\u770b[\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX?](https://www.bilibili.com/video/BV1w54y1V73Z?p=1&share_medium=android&share_plat=android&share_source=COPY&share_tag=s_i&timestamp=1621812452&unique_k=PEusrt)"},{"id":"\u4f7f\u7528 Rancher \u6781\u901f\u90e8\u7f72\u66f4\u597d\u7528\u7684\u5f00\u6e90\u7f51\u5173\u548c Ingress \u63a7\u5236\u5668","metadata":{"permalink":"/zh/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast","source":"@site/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast.md","title":"\u4f7f\u7528 Rancher \u6781\u901f\u90e8\u7f72\u66f4\u597d\u7528\u7684\u5f00\u6e90\u7f51\u5173\u548c Ingress \u63a7\u5236\u5668","description":"\u901a\u8fc7 API \u7f51\u5173 Apache APISIX Helm \u4ed3\u5e93\u53ef\u76f4\u63a5\u90e8\u7f72 APISIX \u548c APISIX Ingress Controller \u5728 Rancher \u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7\u5b83\u4eec\u6765\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u3002","date":"2021-06-23T00:00:00.000Z","formattedDate":"2021\u5e746\u670823\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":5.645,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","url":"https://github.com/tao12345666333","imageURL":"https://avatars.githubusercontent.com/u/3264292?v=4"}],"prevItem":{"title":"\u6709\u4e86 NGINX \u548c Kong\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 Apache APISIX","permalink":"/zh/blog/2021/06/28/why-we-need-apache-apisix"},"nextItem":{"title":"\u4f7f\u7528 Java \u7f16\u5199 Apache APISIX \u63d2\u4ef6","permalink":"/zh/blog/2021/06/21/use-java-to-write-apache-apisix-plugins"}},"content":"> \u4f60\u53ef\u4ee5\u5728 Rancher \u4e2d\u4f7f\u7528 Apache APISIX \u7684\u5b98\u65b9 Helm \u4ed3\u5e93\u76f4\u63a5\u90e8\u7f72 Apache APISIX \u548c APISIX Ingress controller\u3002\u5e76\u4e14 Apache APISIX \u53ef\u901a\u8fc7\u4f5c\u4e3a\u7f51\u5173\uff0c\u6216\u8005 APISIX Ingress controller \u7684\u6570\u636e\u9762\u6765\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u3002\\n\\n\x3c!--truncate--\x3e\\n## Rancher \u4ecb\u7ecd\\n\\nRancher \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4f01\u4e1a\u7ea7\u591a\u96c6\u7fa4 Kubernetes \u7ba1\u7406\u5e73\u53f0\uff0c\u5b9e\u73b0\u4e86 Kubernetes \u96c6\u7fa4\u5728\u6df7\u5408\u4e91+\u672c\u5730\u6570\u636e\u4e2d\u5fc3\u7684\u96c6\u4e2d\u90e8\u7f72\u4e0e\u7ba1\u7406\uff0c\u4ee5\u786e\u4fdd\u96c6\u7fa4\u7684\u5b89\u5168\u6027\uff0c\u52a0\u901f\u4f01\u4e1a\u6570\u5b57\u5316\u8f6c\u578b\u3002\\n\\n## Apache APISIX \u4ecb\u7ecd\\n\\nApache APISIX \u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u9ad8\u6027\u80fd\u3001\u52a8\u6001\u4e91\u539f\u751f\u7f51\u5173\uff0c\u7531\u6df1\u5733[\u652f\u6d41\u79d1\u6280](https://api7.ai/)\u6709\u9650\u516c\u53f8\u4e8e 2019 \u5e74\u6350\u8d60\u7ed9 Apache \u57fa\u91d1\u4f1a\uff0c\u5f53\u524d\u5df2\u7ecf\u6210\u4e3a Apache \u57fa\u91d1\u4f1a\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u662f GitHub \u4e0a\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\u3002Apache APISIX \u5f53\u524d\u5df2\u7ecf\u8986\u76d6\u4e86 API \u7f51\u5173\uff0cLB\uff0cKubernetes Ingress\uff0cService Mesh \u7b49\u591a\u79cd\u573a\u666f\u3002\\n\\n## \u524d\u7f6e\u6761\u4ef6\\n\\n- \u5c06\u73b0\u6709 Kubernetes \u96c6\u7fa4\u5df2\u7eb3\u5165 Rancher \u7ba1\u7406\u3002\\n\\n## \u90e8\u7f72 Apache APISIX \u548c Apache APISIX Ingress controller\\n\\n\u5728 Rancher \u7684 *Tools - Catalogs* \u9875\u9762\u53ef\u4ee5\u8fdb\u884c\u5546\u5e97\uff08catalogs\uff09\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u5728\u8fd9\u91cc[\u6dfb\u52a0 Apache APISIX \u7684 Helm \u4ed3\u5e93](https://github.com/apache/apisix-helm-chart)\u3002\\n\\n![2021-06-23-1](https://static.apiseven.com/202108/1639464984786-20a73a62-1e9d-463b-aac3-26ac18ab5228.png)\\n\\n\u4fdd\u5b58\u5b8c\u6210\u540e\uff0c\u5373\u53ef\u9009\u62e9 *Apps* \u9875\u9762\u8fdb\u884c Apache APISIX \u7684\u90e8\u7f72\u4e86\u3002\u9009\u62e9 *Launch* \u4fbf\u53ef\u770b\u5230 Apache APISIX \u7684\u4ed3\u5e93\u4fe1\u606f\u4e86\u3002\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u9009\u62e9 apisix \u5373\u53ef\u3002\\n\\n![2021-06-23-2](https://static.apiseven.com/202108/1639465059361-aa11ab87-11f7-45b6-964f-d285d41e8a39.png)\\n\\n![2021-06-23-3](https://static.apiseven.com/202108/1639465129809-bf86383f-bab5-459d-bb02-e7d45e3b4c51.png)\\n\\n\u63a5\u4e0b\u6765\u7740\u53ea\u9700\u8981\u5728\u6b64\u9875\u9762\u4e2d\u8fdb\u884c\u7b80\u5355\u7684\u914d\u7f6e\u5373\u53ef\u3002 **\u56e0\u4e3a\u6211\u4eec\u60f3\u8981\u540c\u65f6\u90e8\u7f72 APISIX Ingress controller\uff0c\u6240\u4ee5\u5728\u5e95\u90e8\u7684 Answers \u4e2d\u586b\u5165 `ingress-controller.enabled=true` \u8fd9\u4e2a\u914d\u7f6e\u9879** \u3002\u4fdd\u5b58\u5373\u53ef\u5b8c\u6210\u90e8\u7f72\u3002\\n\\n![2021-06-23-4](https://static.apiseven.com/202108/1639465197713-4ba6e7a2-8824-42e6-bf27-1d49f4e60ce5.png)\\n\\n\u7a0d\u7b49\u7247\u523b\u5373\u53ef\u5b8c\u6210\u90e8\u7f72\u3002\\n\\n![2021-06-23-5](https://static.apiseven.com/202108/1639465259396-fc1104e9-289d-41b6-ae23-d6e05da066b1.png)\\n\\n## \u90e8\u7f72\u793a\u4f8b\u9879\u76ee\\n\\n\u6211\u4eec\u4f7f\u7528 `kennethreitz/httpbin` \u4f5c\u4e3a\u793a\u4f8b\u9879\u76ee\u8fdb\u884c\u6f14\u793a\u3002\u8fd9\u91cc\u4e5f\u76f4\u63a5\u5728 Rancher \u4e2d\u5b8c\u6210\u90e8\u7f72\u3002\\n\\n![2021-06-23-6](https://static.apiseven.com/202108/1639465331864-d8160567-d30c-427a-b0e5-425df6657879.png)\\n\\n## \u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u7f51\u5173\u4ee3\u7406\\n\\n\u6211\u4eec\u5148\u6f14\u793a\u5982\u4f55\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u7f51\u5173\u4ee3\u7406 Kubernetes \u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u3002\\n\\n```shell\\nroot@apisix:~$ kubectl -n apisix exec -it `kubectl -n apisix get pods -l app.kubernetes.io/name=apisix -o name` -- bash\\nbash-5.1# curl httpbin.default/get\\n{\\n  \\"args\\": {},\\n  \\"headers\\": {\\n    \\"Accept\\": \\"*/*\\",\\n    \\"Host\\": \\"httpbin.default\\",\\n    \\"User-Agent\\": \\"curl/7.76.1\\"\\n  },\\n  \\"origin\\": \\"10.244.3.3\\",\\n  \\"url\\": \\"http://httpbin.default/get\\"\\n}\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u5728 Apache APISIX \u7684 Pod \u5185\u53ef\u6b63\u5e38\u8bbf\u95ee\u793a\u4f8b\u9879\u76ee\u3002\u63a5\u4e0b\u6765\u4f7f\u7528 Apache APISIX \u5bf9\u8be5\u793a\u4f8b\u9879\u76ee\u8fdb\u884c\u4ee3\u7406\u3002\\n\\n\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 `curl` \u8c03\u7528 Apache APISIX \u7684 admin \u63a5\u53e3\uff0c\u521b\u5efa\u4e00\u6761\u8def\u7531\u3002\u5c06\u6240\u6709 host \u5934\u4e3a `httpbin.org` \u7684\u8bf7\u6c42\u8f6c\u53d1\u7ed9 `httpbin.default:80` \u8fd9\u4e2a\u5b9e\u9645\u7684\u5e94\u7528\u670d\u52a1\u4e0a\u3002\\n\\n```shell\\nbash-5.1# curl \\"http://127.0.0.1:9180/apisix/admin/routes/1\\" -H \\"X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\\" -X PUT -d \'\\n{\\n  \\"uri\\": \\"/*\\",\\n  \\"host\\": \\"httpbin.org\\",\\n  \\"upstream\\": {\\n    \\"type\\": \\"roundrobin\\",\\n    \\"nodes\\": {\\n      \\"httpbin.default:80\\": 1\\n    }\\n  }\\n}\'\\n{\\"action\\":\\"set\\",\\"node\\":{\\"value\\":{\\"uri\\":\\"\\\\/*\\",\\"create_time\\":1623834078,\\"update_time\\":1623834078,\\"priority\\":0,\\"upstream\\":{\\"type\\":\\"roundrobin\\",\\"hash_on\\":\\"vars\\",\\"pass_host\\":\\"pass\\",\\"nodes\\":{\\"httpbin.default:80\\":1},\\"scheme\\":\\"http\\"},\\"id\\":\\"1\\",\\"status\\":1,\\"host\\":\\"httpbin.org\\"},\\"key\\":\\"\\\\/apisix\\\\/routes\\\\/1\\"}}\\n```\\n\\n\u4f60\u4f1a\u5f97\u5230\u7c7b\u4f3c\u4e0a\u9762\u7684\u8f93\u51fa\uff0c\u63a5\u4e0b\u6765\u9a8c\u8bc1\u662f\u5426\u4ee3\u7406\u6210\u529f\uff1a\\n\\n```shell\\nbash-5.1# curl http://127.0.0.1:9080/get -H \\"HOST: httpbin.org\\"\\n{\\n  \\"args\\": {},\\n  \\"headers\\": {\\n    \\"Accept\\": \\"*/*\\",\\n    \\"Host\\": \\"httpbin.org\\",\\n    \\"User-Agent\\": \\"curl/7.76.1\\",\\n    \\"X-Forwarded-Host\\": \\"httpbin.org\\"\\n  },\\n  \\"origin\\": \\"127.0.0.1\\",\\n  \\"url\\": \\"http://httpbin.org/get\\"\\n}\\n```\\n\\n\u5f97\u5230\u4e0a\u9762\u7684\u8f93\u51fa\uff0c\u8bf4\u660e\u5df2\u7ecf\u901a\u8fc7 Apache APISIX \u4ee3\u7406\u4e86\u793a\u4f8b\u9879\u76ee\u7684\u6d41\u91cf\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8bd5\u8bd5\u5728\u96c6\u7fa4\u5916\u901a\u8fc7 Apache APISIX \u8bbf\u95ee\u793a\u4f8b\u9879\u76ee\u3002\\n\\n```shell\\nroot@apisix:~$ kubectl  -n apisix get svc -l app.kubernetes.io/name=apisix\\nNAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\\napisix-admin     ClusterIP   10.96.142.88    <none>        9180/TCP       51m\\napisix-gateway   NodePort    10.96.158.192   <none>        80:32763/TCP   51m\\n```\\n\\n\u5728\u4f7f\u7528 Helm chart \u90e8\u7f72\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u4f1a\u5c06 Apache APISIX \u7684\u7aef\u53e3\u901a\u8fc7 NodePort \u7684\u5f62\u5f0f\u66b4\u9732\u51fa\u53bb\u3002\u6211\u4eec\u4f7f\u7528 Node IP + NodePort \u7684\u7aef\u53e3\u8fdb\u884c\u8bbf\u95ee\u6d4b\u8bd5\u3002\\n\\n```shell\\nroot@apisix:~$ curl http://172.18.0.2:32763/get -H \\"HOST: httpbin.org\\"\\n{\\n  \\"args\\": {},\\n  \\"headers\\": {\\n    \\"Accept\\": \\"*/*\\",\\n    \\"Host\\": \\"httpbin.org\\",\\n    \\"User-Agent\\": \\"curl/7.58.0\\",\\n    \\"X-Forwarded-Host\\": \\"httpbin.org\\"\\n  },\\n  \\"origin\\": \\"10.244.3.1\\",\\n  \\"url\\": \\"http://httpbin.org/get\\"\\n}\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\uff0c**\u5728\u96c6\u7fa4\u5916\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7 Apache APISIX \u4f5c\u4e3a\u7f51\u5173\u4ee3\u7406 Kubernetes \u96c6\u7fa4\u5185\u7684\u670d\u52a1\u4e86\u3002**\\n\\n## \u4f7f\u7528 APISIX Ingress controller \u4ee3\u7406\u670d\u52a1\\n\\n\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728 Rancher \u4e2d\u6dfb\u52a0 Ingress \uff0cApache APISIX Ingress controller \u4f1a\u81ea\u52a8\u5c06\u8def\u7531\u89c4\u5219\u540c\u6b65\u81f3 Apache APISIX \u4e2d\uff0c\u5b8c\u6210\u670d\u52a1\u7684\u4ee3\u7406\u3002\\n\\n![2021-06-23-7](https://static.apiseven.com/202108/1639465402058-3f41e8de-033b-4888-a835-30969251e402.png)\\n\\n\u6ce8\u610f\u53f3\u4e0b\u89d2\uff0c \u6211\u4eec\u6dfb\u52a0\u4e86 `kubernetes.io/ingress.class: apisix` \u7684 annotation \u914d\u7f6e\uff0c\u7528\u4e8e\u652f\u6301\u96c6\u7fa4\u5185\u591a ingress-controller \u7684\u573a\u666f\u3002\\n\\n\u4fdd\u5b58\u540e\uff0c\u53ef\u770b\u5230\u5982\u4e0b\u754c\u9762\uff1a\\n\\n![2021-06-23-8](https://static.apiseven.com/202108/1639465466581-db8c19d7-9c8f-402c-9270-34e327908caa.png)\\n\\n\u5728\u7ec8\u7aef\u4e0b\u6d4b\u8bd5\u662f\u5426\u4ee3\u7406\u6210\u529f\uff1a\\n\\n```shell\\nroot@apisix:~$ curl http://172.18.0.2:32763/get -H \\"HOST: httpbin-ing.org\\"\\n{\\n  \\"args\\": {},\\n  \\"headers\\": {\\n    \\"Accept\\": \\"*/*\\",\\n    \\"Host\\": \\"httpbin-ing.org\\",\\n    \\"User-Agent\\": \\"curl/7.58.0\\",\\n    \\"X-Forwarded-Host\\": \\"httpbin-ing.org\\"\\n  },\\n  \\"origin\\": \\"10.244.3.1\\",\\n  \\"url\\": \\"http://httpbin-ing.org/get\\"\\n}\\n```\\n\\n\u53ef\u4ee5\u770b\u5230\u4e5f\u6b63\u5e38\u4ee3\u7406\u4e86\u3002\\n\\n\u9664\u4e86\u4ee5\u4e0a\u65b9\u5f0f\u5916\uff0cApache APISIX Ingress controller \u901a\u8fc7 CRD \u7684\u65b9\u5f0f\u5bf9 Kubernetes \u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u53d1\u5e03 `ApisixRoute` \u7b49\u8fd9\u79cd\u81ea\u5b9a\u4e49\u8d44\u6e90\u6765\u5b8c\u6210 Kubernetes \u4e2d\u670d\u52a1\u7684\u5bf9\u5916\u66b4\u9732\u3002\\n\\n## \u603b\u7ed3\\n\\n\u4f60\u53ef\u4ee5\u5728 Rancher \u4e2d\u4f7f\u7528 Apache APISIX \u7684\u5b98\u65b9 Helm \u4ed3\u5e93\u76f4\u63a5\u90e8\u7f72 Apache APISIX \u548c APISIX Ingress controller \u3002\u5e76\u4e14 Apache APISIX \u53ef\u901a\u8fc7\u4f5c\u4e3a\u7f51\u5173\uff0c\u6216\u8005 APISIX Ingress controller \u7684\u6570\u636e\u9762\u6765\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\u3002\\n\\n## \u672a\u6765\u5c55\u671b\\n\\nApache APISIX \u5df2\u7ecf\u4e0e Rancher \u793e\u533a\u8fbe\u6210\u5408\u4f5c\uff0c\u672a\u6765\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728 Rancher \u81ea\u5e26\u7684\u5e94\u7528\u4ed3\u5e93\u4e2d\u627e\u5230 Apache APISIX \uff0c\u4e0d\u518d\u9700\u8981\u624b\u52a8\u6dfb\u52a0 Helm \u4ed3\u5e93\u4e86\u3002"},{"id":"2021/06/21/use-java-to-write-apache-apisix-plugins","metadata":{"permalink":"/zh/blog/2021/06/21/use-java-to-write-apache-apisix-plugins","source":"@site/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins.md","title":"\u4f7f\u7528 Java \u7f16\u5199 Apache APISIX \u63d2\u4ef6","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u5df2\u7ecf\u652f\u6301\u4e86 Java \u7f16\u5199\u63d2\u4ef6\uff0c\u4f7f\u7528\u8005\u4e0d\u4ec5\u53ef\u4ee5\u4f7f\u7528 Java \u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u878d\u5165 Spring Cloud \u751f\u6001\u5708\uff0c\u5e7f\u6cdb\u4f7f\u7528\u751f\u6001\u5708\u5185\u7684\u5404\u79cd\u6280\u672f\u7ec4\u4ef6\u3002","date":"2021-06-21T00:00:00.000Z","formattedDate":"2021\u5e746\u670821\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":7.23,"truncated":true,"authors":[{"name":"\u5c60\u6b63\u677e","url":"https://github.com/tzssangglass","imageURL":"https://avatars.githubusercontent.com/u/30819887?v=4"}],"prevItem":{"title":"\u4f7f\u7528 Rancher \u6781\u901f\u90e8\u7f72\u66f4\u597d\u7528\u7684\u5f00\u6e90\u7f51\u5173\u548c Ingress \u63a7\u5236\u5668","permalink":"/zh/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast"},"nextItem":{"title":"Apache APISIX Ingress Controller \u9996\u4e2a GA \u7248\u672c v1.0 \u6b63\u5f0f\u53d1\u5e03\uff01","permalink":"/zh/blog/2021/06/18/first-ga-version-v1.0-of-apache-apisix-ingress-controller-released"}},"content":"> Apache APISIX \u652f\u6301\u591a\u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\u4e86\uff01\u4e0d\u4f1a Lua \u4e5f\u6ca1\u5173\u7cfb\uff0c\u73b0\u5728\u53ef\u4ee5\u7528\u4f60\u719f\u6089\u7684\u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\uff0c\u6587\u672b\u8fd8\u6709\u89c6\u9891\u6559\u7a0b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## 1. \u7b80\u4ecb\\n\\n### 1.1 \u4e3a\u4ec0\u4e48 Apache APISIX \u8981\u652f\u6301\u591a\u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\\n\\n\u5728\u652f\u6301\u591a\u8bed\u8a00\u7f16\u7a0b\u63d2\u4ef6\u524d\uff0cApache APISIX \u53ea\u652f\u6301\u4f7f\u7528 Lua \u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\uff0c\u9700\u8981\u5f00\u53d1\u8005\u638c\u63e1 Lua \u548c OpenResty \u76f8\u5173\u7684\u5f00\u53d1\u80fd\u529b\u3002\u7136\u800c\u76f8\u5bf9\u4e8e\u4e3b\u6d41\u5f00\u53d1\u8bed\u8a00 Java\u3001Go \u6765\u8bf4\uff0cLua \u548c OpenResty \u5c5e\u4e8e\u76f8\u5bf9\u5c0f\u4f17\u7684\u6280\u672f\uff0c\u5f00\u53d1\u8005\u5f88\u5c11\u3002\u5982\u679c\u4ece\u5934\u5f00\u59cb\u5b66\u4e60 Lua \u548c OpenResty\uff0c\u9700\u8981\u4ed8\u51fa\u76f8\u5f53\u591a\u7684\u65f6\u95f4\u548c\u7cbe\u529b\u3002\\n\\n\u5f00\u53d1\u56e2\u961f\u5728\u8fdb\u884c\u6280\u672f\u9009\u578b\u7684\u65f6\u5019\uff0c\u6700\u91cd\u8981\u7684\u8003\u91cf\u5c31\u662f\u6240\u9009\u6280\u672f\u662f\u5426\u4e0e\u672c\u56e2\u961f\u6280\u672f\u6808\u76f8\u5339\u914d\uff0c\u7136\u800c\u5c0f\u4f17\u7684\u6280\u672f\u6808\u5c31\u9650\u5236\u4e86 Apache APISIX \u5728\u66f4\u5e7f\u9614\u7684\u573a\u666f\u4e0b\u8fdb\u884c\u6280\u672f\u843d\u5730\u3002\\n\\n\u73b0\u5728 Apache APISIX \u652f\u6301\u591a\u8bed\u8a00\u5f00\u53d1\u63d2\u4ef6\uff0c**\u66f4\u91cd\u8981\u7684\u662f\u652f\u6301\u8bed\u8a00\u6240\u5728\u7684\u5f00\u53d1\u751f\u6001\u5708\uff0c\u4f7f\u7528\u8005\u53ef\u4ee5\u4f7f\u7528\u81ea\u5df1\u719f\u6089\u7684\u6280\u672f\u6808\u6765\u5f00\u53d1 Apache APISIX**\u3002\u4ee5\u652f\u6301 Java \u4e3a\u4f8b\uff0c\u4f7f\u7528\u8005\u4e0d\u4ec5\u53ef\u4ee5\u4f7f\u7528 Java \u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u878d\u5165 Spring Cloud \u751f\u6001\u5708\uff0c\u5e7f\u6cdb\u4f7f\u7528\u751f\u6001\u5708\u5185\u7684\u5404\u79cd\u6280\u672f\u7ec4\u4ef6\u3002\\n\\n### 1.2 Apache APISIX \u591a\u8bed\u8a00\u652f\u6301\u67b6\u6784\u56fe\\n\\n![2021-06-21-1](https://static.apiseven.com/202108/1639464774923-50cebc94-6344-4ea6-88a6-2b424c5f8567.png)\\n\\n\u4e0a\u56fe\u5de6\u8fb9\u662f Apache APISIX \u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u53f3\u8fb9\u7684 plugin runner \u662f\u6307\u63d2\u4ef6\u8fd0\u884c\u5668\uff0c\u6cdb\u6307\u591a\u8bed\u8a00\u652f\u6301\u7684\u9879\u76ee\u3002\u672c\u6587\u6863\u4e0b\u9762\u63d0\u5230\u7684 apisix-java-plugin-runner \u9879\u76ee\u5c31\u662f\u652f\u6301 Java \u8bed\u8a00\u7684 plugin runner\u3002\\n\\n\u5f53\u4f60\u5728 Apache APISIX \u4e2d\u914d\u7f6e\u4e00\u4e2a plugin runner \u65f6\uff0cApache APISIX \u4f1a\u542f\u52a8\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u8fd0\u884c plugin runner\uff0c\u8be5\u5b50\u8fdb\u7a0b\u4e0e Apache APISIX \u8fdb\u7a0b\u5c5e\u4e8e\u540c\u4e00\u4e2a\u7528\u6237\u3002\u5f53\u6211\u4eec\u91cd\u542f\u6216\u91cd\u65b0\u52a0\u8f7d Apache APISIX \u65f6\uff0cplugin runner \u4e5f\u5c06\u88ab\u91cd\u542f\u3002\\n\\n\u5982\u679c\u4f60\u4e3a\u4e00\u4e2a\u7ed9\u5b9a\u7684\u8def\u7531\u914d\u7f6e\u4e86 ext-plugin-* \u63d2\u4ef6\uff0c\u547d\u4e2d\u8be5\u8def\u7531\u7684\u8bf7\u6c42\u5c06\u89e6\u53d1  Apache APISIX\uff0c\u901a\u8fc7 unix socket \u5411 plugin runner \u6267\u884c RPC \u8c03\u7528\u3002\u8c03\u7528\u7ec6\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a\\n\\n- ext-plugin-pre-req: \u5728\u6267\u884c Apache APISIX \u5185\u7f6e\u63d2\u4ef6(Lua \u8bed\u8a00\u63d2\u4ef6)\u4e4b\u524d\\n- ext-plugin-post-req: \u5728\u6267\u884c Apache APISIX \u5185\u7f6e\u63d2\u4ef6(Lua \u8bed\u8a00\u63d2\u4ef6)\u4e4b\u540e\\n\\n\u6839\u636e\u9700\u8981\u914d\u7f6e plugin runner \u7684\u6267\u884c\u65f6\u673a\u3002\\n\\nplugin runner \u4f1a\u5904\u7406 RPC \u8c03\u7528\uff0c\u5728\u5176\u5185\u90e8\u521b\u5efa\u4e00\u4e2a\u6a21\u62df\u8bf7\u6c42\uff0c\u7136\u540e\u8fd0\u884c\u591a\u8bed\u8a00\u7f16\u5199\u7684\u63d2\u4ef6\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9 Apache APISIX\u3002\\n\\n\u591a\u8bed\u8a00\u63d2\u4ef6\u7684\u6267\u884c\u987a\u5e8f\u662f\u5728 ext-plugin-* \u63d2\u4ef6\u914d\u7f6e\u9879\u4e2d\u5b9a\u4e49\u7684\u3002\u50cf\u5176\u4ed6\u63d2\u4ef6\u4e00\u6837\uff0c\u5b83\u4eec\u53ef\u4ee5\u88ab\u542f\u7528\u5e76\u5728\u8fd0\u884c\u4e2d\u91cd\u65b0\u5b9a\u4e49\u3002\\n\\n## 2. \u642d\u5efa\u5f00\u53d1\u73af\u5883\\n\\n\u9996\u5148\u9700\u8981\u642d\u5efa Apache APISIX \u7684\u8fd0\u884c\u73af\u5883\u6216\u8005\u5f00\u53d1\u73af\u5883\uff0c\u53c2\u8003 [\u6784\u5efa Apache APISIX](https://github.com/apache/apisix/blob/master/docs/zh/latest/how-to-build.md)\uff0c\u4ee5\u53ca Java \u9879\u76ee\u7684\u5f00\u53d1\u73af\u5883\uff0c\u53c2\u8003 [\u6784\u5efa apisix-java-plugin-runner](https://github.com/apache/apisix-java-plugin-runner/blob/main/docs/development.md)\u3002\\n\\n**\u6ce8\u610f**\uff1aApache APISIX \u548c apisix-java-plugin-runner \u9700\u8981\u4f4d\u4e8e\u540c\u4e00\u5b9e\u4f8b\u4e0a\u3002\\n\\n## 3. \u8fdb\u5165\u8c03\u8bd5\u6a21\u5f0f\\n\\n### 3.1 \u8bbe\u7f6e Apache APISIX \u8fdb\u5165\u8c03\u8bd5\u6a21\u5f0f\\n\\n\u8fd9\u91cc\u662f\u6307\u8ba9 Apache APISIX \u4ee5\u8c03\u8bd5\u7684\u65b9\u5f0f\u8fd0\u884c\u5916\u90e8\u63d2\u4ef6\uff0c\u5728 `config.yaml` \u4e2d\u589e\u52a0\u4ee5\u4e0b\u914d\u7f6e\\n\\n```text\\next-plugin:\\n  path_for_test: /tmp/runner.sock\\n```\\n\\n\u8fd9\u4e2a\u914d\u7f6e\u7684\u610f\u601d\u662f\uff0cApache APISIX  \u76f8\u5f53\u4e8e client \u7aef\uff0c\u4f1a\u76d1\u542c\u4f4d\u4e8e `/tmp/runner.sock` \u4f4d\u7f6e\u4e0a\u7684 Unxi Domain Socket \u94fe\u63a5\u3002\\n\\n### 3.2 \u8bbe\u7f6e apisix-java-plugin-runner \u8fdb\u5165\u8c03\u8bd5\u6a21\u5f0f\\n\\n\u5728\u542f\u52a8 `Main class(org.apache.apisix.plugin.runner.PluginRunnerApplication)`\u4e4b\u524d\uff0c\u9700\u8981\u914d\u7f6e\u7528\u6237\u7ea7\u7684\u73af\u5883\u53d8\u91cf `APISIX_LISTEN_ADDRESS=unix:/tmp/runner.sock` \u548c `APISIX_CONF_EXPIRE_TIME=3600`\u3002\\n\\n\u5982\u679c\u4f60\u662f\u4f7f\u7528 IDEA \u8fdb\u884c\u5f00\u53d1\uff0c\u90a3\u4e48\u914d\u7f6e\u597d\u7684\u73af\u5883\u53d8\u91cf\u793a\u610f\u5982\u4e0b\uff1a\\n\\n![2021-06-21-2](https://static.apiseven.com/202108/1639464890287-ee6bbc3a-3f8b-4de7-9ce4-7670fb0c3f64.png)\\n\\napisix-java-plugin-runner \u76f8\u5f53\u4e8e server \u7aef\uff0c\u5728\u542f\u52a8\u65f6\u4f1a\u4e3b\u52a8\u521b\u5efa `/tmp/runner.sock` \u6587\u4ef6\uff0c\u5e76\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e0a\u4e0e Apache APISIX \u8fdb\u884c Unix Domain Socket \u901a\u4fe1\u3002\\n\\n## 4. \u5f00\u53d1\\n\\n### 4.1 \u573a\u666f\\n\\n\u6211\u4eec\u4ee5\u4e00\u4e2a\u573a\u666f\u6765\u4ee3\u5165\u5f00\u53d1\u8fc7\u7a0b\uff1a\u9700\u8981\u9a8c\u8bc1\u8bf7\u6c42 header \u4e2d token \u7684\u6709\u6548\u6027\uff0c\u9a8c\u8bc1 token \u7684\u65b9\u5f0f\u662f\u7528\u8bf7\u6c42\u4e2d\u643a\u5e26 token \u4f5c\u4e3a\u53c2\u6570\uff0c\u8bbf\u95ee SSO \u56fa\u5b9a\u7684\u63a5\u53e3\uff0c\u5982\u679c token \u9a8c\u8bc1\u901a\u8fc7\u5219\u653e\u884c\u8bf7\u6c42\uff0c\u9a8c\u8bc1\u5931\u8d25\u5219\u963b\u6b62\u8bf7\u6c42\u3002\\n\\n### 4.2 \u914d\u7f6e Apache APISIX\\n\\n\u5148\u7ed9\u63d2\u4ef6\u547d\u540d\u4e3a `TokenValidator`\uff0c\u7136\u540e\u8bbe\u8ba1\u5c5e\u6027\uff0c\u4e3a\u4e86\u5c3d\u53ef\u80fd\u505a\u5230\u52a8\u6001\u914d\u7f6e\uff0c\u5c5e\u6027\u8bbe\u8ba1\u5982\u4e0b\\n\\n```json\\n{\\n  \\"validate_header\\": \\"token\\",\\n  \\"validate_url\\": \\"https://www.sso.foo.com/token/validate\\",\\n  \\"rejected_code\\": \\"403\\"\\n}\\n```\\n\\n\u542f\u52a8 Apache APISIX\uff0c\u7136\u540e\u65b0\u589e\u4e00\u6761\u8def\u7531\u914d\u7f6e\uff0c\u6307\u5b9a\u8be5\u8def\u7531\u9700\u8981\u8c03\u7528 apisix-java-plugin-runner \u7684 `TokenValidator` \u63d2\u4ef6\uff0c\u793a\u4f8b\u5982\u4e0b\\n\\n```shell\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -H \'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1\' -X PUT -d \'\\n{\\n    \\"uri\\":\\"/get\\",\\n    \\"plugins\\":{\\n        \\"ext-plugin-pre-req\\":{\\n            \\"conf\\":[\\n                {\\n                    \\"name\\":\\"TokenValidator\\",\\n                    \\"value\\":\\"{\\\\\\"validate_header\\\\\\":\\\\\\"token\\\\\\",\\\\\\"validate_url\\\\\\":\\\\\\"https://www.sso.foo.com/token/validate\\\\\\",\\\\\\"rejected_code\\\\\\":\\\\\\"403\\\\\\"}\\"\\n                }\\n            ]\\n        }\\n    },\\n    \\"upstream\\":{\\n        \\"nodes\\":{\\n            \\"httpbin.org:80\\":1\\n        },\\n        \\"type\\":\\"roundrobin\\"\\n    }\\n}\\n```\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c`TokenValidator` \u7684\u5c5e\u6027\u9700\u8981\u7ecf\u8fc7 json \u8f6c\u4e49\uff0c\u4f5c\u4e3a string \u7c7b\u578b\u8fdb\u884c\u914d\u7f6e\u3002\\n\\n\uff08\u8fd9\u91cc\u4e0a\u6e38\u5730\u5740\u914d\u7f6e\u4e3a httpbin.org\uff0c\u65b9\u4fbf\u8c03\u8bd5\uff09\\n\\n### 4.3 \u5f00\u53d1 Java \u63d2\u4ef6\\n\\n\u5728 runner-plugin/src/main/java/org/apache/apisix/plugin/runner/filter \u76ee\u5f55\u4e0b\uff0c\u65b0\u589e `TokenValidatr.java`\uff0c\u4ee3\u7801\u521d\u59cb\u9aa8\u67b6\u5982\u4e0b\\n\\n```Java\\npackage org.apache.apisix.plugin.runner.filter;\\n\\nimport org.apache.apisix.plugin.runner.HttpRequest;\\nimport org.apache.apisix.plugin.runner.HttpResponse;\\nimport org.springframework.stereotype.Component;\\nimport reactor.core.publisher.Mono;\\n\\n\\n@Component\\npublic class TokenValidator implements PluginFilter {\\n\\n    @Override\\n    public String name() {\\n        return \\"TokenValidator\\";\\n    }\\n\\n    @Override\\n    public Mono<Void> filter(HttpRequest request, HttpResponse response, PluginFilterChain chain) {\\n        return chain.filter(request, response);\\n    }\\n}\\n```\\n\\n\u9700\u8981\u7ee7\u627f `PluginFilter`\u63a5\u53e3\uff0c\u91cd\u5199 `name` \u548c `filter`\u51fd\u6570\u3002\\n\\n\u91cd\u5199 `name` \u7684\u8fd4\u56de\u503c\uff0c\u548c\u524d\u9762\u914d\u7f6e APISIX \u7684\u8def\u7531\u5c5e\u6027\u4e2d \\"name\\" \u4fdd\u6301\u4e00\u81f4\u3002\\n\\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a\\n\\n```Java\\npackage org.apache.apisix.plugin.runner.filter;\\n\\nimport com.google.gson.Gson;\\nimport org.apache.apisix.plugin.runner.HttpRequest;\\nimport org.apache.apisix.plugin.runner.HttpResponse;\\nimport org.springframework.stereotype.Component;\\nimport reactor.core.publisher.Mono;\\n\\nimport java.util.HashMap;\\nimport java.util.Map;\\n\\n@Component\\npublic class TokenValidator implements PluginFilter {\\n\\n    @Override\\n    public String name() {\\n        return \\"TokenValidator\\";\\n    }\\n\\n    @Override\\n    public Mono<Void> filter(HttpRequest request, HttpResponse response, PluginFilterChain chain) {\\n        // parse `conf` to json\\n        String configStr = request.getConfig(this);\\n        Gson gson = new Gson();\\n        Map<String, Object> conf = new HashMap<>();\\n        conf = gson.fromJson(configStr, conf.getClass());\\n\\n        // get configuration parameters\\n        String token = request.getHeader((String) conf.get(\\"validate_header\\"));\\n        String validate_url = (String) conf.get(\\"validate_url\\");\\n        boolean flag = validate(token, validate_url);\\n\\n        // token verification results\\n        if (!flag) {\\n            String rejected_code = (String) conf.get(\\"rejected_code\\");\\n            response.setStatusCode(Integer.parseInt(rejected_code));\\n            return chain.filter(request, response);\\n        }\\n\\n        return chain.filter(request, response);\\n    }\\n\\n    private Boolean validate(String token, String validate_url) {\\n        //TODO: improve the validation process\\n        return true;\\n    }\\n}\\n```\\n\\n### 4.4 \u6d4b\u8bd5\\n\\n\u5728 Apache APISIX \u4e0a\u914d\u7f6e\u7684\u4e0a\u6e38\u670d\u52a1\u662f httpbin.org\uff0c\u53ef\u4ee5\u8bbf\u95ee Apache APISIX\uff0c\u89e6\u53d1\u8def\u7531\uff0c\u8ba9 Apache APISIX \u8c03\u7528 apisix-java-plugin-runner \u53bb\u6267\u884c TokenValidator \u63d2\u4ef6\uff0c\u6d4b\u8bd5\u4e00\u4e0b Java \u63d2\u4ef6\u6548\u679c\u3002\\n\\n```shell\\ncurl -H \'token: 123456\' 127.0.0.1:9080/get\\n{\\n \\"args\\": {},\\n \\"headers\\": {\\n \\"Accept\\": \\"/\\",\\n \\"Host\\": \\"127.0.0.1\\",\\n \\"Token\\": \\"123456\\",\\n \\"User-Agent\\": \\"curl/7.71.1\\",\\n \\"X-Amzn-Trace-Id\\": \\"Root=1-60cb0424-02b5bf804cfeab5252392f96\\",\\n \\"X-Forwarded-Host\\": \\"127.0.0.1\\"\\n },\\n \\"origin\\": \\"127.0.0.1\\",\\n \\"url\\": \\"http://127.0.0.1/get\\"\\n}\\n```\\n\\n## 5. \u90e8\u7f72\\n\\n\u63d2\u4ef6\u5f00\u53d1\u5b8c\u6210\u540e\uff0c\u90e8\u7f72\u64cd\u4f5c\u53ef\u4ee5\u53c2\u8003 [\u90e8\u7f72 apisix-java-plugin-runner](https://github.com/apache/apisix-java-plugin-runner/blob/main/docs/how-it-works.md#run)\u3002\\n\\n## 6. \u89c6\u9891\u6559\u7a0b\\n\\n<iframe\\n    height=\\"350\\"\\n    width=\\"600\\"\\n    src=\\"https://api7-website-1301662268.file.myqcloud.com/2021-06-21-use-Java-to-write-Apache-APISIX-plugins.mp4\\"\\n    frameborder=\\"0\\">\\n</iframe>"},{"id":"2021/06/18/first-ga-version-v1.0-of-apache-apisix-ingress-controller-released","metadata":{"permalink":"/zh/blog/2021/06/18/first-ga-version-v1.0-of-apache-apisix-ingress-controller-released","source":"@site/blog/2021/06/18/first-GA-version-v1.0-of-Apache-APISIX-Ingress-Controller-released.md","title":"Apache APISIX Ingress Controller \u9996\u4e2a GA \u7248\u672c v1.0 \u6b63\u5f0f\u53d1\u5e03\uff01","description":"Apache APISIX Ingress Controller \u6b63\u5f0f\u53d1\u5e03\uff0c\u652f\u6301 ApisixRoute \u548c  ApisixUpstream \u7b49\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u4ee5\u53ca K8s \u539f\u751f Ingress \u8d44\u6e90\u7b49\u63a7\u5236\u5916\u90e8\u6d41\u91cf\u8bbf\u95ee\u90e8\u7f72\u5728 K8s \u4e2d\u7684\u670d\u52a1\u3002","date":"2021-06-18T00:00:00.000Z","formattedDate":"2021\u5e746\u670818\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":3.995,"truncated":true,"authors":[{"name":"\u5f20\u664b\u6d9b","url":"https://github.com/tao12345666333","imageURL":"https://avatars.githubusercontent.com/u/3264292?v=4"}],"prevItem":{"title":"\u4f7f\u7528 Java \u7f16\u5199 Apache APISIX \u63d2\u4ef6","permalink":"/zh/blog/2021/06/21/use-java-to-write-apache-apisix-plugins"},"nextItem":{"title":"Apache APISIX Dashboard \u8bbf\u95ee\u63a7\u5236\u7ed5\u8fc7\u6f0f\u6d1e\u516c\u544a\uff08CVE-2021-33190\uff09","permalink":"/zh/blog/2021/06/17/apache-apisix-dashboard-access-control-bypass-vulnerability-announcement"}},"content":"> Apache APISIX Ingress Controller v1.0 \u6b63\u5f0f\u53d1\u5e03\uff0c\u53ef\u652f\u6301\u4f7f\u7528\u5305\u62ec `ApisixRoute`\u3001`ApisixUpstream` \u7b49\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u4ee5\u53ca Kubernetes \u539f\u751f Ingress \u8d44\u6e90\u7b49\u63a7\u5236\u5916\u90e8\u6d41\u91cf\u8bbf\u95ee\u90e8\u7f72\u5728 Kubernetes \u4e2d\u7684\u670d\u52a1\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5173\u4e8e Apache APISIX Ingress Controller\\n\\nApache APISIX Ingress Controller \u662f\u4e00\u4e2a\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u6570\u636e\u9762\u627f\u8f7d\u6d41\u91cf\u7684\u4e91\u539f\u751f Ingress Controller \u5b9e\u73b0\uff0c\u91c7\u7528 CRD \u7684\u65b9\u5f0f\u5bf9 Kubernetes \u8fdb\u884c\u4e86\u6269\u5c55\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u53ef\u652f\u6301\u4f7f\u7528\u5305\u62ec ApisixRoute\u3001ApisixUpstream \u7b49\u81ea\u5b9a\u4e49\u8d44\u6e90\uff0c\u4ee5\u53ca Kubernetes \u539f\u751f Ingress \u8d44\u6e90\u7b49\u63a7\u5236\u5916\u90e8\u6d41\u91cf\u8bbf\u95ee\u90e8\u7f72\u5728 Kubernetes \u4e2d\u7684\u670d\u52a1\u3002\\n\\n\u6574\u4f53\u67b6\u6784\u5982\u4e0b\uff1a\\n\\n![Apache APISIX Ingress Controller \u67b6\u6784\u56fe](https://static.apiseven.com/202108/1639464578081-06d7c64a-b597-444f-a59f-0217676e1ffc.png)\\n\\n## v1.0 \u6700\u65b0\u7279\u6027\\n\\n### \u589e\u52a0 ApisixConsumer \u81ea\u5b9a\u4e49\u8d44\u6e90\u4f7f\u914d\u7f6e\u8ba4\u8bc1\u66f4\u65b9\u4fbf\\n\\n\u5728\u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u5982\u679c\u60f3\u8981\u914d\u7f6e keyAuth \u6216\u8005 basicAuth \u9700\u8981\u624b\u52a8\u53bb\u8c03\u7528 Apache APISIX \u7684 admin api \u521b\u5efa consumer \u914d\u7f6e\u3002\\n\\n\u5728 v1.0 \u7248\u672c\u4e2d\uff0c\u6211\u4eec\u589e\u52a0\u4e86 `ApisixConsumer` \u8d44\u6e90\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u66f4\u539f\u751f\u7684\u65b9\u5f0f\u6765\u5b9a\u4e49 consumer \u8d44\u6e90\u53ca\u4e3a ApisixRoute \u914d\u7f6e\u8ba4\u8bc1\u3002\\n\\n\u4f8b\u5982\u901a\u8fc7\u4ee5\u4e0b\u914d\u7f6e\u5b9a\u4e49\u4e00\u4e2a keyAuth \u8d44\u6e90\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v2alpha1\\nkind: ApisixConsumer\\nmetadata:\\n  name: keyauth\\nspec:\\n  authParameter:\\n    keyAuth:\\n      value:\\n        key: API\\n```\\n\\n\u5728 ApisixRoute \u4e2d\u53ea\u9700\u8981\u589e\u52a0\u5bf9\u5e94\u7c7b\u578b\u7684 `authentication` \u914d\u7f6e\u5373\u53ef\u3002\\n\\n```yaml\\napiVersion: apisix.apache.org/v2alpha1\\nkind: ApisixRoute\\nmetadata:\\n  name: httpbin-route\\nspec:\\n  http:\\n   ...\\n   authentication:\\n     enable: true\\n     type: keyAuth\\n```\\n\\n### \u4e3a ApisixTls \u589e\u52a0 mTLS \u652f\u6301\\n\\n\u5728 v1.0 \u7248\u672c\u4e2d\u6211\u4eec\u4e5f\u4e3a ApisixTls \u81ea\u5b9a\u4e49\u8d44\u6e90\u589e\u52a0\u4e86 mTLS \u7684\u652f\u6301\uff0c\u53ea\u9700\u8981\u5728 ApisixTls \u8d44\u6e90\u7684\u914d\u7f6e\u4e2d\u589e\u52a0 client \u914d\u7f6e\u5373\u53ef\uff0c\u4f8b\u5982\uff1a\\n\\n```yaml\\napiVersion: apisix.apache.org/v1\\nkind: ApisixTls\\nmetadata:\\n  name: sample-tls\\nspec:\\n  ...\\n  client:\\n    caSecret:\\n      name: client-ca-secret\\n      namespace: default\\n```\\n\\n### \u4e3a\u539f\u751f Ingress \u8d44\u6e90\u589e\u52a0\u4e86\u66f4\u591a annotation \u6765\u4e30\u5bcc\u5176\u529f\u80fd\\n\\n- `k8s.apisix.apache.org/blocklist-source-range` \u53ef\u5bf9\u6765\u6e90 IP \u8fdb\u884c\u9650\u5236\uff1b\\n- `k8s.apisix.apache.org/rewrite-target` \u548c `k8s.apisix.apache.org/rewrite-target-regex` \u53ef\u8fdb\u884c target \u7684 rewrite \u64cd\u4f5c\uff1b\\n- `k8s.apisix.apache.org/http-to-https` \u53ef\u8fdb\u884c HTTP \u5230 HTTPS \u7684\u5f3a\u5236\u91cd\u5b9a\u5411\uff1b\\n\\n\u66f4\u591a\u7279\u6027\u53d8\u66f4\u8bf7\u53c2\u8003\u9879\u76ee [CHANGELOG](https://github.com/apache/apisix-ingress-controller/blob/master/CHANGELOG.md) \u3002\\n\\n## \u4e3a\u4ec0\u4e48\u4f7f\u7528 APISIX Ingress Controller\\n\\nApache APISIX Ingress Controller \u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u5176\u6570\u636e\u9762\u627f\u8f7d\u4e1a\u52a1\u6d41\u91cf\uff0c\u6240\u4ee5\u5176\u4ece Apache APISIX \u7ee7\u627f\u4e86\u5982\u4e0b\u4f18\u52bf\uff1a\\n\\n- **\u9ad8\u6027\u80fd & \u7a33\u5b9a\u6027**\uff1aApache APISIX \u662f\u4e00\u6b3e\u4e91\u539f\u751f\u9ad8\u6027\u80fd\u52a8\u6001 API \u7f51\u5173\uff0c\u5df2\u5728\u4f17\u591a\u4f01\u4e1a\u5927\u89c4\u6a21\u6d41\u91cf\u573a\u666f\u4e0b\u4f7f\u7528\uff0c\u5176\u6027\u80fd\u53ca\u7a33\u5b9a\u6027\u4e45\u7ecf\u8003\u9a8c\u3002\\n- **\u751f\u6001\u4e30\u5bcc**\uff1aApache APISIX \u662f\u5f53\u524d\u6700\u6d3b\u8dc3\u7684\u5f00\u6e90\u7f51\u5173\u9879\u76ee\uff0c\u4f5c\u4e3a Apache \u9876\u7ea7\u9879\u76ee\uff0c\u65e0\u8bba\u662f\u793e\u533a\u6d3b\u8dc3\u5ea6\u8fd8\u662f\u5176\u63d2\u4ef6\u751f\u6001\u90fd\u975e\u5e38\u4e30\u5bcc\uff0c\u53ef\u6ee1\u8db3\u7528\u6237\u7684\u591a\u79cd\u4f7f\u7528\u573a\u666f\u548c\u9700\u6c42\uff1b\\n\\n\u6b64\u5916\uff0c\u7531\u4e8e APISIX Ingress Controller \u8fd8\u5177\u5907\u5982\u4e0b\u72ec\u6709\u7684\u4f18\u52bf\uff1a\\n\\n- **\u517c\u5bb9\u6027\u597d**\uff1a\u652f\u6301\u591a\u4e2a Ingress \u8d44\u6e90\u7248\u672c\uff0c\u5728\u4e0d\u540c\u7684 Kubernetes \u7248\u672c\u4e2d\u5747\u53ef\u6b63\u5e38\u5de5\u4f5c\uff1b\\n- **\u52a8\u6001\u66f4\u65b0**\uff1a\u65e0\u8bba\u662f Ingress \u8d44\u6e90\u6216\u662f\u8bc1\u4e66\u7b49\u914d\u7f6e\u7684\u66f4\u65b0\uff0c\u5747\u5df2\u5b9e\u73b0\u70ed\u52a0\u8f7d\uff0c\u65e0\u9700 reload\uff0c\u4fdd\u969c\u4e1a\u52a1\u5e73\u7a33\u8fd0\u884c\uff1b\\n- **\u6269\u5bb9\u7075\u6d3b**\uff1a\u7531\u4e8e APISIX Ingress Controller \u91c7\u7528\u63a7\u5236\u9762\u548c\u6570\u636e\u9762\u5206\u79bb\u7684\u67b6\u6784\uff0c\u6240\u4ee5\u5728\u6269\u5bb9\u65f6\uff0c\u53ef\u4ee5\u5355\u72ec\u6269\u5bb9 Apache APISIX \u8fd9\u4e2a\u6570\u636e\u9762\u96c6\u7fa4\uff0c\u800c\u65e0\u987b\u5bf9 Apache APISIX Ingress Controller \u8fdb\u884c\u6269\u5bb9\uff1b\\n- **\u8fd0\u7ef4\u53cb\u597d**\uff1a\u5728\u5f53\u524d\u67b6\u6784\u4e0b\uff0c\u7528\u6237\u53ef\u6309\u5b9e\u9645\u60c5\u51b5\u9009\u62e9\u5c06\u6570\u636e\u9762 Apache APISIX \u96c6\u7fa4\u90e8\u7f72\u5728 Kubernetes \u96c6\u7fa4\u4e2d\uff0c\u6216\u662f\u90e8\u7f72\u5728\u7269\u7406\u673a\u73af\u5883\u3002\u4e14 Apache APISIX Ingress Controller \u6545\u969c\u4e0d\u4f1a\u5bf9\u4e1a\u52a1\u6d41\u91cf\u9020\u6210\u4efb\u4f55\u5f71\u54cd\u3002"},{"id":"2021/06/17/apache-apisix-dashboard-access-control-bypass-vulnerability-announcement","metadata":{"permalink":"/zh/blog/2021/06/17/apache-apisix-dashboard-access-control-bypass-vulnerability-announcement","source":"@site/blog/2021/06/17/Apache-APISIX-Dashboard-Access-Control-Bypass-Vulnerability-Announcement.md","title":"Apache APISIX Dashboard \u8bbf\u95ee\u63a7\u5236\u7ed5\u8fc7\u6f0f\u6d1e\u516c\u544a\uff08CVE-2021-33190\uff09","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX Dashboard \u8bbf\u95ee\u63a7\u5236\u7ed5\u8fc7\u6f0f\u6d1e\u516c\u544a\uff0c\u8bf7\u5c3d\u5feb\u5347\u7ea7\u7248\u672c\u4fee\u590d\u8be5\u6f0f\u6d1e\u3002","date":"2021-06-17T00:00:00.000Z","formattedDate":"2021\u5e746\u670817\u65e5","tags":[{"label":"Vulnerabilities","permalink":"/zh/blog/tags/vulnerabilities"}],"readingTime":1.86,"truncated":true,"authors":[{"name":"\u741a\u81f4\u8fdc","url":"https://github.com/juzhiyuan","imageURL":"https://avatars.githubusercontent.com/u/2106987?v=4"}],"prevItem":{"title":"Apache APISIX Ingress Controller \u9996\u4e2a GA \u7248\u672c v1.0 \u6b63\u5f0f\u53d1\u5e03\uff01","permalink":"/zh/blog/2021/06/18/first-ga-version-v1.0-of-apache-apisix-ingress-controller-released"},"nextItem":{"title":"Chaos Mesh \u52a9\u529b Apache APISIX \u63d0\u5347\u7a33\u5b9a\u6027","permalink":"/zh/blog/2021/06/16/chaos-mesh-helps-apache-apisix-improve-stability"}},"content":"> \u7531\u4e8e\u7a0b\u5e8f\u901a\u8fc7\u83b7\u53d6\u8bf7\u6c42\u5934 `X-Forwarded-For` \u7684\u503c\u6765\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\u5224\u65ad\uff0c\u5bfc\u81f4\u653b\u51fb\u8005\u5728\u8c03\u7528 API \u8bf7\u6c42\u65f6\uff0c\u53ea\u9700\u7be1\u6539\u8be5\u8bf7\u6c42\u5934\u5373\u53ef\u5b9e\u73b0\u8bbf\u95ee\u63a7\u5236\u7ed5\u8fc7\u653b\u51fb\u3002\\n\\n\x3c!--truncate--\x3e\\n## \u95ee\u9898\u63cf\u8ff0\\n\\n\u5728 Apache APISIX Dashboard 2.6 \u4e2d\uff0c\u5b58\u5728\u4e24\u4e2a\u914d\u7f6e\u9879\uff1a\\n\\n1. `conf.listen.host` \u7684\u914d\u7f6e\u9879\uff0c\u7528\u4e8e\u6307\u5b9a ManagerAPI \u5728\u542f\u52a8\u65f6\u76d1\u542c\u54ea\u4e2a IP \u5730\u5740\uff0c\u5b83\u7684\u9ed8\u8ba4\u503c\u4e3a `0.0.0.0`\uff08\u9ed8\u8ba4\u76d1\u542c\u5916\u90e8\u7f51\u7edc\u8bf7\u6c42\uff09\uff1b\\n\\n2. `conf.allow_list` \u7684\u914d\u7f6e\u9879\uff0c\u7528\u4e8e\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\uff0c\u9ed8\u8ba4\u53ea\u5141\u8bb8 `127.0.0.1`\uff08\u5373\u672c\u5730\u7f51\u7edc\uff09\u8fdb\u884c\u8bbf\u95ee\u3002\\n\\n\u7531\u4e8e\u7a0b\u5e8f\u901a\u8fc7\u83b7\u53d6\u8bf7\u6c42\u5934 `X-Forwarded-For` \u7684\u503c\u6765\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\u5224\u65ad\uff0c\u5bfc\u81f4\u653b\u51fb\u8005\u5728\u8c03\u7528 API \u8bf7\u6c42\u65f6\uff0c\u53ea\u9700\u7be1\u6539\u8be5\u8bf7\u6c42\u5934\u5373\u53ef\u5b9e\u73b0\u8bbf\u95ee\u63a7\u5236\u7ed5\u8fc7\u653b\u51fb\u3002\\n\\n## \u5f71\u54cd\u7248\u672c\\n\\nApache APISIX 2.6.0\\n\\n## \u89e3\u51b3\u65b9\u6848\\n\\n\u8be5\u95ee\u9898\u5df2\u5728 2.6.1 \u7248\u672c\u4e2d\u89e3\u51b3\uff0c\u8bf7\u5c3d\u5feb\u66f4\u65b0\u81f3\u6700\u65b0\u7248\u672c\uff0c\u5e76\u5728\u90e8\u7f72\u7a0b\u5e8f\u540e\u4fee\u6539\u9ed8\u8ba4\u7528\u6237\u540d\u4e0e\u5bc6\u7801\u3002\\n\\n## \u6f0f\u6d1e\u8be6\u60c5\\n\\n\u6f0f\u6d1e\u516c\u5f00\u65f6\u95f4\uff1a2021 \u5e74 6 \u6708 8 \u65e5\\n\\nCVE \u8be6\u7ec6\u4fe1\u606f\uff1ahttps://nvd.nist.gov/vuln/detail/CVE-2021-33190\\n\\n## \u8d21\u732e\u8005\u7b80\u4ecb\\n\\n\u8be5\u6f0f\u6d1e\u662f\u7531\u5e73\u5b89\u79d1\u6280\u94f6\u6cb3\u5b89\u5168\u5b9e\u9a8c\u5ba4\u7684 Vern \u53d1\u73b0\uff0c\u5e76\u5411 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u4e0a\u62a5\u8be5\u6f0f\u6d1e\u3002\u611f\u8c22 Vern \u548c\u5e73\u5b89\u79d1\u6280\u94f6\u6cb3\u5b89\u5168\u5b9e\u9a8c\u5ba4\u5bf9 Apache APISIX \u793e\u533a\u7684\u8d21\u732e\u3002\\n\\n![2021-06-17-1](https://static.apiseven.com/202108/1639463130837-f27bf7bf-28b9-4742-a40f-ee43ebf5a7a8.jpeg)\\n\\n## \u62d3\u5c55\u9605\u8bfb\\n\\n[Apache APISIX \u8d21\u732e\u8005\u4e13\u8bbf | \u666e\u534e\u6c38\u9053\u534e\u5357\u6570\u636e\u5b89\u5168\u4e0e\u9690\u79c1\u4fdd\u62a4\u56e2\u961f\u9ad8\u7ea7\u5b89\u5168\u987e\u95ee\u738b\u9e4f\u8bda](./2021-01-11-interview-Apache-APISIX-contributor-Wang-Pengcheng-Senior-Security-Advisor-of-PwC-South-China-Data-Security-and-Privacy-Protection-Team.md)"},{"id":"2021/06/16/chaos-mesh-helps-apache-apisix-improve-stability","metadata":{"permalink":"/zh/blog/2021/06/16/chaos-mesh-helps-apache-apisix-improve-stability","source":"@site/blog/2021/06/16/Chaos-Mesh-helps-Apache-APISIX-improve-stability.md","title":"Chaos Mesh \u52a9\u529b Apache APISIX \u63d0\u5347\u7a33\u5b9a\u6027","description":"\u672c\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 Chaos Mesh \u6d4b\u8bd5 API \u7f51\u5173 Apache APISIX \u7684\u76f8\u5173\u6d41\u7a0b\u53ca\u573a\u666f\uff0c\u7528\u6765\u63d0\u5347 APISIX \u7684\u7a33\u5b9a\u6027\u3002\u5e76\u4e14\u4ecb\u7ecd\u4e86\u672a\u6765 APISIX \u7684\u6d4b\u8bd5\u8ba1\u5212\u3002","date":"2021-06-16T00:00:00.000Z","formattedDate":"2021\u5e746\u670816\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.07,"truncated":true,"authors":[{"name":"\u5434\u8212\u65f8","url":"https://github.com/Yiyiyimu","imageURL":"https://avatars.githubusercontent.com/u/34589752?v=4"}],"prevItem":{"title":"Apache APISIX Dashboard \u8bbf\u95ee\u63a7\u5236\u7ed5\u8fc7\u6f0f\u6d1e\u516c\u544a\uff08CVE-2021-33190\uff09","permalink":"/zh/blog/2021/06/17/apache-apisix-dashboard-access-control-bypass-vulnerability-announcement"},"nextItem":{"title":"Apache APISIX \u548c Envoy \u6027\u80fd\u5927\u6bd4\u62fc","permalink":"/zh/blog/2021/06/10/apache-apisix-and-envoy-performance-comparison"}},"content":"> \u672c\u6587\u63cf\u8ff0\u4e86\u5982\u4f55\u5728\u591a\u79cd\u573a\u666f\u4e0b\u4f7f\u7528 Chaos Mesh\uff0c\u4e3a Apache APISIX \u63d0\u5347\u7a33\u5b9a\u6027\u3002\\n\\n\x3c!--truncate--\x3e\\n\\nApache APISIX \u662f Apache \u57fa\u91d1\u4f1a\u4e0b\u7684\u9876\u7ea7\u9879\u76ee\uff0c\u76ee\u524d\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5df2\u7ecf\u901a\u8fc7\u6bcf\u65e5\u51e0\u767e\u4ebf\u6b21\u8bf7\u6c42\u91cf\u7684\u8003\u9a8c\u3002\u968f\u7740\u793e\u533a\u7684\u53d1\u5c55\uff0cApache APISIX \u7684\u529f\u80fd\u8d8a\u6765\u8d8a\u591a\uff0c\u9700\u8981\u4e0e\u5916\u90e8\u7ec4\u4ef6\u4ea7\u751f\u7684\u4ea4\u4e92\u4e5f\u8d8a\u6765\u8d8a\u591a\uff0c\u968f\u4e4b\u800c\u6765\u7684\u4e0d\u786e\u5b9a\u6027\u5448\u6307\u6570\u7ea7\u589e\u957f\u3002\u5728\u793e\u533a\u4e2d\uff0c\u6211\u4eec\u4e5f\u6536\u5230\u4e86\u7528\u6237\u53cd\u9988\u7684\u4e00\u4e9b\u95ee\u9898\uff0c\u8fd9\u91cc\u4e3e\u4e24\u4e2a\u4f8b\u5b50\u3002\\n\\n### \u573a\u666f\u4e00\\n\\n\u5728 Apache APISIX \u7684\u914d\u7f6e\u4e2d\u5fc3\uff0c etcd \u4e0e Apache APISIX \u4e4b\u95f4\u51fa\u73b0\u610f\u5916\u7684\u9ad8\u7f51\u7edc\u5ef6\u8fdf\u65f6\uff0cApache APISIX \u80fd\u5426\u4ecd\u7136\u6b63\u5e38\u8fd0\u884c\u8fdb\u884c\u6d41\u91cf\u8fc7\u6ee4\u8f6c\u53d1\uff1f\\n\\n### \u573a\u666f\u4e8c\\n\\n\u7528\u6237\u5728 issue \u53cd\u9988\uff0c\u5f53 etcd \u96c6\u7fa4\u4e2d\u7684\u4e00\u4e2a\u8282\u70b9\u5931\u6548\u800c\u96c6\u7fa4\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u65f6\uff0c\u4f1a\u51fa\u73b0\u4e0e Apache APISIX admin API \u4ea4\u4e92\u62a5\u9519\u7684\u60c5\u51b5\u3002\\n\\n\u5c3d\u7ba1 Apache APISIX \u5728 CI \u4e2d\u901a\u8fc7\u5355\u5143 / e2e / fuzz \u6d4b\u8bd5\u8986\u76d6\u4e86\u5927\u90e8\u5206\u60c5\u666f\uff0c\u7136\u800c\u5c1a\u672a\u8986\u76d6\u5230\u4e0e\u5916\u90e8\u7ec4\u4ef6\u7684\u4ea4\u4e92\u3002\u5f53\u53d1\u751f\u7f51\u7edc\u6ce2\u52a8\u3001\u786c\u76d8\u6545\u969c\u3001\u6216\u662f\u8fdb\u7a0b\u88ab\u6740\u6389\u7b49\u96be\u4ee5\u9884\u6599\u7684\u5f02\u5e38\u884c\u4e3a\u65f6\uff0cApache APISIX \u80fd\u5426\u7ed9\u51fa\u5408\u9002\u7684\u9519\u8bef\u4fe1\u606f\u3001\u662f\u5426\u53ef\u4ee5\u4fdd\u6301\u6216\u81ea\u884c\u6062\u590d\u5230\u6b63\u5e38\u7684\u8fd0\u884c\u72b6\u6001\u5462\uff1f\u4e3a\u4e86\u6d4b\u8bd5\u8986\u76d6\u5230\u7528\u6237\u63d0\u51fa\u7684\u573a\u666f\uff0c\u4ee5\u53ca\u5728\u6295\u5165\u751f\u4ea7\u73af\u5883\u524d\u4e3b\u52a8\u53d1\u73b0\u7c7b\u4f3c\u7684\u95ee\u9898\uff0c\u7ecf\u8fc7\u793e\u533a\u8ba8\u8bba\u51b3\u5b9a\u4f7f\u7528 PingCAP \u5f00\u6e90\u7684\u6df7\u6c8c\u5de5\u7a0b\u5e73\u53f0 Chaos Mesh \u8fdb\u884c\u6d4b\u8bd5\u3002\\n\\n\u6df7\u6c8c\u5de5\u7a0b\u662f\u4e00\u79cd\u5728\u7cfb\u7edf\u57fa\u7840\u8bbe\u65bd\u4e0a\u8fdb\u884c\u8bd5\u9a8c\uff0c\u4e3b\u52a8\u627e\u51fa\u7cfb\u7edf\u4e2d\u7684\u8106\u5f31\u73af\u8282\u7684\u65b9\u6cd5\uff0c\u4ece\u800c\u786e\u4fdd\u7cfb\u7edf\u5177\u6709\u62b5\u5fa1\u751f\u4ea7\u73af\u5883\u4e2d\u5931\u63a7\u73af\u5883\u7684\u80fd\u529b\u3002\u6df7\u6c8c\u5de5\u7a0b\u6700\u65e9\u7531 Netflix \u63d0\u51fa\uff0c\u7528\u4ee5\u6a21\u62df\u4ece\u800c\u62b5\u5fa1\u65e9\u671f\u4e91\u670d\u52a1\u7684\u4e0d\u7a33\u5b9a\u6027\u3002\u968f\u7740\u6280\u672f\u7684\u6f14\u8fdb\uff0c\u73b0\u5728\u7684\u6df7\u6c8c\u5de5\u7a0b\u5e73\u53f0\u63d0\u4f9b\u4e86\u66f4\u591a\u79cd\u7c7b\u7684\u6545\u969c\u53ef\u4f9b\u6ce8\u5165\uff0c\u4f9d\u9760 Kubernetes \u4e5f\u53ef\u4ee5\u66f4\u65b9\u4fbf\u5730\u63a7\u5236\u6545\u969c\u534a\u5f84\u3002\u8fd9\u4e9b\u90fd\u662f Apache APISIX \u9009\u62e9 Chaos Mesh \u7684\u91cd\u8981\u539f\u56e0\uff0c\u4f46\u4f5c\u4e3a\u5f00\u6e90\u793e\u533a\uff0cApache APISIX \u6df1\u77e5\u53ea\u6709\u6d3b\u8dc3\u7684\u793e\u533a\u624d\u80fd\u786e\u4fdd\u8f6f\u4ef6\u7a33\u5b9a\u4f7f\u7528\u548c\u5feb\u901f\u8fed\u4ee3\uff0c\u800c\u8fd9\u4e5f\u662f Chaos Mesh \u66f4\u52a0\u5438\u5f15\u4eba\u7684\u7279\u70b9\u3002\\n\\n## \u5982\u4f55\u5728 APISIX \u4e0a\u5e94\u7528\u6df7\u6c8c\u5de5\u7a0b\\n\\n\u6df7\u6c8c\u5de5\u7a0b\u5728\u5355\u7eaf\u7684\u6ce8\u5165\u6545\u969c\u4ee5\u5916\uff0c\u9010\u6e10\u5f62\u6210\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u65b9\u6cd5\u8bba\u3002\u6839\u636e Principle of Chaos Engineering \u7684\u63a8\u8350\uff0c\u90e8\u7f72\u6df7\u6c8c\u5de5\u7a0b\u5b9e\u9a8c\u9700\u8981\u4e94\u4e2a\u6b65\u9aa4\uff1a\\n\\n1. \u5b9a\u4e49\u7a33\u6001\uff0c\u5373\u627e\u5230\u4e00\u4e2a\u8bc1\u660e\u6b63\u5e38\u8fd0\u884c\u7684\u53ef\u91cf\u5316\u6307\u6807\u3002\\n2. \u505a\u51fa\u5047\u8bbe\uff0c\u5047\u8bbe\u6307\u6807\u5728\u5b9e\u9a8c\u7ec4\u548c\u5bf9\u7167\u7ec4\u90fd\u59cb\u7ec8\u4fdd\u6301\u7a33\u5b9a\u72b6\u6001\u3002\\n3. \u8bbe\u8ba1\u5b9e\u9a8c\uff0c\u5f15\u5165\u8fd0\u884c\u4e2d\u53ef\u80fd\u51fa\u73b0\u7684\u6545\u969c\u3002\\n4. \u9a8c\u8bc1\u5047\u8bbe\uff0c\u5373\u901a\u8fc7\u6bd4\u8f83\u5b9e\u9a8c\u7ec4\u548c\u5bf9\u7167\u7ec4\u7684\u7ed3\u679c\u8bc1\u4f2a\u5047\u8bbe\u3002\\n5. \u4fee\u590d\u95ee\u9898\u3002\\n\\n\u63a5\u4e0b\u6765\u4ee5\u4e0a\u8ff0\u4e24\u4e2a\u7528\u6237\u53cd\u9988\u573a\u666f\u4e3a\u4f8b\uff0c\u4f9d\u7167\u8fd9\u4e94\u4e2a\u6b65\u9aa4\u4e3a\u5927\u5bb6\u4ecb\u7ecd Apache APISIX \u5e94\u7528\u6df7\u6c8c\u5de5\u7a0b\u7684\u6d41\u7a0b\u3002\\n\\n### \u573a\u666f\u4e00\\n\\n![2021-06-16-1](https://static.apiseven.com/202108/1639462804552-8d51872f-3419-4e64-b365-4ef7cbb2a388.png)\\n\\n\u7528\u4e00\u5e45\u56fe\u6765\u63cf\u8ff0\u8fd9\u4e2a\u573a\u666f\u3002\u5bf9\u7167\u4e0a\u9762\u7684\u4e94\u4e2a\u6b65\u9aa4\uff0c\u9996\u5148\u9700\u8981\u627e\u5230\u8861\u91cf Apache APISIX \u6b63\u5e38\u8fd0\u884c\u7684\u53ef\u91cf\u5316\u6307\u6807\u3002\u5728\u6d4b\u8bd5\u65f6\u6700\u4e3b\u8981\u7684\u65b9\u6cd5\u662f\u5229\u7528 Grafana \u5bf9 Apache APISIX \u8fd0\u884c\u6307\u6807\u8fdb\u884c\u76d1\u6d4b\uff0c\u627e\u5230\u53ef\u8861\u91cf\u7684\u6307\u6807\u540e\uff0c\u5728 CI \u4e2d\u5c31\u53ef\u4ee5\u4ece Prometheus \u4e2d\u5355\u72ec\u63d0\u53d6\u6570\u636e\u8fdb\u884c\u6bd4\u8f83\u5224\u65ad\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e86\u8def\u7531\u8f6c\u53d1\u7684 Request per Second\uff08RPS\uff09\u548c etcd \u7684\u53ef\u8fde\u63a5\u6027 \u4f5c\u4e3a\u8bc4\u4ef7\u6307\u6807\u3002\u53e6\u4e00\u70b9\u5c31\u662f\u9700\u8981\u5bf9\u65e5\u5fd7\u8fdb\u884c\u5206\u6790\uff0c\u5bf9\u4e8e Apache APISIX \u5c31\u662f\u67e5\u770b Nginx \u7684 error.log \u5224\u65ad\u662f\u5426\u6709\u62a5\u9519\u4ee5\u53ca\u62a5\u9519\u662f\u5426\u7b26\u5408\u9884\u671f\u3002\\n\\n\u5728\u5bf9\u7167\u7ec4\u4e5f\u5c31\u662f\u5f15\u5165 Chaos \u524d\u8fdb\u884c\u5b9e\u9a8c\uff0c\u68c0\u6d4b set/get route \u5747\u80fd\u6210\u529f\uff0cetcd \u53ef\u8fde\u63a5\uff0c\u5e76\u8bb0\u5f55\u6b64\u65f6\u7684 RPS\u3002\u4e4b\u540e\uff0c\u4f7f\u7528 network chaos \u6dfb\u52a0 5s \u7684\u7f51\u7edc\u5ef6\u8fdf \uff0c\u518d\u6b21\u8fdb\u884c\u5b9e\u9a8c\uff0c\u6b64\u65f6 set route \u5931\u8d25\uff0cget route \u6210\u529f\uff0cetcd \u65e0\u6cd5\u8fde\u63a5\uff0cRPS \u4e0e\u4e4b\u524d\u76f8\u6bd4\u65e0\u660e\u663e\u53d8\u5316\u3002\u5b9e\u9a8c\u7b26\u5408\u9884\u671f\u3002\\n\\n### \u573a\u666f\u4e8c\\n\\n![2021-06-16-2](https://static.apiseven.com/202108/1639462935848-b87400d3-e59b-4e6d-84f9-25c2771d48d3.png)\\n\\n\u8fdb\u884c\u540c\u6837\u7684\u5bf9\u7167\u7ec4\u5b9e\u9a8c\u4e4b\u540e\u5f15\u5165 pod-kill chaos\uff0c\u590d\u73b0\u4e86\u9884\u671f\u7684\u9519\u8bef\u3002\u5728\u968f\u673a\u5220\u9664\u96c6\u7fa4\u4e2d\u5c11\u6570 etcd \u8282\u70b9\u7684\u60c5\u51b5\u4e0b\uff0cetcd \u53ef\u8fde\u63a5\u6027\u8868\u73b0\u51fa\u65f6\u6709\u65f6\u65e0\uff0c\u65e5\u5fd7\u5219\u6253\u5370\u51fa\u4e86\u5927\u91cf\u8fde\u63a5\u62d2\u7edd\u7684\u62a5\u9519\u3002\u66f4\u52a0\u6709\u8da3\u7684\u662f\uff0c\u5728\u5220\u9664 etcd \u7aef\u70b9\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u6216\u7b2c\u4e09\u4e2a\u8282\u70b9\u65f6\uff0c\u8bbe\u7f6e\u8def\u7531\u6b63\u5e38\u8fd4\u56de\uff0c\u800c\u53ea\u6709\u5728\u5220\u9664 etcd \u7aef\u70b9\u5217\u8868\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u8282\u70b9\u65f6\uff0c\u8bbe\u7f6e\u8def\u7531\u4f1a\u62a5\u9519 \u201cconnection refused\u201d\u3002\\n\\n\u6392\u67e5\u53d1\u73b0\u539f\u56e0\u5728\u4e8e Apache APISIX \u4f7f\u7528\u7684 etcd lua API \u9009\u62e9\u7aef\u70b9\u65f6\u5e76\u4e0d\u662f\u968f\u673a\u800c\u662f\u987a\u5e8f\u9009\u62e9\uff0c\u56e0\u6b64\u65b0\u5efa etcd client \u8fdb\u884c\u7684\u64cd\u4f5c\u5c31\u76f8\u5f53\u4e8e\u53ea\u7ed1\u5b9a\u5728\u4e00\u4e2a etcd \u7aef\u70b9\u4e0a\u5bfc\u81f4\u6301\u7eed\u6027\u7684\u5931\u8d25\u3002\u4fee\u590d\u8fd9\u4e2a\u95ee\u9898\u4e4b\u540e\uff0c\u8fd8\u4e3a etcd lua API \u6dfb\u52a0\u4e86\u5065\u5eb7\u68c0\u67e5\uff0c\u786e\u4fdd\u4e0d\u4f1a\u5728\u65ad\u5f00\u8fde\u63a5\u7684 etcd \u4e0a\u8fdb\u884c\u5927\u91cf\u7684\u91cd\u590d\uff1b\u4ee5\u53ca\u589e\u52a0\u4e86 etcd \u96c6\u7fa4\u5b8c\u5168\u65ad\u5f00\u8fde\u63a5\u65f6\u7684\u56de\u9000\u68c0\u67e5\uff0c\u907f\u514d\u5927\u91cf\u62a5\u9519\u51b2\u7206\u65e5\u5fd7\u3002\\n\\n## \u672a\u6765\u8ba1\u5212\\n\\n### 1. \u501f\u52a9 e2e \u6a21\u62df\u573a\u666f\u8fdb\u884c\u6df7\u6c8c\u6d4b\u8bd5\\n\\n\u76ee\u524d\u5728 Apache APISIX \u4e2d\uff0c\u4ecd\u7136\u4e3b\u8981\u4f9d\u9760\u4eba\u6765\u8bc6\u522b\u7cfb\u7edf\u4e2d\u53ef\u80fd\u7684\u8106\u5f31\u70b9\u8fdb\u884c\u6d4b\u8bd5\u4fee\u590d\u3002\u5bf9\u4e8e\u5f00\u6e90\u793e\u533a\u6765\u8bf4\uff0c\u4e0e\u4e4b\u524d\u63d0\u5230\u7684 Netflix \u5728\u4f01\u4e1a\u4e2d\u5e94\u7528\u6df7\u6c8c\u5de5\u7a0b\u4e0d\u540c\uff0c\u5c3d\u7ba1\u5728 CI \u4e2d\u6d4b\u8bd5\uff0c\u65e0\u9700\u62c5\u5fc3\u6df7\u6c8c\u5de5\u7a0b\u7684\u6545\u969c\u534a\u5f84\u5bf9\u751f\u4ea7\u73af\u5883\u7684\u5f71\u54cd\uff0c\u4f46\u540c\u65f6\u4e5f\u65e0\u6cd5\u8986\u76d6\u751f\u4ea7\u73af\u5883\u4e2d\u7684\u590d\u6742\u800c\u5168\u9762\u7684\u573a\u666f\u3002\\n\\n\u4e3a\u4e86\u8986\u76d6\u66f4\u591a\u7684\u573a\u666f\uff0c\u672a\u6765\u793e\u533a\u8ba1\u5212\u5229\u7528\u73b0\u6709\u7684 e2e \u6d4b\u8bd5\u6a21\u62df\u66f4\u52a0\u5b8c\u6574\u7684\u573a\u666f\uff0c\u8fdb\u884c\u66f4\u5927\u8303\u56f4\u3001\u66f4\u5f3a\u968f\u673a\u6027\u7684\u6df7\u6c8c\u6d4b\u8bd5\u3002\\n\\n### 2. \u4e3a\u66f4\u591a Apache APISIX \u9879\u76ee\u6dfb\u52a0\u6df7\u6c8c\u6d4b\u8bd5\\n\\n\u9664\u4e86\u4e3a Apache APISIX \u627e\u5230\u66f4\u591a\u53ef\u80fd\u7684\u8106\u5f31\u70b9\u4e4b\u5916\uff0c\u793e\u533a\u8fd8\u8ba1\u5212\u4e3a Apache APISIX Dashboard \u548c Apache APISIX Ingress Controller \u7b49\u66f4\u591a\u9879\u76ee\u6dfb\u52a0\u6df7\u6c8c\u6d4b\u8bd5\u3002\\n\\n### 3. \u4e3a Chaos Mesh \u6dfb\u52a0\u529f\u80fd\\n\\n\u5728\u90e8\u7f72 Chaos Mesh \u65f6\u9047\u89c1\u4e00\u4e9b\u6682\u4e0d\u652f\u6301\u7684\u529f\u80fd\uff0c\u5305\u62ec\u7f51\u7edc\u5ef6\u8fdf\u7684\u76ee\u6807\u4e0d\u652f\u6301\u9009\u62e9 service\uff0c\u7f51\u7edc\u6df7\u6c8c\u65e0\u6cd5\u6307\u5b9a\u5bb9\u5668\u7aef\u53e3\u6ce8\u5165\u7b49\uff0cApache APISIX \u793e\u533a\u672a\u6765\u4e5f\u4f1a\u534f\u52a9 Chaos Mesh \u6dfb\u52a0\u76f8\u5173\u529f\u80fd\u3002\u5e0c\u671b\u5f00\u6e90\u793e\u533a\u90fd\u4f1a\u8d8a\u6765\u8d8a\u597d\u3002"},{"id":"2021/06/10/apache-apisix-and-envoy-performance-comparison","metadata":{"permalink":"/zh/blog/2021/06/10/apache-apisix-and-envoy-performance-comparison","source":"@site/blog/2021/06/10/Apache-APISIX-and-Envoy-performance-comparison.md","title":"Apache APISIX \u548c Envoy \u6027\u80fd\u5927\u6bd4\u62fc","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684\u6027\u80fd\u5728\u5f00\u542f\u591a\u4e2a worker \u8fdb\u884c\u65f6\uff0c\u6027\u80fd\u6bd4 Envoy\u5f3a\u5927\u3002APISIX \u5728\u6027\u80fd\u548c\u5ef6\u8fdf\u4e0a\u7684\u8868\u73b0\u4f7f\u5b83\u5728\u5904\u7406\u5357\u5317\u5411\u6d41\u91cf\u4e0a\u5177\u6709\u6d77\u91cf\u7684\u541e\u5410\u80fd\u529b\u3002","date":"2021-06-10T00:00:00.000Z","formattedDate":"2021\u5e746\u670810\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":8.19,"truncated":true,"authors":[{"name":"\u827e\u83f2"}],"prevItem":{"title":"Chaos Mesh \u52a9\u529b Apache APISIX \u63d0\u5347\u7a33\u5b9a\u6027","permalink":"/zh/blog/2021/06/16/chaos-mesh-helps-apache-apisix-improve-stability"},"nextItem":{"title":"Apache APISIX \u5f00\u6e90 2 \u5468\u5e74\uff01","permalink":"/zh/blog/2021/06/06/apisix-two-years"}},"content":"> \u672c\u6587\u4ecb\u7ecd\u4e86\u5728\u4e00\u5b9a\u6761\u4ef6\u4e0b\uff0cApache APISIX \u548c Envoy \u7684\u6027\u80fd\u5bf9\u6bd4\uff0c\u603b\u4f53\u6765\u8bf4 Apache APISIX \u5728\u54cd\u5e94\u5ef6\u8fdf\u548c QPS \u5c42\u9762\u90fd\u7565\u4f18\u4e8e Envoy\uff0cApache APISIX \u5728\u5f00\u542f\u591a\u4e2a worker \u8fdb\u7a0b\u540e\u6027\u80fd\u63d0\u5347\u8f83 Enovy \u66f4\u4e3a\u660e\u663e\uff1b\u800c\u4e14 Apache APISIX \u5728\u6027\u80fd\u548c\u5ef6\u8fdf\u4e0a\u7684\u8868\u73b0\u4f7f\u5b83\u5728\u5904\u7406\u5357\u5317\u5411\u6d41\u91cf\u4e0a\u5177\u6709\u6d77\u91cf\u7684\u541e\u5410\u80fd\u529b\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> Source: https://www.apiseven.com/zh/blog/Apache-APISIX-and-Envoy-performance-comparison\\n\\n\u5728 CNCF \u7ec4\u7ec7\u7684\u4e00\u573a\u6280\u672f\u5206\u4eab\u4f1a\u4e0a\uff0c\u7b2c\u4e00\u6b21\u542c\u5230\u4e86 Envoy \u8fd9\u4e48\u4e00\u4e2a\u4e1c\u897f\uff0c\u5206\u4eab\u7684\u5609\u5bbe\u5df4\u62c9\u5df4\u62c9\u8bb2\u4e86\u4e00\u5927\u5806\uff0c\u5565\u90fd\u6ca1\u8bb0\u4f4f\uff0c\u5c31\u8bb0\u4f4f\u4e86\u4e00\u4e2a\u7279\u522b\u65b0\u9896\u7684\u6982\u5ff5\u201c\u901a\u4fe1\u603b\u7ebf\u201d\uff0c\u540e\u9762 google \u4e86\u4e0b Envoy \u8fd9\u4e2a\u4e1c\u897f\u5230\u5e95\u662f\u4ec0\u4e48\uff0c\u53d1\u73b0\u5b98\u7f51\u4e0a\u5982\u662f\u63cf\u8ff0\uff1a\\n\\n\u201cEnvoy \u662f\u4e13\u4e3a\u5927\u578b\u73b0\u4ee3 SOA\uff08\u9762\u5411\u670d\u52a1\u67b6\u6784\uff09\u67b6\u6784\u8bbe\u8ba1\u7684 L7 \u4ee3\u7406\u548c\u901a\u4fe1\u603b\u7ebf\u201d\\n\\n\u4e5f\u5c31\u662f\u8bf4\uff0c Envoy \u662f\u4e3a\u4e86\u89e3\u51b3 Service Mesh \u9886\u57df\u800c\u8bde\u751f\u4e00\u6b3e L7 \u4ee3\u7406\u8f6f\u4ef6\uff0c\u8fd9\u91cc\u6211\u7f51\u4e0a\u627e\u4e86\u4e00\u5f20\u56fe\uff0c\u6211\u7406\u89e3\u7684 Envoy \u5927\u6982\u662f\u5982\u4e0b\u7684\u90e8\u7f72\u67b6\u6784\u3002\uff08\u5982\u679c\u9519\u4e86\u8bf7\u5927\u4f6c\u6307\u6559\uff09\\n\\n![Envoy arch](https://static.apiseven.com/202108/20210617001.png)\\n\\n\u65e2\u7136\u662f L7 \u7684\u4ee3\u7406\u8f6f\u4ef6\u561b\uff0c\u4f5c\u4e3a\u5e38\u5e74\u6df7\u8ff9 OpenResty \u793e\u533a\u7684\u8001\u53f8\u673a\uff0c\u81ea\u7136\u5fcd\u4e0d\u4f4f\u628a\u5b83\u62ff\u6765\u641e\u4e00\u641e\uff0c\u5bf9\u6bd4\u5bf9\u6bd4\u3002\\n\\n\u6211\u4eec\u9009\u62e9\u7684\u6bd4\u8bd5\u5bf9\u8c61\u662f Apache APISIX\uff0c\u5b83\u662f\u57fa\u4e8e OpenResty \u5b9e\u73b0\u7684 API \u7f51\u5173\u3002\uff08\u5176\u5b9e\u4e5f\u5c31\u662f L7 \u4ee3\u7406\u7136\u540e\u52a0\u4e86\u8def\u7531\u3001\u8ba4\u8bc1\uff0c\u9650\u6d41\u3001\u52a8\u6001\u4e0a\u6e38\u7b49\u7b49\u4e4b\u7c7b\u7684\u529f\u80fd\uff09\\n\\n\u4e3a\u4ec0\u4e48\u9009\u62e9\u5b83\u5462\uff0c\u56e0\u4e3a\u6709\u4e00\u6b21\u793e\u533a\u5206\u4eab\u7684\u65f6\u5019\u542c\u8bf4\u8fd9\u8d27\u7684\u8def\u7531\u5b9e\u73b0\u975e\u5e38\u68d2\uff0c\u6b63\u597d\u6211\u4eec\u7684\u73b0\u5728\u4e1a\u52a1\u7684\u8def\u7531\u7cfb\u7edf\u4e71\u4e03\u516b\u7cdf\uff0c\u6252\u62c9\u4e86\u4e0b APISIX \u7684\u6e90\u7801\uff0c\u53d1\u73b0\u786e\u5b9e\u662f 6 \u5230\u98de\u8d77\uff0c\u540a\u6253\u6211\u770b\u5230\u8fc7\u7684\u540c\u7c7b\u4ea7\u54c1\uff0c \u6240\u4ee5\u5370\u8c61\u6df1\u523b\uff0c\u5c31\u5b83\u4e86\uff01\\n\\n\u8fd9\u91cc\u9644\u4e0a\u4e00\u5f20\u5728 APISIX \u5b98\u7f51\u6252\u62c9\u7684\u56fe\uff0c\u771f\u662f\u4e00\u56fe\u80dc\u5343\u8a00\uff0c\u4e00\u770b\u5c31\u77e5\u9053\u8fd9\u73a9\u610f\u513f\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002\\n\\n![APISIX arch](https://static.apiseven.com/202108/20210617002.png)\\n\\n\u5f00\u641e\u5427\uff0c\u9996\u5148\u6211\u4eec\u53bb\u5b98\u7f51\u627e\u5230\u4e24\u4e2a\u4ea7\u54c1\u7684\u6700\u7248\u672c\uff1a\\n\\nApache APISIX 1.5 \u548c Envoy 1.14\\n\\n\uff08\u7b14\u8005\u5728\u5199\u8fd9\u7bc7\u6587\u7ae0\u65f6\u7684\u6700\u65b0\u7248\uff09\\n\\n#### \u6784\u5efa\u73af\u5883\u51c6\u5907\\n\\n- \u538b\u529b\u6d4b\u8bd5\u5ba2\u6237\u7aef\uff1awrk\uff1b\\n- \u6d4b\u8bd5\u4e3b\u8981\u6307\u6807\u5305\u62ec\uff1a\u7f51\u5173\u5ef6\u8fdf\u3001QPS \u548c\u662f\u5426\u7ebf\u6027\u6269\u5c55\uff1b\\n- \u6d4b\u8bd5\u73af\u5883\uff1a\u5fae\u8f6f\u4e91 Linux (ubuntu 18.04)\uff0c Standard D13 v2 (8 vcpus, 56 GiB memory)\uff1b\\n- \u6d4b\u8bd5\u65b9\u5f0f 1\uff1a\u91c7\u7528\u5355\u6838\u8fd0\u884c\u6a2a\u5411\u5bf9\u6bd4\uff08\u56e0\u4e3a\u5b83\u4eec\u90fd\u662f\u57fa\u4e8e epoll \u7684 IO \u6a21\u578b\uff0c\u6240\u4ee5\u7528\u5355\u6838\u538b\u6d4b\u9a8c\u8bc1\u5b83\u4eec\u7684\u5904\u7406\u80fd\u529b\uff09\uff1b\\n- \u6d4b\u8bd5\u65b9\u5f0f 2\uff1a\u91c7\u7528\u591a\u6838\u8fd0\u884c\u6a2a\u5411\u5bf9\u6bd4\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u9a8c\u8bc1\u4e24\u8005\u5728\u6dfb\u52a0\u591a\uff08\u8fdb\u7a0b|\u7ebf\u7a0b\uff09\u7684\u573a\u666f\u4e0b\u5176\u6574\u4f53\u5904\u7406\u80fd\u529b\u662f\u5426\u80fd\u591f\u7ebf\u6027\u589e\u957f\uff1b\\n\\n#### \u6d4b\u8bd5\u573a\u666f\\n\\n\u8fd9\u91cc\u6211\u4eec\u7528 NGINX \u642d\u5efa\u4e86\u4e00\u4e2a\u4e0a\u6e38\u670d\u52a1\u5668\uff0c\u914d\u7f6e 2 \u4e2a worker\uff0c\u63a5\u6536\u5230\u8bf7\u6c42\u76f4\u63a5\u5e94\u7b54 4k \u5185\u5bb9\uff0c\u53c2\u8003\u914d\u7f6e\u5982\u4e0b:\\n\\n```text\\nserver {\\n  listen 1980;\\n\\n  access_log off;\\n  location = /hello {\\n    echo_duplicate 400 \\"1234567890\\";\\n  }\\n}\\n```\\n\\n- \u7f51\u7edc\u67b6\u6784\u793a\u610f\u56fe\u5982\u4e0b\uff1a\uff08\u7eff\u8272\u6b63\u5e38\u8d1f\u8f7d\uff0c\u672a\u8dd1\u6ee1\u3002\u7ea2\u8272\u4e3a\u9ad8\u538b\u8d1f\u8f7d\uff0c\u8981\u628a\u8fdb\u7a0b\u8d44\u6e90\u8dd1\u6ee1\uff0c\u4e3b\u8981\u662f CPU\uff09\\n\\n![test result](https://static.apiseven.com/202108/20210617003.png)\\n\\n#### \u8def\u7531\u914d\u7f6e\\n\\n\u9996\u5148\u6211\u4eec\u627e\u5230 APISIX \u7684\u5165\u95e8\u914d\u7f6e\u6307\u5357\uff0c\u6211\u4eec\u6dfb\u52a0\u4e00\u6761\u5230 /hello \u7684\u8def\u7531\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a\\n\\n```text\\ncurl http://127.0.0.1:9080/apisix/admin/routes/1 -X PUT -d \'{\u3001\\n    \\"uri\\": \\"/hello\\",\\n    \\"upstream\\": {\\n        \\"type\\": \\"roundrobin\\",\\n        \\"nodes\\": {\\n            \\"127.0.0.1:1980\\": 1\\n        }\\n    }}\'\\n```\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u6ca1\u5e76\u6ca1\u6709\u5f00\u59cb proxy_cache \u548c proxy_mirror \u63d2\u4ef6\uff0c\u56e0\u4e3a Enovy \u5e76\u6ca1\u6709\u7c7b\u4f3c\u7684\u529f\u80fd\uff1b\\n\\n\u7136\u540e\u6211\u4eec\u53c2\u8003 Envoy \u5b98\u65b9\u538b\u6d4b\u6307\u5bfc \u4e3a Envoy \u6dfb\u52a0\u4e00\u6761\u8def\u7531\uff1a\\n\\n```text\\nstatic_resources:\\n  listeners:\\n  - name: listener_0\\n    address:\\n      socket_address: { address: \\"0.0.0.0\\", port_value: 10000 }\\n\\n    filter_chains:\\n    - filters:\\n      - name: envoy.http_connection_manager\\n        config:\\n          generate_request_id: false,\\n          stat_prefix: ingress_http\\n          route_config:\\n            name: local_route\\n            virtual_hosts:\\n            - name: local_service\\n              domains: [\\"*\\"]\\n              routes:\\n              - match: { prefix: \\"/hello\\" }\\n                route: { cluster: service_test }\\n          http_filters:\\n          - name: envoy.router\\n            config:\\n              dynamic_stats: false\\n  clusters:\\n  - name: service_test\\n    connect_timeout: 0.25s\\n    type: LOGICAL_DNS\\n    dns_lookup_family: V4_ONLY\\n    lb_policy: ROUND_ROBIN\\n    hosts: [{ socket_address: { address: \\"127.0.0.1\\", port_value: 1980 }}]\\n    circuit_breakers:\\n      thresholds:\\n        - priority: DEFAULT\\n          max_connections: 1000000000\\n          max_pending_requests: 1000000000\\n          max_requests: 1000000000\\n          max_retries: 1000000000\\n        - priority: HIGH\\n        max_connections: 1000000000\\n        max_pending_requests: 1000000000\\n        max_requests: 1000000000\\n        max_retries: 1000000000\\n```\\n\\n\u4e0a\u9762\u7684 generate*request_id\u3001dynamic_stats \u548c circuit_breakers \u90e8\u5206\uff0c\u5728 Envoy \u5185\u90e8\u662f\u9ed8\u8ba4\u5f00\u542f\uff0c\u4f46\u672c\u6b21\u538b\u6d4b\u7528\u4e0d\u5230\uff0c\u9700\u8981\u663e\u5f0f\u5173\u95ed\u6216\u8bbe\u7f6e\u8d85\u5927\u9608\u503c\u4ece\u800c\u63d0\u5347\u6027\u80fd\u3002\uff08\u8c01\u80fd\u7ed9\u6211\u89e3\u91ca\u4e0b\u4e3a\u4ec0\u4e48\u8fd9\u73a9\u610f\u513f\u914d\u7f6e\u8fd9\u4e48\u590d\u6742 -*-!\uff09\\n\\n#### \u538b\u6d4b\u7ed3\u679c\\n\\n\u5355\u6761\u8def\u7531\uff0c\u4e0d\u5f00\u542f\u4efb\u4f55\u63d2\u4ef6\u3002\u5f00\u542f\u4e0d\u540c CPU \u6570\u91cf\uff0c\u8fdb\u884c\u6ee1\u8f7d\u538b\u529b\u6d4b\u8bd5\u3002\u8bf4\u660e\uff1a\u5bf9\u4e8e NGINX \u53eb worker \u6570\u91cf\uff0cEnvoy \u662f concurrent \uff0c\u4e3a\u4e86\u7edf\u4e00\u540e\u9762\u90fd\u53eb worker \u6570\u91cf\u3002\\n\\n| **\u8fdb\u7a0b\u6570**    | **APISIX QPS** | **APISIX Latency** | **Envoy QPS** | **Envoy Latency** |\\n| :------------ | :------------- | :----------------- | :------------ | :---------------- |\\n| **1 worker**  | 18608.4        | 0.96               | 15625.56      | 1.02              |\\n| **2 workers** | 34975.8        | 1.01               | 29058.135     | 1.09              |\\n| **3 workers** | 52334.8        | 1.02               | 42561.125     | 1.12              |\\n\\n\u6ce8\uff1a\u539f\u59cb\u6570\u636e\u516c\u5f00\u5728 [gist](https://gist.github.com/aifeiasdf/9fc4585f6404e3a0a70c568c2a14b9c9) \u9884\u89c8\u3002\\n\\n![test result](https://static.apiseven.com/202108/20210617004.png)\\n\\nQPS\uff1a\u6bcf\u79d2\u949f\u5b8c\u6210\u7684\u8bf7\u6c42\u6570\uff0c\u6570\u91cf\u8d8a\u591a\u8d8a\u597d\uff0c\u6570\u503c\u8d8a\u5927\u4ee3\u8868\u5355\u4f4d\u65f6\u95f4\u5185\u53ef\u4ee5\u5b8c\u6210\u7684\u8bf7\u6c42\u6570\u91cf\u8d8a\u591a\u3002\u4ece QPS \u7ed3\u679c\u770b\uff0cAPISIX \u6027\u80fd\u662f Envoy \u7684 120% \u5de6\u53f3\uff0c\u6838\u5fc3\u6570\u8d8a\u591a QPS \u5dee\u8ddd\u8d8a\u5927\u3002\\n\\nLatency\uff1a\u6bcf\u8bf7\u6c42\u7684\u5ef6\u8fdf\u65f6\u95f4\uff0c\u6570\u503c\u8d8a\u5c0f\u8d8a\u597d\u3002\u5b83\u4ee3\u8868\u6bcf\u8bf7\u6c42\u4ece\u53d1\u51fa\u540e\u9700\u8981\u7ecf\u8fc7\u591a\u957f\u65f6\u95f4\u53ef\u4ee5\u63a5\u6536\u5230\u5e94\u7b54\u3002\u5bf9\u4e8e\u53cd\u5411\u4ee3\u7406\u573a\u666f\uff0c\u8be5\u6570\u503c\u8d8a\u5c0f\uff0c\u5bf9\u8bf7\u6c42\u7684\u5f71\u54cd\u4e5f\u5c31\u6700\u5c0f\u3002\u4ece\u7ed3\u679c\u4e0a\u770b\uff0cEnvoy \u7684\u6bcf\u8bf7\u6c42\u5ef6\u8fdf\u8981\u6bd4 APISIX \u591a 6-10% \uff0c\u6838\u5fc3\u6570\u91cf\u8d8a\u591a\u5ef6\u8fdf\u8d8a\u5927\u3002\\n\\n\u53ef\u4ee5\u770b\u5230\u4e24\u8005\u5728\u5355\u5de5\u4f5c\u7ebf\u7a0b|\u8fdb\u7a0b\u7684\u6a21\u5f0f\u4e0b\uff0cQPS \u548c Latency \u4e24\u4e2a\u6307\u6807\u5dee\u8ddd\u4e0d\u5927\uff0c\u4f46\u662f\u968f\u7740\u5de5\u4f5c\u7ebf\u7a0b|\u8fdb\u7a0b\u7684\u589e\u52a0\u4ed6\u4eec\u7684\u5dee\u8ddd\u9010\u6e10\u653e\u5927\uff0c\u8fd9\u91cc\u6211\u5206\u6790\u53ef\u80fd\u6709\u4ee5\u4e0b\u4e24\u65b9\u9762\u7684\u539f\u56e0\uff0cNGINX \u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u7528\u591a worker \u548c\u7cfb\u7edf\u7684 IO \u6a21\u578b\u8fdb\u884c\u4ea4\u4e92\u662f\u4e0d\u662f\u4f1a\u66f4\u6709\u4f18\u52bf\uff0c\u53e6\u5916\u4e00\u65b9\u9762\uff0c\u4e5f\u53ef\u80fd\u662f NGINX \u81ea\u8eab\u5728\u5b9e\u73b0\u4e0a\u9762\u5bf9\u5185\u5b58\u548c CPU \u7684\u4f7f\u7528\u6bd4\u8f83\u201c\u62a0\u95e8\u201d\uff0c\u8fd9\u6837\u7d2f\u79ef\u8d77\u6765\u7684\u6027\u80fd\u4f18\u52bf\uff0c\u4ee5\u540e\u8be6\u7ec6\u8bc4\u4f30\u8bc4\u4f30\u3002\\n\\n#### \u603b\u7ed3\\n\\n\u603b\u4f53\u6765\u8bf4 APISIX \u5728\u54cd\u5e94\u5ef6\u8fdf\u548c QPS \u5c42\u9762\u90fd\u7565\u4f18\u4e8e Envoy\uff0c \u7531\u4e8e NGINX \u7684\u591a worker \u7684\u534f\u4f5c\u65b9\u5f0f\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u66f4\u6709\u4f18\u52bf\uff0c\u5f97\u76ca\u4e8e\u6b64\uff0cAPISIX \u5728\u5f00\u542f\u591a\u4e2a worker \u8fdb\u7a0b\u540e\u6027\u80fd\u63d0\u5347\u8f83 Enovy \u66f4\u4e3a\u660e\u663e\uff1b\u4f46\u662f\u4e24\u8005\u5e76\u4e0d\u51b2\u7a81\uff0c Envoy \u7684\u603b\u7ebf\u8bbe\u8ba1\u4f7f\u5b83\u5728\u5904\u7406\u4e1c\u897f\u5411\u6d41\u91cf\u4e0a\u6709\u72ec\u7279\u7684\u4f18\u52bf\uff0c APISIX \u5728\u6027\u80fd\u548c\u5ef6\u8fdf\u4e0a\u7684\u8868\u73b0\u4f7f\u5b83\u5728\u5904\u7406\u5357\u5317\u5411\u6d41\u91cf\u4e0a\u5177\u6709\u6d77\u91cf\u7684\u541e\u5410\u80fd\u529b\uff0c\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u6765\u9009\u62e9\u5408\u7406\u7684\u7ec4\u4ef6\u914d\u5408\u63d2\u4ef6\u6784\u5efa\u81ea\u5df1\u7684\u670d\u52a1\u624d\u662f\u6b63\u89e3\u3002"},{"id":"Apache APISIX \u5f00\u6e90 2 \u5468\u5e74\uff01","metadata":{"permalink":"/zh/blog/2021/06/06/apisix-two-years","source":"@site/blog/2021/06/06/apisix-two-years.md","title":"Apache APISIX \u5f00\u6e90 2 \u5468\u5e74\uff01","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u5f00\u6e90\u4e24\u5e74\u4e86\uff0c\u5728\u8fd9\u671f\u95f4\uff0cAPISIX \u5b9e\u73b0\u4e86\u5065\u5eb7\u68c0\u67e5\u3001\u670d\u52a1\u7194\u65ad\u3001\u5206\u5e03\u5f0f\u8ffd\u8e2a\u3001\u652f\u6301 etcd v3 \u534f\u8bae\u3001\u670d\u52a1\u53d1\u73b0\u7b49\u65b0\u529f\u80fd\u3002","date":"2021-06-06T00:00:00.000Z","formattedDate":"2021\u5e746\u67086\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":4.49,"truncated":true,"authors":[{"name":"\u8d75\u82e5\u5983","url":"https://github.com/Serendipity96","imageURL":"https://avatars.githubusercontent.com/u/23514812?v=4"}],"prevItem":{"title":"Apache APISIX \u548c Envoy \u6027\u80fd\u5927\u6bd4\u62fc","permalink":"/zh/blog/2021/06/10/apache-apisix-and-envoy-performance-comparison"},"nextItem":{"title":"\u6765\u81ea Apache APISIX committer \u7684\u7ecf\u9a8c\u5206\u4eab \u2014\u2014 \u7f16\u7a0b\u4e4b\u590f\u4e13\u8bbf","permalink":"/zh/blog/2021/06/03/experience-share-from-apache-apisix-committer"}},"content":"> Apache APISIX \u5f00\u6e90 2 \u5468\u5e74\u5566\uff01\\n\\n\x3c!--truncate--\x3e\\n\\n\u4eca\u5929\u662f 2021 \u5e74 6 \u6708 6 \u65e5\uff0c\u5728\u8fd9\u4e2a 666 \u7684\u65e5\u5b50 [Apache APISIX](https://github.com/apache/apisix) \u5f00\u6e90 2 \u5468\u5e74\u5566\uff01\ud83c\udf89\\n\\nApache APISIX \u4e8e 2019 \u5e74 6 \u6708 6 \u65e5\u5f00\u6e90\uff0c\u540c\u5e74 10 \u6708\u8fdb\u5165 Apache \u5b75\u5316\u5668\uff0c\u4e5f\u662f\u5728\u8fd9\u77ed\u77ed\u4e24\u5e74\u65f6\u95f4\u5185\uff0c\u6210\u4e3a\u4e86 **Apache \u9876\u7ea7\u9879\u76ee**\uff01\\n\\n\u5728\u8fdb\u5165 Apache \u5b75\u5316\u5668\u4e4b\u524d\uff0cApache APISIX \u4ec5\u6709 20 \u591a\u4e2a contributor\uff0c\u73b0\u5728\u548c Apache APISIX \u6709\u5173\u7684\u9879\u76ee\u5171\u6709 249 \u4e2a contributor\uff0c\u5728\u4e00\u5e74\u534a\u7684\u65f6\u95f4\uff0c**contributor \u6570\u91cf\u589e\u957f\u4e86 10 \u500d**\uff01 Apache APISIX \u7684\u793e\u533a\u4e5f\u975e\u5e38\u6d3b\u8dc3\uff0c\u622a\u6b62\u5230\u4eca\u5929 **249 \u4f4d contributor \u5171\u63d0\u4ea4\u4e86 2303 \u4e2a PR \uff0c\u6bcf\u4e2a\u6708\u90fd\u4f1a\u53d1\u5e03\u4e00\u4e2a\u65b0\u7248\u672c**\u3002\\n\\n![2019.6.6 ~ 2021.6.6 contributor growth curve](https://static.apiseven.com/202108/1630116210945-cdf0888f-c823-4eae-b404-3b1d6cb1b1e6.png)\\n\\n\u751f\u6d3b\u4e2d\uff0c\u5f53\u4f60\u53bb\u4e70\u673a\u7968\u3001\u5237\u5fae\u535a\u3001\u4e70\u5976\u8336\u7684\u65f6\u5019\uff0c\u80cc\u540e\u7684\u5173\u952e\u6d41\u91cf\u90fd\u662f\u7531 Apache APISIX \u6765\u5904\u7406\u7684\u3002\u5728\u8fd9\u4e24\u5e74\u91cc\uff0c Apache APISIX \u5df2\u7ecf\u88ab\u975e\u5e38\u591a\u7684\u4f01\u4e1a\u5e7f\u6cdb\u4f7f\u7528\uff0c\u6db5\u76d6\u91d1\u878d\u3001\u4e92\u8054\u7f51\u3001\u5236\u9020\u3001\u96f6\u552e\u3001\u8fd0\u8425\u5546\u7b49\u7b49\uff0c\u6bd4\u5982\u7f8e\u56fd\u7684\u822a\u7a7a\u822a\u5929\u5c40\uff08NASA)\u3001\u6b27\u76df\u7684\u6570\u5b57\u5de5\u5382\u3001\u4e2d\u56fd\u822a\u4fe1\u3001\u817e\u8baf\u3001\u534e\u4e3a\u3001\u5fae\u535a\u3001\u8d1d\u58f3\u627e\u623f\u3001\u4e2d\u56fd\u79fb\u52a8\u3001\u6cf0\u5eb7\u3001360\u3001\u5948\u96ea\u7684\u8336\u7b49\u7b49\u3002\u70b9\u51fb\u67e5\u770b [Apache APISIX \u7684\u7528\u6237\u5217\u8868](https://github.com/apache/apisix)\u3002\\n\\n**2019 \u5e74 8 \u6708\uff0cApache APISIX \u53d1\u5e03\u4e86\u7b2c\u4e00\u4e2a\u7248\u672c 0.6.0**\u3002\u8fd9\u4e2a\u7248\u672c\u5e26\u6765\u5f88\u591a\u65b0\u7684\u7279\u6027\uff1a\u5065\u5eb7\u68c0\u67e5\u3001\u670d\u52a1\u7194\u65ad\u3001debug \u6a21\u5f0f\uff0c\u5206\u5e03\u5f0f\u8ffd\u8e2a\u3001JWT \u8ba4\u8bc1\u7b49\uff0c\u4ee5\u53ca\u5185\u7f6e\u7684 dashboard\u3002\\n\\n**1.0 \u7248\u672c\u4e8e 2020 \u5e74 1 \u6708 \u53d1\u5e03\uff0c\u662f Apache APISIX \u7b2c\u4e00\u4e2a\u751f\u4ea7\u7248\u672c\u3002** \u8fd9\u4e2a\u7248\u672c\u4e0d\u4ec5\u652f\u6301\u4e86\u65b0\u7279\u6027\u2014\u2014\u5728 URI \u76f8\u540c\u7684\u6761\u4ef6\u4e0b\u6839\u636e header\u3001args\u3001\u4f18\u5148\u7ea7\u7b49\u6761\u4ef6\uff0c\u6765\u5339\u914d\u5230\u4e0d\u540c\u7684\u4e0a\u6e38\u670d\u52a1\uff0c\u800c\u4e14\u5728\u4ee3\u7801\u7a33\u5b9a\u6027\u3001\u6587\u6863\u65b9\u9762\u4e5f\u66f4\u52a0\u5b8c\u5584\uff0c\u5982\uff1a\u589e\u52a0\u81ea\u5b9a\u4e49\u5f00\u53d1\u63d2\u4ef6\u7684\u6587\u6863\u3001Oauth \u63d2\u4ef6\u7684\u4f7f\u7528\u6587\u6863\u3001dashboard \u7f16\u8bd1\u7684\u6587\u6863\u3001\u5982\u4f55\u8fdb\u884c a/b \u6d4b\u8bd5\u7684\u6587\u6863\u3001\u5982\u4f55\u5f00\u542f MQTT \u63d2\u4ef6\u7684\u6587\u6863\u7b49\uff0c\u8bf4\u660e Apache APISIX \u5f00\u59cb\u5728\u8d8a\u6765\u8d8a\u591a\u7684\u73af\u5883\u4e2d\u88ab\u5e94\u7528\u8d77\u6765\u3002\\n\\n**\u6bcf\u6708\u53d1\u5e03\u4e00\u4e2a\u65b0\u7248\u672c\uff0c\u6211\u4eec\u662f\u8ba4\u771f\u7684\uff01** \u5728 2020 \u5e74 10 \u6708\uff0c\u6211\u4eec\u53d1\u5e03\u4e86 2.0 \u7248\u672c\u30022.0 \u7248\u672c\u4ece etcd v2 \u534f\u8bae\u8fc1\u79fb\u5230 v3\uff0c\u53ea\u652f\u6301 etcd 3.4 \u4ee5\u53ca\u540e\u7eed\u7684\u7248\u672c\uff0c\u652f\u6301\u4e3a\u4e0a\u6e38\u5bf9\u8c61\u589e\u52a0\u6807\u7b7e\uff0c\u4e3a\u4e0a\u6e38\u3001\u8def\u7531\u7b49\u8d44\u6e90\u589e\u52a0\u66f4\u591a\u5b57\u6bb5\uff0c\u4f7f\u7528\u62e6\u622a\u5668\u6765\u4fdd\u62a4\u63d2\u4ef6\u7684\u8def\u7531\uff0c\u652f\u6301 http \u548c https \u76d1\u542c\u591a\u4e2a\u7aef\u53e3\uff0c\u589e\u52a0 AK/SK\uff08HMAC\uff09\u8ba4\u8bc1\u63d2\u4ef6\u3001 referer-restriction \u63d2\u4ef6\u3002\\n\\n**16 \u5929\u524d\uff0c\u6211\u4eec\u53d1\u5e03\u4e86 APISIX 2.6 \u7248\u672c\uff01** \u5728\u8fd9\u4e2a\u7248\u672c\u91cc\uff0c\u652f\u6301\u4e86\u5927\u5bb6\u547c\u58f0\u5f88\u9ad8\u7684\u65b0\u7279\u6027\uff0c\u5982\uff1a**\u4f7f\u7528\u5176\u4ed6\u8bed\u8a00\u7f16\u5199\u81ea\u5b9a\u4e49\u63d2\u4ef6\uff0c\u73b0\u5728\u5df2\u7ecf\u652f\u6301 Java \u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6\uff0c\u672c\u6708\u5e95\u8fd8\u4f1a\u652f\u6301\u4f7f\u7528 Go \u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6\uff01** \u9664\u6b64\u4e4b\u5916\uff0c2.6 \u7248\u672c\u7684\u751f\u6001\u5df2\u7ecf\u5b8c\u6574\u652f\u6301 Nacos \u670d\u52a1\u53d1\u73b0\uff0c\u652f\u6301\u914d\u7f6e IPv6 \u7684 DNS resolver\uff0c\u652f\u6301\u4fee\u6539 Prometheus \u9ed8\u8ba4\u7aef\u53e3\uff0c\u4e0d\u518d\u66b4\u9732\u5230\u6570\u636e\u9762\u7684\u7aef\u53e3\u4e0a\u3002\\n\\nApache APISIX \u7684\u76ee\u6807\u4e0d\u53ea\u662f\u505a\u4e00\u4e2a API \u7f51\u5173\uff0c**Apache APISIX \u5e0c\u671b\u505a\u4e91\u539f\u751f\u65f6\u4ee3\u56db\u5c42\u548c\u4e03\u5c42\u6d41\u91cf\u5904\u7406\u548c\u8fde\u63a5\u8005\u3002** \u5728 Apache APISIX \u91cc\u6240\u6709\u7684\u914d\u7f6e\u90fd\u662f\u52a8\u6001\u7684\uff0c\u8fd9\u5bf9\u4e8e\u4e91\u539f\u751f\u65f6\u4ee3\u7684\u5f39\u6027\u4f38\u7f29\u4ee5\u53ca\u591a\u4e91\u7684\u90e8\u7f72\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u6211\u4eec\u76f8\u4fe1 Apache APISIX \u662f\u4e91\u539f\u751f\u65f6\u4ee3\u6700\u597d\u7684\u9009\u62e9\u3002\u6b22\u8fce\u5927\u5bb6\u52a0\u5165 Apache APISIX \u7684\u5f00\u6e90\u793e\u533a\uff0c\u6b22\u8fce\u5927\u5bb6\u4f7f\u7528 Apache APISIX\uff01\\n\\nApache APISIX \u7684\u53d1\u5c55\u79bb\u4e0d\u5f00\u793e\u533a\u91cc\u7684\u6bcf\u4e00\u4e2a\u5c0f\u4f19\u4f34\uff0c**\u7279\u522b\u611f\u8c22 Apache APISIX \u793e\u533a\u7684 contributor \u548c\u793e\u533a\u7528\u6237\u4e3a Apache APISIX \u53d1\u5c55\u4f5c\u51fa\u7684\u8d21\u732e\u3002**\\n\\n![apisix contributors](https://static.apiseven.com/202108/1630468565074-c7e83b82-c40d-4c56-bc66-d1be2acc645b.jpeg)\\n\\nApache APISIX 2 \u5468\u5c81\uff0c\u751f\u65e5\u5feb\u4e50\uff01"},{"id":"2021/06/03/experience-share-from-apache-apisix-committer","metadata":{"permalink":"/zh/blog/2021/06/03/experience-share-from-apache-apisix-committer","source":"@site/blog/2021/06/03/experience-share-from-Apache-APISIX-committer.md","title":"\u6765\u81ea Apache APISIX committer \u7684\u7ecf\u9a8c\u5206\u4eab \u2014\u2014 \u7f16\u7a0b\u4e4b\u590f\u4e13\u8bbf","description":"\u672c\u6b21\u91c7\u8bbf\u9080\u8bf7\u5230\u4e86\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u7684 committer\uff0c\u5206\u4eab\u53c2\u4e0e\u5f00\u6e90\u9879\u76ee\u7684\u5fc3\u5f97\u4f53\u4f1a\uff0c\u4ee5\u53ca\u4ecb\u7ecd\u4e86\u5982\u4f55\u9009\u62e9\u9002\u5408\u81ea\u5df1\u7684\u9879\u76ee\u3002","date":"2021-06-03T00:00:00.000Z","formattedDate":"2021\u5e746\u67083\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":9.51,"truncated":true,"authors":[{"name":"\u8d75\u82e5\u5983","url":"https://github.com/Serendipity96","imageURL":"https://avatars.githubusercontent.com/u/23514812?v=4"}],"prevItem":{"title":"Apache APISIX \u5f00\u6e90 2 \u5468\u5e74\uff01","permalink":"/zh/blog/2021/06/06/apisix-two-years"},"nextItem":{"title":"Apache APISIX 2.6.0-Release \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/05/25/apache-apisix-2.6.0-release"}},"content":"> \u672c\u6b21\u91c7\u8bbf\u9080\u8bf7\u5230\u4e86\u53bb\u5e74\u53c2\u52a0\u7f16\u7a0b\u4e4b\u590f\u7684\u4e24\u4f4d\u540c\u5b66\uff0c\u4e24\u4f4d\u540c\u5b66\u73b0\u5728\u90fd\u662f Apache APISIX \u7684 committer\uff0c\u4e5f\u662f\u4eca\u5e74\u793e\u533a\u9879\u76ee\u7684\u5bfc\u5e08\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5206\u4eab\u5609\u5bbe\uff1a\u5434\u8212\u65f8\\n\\n![yiyiyimu](https://static.apiseven.com/202108/1630546588578-2d8386cd-06c0-4c71-848a-8ed0e1263a4e.png)\\n\\n**Q\uff1a\u8212\u65f8\uff0c\u8bf7\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1\u3002**\\n\\n**\u8212\u65f8**\uff1aHello\uff0c\u5927\u5bb6\u597d~ \u6211\u662f\u5434\u8212\u65f8\uff08Github ID: yiyiyimu\uff09\uff0c\u53bb\u5e74\u672c\u79d1\u6bd5\u4e1a\u4e8e\u4e0a\u6d77\u4ea4\u901a\u5927\u5b66\u73af\u5883\u5b66\u9662\uff0c\u4eca\u5e74\u516b\u6708\u4f1a\u5728\u4f50\u6cbb\u4e9a\u7406\u5de5\u5b66\u9662\u5f00\u59cb\u8bfb\u8ba1\u7b97\u673a\u7855\u58eb\u3002\u73b0\u5728\u5728 APISIX \u80cc\u540e\u7684\u5546\u4e1a\u516c\u53f8\u2014\u2014[\u652f\u6d41\u79d1\u6280](https://api7.ai/)\u5168\u804c\u7ef4\u62a4\u5f00\u6e90\u793e\u533a\uff0c\u4e5f\u662f Apache APISIX \u548c Chaos Mesh \u4e24\u4e2a\u9879\u76ee\u7684 committer\u3002\u53bb\u5e74\u53c2\u4e0e\u201c\u7f16\u7a0b\u4e4b\u590f 2020\u201d\u5728 Apache APISIX \u5b8c\u6210\u4e86\u201c\u652f\u6301 etcd v3 \u534f\u8bae\u201d\u8fd9\u4e2a\u9879\u76ee\uff0c\u8fd9\u4e5f\u4f5c\u4e3a\u4e86 APISIX v2.0 \u7684\u4e3b\u8981\u66f4\u65b0\u70b9\uff0c\u4e4b\u540e\u4e5f\u6709\u5e78\u88ab\u8bc4\u4e0a\u4e86\u201c\u7f16\u7a0b\u4e4b\u590f 2020\u201d\u7684\u4f18\u79c0\u5b66\u751f\uff0c\u4eca\u5e74\u4e5f\u4f1a\u4f5c\u4e3a mentor \u7ee7\u7eed\u53c2\u4e0e\u201c\u7f16\u7a0b\u4e4b\u590f 2021\u201d\u3002\\n\\n**Q\uff1a\u53bb\u5e74\u4e3a\u4ec0\u4e48\u4f1a\u9009\u62e9\u53c2\u52a0\u7f16\u7a0b\u4e4b\u590f\uff1f**\\n\\n**\u8212\u65f8**\uff1a\u53bb\u5e74\u56e0\u4e3a\u75ab\u60c5\u539f\u56e0\u6709\u65f6\u95f4\u53ef\u4ee5\u5728\u5bb6\u966a\u7236\u6bcd\uff0c\u5c31\u60f3\u7740\u5c3d\u91cf\u627e\u53ef\u4ee5\u8fdc\u7a0b\u5b9e\u4e60\u7684\u9879\u76ee\uff0c\u8fd0\u6c14\u5f88\u597d\u627e\u5230\u4e86\u5f00\u6e90\u793e\u533a\u7684\u6d3b\u52a8\uff08\u8fd9\u91cc\u7ed9\u6211\u53f8\u6253\u4e2a\u5e7f\u544a\uff0c\u4e0a\u73ed\u662f\u5b8c\u5168\u8fdc\u7a0b\u5de5\u4f5c\u7684\uff09\u3002\u7f16\u7a0b\u4e4b\u590f\u76f8\u6bd4 GSOC \u548c Community Bridge\uff0c\u56e0\u4e3a\u9879\u76ee\u591a\u5e76\u4e14\u6bcf\u4e2a\u9879\u76ee\u90fd\u4fdd\u8bc1\u4f1a\u6709\u81ea\u5df1\u7684 slot\uff0c\u53ef\u4ee5\u8bf4\u6709\u7740\u975e\u5e38\u9ad8\u7684\u5165\u9009\u7387\u4e86\u3002**\u53bb\u5e74\u7684\u6570\u636e\u662f\uff1a397 \u7684\u9879\u76ee\u6570\uff0c219 \u7684\u88ab\u7533\u8bf7\u6570\uff0c185 \u7684\u4e2d\u9009\u6570\u3002\u57fa\u672c\u6709\u7740 85% \u7684\u62a5\u540d\u4e2d\u9009\u7387\uff0c\u5982\u679c\u7b97\u4e0a\u53ef\u4ee5\u62a5\u540d\u4e09\u4e2a\u9879\u76ee\u4e2d\u9009\u7387\u5c31\u5927\u4e8e 99% \u4e86\uff0c\u6240\u4ee5\u6211\u8fd9\u4e2a Github Contribution Graph \u57fa\u672c\u5168\u767d\u7684\u4eba\u4e5f\u53ef\u4ee5\u5165\u9009\u3002**\\n\\n**Q\uff1a\u8212\u65f8\u53bb\u5e74\u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX \u7684\u9879\u76ee?**\\n\\n**\u8212\u65f8**\uff1a\u6211\u628a\u53bb\u5e74\u4f1a\u8bae\u4e0a\u8bb2\u7684 PPT \u622a\u51fa\u6765\u4e86\uff0c\u5bf9\u4e8e\u6709\u660e\u786e\u5174\u8da3\u76ee\u6807\u7684\u540c\u5b66\uff0c\u81ea\u7136\u4e0d\u9700\u8981\u8003\u8651\u5982\u4f55\u9009\u62e9\u9879\u76ee\u7684\u95ee\u9898\u3002\u4f46\u5982\u679c\u50cf\u53bb\u5e74\u7684\u6211\u81ea\u5df1\u4e00\u6837\uff0c\u770b\u4e00\u5708\u9879\u76ee\u4e0b\u6765\u53d1\u73b0\u90fd\u4e0d\u600e\u4e48\u770b\u5f97\u61c2\u8be5\u600e\u4e48\u529e\u5462\u3002\u8fd9\u4e2a\u65f6\u5019\u5927\u5bb6\u53ef\u80fd\u4f1a\u53bb\u9009\u62e9 star \u6570\u591a\u7684\u9879\u76ee\uff0c\u4f46\u5b9e\u9645\u4e0a **star \u6570\u591a\u53ea\u8868\u660e\u4e86\u8fd9\u4e2a\u9879\u76ee\u7684\u53d7\u6b22\u8fce\u7a0b\u5ea6\uff0c\u800c\u4e0d\u662f\u80fd\u4ece\u793e\u533a\u4e2d\u83b7\u5f97\u591a\u5c11\u5e2e\u52a9\u7684\u201c\u793e\u533a\u6d3b\u8dc3\u5ea6\u201d\u6307\u6807\u3002\u6d3b\u8dc3\u7684\u793e\u533a\u5728\u4f60\u4e24\u4e2a\u9636\u6bb5\u90fd\u4f1a\u6709\u6240\u88e8\u76ca\uff0c\u5728\u5165\u95e8\u65f6\u63d0\u4f9b\u8db3\u591f\u7684\u5e2e\u52a9\uff0c\u4e5f\u5728\u540e\u9762\u7ef4\u62a4\u793e\u533a\u65f6\u63d0\u4f9b\u8db3\u591f\u7684\u53cd\u9988\u3002**\\n\\n![github introduction](https://static.apiseven.com/202108/1630546653087-23ff48eb-8e13-464c-874e-c4225cc32336.png)\\n\\n**\u8212\u65f8**\uff1a**\u6211\u5f53\u65f6\u9009\u62e9\u7684\u6307\u6807\u4e3b\u8981\u662f issue \u56de\u590d\u60c5\u51b5\uff08\u5165\u95e8\u65f6\u78b0\u5230\u95ee\u9898\u80fd\u5426\u53ca\u65f6\u5f97\u5230\u56de\u590d\uff09\u3001good first issue \u6570\u91cf\uff08\u6709\u6ca1\u6709\u597d\u5165\u624b\u7684 issue\uff0c\u65e2\u589e\u52a0\u5bf9\u9879\u76ee\u7684\u4e86\u89e3\u4e5f\u53ef\u4ee5\u591a\u5237\u8138\uff09\u4ee5\u53ca insights \u6307\u6807\uff08\u793e\u533a\u6574\u4f53\u7684\u6d3b\u8dc3\u5ea6\uff09\u3002** \u4eca\u5e74\u6211\u4eec\u5728\u516c\u53f8\u4e5f\u5199\u4e86\u4e00\u4e2a\u67e5\u770b[\u8d21\u732e\u8005](https://github.com/api7/contributor-graph)\u60c5\u51b5\u7684\u5c0f\u5de5\u5177\uff0c\u53ef\u4ee5\u66f4\u76f4\u89c2\u7684\u770b\u5230\u793e\u533a\u8d21\u732e\u8005\u589e\u957f\u60c5\u51b5\u4ee5\u53ca\u6708\u5ea6\u6d3b\u8dc3\u8d21\u732e\u8005\u591a\u5c11\uff0c\u4e5f\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u6307\u6807\u3002\\n\\n![join opensource](https://static.apiseven.com/202108/1630546703021-d63457b1-4068-45da-8bde-aa9c708c6793.png)\\n\\n**\u8212\u65f8**\uff1a\u53bb\u5e74\u53c2\u4e0e APISIX \u4e4b\u524d\u6211\u5bf9\u4e8e\u9879\u76ee\u9700\u8981\u7684\u6280\u672f\u6808\u5305\u62ec Lua/Openresty/etcd \u751a\u81f3 API \u7f51\u5173\u90fd\u5b8c\u5168\u6ca1\u6709\u4efb\u4f55\u4e86\u89e3\uff0c\u4f46\u5176\u5b9e\u4e0a\u624b\u901f\u5ea6\u5f88\u5feb\u3002\u501f\u52a9\u6587\u6863\u628a\u7a0b\u5e8f\u8dd1\u8d77\u6765\u8fd0\u884c\u51e0\u4e2a demo \u5f88\u5feb\u5c31\u53ef\u4ee5\u5b8c\u6210\uff0cLua \u4e5f\u534a\u5929\u5c31\u53ef\u4ee5\u4e0a\u624b\u3002\u8fd9\u91cc\u518d\u63a8\u8350\u4e00\u4e0b APISIX PMC moonming \u5927\u4f6c\u7684\u4e24\u4efd Openresty \u5165\u95e8\u5fc5\u5907\uff0c\u514d\u8d39\u7684 Openresty \u7535\u5b50\u4e66\u548c\u4ed8\u8d39\u7684 Openresty \u6781\u5ba2\u65f6\u95f4\u8bfe\u7a0b\uff0c\u5f53\u65f6\u5165\u95e8\u4ece\u5176\u4e2d\u6536\u83b7\u9887\u4e30\u3002\\n\\n**Q\uff1a\u793e\u533a\u6d3b\u8dc3\u5ea6\u5bf9\u5f00\u6e90\u9879\u76ee\u6765\u8bf4\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u8212\u65f8\u4ecb\u7ecd\u5730\u975e\u5e38\u8be6\u7ec6\u3002\u53c2\u52a0\u5230 Apache APISIX \u9879\u76ee\u4e2d\uff0c\u4f60\u6700\u5927\u7684\u6536\u83b7\u662f\u4ec0\u4e48\uff1f**\\n\\n**\u8212\u65f8**\uff1a\u6700\u5927\u6536\u83b7\u5e94\u8be5\u662f\u7b2c\u4e00\u6b21\u77e5\u9053\u4e86**\u5927\u578b\u9879\u76ee\u662f\u5982\u4f55\u8fd0\u4f5c\u7684**\u3002\u53ef\u80fd\u662f\u56e0\u4e3a\u8f6c\u4e13\u4e1a\u7684\u7f18\u6545\uff0c\u4e0d\u7ba1\u662f\u5728\u5b66\u6821\u505a\u7684\u8fd8\u662f\u81ea\u5df1\u505a\u7684\u9879\u76ee\u90fd\u53ea\u80fd\u7b97\u662f toy project\uff0c\u53c2\u4e0e\u5f00\u6e90\u793e\u533a\u662f\u6211\u7b2c\u4e00\u6b21\u5b66\u4e60\u5230\u4e00\u4e2a\u5728\u751f\u4ea7\u4e0a\u4f7f\u7528\u7684\u9879\u76ee\u662f\u5982\u4f55\u5f00\u53d1\u548c\u7ef4\u62a4\u7684\u3002\u5728\u793e\u533a\u4e2d\u4e5f\u4f1a\u9047\u89c1\u5404\u8def\u5927\u795e\u4ee5\u53ca\u70ed\u7231\u5f00\u6e90\u7684\u5c0f\u4f19\u4f34\u4eec\uff0c\u90fd\u662f\u975e\u5e38\u5f00\u5fc3\u7684\u7ecf\u5386\u3002\u4e5f\u975e\u5e38\u611f\u8c22 mentor nic-chen \u4e0d\u538c\u5176\u70e6\u7684\u6307\u5bfc\u6211\u8fd9\u4e2a\u5c0f\u767d\u3002\\n\\n**Q\uff1a\u8212\u65f8\u662f\u600e\u4e48\u6210\u4e3a committer \u7684\uff1f\u53ef\u4ee5\u8ddf\u5927\u5bb6\u5206\u4eab\u4e00\u4e9b\u4f60\u7684\u7ecf\u9a8c\u5417\uff1f**\\n\\n**\u8212\u65f8**\uff1a\u6700\u4e3b\u8981\u7684\u539f\u56e0\u5e94\u8be5\u5c31\u662f\u8d21\u732e\u4e86\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684 feature\u3002\u9664\u6b64\u4e4b\u5916\u56e0\u4e3a\u6211\u4eec\u662f\u5f00\u6e90\u793e\u533a\u561b\uff0c\u5206\u4eab\u5408\u4f5c\u90fd\u662f\u975e\u5e38\u91cd\u8981\u7684\u7ec4\u6210\u90e8\u5206\uff0c\u5728\u793e\u533a\u4e2d\u5e2e\u52a9\u4ed6\u4eba\uff0c\u56de\u590d issue\uff0creview PR\uff0c\u4ee5\u53ca\u5728\u90ae\u4ef6\u5217\u8868\u4e2d\u53c2\u4e0e\u65b0 feature \u7684\u8ba8\u8bba\u90fd\u662f\u53c2\u4e0e\u793e\u533a\u5f88\u91cd\u8981\u7684\u90e8\u5206\u3002\\n\\n**Q\uff1a\u5bf9\u60f3\u53c2\u52a0\u7f16\u7a0b\u4e4b\u590f 2021 \u7684\u5927\u5b66\u751f\uff0c\u6709\u4ec0\u4e48\u60f3\u8bf4\u7684\uff1f**\\n\\n**\u8212\u65f8**\uff1a\u5e0c\u671b\u5927\u5bb6\u591a\u591a\u62a5\u540d\uff0c\u4e0d\u8981\u6709\u592a\u591a\u987e\u8651\uff0c\u591a\u548c\u793e\u533a\u4ea4\u6d41\uff0c\u5927\u5bb6\u90fd\u975e\u5e38\u53cb\u597d\u7684\uff0c\u597d\u597d\u4eab\u53d7\u8fd9\u4e09\u4e2a\u6708\u7684\u5f00\u53d1\u7ecf\u5386~\\n\\n## \u5206\u4eab\u5609\u5bbe\uff1a\u767d\u6cfd\u5e73\\n\\n![Zeping Bai](https://static.apiseven.com/202108/1630546751119-8df77cd8-6be0-4f8e-af13-182e77462d73.png)\\n\\n**Q\uff1a\u6cfd\u5e73\uff0c\u4f60\u597d\uff0c\u8bf7\u505a\u4e2a\u7b80\u5355\u7684\u81ea\u6211\u4ecb\u7ecd\u5427\u3002**\\n\\n**\u6cfd\u5e73**\uff1a\u6211\u662f\u767d\u6cfd\u5e73\uff0c\u76ee\u524d\u5728\u5929\u6d25\u5546\u4e1a\u5927\u5b66\u5de5\u5546\u7ba1\u7406\u4e13\u4e1a\u5927\u4e09\u5e74\u7ea7\u3002\u4ece\u6211\u521d\u4e2d\u65f6\u5f00\u59cb\u6211\u5c31\u5728\u81ea\u5b66\u7f16\u7a0b\u4e86\uff0c\u5b83\u4e5f\u6210\u4e86\u6211\u7684\u5174\u8da3\u4e4b\u4e00\u3002\u6211\u64c5\u957f\u7684\u9886\u57df\u4e3b\u8981\u662f\u540e\u7aef\u3001Web \u524d\u7aef\u5f00\u53d1\uff0c\u66fe\u7ecf\u8fd8\u5ba2\u4e32\u8fc7 Android \u5f00\u53d1\uff0c\u4e3b\u8981\u4f7f\u7528 Golang\u3001PHP \u548c Javascript\u3002\\n\\n**Q\uff1a\u53bb\u5e74\u4f60\u4e3a\u4ec0\u4e48\u4f1a\u9009\u62e9\u53c2\u52a0\u7f16\u7a0b\u4e4b\u590f\uff0c\u9009\u62e9 Apache APISIX \u7684\u9879\u76ee?**\\n\\n**\u6cfd\u5e73**\uff1a\u4e4b\u524d\u5728\u4f7f\u7528 Apache APISIX \u7f51\u5173\u63a7\u5236\u9762\u677f\u65f6\u53d1\u73b0\u4e86\u4e00\u4e9b\u6ca1\u6709\u652f\u6301\u5230\u7684\u529f\u80fd\uff0c\u4e8e\u662f\u63d0\u4ea4\u4e86\u4e00\u4e9b\u4ee3\u7801\u5b8c\u5584\u4e86\u8fd9\u5757\u7684\u529f\u80fd\uff0c\u793e\u533a\u7684\u5927\u4f6c\u4eec\u5f88\u7ed9\u529b\uff0c\u80fd\u8ba9\u6211\u5b66\u5230\u4e0d\u5c11\u4e1c\u897f\uff0c\u8fd9\u7ed9\u4e86\u6211\u53c2\u4e0e\u5f00\u6e90\u9879\u76ee\u7684\u52a8\u529b\u3002\u5728\u53bb\u5e74\u7f16\u7a0b\u4e4b\u590f\u6d3b\u52a8\u5f00\u59cb\u4e4b\u524d\u6211\u7533\u8bf7\u4e86\u5176\u4ed6\u793e\u533a\u9879\u76ee\u7684 GSoC\uff0c\u4f46\u6ca1\u6709\u88ab\u9009\u4e2d\uff0c\u540e\u6765\u770b\u5230\u7f16\u7a0b\u4e4b\u590f 2020 \u7684\u6d3b\u52a8\u5ba3\u4f20\u65f6\uff0c\u5c31\u62a5\u540d\u53c2\u52a0\u4e86\u3002\\n\\n**Q\uff1a\u4eca\u5e74\u4f60\u6210\u4e3a\u4e86 Apache APISIX \u9879\u76ee\u5bfc\u5e08\uff0c\u5bf9\u4e8e\u9879\u76ee\u7533\u8bf7\u6709\u54ea\u4e9b tips \u53ef\u4ee5\u7ed9\u5230\u5927\u5bb6\uff1f**\\n\\n**\u6cfd\u5e73**\uff1a\u5728\u9879\u76ee\u7533\u8bf7\u4e66\u4e2d\u4e3b\u8981\u63cf\u8ff0\u4e00\u4e0b\u4f60\u5173\u4e8e\u5f53\u524d\u9879\u76ee\u65b9\u6848\u7684\u60f3\u6cd5\u6216\u76f8\u5173\u7684\u6280\u672f\u8def\u7ebf\uff0c\u540c\u65f6\u8fd8\u8981\u7b80\u8981\u63cf\u8ff0\u4e00\u4e0b\u5b9e\u73b0\u9879\u76ee\u76ee\u6807\u7684\u8fc7\u7a0b\uff08\u4ece\u6bcf\u4e00\u4e2a\u5c0f\u6a21\u5757\u51fa\u53d1\u9010\u6b65\u5b9e\u73b0\u9879\u76ee\u76ee\u6807\uff09\u548c\u5927\u81f4\u6240\u9700\u7684\u65f6\u95f4\u3002\u5176\u4f59\u7684\u4fe1\u606f\u9700\u8981\u5982\u4e2a\u4eba\u4ecb\u7ecd\u7b49\u3002\u4ee5\u4e0a\u5185\u5bb9\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5feb\u901f\u7684\u4f60\u7684\u80fd\u529b\u548c\u9879\u76ee\u65b9\u6848\uff0c\u6709\u52a9\u4e8e\u9879\u76ee\u7533\u8bf7\u3002\u540c\u65f6\u8fd8\u53ef\u4ee5\u63d0\u524d\u4e0e\u9879\u76ee\u5bfc\u5e08\u8054\u7cfb\uff0c\u4e86\u89e3\u66f4\u5168\u9762\u7684\u9879\u76ee\u4fe1\u606f\u3002\\n\\n**Q\uff1a\u6cfd\u5e73\uff0c\u4eca\u5e74\u4f60\u6210\u4e3a\u4e86\u793e\u533a\u9879\u76ee\u7684\u5bfc\u5e08\uff0c\u5173\u4e8e\u8fd9\u4e2a\u89d2\u8272\u7684\u8f6c\u53d8\uff0c\u6709\u4ec0\u4e48\u60f3\u548c\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u7684\u5417\uff1f**\\n\\n**\u6cfd\u5e73**\uff1a\u53bb\u5e74\u4f5c\u4e3a\u5b66\u751f\u53c2\u52a0\u7f16\u7a0b\u4e4b\u590f\u6d3b\u52a8\u65f6\uff0c\u5f97\u5230\u4e86\u4e0d\u5c11\u6307\u5bfc\u4e0e\u5e2e\u52a9\uff0c\u5982\u679c\u4f60\u4eca\u5e74\u9009\u62e9\u53c2\u52a0 Apache  APISIX \u793e\u533a\u7684\u9879\u76ee\uff0c\u6211\u540c\u6837\u4e5f\u4f1a\u4e3a\u4f60\u63d0\u4f9b\u5e2e\u52a9\uff0c\u8ba9\u4f60\u66f4\u5feb\u7684\u4e0a\u624b\u9879\u76ee\u5f00\u53d1\u3002\\n\\n**Q\uff1a\u5bf9\u60f3\u53c2\u52a0\u7f16\u7a0b\u4e4b\u590f 2021 \u7684\u5927\u5b66\u751f\uff0c\u4f60\u6709\u4ec0\u4e48\u8bdd\u60f3\u5bf9\u5404\u4f4d\u540c\u5b66\u8bf4\uff1f**\\n\\n**\u6cfd\u5e73**\uff1a\u7f16\u7a0b\u4e4b\u590f\u80fd\u78e8\u7ec3\u4f60\u7684\u6280\u672f\uff0c\u8fd8\u80fd\u5e2e\u52a9\u4f60\u66f4\u5feb\u5730\u5165\u95e8\u5f00\u6e90\u9879\u76ee\u7684\u534f\u4f5c\uff0c\u53c2\u4e0e\u5230\u5f00\u6e90\u9879\u76ee\u4e2d\u53bb\u3002\u7533\u8bf7\u9879\u76ee\u673a\u4f1a\u5f88\u591a\u540c\u65f6\u63d0\u4ea4\u7684\u6750\u6599\u4e5f\u5e76\u4e0d\u56f0\u96be\uff0c\u5e0c\u671b\u5927\u5bb6\u4e0d\u8981\u72b9\u8c6b\uff0c\u8e0a\u8dc3\u53c2\u52a0\uff01"},{"id":"2021/05/25/apache-apisix-2.6.0-release","metadata":{"permalink":"/zh/blog/2021/05/25/apache-apisix-2.6.0-release","source":"@site/blog/2021/05/25/Apache APISIX 2.6.0-Release.md","title":"Apache APISIX 2.6.0-Release \u6b63\u5f0f\u53d1\u5e03","description":"\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX 2.6.0-Release \u6b63\u5f0f\u53d1\u5e03\uff01\u652f\u6301\u4f7f\u7528\u5176\u4ed6\u8bed\u8a00\u7f16\u5199\u81ea\u5b9a\u4e49\u63d2\u4ef6\u3001Nacos \u670d\u52a1\u53d1\u73b0\u3001\u652f\u6301\u914d\u7f6e IPv6 DNS \u89e3\u6790 \uff0c\u6b22\u8fce\u5927\u5bb6\u4e0b\u8f7d\u4f7f\u7528\u3002","date":"2021-05-25T00:00:00.000Z","formattedDate":"2021\u5e745\u670825\u65e5","tags":[{"label":"Community","permalink":"/zh/blog/tags/community"}],"readingTime":5.235,"truncated":true,"authors":[{"name":"\u7f57\u6cfd\u8f69","url":"https://github.com/spacewander","imageURL":"https://avatars.githubusercontent.com/u/4161644?v=4"}],"prevItem":{"title":"\u6765\u81ea Apache APISIX committer \u7684\u7ecf\u9a8c\u5206\u4eab \u2014\u2014 \u7f16\u7a0b\u4e4b\u590f\u4e13\u8bbf","permalink":"/zh/blog/2021/06/03/experience-share-from-apache-apisix-committer"},"nextItem":{"title":"\u652f\u6301 10 \u4ebf\u65e5\u6d41\u91cf\u7684\u57fa\u7840\u8bbe\u65bd\uff1a\u5f53 Apache APISIX \u9047\u4e0a\u817e\u8baf","permalink":"/zh/blog/2021/05/24/tencent-games"}},"content":"> Apache APISIX 2.6.0-Release \u6b63\u5f0f\u53d1\u5e03\uff01\u6b22\u8fce\u5927\u5bb6\u4e0b\u8f7d\u4f7f\u7528\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## Release Notes\\n\\n\u258c**\u65b0\u529f\u80fd\uff1aAPISIX \u73b0\u5728\u652f\u6301\u4f7f\u7528\u5176\u4ed6\u8bed\u8a00\u7f16\u5199\u81ea\u5b9a\u4e49\u63d2\u4ef6**\\n\\nAPISIX \u73b0\u5728\u652f\u6301\u901a\u8fc7 Lua \u8bed\u8a00\u7f16\u5199\u63d2\u4ef6\uff0c\u5728\u4ee3\u7406\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\u6267\u884c\u81ea\u5b9a\u4e49\u7684\u903b\u8f91\uff0c\u8bf8\u5982\u8c03\u7528 webhook \u901a\u77e5\u5916\u90e8\u7cfb\u7edf\u3001\u6267\u884c\u7279\u6b8a\u7684\u9274\u6743\u903b\u8f91\u7b49\u7b49\u3002\u4f46\u662f\u6709\u4e9b\u60c5\u51b5\u4e0b\u5f00\u53d1\u8005\u53ef\u80fd\u4f1a\u60f3\u8981\u91c7\u7528 Lua \u4ee5\u5916\u7684\u8bed\u8a00\u6765\u7f16\u5199\u63d2\u4ef6\u3002\\n\\n\u6bd4\u5982\u5f00\u53d1\u8005\u4e0d\u719f\u6089 Lua\uff0c\u60f3\u8981\u7528\u81ea\u5df1\u719f\u6089\u7684\u8bed\u8a00\u6765\u7f16\u5199\u63d2\u4ef6\uff1b\u6216\u8005\u7b2c\u4e09\u65b9\u56e2\u961f\u53ea\u63d0\u4f9b\u4e86 Java SDK\uff0c\u6ca1\u6709\u529e\u6cd5\u5728 Lua \u63d2\u4ef6\u91cc\u9762\u4f7f\u7528\u3002\\n\\n\u4ece 2.6 \u7248\u672c\u5f00\u59cb\uff0c\u501f\u52a9 plugin runner\uff0cAPISIX \u652f\u6301\u8fd0\u884c\u975e Lua \u8bed\u8a00\u7f16\u5199\u7684\u63d2\u4ef6\u3002\u67b6\u6784\u56fe\u5982\u4e0b\uff1a\\n\\n![2021-05-25-1](https://static.apiseven.com/202108/1639462480260-86431748-7dcd-4643-816b-92104ec5a666.png)\\n\\nAPISIX \u4f1a\u4ee5 sidecar \u7684\u5f62\u5f0f\u8fd0\u884c plugin runner\u3002\\n\\n\u5b83\u4eec\u4e24\u8005\u4e4b\u95f4\u91c7\u7528 RPC \u8fdb\u884c\u901a\u8baf\uff0cAPISIX \u8d1f\u8d23\u53d1\u9001\u8bf7\u6c42\u6570\u636e\u548c\u914d\u7f6e\uff0cplugin runner \u8d1f\u8d23\u52a0\u8f7d\u7528\u6237\u7684\u81ea\u5b9a\u4e49\u63d2\u4ef6\uff0c\u5904\u7406\u8fd9\u4e9b\u6570\u636e\u5e76\u544a\u8bc9 APISIX \u600e\u4e48\u5904\u7406\u8fd9\u4e9b\u8bf7\u6c42\u3002\u76ee\u524d\u652f\u6301\u5728\u4ee3\u7406\u8bf7\u6c42\u5230\u4e0a\u6e38\u4e4b\u524d\uff0c\u6267\u884c\u975e Lua \u8bed\u8a00\u7f16\u5199\u7684\u903b\u8f91\u3002\u540e\u7eed\u5c06\u4f1a\u652f\u6301\u7528\u975e Lua \u8bed\u8a00\u6539\u5199\u54cd\u5e94\u3002\\n\\nAPISIX \u73b0\u5728\u653e\u7f6e\u4e86\u4e24\u4e2a\u5165\u53e3\u7ed9 plugin runner \u53d1\u9001 RPC\u3002\u4e00\u4e2a\u662f ext-plugin-pre-req\uff0c\u53e6\u4e00\u4e2a\u662f ext-plugin-post-req\u3002\u524d\u8005\u4f1a\u5728\u6267\u884c Lua \u63d2\u4ef6\u903b\u8f91\u524d\u8fd0\u884c\uff0c\u540e\u8005\u4f1a\u5728\u6267\u884c\u5b8c Lua \u63d2\u4ef6\u4e14\u5728\u4ee3\u7406\u8bf7\u6c42\u5230\u4e0a\u6e38\u4e4b\u524d\u8fd0\u884c\u3002\u8fd9\u4e24\u4e2a\u5165\u53e3\u90fd\u662f\u53ef\u4ee5\u5728\u8def\u7531\u7ea7\u522b\u4e0a\u52a8\u6001\u5f00\u5173\u7684\u3002\\n\\n\u5047\u8bbe\u6211\u4eec\u5bf9\u4e8e\u67d0\u4e9b\u8bf7\u6c42\u5f00\u542f\u4e86 ext-plugin-pre-req\uff0c\u4e14 plugin runner \u91cc\u9762\u52a0\u8f7d\u4e86 validator \u548c rewrite \u4e24\u4e2a\u63d2\u4ef6\uff0c\u90a3\u4e48\u6bcf\u4e2a\u5339\u914d\u7684\u8bf7\u6c42\uff0c\u5b83\u90fd\u4f1a\u89e6\u53d1\u5bf9 plugin runner \u7684 RPC \u8c03\u7528\uff0c\u5148\u6267\u884c plugin runner \u91cc\u9762\u7684 validator \u548c rewrite\uff0c\u7136\u540e\u628a\u6267\u884c\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9 APISIX\u3002APISIX \u53ef\u4ee5\u6839\u636e\u7ed3\u679c\u6765\u5224\u65ad\u662f\u5426\u8981\u7ee7\u7eed\u6267\u884c\u8bf7\u6c42\uff0c\u8fd8\u662f\u62d2\u7edd\u6389\u8bf7\u6c42\u3002\u5982\u679c\u7ee7\u7eed\u6267\u884c\uff0c\u4f1a\u8fd0\u884c APISIX \u5185\u7f6e\u7684 Lua \u63d2\u4ef6\uff0c\u6bd4\u5982\u9650\u6d41\u9650\u901f\u7b49\u7b49\u3002\u5982\u679c\u5f00\u542f\u7684\u662f ext-plugin-post-req\uff0c\u5219\u6b63\u597d\u76f8\u53cd\u3002\\n\\nJava \u548c Go \u7684 plugin runner \u5df2\u5728\u5f00\u53d1\u4e2d\u3002\u9884\u8ba1\u672c\u5468\u5185 Java \u7248\u7684 plugin runner \u5c06\u4f1a\u53ef\u7528\uff0cGo \u7248\u7684 plugin runner \u5c06\u4e8e\u516d\u6708\u4efd\u5b8c\u6210\u3002\\n\\n\u258c**\u5b89\u5168\u63d0\u5347\uff1a\u4fee\u6539 Prometheus \u9ed8\u8ba4\u7aef\u53e3\uff0c\u4e0d\u518d\u66b4\u9732\u5230\u6570\u636e\u9762\u7684\u7aef\u53e3\u4e0a**\\n\\n\u4e4b\u524d\u9ed8\u8ba4\u60c5\u51b5\u4e0b Prometheus \u7684\u6570\u636e\u4f1a\u66b4\u9732\u5728\u6570\u636e\u9762\u7684\u7aef\u53e3\u4e0a\uff0c\u867d\u7136\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e plugin interceptor \u6765\u9650\u5236 IP \u8bbf\u95ee\uff0c\u4f46\u662f\u8fd8\u662f\u5b58\u5728\u9ed8\u8ba4\u4e0d\u5b89\u5168\u7684\u95ee\u9898\u3002\u6240\u4ee5\u4ece 2.6 \u5f00\u59cb\uff0c\u4e13\u95e8\u91c7\u7528\u4e00\u4e2a\u65b0\u7aef\u53e3\u6765\u66b4\u9732\u6307\u6807\uff0c\u800c\u4e14\u9ed8\u8ba4\u53ea\u76d1\u542c 127.0.0.1 .\\n\\n\u5728 2.6 \u4e4b\u524d\uff0cPrometheus \u91c7\u96c6 APISIX \u7684\u6307\u6807\u65f6\u8bbf\u95ee\u7684\u662f\u6570\u636e\u9762\u7684\u7aef\u53e3\uff08\u9ed8\u8ba4 9080 \u7aef\u53e3\uff09\u3002\\n\\n\u65b0\u7aef\u53e3\u662f 9091 \u7aef\u53e3\uff0c\u4e14\u53ea\u76d1\u542c 127.0.0.1\uff0c\u4f60\u9700\u8981\u4fee\u6539\u76d1\u542c\u5730\u5740\u4e3a\u4f60\u7684\u670d\u52a1\u5668\u7684\u5185\u7f51\u5730\u5740\uff0c\u5e76\u52a0\u4e0a\u9632\u706b\u5899\u89c4\u5219\u786e\u4fdd\u53ea\u6709 Prometheus \u624d\u80fd\u8bbf\u95ee\u3002\\n\\n\u258c**\u652f\u6301:\u751f\u6001\u5b8c\u6574\u652f\u6301 Nacos \u670d\u52a1\u53d1\u73b0**\\n\\nAPISIX \u6dfb\u52a0\u4e86\u5bf9 Nacos \u670d\u52a1\u53d1\u73b0\u529f\u80fd\u7684\u652f\u6301\u3002\\n\\n\u7528\u6237\u53ea\u9700\u5f00\u542f Nacos \u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff0c\u5e76\u5728\u4e0a\u6e38\u914d\u7f6e\u4e2d\u8bbe\u7f6e\u670d\u52a1\u540d\u79f0\uff0cAPISIX \u5c31\u4f1a\u5728\u540e\u53f0\u5b9a\u671f\u6839\u636e\u670d\u52a1\u540d\u79f0\u83b7\u53d6 Nacos \u4e2d\u5bf9\u5e94\u670d\u52a1\u7684\u5b9e\u4f8b\u5730\u5740\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u65e0\u9700\u5728 APISIX \u91cc\u9762\u914d\u7f6e\u5177\u4f53\u7684\u4e0a\u6e38\u8282\u70b9\u5730\u5740\uff0c\u53ea\u9700\u8981\u5728 Nacos \u91cc\u9762\u914d\u7f6e\u5373\u53ef\u3002\\n\u76ee\u524d APISIX \u5185\u7f6e\u7684\u670d\u52a1\u53d1\u73b0\u529f\u80fd\u5df2\u652f\u6301\u4e0b\u5217\u5916\u90e8\u670d\u52a1\uff1a\\n\\n1. DNS\\n2. Consul KV mode\\n3. Eureka\\n4. Nacos\\n\\n\u258c**\u652f\u6301:\u914d\u7f6e IPv6 \u7684 DNS resolver**\\n\\n\u4e4b\u524d\u914d\u7f6e APISIX \u7684 DNS resolver \u65f6\uff0c\u53ea\u80fd\u914d\u7f6e IPv4 \u670d\u52a1\u5668\u3002\u4ece 2.6 \u7248\u672c\u4e4b\u540e\uff0c\u6211\u4eec\u52a0\u4e0a\u4e86\u5bf9 IPv6 DNS \u670d\u52a1\u5668\u7684\u652f\u6301\u3002\\n\\n\u73b0\u5728\u914d\u7f6e DNS resolver \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5199\u4e0a IPv6 \u7684\u670d\u52a1\u5668\u5730\u5740\u4e86\u3002\\n\\n## \u4e0b\u8f7d\\n\\n\u4e0b\u8f7d Apache APISIX 2.6.0-Release \u6e90\u4ee3\u7801\u53ca\u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\uff0c\u8bf7\u8bbf\u95ee\u4e0b\u8f7d\u9875\u9762: `https://apisix.apache.org/downloads/`\u3002\\n\\n## \u6587\u6863\u66f4\u65b0\\n\\n\u5728\u672c\u6b21\u53d1\u5e03\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u5728\u6301\u7eed\u66f4\u65b0\u548c\u53d1\u5e03\u65b0\u7684\u4f7f\u7528\u6587\u6863\uff0c\u6b22\u8fce\u5927\u5bb6\u63d0\u51fa\u5b9d\u8d35\u7684\u610f\u89c1\u3002\\n\\n`https://apisix.apache.org/docs/apisix/getting-started/`\\n\\n\u66f4\u8be6\u7ec6\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003 2.6 \u7248\u672c\u7684 Changelog \u548c GitHub \u4e0a Apache APISIX  \u7684\u63d0\u4ea4\u8bb0\u5f55\u3002"},{"id":"2021/05/24/tencent-games","metadata":{"permalink":"/zh/blog/2021/05/24/tencent-games","source":"@site/blog/2021/05/24/Tencent-Games.md","title":"\u652f\u6301 10 \u4ebf\u65e5\u6d41\u91cf\u7684\u57fa\u7840\u8bbe\u65bd\uff1a\u5f53 Apache APISIX \u9047\u4e0a\u817e\u8baf","description":"\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u4f60\u4e0d\u4ec5\u53ef\u4ee5\u4e86\u89e3 API \u7f51\u5173\u662f\u4ec0\u4e48\u3001\u7f51\u5173\u6a21\u5f0f\u5bf9\u4f20\u7edf\u670d\u52a1\u67b6\u6784\u7684\u6539\u8fdb\uff0c\u8fd8\u53ef\u4ee5\u4e86\u89e3\u817e\u8baf OTeam \u8bde\u751f\u7684\u539f\u56e0\u4ee5\u53ca Apache APISIX \u662f\u5982\u4f55\u5728\u817e\u8baf\u5185\u90e8\u843d\u5730\u7684\u3002","date":"2021-05-24T00:00:00.000Z","formattedDate":"2021\u5e745\u670824\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":14.815,"truncated":true,"authors":[{"name":"\u5f90\u946b"}],"prevItem":{"title":"Apache APISIX 2.6.0-Release \u6b63\u5f0f\u53d1\u5e03","permalink":"/zh/blog/2021/05/25/apache-apisix-2.6.0-release"},"nextItem":{"title":"Apache APISIX \u8d21\u732e\u8005\u4e13\u8bbf | \u666e\u534e\u6c38\u9053\u9ad8\u7ea7\u5b89\u5168\u987e\u95ee\u738b\u9e4f\u8bda","permalink":"/zh/blog/2021/01/11/interview-apache-apisix-contributor-wang-pengcheng-senior-security-advisor-of-pwc-south-china-data-security-and-privacy-protection-team"}},"content":"> \u672c\u6587\u6574\u7406\u81ea\u817e\u8baf\u6e38\u620f\u8d1f\u8d23\u5185\u90e8\u5bb9\u5668\u5e73\u53f0\u7684\u5de5\u7a0b\u5e08\u5f90\u946b\u5728 Apache APISIX Meetup - \u6df1\u5733\u7ad9\u7684\u6f14\u8bb2\uff0c\u901a\u8fc7\u9605\u8bfb\u672c\u6587\uff0c\u60a8\u4e0d\u4ec5\u53ef\u4ee5\u4e86\u89e3\u7f51\u5173\u662f\u4ec0\u4e48\u3001\u7f51\u5173\u6a21\u5f0f\u5bf9\u4f20\u7edf\u670d\u52a1\u67b6\u6784\u7684\u6539\u8fdb\uff0c\u8fd8\u53ef\u4ee5\u4e86\u89e3\u817e\u8baf OTeam \u8bde\u751f\u7684\u539f\u56e0\uff0c\u4ee5\u53ca Apache APISIX \u662f\u5982\u4f55\u5728\u817e\u8baf\u5185\u90e8\u843d\u5730\u7684\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u5728\u6b63\u5f0f\u8fdb\u5165\u5206\u4eab\u4e4b\u524d\uff0c\u5148\u4e3a\u5927\u5bb6\u4ecb\u7ecd\u4e00\u4e0b\u7f51\u5173\uff08Gateway\uff09\u7684\u4f5c\u7528\u548c\u4ef7\u503c\u3002\\n\\n## \u7f51\u5173\u662f\u4ec0\u4e48\\n\\n### \u4f20\u7edf\u67b6\u6784\u7684\u901a\u7528\u529f\u80fd\\n\\n\u5728\u4f20\u7edf\u7684\u67b6\u6784\u4e2d\uff0c\u6ca1\u6709\u7f51\u5173\uff0c\u90a3\u4e48\u901a\u7528\u529f\u80fd\u8be5\u600e\u4e48\u590d\u7528\u8d77\u6765\u5462\uff1f\u8fd9\u91cc\u7684\u901a\u7528\u529f\u80fd\u6307\u4e1a\u52a1\u65e0\u5173\u7684\u4e00\u4e9b\u7279\u6027\uff0c\u6bd4\u5982\uff1a\\n\\n- \u5b89\u5168\u6027\uff1a\u8eab\u4efd\u9a8c\u8bc1\u3001\u6388\u6743\u3001\u9632\u91cd\u653e\u3001\u9632\u7be1\u6539\u3001\u5bf9\u6297 DDos \u7b49\u3002\\n- \u53ef\u9760\u6027\uff1a\u670d\u52a1\u964d\u7ea7\u3001\u7194\u65ad\u3001\u9650\u6d41\u7b49\u3002\\n\\n\u8fd9\u4e9b\u529f\u80fd\u5728\u4f20\u7edf\u67b6\u6784\u4e0b\uff0c\u6700\u5e38\u89c1\u7684\u5904\u7406\u65b9\u6cd5\u5c31\u662f\u5c06\u5176\u653e\u5165\u670d\u52a1\u6846\u67b6\u5f53\u4e2d\uff0c\u901a\u8fc7 AOP \u7684\u65b9\u5f0f\u53bb\u5b9e\u73b0\uff0c\u7c7b\u4f3c\u4e0b\u56fe\uff1a\\n\\n![\u4f20\u7edf\u67b6\u6784](https://static.apiseven.com/202108/1630640321175-ee272ad4-d8ee-45f3-8b67-9630fb534a82.png)\\n\\n\u4f20\u7edf\u67b6\u6784\u56fe\u4e2d\u6709\u4ee5\u4e0b\u51e0\u4e2a\u6a21\u5757\uff1a\\n\\n- Backend\uff1a\u540e\u7aef\u670d\u52a1\u3002\\n- AOP\uff1a\u6846\u67b6\u643a\u5e26\u7684 AOP \u5206\u5c42\u3002\\n- SD\uff1a\u670d\u52a1\u4e2d\u5fc3\uff0c\u7528\u4e8e\u670d\u52a1\u95f4\u53d1\u73b0\uff0c\u6b64\u7ec4\u4ef6\u5728\u4e91\u539f\u751f\u73af\u5883\u4e0b\u7ecf\u5e38\u7528 Service \u66ff\u4ee3\u3002\\n- LB\uff1a\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u653e\u7f6e\u4e8e\u7f51\u7edc\u8fb9\u754c\u4e0a\uff0c\u4f5c\u4e3a\u5916\u90e8\u6d41\u91cf\u7684\u5165\u53e3\u3002\\n\\n\u8fd9\u79cd\u67b6\u6784\u5728\u65e9\u4e9b\u5e74\u7684\u8bbe\u8ba1\u4e2d\u975e\u5e38\u5e38\u89c1\uff0c\u7531\u6b64\u8bde\u751f\u4e86\u5f88\u591a\u5927\u800c\u5168\u7684\u670d\u52a1\u6846\u67b6\uff0c\u6bd4\u5982 Dubbo\u3001SpringCloud \u7b49\u3002\u5982\u679c\u6211\u4eec\u53bb\u8ba4\u771f\u7814\u7a76\u5b83\u4eec\u7684\u529f\u80fd\u4ecb\u7ecd\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u8fd9\u4e9b\u529f\u80fd\u70b9\u5b83\u4eec\u5927\u591a\u90fd\u6709\u3002\\n\\n\u8fd9\u79cd\u67b6\u6784\u7684\u4f18\u70b9\u5728\u4e8e\u4e0a\u4e0b\u6e38\u5173\u7cfb\u7b80\u5355\uff0c\u7f51\u7edc\u4f20\u8f93\u4e2d\u4e5f\u5c11\u4e86\u4e00\u6b21\u8f6c\u53d1\u3002\u4f46\u662f\u5b83\u4eec\u7684\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff1a\\n\\n- \u901a\u7528\u529f\u80fd\u7684\u8fed\u4ee3\u4f1a\u8feb\u4f7f\u4e1a\u52a1\u670d\u52a1\u66f4\u65b0\uff1a\u7531\u4e8e\u91c7\u7528\u7684\u662f\u4ee3\u7801\u5f15\u7528\uff0c\u56e0\u6b64\u9700\u8981\u4e1a\u52a1\u670d\u52a1\u91cd\u65b0\u7f16\u8bd1\u624d\u80fd\u4f7f\u529f\u80fd\u751f\u6548\u3002\u5bf9\u4e00\u4e9b\u6ca1\u6709\u5b9e\u73b0\u5e73\u6ed1\u53d1\u5e03\u7684\u56e2\u961f\uff0c\u7531\u4e8e\u670d\u52a1\u4f1a\u4e2d\u65ad\uff0c\u56e0\u6b64\u8fd8\u5f97\u6311\u4e1a\u52a1\u7684\u7a7a\u95f2\u671f\u53d1\u5e03\u3002\\n- \u7248\u672c\u96be\u4ee5\u7ba1\u7406\uff1a\u7531\u4e8e\u6211\u4eec\u4e0d\u53ef\u80fd\u6bcf\u6b21\u53d1\u5e03\u90fd\u8ba9\u6240\u6709\u4e1a\u52a1\u670d\u52a1\u5347\u7ea7\u6700\u65b0\u7248\uff0c\u957f\u6b64\u4ee5\u5f80\uff0c\u5404\u4e2a\u670d\u52a1\u7684\u7248\u672c\u5c06\u4f1a\u4e0d\u4e00\u81f4\u3002\\n\\n\u90a3\u4e48\u6211\u4eec\u662f\u5426\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u901a\u7528\u529f\u80fd\u4e0b\u6c89\u5230\u4e00\u4e2a\u72ec\u7acb\u7684\u670d\u52a1\uff0c\u5b83\u53ef\u4ee5\u5355\u72ec\u8fed\u4ee3\u4e14\u4e1a\u52a1\u65e0\u5173\uff1f\\n\\n### \u7f51\u5173\u6a21\u5f0f\u7684\u51fa\u73b0\\n\\n![\u7f51\u5173\u6a21\u5f0f](https://static.apiseven.com/202108/1630640321180-bd19ad6c-6116-4982-98e8-3b626285ed03.png)\\n\\n\u4ece\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4f20\u7edf\u67b6\u6784\u7684\u5927\u90e8\u5206\u5185\u5bb9\u90fd\u6ca1\u6709\u53d8\u5316\uff0c\u53ea\u662f\u5728\u540e\u7aef\u670d\u52a1\u4e0e LB\uff08\u8d1f\u8f7d\u5747\u8861\u5668\uff09\u4e4b\u95f4\u591a\u51fa\u4e86\u4e00\u4e2a\u89d2\u8272\uff1a\u7f51\u5173\u3002\\n\uff08\u8fd9\u91cc\u9700\u8981\u6f84\u6e05\u7684\u662f\uff0c\u672c\u6587\u8ba8\u8bba\u7684\u7f51\u5173\u7279\u6307 API Gateway \uff0c\u5373\u9488\u5bf9\u540e\u53f0\u670d\u52a1\u4ee5 API \u63d0\u4f9b\u670d\u52a1\u7684\u573a\u666f\u3002\uff09\\n\\n\u5728\u4e0a\u9762\u7684\u8fd9\u4e2a\u56fe\u4e2d\uff0c\u6709\u65f6 LB \u540c\u65f6\u4e5f\u8d77\u5230\u7f51\u5173\u7684\u4f5c\u7528\uff0c\u6bd4\u5982 k8s \u7684 Ingress \u7ec4\u4ef6\u3002\\n\\n\u6709\u4e86\u7f51\u5173\u8fd9\u4e2a\u7ec4\u4ef6\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u4f20\u7edf\u67b6\u6784\u7684\u901a\u7528\u529f\u80fd\u4e0b\u6c89\u5230\u7f51\u5173\uff0c\u8fd9\u6837\u4e00\u6765\u6211\u4eec\u83b7\u5f97\u4e86\u5f88\u591a\u7684\u597d\u5904\uff1a\\n\\n- \u7f51\u5173\u53ef\u4ee5\u72ec\u7acb\u8fed\u4ee3\uff0c\u4e0d\u518d\u9700\u8981\u4e1a\u52a1\u670d\u52a1\u914d\u5408\u3002\\n- \u4e0e\u8bed\u8a00\u65e0\u5173\uff0c\u53ef\u4ee5\u914d\u7f6e\u4e13\u95e8\u7684\u56e2\u961f\u7ef4\u62a4\u3002\\n\\n\u4f46\u662f\u7f51\u5173\u6a21\u5f0f\u4e5f\u6709\u81ea\u5df1\u7684\u7f3a\u70b9\uff1a\\n\\n- \u591a\u4e86\u4e00\u6b21\u8f6c\u53d1\uff0c\u5ef6\u8fdf\u53d8\u9ad8\uff0c\u6392\u67e5\u95ee\u9898\u590d\u6742\u5ea6\u53d8\u9ad8\u3002\\n- \u7f51\u5173\u5982\u679c\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u53ef\u80fd\u4f1a\u6210\u4e3a\u6574\u4e2a\u5e73\u53f0\u7684\u74f6\u9888\u3002\\n\\n\u5982\u4f55\u5e73\u8861\u597d\u7f51\u5173\u6a21\u5f0f\u7684\u597d\u5904\u548c\u7f3a\u70b9\uff0c\u4e0d\u4ec5\u5341\u5206\u8003\u9a8c\u4e1a\u52a1\u56e2\u961f\u7684\u5b9e\u529b\uff0c\u66f4\u662f\u4e0e\u7f51\u5173\u7684\u9009\u578b\u606f\u606f\u76f8\u5173\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981\u8bf7\u51fa\u672c\u6587\u8981\u4ecb\u7ecd\u7684\u4e24\u4e2a\u91cd\u70b9\u5bf9\u8c61\uff1a\u817e\u8baf OTeam \u548c Apache APISIX\u3002\\n\\n## \u9879\u76ee\u4ecb\u7ecd\\n\\n### OTeam\\n\\n\u5f88\u591a\u4eba\u5bf9\u817e\u8baf\u5185\u90e8\u7684\u8d5b\u9a6c\u6587\u5316\u6050\u6015\u65e9\u6709\u8033\u95fb\u3002\u5728\u817e\u8baf\u5185\u90e8\uff0c\u8001\u677f\u4eec\u4e3a\u4e86\u521b\u9020\u66f4\u6709\u7ade\u4e89\u529b\u7684\u4ea7\u54c1\uff0c\u901a\u5e38\u4f1a\u8ba9\u4e0d\u540c\u7684\u961f\u4f0d\u53bb\u540c\u4e00\u4e2a\u8d5b\u9053\u7ade\u4e89\u3002\u7531\u4e8e\u4ea7\u54c1\u7684\u7ade\u4e89\u5173\u7cfb\uff0c\u4e0b\u9762\u7684\u6280\u672f\u5f53\u7136\u4e5f\u4e0d\u4f1a\u5171\u4eab\uff0c\u56e0\u6b64\u5bfc\u81f4\u65e9\u671f\u7684\u817e\u8baf\u5728\u6280\u672f\u6c89\u6dc0\u65b9\u9762\u662f\u4e92\u8054\u7f51\u5927\u5382\u4e2d\u57ab\u5e95\u7684\u90a3\u4e2a\u3002\\n\\n\u4e3a\u4e86\u6574\u5408\u516c\u53f8\u5185\u7684\u91cd\u590d\u8f6e\u5b50\uff0c\u6c89\u6dc0\u6280\u672f\u4e2d\u53f0\u3002\u817e\u8baf\u5c06\u76f8\u540c\u6027\u8d28\u7684\u51e0\u4e2a\u6280\u672f\u4ea7\u54c1\u90fd\u653e\u5165\u540c\u4e00\u4e2a Oteam\uff0c\u5c06\u7ef4\u62a4\u4eba\u5458\u90fd\u6574\u5408\u8d77\u6765\uff0c\u4e00\u8d77\u53d1\u529b\uff0c\u8ba9\u8fd9\u4e9b\u4ea7\u54c1\u9010\u6e10\u5408\u5e76\u6210\u4e00\u4e2a\u5927\u800c\u5168\u7684\u4ea7\u54c1\uff0c\u8fd9\u5c31\u662f Oteam\u3002\\n\\n\u6709\u7684 Oteam \u4e0b\u9762\u6709\u591a\u8fbe\u5341\u6570\u79cd\u4ea7\u54c1\uff0c\u800c\u6709\u7684\u53ea\u6709\u4e00\u79cd\u3002\u6bd4\u5982 Apache APISIX \u6240\u5728\u7684 Oteam \u5c31\u5355\u5355\u53ea\u6709 Apache APISIX \u8fd9\u4e00\u4e2a\u4ea7\u54c1\uff0c\u8fd9\u4e2a Oteam \u6210\u7acb\u7684\u521d\u8877\u662f\uff1a\u7ef4\u62a4\u817e\u8baf\u5185\u90e8\u7684 Apache APISIX \u5b9a\u5236\u5316\u7279\u6027\u3002\\n\\n### Apache APISIX\\n\\n\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u770b\u770b Apache APISIX \u7684 GitHub \u9879\u76ee\u4e3b\u9875\uff1a[Apache APISIX](https://github.com/apache/apisix)\u3002\u6211\u4eec\u5728\u8fd9\u91cc\u53ea\u7b80\u5355\u4ecb\u7ecd\u51e0\u4e2a\u70b9\uff1a\\n\\n- Apache APISIX \u662f\u57fa\u4e8e OpenResty \u7684\u9ad8\u6027\u80fd\u7f51\u5173\uff0c\u6bd4\u8d77\u7ade\u54c1 Kong\uff0c\u5b83\u7684\u8def\u7531\u6027\u80fd\u9ad8\u4e86\u4e00\u4e2a\u6570\u91cf\u7ea7\u3002\\n- Apache APISIX \u4f7f\u7528 ETCD \u4f5c\u4e3a\u914d\u7f6e\u5b58\u50a8\uff0c\u53ef\u4ee5\u5b9e\u73b0\u914d\u7f6e\u79d2\u66f4\u65b0\u3002\\n- Apache APISIX \u662f Apache \u57fa\u91d1\u4f1a\u6bd5\u4e1a\u6700\u5feb\u3001\u6700\u8ba9\u5bfc\u5e08\u7701\u5fc3\u7684\u9879\u76ee\u4e4b\u4e00\u3002\\n\\n## Apache APISIX in OTeam\\n\\n\u5927\u5bb6\u662f\u4e0d\u662f\u5f88\u597d\u5947\u817e\u8baf\u7684 OTeam \u662f\u600e\u4e48\u8fd0\u4f5c\uff0c\u53c8\u5982\u4f55\u548c GitHub \u7684\u793e\u533a\u5f62\u6210\u53cc\u8d62\u7684\u5173\u7cfb\u7684\uff1f\\nOTeam \u7684\u8fd0\u4f5c\u53c2\u8003\u4e0b\u56fe\uff1a\\n\\n![OTeam \u7684\u8fd0\u8425\u7b56\u7565](https://static.apiseven.com/202108/1630640321189-46cf2163-552c-4816-bdf6-ef4f58702667.png)\\n\\n\u53ef\u4ee5\u770b\u5230 OTeam \u7684\u7279\u6027\u8fed\u4ee3\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u95ed\u73af\uff1a\\n\\n- \u7528\u6237\u901a\u8fc7 Issue \u53cd\u9988\u95ee\u9898\u548c\u9700\u6c42\\n- OTeam \u7684\u6210\u5458 \u5728 \u5468\u4f1a \u4e0a\u8ba8\u8bba\u89e3\u51b3\u65b9\u6848\uff0c\u6216\u8005\u76f4\u63a5\u5728 Issue \u4e2d\u8ddf\u8fdb\\n- \u6309\u7167\u89e3\u51b3\u65b9\u6848\u5b9e\u73b0\u7279\u6027 or \u4fee\u590d Bug\\n- \u4ee3\u7801 Review \u540e\uff0c\u7ecf\u5386 CI \u5408\u5165\u5230\u4e3b\u5e72\u4e2d\uff0c\u518d\u89c6\u60c5\u51b5\u9700\u4e0d\u9700\u8981\u6253\u5305\u955c\u50cf\u53d1\u7248\\n\u8fd9\u4e2a\u6d41\u7a0b\u5176\u5b9e\u548c GitHub \u591a\u6570\u5f00\u6e90\u9879\u76ee\u7684\u8d21\u732e\u8fc7\u7a0b\u662f\u6ca1\u533a\u522b\u7684\uff0c\u5173\u952e\u70b9\u5728\u4e8e\uff1a\\n- \u89e3\u51b3\u4e86 Issue \u540e\uff0c\u817e\u8baf\u5de5\u7a0b\u5e08\u4f1a\u5224\u65ad\u8fd9\u4e2a\u95ee\u9898\u5bf9\u4e8e\u793e\u533a\u6765\u8bf4\uff0c\u662f\u5426\u4e5f\u662f\u4e00\u4e2a\u5171\u6027\u95ee\u9898\u3002\u5982\u679c\u662f\uff0c\u5219\u4f1a\u53d1 PR \u5230\u793e\u533a\u7684\u4ed3\u5e93\u53bb\u3002\\n- \u817e\u8baf OTeam \u4f1a\u5b9a\u671f Review Apache APISIX \u7684\u65b0\u7279\u6027\uff0c\u5224\u65ad\u5176\u662f\u5426\u7a33\u5b9a\u3001\u662f\u5426\u5bf9\u817e\u8baf\u5185\u90e8\u4e5f\u662f\u4e00\u4e2a\u75db\u70b9\u3002\u5982\u679c\u7b54\u6848\u662f\u80af\u5b9a\u7684\uff0c\u5408\u5165\u76f8\u5173\u4ee3\u7801\u3002\\n\\n\u6700\u65e9\u671f\u7684\u65f6\u5019\uff0cOTeam \u4f1a\u6bcf 12 \u5c0f\u65f6\uff0c\u81ea\u52a8\u5408\u5165\u793e\u533a\u4ee3\u7801\u5230\u5185\u90e8\u4ed3\u5e93\u4e2d\uff0c\u4ee5\u4fdd\u8bc1\u6211\u4eec\u4e0e\u793e\u533a\u80fd\u591f\u5171\u540c\u524d\u8fdb\uff0c\u4f46\u8fd9\u79cd\u505a\u6cd5\u5e26\u6765\u4e86\u51e0\u4e2a\u95ee\u9898\uff1a\\n\\n- \u5408\u5165\u7684\u4ee3\u7801\u901a\u8fc7\u76ee\u524d\u7684\u96c6\u6210\u6d4b\u8bd5\u53ea\u80fd\u4fdd\u8bc1\u529f\u80fd \u6b63\u786e\u6027 \u5374\u6ca1\u6cd5\u4fdd\u8bc1 \u7a33\u5b9a\u6027\uff0c\u5f88\u591a\u5076\u73b0\u7684\u95ee\u9898\u90fd\u662f\u5728\u5e76\u53d1\u4e2d\u53d1\u751f\u7684\u3002\\n- \u5408\u5165\u7684\u4ee3\u7801\uff0c\u6709\u65f6\u4f1a\u4ea7\u751f\u4e0a\u6e38\u7684\u591a\u4e2a PR \u5728\u903b\u8f91\u4e0a\u51fa\u73b0\u51b2\u7a81\u7684\u95ee\u9898\uff0c\u4f46\u662f\u5404\u81ea\u7684 CI \u65e0\u6cd5\u68c0\u6d4b\u51fa\u6765\uff0c\u53ea\u6709\u5f53\u5408\u5165\u4e3b\u5e72\u540e\uff0c\u624d\u4f1a\u53d1\u73b0\u4e3b\u5e72\u7684\u4ee3\u7801\u4ea7\u751f\u4e86\u95ee\u9898\u3002\\n\\n\u51fa\u4e8e\u4ee5\u4e0a\u539f\u56e0\uff0c\u73b0\u5728 OTeam \u8f6c\u4e3a\u5b9a\u671f Review \u540e\u5408\u5165\u6240\u9700\u7279\u6027\u7684\u4ee3\u7801\u7684\u7b56\u7565\u3002\\n\\n## OTeam \u53d1\u5c55\u60c5\u51b5\\n\\n\u622a\u6b62 2021 \u5e74 5 \u6708\uff0cApache APISIX \u6240\u5728\u7684 OTeam \u5728\u817e\u8baf\u5185\u90e8\u5df2\u4e3a\u8d85\u8fc7\u5341\u4e2a\u56e2\u961f\u843d\u5730\u4e86 Apache APISIX\uff0c\u5176\u4e2d\u6700\u5927\u7684\u4e1a\u52a1\u65e5\u8bf7\u6c42\u91cf\u5df2\u8d85\u8fc7\u5341\u4ebf\uff0c\u540c\u65f6 OTeam \u4e5f\u4e3a Apache APISIX \u5f00\u53d1\u4e86\u8d85\u8fc7\u5341\u4e2a\u5185\u90e8\u7279\u6027\uff0c\u5176\u4e2d\u5305\u62ec\u5185\u90e8\u7684\u670d\u52a1\u53d1\u73b0\u3001RPC \u534f\u8bae\u8f6c\u6362\u3001\u6253\u901a\u76d1\u63a7\u5e73\u53f0\u7b49\u3002\u4e0e\u6b64\u540c\u65f6\uff0cOTeam \u4e5f\u5c06\u5f00\u53d1\u7684\u4e00\u4e9b\u901a\u7528\u7684\u7279\u6027\u8d21\u732e\u5230\u4e86\u793e\u533a\uff0c\u4e3a\u793e\u533a\u5e26\u6765\u4e86\u4e0d\u5c11 Contributor\u3002\u76ee\u524d OTeam \u56e2\u961f\u4e2d\uff0c\u6709\u4e24\u4f4d\u6210\u5458\u540c\u65f6\u4e5f\u662f ApacheAPISIX \u793e\u533a\u7684 PMC\uff0cOTeam \u4e3a\u793e\u533a\u8d21\u732e\u4e86\u8d85\u8fc7 50 \u4e2a PR\u3002\u540c\u65f6\uff0c\u6211\u4eec\u76f8\u4fe1 OTeam \u4eca\u540e\u8fd8\u4f1a\u4e0e Apache APISIX \u793e\u533a\u5f00\u5c55\u66f4\u591a\u7684\u5408\u4f5c\u3002\\n\\n## \u817e\u8baf\u5185\u90e8\u7279\u6027\u4ecb\u7ecd\\n\\nOTeam \u7684\u4e3b\u8981\u804c\u8d23\u662f\u7ef4\u62a4 Apache APISIX \u7684\u4e00\u4e9b\u9488\u5bf9\u817e\u8baf\u5185\u90e8\u7684\u7279\u6027\uff0c\u90a3\u4e48\u8fd9\u4e9b\u7279\u6027\u90fd\u662f\u54ea\u4e9b\uff0c\u53c8\u89e3\u51b3\u4e86\u4ec0\u4e48\u6837\u7684\u75db\u70b9\u5462\uff1f\\n\\n### \u5185\u90e8\u7684\u75db\u70b9\\n\\n\u5148\u6765\u770b\u770b\uff0c\u6709\u54ea\u4e9b\u75db\u70b9\u662f\u817e\u8baf\u5185\u90e8\u72ec\u6709\u7684\uff1a\\n\\n- RPC \u6846\u67b6\u5bf9\u524d\u7aef\u4e0d\u53cb\u597d\uff1a\u817e\u8baf\u5185\u90e8\u6709\u5f88\u591a\u9057\u7559\u9879\u76ee\u4f7f\u7528\u4e86 TARS \u6846\u67b6\uff0c\u5b83\u4e0d\u50cf TRPC \u4e00\u6837\u53ef\u4ee5\u76f4\u63a5\u652f\u6301 HTTP \u534f\u8bae\uff0c\u5b83\u53ea\u652f\u6301 RPC \u6846\u67b6\u6700\u4f20\u7edf\u7684 TCP \u534f\u8bae\uff0c\u4f20\u8f93\u5185\u5bb9\u90fd\u4f7f\u7528\u7279\u5b9a\u7684\u4e8c\u8fdb\u5236\u534f\u8bae\u3002\u8fd9\u5e26\u6765\u7684\u4e00\u4e2a\u95ee\u9898\u662f\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u4e2d\u95f4\u670d\u52a1\u6765\u5c06\u8fd9\u4e9b\u63a5\u53e3\u8f6c\u6362\u4e3a\u524d\u7aef\u53cb\u597d\u7684 HTTP + Json \u5f62\u5f0f\u3002\\n- \u670d\u52a1\u4e2d\u5fc3\u591a\u6837\u5316\uff1a\u817e\u8baf\u5185\u90e8\u670d\u52a1\u53d1\u73b0\u7684\u7ec4\u4ef6\u4f17\u591a\uff0c\u6bd4\u5982 CL5\u3001L5\u3001\u5317\u6781\u661f\u7b49\u3002\u867d\u7136\u5728\u672a\u6765\uff0c\u670d\u52a1\u7ec4\u4ef6\u4f1a\u9010\u6e10\u7edf\u4e00\uff0c\u4f46\u5728\u8fc7\u6e21\u671f\u95f4\uff0c\u4f1a\u5b58\u5728\u591a\u4e2a\u670d\u52a1\u4e2d\u5fc3\u540c\u65f6\u4f7f\u7528\u7684\u60c5\u51b5\uff0c\u6700\u5f00\u59cb\u7684 Apache APISIX \u4e0d\u652f\u6301\u8fd9\u4e00\u70b9\u3002\\n- \u544a\u8b66\uff1a\u4f5c\u4e3a\u4e00\u4e2a\u7f51\u5173\u89e3\u51b3\u65b9\u6848\uff0c\u544a\u8b66\u4e0d\u662f\u4e00\u4e2a\u5b83\u5e94\u8be5\u5173\u6ce8\u7684\u65b9\u5411\uff0c\u4f46\u662f\u4f5c\u4e3a\u7f51\u5173\u8fd9\u4e2a\u57fa\u7840\u7ec4\u4ef6\uff0c\u544a\u8b66\u4e00\u5b9a\u662f\u56e2\u961f\u6240\u5173\u5fc3\u7684\u4e8b\u9879\uff0c\u8981\u600e\u4e48\u89e3\u51b3\u544a\u8b66\u95ee\u9898\uff0c\u4e5f\u662f\u4e00\u4e2a\u75db\u70b9\u3002\\n- \u5b89\u5168\u6027\uff1a\u817e\u8baf\u8fd9\u79cd\u4f53\u91cf\u7684\u516c\u53f8\uff0c\u9664\u4e86\u4ea7\u54c1\u672c\u8eab\u4f1a\u9762\u5bf9\u5927\u91cf\u6d41\u91cf\u4e4b\u5916\uff0c\u4ea7\u54c1\u8fd8\u6709\u5b89\u5168\u6027\u7684\u8981\u6c42\u3002\u4e0d\u4e4f ToC \u7684\u4ea7\u54c1\u4f7f\u7528\u4e86 OTeam \uff0c\u5b83\u4eec\u8981\u9762\u5bf9\u7684\u4e0d\u6b62\u6d77\u91cf\u7528\u6237\u7684\u8bef\u64cd\u4f5c\uff0c\u8fd8\u8981\u9762\u5bf9\u6765\u81ea\u7f51\u7edc\u7684\u653b\u51fb\uff0c\u65e0\u8bba\u662f\u5584\u610f\u8fd8\u662f\u6076\u610f\u7684\uff0c\u6700\u5178\u578b\u7684\u6709 DDos\u3001\u91cd\u653e\u3001\u7be1\u6539\u8bf7\u6c42\u7b49\u3002\u8fd9\u4e9b\u6d41\u91cf\u6211\u4eec\u662f\u5426\u53ef\u4ee5\u5728\u7f51\u5173\u5c42\u89e3\u51b3\uff1f\\n\\n### \u95ee\u9898\u7684\u89e3\u51b3\\n\\n\u5e26\u7740\u8fd9\u4e9b\u95ee\u9898\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u67b6\u6784\u62d3\u6251\u56fe\uff0c\u5b83\u6765\u81ea\u4e00\u4e2a\u817e\u8baf\u5185\u90e8\u67d0\u4e2a\u843d\u5730\u6848\u4f8b\u7684\u7b80\u5316\uff1a\\n\\n![OTeam \u67b6\u6784\u62d3\u6251\u56fe](https://static.apiseven.com/202108/1630640321184-dfcba4df-1b97-4d6e-ab10-07f89e131438.png)\\n\\n\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u521a\u624d\u63d0\u51fa\u7684\u51e0\u4e2a\u95ee\u9898\u90fd\u5728 OTeam \u90fd\u5f97\u5230\u4e86\u89e3\u51b3\uff1a\\n\\n- \u7f51\u5173\u5b9e\u73b0\u534f\u8bae\u8f6c\u6362\uff1aOTeam \u57fa\u4e8e Apache APISIX \u5b9e\u73b0\u4e86 TRPC \u4e0e TARS \u7684\u534f\u8bae\u8f6c\u6362\uff0c\u8fd9\u6837\u4e00\u6765\u90a3\u4e9b\u6ca1\u6709\u5b9e\u73b0 HTTP \u7684\u9057\u7559\u670d\u52a1\uff0c\u53ef\u4ee5\u5728\u7f51\u5173\u76f4\u63a5\u4f7f\u7528\u5c01\u88c5\u597d\u7684\u534f\u8bae\u8f6c\u6362\u63d2\u4ef6\u6765\u5b9e\u73b0 HTTP \u548c RPC \u4e92\u8f6c\u7684\u9700\u6c42\u800c\u4e0d\u518d\u9700\u8981\u7f16\u5199\u4e2d\u95f4\u670d\u52a1\u3002\\n- \u652f\u6301\u591a\u670d\u52a1\u4e2d\u5fc3\uff1a\u8fd9\u4e00\u70b9\u5176\u5b9e\u5e94\u8be5\u4e0d\u6b62\u817e\u8baf\u5185\u90e8\u9700\u8981\uff0c\u76f8\u4fe1\u5916\u9762\u4e5f\u6709\u5f88\u591a\u540c\u5b66\u5728\u65b0\u8001\u67b6\u6784\u7684\u8fc7\u6e21\u671f\u9700\u8981\uff0c\u8be5\u7279\u6027\u6211\u4eec\u5df2\u7ecf\u53cd\u9988\u7ed9\u4e86\u793e\u533a\u3002\\n- \u6307\u6807\u4e0a\u62a5\u81ea\u7814\u76d1\u63a7\u5e73\u53f0\uff1aOTeam \u5229\u7528\u63d2\u4ef6\u6253\u901a\u4e86\u817e\u8baf\u5185\u90e8\u7684\u51e0\u4e2a\u4e3b\u8981\u7684\u76d1\u63a7\u5e73\u53f0\uff0c\u8ba9\u7528\u6237\u53ef\u4ee5\u7b80\u5355\u914d\u7f6e\u540e\u81ea\u52a8\u4e0a\u62a5\u63a5\u53e3\u53ef\u89c2\u6d4b\u6027\u7684\u76f8\u5173\u4fe1\u606f\uff08\u94fe\u8def\u8c03\u7528\u3001\u65e5\u5fd7\u3001\u7edf\u8ba1\uff09\uff0c\u4e0a\u62a5\u540e\u7528\u6237\u53ef\u81ea\u884c\u5728\u76d1\u63a7\u5e73\u53f0\u914d\u7f6e\u544a\u8b66\u3002\\n- \u9632\u91cd\u653e\u4e0e\u9632\u7be1\u6539\uff1aOTeam \u5b9e\u73b0\u4e86\u9632\u91cd\u653e\u548c\u9632\u7be1\u6539\u63d2\u4ef6\uff0c\u8ba9\u9700\u8981\u8fd9\u4e9b\u80fd\u529b\u7684\u5bf9\u5916\u7684\u4e1a\u52a1\u53ef\u4ee5\u76f4\u63a5\u5f00\u7bb1\u5373\u7528\uff0c\u4fdd\u62a4\u81ea\u5df1\u7684\u63a5\u53e3\u5b89\u5168\u3002\\n\u6211\u4eec\u5e0c\u671b\u8fd9\u4e9b\u4f8b\u5b50\u80fd\u8d77\u5230\u629b\u7816\u5f15\u7389\u7684\u4f5c\u7528\uff0c\u9f13\u52b1\u5927\u5bb6\u53bb\u53d1\u6398\u66f4\u591a Apache APISIX \u7684\u4f7f\u7528\u573a\u666f\uff0c\u66f4\u597d\u7684\u628a Apache APISIX \u8fd9\u4e2a\u597d\u7528\u7684\u5de5\u5177\u7528\u8d77\u6765\u3002\u6bd4\u5982\u5728\u817e\u8baf\u4e91\u56e2\u961f\uff0c\u5c31\u6709\u540c\u5b66\u5229\u7528\u7f51\u5173\u5b9e\u73b0\u4e86\u4e00\u4e9b\u817e\u8baf\u4e91\u5e73\u53f0\u5f3a\u5236\u8981\u6c42\u7684 API \u89c4\u8303\uff0c\u5c06\u8fd9\u903b\u8f91\u4e0b\u6c89\u5230\u4e86\u7f51\u5173\u3002\\n\\n## \u6700\u540e\u7684\u8bdd\\n\\n\u8f6c\u773c\u5728\u817e\u8baf\u5185\u5e2e\u52a9\u5404\u4e2a\u56e2\u961f\u7ef4\u62a4 Apache APISIX \u4e5f\u4e00\u5e74\u591a\u4e86\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cOTeam \u65e2\u5e2e\u52a9\u4e1a\u52a1\u56e2\u961f\u89e3\u51b3\u4e86\u4ed6\u4eec\u7684\u75db\u70b9\uff0c\u4e5f\u4e0d\u65ad\u5b8c\u5584\u4e86 Apache APISIX \u5728\u817e\u8baf\u5185\u90e8\u7684\u7279\u6027\uff0c\u540c\u65f6\u4e5f\u95f4\u63a5\u63a8\u52a8\u4e86\u793e\u533a\u7684\u53d1\u5c55\uff0c\u5b9e\u73b0\u4e86\u5171\u8d62\u3002\\n\u5982\u679c\u8bfb\u8005\u6240\u5728\u516c\u53f8\u5982\u679c\u8fd8\u6ca1\u6709\u843d\u5730\u7f51\u5173\u7684\u8bdd\uff0c\u53ef\u4ee5\u4e86\u89e3\u4e0b Apache APISIX\u3002\u5df2\u7ecf\u843d\u5730\u4e86\u7f51\u5173\u7684\u8bfb\u8005\uff0c\u4e5f\u5e0c\u671b\u672c\u6587\u80fd\u591f\u7ed9\u4f60\u4eec\u5e26\u6765\u4e00\u70b9\u5728\u7f51\u5173\u843d\u5730\u4e0a\u7684\u7075\u611f\u548c\u5e2e\u52a9\u3002\\n\\n> \u6b22\u8fce\u611f\u5174\u8da3\u7684\u540c\u5b66\u8bbf\u95ee bilibili [Apache APISIX \u5728\u817e\u8baf\u6e38\u620f\u7684\u5e94\u7528](https://www.bilibili.com/video/BV1yK4y1G7CP/)\uff0c\u89c2\u770b\u89c6\u9891\u3002"},{"id":"2021/01/11/interview-apache-apisix-contributor-wang-pengcheng-senior-security-advisor-of-pwc-south-china-data-security-and-privacy-protection-team","metadata":{"permalink":"/zh/blog/2021/01/11/interview-apache-apisix-contributor-wang-pengcheng-senior-security-advisor-of-pwc-south-china-data-security-and-privacy-protection-team","source":"@site/blog/2021/01/11/interview-Apache-APISIX-contributor-Wang-Pengcheng-Senior-Security-Advisor-of-PwC-South-China-Data-Security-and-Privacy-Protection-Team.md","title":"Apache APISIX \u8d21\u732e\u8005\u4e13\u8bbf | \u666e\u534e\u6c38\u9053\u9ad8\u7ea7\u5b89\u5168\u987e\u95ee\u738b\u9e4f\u8bda","description":"\u666e\u534e\u6c38\u9053\u62a5\u544a\u4e86 API \u7f51\u5173 Apache APISIX \u7684 Admin API \u9ed8\u8ba4 Token \u6f0f\u6d1e\uff0c\u4e3a\u4e86\u611f\u8c22\u9e4f\u8bda\u5bf9 Apache APISIX \u793e\u533a\u505a\u7684\u8d21\u732e\uff0c\u6211\u4eec\u4e5f\u7279\u610f\u5bf9\u9e4f\u8bda\u8fdb\u884c\u4e86\u4e13\u8bbf\u3002","date":"2021-01-11T00:00:00.000Z","formattedDate":"2021\u5e741\u670811\u65e5","tags":[{"label":"Vulnerabilities","permalink":"/zh/blog/tags/vulnerabilities"}],"readingTime":4.81,"truncated":true,"authors":[{"name":"\u6e29\u94ed","url":"https://github.com/moonming","imageURL":"https://avatars.githubusercontent.com/u/26448043?v=4"}],"prevItem":{"title":"\u652f\u6301 10 \u4ebf\u65e5\u6d41\u91cf\u7684\u57fa\u7840\u8bbe\u65bd\uff1a\u5f53 Apache APISIX \u9047\u4e0a\u817e\u8baf","permalink":"/zh/blog/2021/05/24/tencent-games"},"nextItem":{"title":"\u521d\u63a2 Kubernetes Service APIs","permalink":"/zh/blog/2020/12/18/first-look-at-kubernetes-service-api"}},"content":"> \u8fd1\u65e5\uff0c\u6765\u81ea\u666e\u534e\u6c38\u9053\u534e\u5357\u6570\u636e\u5b89\u5168\u53ca\u9690\u79c1\u4fdd\u62a4\u56e2\u961f\u7684\u9ad8\u7ea7\u5b89\u5168\u987e\u95ee\u738b\u9e4f\u8bda\u5411\u56fd\u5bb6\u4fe1\u606f\u5b89\u5168\u6f0f\u6d1e\u5171\u4eab\u5e73\u53f0\uff08CNVD\uff09\u548c Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\uff0c\u62a5\u544a\u4e86 Apache APISIX \u7684\u7b2c\u4e00\u4e2a CVE\uff1aApache APISIX Admin API \u9ed8\u8ba4 Token \u6f0f\u6d1e\uff08CVE-2020-13945\uff09\u3002\u4e3a\u4e86\u611f\u8c22\u9e4f\u8bda\u5bf9 Apache APISIX \u793e\u533a\u505a\u7684\u8d21\u732e\uff0c\u6211\u4eec\u4e5f\u7279\u610f\u5bf9\u9e4f\u8bda\u8fdb\u884c\u4e86\u4e13\u8bbf\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u8d21\u732e\u8005\u7b80\u4ecb\\n\\n\u738b\u9e4f\u8bda\uff0c\u666e\u534e\u6c38\u9053\u534e\u5357\u6570\u636e\u5b89\u5168\u53ca\u9690\u79c1\u4fdd\u62a4\u56e2\u961f\u62c5\u4efb\u9ad8\u7ea7\u5b89\u5168\u987e\u95ee\uff0c\u4e3a\u591a\u5bb6\u9f99\u5934\u4f01\u4e1a\u63d0\u4f9b\u6570\u636e\u5b89\u5168\u4e0e\u9690\u79c1\u5408\u89c4\u54a8\u8be2\u3001\u7ea2\u84dd\u5bf9\u6297\u3001\u5b89\u5168\u8fd0\u8425\u7b49\u6280\u672f\u670d\u52a1\uff0c\u76ee\u524d\u62e5\u6709 cisp/cisp-pte/cisp-dsg/CEH/iso27701/ccsk \u7b49\u591a\u9879\u5b89\u5168\u8ba4\u8bc1\u3002\\n\\n## \u4e13\u8bbf\u6b63\u6587\\n\\n**\u5c0f\u7f16**\uff1a\u606d\u559c\u9e4f\u8bda\uff01\u4e5f\u611f\u8c22\u9e4f\u8bda\u4e3a Apache APISIX \u793e\u533a\u505a\u7684\u8d21\u732e\uff01\u80fd\u7b80\u5355\u4ecb\u7ecd\u4e0b\u60a8\u548c\u60a8\u7684\u56e2\u961f\u561b\uff1f\\n\\n**\u9e4f\u8bda**\uff1a\u5927\u5bb6\u597d\uff0c\u6211\u662f\u738b\u9e4f\u8bda\uff0c\u6765\u81ea\u666e\u534e\u6c38\u9053\u5e7f\u5dde\u6570\u636e\u5b89\u5168\u53ca\u9690\u79c1\u4fdd\u62a4\u56e2\u961f\uff0c\u4e3a\u666e\u534e\u6c38\u9053\u7684\u5ba2\u6237\u63d0\u4f9b\u6570\u636e\u5b89\u5168\u548c\u9690\u79c1\u4fdd\u62a4\u7684\u4e13\u4e1a\u54a8\u8be2\u670d\u52a1\u3002\u505a\u4e3a\u4e00\u540d\u5b89\u5168\u54a8\u8be2\u987e\u95ee\u548c\u5f00\u6e90\u6280\u672f\u7231\u597d\u8005\uff0c\u5e2e\u52a9\u56e2\u961f\u62ff\u5230\u7b2c\u4e00\u679a CVE \u540c\u65f6\u4e5f\u4e3a Apache APISIX \u505a\u4e86\u4e00\u70b9\u8d21\u732e\uff0c\u8fd8\u662f\u86ee\u6fc0\u52a8\u7684\u3002\\n\\n**\u5c0f\u7f16**\uff1a\u666e\u534e\u6c38\u9053\u5728\u5927\u90e8\u5206\u4eba\u7684\u5370\u8c61\u4e2d\u662f\u4f1a\u8ba1\u5e08\u4e8b\u52a1\u6240\uff0c\u6ca1\u60f3\u5230\u8fd8\u63d0\u4f9b\u4e13\u4e1a\u7684\u5b89\u5168\u670d\u52a1\u3002\u8bf7\u95ee\u4f60\u4eec\u662f\u5982\u4f55\u4e86\u89e3\u5230 Apache APISIX \u7684\u5462\uff1f\\n\\n**\u9e4f\u8bda**\uff1a\u666e\u534e\u6c38\u9053\u4e0d\u4ec5\u63d0\u4f9b\u4f20\u7edf\u7684\u8d22\u52a1\u5ba1\u8ba1\u670d\u52a1\uff0c\u73b0\u5728\u8fd8\u63d0\u4f9b\u5b89\u5168\u8fd0\u8425\u3001\u4f01\u4e1a\u5b89\u5168\u54a8\u8be2\u3001\u6570\u636e\u5b89\u5168\u4e0e\u5408\u89c4\u3001\u9690\u79c1\u54a8\u8be2\u3001\u8f66\u8054\u7f51\u3001\u7269\u8054\u7f51\u7b49\u4e00\u7cfb\u5217\u7684\u5b89\u5168\u6d4b\u8bd5\u4e0e\u9690\u79c1\u5408\u89c4\u54a8\u8be2\u670d\u52a1\u30022020 \u5e74\u4e2d\uff0c\u6211\u4eec\u5728\u5bf9\u51e0\u4e2a\u5ba2\u6237\u505a\u6e17\u900f\u6d4b\u8bd5\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u4ed6\u4eec\u90fd\u4f7f\u7528\u4e86 Apache APISIX \u8fd9\u4e2a\u5f00\u6e90\u4ea7\u54c1\u4f5c\u4e3a API \u7f51\u5173\u3002\u867d\u7136\u8fd9\u5bf9\u4e8e\u6211\u4eec\u800c\u8a00\u662f\u4e00\u4e2a\u65b0\u7684\u4ea7\u54c1\uff0c\u4f46\u662f\u5df2\u7ecf\u88ab\u8fd9\u4e48\u591a\u4f18\u8d28\u5ba2\u6237\u4f7f\u7528\uff0c\u6211\u4eec\u51b3\u5b9a\u5bf9 Apache APISIX \u8fdb\u884c\u5b89\u5168\u65b9\u9762\u7684\u7814\u7a76\uff0c\u770b\u770b\u5176\u662f\u5426\u53ef\u9760\uff0c\u662f\u5426\u6709\u5b89\u5168\u6f0f\u6d1e\u3002\u7136\u540e\u6211\u4eec\u53d1\u73b0\u5176\u5b58\u5728\u56fa\u5b9a token \u7684\u95ee\u9898\uff0c\u8be5\u95ee\u9898\u5c06\u4f1a\u5bfc\u81f4\u6076\u610f\u653b\u51fb\u8005\u53ef\u76f4\u63a5\u63a7\u5236 API \u7f51\u5173\u800c\u5f71\u54cd\u5230\u6b63\u5e38\u4e1a\u52a1\u5f00\u5c55\u3002**\u4f46\u662f\u5728 Apache APISIX \u7684\u9ed8\u8ba4\u914d\u7f6e\u4e0b\uff0c\u5e76\u4e0d\u4f1a\u4ea7\u751f\u8fd9\u4e2a\u5b89\u5168\u95ee\u9898\uff0c\u53ea\u6709\u5728\u7528\u6237\u4fee\u6539\u4e86\u9ed8\u8ba4\u7684\u63a7\u5236\u5e73\u9762\u7684 IP \u9650\u5236\u800c\u6ca1\u6709\u4fee\u6539\u9ed8\u8ba4 token\uff0c\u624d\u4f1a\u628a\u81ea\u5df1\u66b4\u9732\u5728\u98ce\u9669\u4e4b\u4e2d\u3002**\\n\\n**\u5c0f\u7f16**\uff1a\u6211\u4eec\u56e2\u961f\u4e5f\u6709\u6765\u81ea\u5b89\u5168\u80cc\u666f\u7684\u540c\u4e8b\uff0c\u6211\u4eec\u4e86\u89e3\u5b89\u5168\u5bf9\u4e8e\u4e00\u4e2a\u4ea7\u54c1\u800c\u8a00\u662f\u591a\u4e48\u91cd\u8981\u3002\u8bf7\u95ee\u5728\u4f60\u4eec\u7684\u5b89\u5168\u6d4b\u8bd5\u4e2d\uff0c\u662f\u5426\u8fd8\u53d1\u73b0\u4e86 Apache APISIX \u7684\u5176\u4ed6\u95ee\u9898\u5462\uff1f\\n\\n**\u9e4f\u8bda**\uff1a\u6682\u65f6\u8fd8\u6ca1\u6709\u3002\u4e4b\u524d\u7684\u6d4b\u8bd5\u53ea\u662f\u7ad9\u5728\u9ed1\u76d2\u89d2\u5ea6\u5e76\u4e14\u6bd4\u8f83\u6d45\u7684\u4e00\u6b21\u5b89\u5168\u6d4b\u8bd5\uff0c\u540e\u7eed\u4f1a\u5c1d\u8bd5\u767d\u76d2\u5ba1\u8ba1\u76f8\u5173\u4ee3\u7801\uff0c\u4ece\u5b89\u5168\u7684\u89d2\u5ea6\u770b\u770b\u662f\u5426\u4f1a\u6709\u5176\u4ed6\u7684\u6f0f\u6d1e\u3002\u5982\u679c\u53d1\u73b0\u7684\u8bdd\uff0c\u4e5f\u4f1a\u7b2c\u4e00\u65f6\u95f4\u5411 Apache \u8f6f\u4ef6\u57fa\u91d1\u4f1a\u7684\u5b89\u5168\u90e8\u95e8\u62a5\u544a\uff0c\u6765\u4e3a\u5f00\u6e90\u793e\u533a\u8d21\u732e\u81ea\u5df1\u7684\u529b\u91cf\u3002\\n\\n**\u5c0f\u7f16**\uff1a\u975e\u5e38\u611f\u8c22\u9e4f\u8bda\u548c\u666e\u534e\u6c38\u9053\u5e7f\u5dde\u6570\u636e\u5b89\u5168\u53ca\u9690\u79c1\u4fdd\u62a4\u56e2\u961f\u7684\u540c\u4e8b\uff01\u5bf9\u4e8e\u5f00\u6e90\u9879\u76ee\u800c\u8a00\uff0c\u4e0d\u4ec5\u4ee3\u7801\u548c\u6587\u6863\u662f\u8d21\u732e\uff0c\u62a5\u544a\u5b89\u5168\u95ee\u9898\u4e5f\u4e00\u6837\u662f\u975e\u5e38\u91cd\u8981\u7684\u8d21\u732e\uff01\u8bf7\u95ee\u540e\u7eed\u6709\u4ec0\u4e48\u76f8\u5e94\u7684\u8ba1\u5212\u5417\uff1f\\n\\n**\u9e4f\u8bda**\uff1a\u6211\u4eec\u56e2\u961f\u540e\u9762\u4e5f\u4f1a\u79ef\u6781\u53c2\u4e0e\u5230 Apache APISIX \u7684\u793e\u533a\u4e2d\u6765\uff0c\u5e2e\u52a9\u793e\u533a\u9884\u9632\u548c\u5c3d\u65e9\u53d1\u73b0\u5b89\u5168\u9690\u60a3\uff0c\u8ba9\u5927\u5bb6\u7528\u4e0a\u5b89\u5168\u53ef\u9760\u7684 API \u7f51\u5173\u3002\\n\\n## Apache APISIX \u7684\u7b2c\u4e00\u4e2a CVE\\n\\nApache APISIX \u7684\u7b2c\u4e00\u4e2a CVE\uff1aApache APISIX Admin API \u9ed8\u8ba4 Token \u6f0f\u6d1e\uff08CVE-2020-13945\uff09\u3002[\u5b89\u5168\u6f0f\u6d1e\u8be6\u60c5](https://nvd.nist.gov/vuln/detail/CVE-2020-13945)\\n\\n![2021-01-11-1](https://static.apiseven.com/202108/1639461621848-2d567a42-7cab-44ab-8afc-a9c80c8a3ab8.png)"},{"id":"\u521d\u63a2 Kubernetes Service APIs","metadata":{"permalink":"/zh/blog/2020/12/18/first-look-at-kubernetes-service-api","source":"@site/blog/2020/12/18/first-look-at-kubernetes-service-api.md","title":"\u521d\u63a2 Kubernetes Service APIs","description":"\u672c\u6587\u4ecb\u7ecd\u4e86 Kubernetes Service APIs \u7684\u57fa\u672c\u6982\u5ff5\u3001\u4e3b\u8981\u7279\u70b9\u3001\u4ee5\u53ca\u5982\u4f55\u7ba1\u7406\u8d44\u6e90\u8bfb\u5199\u6743\u9650\u548c\u4e3b\u8981\u7684\u6269\u5c55\u70b9\uff0c\u4ee5\u53ca\u63a8\u884c\u4f1a\u5e26\u6765\u7684\u6539\u53d8\u3002","date":"2020-12-18T00:00:00.000Z","formattedDate":"2020\u5e7412\u670818\u65e5","tags":[{"label":"Ecosystem","permalink":"/zh/blog/tags/ecosystem"}],"readingTime":8.78,"truncated":true,"authors":[{"name":"\u91d1\u536b","url":"https://github.com/gxthrj","imageURL":"https://avatars2.githubusercontent.com/u/4413028?s=400&u=e140a6d2bf19c426da6498b8888edc96509be649&v=4"}],"prevItem":{"title":"Apache APISIX \u8d21\u732e\u8005\u4e13\u8bbf | \u666e\u534e\u6c38\u9053\u9ad8\u7ea7\u5b89\u5168\u987e\u95ee\u738b\u9e4f\u8bda","permalink":"/zh/blog/2021/01/11/interview-apache-apisix-contributor-wang-pengcheng-senior-security-advisor-of-pwc-south-china-data-security-and-privacy-protection-team"},"nextItem":{"title":"\u8d1d\u58f3\u627e\u623f\u5982\u4f55\u57fa\u4e8e APISIX \u642d\u5efa\u7f51\u5173","permalink":"/zh/blog/2020/12/11/beike-how-to-build-gateway-based-on-apache-apisix"}},"content":"> \u672c\u6587\u901a\u8fc7\u63d0\u95ee\u7684\u65b9\u5f0f\uff0c\u5bf9 Kubernetes Service APIs \u505a\u4e86\u4e00\u4e9b\u57fa\u672c\u4ecb\u7ecd\uff0c\u4ece\u6574\u4f53\u6765\u770b\uff0cKubernetes Service APIs \u63d0\u70bc\u4e86\u5f88\u591a ingress \u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u6bd4\u5982\u8868\u8fbe\u80fd\u529b\u7684\u589e\u5f3a\uff0c\u5176\u5b9e\u5c31\u662f\u6269\u5c55\u4e86 Route \u7684\u80fd\u529b\uff0c\u518d\u6bd4\u5982 BackendPolicy \u5bf9\u8c61\uff0c\u53ef\u4ee5\u4e3a upstream \u6307\u5b9a\u51e0\u4e4e\u6240\u6709\u7684 Kubernetes \u540e\u7aef\u8d44\u6e90\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n> Source:\\n>\\n> - https://github.com/apache/apisix\\n> - https://github.com/apache/apisix-ingress-controller\\n\\n## \u524d\u8a00\\n\\n\u7b14\u8005\u662f Apache APISIX PMC\uff0c\u4e5f\u662f Apache APISIX Ingress Controller Founder\uff0c\u901a\u8fc7\u8c03\u7814\u548c\u793e\u533a\u4ea4\u6d41\uff0c\u6253\u7b97\u5728 Apache APISIX Ingress Controller \u7684\u540e\u671f\u7248\u672c\u4e2d\u9010\u6b65\u652f\u6301 Kubernetes Service APIs.\\n\\n\u6211\u4eec\u77e5\u9053 Kubernetes \u4e3a\u4e86\u5c06\u96c6\u7fa4\u5185\u90e8\u670d\u52a1\u66b4\u9732\u51fa\u53bb\uff0c\u6709\u591a\u79cd\u65b9\u6848\u5b9e\u73b0\uff0c\u5176\u4e2d\u4e00\u4e2a\u6bd4\u8f83\u53d7\u5927\u4f17\u63a8\u5d07\u7684\u5c31\u662f Ingress\u3002Ingress \u4f5c\u4e3a\u4e00\u79cd\u5bf9\u5916\u66b4\u9732\u670d\u52a1\u7684\u6807\u51c6\uff0c\u6709\u76f8\u5f53\u591a\u7684\u7b2c\u4e09\u65b9\u5b9e\u73b0\uff0c\u6bcf\u79cd\u5b9e\u73b0\u90fd\u6709\u5404\u81ea\u7684\u6280\u672f\u6808 \u548c \u6240\u4f9d\u8d56\u7684\u7f51\u5173\u7684\u5f71\u5b50\uff0c\u76f8\u4e92\u4e4b\u95f4\u5e76\u4e0d\u517c\u5bb9\u3002\\n\\n\u4e3a\u4e86\u7edf\u4e00\u5404\u79cd Ingress \u7684\u5b9e\u73b0\uff0c\u4fbf\u4e8e Kubernetes \u4e0a\u7edf\u4e00\u7ba1\u7406\uff0c[SIG-NETWORK](https://github.com/kubernetes/community/tree/master/sig-network) \u793e\u533a\u63a8\u51fa\u4e86[Kubernetes Service APIs](https://gateway-api.sigs.k8s.io/) \u4e00\u5957\u6807\u51c6\u5b9e\u73b0\uff0c\u79f0\u4e3a\u7b2c\u4e8c\u4ee3 Ingress \u3002\\n\\n## \u4e3b\u9898\u63cf\u8ff0\\n\\n\u672c\u6587\u4ece\u51e0\u4e2a\u95ee\u9898\u5165\u624b\uff0c\u5bf9 Kubernetes Service APIs \u7684\u57fa\u672c\u6982\u5ff5\u8fdb\u884c\u4ecb\u7ecd\u3002\\n\\n## \u4ecb\u7ecd\\n\\n### Kubernetes Service APIs \u53f7\u79f0\u7b2c\u4e8c\u4ee3 Ingress \u6280\u672f\uff0c\u5230\u5e95\u5728\u54ea\u4e9b\u65b9\u9762\u4f18\u4e8e\u7b2c\u4e00\u4ee3\\n\\nKubernetes Service APIs \u8bbe\u8ba1\u4e4b\u521d\uff0c\u76ee\u6807\u5e76\u6ca1\u6709\u5c40\u9650\u5728 Ingress\uff0c \u800c\u662f\u4e3a\u4e86\u589e\u5f3a service networking\uff0c\u7740\u91cd\u901a\u8fc7\u4ee5\u4e0b\u51e0\u70b9\u6765\u589e\u5f3a\uff1a\u8868\u8fbe\u6027\u3001\u6269\u5c55\u6027\u3001RBAC\u3002\\n\\n1. \u66f4\u5f3a\u7684\u8868\u8fbe\u80fd\u529b\uff0c\u4f8b\u5982 \u53ef\u4ee5\u6839\u636e header \u3001weighting \u6765\u7ba1\u7406\u6d41\u91cf\\n\\n```text\\nkind: HTTPRoute\\napiVersion: networking.x-k8s.io/v1alpha1\\n...\\nmatches:\\n  - path:\\n      value: \\"/foo\\"\\n    headers:\\n      values:\\n        version: \\"2\\"\\n  - path:\\n      value: \\"/v2/foo\\"\\n```\\n\\n2. \u589e\u5f3a\u4e86\u6269\u5c55\u80fd\u529b\uff0cService APIs \u63d0\u51fa\u591a\u5c42 API \u7684\u6982\u5ff5\uff0c\u5404\u5c42\u72ec\u7acb\u66b4\u9732\u63a5\u53e3\uff0c\u65b9\u4fbf\u5176\u4ed6\u81ea\u5b9a\u4e49\u8d44\u6e90\u4e0e API \u5bf9\u63a5\uff0c\u505a\u5230\u66f4\u7ec6\u7c92\u5ea6\uff08API \u7c92\u5ea6\uff09\u7684\u63a7\u5236\u3002\\n\\n![api-model](https://gateway-api.sigs.k8s.io/images/api-model.png)\\n\\n3. \u9762\u5411\u89d2\u8272 RBAC\uff1a\u591a\u5c42 API \u7684\u5b9e\u73b0\uff0c\u5176\u4e2d\u4e00\u4e2a\u601d\u60f3\u5c31\u662f\u4ece\u4f7f\u7528\u8005\u7684\u89d2\u5ea6\u53bb\u8bbe\u8ba1\u8d44\u6e90\u5bf9\u8c61\u3002\u8fd9\u4e9b\u8d44\u6e90\u6700\u7ec8\u4f1a\u4e0e Kubernetes \u4e0a\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u7684\u5e38\u89c1\u89d2\u8272\u8fdb\u884c\u6620\u5c04\u3002\\n\\n## Kubernetes Service APIs \u62bd\u8c61\u51fa\u4e86\u54ea\u4e9b\u8d44\u6e90\u5bf9\u8c61\\n\\nKubernetes Service APIs \u57fa\u4e8e\u4f7f\u7528\u8005\u89d2\u8272\uff0c\u5c06\u5b9a\u4e49\u4e86\u4ee5\u4e0b\u51e0\u79cd\u8d44\u6e90\uff1a\\n\\nGatewayClass, Gateway, Route\\n\\n1. GatewayClass \u5b9a\u4e49\u4e86\u4e00\u7ec4\u5177\u6709\u901a\u7528\u914d\u7f6e\u548c\u884c\u4e3a\u7684\u7f51\u5173\u7c7b\u578b\\n\\n- \u4e0e Gateway \u7684\u5173\u7cfb\uff0c\u7c7b\u4f3c ingress \u4e2d\u7684 ingress.class annotation\uff1b\\n\\n- GatewayClass \u5b9a\u4e49\u4e86\u4e00\u7ec4\u5171\u4eab\u76f8\u540c\u914d\u7f6e\u548c\u884c\u4e3a\u7684\u7f51\u5173\u3002\u6bcf\u4e2a GatewayClass \u5c06\u7531\u5355\u4e2a controller \u5904\u7406\uff0ccontroller \u4e0e GatewayClass \u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\uff1b\\n\\n- GatewayClass \u662f cluster \u8d44\u6e90\u3002\u5fc5\u987b\u81f3\u5c11\u5b9a\u4e49\u4e00\u4e2a GatewayClass \u624d\u80fd\u5177\u6709\u529f\u80fd\u7f51\u5173\u3002\\n\\n2. Gateway \u8bf7\u6c42\u4e00\u4e2a\u53ef\u4ee5\u5c06\u6d41\u91cf\u8f6c\u6362\u4e3a\u7fa4\u96c6\u5185\u670d\u52a1\u7684\u70b9\u3002\\n\\n- \u4f5c\u7528\uff1a\u628a\u96c6\u7fa4\u5916\u7684\u6d41\u91cf\u5f15\u5165\u96c6\u7fa4\u5185\u90e8\u3002\u8fd9\u4e2a\u624d\u662f\u771f\u6b63\u7684 ingress \u5b9e\u4f53\uff1b\\n\\n- \u5b83\u5b9a\u4e49\u4e86\u5bf9\u7279\u5b9a LB \u914d\u7f6e\u7684\u8bf7\u6c42\uff0c\u8be5\u914d\u7f6e\u4e5f\u662f GatewayClass \u7684\u914d\u7f6e\u548c\u884c\u4e3a\u7684\u5b9e\u73b0\uff1b\\n\\n- Gateway \u8d44\u6e90\u53ef\u4ee5\u7531\u64cd\u4f5c\u5458\u76f4\u63a5\u521b\u5efa\uff0c\u4e5f\u53ef\u4ee5\u7531\u5904\u7406 GatewayClass \u7684 controller \u521b\u5efa\uff1b\\n\\n- Gateway \u4e0e Route \u662f\u591a\u5bf9\u591a\u7684\u5173\u7cfb\uff1b\\n\\n3. Route \u63cf\u8ff0\u4e86\u901a\u8fc7\u7f51\u5173\u7684\u6d41\u91cf\u5982\u4f55\u6620\u5c04\u5230\u670d\u52a1\u3002\\n\\n![schema-uml](https://gateway-api.sigs.k8s.io/images/schema-uml.svg)\\n\\n\u53e6\u5916\uff0cKubernetes Service APIs \u4e3a\u4e86\u80fd\u591f\u7075\u6d3b\u7684\u914d\u7f6e\u540e\u7aef\u670d\u52a1\uff0c\u7279\u5730\u5b9a\u4e49\u4e86\u4e00\u4e2a BackendPolicy \u8d44\u6e90\u5bf9\u8c61\u3002\\n\\n\u901a\u8fc7 BackendPolicy \u5bf9\u8c61\uff0c\u53ef\u4ee5\u914d\u7f6e TLS\u3001\u5065\u5eb7\u68c0\u67e5 \u4ee5\u53ca\u6307\u5b9a\u540e\u7aef\u670d\u52a1\u7c7b\u578b\uff0c\u6bd4\u5982 service \u8fd8\u662f pod\u3002\\n\\n## Kubernetes Service APIs \u7684\u63a8\u884c\u4f1a\u5e26\u6765\u54ea\u4e9b\u6539\u53d8\\n\\nKubernetes Service APIs \u4f5c\u4e3a\u4e00\u79cd\u5b9e\u73b0\u6807\u51c6\uff0c\u5e26\u6765\u4e86\u4ee5\u4e0b\u6539\u53d8\uff1a\\n\\n1. \u901a\u7528\u6027\uff1a \u53ef\u4ee5\u6709\u591a\u79cd\u5b9e\u73b0\uff0c\u5c31\u50cf ingress \u6709\u591a\u79cd\u5b9e\u73b0\u4e00\u6837\uff0c\u53ef\u4ee5\u6839\u636e\u7f51\u5173\u7684\u7279\u70b9\u53bb\u81ea\u5b9a\u4e49 ingress controller\uff0c\u4f46\u662f\u4ed6\u4eec\u90fd\u6709\u4e00\u81f4\u7684\u914d\u7f6e\u7ed3\u6784\u3002\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u79cd ingress controller\u3002\\n\\n2. Class \u6982\u5ff5\uff1aGatewayClasses \u53ef\u4ee5\u914d\u7f6e\u4e0d\u540c\u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7684\u7c7b\u578b\u3002\u8fd9\u4e9b\u7c7b class \u4f7f\u7528\u6237\u53ef\u4ee5\u8f7b\u677e\u800c\u660e\u786e\u5730\u4e86\u89e3\u54ea\u4e9b\u529f\u80fd\u53ef\u4ee5\u7528\u4f5c\u8d44\u6e90\u6a21\u578b\u672c\u8eab\u3002\\n\\n3. \u5171\u4eab\u7f51\u5173\uff1a\u901a\u8fc7\u5141\u8bb8\u72ec\u7acb\u7684\u8def\u7531\u8d44\u6e90 HTTPRoute \u7ed1\u5b9a\u5230\u540c\u4e00\u4e2a GatewayClass\uff0c\u5b83\u4eec\u53ef\u4ee5\u5171\u4eab\u8d1f\u8f7d\u5e73\u8861\u5668\u548c VIP\u3002\u6309\u7167\u4f7f\u7528\u8005\u5206\u5c42\uff0c\u8fd9\u4f7f\u5f97\u56e2\u961f\u53ef\u4ee5\u5b89\u5168\u5730\u5171\u4eab\u57fa\u7840\u7ed3\u6784\uff0c\u800c\u65e0\u9700\u5173\u5fc3\u4e0b\u5c42 Gateway \u7684\u5177\u4f53\u5b9e\u73b0\u3002\\n\\n4. \u5e26\u7c7b\u578b\u7684\u540e\u7aef\u5f15\u7528: \u4f7f\u7528\u5e26\u7c7b\u578b\u7684\u540e\u7aef\u5f15\u7528\uff0c\u8def\u7531\u53ef\u4ee5\u5f15\u7528 Kubernetes Services\uff0c\u4e5f\u53ef\u4ee5\u5f15\u7528\u4efb\u4f55\u7c7b\u578b\u7684\u8bbe\u8ba1\u4e3a\u7f51\u5173\u540e\u7aef\u7684 Kubernetes \u8d44\u6e90\uff0c\u6bd4\u5982 pod\uff0c\u53c8\u6216\u8005\u662f statefulset \u6bd4\u5982 DB\uff0c \u751a\u81f3\u662f\u53ef\u8bbf\u95ee\u7684\u96c6\u7fa4\u5916\u90e8\u8d44\u6e90\u3002\\n\\n5. \u8de8\u547d\u540d\u7a7a\u95f4\u5f15\u7528\uff1a\u8de8\u4e0d\u540c\u547d\u540d\u7a7a\u95f4\u7684\u8def\u7531\u53ef\u4ee5\u7ed1\u5b9a\u5230 Gateway\u3002\u5141\u8bb8\u8de8\u547d\u540d\u7a7a\u95f4\u7684\u4e92\u76f8\u8bbf\u95ee\u3002\u540c\u65f6\u4e5f\u53ef\u4ee5\u9650\u5236\u67d0\u4e2a Gateway \u4e0b\u7684 Route \u53ef\u4ee5\u8bbf\u95ee\u7684\u547d\u540d\u7a7a\u95f4\u8303\u56f4\u3002\\n\\n## \u76ee\u524d\u6709\u54ea\u4e9b ingress \u5b9e\u73b0\u4e86 Kubernetes Service APIs\\n\\n\u76ee\u524d\u5df2\u77e5\u7684\u4ece\u4ee3\u7801\u5c42\u9762\u80fd\u770b\u5230\u5bf9 Kubernetes Service APIs \u8d44\u6e90\u5bf9\u8c61\u652f\u6301\u7684 Ingress \u6709 Contour, ingress-gce\u3002\\n\\n## Kubernetes Service APIs \u5982\u4f55\u7ba1\u7406\u8d44\u6e90\u8bfb\u5199\u6743\u9650\\n\\nKubernetes Service APIs \u6309\u7167\u4f7f\u7528\u8005\u7684\u7ef4\u5ea6\u5206\u4e3a 3 \u4e2a\u89d2\u8272\\n\\n1. \u57fa\u7840\u8bbe\u65bd\u63d0\u4f9b\u65b9 GatewayClass\\n\\n2. \u96c6\u7fa4\u64cd\u4f5c\u4eba\u5458 Gateway\\n\\n3. \u5e94\u7528\u5f00\u53d1\u8005 Route\\n\\nRBAC\uff08\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff09\u662f\u7528\u4e8e Kubernetes \u6388\u6743\u7684\u6807\u51c6\u3002\u5141\u8bb8\u7528\u6237\u914d\u7f6e\u8c01\u53ef\u4ee5\u5bf9\u7279\u5b9a\u8303\u56f4\u5185\u7684\u8d44\u6e90\u6267\u884c\u64cd\u4f5c\u3002 RBAC \u53ef\u7528\u4e8e\u542f\u7528\u4e0a\u9762\u5b9a\u4e49\u7684\u6bcf\u4e2a\u89d2\u8272\u3002\\n\\n\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5e0c\u671b\u6240\u6709\u89d2\u8272\u90fd\u53ef\u4ee5\u8bfb\u53d6\u6240\u6709\u8d44\u6e90\\n\\n\u4e09\u5c42\u6a21\u578b\u7684\u5199\u6743\u9650\u5982\u4e0b\u3002\\n\\n|                         | GatewayClass | Gateway | Route |\\n| ----------------------- | ------------ | ------- | ----- |\\n| Infrastructure Provider | Yes          | Yes     | Yes   |\\n| Cluster Operators       | No           | Yes     | Yes   |\\n| Application Developers  | No           | No      | Yes   |\\n\\n## Kubernetes Service APIs \u6709\u54ea\u4e9b\u6269\u5c55\u70b9\\n\\n\u7f51\u5173\u7684\u9700\u6c42\u975e\u5e38\u4e30\u5bcc\uff0c\u540c\u4e00\u4e2a\u573a\u666f\u5b9e\u73b0\u7684\u65b9\u5f0f\u591a\u79cd\u591a\u6837\uff0c\u5404\u6709\u5229\u5f0a\u3002Kubernetes Service APIs \u63d0\u70bc\u51fa \u591a\u5c42 \u8d44\u6e90\u5bf9\u8c61\uff0c\u540c\u65f6\u4e5f\u9884\u7559\u4e86\u4e00\u4e9b\u6269\u5c55\u70b9\u3002\\n\\n\u76ee\u524d Kubernetes Service APIs \u7684\u6269\u5c55\u70b9\u57fa\u672c\u96c6\u4e2d\u5728 Route \u4e0a\uff1a\\n\\n- RouteMatch \u53ef\u4ee5\u6269\u5c55 Route \u5339\u914d\u89c4\u5219\u3002\\n\\n- specify Backend \u53ef\u4ee5\u6269\u5c55\u7279\u5b9a\u7c7b\u578b\u7684 \u540e\u7aef\u670d\u52a1\uff0c \u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684 Kubernetes \u8d44\u6e90\u5916\uff0c\u8fd8\u53ef\u4ee5\u6269\u5c55\u6bd4\u5982 \u6587\u4ef6\u7cfb\u7edf\uff0c\u51fd\u6570\u8868\u8fbe\u5f0f\u7b49\u3002\\n\\n- Route filter \u53ef\u4ee5\u5728 Route \u7684\u751f\u547d\u5468\u671f\u4e2d\u589e\u52a0\u6269\u5c55\u70b9\uff0c\u5904\u7406 request/response \u3002\\n\\n- Custom Route \u4ee5\u4e0a\u6269\u5c55\u70b9\u90fd\u4e0d\u80fd\u6ee1\u8db3\u65f6\uff0c\u53ef\u4ee5\u5b8c\u5168\u81ea\u5b9a\u4e49\u4e00\u4e2a Route\u3002\\n\\n## \u603b\u7ed3\\n\\n\u672c\u6587\u901a\u8fc7\u63d0\u95ee\u7684\u65b9\u5f0f\uff0c\u5bf9 Kubernetes Service APIs \u505a\u4e86\u4e00\u4e9b\u57fa\u672c\u4ecb\u7ecd\uff0c\u4ece\u6574\u4f53\u6765\u770b\uff0cKubernetes Service APIs \u63d0\u70bc\u4e86\u5f88\u591a ingress \u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u6bd4\u5982\u8868\u8fbe\u80fd\u529b\u7684\u589e\u5f3a\uff0c\u5176\u5b9e\u5c31\u662f\u6269\u5c55\u4e86 Route \u7684\u80fd\u529b\uff0c\u518d\u6bd4\u5982 BackendPolicy \u5bf9\u8c61\uff0c\u53ef\u4ee5\u4e3a upstream \u6307\u5b9a\u51e0\u4e4e\u6240\u6709\u7684 Kubernetes \u540e\u7aef\u8d44\u6e90\u3002\u5f53\u7136\uff0c\u9879\u76ee\u521d\u671f\u4e5f\u6709\u4e0d\u8db3\u7684\u5730\u65b9\uff0c\u76ee\u524d Kubernetes Service APIs \u867d\u7136\u5df2\u7ecf\u4ece\u5927\u7684\u5c42\u9762\u4e0a\u89c4\u5b9a\u4e86\u8d44\u6e90\u5bf9\u8c61\uff0c\u4f46\u8d44\u6e90\u5bf9\u8c61\u5185\u90e8\u8fd8\u6709\u4e0d\u5c11\u7ec6\u8282\u9700\u8981\u8ba8\u8bba\u4e4b\u540e\u518d\u786e\u5b9a\uff0c\u4ee5\u9632\u6b62\u53ef\u80fd\u51fa\u73b0\u7684\u51b2\u7a81\u573a\u666f\uff0c\u7ed3\u6784\u4e0a\u5b58\u5728\u4e00\u5b9a\u53d8\u6570\u3002\\n\\n---\\n\\n\u53c2\u8003:\\n\\n- https://gateway-api.sigs.k8s.io/\\n- https://www.apiseven.com/zh/blog/a-first-look-at-kubernetes-service-api"},{"id":"\u8d1d\u58f3\u627e\u623f\u5982\u4f55\u57fa\u4e8e APISIX \u642d\u5efa\u7f51\u5173","metadata":{"permalink":"/zh/blog/2020/12/11/beike-how-to-build-gateway-based-on-apache-apisix","source":"@site/blog/2020/12/11/beike-how-to-build-gateway-based-on-apache-apisix.md","title":"\u8d1d\u58f3\u627e\u623f\u5982\u4f55\u57fa\u4e8e APISIX \u642d\u5efa\u7f51\u5173","description":"\u8d1d\u58f3\u627e\u623f\u9009\u62e9\u4f7f\u7528\u4e91\u539f\u751f API \u7f51\u5173 Apache APISIX \u4f5c\u4e3a API \u7f51\u5173\uff0c\u6bcf\u5929\u5904\u7406\u4e0a\u4ebf\u6d41\u91cf\uff0c\u6027\u80fd\u4f18\u5f02\u800c\u4e14\u975e\u5e38\u7a33\u5b9a\uff0c\u5e76\u4e14\u76f8\u6bd4\u4e8e Kong\uff0cApache APISIX \u66f4\u5bb9\u6613\u5165\u95e8\u3002","date":"2020-12-11T00:00:00.000Z","formattedDate":"2020\u5e7412\u670811\u65e5","tags":[{"label":"Case Studies","permalink":"/zh/blog/tags/case-studies"}],"readingTime":11.985,"truncated":true,"authors":[{"name":"\u738b\u8f89"}],"prevItem":{"title":"\u521d\u63a2 Kubernetes Service APIs","permalink":"/zh/blog/2020/12/18/first-look-at-kubernetes-service-api"}},"content":"> \u672c\u6587\u8bb2\u8ff0\u4e86\u8d1d\u58f3\u627e\u623f\u5f53\u521d\u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX \u4f5c\u4e3a API \u7f51\u5173\uff0c\u4ee5\u53ca\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u5fc3\u5f97\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n\u6211\u662f\u738b\u8f89\uff0c\u5728\u8d1d\u58f3\u627e\u623f\u8d1f\u8d23 API \u7f51\u5173\u7cfb\u7edf\u7684\u5f00\u53d1\uff0c\u8d1d\u58f3\u627e\u623f\u4f7f\u7528 Apache APISIX \u4f5c\u4e3a\u751f\u4ea7\u7cfb\u7edf\u7684 API \u7f51\u5173\uff0c\u6bcf\u5929\u5904\u7406\u8fc7\u4ebf\u7684\u751f\u4ea7\u6d41\u91cf\uff0c\u6027\u80fd\u4f18\u5f02\uff0c\u800c\u4e14\u5f88\u7a33\u5b9a\u3002\u6b63\u597d Apache APISIX \u521a\u521a\u52a0\u5165 Apache \u5b75\u5316\u5668\uff0c\u9664\u4e86\u606d\u559c\u4e4b\u5916\uff0c\u6211\u60f3\u6765\u5206\u4eab\u4e0b\u8d1d\u58f3\u627e\u623f\u5f53\u521d\u4e3a\u4ec0\u4e48\u9009\u62e9 Apache APISIX\uff0c\u4ee5\u53ca\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u5fc3\u5f97\u3002\\n\\n## \u9009\u62e9 Kong \u8fd8\u662f Apache APISIX\\n\\n![Apache APISIX vs Kong in QPS](https://static.apiseven.com/2020/1211/20220816-202641.jpg)\\n\\n\u5bf9\u4e8e\u7f51\u5173\u7684\u6280\u672f\u8981\u6c42\uff0c\u4e00\u662f\u8981\u6027\u80fd\u597d\uff0c\u80fd\u591f\u652f\u6491\u5927\u6d41\u91cf\u7684\u63a5\u5165\uff0c\u4e8c\u662f\u8981\u7a33\u5b9a\uff0c\u4e0d\u80fd\u51fa\u95ee\u9898\u3002\\n\\n\u9009\u578b\u7684\u539f\u5219\u5c31\u662f\u57fa\u4e8e\u6216\u8005\u501f\u9274\u5f00\u6e90\u9879\u76ee\u91cd\u6784\u4e00\u4e2a\u66f4\u52a0\u7a33\u5b9a\u7684\u7248\u672c\uff0c\u80fd\u591f\u4fdd\u8bc1\u63a5\u5165\u66f4\u5927\u7684\u6d41\u91cf\uff0c\u521a\u5f00\u59cb\u7684\u6d41\u91cf\u8fd8\u5c11\uff0c\u505a\u8fd9\u6837\u7684\u5927\u52a8\u4f5c\u662f\u5b8c\u5168\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\u8bc4\u4f30\u5b8c\u5229\u5f0a\u540e\u548c\u9886\u5bfc\u6c9f\u901a\u4e86\u4e00\u4e0b\u60f3\u6cd5\uff0c\u5f97\u5230\u9886\u5bfc\u7684\u80af\u5b9a\u540e\u5c31\u51b3\u5b9a\u641e\u8d77\uff0c\u8fd9\u65f6\u8111\u6d77\u60f3\u7684\u7b2c\u4e00\u4e2a\u5c31\u662f Kong \u4e86\uff0c\u5927\u540d\u9f0e\u9f0e\u7684\u5f00\u6e90\u7f51\u5173\u3002\u4e8e\u662f\u5c31\u53bb\u5b98\u7f51\u6d4f\u89c8\u4e86\u4e00\u756a\uff0c\u5468\u8fb9\u6587\u7ae0\u4e5f\u770b\u4e86\u4e9b\uff0c\u7b2c\u4e00\u5370\u8c61\u5c31\u662f\u8fd9\u4e2a\u9879\u76ee\u5f88\u4e0d\u9519\uff0c\u80fd\u591f\u6ee1\u8db3\u7528\u6237\u7684\u5927\u591a\u6570\u9700\u6c42\uff0c\u6027\u80fd\u8fd8\u7a33\u5b9a\uff0c\u5c31\u662f\u5b83\u4e86\u3002\u5174\u9ad8\u91c7\u70c8\u5730 clone \u4e86\u4ee3\u7801\u5f00\u59cb\u9605\u8bfb\u8d77\u6765\uff0c\u4e00\u5929\u4e24\u5929\u82e5\u5e72\u5929\u8fc7\u53bb\u4e86\uff0c\u8fd8\u662f\u4e00\u5934\u96fe\u6c34\u7684\u6837\u5b50\uff0c\u60f3\u60f3\u4e5f\u662f\uff0cKong \u80fd\u63d0\u4f9b\u8fd9\u4e48\u591a\u7684\u529f\u80fd\uff0c\u5176\u4ee3\u7801\u7684\u590d\u6742\u5ea6\u53ef\u60f3\u800c\u77e5\u3002\\n\\n\u8fd9\u65f6\u51e0\u4e2a\u95ee\u9898\u51fa\u73b0\u5728\u6211\u7684\u8111\u6d77\u91cc\uff0c\u6211\u4e00\u4e2a\u4eba\u591a\u4e45\u80fd\u5543\u4e0b\u6765 Kong \u5462\uff1f\u7136\u540e\u8fd8\u8981\u6784\u5efa\u4e00\u4e2a\u9002\u5408\u81ea\u5df1\u7684\u9879\u76ee\uff0c\u53c8\u9700\u8981\u591a\u4e45\u5462\uff1f\u8fd8\u6709\u5c31\u662f\u8fd9\u4e48\u591a\u7684\u529f\u80fd\u6211\u90fd\u9700\u8981\u4e48\uff1f\\n\\n\u521a\u597d\u90a3\u51e0\u5929 API \u7f51\u5173 Apache APISIX 0.5 \u7248\u672c\u53d1\u5e03\u4e86\uff0c\u62b1\u7740\u4e86\u89e3\u7684\u5fc3\u6001\u53bb\u770b\u4e86\u4e00\u773c\uff0c\u53d1\u73b0\u662f\u9662\u751f\u548c\u6e29\u94ed\u4e00\u8d77\u641e\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u6709\u4e24\u4f4d\u6280\u672f\u5927\u4f6c\u7684\u80cc\u4e66\uff0c\u8ba9\u6211\u4e0d\u7981\u60f3\u8bd5\u8bd5\u770b\u3002\\n\\n\u62b1\u7740\u8bd5\u4e00\u8bd5\u7684\u6001\u5ea6\u5f00\u59cb\u8d70\u8fd1 Apache APISIX\uff0c\u7531\u4e8e\u5f00\u6e90\u65f6\u95f4\u8f83\u77ed\u6240\u4ee5\u652f\u6301\u7684\u529f\u80fd\u6709\u9650\uff0c\u4f46\u662f\u50cf\u52a8\u6001\u8d1f\u8f7d\u5747\u8861\u3001\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u3001\u9650\u901f\u7b49\u7b49\u8fd9\u4e9b\u57fa\u672c\u529f\u80fd\u90fd\u5df2\u5b9e\u73b0\u3002\u540c\u65f6\u4ee3\u7801\u91cf\u4e5f\u4e0d\u662f\u5f88\u5927\u964d\u4f4e\u4e86\u5b66\u4e60\u6210\u672c\uff0c\u5728\u8fd9\u4e00\u70b9\u4e0a PK \u6389\u4e86 Kong\u3002\u6240\u4ee5\u7efc\u5408\u6765\u770b Apache APISIX \u66f4\u9002\u5408\u6211\u5f53\u524d\u7684\u72b6\u51b5\uff0c\u6ee1\u8db3\u6211\u521d\u671f\u7684\u529f\u80fd\u89c4\u5212\uff0c\u4e5f\u4e0d\u7528\u8003\u8651\u4e0d\u9700\u8981\u7684\u529f\u80fd\u600e\u4e48\u5904\u7406\u95ee\u9898\u4e86\u3002\\n\\n\u6700\u5173\u952e\u7684\u95ee\u9898\uff0c\u5f00\u6e90\u65f6\u95f4\u8fd9\u4e48\u77ed\uff0c\u6027\u80fd\u600e\u4e48\u6837\uff1f\u770b\u4e86\u76f8\u540c\u73af\u5883\u7684\u538b\u6d4b\u6570\u636e\u5bf9\u6bd4\uff0cApache APISIX \u5b8c\u7206 Kong\uff0c\u867d\u7136\u8fd9\u6837\u4e0d\u592a\u516c\u5e73\uff0c\u6bd5\u7adf Kong \u662f\u4e2a\u5e9e\u7136\u5927\u7269\uff0c\u4f46\u5bf9\u4e8e\u6211\u7684\u751f\u4ea7\u73af\u5883\u6765\u8bf4\uff0c\u5b83\u4fe9\u662f\u4e00\u6837\u7684\u3002\u6839\u636e Apache APISIX \u7684\u6027\u80fd\u6d4b\u8bd5\u62a5\u544a\uff0c\u5355\u6838 CPU \u53ef\u4ee5\u8fbe\u5230 24k QPS\uff0c\u540c\u65f6\u5ef6\u65f6\u53ea\u6709 0.7 \u6beb\u79d2\u3002\\n\\n\u6700\u7ec8\u9009\u62e9\u4e86 Apache APISIX\uff0c\u6211\u7684\u7406\u7531\u5982\u4e0b\uff1a\\n\\n+ \u5728\u90fd\u80fd\u6ee1\u8db3\u9879\u76ee\u9700\u6c42\u7684\u524d\u63d0\u4e0b\uff0cApache APISIX \u5b66\u4e60\u6210\u672c\u4f4e\\n+ Kong \u7684\u4ee3\u7801\u91cf\u5e9e\u5927\uff0c\u540e\u671f\u7ef4\u62a4\u4e5f\u4f1a\u5e26\u6765\u96be\u5ea6\\n+ Apache APISIX \u4f5c\u8005\u7ecf\u5e38\u6d3b\u8dc3\u4e8e OpenResty \u793e\u533a\uff0c\u4ee3\u7801\u8d28\u91cf\u6709\u4fdd\u8bc1\\n+ \u6700\u91cd\u8981\u7684\u4e00\u70b9\u5c31\u662f\u63a5\u89e6\u8fc7\u4f5c\u8005\uff0c\u6709\u4ec0\u4e48\u95ee\u9898\u90fd\u53ef\u4ee5\u5feb\u901f\u7684\u6c9f\u901a\\n\\n\u5b98\u7f51\u7684\u7406\u7531\u5982\u4e0b\u56fe\u6240\u793a\uff1a\\n\\n![Apache APISIX \u6280\u672f\u4eae\u70b9](https://static.apiseven.com/2020/1211/20220816-202705.jpg)\\n\\n## Apache APISIX \u80fd\u63d0\u4f9b\u54ea\u4e9b\u80fd\u529b\\n\\n+ \u70ed\u66f4\u65b0\u548c\u70ed\u63d2\u4ef6\\n+ \u52a8\u6001\u8d1f\u8f7d\u5747\u8861\\n+ \u4e3b\u52a8\u548c\u88ab\u52a8\u5065\u5eb7\u68c0\u6d4b\\n+ \u7194\u65ad\u5668\\n+ \u8eab\u4efd\u8ba4\u8bc1\\n+ \u9650\u6d41\u9650\u901f\\n+ gRPC \u534f\u8bae\u8f6c\u6362\\n+ \u52a8\u6001 TCP/UDP\u3001gRPC\u3001websocket\u3001MQTT \u4ee3\u7406\\n+ \u63a7\u5236\u53f0\\n+ \u9ed1\u767d\u540d\u5355\\n+ Serverless\\n\\nApache APISIX \u5df2\u7ecf\u53d1\u5e03\u4e86\u63a5\u8fd1\u5341\u4e2a\u7248\u672c\u4e86\uff0c\u5b83\u6240\u652f\u6301\u7684\u529f\u80fd\u8fdc\u4e0d\u6b62\u8fd9\u4e9b\u4e86\u3002\u7ed3\u5408\u4e1a\u52a1\u60c5\u51b5\u7ed8\u5236\u4e86\u67b6\u6784\u56fe\uff0c\u5982\u4e0b\uff1a\\n\\n![Apache APISIX \u67b6\u6784\u56fe](https://static.apiseven.com/2020/1211/20220816-202709.jpg)\\n\\n## \u96c6\u6210 APISIX \u7684\u70b9\u70b9\u6ef4\u6ef4\\n\\n\u7ecf\u8fc7\u51e0\u5929\u7684\u4ee3\u7801\u9605\u8bfb\uff0c\u5bf9 Apache APISIX \u6709\u4e86\u4e00\u5b9a\u7684\u4e86\u89e3\u4e86\uff0c\u4f46\u7b2c\u4e00\u4e2a\u95ee\u9898\u51fa\u73b0\u4e86\uff1a\u4e4b\u524d\u6ca1\u6709\u57fa\u4e8e\u5f00\u6e90\u9879\u76ee\u5f00\u53d1\u7684\u7ecf\u9a8c\uff0c\u4e00\u65b9\u9762\u8981\u505a\u4e1a\u52a1\u9700\u6c42\u8fed\u4ee3\uff0c\u4e00\u65b9\u9762\u8fd8\u8981\u5347\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u600e\u4e48\u641e\u5462\uff1f\u6211\u5728\u672c\u5730\u521b\u5efa\u4e86\u4e09\u4e2a\u5206\u652f\uff0c\u4e00\u4e2a Apache APISIX \u5206\u652f\u6307\u5411\u4e0a\u6e38\u5f00\u6e90\u4ed3\u5e93\uff0cdev \u7528\u6765\u5e38\u89c4\u7684\u4e1a\u52a1\u8fed\u4ee3\uff0c\u800c master \u5206\u652f\u7528\u6765\u4e0a\u7ebf\u5347\u7ea7\u3002\\n\\n\u5728\u952e\u76d8\u4e0a\u6572\u6253\u4e86\u4e24\u5468\uff0c\u6211\u7684\u201c\u5c0f\u91d1\u521a\u201d\u7ec8\u4e8e\u6709\u4e9b\u6a21\u6837\u4e86\uff0c\u8be5\u770b\u770b\u5b83\u8dd1\u7684\u6709\u591a\u5feb\u3001\u7701\u4e0d\u7701\u6cb9\u4e86\uff0c\u5c31\u8fd9\u6837\u538b\u6d4b\u5f00\u59cb\u4e86\u3002\u670d\u52a1\u90e8\u7f72\u5728 8CPU 32G \u5185\u5b58\u7684\u817e\u8baf\u4e91\u4e0a\u9762\u4e86\uff0c\u4e0a\u6e38\u662f\u771f\u5b9e\u7684\u7ebf\u4e0a\u751f\u4ea7\u73af\u5883\uff0c\u56e0\u6b64\u4e0d\u80fd\u538b\u7684\u592a\u72e0\uff0c\u6027\u80fd\u62a5\u544a\u5982\u4e0b\uff1a\\n\\n![Apache APISIX \u6027\u80fd\u6d4b\u8bd5](https://static.apiseven.com/2020/1211/20220816-202712.jpg)\\n\\n\u6027\u80fd\u62a5\u544a\u5c0f\u7ed3\uff1a\u63a5\u53e3\u8017\u65f6\u51cf\u5c11\u4e86 47%\uff0c\u6ca1\u6709\u9519\u8bef\u4ea7\u751f\u7a33\u5b9a\u6027\u6709\u6240\u63d0\u5347\uff0cTPS \u5cf0\u503c\u63d0\u5347\u4e86 82%\uff0c\u6ca1\u6709\u9519\u8bef\u4ea7\u751f\uff0c\u7a33\u5b9a\u6027\u6709\u6240\u63d0\u5347\u3002\\n\\n\u5f00\u53d1\u73af\u5883\u6ca1\u95ee\u9898\u4e86\uff0c\u5f00\u59cb\u7814\u7a76\u7ebf\u4e0a\u90e8\u7f72\u3002Apache APISIX \u652f\u6301\u5404\u79cd\u5b89\u88c5\u7684\u65b9\u5f0f\uff1adocker\u3001rpm \u5305\u3001Luarocks \u548c\u6e90\u7801\u3002\u4f46\u662f\u7ebf\u4e0a\u73af\u5883\u4e0d\u8ba9\u5b89\u88c5\u4efb\u4f55\u4e1c\u897f\uff0c\u4ee3\u7801\u53ea\u80fd\u653e\u5230\u56fa\u5b9a\u7684\u8def\u5f84\u4e2d\uff0cApache APISIX \u652f\u6301\u7684\u5f88\u591a\u7279\u6027\u90fd\u662f\u57fa\u4e8e OpenResty 1.15.8 \u7684\uff0c\u548b\u641e\u5462\uff1f\u7f16\u8bd1\u5b8c\u4e86\u653e\u5728\u4ee3\u7801\u4ed3\u5e93\u4e2d\u5427\uff0c\u6309\u7167\u6307\u5b9a\u7684\u76ee\u5f55\u8fdb\u884c\u7f16\u8bd1\uff0c\u800c\u4e14\u4e0d\u80fd\u7528 pcre \u7684\u9759\u6001\u8054\u7f16\uff0c\u6298\u817e\u4e86\u4e00\u4e24\u5929\u624d\u641e\u5b9a\u3002\u8c03\u6574\u8d1f\u8f7d\u5f00\u59cb\u7070\u5ea6\uff0c\u4ece 2% \u7684\u6d41\u91cf\u5230\u5168\u91cf\u7ecf\u5386\u4e86\u51e0\u5468\uff0c\u597d\u5728\u4e00\u5207\u987a\u5229\u3002\\n\\n\u7ecf\u8fc7\u51e0\u5468\u7684\u89c2\u5bdf\u7ebf\u4e0a\u670d\u52a1\u5f88\u7a33\u5b9a\uff0cApache APISIX 0.5 \u7248\u672c\u7684\u5f88\u591a\u529f\u80fd\u90fd\u662f\u5f97\u7528\u901a\u8fc7 API \u63a5\u53e3\u8c03\u7528\u5b9e\u73b0\u7684\uff0c\u8bf7\u6c42\u53c2\u6570\u6bd4\u8f83\u5bb9\u6613\u51fa\u73b0\u8bed\u6cd5\u9519\u8bef\uff0c\u6ca1\u6709\u9875\u9762\u6765\u7684\u76f4\u89c2\u65b9\u4fbf\uff0c\u8fd8\u6709\u4e00\u70b9\u5c31\u662f\u6211\u7684\u4e1a\u52a1\u573a\u666f\u9700\u8981\u6709\u5bf9\u4e0a\u6e38\u670d\u52a1\u7684\u63a2\u6d3b\u529f\u80fd\u3002\u5c31\u662f\u8fd9\u4e48\u5de7 Apache APISIX 0.7 \u7248\u672c\u53d1\u5e03\u4e86\uff0c0.7 \u7248\u672c\u652f\u6301\u4e86\u63a7\u5236\u53f0\u548c\u4e0a\u6e38\u670d\u52a1\u63a2\u6d3b\uff0c\u771f\u662f\u4e2a\u559c\u5927\u666e\u5954\u7684\u597d\u6d88\u606f\u554a\uff0c\u5347\u7ea7\u3002\\n\\nApache APISIX \u5206\u652f\u5347\u7ea7\u5230 0.7 \u5f88\u65b9\u4fbf\uff0c\u6211\u548b\u5408\u5e76\u4ee3\u7801\u5462\uff1f\u4e24\u4e2a\u7248\u672c\u4ee3\u7801\u6539\u52a8\u975e\u5e38\u5927\uff0c\u5148\u5c1d\u8bd5\u4e00\u4e0b\u5408\u5e76\uff0c\u6211\u7684\u5929\u554a\uff0c\u8fd9\u51b2\u7a81\u592a\u591a\u4e86\uff0c\u641e\u6b7b\u7684\u8282\u594f\u554a\uff0c\u666e\u901a\u7684\u89e3\u51b3\u51b2\u7a81\u7684\u65b9\u6cd5\u4e0d\u73b0\u5b9e\u4e86\uff0c\u8fd9\u4e48\u591a\u5904\u624b\u4e00\u6296\u8fd8\u4f1a\u51fa\u73b0\u4e00\u4e0b\u9690\u85cf\u7684 bug\uff0c\u6709\u6ca1\u6709\u5565\u9ad8\u6548\u7684\u65b9\u6cd5\u5462\uff1f\u641c\u7d22\u4e86\u4e00\u4e0b\u627e\u5230\u4e86\u5feb\u6377\u65b9\u6cd5 git checkout --ours \u548c git checkout --theirs\uff08\u6ca1\u7528\u8fc7\u7684\u81ea\u884c\u641c\u7d22\u54c8\uff09\uff0c\u51e0\u5206\u949f\u5b8c\u6210 APISIX  0.5 \u5230 0.7 \u7684\u5347\u7ea7\uff0c\u5f88\u75db\u5feb\u3002\u5f53\u7136\u8fd9\u4e5f\u662f\u5f97\u76ca\u4e8e APISIX \u4ee3\u7801\u7684\u5065\u58ee\uff0c\u6211\u53ea\u9700\u8981\u6dfb\u52a0\u4e1a\u52a1\u63d2\u4ef6\u5373\u53ef\uff0c\u5b8c\u5168\u96f6\u8026\u5408\u3002\\n\\nApache APISIX 0.7 \u7248\u672c\u63d0\u4f9b\u4e86\u63a7\u5236\u53f0\u4e86\uff0c\u4e0d\u7528\u518d\u62fc json \u4e86\uff0c\u8212\u670d\u3002\u8d76\u7d27\u6d4b\u8bd5\u4e00\u4e0b\u81ea\u5df1\u5173\u5fc3\u7684\u5065\u5eb7\u68c0\u6d4b\u5427\uff0c\u4e00\u5f00\u59cb\u6ca1\u4ec0\u4e48\u95ee\u9898\uff0c\u80fd\u591f\u6e05\u6670\u7684\u611f\u77e5\u4e0a\u6e38\u670d\u52a1\u7684\u72b6\u6001\uff0c\u4f46\u6211\u89c2\u5bdf\u4e0a\u6e38\u670d\u52a1\u7684\u65e5\u5fd7\u53d1\u73b0\uff0c\u7ecf\u8fc7\u51e0\u6b21\u542f\u505c\uff0c\u5065\u5eb7\u68c0\u6d4b\u529f\u80fd\u63a2\u6d3b\u7684\u9891\u7387\u597d\u50cf\u53d8\u5feb\u4e86\uff0c\u5e94\u8be5\u662f\u5065\u5eb7\u68c0\u6d4b\u6709 bug\uff0c\u7b80\u5355\u7684\u9605\u8bfb\u4e00\u4e0b\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u53d1\u73b0\u521b\u5efa\u7684\u6bcf\u4e2a\u8def\u7531\u7684 checker \u4e0d\u662f\u5168\u5c40\u552f\u4e00\u7684\uff0c\u800c\u662f\u6bcf\u4e2a work \u521b\u5efa\u4e86\u4e00\u4e2a\uff0c\u53d1\u73b0\u95ee\u9898\u5c31\u597d\u529e\u4e86\uff0c\u521b\u5efa\u7684 work \u90fd\u7528\u4e00\u4e2a name \u5c31\u80fd\u4fdd\u8bc1\u5168\u5c40\u552f\u4e00\u4e86\uff0c\u867d\u7136\u6539\u52a8\u5f88\u5c0f\uff0c\u4f46\u8fd8\u662f\u8d76\u7d27\u63d0\u4ea4\u4e86\u4e00\u4e2a PR\u3002\\n\\n\u628a\u7ebf\u4e0a\u4e1a\u52a1 APISIX \u5347\u7ea7\u5230\u4e86 0.7\uff0c\u7136\u540e\u89c2\u5bdf\u670d\u52a1\u8d44\u6e90\u5360\u7528\u60c5\u51b5\uff0c\u6bd5\u7adf\u662f\u5347\u7ea7\u4e86\u8f83\u5927\u7684\u7248\u672c\uff0c\u5934\u51e0\u4e2a\u5c0f\u65f6\u8fd8\u6ca1\u611f\u89c9\uff0c\u548c\u4e4b\u524d 0.5 \u5dee\u4e0d\u591a\u3002\u7b49\u4e0b\u73ed\u65f6\u518d\u770b\u4e00\u773c\uff0c\u597d\u50cf\u5185\u5b58\u8d44\u6e90\u5360\u7528\u597d\u50cf\u4e0d\u592a\u5bf9\uff0c0.5 \u7248\u672c\u4e00\u76f4\u6bd4\u8f83\u7a33\u5b9a\uff0c0.7 \u5374\u597d\u50cf\u6709\u6cc4\u6f0f\uff0c\u56e0\u4e3a\u5185\u5b58\u7684\u5360\u7528\u589e\u957f\u5f88\u6162\uff0c\u5c31\u51b3\u5b9a\u518d\u89c2\u5bdf\u4e00\u665a\u4e0a\u3002\u7b2c\u4e8c\u5929\u6765\u5bf9\u6bd4\u4e86\u76d1\u63a7\u6570\u636e\uff0c\u786e\u5b9a\u662f\u6709\u5185\u5b58\u6cc4\u6f0f\uff0c\u8d76\u7d27\u56de\u6eda\u5230\u4e0a\u4e00\u4e2a\u7248\u672c\u3002\u548c\u9662\u751f\u53cd\u9988\u4e86\u4e00\u4e0b\u95ee\u9898\uff0c\u6839\u636e\u6211\u63cf\u8ff0\u7684\u573a\u666f\u901a\u8fc7\u538b\u6d4b\u53d1\u73b0\u4e86\u95ee\u9898\u6240\u5728\uff0c\u662f radixtree \u7684\u95ee\u9898\uff0c\u9662\u751f\u53d1\u5e03\u4e86 radixtree \u7684\u65b0\u7248\u672c\uff0c\u6211\u5347\u7ea7\u4e86\u4e00\u4e0b\u4f9d\u8d56\uff0c\u7136\u540e\u5728\u8fdb\u884c\u538b\u6d4b\uff0c\u6ca1\u6709\u590d\u73b0\u95ee\u9898\uff0c\u7686\u5927\u6b22\u559c\u3002\\n\\n\u518d\u6b21\u4e0a\u7ebf\uff0cApache APISIX 0.7 \u7248\u672c\u8fd8\u662f\u7ed9\u4e86\u6211\u4e00\u4e9b\u60ca\u559c\u7684\uff0c\u4e4b\u524d Apache APISIX 0.5 \u7248\u672c\u4f7f\u7528\u7684\u8def\u7531\u4f9d\u8d56\u662f libr3\uff0c\u800c Apache APISIX 0.7 \u662f\u6362\u7528\u4e86 radixtree\uff0c\u8f83\u4e4b\u524d\u6709\u66f4\u597d\u7684\u8868\u73b0\uff0ccpu \u4f7f\u7528\u7387\u548c\u5185\u5b58\u90fd\u6709\u6240\u4e0b\u964d\uff0cApache APISIX 0.5 \u7248\u672c\u5355 work \u7684 cpu \u5728 1-10%\uff0c\u5185\u5b58 0.1%\uff0cApache APISIX 0.7 \u7248\u672c\u5355 work \u7684 cpu \u4f7f\u7528\u7387\u964d\u4f4e\u5230 1-2%\uff0c\u5185\u5b58\u4e5f\u4e0d\u8db3 0.1% \u4e86\uff0c\u4f18\u79c0\u3002\\n\\n## \u672a\u6765\u89c4\u5212\\n\\nApache APISIX \u5728\u7ebf\u4e0a\u5df2\u7ecf\u8dd1\u4e86\u4e24\u4e2a\u6708\u4e86\uff0c\u8fd8\u672a\u51fa\u73b0\u7ebf\u4e0a\u6545\u969c\uff0c\u7a83\u559c\u3002\u8fd9\u624d\u662f\u5f00\u59cb\uff0c\u540e\u7eed\u6211\u4eec\u8fd8\u80fd\u505a\u5f88\u591a\u4e1c\u897f\uff0c\u628a\u66f4\u591a\u7684\u80fd\u529b\u5c55\u73b0\u7ed9\u670d\u52a1\u65b9\u3002\u7f51\u5173\u63d0\u4f9b\u7684\u4e0d\u4ec5\u4ec5\u53ea\u662f\u53cd\u5411\u4ee3\u7406\uff0c\u53ef\u4ee5\u7ed9\u4e00\u4e9b\u6ca1\u6709\u66f4\u591a\u7cbe\u529b\u53bb\u5f00\u53d1\u4fdd\u8bc1\u670d\u52a1\u7a33\u5b9a\u529f\u80fd\u7684\u56e2\u961f\u63d0\u4f9b\u5e2e\u52a9\uff0c\u5305\u62ec\u9650\u6d41\u3001\u7194\u65ad\u3001\u76d1\u63a7\u7b49\u670d\u52a1\uff0c\u8fd8\u6709\u63a5\u5165\u7684\u5e73\u53f0\u3002\u6700\u540e\u611f\u8c22\u4e24\u4f4d\u5927\u4f6c\u63d0\u4f9b\u4e86\u8fd9\u4e48\u4f18\u79c0\u7684\u4ea7\u54c1\uff0c\u4e5f\u611f\u8c22 Apache APISIX \u793e\u533a\u8d21\u732e\u51fa\u7684\u8fed\u4ee3\u529f\u80fd\u3002\\n\\n\u73b0\u5728\u7f51\u5173\u6bcf\u65e5\u6d41\u91cf\u5df2\u7ecf\u8fc7\u4ebf\uff0c\u8fd8\u6ca1\u6709\u4ec0\u4e48\u6027\u80fd\u95ee\u9898\uff0c\u6d41\u91cf\u5982\u679c\u80fd\u8fbe\u5230\u5341\u4ebf\u7ea7\uff0c\u540e\u7eed\u8fd8\u4f1a\u518d\u5206\u4eab\u4e00\u4e0b Apache APISIX \u548c\u6211\u7684\u524d\u884c\u4e4b\u8def\uff0c\u6b22\u8fce\u5927\u5bb6\u5173\u6ce8\u3002"}]}')}}]);